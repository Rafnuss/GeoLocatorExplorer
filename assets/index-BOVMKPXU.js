(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const F of document.querySelectorAll('link[rel="modulepreload"]'))z(F);new MutationObserver(F=>{for(const q of F)if(q.type==="childList")for(const V of q.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&z(V)}).observe(document,{childList:!0,subtree:!0});function p(F){const q={};return F.integrity&&(q.integrity=F.integrity),F.referrerPolicy&&(q.referrerPolicy=F.referrerPolicy),F.crossOrigin==="use-credentials"?q.credentials="include":F.crossOrigin==="anonymous"?q.credentials="omit":q.credentials="same-origin",q}function z(F){if(F.ep)return;F.ep=!0;const q=p(F);fetch(F.href,q)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function D1(v){const y=Object.create(null);for(const p of v.split(","))y[p]=1;return p=>p in y}const Co={},ag=[],Ih=()=>{},V3=()=>!1,N0=v=>v.charCodeAt(0)===111&&v.charCodeAt(1)===110&&(v.charCodeAt(2)>122||v.charCodeAt(2)<97),O1=v=>v.startsWith("onUpdate:"),Ya=Object.assign,z1=(v,y)=>{const p=v.indexOf(y);p>-1&&v.splice(p,1)},G3=Object.prototype.hasOwnProperty,oo=(v,y)=>G3.call(v,y),gs=Array.isArray,lg=v=>U0(v)==="[object Map]",MS=v=>U0(v)==="[object Set]",Cs=v=>typeof v=="function",da=v=>typeof v=="string",Dp=v=>typeof v=="symbol",Vo=v=>v!==null&&typeof v=="object",SS=v=>(Vo(v)||Cs(v))&&Cs(v.then)&&Cs(v.catch),ES=Object.prototype.toString,U0=v=>ES.call(v),H3=v=>U0(v).slice(8,-1),AS=v=>U0(v)==="[object Object]",k1=v=>da(v)&&v!=="NaN"&&v[0]!=="-"&&""+parseInt(v,10)===v,N_=D1(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),V0=v=>{const y=Object.create(null);return p=>y[p]||(y[p]=v(p))},j3=/-(\w)/g,Lp=V0(v=>v.replace(j3,(y,p)=>p?p.toUpperCase():"")),W3=/\B([A-Z])/g,nm=V0(v=>v.replace(W3,"-$1").toLowerCase()),CS=V0(v=>v.charAt(0).toUpperCase()+v.slice(1)),ix=V0(v=>v?`on${CS(v)}`:""),Yf=(v,y)=>!Object.is(v,y),nx=(v,...y)=>{for(let p=0;p<v.length;p++)v[p](...y)},LS=(v,y,p,z=!1)=>{Object.defineProperty(v,y,{configurable:!0,enumerable:!1,writable:z,value:p})},q3=v=>{const y=parseFloat(v);return isNaN(y)?v:y};let MT;const G0=()=>MT||(MT=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function F1(v){if(gs(v)){const y={};for(let p=0;p<v.length;p++){const z=v[p],F=da(z)?Y3(z):F1(z);if(F)for(const q in F)y[q]=F[q]}return y}else if(da(v)||Vo(v))return v}const $3=/;(?![^(]*\))/g,Z3=/:([^]+)/,X3=/\/\*[^]*?\*\//g;function Y3(v){const y={};return v.replace(X3,"").split($3).forEach(p=>{if(p){const z=p.split(Z3);z.length>1&&(y[z[0].trim()]=z[1].trim())}}),y}function H0(v){let y="";if(da(v))y=v;else if(gs(v))for(let p=0;p<v.length;p++){const z=H0(v[p]);z&&(y+=z+" ")}else if(Vo(v))for(const p in v)v[p]&&(y+=p+" ");return y.trim()}const K3="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",J3=D1(K3);function IS(v){return!!v||v===""}const RS=v=>!!(v&&v.__v_isRef===!0),PS=v=>da(v)?v:v==null?"":gs(v)||Vo(v)&&(v.toString===ES||!Cs(v.toString))?RS(v)?PS(v.value):JSON.stringify(v,DS,2):String(v),DS=(v,y)=>RS(y)?DS(v,y.value):lg(y)?{[`Map(${y.size})`]:[...y.entries()].reduce((p,[z,F],q)=>(p[rx(z,q)+" =>"]=F,p),{})}:MS(y)?{[`Set(${y.size})`]:[...y.values()].map(p=>rx(p))}:Dp(y)?rx(y):Vo(y)&&!gs(y)&&!AS(y)?String(y):y,rx=(v,y="")=>{var p;return Dp(v)?`Symbol(${(p=v.description)!=null?p:y})`:v};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let dc;class Q3{constructor(y=!1){this.detached=y,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=dc,!y&&dc&&(this.index=(dc.scopes||(dc.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let y,p;if(this.scopes)for(y=0,p=this.scopes.length;y<p;y++)this.scopes[y].pause();for(y=0,p=this.effects.length;y<p;y++)this.effects[y].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let y,p;if(this.scopes)for(y=0,p=this.scopes.length;y<p;y++)this.scopes[y].resume();for(y=0,p=this.effects.length;y<p;y++)this.effects[y].resume()}}run(y){if(this._active){const p=dc;try{return dc=this,y()}finally{dc=p}}}on(){dc=this}off(){dc=this.parent}stop(y){if(this._active){this._active=!1;let p,z;for(p=0,z=this.effects.length;p<z;p++)this.effects[p].stop();for(this.effects.length=0,p=0,z=this.cleanups.length;p<z;p++)this.cleanups[p]();if(this.cleanups.length=0,this.scopes){for(p=0,z=this.scopes.length;p<z;p++)this.scopes[p].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!y){const F=this.parent.scopes.pop();F&&F!==this&&(this.parent.scopes[this.index]=F,F.index=this.index)}this.parent=void 0}}}function eC(){return dc}let Ao;const sx=new WeakSet;class OS{constructor(y){this.fn=y,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,dc&&dc.active&&dc.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,sx.has(this)&&(sx.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||kS(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,ST(this),FS(this);const y=Ao,p=Ou;Ao=this,Ou=!0;try{return this.fn()}finally{BS(this),Ao=y,Ou=p,this.flags&=-3}}stop(){if(this.flags&1){for(let y=this.deps;y;y=y.nextDep)U1(y);this.deps=this.depsTail=void 0,ST(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?sx.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){d1(this)&&this.run()}get dirty(){return d1(this)}}let zS=0,U_,V_;function kS(v,y=!1){if(v.flags|=8,y){v.next=V_,V_=v;return}v.next=U_,U_=v}function B1(){zS++}function N1(){if(--zS>0)return;if(V_){let y=V_;for(V_=void 0;y;){const p=y.next;y.next=void 0,y.flags&=-9,y=p}}let v;for(;U_;){let y=U_;for(U_=void 0;y;){const p=y.next;if(y.next=void 0,y.flags&=-9,y.flags&1)try{y.trigger()}catch(z){v||(v=z)}y=p}}if(v)throw v}function FS(v){for(let y=v.deps;y;y=y.nextDep)y.version=-1,y.prevActiveLink=y.dep.activeLink,y.dep.activeLink=y}function BS(v){let y,p=v.depsTail,z=p;for(;z;){const F=z.prevDep;z.version===-1?(z===p&&(p=F),U1(z),tC(z)):y=z,z.dep.activeLink=z.prevActiveLink,z.prevActiveLink=void 0,z=F}v.deps=y,v.depsTail=p}function d1(v){for(let y=v.deps;y;y=y.nextDep)if(y.dep.version!==y.version||y.dep.computed&&(NS(y.dep.computed)||y.dep.version!==y.version))return!0;return!!v._dirty}function NS(v){if(v.flags&4&&!(v.flags&16)||(v.flags&=-17,v.globalVersion===$_))return;v.globalVersion=$_;const y=v.dep;if(v.flags|=2,y.version>0&&!v.isSSR&&v.deps&&!d1(v)){v.flags&=-3;return}const p=Ao,z=Ou;Ao=v,Ou=!0;try{FS(v);const F=v.fn(v._value);(y.version===0||Yf(F,v._value))&&(v._value=F,y.version++)}catch(F){throw y.version++,F}finally{Ao=p,Ou=z,BS(v),v.flags&=-3}}function U1(v,y=!1){const{dep:p,prevSub:z,nextSub:F}=v;if(z&&(z.nextSub=F,v.prevSub=void 0),F&&(F.prevSub=z,v.nextSub=void 0),p.subs===v&&(p.subs=z,!z&&p.computed)){p.computed.flags&=-5;for(let q=p.computed.deps;q;q=q.nextDep)U1(q,!0)}!y&&!--p.sc&&p.map&&p.map.delete(p.key)}function tC(v){const{prevDep:y,nextDep:p}=v;y&&(y.nextDep=p,v.prevDep=void 0),p&&(p.prevDep=y,v.nextDep=void 0)}let Ou=!0;const US=[];function Op(){US.push(Ou),Ou=!1}function zp(){const v=US.pop();Ou=v===void 0?!0:v}function ST(v){const{cleanup:y}=v;if(v.cleanup=void 0,y){const p=Ao;Ao=void 0;try{y()}finally{Ao=p}}}let $_=0;class iC{constructor(y,p){this.sub=y,this.dep=p,this.version=p.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class VS{constructor(y){this.computed=y,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(y){if(!Ao||!Ou||Ao===this.computed)return;let p=this.activeLink;if(p===void 0||p.sub!==Ao)p=this.activeLink=new iC(Ao,this),Ao.deps?(p.prevDep=Ao.depsTail,Ao.depsTail.nextDep=p,Ao.depsTail=p):Ao.deps=Ao.depsTail=p,GS(p);else if(p.version===-1&&(p.version=this.version,p.nextDep)){const z=p.nextDep;z.prevDep=p.prevDep,p.prevDep&&(p.prevDep.nextDep=z),p.prevDep=Ao.depsTail,p.nextDep=void 0,Ao.depsTail.nextDep=p,Ao.depsTail=p,Ao.deps===p&&(Ao.deps=z)}return p}trigger(y){this.version++,$_++,this.notify(y)}notify(y){B1();try{for(let p=this.subs;p;p=p.prevSub)p.sub.notify()&&p.sub.dep.notify()}finally{N1()}}}function GS(v){if(v.dep.sc++,v.sub.flags&4){const y=v.dep.computed;if(y&&!v.dep.subs){y.flags|=20;for(let z=y.deps;z;z=z.nextDep)GS(z)}const p=v.dep.subs;p!==v&&(v.prevSub=p,p&&(p.nextSub=v)),v.dep.subs=v}}const p1=new WeakMap,Kf=Symbol(""),f1=Symbol(""),Z_=Symbol("");function ol(v,y,p){if(Ou&&Ao){let z=p1.get(v);z||p1.set(v,z=new Map);let F=z.get(p);F||(z.set(p,F=new VS),F.map=z,F.key=p),F.track()}}function vd(v,y,p,z,F,q){const V=p1.get(v);if(!V){$_++;return}const n=J=>{J&&J.trigger()};if(B1(),y==="clear")V.forEach(n);else{const J=gs(v),re=J&&k1(p);if(J&&p==="length"){const ce=Number(z);V.forEach((Se,Xe)=>{(Xe==="length"||Xe===Z_||!Dp(Xe)&&Xe>=ce)&&n(Se)})}else switch((p!==void 0||V.has(void 0))&&n(V.get(p)),re&&n(V.get(Z_)),y){case"add":J?re&&n(V.get("length")):(n(V.get(Kf)),lg(v)&&n(V.get(f1)));break;case"delete":J||(n(V.get(Kf)),lg(v)&&n(V.get(f1)));break;case"set":lg(v)&&n(V.get(Kf));break}}N1()}function Ym(v){const y=po(v);return y===v?y:(ol(y,"iterate",Z_),zu(v)?y:y.map(ql))}function j0(v){return ol(v=po(v),"iterate",Z_),v}const nC={__proto__:null,[Symbol.iterator](){return ox(this,Symbol.iterator,ql)},concat(...v){return Ym(this).concat(...v.map(y=>gs(y)?Ym(y):y))},entries(){return ox(this,"entries",v=>(v[1]=ql(v[1]),v))},every(v,y){return fd(this,"every",v,y,void 0,arguments)},filter(v,y){return fd(this,"filter",v,y,p=>p.map(ql),arguments)},find(v,y){return fd(this,"find",v,y,ql,arguments)},findIndex(v,y){return fd(this,"findIndex",v,y,void 0,arguments)},findLast(v,y){return fd(this,"findLast",v,y,ql,arguments)},findLastIndex(v,y){return fd(this,"findLastIndex",v,y,void 0,arguments)},forEach(v,y){return fd(this,"forEach",v,y,void 0,arguments)},includes(...v){return ax(this,"includes",v)},indexOf(...v){return ax(this,"indexOf",v)},join(v){return Ym(this).join(v)},lastIndexOf(...v){return ax(this,"lastIndexOf",v)},map(v,y){return fd(this,"map",v,y,void 0,arguments)},pop(){return D_(this,"pop")},push(...v){return D_(this,"push",v)},reduce(v,...y){return ET(this,"reduce",v,y)},reduceRight(v,...y){return ET(this,"reduceRight",v,y)},shift(){return D_(this,"shift")},some(v,y){return fd(this,"some",v,y,void 0,arguments)},splice(...v){return D_(this,"splice",v)},toReversed(){return Ym(this).toReversed()},toSorted(v){return Ym(this).toSorted(v)},toSpliced(...v){return Ym(this).toSpliced(...v)},unshift(...v){return D_(this,"unshift",v)},values(){return ox(this,"values",ql)}};function ox(v,y,p){const z=j0(v),F=z[y]();return z!==v&&!zu(v)&&(F._next=F.next,F.next=()=>{const q=F._next();return q.value&&(q.value=p(q.value)),q}),F}const rC=Array.prototype;function fd(v,y,p,z,F,q){const V=j0(v),n=V!==v&&!zu(v),J=V[y];if(J!==rC[y]){const Se=J.apply(v,q);return n?ql(Se):Se}let re=p;V!==v&&(n?re=function(Se,Xe){return p.call(this,ql(Se),Xe,v)}:p.length>2&&(re=function(Se,Xe){return p.call(this,Se,Xe,v)}));const ce=J.call(V,re,z);return n&&F?F(ce):ce}function ET(v,y,p,z){const F=j0(v);let q=p;return F!==v&&(zu(v)?p.length>3&&(q=function(V,n,J){return p.call(this,V,n,J,v)}):q=function(V,n,J){return p.call(this,V,ql(n),J,v)}),F[y](q,...z)}function ax(v,y,p){const z=po(v);ol(z,"iterate",Z_);const F=z[y](...p);return(F===-1||F===!1)&&j1(p[0])?(p[0]=po(p[0]),z[y](...p)):F}function D_(v,y,p=[]){Op(),B1();const z=po(v)[y].apply(v,p);return N1(),zp(),z}const sC=D1("__proto__,__v_isRef,__isVue"),HS=new Set(Object.getOwnPropertyNames(Symbol).filter(v=>v!=="arguments"&&v!=="caller").map(v=>Symbol[v]).filter(Dp));function oC(v){Dp(v)||(v=String(v));const y=po(this);return ol(y,"has",v),y.hasOwnProperty(v)}class jS{constructor(y=!1,p=!1){this._isReadonly=y,this._isShallow=p}get(y,p,z){if(p==="__v_skip")return y.__v_skip;const F=this._isReadonly,q=this._isShallow;if(p==="__v_isReactive")return!F;if(p==="__v_isReadonly")return F;if(p==="__v_isShallow")return q;if(p==="__v_raw")return z===(F?q?gC:ZS:q?$S:qS).get(y)||Object.getPrototypeOf(y)===Object.getPrototypeOf(z)?y:void 0;const V=gs(y);if(!F){let J;if(V&&(J=nC[p]))return J;if(p==="hasOwnProperty")return oC}const n=Reflect.get(y,p,Pl(y)?y:z);return(Dp(p)?HS.has(p):sC(p))||(F||ol(y,"get",p),q)?n:Pl(n)?V&&k1(p)?n:n.value:Vo(n)?F?XS(n):G1(n):n}}class WS extends jS{constructor(y=!1){super(!1,y)}set(y,p,z,F){let q=y[p];if(!this._isShallow){const J=dg(q);if(!zu(z)&&!dg(z)&&(q=po(q),z=po(z)),!gs(y)&&Pl(q)&&!Pl(z))return J?!1:(q.value=z,!0)}const V=gs(y)&&k1(p)?Number(p)<y.length:oo(y,p),n=Reflect.set(y,p,z,Pl(y)?y:F);return y===po(F)&&(V?Yf(z,q)&&vd(y,"set",p,z):vd(y,"add",p,z)),n}deleteProperty(y,p){const z=oo(y,p);y[p];const F=Reflect.deleteProperty(y,p);return F&&z&&vd(y,"delete",p,void 0),F}has(y,p){const z=Reflect.has(y,p);return(!Dp(p)||!HS.has(p))&&ol(y,"has",p),z}ownKeys(y){return ol(y,"iterate",gs(y)?"length":Kf),Reflect.ownKeys(y)}}class aC extends jS{constructor(y=!1){super(!0,y)}set(y,p){return!0}deleteProperty(y,p){return!0}}const lC=new WS,cC=new aC,uC=new WS(!0);const m1=v=>v,n0=v=>Reflect.getPrototypeOf(v);function hC(v,y,p){return function(...z){const F=this.__v_raw,q=po(F),V=lg(q),n=v==="entries"||v===Symbol.iterator&&V,J=v==="keys"&&V,re=F[v](...z),ce=p?m1:y?g1:ql;return!y&&ol(q,"iterate",J?f1:Kf),{next(){const{value:Se,done:Xe}=re.next();return Xe?{value:Se,done:Xe}:{value:n?[ce(Se[0]),ce(Se[1])]:ce(Se),done:Xe}},[Symbol.iterator](){return this}}}}function r0(v){return function(...y){return v==="delete"?!1:v==="clear"?void 0:this}}function dC(v,y){const p={get(F){const q=this.__v_raw,V=po(q),n=po(F);v||(Yf(F,n)&&ol(V,"get",F),ol(V,"get",n));const{has:J}=n0(V),re=y?m1:v?g1:ql;if(J.call(V,F))return re(q.get(F));if(J.call(V,n))return re(q.get(n));q!==V&&q.get(F)},get size(){const F=this.__v_raw;return!v&&ol(po(F),"iterate",Kf),Reflect.get(F,"size",F)},has(F){const q=this.__v_raw,V=po(q),n=po(F);return v||(Yf(F,n)&&ol(V,"has",F),ol(V,"has",n)),F===n?q.has(F):q.has(F)||q.has(n)},forEach(F,q){const V=this,n=V.__v_raw,J=po(n),re=y?m1:v?g1:ql;return!v&&ol(J,"iterate",Kf),n.forEach((ce,Se)=>F.call(q,re(ce),re(Se),V))}};return Ya(p,v?{add:r0("add"),set:r0("set"),delete:r0("delete"),clear:r0("clear")}:{add(F){!y&&!zu(F)&&!dg(F)&&(F=po(F));const q=po(this);return n0(q).has.call(q,F)||(q.add(F),vd(q,"add",F,F)),this},set(F,q){!y&&!zu(q)&&!dg(q)&&(q=po(q));const V=po(this),{has:n,get:J}=n0(V);let re=n.call(V,F);re||(F=po(F),re=n.call(V,F));const ce=J.call(V,F);return V.set(F,q),re?Yf(q,ce)&&vd(V,"set",F,q):vd(V,"add",F,q),this},delete(F){const q=po(this),{has:V,get:n}=n0(q);let J=V.call(q,F);J||(F=po(F),J=V.call(q,F)),n&&n.call(q,F);const re=q.delete(F);return J&&vd(q,"delete",F,void 0),re},clear(){const F=po(this),q=F.size!==0,V=F.clear();return q&&vd(F,"clear",void 0,void 0),V}}),["keys","values","entries",Symbol.iterator].forEach(F=>{p[F]=hC(F,v,y)}),p}function V1(v,y){const p=dC(v,y);return(z,F,q)=>F==="__v_isReactive"?!v:F==="__v_isReadonly"?v:F==="__v_raw"?z:Reflect.get(oo(p,F)&&F in z?p:z,F,q)}const pC={get:V1(!1,!1)},fC={get:V1(!1,!0)},mC={get:V1(!0,!1)};const qS=new WeakMap,$S=new WeakMap,ZS=new WeakMap,gC=new WeakMap;function _C(v){switch(v){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function yC(v){return v.__v_skip||!Object.isExtensible(v)?0:_C(H3(v))}function G1(v){return dg(v)?v:H1(v,!1,lC,pC,qS)}function vC(v){return H1(v,!1,uC,fC,$S)}function XS(v){return H1(v,!0,cC,mC,ZS)}function H1(v,y,p,z,F){if(!Vo(v)||v.__v_raw&&!(y&&v.__v_isReactive))return v;const q=F.get(v);if(q)return q;const V=yC(v);if(V===0)return v;const n=new Proxy(v,V===2?z:p);return F.set(v,n),n}function cg(v){return dg(v)?cg(v.__v_raw):!!(v&&v.__v_isReactive)}function dg(v){return!!(v&&v.__v_isReadonly)}function zu(v){return!!(v&&v.__v_isShallow)}function j1(v){return v?!!v.__v_raw:!1}function po(v){const y=v&&v.__v_raw;return y?po(y):v}function xC(v){return!oo(v,"__v_skip")&&Object.isExtensible(v)&&LS(v,"__v_skip",!0),v}const ql=v=>Vo(v)?G1(v):v,g1=v=>Vo(v)?XS(v):v;function Pl(v){return v?v.__v_isRef===!0:!1}function bC(v){return Pl(v)?v.value:v}const wC={get:(v,y,p)=>y==="__v_raw"?v:bC(Reflect.get(v,y,p)),set:(v,y,p,z)=>{const F=v[y];return Pl(F)&&!Pl(p)?(F.value=p,!0):Reflect.set(v,y,p,z)}};function YS(v){return cg(v)?v:new Proxy(v,wC)}class TC{constructor(y,p,z){this.fn=y,this.setter=p,this._value=void 0,this.dep=new VS(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=$_-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!p,this.isSSR=z}notify(){if(this.flags|=16,!(this.flags&8)&&Ao!==this)return kS(this,!0),!0}get value(){const y=this.dep.track();return NS(this),y&&(y.version=this.dep.version),this._value}set value(y){this.setter&&this.setter(y)}}function MC(v,y,p=!1){let z,F;return Cs(v)?z=v:(z=v.get,F=v.set),new TC(z,F,p)}const s0={},E0=new WeakMap;let $f;function SC(v,y=!1,p=$f){if(p){let z=E0.get(p);z||E0.set(p,z=[]),z.push(v)}}function EC(v,y,p=Co){const{immediate:z,deep:F,once:q,scheduler:V,augmentJob:n,call:J}=p,re=Zt=>F?Zt:zu(Zt)||F===!1||F===0?Cp(Zt,1):Cp(Zt);let ce,Se,Xe,ht,Ut=!1,ct=!1;if(Pl(v)?(Se=()=>v.value,Ut=zu(v)):cg(v)?(Se=()=>re(v),Ut=!0):gs(v)?(ct=!0,Ut=v.some(Zt=>cg(Zt)||zu(Zt)),Se=()=>v.map(Zt=>{if(Pl(Zt))return Zt.value;if(cg(Zt))return re(Zt);if(Cs(Zt))return J?J(Zt,2):Zt()})):Cs(v)?y?Se=J?()=>J(v,2):v:Se=()=>{if(Xe){Op();try{Xe()}finally{zp()}}const Zt=$f;$f=ce;try{return J?J(v,3,[ht]):v(ht)}finally{$f=Zt}}:Se=Ih,y&&F){const Zt=Se,At=F===!0?1/0:F;Se=()=>Cp(Zt(),At)}const Dt=eC(),rt=()=>{ce.stop(),Dt&&Dt.active&&z1(Dt.effects,ce)};if(q&&y){const Zt=y;y=(...At)=>{Zt(...At),rt()}}let pt=ct?new Array(v.length).fill(s0):s0;const gi=Zt=>{if(!(!(ce.flags&1)||!ce.dirty&&!Zt))if(y){const At=ce.run();if(F||Ut||(ct?At.some((It,Ye)=>Yf(It,pt[Ye])):Yf(At,pt))){Xe&&Xe();const It=$f;$f=ce;try{const Ye=[At,pt===s0?void 0:ct&&pt[0]===s0?[]:pt,ht];J?J(y,3,Ye):y(...Ye),pt=At}finally{$f=It}}}else ce.run()};return n&&n(gi),ce=new OS(Se),ce.scheduler=V?()=>V(gi,!1):gi,ht=Zt=>SC(Zt,!1,ce),Xe=ce.onStop=()=>{const Zt=E0.get(ce);if(Zt){if(J)J(Zt,4);else for(const At of Zt)At();E0.delete(ce)}},y?z?gi(!0):pt=ce.run():V?V(gi.bind(null,!0),!0):ce.run(),rt.pause=ce.pause.bind(ce),rt.resume=ce.resume.bind(ce),rt.stop=rt,rt}function Cp(v,y=1/0,p){if(y<=0||!Vo(v)||v.__v_skip||(p=p||new Set,p.has(v)))return v;if(p.add(v),y--,Pl(v))Cp(v.value,y,p);else if(gs(v))for(let z=0;z<v.length;z++)Cp(v[z],y,p);else if(MS(v)||lg(v))v.forEach(z=>{Cp(z,y,p)});else if(AS(v)){for(const z in v)Cp(v[z],y,p);for(const z of Object.getOwnPropertySymbols(v))Object.prototype.propertyIsEnumerable.call(v,z)&&Cp(v[z],y,p)}return v}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ey(v,y,p,z){try{return z?v(...z):v()}catch(F){W0(F,y,p)}}function Oh(v,y,p,z){if(Cs(v)){const F=ey(v,y,p,z);return F&&SS(F)&&F.catch(q=>{W0(q,y,p)}),F}if(gs(v)){const F=[];for(let q=0;q<v.length;q++)F.push(Oh(v[q],y,p,z));return F}}function W0(v,y,p,z=!0){const F=y?y.vnode:null,{errorHandler:q,throwUnhandledErrorInProduction:V}=y&&y.appContext.config||Co;if(y){let n=y.parent;const J=y.proxy,re=`https://vuejs.org/error-reference/#runtime-${p}`;for(;n;){const ce=n.ec;if(ce){for(let Se=0;Se<ce.length;Se++)if(ce[Se](v,J,re)===!1)return}n=n.parent}if(q){Op(),ey(q,null,10,[v,J,re]),zp();return}}AC(v,p,F,z,V)}function AC(v,y,p,z=!0,F=!1){if(F)throw v;console.error(v)}const Il=[];let Eh=-1;const ug=[];let Ep=null,ig=0;const KS=Promise.resolve();let A0=null;function CC(v){const y=A0||KS;return v?y.then(this?v.bind(this):v):y}function LC(v){let y=Eh+1,p=Il.length;for(;y<p;){const z=y+p>>>1,F=Il[z],q=X_(F);q<v||q===v&&F.flags&2?y=z+1:p=z}return y}function W1(v){if(!(v.flags&1)){const y=X_(v),p=Il[Il.length-1];!p||!(v.flags&2)&&y>=X_(p)?Il.push(v):Il.splice(LC(y),0,v),v.flags|=1,JS()}}function JS(){A0||(A0=KS.then(e2))}function IC(v){gs(v)?ug.push(...v):Ep&&v.id===-1?Ep.splice(ig+1,0,v):v.flags&1||(ug.push(v),v.flags|=1),JS()}function AT(v,y,p=Eh+1){for(;p<Il.length;p++){const z=Il[p];if(z&&z.flags&2){if(v&&z.id!==v.uid)continue;Il.splice(p,1),p--,z.flags&4&&(z.flags&=-2),z(),z.flags&4||(z.flags&=-2)}}}function QS(v){if(ug.length){const y=[...new Set(ug)].sort((p,z)=>X_(p)-X_(z));if(ug.length=0,Ep){Ep.push(...y);return}for(Ep=y,ig=0;ig<Ep.length;ig++){const p=Ep[ig];p.flags&4&&(p.flags&=-2),p.flags&8||p(),p.flags&=-2}Ep=null,ig=0}}const X_=v=>v.id==null?v.flags&2?-1:1/0:v.id;function e2(v){try{for(Eh=0;Eh<Il.length;Eh++){const y=Il[Eh];y&&!(y.flags&8)&&(y.flags&4&&(y.flags&=-2),ey(y,y.i,y.i?15:14),y.flags&4||(y.flags&=-2))}}finally{for(;Eh<Il.length;Eh++){const y=Il[Eh];y&&(y.flags&=-2)}Eh=-1,Il.length=0,QS(),A0=null,(Il.length||ug.length)&&e2()}}let Lh=null,t2=null;function C0(v){const y=Lh;return Lh=v,t2=v&&v.type.__scopeId||null,y}function RC(v,y=Lh,p){if(!y||v._n)return v;const z=(...F)=>{z._d&&zT(-1);const q=C0(y);let V;try{V=v(...F)}finally{C0(q),z._d&&zT(1)}return V};return z._n=!0,z._c=!0,z._d=!0,z}function Wf(v,y,p,z){const F=v.dirs,q=y&&y.dirs;for(let V=0;V<F.length;V++){const n=F[V];q&&(n.oldValue=q[V].value);let J=n.dir[z];J&&(Op(),Oh(J,p,8,[v.el,n,v,y]),zp())}}const PC=Symbol("_vte"),DC=v=>v.__isTeleport;function q1(v,y){v.shapeFlag&6&&v.component?(v.transition=y,q1(v.component.subTree,y)):v.shapeFlag&128?(v.ssContent.transition=y.clone(v.ssContent),v.ssFallback.transition=y.clone(v.ssFallback)):v.transition=y}function i2(v){v.ids=[v.ids[0]+v.ids[2]+++"-",0,0]}function L0(v,y,p,z,F=!1){if(gs(v)){v.forEach((Ut,ct)=>L0(Ut,y&&(gs(y)?y[ct]:y),p,z,F));return}if(G_(z)&&!F){z.shapeFlag&512&&z.type.__asyncResolved&&z.component.subTree.component&&L0(v,y,p,z.component.subTree);return}const q=z.shapeFlag&4?Y1(z.component):z.el,V=F?null:q,{i:n,r:J}=v,re=y&&y.r,ce=n.refs===Co?n.refs={}:n.refs,Se=n.setupState,Xe=po(Se),ht=Se===Co?()=>!1:Ut=>oo(Xe,Ut);if(re!=null&&re!==J&&(da(re)?(ce[re]=null,ht(re)&&(Se[re]=null)):Pl(re)&&(re.value=null)),Cs(J))ey(J,n,12,[V,ce]);else{const Ut=da(J),ct=Pl(J);if(Ut||ct){const Dt=()=>{if(v.f){const rt=Ut?ht(J)?Se[J]:ce[J]:J.value;F?gs(rt)&&z1(rt,q):gs(rt)?rt.includes(q)||rt.push(q):Ut?(ce[J]=[q],ht(J)&&(Se[J]=ce[J])):(J.value=[q],v.k&&(ce[v.k]=J.value))}else Ut?(ce[J]=V,ht(J)&&(Se[J]=V)):ct&&(J.value=V,v.k&&(ce[v.k]=V))};V?(Dt.id=-1,hc(Dt,p)):Dt()}}}G0().requestIdleCallback;G0().cancelIdleCallback;const G_=v=>!!v.type.__asyncLoader,n2=v=>v.type.__isKeepAlive;function OC(v,y){r2(v,"a",y)}function zC(v,y){r2(v,"da",y)}function r2(v,y,p=Rl){const z=v.__wdc||(v.__wdc=()=>{let F=p;for(;F;){if(F.isDeactivated)return;F=F.parent}return v()});if(q0(y,z,p),p){let F=p.parent;for(;F&&F.parent;)n2(F.parent.vnode)&&kC(z,y,p,F),F=F.parent}}function kC(v,y,p,z){const F=q0(y,v,z,!0);s2(()=>{z1(z[y],F)},p)}function q0(v,y,p=Rl,z=!1){if(p){const F=p[v]||(p[v]=[]),q=y.__weh||(y.__weh=(...V)=>{Op();const n=ty(p),J=Oh(y,p,v,V);return n(),zp(),J});return z?F.unshift(q):F.push(q),q}}const Ed=v=>(y,p=Rl)=>{(!K_||v==="sp")&&q0(v,(...z)=>y(...z),p)},FC=Ed("bm"),BC=Ed("m"),NC=Ed("bu"),UC=Ed("u"),VC=Ed("bum"),s2=Ed("um"),GC=Ed("sp"),HC=Ed("rtg"),jC=Ed("rtc");function WC(v,y=Rl){q0("ec",v,y)}const qC=Symbol.for("v-ndc");function $C(v,y,p,z){let F;const q=p,V=gs(v);if(V||da(v)){const n=V&&cg(v);let J=!1;n&&(J=!zu(v),v=j0(v)),F=new Array(v.length);for(let re=0,ce=v.length;re<ce;re++)F[re]=y(J?ql(v[re]):v[re],re,void 0,q)}else if(typeof v=="number"){F=new Array(v);for(let n=0;n<v;n++)F[n]=y(n+1,n,void 0,q)}else if(Vo(v))if(v[Symbol.iterator])F=Array.from(v,(n,J)=>y(n,J,void 0,q));else{const n=Object.keys(v);F=new Array(n.length);for(let J=0,re=n.length;J<re;J++){const ce=n[J];F[J]=y(v[ce],ce,J,q)}}else F=[];return F}const _1=v=>v?E2(v)?Y1(v):_1(v.parent):null,H_=Ya(Object.create(null),{$:v=>v,$el:v=>v.vnode.el,$data:v=>v.data,$props:v=>v.props,$attrs:v=>v.attrs,$slots:v=>v.slots,$refs:v=>v.refs,$parent:v=>_1(v.parent),$root:v=>_1(v.root),$host:v=>v.ce,$emit:v=>v.emit,$options:v=>$1(v),$forceUpdate:v=>v.f||(v.f=()=>{W1(v.update)}),$nextTick:v=>v.n||(v.n=CC.bind(v.proxy)),$watch:v=>mL.bind(v)}),lx=(v,y)=>v!==Co&&!v.__isScriptSetup&&oo(v,y),ZC={get({_:v},y){if(y==="__v_skip")return!0;const{ctx:p,setupState:z,data:F,props:q,accessCache:V,type:n,appContext:J}=v;let re;if(y[0]!=="$"){const ht=V[y];if(ht!==void 0)switch(ht){case 1:return z[y];case 2:return F[y];case 4:return p[y];case 3:return q[y]}else{if(lx(z,y))return V[y]=1,z[y];if(F!==Co&&oo(F,y))return V[y]=2,F[y];if((re=v.propsOptions[0])&&oo(re,y))return V[y]=3,q[y];if(p!==Co&&oo(p,y))return V[y]=4,p[y];y1&&(V[y]=0)}}const ce=H_[y];let Se,Xe;if(ce)return y==="$attrs"&&ol(v.attrs,"get",""),ce(v);if((Se=n.__cssModules)&&(Se=Se[y]))return Se;if(p!==Co&&oo(p,y))return V[y]=4,p[y];if(Xe=J.config.globalProperties,oo(Xe,y))return Xe[y]},set({_:v},y,p){const{data:z,setupState:F,ctx:q}=v;return lx(F,y)?(F[y]=p,!0):z!==Co&&oo(z,y)?(z[y]=p,!0):oo(v.props,y)||y[0]==="$"&&y.slice(1)in v?!1:(q[y]=p,!0)},has({_:{data:v,setupState:y,accessCache:p,ctx:z,appContext:F,propsOptions:q}},V){let n;return!!p[V]||v!==Co&&oo(v,V)||lx(y,V)||(n=q[0])&&oo(n,V)||oo(z,V)||oo(H_,V)||oo(F.config.globalProperties,V)},defineProperty(v,y,p){return p.get!=null?v._.accessCache[y]=0:oo(p,"value")&&this.set(v,y,p.value,null),Reflect.defineProperty(v,y,p)}};function CT(v){return gs(v)?v.reduce((y,p)=>(y[p]=null,y),{}):v}let y1=!0;function XC(v){const y=$1(v),p=v.proxy,z=v.ctx;y1=!1,y.beforeCreate&&LT(y.beforeCreate,v,"bc");const{data:F,computed:q,methods:V,watch:n,provide:J,inject:re,created:ce,beforeMount:Se,mounted:Xe,beforeUpdate:ht,updated:Ut,activated:ct,deactivated:Dt,beforeDestroy:rt,beforeUnmount:pt,destroyed:gi,unmounted:Zt,render:At,renderTracked:It,renderTriggered:Ye,errorCaptured:ot,serverPrefetch:tt,expose:et,inheritAttrs:Rt,components:at,directives:_t,filters:Qt}=y;if(re&&YC(re,z,null),V)for(const ve in V){const De=V[ve];Cs(De)&&(z[ve]=De.bind(p))}if(F){const ve=F.call(p,p);Vo(ve)&&(v.data=G1(ve))}if(y1=!0,q)for(const ve in q){const De=q[ve],Ce=Cs(De)?De.bind(p,p):Cs(De.get)?De.get.bind(p,p):Ih,Vt=!Cs(De)&&Cs(De.set)?De.set.bind(p):Ih,zt=BL({get:Ce,set:Vt});Object.defineProperty(z,ve,{enumerable:!0,configurable:!0,get:()=>zt.value,set:mt=>zt.value=mt})}if(n)for(const ve in n)o2(n[ve],z,p,ve);if(J){const ve=Cs(J)?J.call(p):J;Reflect.ownKeys(ve).forEach(De=>{iL(De,ve[De])})}ce&&LT(ce,v,"c");function be(ve,De){gs(De)?De.forEach(Ce=>ve(Ce.bind(p))):De&&ve(De.bind(p))}if(be(FC,Se),be(BC,Xe),be(NC,ht),be(UC,Ut),be(OC,ct),be(zC,Dt),be(WC,ot),be(jC,It),be(HC,Ye),be(VC,pt),be(s2,Zt),be(GC,tt),gs(et))if(et.length){const ve=v.exposed||(v.exposed={});et.forEach(De=>{Object.defineProperty(ve,De,{get:()=>p[De],set:Ce=>p[De]=Ce})})}else v.exposed||(v.exposed={});At&&v.render===Ih&&(v.render=At),Rt!=null&&(v.inheritAttrs=Rt),at&&(v.components=at),_t&&(v.directives=_t),tt&&i2(v)}function YC(v,y,p=Ih){gs(v)&&(v=v1(v));for(const z in v){const F=v[z];let q;Vo(F)?"default"in F?q=y0(F.from||z,F.default,!0):q=y0(F.from||z):q=y0(F),Pl(q)?Object.defineProperty(y,z,{enumerable:!0,configurable:!0,get:()=>q.value,set:V=>q.value=V}):y[z]=q}}function LT(v,y,p){Oh(gs(v)?v.map(z=>z.bind(y.proxy)):v.bind(y.proxy),y,p)}function o2(v,y,p,z){let F=z.includes(".")?x2(p,z):()=>p[z];if(da(v)){const q=y[v];Cs(q)&&ux(F,q)}else if(Cs(v))ux(F,v.bind(p));else if(Vo(v))if(gs(v))v.forEach(q=>o2(q,y,p,z));else{const q=Cs(v.handler)?v.handler.bind(p):y[v.handler];Cs(q)&&ux(F,q,v)}}function $1(v){const y=v.type,{mixins:p,extends:z}=y,{mixins:F,optionsCache:q,config:{optionMergeStrategies:V}}=v.appContext,n=q.get(y);let J;return n?J=n:!F.length&&!p&&!z?J=y:(J={},F.length&&F.forEach(re=>I0(J,re,V,!0)),I0(J,y,V)),Vo(y)&&q.set(y,J),J}function I0(v,y,p,z=!1){const{mixins:F,extends:q}=y;q&&I0(v,q,p,!0),F&&F.forEach(V=>I0(v,V,p,!0));for(const V in y)if(!(z&&V==="expose")){const n=KC[V]||p&&p[V];v[V]=n?n(v[V],y[V]):y[V]}return v}const KC={data:IT,props:RT,emits:RT,methods:F_,computed:F_,beforeCreate:Ll,created:Ll,beforeMount:Ll,mounted:Ll,beforeUpdate:Ll,updated:Ll,beforeDestroy:Ll,beforeUnmount:Ll,destroyed:Ll,unmounted:Ll,activated:Ll,deactivated:Ll,errorCaptured:Ll,serverPrefetch:Ll,components:F_,directives:F_,watch:QC,provide:IT,inject:JC};function IT(v,y){return y?v?function(){return Ya(Cs(v)?v.call(this,this):v,Cs(y)?y.call(this,this):y)}:y:v}function JC(v,y){return F_(v1(v),v1(y))}function v1(v){if(gs(v)){const y={};for(let p=0;p<v.length;p++)y[v[p]]=v[p];return y}return v}function Ll(v,y){return v?[...new Set([].concat(v,y))]:y}function F_(v,y){return v?Ya(Object.create(null),v,y):y}function RT(v,y){return v?gs(v)&&gs(y)?[...new Set([...v,...y])]:Ya(Object.create(null),CT(v),CT(y??{})):y}function QC(v,y){if(!v)return y;if(!y)return v;const p=Ya(Object.create(null),v);for(const z in y)p[z]=Ll(v[z],y[z]);return p}function a2(){return{app:null,config:{isNativeTag:V3,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let eL=0;function tL(v,y){return function(z,F=null){Cs(z)||(z=Ya({},z)),F!=null&&!Vo(F)&&(F=null);const q=a2(),V=new WeakSet,n=[];let J=!1;const re=q.app={_uid:eL++,_component:z,_props:F,_container:null,_context:q,_instance:null,version:NL,get config(){return q.config},set config(ce){},use(ce,...Se){return V.has(ce)||(ce&&Cs(ce.install)?(V.add(ce),ce.install(re,...Se)):Cs(ce)&&(V.add(ce),ce(re,...Se))),re},mixin(ce){return q.mixins.includes(ce)||q.mixins.push(ce),re},component(ce,Se){return Se?(q.components[ce]=Se,re):q.components[ce]},directive(ce,Se){return Se?(q.directives[ce]=Se,re):q.directives[ce]},mount(ce,Se,Xe){if(!J){const ht=re._ceVNode||bd(z,F);return ht.appContext=q,Xe===!0?Xe="svg":Xe===!1&&(Xe=void 0),Se&&y?y(ht,ce):v(ht,ce,Xe),J=!0,re._container=ce,ce.__vue_app__=re,Y1(ht.component)}},onUnmount(ce){n.push(ce)},unmount(){J&&(Oh(n,re._instance,16),v(null,re._container),delete re._container.__vue_app__)},provide(ce,Se){return q.provides[ce]=Se,re},runWithContext(ce){const Se=hg;hg=re;try{return ce()}finally{hg=Se}}};return re}}let hg=null;function iL(v,y){if(Rl){let p=Rl.provides;const z=Rl.parent&&Rl.parent.provides;z===p&&(p=Rl.provides=Object.create(z)),p[v]=y}}function y0(v,y,p=!1){const z=Rl||Lh;if(z||hg){const F=hg?hg._context.provides:z?z.parent==null?z.vnode.appContext&&z.vnode.appContext.provides:z.parent.provides:void 0;if(F&&v in F)return F[v];if(arguments.length>1)return p&&Cs(y)?y.call(z&&z.proxy):y}}const l2={},c2=()=>Object.create(l2),u2=v=>Object.getPrototypeOf(v)===l2;function nL(v,y,p,z=!1){const F={},q=c2();v.propsDefaults=Object.create(null),h2(v,y,F,q);for(const V in v.propsOptions[0])V in F||(F[V]=void 0);p?v.props=z?F:vC(F):v.type.props?v.props=F:v.props=q,v.attrs=q}function rL(v,y,p,z){const{props:F,attrs:q,vnode:{patchFlag:V}}=v,n=po(F),[J]=v.propsOptions;let re=!1;if((z||V>0)&&!(V&16)){if(V&8){const ce=v.vnode.dynamicProps;for(let Se=0;Se<ce.length;Se++){let Xe=ce[Se];if($0(v.emitsOptions,Xe))continue;const ht=y[Xe];if(J)if(oo(q,Xe))ht!==q[Xe]&&(q[Xe]=ht,re=!0);else{const Ut=Lp(Xe);F[Ut]=x1(J,n,Ut,ht,v,!1)}else ht!==q[Xe]&&(q[Xe]=ht,re=!0)}}}else{h2(v,y,F,q)&&(re=!0);let ce;for(const Se in n)(!y||!oo(y,Se)&&((ce=nm(Se))===Se||!oo(y,ce)))&&(J?p&&(p[Se]!==void 0||p[ce]!==void 0)&&(F[Se]=x1(J,n,Se,void 0,v,!0)):delete F[Se]);if(q!==n)for(const Se in q)(!y||!oo(y,Se))&&(delete q[Se],re=!0)}re&&vd(v.attrs,"set","")}function h2(v,y,p,z){const[F,q]=v.propsOptions;let V=!1,n;if(y)for(let J in y){if(N_(J))continue;const re=y[J];let ce;F&&oo(F,ce=Lp(J))?!q||!q.includes(ce)?p[ce]=re:(n||(n={}))[ce]=re:$0(v.emitsOptions,J)||(!(J in z)||re!==z[J])&&(z[J]=re,V=!0)}if(q){const J=po(p),re=n||Co;for(let ce=0;ce<q.length;ce++){const Se=q[ce];p[Se]=x1(F,J,Se,re[Se],v,!oo(re,Se))}}return V}function x1(v,y,p,z,F,q){const V=v[p];if(V!=null){const n=oo(V,"default");if(n&&z===void 0){const J=V.default;if(V.type!==Function&&!V.skipFactory&&Cs(J)){const{propsDefaults:re}=F;if(p in re)z=re[p];else{const ce=ty(F);z=re[p]=J.call(null,y),ce()}}else z=J;F.ce&&F.ce._setProp(p,z)}V[0]&&(q&&!n?z=!1:V[1]&&(z===""||z===nm(p))&&(z=!0))}return z}const sL=new WeakMap;function d2(v,y,p=!1){const z=p?sL:y.propsCache,F=z.get(v);if(F)return F;const q=v.props,V={},n=[];let J=!1;if(!Cs(v)){const ce=Se=>{J=!0;const[Xe,ht]=d2(Se,y,!0);Ya(V,Xe),ht&&n.push(...ht)};!p&&y.mixins.length&&y.mixins.forEach(ce),v.extends&&ce(v.extends),v.mixins&&v.mixins.forEach(ce)}if(!q&&!J)return Vo(v)&&z.set(v,ag),ag;if(gs(q))for(let ce=0;ce<q.length;ce++){const Se=Lp(q[ce]);PT(Se)&&(V[Se]=Co)}else if(q)for(const ce in q){const Se=Lp(ce);if(PT(Se)){const Xe=q[ce],ht=V[Se]=gs(Xe)||Cs(Xe)?{type:Xe}:Ya({},Xe),Ut=ht.type;let ct=!1,Dt=!0;if(gs(Ut))for(let rt=0;rt<Ut.length;++rt){const pt=Ut[rt],gi=Cs(pt)&&pt.name;if(gi==="Boolean"){ct=!0;break}else gi==="String"&&(Dt=!1)}else ct=Cs(Ut)&&Ut.name==="Boolean";ht[0]=ct,ht[1]=Dt,(ct||oo(ht,"default"))&&n.push(Se)}}const re=[V,n];return Vo(v)&&z.set(v,re),re}function PT(v){return v[0]!=="$"&&!N_(v)}const p2=v=>v[0]==="_"||v==="$stable",Z1=v=>gs(v)?v.map(Ch):[Ch(v)],oL=(v,y,p)=>{if(y._n)return y;const z=RC((...F)=>Z1(y(...F)),p);return z._c=!1,z},f2=(v,y,p)=>{const z=v._ctx;for(const F in v){if(p2(F))continue;const q=v[F];if(Cs(q))y[F]=oL(F,q,z);else if(q!=null){const V=Z1(q);y[F]=()=>V}}},m2=(v,y)=>{const p=Z1(y);v.slots.default=()=>p},g2=(v,y,p)=>{for(const z in y)(p||z!=="_")&&(v[z]=y[z])},aL=(v,y,p)=>{const z=v.slots=c2();if(v.vnode.shapeFlag&32){const F=y._;F?(g2(z,y,p),p&&LS(z,"_",F,!0)):f2(y,z)}else y&&m2(v,y)},lL=(v,y,p)=>{const{vnode:z,slots:F}=v;let q=!0,V=Co;if(z.shapeFlag&32){const n=y._;n?p&&n===1?q=!1:g2(F,y,p):(q=!y.$stable,f2(y,F)),V=y}else y&&(m2(v,y),V={default:1});if(q)for(const n in F)!p2(n)&&V[n]==null&&delete F[n]},hc=wL;function cL(v){return uL(v)}function uL(v,y){const p=G0();p.__VUE__=!0;const{insert:z,remove:F,patchProp:q,createElement:V,createText:n,createComment:J,setText:re,setElementText:ce,parentNode:Se,nextSibling:Xe,setScopeId:ht=Ih,insertStaticContent:Ut}=v,ct=(bt,je,Ot,Le=null,Ie=null,Fe=null,Ge=void 0,Je=null,st=!!je.dynamicChildren)=>{if(bt===je)return;bt&&!O_(bt,je)&&(Le=Hi(bt),mt(bt,Ie,Fe,!0),bt=null),je.patchFlag===-2&&(st=!1,je.dynamicChildren=null);const{type:lt,ref:Tt,shapeFlag:Mt}=je;switch(lt){case Z0:Dt(bt,je,Ot,Le);break;case em:rt(bt,je,Ot,Le);break;case dx:bt==null&&pt(je,Ot,Le,Ge);break;case Ah:at(bt,je,Ot,Le,Ie,Fe,Ge,Je,st);break;default:Mt&1?At(bt,je,Ot,Le,Ie,Fe,Ge,Je,st):Mt&6?_t(bt,je,Ot,Le,Ie,Fe,Ge,Je,st):(Mt&64||Mt&128)&&lt.process(bt,je,Ot,Le,Ie,Fe,Ge,Je,st,Qe)}Tt!=null&&Ie&&L0(Tt,bt&&bt.ref,Fe,je||bt,!je)},Dt=(bt,je,Ot,Le)=>{if(bt==null)z(je.el=n(je.children),Ot,Le);else{const Ie=je.el=bt.el;je.children!==bt.children&&re(Ie,je.children)}},rt=(bt,je,Ot,Le)=>{bt==null?z(je.el=J(je.children||""),Ot,Le):je.el=bt.el},pt=(bt,je,Ot,Le)=>{[bt.el,bt.anchor]=Ut(bt.children,je,Ot,Le,bt.el,bt.anchor)},gi=({el:bt,anchor:je},Ot,Le)=>{let Ie;for(;bt&&bt!==je;)Ie=Xe(bt),z(bt,Ot,Le),bt=Ie;z(je,Ot,Le)},Zt=({el:bt,anchor:je})=>{let Ot;for(;bt&&bt!==je;)Ot=Xe(bt),F(bt),bt=Ot;F(je)},At=(bt,je,Ot,Le,Ie,Fe,Ge,Je,st)=>{je.type==="svg"?Ge="svg":je.type==="math"&&(Ge="mathml"),bt==null?It(je,Ot,Le,Ie,Fe,Ge,Je,st):tt(bt,je,Ie,Fe,Ge,Je,st)},It=(bt,je,Ot,Le,Ie,Fe,Ge,Je)=>{let st,lt;const{props:Tt,shapeFlag:Mt,transition:ci,dirs:xi}=bt;if(st=bt.el=V(bt.type,Fe,Tt&&Tt.is,Tt),Mt&8?ce(st,bt.children):Mt&16&&ot(bt.children,st,null,Le,Ie,cx(bt,Fe),Ge,Je),xi&&Wf(bt,null,Le,"created"),Ye(st,bt,bt.scopeId,Ge,Le),Tt){for(const cn in Tt)cn!=="value"&&!N_(cn)&&q(st,cn,null,Tt[cn],Fe,Le);"value"in Tt&&q(st,"value",null,Tt.value,Fe),(lt=Tt.onVnodeBeforeMount)&&Sh(lt,Le,bt)}xi&&Wf(bt,null,Le,"beforeMount");const an=hL(Ie,ci);an&&ci.beforeEnter(st),z(st,je,Ot),((lt=Tt&&Tt.onVnodeMounted)||an||xi)&&hc(()=>{lt&&Sh(lt,Le,bt),an&&ci.enter(st),xi&&Wf(bt,null,Le,"mounted")},Ie)},Ye=(bt,je,Ot,Le,Ie)=>{if(Ot&&ht(bt,Ot),Le)for(let Fe=0;Fe<Le.length;Fe++)ht(bt,Le[Fe]);if(Ie){let Fe=Ie.subTree;if(je===Fe||w2(Fe.type)&&(Fe.ssContent===je||Fe.ssFallback===je)){const Ge=Ie.vnode;Ye(bt,Ge,Ge.scopeId,Ge.slotScopeIds,Ie.parent)}}},ot=(bt,je,Ot,Le,Ie,Fe,Ge,Je,st=0)=>{for(let lt=st;lt<bt.length;lt++){const Tt=bt[lt]=Je?Ap(bt[lt]):Ch(bt[lt]);ct(null,Tt,je,Ot,Le,Ie,Fe,Ge,Je)}},tt=(bt,je,Ot,Le,Ie,Fe,Ge)=>{const Je=je.el=bt.el;let{patchFlag:st,dynamicChildren:lt,dirs:Tt}=je;st|=bt.patchFlag&16;const Mt=bt.props||Co,ci=je.props||Co;let xi;if(Ot&&qf(Ot,!1),(xi=ci.onVnodeBeforeUpdate)&&Sh(xi,Ot,je,bt),Tt&&Wf(je,bt,Ot,"beforeUpdate"),Ot&&qf(Ot,!0),(Mt.innerHTML&&ci.innerHTML==null||Mt.textContent&&ci.textContent==null)&&ce(Je,""),lt?et(bt.dynamicChildren,lt,Je,Ot,Le,cx(je,Ie),Fe):Ge||De(bt,je,Je,null,Ot,Le,cx(je,Ie),Fe,!1),st>0){if(st&16)Rt(Je,Mt,ci,Ot,Ie);else if(st&2&&Mt.class!==ci.class&&q(Je,"class",null,ci.class,Ie),st&4&&q(Je,"style",Mt.style,ci.style,Ie),st&8){const an=je.dynamicProps;for(let cn=0;cn<an.length;cn++){const _n=an[cn],Fn=Mt[_n],Mn=ci[_n];(Mn!==Fn||_n==="value")&&q(Je,_n,Fn,Mn,Ie,Ot)}}st&1&&bt.children!==je.children&&ce(Je,je.children)}else!Ge&&lt==null&&Rt(Je,Mt,ci,Ot,Ie);((xi=ci.onVnodeUpdated)||Tt)&&hc(()=>{xi&&Sh(xi,Ot,je,bt),Tt&&Wf(je,bt,Ot,"updated")},Le)},et=(bt,je,Ot,Le,Ie,Fe,Ge)=>{for(let Je=0;Je<je.length;Je++){const st=bt[Je],lt=je[Je],Tt=st.el&&(st.type===Ah||!O_(st,lt)||st.shapeFlag&70)?Se(st.el):Ot;ct(st,lt,Tt,null,Le,Ie,Fe,Ge,!0)}},Rt=(bt,je,Ot,Le,Ie)=>{if(je!==Ot){if(je!==Co)for(const Fe in je)!N_(Fe)&&!(Fe in Ot)&&q(bt,Fe,je[Fe],null,Ie,Le);for(const Fe in Ot){if(N_(Fe))continue;const Ge=Ot[Fe],Je=je[Fe];Ge!==Je&&Fe!=="value"&&q(bt,Fe,Je,Ge,Ie,Le)}"value"in Ot&&q(bt,"value",je.value,Ot.value,Ie)}},at=(bt,je,Ot,Le,Ie,Fe,Ge,Je,st)=>{const lt=je.el=bt?bt.el:n(""),Tt=je.anchor=bt?bt.anchor:n("");let{patchFlag:Mt,dynamicChildren:ci,slotScopeIds:xi}=je;xi&&(Je=Je?Je.concat(xi):xi),bt==null?(z(lt,Ot,Le),z(Tt,Ot,Le),ot(je.children||[],Ot,Tt,Ie,Fe,Ge,Je,st)):Mt>0&&Mt&64&&ci&&bt.dynamicChildren?(et(bt.dynamicChildren,ci,Ot,Ie,Fe,Ge,Je),(je.key!=null||Ie&&je===Ie.subTree)&&_2(bt,je,!0)):De(bt,je,Ot,Tt,Ie,Fe,Ge,Je,st)},_t=(bt,je,Ot,Le,Ie,Fe,Ge,Je,st)=>{je.slotScopeIds=Je,bt==null?je.shapeFlag&512?Ie.ctx.activate(je,Ot,Le,Ge,st):Qt(je,Ot,Le,Ie,Fe,Ge,st):ae(bt,je,st)},Qt=(bt,je,Ot,Le,Ie,Fe,Ge)=>{const Je=bt.component=PL(bt,Le,Ie);if(n2(bt)&&(Je.ctx.renderer=Qe),DL(Je,!1,Ge),Je.asyncDep){if(Ie&&Ie.registerDep(Je,be,Ge),!bt.el){const st=Je.subTree=bd(em);rt(null,st,je,Ot)}}else be(Je,bt,je,Ot,Ie,Fe,Ge)},ae=(bt,je,Ot)=>{const Le=je.component=bt.component;if(xL(bt,je,Ot))if(Le.asyncDep&&!Le.asyncResolved){ve(Le,je,Ot);return}else Le.next=je,Le.update();else je.el=bt.el,Le.vnode=je},be=(bt,je,Ot,Le,Ie,Fe,Ge)=>{const Je=()=>{if(bt.isMounted){let{next:Mt,bu:ci,u:xi,parent:an,vnode:cn}=bt;{const Lr=y2(bt);if(Lr){Mt&&(Mt.el=cn.el,ve(bt,Mt,Ge)),Lr.asyncDep.then(()=>{bt.isUnmounted||Je()});return}}let _n=Mt,Fn;qf(bt,!1),Mt?(Mt.el=cn.el,ve(bt,Mt,Ge)):Mt=cn,ci&&nx(ci),(Fn=Mt.props&&Mt.props.onVnodeBeforeUpdate)&&Sh(Fn,an,Mt,cn),qf(bt,!0);const Mn=hx(bt),jn=bt.subTree;bt.subTree=Mn,ct(jn,Mn,Se(jn.el),Hi(jn),bt,Ie,Fe),Mt.el=Mn.el,_n===null&&bL(bt,Mn.el),xi&&hc(xi,Ie),(Fn=Mt.props&&Mt.props.onVnodeUpdated)&&hc(()=>Sh(Fn,an,Mt,cn),Ie)}else{let Mt;const{el:ci,props:xi}=je,{bm:an,m:cn,parent:_n,root:Fn,type:Mn}=bt,jn=G_(je);if(qf(bt,!1),an&&nx(an),!jn&&(Mt=xi&&xi.onVnodeBeforeMount)&&Sh(Mt,_n,je),qf(bt,!0),ci&&pr){const Lr=()=>{bt.subTree=hx(bt),pr(ci,bt.subTree,bt,Ie,null)};jn&&Mn.__asyncHydrate?Mn.__asyncHydrate(ci,bt,Lr):Lr()}else{Fn.ce&&Fn.ce._injectChildStyle(Mn);const Lr=bt.subTree=hx(bt);ct(null,Lr,Ot,Le,bt,Ie,Fe),je.el=Lr.el}if(cn&&hc(cn,Ie),!jn&&(Mt=xi&&xi.onVnodeMounted)){const Lr=je;hc(()=>Sh(Mt,_n,Lr),Ie)}(je.shapeFlag&256||_n&&G_(_n.vnode)&&_n.vnode.shapeFlag&256)&&bt.a&&hc(bt.a,Ie),bt.isMounted=!0,je=Ot=Le=null}};bt.scope.on();const st=bt.effect=new OS(Je);bt.scope.off();const lt=bt.update=st.run.bind(st),Tt=bt.job=st.runIfDirty.bind(st);Tt.i=bt,Tt.id=bt.uid,st.scheduler=()=>W1(Tt),qf(bt,!0),lt()},ve=(bt,je,Ot)=>{je.component=bt;const Le=bt.vnode.props;bt.vnode=je,bt.next=null,rL(bt,je.props,Le,Ot),lL(bt,je.children,Ot),Op(),AT(bt),zp()},De=(bt,je,Ot,Le,Ie,Fe,Ge,Je,st=!1)=>{const lt=bt&&bt.children,Tt=bt?bt.shapeFlag:0,Mt=je.children,{patchFlag:ci,shapeFlag:xi}=je;if(ci>0){if(ci&128){Vt(lt,Mt,Ot,Le,Ie,Fe,Ge,Je,st);return}else if(ci&256){Ce(lt,Mt,Ot,Le,Ie,Fe,Ge,Je,st);return}}xi&8?(Tt&16&&zi(lt,Ie,Fe),Mt!==lt&&ce(Ot,Mt)):Tt&16?xi&16?Vt(lt,Mt,Ot,Le,Ie,Fe,Ge,Je,st):zi(lt,Ie,Fe,!0):(Tt&8&&ce(Ot,""),xi&16&&ot(Mt,Ot,Le,Ie,Fe,Ge,Je,st))},Ce=(bt,je,Ot,Le,Ie,Fe,Ge,Je,st)=>{bt=bt||ag,je=je||ag;const lt=bt.length,Tt=je.length,Mt=Math.min(lt,Tt);let ci;for(ci=0;ci<Mt;ci++){const xi=je[ci]=st?Ap(je[ci]):Ch(je[ci]);ct(bt[ci],xi,Ot,null,Ie,Fe,Ge,Je,st)}lt>Tt?zi(bt,Ie,Fe,!0,!1,Mt):ot(je,Ot,Le,Ie,Fe,Ge,Je,st,Mt)},Vt=(bt,je,Ot,Le,Ie,Fe,Ge,Je,st)=>{let lt=0;const Tt=je.length;let Mt=bt.length-1,ci=Tt-1;for(;lt<=Mt&&lt<=ci;){const xi=bt[lt],an=je[lt]=st?Ap(je[lt]):Ch(je[lt]);if(O_(xi,an))ct(xi,an,Ot,null,Ie,Fe,Ge,Je,st);else break;lt++}for(;lt<=Mt&&lt<=ci;){const xi=bt[Mt],an=je[ci]=st?Ap(je[ci]):Ch(je[ci]);if(O_(xi,an))ct(xi,an,Ot,null,Ie,Fe,Ge,Je,st);else break;Mt--,ci--}if(lt>Mt){if(lt<=ci){const xi=ci+1,an=xi<Tt?je[xi].el:Le;for(;lt<=ci;)ct(null,je[lt]=st?Ap(je[lt]):Ch(je[lt]),Ot,an,Ie,Fe,Ge,Je,st),lt++}}else if(lt>ci)for(;lt<=Mt;)mt(bt[lt],Ie,Fe,!0),lt++;else{const xi=lt,an=lt,cn=new Map;for(lt=an;lt<=ci;lt++){const $r=je[lt]=st?Ap(je[lt]):Ch(je[lt]);$r.key!=null&&cn.set($r.key,lt)}let _n,Fn=0;const Mn=ci-an+1;let jn=!1,Lr=0;const Tr=new Array(Mn);for(lt=0;lt<Mn;lt++)Tr[lt]=0;for(lt=xi;lt<=Mt;lt++){const $r=bt[lt];if(Fn>=Mn){mt($r,Ie,Fe,!0);continue}let en;if($r.key!=null)en=cn.get($r.key);else for(_n=an;_n<=ci;_n++)if(Tr[_n-an]===0&&O_($r,je[_n])){en=_n;break}en===void 0?mt($r,Ie,Fe,!0):(Tr[en-an]=lt+1,en>=Lr?Lr=en:jn=!0,ct($r,je[en],Ot,null,Ie,Fe,Ge,Je,st),Fn++)}const eo=jn?dL(Tr):ag;for(_n=eo.length-1,lt=Mn-1;lt>=0;lt--){const $r=an+lt,en=je[$r],Wn=$r+1<Tt?je[$r+1].el:Le;Tr[lt]===0?ct(null,en,Ot,Wn,Ie,Fe,Ge,Je,st):jn&&(_n<0||lt!==eo[_n]?zt(en,Ot,Wn,2):_n--)}}},zt=(bt,je,Ot,Le,Ie=null)=>{const{el:Fe,type:Ge,transition:Je,children:st,shapeFlag:lt}=bt;if(lt&6){zt(bt.component.subTree,je,Ot,Le);return}if(lt&128){bt.suspense.move(je,Ot,Le);return}if(lt&64){Ge.move(bt,je,Ot,Qe);return}if(Ge===Ah){z(Fe,je,Ot);for(let Mt=0;Mt<st.length;Mt++)zt(st[Mt],je,Ot,Le);z(bt.anchor,je,Ot);return}if(Ge===dx){gi(bt,je,Ot);return}if(Le!==2&&lt&1&&Je)if(Le===0)Je.beforeEnter(Fe),z(Fe,je,Ot),hc(()=>Je.enter(Fe),Ie);else{const{leave:Mt,delayLeave:ci,afterLeave:xi}=Je,an=()=>z(Fe,je,Ot),cn=()=>{Mt(Fe,()=>{an(),xi&&xi()})};ci?ci(Fe,an,cn):cn()}else z(Fe,je,Ot)},mt=(bt,je,Ot,Le=!1,Ie=!1)=>{const{type:Fe,props:Ge,ref:Je,children:st,dynamicChildren:lt,shapeFlag:Tt,patchFlag:Mt,dirs:ci,cacheIndex:xi}=bt;if(Mt===-2&&(Ie=!1),Je!=null&&L0(Je,null,Ot,bt,!0),xi!=null&&(je.renderCache[xi]=void 0),Tt&256){je.ctx.deactivate(bt);return}const an=Tt&1&&ci,cn=!G_(bt);let _n;if(cn&&(_n=Ge&&Ge.onVnodeBeforeUnmount)&&Sh(_n,je,bt),Tt&6)ii(bt.component,Ot,Le);else{if(Tt&128){bt.suspense.unmount(Ot,Le);return}an&&Wf(bt,null,je,"beforeUnmount"),Tt&64?bt.type.remove(bt,je,Ot,Qe,Le):lt&&!lt.hasOnce&&(Fe!==Ah||Mt>0&&Mt&64)?zi(lt,je,Ot,!1,!0):(Fe===Ah&&Mt&384||!Ie&&Tt&16)&&zi(st,je,Ot),Le&&Nt(bt)}(cn&&(_n=Ge&&Ge.onVnodeUnmounted)||an)&&hc(()=>{_n&&Sh(_n,je,bt),an&&Wf(bt,null,je,"unmounted")},Ot)},Nt=bt=>{const{type:je,el:Ot,anchor:Le,transition:Ie}=bt;if(je===Ah){Gt(Ot,Le);return}if(je===dx){Zt(bt);return}const Fe=()=>{F(Ot),Ie&&!Ie.persisted&&Ie.afterLeave&&Ie.afterLeave()};if(bt.shapeFlag&1&&Ie&&!Ie.persisted){const{leave:Ge,delayLeave:Je}=Ie,st=()=>Ge(Ot,Fe);Je?Je(bt.el,Fe,st):st()}else Fe()},Gt=(bt,je)=>{let Ot;for(;bt!==je;)Ot=Xe(bt),F(bt),bt=Ot;F(je)},ii=(bt,je,Ot)=>{const{bum:Le,scope:Ie,job:Fe,subTree:Ge,um:Je,m:st,a:lt}=bt;DT(st),DT(lt),Le&&nx(Le),Ie.stop(),Fe&&(Fe.flags|=8,mt(Ge,bt,je,Ot)),Je&&hc(Je,je),hc(()=>{bt.isUnmounted=!0},je),je&&je.pendingBranch&&!je.isUnmounted&&bt.asyncDep&&!bt.asyncResolved&&bt.suspenseId===je.pendingId&&(je.deps--,je.deps===0&&je.resolve())},zi=(bt,je,Ot,Le=!1,Ie=!1,Fe=0)=>{for(let Ge=Fe;Ge<bt.length;Ge++)mt(bt[Ge],je,Ot,Le,Ie)},Hi=bt=>{if(bt.shapeFlag&6)return Hi(bt.component.subTree);if(bt.shapeFlag&128)return bt.suspense.next();const je=Xe(bt.anchor||bt.el),Ot=je&&je[PC];return Ot?Xe(Ot):je};let on=!1;const mn=(bt,je,Ot)=>{bt==null?je._vnode&&mt(je._vnode,null,null,!0):ct(je._vnode||null,bt,je,null,null,null,Ot),je._vnode=bt,on||(on=!0,AT(),QS(),on=!1)},Qe={p:ct,um:mt,m:zt,r:Nt,mt:Qt,mc:ot,pc:De,pbc:et,n:Hi,o:v};let Yn,pr;return{render:mn,hydrate:Yn,createApp:tL(mn,Yn)}}function cx({type:v,props:y},p){return p==="svg"&&v==="foreignObject"||p==="mathml"&&v==="annotation-xml"&&y&&y.encoding&&y.encoding.includes("html")?void 0:p}function qf({effect:v,job:y},p){p?(v.flags|=32,y.flags|=4):(v.flags&=-33,y.flags&=-5)}function hL(v,y){return(!v||v&&!v.pendingBranch)&&y&&!y.persisted}function _2(v,y,p=!1){const z=v.children,F=y.children;if(gs(z)&&gs(F))for(let q=0;q<z.length;q++){const V=z[q];let n=F[q];n.shapeFlag&1&&!n.dynamicChildren&&((n.patchFlag<=0||n.patchFlag===32)&&(n=F[q]=Ap(F[q]),n.el=V.el),!p&&n.patchFlag!==-2&&_2(V,n)),n.type===Z0&&(n.el=V.el)}}function dL(v){const y=v.slice(),p=[0];let z,F,q,V,n;const J=v.length;for(z=0;z<J;z++){const re=v[z];if(re!==0){if(F=p[p.length-1],v[F]<re){y[z]=F,p.push(z);continue}for(q=0,V=p.length-1;q<V;)n=q+V>>1,v[p[n]]<re?q=n+1:V=n;re<v[p[q]]&&(q>0&&(y[z]=p[q-1]),p[q]=z)}}for(q=p.length,V=p[q-1];q-- >0;)p[q]=V,V=y[V];return p}function y2(v){const y=v.subTree.component;if(y)return y.asyncDep&&!y.asyncResolved?y:y2(y)}function DT(v){if(v)for(let y=0;y<v.length;y++)v[y].flags|=8}const pL=Symbol.for("v-scx"),fL=()=>y0(pL);function ux(v,y,p){return v2(v,y,p)}function v2(v,y,p=Co){const{immediate:z,deep:F,flush:q,once:V}=p,n=Ya({},p),J=y&&z||!y&&q!=="post";let re;if(K_){if(q==="sync"){const ht=fL();re=ht.__watcherHandles||(ht.__watcherHandles=[])}else if(!J){const ht=()=>{};return ht.stop=Ih,ht.resume=Ih,ht.pause=Ih,ht}}const ce=Rl;n.call=(ht,Ut,ct)=>Oh(ht,ce,Ut,ct);let Se=!1;q==="post"?n.scheduler=ht=>{hc(ht,ce&&ce.suspense)}:q!=="sync"&&(Se=!0,n.scheduler=(ht,Ut)=>{Ut?ht():W1(ht)}),n.augmentJob=ht=>{y&&(ht.flags|=4),Se&&(ht.flags|=2,ce&&(ht.id=ce.uid,ht.i=ce))};const Xe=EC(v,y,n);return K_&&(re?re.push(Xe):J&&Xe()),Xe}function mL(v,y,p){const z=this.proxy,F=da(v)?v.includes(".")?x2(z,v):()=>z[v]:v.bind(z,z);let q;Cs(y)?q=y:(q=y.handler,p=y);const V=ty(this),n=v2(F,q.bind(z),p);return V(),n}function x2(v,y){const p=y.split(".");return()=>{let z=v;for(let F=0;F<p.length&&z;F++)z=z[p[F]];return z}}const gL=(v,y)=>y==="modelValue"||y==="model-value"?v.modelModifiers:v[`${y}Modifiers`]||v[`${Lp(y)}Modifiers`]||v[`${nm(y)}Modifiers`];function _L(v,y,...p){if(v.isUnmounted)return;const z=v.vnode.props||Co;let F=p;const q=y.startsWith("update:"),V=q&&gL(z,y.slice(7));V&&(V.trim&&(F=p.map(ce=>da(ce)?ce.trim():ce)),V.number&&(F=p.map(q3)));let n,J=z[n=ix(y)]||z[n=ix(Lp(y))];!J&&q&&(J=z[n=ix(nm(y))]),J&&Oh(J,v,6,F);const re=z[n+"Once"];if(re){if(!v.emitted)v.emitted={};else if(v.emitted[n])return;v.emitted[n]=!0,Oh(re,v,6,F)}}function b2(v,y,p=!1){const z=y.emitsCache,F=z.get(v);if(F!==void 0)return F;const q=v.emits;let V={},n=!1;if(!Cs(v)){const J=re=>{const ce=b2(re,y,!0);ce&&(n=!0,Ya(V,ce))};!p&&y.mixins.length&&y.mixins.forEach(J),v.extends&&J(v.extends),v.mixins&&v.mixins.forEach(J)}return!q&&!n?(Vo(v)&&z.set(v,null),null):(gs(q)?q.forEach(J=>V[J]=null):Ya(V,q),Vo(v)&&z.set(v,V),V)}function $0(v,y){return!v||!N0(y)?!1:(y=y.slice(2).replace(/Once$/,""),oo(v,y[0].toLowerCase()+y.slice(1))||oo(v,nm(y))||oo(v,y))}function hx(v){const{type:y,vnode:p,proxy:z,withProxy:F,propsOptions:[q],slots:V,attrs:n,emit:J,render:re,renderCache:ce,props:Se,data:Xe,setupState:ht,ctx:Ut,inheritAttrs:ct}=v,Dt=C0(v);let rt,pt;try{if(p.shapeFlag&4){const Zt=F||z,At=Zt;rt=Ch(re.call(At,Zt,ce,Se,ht,Xe,Ut)),pt=n}else{const Zt=y;rt=Ch(Zt.length>1?Zt(Se,{attrs:n,slots:V,emit:J}):Zt(Se,null)),pt=y.props?n:yL(n)}}catch(Zt){j_.length=0,W0(Zt,v,1),rt=bd(em)}let gi=rt;if(pt&&ct!==!1){const Zt=Object.keys(pt),{shapeFlag:At}=gi;Zt.length&&At&7&&(q&&Zt.some(O1)&&(pt=vL(pt,q)),gi=pg(gi,pt,!1,!0))}return p.dirs&&(gi=pg(gi,null,!1,!0),gi.dirs=gi.dirs?gi.dirs.concat(p.dirs):p.dirs),p.transition&&q1(gi,p.transition),rt=gi,C0(Dt),rt}const yL=v=>{let y;for(const p in v)(p==="class"||p==="style"||N0(p))&&((y||(y={}))[p]=v[p]);return y},vL=(v,y)=>{const p={};for(const z in v)(!O1(z)||!(z.slice(9)in y))&&(p[z]=v[z]);return p};function xL(v,y,p){const{props:z,children:F,component:q}=v,{props:V,children:n,patchFlag:J}=y,re=q.emitsOptions;if(y.dirs||y.transition)return!0;if(p&&J>=0){if(J&1024)return!0;if(J&16)return z?OT(z,V,re):!!V;if(J&8){const ce=y.dynamicProps;for(let Se=0;Se<ce.length;Se++){const Xe=ce[Se];if(V[Xe]!==z[Xe]&&!$0(re,Xe))return!0}}}else return(F||n)&&(!n||!n.$stable)?!0:z===V?!1:z?V?OT(z,V,re):!0:!!V;return!1}function OT(v,y,p){const z=Object.keys(y);if(z.length!==Object.keys(v).length)return!0;for(let F=0;F<z.length;F++){const q=z[F];if(y[q]!==v[q]&&!$0(p,q))return!0}return!1}function bL({vnode:v,parent:y},p){for(;y;){const z=y.subTree;if(z.suspense&&z.suspense.activeBranch===v&&(z.el=v.el),z===v)(v=y.vnode).el=p,y=y.parent;else break}}const w2=v=>v.__isSuspense;function wL(v,y){y&&y.pendingBranch?gs(v)?y.effects.push(...v):y.effects.push(v):IC(v)}const Ah=Symbol.for("v-fgt"),Z0=Symbol.for("v-txt"),em=Symbol.for("v-cmt"),dx=Symbol.for("v-stc"),j_=[];let pc=null;function gd(v=!1){j_.push(pc=v?null:[])}function TL(){j_.pop(),pc=j_[j_.length-1]||null}let Y_=1;function zT(v,y=!1){Y_+=v,v<0&&pc&&y&&(pc.hasOnce=!0)}function T2(v){return v.dynamicChildren=Y_>0?pc||ag:null,TL(),Y_>0&&pc&&pc.push(v),v}function Mp(v,y,p,z,F,q){return T2(Oa(v,y,p,z,F,q,!0))}function ML(v,y,p,z,F){return T2(bd(v,y,p,z,F,!0))}function M2(v){return v?v.__v_isVNode===!0:!1}function O_(v,y){return v.type===y.type&&v.key===y.key}const S2=({key:v})=>v??null,v0=({ref:v,ref_key:y,ref_for:p})=>(typeof v=="number"&&(v=""+v),v!=null?da(v)||Pl(v)||Cs(v)?{i:Lh,r:v,k:y,f:!!p}:v:null);function Oa(v,y=null,p=null,z=0,F=null,q=v===Ah?0:1,V=!1,n=!1){const J={__v_isVNode:!0,__v_skip:!0,type:v,props:y,key:y&&S2(y),ref:y&&v0(y),scopeId:t2,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:q,patchFlag:z,dynamicProps:F,dynamicChildren:null,appContext:null,ctx:Lh};return n?(X1(J,p),q&128&&v.normalize(J)):p&&(J.shapeFlag|=da(p)?8:16),Y_>0&&!V&&pc&&(J.patchFlag>0||q&6)&&J.patchFlag!==32&&pc.push(J),J}const bd=SL;function SL(v,y=null,p=null,z=0,F=null,q=!1){if((!v||v===qC)&&(v=em),M2(v)){const n=pg(v,y,!0);return p&&X1(n,p),Y_>0&&!q&&pc&&(n.shapeFlag&6?pc[pc.indexOf(v)]=n:pc.push(n)),n.patchFlag=-2,n}if(FL(v)&&(v=v.__vccOpts),y){y=EL(y);let{class:n,style:J}=y;n&&!da(n)&&(y.class=H0(n)),Vo(J)&&(j1(J)&&!gs(J)&&(J=Ya({},J)),y.style=F1(J))}const V=da(v)?1:w2(v)?128:DC(v)?64:Vo(v)?4:Cs(v)?2:0;return Oa(v,y,p,z,F,V,q,!0)}function EL(v){return v?j1(v)||u2(v)?Ya({},v):v:null}function pg(v,y,p=!1,z=!1){const{props:F,ref:q,patchFlag:V,children:n,transition:J}=v,re=y?LL(F||{},y):F,ce={__v_isVNode:!0,__v_skip:!0,type:v.type,props:re,key:re&&S2(re),ref:y&&y.ref?p&&q?gs(q)?q.concat(v0(y)):[q,v0(y)]:v0(y):q,scopeId:v.scopeId,slotScopeIds:v.slotScopeIds,children:n,target:v.target,targetStart:v.targetStart,targetAnchor:v.targetAnchor,staticCount:v.staticCount,shapeFlag:v.shapeFlag,patchFlag:y&&v.type!==Ah?V===-1?16:V|16:V,dynamicProps:v.dynamicProps,dynamicChildren:v.dynamicChildren,appContext:v.appContext,dirs:v.dirs,transition:J,component:v.component,suspense:v.suspense,ssContent:v.ssContent&&pg(v.ssContent),ssFallback:v.ssFallback&&pg(v.ssFallback),el:v.el,anchor:v.anchor,ctx:v.ctx,ce:v.ce};return J&&z&&q1(ce,J.clone(ce)),ce}function AL(v=" ",y=0){return bd(Z0,null,v,y)}function CL(v="",y=!1){return y?(gd(),ML(em,null,v)):bd(em,null,v)}function Ch(v){return v==null||typeof v=="boolean"?bd(em):gs(v)?bd(Ah,null,v.slice()):M2(v)?Ap(v):bd(Z0,null,String(v))}function Ap(v){return v.el===null&&v.patchFlag!==-1||v.memo?v:pg(v)}function X1(v,y){let p=0;const{shapeFlag:z}=v;if(y==null)y=null;else if(gs(y))p=16;else if(typeof y=="object")if(z&65){const F=y.default;F&&(F._c&&(F._d=!1),X1(v,F()),F._c&&(F._d=!0));return}else{p=32;const F=y._;!F&&!u2(y)?y._ctx=Lh:F===3&&Lh&&(Lh.slots._===1?y._=1:(y._=2,v.patchFlag|=1024))}else Cs(y)?(y={default:y,_ctx:Lh},p=32):(y=String(y),z&64?(p=16,y=[AL(y)]):p=8);v.children=y,v.shapeFlag|=p}function LL(...v){const y={};for(let p=0;p<v.length;p++){const z=v[p];for(const F in z)if(F==="class")y.class!==z.class&&(y.class=H0([y.class,z.class]));else if(F==="style")y.style=F1([y.style,z.style]);else if(N0(F)){const q=y[F],V=z[F];V&&q!==V&&!(gs(q)&&q.includes(V))&&(y[F]=q?[].concat(q,V):V)}else F!==""&&(y[F]=z[F])}return y}function Sh(v,y,p,z=null){Oh(v,y,7,[p,z])}const IL=a2();let RL=0;function PL(v,y,p){const z=v.type,F=(y?y.appContext:v.appContext)||IL,q={uid:RL++,vnode:v,type:z,parent:y,appContext:F,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Q3(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:y?y.provides:Object.create(F.provides),ids:y?y.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:d2(z,F),emitsOptions:b2(z,F),emit:null,emitted:null,propsDefaults:Co,inheritAttrs:z.inheritAttrs,ctx:Co,data:Co,props:Co,attrs:Co,slots:Co,refs:Co,setupState:Co,setupContext:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return q.ctx={_:q},q.root=y?y.root:q,q.emit=_L.bind(null,q),v.ce&&v.ce(q),q}let Rl=null,R0,b1;{const v=G0(),y=(p,z)=>{let F;return(F=v[p])||(F=v[p]=[]),F.push(z),q=>{F.length>1?F.forEach(V=>V(q)):F[0](q)}};R0=y("__VUE_INSTANCE_SETTERS__",p=>Rl=p),b1=y("__VUE_SSR_SETTERS__",p=>K_=p)}const ty=v=>{const y=Rl;return R0(v),v.scope.on(),()=>{v.scope.off(),R0(y)}},kT=()=>{Rl&&Rl.scope.off(),R0(null)};function E2(v){return v.vnode.shapeFlag&4}let K_=!1;function DL(v,y=!1,p=!1){y&&b1(y);const{props:z,children:F}=v.vnode,q=E2(v);nL(v,z,q,y),aL(v,F,p);const V=q?OL(v,y):void 0;return y&&b1(!1),V}function OL(v,y){const p=v.type;v.accessCache=Object.create(null),v.proxy=new Proxy(v.ctx,ZC);const{setup:z}=p;if(z){Op();const F=v.setupContext=z.length>1?kL(v):null,q=ty(v),V=ey(z,v,0,[v.props,F]),n=SS(V);if(zp(),q(),(n||v.sp)&&!G_(v)&&i2(v),n){if(V.then(kT,kT),y)return V.then(J=>{FT(v,J,y)}).catch(J=>{W0(J,v,0)});v.asyncDep=V}else FT(v,V,y)}else A2(v,y)}function FT(v,y,p){Cs(y)?v.type.__ssrInlineRender?v.ssrRender=y:v.render=y:Vo(y)&&(v.setupState=YS(y)),A2(v,p)}let BT;function A2(v,y,p){const z=v.type;if(!v.render){if(!y&&BT&&!z.render){const F=z.template||$1(v).template;if(F){const{isCustomElement:q,compilerOptions:V}=v.appContext.config,{delimiters:n,compilerOptions:J}=z,re=Ya(Ya({isCustomElement:q,delimiters:n},V),J);z.render=BT(F,re)}}v.render=z.render||Ih}{const F=ty(v);Op();try{XC(v)}finally{zp(),F()}}}const zL={get(v,y){return ol(v,"get",""),v[y]}};function kL(v){const y=p=>{v.exposed=p||{}};return{attrs:new Proxy(v.attrs,zL),slots:v.slots,emit:v.emit,expose:y}}function Y1(v){return v.exposed?v.exposeProxy||(v.exposeProxy=new Proxy(YS(xC(v.exposed)),{get(y,p){if(p in y)return y[p];if(p in H_)return H_[p](v)},has(y,p){return p in y||p in H_}})):v.proxy}function FL(v){return Cs(v)&&"__vccOpts"in v}const BL=(v,y)=>MC(v,y,K_),NL="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let w1;const NT=typeof window<"u"&&window.trustedTypes;if(NT)try{w1=NT.createPolicy("vue",{createHTML:v=>v})}catch{}const C2=w1?v=>w1.createHTML(v):v=>v,UL="http://www.w3.org/2000/svg",VL="http://www.w3.org/1998/Math/MathML",_d=typeof document<"u"?document:null,UT=_d&&_d.createElement("template"),GL={insert:(v,y,p)=>{y.insertBefore(v,p||null)},remove:v=>{const y=v.parentNode;y&&y.removeChild(v)},createElement:(v,y,p,z)=>{const F=y==="svg"?_d.createElementNS(UL,v):y==="mathml"?_d.createElementNS(VL,v):p?_d.createElement(v,{is:p}):_d.createElement(v);return v==="select"&&z&&z.multiple!=null&&F.setAttribute("multiple",z.multiple),F},createText:v=>_d.createTextNode(v),createComment:v=>_d.createComment(v),setText:(v,y)=>{v.nodeValue=y},setElementText:(v,y)=>{v.textContent=y},parentNode:v=>v.parentNode,nextSibling:v=>v.nextSibling,querySelector:v=>_d.querySelector(v),setScopeId(v,y){v.setAttribute(y,"")},insertStaticContent(v,y,p,z,F,q){const V=p?p.previousSibling:y.lastChild;if(F&&(F===q||F.nextSibling))for(;y.insertBefore(F.cloneNode(!0),p),!(F===q||!(F=F.nextSibling)););else{UT.innerHTML=C2(z==="svg"?`<svg>${v}</svg>`:z==="mathml"?`<math>${v}</math>`:v);const n=UT.content;if(z==="svg"||z==="mathml"){const J=n.firstChild;for(;J.firstChild;)n.appendChild(J.firstChild);n.removeChild(J)}y.insertBefore(n,p)}return[V?V.nextSibling:y.firstChild,p?p.previousSibling:y.lastChild]}},HL=Symbol("_vtc");function jL(v,y,p){const z=v[HL];z&&(y=(y?[y,...z]:[...z]).join(" ")),y==null?v.removeAttribute("class"):p?v.setAttribute("class",y):v.className=y}const VT=Symbol("_vod"),WL=Symbol("_vsh"),qL=Symbol(""),$L=/(^|;)\s*display\s*:/;function ZL(v,y,p){const z=v.style,F=da(p);let q=!1;if(p&&!F){if(y)if(da(y))for(const V of y.split(";")){const n=V.slice(0,V.indexOf(":")).trim();p[n]==null&&x0(z,n,"")}else for(const V in y)p[V]==null&&x0(z,V,"");for(const V in p)V==="display"&&(q=!0),x0(z,V,p[V])}else if(F){if(y!==p){const V=z[qL];V&&(p+=";"+V),z.cssText=p,q=$L.test(p)}}else y&&v.removeAttribute("style");VT in v&&(v[VT]=q?z.display:"",v[WL]&&(z.display="none"))}const GT=/\s*!important$/;function x0(v,y,p){if(gs(p))p.forEach(z=>x0(v,y,z));else if(p==null&&(p=""),y.startsWith("--"))v.setProperty(y,p);else{const z=XL(v,y);GT.test(p)?v.setProperty(nm(z),p.replace(GT,""),"important"):v[z]=p}}const HT=["Webkit","Moz","ms"],px={};function XL(v,y){const p=px[y];if(p)return p;let z=Lp(y);if(z!=="filter"&&z in v)return px[y]=z;z=CS(z);for(let F=0;F<HT.length;F++){const q=HT[F]+z;if(q in v)return px[y]=q}return y}const jT="http://www.w3.org/1999/xlink";function WT(v,y,p,z,F,q=J3(y)){z&&y.startsWith("xlink:")?p==null?v.removeAttributeNS(jT,y.slice(6,y.length)):v.setAttributeNS(jT,y,p):p==null||q&&!IS(p)?v.removeAttribute(y):v.setAttribute(y,q?"":Dp(p)?String(p):p)}function qT(v,y,p,z,F){if(y==="innerHTML"||y==="textContent"){p!=null&&(v[y]=y==="innerHTML"?C2(p):p);return}const q=v.tagName;if(y==="value"&&q!=="PROGRESS"&&!q.includes("-")){const n=q==="OPTION"?v.getAttribute("value")||"":v.value,J=p==null?v.type==="checkbox"?"on":"":String(p);(n!==J||!("_value"in v))&&(v.value=J),p==null&&v.removeAttribute(y),v._value=p;return}let V=!1;if(p===""||p==null){const n=typeof v[y];n==="boolean"?p=IS(p):p==null&&n==="string"?(p="",V=!0):n==="number"&&(p=0,V=!0)}try{v[y]=p}catch{}V&&v.removeAttribute(F||y)}function YL(v,y,p,z){v.addEventListener(y,p,z)}function KL(v,y,p,z){v.removeEventListener(y,p,z)}const $T=Symbol("_vei");function JL(v,y,p,z,F=null){const q=v[$T]||(v[$T]={}),V=q[y];if(z&&V)V.value=z;else{const[n,J]=QL(y);if(z){const re=q[y]=iI(z,F);YL(v,n,re,J)}else V&&(KL(v,n,V,J),q[y]=void 0)}}const ZT=/(?:Once|Passive|Capture)$/;function QL(v){let y;if(ZT.test(v)){y={};let z;for(;z=v.match(ZT);)v=v.slice(0,v.length-z[0].length),y[z[0].toLowerCase()]=!0}return[v[2]===":"?v.slice(3):nm(v.slice(2)),y]}let fx=0;const eI=Promise.resolve(),tI=()=>fx||(eI.then(()=>fx=0),fx=Date.now());function iI(v,y){const p=z=>{if(!z._vts)z._vts=Date.now();else if(z._vts<=p.attached)return;Oh(nI(z,p.value),y,5,[z])};return p.value=v,p.attached=tI(),p}function nI(v,y){if(gs(y)){const p=v.stopImmediatePropagation;return v.stopImmediatePropagation=()=>{p.call(v),v._stopped=!0},y.map(z=>F=>!F._stopped&&z&&z(F))}else return y}const XT=v=>v.charCodeAt(0)===111&&v.charCodeAt(1)===110&&v.charCodeAt(2)>96&&v.charCodeAt(2)<123,rI=(v,y,p,z,F,q)=>{const V=F==="svg";y==="class"?jL(v,z,V):y==="style"?ZL(v,p,z):N0(y)?O1(y)||JL(v,y,p,z,q):(y[0]==="."?(y=y.slice(1),!0):y[0]==="^"?(y=y.slice(1),!1):sI(v,y,z,V))?(qT(v,y,z),!v.tagName.includes("-")&&(y==="value"||y==="checked"||y==="selected")&&WT(v,y,z,V,q,y!=="value")):v._isVueCE&&(/[A-Z]/.test(y)||!da(z))?qT(v,Lp(y),z,q,y):(y==="true-value"?v._trueValue=z:y==="false-value"&&(v._falseValue=z),WT(v,y,z,V))};function sI(v,y,p,z){if(z)return!!(y==="innerHTML"||y==="textContent"||y in v&&XT(y)&&Cs(p));if(y==="spellcheck"||y==="draggable"||y==="translate"||y==="form"||y==="list"&&v.tagName==="INPUT"||y==="type"&&v.tagName==="TEXTAREA")return!1;if(y==="width"||y==="height"){const F=v.tagName;if(F==="IMG"||F==="VIDEO"||F==="CANVAS"||F==="SOURCE")return!1}return XT(y)&&da(p)?!1:y in v}const oI=Ya({patchProp:rI},GL);let YT;function aI(){return YT||(YT=cL(oI))}const lI=(...v)=>{const y=aI().createApp(...v),{mount:p}=y;return y.mount=z=>{const F=uI(z);if(!F)return;const q=y._component;!Cs(q)&&!q.render&&!q.template&&(q.template=F.innerHTML),F.nodeType===1&&(F.textContent="");const V=p(F,!1,cI(F));return F instanceof Element&&(F.removeAttribute("v-cloak"),F.setAttribute("data-v-app","")),V},y};function cI(v){if(v instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&v instanceof MathMLElement)return"mathml"}function uI(v){return da(v)?document.querySelector(v):v}function L2(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var b0={exports:{}},hI=b0.exports,KT;function dI(){return KT||(KT=1,function(v,y){(function(p,z){v.exports=z()})(hI,function(){var p,z,F;function q(n,J){if(!p)p=J;else if(!z)z=J;else{var re="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+z+")(sharedChunk); self.onerror = null;",ce={};p(ce),F=J(ce),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(F.workerUrl=window.URL.createObjectURL(new Blob([re],{type:"text/javascript"})))}}q(["exports"],function(n){function J(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var re,ce={},Se={};function Xe(){if(re)return Se;re=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.setMatrixArrayType=function(f){Se.ARRAY_TYPE=t=f},Se.toRadian=function(f){return f*c},Se.equals=function(f,u){return Math.abs(f-u)<=a*Math.max(1,Math.abs(f),Math.abs(u))},Se.RANDOM=Se.ARRAY_TYPE=Se.EPSILON=void 0;var a=1e-6;Se.EPSILON=a;var t=typeof Float32Array<"u"?Float32Array:Array;Se.ARRAY_TYPE=t;var r=Math.random;Se.RANDOM=r;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var f=0,u=arguments.length;u--;)f+=arguments[u]*arguments[u];return Math.sqrt(f)}),Se}var ht,Ut={};function ct(){if(ht)return Ut;function a(u){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},a(u)}ht=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.create=function(){var u=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},Ut.clone=function(u){var m=new t.ARRAY_TYPE(4);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m},Ut.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u},Ut.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u},Ut.fromValues=function(u,m,T,L){var D=new t.ARRAY_TYPE(4);return D[0]=u,D[1]=m,D[2]=T,D[3]=L,D},Ut.set=function(u,m,T,L,D){return u[0]=m,u[1]=T,u[2]=L,u[3]=D,u},Ut.transpose=function(u,m){if(u===m){var T=m[1];u[1]=m[2],u[2]=T}else u[0]=m[0],u[1]=m[2],u[2]=m[1],u[3]=m[3];return u},Ut.invert=function(u,m){var T=m[0],L=m[1],D=m[2],b=m[3],C=T*b-D*L;return C?(u[0]=b*(C=1/C),u[1]=-L*C,u[2]=-D*C,u[3]=T*C,u):null},Ut.adjoint=function(u,m){var T=m[0];return u[0]=m[3],u[1]=-m[1],u[2]=-m[2],u[3]=T,u},Ut.determinant=function(u){return u[0]*u[3]-u[2]*u[1]},Ut.multiply=c,Ut.rotate=function(u,m,T){var L=m[0],D=m[1],b=m[2],C=m[3],R=Math.sin(T),A=Math.cos(T);return u[0]=L*A+b*R,u[1]=D*A+C*R,u[2]=L*-R+b*A,u[3]=D*-R+C*A,u},Ut.scale=function(u,m,T){var L=m[1],D=m[2],b=m[3],C=T[0],R=T[1];return u[0]=m[0]*C,u[1]=L*C,u[2]=D*R,u[3]=b*R,u},Ut.fromRotation=function(u,m){var T=Math.sin(m),L=Math.cos(m);return u[0]=L,u[1]=T,u[2]=-T,u[3]=L,u},Ut.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u},Ut.str=function(u){return"mat2("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")"},Ut.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},Ut.LDU=function(u,m,T,L){return u[2]=L[2]/L[0],T[0]=L[0],T[1]=L[1],T[3]=L[3]-u[2]*T[1],[u,m,T]},Ut.add=function(u,m,T){return u[0]=m[0]+T[0],u[1]=m[1]+T[1],u[2]=m[2]+T[2],u[3]=m[3]+T[3],u},Ut.subtract=f,Ut.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]},Ut.equals=function(u,m){var T=u[0],L=u[1],D=u[2],b=u[3],C=m[0],R=m[1],A=m[2],I=m[3];return Math.abs(T-C)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(C))&&Math.abs(L-R)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(R))&&Math.abs(D-A)<=t.EPSILON*Math.max(1,Math.abs(D),Math.abs(A))&&Math.abs(b-I)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(I))},Ut.multiplyScalar=function(u,m,T){return u[0]=m[0]*T,u[1]=m[1]*T,u[2]=m[2]*T,u[3]=m[3]*T,u},Ut.multiplyScalarAndAdd=function(u,m,T,L){return u[0]=m[0]+T[0]*L,u[1]=m[1]+T[1]*L,u[2]=m[2]+T[2]*L,u[3]=m[3]+T[3]*L,u},Ut.sub=Ut.mul=void 0;var t=function(u,m){if(u&&u.__esModule)return u;if(u===null||a(u)!=="object"&&typeof u!="function")return{default:u};var T=r(void 0);if(T&&T.has(u))return T.get(u);var L={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in u)if(b!=="default"&&Object.prototype.hasOwnProperty.call(u,b)){var C=D?Object.getOwnPropertyDescriptor(u,b):null;C&&(C.get||C.set)?Object.defineProperty(L,b,C):L[b]=u[b]}return L.default=u,T&&T.set(u,L),L}(Xe());function r(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,T=new WeakMap;return(r=function(L){return L?T:m})(u)}function c(u,m,T){var L=m[0],D=m[1],b=m[2],C=m[3],R=T[0],A=T[1],I=T[2],k=T[3];return u[0]=L*R+b*A,u[1]=D*R+C*A,u[2]=L*I+b*k,u[3]=D*I+C*k,u}function f(u,m,T){return u[0]=m[0]-T[0],u[1]=m[1]-T[1],u[2]=m[2]-T[2],u[3]=m[3]-T[3],u}return Ut.mul=c,Ut.sub=f,Ut}var Dt,rt={};function pt(){if(Dt)return rt;function a(u){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},a(u)}Dt=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.create=function(){var u=new t.ARRAY_TYPE(6);return t.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[4]=0,u[5]=0),u[0]=1,u[3]=1,u},rt.clone=function(u){var m=new t.ARRAY_TYPE(6);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m},rt.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u},rt.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=0,u[5]=0,u},rt.fromValues=function(u,m,T,L,D,b){var C=new t.ARRAY_TYPE(6);return C[0]=u,C[1]=m,C[2]=T,C[3]=L,C[4]=D,C[5]=b,C},rt.set=function(u,m,T,L,D,b,C){return u[0]=m,u[1]=T,u[2]=L,u[3]=D,u[4]=b,u[5]=C,u},rt.invert=function(u,m){var T=m[0],L=m[1],D=m[2],b=m[3],C=m[4],R=m[5],A=T*b-L*D;return A?(u[0]=b*(A=1/A),u[1]=-L*A,u[2]=-D*A,u[3]=T*A,u[4]=(D*R-b*C)*A,u[5]=(L*C-T*R)*A,u):null},rt.determinant=function(u){return u[0]*u[3]-u[1]*u[2]},rt.multiply=c,rt.rotate=function(u,m,T){var L=m[0],D=m[1],b=m[2],C=m[3],R=m[4],A=m[5],I=Math.sin(T),k=Math.cos(T);return u[0]=L*k+b*I,u[1]=D*k+C*I,u[2]=L*-I+b*k,u[3]=D*-I+C*k,u[4]=R,u[5]=A,u},rt.scale=function(u,m,T){var L=m[1],D=m[2],b=m[3],C=m[4],R=m[5],A=T[0],I=T[1];return u[0]=m[0]*A,u[1]=L*A,u[2]=D*I,u[3]=b*I,u[4]=C,u[5]=R,u},rt.translate=function(u,m,T){var L=m[0],D=m[1],b=m[2],C=m[3],R=m[4],A=m[5],I=T[0],k=T[1];return u[0]=L,u[1]=D,u[2]=b,u[3]=C,u[4]=L*I+b*k+R,u[5]=D*I+C*k+A,u},rt.fromRotation=function(u,m){var T=Math.sin(m),L=Math.cos(m);return u[0]=L,u[1]=T,u[2]=-T,u[3]=L,u[4]=0,u[5]=0,u},rt.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u[4]=0,u[5]=0,u},rt.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=m[0],u[5]=m[1],u},rt.str=function(u){return"mat2d("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+")"},rt.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],1)},rt.add=function(u,m,T){return u[0]=m[0]+T[0],u[1]=m[1]+T[1],u[2]=m[2]+T[2],u[3]=m[3]+T[3],u[4]=m[4]+T[4],u[5]=m[5]+T[5],u},rt.subtract=f,rt.multiplyScalar=function(u,m,T){return u[0]=m[0]*T,u[1]=m[1]*T,u[2]=m[2]*T,u[3]=m[3]*T,u[4]=m[4]*T,u[5]=m[5]*T,u},rt.multiplyScalarAndAdd=function(u,m,T,L){return u[0]=m[0]+T[0]*L,u[1]=m[1]+T[1]*L,u[2]=m[2]+T[2]*L,u[3]=m[3]+T[3]*L,u[4]=m[4]+T[4]*L,u[5]=m[5]+T[5]*L,u},rt.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]},rt.equals=function(u,m){var T=u[0],L=u[1],D=u[2],b=u[3],C=u[4],R=u[5],A=m[0],I=m[1],k=m[2],W=m[3],$=m[4],ee=m[5];return Math.abs(T-A)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(A))&&Math.abs(L-I)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(I))&&Math.abs(D-k)<=t.EPSILON*Math.max(1,Math.abs(D),Math.abs(k))&&Math.abs(b-W)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(W))&&Math.abs(C-$)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs($))&&Math.abs(R-ee)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(ee))},rt.sub=rt.mul=void 0;var t=function(u,m){if(u&&u.__esModule)return u;if(u===null||a(u)!=="object"&&typeof u!="function")return{default:u};var T=r(void 0);if(T&&T.has(u))return T.get(u);var L={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in u)if(b!=="default"&&Object.prototype.hasOwnProperty.call(u,b)){var C=D?Object.getOwnPropertyDescriptor(u,b):null;C&&(C.get||C.set)?Object.defineProperty(L,b,C):L[b]=u[b]}return L.default=u,T&&T.set(u,L),L}(Xe());function r(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,T=new WeakMap;return(r=function(L){return L?T:m})(u)}function c(u,m,T){var L=m[0],D=m[1],b=m[2],C=m[3],R=m[4],A=m[5],I=T[0],k=T[1],W=T[2],$=T[3],ee=T[4],te=T[5];return u[0]=L*I+b*k,u[1]=D*I+C*k,u[2]=L*W+b*$,u[3]=D*W+C*$,u[4]=L*ee+b*te+R,u[5]=D*ee+C*te+A,u}function f(u,m,T){return u[0]=m[0]-T[0],u[1]=m[1]-T[1],u[2]=m[2]-T[2],u[3]=m[3]-T[3],u[4]=m[4]-T[4],u[5]=m[5]-T[5],u}return rt.mul=c,rt.sub=f,rt}var gi,Zt={};function At(){if(gi)return Zt;function a(u){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},a(u)}gi=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=function(){var u=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u},Zt.fromMat4=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[4],u[4]=m[5],u[5]=m[6],u[6]=m[8],u[7]=m[9],u[8]=m[10],u},Zt.clone=function(u){var m=new t.ARRAY_TYPE(9);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m[6]=u[6],m[7]=u[7],m[8]=u[8],m},Zt.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},Zt.fromValues=function(u,m,T,L,D,b,C,R,A){var I=new t.ARRAY_TYPE(9);return I[0]=u,I[1]=m,I[2]=T,I[3]=L,I[4]=D,I[5]=b,I[6]=C,I[7]=R,I[8]=A,I},Zt.set=function(u,m,T,L,D,b,C,R,A,I){return u[0]=m,u[1]=T,u[2]=L,u[3]=D,u[4]=b,u[5]=C,u[6]=R,u[7]=A,u[8]=I,u},Zt.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Zt.transpose=function(u,m){if(u===m){var T=m[1],L=m[2],D=m[5];u[1]=m[3],u[2]=m[6],u[3]=T,u[5]=m[7],u[6]=L,u[7]=D}else u[0]=m[0],u[1]=m[3],u[2]=m[6],u[3]=m[1],u[4]=m[4],u[5]=m[7],u[6]=m[2],u[7]=m[5],u[8]=m[8];return u},Zt.invert=function(u,m){var T=m[0],L=m[1],D=m[2],b=m[3],C=m[4],R=m[5],A=m[6],I=m[7],k=m[8],W=k*C-R*I,$=-k*b+R*A,ee=I*b-C*A,te=T*W+L*$+D*ee;return te?(u[0]=W*(te=1/te),u[1]=(-k*L+D*I)*te,u[2]=(R*L-D*C)*te,u[3]=$*te,u[4]=(k*T-D*A)*te,u[5]=(-R*T+D*b)*te,u[6]=ee*te,u[7]=(-I*T+L*A)*te,u[8]=(C*T-L*b)*te,u):null},Zt.adjoint=function(u,m){var T=m[0],L=m[1],D=m[2],b=m[3],C=m[4],R=m[5],A=m[6],I=m[7],k=m[8];return u[0]=C*k-R*I,u[1]=D*I-L*k,u[2]=L*R-D*C,u[3]=R*A-b*k,u[4]=T*k-D*A,u[5]=D*b-T*R,u[6]=b*I-C*A,u[7]=L*A-T*I,u[8]=T*C-L*b,u},Zt.determinant=function(u){var m=u[3],T=u[4],L=u[5],D=u[6],b=u[7],C=u[8];return u[0]*(C*T-L*b)+u[1]*(-C*m+L*D)+u[2]*(b*m-T*D)},Zt.multiply=c,Zt.translate=function(u,m,T){var L=m[0],D=m[1],b=m[2],C=m[3],R=m[4],A=m[5],I=m[6],k=m[7],W=m[8],$=T[0],ee=T[1];return u[0]=L,u[1]=D,u[2]=b,u[3]=C,u[4]=R,u[5]=A,u[6]=$*L+ee*C+I,u[7]=$*D+ee*R+k,u[8]=$*b+ee*A+W,u},Zt.rotate=function(u,m,T){var L=m[0],D=m[1],b=m[2],C=m[3],R=m[4],A=m[5],I=m[6],k=m[7],W=m[8],$=Math.sin(T),ee=Math.cos(T);return u[0]=ee*L+$*C,u[1]=ee*D+$*R,u[2]=ee*b+$*A,u[3]=ee*C-$*L,u[4]=ee*R-$*D,u[5]=ee*A-$*b,u[6]=I,u[7]=k,u[8]=W,u},Zt.scale=function(u,m,T){var L=T[0],D=T[1];return u[0]=L*m[0],u[1]=L*m[1],u[2]=L*m[2],u[3]=D*m[3],u[4]=D*m[4],u[5]=D*m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},Zt.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=m[0],u[7]=m[1],u[8]=1,u},Zt.fromRotation=function(u,m){var T=Math.sin(m),L=Math.cos(m);return u[0]=L,u[1]=T,u[2]=0,u[3]=-T,u[4]=L,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Zt.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=0,u[4]=m[1],u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Zt.fromMat2d=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=0,u[3]=m[2],u[4]=m[3],u[5]=0,u[6]=m[4],u[7]=m[5],u[8]=1,u},Zt.fromQuat=function(u,m){var T=m[0],L=m[1],D=m[2],b=m[3],C=T+T,R=L+L,A=D+D,I=T*C,k=L*C,W=L*R,$=D*C,ee=D*R,te=D*A,X=b*C,le=b*R,he=b*A;return u[0]=1-W-te,u[3]=k-he,u[6]=$+le,u[1]=k+he,u[4]=1-I-te,u[7]=ee-X,u[2]=$-le,u[5]=ee+X,u[8]=1-I-W,u},Zt.normalFromMat4=function(u,m){var T=m[0],L=m[1],D=m[2],b=m[3],C=m[4],R=m[5],A=m[6],I=m[7],k=m[8],W=m[9],$=m[10],ee=m[11],te=m[12],X=m[13],le=m[14],he=m[15],Me=T*R-L*C,He=T*A-D*C,ze=T*I-b*C,Be=L*A-D*R,yt=L*I-b*R,ke=D*I-b*A,dt=k*X-W*te,Et=k*le-$*te,Ct=k*he-ee*te,Bt=W*le-$*X,ei=W*he-ee*X,ni=$*he-ee*le,Yt=Me*ni-He*ei+ze*Bt+Be*Ct-yt*Et+ke*dt;return Yt?(u[0]=(R*ni-A*ei+I*Bt)*(Yt=1/Yt),u[1]=(A*Ct-C*ni-I*Et)*Yt,u[2]=(C*ei-R*Ct+I*dt)*Yt,u[3]=(D*ei-L*ni-b*Bt)*Yt,u[4]=(T*ni-D*Ct+b*Et)*Yt,u[5]=(L*Ct-T*ei-b*dt)*Yt,u[6]=(X*ke-le*yt+he*Be)*Yt,u[7]=(le*ze-te*ke-he*He)*Yt,u[8]=(te*yt-X*ze+he*Me)*Yt,u):null},Zt.projection=function(u,m,T){return u[0]=2/m,u[1]=0,u[2]=0,u[3]=0,u[4]=-2/T,u[5]=0,u[6]=-1,u[7]=1,u[8]=1,u},Zt.str=function(u){return"mat3("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+", "+u[6]+", "+u[7]+", "+u[8]+")"},Zt.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8])},Zt.add=function(u,m,T){return u[0]=m[0]+T[0],u[1]=m[1]+T[1],u[2]=m[2]+T[2],u[3]=m[3]+T[3],u[4]=m[4]+T[4],u[5]=m[5]+T[5],u[6]=m[6]+T[6],u[7]=m[7]+T[7],u[8]=m[8]+T[8],u},Zt.subtract=f,Zt.multiplyScalar=function(u,m,T){return u[0]=m[0]*T,u[1]=m[1]*T,u[2]=m[2]*T,u[3]=m[3]*T,u[4]=m[4]*T,u[5]=m[5]*T,u[6]=m[6]*T,u[7]=m[7]*T,u[8]=m[8]*T,u},Zt.multiplyScalarAndAdd=function(u,m,T,L){return u[0]=m[0]+T[0]*L,u[1]=m[1]+T[1]*L,u[2]=m[2]+T[2]*L,u[3]=m[3]+T[3]*L,u[4]=m[4]+T[4]*L,u[5]=m[5]+T[5]*L,u[6]=m[6]+T[6]*L,u[7]=m[7]+T[7]*L,u[8]=m[8]+T[8]*L,u},Zt.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]&&u[6]===m[6]&&u[7]===m[7]&&u[8]===m[8]},Zt.equals=function(u,m){var T=u[0],L=u[1],D=u[2],b=u[3],C=u[4],R=u[5],A=u[6],I=u[7],k=u[8],W=m[0],$=m[1],ee=m[2],te=m[3],X=m[4],le=m[5],he=m[6],Me=m[7],He=m[8];return Math.abs(T-W)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(W))&&Math.abs(L-$)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs($))&&Math.abs(D-ee)<=t.EPSILON*Math.max(1,Math.abs(D),Math.abs(ee))&&Math.abs(b-te)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(te))&&Math.abs(C-X)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(X))&&Math.abs(R-le)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(le))&&Math.abs(A-he)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(he))&&Math.abs(I-Me)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(Me))&&Math.abs(k-He)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(He))},Zt.sub=Zt.mul=void 0;var t=function(u,m){if(u&&u.__esModule)return u;if(u===null||a(u)!=="object"&&typeof u!="function")return{default:u};var T=r(void 0);if(T&&T.has(u))return T.get(u);var L={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in u)if(b!=="default"&&Object.prototype.hasOwnProperty.call(u,b)){var C=D?Object.getOwnPropertyDescriptor(u,b):null;C&&(C.get||C.set)?Object.defineProperty(L,b,C):L[b]=u[b]}return L.default=u,T&&T.set(u,L),L}(Xe());function r(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,T=new WeakMap;return(r=function(L){return L?T:m})(u)}function c(u,m,T){var L=m[0],D=m[1],b=m[2],C=m[3],R=m[4],A=m[5],I=m[6],k=m[7],W=m[8],$=T[0],ee=T[1],te=T[2],X=T[3],le=T[4],he=T[5],Me=T[6],He=T[7],ze=T[8];return u[0]=$*L+ee*C+te*I,u[1]=$*D+ee*R+te*k,u[2]=$*b+ee*A+te*W,u[3]=X*L+le*C+he*I,u[4]=X*D+le*R+he*k,u[5]=X*b+le*A+he*W,u[6]=Me*L+He*C+ze*I,u[7]=Me*D+He*R+ze*k,u[8]=Me*b+He*A+ze*W,u}function f(u,m,T){return u[0]=m[0]-T[0],u[1]=m[1]-T[1],u[2]=m[2]-T[2],u[3]=m[3]-T[3],u[4]=m[4]-T[4],u[5]=m[5]-T[5],u[6]=m[6]-T[6],u[7]=m[7]-T[7],u[8]=m[8]-T[8],u}return Zt.mul=c,Zt.sub=f,Zt}var It,Ye={};function ot(){if(It)return Ye;function a(b){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},a(b)}It=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.create=function(){var b=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0),b[0]=1,b[5]=1,b[10]=1,b[15]=1,b},Ye.clone=function(b){var C=new t.ARRAY_TYPE(16);return C[0]=b[0],C[1]=b[1],C[2]=b[2],C[3]=b[3],C[4]=b[4],C[5]=b[5],C[6]=b[6],C[7]=b[7],C[8]=b[8],C[9]=b[9],C[10]=b[10],C[11]=b[11],C[12]=b[12],C[13]=b[13],C[14]=b[14],C[15]=b[15],C},Ye.copy=function(b,C){return b[0]=C[0],b[1]=C[1],b[2]=C[2],b[3]=C[3],b[4]=C[4],b[5]=C[5],b[6]=C[6],b[7]=C[7],b[8]=C[8],b[9]=C[9],b[10]=C[10],b[11]=C[11],b[12]=C[12],b[13]=C[13],b[14]=C[14],b[15]=C[15],b},Ye.fromValues=function(b,C,R,A,I,k,W,$,ee,te,X,le,he,Me,He,ze){var Be=new t.ARRAY_TYPE(16);return Be[0]=b,Be[1]=C,Be[2]=R,Be[3]=A,Be[4]=I,Be[5]=k,Be[6]=W,Be[7]=$,Be[8]=ee,Be[9]=te,Be[10]=X,Be[11]=le,Be[12]=he,Be[13]=Me,Be[14]=He,Be[15]=ze,Be},Ye.set=function(b,C,R,A,I,k,W,$,ee,te,X,le,he,Me,He,ze,Be){return b[0]=C,b[1]=R,b[2]=A,b[3]=I,b[4]=k,b[5]=W,b[6]=$,b[7]=ee,b[8]=te,b[9]=X,b[10]=le,b[11]=he,b[12]=Me,b[13]=He,b[14]=ze,b[15]=Be,b},Ye.identity=c,Ye.transpose=function(b,C){if(b===C){var R=C[1],A=C[2],I=C[3],k=C[6],W=C[7],$=C[11];b[1]=C[4],b[2]=C[8],b[3]=C[12],b[4]=R,b[6]=C[9],b[7]=C[13],b[8]=A,b[9]=k,b[11]=C[14],b[12]=I,b[13]=W,b[14]=$}else b[0]=C[0],b[1]=C[4],b[2]=C[8],b[3]=C[12],b[4]=C[1],b[5]=C[5],b[6]=C[9],b[7]=C[13],b[8]=C[2],b[9]=C[6],b[10]=C[10],b[11]=C[14],b[12]=C[3],b[13]=C[7],b[14]=C[11],b[15]=C[15];return b},Ye.invert=function(b,C){var R=C[0],A=C[1],I=C[2],k=C[3],W=C[4],$=C[5],ee=C[6],te=C[7],X=C[8],le=C[9],he=C[10],Me=C[11],He=C[12],ze=C[13],Be=C[14],yt=C[15],ke=R*$-A*W,dt=R*ee-I*W,Et=R*te-k*W,Ct=A*ee-I*$,Bt=A*te-k*$,ei=I*te-k*ee,ni=X*ze-le*He,Yt=X*Be-he*He,yi=X*yt-Me*He,Fi=le*Be-he*ze,di=le*yt-Me*ze,Tn=he*yt-Me*Be,ln=ke*Tn-dt*di+Et*Fi+Ct*yi-Bt*Yt+ei*ni;return ln?(b[0]=($*Tn-ee*di+te*Fi)*(ln=1/ln),b[1]=(I*di-A*Tn-k*Fi)*ln,b[2]=(ze*ei-Be*Bt+yt*Ct)*ln,b[3]=(he*Bt-le*ei-Me*Ct)*ln,b[4]=(ee*yi-W*Tn-te*Yt)*ln,b[5]=(R*Tn-I*yi+k*Yt)*ln,b[6]=(Be*Et-He*ei-yt*dt)*ln,b[7]=(X*ei-he*Et+Me*dt)*ln,b[8]=(W*di-$*yi+te*ni)*ln,b[9]=(A*yi-R*di-k*ni)*ln,b[10]=(He*Bt-ze*Et+yt*ke)*ln,b[11]=(le*Et-X*Bt-Me*ke)*ln,b[12]=($*Yt-W*Fi-ee*ni)*ln,b[13]=(R*Fi-A*Yt+I*ni)*ln,b[14]=(ze*dt-He*Ct-Be*ke)*ln,b[15]=(X*Ct-le*dt+he*ke)*ln,b):null},Ye.adjoint=function(b,C){var R=C[0],A=C[1],I=C[2],k=C[3],W=C[4],$=C[5],ee=C[6],te=C[7],X=C[8],le=C[9],he=C[10],Me=C[11],He=C[12],ze=C[13],Be=C[14],yt=C[15];return b[0]=$*(he*yt-Me*Be)-le*(ee*yt-te*Be)+ze*(ee*Me-te*he),b[1]=-(A*(he*yt-Me*Be)-le*(I*yt-k*Be)+ze*(I*Me-k*he)),b[2]=A*(ee*yt-te*Be)-$*(I*yt-k*Be)+ze*(I*te-k*ee),b[3]=-(A*(ee*Me-te*he)-$*(I*Me-k*he)+le*(I*te-k*ee)),b[4]=-(W*(he*yt-Me*Be)-X*(ee*yt-te*Be)+He*(ee*Me-te*he)),b[5]=R*(he*yt-Me*Be)-X*(I*yt-k*Be)+He*(I*Me-k*he),b[6]=-(R*(ee*yt-te*Be)-W*(I*yt-k*Be)+He*(I*te-k*ee)),b[7]=R*(ee*Me-te*he)-W*(I*Me-k*he)+X*(I*te-k*ee),b[8]=W*(le*yt-Me*ze)-X*($*yt-te*ze)+He*($*Me-te*le),b[9]=-(R*(le*yt-Me*ze)-X*(A*yt-k*ze)+He*(A*Me-k*le)),b[10]=R*($*yt-te*ze)-W*(A*yt-k*ze)+He*(A*te-k*$),b[11]=-(R*($*Me-te*le)-W*(A*Me-k*le)+X*(A*te-k*$)),b[12]=-(W*(le*Be-he*ze)-X*($*Be-ee*ze)+He*($*he-ee*le)),b[13]=R*(le*Be-he*ze)-X*(A*Be-I*ze)+He*(A*he-I*le),b[14]=-(R*($*Be-ee*ze)-W*(A*Be-I*ze)+He*(A*ee-I*$)),b[15]=R*($*he-ee*le)-W*(A*he-I*le)+X*(A*ee-I*$),b},Ye.determinant=function(b){var C=b[0],R=b[1],A=b[2],I=b[3],k=b[4],W=b[5],$=b[6],ee=b[7],te=b[8],X=b[9],le=b[10],he=b[11],Me=b[12],He=b[13],ze=b[14],Be=b[15];return(C*W-R*k)*(le*Be-he*ze)-(C*$-A*k)*(X*Be-he*He)+(C*ee-I*k)*(X*ze-le*He)+(R*$-A*W)*(te*Be-he*Me)-(R*ee-I*W)*(te*ze-le*Me)+(A*ee-I*$)*(te*He-X*Me)},Ye.multiply=f,Ye.translate=function(b,C,R){var A,I,k,W,$,ee,te,X,le,he,Me,He,ze=R[0],Be=R[1],yt=R[2];return C===b?(b[12]=C[0]*ze+C[4]*Be+C[8]*yt+C[12],b[13]=C[1]*ze+C[5]*Be+C[9]*yt+C[13],b[14]=C[2]*ze+C[6]*Be+C[10]*yt+C[14],b[15]=C[3]*ze+C[7]*Be+C[11]*yt+C[15]):(I=C[1],k=C[2],W=C[3],$=C[4],ee=C[5],te=C[6],X=C[7],le=C[8],he=C[9],Me=C[10],He=C[11],b[0]=A=C[0],b[1]=I,b[2]=k,b[3]=W,b[4]=$,b[5]=ee,b[6]=te,b[7]=X,b[8]=le,b[9]=he,b[10]=Me,b[11]=He,b[12]=A*ze+$*Be+le*yt+C[12],b[13]=I*ze+ee*Be+he*yt+C[13],b[14]=k*ze+te*Be+Me*yt+C[14],b[15]=W*ze+X*Be+He*yt+C[15]),b},Ye.scale=function(b,C,R){var A=R[0],I=R[1],k=R[2];return b[0]=C[0]*A,b[1]=C[1]*A,b[2]=C[2]*A,b[3]=C[3]*A,b[4]=C[4]*I,b[5]=C[5]*I,b[6]=C[6]*I,b[7]=C[7]*I,b[8]=C[8]*k,b[9]=C[9]*k,b[10]=C[10]*k,b[11]=C[11]*k,b[12]=C[12],b[13]=C[13],b[14]=C[14],b[15]=C[15],b},Ye.rotate=function(b,C,R,A){var I,k,W,$,ee,te,X,le,he,Me,He,ze,Be,yt,ke,dt,Et,Ct,Bt,ei,ni,Yt,yi,Fi,di=A[0],Tn=A[1],ln=A[2],$i=Math.hypot(di,Tn,ln);return $i<t.EPSILON?null:(di*=$i=1/$i,Tn*=$i,ln*=$i,I=Math.sin(R),k=Math.cos(R),ee=C[1],te=C[2],X=C[3],he=C[5],Me=C[6],He=C[7],Be=C[9],yt=C[10],ke=C[11],dt=di*di*(W=1-k)+k,Bt=di*Tn*W-ln*I,ei=Tn*Tn*W+k,ni=ln*Tn*W+di*I,Yt=di*ln*W+Tn*I,yi=Tn*ln*W-di*I,Fi=ln*ln*W+k,b[0]=($=C[0])*dt+(le=C[4])*(Et=Tn*di*W+ln*I)+(ze=C[8])*(Ct=ln*di*W-Tn*I),b[1]=ee*dt+he*Et+Be*Ct,b[2]=te*dt+Me*Et+yt*Ct,b[3]=X*dt+He*Et+ke*Ct,b[4]=$*Bt+le*ei+ze*ni,b[5]=ee*Bt+he*ei+Be*ni,b[6]=te*Bt+Me*ei+yt*ni,b[7]=X*Bt+He*ei+ke*ni,b[8]=$*Yt+le*yi+ze*Fi,b[9]=ee*Yt+he*yi+Be*Fi,b[10]=te*Yt+Me*yi+yt*Fi,b[11]=X*Yt+He*yi+ke*Fi,C!==b&&(b[12]=C[12],b[13]=C[13],b[14]=C[14],b[15]=C[15]),b)},Ye.rotateX=function(b,C,R){var A=Math.sin(R),I=Math.cos(R),k=C[4],W=C[5],$=C[6],ee=C[7],te=C[8],X=C[9],le=C[10],he=C[11];return C!==b&&(b[0]=C[0],b[1]=C[1],b[2]=C[2],b[3]=C[3],b[12]=C[12],b[13]=C[13],b[14]=C[14],b[15]=C[15]),b[4]=k*I+te*A,b[5]=W*I+X*A,b[6]=$*I+le*A,b[7]=ee*I+he*A,b[8]=te*I-k*A,b[9]=X*I-W*A,b[10]=le*I-$*A,b[11]=he*I-ee*A,b},Ye.rotateY=function(b,C,R){var A=Math.sin(R),I=Math.cos(R),k=C[0],W=C[1],$=C[2],ee=C[3],te=C[8],X=C[9],le=C[10],he=C[11];return C!==b&&(b[4]=C[4],b[5]=C[5],b[6]=C[6],b[7]=C[7],b[12]=C[12],b[13]=C[13],b[14]=C[14],b[15]=C[15]),b[0]=k*I-te*A,b[1]=W*I-X*A,b[2]=$*I-le*A,b[3]=ee*I-he*A,b[8]=k*A+te*I,b[9]=W*A+X*I,b[10]=$*A+le*I,b[11]=ee*A+he*I,b},Ye.rotateZ=function(b,C,R){var A=Math.sin(R),I=Math.cos(R),k=C[0],W=C[1],$=C[2],ee=C[3],te=C[4],X=C[5],le=C[6],he=C[7];return C!==b&&(b[8]=C[8],b[9]=C[9],b[10]=C[10],b[11]=C[11],b[12]=C[12],b[13]=C[13],b[14]=C[14],b[15]=C[15]),b[0]=k*I+te*A,b[1]=W*I+X*A,b[2]=$*I+le*A,b[3]=ee*I+he*A,b[4]=te*I-k*A,b[5]=X*I-W*A,b[6]=le*I-$*A,b[7]=he*I-ee*A,b},Ye.fromTranslation=function(b,C){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=C[0],b[13]=C[1],b[14]=C[2],b[15]=1,b},Ye.fromScaling=function(b,C){return b[0]=C[0],b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=C[1],b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=C[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Ye.fromRotation=function(b,C,R){var A,I,k,W=R[0],$=R[1],ee=R[2],te=Math.hypot(W,$,ee);return te<t.EPSILON?null:(W*=te=1/te,$*=te,ee*=te,A=Math.sin(C),I=Math.cos(C),b[0]=W*W*(k=1-I)+I,b[1]=$*W*k+ee*A,b[2]=ee*W*k-$*A,b[3]=0,b[4]=W*$*k-ee*A,b[5]=$*$*k+I,b[6]=ee*$*k+W*A,b[7]=0,b[8]=W*ee*k+$*A,b[9]=$*ee*k-W*A,b[10]=ee*ee*k+I,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b)},Ye.fromXRotation=function(b,C){var R=Math.sin(C),A=Math.cos(C);return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=A,b[6]=R,b[7]=0,b[8]=0,b[9]=-R,b[10]=A,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Ye.fromYRotation=function(b,C){var R=Math.sin(C),A=Math.cos(C);return b[0]=A,b[1]=0,b[2]=-R,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=R,b[9]=0,b[10]=A,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Ye.fromZRotation=function(b,C){var R=Math.sin(C),A=Math.cos(C);return b[0]=A,b[1]=R,b[2]=0,b[3]=0,b[4]=-R,b[5]=A,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Ye.fromRotationTranslation=u,Ye.fromQuat2=function(b,C){var R=new t.ARRAY_TYPE(3),A=-C[0],I=-C[1],k=-C[2],W=C[3],$=C[4],ee=C[5],te=C[6],X=C[7],le=A*A+I*I+k*k+W*W;return le>0?(R[0]=2*($*W+X*A+ee*k-te*I)/le,R[1]=2*(ee*W+X*I+te*A-$*k)/le,R[2]=2*(te*W+X*k+$*I-ee*A)/le):(R[0]=2*($*W+X*A+ee*k-te*I),R[1]=2*(ee*W+X*I+te*A-$*k),R[2]=2*(te*W+X*k+$*I-ee*A)),u(b,C,R),b},Ye.getTranslation=function(b,C){return b[0]=C[12],b[1]=C[13],b[2]=C[14],b},Ye.getScaling=m,Ye.getRotation=function(b,C){var R=new t.ARRAY_TYPE(3);m(R,C);var A=1/R[0],I=1/R[1],k=1/R[2],W=C[0]*A,$=C[1]*I,ee=C[2]*k,te=C[4]*A,X=C[5]*I,le=C[6]*k,he=C[8]*A,Me=C[9]*I,He=C[10]*k,ze=W+X+He,Be=0;return ze>0?(Be=2*Math.sqrt(ze+1),b[3]=.25*Be,b[0]=(le-Me)/Be,b[1]=(he-ee)/Be,b[2]=($-te)/Be):W>X&&W>He?(Be=2*Math.sqrt(1+W-X-He),b[3]=(le-Me)/Be,b[0]=.25*Be,b[1]=($+te)/Be,b[2]=(he+ee)/Be):X>He?(Be=2*Math.sqrt(1+X-W-He),b[3]=(he-ee)/Be,b[0]=($+te)/Be,b[1]=.25*Be,b[2]=(le+Me)/Be):(Be=2*Math.sqrt(1+He-W-X),b[3]=($-te)/Be,b[0]=(he+ee)/Be,b[1]=(le+Me)/Be,b[2]=.25*Be),b},Ye.fromRotationTranslationScale=function(b,C,R,A){var I=C[0],k=C[1],W=C[2],$=C[3],ee=I+I,te=k+k,X=W+W,le=I*ee,he=I*te,Me=I*X,He=k*te,ze=k*X,Be=W*X,yt=$*ee,ke=$*te,dt=$*X,Et=A[0],Ct=A[1],Bt=A[2];return b[0]=(1-(He+Be))*Et,b[1]=(he+dt)*Et,b[2]=(Me-ke)*Et,b[3]=0,b[4]=(he-dt)*Ct,b[5]=(1-(le+Be))*Ct,b[6]=(ze+yt)*Ct,b[7]=0,b[8]=(Me+ke)*Bt,b[9]=(ze-yt)*Bt,b[10]=(1-(le+He))*Bt,b[11]=0,b[12]=R[0],b[13]=R[1],b[14]=R[2],b[15]=1,b},Ye.fromRotationTranslationScaleOrigin=function(b,C,R,A,I){var k=C[0],W=C[1],$=C[2],ee=C[3],te=k+k,X=W+W,le=$+$,he=k*te,Me=k*X,He=k*le,ze=W*X,Be=W*le,yt=$*le,ke=ee*te,dt=ee*X,Et=ee*le,Ct=A[0],Bt=A[1],ei=A[2],ni=I[0],Yt=I[1],yi=I[2],Fi=(1-(ze+yt))*Ct,di=(Me+Et)*Ct,Tn=(He-dt)*Ct,ln=(Me-Et)*Bt,$i=(1-(he+yt))*Bt,Di=(Be+ke)*Bt,Kn=(He+dt)*ei,bn=(Be-ke)*ei,Cn=(1-(he+ze))*ei;return b[0]=Fi,b[1]=di,b[2]=Tn,b[3]=0,b[4]=ln,b[5]=$i,b[6]=Di,b[7]=0,b[8]=Kn,b[9]=bn,b[10]=Cn,b[11]=0,b[12]=R[0]+ni-(Fi*ni+ln*Yt+Kn*yi),b[13]=R[1]+Yt-(di*ni+$i*Yt+bn*yi),b[14]=R[2]+yi-(Tn*ni+Di*Yt+Cn*yi),b[15]=1,b},Ye.fromQuat=function(b,C){var R=C[0],A=C[1],I=C[2],k=C[3],W=R+R,$=A+A,ee=I+I,te=R*W,X=A*W,le=A*$,he=I*W,Me=I*$,He=I*ee,ze=k*W,Be=k*$,yt=k*ee;return b[0]=1-le-He,b[1]=X+yt,b[2]=he-Be,b[3]=0,b[4]=X-yt,b[5]=1-te-He,b[6]=Me+ze,b[7]=0,b[8]=he+Be,b[9]=Me-ze,b[10]=1-te-le,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Ye.frustum=function(b,C,R,A,I,k,W){var $=1/(R-C),ee=1/(I-A),te=1/(k-W);return b[0]=2*k*$,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=2*k*ee,b[6]=0,b[7]=0,b[8]=(R+C)*$,b[9]=(I+A)*ee,b[10]=(W+k)*te,b[11]=-1,b[12]=0,b[13]=0,b[14]=W*k*2*te,b[15]=0,b},Ye.perspectiveNO=T,Ye.perspectiveZO=function(b,C,R,A,I){var k,W=1/Math.tan(C/2);return b[0]=W/R,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=W,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,I!=null&&I!==1/0?(b[10]=I*(k=1/(A-I)),b[14]=I*A*k):(b[10]=-1,b[14]=-A),b},Ye.perspectiveFromFieldOfView=function(b,C,R,A){var I=Math.tan(C.upDegrees*Math.PI/180),k=Math.tan(C.downDegrees*Math.PI/180),W=Math.tan(C.leftDegrees*Math.PI/180),$=Math.tan(C.rightDegrees*Math.PI/180),ee=2/(W+$),te=2/(I+k);return b[0]=ee,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=te,b[6]=0,b[7]=0,b[8]=-(W-$)*ee*.5,b[9]=(I-k)*te*.5,b[10]=A/(R-A),b[11]=-1,b[12]=0,b[13]=0,b[14]=A*R/(R-A),b[15]=0,b},Ye.orthoNO=L,Ye.orthoZO=function(b,C,R,A,I,k,W){var $=1/(C-R),ee=1/(A-I),te=1/(k-W);return b[0]=-2*$,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*ee,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=te,b[11]=0,b[12]=(C+R)*$,b[13]=(I+A)*ee,b[14]=k*te,b[15]=1,b},Ye.lookAt=function(b,C,R,A){var I,k,W,$,ee,te,X,le,he,Me,He=C[0],ze=C[1],Be=C[2],yt=A[0],ke=A[1],dt=A[2],Et=R[0],Ct=R[1],Bt=R[2];return Math.abs(He-Et)<t.EPSILON&&Math.abs(ze-Ct)<t.EPSILON&&Math.abs(Be-Bt)<t.EPSILON?c(b):(X=He-Et,le=ze-Ct,he=Be-Bt,I=ke*(he*=Me=1/Math.hypot(X,le,he))-dt*(le*=Me),k=dt*(X*=Me)-yt*he,W=yt*le-ke*X,(Me=Math.hypot(I,k,W))?(I*=Me=1/Me,k*=Me,W*=Me):(I=0,k=0,W=0),$=le*W-he*k,ee=he*I-X*W,te=X*k-le*I,(Me=Math.hypot($,ee,te))?($*=Me=1/Me,ee*=Me,te*=Me):($=0,ee=0,te=0),b[0]=I,b[1]=$,b[2]=X,b[3]=0,b[4]=k,b[5]=ee,b[6]=le,b[7]=0,b[8]=W,b[9]=te,b[10]=he,b[11]=0,b[12]=-(I*He+k*ze+W*Be),b[13]=-($*He+ee*ze+te*Be),b[14]=-(X*He+le*ze+he*Be),b[15]=1,b)},Ye.targetTo=function(b,C,R,A){var I=C[0],k=C[1],W=C[2],$=A[0],ee=A[1],te=A[2],X=I-R[0],le=k-R[1],he=W-R[2],Me=X*X+le*le+he*he;Me>0&&(X*=Me=1/Math.sqrt(Me),le*=Me,he*=Me);var He=ee*he-te*le,ze=te*X-$*he,Be=$*le-ee*X;return(Me=He*He+ze*ze+Be*Be)>0&&(He*=Me=1/Math.sqrt(Me),ze*=Me,Be*=Me),b[0]=He,b[1]=ze,b[2]=Be,b[3]=0,b[4]=le*Be-he*ze,b[5]=he*He-X*Be,b[6]=X*ze-le*He,b[7]=0,b[8]=X,b[9]=le,b[10]=he,b[11]=0,b[12]=I,b[13]=k,b[14]=W,b[15]=1,b},Ye.str=function(b){return"mat4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+")"},Ye.frob=function(b){return Math.hypot(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15])},Ye.add=function(b,C,R){return b[0]=C[0]+R[0],b[1]=C[1]+R[1],b[2]=C[2]+R[2],b[3]=C[3]+R[3],b[4]=C[4]+R[4],b[5]=C[5]+R[5],b[6]=C[6]+R[6],b[7]=C[7]+R[7],b[8]=C[8]+R[8],b[9]=C[9]+R[9],b[10]=C[10]+R[10],b[11]=C[11]+R[11],b[12]=C[12]+R[12],b[13]=C[13]+R[13],b[14]=C[14]+R[14],b[15]=C[15]+R[15],b},Ye.subtract=D,Ye.multiplyScalar=function(b,C,R){return b[0]=C[0]*R,b[1]=C[1]*R,b[2]=C[2]*R,b[3]=C[3]*R,b[4]=C[4]*R,b[5]=C[5]*R,b[6]=C[6]*R,b[7]=C[7]*R,b[8]=C[8]*R,b[9]=C[9]*R,b[10]=C[10]*R,b[11]=C[11]*R,b[12]=C[12]*R,b[13]=C[13]*R,b[14]=C[14]*R,b[15]=C[15]*R,b},Ye.multiplyScalarAndAdd=function(b,C,R,A){return b[0]=C[0]+R[0]*A,b[1]=C[1]+R[1]*A,b[2]=C[2]+R[2]*A,b[3]=C[3]+R[3]*A,b[4]=C[4]+R[4]*A,b[5]=C[5]+R[5]*A,b[6]=C[6]+R[6]*A,b[7]=C[7]+R[7]*A,b[8]=C[8]+R[8]*A,b[9]=C[9]+R[9]*A,b[10]=C[10]+R[10]*A,b[11]=C[11]+R[11]*A,b[12]=C[12]+R[12]*A,b[13]=C[13]+R[13]*A,b[14]=C[14]+R[14]*A,b[15]=C[15]+R[15]*A,b},Ye.exactEquals=function(b,C){return b[0]===C[0]&&b[1]===C[1]&&b[2]===C[2]&&b[3]===C[3]&&b[4]===C[4]&&b[5]===C[5]&&b[6]===C[6]&&b[7]===C[7]&&b[8]===C[8]&&b[9]===C[9]&&b[10]===C[10]&&b[11]===C[11]&&b[12]===C[12]&&b[13]===C[13]&&b[14]===C[14]&&b[15]===C[15]},Ye.equals=function(b,C){var R=b[0],A=b[1],I=b[2],k=b[3],W=b[4],$=b[5],ee=b[6],te=b[7],X=b[8],le=b[9],he=b[10],Me=b[11],He=b[12],ze=b[13],Be=b[14],yt=b[15],ke=C[0],dt=C[1],Et=C[2],Ct=C[3],Bt=C[4],ei=C[5],ni=C[6],Yt=C[7],yi=C[8],Fi=C[9],di=C[10],Tn=C[11],ln=C[12],$i=C[13],Di=C[14],Kn=C[15];return Math.abs(R-ke)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(ke))&&Math.abs(A-dt)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(dt))&&Math.abs(I-Et)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(Et))&&Math.abs(k-Ct)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ct))&&Math.abs(W-Bt)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(Bt))&&Math.abs($-ei)<=t.EPSILON*Math.max(1,Math.abs($),Math.abs(ei))&&Math.abs(ee-ni)<=t.EPSILON*Math.max(1,Math.abs(ee),Math.abs(ni))&&Math.abs(te-Yt)<=t.EPSILON*Math.max(1,Math.abs(te),Math.abs(Yt))&&Math.abs(X-yi)<=t.EPSILON*Math.max(1,Math.abs(X),Math.abs(yi))&&Math.abs(le-Fi)<=t.EPSILON*Math.max(1,Math.abs(le),Math.abs(Fi))&&Math.abs(he-di)<=t.EPSILON*Math.max(1,Math.abs(he),Math.abs(di))&&Math.abs(Me-Tn)<=t.EPSILON*Math.max(1,Math.abs(Me),Math.abs(Tn))&&Math.abs(He-ln)<=t.EPSILON*Math.max(1,Math.abs(He),Math.abs(ln))&&Math.abs(ze-$i)<=t.EPSILON*Math.max(1,Math.abs(ze),Math.abs($i))&&Math.abs(Be-Di)<=t.EPSILON*Math.max(1,Math.abs(Be),Math.abs(Di))&&Math.abs(yt-Kn)<=t.EPSILON*Math.max(1,Math.abs(yt),Math.abs(Kn))},Ye.sub=Ye.mul=Ye.ortho=Ye.perspective=void 0;var t=function(b,C){if(b&&b.__esModule)return b;if(b===null||a(b)!=="object"&&typeof b!="function")return{default:b};var R=r(void 0);if(R&&R.has(b))return R.get(b);var A={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in b)if(k!=="default"&&Object.prototype.hasOwnProperty.call(b,k)){var W=I?Object.getOwnPropertyDescriptor(b,k):null;W&&(W.get||W.set)?Object.defineProperty(A,k,W):A[k]=b[k]}return A.default=b,R&&R.set(b,A),A}(Xe());function r(b){if(typeof WeakMap!="function")return null;var C=new WeakMap,R=new WeakMap;return(r=function(A){return A?R:C})(b)}function c(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function f(b,C,R){var A=C[0],I=C[1],k=C[2],W=C[3],$=C[4],ee=C[5],te=C[6],X=C[7],le=C[8],he=C[9],Me=C[10],He=C[11],ze=C[12],Be=C[13],yt=C[14],ke=C[15],dt=R[0],Et=R[1],Ct=R[2],Bt=R[3];return b[0]=dt*A+Et*$+Ct*le+Bt*ze,b[1]=dt*I+Et*ee+Ct*he+Bt*Be,b[2]=dt*k+Et*te+Ct*Me+Bt*yt,b[3]=dt*W+Et*X+Ct*He+Bt*ke,b[4]=(dt=R[4])*A+(Et=R[5])*$+(Ct=R[6])*le+(Bt=R[7])*ze,b[5]=dt*I+Et*ee+Ct*he+Bt*Be,b[6]=dt*k+Et*te+Ct*Me+Bt*yt,b[7]=dt*W+Et*X+Ct*He+Bt*ke,b[8]=(dt=R[8])*A+(Et=R[9])*$+(Ct=R[10])*le+(Bt=R[11])*ze,b[9]=dt*I+Et*ee+Ct*he+Bt*Be,b[10]=dt*k+Et*te+Ct*Me+Bt*yt,b[11]=dt*W+Et*X+Ct*He+Bt*ke,b[12]=(dt=R[12])*A+(Et=R[13])*$+(Ct=R[14])*le+(Bt=R[15])*ze,b[13]=dt*I+Et*ee+Ct*he+Bt*Be,b[14]=dt*k+Et*te+Ct*Me+Bt*yt,b[15]=dt*W+Et*X+Ct*He+Bt*ke,b}function u(b,C,R){var A=C[0],I=C[1],k=C[2],W=C[3],$=A+A,ee=I+I,te=k+k,X=A*$,le=A*ee,he=A*te,Me=I*ee,He=I*te,ze=k*te,Be=W*$,yt=W*ee,ke=W*te;return b[0]=1-(Me+ze),b[1]=le+ke,b[2]=he-yt,b[3]=0,b[4]=le-ke,b[5]=1-(X+ze),b[6]=He+Be,b[7]=0,b[8]=he+yt,b[9]=He-Be,b[10]=1-(X+Me),b[11]=0,b[12]=R[0],b[13]=R[1],b[14]=R[2],b[15]=1,b}function m(b,C){var R=C[4],A=C[5],I=C[6],k=C[8],W=C[9],$=C[10];return b[0]=Math.hypot(C[0],C[1],C[2]),b[1]=Math.hypot(R,A,I),b[2]=Math.hypot(k,W,$),b}function T(b,C,R,A,I){var k,W=1/Math.tan(C/2);return b[0]=W/R,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=W,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,I!=null&&I!==1/0?(b[10]=(I+A)*(k=1/(A-I)),b[14]=2*I*A*k):(b[10]=-1,b[14]=-2*A),b}function L(b,C,R,A,I,k,W){var $=1/(C-R),ee=1/(A-I),te=1/(k-W);return b[0]=-2*$,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*ee,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=2*te,b[11]=0,b[12]=(C+R)*$,b[13]=(I+A)*ee,b[14]=(W+k)*te,b[15]=1,b}function D(b,C,R){return b[0]=C[0]-R[0],b[1]=C[1]-R[1],b[2]=C[2]-R[2],b[3]=C[3]-R[3],b[4]=C[4]-R[4],b[5]=C[5]-R[5],b[6]=C[6]-R[6],b[7]=C[7]-R[7],b[8]=C[8]-R[8],b[9]=C[9]-R[9],b[10]=C[10]-R[10],b[11]=C[11]-R[11],b[12]=C[12]-R[12],b[13]=C[13]-R[13],b[14]=C[14]-R[14],b[15]=C[15]-R[15],b}return Ye.perspective=T,Ye.ortho=L,Ye.mul=f,Ye.sub=D,Ye}var tt,et={},Rt={};function at(){if(tt)return Rt;function a(I){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},a(I)}tt=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=c,Rt.clone=function(I){var k=new t.ARRAY_TYPE(3);return k[0]=I[0],k[1]=I[1],k[2]=I[2],k},Rt.length=f,Rt.fromValues=function(I,k,W){var $=new t.ARRAY_TYPE(3);return $[0]=I,$[1]=k,$[2]=W,$},Rt.copy=function(I,k){return I[0]=k[0],I[1]=k[1],I[2]=k[2],I},Rt.set=function(I,k,W,$){return I[0]=k,I[1]=W,I[2]=$,I},Rt.add=function(I,k,W){return I[0]=k[0]+W[0],I[1]=k[1]+W[1],I[2]=k[2]+W[2],I},Rt.subtract=u,Rt.multiply=m,Rt.divide=T,Rt.ceil=function(I,k){return I[0]=Math.ceil(k[0]),I[1]=Math.ceil(k[1]),I[2]=Math.ceil(k[2]),I},Rt.floor=function(I,k){return I[0]=Math.floor(k[0]),I[1]=Math.floor(k[1]),I[2]=Math.floor(k[2]),I},Rt.min=function(I,k,W){return I[0]=Math.min(k[0],W[0]),I[1]=Math.min(k[1],W[1]),I[2]=Math.min(k[2],W[2]),I},Rt.max=function(I,k,W){return I[0]=Math.max(k[0],W[0]),I[1]=Math.max(k[1],W[1]),I[2]=Math.max(k[2],W[2]),I},Rt.round=function(I,k){return I[0]=Math.round(k[0]),I[1]=Math.round(k[1]),I[2]=Math.round(k[2]),I},Rt.scale=function(I,k,W){return I[0]=k[0]*W,I[1]=k[1]*W,I[2]=k[2]*W,I},Rt.scaleAndAdd=function(I,k,W,$){return I[0]=k[0]+W[0]*$,I[1]=k[1]+W[1]*$,I[2]=k[2]+W[2]*$,I},Rt.distance=L,Rt.squaredDistance=D,Rt.squaredLength=b,Rt.negate=function(I,k){return I[0]=-k[0],I[1]=-k[1],I[2]=-k[2],I},Rt.inverse=function(I,k){return I[0]=1/k[0],I[1]=1/k[1],I[2]=1/k[2],I},Rt.normalize=function(I,k){var W=k[0],$=k[1],ee=k[2],te=W*W+$*$+ee*ee;return te>0&&(te=1/Math.sqrt(te)),I[0]=k[0]*te,I[1]=k[1]*te,I[2]=k[2]*te,I},Rt.dot=C,Rt.cross=function(I,k,W){var $=k[0],ee=k[1],te=k[2],X=W[0],le=W[1],he=W[2];return I[0]=ee*he-te*le,I[1]=te*X-$*he,I[2]=$*le-ee*X,I},Rt.lerp=function(I,k,W,$){var ee=k[0],te=k[1],X=k[2];return I[0]=ee+$*(W[0]-ee),I[1]=te+$*(W[1]-te),I[2]=X+$*(W[2]-X),I},Rt.hermite=function(I,k,W,$,ee,te){var X=te*te,le=X*(2*te-3)+1,he=X*(te-2)+te,Me=X*(te-1),He=X*(3-2*te);return I[0]=k[0]*le+W[0]*he+$[0]*Me+ee[0]*He,I[1]=k[1]*le+W[1]*he+$[1]*Me+ee[1]*He,I[2]=k[2]*le+W[2]*he+$[2]*Me+ee[2]*He,I},Rt.bezier=function(I,k,W,$,ee,te){var X=1-te,le=X*X,he=te*te,Me=le*X,He=3*te*le,ze=3*he*X,Be=he*te;return I[0]=k[0]*Me+W[0]*He+$[0]*ze+ee[0]*Be,I[1]=k[1]*Me+W[1]*He+$[1]*ze+ee[1]*Be,I[2]=k[2]*Me+W[2]*He+$[2]*ze+ee[2]*Be,I},Rt.random=function(I,k){k=k||1;var W=2*t.RANDOM()*Math.PI,$=2*t.RANDOM()-1,ee=Math.sqrt(1-$*$)*k;return I[0]=Math.cos(W)*ee,I[1]=Math.sin(W)*ee,I[2]=$*k,I},Rt.transformMat4=function(I,k,W){var $=k[0],ee=k[1],te=k[2],X=W[3]*$+W[7]*ee+W[11]*te+W[15];return I[0]=(W[0]*$+W[4]*ee+W[8]*te+W[12])/(X=X||1),I[1]=(W[1]*$+W[5]*ee+W[9]*te+W[13])/X,I[2]=(W[2]*$+W[6]*ee+W[10]*te+W[14])/X,I},Rt.transformMat3=function(I,k,W){var $=k[0],ee=k[1],te=k[2];return I[0]=$*W[0]+ee*W[3]+te*W[6],I[1]=$*W[1]+ee*W[4]+te*W[7],I[2]=$*W[2]+ee*W[5]+te*W[8],I},Rt.transformQuat=function(I,k,W){var $=W[0],ee=W[1],te=W[2],X=k[0],le=k[1],he=k[2],Me=ee*he-te*le,He=te*X-$*he,ze=$*le-ee*X,Be=ee*ze-te*He,yt=te*Me-$*ze,ke=$*He-ee*Me,dt=2*W[3];return He*=dt,ze*=dt,yt*=2,ke*=2,I[0]=X+(Me*=dt)+(Be*=2),I[1]=le+He+yt,I[2]=he+ze+ke,I},Rt.rotateX=function(I,k,W,$){var ee=[],te=[];return ee[0]=k[0]-W[0],ee[1]=k[1]-W[1],ee[2]=k[2]-W[2],te[0]=ee[0],te[1]=ee[1]*Math.cos($)-ee[2]*Math.sin($),te[2]=ee[1]*Math.sin($)+ee[2]*Math.cos($),I[0]=te[0]+W[0],I[1]=te[1]+W[1],I[2]=te[2]+W[2],I},Rt.rotateY=function(I,k,W,$){var ee=[],te=[];return ee[0]=k[0]-W[0],ee[1]=k[1]-W[1],ee[2]=k[2]-W[2],te[0]=ee[2]*Math.sin($)+ee[0]*Math.cos($),te[1]=ee[1],te[2]=ee[2]*Math.cos($)-ee[0]*Math.sin($),I[0]=te[0]+W[0],I[1]=te[1]+W[1],I[2]=te[2]+W[2],I},Rt.rotateZ=function(I,k,W,$){var ee=[],te=[];return ee[0]=k[0]-W[0],ee[1]=k[1]-W[1],ee[2]=k[2]-W[2],te[0]=ee[0]*Math.cos($)-ee[1]*Math.sin($),te[1]=ee[0]*Math.sin($)+ee[1]*Math.cos($),te[2]=ee[2],I[0]=te[0]+W[0],I[1]=te[1]+W[1],I[2]=te[2]+W[2],I},Rt.angle=function(I,k){var W=I[0],$=I[1],ee=I[2],te=k[0],X=k[1],le=k[2],he=Math.sqrt(W*W+$*$+ee*ee)*Math.sqrt(te*te+X*X+le*le),Me=he&&C(I,k)/he;return Math.acos(Math.min(Math.max(Me,-1),1))},Rt.zero=function(I){return I[0]=0,I[1]=0,I[2]=0,I},Rt.str=function(I){return"vec3("+I[0]+", "+I[1]+", "+I[2]+")"},Rt.exactEquals=function(I,k){return I[0]===k[0]&&I[1]===k[1]&&I[2]===k[2]},Rt.equals=function(I,k){var W=I[0],$=I[1],ee=I[2],te=k[0],X=k[1],le=k[2];return Math.abs(W-te)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(te))&&Math.abs($-X)<=t.EPSILON*Math.max(1,Math.abs($),Math.abs(X))&&Math.abs(ee-le)<=t.EPSILON*Math.max(1,Math.abs(ee),Math.abs(le))},Rt.forEach=Rt.sqrLen=Rt.len=Rt.sqrDist=Rt.dist=Rt.div=Rt.mul=Rt.sub=void 0;var t=function(I,k){if(I&&I.__esModule)return I;if(I===null||a(I)!=="object"&&typeof I!="function")return{default:I};var W=r(void 0);if(W&&W.has(I))return W.get(I);var $={},ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var te in I)if(te!=="default"&&Object.prototype.hasOwnProperty.call(I,te)){var X=ee?Object.getOwnPropertyDescriptor(I,te):null;X&&(X.get||X.set)?Object.defineProperty($,te,X):$[te]=I[te]}return $.default=I,W&&W.set(I,$),$}(Xe());function r(I){if(typeof WeakMap!="function")return null;var k=new WeakMap,W=new WeakMap;return(r=function($){return $?W:k})(I)}function c(){var I=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0),I}function f(I){return Math.hypot(I[0],I[1],I[2])}function u(I,k,W){return I[0]=k[0]-W[0],I[1]=k[1]-W[1],I[2]=k[2]-W[2],I}function m(I,k,W){return I[0]=k[0]*W[0],I[1]=k[1]*W[1],I[2]=k[2]*W[2],I}function T(I,k,W){return I[0]=k[0]/W[0],I[1]=k[1]/W[1],I[2]=k[2]/W[2],I}function L(I,k){return Math.hypot(k[0]-I[0],k[1]-I[1],k[2]-I[2])}function D(I,k){var W=k[0]-I[0],$=k[1]-I[1],ee=k[2]-I[2];return W*W+$*$+ee*ee}function b(I){var k=I[0],W=I[1],$=I[2];return k*k+W*W+$*$}function C(I,k){return I[0]*k[0]+I[1]*k[1]+I[2]*k[2]}Rt.sub=u,Rt.mul=m,Rt.div=T,Rt.dist=L,Rt.sqrDist=D,Rt.len=f,Rt.sqrLen=b;var R,A=(R=c(),function(I,k,W,$,ee,te){var X,le;for(k||(k=3),W||(W=0),le=$?Math.min($*k+W,I.length):I.length,X=W;X<le;X+=k)R[0]=I[X],R[1]=I[X+1],R[2]=I[X+2],ee(R,R,te),I[X]=R[0],I[X+1]=R[1],I[X+2]=R[2];return I});return Rt.forEach=A,Rt}var _t,Qt,ae={};function be(){if(_t)return ae;function a(A){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},a(A)}_t=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.create=c,ae.clone=function(A){var I=new t.ARRAY_TYPE(4);return I[0]=A[0],I[1]=A[1],I[2]=A[2],I[3]=A[3],I},ae.fromValues=function(A,I,k,W){var $=new t.ARRAY_TYPE(4);return $[0]=A,$[1]=I,$[2]=k,$[3]=W,$},ae.copy=function(A,I){return A[0]=I[0],A[1]=I[1],A[2]=I[2],A[3]=I[3],A},ae.set=function(A,I,k,W,$){return A[0]=I,A[1]=k,A[2]=W,A[3]=$,A},ae.add=function(A,I,k){return A[0]=I[0]+k[0],A[1]=I[1]+k[1],A[2]=I[2]+k[2],A[3]=I[3]+k[3],A},ae.subtract=f,ae.multiply=u,ae.divide=m,ae.ceil=function(A,I){return A[0]=Math.ceil(I[0]),A[1]=Math.ceil(I[1]),A[2]=Math.ceil(I[2]),A[3]=Math.ceil(I[3]),A},ae.floor=function(A,I){return A[0]=Math.floor(I[0]),A[1]=Math.floor(I[1]),A[2]=Math.floor(I[2]),A[3]=Math.floor(I[3]),A},ae.min=function(A,I,k){return A[0]=Math.min(I[0],k[0]),A[1]=Math.min(I[1],k[1]),A[2]=Math.min(I[2],k[2]),A[3]=Math.min(I[3],k[3]),A},ae.max=function(A,I,k){return A[0]=Math.max(I[0],k[0]),A[1]=Math.max(I[1],k[1]),A[2]=Math.max(I[2],k[2]),A[3]=Math.max(I[3],k[3]),A},ae.round=function(A,I){return A[0]=Math.round(I[0]),A[1]=Math.round(I[1]),A[2]=Math.round(I[2]),A[3]=Math.round(I[3]),A},ae.scale=function(A,I,k){return A[0]=I[0]*k,A[1]=I[1]*k,A[2]=I[2]*k,A[3]=I[3]*k,A},ae.scaleAndAdd=function(A,I,k,W){return A[0]=I[0]+k[0]*W,A[1]=I[1]+k[1]*W,A[2]=I[2]+k[2]*W,A[3]=I[3]+k[3]*W,A},ae.distance=T,ae.squaredDistance=L,ae.length=D,ae.squaredLength=b,ae.negate=function(A,I){return A[0]=-I[0],A[1]=-I[1],A[2]=-I[2],A[3]=-I[3],A},ae.inverse=function(A,I){return A[0]=1/I[0],A[1]=1/I[1],A[2]=1/I[2],A[3]=1/I[3],A},ae.normalize=function(A,I){var k=I[0],W=I[1],$=I[2],ee=I[3],te=k*k+W*W+$*$+ee*ee;return te>0&&(te=1/Math.sqrt(te)),A[0]=k*te,A[1]=W*te,A[2]=$*te,A[3]=ee*te,A},ae.dot=function(A,I){return A[0]*I[0]+A[1]*I[1]+A[2]*I[2]+A[3]*I[3]},ae.cross=function(A,I,k,W){var $=k[0]*W[1]-k[1]*W[0],ee=k[0]*W[2]-k[2]*W[0],te=k[0]*W[3]-k[3]*W[0],X=k[1]*W[2]-k[2]*W[1],le=k[1]*W[3]-k[3]*W[1],he=k[2]*W[3]-k[3]*W[2],Me=I[0],He=I[1],ze=I[2],Be=I[3];return A[0]=He*he-ze*le+Be*X,A[1]=-Me*he+ze*te-Be*ee,A[2]=Me*le-He*te+Be*$,A[3]=-Me*X+He*ee-ze*$,A},ae.lerp=function(A,I,k,W){var $=I[0],ee=I[1],te=I[2],X=I[3];return A[0]=$+W*(k[0]-$),A[1]=ee+W*(k[1]-ee),A[2]=te+W*(k[2]-te),A[3]=X+W*(k[3]-X),A},ae.random=function(A,I){var k,W,$,ee,te,X;I=I||1;do te=(k=2*t.RANDOM()-1)*k+(W=2*t.RANDOM()-1)*W;while(te>=1);do X=($=2*t.RANDOM()-1)*$+(ee=2*t.RANDOM()-1)*ee;while(X>=1);var le=Math.sqrt((1-te)/X);return A[0]=I*k,A[1]=I*W,A[2]=I*$*le,A[3]=I*ee*le,A},ae.transformMat4=function(A,I,k){var W=I[0],$=I[1],ee=I[2],te=I[3];return A[0]=k[0]*W+k[4]*$+k[8]*ee+k[12]*te,A[1]=k[1]*W+k[5]*$+k[9]*ee+k[13]*te,A[2]=k[2]*W+k[6]*$+k[10]*ee+k[14]*te,A[3]=k[3]*W+k[7]*$+k[11]*ee+k[15]*te,A},ae.transformQuat=function(A,I,k){var W=I[0],$=I[1],ee=I[2],te=k[0],X=k[1],le=k[2],he=k[3],Me=he*W+X*ee-le*$,He=he*$+le*W-te*ee,ze=he*ee+te*$-X*W,Be=-te*W-X*$-le*ee;return A[0]=Me*he+Be*-te+He*-le-ze*-X,A[1]=He*he+Be*-X+ze*-te-Me*-le,A[2]=ze*he+Be*-le+Me*-X-He*-te,A[3]=I[3],A},ae.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=0,A},ae.str=function(A){return"vec4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+")"},ae.exactEquals=function(A,I){return A[0]===I[0]&&A[1]===I[1]&&A[2]===I[2]&&A[3]===I[3]},ae.equals=function(A,I){var k=A[0],W=A[1],$=A[2],ee=A[3],te=I[0],X=I[1],le=I[2],he=I[3];return Math.abs(k-te)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(te))&&Math.abs(W-X)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(X))&&Math.abs($-le)<=t.EPSILON*Math.max(1,Math.abs($),Math.abs(le))&&Math.abs(ee-he)<=t.EPSILON*Math.max(1,Math.abs(ee),Math.abs(he))},ae.forEach=ae.sqrLen=ae.len=ae.sqrDist=ae.dist=ae.div=ae.mul=ae.sub=void 0;var t=function(A,I){if(A&&A.__esModule)return A;if(A===null||a(A)!=="object"&&typeof A!="function")return{default:A};var k=r(void 0);if(k&&k.has(A))return k.get(A);var W={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in A)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(A,ee)){var te=$?Object.getOwnPropertyDescriptor(A,ee):null;te&&(te.get||te.set)?Object.defineProperty(W,ee,te):W[ee]=A[ee]}return W.default=A,k&&k.set(A,W),W}(Xe());function r(A){if(typeof WeakMap!="function")return null;var I=new WeakMap,k=new WeakMap;return(r=function(W){return W?k:I})(A)}function c(){var A=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function f(A,I,k){return A[0]=I[0]-k[0],A[1]=I[1]-k[1],A[2]=I[2]-k[2],A[3]=I[3]-k[3],A}function u(A,I,k){return A[0]=I[0]*k[0],A[1]=I[1]*k[1],A[2]=I[2]*k[2],A[3]=I[3]*k[3],A}function m(A,I,k){return A[0]=I[0]/k[0],A[1]=I[1]/k[1],A[2]=I[2]/k[2],A[3]=I[3]/k[3],A}function T(A,I){return Math.hypot(I[0]-A[0],I[1]-A[1],I[2]-A[2],I[3]-A[3])}function L(A,I){var k=I[0]-A[0],W=I[1]-A[1],$=I[2]-A[2],ee=I[3]-A[3];return k*k+W*W+$*$+ee*ee}function D(A){return Math.hypot(A[0],A[1],A[2],A[3])}function b(A){var I=A[0],k=A[1],W=A[2],$=A[3];return I*I+k*k+W*W+$*$}ae.sub=f,ae.mul=u,ae.div=m,ae.dist=T,ae.sqrDist=L,ae.len=D,ae.sqrLen=b;var C,R=(C=c(),function(A,I,k,W,$,ee){var te,X;for(I||(I=4),k||(k=0),X=W?Math.min(W*I+k,A.length):A.length,te=k;te<X;te+=I)C[0]=A[te],C[1]=A[te+1],C[2]=A[te+2],C[3]=A[te+3],$(C,C,ee),A[te]=C[0],A[te+1]=C[1],A[te+2]=C[2],A[te+3]=C[3];return A});return ae.forEach=R,ae}function ve(){if(Qt)return et;function a(ke){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(dt){return typeof dt}:function(dt){return dt&&typeof Symbol=="function"&&dt.constructor===Symbol&&dt!==Symbol.prototype?"symbol":typeof dt},a(ke)}Qt=1,Object.defineProperty(et,"__esModule",{value:!0}),et.create=T,et.identity=function(ke){return ke[0]=0,ke[1]=0,ke[2]=0,ke[3]=1,ke},et.setAxisAngle=L,et.getAxisAngle=function(ke,dt){var Et=2*Math.acos(dt[3]),Ct=Math.sin(Et/2);return Ct>t.EPSILON?(ke[0]=dt[0]/Ct,ke[1]=dt[1]/Ct,ke[2]=dt[2]/Ct):(ke[0]=1,ke[1]=0,ke[2]=0),Et},et.getAngle=function(ke,dt){var Et=k(ke,dt);return Math.acos(2*Et*Et-1)},et.multiply=D,et.rotateX=function(ke,dt,Et){Et*=.5;var Ct=dt[0],Bt=dt[1],ei=dt[2],ni=dt[3],Yt=Math.sin(Et),yi=Math.cos(Et);return ke[0]=Ct*yi+ni*Yt,ke[1]=Bt*yi+ei*Yt,ke[2]=ei*yi-Bt*Yt,ke[3]=ni*yi-Ct*Yt,ke},et.rotateY=function(ke,dt,Et){Et*=.5;var Ct=dt[0],Bt=dt[1],ei=dt[2],ni=dt[3],Yt=Math.sin(Et),yi=Math.cos(Et);return ke[0]=Ct*yi-ei*Yt,ke[1]=Bt*yi+ni*Yt,ke[2]=ei*yi+Ct*Yt,ke[3]=ni*yi-Bt*Yt,ke},et.rotateZ=function(ke,dt,Et){Et*=.5;var Ct=dt[0],Bt=dt[1],ei=dt[2],ni=dt[3],Yt=Math.sin(Et),yi=Math.cos(Et);return ke[0]=Ct*yi+Bt*Yt,ke[1]=Bt*yi-Ct*Yt,ke[2]=ei*yi+ni*Yt,ke[3]=ni*yi-ei*Yt,ke},et.calculateW=function(ke,dt){var Et=dt[0],Ct=dt[1],Bt=dt[2];return ke[0]=Et,ke[1]=Ct,ke[2]=Bt,ke[3]=Math.sqrt(Math.abs(1-Et*Et-Ct*Ct-Bt*Bt)),ke},et.exp=b,et.ln=C,et.pow=function(ke,dt,Et){return C(ke,dt),I(ke,ke,Et),b(ke,ke),ke},et.slerp=R,et.random=function(ke){var dt=t.RANDOM(),Et=t.RANDOM(),Ct=t.RANDOM(),Bt=Math.sqrt(1-dt),ei=Math.sqrt(dt);return ke[0]=Bt*Math.sin(2*Math.PI*Et),ke[1]=Bt*Math.cos(2*Math.PI*Et),ke[2]=ei*Math.sin(2*Math.PI*Ct),ke[3]=ei*Math.cos(2*Math.PI*Ct),ke},et.invert=function(ke,dt){var Et=dt[0],Ct=dt[1],Bt=dt[2],ei=dt[3],ni=Et*Et+Ct*Ct+Bt*Bt+ei*ei,Yt=ni?1/ni:0;return ke[0]=-Et*Yt,ke[1]=-Ct*Yt,ke[2]=-Bt*Yt,ke[3]=ei*Yt,ke},et.conjugate=function(ke,dt){return ke[0]=-dt[0],ke[1]=-dt[1],ke[2]=-dt[2],ke[3]=dt[3],ke},et.fromMat3=A,et.fromEuler=function(ke,dt,Et,Ct){var Bt=.5*Math.PI/180;dt*=Bt,Et*=Bt,Ct*=Bt;var ei=Math.sin(dt),ni=Math.cos(dt),Yt=Math.sin(Et),yi=Math.cos(Et),Fi=Math.sin(Ct),di=Math.cos(Ct);return ke[0]=ei*yi*di-ni*Yt*Fi,ke[1]=ni*Yt*di+ei*yi*Fi,ke[2]=ni*yi*Fi-ei*Yt*di,ke[3]=ni*yi*di+ei*Yt*Fi,ke},et.str=function(ke){return"quat("+ke[0]+", "+ke[1]+", "+ke[2]+", "+ke[3]+")"},et.setAxes=et.sqlerp=et.rotationTo=et.equals=et.exactEquals=et.normalize=et.sqrLen=et.squaredLength=et.len=et.length=et.lerp=et.dot=et.scale=et.mul=et.add=et.set=et.copy=et.fromValues=et.clone=void 0;var t=m(Xe()),r=m(At()),c=m(at()),f=m(be());function u(ke){if(typeof WeakMap!="function")return null;var dt=new WeakMap,Et=new WeakMap;return(u=function(Ct){return Ct?Et:dt})(ke)}function m(ke,dt){if(ke&&ke.__esModule)return ke;if(ke===null||a(ke)!=="object"&&typeof ke!="function")return{default:ke};var Et=u(dt);if(Et&&Et.has(ke))return Et.get(ke);var Ct={},Bt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ei in ke)if(ei!=="default"&&Object.prototype.hasOwnProperty.call(ke,ei)){var ni=Bt?Object.getOwnPropertyDescriptor(ke,ei):null;ni&&(ni.get||ni.set)?Object.defineProperty(Ct,ei,ni):Ct[ei]=ke[ei]}return Ct.default=ke,Et&&Et.set(ke,Ct),Ct}function T(){var ke=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(ke[0]=0,ke[1]=0,ke[2]=0),ke[3]=1,ke}function L(ke,dt,Et){Et*=.5;var Ct=Math.sin(Et);return ke[0]=Ct*dt[0],ke[1]=Ct*dt[1],ke[2]=Ct*dt[2],ke[3]=Math.cos(Et),ke}function D(ke,dt,Et){var Ct=dt[0],Bt=dt[1],ei=dt[2],ni=dt[3],Yt=Et[0],yi=Et[1],Fi=Et[2],di=Et[3];return ke[0]=Ct*di+ni*Yt+Bt*Fi-ei*yi,ke[1]=Bt*di+ni*yi+ei*Yt-Ct*Fi,ke[2]=ei*di+ni*Fi+Ct*yi-Bt*Yt,ke[3]=ni*di-Ct*Yt-Bt*yi-ei*Fi,ke}function b(ke,dt){var Et=dt[0],Ct=dt[1],Bt=dt[2],ei=dt[3],ni=Math.sqrt(Et*Et+Ct*Ct+Bt*Bt),Yt=Math.exp(ei),yi=ni>0?Yt*Math.sin(ni)/ni:0;return ke[0]=Et*yi,ke[1]=Ct*yi,ke[2]=Bt*yi,ke[3]=Yt*Math.cos(ni),ke}function C(ke,dt){var Et=dt[0],Ct=dt[1],Bt=dt[2],ei=dt[3],ni=Math.sqrt(Et*Et+Ct*Ct+Bt*Bt),Yt=ni>0?Math.atan2(ni,ei)/ni:0;return ke[0]=Et*Yt,ke[1]=Ct*Yt,ke[2]=Bt*Yt,ke[3]=.5*Math.log(Et*Et+Ct*Ct+Bt*Bt+ei*ei),ke}function R(ke,dt,Et,Ct){var Bt,ei,ni,Yt,yi,Fi=dt[0],di=dt[1],Tn=dt[2],ln=dt[3],$i=Et[0],Di=Et[1],Kn=Et[2],bn=Et[3];return(ei=Fi*$i+di*Di+Tn*Kn+ln*bn)<0&&(ei=-ei,$i=-$i,Di=-Di,Kn=-Kn,bn=-bn),1-ei>t.EPSILON?(Bt=Math.acos(ei),ni=Math.sin(Bt),Yt=Math.sin((1-Ct)*Bt)/ni,yi=Math.sin(Ct*Bt)/ni):(Yt=1-Ct,yi=Ct),ke[0]=Yt*Fi+yi*$i,ke[1]=Yt*di+yi*Di,ke[2]=Yt*Tn+yi*Kn,ke[3]=Yt*ln+yi*bn,ke}function A(ke,dt){var Et,Ct=dt[0]+dt[4]+dt[8];if(Ct>0)Et=Math.sqrt(Ct+1),ke[3]=.5*Et,ke[0]=(dt[5]-dt[7])*(Et=.5/Et),ke[1]=(dt[6]-dt[2])*Et,ke[2]=(dt[1]-dt[3])*Et;else{var Bt=0;dt[4]>dt[0]&&(Bt=1),dt[8]>dt[3*Bt+Bt]&&(Bt=2);var ei=(Bt+1)%3,ni=(Bt+2)%3;Et=Math.sqrt(dt[3*Bt+Bt]-dt[3*ei+ei]-dt[3*ni+ni]+1),ke[Bt]=.5*Et,ke[3]=(dt[3*ei+ni]-dt[3*ni+ei])*(Et=.5/Et),ke[ei]=(dt[3*ei+Bt]+dt[3*Bt+ei])*Et,ke[ni]=(dt[3*ni+Bt]+dt[3*Bt+ni])*Et}return ke}et.clone=f.clone,et.fromValues=f.fromValues,et.copy=f.copy,et.set=f.set,et.add=f.add,et.mul=D;var I=f.scale;et.scale=I;var k=f.dot;et.dot=k,et.lerp=f.lerp;var W=f.length;et.length=W,et.len=W;var $=f.squaredLength;et.squaredLength=$,et.sqrLen=$;var ee=f.normalize;et.normalize=ee,et.exactEquals=f.exactEquals,et.equals=f.equals;var te,X,le,he=(te=c.create(),X=c.fromValues(1,0,0),le=c.fromValues(0,1,0),function(ke,dt,Et){var Ct=c.dot(dt,Et);return Ct<-.999999?(c.cross(te,X,dt),c.len(te)<1e-6&&c.cross(te,le,dt),c.normalize(te,te),L(ke,te,Math.PI),ke):Ct>.999999?(ke[0]=0,ke[1]=0,ke[2]=0,ke[3]=1,ke):(c.cross(te,dt,Et),ke[0]=te[0],ke[1]=te[1],ke[2]=te[2],ke[3]=1+Ct,ee(ke,ke))});et.rotationTo=he;var Me,He,ze=(Me=T(),He=T(),function(ke,dt,Et,Ct,Bt,ei){return R(Me,dt,Bt,ei),R(He,Et,Ct,ei),R(ke,Me,He,2*ei*(1-ei)),ke});et.sqlerp=ze;var Be,yt=(Be=r.create(),function(ke,dt,Et,Ct){return Be[0]=Et[0],Be[3]=Et[1],Be[6]=Et[2],Be[1]=Ct[0],Be[4]=Ct[1],Be[7]=Ct[2],Be[2]=-dt[0],Be[5]=-dt[1],Be[8]=-dt[2],ee(ke,A(ke,Be))});return et.setAxes=yt,et}var De,Ce={};function Vt(){if(De)return Ce;function a(R){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},a(R)}De=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.create=function(){var R=new t.ARRAY_TYPE(8);return t.ARRAY_TYPE!=Float32Array&&(R[0]=0,R[1]=0,R[2]=0,R[4]=0,R[5]=0,R[6]=0,R[7]=0),R[3]=1,R},Ce.clone=function(R){var A=new t.ARRAY_TYPE(8);return A[0]=R[0],A[1]=R[1],A[2]=R[2],A[3]=R[3],A[4]=R[4],A[5]=R[5],A[6]=R[6],A[7]=R[7],A},Ce.fromValues=function(R,A,I,k,W,$,ee,te){var X=new t.ARRAY_TYPE(8);return X[0]=R,X[1]=A,X[2]=I,X[3]=k,X[4]=W,X[5]=$,X[6]=ee,X[7]=te,X},Ce.fromRotationTranslationValues=function(R,A,I,k,W,$,ee){var te=new t.ARRAY_TYPE(8);te[0]=R,te[1]=A,te[2]=I,te[3]=k;var X=.5*W,le=.5*$,he=.5*ee;return te[4]=X*k+le*I-he*A,te[5]=le*k+he*R-X*I,te[6]=he*k+X*A-le*R,te[7]=-X*R-le*A-he*I,te},Ce.fromRotationTranslation=m,Ce.fromTranslation=function(R,A){return R[0]=0,R[1]=0,R[2]=0,R[3]=1,R[4]=.5*A[0],R[5]=.5*A[1],R[6]=.5*A[2],R[7]=0,R},Ce.fromRotation=function(R,A){return R[0]=A[0],R[1]=A[1],R[2]=A[2],R[3]=A[3],R[4]=0,R[5]=0,R[6]=0,R[7]=0,R},Ce.fromMat4=function(R,A){var I=r.create();c.getRotation(I,A);var k=new t.ARRAY_TYPE(3);return c.getTranslation(k,A),m(R,I,k),R},Ce.copy=T,Ce.identity=function(R){return R[0]=0,R[1]=0,R[2]=0,R[3]=1,R[4]=0,R[5]=0,R[6]=0,R[7]=0,R},Ce.set=function(R,A,I,k,W,$,ee,te,X){return R[0]=A,R[1]=I,R[2]=k,R[3]=W,R[4]=$,R[5]=ee,R[6]=te,R[7]=X,R},Ce.getDual=function(R,A){return R[0]=A[4],R[1]=A[5],R[2]=A[6],R[3]=A[7],R},Ce.setDual=function(R,A){return R[4]=A[0],R[5]=A[1],R[6]=A[2],R[7]=A[3],R},Ce.getTranslation=function(R,A){var I=A[4],k=A[5],W=A[6],$=A[7],ee=-A[0],te=-A[1],X=-A[2],le=A[3];return R[0]=2*(I*le+$*ee+k*X-W*te),R[1]=2*(k*le+$*te+W*ee-I*X),R[2]=2*(W*le+$*X+I*te-k*ee),R},Ce.translate=function(R,A,I){var k=A[0],W=A[1],$=A[2],ee=A[3],te=.5*I[0],X=.5*I[1],le=.5*I[2],he=A[4],Me=A[5],He=A[6],ze=A[7];return R[0]=k,R[1]=W,R[2]=$,R[3]=ee,R[4]=ee*te+W*le-$*X+he,R[5]=ee*X+$*te-k*le+Me,R[6]=ee*le+k*X-W*te+He,R[7]=-k*te-W*X-$*le+ze,R},Ce.rotateX=function(R,A,I){var k=-A[0],W=-A[1],$=-A[2],ee=A[3],te=A[4],X=A[5],le=A[6],he=A[7],Me=te*ee+he*k+X*$-le*W,He=X*ee+he*W+le*k-te*$,ze=le*ee+he*$+te*W-X*k,Be=he*ee-te*k-X*W-le*$;return r.rotateX(R,A,I),R[4]=Me*(ee=R[3])+Be*(k=R[0])+He*($=R[2])-ze*(W=R[1]),R[5]=He*ee+Be*W+ze*k-Me*$,R[6]=ze*ee+Be*$+Me*W-He*k,R[7]=Be*ee-Me*k-He*W-ze*$,R},Ce.rotateY=function(R,A,I){var k=-A[0],W=-A[1],$=-A[2],ee=A[3],te=A[4],X=A[5],le=A[6],he=A[7],Me=te*ee+he*k+X*$-le*W,He=X*ee+he*W+le*k-te*$,ze=le*ee+he*$+te*W-X*k,Be=he*ee-te*k-X*W-le*$;return r.rotateY(R,A,I),R[4]=Me*(ee=R[3])+Be*(k=R[0])+He*($=R[2])-ze*(W=R[1]),R[5]=He*ee+Be*W+ze*k-Me*$,R[6]=ze*ee+Be*$+Me*W-He*k,R[7]=Be*ee-Me*k-He*W-ze*$,R},Ce.rotateZ=function(R,A,I){var k=-A[0],W=-A[1],$=-A[2],ee=A[3],te=A[4],X=A[5],le=A[6],he=A[7],Me=te*ee+he*k+X*$-le*W,He=X*ee+he*W+le*k-te*$,ze=le*ee+he*$+te*W-X*k,Be=he*ee-te*k-X*W-le*$;return r.rotateZ(R,A,I),R[4]=Me*(ee=R[3])+Be*(k=R[0])+He*($=R[2])-ze*(W=R[1]),R[5]=He*ee+Be*W+ze*k-Me*$,R[6]=ze*ee+Be*$+Me*W-He*k,R[7]=Be*ee-Me*k-He*W-ze*$,R},Ce.rotateByQuatAppend=function(R,A,I){var k=I[0],W=I[1],$=I[2],ee=I[3],te=A[0],X=A[1],le=A[2],he=A[3];return R[0]=te*ee+he*k+X*$-le*W,R[1]=X*ee+he*W+le*k-te*$,R[2]=le*ee+he*$+te*W-X*k,R[3]=he*ee-te*k-X*W-le*$,R[4]=(te=A[4])*ee+(he=A[7])*k+(X=A[5])*$-(le=A[6])*W,R[5]=X*ee+he*W+le*k-te*$,R[6]=le*ee+he*$+te*W-X*k,R[7]=he*ee-te*k-X*W-le*$,R},Ce.rotateByQuatPrepend=function(R,A,I){var k=A[0],W=A[1],$=A[2],ee=A[3],te=I[0],X=I[1],le=I[2],he=I[3];return R[0]=k*he+ee*te+W*le-$*X,R[1]=W*he+ee*X+$*te-k*le,R[2]=$*he+ee*le+k*X-W*te,R[3]=ee*he-k*te-W*X-$*le,R[4]=k*(he=I[7])+ee*(te=I[4])+W*(le=I[6])-$*(X=I[5]),R[5]=W*he+ee*X+$*te-k*le,R[6]=$*he+ee*le+k*X-W*te,R[7]=ee*he-k*te-W*X-$*le,R},Ce.rotateAroundAxis=function(R,A,I,k){if(Math.abs(k)<t.EPSILON)return T(R,A);var W=Math.hypot(I[0],I[1],I[2]);k*=.5;var $=Math.sin(k),ee=$*I[0]/W,te=$*I[1]/W,X=$*I[2]/W,le=Math.cos(k),he=A[0],Me=A[1],He=A[2],ze=A[3];R[0]=he*le+ze*ee+Me*X-He*te,R[1]=Me*le+ze*te+He*ee-he*X,R[2]=He*le+ze*X+he*te-Me*ee,R[3]=ze*le-he*ee-Me*te-He*X;var Be=A[4],yt=A[5],ke=A[6],dt=A[7];return R[4]=Be*le+dt*ee+yt*X-ke*te,R[5]=yt*le+dt*te+ke*ee-Be*X,R[6]=ke*le+dt*X+Be*te-yt*ee,R[7]=dt*le-Be*ee-yt*te-ke*X,R},Ce.add=function(R,A,I){return R[0]=A[0]+I[0],R[1]=A[1]+I[1],R[2]=A[2]+I[2],R[3]=A[3]+I[3],R[4]=A[4]+I[4],R[5]=A[5]+I[5],R[6]=A[6]+I[6],R[7]=A[7]+I[7],R},Ce.multiply=L,Ce.scale=function(R,A,I){return R[0]=A[0]*I,R[1]=A[1]*I,R[2]=A[2]*I,R[3]=A[3]*I,R[4]=A[4]*I,R[5]=A[5]*I,R[6]=A[6]*I,R[7]=A[7]*I,R},Ce.lerp=function(R,A,I,k){var W=1-k;return D(A,I)<0&&(k=-k),R[0]=A[0]*W+I[0]*k,R[1]=A[1]*W+I[1]*k,R[2]=A[2]*W+I[2]*k,R[3]=A[3]*W+I[3]*k,R[4]=A[4]*W+I[4]*k,R[5]=A[5]*W+I[5]*k,R[6]=A[6]*W+I[6]*k,R[7]=A[7]*W+I[7]*k,R},Ce.invert=function(R,A){var I=C(A);return R[0]=-A[0]/I,R[1]=-A[1]/I,R[2]=-A[2]/I,R[3]=A[3]/I,R[4]=-A[4]/I,R[5]=-A[5]/I,R[6]=-A[6]/I,R[7]=A[7]/I,R},Ce.conjugate=function(R,A){return R[0]=-A[0],R[1]=-A[1],R[2]=-A[2],R[3]=A[3],R[4]=-A[4],R[5]=-A[5],R[6]=-A[6],R[7]=A[7],R},Ce.normalize=function(R,A){var I=C(A);if(I>0){I=Math.sqrt(I);var k=A[0]/I,W=A[1]/I,$=A[2]/I,ee=A[3]/I,te=A[4],X=A[5],le=A[6],he=A[7],Me=k*te+W*X+$*le+ee*he;R[0]=k,R[1]=W,R[2]=$,R[3]=ee,R[4]=(te-k*Me)/I,R[5]=(X-W*Me)/I,R[6]=(le-$*Me)/I,R[7]=(he-ee*Me)/I}return R},Ce.str=function(R){return"quat2("+R[0]+", "+R[1]+", "+R[2]+", "+R[3]+", "+R[4]+", "+R[5]+", "+R[6]+", "+R[7]+")"},Ce.exactEquals=function(R,A){return R[0]===A[0]&&R[1]===A[1]&&R[2]===A[2]&&R[3]===A[3]&&R[4]===A[4]&&R[5]===A[5]&&R[6]===A[6]&&R[7]===A[7]},Ce.equals=function(R,A){var I=R[0],k=R[1],W=R[2],$=R[3],ee=R[4],te=R[5],X=R[6],le=R[7],he=A[0],Me=A[1],He=A[2],ze=A[3],Be=A[4],yt=A[5],ke=A[6],dt=A[7];return Math.abs(I-he)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(he))&&Math.abs(k-Me)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(Me))&&Math.abs(W-He)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(He))&&Math.abs($-ze)<=t.EPSILON*Math.max(1,Math.abs($),Math.abs(ze))&&Math.abs(ee-Be)<=t.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Be))&&Math.abs(te-yt)<=t.EPSILON*Math.max(1,Math.abs(te),Math.abs(yt))&&Math.abs(X-ke)<=t.EPSILON*Math.max(1,Math.abs(X),Math.abs(ke))&&Math.abs(le-dt)<=t.EPSILON*Math.max(1,Math.abs(le),Math.abs(dt))},Ce.sqrLen=Ce.squaredLength=Ce.len=Ce.length=Ce.dot=Ce.mul=Ce.setReal=Ce.getReal=void 0;var t=u(Xe()),r=u(ve()),c=u(ot());function f(R){if(typeof WeakMap!="function")return null;var A=new WeakMap,I=new WeakMap;return(f=function(k){return k?I:A})(R)}function u(R,A){if(R&&R.__esModule)return R;if(R===null||a(R)!=="object"&&typeof R!="function")return{default:R};var I=f(A);if(I&&I.has(R))return I.get(R);var k={},W=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var $ in R)if($!=="default"&&Object.prototype.hasOwnProperty.call(R,$)){var ee=W?Object.getOwnPropertyDescriptor(R,$):null;ee&&(ee.get||ee.set)?Object.defineProperty(k,$,ee):k[$]=R[$]}return k.default=R,I&&I.set(R,k),k}function m(R,A,I){var k=.5*I[0],W=.5*I[1],$=.5*I[2],ee=A[0],te=A[1],X=A[2],le=A[3];return R[0]=ee,R[1]=te,R[2]=X,R[3]=le,R[4]=k*le+W*X-$*te,R[5]=W*le+$*ee-k*X,R[6]=$*le+k*te-W*ee,R[7]=-k*ee-W*te-$*X,R}function T(R,A){return R[0]=A[0],R[1]=A[1],R[2]=A[2],R[3]=A[3],R[4]=A[4],R[5]=A[5],R[6]=A[6],R[7]=A[7],R}function L(R,A,I){var k=A[0],W=A[1],$=A[2],ee=A[3],te=I[4],X=I[5],le=I[6],he=I[7],Me=A[4],He=A[5],ze=A[6],Be=A[7],yt=I[0],ke=I[1],dt=I[2],Et=I[3];return R[0]=k*Et+ee*yt+W*dt-$*ke,R[1]=W*Et+ee*ke+$*yt-k*dt,R[2]=$*Et+ee*dt+k*ke-W*yt,R[3]=ee*Et-k*yt-W*ke-$*dt,R[4]=k*he+ee*te+W*le-$*X+Me*Et+Be*yt+He*dt-ze*ke,R[5]=W*he+ee*X+$*te-k*le+He*Et+Be*ke+ze*yt-Me*dt,R[6]=$*he+ee*le+k*X-W*te+ze*Et+Be*dt+Me*ke-He*yt,R[7]=ee*he-k*te-W*X-$*le+Be*Et-Me*yt-He*ke-ze*dt,R}Ce.getReal=r.copy,Ce.setReal=r.copy,Ce.mul=L;var D=r.dot;Ce.dot=D;var b=r.length;Ce.length=b,Ce.len=b;var C=r.squaredLength;return Ce.squaredLength=C,Ce.sqrLen=C,Ce}var zt,mt,Nt={};function Gt(){if(zt)return Nt;function a(A){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},a(A)}zt=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.create=c,Nt.clone=function(A){var I=new t.ARRAY_TYPE(2);return I[0]=A[0],I[1]=A[1],I},Nt.fromValues=function(A,I){var k=new t.ARRAY_TYPE(2);return k[0]=A,k[1]=I,k},Nt.copy=function(A,I){return A[0]=I[0],A[1]=I[1],A},Nt.set=function(A,I,k){return A[0]=I,A[1]=k,A},Nt.add=function(A,I,k){return A[0]=I[0]+k[0],A[1]=I[1]+k[1],A},Nt.subtract=f,Nt.multiply=u,Nt.divide=m,Nt.ceil=function(A,I){return A[0]=Math.ceil(I[0]),A[1]=Math.ceil(I[1]),A},Nt.floor=function(A,I){return A[0]=Math.floor(I[0]),A[1]=Math.floor(I[1]),A},Nt.min=function(A,I,k){return A[0]=Math.min(I[0],k[0]),A[1]=Math.min(I[1],k[1]),A},Nt.max=function(A,I,k){return A[0]=Math.max(I[0],k[0]),A[1]=Math.max(I[1],k[1]),A},Nt.round=function(A,I){return A[0]=Math.round(I[0]),A[1]=Math.round(I[1]),A},Nt.scale=function(A,I,k){return A[0]=I[0]*k,A[1]=I[1]*k,A},Nt.scaleAndAdd=function(A,I,k,W){return A[0]=I[0]+k[0]*W,A[1]=I[1]+k[1]*W,A},Nt.distance=T,Nt.squaredDistance=L,Nt.length=D,Nt.squaredLength=b,Nt.negate=function(A,I){return A[0]=-I[0],A[1]=-I[1],A},Nt.inverse=function(A,I){return A[0]=1/I[0],A[1]=1/I[1],A},Nt.normalize=function(A,I){var k=I[0],W=I[1],$=k*k+W*W;return $>0&&($=1/Math.sqrt($)),A[0]=I[0]*$,A[1]=I[1]*$,A},Nt.dot=function(A,I){return A[0]*I[0]+A[1]*I[1]},Nt.cross=function(A,I,k){var W=I[0]*k[1]-I[1]*k[0];return A[0]=A[1]=0,A[2]=W,A},Nt.lerp=function(A,I,k,W){var $=I[0],ee=I[1];return A[0]=$+W*(k[0]-$),A[1]=ee+W*(k[1]-ee),A},Nt.random=function(A,I){I=I||1;var k=2*t.RANDOM()*Math.PI;return A[0]=Math.cos(k)*I,A[1]=Math.sin(k)*I,A},Nt.transformMat2=function(A,I,k){var W=I[0],$=I[1];return A[0]=k[0]*W+k[2]*$,A[1]=k[1]*W+k[3]*$,A},Nt.transformMat2d=function(A,I,k){var W=I[0],$=I[1];return A[0]=k[0]*W+k[2]*$+k[4],A[1]=k[1]*W+k[3]*$+k[5],A},Nt.transformMat3=function(A,I,k){var W=I[0],$=I[1];return A[0]=k[0]*W+k[3]*$+k[6],A[1]=k[1]*W+k[4]*$+k[7],A},Nt.transformMat4=function(A,I,k){var W=I[0],$=I[1];return A[0]=k[0]*W+k[4]*$+k[12],A[1]=k[1]*W+k[5]*$+k[13],A},Nt.rotate=function(A,I,k,W){var $=I[0]-k[0],ee=I[1]-k[1],te=Math.sin(W),X=Math.cos(W);return A[0]=$*X-ee*te+k[0],A[1]=$*te+ee*X+k[1],A},Nt.angle=function(A,I){var k=A[0],W=A[1],$=I[0],ee=I[1],te=Math.sqrt(k*k+W*W)*Math.sqrt($*$+ee*ee);return Math.acos(Math.min(Math.max(te&&(k*$+W*ee)/te,-1),1))},Nt.zero=function(A){return A[0]=0,A[1]=0,A},Nt.str=function(A){return"vec2("+A[0]+", "+A[1]+")"},Nt.exactEquals=function(A,I){return A[0]===I[0]&&A[1]===I[1]},Nt.equals=function(A,I){var k=A[0],W=A[1],$=I[0],ee=I[1];return Math.abs(k-$)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs($))&&Math.abs(W-ee)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(ee))},Nt.forEach=Nt.sqrLen=Nt.sqrDist=Nt.dist=Nt.div=Nt.mul=Nt.sub=Nt.len=void 0;var t=function(A,I){if(A&&A.__esModule)return A;if(A===null||a(A)!=="object"&&typeof A!="function")return{default:A};var k=r(void 0);if(k&&k.has(A))return k.get(A);var W={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in A)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(A,ee)){var te=$?Object.getOwnPropertyDescriptor(A,ee):null;te&&(te.get||te.set)?Object.defineProperty(W,ee,te):W[ee]=A[ee]}return W.default=A,k&&k.set(A,W),W}(Xe());function r(A){if(typeof WeakMap!="function")return null;var I=new WeakMap,k=new WeakMap;return(r=function(W){return W?k:I})(A)}function c(){var A=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0),A}function f(A,I,k){return A[0]=I[0]-k[0],A[1]=I[1]-k[1],A}function u(A,I,k){return A[0]=I[0]*k[0],A[1]=I[1]*k[1],A}function m(A,I,k){return A[0]=I[0]/k[0],A[1]=I[1]/k[1],A}function T(A,I){return Math.hypot(I[0]-A[0],I[1]-A[1])}function L(A,I){var k=I[0]-A[0],W=I[1]-A[1];return k*k+W*W}function D(A){return Math.hypot(A[0],A[1])}function b(A){var I=A[0],k=A[1];return I*I+k*k}Nt.len=D,Nt.sub=f,Nt.mul=u,Nt.div=m,Nt.dist=T,Nt.sqrDist=L,Nt.sqrLen=b;var C,R=(C=c(),function(A,I,k,W,$,ee){var te,X;for(I||(I=2),k||(k=0),X=W?Math.min(W*I+k,A.length):A.length,te=k;te<X;te+=I)C[0]=A[te],C[1]=A[te+1],$(C,C,ee),A[te]=C[0],A[te+1]=C[1];return A});return Nt.forEach=R,Nt}function ii(){if(mt)return ce;function a(A){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},a(A)}mt=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.vec4=ce.vec3=ce.vec2=ce.quat2=ce.quat=ce.mat4=ce.mat3=ce.mat2d=ce.mat2=ce.glMatrix=void 0;var t=R(Xe());ce.glMatrix=t;var r=R(ct());ce.mat2=r;var c=R(pt());ce.mat2d=c;var f=R(At());ce.mat3=f;var u=R(ot());ce.mat4=u;var m=R(ve());ce.quat=m;var T=R(Vt());ce.quat2=T;var L=R(Gt());ce.vec2=L;var D=R(at());ce.vec3=D;var b=R(be());function C(A){if(typeof WeakMap!="function")return null;var I=new WeakMap,k=new WeakMap;return(C=function(W){return W?k:I})(A)}function R(A,I){if(A&&A.__esModule)return A;if(A===null||a(A)!=="object"&&typeof A!="function")return{default:A};var k=C(I);if(k&&k.has(A))return k.get(A);var W={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in A)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(A,ee)){var te=$?Object.getOwnPropertyDescriptor(A,ee):null;te&&(te.get||te.set)?Object.defineProperty(W,ee,te):W[ee]=A[ee]}return W.default=A,k&&k.set(A,W),W}return ce.vec4=b,ce}var zi,Hi,on,mn,Qe=ii(),Yn=function(){if(Hi)return zi;function a(t,r,c,f){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=c,this.p2y=f}return Hi=1,zi=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,f=0;f<8;f++){var u=this.sampleCurveX(c)-t;if(Math.abs(u)<r)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=u/m}var T=0,L=1;for(c=t,f=0;f<20&&(u=this.sampleCurveX(c),!(Math.abs(u-t)<r));f++)t>u?T=c:L=c,c=.5*(L-T)+T;return c},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},zi}(),pr=J(Yn);function bt(){if(mn)return on;function a(t,r){this.x=t,this.y=r}return mn=1,on=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,c=t.y-this.y;return r*r+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),c=Math.sin(t),f=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=f,this},_rotateAround:function(t,r){var c=Math.cos(t),f=Math.sin(t),u=r.y+f*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-f*(this.y-r.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t},on}var je=J(bt());function Ot(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(!Ot(a[r],t[r]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const r in a)if(!Ot(a[r],t[r]))return!1;return!0}return a===t}const Le=Math.PI/180,Ie=180/Math.PI;function Fe(a){return a*Le}function Ge(a){return a*Ie}const Je=[[0,0],[1,0],[1,1],[0,1]];function st(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,r=t*a;return 4*(a<.5?r:3*(a-t)+r-.75)}function lt(a,t,r,c){const f=new pr(a,t,r,c);return function(u){return f.solve(u)}}const Tt=lt(.25,.1,.25,1);function Mt(a,t,r){return Math.min(r,Math.max(t,a))}function ci(a,t,r){return(r=Mt((r-a)/(t-a),0,1))*r*(3-2*r)}function xi(a,t,r){const c=r-t,f=((a-t)%c+c)%c+t;return f===t?r:f}function an(a,t,r){if(!a.length)return r(null,[]);let c=a.length;const f=new Array(a.length);let u=null;a.forEach((m,T)=>{t(m,(L,D)=>{L&&(u=L),f[T]=D,--c==0&&r(u,f)})})}function cn(a,...t){for(const r of t)for(const c in r)a[c]=r[c];return a}let _n=1;function Fn(){return _n++}function Mn(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function jn(a,t){a.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function Lr(a,t){return a.indexOf(t,a.length-t.length)!==-1}function Tr(a,t,r){const c={};for(const f in a)c[f]=t.call(this,a[f],f,a);return c}function eo(a,t,r){const c={};for(const f in a)t.call(this,a[f],f,a)&&(c[f]=a[f]);return c}function $r(a){return Array.isArray(a)?a.map($r):typeof a=="object"&&a?Tr(a,$r):a}const en={};function Wn(a){en[a]||(typeof console<"u"&&console.warn(a),en[a]=!0)}function Ls(a,t,r){return(r.y-a.y)*(t.x-a.x)>(t.y-a.y)*(r.x-a.x)}function bo(a){let t=0;for(let r,c,f=0,u=a.length,m=u-1;f<u;m=f++)r=a[f],c=a[m],t+=(c.x-r.x)*(r.y+c.y);return t}function Lo([a,t,r]){const c=Fe(t+90),f=Fe(r);return{x:a*Math.cos(c)*Math.sin(f),y:a*Math.sin(c)*Math.sin(f),z:a*Math.cos(f),azimuthal:t,polar:r}}function _s(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function js(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,c,f,u)=>{const m=f||u;return t[c]=!m||m.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let Dr=null;function no(a,t){return[a[4*t],a[4*t+1],a[4*t+2],a[4*t+3]]}function uo(a,t,r,c){for(;t<r;){const f=t+r>>1;a[f]<c?t=f+1:r=f}return t}function oi(a,t,r,c){for(;t<r;){const f=t+r>>1;a[f]<=c?t=f+1:r=f}return t}function ye(a){return a>0?1/(1.001-a):1+a}function ie(a){return a>0?1-1/(1.001-a):-a}const qe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!qe.API_URL)return null;try{const a=new URL(qe.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function St(a){return qe.API_URL_REGEX.test(a)}function ut(a){return qe.API_SPRITE_REGEX.test(a)}let Ft,si,$t,ai,fi,pi;function Pi(){return Ft==null&&(Ft=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ft}const tn={now:()=>ai!==void 0?ai:performance.now(),setNow(a){ai=a},restoreNow(){ai=void 0},frame(a){const t=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(a,t=0){const{width:r,height:c}=a;fi||(fi=document.createElement("canvas"));const f=fi.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(r>fi.width||c>fi.height)&&(fi.width=r,fi.height=c),f.clearRect(-t,-t,r+2*t,c+2*t),f.drawImage(a,0,0,r,c),f.getImageData(-t,-t,r+2*t,c+2*t)},resolveURL:a=>(si||(si=document.createElement("a")),si.href=a,si.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&($t==null&&($t=window.matchMedia("(prefers-reduced-motion: reduce)")),$t.matches)},hasCanvasFingerprintNoise(){if(pi!==void 0)return pi;if(!Pi())return pi=!1,!1;const a=new OffscreenCanvas(85,1),t=a.getContext("2d",{willReadFrequently:!0});let r=0;for(let f=0;f<a.width;++f)t.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,t.fillRect(f,0,1,1);const c=t.getImageData(0,0,a.width,a.height);r=0;for(let f=0;f<c.data.length;++f)if(f%4!=3&&r++!==c.data[f])return pi=!0,!0;return pi=!1,!1}};function xn(a,t){const r=a.indexOf("?");if(r<0)return`${a}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(a.slice(r));for(const f in t)c.set(f,t[f]);return`${a.slice(0,r)}?${c.toString()}`}function Jn(a,t={persistentParams:[]}){const r=a.indexOf("?");if(r<0)return a;const c=new URLSearchParams,f=new URLSearchParams(a.slice(r));for(const m of t.persistentParams){const T=f.get(m);T&&c.set(m,T)}const u=c.toString();return`${a.slice(0,r)}${u.length>0?`?${u}`:""}`}const sr="mapbox-tiles";let ar=500,er=50;const Zr=["language","worldview","jobid"];let Gr,yr;function Jr(){try{return caches}catch{}}function us(){const a=Jr();a&&Gr==null&&(Gr=a.open(sr))}let Ns=1/0;const es={supported:!1,testSupport:function(a){!wo&&Ps&&(Xo?ll(a):Fs=a)}};let Fs,Ps,wo=!1,Xo=!1;const ka=typeof self<"u"?self:{};function ll(a){const t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ps),a.isContextLost())return;es.supported=!0}catch{}a.deleteTexture(t),wo=!0}ka.document&&(Ps=ka.document.createElement("img"),Ps.onload=function(){Fs&&ll(Fs),Fs=null,Xo=!0},Ps.onerror=function(){wo=!0,Fs=null},Ps.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const na={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(na);class nr extends Error{constructor(t,r,c){r===401&&St(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Go=_s()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,fo=function(a,t){if(!(/^file:/.test(r=a.url)||/^file:/.test(Go())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,f){const u=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Go(),referrerPolicy:c.referrerPolicy,signal:u.signal});let T=!1,L=!1;const D=(b=m.url).indexOf("sku=")>0&&St(b);var b;c.type==="json"&&m.headers.set("Accept","application/json");const C=(A,I,k)=>{if(L)return;if(A&&A.message!=="SecurityError"&&Wn(A.toString()),I&&k)return R(I);const W=Date.now();fetch(m).then($=>{if($.ok){const ee=D?$.clone():null;return R($,ee,W)}return f(new nr($.statusText,$.status,c.url))}).catch($=>{$.name!=="AbortError"&&f(new Error(`${$.message} ${c.url}`))})},R=(A,I,k)=>{(c.type==="arrayBuffer"?A.arrayBuffer():c.type==="json"?A.json():A.text()).then(W=>{L||(I&&k&&function($,ee,te){if(us(),Gr==null)return;const X=js(ee.headers.get("Cache-Control")||"");if(X["no-store"])return;const le={status:ee.status,statusText:ee.statusText,headers:new Headers};ee.headers.forEach((He,ze)=>le.headers.set(ze,He)),X["max-age"]&&le.headers.set("Expires",new Date(te+1e3*X["max-age"]).toUTCString());const he=le.headers.get("Expires");if(!he||new Date(he).getTime()-te<42e4)return;let Me=Jn($.url,{persistentParams:Zr});if(ee.status===206){const He=$.headers.get("Range");if(!He)return;le.status=200,Me=xn(Me,{range:He})}(function(He,ze){if(yr===void 0)try{new Response(new ReadableStream),yr=!0}catch{yr=!1}yr?ze(He.body):He.blob().then(ze)})(ee,He=>{const ze=new Response((Be=ee.status)!==200&&Be!==404&&[101,103,204,205,304].includes(Be)?null:He,le);var Be;us(),Gr!=null&&Gr.then(yt=>yt.put(Me,ze)).catch(yt=>Wn(yt.message))})}(m,I,k),T=!0,f(null,W,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(W=>{L||f(new Error(W.message))})};return D?function(A,I){if(us(),Gr==null)return I(null);Gr.then(k=>{let W=Jn(A.url,{persistentParams:Zr});const $=A.headers.get("Range");$&&(W=xn(W,{range:$})),k.match(W).then(ee=>{const te=function(X){if(!X)return!1;const le=new Date(X.headers.get("Expires")||0),he=js(X.headers.get("Cache-Control")||"");return le>Date.now()&&!he["no-cache"]}(ee);k.delete(W),te&&k.put(W,ee.clone()),I(null,ee,te)}).catch(I)}).catch(I)}(m,C):C(null,null),{cancel:()=>{L=!0,T||u.abort()}}}(a,t);if(_s()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var r;return function(c,f){const u=new XMLHttpRequest;u.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const m in c.headers)u.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=c.credentials==="include",u.onerror=()=>{f(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let m=u.response;if(c.type==="json")try{m=JSON.parse(u.response)}catch(T){return f(T)}f(null,m,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else f(new nr(u.statusText,u.status,c.url))},u.send(c.body),{cancel:()=>u.abort()}}(a,t)},Bo=function(a,t){return fo(cn(a,{type:"arrayBuffer"}),t)};function ra(a){const t=document.createElement("a");return t.href=a,t.protocol===location.protocol&&t.host===location.host}const mo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ho,Ws;Ho=[],Ws=0;const pa=function(a,t){if(es.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Ws>=qe.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:a,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Ho.push(u),u}Ws++;let r=!1;const c=()=>{if(!r)for(r=!0,Ws--;Ho.length&&Ws<qe.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Ho.shift(),{requestParameters:m,callback:T,cancelled:L}=u;L||(u.cancel=pa(m,T).cancel)}},f=Bo(a,(u,m,T,L)=>{c(),u?t(u):m&&(self.createImageBitmap?function(D,b){const C=new Blob([new Uint8Array(D)],{type:"image/png"});createImageBitmap(C).then(R=>{b(null,R)}).catch(R=>{b(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(D,b)=>t(D,b,T,L)):function(D,b){const C=new Image;C.onload=()=>{b(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=mo})},C.onerror=()=>b(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(D)],{type:"image/png"});C.src=D.byteLength?URL.createObjectURL(R):mo}(m,(D,b)=>t(D,b,T,L)))});return{cancel:()=>{f.cancel(),c()}}};var cl,Fa,zl,Us={exports:{}},ul={exports:{}},hl={exports:{}},Ae=function(){if(zl)return Us.exports;zl=1;var a=(cl||(cl=1,ul.exports=function(r,c){var f,u,m,T,L,D,b,C;for(u=r.length-(f=3&r.length),m=c,L=3432918353,D=461845907,C=0;C<u;)b=255&r.charCodeAt(C)|(255&r.charCodeAt(++C))<<8|(255&r.charCodeAt(++C))<<16|(255&r.charCodeAt(++C))<<24,++C,m=27492+(65535&(T=5*(65535&(m=(m^=b=(65535&(b=(b=(65535&b)*L+(((b>>>16)*L&65535)<<16)&4294967295)<<15|b>>>17))*D+(((b>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(b=0,f){case 3:b^=(255&r.charCodeAt(C+2))<<16;case 2:b^=(255&r.charCodeAt(C+1))<<8;case 1:m^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(C)))*L+(((b>>>16)*L&65535)<<16)&4294967295)<<15|b>>>17))*D+(((b>>>16)*D&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),ul.exports),t=(Fa||(Fa=1,hl.exports=function(r,c){for(var f,u=r.length,m=c^u,T=0;u>=4;)f=1540483477*(65535&(f=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24))+((1540483477*(f>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),u-=4,++T;switch(u){case 3:m^=(255&r.charCodeAt(T+2))<<16;case 2:m^=(255&r.charCodeAt(T+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(T)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),hl.exports);return Us.exports=a,Us.exports.murmur3=a,Us.exports.murmur2=t,Us.exports}(),Te=J(Ae);class Ve{constructor(t,...r){cn(this,r[0]||{}),this.type=t}}class Pt extends Ve{constructor(t,r={}){super("error",cn({error:t},r))}}function Ai(a,t,r){r[a]&&r[a].indexOf(t)!==-1||(r[a]=r[a]||[],r[a].push(t))}function Ui(a,t,r){if(r&&r[a]){const c=r[a].indexOf(t);c!==-1&&r[a].splice(c,1)}}class bi{on(t,r){return this._listeners=this._listeners||{},Ai(t,r,this._listeners),this}off(t,r){return Ui(t,r,this._listeners),Ui(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ai(t,r,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,r){const c=typeof t=="string"?new Ve(t,r):t,f=c.type;if(this.listens(f)){c.target=this;const u=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const L of u)L.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const L of m)Ui(f,L,this._oneTimeListeners),L.call(this,c);const T=this._eventedParent;T&&(cn(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(c))}else c instanceof Pt&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Yi,fe={},me=function(){if(Yi)return fe;Yi=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(u){return(u=Math.round(u))<0?0:u>255?255:u}function r(u){return t(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function c(u){return(m=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:m>1?1:m;var m}function f(u,m,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?u+(m-u)*T*6:2*T<1?m:3*T<2?u+(m-u)*(2/3-T)*6:u}try{fe.parseCSSColor=function(u){var m,T=u.replace(/ /g,"").toLowerCase();if(T in a)return a[T].slice();if(T[0]==="#")return T.length===4?(m=parseInt(T.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:T.length===7&&(m=parseInt(T.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var L=T.indexOf("("),D=T.indexOf(")");if(L!==-1&&D+1===T.length){var b=T.substr(0,L),C=T.substr(L+1,D-(L+1)).split(","),R=1;switch(b){case"rgba":if(C.length!==4)return null;R=c(C.pop());case"rgb":return C.length!==3?null:[r(C[0]),r(C[1]),r(C[2]),R];case"hsla":if(C.length!==4)return null;R=c(C.pop());case"hsl":if(C.length!==3)return null;var A=(parseFloat(C[0])%360+360)%360/360,I=c(C[1]),k=c(C[2]),W=k<=.5?k*(I+1):k+I-k*I,$=2*k-W;return[t(255*f($,W,A+1/3)),t(255*f($,W,A)),t(255*f($,W,A-1/3)),R];default:return null}}return null}}catch{}return fe}();class Ee{constructor(t,r,c,f=1){this.r=t,this.g=r,this.b=c,this.a=f}static parse(t){if(!t)return;if(t instanceof Ee)return t;if(typeof t!="string")return;const r=me.parseCSSColor(t);return r?new Ee(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[t,r,c,f]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(r)},${Math.round(c)},${f})`}toRenderColor(t){const{r,g:c,b:f,a:u}=this;return new We(t,r,c,f,u)}}class We{constructor(t,r,c,f,u){if(t){const m=t.image.height,T=m*m;r=u===0?0:r/u*(m-1),c=u===0?0:c/u*(m-1),f=u===0?0:f/u*(m-1);const L=Math.floor(r),D=Math.floor(c),b=Math.floor(f),C=Math.ceil(r),R=Math.ceil(c),A=Math.ceil(f),I=r-L,k=c-D,W=f-b,$=t.image.data,ee=4*(L+D*T+b*m),te=4*(L+D*T+A*m),X=4*(L+R*T+b*m),le=4*(L+R*T+A*m),he=4*(C+D*T+b*m),Me=4*(C+D*T+A*m),He=4*(C+R*T+b*m),ze=4*(C+R*T+A*m);if(ee<0||ze>=$.length)throw new Error("out of range");this.r=Pe(Pe(Pe($[ee],$[te],W),Pe($[X],$[le],W),k),Pe(Pe($[he],$[Me],W),Pe($[He],$[ze],W),k),I)/255*u,this.g=Pe(Pe(Pe($[ee+1],$[te+1],W),Pe($[X+1],$[le+1],W),k),Pe(Pe($[he+1],$[Me+1],W),Pe($[He+1],$[ze+1],W),k),I)/255*u,this.b=Pe(Pe(Pe($[ee+2],$[te+2],W),Pe($[X+2],$[le+2],W),k),Pe(Pe($[he+2],$[Me+2],W),Pe($[He+2],$[ze+2],W),k),I)/255*u,this.a=u}else this.r=r,this.g=c,this.b=f,this.a=u}toArray(){const{r:t,g:r,b:c,a:f}=this;return f===0?[0,0,0,0]:[255*t/f,255*r/f,255*c/f,f]}toArray01(){const{r:t,g:r,b:c,a:f}=this;return f===0?[0,0,0,0]:[t/f,r/f,c/f,f]}toArray01Scaled(t){const{r,g:c,b:f,a:u}=this;return u===0?[0,0,0]:[r/u*t,c/u*t,f/u*t]}toArray01PremultipliedAlpha(){const{r:t,g:r,b:c,a:f}=this;return[t,r,c,f]}toArray01Linear(){const{r:t,g:r,b:c,a:f}=this;return f===0?[0,0,0,0]:[Math.pow(t/f,2.2),Math.pow(r/f,2.2),Math.pow(c/f,2.2),f]}}function Pe(a,t,r){return a*(1-r)+t*r}function li(a,t,r){return a.map((c,f)=>Pe(c,t[f],r))}Ee.black=new Ee(0,0,0,1),Ee.white=new Ee(1,1,1,1),Ee.transparent=new Ee(0,0,0,0),Ee.red=new Ee(1,0,0,1),Ee.blue=new Ee(0,0,1,1);var Mi=Object.freeze({__proto__:null,array:li,color:function(a,t,r){return new Ee(Pe(a.r,t.r,r),Pe(a.g,t.g,r),Pe(a.b,t.b,r),Pe(a.a,t.a,r))},number:Pe});function Wi(a,...t){for(const r of t)for(const c in r)a[c]=r[c];return a}class hn extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Dn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[c,f]of r)this.bindings[c]=f}concat(t){return new Dn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Zi={kind:"null"},Kt={kind:"number"},nn={kind:"string"},Ei={kind:"boolean"},Ln={kind:"color"},Vi={kind:"object"},fn={kind:"value"},cr={kind:"collator"},gr={kind:"formatted"},_r={kind:"resolvedImage"};function Rr(a,t){return{kind:"array",itemType:a,N:t}}function ur(a){if(a.kind==="array"){const t=ur(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const wn=[Zi,Kt,nn,Ei,Ln,gr,Vi,Rr(fn),_r];function ws(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ws(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const r of wn)if(!ws(r,t))return null}}return`Expected ${ur(a)} but found ${ur(t)} instead.`}function wr(a,t){return t.some(r=>r.kind===a.kind)}function Vs(a,t){return t.some(r=>r==="null"?a===null:r==="array"?Array.isArray(a):r==="object"?a&&!Array.isArray(a)&&typeof a=="object":r===typeof a)}class Or{constructor(t,r,c){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ro{constructor(t,r,c,f,u){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=c,this.fontStack=f,this.textColor=u}}class to{constructor(t){this.sections=t}static fromString(t){return new to([new ro(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof to?t:to.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){t.push(["image",r.image.namePrimary]);continue}t.push(r.text);const c={};r.fontStack&&(c["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(c["font-scale"]=r.scale),r.textColor&&(c["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),t.push(c)}return t}}class Xs{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,r){return t?new Xs({namePrimary:t,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ba(a,t,r,c){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[a,t,r,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[a,t,r,c]:[a,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function To(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Ee||a instanceof Or||a instanceof to||a instanceof Xs)return!0;if(Array.isArray(a)){for(const t of a)if(!To(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!To(a[t]))return!1;return!0}return!1}function hs(a){if(a===null)return Zi;if(typeof a=="string")return nn;if(typeof a=="boolean")return Ei;if(typeof a=="number")return Kt;if(a instanceof Ee)return Ln;if(a instanceof Or)return cr;if(a instanceof to)return gr;if(a instanceof Xs)return _r;if(Array.isArray(a)){const t=a.length;let r;for(const c of a){const f=hs(c);if(r){if(r===f)continue;r=fn;break}r=f}return Rr(r||fn,t)}return Vi}function Is(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Ee||a instanceof to||a instanceof Xs?a.toString():JSON.stringify(a)}class Yo{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!To(t[1]))return r.error("invalid value");const c=t[1];let f=hs(c);const u=r.expectedType;return f.kind!=="array"||f.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(f=u),new Yo(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ee?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof to?this.value.serialize():this.value}}class Un{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const dl={string:nn,number:Kt,boolean:Ei,object:Vi};class fa{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let c,f=1;const u=t[0];if(u==="array"){let T,L;if(t.length>2){const D=t[1];if(typeof D!="string"||!(D in dl)||D==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);T=dl[D],f++}else T=fn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);L=t[2],f++}c=Rr(T,L)}else c=dl[u];const m=[];for(;f<t.length;f++){const T=r.parse(t[f],f,fn);if(!T)return null;m.push(T)}return new fa(c,m)}evaluate(t){for(let r=0;r<this.args.length;r++){const c=this.args[r].evaluate(t);if(!ws(this.type,hs(c)))return c;if(r===this.args.length-1)throw new Un(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${ur(hs(c))} but was expected to be of type ${ur(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){r.push(c.kind);const f=t.N;(typeof f=="number"||this.args.length>1)&&r.push(f)}}return r.concat(this.args.map(c=>c.serialize()))}}class Zl{constructor(t){this.type=gr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return r.error("First argument must be an image or text section.");const f=[];let u=!1;for(let m=1;m<=t.length-1;++m){const T=t[m];if(u&&typeof T=="object"&&!Array.isArray(T)){u=!1;let L=null;if(T["font-scale"]&&(L=r.parseObjectValue(T["font-scale"],m,"font-scale",Kt),!L))return null;let D=null;if(T["text-font"]&&(D=r.parseObjectValue(T["text-font"],m,"text-font",Rr(nn)),!D))return null;let b=null;if(T["text-color"]&&(b=r.parseObjectValue(T["text-color"],m,"text-color",Ln),!b))return null;const C=f[f.length-1];C.scale=L,C.font=D,C.textColor=b}else{const L=r.parse(t[m],m,fn);if(!L)return null;const D=L.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,f.push({content:L,scale:null,font:null,textColor:null})}}return new Zl(f)}evaluate(t){return new to(this.sections.map(r=>{const c=r.content.evaluate(t);return hs(c)===_r?new ro("",c,null,null,null):new ro(Is(c),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const c={};r.scale&&(c["font-scale"]=r.scale.serialize()),r.font&&(c["text-font"]=r.font.serialize()),r.textColor&&(c["text-color"]=r.textColor.serialize()),t.push(c)}return t}}class ma{constructor(t,r){this.type=_r,this.inputPrimary=t,this.inputSecondary=r}static parse(t,r){if(t.length<2)return r.error("Expected two or more arguments.");const c=r.parse(t[1],1,nn);if(!c)return r.error("No image name provided.");if(t.length===2)return new ma(c);const f=r.parse(t[2],1,nn);return f?new ma(c,f):r.error("Secondary image variant is not a string.")}evaluate(t){const r=Xs.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&t.availableImages&&(r.available=t.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function pl(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const ga={"to-boolean":Ei,"to-color":Ln,"to-number":Kt,"to-string":nn};class fl{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const c=t[0],f=[];let u=Zi;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const m=t[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);u=Rr(r.expectedType.itemType,m)}else{if(!(m>0&&To(t[1][0])))return null;u=Rr(hs(t[1][0]),m)}for(let T=0;T<m;T++){const L=t[1][T];let D;if(pl(L)==="array")D=r.parse(L,void 0,u.itemType);else{const b=pl(L);if(b!==u.itemType.kind)return r.error(`Expected ${u.itemType.kind} but found ${b}.`);D=r.registry.literal.parse(["literal",L===void 0?null:L],r)}if(!D)return null;f.push(D)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return r.error("Expected one argument.");u=ga[c];for(let m=1;m<t.length;m++){const T=r.parse(t[m],m,fn);if(!T)return null;f.push(T)}}return new fl(u,f)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let r,c;for(const f of this.args){if(r=f.evaluate(t),c=null,r instanceof Ee)return r;if(typeof r=="string"){const u=t.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(c=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ba(r[0],r[1],r[2],r[3]),!c))return new Ee(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Un(c||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const c of this.args){if(r=c.evaluate(t),r===null)return 0;const f=Number(r);if(!isNaN(f))return f}throw new Un(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?to.fromString(Is(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Xs.fromString(Is(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(r=>r.evaluate(t)):Is(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Zl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ma(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}const Nu=["Unknown","Point","LineString","Polygon"];class Ma{constructor(t,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Nu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:c,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*r-t[0])+this.featureDistanceData.bearing[1]*(f*r-t[1])}return 0}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=Ee.parse(t)),r}getConfig(t){return this.options?this.options.get(t):null}}class jo{constructor(t,r,c,f,u){this.name=t,this.type=r,this._evaluate=c,this.args=f,this._overloadIndex=u}evaluate(t){if(!this._evaluate){const r=jo.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const c=t[0],f=jo.definitions[c];if(!f)return r.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(f)?f[0]:f.type,m=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,T=[];let L=null,D=-1;for(const[b,C]of m){if(Array.isArray(b)&&b.length!==t.length-1)continue;T.push(b),D++,L=new $p(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const R=[];let A=!1;for(let I=1;I<t.length;I++){const k=t[I],W=Array.isArray(b)?b[I-1]:b.type,$=L.parse(k,1+R.length,W);if(!$){A=!0;break}R.push($)}if(!A)if(Array.isArray(b)&&b.length!==R.length)L.error(`Expected ${b.length} arguments, but found ${R.length} instead.`);else{for(let I=0;I<R.length;I++){const k=Array.isArray(b)?b[I]:b.type,W=R[I];L.concat(I+1).checkSubtype(k,W.type)}if(L.errors.length===0)return new jo(c,u,C,R,D)}}if(T.length===1)r.errors.push(...L.errors);else{const b=(T.length?T:m.map(([R])=>R)).map(Wo).join(" | "),C=[];for(let R=1;R<t.length;R++){const A=r.parse(t[R],1+C.length);if(!A)return null;C.push(ur(A.type))}r.error(`Expected arguments of type ${b}, but found (${C.join(", ")}) instead.`)}return null}static register(t,r){jo.definitions=r;for(const c in r)t[c]=jo}}function Wo(a){return Array.isArray(a)?`(${a.map(ur).join(", ")})`:`(${ur(a.type)}...)`}class Pr{constructor(t,r,c){this.type=cr,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return r.error("Collator options argument must be an object.");const f=c["case-sensitive"]===void 0?r.parse(!1,1,Ei):r.parseObjectValue(c["case-sensitive"],1,"case-sensitive",Ei);if(!f)return null;const u=c["diacritic-sensitive"]===void 0?r.parse(!1,1,Ei):r.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",Ei);if(!u)return null;let m=null;return c.locale&&(m=r.parseObjectValue(c.locale,1,"locale",nn),!m)?null:new Pr(f,u,m)}evaluate(t){return new Or(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Vp(a,t,r=0,c=a.length-1,f=yc){for(;c>r;){if(c-r>600){const L=c-r+1,D=t-r+1,b=Math.log(L),C=.5*Math.exp(2*b/3),R=.5*Math.sqrt(b*C*(L-C)/L)*(D-L/2<0?-1:1);Vp(a,t,Math.max(r,Math.floor(t-D*C/L+R)),Math.min(c,Math.floor(t+(L-D)*C/L+R)),f)}const u=a[t];let m=r,T=c;for(ml(a,r,t),f(a[c],u)>0&&ml(a,r,c);m<T;){for(ml(a,m,T),m++,T--;f(a[m],u)<0;)m++;for(;f(a[T],u)>0;)T--}f(a[r],u)===0?ml(a,r,T):(T++,ml(a,T,c)),T<=t&&(r=T+1),t<=T&&(c=T-1)}}function ml(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}function yc(a,t){return a<t?-1:a>t?1:0}function vc(a){let t=0;for(let r,c,f=0,u=a.length,m=u-1;f<u;m=f++)r=a[f],c=a[m],t+=(c.x-r.x)*(r.y+c.y);return t}function Ka(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function Sa(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Gp(a,t,r){const c=a[0]-t[0],f=a[1]-t[1],u=a[0]-r[0],m=a[1]-r[1];return c*m-u*f==0&&c*u<=0&&f*m<=0}function xc(a,t,r=!1){let c=!1;for(let T=0,L=t.length;T<L;T++){const D=t[T];for(let b=0,C=D.length,R=C-1;b<C;R=b++){const A=D[R],I=D[b];if(Gp(a,A,I))return r;(u=A)[1]>(f=a)[1]!=(m=I)[1]>f[1]&&f[0]<(m[0]-u[0])*(f[1]-u[1])/(m[1]-u[1])+u[0]&&(c=!c)}}var f,u,m;return c}function Ld(a,t,r,c){const f=c[0]-r[0],u=c[1]-r[1],m=(a[0]-r[0])*u-f*(a[1]-r[1]),T=(t[0]-r[0])*u-f*(t[1]-r[1]);return m>0&&T<0||m<0&&T>0}function tu(a,t,r,c){return(f=[c[0]-r[0],c[1]-r[1]])[0]*(u=[t[0]-a[0],t[1]-a[1]])[1]-f[1]*u[0]!=0&&!(!Ld(a,t,r,c)||!Ld(r,c,a,t));var f,u}const sa=8192;function Ir(a,t){const r=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(r*f*sa),Math.round(c*f*sa)]}function Xn(a,t){for(let r=0;r<t.length;r++)if(xc(a,t[r]))return!0;return!1}function Uu(a,t,r){for(const c of r)for(let f=0,u=c.length,m=u-1;f<u;m=f++)if(tu(a,t,c[m],c[f]))return!0;return!1}function hr(a,t){for(let r=0;r<a.length;++r)if(!xc(a[r],t))return!1;for(let r=0;r<a.length-1;++r)if(Uu(a[r],a[r+1],t))return!1;return!0}function kh(a,t){for(let r=0;r<t.length;r++)if(hr(a,t[r]))return!0;return!1}function bc(a,t,r){const c=[];for(let f=0;f<a.length;f++){const u=[];for(let m=0;m<a[f].length;m++){const T=Ir(a[f][m],r);Ka(t,T),u.push(T)}c.push(u)}return c}function qn(a,t,r){const c=[];for(let f=0;f<a.length;f++){const u=bc(a[f],t,r);c.push(u)}return c}function Vu(a,t,r,c){if(a[0]<r[0]||a[0]>r[2]){const f=.5*c;let u=a[0]-r[0]>f?-c:r[0]-a[0]>f?c:0;u===0&&(u=a[0]-r[2]>f?-c:r[2]-a[0]>f?c:0),a[0]+=u}Ka(t,a)}function Ja(a,t,r,c){const f=Math.pow(2,c.z)*sa,u=[c.x*sa,c.y*sa],m=[];if(!a)return m;for(const T of a)for(const L of T){const D=[L.x+u[0],L.y+u[1]];Vu(D,t,r,f),m.push(D)}return m}function wc(a,t,r,c){const f=Math.pow(2,c.z)*sa,u=[c.x*sa,c.y*sa],m=[];if(!a)return m;for(const L of a){const D=[];for(const b of L){const C=[b.x+u[0],b.y+u[1]];Ka(t,C),D.push(C)}m.push(D)}if(t[2]-t[0]<=f/2){(T=t)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const L of m)for(const D of L)Vu(D,t,r,f)}var T;return m}class go{constructor(t,r){this.type=Ei,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(To(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let f=0;f<c.features.length;++f){const u=c.features[f].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new go(c,c.features[f].geometry)}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new go(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new go(c,c)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,c){const f=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const T=bc(c.coordinates,u,m),L=Ja(r.geometry(),f,u,m);if(!Sa(f,u))return!1;for(const D of L)if(!xc(D,T))return!1}if(c.type==="MultiPolygon"){const T=qn(c.coordinates,u,m),L=Ja(r.geometry(),f,u,m);if(!Sa(f,u))return!1;for(const D of L)if(!Xn(D,T))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,c){const f=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const T=bc(c.coordinates,u,m),L=wc(r.geometry(),f,u,m);if(!Sa(f,u))return!1;for(const D of L)if(!hr(D,T))return!1}if(c.type==="MultiPolygon"){const T=qn(c.coordinates,u,m),L=wc(r.geometry(),f,u,m);if(!Sa(f,u))return!1;for(const D of L)if(!kh(D,T))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Tc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ao=1/298.257223563,Mc=ao*(2-ao),_o=Math.PI/180;class gl{static fromTile(t,r,c){const f=Math.PI*(1-2*(t+.5)/Math.pow(2,r)),u=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/_o;return new gl(u,c)}static get units(){return Tc}constructor(t,r){if(t===void 0)throw new Error("No latitude given.");if(r&&!Tc[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(Tc).join(", ")}`);const c=6378.137*_o*(r?Tc[r]:1),f=Math.cos(t*_o),u=1/(1-Mc*(1-f*f)),m=Math.sqrt(u);this.kx=c*m*f,this.ky=c*m*u*(1-Mc)}distance(t,r){const c=Ys(t[0]-r[0])*this.kx,f=(t[1]-r[1])*this.ky;return Math.sqrt(c*c+f*f)}bearing(t,r){const c=Ys(r[0]-t[0])*this.kx;return Math.atan2(c,(r[1]-t[1])*this.ky)/_o}destination(t,r,c){const f=c*_o;return this.offset(t,Math.sin(f)*r,Math.cos(f)*r)}offset(t,r,c){return[t[0]+r/this.kx,t[1]+c/this.ky]}lineDistance(t){let r=0;for(let c=0;c<t.length-1;c++)r+=this.distance(t[c],t[c+1]);return r}area(t){let r=0;for(let c=0;c<t.length;c++){const f=t[c];for(let u=0,m=f.length,T=m-1;u<m;T=u++)r+=Ys(f[u][0]-f[T][0])*(f[u][1]+f[T][1])*(c?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(t,r){let c=0;if(r<=0)return t[0];for(let f=0;f<t.length-1;f++){const u=t[f],m=t[f+1],T=this.distance(u,m);if(c+=T,c>r)return Ea(u,m,(r-(c-T))/T)}return t[t.length-1]}pointToSegmentDistance(t,r,c){let[f,u]=r,m=Ys(c[0]-f)*this.kx,T=(c[1]-u)*this.ky;if(m!==0||T!==0){const L=(Ys(t[0]-f)*this.kx*m+(t[1]-u)*this.ky*T)/(m*m+T*T);L>1?(f=c[0],u=c[1]):L>0&&(f+=m/this.kx*L,u+=T/this.ky*L)}return m=Ys(t[0]-f)*this.kx,T=(t[1]-u)*this.ky,Math.sqrt(m*m+T*T)}pointOnLine(t,r){let c=1/0,f=t[0][0],u=t[0][1],m=0,T=0;for(let L=0;L<t.length-1;L++){let D=t[L][0],b=t[L][1],C=Ys(t[L+1][0]-D)*this.kx,R=(t[L+1][1]-b)*this.ky,A=0;C===0&&R===0||(A=(Ys(r[0]-D)*this.kx*C+(r[1]-b)*this.ky*R)/(C*C+R*R),A>1?(D=t[L+1][0],b=t[L+1][1]):A>0&&(D+=C/this.kx*A,b+=R/this.ky*A)),C=Ys(r[0]-D)*this.kx,R=(r[1]-b)*this.ky;const I=C*C+R*R;I<c&&(c=I,f=D,u=b,m=L,T=A)}return{point:[f,u],index:m,t:Math.max(0,Math.min(1,T))}}lineSlice(t,r,c){let f=this.pointOnLine(c,t),u=this.pointOnLine(c,r);if(f.index>u.index||f.index===u.index&&f.t>u.t){const D=f;f=u,u=D}const m=[f.point],T=f.index+1,L=u.index;!iu(c[T],m[0])&&T<=L&&m.push(c[T]);for(let D=T+1;D<=L;D++)m.push(c[D]);return iu(c[L],u.point)||m.push(u.point),m}lineSliceAlong(t,r,c){let f=0;const u=[];for(let m=0;m<c.length-1;m++){const T=c[m],L=c[m+1],D=this.distance(T,L);if(f+=D,f>t&&u.length===0&&u.push(Ea(T,L,(t-(f-D))/D)),f>=r)return u.push(Ea(T,L,(r-(f-D))/D)),u;f>t&&u.push(L)}return u}bufferPoint(t,r){const c=r/this.ky,f=r/this.kx;return[t[0]-f,t[1]-c,t[0]+f,t[1]+c]}bufferBBox(t,r){const c=r/this.ky,f=r/this.kx;return[t[0]-f,t[1]-c,t[2]+f,t[3]+c]}insideBBox(t,r){return Ys(t[0]-r[0])>=0&&Ys(t[0]-r[2])<=0&&t[1]>=r[1]&&t[1]<=r[3]}}function iu(a,t){return a[0]===t[0]&&a[1]===t[1]}function Ea(a,t,r){const c=Ys(t[0]-a[0]);return[a[0]+c*r,a[1]+(t[1]-a[1])*r]}function Ys(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class Fh{constructor(t=[],r=(c,f)=>c<f?-1:c>f?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:c}=this,f=r[t];for(;t>0;){const u=t-1>>1,m=r[u];if(c(f,m)>=0)break;r[t]=m,t=u}r[t]=f}_down(t){const{data:r,compare:c}=this,f=this.length>>1,u=r[t];for(;t<f;){let m=1+(t<<1);const T=m+1;if(T<this.length&&c(r[T],r[m])<0&&(m=T),c(r[m],u)>=0)break;r[t]=r[m],t=m}r[t]=u}}var un=8192;function om(a,t){return t.dist-a.dist}const _a=100,Xl=50;function nu(a){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==a.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==a[r])return!1;return!0}function Sc(a){return a[1]-a[0]+1}function kl(a,t){const r=a[1]>=a[0]&&a[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function Hp(a,t){if(a[0]>a[1])return[null,null];const r=Sc(a);if(t){if(r===2)return[a,null];const c=Math.floor(r/2);return[[a[0],a[0]+c],[a[0]+c,a[1]]]}{if(r===1)return[a,null];const c=Math.floor(r/2)-1;return[[a[0],a[0]+c],[a[0]+c+1,a[1]]]}}function No(a,t){const r=[1/0,1/0,-1/0,-1/0];if(!kl(t,a.length))return r;for(let c=t[0];c<=t[1];++c)Ka(r,a[c]);return r}function os(a){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<a.length;++r)for(let c=0;c<a[r].length;++c)Ka(t,a[r][c]);return t}function Qn(a,t,r){if(nu(a)||nu(t))return NaN;let c=0,f=0;return a[2]<t[0]&&(c=t[0]-a[2]),a[0]>t[2]&&(c=a[0]-t[2]),a[1]>t[3]&&(f=a[1]-t[3]),a[3]<t[1]&&(f=t[1]-a[3]),r.distance([0,0],[c,f])}function Qa(a){return 360*a-180}function am(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Na(a,t){const r=Math.pow(2,t.z),c=(a.y/un+t.y)/r;return[Qa((a.x/un+t.x)/r),am(c)]}function lm(a,t){const r=[];for(let c=0;c<a.length;++c)r.push(Na(a[c],t));return r}function jp(a,t,r){const c=r.pointOnLine(t,a).point;return r.distance(a,c)}function Wp(a,t,r,c,f){const u=r.slice(c[0],c[1]+1);let m=1/0;for(let T=t[0];T<=t[1];++T)if((m=Math.min(m,jp(a[T],u,f)))===0)return 0;return m}function Id(a,t,r,c,f){const u=Math.min(f.pointToSegmentDistance(a,r,c),f.pointToSegmentDistance(t,r,c)),m=Math.min(f.pointToSegmentDistance(r,a,t),f.pointToSegmentDistance(c,a,t));return Math.min(u,m)}function Gu(a,t,r,c,f){if(!kl(t,a.length)||!kl(c,r.length))return NaN;let u=1/0;for(let m=t[0];m<t[1];++m)for(let T=c[0];T<c[1];++T){if(tu(a[m],a[m+1],r[T],r[T+1]))return 0;u=Math.min(u,Id(a[m],a[m+1],r[T],r[T+1],f))}return u}function ru(a,t,r,c,f){if(!kl(t,a.length)||!kl(c,r.length))return NaN;let u=1/0;for(let m=t[0];m<=t[1];++m)for(let T=c[0];T<=c[1];++T)if((u=Math.min(u,f.distance(a[m],r[T])))===0)return u;return u}function _l(a,t,r){if(xc(a,t,!0))return 0;let c=1/0;for(const f of t){const u=f.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[u-1]&&(c=Math.min(c,r.pointToSegmentDistance(a,f[u-1],f[0])))===0||(c=Math.min(c,jp(a,f,r)))===0)return c}return c}function qp(a,t,r,c){if(!kl(t,a.length))return NaN;for(let u=t[0];u<=t[1];++u)if(xc(a[u],r,!0))return 0;let f=1/0;for(let u=t[0];u<t[1];++u)for(const m of r)for(let T=0,L=m.length,D=L-1;T<L;D=T++){if(tu(a[u],a[u+1],m[D],m[T]))return 0;f=Math.min(f,Id(a[u],a[u+1],m[D],m[T],c))}return f}function Rd(a,t){for(const r of a)for(let c=0;c<=r.length-1;++c)if(xc(r[c],t,!0))return!0;return!1}function Bh(a,t,r,c=1/0){const f=os(a),u=os(t);if(c!==1/0&&Qn(f,u,r)>=c)return c;if(Sa(f,u)){if(Rd(a,t))return 0}else if(Rd(t,a))return 0;let m=c;for(const T of a)for(let L=0,D=T.length,b=D-1;L<D;b=L++)for(const C of t)for(let R=0,A=C.length,I=A-1;R<A;I=R++){if(tu(T[b],T[L],C[I],C[R]))return 0;m=Math.min(m,Id(T[b],T[L],C[I],C[R],r))}return m}function Aa(a,t,r,c,f,u,m){if(u===null||m===null)return;const T=Qn(No(c,u),No(f,m),r);T<t&&a.push({dist:T,range1:u,range2:m})}function Hu(a,t,r,c,f=1/0){let u=Math.min(c.distance(a[0],r[0][0]),f);if(u===0)return u;const m=new Fh([{dist:0,range1:[0,a.length-1],range2:[0,0]}],om),T=t?Xl:_a,L=os(r);for(;m.length;){const D=m.pop();if(D.dist>=u)continue;const b=D.range1;if(Sc(b)<=T){if(!kl(b,a.length))return NaN;if(t){const C=qp(a,b,r,c);if((u=Math.min(u,C))===0)return u}else for(let C=b[0];C<=b[1];++C){const R=_l(a[C],r,c);if((u=Math.min(u,R))===0)return u}}else{const C=Hp(b,t);if(C[0]!==null){const R=Qn(No(a,C[0]),L,c);R<u&&m.push({dist:R,range1:C[0],range2:[0,0]})}if(C[1]!==null){const R=Qn(No(a,C[1]),L,c);R<u&&m.push({dist:R,range1:C[1],range2:[0,0]})}}}return u}function Yl(a,t,r,c,f,u=1/0){let m=Math.min(u,f.distance(a[0],r[0]));if(m===0)return m;const T=new Fh([{dist:0,range1:[0,a.length-1],range2:[0,r.length-1]}],om),L=t?Xl:_a,D=c?Xl:_a;for(;T.length;){const b=T.pop();if(b.dist>=m)continue;const C=b.range1,R=b.range2;if(Sc(C)<=L&&Sc(R)<=D){if(!kl(C,a.length)||!kl(R,r.length))return NaN;if(t&&c?m=Math.min(m,Gu(a,C,r,R,f)):t||c?t&&!c?m=Math.min(m,Wp(r,R,a,C,f)):!t&&c&&(m=Math.min(m,Wp(a,C,r,R,f))):m=Math.min(m,ru(a,C,r,R,f)),m===0)return m}else{const A=Hp(C,t),I=Hp(R,c);Aa(T,m,f,a,r,A[0],I[0]),Aa(T,m,f,a,r,A[0],I[1]),Aa(T,m,f,a,r,A[1],I[0]),Aa(T,m,f,a,r,A[1],I[1])}}return m}function su(a,t,r,c,f=1/0){let u=f;const m=No(a,[0,a.length-1]);for(const T of r)if(!(u!==1/0&&Qn(m,No(T,[0,T.length-1]),c)>=u)&&(u=Math.min(u,Yl(a,t,T,!0,c,u)),u===0))return u;return u}function Ec(a,t,r,c,f=1/0){let u=f;const m=No(a,[0,a.length-1]);for(const T of r){if(u!==1/0&&Qn(m,os(T),c)>=u)continue;const L=Hu(a,t,T,c,u);if(isNaN(L))return L;if((u=Math.min(u,L))===0)return u}return u}function Nh(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class Fl{constructor(t,r){this.type=Kt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(To(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let f=0;f<c.features.length;++f)if(Nh(c.features[f].geometry.type))return new Fl(c,c.features[f].geometry)}else if(c.type==="Feature"){if(Nh(c.geometry.type))return new Fl(c,c.geometry)}else if(Nh(c.type))return new Fl(c,c)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const r=t.geometry(),c=t.canonicalID();if(r!=null&&c!=null){if(t.geometryType()==="Point")return function(f,u,m){const T=[];for(const D of f)for(const b of D)T.push(Na(b,u));const L=new gl(T[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Yl(T,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",L):m.type==="MultiLineString"?su(T,!1,m.coordinates,L):m.type==="Polygon"||m.type==="MultiPolygon"?Ec(T,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,L):null}(r,c,this.geometries);if(t.geometryType()==="LineString")return function(f,u,m){const T=[];for(const D of f){const b=[];for(const C of D)b.push(Na(C,u));T.push(b)}const L=new gl(T[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return su(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",T,L);if(m.type==="MultiLineString"){let D=1/0;for(let b=0;b<m.coordinates.length;b++){const C=su(m.coordinates[b],!0,T,L,D);if(isNaN(C))return C;if((D=Math.min(D,C))===0)return D}return D}if(m.type==="Polygon"||m.type==="MultiPolygon"){let D=1/0;for(let b=0;b<T.length;b++){const C=Ec(T[b],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,L,D);if(isNaN(C))return C;if((D=Math.min(D,C))===0)return D}return D}return null}(r,c,this.geometries);if(t.geometryType()==="Polygon")return function(f,u,m){const T=[];for(const D of function(b,C){const R=b.length;if(R<=1)return[b];const A=[];let I,k;for(let W=0;W<R;W++){const $=vc(b[W]);$!==0&&(b[W].area=Math.abs($),k===void 0&&(k=$<0),k===$<0?(I&&A.push(I),I=[b[W]]):I.push(b[W]))}return I&&A.push(I),A}(f)){const b=[];for(let C=0;C<D.length;++C)b.push(lm(D[C],u));T.push(b)}const L=new gl(T[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Ec(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",T,L);if(m.type==="MultiLineString"){let D=1/0;for(let b=0;b<m.coordinates.length;b++){const C=Ec(m.coordinates[b],!0,T,L,D);if(isNaN(C))return C;if((D=Math.min(D,C))===0)return D}return D}return m.type==="Polygon"||m.type==="MultiPolygon"?function(D,b,C){let R=1/0;for(const A of D)for(const I of b){const k=Bh(A,I,C,R);if(isNaN(k))return k;if((R=Math.min(R,k))===0)return R}return R}(m.type==="Polygon"?[m.coordinates]:m.coordinates,T,L):null}(r,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ca(a,t){switch(a){case"string":return Is(t);case"number":return+t;case"boolean":return!!t;case"color":return Ee.parse(t);case"formatted":return to.fromString(Is(t));case"resolvedImage":return Xs.fromString(Is(t))}return t}function zr(a,t,r,c){return c!==void 0&&(a=c*Math.round(a/c)),t!==void 0&&a<t&&(a=t),r!==void 0&&a>r&&(a=r),a}class ou{constructor(t,r,c){this.type=t,this.key=r,this.scope=c}static parse(t,r){let c=r.expectedType;if(c==null&&(c=fn),t.length<2||t.length>3)return r.error("Invalid number of arguments for 'config' expression.");const f=r.parse(t[1],1);if(!(f instanceof Yo))return r.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const u=r.parse(t[2],2);return u instanceof Yo?new ou(c,Is(f.value),Is(u.value)):r.error("Scope of 'config' expression must be a string literal.")}return new ou(c,Is(f.value))}evaluate(t){const r=[this.key,this.scope,t.scope].filter(Boolean).join(""),c=t.getConfig(r);if(!c)return null;const{type:f,value:u,values:m,minValue:T,maxValue:L,stepValue:D}=c,b=c.default.evaluate(t);let C=b;if(u){const R=t.scope;t.scope=(R||"").split("").slice(1).join(""),C=u.evaluate(t),t.scope=R}return f&&(C=Ca(f,C)),C===void 0||T===void 0&&L===void 0&&D===void 0||(typeof C=="number"?C=zr(C,T,L,D):Array.isArray(C)&&(C=C.map(R=>typeof R=="number"?zr(R,T,L,D):R))),u!==void 0&&C!==void 0&&m&&!m.includes(C)&&(C=b,f&&(C=Ca(f,C))),(f&&f!==this.type||C!==void 0&&hs(C)!==this.type)&&(C=Ca(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function ju(a){if(a instanceof jo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof go||a instanceof Fl)return!1;let t=!0;return a.eachChild(r=>{t&&!ju(r)&&(t=!1)}),t}function Pd(a){if(a instanceof jo&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(r=>{t&&!Pd(r)&&(t=!1)}),t}function Uh(a){if(a instanceof ou)return new Set([a.key]);let t=new Set;return a.eachChild(r=>{t=new Set([...t,...Uh(r)])}),t}function au(a,t){if(a instanceof jo&&t.indexOf(a.name)>=0)return!1;let r=!0;return a.eachChild(c=>{r&&!au(c,t)&&(r=!1)}),r}class ys{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const c=t[1];return r.scope.has(c)?new ys(c,r.scope.get(c)):r.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Dd{constructor(t,r=[],c,f=new Dn,u=[],m,T){this.registry=t,this.path=r,this.key=r.map(L=>typeof L=="string"?`['${L}']`:`[${L}]`).join(""),this.scope=f,this.errors=u,this.expectedType=c,this._scope=m,this.options=T}parse(t,r,c,f,u={}){return r||c?this.concat(r,null,c,f)._parse(t,u):this._parse(t,u)}parseObjectValue(t,r,c,f,u,m={}){return this.concat(r,c,f,u)._parse(t,m)}_parse(t,r){function c(f,u,m){return m==="assert"?new fa(u,[f]):m==="coerce"?new fl(u,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(f){let u=f.parse(t,this);if(!u)return null;if(this.expectedType){const m=this.expectedType,T=u.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||T.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(m,T))return null}else u=c(u,m,r.typeAnnotation||"coerce");else u=c(u,m,r.typeAnnotation||"assert")}if(!(u instanceof Yo)&&u.type.kind!=="resolvedImage"&&Vh(u)){const m=new Ma(this._scope,this.options);try{u=new Yo(u.type,u.evaluate(m))}catch(T){return this.error(T.message),null}}return u}return fl.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,c,f){let u=typeof t=="number"?this.path.concat(t):this.path;u=typeof r=="string"?u.concat(r):u;const m=f?this.scope.concat(f):this.scope;return new Dd(this.registry,u,c||null,m,this.errors,this._scope,this.options)}error(t,...r){const c=`${this.key}${r.map(f=>`[${f}]`).join("")}`;this.errors.push(new hn(c,t))}checkSubtype(t,r){const c=ws(t,r);return c&&this.error(c),c}}var $p=Dd;function Vh(a){if(a instanceof ys)return Vh(a.boundExpression);if(a instanceof jo&&a.name==="error"||a instanceof Pr||a instanceof go||a instanceof Fl||a instanceof ou)return!1;const t=a instanceof fl||a instanceof fa;let r=!0;return a.eachChild(c=>{r=t?r&&Vh(c):r&&c instanceof Yo}),!!r&&ju(a)&&au(a,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Wu(a,t){const r=a.length-1;let c,f,u=0,m=r,T=0;for(;u<=m;)if(T=Math.floor((u+m)/2),c=a[T],f=a[T+1],c<=t){if(T===r||t<f)return T;u=T+1}else{if(!(c>t))throw new Un("Input is not a number.");m=T-1}return 0}class Gh{constructor(t,r,c){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[f,u]of c)this.labels.push(f),this.outputs.push(u)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const c=r.parse(t[1],1,Kt);if(!c)return null;const f=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let m=1;m<t.length;m+=2){const T=m===1?-1/0:t[m],L=t[m+1],D=m,b=m+1;if(typeof T!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=T)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const C=r.parse(L,b,u);if(!C)return null;u=u||C.type,f.push([T,C])}return new Gh(u,c,f)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=r[0])return c[0].evaluate(t);const u=r.length;return f>=r[u-1]?c[u-1].evaluate(t):c[Wu(r,f)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}const cm=.95047,um=1.08883,hm=4/29,qu=6/29,dm=3*qu*qu,Rg=qu*qu*qu,Pg=Math.PI/180,Dg=180/Math.PI;function Hh(a){return a>Rg?Math.pow(a,1/3):a/dm+hm}function jh(a){return a>qu?a*a*a:dm*(a-hm)}function Od(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Zp(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function pm(a){const t=Zp(a.r),r=Zp(a.g),c=Zp(a.b),f=Hh((.4124564*t+.3575761*r+.1804375*c)/cm),u=Hh((.2126729*t+.7151522*r+.072175*c)/1);return{l:116*u-16,a:500*(f-u),b:200*(u-Hh((.0193339*t+.119192*r+.9503041*c)/um)),alpha:a.a}}function Xp(a){let t=(a.l+16)/116,r=isNaN(a.a)?t:t+a.a/500,c=isNaN(a.b)?t:t-a.b/200;return t=1*jh(t),r=cm*jh(r),c=um*jh(c),new Ee(Od(3.2404542*r-1.5371385*t-.4985314*c),Od(-.969266*r+1.8760108*t+.041556*c),Od(.0556434*r-.2040259*t+1.0572252*c),a.alpha)}function fm(a,t,r){const c=t-a;return a+r*(c>180||c<-180?c-360*Math.round(c/360):c)}const $u={forward:pm,reverse:Xp,interpolate:function(a,t,r){return{l:Pe(a.l,t.l,r),a:Pe(a.a,t.a,r),b:Pe(a.b,t.b,r),alpha:Pe(a.alpha,t.alpha,r)}}},Zu={forward:function(a){const{l:t,a:r,b:c}=pm(a),f=Math.atan2(c,r)*Dg;return{h:f<0?f+360:f,c:Math.sqrt(r*r+c*c),l:t,alpha:a.a}},reverse:function(a){const t=a.h*Pg,r=a.c;return Xp({l:a.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:a.alpha})},interpolate:function(a,t,r){return{h:fm(a.h,t.h,r),c:Pe(a.c,t.c,r),l:Pe(a.l,t.l,r),alpha:Pe(a.alpha,t.alpha,r)}}};var Yp=Object.freeze({__proto__:null,hcl:Zu,lab:$u});class La{constructor(t,r,c,f,u){this.type=t,this.operator=r,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[m,T]of u)this.labels.push(m),this.outputs.push(T)}static interpolationFactor(t,r,c,f){let u=0;if(t.name==="exponential")u=Ac(r,t.base,c,f);else if(t.name==="linear")u=Ac(r,1,c,f);else if(t.name==="cubic-bezier"){const m=t.controlPoints;u=new pr(m[0],m[1],m[2],m[3]).solve(Ac(r,1,c,f))}return u}static parse(t,r){let[c,f,u,...m]=t;if(!Array.isArray(f)||f.length===0)return r.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const D=f[1];if(typeof D!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if(f[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const D=f.slice(1);if(D.length!==4||D.some(b=>typeof b!="number"||b<0||b>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,Kt),!u)return null;const T=[];let L=null;c==="interpolate-hcl"||c==="interpolate-lab"?L=Ln:r.expectedType&&r.expectedType.kind!=="value"&&(L=r.expectedType);for(let D=0;D<m.length;D+=2){const b=m[D],C=m[D+1],R=D+3,A=D+4;if(typeof b!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(T.length&&T[T.length-1][0]>=b)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const I=r.parse(C,A,L);if(!I)return null;L=L||I.type,T.push([b,I])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new La(L,c,f,u,T):r.error(`Type ${ur(L)} is not interpolatable.`)}evaluate(t){const r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(t);const f=this.input.evaluate(t);if(f<=r[0])return c[0].evaluate(t);const u=r.length;if(f>=r[u-1])return c[u-1].evaluate(t);const m=Wu(r,f),T=La.interpolationFactor(this.interpolation,f,r[m],r[m+1]),L=c[m].evaluate(t),D=c[m+1].evaluate(t);return this.operator==="interpolate"?Mi[this.type.kind.toLowerCase()](L,D,T):this.operator==="interpolate-hcl"?Zu.reverse(Zu.interpolate(Zu.forward(L),Zu.forward(D),T)):$u.reverse($u.interpolate($u.forward(L),$u.forward(D),T))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)r.push(this.labels[c],this.outputs[c].serialize());return r}}function Ac(a,t,r,c){const f=c-r,u=a-r;return f===0?0:t===1?u/f:(Math.pow(t,u)-1)/(Math.pow(t,f)-1)}class qo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let c=null;const f=r.expectedType;f&&f.kind!=="value"&&(c=f);const u=[];for(const T of t.slice(1)){const L=r.parse(T,1+u.length,c,void 0,{typeAnnotation:"omit"});if(!L)return null;c=c||L.type,u.push(L)}const m=f&&u.some(T=>ws(f,T.type));return new qo(m?fn:c,u)}evaluate(t){let r,c=null,f=0;for(const u of this.args){if(f++,c=u.evaluate(t),c&&c instanceof Xs&&!c.available&&(r||(r=c),c=null,f===this.args.length))return r;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class Uo{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let u=1;u<t.length-1;u+=2){const m=t[u];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,u);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const T=r.parse(t[u+1],u+1);if(!T)return null;c.push([m,T])}const f=r.parse(t[t.length-1],t.length-1,r.expectedType,c);return f?new Uo(c,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,c]of this.bindings)t.push(r,c.serialize());return t.push(this.result.serialize()),t}}class zd{constructor(t,r,c){this.type=t,this.index=r,this.input=c}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,Kt),f=r.parse(t[2],2,Rr(r.expectedType||fn));return c&&f?new zd(f.type.itemType,c,f):null}evaluate(t){const r=this.index.evaluate(t),c=this.input.evaluate(t);if(r<0)throw new Un(`Array index out of bounds: ${r} < 0.`);if(r>c.length-1)throw new Un(`Array index out of bounds: ${r} > ${c.length-1}.`);if(r===Math.floor(r))return c[r];const f=Math.floor(r),u=Math.ceil(r),m=c[f],T=c[u];if(typeof m!="number"||typeof T!="number")throw new Un(`Cannot interpolate between non-number values at index ${r}.`);const L=r-f;return m*(1-L)+T*L}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Kp{constructor(t,r){this.type=Ei,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,fn),f=r.parse(t[2],2,fn);return c&&f?wr(c.type,[Ei,nn,Kt,Zi,fn])?new Kp(c,f):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(c.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!Vs(r,["boolean","string","number","null"]))throw new Un(`Expected first argument to be of type boolean, string, number or null, but found ${ur(hs(r))} instead.`);if(!Vs(c,["string","array"]))throw new Un(`Expected second argument to be of type array or string, but found ${ur(hs(c))} instead.`);return c.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class kd{constructor(t,r,c){this.type=Kt,this.needle=t,this.haystack=r,this.fromIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,fn),f=r.parse(t[2],2,fn);if(!c||!f)return null;if(!wr(c.type,[Ei,nn,Kt,Zi,fn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(c.type)} instead`);if(t.length===4){const u=r.parse(t[3],3,Kt);return u?new kd(c,f,u):null}return new kd(c,f)}evaluate(t){const r=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Vs(r,["boolean","string","number","null"]))throw new Un(`Expected first argument to be of type boolean, string, number or null, but found ${ur(hs(r))} instead.`);if(!Vs(c,["string","array"]))throw new Un(`Expected second argument to be of type array or string, but found ${ur(hs(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(t);return c.indexOf(r,f)}return c.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Jp{constructor(t,r,c,f,u,m){this.inputType=t,this.type=r,this.input=c,this.cases=f,this.outputs=u,this.otherwise=m}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let c,f;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);const u={},m=[];for(let D=2;D<t.length-1;D+=2){let b=t[D];const C=t[D+1];Array.isArray(b)||(b=[b]);const R=r.concat(D);if(b.length===0)return R.error("Expected at least one branch label.");for(const I of b){if(typeof I!="number"&&typeof I!="string")return R.error("Branch labels must be numbers or strings.");if(typeof I=="number"&&Math.abs(I)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof I=="number"&&Math.floor(I)!==I)return R.error("Numeric branch labels must be integer values.");if(c){if(R.checkSubtype(c,hs(I)))return null}else c=hs(I);if(u[String(I)]!==void 0)return R.error("Branch labels must be unique.");u[String(I)]=m.length}const A=r.parse(C,D,f);if(!A)return null;f=f||A.type,m.push(A)}const T=r.parse(t[1],1,fn);if(!T)return null;const L=r.parse(t[t.length-1],t.length-1,f);return L?T.type.kind!=="value"&&r.concat(1).checkSubtype(c,T.type)?null:new Jp(c,f,T,u,m,L):null}evaluate(t){const r=this.input.evaluate(t);return(hs(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),c=[],f={};for(const m of r){const T=f[this.cases[m]];T===void 0?(f[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[T][1].push(m)}const u=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,T]of c)t.push(T.length===1?u(T[0]):T.map(u)),t.push(this.outputs[m].serialize());return t.push(this.otherwise.serialize()),t}}class Wh{constructor(t,r,c){this.type=t,this.branches=r,this.otherwise=c}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const f=[];for(let m=1;m<t.length-1;m+=2){const T=r.parse(t[m],m,Ei);if(!T)return null;const L=r.parse(t[m+1],m+1,c);if(!L)return null;f.push([T,L]),c=c||L.type}const u=r.parse(t[t.length-1],t.length-1,c);return u?new Wh(c,f,u):null}evaluate(t){for(const[r,c]of this.branches)if(r.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,c]of this.branches)t(r),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class Fd{constructor(t,r,c,f){this.type=t,this.input=r,this.beginIndex=c,this.endIndex=f}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=r.parse(t[1],1,fn),f=r.parse(t[2],2,Kt);if(!c||!f)return null;if(!wr(c.type,[Rr(fn),nn,fn]))return r.error(`Expected first argument to be of type array or string, but found ${ur(c.type)} instead`);if(t.length===4){const u=r.parse(t[3],3,Kt);return u?new Fd(c.type,c,f,u):null}return new Fd(c.type,c,f)}evaluate(t){const r=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!Vs(r,["string","array"]))throw new Un(`Expected first argument to be of type array or string, but found ${ur(hs(r))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(t);return r.slice(c,f)}return r.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Qp(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function mm(a,t,r,c){return c.compare(t,r)===0}function Xu(a,t,r){const c=a!=="=="&&a!=="!=";return class I2{constructor(u,m,T){this.type=Ei,this.lhs=u,this.rhs=m,this.collator=T,this.hasUntypedArgument=u.type.kind==="value"||m.type.kind==="value"}static parse(u,m){if(u.length!==3&&u.length!==4)return m.error("Expected two or three arguments.");const T=u[0];let L=m.parse(u[1],1,fn);if(!L)return null;if(!Qp(T,L.type))return m.concat(1).error(`"${T}" comparisons are not supported for type '${ur(L.type)}'.`);let D=m.parse(u[2],2,fn);if(!D)return null;if(!Qp(T,D.type))return m.concat(2).error(`"${T}" comparisons are not supported for type '${ur(D.type)}'.`);if(L.type.kind!==D.type.kind&&L.type.kind!=="value"&&D.type.kind!=="value")return m.error(`Cannot compare types '${ur(L.type)}' and '${ur(D.type)}'.`);c&&(L.type.kind==="value"&&D.type.kind!=="value"?L=new fa(D.type,[L]):L.type.kind!=="value"&&D.type.kind==="value"&&(D=new fa(L.type,[D])));let b=null;if(u.length===4){if(L.type.kind!=="string"&&D.type.kind!=="string"&&L.type.kind!=="value"&&D.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(b=m.parse(u[3],3,cr),!b)return null}return new I2(L,D,b)}evaluate(u){const m=this.lhs.evaluate(u),T=this.rhs.evaluate(u);if(c&&this.hasUntypedArgument){const L=hs(m),D=hs(T);if(L.kind!==D.kind||L.kind!=="string"&&L.kind!=="number")throw new Un(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${L.kind}, ${D.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const L=hs(m),D=hs(T);if(L.kind!=="string"||D.kind!=="string")return t(u,m,T)}return this.collator?r(u,m,T,this.collator.evaluate(u)):t(u,m,T)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[a];return this.eachChild(m=>{u.push(m.serialize())}),u}}}const Og=Xu("==",function(a,t,r){return t===r},mm),gm=Xu("!=",function(a,t,r){return t!==r},function(a,t,r,c){return!mm(0,t,r,c)}),_m=Xu("<",function(a,t,r){return t<r},function(a,t,r,c){return c.compare(t,r)<0}),Yu=Xu(">",function(a,t,r){return t>r},function(a,t,r,c){return c.compare(t,r)>0}),ym=Xu("<=",function(a,t,r){return t<=r},function(a,t,r,c){return c.compare(t,r)<=0}),vm=Xu(">=",function(a,t,r){return t>=r},function(a,t,r,c){return c.compare(t,r)>=0});class ef{constructor(t,r,c,f,u,m){this.type=nn,this.number=t,this.locale=r,this.currency=c,this.unit=f,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const c=r.parse(t[1],1,Kt);if(!c)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return r.error("NumberFormat options argument must be an object.");let u=null;if(f.locale&&(u=r.parseObjectValue(f.locale,2,"locale",nn),!u))return null;let m=null;if(f.currency&&(m=r.parseObjectValue(f.currency,2,"currency",nn),!m))return null;let T=null;if(f.unit&&(T=r.parseObjectValue(f.unit,2,"unit",nn),!T))return null;let L=null;if(f["min-fraction-digits"]&&(L=r.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",Kt),!L))return null;let D=null;return f["max-fraction-digits"]&&(D=r.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",Kt),!D)?null:new ef(c,u,m,T,L,D)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class qh{constructor(t){this.type=Kt,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=r.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ur(c.type)} instead.`):new qh(c):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Un(`Expected value to be of type string or array, but found ${ur(hs(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}function Bd(a){return function(){a=1831565813+(a|=0)|0;let t=Math.imul(a^a>>>15,1|a);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Ku={"==":Og,"!=":gm,">":Yu,"<":_m,">=":vm,"<=":ym,array:fa,at:zd,boolean:fa,case:Wh,coalesce:qo,collator:Pr,format:Zl,image:ma,in:Kp,"index-of":kd,interpolate:La,"interpolate-hcl":La,"interpolate-lab":La,length:qh,let:Uo,literal:Yo,match:Jp,number:fa,"number-format":ef,object:fa,slice:Fd,step:Gh,string:fa,"to-boolean":fl,"to-color":fl,"to-number":fl,"to-string":fl,var:ys,within:go,distance:Fl,config:ou};function xm(a,[t,r,c,f]){t=t.evaluate(a),r=r.evaluate(a),c=c.evaluate(a);const u=f?f.evaluate(a):1,m=Ba(t,r,c,u);if(m)throw new Un(m);return new Ee(t/255*u,r/255*u,c/255*u,u)}function tf(a,[t,r,c,f]){t=t.evaluate(a),r=r.evaluate(a),c=c.evaluate(a);const u=f?f.evaluate(a):1,m=function(D,b,C,R){return typeof D=="number"&&D>=0&&D<=360?typeof b=="number"&&b>=0&&b<=100&&typeof C=="number"&&C>=0&&C<=100?R===void 0||typeof R=="number"&&R>=0&&R<=1?null:`Invalid hsla value [${[D,b,C,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof R=="number"?[D,b,C,R]:[D,b,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof R=="number"?[D,b,C,R]:[D,b,C]).join(", ")}]: 'h' must be between 0 and 360.`}(t,r,c,u);if(m)throw new Un(m);const T=`hsla(${t}, ${r}%, ${c}%, ${u})`,L=Ee.parse(T);if(!L)throw new Un(`Failed to parse HSLA color: ${T}`);return L}function nf(a,t){return a in t}function rf(a,t){const r=t[a];return r===void 0?null:r}function lu(a){return{type:a}}function bm(a){return{result:"success",value:a}}function Kl(a){return{result:"error",value:a}}function Nd(a,t){return!!a&&!!a.parameters&&a.parameters.indexOf(t)>-1}function cu(a){return a["property-type"]==="data-driven"}function wm(a){return Nd(a.expression,"measure-light")}function sf(a){return Nd(a.expression,"zoom")}function of(a){return!!a.expression&&a.expression.interpolated}function af(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Tm(a){return a}function lf(a,t){const r=t.type==="color",c=a.stops&&typeof a.stops[0][0]=="object",f=c||!(c||a.property!==void 0),u=a.type||(of(t)?"exponential":"interval");if(r&&((a=Wi({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],Ee.parse(D[1])])),a.default=Ee.parse(a.default?a.default:t.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Yp[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let m,T,L;if(u==="exponential")m=cf;else if(u==="interval")m=kg;else if(u==="categorical"){m=zg,T=Object.create(null);for(const D of a.stops)T[D[0]]=D[1];L=typeof a.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);m=Mm}if(c){const D={},b=[];for(let A=0;A<a.stops.length;A++){const I=a.stops[A],k=I[0].zoom;D[k]===void 0&&(D[k]={zoom:k,type:a.type,property:a.property,default:a.default,stops:[]},b.push(k)),D[k].stops.push([I[0].value,I[1]])}const C=[];for(const A of b)C.push([D[A].zoom,lf(D[A],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:La.interpolationFactor.bind(void 0,R),zoomStops:C.map(A=>A[0]),evaluate:({zoom:A},I)=>cf({stops:C,base:a.base},t,A).evaluate(A,I)}}if(f){const D=u==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:La.interpolationFactor.bind(void 0,D),zoomStops:a.stops.map(b=>b[0]),evaluate:({zoom:b})=>m(a,t,b,T,L)}}return{kind:"source",evaluate(D,b){const C=b&&b.properties?b.properties[a.property]:void 0;return C===void 0?$h(a.default,t.default):m(a,t,C,T,L)}}}function $h(a,t,r){return a!==void 0?a:t!==void 0?t:r!==void 0?r:void 0}function zg(a,t,r,c,f){return $h(typeof r===f?c[r]:void 0,a.default,t.default)}function kg(a,t,r){if(pl(r)!=="number")return $h(a.default,t.default);const c=a.stops.length;if(c===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[c-1][0])return a.stops[c-1][1];const f=Wu(a.stops.map(u=>u[0]),r);return a.stops[f][1]}function cf(a,t,r){const c=a.base!==void 0?a.base:1;if(pl(r)!=="number")return $h(a.default,t.default);const f=a.stops.length;if(f===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[f-1][0])return a.stops[f-1][1];const u=Wu(a.stops.map(b=>b[0]),r),m=function(b,C,R,A){const I=A-R,k=b-R;return I===0?0:C===1?k/I:(Math.pow(C,k)-1)/(Math.pow(C,I)-1)}(r,c,a.stops[u][0],a.stops[u+1][0]),T=a.stops[u][1],L=a.stops[u+1][1];let D=Mi[t.type]||Tm;if(a.colorSpace&&a.colorSpace!=="rgb"){const b=Yp[a.colorSpace];D=(C,R)=>b.reverse(b.interpolate(b.forward(C),b.forward(R),m))}return typeof T.evaluate=="function"?{evaluate(...b){const C=T.evaluate.apply(void 0,b),R=L.evaluate.apply(void 0,b);if(C!==void 0&&R!==void 0)return D(C,R,m)}}:D(T,L,m)}function Mm(a,t,r){return t.type==="color"?r=Ee.parse(r):t.type==="formatted"?r=to.fromString(r.toString()):t.type==="resolvedImage"?r=Xs.fromString(r.toString()):pl(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),$h(r,a.default,t.default)}jo.register(Ku,{error:[{kind:"error"},[nn],(a,[t])=>{throw new Un(t.evaluate(a))}],typeof:[nn,[fn],(a,[t])=>ur(hs(t.evaluate(a)))],"to-rgba":[Rr(Kt,4),[Ln],(a,[t])=>t.evaluate(a).toRenderColor(null).toArray()],rgb:[Ln,[Kt,Kt,Kt],xm],rgba:[Ln,[Kt,Kt,Kt,Kt],xm],hsl:[Ln,[Kt,Kt,Kt],tf],hsla:[Ln,[Kt,Kt,Kt,Kt],tf],has:{type:Ei,overloads:[[[nn],(a,[t])=>nf(t.evaluate(a),a.properties())],[[nn,Vi],(a,[t,r])=>nf(t.evaluate(a),r.evaluate(a))]]},get:{type:fn,overloads:[[[nn],(a,[t])=>rf(t.evaluate(a),a.properties())],[[nn,Vi],(a,[t,r])=>rf(t.evaluate(a),r.evaluate(a))]]},"feature-state":[fn,[nn],(a,[t])=>rf(t.evaluate(a),a.featureState||{})],properties:[Vi,[],a=>a.properties()],"geometry-type":[nn,[],a=>a.geometryType()],id:[fn,[],a=>a.id()],zoom:[Kt,[],a=>a.globals.zoom],pitch:[Kt,[],a=>a.globals.pitch||0],"distance-from-center":[Kt,[],a=>a.distanceFromCenter()],"measure-light":[Kt,[nn],(a,[t])=>a.measureLight(t.evaluate(a))],"heatmap-density":[Kt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Kt,[],a=>a.globals.lineProgress||0],"raster-value":[Kt,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[Kt,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[Kt,[],a=>a.globals.skyRadialProgress||0],accumulated:[fn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Kt,lu(Kt),(a,t)=>{let r=0;for(const c of t)r+=c.evaluate(a);return r}],"*":[Kt,lu(Kt),(a,t)=>{let r=1;for(const c of t)r*=c.evaluate(a);return r}],"-":{type:Kt,overloads:[[[Kt,Kt],(a,[t,r])=>t.evaluate(a)-r.evaluate(a)],[[Kt],(a,[t])=>-t.evaluate(a)]]},"/":[Kt,[Kt,Kt],(a,[t,r])=>t.evaluate(a)/r.evaluate(a)],"%":[Kt,[Kt,Kt],(a,[t,r])=>t.evaluate(a)%r.evaluate(a)],ln2:[Kt,[],()=>Math.LN2],pi:[Kt,[],()=>Math.PI],e:[Kt,[],()=>Math.E],"^":[Kt,[Kt,Kt],(a,[t,r])=>Math.pow(t.evaluate(a),r.evaluate(a))],sqrt:[Kt,[Kt],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[Kt,[Kt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[Kt,[Kt],(a,[t])=>Math.log(t.evaluate(a))],log2:[Kt,[Kt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[Kt,[Kt],(a,[t])=>Math.sin(t.evaluate(a))],cos:[Kt,[Kt],(a,[t])=>Math.cos(t.evaluate(a))],tan:[Kt,[Kt],(a,[t])=>Math.tan(t.evaluate(a))],asin:[Kt,[Kt],(a,[t])=>Math.asin(t.evaluate(a))],acos:[Kt,[Kt],(a,[t])=>Math.acos(t.evaluate(a))],atan:[Kt,[Kt],(a,[t])=>Math.atan(t.evaluate(a))],min:[Kt,lu(Kt),(a,t)=>Math.min(...t.map(r=>r.evaluate(a)))],max:[Kt,lu(Kt),(a,t)=>Math.max(...t.map(r=>r.evaluate(a)))],abs:[Kt,[Kt],(a,[t])=>Math.abs(t.evaluate(a))],round:[Kt,[Kt],(a,[t])=>{const r=t.evaluate(a);return r<0?-Math.round(-r):Math.round(r)}],floor:[Kt,[Kt],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[Kt,[Kt],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Ei,[nn,fn],(a,[t,r])=>a.properties()[t.value]===r.value],"filter-id-==":[Ei,[fn],(a,[t])=>a.id()===t.value],"filter-type-==":[Ei,[nn],(a,[t])=>a.geometryType()===t.value],"filter-<":[Ei,[nn,fn],(a,[t,r])=>{const c=a.properties()[t.value],f=r.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Ei,[fn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r<c}],"filter->":[Ei,[nn,fn],(a,[t,r])=>{const c=a.properties()[t.value],f=r.value;return typeof c==typeof f&&c>f}],"filter-id->":[Ei,[fn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r>c}],"filter-<=":[Ei,[nn,fn],(a,[t,r])=>{const c=a.properties()[t.value],f=r.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Ei,[fn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r<=c}],"filter->=":[Ei,[nn,fn],(a,[t,r])=>{const c=a.properties()[t.value],f=r.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Ei,[fn],(a,[t])=>{const r=a.id(),c=t.value;return typeof r==typeof c&&r>=c}],"filter-has":[Ei,[fn],(a,[t])=>t.value in a.properties()],"filter-has-id":[Ei,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Ei,[Rr(nn)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Ei,[Rr(fn)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Ei,[nn,Rr(fn)],(a,[t,r])=>r.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Ei,[nn,Rr(fn)],(a,[t,r])=>function(c,f,u,m){for(;u<=m;){const T=u+m>>1;if(f[T]===c)return!0;f[T]>c?m=T-1:u=T+1}return!1}(a.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ei,overloads:[[[Ei,Ei],(a,[t,r])=>t.evaluate(a)&&r.evaluate(a)],[lu(Ei),(a,t)=>{for(const r of t)if(!r.evaluate(a))return!1;return!0}]]},any:{type:Ei,overloads:[[[Ei,Ei],(a,[t,r])=>t.evaluate(a)||r.evaluate(a)],[lu(Ei),(a,t)=>{for(const r of t)if(r.evaluate(a))return!0;return!1}]]},"!":[Ei,[Ei],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Ei,[nn],(a,[t])=>{const r=a.globals&&a.globals.isSupportedScript;return!r||r(t.evaluate(a))}],upcase:[nn,[nn],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[nn,[nn],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[nn,lu(fn),(a,t)=>t.map(r=>Is(r.evaluate(a))).join("")],"resolved-locale":[nn,[cr],(a,[t])=>t.evaluate(a).resolvedLocale()],random:[Kt,[Kt,Kt,fn],(a,t)=>{const[r,c,f]=t.map(m=>m.evaluate(a));if(r>c||r===c)return r;let u;if(typeof f=="string")u=function(m){let T=0;if(m.length===0)return T;for(let L=0;L<m.length;L++)T=(T<<5)-T+m.charCodeAt(L),T|=0;return T}(f);else{if(typeof f!="number")throw new Un(`Invalid seed input: ${f}`);u=f}return r+Bd(u)()*(c-r)}]});class Ud{constructor(t,r,c,f){this.expression=t,this._warningHistory={},this._evaluator=new Ma(c,f),this._defaultValue=r?function(u){return u.type==="color"&&(af(u.default)||Array.isArray(u.default))?new Ee(0,0,0,0):u.type==="color"?Ee.parse(u.default)||null:u.default===void 0?null:u.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=Uh(t)}evaluateWithoutErrorHandling(t,r,c,f,u,m,T,L){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=c,this._evaluator.canonical=f||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=L||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,c,f,u,m,T,L){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=L||null;try{const D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Un(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function Ju(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ku}function uu(a,t,r,c){const f=new $p(Ku,[],t?function(m){const T={color:Ln,string:nn,number:Kt,enum:nn,boolean:Ei,formatted:gr,resolvedImage:_r};return m.type==="array"?Rr(T[m.value]||fn,m.length):T[m.type]}(t):void 0,void 0,void 0,r,c),u=f.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?bm(new Ud(u,t,r,c)):Kl(f.errors)}class Vd{constructor(t,r,c){this.kind=t,this._styleExpression=r,this.isLightConstant=c,this.isStateDependent=t!=="constant"&&!Pd(r.expression),this.configDependencies=Uh(r.expression)}evaluateWithoutErrorHandling(t,r,c,f,u,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,f,u,m)}evaluate(t,r,c,f,u,m){return this._styleExpression.evaluate(t,r,c,f,u,m)}}class el{constructor(t,r,c,f,u){this.kind=t,this.zoomStops=c,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Pd(r.expression),this.isLightConstant=u,this.configDependencies=Uh(r.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,r,c,f,u,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,c,f,u,m)}evaluate(t,r,c,f,u,m){return this._styleExpression.evaluate(t,r,c,f,u,m)}interpolationFactor(t,r,c){return this.interpolationType?La.interpolationFactor(this.interpolationType,t,r,c):0}}function Cc(a,t,r,c){if((a=uu(a,t,r,c)).result==="error")return a;const f=a.value.expression,u=ju(f);if(!u&&!cu(t))return Kl([new hn("","data expressions not supported")]);const m=au(f,["zoom","pitch","distance-from-center"]);if(!m&&!sf(t))return Kl([new hn("","zoom expressions not supported")]);const T=au(f,["measure-light"]);if(!T&&!wm(t))return Kl([new hn("","measure-light expression not supported")]);const L=au(f,["line-progress"]);if(!L&&!function(C){return Nd(C.expression,"line-progress")}(t))return Kl([new hn("","line-progress expression not supported")]);const D=t.expression&&t.expression.relaxZoomRestriction,b=Zh(f);return b||m||D?b instanceof hn?Kl([b]):b instanceof La&&!of(t)?Kl([new hn("",'"interpolate" expressions cannot be used with this property')]):bm(b?new el(u&&L?"camera":"composite",a.value,b.labels,b instanceof La?b.interpolation:void 0,T):new Vd(u&&L?"constant":"source",a.value,T)):Kl([new hn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Gd{constructor(t,r){this._parameters=t,this._specification=r,Wi(this,lf(this._parameters,this._specification))}static deserialize(t){return new Gd(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Zh(a){let t=null;if(a instanceof Uo)t=Zh(a.result);else if(a instanceof qo){for(const r of a.args)if(t=Zh(r),t)break}else(a instanceof Gh||a instanceof La)&&a.input instanceof jo&&a.input.name==="zoom"&&(t=a);return t instanceof hn||a.eachChild(r=>{const c=Zh(r);c instanceof hn?t=c:t&&c&&t!==c&&(t=new hn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Hd,Lc,Sm=function(){if(Lc)return Hd;Lc=1,Hd=t;var a=3;function t(r,c,f){var u=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var m=new Int32Array(this.arrayBuffer);r=m[0],this.d=(c=m[1])+2*(f=m[2]);for(var T=0;T<this.d*this.d;T++){var L=m[a+T],D=m[a+T+1];u.push(L===D?null:m.subarray(L,D))}var b=m[a+u.length+1];this.keys=m.subarray(m[a+u.length],b),this.bboxes=m.subarray(b),this.insert=this._insertReadonly}else{this.d=c+2*f;for(var C=0;C<this.d*this.d;C++)u.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=f,this.scale=c/r,this.uid=0;var R=f/c*r;this.min=-R,this.max=r+R}return t.prototype.insert=function(r,c,f,u,m){this._forEachCell(c,f,u,m,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(u),this.bboxes.push(m)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(r,c,f,u,m,T){this.cells[m].push(T)},t.prototype.query=function(r,c,f,u,m){var T=this.min,L=this.max;if(r<=T&&c<=T&&L<=f&&L<=u&&!m)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(r,c,f,u,this._queryCell,D,{},m),D},t.prototype._queryCell=function(r,c,f,u,m,T,L,D){var b=this.cells[m];if(b!==null)for(var C=this.keys,R=this.bboxes,A=0;A<b.length;A++){var I=b[A];if(L[I]===void 0){var k=4*I;(D?D(R[k+0],R[k+1],R[k+2],R[k+3]):r<=R[k+2]&&c<=R[k+3]&&f>=R[k+0]&&u>=R[k+1])?(L[I]=!0,T.push(C[I])):L[I]=!1}}},t.prototype._forEachCell=function(r,c,f,u,m,T,L,D){for(var b=this._convertToCellCoord(r),C=this._convertToCellCoord(c),R=this._convertToCellCoord(f),A=this._convertToCellCoord(u),I=b;I<=R;I++)for(var k=C;k<=A;k++){var W=this.d*k+I;if((!D||D(this._convertFromCellCoord(I),this._convertFromCellCoord(k),this._convertFromCellCoord(I+1),this._convertFromCellCoord(k+1)))&&m.call(this,r,c,f,u,W,T,L,D))return}},t.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},t.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,c=a+this.cells.length+1+1,f=0,u=0;u<this.cells.length;u++)f+=this.cells[u].length;var m=new Int32Array(c+f+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var T=c,L=0;L<r.length;L++){var D=r[L];m[a+L]=T,m.set(D,T),T+=D.length}return m[a+r.length]=T,m.set(this.keys,T),m[a+r.length+1]=T+=this.keys.length,m.set(this.bboxes,T),T+=this.bboxes.length,m.buffer},Hd}(),hu=J(Sm);const Jl={};function Sn(a,t,r={}){Object.defineProperty(a,"_classRegistryKey",{value:t,writable:!1}),Jl[t]={klass:a,omit:r.omit||[]}}Sn(Object,"Object"),hu.serialize=function(a,t){const r=a.toArrayBuffer();return t&&t.add(r),{buffer:r}},hu.deserialize=function(a){return new hu(a.buffer)},Object.defineProperty(hu,"name",{value:"Grid"}),Sn(hu,"Grid"),Sn(Ee,"Color"),Sn(Error,"Error"),Sn(to,"Formatted"),Sn(ro,"FormattedSection"),Sn(nr,"AJAXError"),Sn(Xs,"ResolvedImage"),Sn(Gd,"StylePropertyFunction"),Sn(Ud,"StyleExpression",{omit:["_evaluator"]}),Sn(el,"ZoomDependentExpression"),Sn(Vd,"ZoomConstantExpression"),Sn(jo,"CompoundExpression",{omit:["_evaluate"]});for(const a in Ku)Jl[Ku[a]._classRegistryKey]||Sn(Ku[a],`Expression${a}`);function Xh(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function uf(a){return self.ImageBitmap&&a instanceof ImageBitmap}function Ql(a,t){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Xh(a)||uf(a))return t&&t.add(a),a;if(ArrayBuffer.isView(a)){const r=a;return t&&t.add(r.buffer),r}if(a instanceof ImageData)return t&&t.add(a.data.buffer),a;if(Array.isArray(a)){const r=[];for(const c of a)r.push(Ql(c,t));return r}if(a instanceof Map){const r={$name:"Map"};for(const[c,f]of a.entries())r[c]=Ql(f);return r}if(a instanceof Set){const r={$name:"Set"};let c=0;for(const f of a.values())r[++c]=Ql(f);return r}if(typeof a=="object"){const r=a.constructor,c=r._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const f=r.serialize?r.serialize(a,t):{};if(!r.serialize){for(const u in a)a.hasOwnProperty(u)&&(Jl[c].omit.indexOf(u)>=0||(f[u]=Ql(a[u],t)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof a)}function Ia(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Xh(a)||uf(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Ia);if(typeof a=="object"){const t=a.$name||"Object";if(t==="Map"){const f=new Map;for(const u of Object.keys(a))u!=="$name"&&f.set(u,Ia(a[u]));return f}if(t==="Set"){const f=new Set;for(const u of Object.keys(a))u!=="$name"&&f.add(Ia(a[u]));return f}const{klass:r}=Jl[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(a);const c=Object.create(r.prototype);for(const f of Object.keys(a))f!=="$name"&&(c[f]=Ia(a[f]));return c}throw new Error("can't deserialize object of type "+typeof a)}const Gn={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function hf(a){for(const t of a)if(du(t.charCodeAt(0)))return!0;return!1}function df(a){for(const t of a)if(!Fg(t.charCodeAt(0)))return!1;return!0}function Fg(a){return!(Gn.Arabic(a)||Gn["Arabic Supplement"](a)||Gn["Arabic Extended-A"](a)||Gn["Arabic Presentation Forms-A"](a)||Gn["Arabic Presentation Forms-B"](a))}function du(a){return!(a!==746&&a!==747&&(a<4352||!(Gn["Bopomofo Extended"](a)||Gn.Bopomofo(a)||Gn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Gn["CJK Compatibility Ideographs"](a)||Gn["CJK Compatibility"](a)||Gn["CJK Radicals Supplement"](a)||Gn["CJK Strokes"](a)||!(!Gn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Gn["CJK Unified Ideographs Extension A"](a)||Gn["CJK Unified Ideographs"](a)||Gn["Enclosed CJK Letters and Months"](a)||Gn["Hangul Compatibility Jamo"](a)||Gn["Hangul Jamo Extended-A"](a)||Gn["Hangul Jamo Extended-B"](a)||Gn["Hangul Jamo"](a)||Gn["Hangul Syllables"](a)||Gn.Hiragana(a)||Gn["Ideographic Description Characters"](a)||Gn.Kanbun(a)||Gn["Kangxi Radicals"](a)||Gn["Katakana Phonetic Extensions"](a)||Gn.Katakana(a)&&a!==12540||!(!Gn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Gn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Gn["Unified Canadian Aboriginal Syllabics"](a)||Gn["Unified Canadian Aboriginal Syllabics Extended"](a)||Gn["Vertical Forms"](a)||Gn["Yijing Hexagram Symbols"](a)||Gn["Yi Syllables"](a)||Gn["Yi Radicals"](a))))}function jd(a){return!(du(a)||function(t){return!!(Gn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Gn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Gn["Letterlike Symbols"](t)||Gn["Number Forms"](t)||Gn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Gn["Control Pictures"](t)&&t!==9251||Gn["Optical Character Recognition"](t)||Gn["Enclosed Alphanumerics"](t)||Gn["Geometric Shapes"](t)||Gn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Gn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gn["CJK Symbols and Punctuation"](t)||Gn.Katakana(t)||Gn["Private Use Area"](t)||Gn["CJK Compatibility Forms"](t)||Gn["Small Form Variants"](t)||Gn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}function Yh(a){return a>=1424&&a<=2303||Gn["Arabic Presentation Forms-A"](a)||Gn["Arabic Presentation Forms-B"](a)}function Em(a,t){return!(!t&&Yh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Gn.Khmer(a))}function Bg(a){for(const t of a)if(Yh(t.charCodeAt(0)))return!0;return!1}const pf="deferred",Qu="loading",eh="loaded";let Wd=null,Ko="unavailable",Ua=null;const Am=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Ko="error"),Wd&&Wd(a)};function ff(){qd.fire(new Ve("pluginStateChange",{pluginStatus:Ko,pluginURL:Ua}))}const qd=new bi,mf=function(){return Ko},Kh=function(){if(Ko!==pf||!Ua)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ko=Qu,ff(),Ua&&Bo({url:Ua},a=>{a?Am(a):(Ko=eh,ff())})},oa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ko===eh||oa.applyArabicShaping!=null,isLoading:()=>Ko===Qu,setState(a){Ko=a.pluginStatus,Ua=a.pluginURL},isParsed:()=>oa.applyArabicShaping!=null&&oa.processBidirectionalText!=null&&oa.processStyledBidirectionalText!=null,getPluginURL:()=>Ua};class Qs{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(r,c){for(const f of r)if(!Em(f.charCodeAt(0),c))return!1;return!0}(t,oa.isLoaded())}}class $d{constructor(t,r,c,f){this.property=t,this.value=r,this.expression=function(u,m,T,L){if(af(u))return new Gd(u,m);if(Ju(u)||Array.isArray(u)&&u.length>0){const D=Cc(u,m,T,L);if(D.result==="error")throw new Error(D.value.map(b=>`${b.key}: ${b.message}`).join(", "));return D.value}{let D=u;return typeof u=="string"&&m.type==="color"&&(D=Ee.parse(u)),{kind:"constant",configDependencies:new Set,evaluate:()=>D}}}(r===void 0?t.specification.default:r,t.specification,c,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,c){return this.property.possiblyEvaluate(this,t,r,c)}}class gf{constructor(t,r,c){this.property=t,this.value=new $d(t,void 0,r,c)}transitioned(t,r){return new Zd(this.property,this.value,r,cn({},t.transition,this.transition),t.now)}untransitioned(){return new Zd(this.property,this.value,null,{},0)}}class _f{constructor(t,r,c){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=r,this._options=c,this.configDependencies=new Set}getValue(t){return $r(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new gf(this._values[t].property,this._scope,this._options)),this._values[t].value=new $d(this._values[t].property,r===null?void 0:$r(r),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,r){r&&(this._options=r);const c=this._properties.properties;if(t)for(const f in t){const u=t[f];if(Lr(f,"-transition")){const m=f.slice(0,-11);c[m]&&this.setTransition(m,u)}else c.hasOwnProperty(f)&&this.setValue(f,u)}}getTransition(t){return $r(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new gf(this._values[t].property)),this._values[t].transition=$r(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c);const f=this.getTransition(r);f!==void 0&&(t[`${r}-transition`]=f)}return t}transitioned(t,r){const c=new Ic(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(t,r._values[f]);return c}untransitioned(){const t=new Ic(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Zd{constructor(t,r,c,f,u){const m=f.delay||0,T=f.duration||0;u=u||0,this.property=t,this.value=r,this.begin=u+m,this.end=this.begin+T,t.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(t,r,c){const f=t.now||0,u=this.value.possiblyEvaluate(t,r,c),m=this.prior;if(m){if(f>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(f<this.begin)return m.possiblyEvaluate(t,r,c);{const T=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,r,c),u,st(T))}}return u}}class Ic{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,c){const f=new th(this._properties);for(const u of Object.keys(this._values))f._values[u]=this._values[u].possiblyEvaluate(t,r,c);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ng{constructor(t,r,c){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=r,this._options=c,this.configDependencies=new Set}getValue(t){return $r(this._values[t].value)}setValue(t,r){this._values[t]=new $d(this._values[t].property,r===null?void 0:$r(r),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const r of Object.keys(this._values)){const c=this.getValue(r);c!==void 0&&(t[r]=c)}return t}possiblyEvaluate(t,r,c){const f=new th(this._properties);for(const u of Object.keys(this._values))f._values[u]=this._values[u].possiblyEvaluate(t,r,c);return f}}class Rc{constructor(t,r,c){this.property=t,this.value=r,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,c,f){return this.property.evaluate(this.value,this.parameters,t,r,c,f)}}class th{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class qi{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,c){const f=Mi[this.specification.type];return f?f(t,r,c):t}}class yn{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,c,f){return new Rc(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},c,f)}:t.expression,r)}interpolate(t,r,c){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Rc(this,{kind:"constant",value:void 0},t.parameters);const f=Mi[this.specification.type];return f?new Rc(this,{kind:"constant",value:f(t.value.value,r.value.value,c)},t.parameters):t}evaluate(t,r,c,f,u,m){return t.kind==="constant"?t.value:t.evaluate(r,c,f,u,m)}}class pu{constructor(t){this.specification=t}possiblyEvaluate(t,r,c,f){return!!t.expression.evaluate(r,null,{},c,f)}interpolate(){return!1}}class Ts{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new Qs(0,{});for(const c in t){const f=t[c];f.specification.overridable&&this.overridableProperties.push(c);const u=this.defaultPropertyValues[c]=new $d(f,void 0),m=this.defaultTransitionablePropertyValues[c]=new gf(f);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=u.possiblyEvaluate(r)}}}Sn(yn,"DataDrivenProperty"),Sn(qi,"DataConstantProperty"),Sn(pu,"ColorRampProperty");var Jt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ih(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Va(a){if(Array.isArray(a))return a.map(Va);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const r in a)t[r]=Va(a[r]);return t}return ih(a)}function yo(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!yo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function yl(a,t="",r=null,c="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yo(a)||(a=Dc(a));const f=a;let u=!0;try{u=function(b){if(!ya(b))return b;let C=Va(b);return Pc(C),C=tl(C),C}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let m=null,T=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){T=Jt[`filter_${c}`];const b=uu(u,T,t,r);if(b.result==="error")throw new Error(b.value.map(C=>`${C.key}: ${C.message}`).join(", "));m=(C,R,A)=>b.value.evaluate(C,R,{},A)}let L=null,D=null;if(u!==f){const b=uu(f,T,t,r);if(b.result==="error")throw new Error(b.value.map(C=>`${C.key}: ${C.message}`).join(", "));L=(C,R,A,I,k)=>b.value.evaluate(C,R,{},A,void 0,void 0,I,k),D=!ju(b.value.expression)}return{filter:m,dynamicFilter:L||void 0,needGeometry:fu(u),needFeature:!!D}}function tl(a){if(!Array.isArray(a))return a;const t=function(r){if(nh.has(r[0])){for(let c=1;c<r.length;c++)if(ya(r[c]))return!0}return r}(a);return t===!0?t:t.map(r=>tl(r))}function Pc(a){let t=!1;const r=[];if(a[0]==="case"){for(let c=1;c<a.length-1;c+=2)t=t||ya(a[c]),r.push(a[c+1]);r.push(a[a.length-1])}else if(a[0]==="match"){t=t||ya(a[1]);for(let c=2;c<a.length-1;c+=2)r.push(a[c+1]);r.push(a[a.length-1])}else if(a[0]==="step"){t=t||ya(a[1]);for(let c=1;c<a.length-1;c+=2)r.push(a[c+1])}t&&(a.length=0,a.push("any",...r));for(let c=1;c<a.length;c++)Pc(a[c])}function ya(a){if(!Array.isArray(a))return!1;if((t=a[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let r=1;r<a.length;r++)if(ya(a[r]))return!0;return!1}const nh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rh(a,t){return a<t?-1:a>t?1:0}function fu(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(fu(a[t]))return!0;return!1}function Dc(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?Xd(a[1],a[2],"=="):t==="!="?Bl(Xd(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Xd(a[1],a[2],t):t==="any"?(r=a.slice(1),["any"].concat(r.map(Dc))):t==="all"?["all"].concat(a.slice(1).map(Dc)):t==="none"?["all"].concat(a.slice(1).map(Dc).map(Bl)):t==="in"?sh(a[1],a.slice(2)):t==="!in"?Bl(sh(a[1],a.slice(2))):t==="has"?Oc(a[1]):t!=="!has"||Bl(Oc(a[1]));var r}function Xd(a,t,r){switch(a){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,a,t]}}function sh(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",a,["literal",t.sort(rh)]]:["filter-in-small",a,["literal",t]]}}function Oc(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Bl(a){return["!",a]}const oh="";function ah(a,t){return t?`${a}${oh}${t}`:a}const yf="-transition",Ga=new Set(["fill","line","background","hillshade","raster"]);class $o extends bi{constructor(t,r,c,f,u){if(super(),this.id=t.id,this.fqid=ah(this.id,c),this.type=t.type,this.scope=c,this.lut=f,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const m=uu(this.filter,Jt[`filter_${t.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),r.layout&&(this._unevaluatedLayout=new Ng(r.layout,this.scope,u),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new _f(r.paint,this.scope,u);for(const m in t.paint)this.setPaintProperty(m,t.paint[m]);for(const m in t.layout)this.setLayoutProperty(m,t.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new th(r.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D()&&Ga.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r){if(this.type==="custom"&&t==="visibility")return void(this.visibility=r);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,r),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return Lr(t,yf)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r){const c=this._transitionablePaint,f=c._properties.properties;if(Lr(t,yf)){const C=t.slice(0,-11);return f[C]&&c.setTransition(C,r||void 0),!1}if(!f[t])return!1;const u=c._values[t],m=u.value.isDataDriven(),T=u.value;c.setValue(t,r),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const L=c._values[t].value,D=L.isDataDriven(),b=Lr(t,"pattern")||t==="line-dasharray";return D||m||b||this._handleOverridablePaintPropertyUpdate(t,T,L)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,r,c){return null}_handleOverridablePaintPropertyUpdate(t,r,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){return eo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,r)=>!(t===void 0||r==="layout"&&!Object.keys(t).length||r==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Rc&&cu(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=yl(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,r,c,f,u,m,T,L,D){}queryIntersectsMatchingFeature(t,r,c,f){}}const Jh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class lh{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ds{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qr(a,t=1){let r=0,c=0;return{members:a.map(f=>{const u=Jh[f.type].BYTES_PER_ELEMENT,m=r=vf(r,Math.max(t,u)),T=f.components||1;return c=Math.max(c,u),r+=u*T,{name:f.name,type:f.type,components:T,offset:m}}),size:vf(r,Math.max(c,t)),alignment:t}}function vf(a,t){return Math.ceil(a/t)*t}class ec extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const f=2*t;return this.int16[f+0]=r,this.int16[f+1]=c,t}}ec.prototype.bytesPerElement=4,Sn(ec,"StructArrayLayout2i4");class Yd extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,c)}emplace(t,r,c,f){const u=3*t;return this.int16[u+0]=r,this.int16[u+1]=c,this.int16[u+2]=f,t}}Yd.prototype.bytesPerElement=6,Sn(Yd,"StructArrayLayout3i6");class mu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,c,f)}emplace(t,r,c,f,u){const m=4*t;return this.int16[m+0]=r,this.int16[m+1]=c,this.int16[m+2]=f,this.int16[m+3]=u,t}}mu.prototype.bytesPerElement=8,Sn(mu,"StructArrayLayout4i8");class ch extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,c,f,u)}emplace(t,r,c,f,u,m){const T=5*t;return this.int16[T+0]=r,this.int16[T+1]=c,this.int16[T+2]=f,this.int16[T+3]=u,this.int16[T+4]=m,t}}ch.prototype.bytesPerElement=10,Sn(ch,"StructArrayLayout5i10");class zc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,c,f,u,m,T)}emplace(t,r,c,f,u,m,T,L){const D=6*t,b=12*t,C=3*t;return this.int16[D+0]=r,this.int16[D+1]=c,this.uint8[b+4]=f,this.uint8[b+5]=u,this.uint8[b+6]=m,this.uint8[b+7]=T,this.float32[C+2]=L,t}}zc.prototype.bytesPerElement=12,Sn(zc,"StructArrayLayout2i4ub1f12");class va extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,c,f)}emplace(t,r,c,f,u){const m=4*t;return this.float32[m+0]=r,this.float32[m+1]=c,this.float32[m+2]=f,this.float32[m+3]=u,t}}va.prototype.bytesPerElement=16,Sn(va,"StructArrayLayout4f16");class tc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,c)}emplace(t,r,c,f){const u=3*t;return this.float32[u+0]=r,this.float32[u+1]=c,this.float32[u+2]=f,t}}tc.prototype.bytesPerElement=12,Sn(tc,"StructArrayLayout3f12");class ic extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,c,f,u)}emplace(t,r,c,f,u,m){const T=6*t,L=3*t;return this.uint16[T+0]=r,this.uint16[T+1]=c,this.uint16[T+2]=f,this.uint16[T+3]=u,this.float32[L+2]=m,t}}ic.prototype.bytesPerElement=12,Sn(ic,"StructArrayLayout4ui1f12");class gu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,f){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,c,f)}emplace(t,r,c,f,u){const m=4*t;return this.uint16[m+0]=r,this.uint16[m+1]=c,this.uint16[m+2]=f,this.uint16[m+3]=u,t}}gu.prototype.bytesPerElement=8,Sn(gu,"StructArrayLayout4ui8");class vl extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,c,f,u,m)}emplace(t,r,c,f,u,m,T){const L=6*t;return this.int16[L+0]=r,this.int16[L+1]=c,this.int16[L+2]=f,this.int16[L+3]=u,this.int16[L+4]=m,this.int16[L+5]=T,t}}vl.prototype.bytesPerElement=12,Sn(vl,"StructArrayLayout6i12");class _u extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T,L,D,b,C,R){const A=this.length;return this.resize(A+1),this.emplace(A,t,r,c,f,u,m,T,L,D,b,C,R)}emplace(t,r,c,f,u,m,T,L,D,b,C,R,A){const I=12*t;return this.int16[I+0]=r,this.int16[I+1]=c,this.int16[I+2]=f,this.int16[I+3]=u,this.uint16[I+4]=m,this.uint16[I+5]=T,this.uint16[I+6]=L,this.uint16[I+7]=D,this.int16[I+8]=b,this.int16[I+9]=C,this.int16[I+10]=R,this.int16[I+11]=A,t}}_u.prototype.bytesPerElement=24,Sn(_u,"StructArrayLayout4i4ui4i24");class Kd extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,c,f,u,m)}emplace(t,r,c,f,u,m,T){const L=10*t,D=5*t;return this.int16[L+0]=r,this.int16[L+1]=c,this.int16[L+2]=f,this.float32[D+2]=u,this.float32[D+3]=m,this.float32[D+4]=T,t}}Kd.prototype.bytesPerElement=20,Sn(Kd,"StructArrayLayout3i3f20");class uh extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}uh.prototype.bytesPerElement=4,Sn(uh,"StructArrayLayout1ul4");class il extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const f=2*t;return this.uint16[f+0]=r,this.uint16[f+1]=c,t}}il.prototype.bytesPerElement=4,Sn(il,"StructArrayLayout2ui4");class Qh extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T,L,D,b,C,R,A){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,c,f,u,m,T,L,D,b,C,R,A)}emplace(t,r,c,f,u,m,T,L,D,b,C,R,A,I){const k=20*t,W=10*t;return this.int16[k+0]=r,this.int16[k+1]=c,this.int16[k+2]=f,this.int16[k+3]=u,this.int16[k+4]=m,this.float32[W+3]=T,this.float32[W+4]=L,this.float32[W+5]=D,this.float32[W+6]=b,this.int16[k+14]=C,this.uint32[W+8]=R,this.uint16[k+18]=A,this.uint16[k+19]=I,t}}Qh.prototype.bytesPerElement=40,Sn(Qh,"StructArrayLayout5i4f1i1ul2ui40");class Io extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,c,f,u,m,T)}emplace(t,r,c,f,u,m,T,L){const D=8*t;return this.int16[D+0]=r,this.int16[D+1]=c,this.int16[D+2]=f,this.int16[D+4]=u,this.int16[D+5]=m,this.int16[D+6]=T,this.int16[D+7]=L,t}}Io.prototype.bytesPerElement=16,Sn(Io,"StructArrayLayout3i2i2i16");class yu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,c,f,u)}emplace(t,r,c,f,u,m){const T=4*t,L=8*t;return this.float32[T+0]=r,this.float32[T+1]=c,this.float32[T+2]=f,this.int16[L+6]=u,this.int16[L+7]=m,t}}yu.prototype.bytesPerElement=16,Sn(yu,"StructArrayLayout2f1f2i16");class vu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,c,f,u,m)}emplace(t,r,c,f,u,m,T){const L=20*t,D=5*t;return this.uint8[L+0]=r,this.uint8[L+1]=c,this.float32[D+1]=f,this.float32[D+2]=u,this.float32[D+3]=m,this.float32[D+4]=T,t}}vu.prototype.bytesPerElement=20,Sn(vu,"StructArrayLayout2ub4f20");class qs extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,c)}emplace(t,r,c,f){const u=3*t;return this.uint16[u+0]=r,this.uint16[u+1]=c,this.uint16[u+2]=f,t}}qs.prototype.bytesPerElement=6,Sn(qs,"StructArrayLayout3ui6");class kc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W,$,ee,te,X,le){const he=this.length;return this.resize(he+1),this.emplace(he,t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W,$,ee,te,X,le)}emplace(t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W,$,ee,te,X,le,he){const Me=30*t,He=15*t,ze=60*t;return this.int16[Me+0]=r,this.int16[Me+1]=c,this.int16[Me+2]=f,this.float32[He+2]=u,this.float32[He+3]=m,this.uint16[Me+8]=T,this.uint16[Me+9]=L,this.uint32[He+5]=D,this.uint32[He+6]=b,this.uint32[He+7]=C,this.uint16[Me+16]=R,this.uint16[Me+17]=A,this.uint16[Me+18]=I,this.float32[He+10]=k,this.float32[He+11]=W,this.uint8[ze+48]=$,this.uint8[ze+49]=ee,this.uint8[ze+50]=te,this.uint32[He+13]=X,this.int16[Me+28]=le,this.uint8[ze+58]=he,t}}kc.prototype.bytesPerElement=60,Sn(kc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class hh extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W,$,ee,te,X,le,he,Me,He,ze,Be,yt,ke,dt,Et,Ct,Bt){const ei=this.length;return this.resize(ei+1),this.emplace(ei,t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W,$,ee,te,X,le,he,Me,He,ze,Be,yt,ke,dt,Et,Ct,Bt)}emplace(t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W,$,ee,te,X,le,he,Me,He,ze,Be,yt,ke,dt,Et,Ct,Bt,ei){const ni=20*t,Yt=40*t,yi=80*t;return this.float32[ni+0]=r,this.float32[ni+1]=c,this.int16[Yt+4]=f,this.int16[Yt+5]=u,this.int16[Yt+6]=m,this.int16[Yt+7]=T,this.int16[Yt+8]=L,this.int16[Yt+9]=D,this.int16[Yt+10]=b,this.int16[Yt+11]=C,this.int16[Yt+12]=R,this.uint16[Yt+13]=A,this.uint16[Yt+14]=I,this.uint16[Yt+15]=k,this.uint16[Yt+16]=W,this.uint16[Yt+17]=$,this.uint16[Yt+18]=ee,this.uint16[Yt+19]=te,this.uint16[Yt+20]=X,this.uint16[Yt+21]=le,this.uint16[Yt+22]=he,this.uint16[Yt+23]=Me,this.uint16[Yt+24]=He,this.uint16[Yt+25]=ze,this.uint16[Yt+26]=Be,this.uint16[Yt+27]=yt,this.uint32[ni+14]=ke,this.float32[ni+15]=dt,this.float32[ni+16]=Et,this.float32[ni+17]=Ct,this.float32[ni+18]=Bt,this.uint8[yi+76]=ei,t}}hh.prototype.bytesPerElement=80,Sn(hh,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ra extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Ra.prototype.bytesPerElement=4,Sn(Ra,"StructArrayLayout1f4");class Fc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,c,f,u)}emplace(t,r,c,f,u,m){const T=5*t;return this.float32[T+0]=r,this.float32[T+1]=c,this.float32[T+2]=f,this.float32[T+3]=u,this.float32[T+4]=m,t}}Fc.prototype.bytesPerElement=20,Sn(Fc,"StructArrayLayout5f20");class Jd extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,c,f,u,m,T)}emplace(t,r,c,f,u,m,T,L){const D=7*t;return this.float32[D+0]=r,this.float32[D+1]=c,this.float32[D+2]=f,this.float32[D+3]=u,this.float32[D+4]=m,this.float32[D+5]=T,this.float32[D+6]=L,t}}Jd.prototype.bytesPerElement=28,Sn(Jd,"StructArrayLayout7f28");class Jo extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T,L,D,b,C){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,c,f,u,m,T,L,D,b,C)}emplace(t,r,c,f,u,m,T,L,D,b,C,R){const A=11*t;return this.float32[A+0]=r,this.float32[A+1]=c,this.float32[A+2]=f,this.float32[A+3]=u,this.float32[A+4]=m,this.float32[A+5]=T,this.float32[A+6]=L,this.float32[A+7]=D,this.float32[A+8]=b,this.float32[A+9]=C,this.float32[A+10]=R,t}}Jo.prototype.bytesPerElement=44,Sn(Jo,"StructArrayLayout11f44");class Qd extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T,L,D){const b=this.length;return this.resize(b+1),this.emplace(b,t,r,c,f,u,m,T,L,D)}emplace(t,r,c,f,u,m,T,L,D,b){const C=9*t;return this.float32[C+0]=r,this.float32[C+1]=c,this.float32[C+2]=f,this.float32[C+3]=u,this.float32[C+4]=m,this.float32[C+5]=T,this.float32[C+6]=L,this.float32[C+7]=D,this.float32[C+8]=b,t}}Qd.prototype.bytesPerElement=36,Sn(Qd,"StructArrayLayout9f36");class xl extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,c,f){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,c,f)}emplace(t,r,c,f,u){const m=6*t;return this.uint32[3*t+0]=r,this.uint16[m+2]=c,this.uint16[m+3]=f,this.uint16[m+4]=u,t}}xl.prototype.bytesPerElement=12,Sn(xl,"StructArrayLayout1ul3ui12");class ep extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}ep.prototype.bytesPerElement=2,Sn(ep,"StructArrayLayout1ui2");class xu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const c=this.length;return this.resize(c+1),this.emplace(c,t,r)}emplace(t,r,c){const f=2*t;return this.float32[f+0]=r,this.float32[f+1]=c,t}}xu.prototype.bytesPerElement=8,Sn(xu,"StructArrayLayout2f8");class Bc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W){const $=this.length;return this.resize($+1),this.emplace($,t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W)}emplace(t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W,$){const ee=16*t;return this.float32[ee+0]=r,this.float32[ee+1]=c,this.float32[ee+2]=f,this.float32[ee+3]=u,this.float32[ee+4]=m,this.float32[ee+5]=T,this.float32[ee+6]=L,this.float32[ee+7]=D,this.float32[ee+8]=b,this.float32[ee+9]=C,this.float32[ee+10]=R,this.float32[ee+11]=A,this.float32[ee+12]=I,this.float32[ee+13]=k,this.float32[ee+14]=W,this.float32[ee+15]=$,t}}Bc.prototype.bytesPerElement=64,Sn(Bc,"StructArrayLayout16f64");class bu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,c,f,u,m,T){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,c,f,u,m,T)}emplace(t,r,c,f,u,m,T,L){const D=10*t,b=5*t;return this.uint16[D+0]=r,this.uint16[D+1]=c,this.uint16[D+2]=f,this.uint16[D+3]=u,this.float32[b+2]=m,this.float32[b+3]=T,this.float32[b+4]=L,t}}bu.prototype.bytesPerElement=20,Sn(bu,"StructArrayLayout4ui3f20");class Nc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.int16[1*t+0]=r,t}}Nc.prototype.bytesPerElement=2,Sn(Nc,"StructArrayLayout1i2");class ed extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint8[1*t+0]=r,t}}ed.prototype.bytesPerElement=1,Sn(ed,"StructArrayLayout1ub1");class xf extends lh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}xf.prototype.size=40;class dh extends Qh{get(t){return new xf(this,t)}}Sn(dh,"CollisionBoxArray");class ph extends lh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}ph.prototype.size=60;class tp extends kc{get(t){return new ph(this,t)}}Sn(tp,"PlacedSymbolArray");class wu extends lh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}wu.prototype.size=80;class Nl extends hh{get(t){return new wu(this,t)}}Sn(Nl,"SymbolInstanceArray");class Tu extends Ra{getoffsetX(t){return this.float32[1*t+0]}}Sn(Tu,"GlyphOffsetArray");class Ha extends ec{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Sn(Ha,"SymbolLineVertexArray");class Mu extends lh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Mu.prototype.size=12;class td extends xl{get(t){return new Mu(this,t)}}Sn(td,"FeatureIndexArray");class id extends il{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Sn(id,"FillExtrusionCentroidArray");class ip extends lh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ip.prototype.size=6;class fh extends Yd{get(t){return new ip(this,t)}}Sn(fh,"FillExtrusionWallArray");const bf=Qr([{name:"a_pos",components:2,type:"Int16"}],4),ja=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ks{constructor(t=[]){this.segments=t}_prepareSegment(t,r,c,f){let u=this.segments[this.segments.length-1];return t>Ks.MAX_VERTEX_ARRAY_LENGTH&&Wn(`Max vertices per segment is ${Ks.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!u||u.vertexLength+t>Ks.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==f)&&(u={vertexOffset:r,primitiveOffset:c,vertexLength:0,primitiveLength:0},f!==void 0&&(u.sortKey=f),this.segments.push(u)),u}prepareSegment(t,r,c,f){return this._prepareSegment(t,r.length,c.length,f)}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,c,f){return new Ks([{vertexOffset:t,primitiveOffset:r,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}function np(a,t){return 256*(a=Mt(Math.floor(a),0,255))+Mt(Math.floor(t),0,255)}Ks.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Sn(Ks,"SegmentVector");const wf=Qr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),rp=Qr([{name:"a_dash",components:4,type:"Uint16"}]);class Su{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,r,c,f){this.ids.push(sp(t)),this.positions.push(r,c,f)}eachPosition(t,r){const c=sp(t);let f=0,u=this.ids.length-1;for(;f<u;){const m=f+u>>1;this.ids[m]>=c?u=m:f=m+1}for(;this.ids[f]===c;)r(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(t,r){const c=new Float64Array(t.ids),f=new Uint32Array(t.positions);return Uc(c,f,0,c.length-1),r&&(r.add(c.buffer),r.add(f.buffer)),{ids:c,positions:f}}static deserialize(t){const r=new Su;let c;r.ids=t.ids,r.positions=t.positions;for(const f of r.ids)f!==c&&r.uniqueIds.push(f),c=f;return r.indexed=!0,r}}function sp(a){const t=+a;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Te(String(a))}function Uc(a,t,r,c){for(;r<c;){const f=a[r+c>>1];let u=r-1,m=c+1;for(;;){do u++;while(a[u]<f);do m--;while(a[m]>f);if(u>=m)break;mh(a,u,m),mh(t,3*u,3*m),mh(t,3*u+1,3*m+1),mh(t,3*u+2,3*m+2)}m-r<c-m?(Uc(a,t,r,m),r=m+1):(Uc(a,t,m+1,c),c=m)}}function mh(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}Sn(Su,"FeaturePositionMap");class Ul{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}set(t,r,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class bl extends Ul{constructor(t){super(t),this.current=0}set(t,r,c){this.fetchUniformLocation(t,r)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class lo extends Ul{constructor(t){super(t),this.current=0}set(t,r,c){this.fetchUniformLocation(t,r)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Wa extends Ul{constructor(t){super(t),this.current=[0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class nd extends Ul{constructor(t){super(t),this.current=[0,0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Vc extends Ul{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,c){this.fetchUniformLocation(t,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class op extends Ul{constructor(t){super(t),this.current=Ee.transparent.toRenderColor(null)}set(t,r,c){this.fetchUniformLocation(t,r)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const rd=new Float32Array(16);class Eu extends Ul{constructor(t){super(t),this.current=rd}set(t,r,c){if(this.fetchUniformLocation(t,r)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let f=1;f<16;f++)if(c[f]!==this.current[f]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const ap=new Float32Array(9),lp=new Float32Array(4);class cp extends Ul{constructor(t){super(t),this.current=lp}set(t,r,c){if(this.fetchUniformLocation(t,r)){for(let f=0;f<4;f++)if(c[f]!==this.current[f]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function up(a){return[np(255*a.r,255*a.g),np(255*a.b,255*a.a)]}class nl{constructor(t,r,c,f){this.value=t,this.uniformNames=r.map(u=>`u_${u}`),this.type=c,this.context=f}setUniform(t,r,c,f,u){const m=f.constantOr(this.value);r.set(t,u,m instanceof Ee?m.toRenderColor(this.context.lut):m)}getBinding(t,r){return this.type==="color"?new op(t):new lo(t)}}class Vl{constructor(t,r){this.uniformNames=r.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,r,c,f,u){const m=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;m&&r.set(t,u,m)}getBinding(t,r){return r==="u_pattern"||r==="u_dash"?new Vc(t):new lo(t)}}class nc{constructor(t,r,c,f){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,r,c,f,u,m,T){const L=this.paintVertexArray.length,D=this.expression.evaluate(new Qs(0,{brightness:m}),r,{},u,f,T);this.paintVertexArray.resize(t),this._setPaintValue(L,t,D,this.context)}updatePaintArray(t,r,c,f,u,m,T){const L=this.expression.evaluate({zoom:0,brightness:T},c,f,void 0,u);this._setPaintValue(t,r,L,this.context)}_setPaintValue(t,r,c,f){if(this.type==="color"){const u=up(c.toRenderColor(f.lut));for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wl{constructor(t,r,c,f,u,m){this.expression=t,this.uniformNames=r.map(T=>`u_${T}_t`),this.type=c,this.useIntegerZoom=f,this.context=u,this.maxValue=0,this.paintVertexAttributes=r.map(T=>({name:`a_${T}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,r,c,f,u,m,T){const L=this.expression.evaluate(new Qs(this.context.zoom,{brightness:m}),r,{},u,f,T),D=this.expression.evaluate(new Qs(this.context.zoom+1,{brightness:m}),r,{},u,f,T),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,L,D,this.context)}updatePaintArray(t,r,c,f,u,m,T){const L=this.expression.evaluate({zoom:this.context.zoom,brightness:T},c,f,void 0,u),D=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T},c,f,void 0,u);this._setPaintValue(t,r,L,D,this.context)}_setPaintValue(t,r,c,f,u){if(this.type==="color"){const m=up(c.toRenderColor(u.lut)),T=up(c.toRenderColor(u.lut));for(let L=t;L<r;L++)this.paintVertexArray.emplace(L,m[0],m[1],T[0],T[1])}else{for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,c,f,u){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,T=Mt(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);r.set(t,u,T)}getBinding(t,r){return new lo(t)}}class rc{constructor(t,r,c,f,u){this.expression=t,this.layerId=u,this.paintVertexAttributes=(c==="array"?rp:wf).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new f}populatePaintArray(t,r,c,f){const u=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(u,t,r.patterns&&r.patterns[this.layerId],c)}updatePaintArray(t,r,c,f,u,m,T){this._setPaintValues(t,r,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(t,r,c,f){if(!f||!c)return;const u=f[c];if(!u)return;const{tl:m,br:T,pixelRatio:L}=u;for(let D=t;D<r;D++)this.paintVertexArray.emplace(D,m[0],m[1],T[0],T[1],L)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sc{constructor(t,r,c=()=>!0){this.binders={},this._buffers=[],this.context=r;const f=[];for(const u in t.paint._values){const m=t.paint.get(u);if(!c(u)||!(m instanceof Rc&&cu(m.property.specification)))continue;const T=Vg(u,t.type),L=m.value,D=m.property.specification.type,b=!!m.property.useIntegerZoom,C=u==="line-dasharray"||u.endsWith("pattern"),R=u==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(L.kind!=="constant"||R)if(L.kind==="source"||R||C){const A=Au(u,D,"source");this.binders[u]=C?new rc(L,T,D,A,t.id):new nc(L,T,D,A),f.push(`/a_${u}`)}else{const A=Au(u,D,"composite");this.binders[u]=new wl(L,T,D,b,r,A),f.push(`/z_${u}`)}else this.binders[u]=C?new Vl(L.value,T):new nl(L.value,T,D,r),f.push(`/u_${u}`)}this.cacheKey=f.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof nc||r instanceof wl?r.maxValue:0}populatePaintArrays(t,r,c,f,u,m,T){for(const L in this.binders){const D=this.binders[L];D.context=this.context,(D instanceof nc||D instanceof wl||D instanceof rc)&&D.populatePaintArray(t,r,c,f,u,m,T)}}setConstantPatternPositions(t){for(const r in this.binders){const c=this.binders[r];c instanceof Vl&&c.setConstantPatternPositions(t)}}updatePaintArrays(t,r,c,f,u,m,T,L){let D=!1;const b=Object.keys(t),C=b.length!==0,R=C?b:r.uniqueIds;this.context.lut=u.lut;for(const A in this.binders){const I=this.binders[A];if(I.context=this.context,(I instanceof nc||I instanceof wl||I instanceof rc)&&(I.expression.isStateDependent===!0||I.expression.isLightConstant===!1)){const k=u.paint.get(A);I.expression=k.value;for(const W of R){const $=t[W.toString()];r.eachPosition(W,(ee,te,X)=>{const le=f.feature(ee);I.updatePaintArray(te,X,le,$,m,T,L)})}if(!C)for(const W of c.uniqueIds){const $=t[W.toString()];c.eachPosition(W,(ee,te,X)=>{const le=f.feature(ee);I.updatePaintArray(te,X,le,$,m,T,L)})}D=!0}}return D}defines(){const t=[];for(const r in this.binders){const c=this.binders[r];(c instanceof nl||c instanceof Vl)&&t.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const c=this.binders[r];if(c instanceof nc||c instanceof wl||c instanceof rc)for(let f=0;f<c.paintVertexAttributes.length;f++)t.push(c.paintVertexAttributes[f].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const c=this.binders[r];if(c instanceof nl||c instanceof Vl||c instanceof wl)for(const f of c.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof nl||f instanceof Vl||f instanceof wl)for(const u of f.uniformNames)r.push({name:u,property:c,binding:f.getBinding(t,u)})}return r}setUniforms(t,r,c,f,u){for(const{name:m,property:T,binding:L}of c)this.binders[T].setUniform(t,L,u,f.get(T),m)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof nc||r instanceof wl||r instanceof rc)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(t){for(const r in this.binders){const c=this.binders[r];(c instanceof nc||c instanceof wl||c instanceof rc)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof nc||r instanceof wl||r instanceof rc)&&r.destroy()}}}class Gl{constructor(t,r,c=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new sc(f,r,c);this.needsUpload=!1,this._featureMap=new Su,this._featureMapWithoutIds=new Su,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,r,c,f,u,m,T,L){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(t,r,f,u,m,T,L);r.id!==void 0?this._featureMap.add(r.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,c,f,u,m){for(const T of c)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,r,T,f,u,m||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Ug={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Vg(a,t){return Ug[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}const Tf={"line-pattern":{source:ic,composite:ic},"fill-pattern":{source:ic,composite:ic},"fill-extrusion-pattern":{source:ic,composite:ic},"line-dasharray":{source:gu,composite:gu}},Gg={color:{source:xu,composite:va},number:{source:Ra,composite:xu}};function Au(a,t,r){const c=Tf[a];return c&&c[r]||Gg[t][r]}Sn(nl,"ConstantBinder"),Sn(Vl,"PatternConstantBinder"),Sn(nc,"SourceExpressionBinder"),Sn(rc,"PatternCompositeBinder"),Sn(wl,"CompositeExpressionBinder"),Sn(sc,"ProgramConfiguration",{omit:["_buffers"]}),Sn(Gl,"ProgramConfigurationSet");const Qo=un/Math.PI/2,ho=5,h=6,i=16383,s=64,d=[s,32,16],x=-Qo,w=Qo;function E(a,t,r,c=Qo){return r=Fe(r),[a*Math.sin(r)*c,-t*c,a*Math.cos(r)*c]}function O(a,t,r){return E(Math.cos(Fe(a)),Math.sin(Fe(a)),t,r)}const B=63710088e-1,j=2*Math.PI*B;class H{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new H(xi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,c=this.lat*r,f=t.lat*r,u=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((t.lng-this.lng)*r);return B*Math.acos(Math.min(u,1))}toBounds(t=0){const r=360*t/40075017,c=r/Math.cos(Math.PI/180*this.lat);return new Z({lng:this.lng-c,lat:this.lat-r},{lng:this.lng+c,lat:this.lat+r})}toEcef(t){return O(this.lat,this.lng,Qo+t*Qo/B)}static convert(t){if(t instanceof H)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new H(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new H(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Z{constructor(t,r){if(t)if(r)this.setSouthWest(t).setNorthEast(r);else if(t.length===4){const c=t;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=t;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(t){return this._ne=t instanceof H?new H(t.lng,t.lat):H.convert(t),this}setSouthWest(t){return this._sw=t instanceof H?new H(t.lng,t.lat):H.convert(t),this}extend(t){const r=this._sw,c=this._ne;let f,u;if(t instanceof H)f=t,u=t;else{if(!(t instanceof Z))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Z.convert(t)):this.extend(H.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(H.convert(t)):this;if(f=t._sw,u=t._ne,!f||!u)return this}return r||c?(r.lng=Math.min(f.lng,r.lng),r.lat=Math.min(f.lat,r.lat),c.lng=Math.max(u.lng,c.lng),c.lat=Math.max(u.lat,c.lat)):(this._sw=new H(f.lng,f.lat),this._ne=new H(u.lng,u.lat)),this}getCenter(){return new H((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new H(this.getWest(),this.getNorth())}getSouthEast(){return new H(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:c}=H.convert(t);let f=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(t){if(t)return t instanceof Z?t:new Z(t)}}const Y=0,se=25.5;function pe(a){return j*Math.cos(a*Math.PI/180)}function ue(a){return(180+a)/360}function _e(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ge(a,t){return a/pe(t)}function Oe(a){return 360*a-180}function Ne(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ue(a,t){return a*pe(Ne(t))}const $e=85.051129;function Ke(a){return Math.cos(Fe(Mt(a,-$e,$e)))}function Ze(a,t){const r=Mt(t,Y,se),c=Math.pow(2,r);return Ke(a)*j/(512*c)}function it(a){return 1/Math.cos(a*Math.PI/180)}function gt(a,t=0){const r=Math.exp(Math.PI*(1-(a.y+t/un)/(1<<a.z)*2));return 80150034*r/(r*r+1)/un/(1<<a.z)}class Lt{constructor(t,r,c=0){this.x=+t,this.y=+r,this.z=+c}static fromLngLat(t,r=0){const c=H.convert(t);return new Lt(ue(c.lng),_e(c.lat),ge(r,c.lat))}toLngLat(){return new H(Oe(this.x),Ne(this.y))}toAltitude(){return Ue(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/j*it(Ne(this.y))}}function wt(a,t,r,c,f,u,m,T,L){const D=(t+c)/2,b=(r+f)/2,C=new je(D,b);T(C),function(R,A,I,k,W,$){const ee=I-W,te=k-$;return Math.abs((k-A)*ee-(I-R)*te)/Math.hypot(ee,te)}(C.x,C.y,u.x,u.y,m.x,m.y)>=L?(wt(a,t,r,D,b,u,C,T,L),wt(a,D,b,c,f,C,m,T,L)):a.push(m)}function vt(a,t,r){let c=a[0],f=c.x,u=c.y;t(c);const m=[c];for(let T=1;T<a.length;T++){const L=a[T],{x:D,y:b}=L;t(L),wt(m,f,u,D,b,c,L,t,r),f=D,u=b,c=L}return m}function ri(a,t,r,c){if(c(t,r)){const f=t.add(r)._mult(.5);ri(a,t,f,c),ri(a,f,r,c)}else a.push(r)}function hi(a,t){let r=a[0];const c=[r];for(let f=1;f<a.length;f++){const u=a[f];ri(c,r,u,t),r=u}return c}const Si=Math.pow(2,14)-1,Gi=-Si-1;function Ki(a,t){const r=Math.round(a.x*t),c=Math.round(a.y*t);return a.x=Mt(r,Gi,Si),a.y=Mt(c,Gi,Si),(r<a.x||r>a.x+1||c<a.y||c>a.y+1)&&Wn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Wt(a,t,r){const c=a.loadGeometry(),f=a.extent,u=un/f;if(t&&r&&r.projection.isReprojectedInTileSpace){const m=1<<t.z,{scale:T,x:L,y:D,projection:b}=r,C=R=>{const A=Oe((t.x+R.x/f)/m),I=Ne((t.y+R.y/f)/m),k=b.project(A,I);R.x=(k.x*T-L)*f,R.y=(k.y*T-D)*f};for(let R=0;R<c.length;R++)if(a.type!==1)c[R]=vt(c[R],C,1);else{const A=[];for(const I of c[R])I.x<0||I.x>=f||I.y<0||I.y>=f||(C(I),A.push(I));c[R]=A}}for(const m of c)for(const T of m)Ki(T,u);return c}function wi(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Wt(a):[]}}function ui(a,t,r,c,f){a.emplaceBack(2*t+(c+1)/2,2*r+(f+1)/2)}function Ti(a,t,r){a.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ci{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ec,this.indexArray=new qs,this.segments=new Ks,this.programConfigurations=new Gl(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(t,r){}populate(t,r,c,f){const u=this.layers[0],m=[];let T=null;u.type==="circle"&&(T=u.layout.get("circle-sort-key"));for(const{feature:D,id:b,index:C,sourceLayerIndex:R}of t){const A=this.layers[0]._featureFilter.needGeometry,I=wi(D,A);if(!this.layers[0]._featureFilter.filter(new Qs(this.zoom),I,c))continue;const k=T?T.evaluate(I,{},c):void 0,W={id:b,properties:D.properties,type:D.type,sourceLayerIndex:R,index:C,geometry:A?I.geometry:Wt(D,c,f),patterns:{},sortKey:k};m.push(W)}T&&m.sort((D,b)=>D.sortKey-b.sortKey);let L=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new vl,L=f.projection);for(const D of m){const{geometry:b,index:C,sourceLayerIndex:R}=D,A=t[C].feature;this.addFeature(D,b,C,r.availableImages,c,L,r.brightness),r.featureIndex.insert(A,b,C,R,this.index)}}update(t,r,c,f,u){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,m?this.stateDependentLayers:this.layers,c,f,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bf.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,ja.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,r,c,f,u,m,T){for(const L of r)for(const D of L){const b=D.x,C=D.y;if(b<0||b>=un||C<0||C>=un)continue;if(m){const I=m.projectTilePoint(b,C,u),k=m.upVector(u,b,C),W=this.globeExtVertexArray;Ti(W,I,k),Ti(W,I,k),Ti(W,I,k),Ti(W,I,k)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=R.vertexLength;ui(this.layoutVertexArray,b,C,-1,-1),ui(this.layoutVertexArray,b,C,1,-1),ui(this.layoutVertexArray,b,C,1,1),ui(this.layoutVertexArray,b,C,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},f,u,T)}}function mi(a,t){for(let r=0;r<a.length;r++)if(Nr(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(Nr(a,t[r]))return!0;return!!An(a,t)}function Xi(a,t,r){return!!Nr(a,t)||!!dn(t,a,r)}function zn(a,t){if(a.length===1)return dr(t,a[0]);for(let r=0;r<t.length;r++){const c=t[r];for(let f=0;f<c.length;f++)if(Nr(a,c[f]))return!0}for(let r=0;r<a.length;r++)if(dr(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(An(a,t[r]))return!0;return!1}function $n(a,t,r){if(a.length>1){if(An(a,t))return!0;for(let c=0;c<t.length;c++)if(dn(t[c],a,r))return!0}for(let c=0;c<a.length;c++)if(dn(a[c],t,r))return!0;return!1}function An(a,t){if(a.length===0||t.length===0)return!1;for(let r=0;r<a.length-1;r++){const c=a[r],f=a[r+1];for(let u=0;u<t.length-1;u++)if(kn(c,f,t[u],t[u+1]))return!0}return!1}function kn(a,t,r,c){return Ls(a,r,c)!==Ls(t,r,c)&&Ls(a,t,r)!==Ls(a,t,c)}function dn(a,t,r){const c=r*r;if(t.length===1)return a.distSqr(t[0])<c;for(let f=1;f<t.length;f++)if(tr(a,t[f-1],t[f])<c)return!0;return!1}function tr(a,t,r){const c=t.distSqr(r);if(c===0)return a.distSqr(t);const f=((a.x-t.x)*(r.x-t.x)+(a.y-t.y)*(r.y-t.y))/c;return a.distSqr(f<0?t:f>1?r:r.sub(t)._mult(f)._add(t))}function dr(a,t){let r,c,f,u=!1;for(let m=0;m<a.length;m++){r=a[m];for(let T=0,L=r.length-1;T<r.length;L=T++)c=r[T],f=r[L],c.y>t.y!=f.y>t.y&&t.x<(f.x-c.x)*(t.y-c.y)/(f.y-c.y)+c.x&&(u=!u)}return u}function Nr(a,t){let r=!1;for(let c=0,f=a.length-1;c<a.length;f=c++){const u=a[c],m=a[f];u.y>t.y!=m.y>t.y&&t.x<(m.x-u.x)*(t.y-u.y)/(m.y-u.y)+u.x&&(r=!r)}return r}function as(a,t,r,c,f){for(const m of a)if(t<=m.x&&r<=m.y&&c>=m.x&&f>=m.y)return!0;const u=[new je(t,r),new je(t,f),new je(c,f),new je(c,r)];if(a.length>2){for(const m of u)if(Nr(a,m))return!0}for(let m=0;m<a.length-1;m++)if(Ur(a[m],a[m+1],u))return!0;return!1}function Ur(a,t,r){const c=r[0],f=r[2];if(a.x<c.x&&t.x<c.x||a.x>f.x&&t.x>f.x||a.y<c.y&&t.y<c.y||a.y>f.y&&t.y>f.y)return!1;const u=Ls(a,t,r[0]);return u!==Ls(a,t,r[1])||u!==Ls(a,t,r[2])||u!==Ls(a,t,r[3])}function vs(a,t,r,c,f,u){let m=t.y-a.y,T=a.x-t.x;if(u=u||0){const L=m*m+T*T;if(L===0)return!0;const D=Math.sqrt(L);m/=D,T/=D}return!((r.x-a.x)*m+(r.y-a.y)*T-u<0||(c.x-a.x)*m+(c.y-a.y)*T-u<0||(f.x-a.x)*m+(f.y-a.y)*T-u<0)}function Xr(a,t,r,c,f,u,m){return!(vs(a,t,c,f,u,m)||vs(t,r,c,f,u,m)||vs(r,a,c,f,u,m)||vs(c,f,a,t,r,m)||vs(f,u,a,t,r,m)||vs(u,c,a,t,r,m))}function Ss(a,t,r){const c=t.paint.get(a).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(a)}function br(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ds(a,t,r,c,f){if(!t[0]&&!t[1])return a;const u=je.convert(t)._mult(f);r==="viewport"&&u._rotate(-c);const m=[];for(let T=0;T<a.length;T++)m.push(a[T].sub(u));return m}function ps(a,t,r,c){const f=je.convert(a)._mult(c);return t==="viewport"&&f._rotate(-r),f}let Er,ts;Sn(Ci,"CircleBucket",{omit:["layers"]});var Gs,ea={exports:{}},qa=(Gs||(Gs=1,function(a,t){(function(r){function c(u,m,T){var L=f(256*u,256*(m=Math.pow(2,T)-m-1),T),D=f(256*(u+1),256*(m+1),T);return L[0]+","+L[1]+","+D[0]+","+D[1]}function f(u,m,T){var L=2*Math.PI*6378137/256/Math.pow(2,T);return[u*L-2*Math.PI*6378137/2,m*L-2*Math.PI*6378137/2]}r.getURL=function(u,m,T,L,D,b){return b=b||{},u+"?"+["bbox="+c(T,L,D),"format="+(b.format||"image/png"),"service="+(b.service||"WMS"),"version="+(b.version||"1.1.1"),"request="+(b.request||"GetMap"),"srs="+(b.srs||"EPSG:3857"),"width="+(b.width||256),"height="+(b.height||256),"layers="+m].join("&")},r.getTileBBox=c,r.getMercCoords=f,Object.defineProperty(r,"__esModule",{value:!0})})(t)}(0,ea.exports)),ea.exports);class Mo{constructor(t,r,c){this.z=t,this.x=r,this.y=c,this.key=Yr(0,t,t,r,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r){const c=qa.getTileBBox(this.x,this.y,this.z),f=function(u,m,T){let L,D="";for(let b=u;b>0;b--)L=1<<b-1,D+=(m&L?1:0)+(T&L?2:0);return D}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wr{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Yr(t,r.z,r.z,r.x,r.y)}}class Hr{constructor(t,r,c,f,u){this.overscaledZ=t,this.wrap=r,this.canonical=new Mo(c,+f,+u),this.key=r===0&&t===c?this.canonical.key:Yr(r,t,c,f,u)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new Hr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return Yr(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return Yr(this.wrap*+r,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new Hr(r,this.wrap,r,c,f),new Hr(r,this.wrap,r,c+1,f),new Hr(r,this.wrap,r,c,f+1),new Hr(r,this.wrap,r,c+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Hr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Yr(a,t,r,c,f){const u=1<<Math.min(r,22);let m=u*(f%u)+c%u;return a&&r<22&&(m+=u*u*((a<0?-2*a-1:2*a)%(1<<2*(22-r)))),16*(32*m+r)+(t-r)}const is=[a=>{let t=a.canonical.x-1,r=a.wrap;return t<0&&(t=(1<<a.canonical.z)-1,r--),new Hr(a.overscaledZ,r,a.canonical.z,t,a.canonical.y)},a=>{let t=a.canonical.x+1,r=a.wrap;return t===1<<a.canonical.z&&(t=0,r++),new Hr(a.overscaledZ,r,a.canonical.z,t,a.canonical.y)},a=>new Hr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Hr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Sn(Mo,"CanonicalTileID"),Sn(Hr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Es=Qr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Os}=Es,Ro=Qr([{name:"a_pos_3",components:3,type:"Int16"}]);var Tl=Qr([{name:"a_pos",type:"Int16",components:2}]);class xa{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,c){const f=Qe.vec3.dot(r,this.dir);if(Math.abs(f)<1e-6)return!1;const u=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/f;return c[0]=this.pos[0]+this.dir[0]*u,c[1]=this.pos[1]+this.dir[1]*u,c[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(t,r,c){if(Qe.vec3.equals(this.pos,t)||r===0)return c[0]=c[1]=c[2]=0,!1;const[f,u,m]=this.dir,T=this.pos[0]-t[0],L=this.pos[1]-t[1],D=this.pos[2]-t[2],b=f*f+u*u+m*m,C=2*(T*f+L*u+D*m),R=C*C-4*b*(T*T+L*L+D*D-r*r);if(R<0){const A=Math.max(-C/2,0),I=T+f*A,k=L+u*A,W=D+m*A,$=Math.hypot(I,k,W);return c[0]=I*r/$,c[1]=k*r/$,c[2]=W*r/$,!1}{const A=(-C-Math.sqrt(R))/(2*b);if(A<0){const I=Math.hypot(T,L,D);return c[0]=T*r/I,c[1]=L*r/I,c[2]=D*r/I,!1}return c[0]=T+f*A,c[1]=L+u*A,c[2]=D+m*A,!0}}}class aa{constructor(t,r,c,f,u){this.TL=t,this.TR=r,this.BR=c,this.BL=f,this.horizon=u}static fromInvProjectionMatrix(t,r,c){const f=[-1,1,1],u=[1,1,1],m=[1,-1,1],T=[-1,-1,1],L=Qe.vec3.transformMat4(f,f,t),D=Qe.vec3.transformMat4(u,u,t),b=Qe.vec3.transformMat4(m,m,t),C=Qe.vec3.transformMat4(T,T,t);return new aa(L,D,b,C,r/c)}}function $a(a,t,r){let c=1/0,f=-1/0;const u=[];for(const m of a){Qe.vec3.sub(u,m,t);const T=Qe.vec3.dot(u,r);c=Math.min(c,T),f=Math.max(f,T)}return[c,f]}function Za(a,t){let r=!0;for(let c=0;c<a.planes.length;c++){const f=a.planes[c];let u=0;for(let m=0;m<t.length;m++)u+=Qe.vec3.dot(f,t[m])+f[3]>=0;if(u===0)return 0;u!==t.length&&(r=!1)}return r?2:1}function ba(a,t){for(const r of a.projections){const c=$a(t,a.points[0],r.axis);if(r.projection[1]<c[0]||r.projection[0]>c[1])return 0}return 1}function Xa(a,t){let r=0;const c=[0,0,0,0];for(let f=0;f<a.length;f++)c[0]=a[f][0],c[1]=a[f][1],c[2]=a[f][2],c[3]=1,Qe.vec4.dot(c,t)>=0&&r++;return r}class Pa{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=ls.fromPoints(this.points),this.projections=[],this.frustumEdges=[Qe.vec3.sub([],this.points[2],this.points[3]),Qe.vec3.sub([],this.points[0],this.points[3]),Qe.vec3.sub([],this.points[4],this.points[0]),Qe.vec3.sub([],this.points[5],this.points[1]),Qe.vec3.sub([],this.points[6],this.points[2]),Qe.vec3.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const f=[0,-c[2],c[1]],u=[c[2],0,-c[0]];this.projections.push({axis:f,projection:$a(this.points,this.points[0],f)}),this.projections.push({axis:u,projection:$a(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(t,r,c,f){const u=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const b=Qe.vec4.transformMat4([],D,t),C=1/b[3]/r*u;return Qe.vec4.mul(b,b,[C,C,f?1/b[3]:C,C])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const b=Qe.vec3.sub([],m[D[0]],m[D[1]]),C=Qe.vec3.sub([],m[D[2]],m[D[1]]),R=Qe.vec3.normalize([],Qe.vec3.cross([],b,C)),A=-Qe.vec3.dot(R,m[D[1]]);return R.concat(A)}),L=[];for(let D=0;D<m.length;D++)L.push([m[D][0],m[D][1],m[D][2]]);return new Pa(L,T)}intersectsPrecise(t,r,c){for(let f=0;f<r.length;f++)if(!Xa(t,r[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!Xa(t,this.planes[f]))return 0;for(const f of c)for(const u of this.frustumEdges){const m=Qe.vec3.cross([],f,u),T=Qe.vec3.length(m);if(T===0)continue;Qe.vec3.scale(m,m,1/T);const L=$a(this.points,this.points[0],m),D=$a(t,this.points[0],m);if(L[0]>D[1]||D[0]>L[1])return 0}return 1}containsPoint(t){for(const r of this.planes){const c=r[3];if(Qe.vec3.dot([r[0],r[1],r[2]],t)+c<0)return!1}return!0}}class ls{static fromPoints(t){const r=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const f of t)Qe.vec3.min(r,r,f),Qe.vec3.max(c,c,f);return new ls(r,c)}static fromTileIdAndHeight(t,r,c){const f=1<<t.canonical.z,u=t.canonical.x,m=t.canonical.y;return new ls([u/f,m/f,r],[(u+1)/f,(m+1)/f,c])}static applyTransform(t,r){const c=t.getCorners();for(let f=0;f<c.length;++f)Qe.vec3.transformMat4(c[f],c[f],r);return ls.fromPoints(c)}static applyTransformFast(t,r){const c=[r[12],r[13],r[14]],f=[...c];for(let u=0;u<3;u++)for(let m=0;m<3;m++){const T=r[4*m+u],L=T*t.min[m],D=T*t.max[m];c[u]+=Math.min(L,D),f[u]+=Math.max(L,D)}return new ls(c,f)}static projectAabbCorners(t,r){const c=t.getCorners();for(let f=0;f<c.length;++f)Qe.vec3.transformMat4(c[f],c[f],r);return c}constructor(t,r){this.min=t,this.max=r,this.center=Qe.vec3.scale([],Qe.vec3.add([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],c=Qe.vec3.clone(this.min),f=Qe.vec3.clone(this.max);for(let u=0;u<r.length;u++)c[u]=r[u]?this.min[u]:this.center[u],f[u]=r[u]?this.center[u]:this.max[u];return f[2]=this.max[2],new ls(c,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Za(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Za(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,r){return r||this.intersects(t)?ba(t,this.getCorners()):0}intersectsPreciseFlat(t,r){return r||this.intersectsFlat(t)?ba(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let r=0;r<3;++r)if(this.min[r]>t.max[r]||t.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t.min[r]),this.max[r]=Math.max(this.max[r],t.max[r])}encapsulatePoint(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t[r]),this.max[r]=Math.max(this.max[r],t[r])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function Gc(a){return a*Qo/B}Sn(ls,"Aabb");const hp=[new ls([x,x,x],[w,w,w]),new ls([x,x,x],[0,0,w]),new ls([0,x,x],[w,0,w]),new ls([x,0,x],[0,w,w]),new ls([0,0,x],[w,w,w])];function Hc(a,t,r,c=!0){const f=Qe.vec3.scale([],a._camera.position,a.worldSize),u=[t,r,1,1];Qe.vec4.transformMat4(u,u,a.pixelMatrixInverse),Qe.vec4.scale(u,u,1/u[3]);const m=Qe.vec3.sub([],u,f),T=Qe.vec3.normalize([],m),L=a.globeMatrix,D=[L[12],L[13],L[14]],b=Qe.vec3.sub([],D,f),C=Qe.vec3.length(b),R=Qe.vec3.normalize([],b),A=a.worldSize/(2*Math.PI),I=Qe.vec3.dot(R,T),k=Math.asin(A/C);if(k<Math.acos(I)){if(!c)return null;const yt=[],ke=[];Qe.vec3.scale(yt,T,C/I),Qe.vec3.normalize(ke,Qe.vec3.sub(ke,yt,b)),Qe.vec3.normalize(T,Qe.vec3.add(T,b,Qe.vec3.scale(T,ke,Math.tan(k)*C)))}const W=[];new xa(f,T).closestPointOnSphere(D,A,W);const $=Qe.vec3.normalize([],no(L,0)),ee=Qe.vec3.normalize([],no(L,1)),te=Qe.vec3.normalize([],no(L,2)),X=Qe.vec3.dot($,W),le=Qe.vec3.dot(ee,W),he=Qe.vec3.dot(te,W),Me=Ge(Math.asin(-le/A));let He=Ge(Math.atan2(X,he));He=a.center.lng+function(yt,ke){const dt=(ke-yt+180)%360-180;return dt<-180?dt+360:dt}(a.center.lng,He);const ze=ue(He),Be=Mt(_e(Me),0,1);return new Lt(ze,Be)}class sd{constructor(t,r,c){this.a=Qe.vec3.sub([],t,c),this.b=Qe.vec3.sub([],r,c),this.center=c;const f=Qe.vec3.normalize([],this.a),u=Qe.vec3.normalize([],this.b);this.angle=Math.acos(Qe.vec3.dot(f,u))}}function Cu(a,t){if(a.angle===0)return null;let r;return r=a.a[t]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[t]/a.a[t]/Math.sin(a.angle)-1/Math.tan(a.angle)),r<0||r>1?null:function(c,f,u,m){const T=Math.sin(u);return c*(Math.sin((1-m)*u)/T)+f*(Math.sin(m*u)/T)}(a.a[t],a.b[t],a.angle,Mt(r,0,1))+a.center[t]}function Hl(a){if(a.z<=1)return hp[a.z+2*a.y+a.x];const t=Cm(dp(a));return ls.fromPoints(t)}function Ml(a,t,r){return Qe.vec3.scale(a,a,1-r),Qe.vec3.scaleAndAdd(a,a,t,r)}function Hg(a,t,r){for(const c of a)Qe.vec3.transformMat4(c,c,t),Qe.vec3.scale(c,c,r)}function Mf(a,t,r,c){const f=t/a.worldSize,u=a.globeMatrix;if(r.z<=1){const ze=Hl(r).getCorners();return Hg(ze,u,f),ls.fromPoints(ze)}const m=dp(r,c),T=Cm(m,Qo+Gc(a._tileCoverLift));Hg(T,u,f);const L=Number.MAX_VALUE,D=[-L,-L,-L],b=[L,L,L];if(m.contains(a.center)){for(const yt of T)Qe.vec3.min(b,b,yt),Qe.vec3.max(D,D,yt);D[2]=0;const ze=a.point,Be=[ze.x*f,ze.y*f,0];return Qe.vec3.min(b,b,Be),Qe.vec3.max(D,D,Be),new ls(b,D)}if(a._tileCoverLift>0){for(const ze of T)Qe.vec3.min(b,b,ze),Qe.vec3.max(D,D,ze);return new ls(b,D)}const C=[u[12]*f,u[13]*f,u[14]*f],R=m.getCenter(),A=Mt(a.center.lat,-$e,$e),I=Mt(R.lat,-$e,$e),k=ue(a.center.lng),W=_e(A);let $=k-ue(R.lng);const ee=W-_e(I);$>.5?$-=1:$<-.5&&($+=1);let te=0;if(Math.abs($)>Math.abs(ee))te=$>=0?1:3;else{te=ee>=0?0:2;const ze=[u[4]*f,u[5]*f,u[6]*f],Be=-Math.sin(Fe(ee>=0?m.getSouth():m.getNorth()))*Qo;Qe.vec3.scaleAndAdd(C,C,ze,Be)}const X=T[te],le=T[(te+1)%4],he=new sd(X,le,C),Me=[Cu(he,0)||X[0],Cu(he,1)||X[1],Cu(he,2)||X[2]],He=jc(a.zoom);if(He>0){const ze=function({x:yt,y:ke,z:dt},Et,Ct,Bt,ei){const ni=1/(1<<dt);let Yt=yt*ni,yi=Yt+ni,Fi=ke*ni,di=Fi+ni,Tn=0;const ln=(Yt+yi)/2-Bt;return ln>.5?Tn=-1:ln<-.5&&(Tn=1),Yt=((Yt+Tn)*Et-(Bt*=Et))*Ct+Bt,yi=((yi+Tn)*Et-Bt)*Ct+Bt,Fi=(Fi*Et-(ei*=Et))*Ct+ei,di=(di*Et-ei)*Ct+ei,[[Yt,di,0],[yi,di,0],[yi,Fi,0],[Yt,Fi,0]]}(r,t,a._pixelsPerMercatorPixel,k,W);for(let yt=0;yt<T.length;yt++)Ml(T[yt],ze[yt],He);const Be=Qe.vec3.add([],ze[te],ze[(te+1)%4]);Qe.vec3.scale(Be,Be,.5),Ml(Me,Be,He)}for(const ze of T)Qe.vec3.min(b,b,ze),Qe.vec3.max(D,D,ze);return b[2]=Math.min(X[2],le[2]),Qe.vec3.min(b,b,Me),Qe.vec3.max(D,D,Me),new ls(b,D)}function dp({x:a,y:t,z:r},c=!1){const f=1/(1<<r),u=new H(Oe(a*f),t===(1<<r)-1&&c?-90:Ne((t+1)*f)),m=new H(Oe((a+1)*f),t===0&&c?90:Ne(t*f));return new Z(u,m)}function Cm(a,t=Qo){const r=Fe(a.getNorth()),c=Fe(a.getSouth()),f=Math.cos(r),u=Math.cos(c),m=Math.sin(r),T=Math.sin(c),L=a.getWest(),D=a.getEast();return[E(u,T,L,t),E(u,T,D,t),E(f,m,D,t),E(f,m,L,t)]}function Sf(a,t,r,c){const f=1<<r.z,u=(a/un+r.x)/f;return O(Ne((t/un+r.y)/f),Oe(u),c)}function Ef({min:a,max:t}){return i/Math.max(t[0]-a[0],t[1]-a[1],t[2]-a[2])}const jg=new Float64Array(16);function Af(a){const t=Ef(a),r=Qe.mat4.fromScaling(jg,[t,t,t]);return Qe.mat4.translate(r,r,Qe.vec3.negate([],a.min))}function Lm(a){const t=Qe.mat4.fromTranslation(jg,a.min),r=1/Ef(a);return Qe.mat4.scale(t,t,[r,r,r])}function Cf(a){const t=un/(2*Math.PI);return a/(2*Math.PI)/t}function ay(a,t){return un/(512*Math.pow(2,a))*Ef(Hl(t))}function Lf(a,t,r,c,f){const u=Cf(r),m=[a,t,-r/(2*Math.PI)],T=Qe.mat4.identity(new Float64Array(16));return Qe.mat4.translate(T,T,m),Qe.mat4.scale(T,T,[u,u,u]),Qe.mat4.rotateX(T,T,Fe(-f)),Qe.mat4.rotateY(T,T,Fe(-c)),T}function jc(a){return ci(ho,h,a)}function Wg(a,t){const r=O(t.lat,t.lng),c=function(u){const m=O(u._center.lat,u._center.lng),T=Qe.vec3.fromValues(0,1,0);let L=Qe.vec3.cross([],T,m);const D=Qe.mat4.fromRotation([],-u.angle,m);L=Qe.vec3.transformMat4(L,L,D),Qe.mat4.fromRotation(D,-u._pitch,L);const b=Qe.vec3.normalize([],m);return Qe.vec3.scale(b,b,Gc(u.cameraToCenterDistance/u.pixelsPerMeter)),Qe.vec3.transformMat4(b,b,D),Qe.vec3.add([],m,b)}(a),f=Qe.vec3.subtract([],c,r);return Qe.vec3.angle(f,r)}function Im(a,t){return Wg(a,t)>Math.PI/2*1.01}const qg=Fe(85),ly=Math.cos(qg),cy=Math.sin(qg),uy=Qe.mat4.create(),$g=a=>{const t=[];return a.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function gh(a,t,r,c,f,u,m,T,L){if(u&&a.queryGeometry.isAboveHorizon)return!1;u&&(L*=a.pixelToTileUnitsFactor);const D=a.tileID.canonical,b=r.projection.upVectorScale(D,r.center.lat,r.worldSize).metersToTile;for(const C of t)for(const R of C){const A=R.add(T),I=f&&r.elevation?r.elevation.exaggeration()*f.getElevationAt(A.x,A.y,!0):0,k=r.projection.projectTilePoint(A.x,A.y,D);if(I>0){const te=r.projection.upVector(D,A.x,A.y);k.x+=te[0]*b*I,k.y+=te[1]*b*I,k.z+=te[2]*b*I}const W=u?A:hy(k.x,k.y,k.z,c),$=u?a.tilespaceRays.map(te=>Zg(te,I)):a.queryGeometry.screenGeometry,ee=Qe.vec4.transformMat4([],[k.x,k.y,k.z,1],c);if(!m&&u?L*=ee[3]/r.cameraToCenterDistance:m&&!u&&(L*=r.cameraToCenterDistance/ee[3]),u){const te=Ne((R.y/un+D.y)/(1<<D.z));L/=r.projection.pixelsPerMeter(te,1)/ge(1,te)}if(Xi($,W,L))return!0}return!1}function hy(a,t,r,c){const f=Qe.vec4.transformMat4([],[a,t,r,1],c);return new je(f[0]/f[3],f[1]/f[3])}const dy=Qe.vec3.fromValues(0,0,0),od=Qe.vec3.fromValues(0,0,1);function Zg(a,t){const r=Qe.vec3.create();return dy[2]=t,a.intersectsPlane(dy,od,r),new je(r[0],r[1])}class _h extends Ci{}let Xg,py,yh,Yg;function Kg(a,{width:t,height:r},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*r*c)throw new RangeError("mismatched image size")}else f=new Uint8Array(t*r*c);return a.width=t,a.height=r,a.data=f,a}function fy(a,t,r){const{width:c,height:f}=t;c===a.width&&f===a.height||(Jg(a,t,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,c),height:Math.min(a.height,f)},r,null),a.width=c,a.height=f,a.data=t.data)}function Jg(a,t,r,c,f,u,m,T){if(f.width===0||f.height===0)return t;if(f.width>a.width||f.height>a.height||r.x>a.width-f.width||r.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||c.x>t.width-f.width||c.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const L=a.data,D=t.data,b=u===4&&T;for(let C=0;C<f.height;C++){const R=((r.y+C)*a.width+r.x)*u,A=((c.y+C)*t.width+c.x)*u;if(b)for(let I=0;I<f.width;I++){const k=R+I*u+3,W=A+I*u;D[W+0]=255,D[W+1]=255,D[W+2]=255,D[W+3]=L[k]}else if(m)for(let I=0;I<f.width;I++){const k=R+I*u,W=A+I*u,$=L[k+3],ee=new Ee(L[k+0]/255*$,L[k+1]/255*$,L[k+2]/255*$,$).toRenderColor(m).toArray();D[W+0]=ee[0],D[W+1]=ee[1],D[W+2]=ee[2],D[W+3]=ee[3]}else for(let I=0;I<f.width*u;I++)D[A+I]=L[R+I]}return t}Sn(_h,"HeatmapBucket",{omit:["layers"]});class Wc{constructor(t,r){Kg(this,t,1,r)}resize(t){fy(this,new Wc(t),1)}clone(){return new Wc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,f,u){Jg(t,r,c,f,u,1,null)}}class wa{constructor(t,r){Kg(this,t,4,r)}resize(t){fy(this,new wa(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,c,f,u,m,T){Jg(t,r,c,f,u,4,m,T)}}class my{constructor(t,r){this.width=t.width,this.height=t.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function If(a){const t={},r=a.resolution||256,c=a.clips?a.clips.length:1,f=a.image||new wa({width:r,height:c}),u=(m,T,L)=>{t[a.evaluationKey]=L;const D=a.expression.evaluate(t);D&&(f.data[m+T+0]=Math.floor(255*D.r/D.a),f.data[m+T+1]=Math.floor(255*D.g/D.a),f.data[m+T+2]=Math.floor(255*D.b/D.a),f.data[m+T+3]=Math.floor(255*D.a))};if(a.clips)for(let m=0,T=0;m<c;++m,T+=4*r)for(let L=0,D=0;L<r;L++,D+=4){const b=L/(r-1),{start:C,end:R}=a.clips[m];u(T,D,C*(1-b)+R*b)}else for(let m=0,T=0;m<r;m++,T+=4)u(0,T,m/(r-1));return f}Sn(Wc,"AlphaImage"),Sn(wa,"RGBAImage");const lv=Qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:cv}=lv;function Rf(a,t,r=2){const c=t&&t.length,f=c?t[0]*r:a.length;let u=gy(a,0,f,r,!0);const m=[];if(!u||u.next===u.prev)return m;let T,L,D;if(c&&(u=function(b,C,R,A){const I=[];for(let k=0,W=C.length;k<W;k++){const $=gy(b,C[k]*A,k<W-1?C[k+1]*A:b.length,A,!1);$===$.next&&($.steiner=!0),I.push(fp($))}I.sort(vy);for(let k=0;k<I.length;k++)R=xy(I[k],R);return R}(a,t,u,r)),a.length>80*r){T=1/0,L=1/0;let b=-1/0,C=-1/0;for(let R=r;R<f;R+=r){const A=a[R],I=a[R+1];A<T&&(T=A),I<L&&(L=I),A>b&&(b=A),I>C&&(C=I)}D=Math.max(b-T,C-L),D=D!==0?32767/D:0}return pp(u,m,r,T,L,D,0),m}function gy(a,t,r,c,f){let u;if(f===function(m,T,L,D){let b=0;for(let C=T,R=L-D;C<L;C+=D)b+=(m[R]-m[C])*(m[C+1]+m[R+1]),R=C;return b}(a,t,r,c)>0)for(let m=t;m<r;m+=c)u=i_(m/c|0,a[m],a[m+1],u);else for(let m=r-c;m>=t;m-=c)u=i_(m/c|0,a[m],a[m+1],u);return u&&Pf(u,u.next)&&(Df(u),u=u.next),u}function Ms(a,t){if(!a)return a;t||(t=a);let r,c=a;do if(r=!1,c.steiner||!Pf(c,c.next)&&So(c.prev,c,c.next)!==0)c=c.next;else{if(Df(c),c=t=c.prev,c===c.next)break;r=!0}while(r||c!==t);return t}function pp(a,t,r,c,f,u,m){if(!a)return;!m&&u&&function(L,D,b,C){let R=L;do R.z===0&&(R.z=Pm(R.x,R.y,D,b,C)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==L);R.prevZ.nextZ=null,R.prevZ=null,function(A){let I,k=1;do{let W,$=A;A=null;let ee=null;for(I=0;$;){I++;let te=$,X=0;for(let he=0;he<k&&(X++,te=te.nextZ,te);he++);let le=k;for(;X>0||le>0&&te;)X!==0&&(le===0||!te||$.z<=te.z)?(W=$,$=$.nextZ,X--):(W=te,te=te.nextZ,le--),ee?ee.nextZ=W:A=W,W.prevZ=ee,ee=W;$=te}ee.nextZ=null,k*=2}while(I>1)}(R)}(a,c,f,u);let T=a;for(;a.prev!==a.next;){const L=a.prev,D=a.next;if(u?_y(a,c,f,u):uv(a))t.push(L.i,a.i,D.i),Df(a),a=D.next,T=D.next;else if((a=D)===T){m?m===1?pp(a=Rm(Ms(a),t),t,r,c,f,u,2):m===2&&yy(a,t,r,c,f,u):pp(Ms(a),t,r,c,f,u,1);break}}}function uv(a){const t=a.prev,r=a,c=a.next;if(So(t,r,c)>=0)return!1;const f=t.x,u=r.x,m=c.x,T=t.y,L=r.y,D=c.y,b=f<u?f<m?f:m:u<m?u:m,C=T<L?T<D?T:D:L<D?L:D,R=f>u?f>m?f:m:u>m?u:m,A=T>L?T>D?T:D:L>D?L:D;let I=c.next;for(;I!==t;){if(I.x>=b&&I.x<=R&&I.y>=C&&I.y<=A&&ad(f,T,u,L,m,D,I.x,I.y)&&So(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function _y(a,t,r,c){const f=a.prev,u=a,m=a.next;if(So(f,u,m)>=0)return!1;const T=f.x,L=u.x,D=m.x,b=f.y,C=u.y,R=m.y,A=T<L?T<D?T:D:L<D?L:D,I=b<C?b<R?b:R:C<R?C:R,k=T>L?T>D?T:D:L>D?L:D,W=b>C?b>R?b:R:C>R?C:R,$=Pm(A,I,t,r,c),ee=Pm(k,W,t,r,c);let te=a.prevZ,X=a.nextZ;for(;te&&te.z>=$&&X&&X.z<=ee;){if(te.x>=A&&te.x<=k&&te.y>=I&&te.y<=W&&te!==f&&te!==m&&ad(T,b,L,C,D,R,te.x,te.y)&&So(te.prev,te,te.next)>=0||(te=te.prevZ,X.x>=A&&X.x<=k&&X.y>=I&&X.y<=W&&X!==f&&X!==m&&ad(T,b,L,C,D,R,X.x,X.y)&&So(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;te&&te.z>=$;){if(te.x>=A&&te.x<=k&&te.y>=I&&te.y<=W&&te!==f&&te!==m&&ad(T,b,L,C,D,R,te.x,te.y)&&So(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;X&&X.z<=ee;){if(X.x>=A&&X.x<=k&&X.y>=I&&X.y<=W&&X!==f&&X!==m&&ad(T,b,L,C,D,R,X.x,X.y)&&So(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function Rm(a,t){let r=a;do{const c=r.prev,f=r.next.next;!Pf(c,f)&&e_(c,r,r.next,f)&&cd(c,f)&&cd(f,c)&&(t.push(c.i,r.i,f.i),Df(r),Df(r.next),r=a=f),r=r.next}while(r!==a);return Ms(r)}function yy(a,t,r,c,f,u){let m=a;do{let T=m.next.next;for(;T!==m.prev;){if(m.i!==T.i&&Dm(m,T)){let L=t_(m,T);return m=Ms(m,m.next),L=Ms(L,L.next),pp(m,t,r,c,f,u,0),void pp(L,t,r,c,f,u,0)}T=T.next}m=m.next}while(m!==a)}function vy(a,t){return a.x-t.x}function xy(a,t){const r=function(f,u){let m=u;const T=f.x,L=f.y;let D,b=-1/0;do{if(L<=m.y&&L>=m.next.y&&m.next.y!==m.y){const k=m.x+(L-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(k<=T&&k>b&&(b=k,D=m.x<m.next.x?m:m.next,k===T))return D}m=m.next}while(m!==u);if(!D)return null;const C=D,R=D.x,A=D.y;let I=1/0;m=D;do{if(T>=m.x&&m.x>=R&&T!==m.x&&ad(L<A?T:b,L,R,A,L<A?b:T,L,m.x,m.y)){const k=Math.abs(L-m.y)/(T-m.x);cd(m,f)&&(k<I||k===I&&(m.x>D.x||m.x===D.x&&Qg(D,m)))&&(D=m,I=k)}m=m.next}while(m!==C);return D}(a,t);if(!r)return t;const c=t_(r,a);return Ms(c,c.next),Ms(r,r.next)}function Qg(a,t){return So(a.prev,a,t.prev)<0&&So(t.next,a,a.next)<0}function Pm(a,t,r,c,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-r)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function fp(a){let t=a,r=a;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==a);return r}function ad(a,t,r,c,f,u,m,T){return(f-m)*(t-T)>=(a-m)*(u-T)&&(a-m)*(c-T)>=(r-m)*(t-T)&&(r-m)*(u-T)>=(f-m)*(c-T)}function Dm(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(r,c){let f=r;do{if(f.i!==r.i&&f.next.i!==r.i&&f.i!==c.i&&f.next.i!==c.i&&e_(f,f.next,r,c))return!0;f=f.next}while(f!==r);return!1}(a,t)&&(cd(a,t)&&cd(t,a)&&function(r,c){let f=r,u=!1;const m=(r.x+c.x)/2,T=(r.y+c.y)/2;do f.y>T!=f.next.y>T&&f.next.y!==f.y&&m<(f.next.x-f.x)*(T-f.y)/(f.next.y-f.y)+f.x&&(u=!u),f=f.next;while(f!==r);return u}(a,t)&&(So(a.prev,a,t.prev)||So(a,t.prev,t))||Pf(a,t)&&So(a.prev,a,a.next)>0&&So(t.prev,t,t.next)>0)}function So(a,t,r){return(t.y-a.y)*(r.x-t.x)-(t.x-a.x)*(r.y-t.y)}function Pf(a,t){return a.x===t.x&&a.y===t.y}function e_(a,t,r,c){const f=ld(So(a,t,r)),u=ld(So(a,t,c)),m=ld(So(r,c,a)),T=ld(So(r,c,t));return f!==u&&m!==T||!(f!==0||!oc(a,r,t))||!(u!==0||!oc(a,c,t))||!(m!==0||!oc(r,a,c))||!(T!==0||!oc(r,t,c))}function oc(a,t,r){return t.x<=Math.max(a.x,r.x)&&t.x>=Math.min(a.x,r.x)&&t.y<=Math.max(a.y,r.y)&&t.y>=Math.min(a.y,r.y)}function ld(a){return a>0?1:a<0?-1:0}function cd(a,t){return So(a.prev,a,a.next)<0?So(a,t,a.next)>=0&&So(a,a.prev,t)>=0:So(a,t,a.prev)<0||So(a,a.next,t)<0}function t_(a,t){const r=Om(a.i,a.x,a.y),c=Om(t.i,t.x,t.y),f=a.next,u=t.prev;return a.next=t,t.prev=a,r.next=f,f.prev=r,c.next=r,r.prev=c,u.next=c,c.prev=u,c}function i_(a,t,r,c){const f=Om(a,t,r);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Df(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Om(a,t,r){return{i:a,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Of(a,t){const r=a.length;if(r<=1)return[a];const c=[];let f,u;for(let m=0;m<r;m++){const T=bo(a[m]);T!==0&&(a[m].area=Math.abs(T),u===void 0&&(u=T<0),u===T<0?(f&&c.push(f),f=[a[m]]):f.push(a[m]))}if(f&&c.push(f),t>1)for(let m=0;m<c.length;m++)c[m].length<=t||(Vp(c[m],t,1,c[m].length-1,by),c[m]=c[m].slice(0,t));return c}function by(a,t){return t.area-a.area}function zm(a,t,r){const c=r.patternDependencies;let f=!1;for(const u of t){const m=u.paint.get(`${a}-pattern`);m.isConstant()||(f=!0);const T=m.constantOr(null);T&&(f=!0,c[T]=!0)}return f}function mp(a,t,r,c,f){const u=f.patternDependencies;for(const m of t){const T=m.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let L=T.evaluate({zoom:c},r,{},f.availableImages);L=L&&L.name?L.name:L,u[L]=!0,r.patterns[m.id]=L}}return r}class km{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ec,this.indexArray=new qs,this.indexArray2=new il,this.programConfigurations=new Gl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Ks,this.segments2=new Ks,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection}updateFootprints(t,r){}populate(t,r,c,f){this.hasPattern=zm("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:T,id:L,index:D,sourceLayerIndex:b}of t){const C=this.layers[0]._featureFilter.needGeometry,R=wi(T,C);if(!this.layers[0]._featureFilter.filter(new Qs(this.zoom),R,c))continue;const A=u?u.evaluate(R,{},c,r.availableImages):void 0,I={id:L,properties:T.properties,type:T.type,sourceLayerIndex:b,index:D,geometry:C?R.geometry:Wt(T,c,f),patterns:{},sortKey:A};m.push(I)}u&&m.sort((T,L)=>T.sortKey-L.sortKey);for(const T of m){const{geometry:L,index:D,sourceLayerIndex:b}=T;if(this.hasPattern){const C=mp("fill",this.layers,T,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(T,L,D,c,{},r.availableImages,r.brightness);r.featureIndex.insert(t[D].feature,L,D,b,this.index)}}update(t,r,c,f,u){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,m?this.stateDependentLayers:this.layers,c,f,u)}addFeatures(t,r,c,f,u,m){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,r,c,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,c,f,u,m=[],T){for(const L of Of(r,500)){let D=0;for(const k of L)D+=k.length;const b=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),C=b.vertexLength,R=[],A=[];for(const k of L){if(k.length===0)continue;k!==L[0]&&A.push(R.length/2);const W=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),$=W.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack($+k.length-1,$),R.push(k[0].x),R.push(k[0].y);for(let ee=1;ee<k.length;ee++)this.layoutVertexArray.emplaceBack(k[ee].x,k[ee].y),this.indexArray2.emplaceBack($+ee-1,$+ee),R.push(k[ee].x),R.push(k[ee].y);W.vertexLength+=k.length,W.primitiveLength+=k.length}const I=Rf(R,A);for(let k=0;k<I.length;k+=3)this.indexArray.emplaceBack(C+I[k],C+I[k+1],C+I[k+2]);b.vertexLength+=D,b.primitiveLength+=I.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,u,m,f,T)}}let zf,Po,zo,kf;Sn(km,"FillBucket",{omit:["layers","patternFeatures"]});class Fm{constructor(t,r,c,f){if(this.triangleCount=r.length/3,this.min=new je(0,0),this.max=new je(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[u,m]=[t[0].clone(),t[0].clone()];for(let C=1;C<t.length;++C){const R=t[C];u.x=Math.min(u.x,R.x),u.y=Math.min(u.y,R.y),m.x=Math.max(m.x,R.x),m.y=Math.max(m.y,R.y)}if(f){const C=Math.ceil(Math.max(m.x-u.x,m.y-u.y)/f);c=Math.max(c,C)}if(c===0)return;this.min=u,this.max=m;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const L=Math.max(T.x,T.y)/c;this.cellsX=Math.max(1,Math.ceil(T.x/L)),this.cellsY=Math.max(1,Math.ceil(T.y/L)),this.xScale=1/L,this.yScale=1/L;const D=[];for(let C=0;C<this.triangleCount;C++){const R=t[r[3*C+0]].sub(this.min),A=t[r[3*C+1]].sub(this.min),I=t[r[3*C+2]].sub(this.min),k=ac(Math.floor(Math.min(R.x,A.x,I.x)),this.xScale,this.cellsX),W=ac(Math.floor(Math.max(R.x,A.x,I.x)),this.xScale,this.cellsX),$=ac(Math.floor(Math.min(R.y,A.y,I.y)),this.yScale,this.cellsY),ee=ac(Math.floor(Math.max(R.y,A.y,I.y)),this.yScale,this.cellsY),te=new je(0,0),X=new je(0,0),le=new je(0,0),he=new je(0,0);for(let Me=$;Me<=ee;++Me){te.y=X.y=Me*L,le.y=he.y=(Me+1)*L;for(let He=k;He<=W;++He)te.x=le.x=He*L,X.x=he.x=(He+1)*L,(Xr(R,A,I,te,X,he)||Xr(R,A,I,te,he,le))&&D.push({cellIdx:Me*this.cellsX+He,triIdx:C})}}if(D.length===0)return;D.sort((C,R)=>C.cellIdx-R.cellIdx||C.triIdx-R.triIdx);let b=0;for(;b<D.length;){const C=D[b].cellIdx,R={start:this.payload.length,len:0};for(;b<D.length&&D[b].cellIdx===C;)++R.len,this.payload.push(D[b++].triIdx);this.cells[C]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,r){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=ac(t.x-this.min.x,this.xScale,this.cellsX),f=ac(t.y-this.min.y,this.yScale,this.cellsY),u=this.cells[f*this.cellsX+c];if(u){this._lazyInitLookup();for(let m=0;m<u.len;m++){const T=this.payload[u.start+m],L=Math.floor(T/8),D=1<<T%8;if(!(this.lookup[L]&D)&&(this.lookup[L]|=D,r.push(T),r.length===this.triangleCount))return}}}query(t,r,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>r.x||t.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const f=ac(t.x-this.min.x,this.xScale,this.cellsX),u=ac(r.x-this.min.x,this.xScale,this.cellsX),m=ac(t.y-this.min.y,this.yScale,this.cellsY),T=ac(r.y-this.min.y,this.yScale,this.cellsY);for(let L=m;L<=T;L++)for(let D=f;D<=u;D++){const b=this.cells[L*this.cellsX+D];if(b)for(let C=0;C<b.len;C++){const R=this.payload[b.start+C],A=Math.floor(R/8),I=1<<R%8;if(!(this.lookup[A]&I)&&(this.lookup[A]|=I,c.push(R),c.length===this.triangleCount))return}}}}function ac(a,t,r){return Math.max(0,Math.min(r-1,Math.floor(a*t)))}Sn(Fm,"TriangleGridIndex");class Ff{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(t,r){for(const c of this.footprints)r.push({footprint:c,id:t})}populate(t,r,c,f){const u=[];for(const{feature:m,id:T,index:L,sourceLayerIndex:D}of t){const b=this.layers[0]._featureFilter.needGeometry,C=wi(m,b);if(!this.layers[0]._featureFilter.filter(new Qs(this.zoom),C,c))continue;const R={id:T,properties:m.properties,type:m.type,sourceLayerIndex:D,index:L,geometry:b?C.geometry:Wt(m,c,f),patterns:{}};u.push(R)}for(const m of u){const{geometry:T,index:L,sourceLayerIndex:D}=m;this.addFeature(m,T,L,c,{},r.availableImages,r.brightness),r.featureIndex.insert(t[L].feature,T,L,D,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,r,c,f,u){}destroy(){}addFeature(t,r,c,f,u,m=[],T){for(const L of Of(r,2)){const D=[],b=[],C=[],R=new je(1/0,1/0),A=new je(-1/0,-1/0);for(const W of L)if(W.length!==0){W!==L[0]&&C.push(b.length/2);for(let $=0;$<W.length;$++)b.push(W[$].x),b.push(W[$].y),D.push(W[$]),R.x=Math.min(R.x,W[$].x),R.y=Math.min(R.y,W[$].y),A.x=Math.max(A.x,W[$].x),A.y=Math.max(A.y,W[$].y)}const I=Rf(b,C),k=new Fm(D,I,8,256);this.footprints.push({vertices:D,indices:I,grid:k,min:R,max:A})}}}Sn(Ff,"ClipBucket",{omit:["layers"]});const n_=Qr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),wy=Qr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ty=Qr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),hv=Qr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),dv=Qr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),S=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:e}=n_;var l,g,_,M,P,N,U,G={};function K(){if(g)return l;g=1;var a=bt();function t(f,u,m,T,L){this.properties={},this.extent=m,this.type=0,this._pbf=f,this._geometry=-1,this._keys=T,this._values=L,f.readFields(r,this,u)}function r(f,u,m){f==1?u.id=m.readVarint():f==2?function(T,L){for(var D=T.readVarint()+T.pos;T.pos<D;){var b=L._keys[T.readVarint()],C=L._values[T.readVarint()];L.properties[b]=C}}(m,u):f==3?u.type=m.readVarint():f==4&&(u._geometry=m.pos)}function c(f){for(var u,m,T=0,L=0,D=f.length,b=D-1;L<D;b=L++)T+=((m=f[b]).x-(u=f[L]).x)*(u.y+m.y);return T}return l=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var u,m=f.readVarint()+f.pos,T=1,L=0,D=0,b=0,C=[];f.pos<m;){if(L<=0){var R=f.readVarint();T=7&R,L=R>>3}if(L--,T===1||T===2)D+=f.readSVarint(),b+=f.readSVarint(),T===1&&(u&&C.push(u),u=[]),u.push(new a(D,b));else{if(T!==7)throw new Error("unknown command "+T);u&&u.push(u[0].clone())}}return u&&C.push(u),C},t.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var u=f.readVarint()+f.pos,m=1,T=0,L=0,D=0,b=1/0,C=-1/0,R=1/0,A=-1/0;f.pos<u;){if(T<=0){var I=f.readVarint();m=7&I,T=I>>3}if(T--,m===1||m===2)(L+=f.readSVarint())<b&&(b=L),L>C&&(C=L),(D+=f.readSVarint())<R&&(R=D),D>A&&(A=D);else if(m!==7)throw new Error("unknown command "+m)}return[b,R,C,A]},t.prototype.toGeoJSON=function(f,u,m){var T,L,D=this.extent*Math.pow(2,m),b=this.extent*f,C=this.extent*u,R=this.loadGeometry(),A=t.types[this.type];function I($){for(var ee=0;ee<$.length;ee++){var te=$[ee];$[ee]=[360*(te.x+b)/D-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+C)/D)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(T=0;T<R.length;T++)k[T]=R[T][0];I(R=k);break;case 2:for(T=0;T<R.length;T++)I(R[T]);break;case 3:for(R=function($){var ee=$.length;if(ee<=1)return[$];for(var te,X,le=[],he=0;he<ee;he++){var Me=c($[he]);Me!==0&&(X===void 0&&(X=Me<0),X===Me<0?(te&&le.push(te),te=[$[he]]):te.push($[he]))}return te&&le.push(te),le}(R),T=0;T<R.length;T++)for(L=0;L<R[T].length;L++)I(R[T][L])}R.length===1?R=R[0]:A="Multi"+A;var W={type:"Feature",geometry:{type:A,coordinates:R},properties:this.properties};return"id"in this&&(W.id=this.id),W},l}function Q(){if(M)return _;M=1;var a=K();function t(c,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(r,this,f),this.length=this._features.length}function r(c,f,u){c===15?f.version=u.readVarint():c===1?f.name=u.readString():c===5?f.extent=u.readVarint():c===2?f._features.push(u.pos):c===3?f._keys.push(u.readString()):c===4&&f._values.push(function(m){for(var T=null,L=m.readVarint()+m.pos;m.pos<L;){var D=m.readVarint()>>3;T=D===1?m.readString():D===2?m.readFloat():D===3?m.readDouble():D===4?m.readVarint64():D===5?m.readVarint():D===6?m.readSVarint():D===7?m.readBoolean():null}return T}(u))}return _=t,t.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var f=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,f,this.extent,this._keys,this._values)},_}function ne(){return U||(U=1,G.VectorTile=function(){if(N)return P;N=1;var a=Q();function t(r,c,f){if(r===3){var u=new a(f,f.readVarint()+f.pos);u.length&&(c[u.name]=u)}}return P=function(r,c){this.layers=r.readFields(t,{},c)},P}(),G.VectorTileFeature=K(),G.VectorTileLayer=Q()),G}var oe=ne();class de extends je{constructor(t,r,c){super(t,r),this.z=c}}class xe extends de{constructor(t,r,c,f){super(t,r,c),this.w=f}}function Re(a,t,r,c){const f=[],u=c===0?(m,T,L,D,b,C)=>{m.push(new je(C,L+(C-T)/(D-T)*(b-L)))}:(m,T,L,D,b,C)=>{m.push(new je(T+(C-L)/(b-L)*(D-T),C))};for(const m of a){const T=[];for(const L of m){if(L.length<=2)continue;const D=[];for(let R=0;R<L.length-1;R++){const A=L[R].x,I=L[R].y,k=L[R+1].x,W=L[R+1].y,$=c===0?A:I,ee=c===0?k:W;$<t?ee>t&&u(D,A,I,k,W,t):$>r?ee<r&&u(D,A,I,k,W,r):D.push(L[R]),ee<t&&$>=t&&u(D,A,I,k,W,t),ee>r&&$<=r&&u(D,A,I,k,W,r)}let b=L[L.length-1];const C=c===0?b.x:b.y;C>=t&&C<=r&&D.push(b),D.length&&(b=D[D.length-1],D[0].x===b.x&&D[0].y===b.y||D.push(D[0]),T.push(D))}T.length&&f.push(T)}return f}function we(a,t,r,c){const f=r==="x"?"y":"x",u=(c-a[r])/(t[r]-a[r]);a[f]=a[f]+(t[f]-a[f])*u,a[r]=c,a.hasOwnProperty("z")&&(a.z=Pe(a.z,t.z,u)),a.hasOwnProperty("w")&&(a.w=Pe(a.w,t.w,u))}function nt(a,t,r,c){const f=r,u=c;for(const m of["x","y"]){let T=a,L=t;T[m]>=L[m]&&(T=t,L=a),T[m]<f&&L[m]>f&&we(T,L,m,f),T[m]<u&&L[m]>u&&we(L,T,m,u)}}const xt=Number.MAX_SAFE_INTEGER;function ft(a,t,r,c){return a.order<t||a.order===xt||!(a.clipMask&r)||function(f,u){return u.length!==0&&u.find(m=>m===f)===void 0}(c,a.clipScope)}function Ht(a,t){return a.x-t.x||a.y-t.y}function Xt(a,t){return Ht(a.min,t.min)===0&&Ht(a.max,t.max)===0}function _i(a,t){return!(a.min.x>t.max.x||a.max.x<t.min.x||a.min.y>t.max.y||a.max.y<t.min.y)}function vi(a,t){if(a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(a[r].sourceId!==t[r].sourceId||!Xt(a[r],t[r])||a[r].order!==t[r].order||a[r].clipMask!==t[r].clipMask||!Ot(a[r].clipScope,t[r].clipScope))return!1;return!0}function Bi(a,t,r){const c=1/un,f=1/(1<<r.canonical.z),u=(t.x*c+r.canonical.x)*f+r.wrap,m=(t.y*c+r.canonical.y)*f;return{min:new je((a.x*c+r.canonical.x)*f+r.wrap,(a.y*c+r.canonical.y)*f),max:new je(u,m)}}function Li(a,t,r){const c=1<<r.canonical.z,f=((t.x-r.wrap)*c-r.canonical.x)*un,u=(t.y*c-r.canonical.y)*un;return{min:new je(((a.x-r.wrap)*c-r.canonical.x)*un,(a.y*c-r.canonical.y)*un),max:new je(f,u)}}function ki(a,t,r,c,f,u,m){const T=a.indices,L=a.vertices,D=[];for(let b=c;b<c+f;b+=3){const C=t[r[b+0]+u],R=t[r[b+1]+u],A=t[r[b+2]+u],I=Math.min(C.x,R.x,A.x),k=Math.max(C.x,R.x,A.x),W=Math.min(C.y,R.y,A.y),$=Math.max(C.y,R.y,A.y);D.length=0,a.grid.query(new je(I,W),new je(k,$),D);for(let ee=0;ee<D.length;ee++){const te=D[ee];if(Xr(L[T[3*te+0]],L[T[3*te+1]],L[T[3*te+2]],C,R,A,m))return!0}}return!1}function Zn(a,t,r,c){if(!a||!r)return!1;let f=a.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(r.vertices.length<a.vertices.length)return Zn(r,c,a,t);const u=t.canonical,m=c.canonical,T=Math.pow(2,m.z-u.z);f=a.vertices.map(L=>new je((L.x+u.x*un)*T-m.x*un,(L.y+u.y*un)*T-m.y*un))}return ki(r,f,a.indices,0,a.indices.length,0,0)}function En(a,t,r,c){const f=Math.pow(2,c.z-r.z);return new je((a+r.x*un)*f-c.x*un,(t+r.y*un)*f-c.y*un)}function Ji(a,t){const r=[];t.grid.queryPoint(a,r);const c=t.indices,f=t.vertices;for(let u=0;u<r.length;u++){const m=r[u];if(Nr([f[c[3*m+0]],f[c[3*m+1]],f[c[3*m+2]]],a))return!0}return!1}const In=[new je(0,0),new je(un,0),new je(un,un),new je(0,un)];function ir(a,t){const r=[];let c=[];if(!t||a.length<2)return[a];if(a.length===2)return Ur(a[0],a[1],In)?[a]:[];for(let f=0;f<a.length+2;f++){const u=a[f%a.length],m=a[(f+1)%a.length],T=Ur(f===0?a[a.length-1]:a[(f-1)%a.length],u,In),L=Ur(u,m,In),D=T||L;D&&c.push(u),D&&L||c.length>0&&(c.length>1&&r.push(c),c=[])}return c.length>1&&r.push(c),r}const rr=oe.VectorTileFeature.types,vr=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],kr=["fill-extrusion-flood-light-ground-radius"],Fr=Math.pow(2,13),Rn=Math.pow(2,15)-1,qt=new je(0,1),ti=2147483648;function Qi(a,t,r,c,f,u,m,T){a.emplaceBack((t<<1)+m,(r<<1)+u,(Math.floor(c*Fr)<<1)+f,Math.round(T))}function ji(a,t,r){a.emplaceBack(t.x*un,t.y*un,r?1:0)}function Oi(a,t,r,c,f,u){a.emplaceBack(t.x,t.y,(r.x<<1)+c,(r.y<<1)+f,u)}function Nn(a,t,r){a.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Hn{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Ni{constructor(){this.centroidXY=new je(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new je(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new je(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new je(this.max.x-this.min.x,this.max.y-this.min.y)}}class kt{constructor(){this.acc=new je(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,r){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=r.x,t.min.y=t.max.y=r.y)}appendEdge(t,r,c){this.accCount++,this.acc._add(r);let f=!!this.borders;r.x<t.min.x?(t.min.x=r.x,f=!0):r.x>t.max.x&&(t.max.x=r.x,f=!0),r.y<t.min.y?(t.min.y=r.y,f=!0):r.y>t.max.y&&(t.max.y=r.y,f=!0),((r.x===0||r.x===un)&&r.x===c.x)!=((r.y===0||r.y===un)&&r.y===c.y)&&this.processBorderOverlap(r,c),f&&this.checkBorderIntersection(r,c)}checkBorderIntersection(t,r){r.x<0!=t.x<0&&this.addBorderIntersection(0,Pe(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>un!=t.x>un&&this.addBorderIntersection(1,Pe(r.y,t.y,(un-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,Pe(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>un!=t.y>un&&this.addBorderIntersection(3,Pe(r.x,t.x,(un-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];r<c[0]&&(c[0]=r),r>c[1]&&(c[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,r.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,r.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new je(0,0):new je(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0):0}}function Ii(a,t){const r=a.add(t)._unit(),c=Mt(a.x*r.x+a.y*r.y,-1,1);var f,u,m;return m=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(m)))/4*Rn*((f=a).x*(u=t).y-f.y*u.x<0?-1:1)}const gn=[a=>a.x<0,a=>a.x>un,a=>a.y<0,a=>a.y>un];function vn(a,t,r,c){const f=[4];if(c===0)return f;r._mult(c);const u=a.sub(r),m=t.sub(r),T=[a,t,u,m];for(let L=0;L<4;L++)for(const D of T)if(gn[L](D)){f.push(L);break}return f}class pn{constructor(t){this.vertexArray=new ch,this.indexArray=new qs,this.programConfigurations=new Gl(t.layers,{zoom:t.zoom,lut:t.lut},r=>kr.includes(r)),this._segments=new Ks,this.hiddenByLandmarkVertexArray=new ed,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ks}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,r,c,f=!1){const u=t.length;if(u>2){let m=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let L;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const D=t[0],b=t[1];L=Ii(D.sub(t[u-1])._perp()._unit(),b.sub(D)._perp()._unit())}for(let D=0;D<u;D++){const b=D===u-1?0:D+1,C=t[D],R=t[b],A=t[b===u-1?0:b+1],I=R.sub(C)._perp()._unit(),k=Ii(I,A.sub(R)._perp()._unit()),W=L,$=k;if(Kr(C,R,r)||f&&ta(C,r)&&ta(R,r)){L=k;continue}const ee=T.vertexLength;Oi(this.vertexArray,C,R,1,1,W),Oi(this.vertexArray,C,R,1,0,W),Oi(this.vertexArray,C,R,0,1,$),Oi(this.vertexArray,C,R,0,0,$),T.vertexLength+=4;const te=vn(C,R,I,c);for(const X of te)this._segmentToGroundQuads[m].push({id:ee,region:X}),this._segmentToRegionTriCounts[m][X]+=2,T.primitiveLength+=2;L=k}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),r=t.length;for(let c=0;c<r;c++)this._segmentToGroundQuads[c].sort((f,u)=>f.region-u.region);for(let c=0;c<r;c++){const f=this._segmentToGroundQuads[c],u=t[c],m=this._segmentToRegionTriCounts[c];m.reduce((L,D)=>L+D,0);let T=0;for(let L=0;L<=4;L++){const D=m[L];if(D!==0){let b=this.regionSegments[L];b||(b=this.regionSegments[L]=new Ks);const C={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+T,vertexLength:u.vertexLength,primitiveLength:D};b.get().push(C)}T+=D}for(let L=0;L<f.length;L++){const D=f[L].id;this.indexArray.emplaceBack(D,D+1,D+3),this.indexArray.emplaceBack(D,D+3,D+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,r,c,f,u,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,r,c,f,u,m)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,wy.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,r,c,f,u,m){this.hasData()&&this.programConfigurations.updatePaintArrays(t,r,c,f,u,m)}updateHiddenByLandmark(t){if(!this.hasData())return;const r=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const c=t.flags&ti?1:0;for(let f=t.groundVertexArrayOffset;f<r;++f)this.hiddenByLandmarkVertexArray.emplace(f,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,dv.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const r=this.regionSegments[t];r&&r.destroy()}}}}class or{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qs,this.footprintVertices=new ec,this.footprintSegments=[],this.layoutVertexArray=new mu,this.centroidVertexArray=new id,this.wallVertexArray=new fh,this.indexArray=new qs,this.programConfigurations=new Gl(t.layers,{zoom:t.zoom,lut:t.lut},r=>vr.includes(r)),this.segments=new Ks,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new pn(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,r){}populate(t,r,c,f){this.features=[],this.hasPattern=zm("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=gt(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:u,id:m,index:T,sourceLayerIndex:L}of t){const D=this.layers[0]._featureFilter.needGeometry,b=wi(u,D);if(!this.layers[0]._featureFilter.filter(new Qs(this.zoom),b,c))continue;const C={id:m,sourceLayerIndex:L,index:T,geometry:D?b.geometry:Wt(u,c,f),properties:u.properties,type:u.type,patterns:{}},R=this.layoutVertexArray.length,A=rr[C.type]==="Polygon";if(this.hasPattern)this.features.push(mp("fill-extrusion",this.layers,C,this.zoom,r));else if(this.wallMode)for(const I of C.geometry)for(const k of ir(I,A))this.addFeature(C,[k],T,c,{},r.availableImages,f,r.brightness);else this.addFeature(C,C.geometry,T,c,{},r.availableImages,f,r.brightness);r.featureIndex.insert(u,C.geometry,T,L,this.index,R)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,r,c,f,u,m){for(const T of this.features){const L=rr[T.type]==="Polygon",{geometry:D}=T;if(this.wallMode)for(const b of D)for(const C of ir(b,L))this.addFeature(T,[C],T.index,r,c,f,u,m);else this.addFeature(T,D,T.index,r,c,f,u,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,r,c,f,u){const m=Object.keys(t).length!==0;if(m&&!this.stateDependentLayers.length)return;const T=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,r,T,c,f,u),this.groundEffect.update(t,r,T,c,f,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,e),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,hv.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,S.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ty.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,c,f,u,m,T,L){const D=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,b=[new je(0,0),new je(un,un)],C=T.projection,R=C.name==="globe",A=this.wallMode||rr[t.type]==="Polygon",I=new kt;I.centroidDataIndex=this.centroidData.length;const k=new Ni,W=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},f)<=0,$=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},f);let ee;if(k.height=$,k.vertexArrayOffset=this.layoutVertexArray.length,k.groundVertexArrayOffset=this.groundEffect.vertexArray.length,R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new vl),this.wallMode){if(R)return void Wn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;ee=function(Be){const yt=Be[0].x===Be[Be.length-1].x&&Be[0].y===Be[Be.length-1].y;(function($i){let Di=0;const Kn=$i.length;for(let bn=0;bn<Kn;bn++)Di+=($i[(bn+1)%Kn].x-$i[bn].x)*($i[(bn+1)%Kn].y+$i[bn].y);return Di>=0})(Be)||(Be=Be.reverse());const dt={geometry:[],joinNormals:[],indices:[]},Et=[],Ct=[],Bt=[];let ei=Be.length;if(ei<(yt?3:2))return dt;for(;ei>=2&&Be[ei-1].equals(Be[ei-2]);)ei--;let ni,Yt,yi,Fi,di,Tn=0;for(;Tn<ei-1&&Be[Tn].equals(Be[Tn+1]);)Tn++;yt&&(ni=Be[ei-2],di=Be[Tn].sub(ni)._unit()._perp());for(let $i=Tn;$i<ei;$i++){if(yi=$i===ei-1?yt?Be[Tn+1]:void 0:Be[$i+1],yi&&Be[$i].equals(yi))continue;di&&(Fi=di),ni&&(Yt=ni),ni=Be[$i],di=yi?yi.sub(ni)._unit()._perp():Fi,Fi=Fi||di;let Di=Fi.add(di);Di.x===0&&Di.y===0||Di._unit();const Kn=Di.x*di.x+Di.y*di.y,bn=Kn!==0?1/Kn:1/0,Cn=Fi.x*di.y-Fi.y*di.x>0;let fr="miter";const Sr=2;fr==="miter"&&bn>Sr&&(fr="bevel"),fr==="bevel"&&(bn>100&&(fr="flipbevel"),bn<Sr&&(fr="miter"));const Cr=(xr,Vr,Br,Bs)=>{const Rs=new je(xr.x,xr.y),lr=new je(xr.x,xr.y);Rs.x+=Vr.x*Bs,Rs.y+=Vr.y*Bs,lr.x-=Vr.x*Math.max(Br,1),lr.y-=Vr.y*Math.max(Br,1),Bt.push(Vr),Et.push(Rs),Ct.push(lr)};if(fr==="miter")Di._mult(bn),Cr(ni,Di,0,0);else if(fr==="flipbevel")Di=di.mult(-1),Cr(ni,Di,0,0),Cr(ni,Di.mult(-1),0,0);else{const xr=-Math.sqrt(bn*bn-1),Vr=Cn?xr:0,Br=Cn?0:xr;Yt&&Cr(ni,Fi,Vr,Br),yi&&Cr(ni,di,Vr,Br)}}dt.geometry=[...Et,...Ct.reverse(),Et[0]],dt.joinNormals=[...Bt,...Bt.reverse(),Bt[Bt.length-1]];const ln=dt.geometry.length-1;for(let $i=0;$i<ln/2;$i++)if($i+1<ln/2){let Di=$i,Kn=$i+1,bn=ln-1-$i,Cn=ln-2-$i;Di=Di===0?ln-1:Di-1,Kn=Kn===0?ln-1:Kn-1,bn=bn===0?ln-1:bn-1,Cn=Cn===0?ln-1:Cn-1,dt.indices.push(bn),dt.indices.push(Kn),dt.indices.push(Di),dt.indices.push(bn),dt.indices.push(Cn),dt.indices.push(Kn)}return dt}(r[0]),r=[ee.geometry]}const te=(Be,yt)=>Be<(yt.length-1)/2||Be===yt.length-1,X=this.wallMode?[r]:Of(r,500);for(let Be=X.length-1;Be>=0;Be--){const yt=X[Be];(yt.length===0||(le=yt[0]).every(ke=>ke.x<=0)||le.every(ke=>ke.x>=un)||le.every(ke=>ke.y<=0)||le.every(ke=>ke.y>=un))&&X.splice(Be,1)}var le;let he;if(R)he=vh(X,b,f);else{he=[];for(const Be of X)he.push({polygon:Be,bounds:b})}const Me=A?this.edgeRadius:0,He=Me>0&&this.zoom<17,ze=(Be,yt)=>{if(Be.length===0)return!1;const ke=Be[Be.length-1];return yt.x===ke.x&&yt.y===ke.y};for(const{polygon:Be,bounds:yt}of he){let ke=0,dt=0;for(const ei of Be)A&&!ei[0].equals(ei[ei.length-1])&&ei.push(ei[0]),dt+=A?ei.length-1:ei.length;const Et=this.segments.prepareSegment((A?5:4)*dt,this.layoutVertexArray,this.indexArray);k.footprintSegIdx<0&&(k.footprintSegIdx=this.footprintSegments.length),k.polygonSegIdx<0&&(k.polygonSegIdx=this.polygonSegments.length);const Ct={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Bt=new Hn;if(Bt.vertexOffset=this.footprintVertices.length,Bt.indexOffset=3*this.footprintIndices.length,Bt.ringIndices=[],A){const ei=[],ni=[];ke=Et.vertexLength;for(let yi=0;yi<Be.length;yi++){const Fi=Be[yi];Fi.length&&yi!==0&&ni.push(ei.length/2);const di=[];let Tn,ln;Tn=Fi[1].sub(Fi[0])._perp()._unit(),Bt.ringIndices.push(Fi.length-1);for(let $i=1;$i<Fi.length;$i++){const Di=Fi[$i],Kn=Fi[$i===Fi.length-1?1:$i+1],bn=Di.clone();if(Me){ln=Kn.sub(Di)._perp()._unit();const Cn=Tn.add(ln)._unit(),fr=Me*Math.min(4,1/(Tn.x*Cn.x+Tn.y*Cn.y));bn.x+=fr*Cn.x,bn.y+=fr*Cn.y,bn.x=Math.round(bn.x),bn.y=Math.round(bn.y),Tn=ln}if(!W||Me!==0&&!He||ze(di,bn)||di.push(bn),Qi(this.layoutVertexArray,bn.x,bn.y,0,0,1,1,0),this.wallMode){const Cn=te($i,Fi);ji(this.wallVertexArray,ee.joinNormals[$i],!Cn)}Et.vertexLength++,this.footprintVertices.emplaceBack(Di.x,Di.y),ei.push(Di.x,Di.y),R&&Nn(this.layoutVertexExtArray,C.projectTilePoint(bn.x,bn.y,f),C.upVector(f,bn.x,bn.y))}W&&(Me===0||He)&&(di.length!==0&&ze(di,di[0])&&di.pop(),this.groundEffect.addData(di,yt,D))}const Yt=this.wallMode?ee.indices:Rf(ei,ni);for(let yi=0;yi<Yt.length;yi+=3)this.footprintIndices.emplaceBack(Bt.vertexOffset+Yt[yi+0],Bt.vertexOffset+Yt[yi+1],Bt.vertexOffset+Yt[yi+2]),this.indexArray.emplaceBack(ke+Yt[yi],ke+Yt[yi+2],ke+Yt[yi+1]),Et.primitiveLength++;Bt.indexCount+=Yt.length,Bt.vertexCount+=this.footprintVertices.length-Bt.vertexOffset}for(let ei=0;ei<Be.length;ei++){const ni=Be[ei];I.startRing(k,ni[0]);let Yt=ni.length>4&&io(ni[ni.length-2],ni[0],ni[1]),yi=Me?mr(ni[ni.length-2],ni[0],ni[1],Me):0;const Fi=[];let di,Tn,ln;Tn=ni[1].sub(ni[0])._perp()._unit();let $i=!0;for(let Di=1,Kn=0;Di<ni.length;Di++){let bn=ni[Di-1],Cn=ni[Di];const fr=ni[Di===ni.length-1?1:Di+1];if(I.appendEdge(k,Cn,bn),Kr(Cn,bn,yt)){Me&&(Tn=fr.sub(Cn)._perp()._unit(),$i=!$i);continue}const Sr=Cn.sub(bn)._perp(),Cr=Sr.x/(Math.abs(Sr.x)+Math.abs(Sr.y)),xr=Sr.y>0?1:0,Vr=bn.dist(Cn);if(Kn+Vr>32768&&(Kn=0),Me){ln=fr.sub(Cn)._perp()._unit();let lr=ns(bn,Cn,fr,Ar(Tn,ln),Me);isNaN(lr)&&(lr=0);const fs=Cn.sub(bn)._unit();bn=bn.add(fs.mult(yi))._round(),Cn=Cn.add(fs.mult(-lr))._round(),yi=lr,Tn=ln,W&&this.zoom>=17&&(ze(Fi,bn)||Fi.push(bn),ze(Fi,Cn)||Fi.push(Cn))}const Br=Et.vertexLength,Bs=ni.length>4&&io(bn,Cn,fr);let Rs=ia(Kn,Yt,$i);if(Qi(this.layoutVertexArray,bn.x,bn.y,Cr,xr,0,0,Rs),Qi(this.layoutVertexArray,bn.x,bn.y,Cr,xr,0,1,Rs),this.wallMode){const lr=te(Di-1,ni),fs=ee.joinNormals[Di-1];ji(this.wallVertexArray,fs,lr),ji(this.wallVertexArray,fs,lr)}if(Kn+=Vr,Rs=ia(Kn,Bs,!$i),Yt=Bs,Qi(this.layoutVertexArray,Cn.x,Cn.y,Cr,xr,0,0,Rs),Qi(this.layoutVertexArray,Cn.x,Cn.y,Cr,xr,0,1,Rs),this.wallMode){const lr=te(Di,ni),fs=ee.joinNormals[Di];ji(this.wallVertexArray,fs,lr),ji(this.wallVertexArray,fs,lr)}if(Et.vertexLength+=4,this.indexArray.emplaceBack(Br+0,Br+1,Br+2),this.indexArray.emplaceBack(Br+1,Br+3,Br+2),Et.primitiveLength+=2,Me){const lr=ke+(Di===1?ni.length-2:Di-2),fs=Di===1?ke:lr+1;if(this.indexArray.emplaceBack(Br+1,lr,Br+3),this.indexArray.emplaceBack(lr,fs,Br+3),Et.primitiveLength+=2,di===void 0&&(di=Br),!Kr(fr,ni[Di],yt)){const xs=Di===ni.length-1?di:Et.vertexLength;this.indexArray.emplaceBack(Br+2,Br+3,xs),this.indexArray.emplaceBack(Br+3,xs+1,xs),this.indexArray.emplaceBack(Br+3,fs,xs+1),Et.primitiveLength+=3}$i=!$i}if(R){const lr=this.layoutVertexExtArray,fs=C.projectTilePoint(bn.x,bn.y,f),xs=C.projectTilePoint(Cn.x,Cn.y,f),Js=C.upVector(f,bn.x,bn.y),vo=C.upVector(f,Cn.x,Cn.y);Nn(lr,fs,Js),Nn(lr,fs,Js),Nn(lr,xs,vo),Nn(lr,xs,vo)}}A&&(ke+=ni.length-1),W&&Me&&this.zoom>=17&&(Fi.length!==0&&ze(Fi,Fi[0])&&Fi.pop(),this.groundEffect.addData(Fi,yt,D,Me>0))}this.footprintSegments.push(Bt),Ct.triangleCount=this.indexArray.length-Ct.triangleArrayOffset,this.polygonSegments.push(Ct),++k.footprintSegLen,++k.polygonSegLen}if(k.vertexCount=this.layoutVertexArray.length-k.vertexArrayOffset,k.groundVertexCount=this.groundEffect.vertexArray.length-k.groundVertexArrayOffset,k.vertexCount!==0){if(k.centroidXY=I.borders?qt:this.encodeCentroid(I,k),this.centroidData.push(k),I.borders){this.featuresOnBorder.push(I);const Be=this.featuresOnBorder.length-1;for(let yt=0;yt<I.borders.length;yt++)I.borders[yt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[yt].push(Be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,u,m,f,L),this.groundEffect.addPaintPropertiesData(t,c,u,m,f,L),this.maxHeight=Math.max(this.maxHeight,$)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((r,c)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let T=0;T<this.centroidData.length;T++){const L=this.centroidData[T],D=+(L.min.y+L.max.y>un),b=2*D+(+(L.min.x+L.max.x>un)^D);for(let C=0;C<L.polygonSegLen;C++){const R=L.polygonSegIdx+C;t.push({centroidIdx:T,subtile:b,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const r=new qs;t.sort((T,L)=>T.triangleSegmentIdx===L.triangleSegmentIdx?T.subtile-L.subtile:T.triangleSegmentIdx-L.triangleSegmentIdx);let c=0,f=0,u=0;for(const T of t){if(T.triangleSegmentIdx!==c)break;u++}const m=t.length;for(;f!==t.length;){c=t[f].triangleSegmentIdx;let T=0,L=f,D=f;for(let b=L;b<u&&t[b].subtile===T;b++)D++;for(;L!==u;){const b=t[L];T=b.subtile;const C=this.centroidData[b.centroidIdx].min.clone(),R=this.centroidData[b.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let I=L;I<D;I++){const k=t[I],W=this.polygonSegments[k.polygonSegmentIdx],$=this.centroidData[k.centroidIdx].min,ee=this.centroidData[k.centroidIdx].max,te=this.indexArray.uint16;for(let X=W.triangleArrayOffset;X<W.triangleArrayOffset+W.triangleCount;X++)r.emplaceBack(te[3*X],te[3*X+1],te[3*X+2]);A.primitiveLength+=W.triangleCount,C.x=Math.min(C.x,$.x),C.y=Math.min(C.y,$.y),R.x=Math.max(R.x,ee.x),R.y=Math.max(R.y,ee.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:C,max:R}),L=D;for(let I=L;I<u&&t[I].subtile===t[L].subtile;I++)D++}f=u;for(let b=f;b<m&&t[b].triangleSegmentIdx===t[f].triangleSegmentIdx;b++)u++}r._trim(),this.indexArray=r}getVisibleSegments(t,r,c){const f=new Ks;if(this.wallMode){for(const k of this.triangleSubSegments)f.segments.push(k.segment);return f}let u=0,m=0;const T=1<<t.canonical.z;if(r){const k=r.getMinMaxForTile(t);k&&(u=k.min,m=k.max)}m+=this.maxHeight;const L=t.toUnwrapped();let D;const b=[L.canonical.x/T+L.wrap,L.canonical.y/T],C=[(L.canonical.x+1)/T+L.wrap,(L.canonical.y+1)/T],R=(k,W,$)=>[k[0]*(1-$[0])+W[0]*$[0],k[1]*(1-$[1])+W[1]*$[1]],A=[],I=[];for(const k of this.triangleSubSegments){A[0]=k.min.x/un,A[1]=k.min.y/un,I[0]=k.max.x/un,I[1]=k.max.y/un;const W=R(b,C,A),$=R(b,C,I);if(new ls([W[0],W[1],u],[$[0],$[1],m]).intersectsPrecise(c)===0){D&&(f.segments.push(D),D=void 0);continue}const ee=k.segment;D&&D.vertexOffset!==ee.vertexOffset&&(f.segments.push(D),D=void 0),D?(D.vertexLength+=ee.vertexLength,D.primitiveLength+=ee.primitiveLength):D={vertexOffset:ee.vertexOffset,primitiveLength:ee.primitiveLength,vertexLength:ee.vertexLength,primitiveOffset:ee.primitiveOffset,sortKey:void 0,vaos:{}}}return D&&f.segments.push(D),f}encodeCentroid(t,r){const c=t.centroid(),f=r.span(),u=Math.min(7,Math.round(f.x*this.tileToMeter/10)),m=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new je(Mt(c.x,1,un-1)<<3|u,Mt(c.y,1,un-1)<<3|m)}encodeBorderCentroid(t){if(!t.borders)return new je(0,0);const r=t.borders,c=Number.MAX_VALUE;if(r[0][0]!==c||r[1][0]!==c){const f=r[0][0]!==c?0:1;return new je(6|(r[0][0]!==c?0:65528),(r[f][0]+r[f][1])/2<<3|6)}{const f=r[2][0]!==c?2:3;return new je((r[f][0]+r[f][1])/2<<3|6,6|(r[2][0]!==c?0:65528))}}showCentroid(t){const r=this.centroidData[t.centroidDataIndex];r.flags&=ti,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const r=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,f=t.flags&ti?qt:t.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==f.y||u!==f.x){for(let m=r;m<c;++m)this.centroidVertexArray.emplace(m,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,r,c){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const f=r.getReplacementRegionsForTile(t.toUnwrapped());if(vi(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const u=[];for(const m of this.activeReplacements){if(m.order<c)continue;const T=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-t.canonical.z));for(const L of this.centroidData)if(!(L.flags&ti||m.min.x>L.max.x||L.min.x>m.max.x||m.min.y>L.max.y||L.min.y>m.max.y))for(let D=0;D<L.footprintSegLen;D++){const b=this.footprintSegments[L.footprintSegIdx+D];if(u.length=0,ud(this.footprintVertices,b.vertexOffset,b.vertexCount,m.footprintTileId.canonical,t.canonical,u),ki(m.footprint,u,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-T)){L.flags|=ti;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,r,c){let f=!1;for(let u=0;u<c.footprintSegLen;u++){const m=this.footprintSegments[c.footprintSegIdx+u];let T=0;for(const L of m.ringIndices){for(let D=T,b=L+T-1;D<L+T;b=D++){const C=this.footprintVertices.int16[2*(D+m.vertexOffset)+0],R=this.footprintVertices.int16[2*(D+m.vertexOffset)+1],A=this.footprintVertices.int16[2*(b+m.vertexOffset)+1];R>r!=A>r&&t<(this.footprintVertices.int16[2*(b+m.vertexOffset)+0]-C)*(r-R)/(A-R)+C&&(f=!f)}T=L}}return f}getHeightAtTileCoord(t,r){let c=Number.NEGATIVE_INFINITY,f=!0;const u=4*(t+un)*un+(r+un);if(this.partLookup.hasOwnProperty(u)){const m=this.partLookup[u];return m?{height:m.height,hidden:!!(m.flags&ti)}:void 0}for(const m of this.centroidData)t>m.max.x||m.min.x>t||r>m.max.y||m.min.y>r||this.footprintContainsPoint(t,r,m)&&m&&m.height>c&&(c=m.height,this.partLookup[u]=m,f=!!(m.flags&ti));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:f};this.partLookup[u]=void 0}}function Ar(a,t){const r=a.add(t)._unit();return a.x*r.x+a.y*r.y}function mr(a,t,r,c){const f=t.sub(a)._perp()._unit(),u=r.sub(t)._perp()._unit();return ns(a,t,r,Ar(f,u),c)}function ns(a,t,r,c,f){const u=Math.sqrt(1-c*c);return Math.min(a.dist(t)/3,t.dist(r)/3,f*u/c)}function Kr(a,t,r){return a.x<r[0].x&&t.x<r[0].x||a.x>r[1].x&&t.x>r[1].x||a.y<r[0].y&&t.y<r[0].y||a.y>r[1].y&&t.y>r[1].y}function ta(a,t){return a.x<t[0].x||a.x>t[1].x||a.y<t[0].y||a.y>t[1].y}function io(a,t,r){if(a.x<0||a.x>=un||t.x<0||t.x>=un||r.x<0||r.x>=un)return!1;const c=r.sub(t),f=c.perp(),u=a.sub(t);return(c.x*u.x+c.y*u.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(u.x*u.x+u.y*u.y))>-.866&&f.x*u.x+f.y*u.y<0}function ia(a,t,r){const c=t?2|a:-3&a;return r?1|c:-2&c}function rl(){const a=Math.PI/32,t=Math.tan(a),r=B;return r*Math.sqrt(1+2*t*t)-r}function vh(a,t,r){const c=1<<r.z,f=Oe(r.x/c),u=Oe((r.x+1)/c),m=Ne(r.y/c),T=Ne((r.y+1)/c);return function(L,D,b,C,R=0,A){const I=[];if(!L.length||!b||!C)return I;const k=(he,Me)=>{for(const He of he)I.push({polygon:He,bounds:Me})},W=Math.ceil(Math.log2(b)),$=Math.ceil(Math.log2(C)),ee=W-$,te=[];for(let he=0;he<Math.abs(ee);he++)te.push(ee>0?0:1);for(let he=0;he<Math.min(W,$);he++)te.push(0),te.push(1);let X=L;if(X=Re(X,D[0].y-R,D[1].y+R,1),X=Re(X,D[0].x-R,D[1].x+R,0),!X.length)return I;const le=[];for(te.length?le.push({polygons:X,bounds:D,depth:0}):k(X,D);le.length;){const he=le.pop(),Me=he.depth,He=te[Me],ze=he.bounds[0],Be=he.bounds[1],yt=He===0?ze.x:ze.y,ke=He===0?Be.x:Be.y,dt=A?A(He,yt,ke):.5*(yt+ke),Et=Re(he.polygons,yt-R,dt+R,He),Ct=Re(he.polygons,dt-R,ke+R,He);if(Et.length){const Bt=[ze,new je(He===0?dt:Be.x,He===1?dt:Be.y)];te.length>Me+1?le.push({polygons:Et,bounds:Bt,depth:Me+1}):k(Et,Bt)}if(Ct.length){const Bt=[new je(He===0?dt:ze.x,He===1?dt:ze.y),Be];te.length>Me+1?le.push({polygons:Ct,bounds:Bt,depth:Me+1}):k(Ct,Bt)}}return I}(a,t,Math.ceil((u-f)/11.25),Math.ceil((m-T)/11.25),1,(L,D,b)=>{if(L===0)return .5*(D+b);{const C=Ne((r.y+D/un)/c);return(_e(.5*(Ne((r.y+b/un)/c)+C))*c-r.y)*un}})}function ud(a,t,r,c,f,u){const m=Math.pow(2,c.z-f.z);for(let T=0;T<r;T++){let L=a.int16[2*(T+t)+0],D=a.int16[2*(T+t)+1];L=(L+f.x*un)*m-c.x*un,D=(D+f.y*un)*m-c.y*un,u.push(new je(L,D))}}let xh,Sl;function la(a,t){return a.x*t.x+a.y*t.y}function Bn(a,t){if(a.length===1){let r=0;const c=t[r++];let f;for(;!f||c.equals(f);)if(f=t[r++],!f)return 1/0;for(;r<t.length;r++){const u=t[r],m=a[0],T=f.sub(c),L=u.sub(c),D=m.sub(c),b=la(T,T),C=la(T,L),R=la(L,L),A=la(D,T),I=la(D,L),k=b*R-C*C,W=(R*A-C*I)/k,$=(b*I-C*A)/k,ee=c.z*(1-W-$)+f.z*W+u.z*$;if(isFinite(ee))return ee}return 1/0}{let r=1/0;for(const c of t)r=Math.min(r,c.z);return r}}function r_(a,t,r,c,f,u,m,T){const L=m*f.getElevationAt(a,t,!0,!0),D=u[0]!==0,b=D?u[1]===0?m*(u[0]/7-450):m*function(C,R,A){const I=Math.floor(R[0]/8),k=Math.floor(R[1]/8),W=10*(R[0]-8*I),$=10*(R[1]-8*k),ee=C.getElevationAt(I,k,!0,!0),te=C.getMeterToDEM(A),X=Math.floor(.5*(W*te-1)),le=Math.floor(.5*($*te-1)),he=C.tileCoordToPixel(I,k),Me=2*X+1,He=2*le+1,ze=function(Ct,Bt,ei,ni,Yt){return[Ct.getElevationAtPixel(Bt,ei,!0),Ct.getElevationAtPixel(Bt+Yt,ei,!0),Ct.getElevationAtPixel(Bt,ei+Yt,!0),Ct.getElevationAtPixel(Bt+ni,ei+Yt,!0)]}(C,he.x-X,he.y-le,Me,He),Be=Math.abs(ze[0]-ze[1]),yt=Math.abs(ze[2]-ze[3]),ke=Math.abs(ze[0]-ze[2])+Math.abs(ze[1]-ze[3]),dt=Math.min(.25,.5*te*(Be+yt)/Me),Et=Math.min(.25,.5*te*ke/He);return ee+Math.max(dt*W,Et*$)}(f,u,T):L;return{base:L+(r===0?-1:r),top:D?Math.max(b+c,L+r+2):L+c}}Sn(or,"FillExtrusionBucket",{omit:["layers","features"]}),Sn(Ni,"PartData"),Sn(Hn,"FootprintSegment"),Sn(kt,"BorderCentroidData"),Sn(pn,"GroundEffect");const My=Qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),El=Qr([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:Sy}=My,Ey=Qr([{name:"a_packed",components:4,type:"Float32"}]),{members:Ay}=Ey,s_=Qr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Cy}=s_;class o_{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new Wc({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const c=this.getKey(t,r);return this.positions[c]}trim(){const t=this.width,r=this.height=Mn(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,c){const f=[];let u=t.length%2==1?-t[t.length-1]*c:0,m=t[0]*c,T=!0;f.push({left:u,right:m,isDash:T,zeroLength:t[0]===0});let L=t[0];for(let D=1;D<t.length;D++){T=!T;const b=t[D];u=L*c,L+=b,m=L*c,f.push({left:u,right:m,isDash:T,zeroLength:b===0})}return f}addRoundDash(t,r,c){const f=r/2;for(let u=-c;u<=c;u++){const m=this.width*(this.nextRow+c+u);let T=0,L=t[T];for(let D=0;D<this.width;D++){D/L.right>1&&(L=t[++T]);const b=Math.abs(D-L.left),C=Math.abs(D-L.right),R=Math.min(b,C);let A;const I=u/c*(f+1);if(L.isDash){const k=f-Math.abs(I);A=Math.sqrt(R*R+k*k)}else A=f-Math.sqrt(R*R+I*I);this.image.data[m+D]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(t,r){for(let L=t.length-1;L>=0;--L){const D=t[L],b=t[L+1];D.zeroLength?t.splice(L,1):b&&b.isDash===D.isDash&&(b.left=D.left,t.splice(L,1))}const c=t[0],f=t[t.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const u=this.width*this.nextRow;let m=0,T=t[m];for(let L=0;L<this.width;L++){L/T.right>1&&(T=t[++m]);const D=Math.abs(L-T.left),b=Math.abs(L-T.right),C=Math.min(D,b);this.image.data[u+L]=Math.max(0,Math.min(255,(T.isDash?C:-C)+r+128))}}addDash(t,r){const c=this.getKey(t,r);if(this.positions[c])return this.positions[c];const f=r==="round",u=f?7:0,m=2*u+1;if(this.nextRow+m>this.height)return Wn("LineAtlas out of space"),null;t.length===0&&t.push(1);let T=0;for(let b=0;b<t.length;b++)t[b]<0&&(Wn("Negative value is found in line dasharray, replacing values with 0"),t[b]=0),T+=t[b];if(T!==0){const b=this.width/T,C=this.getDashRanges(t,this.width,b);f?this.addRoundDash(C,b,u):this.addRegularDash(C,r==="square"?.5*b:0)}const L=this.nextRow+u;this.nextRow+=m;const D={tl:[L,u],br:[T,0]};return this.positions[c]=D,D}}Sn(o_,"LineAtlas");const hd=oe.VectorTileFeature.types,Ly=Math.cos(Math.PI/180*37.5),Iy=Math.cos(Math.PI/180*5);class gp{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new zc,this.layoutVertexArray2=new va,this.patternVertexArray=new tc,this.indexArray=new qs,this.programConfigurations=new Gl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Ks,this.maxLineLength=0,this.zOffsetVertexArray=new Ra,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:un/64}updateFootprints(t,r){}populate(t,r,c,f){this.hasPattern=zm("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();const m=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&m==="none"&&Wn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&T!==void 0;const L=[];for(const{feature:R,id:A,index:I,sourceLayerIndex:k}of t){const W=this.layers[0]._featureFilter.needGeometry,$=wi(R,W);if(!this.layers[0]._featureFilter.filter(new Qs(this.zoom),$,c))continue;const ee=u?u.evaluate($,{},c):void 0,te={id:A,properties:R.properties,type:R.type,sourceLayerIndex:k,index:I,geometry:W?$.geometry:Wt(R,c,f),patterns:{},sortKey:ee};L.push(te)}u&&L.sort((R,A)=>R.sortKey-A.sortKey);const{lineAtlas:D,featureIndex:b}=r,C=this.addConstantDashes(D);for(const R of L){const{geometry:A,index:I,sourceLayerIndex:k}=R;if(C&&this.addFeatureDashes(R,D),this.hasPattern){const W=mp("line",this.layers,R,this.zoom,r);this.patternFeatures.push(W)}else this.addFeature(R,A,I,c,D.positions,r.availableImages,r.brightness);b.insert(t[I].feature,A,I,k,this.index)}}addConstantDashes(t){let r=!1;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,u=c.layout.get("line-cap").value;if(f.kind!=="constant"||u.kind!=="constant")r=!0;else{const m=u.value,T=f.value;if(!T)continue;t.addDash(T,m)}}return r}addFeatureDashes(t,r){const c=this.zoom;for(const f of this.layers){const u=f.paint.get("line-dasharray").value,m=f.layout.get("line-cap").value;if(u.kind==="constant"&&m.kind==="constant")continue;let T,L;if(u.kind==="constant"){if(T=u.value,!T)continue}else T=u.evaluate({zoom:c},t);L=m.kind==="constant"?m.value:m.evaluate({zoom:c},t),r.addDash(T,L),t.patterns[f.id]=r.getKey(T,L)}}update(t,r,c,f,u){const m=Object.keys(t).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,m?this.stateDependentLayers:this.layers,c,f,u)}addFeatures(t,r,c,f,u,m){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,r,c,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ay)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,Cy)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,El.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sy),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,c,f,u,m,T){const L=this.layers[0].layout,D=L.get("line-join").evaluate(t,{}),b=L.get("line-cap").evaluate(t,{}),C=L.get("line-miter-limit"),R=L.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=L.get("line-z-offset").value;for(const A of r)this.addLine(A,t,f,D,b,C,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,u,m,f,T)}addLine(t,r,c,f,u,m,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const L=f==="none";if(this.patternJoinNone=this.hasPattern&&L,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<t.length-1;te++)this.totalDistance+=t[te].dist(t[te+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D=hd[r.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let C=0;for(;C<b-1&&t[C].equals(t[C+1]);)C++;if(b<(D?3:2))return;f==="bevel"&&(m=1.05);const R=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let A,I,k,W,$,ee;this.e1=this.e2=-1,D&&(A=t[b-2],$=t[C].sub(A)._unit()._perp());for(let te=C;te<b;te++){if(k=te===b-1?D?t[C+1]:void 0:t[te+1],k&&t[te].equals(k))continue;$&&(W=$),A&&(I=A),A=t[te],ee=this.hasZOffset?this.evaluateElevationValue(I?I.dist(A):0):null,$=k?k.sub(A)._unit()._perp():W,W=W||$;const X=I&&k;let le=X?f:D||L?"butt":u;const he=W.x*$.x+W.y*$.y;if(L){const Et=function(Ct){if(Ct.patternJoinNone){const Bt=Ct.segmentPoints.length/2,ei=Ct.lineSoFar-Ct.segmentStart;for(let ni=0;ni<Bt;++ni){const Yt=Ct.segmentPoints[2*ni+1],yi=Math.round(Ct.segmentPoints[2*ni])+.5+.25*Yt;Ct.patternVertexArray.emplaceBack(yi,ei,Ct.segmentStart),Ct.patternVertexArray.emplaceBack(yi,ei,Ct.segmentStart)}Ct.segmentPoints.length=0}Ct.e1=Ct.e2=-1};if(X&&he<Iy){this.updateDistance(I,A),this.addCurrentVertex(A,W,1,1,R,ee),Et(this),this.addCurrentVertex(A,$,-1,-1,R,ee);continue}if(I){if(!k){this.updateDistance(I,A),this.addCurrentVertex(A,W,1,1,R,ee),Et(this);continue}le="miter"}}let Me=W.add($);Me.x===0&&Me.y===0||Me._unit();const He=Me.x*$.x+Me.y*$.y,ze=He!==0?1/He:1/0,Be=2*Math.sqrt(2-2*He),yt=He<Ly&&I&&k,ke=W.x*$.y-W.y*$.x>0,dt=this.overscaling<=16?15*un/(512*this.overscaling):0;if(X&&le==="round"){if(ze<T)le="miter";else if(ze<=2){const Et=a_(A,-10,un+10);le=this.hasZOffset&&(Et||this.hasCrossSlope)?"miter":"fakeround"}}if(le==="miter"&&ze>m&&(le="bevel"),le==="bevel"&&(ze>2&&(le="flipbevel"),ze<m&&(le="miter")),I&&!(le==="miter"&&yt)&&this.updateDistance(I,A),le==="miter")if(yt){const Et=A.dist(I);if(Et>2*dt){const Bt=A.sub(A.sub(I)._mult(dt/Et)._round());this.updateDistance(I,Bt),this.addCurrentVertex(Bt,W,0,0,R,ee),I=Bt}this.updateDistance(I,A),Me._mult(ze),this.addCurrentVertex(A,Me,0,0,R,ee);const Ct=A.dist(k);if(Ct>2*dt){const Bt=A.add(k.sub(A)._mult(dt/Ct)._round());this.updateDistance(A,Bt),this.addCurrentVertex(Bt,$,0,0,R,ee),A=Bt}}else Me._mult(ze),this.addCurrentVertex(A,Me,0,0,R,ee);else if(le==="flipbevel"){if(ze>100)Me=$.mult(-1);else{const Et=ze*W.add($).mag()/W.sub($).mag();Me._perp()._mult(Et*(ke?-1:1))}this.addCurrentVertex(A,Me,0,0,R,ee),this.addCurrentVertex(A,Me.mult(-1),0,0,R,ee)}else if(le==="bevel"||le==="fakeround"){ee!=null&&I&&this.addCurrentVertex(A,W,-1,-1,R,ee);const Et=A.dist(I)<=2*dt&&le!=="bevel",Ct=Me.mult(ke?1:-1);Ct._mult(ze);const Bt=$.mult(ke?-1:1),ei=W.mult(ke?-1:1),ni=this.evaluateElevationValue(this.distance);if(ee==null&&(this.addHalfVertex(A,Ct.x,Ct.y,!1,!ke,0,R,ni),Et||this.addHalfVertex(A,Ct.x+2*ei.x,Ct.y+2*ei.y,!1,ke,0,R,ni)),le==="fakeround"){const Yt=Math.round(180*Be/Math.PI/20);this.addHalfVertex(A,ei.x,ei.y,!1,ke,0,R,ni);for(let yi=0;yi<Yt;yi++){let Fi=yi/Yt;if(Fi!==.5){const Tn=Fi-.5;Fi+=Fi*Tn*(Fi-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*Tn*Tn+(.848013+he*(.215638*he-1.06021)))}const di=Bt.sub(ei)._mult(Fi)._add(ei)._unit();this.addHalfVertex(A,di.x,di.y,!1,ke,0,R,ni)}this.addHalfVertex(A,Bt.x,Bt.y,!1,ke,0,R,ni)}Et||ee!=null||this.addHalfVertex(A,Ct.x+2*Bt.x,Ct.y+2*Bt.y,!1,ke,0,R,ni),ee!=null&&k&&this.addCurrentVertex(A,$,1,1,R,ee)}else le==="butt"?this.addCurrentVertex(A,Me,0,0,R,ee):le==="square"?(I||this.addCurrentVertex(A,Me,-1,-1,R,ee),this.addCurrentVertex(A,Me,0,0,R,ee),I&&this.addCurrentVertex(A,Me,1,1,R,ee)):le==="round"&&(I&&(this.addCurrentVertex(A,W,0,0,R,ee),this.addCurrentVertex(A,W,1,1,R,ee,!0)),k&&(this.addCurrentVertex(A,$,-1,-1,R,ee,!0),this.addCurrentVertex(A,$,0,0,R,ee)))}}addVerticesTo(t,r,c,f,u,m,T,L,D,b){const C=(r.w-t.w)/this.tessellationStep|0;let R=0;const A=this.scaledDistance;if(C>1){this.lineSoFar=t.w;const k=(r.x-t.x)/C,W=(r.y-t.y)/C,$=(r.z-t.z)/C,ee=(r.w-t.w)/C;for(let te=1;te<C;++te){t.x+=k,t.y+=W,t.z+=$,this.lineSoFar+=ee,R+=ee;const X=this.evaluateElevationValue(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(t,c,f,b,!1,T,D,X),this.addHalfVertex(t,u,m,b,!0,-L,D,X)}}this.lineSoFar=r.w,this.scaledDistance=A;const I=this.evaluateElevationValue(this.distance);this.addHalfVertex(r,c,f,b,!1,T,D,I),this.addHalfVertex(r,u,m,b,!0,-L,D,I)}evaluateElevationValue(t){return this.hasZOffset?this.zOffsetValue.kind==="constant"?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):Wn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(t,r,c,f,u,m,T=!1){const L=r.x+r.y*c,D=r.y-r.x*c,b=r.y*f-r.x,C=-r.y-r.x*f;if(m!=null){const A=un+10,I=m,k=new xe(t.x,t.y,I,this.lineSoFar),W=a_(t,-10,A),$=this.lineSoFar,ee=this.distance;if(this.currentVertex)if(W){const te=this.currentVertexIsOutside,X=this.currentVertex,le=new xe(t.x,t.y,I,this.lineSoFar);if(nt(X,le,-10,A),!a_(le,-10,A)){if(te){this.e1=this.e2=-1,this.distance-=X.dist(k),this.lineSoFar=X.w;const he=this.evaluateElevationValue(X.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(X,L,D,T,!1,c,u,he),this.addHalfVertex(X,b,C,T,!0,-f,u,he),this.prevDistance=this.distance}this.distance=this.prevDistance+X.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(X,le,L,D,b,C,c,f,u,T),this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}}else{const te=this.currentVertex;if(this.currentVertexIsOutside){nt(te,k,-10,A),this.e1=this.e2=-1,this.distance-=te.dist(k),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=te.w;const X=this.evaluateElevationValue(te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(te,L,D,T,!1,c,u,X),this.addHalfVertex(te,b,C,T,!0,-f,u,X),this.prevDistance=this.distance,this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(te,k,L,D,b,C,c,f,u,T)}else W||(this.addHalfVertex(t,L,D,T,!1,c,u,m),this.addHalfVertex(t,b,C,T,!0,-f,u,m));this.currentVertex=k,this.currentVertexIsOutside=W,this.lineSoFar=$}else this.addHalfVertex(t,L,D,T,!1,c,u,m),this.addHalfVertex(t,b,C,T,!0,-f,u,m)}addHalfVertex({x:t,y:r},c,f,u,m,T,L,D){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((t<<1)+(u?1:0),(r<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),L.primitiveLength++),m?this.e2=b:this.e1=b,D!=null&&this.zOffsetVertexArray.emplaceBack(D)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,r){this.prevDistance=this.distance,this.distance+=t.dist(r),this.updateScaledDistance()}}function a_(a,t,r){return a.x<t||a.x>r||a.y<t||a.y>r}let Bm,l_;function c_(a,t,r){return t*(un/(a.tileSize*Math.pow(2,r-a.tileID.overscaledZ)))}Sn(gp,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const jt=(a,t,r)=>(1-r)*a+r*t;function rn(a,t){return 1/c_(a,1,t.tileZoom)}function Ri(a,t,r,c){return a.translatePosMatrix(c||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const sn=a=>{const t=[];On(a)&&t.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=a.paint.get("line-trim-offset");r[0]===0&&r[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=a.layout.get("line-join").constantOr("miter")==="none",f=!!a.paint.get("line-pattern").constantOr(1);return c&&f&&t.push("LINE_JOIN_NONE"),t};function On(a){const t=a.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let qr;const Mr=()=>qr||(qr={layout:Bm||(Bm=new Ts({"line-cap":new yn(Jt.layout_line["line-cap"]),"line-join":new yn(Jt.layout_line["line-join"]),"line-miter-limit":new qi(Jt.layout_line["line-miter-limit"]),"line-round-limit":new qi(Jt.layout_line["line-round-limit"]),"line-sort-key":new yn(Jt.layout_line["line-sort-key"]),"line-z-offset":new yn(Jt.layout_line["line-z-offset"]),"line-elevation-reference":new qi(Jt.layout_line["line-elevation-reference"]),"line-cross-slope":new qi(Jt.layout_line["line-cross-slope"]),visibility:new qi(Jt.layout_line.visibility)})),paint:l_||(l_=new Ts({"line-opacity":new yn(Jt.paint_line["line-opacity"]),"line-color":new yn(Jt.paint_line["line-color"]),"line-translate":new qi(Jt.paint_line["line-translate"]),"line-translate-anchor":new qi(Jt.paint_line["line-translate-anchor"]),"line-width":new yn(Jt.paint_line["line-width"]),"line-gap-width":new yn(Jt.paint_line["line-gap-width"]),"line-offset":new yn(Jt.paint_line["line-offset"]),"line-blur":new yn(Jt.paint_line["line-blur"]),"line-dasharray":new yn(Jt.paint_line["line-dasharray"]),"line-pattern":new yn(Jt.paint_line["line-pattern"]),"line-gradient":new pu(Jt.paint_line["line-gradient"]),"line-trim-offset":new qi(Jt.paint_line["line-trim-offset"]),"line-trim-fade-range":new qi(Jt.paint_line["line-trim-fade-range"]),"line-trim-color":new qi(Jt.paint_line["line-trim-color"]),"line-emissive-strength":new qi(Jt.paint_line["line-emissive-strength"]),"line-border-width":new yn(Jt.paint_line["line-border-width"]),"line-border-color":new yn(Jt.paint_line["line-border-color"]),"line-occlusion-opacity":new qi(Jt.paint_line["line-occlusion-opacity"])}))},qr);class rs extends yn{possiblyEvaluate(t,r){return r=new Qs(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,c,f){return r=cn({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,c,f)}}let cs;function so(a,t){return t>0?t+2*a:a}const $s=Qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),As=Qr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ss=Qr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dd=Qr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),ko=Qr([{name:"a_texb",components:2,type:"Uint16"}]),bh=Qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),lc=Qr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wh=Qr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Th=Qr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qr([{name:"triangle",components:3,type:"Uint16"}]),Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Qr([{type:"Float32",name:"offsetX"}]),Qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var zs=24;const Zo=128;function ca(a,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Qs(a+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=r;let u=0;for(;u<c.length&&c[u]<=a;)u++;u=Math.max(0,u-1);let m=u;for(;m<c.length&&c[m]<a+1;)m++;m=Math.min(c.length-1,m);const T=c[u],L=c[m];return r.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:L,interpolationType:f}:{kind:"camera",minZoom:T,maxZoom:L,minSize:r.evaluate(new Qs(T)),maxSize:r.evaluate(new Qs(L)),interpolationType:f}}}function sl(a,{uSize:t,uSizeT:r},{lowerSize:c,upperSize:f}){return a.kind==="source"?c/Zo:a.kind==="composite"?Pe(c/Zo,f/Zo,r):t}function Da(a,t,r=1){let c=0,f=0;if(a.kind==="constant")f=a.layoutSize*r;else if(a.kind!=="source"){const{interpolationType:u,minZoom:m,maxZoom:T}=a,L=u?Mt(La.interpolationFactor(u,t,m,T),0,1):0;a.kind==="camera"?f=Pe(a.minSize,a.maxSize,L)*r:c=L*r}return{uSizeT:c,uSize:f}}var lA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Zo,evaluateSizeForFeature:sl,evaluateSizeForZoom:Da,getSizeData:ca});function cA(a,t,r){return a.sections.forEach(c=>{c.text=function(f,u,m){const T=u.layout.get("text-transform").evaluate(m,{});return T==="uppercase"?f=f.toLocaleUpperCase():T==="lowercase"&&(f=f.toLocaleLowerCase()),oa.applyArabicShaping&&(f=oa.applyArabicShaping(f)),f}(c.text,t,r)}),a}const u_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function uA(a){return a==="︶"||a==="﹈"||a==="︸"||a==="﹄"||a==="﹂"||a==="︾"||a==="︼"||a==="︺"||a==="︘"||a==="﹀"||a==="︐"||a==="︓"||a==="︔"||a==="｀"||a==="￣"||a==="︑"||a==="︒"}function hA(a){return a==="︵"||a==="﹇"||a==="︷"||a==="﹃"||a==="﹁"||a==="︽"||a==="︻"||a==="︹"||a==="︗"||a==="︿"}var Eb,pv,Ab,fv={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function dA(){return Eb||(Eb=1,fv.read=function(a,t,r,c,f){var u,m,T=8*f-c-1,L=(1<<T)-1,D=L>>1,b=-7,C=r?f-1:0,R=r?-1:1,A=a[t+C];for(C+=R,u=A&(1<<-b)-1,A>>=-b,b+=T;b>0;u=256*u+a[t+C],C+=R,b-=8);for(m=u&(1<<-b)-1,u>>=-b,b+=c;b>0;m=256*m+a[t+C],C+=R,b-=8);if(u===0)u=1-D;else{if(u===L)return m?NaN:1/0*(A?-1:1);m+=Math.pow(2,c),u-=D}return(A?-1:1)*m*Math.pow(2,u-c)},fv.write=function(a,t,r,c,f,u){var m,T,L,D=8*u-f-1,b=(1<<D)-1,C=b>>1,R=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=c?0:u-1,I=c?1:-1,k=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(T=isNaN(t)?1:0,m=b):(m=Math.floor(Math.log(t)/Math.LN2),t*(L=Math.pow(2,-m))<1&&(m--,L*=2),(t+=m+C>=1?R/L:R*Math.pow(2,1-C))*L>=2&&(m++,L/=2),m+C>=b?(T=0,m=b):m+C>=1?(T=(t*L-1)*Math.pow(2,f),m+=C):(T=t*Math.pow(2,C-1)*Math.pow(2,f),m=0));f>=8;a[r+A]=255&T,A+=I,T/=256,f-=8);for(m=m<<f|T,D+=f;D>0;a[r+A]=255&m,A+=I,m/=256,D-=8);a[r+A-I]|=128*k}),fv}function Cb(){if(Ab)return pv;Ab=1,pv=t;var a=dA();function t(X){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(X)?X:new Uint8Array(X||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,c=1/r,f=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function u(X){return X.type===t.Bytes?X.readVarint()+X.pos:X.pos+1}function m(X,le,he){return he?4294967296*le+(X>>>0):4294967296*(le>>>0)+(X>>>0)}function T(X,le,he){var Me=le<=16383?1:le<=2097151?2:le<=268435455?3:Math.floor(Math.log(le)/(7*Math.LN2));he.realloc(Me);for(var He=he.pos-1;He>=X;He--)he.buf[He+Me]=he.buf[He]}function L(X,le){for(var he=0;he<X.length;he++)le.writeVarint(X[he])}function D(X,le){for(var he=0;he<X.length;he++)le.writeSVarint(X[he])}function b(X,le){for(var he=0;he<X.length;he++)le.writeFloat(X[he])}function C(X,le){for(var he=0;he<X.length;he++)le.writeDouble(X[he])}function R(X,le){for(var he=0;he<X.length;he++)le.writeBoolean(X[he])}function A(X,le){for(var he=0;he<X.length;he++)le.writeFixed32(X[he])}function I(X,le){for(var he=0;he<X.length;he++)le.writeSFixed32(X[he])}function k(X,le){for(var he=0;he<X.length;he++)le.writeFixed64(X[he])}function W(X,le){for(var he=0;he<X.length;he++)le.writeSFixed64(X[he])}function $(X,le){return(X[le]|X[le+1]<<8|X[le+2]<<16)+16777216*X[le+3]}function ee(X,le,he){X[he]=le,X[he+1]=le>>>8,X[he+2]=le>>>16,X[he+3]=le>>>24}function te(X,le){return(X[le]|X[le+1]<<8|X[le+2]<<16)+(X[le+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(X,le,he){for(he=he||this.length;this.pos<he;){var Me=this.readVarint(),He=Me>>3,ze=this.pos;this.type=7&Me,X(He,le,this),this.pos===ze&&this.skip(Me)}return le},readMessage:function(X,le){return this.readFields(X,le,this.readVarint()+this.pos)},readFixed32:function(){var X=$(this.buf,this.pos);return this.pos+=4,X},readSFixed32:function(){var X=te(this.buf,this.pos);return this.pos+=4,X},readFixed64:function(){var X=$(this.buf,this.pos)+$(this.buf,this.pos+4)*r;return this.pos+=8,X},readSFixed64:function(){var X=$(this.buf,this.pos)+te(this.buf,this.pos+4)*r;return this.pos+=8,X},readFloat:function(){var X=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,X},readDouble:function(){var X=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,X},readVarint:function(X){var le,he,Me=this.buf;return le=127&(he=Me[this.pos++]),he<128?le:(le|=(127&(he=Me[this.pos++]))<<7,he<128?le:(le|=(127&(he=Me[this.pos++]))<<14,he<128?le:(le|=(127&(he=Me[this.pos++]))<<21,he<128?le:function(He,ze,Be){var yt,ke,dt=Be.buf;if(yt=(112&(ke=dt[Be.pos++]))>>4,ke<128||(yt|=(127&(ke=dt[Be.pos++]))<<3,ke<128)||(yt|=(127&(ke=dt[Be.pos++]))<<10,ke<128)||(yt|=(127&(ke=dt[Be.pos++]))<<17,ke<128)||(yt|=(127&(ke=dt[Be.pos++]))<<24,ke<128)||(yt|=(1&(ke=dt[Be.pos++]))<<31,ke<128))return m(He,yt,ze);throw new Error("Expected varint not more than 10 bytes")}(le|=(15&(he=Me[this.pos]))<<28,X,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var X=this.readVarint();return X%2==1?(X+1)/-2:X/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var X=this.readVarint()+this.pos,le=this.pos;return this.pos=X,X-le>=12&&f?function(he,Me,He){return f.decode(he.subarray(Me,He))}(this.buf,le,X):function(he,Me,He){for(var ze="",Be=Me;Be<He;){var yt,ke,dt,Et=he[Be],Ct=null,Bt=Et>239?4:Et>223?3:Et>191?2:1;if(Be+Bt>He)break;Bt===1?Et<128&&(Ct=Et):Bt===2?(192&(yt=he[Be+1]))==128&&(Ct=(31&Et)<<6|63&yt)<=127&&(Ct=null):Bt===3?(ke=he[Be+2],(192&(yt=he[Be+1]))==128&&(192&ke)==128&&((Ct=(15&Et)<<12|(63&yt)<<6|63&ke)<=2047||Ct>=55296&&Ct<=57343)&&(Ct=null)):Bt===4&&(ke=he[Be+2],dt=he[Be+3],(192&(yt=he[Be+1]))==128&&(192&ke)==128&&(192&dt)==128&&((Ct=(15&Et)<<18|(63&yt)<<12|(63&ke)<<6|63&dt)<=65535||Ct>=1114112)&&(Ct=null)),Ct===null?(Ct=65533,Bt=1):Ct>65535&&(Ct-=65536,ze+=String.fromCharCode(Ct>>>10&1023|55296),Ct=56320|1023&Ct),ze+=String.fromCharCode(Ct),Be+=Bt}return ze}(this.buf,le,X)},readBytes:function(){var X=this.readVarint()+this.pos,le=this.buf.subarray(this.pos,X);return this.pos=X,le},readPackedVarint:function(X,le){if(this.type!==t.Bytes)return X.push(this.readVarint(le));var he=u(this);for(X=X||[];this.pos<he;)X.push(this.readVarint(le));return X},readPackedSVarint:function(X){if(this.type!==t.Bytes)return X.push(this.readSVarint());var le=u(this);for(X=X||[];this.pos<le;)X.push(this.readSVarint());return X},readPackedBoolean:function(X){if(this.type!==t.Bytes)return X.push(this.readBoolean());var le=u(this);for(X=X||[];this.pos<le;)X.push(this.readBoolean());return X},readPackedFloat:function(X){if(this.type!==t.Bytes)return X.push(this.readFloat());var le=u(this);for(X=X||[];this.pos<le;)X.push(this.readFloat());return X},readPackedDouble:function(X){if(this.type!==t.Bytes)return X.push(this.readDouble());var le=u(this);for(X=X||[];this.pos<le;)X.push(this.readDouble());return X},readPackedFixed32:function(X){if(this.type!==t.Bytes)return X.push(this.readFixed32());var le=u(this);for(X=X||[];this.pos<le;)X.push(this.readFixed32());return X},readPackedSFixed32:function(X){if(this.type!==t.Bytes)return X.push(this.readSFixed32());var le=u(this);for(X=X||[];this.pos<le;)X.push(this.readSFixed32());return X},readPackedFixed64:function(X){if(this.type!==t.Bytes)return X.push(this.readFixed64());var le=u(this);for(X=X||[];this.pos<le;)X.push(this.readFixed64());return X},readPackedSFixed64:function(X){if(this.type!==t.Bytes)return X.push(this.readSFixed64());var le=u(this);for(X=X||[];this.pos<le;)X.push(this.readSFixed64());return X},skip:function(X){var le=7&X;if(le===t.Varint)for(;this.buf[this.pos++]>127;);else if(le===t.Bytes)this.pos=this.readVarint()+this.pos;else if(le===t.Fixed32)this.pos+=4;else{if(le!==t.Fixed64)throw new Error("Unimplemented type: "+le);this.pos+=8}},writeTag:function(X,le){this.writeVarint(X<<3|le)},realloc:function(X){for(var le=this.length||16;le<this.pos+X;)le*=2;if(le!==this.length){var he=new Uint8Array(le);he.set(this.buf),this.buf=he,this.length=le}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(X){this.realloc(4),ee(this.buf,X,this.pos),this.pos+=4},writeSFixed32:function(X){this.realloc(4),ee(this.buf,X,this.pos),this.pos+=4},writeFixed64:function(X){this.realloc(8),ee(this.buf,-1&X,this.pos),ee(this.buf,Math.floor(X*c),this.pos+4),this.pos+=8},writeSFixed64:function(X){this.realloc(8),ee(this.buf,-1&X,this.pos),ee(this.buf,Math.floor(X*c),this.pos+4),this.pos+=8},writeVarint:function(X){(X=+X||0)>268435455||X<0?function(le,he){var Me,He;if(le>=0?(Me=le%4294967296|0,He=le/4294967296|0):(He=~(-le/4294967296),4294967295^(Me=~(-le%4294967296))?Me=Me+1|0:(Me=0,He=He+1|0)),le>=18446744073709552e3||le<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");he.realloc(10),function(ze,Be,yt){yt.buf[yt.pos++]=127&ze|128,ze>>>=7,yt.buf[yt.pos++]=127&ze|128,ze>>>=7,yt.buf[yt.pos++]=127&ze|128,ze>>>=7,yt.buf[yt.pos++]=127&ze|128,yt.buf[yt.pos]=127&(ze>>>=7)}(Me,0,he),function(ze,Be){var yt=(7&ze)<<4;Be.buf[Be.pos++]|=yt|((ze>>>=3)?128:0),ze&&(Be.buf[Be.pos++]=127&ze|((ze>>>=7)?128:0),ze&&(Be.buf[Be.pos++]=127&ze|((ze>>>=7)?128:0),ze&&(Be.buf[Be.pos++]=127&ze|((ze>>>=7)?128:0),ze&&(Be.buf[Be.pos++]=127&ze|((ze>>>=7)?128:0),ze&&(Be.buf[Be.pos++]=127&ze)))))}(He,he)}(X,this):(this.realloc(4),this.buf[this.pos++]=127&X|(X>127?128:0),X<=127||(this.buf[this.pos++]=127&(X>>>=7)|(X>127?128:0),X<=127||(this.buf[this.pos++]=127&(X>>>=7)|(X>127?128:0),X<=127||(this.buf[this.pos++]=X>>>7&127))))},writeSVarint:function(X){this.writeVarint(X<0?2*-X-1:2*X)},writeBoolean:function(X){this.writeVarint(!!X)},writeString:function(X){X=String(X),this.realloc(4*X.length),this.pos++;var le=this.pos;this.pos=function(Me,He,ze){for(var Be,yt,ke=0;ke<He.length;ke++){if((Be=He.charCodeAt(ke))>55295&&Be<57344){if(!yt){Be>56319||ke+1===He.length?(Me[ze++]=239,Me[ze++]=191,Me[ze++]=189):yt=Be;continue}if(Be<56320){Me[ze++]=239,Me[ze++]=191,Me[ze++]=189,yt=Be;continue}Be=yt-55296<<10|Be-56320|65536,yt=null}else yt&&(Me[ze++]=239,Me[ze++]=191,Me[ze++]=189,yt=null);Be<128?Me[ze++]=Be:(Be<2048?Me[ze++]=Be>>6|192:(Be<65536?Me[ze++]=Be>>12|224:(Me[ze++]=Be>>18|240,Me[ze++]=Be>>12&63|128),Me[ze++]=Be>>6&63|128),Me[ze++]=63&Be|128)}return ze}(this.buf,X,this.pos);var he=this.pos-le;he>=128&&T(le,he,this),this.pos=le-1,this.writeVarint(he),this.pos+=he},writeFloat:function(X){this.realloc(4),a.write(this.buf,X,this.pos,!0,23,4),this.pos+=4},writeDouble:function(X){this.realloc(8),a.write(this.buf,X,this.pos,!0,52,8),this.pos+=8},writeBytes:function(X){var le=X.length;this.writeVarint(le),this.realloc(le);for(var he=0;he<le;he++)this.buf[this.pos++]=X[he]},writeRawMessage:function(X,le){this.pos++;var he=this.pos;X(le,this);var Me=this.pos-he;Me>=128&&T(he,Me,this),this.pos=he-1,this.writeVarint(Me),this.pos+=Me},writeMessage:function(X,le,he){this.writeTag(X,t.Bytes),this.writeRawMessage(le,he)},writePackedVarint:function(X,le){le.length&&this.writeMessage(X,L,le)},writePackedSVarint:function(X,le){le.length&&this.writeMessage(X,D,le)},writePackedBoolean:function(X,le){le.length&&this.writeMessage(X,R,le)},writePackedFloat:function(X,le){le.length&&this.writeMessage(X,b,le)},writePackedDouble:function(X,le){le.length&&this.writeMessage(X,C,le)},writePackedFixed32:function(X,le){le.length&&this.writeMessage(X,A,le)},writePackedSFixed32:function(X,le){le.length&&this.writeMessage(X,I,le)},writePackedFixed64:function(X,le){le.length&&this.writeMessage(X,k,le)},writePackedSFixed64:function(X,le){le.length&&this.writeMessage(X,W,le)},writeBytesField:function(X,le){this.writeTag(X,t.Bytes),this.writeBytes(le)},writeFixed32Field:function(X,le){this.writeTag(X,t.Fixed32),this.writeFixed32(le)},writeSFixed32Field:function(X,le){this.writeTag(X,t.Fixed32),this.writeSFixed32(le)},writeFixed64Field:function(X,le){this.writeTag(X,t.Fixed64),this.writeFixed64(le)},writeSFixed64Field:function(X,le){this.writeTag(X,t.Fixed64),this.writeSFixed64(le)},writeVarintField:function(X,le){this.writeTag(X,t.Varint),this.writeVarint(le)},writeSVarintField:function(X,le){this.writeTag(X,t.Varint),this.writeSVarint(le)},writeStringField:function(X,le){this.writeTag(X,t.Bytes),this.writeString(le)},writeFloatField:function(X,le){this.writeTag(X,t.Fixed32),this.writeFloat(le)},writeDoubleField:function(X,le){this.writeTag(X,t.Fixed64),this.writeDouble(le)},writeBooleanField:function(X,le){this.writeVarintField(X,!!le)}},pv}var Ry=J(Cb());const mv=3;function pA(a,t,r){t.glyphs=[],a===1&&r.readMessage(fA,t)}function fA(a,t,r){if(a===3){const{id:c,bitmap:f,width:u,height:m,left:T,top:L,advance:D}=r.readMessage(mA,{});t.glyphs.push({id:c,bitmap:new Wc({width:u+2*mv,height:m+2*mv},f),metrics:{width:u,height:m,left:T,top:L,advance:D}})}else a===4?t.ascender=r.readSVarint():a===5&&(t.descender=r.readSVarint())}function mA(a,t,r){a===1?t.id=r.readVarint():a===2?t.bitmap=r.readBytes():a===3?t.width=r.readVarint():a===4?t.height=r.readVarint():a===5?t.left=r.readSVarint():a===6?t.top=r.readSVarint():a===7&&(t.advance=r.readVarint())}const Lb=mv,cc={horizontal:1,vertical:2,horizontalOnly:3};class h_{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const c=new h_;return c.scale=t||1,c.fontStack=r,c}static forImage(t){const r=new h_;return r.imageName=t,r}}class Nm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const c=new Nm;for(let f=0;f<t.sections.length;f++){const u=t.sections[f];u.image?c.addImageSection(u):c.addTextSection(u,r)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(r,c){let f="";for(let u=0;u<r.length;u++){const m=r.charCodeAt(u+1)||null,T=r.charCodeAt(u-1)||null;f+=!c&&(m&&jd(m)&&!u_[r[u+1]]||T&&jd(T)&&!u_[r[u-1]])||!u_[r[u]]?r[u]:u_[r[u]]}return f}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&Py[this.text.charCodeAt(c)];c++)t++;let r=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Py[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const c=new Nm;return c.text=this.text.substring(t,r),c.sectionIndex=this.sectionIndex.slice(t,r),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(h_.forText(t.scale,t.fontStack||r));const c=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(c)}addImageSection(t){const r=t.image?t.image.namePrimary:"";if(r.length===0)return void Wn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(h_.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Wn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gv(a,t,r,c,f,u,m,T,L,D,b,C,R,A,I){const k=Nm.fromFeature(a,f);C===cc.vertical&&k.verticalizePunctuation(R);let W=[];const $=function(he,Me,He,ze,Be,yt){if(!he)return[];const ke=[],dt=function(ei,ni,Yt,yi,Fi,di){let Tn=0;for(let ln=0;ln<ei.length();ln++){const $i=ei.getSection(ln);Tn+=Ib(ei.getCodePoint(ln),$i,yi,Fi,ni,di)}return Tn/Math.max(1,Math.ceil(Tn/Yt))}(he,Me,He,ze,Be,yt),Et=he.text.indexOf("​")>=0;let Ct=0;for(let ei=0;ei<he.length();ei++){const ni=he.getSection(ei),Yt=he.getCodePoint(ei);if(Py[Yt]||(Ct+=Ib(Yt,ni,ze,Be,Me,yt)),ei<he.length()-1){const yi=!((Bt=Yt)<11904||!(Gn["Bopomofo Extended"](Bt)||Gn.Bopomofo(Bt)||Gn["CJK Compatibility Forms"](Bt)||Gn["CJK Compatibility Ideographs"](Bt)||Gn["CJK Compatibility"](Bt)||Gn["CJK Radicals Supplement"](Bt)||Gn["CJK Strokes"](Bt)||Gn["CJK Symbols and Punctuation"](Bt)||Gn["CJK Unified Ideographs Extension A"](Bt)||Gn["CJK Unified Ideographs"](Bt)||Gn["Enclosed CJK Letters and Months"](Bt)||Gn["Halfwidth and Fullwidth Forms"](Bt)||Gn.Hiragana(Bt)||Gn["Ideographic Description Characters"](Bt)||Gn["Kangxi Radicals"](Bt)||Gn["Katakana Phonetic Extensions"](Bt)||Gn.Katakana(Bt)||Gn["Vertical Forms"](Bt)||Gn["Yi Radicals"](Bt)||Gn["Yi Syllables"](Bt)));(gA[Yt]||yi||ni.imageName)&&ke.push(Pb(ei+1,Ct,dt,ke,_A(Yt,he.getCodePoint(ei+1),yi&&Et),!1))}}var Bt;return Db(Pb(he.length(),Ct,dt,ke,0,!0))}(k,D,u,t,c,A),{processBidirectionalText:ee,processStyledBidirectionalText:te}=oa;if(ee&&k.sections.length===1){const he=ee(k.toString(),$);for(const Me of he){const He=new Nm;He.text=Me,He.sections=k.sections;for(let ze=0;ze<Me.length;ze++)He.sectionIndex.push(0);W.push(He)}}else if(te){const he=te(k.text,k.sectionIndex,$);for(const Me of he){const He=new Nm;He.text=Me[0],He.sectionIndex=Me[1],He.sections=k.sections,W.push(He)}}else W=function(he,Me){const He=[],ze=he.text;let Be=0;for(const yt of Me)He.push(he.substring(Be,yt)),Be=yt;return Be<ze.length&&He.push(he.substring(Be,ze.length)),He}(k,$);const X=[],le={positionedLines:X,text:k.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,Me,He,ze,Be,yt,ke,dt,Et,Ct,Bt,ei){let ni=0,Yt=0,yi=0;const Fi=dt==="right"?1:dt==="left"?0:.5;let di=!1;for(const bn of Be){const Cn=bn.getSections();for(const fr of Cn){if(fr.imageName)continue;const Sr=Me[fr.fontStack];if(Sr&&(di=Sr.ascender!==void 0&&Sr.descender!==void 0,!di))break}if(!di)break}let Tn=0;for(const bn of Be){bn.trim();const Cn=bn.getMaxScale(),fr=(Cn-1)*zs,Sr={positionedGlyphs:[],lineOffset:0};he.positionedLines[Tn]=Sr;const Cr=Sr.positionedGlyphs;let xr=0;if(!bn.length()){Yt+=yt,++Tn;continue}let Vr=0,Br=0;for(let Rs=0;Rs<bn.length();Rs++){const lr=bn.getSection(Rs),fs=bn.getSectionIndex(Rs),xs=bn.getCodePoint(Rs);let Js=lr.scale,vo=null,Oo=null,xo=null,co=zs,Eo=0;const Fo=!(Et===cc.horizontal||!Bt&&!du(xs)||Bt&&(Py[xs]||(ln=xs,Gn.Arabic(ln)||Gn["Arabic Supplement"](ln)||Gn["Arabic Extended-A"](ln)||Gn["Arabic Presentation Forms-A"](ln)||Gn["Arabic Presentation Forms-B"](ln))));if(lr.imageName){const Ta=ze[lr.imageName];if(!Ta)continue;xo=lr.imageName,he.iconsInText=he.iconsInText||!0,Oo=Ta.paddedRect;const Zs=Ta.displaySize;Js=Js*zs/ei,vo={width:Zs[0],height:Zs[1],left:0,top:-Lb,advance:Fo?Zs[1]:Zs[0],localGlyph:!1},Eo=di?-vo.height*Js:Cn*zs-17-Zs[1]*Js,co=vo.advance;const Al=(Fo?Zs[0]:Zs[1])*Js-zs*Cn;Al>0&&Al>xr&&(xr=Al)}else{const Ta=He[lr.fontStack];if(!Ta)continue;Ta[xs]&&(Oo=Ta[xs]);const Zs=Me[lr.fontStack];if(!Zs)continue;const Al=Zs.glyphs[xs];if(!Al)continue;if(vo=Al.metrics,co=xs!==8203?zs:0,di){const Du=Zs.ascender!==void 0?Math.abs(Zs.ascender):0,$c=Zs.descender!==void 0?Math.abs(Zs.descender):0,Zc=(Du+$c)*Js;Vr<Zc&&(Vr=Zc,Br=(Du-$c)/2*Js),Eo=-Du*Js}else Eo=(Cn-Js)*zs-17}Fo?(he.verticalizable=!0,Cr.push({glyph:xs,imageName:xo,x:ni,y:Yt+Eo,vertical:Fo,scale:Js,localGlyph:vo.localGlyph,fontStack:lr.fontStack,sectionIndex:fs,metrics:vo,rect:Oo}),ni+=co*Js+Ct):(Cr.push({glyph:xs,imageName:xo,x:ni,y:Yt+Eo,vertical:Fo,scale:Js,localGlyph:vo.localGlyph,fontStack:lr.fontStack,sectionIndex:fs,metrics:vo,rect:Oo}),ni+=vo.advance*Js+Ct)}Cr.length!==0&&(yi=Math.max(ni-Ct,yi),di?Ob(Cr,Fi,xr,Br,yt*Cn/2):Ob(Cr,Fi,xr,0,yt/2)),ni=0;const Bs=yt*Cn+xr;Sr.lineOffset=Math.max(xr,fr),Yt+=Bs,++Tn}var ln;const $i=Yt,{horizontalAlign:Di,verticalAlign:Kn}=_v(ke);(function(bn,Cn,fr,Sr,Cr,xr){const Vr=(Cn-fr)*Cr,Br=-xr*Sr;for(const Bs of bn)for(const Rs of Bs.positionedGlyphs)Rs.x+=Vr,Rs.y+=Br})(he.positionedLines,Fi,Di,Kn,yi,$i),he.top+=-Kn*$i,he.bottom=he.top+$i,he.left+=-Di*yi,he.right=he.left+yi,he.hasBaseline=di}(le,t,r,c,W,m,T,L,C,D,R,I),!function(he){for(const Me of he)if(Me.positionedGlyphs.length!==0)return!1;return!0}(X)&&le}const Py={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ib(a,t,r,c,f,u){if(t.imageName){const m=c[t.imageName];return m?m.displaySize[0]*t.scale*zs/u+f:0}{const m=r[t.fontStack],T=m&&m.glyphs[a];return T?T.metrics.advance*t.scale+f:0}}function Rb(a,t,r,c){const f=Math.pow(a-t,2);return c?a<t?f/2:2*f:f+Math.abs(r)*r}function _A(a,t,r){let c=0;return a===10&&(c-=1e4),r&&(c+=150),a!==40&&a!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Pb(a,t,r,c,f,u){let m=null,T=Rb(t,r,f,u);for(const L of c){const D=Rb(t-L.x,r,f,u)+L.badness;D<=T&&(m=L,T=D)}return{index:a,x:t,priorBreak:m,badness:T}}function Db(a){return a?Db(a.priorBreak).concat(a.index):[]}function _v(a){let t=.5,r=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Ob(a,t,r,c,f){if(!(t||r||c||f))return;const u=a.length-1,m=a[u],T=(m.x+m.metrics.advance*m.scale)*t;for(let L=0;L<=u;L++)a[L].x-=T,a[L].y+=r+c+f}function yA(a,t,r,c){const{horizontalAlign:f,verticalAlign:u}=_v(c),m=r[0]-a.displaySize[0]*f,T=r[1]-a.displaySize[1]*u;return{imagePrimary:a,imageSecondary:t,top:T,bottom:T+a.displaySize[1],left:m,right:m+a.displaySize[0]}}function zb(a,t,r,c,f,u){const m=a.imagePrimary;let T;if(m.content){const W=m.content,$=m.pixelRatio||1;T=[W[0]/$,W[1]/$,m.displaySize[0]-W[2]/$,m.displaySize[1]-W[3]/$]}const L=t.left*u,D=t.right*u;let b,C,R,A;r==="width"||r==="both"?(A=f[0]+L-c[3],C=f[0]+D+c[1]):(A=f[0]+(L+D-m.displaySize[0])/2,C=A+m.displaySize[0]);const I=t.top*u,k=t.bottom*u;return r==="height"||r==="both"?(b=f[1]+I-c[0],R=f[1]+k+c[2]):(b=f[1]+(I+k-m.displaySize[1])/2,R=b+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:b,right:C,bottom:R,left:A,collisionPadding:T}}class pd extends je{constructor(t,r,c,f,u){super(t,r),this.angle=f,this.z=c,u!==void 0&&(this.segment=u)}clone(){return new pd(this.x,this.y,this.z,this.angle,this.segment)}}function kb(a,t,r,c,f){if(t.segment===void 0)return!0;let u=t,m=t.segment+1,T=0;for(;T>-r/2;){if(m--,m<0)return!1;T-=a[m].dist(u),u=a[m]}T+=a[m].dist(a[m+1]),m++;const L=[];let D=0;for(;T<r/2;){const b=a[m],C=a[m+1];if(!C)return!1;let R=a[m-1].angleTo(b)-b.angleTo(C);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:T,angleDelta:R}),D+=R;T-L[0].distance>c;)D-=L.shift().angleDelta;if(D>f)return!1;m++,T+=b.dist(C)}return!0}function Fb(a){let t=0;for(let r=0;r<a.length-1;r++)t+=a[r].dist(a[r+1]);return t}function Bb(a,t,r){return a?.6*t*r:0}function Nb(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function vA(a,t,r,c,f,u){const m=Bb(r,f,u),T=Nb(r,c)*u;let L=0;const D=Fb(a)/2;for(let b=0;b<a.length-1;b++){const C=a[b],R=a[b+1],A=C.dist(R);if(L+A>D){const I=(D-L)/A,k=Pe(C.x,R.x,I),W=Pe(C.y,R.y,I),$=new pd(k,W,0,R.angleTo(C),b);return!m||kb(a,$,T,m,t)?$:void 0}L+=A}}function xA(a,t,r,c,f,u,m,T,L){const D=Bb(c,u,m),b=Nb(c,f),C=b*m,R=a[0].x===0||a[0].x===L||a[0].y===0||a[0].y===L;return t-C<t/4&&(t=C+t/4),Ub(a,R?t/2*T%t:(b/2+2*u)*m*T%t,t,D,r,C,R,!1,L)}function Ub(a,t,r,c,f,u,m,T,L){const D=u/2,b=Fb(a);let C=0,R=t-r,A=[];for(let I=0;I<a.length-1;I++){const k=a[I],W=a[I+1],$=k.dist(W),ee=W.angleTo(k);for(;R+r<C+$;){R+=r;const te=(R-C)/$,X=Pe(k.x,W.x,te),le=Pe(k.y,W.y,te);if(X>=0&&X<L&&le>=0&&le<L&&R-D>=0&&R+D<=b){const he=new pd(X,le,0,ee,I);c&&!kb(a,he,u,c,f)||A.push(he)}}C+=$}return T||A.length||m||(A=Ub(a,C/2,r,c,f,u,m,!0,L)),A}function Vb(a,t,r,c,f){const u=[];for(let m=0;m<a.length;m++){const T=a[m];let L;for(let D=0;D<T.length-1;D++){let b=T[D],C=T[D+1];b.x<t&&C.x<t||(b.x<t?b=new je(t,b.y+(t-b.x)/(C.x-b.x)*(C.y-b.y))._round():C.x<t&&(C=new je(t,b.y+(t-b.x)/(C.x-b.x)*(C.y-b.y))._round()),b.y<r&&C.y<r||(b.y<r?b=new je(b.x+(r-b.y)/(C.y-b.y)*(C.x-b.x),r)._round():C.y<r&&(C=new je(b.x+(r-b.y)/(C.y-b.y)*(C.x-b.x),r)._round()),b.x>=c&&C.x>=c||(b.x>=c?b=new je(c,b.y+(c-b.x)/(C.x-b.x)*(C.y-b.y))._round():C.x>=c&&(C=new je(c,b.y+(c-b.x)/(C.x-b.x)*(C.y-b.y))._round()),b.y>=f&&C.y>=f||(b.y>=f?b=new je(b.x+(f-b.y)/(C.y-b.y)*(C.x-b.x),f)._round():C.y>=f&&(C=new je(b.x+(f-b.y)/(C.y-b.y)*(C.x-b.x),f)._round()),L&&b.equals(L[L.length-1])||(L=[b],u.push(L)),L.push(C)))))}}return u}function Gb(a){let t=0,r=0;for(const m of a)t+=m.w*m.h,r=Math.max(r,m.w);a.sort((m,T)=>T.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let f=0,u=0;for(const m of a)for(let T=c.length-1;T>=0;T--){const L=c[T];if(!(m.w>L.w||m.h>L.h)){if(m.x=L.x,m.y=L.y,u=Math.max(u,m.y+m.h),f=Math.max(f,m.x+m.w),m.w===L.w&&m.h===L.h){const D=c.pop();T<c.length&&(c[T]=D)}else m.h===L.h?(L.x+=m.w,L.w-=m.w):m.w===L.w?(L.y+=m.h,L.h-=m.h):(c.push({x:L.x+m.w,y:L.y,w:L.w-m.w,h:m.h}),L.y+=m.h,L.h-=m.h);break}}return{w:f,h:u,fill:t/(f*u)||0}}Sn(pd,"Anchor");const d_=1;class yv{constructor(t,{pixelRatio:r,version:c,stretchX:f,stretchY:u,content:m},T){this.paddedRect=t,this.pixelRatio=r,this.stretchX=f,this.stretchY=u,this.content=m,this.version=c,this.padding=T}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Hb{constructor(t,r,c){const f={},u={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,f,d_,m),this.addImages(r,u,2,m);const{w:T,h:L}=Gb(m),D=new wa({width:T||1,height:L||1});for(const b in t){const C=t[b],R=f[b].paddedRect;wa.copy(C.data,D,{x:0,y:0},{x:R.x+d_,y:R.y+d_},C.data,c,C.sdf)}for(const b in r){const C=r[b],R=u[b].paddedRect;let A=u[b].padding;const I=R.x+A,k=R.y+A,W=C.data.width,$=C.data.height;A=A>1?A-1:A,wa.copy(C.data,D,{x:0,y:0},{x:I,y:k},C.data,c),wa.copy(C.data,D,{x:0,y:$-A},{x:I,y:k-A},{width:W,height:A},c),wa.copy(C.data,D,{x:0,y:0},{x:I,y:k+$},{width:W,height:A},c),wa.copy(C.data,D,{x:W-A,y:0},{x:I-A,y:k},{width:A,height:$},c),wa.copy(C.data,D,{x:0,y:0},{x:I+W,y:k},{width:A,height:$},c),wa.copy(C.data,D,{x:W-A,y:$-A},{x:I-A,y:k-A},{width:A,height:A},c),wa.copy(C.data,D,{x:0,y:$-A},{x:I+W,y:k-A},{width:A,height:A},c),wa.copy(C.data,D,{x:0,y:0},{x:I+W,y:k+$},{width:A,height:A},c),wa.copy(C.data,D,{x:W-A,y:0},{x:I-A,y:k+$},{width:A,height:A},c)}this.image=D,this.iconPositions=f,this.patternPositions=u}addImages(t,r,c,f){for(const u in t){const m=t[u],T={x:0,y:0,w:m.data.width+2*c,h:m.data.height+2*c};f.push(T),r[u]=new yv(T,m,c),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,r,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>t.hasImage(f,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const f in t.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[f],t.getImage(f,c),r),this.patchUpdatedImage(this.patternPositions[f],t.getImage(f,c),r)}patchUpdatedImage(t,r,c){if(!t||!r||t.version===r.version)return;t.version=r.version;const[f,u]=t.tl;c.update(r.data,{position:{x:f,y:u}})}}Sn(yv,"ImagePosition"),Sn(Hb,"ImageAtlas");const p_=1e20;function jb(a,t,r,c,f,u,m,T,L){for(let D=t;D<t+c;D++)Wb(a,r*u+D,u,f,m,T,L);for(let D=r;D<r+f;D++)Wb(a,D*u+t,1,c,m,T,L)}function Wb(a,t,r,c,f,u,m){u[0]=0,m[0]=-p_,m[1]=p_,f[0]=a[t];for(let T=1,L=0,D=0;T<c;T++){f[T]=a[t+T*r];const b=T*T;do{const C=u[L];D=(f[T]-f[C]+b-C*C)/(T-C)/2}while(D<=m[L]&&--L>-1);L++,u[L]=T,m[L]=D,m[L+1]=p_}for(let T=0,L=0;T<c;T++){for(;m[L+1]<T;)L++;const D=u[L],b=T-D;a[t+T*r]=f[D]+b*b}}const Lu=2,vv={none:0,ideographs:1,all:2};class Um{constructor(t,r,c){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,r){this.urls[r]=t}getGlyphs(t,r,c){const f=[],u=this.urls[r]||qe.GLYPHS_URL;for(const m in t)for(const T of t[m])f.push({stack:m,id:T});an(f,({stack:m,id:T},L)=>{let D=this.entries[m];D||(D=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=D.glyphs[T];if(b!==void 0)return void L(null,{stack:m,id:T,glyph:b});if(b=this._tinySDF(D,m,T),b)return D.glyphs[T]=b,void L(null,{stack:m,id:T,glyph:b});const C=Math.floor(T/256);if(256*C>65535)return Wn("glyphs > 65535 not supported"),void L(null,{stack:m,id:T,glyph:b});if(D.ranges[C])return void L(null,{stack:m,id:T,glyph:b});let R=D.requests[C];R||(R=D.requests[C]=[],Um.loadGlyphRange(m,C,u,this.requestManager,(A,I)=>{if(I){D.ascender=I.ascender,D.descender=I.descender;for(const k in I.glyphs)this._doesCharSupportLocalGlyph(+k)||(D.glyphs[+k]=I.glyphs[+k]);D.ranges[C]=!0}for(const k of R)k(A,I);delete D.requests[C]})),R.push((A,I)=>{A?L(A):I&&L(null,{stack:m,id:T,glyph:I.glyphs[T]||null})})},(m,T)=>{if(m)c(m);else if(T){const L={};for(const{stack:D,id:b,glyph:C}of T)L[D]===void 0&&(L[D]={}),L[D].glyphs===void 0&&(L[D].glyphs={}),L[D].glyphs[b]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},L[D].ascender=this.entries[D].ascender,L[D].descender=this.entries[D].descender;c(null,L)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==vv.none&&(this.localGlyphMode===vv.all?!!this.localFontFamily:!!this.localFontFamily&&(Gn["CJK Unified Ideographs"](t)||Gn["Hangul Syllables"](t)||Gn.Hiragana(t)||Gn.Katakana(t)||Gn["CJK Symbols and Punctuation"](t)||Gn["CJK Unified Ideographs Extension A"](t)||Gn["CJK Unified Ideographs Extension B"](t)||Gn.Osage(t)))}_tinySDF(t,r,c){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let u=t.tinySDF;if(!u){let k="400";/bold/i.test(r)?k="900":/medium/i.test(r)?k="500":/light/i.test(r)&&(k="200"),u=t.tinySDF=new Um.TinySDF({fontFamily:f,fontWeight:k,fontSize:24*Lu,buffer:3*Lu,radius:8*Lu}),u.fontWeight=k}if(this.localGlyphs[u.fontWeight][c])return this.localGlyphs[u.fontWeight][c];const m=String.fromCodePoint(c),{data:T,width:L,height:D,glyphWidth:b,glyphHeight:C,glyphLeft:R,glyphTop:A,glyphAdvance:I}=u.draw(m);return this.localGlyphs[u.fontWeight][c]={id:c,bitmap:new Wc({width:L,height:D},T),metrics:{width:b/Lu,height:C/Lu,left:R/Lu,top:A/Lu-27,advance:I/Lu,localGlyph:!0}}}}Um.loadGlyphRange=function(a,t,r,c,f){const u=256*t,m=u+255,T=c.transformRequest(c.normalizeGlyphsURL(r).replace("{fontstack}",a).replace("{range}",`${u}-${m}`),na.Glyphs);Bo(T,(L,D)=>{if(L)f(L);else if(D){const b={},C=function(R){return new Ry(R).readFields(pA,{})}(D);for(const R of C.glyphs)b[R.id]=R;f(null,{glyphs:b,ascender:C.ascender,descender:C.descender})}})},Um.TinySDF=class{constructor({fontSize:a=24,buffer:t=3,radius:r=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:u="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=r;const T=this.size=a+4*t,L=this._createCanvas(T),D=this.ctx=L.getContext("2d",{willReadFrequently:!0});D.font=`${m} ${u} ${a}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(a){const t=document.createElement("canvas");return t.width=t.height=a,t}draw(a){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:u}=this.ctx.measureText(a),m=Math.ceil(r),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-f))),L=Math.min(this.size-this.buffer,m+Math.ceil(c)),D=T+2*this.buffer,b=L+2*this.buffer,C=Math.max(D*b,0),R=new Uint8ClampedArray(C),A={data:R,width:D,height:b,glyphWidth:T,glyphHeight:L,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(T===0||L===0)return A;const{ctx:I,buffer:k,gridInner:W,gridOuter:$}=this;I.clearRect(k,k,T,L),I.fillText(a,k,k+m);const ee=I.getImageData(k,k,T,L);$.fill(p_,0,C),W.fill(0,0,C);for(let te=0;te<L;te++)for(let X=0;X<T;X++){const le=ee.data[4*(te*T+X)+3]/255;if(le===0)continue;const he=(te+k)*D+X+k;if(le===1)$[he]=0,W[he]=p_;else{const Me=.5-le;$[he]=Me>0?Me*Me:0,W[he]=Me<0?Me*Me:0}}jb($,0,0,D,b,D,this.f,this.v,this.z),jb(W,k,k,T,L,D,this.f,this.v,this.z);for(let te=0;te<C;te++){const X=Math.sqrt($[te])-Math.sqrt(W[te]);R[te]=Math.round(255-255*(X/this.radius+this.cutoff))}return A}};const _p=d_;function qb(a,t,r,c,f=1){const u=[],m=a.imagePrimary,T=m.pixelRatio,L=m.paddedRect.w-2*_p,D=m.paddedRect.h-2*_p,b=(a.right-a.left)*f,C=(a.bottom-a.top)*f,R=m.stretchX||[[0,L]],A=m.stretchY||[[0,D]],I=(ke,dt)=>ke+dt[1]-dt[0],k=R.reduce(I,0),W=A.reduce(I,0),$=L-k,ee=D-W;let te=0,X=k,le=0,he=W,Me=0,He=$,ze=0,Be=ee;if(m.content&&c){const ke=m.content;te=Dy(R,0,ke[0]),le=Dy(A,0,ke[1]),X=Dy(R,ke[0],ke[2]),he=Dy(A,ke[1],ke[3]),Me=ke[0]-te,ze=ke[1]-le,He=ke[2]-ke[0]-X,Be=ke[3]-ke[1]-he}const yt=(ke,dt,Et,Ct)=>{const Bt=Oy(ke.stretch-te,X,b,a.left*f),ei=zy(ke.fixed-Me,He,ke.stretch,k),ni=Oy(dt.stretch-le,he,C,a.top*f),Yt=zy(dt.fixed-ze,Be,dt.stretch,W),yi=Oy(Et.stretch-te,X,b,a.left*f),Fi=zy(Et.fixed-Me,He,Et.stretch,k),di=Oy(Ct.stretch-le,he,C,a.top*f),Tn=zy(Ct.fixed-ze,Be,Ct.stretch,W),ln=new je(Bt,ni),$i=new je(yi,ni),Di=new je(yi,di),Kn=new je(Bt,di),bn=new je(ei/T,Yt/T),Cn=new je(Fi/T,Tn/T),fr=t*Math.PI/180;if(fr){const Bs=Math.sin(fr),Rs=Math.cos(fr),lr=[Rs,-Bs,Bs,Rs];ln._matMult(lr),$i._matMult(lr),Kn._matMult(lr),Di._matMult(lr)}const Sr=ke.stretch+ke.fixed,Cr=Et.stretch+Et.fixed,xr=dt.stretch+dt.fixed,Vr=Ct.stretch+Ct.fixed,Br=a.imageSecondary;return{tl:ln,tr:$i,bl:Kn,br:Di,texPrimary:{x:m.paddedRect.x+_p+Sr,y:m.paddedRect.y+_p+xr,w:Cr-Sr,h:Vr-xr},texSecondary:Br?{x:Br.paddedRect.x+_p+Sr,y:Br.paddedRect.y+_p+xr,w:Cr-Sr,h:Vr-xr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:bn,pixelOffsetBR:Cn,minFontScaleX:He/T/b,minFontScaleY:Be/T/C,isSDF:r}};if(c&&(m.stretchX||m.stretchY)){const ke=$b(R,$,k),dt=$b(A,ee,W);for(let Et=0;Et<ke.length-1;Et++){const Ct=ke[Et],Bt=ke[Et+1];for(let ei=0;ei<dt.length-1;ei++)u.push(yt(Ct,dt[ei],Bt,dt[ei+1]))}}else u.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:D+1}));return u}function Dy(a,t,r){let c=0;for(const f of a)c+=Math.max(t,Math.min(r,f[1]))-Math.max(t,Math.min(r,f[0]));return c}function $b(a,t,r){const c=[{fixed:-_p,stretch:0}];for(const[f,u]of a){const m=c[c.length-1];c.push({fixed:f-m.stretch,stretch:m.stretch}),c.push({fixed:f-m.stretch,stretch:m.stretch+(u-f)})}return c.push({fixed:t+_p,stretch:r}),c}function Oy(a,t,r,c){return a/t*r+c}function zy(a,t,r,c){return a-t*r/c}function bA(a,t,r,c){const f=t+a.positionedLines[c].lineOffset;return c===0?r+f/2:r+(f+(t+a.positionedLines[c-1].lineOffset))/2}function wA(a,t=1,r=!1){let c=1/0,f=1/0,u=-1/0,m=-1/0;const T=a[0];for(let A=0;A<T.length;A++){const I=T[A];(!A||I.x<c)&&(c=I.x),(!A||I.y<f)&&(f=I.y),(!A||I.x>u)&&(u=I.x),(!A||I.y>m)&&(m=I.y)}const L=Math.min(u-c,m-f);let D=L/2;const b=new Fh([],TA);if(L===0)return new je(c,f);for(let A=c;A<u;A+=L)for(let I=f;I<m;I+=L)b.push(new Vm(A+D,I+D,D,a));let C=function(A){let I=0,k=0,W=0;const $=A[0];for(let ee=0,te=$.length,X=te-1;ee<te;X=ee++){const le=$[ee],he=$[X],Me=le.x*he.y-he.x*le.y;k+=(le.x+he.x)*Me,W+=(le.y+he.y)*Me,I+=3*Me}return new Vm(k/I,W/I,0,A)}(a),R=b.length;for(;b.length;){const A=b.pop();(A.d>C.d||!C.d)&&(C=A,r&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,R)),A.max-C.d<=t||(D=A.h/2,b.push(new Vm(A.p.x-D,A.p.y-D,D,a)),b.push(new Vm(A.p.x+D,A.p.y-D,D,a)),b.push(new Vm(A.p.x-D,A.p.y+D,D,a)),b.push(new Vm(A.p.x+D,A.p.y+D,D,a)),R+=4)}return r&&(console.log(`num probes: ${R}`),console.log(`best distance: ${C.d}`)),C.p}function TA(a,t){return t.max-a.max}class Vm{constructor(t,r,c,f){this.p=new je(t,r),this.h=c,this.d=function(u,m){let T=!1,L=1/0;for(let D=0;D<m.length;D++){const b=m[D];for(let C=0,R=b.length,A=R-1;C<R;A=C++){const I=b[C],k=b[A];I.y>u.y!=k.y>u.y&&u.x<(k.x-I.x)*(u.y-I.y)/(k.y-I.y)+I.x&&(T=!T),L=Math.min(L,tr(u,I,k))}}return(T?1:-1)*Math.sqrt(L)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const xv=Number.POSITIVE_INFINITY,MA=Math.sqrt(2);function Zb(a,[t,r]){let c=0,f=0;if(r===xv){t<0&&(t=0);const u=t/MA;switch(a){case"top-right":case"top-left":f=u-7;break;case"bottom-right":case"bottom-left":f=7-u;break;case"bottom":f=7-t;break;case"top":f=t-7}switch(a){case"top-right":case"bottom-right":c=-u;break;case"top-left":case"bottom-left":c=u;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),a){case"top-right":case"top-left":case"top":f=r-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-r}switch(a){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,f]}function bv(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function SA(a,t,r,c,f,u,m,T,L,D,b,C,R,A,I){let k=u.textMaxSize.evaluate(t,{},C);k===void 0?k=m*u.textScaleFactor:k*=u.textScaleFactor;const W=a.layers[0].layout,$=W.get("icon-offset").evaluate(t,{},C),ee=Yb(r.horizontal)||r.vertical,te=R.name==="globe",X=zs,le=m*u.textScaleFactor/X,he=a.tilePixelRatio*k/X,Me=(Ct=a.overscaling,a.zoom>18&&Ct>2&&(Ct>>=1),Math.max(un/(512*Ct),1)*W.get("symbol-spacing")),He=W.get("text-padding")*a.tilePixelRatio,ze=W.get("icon-padding")*a.tilePixelRatio,Be=Fe(W.get("text-max-angle")),yt=W.get("text-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",ke=W.get("icon-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",dt=W.get("symbol-placement"),Et=Me/2;var Ct;const Bt=W.get("icon-text-fit").evaluate(t,{},C),ei=W.get("icon-text-fit-padding").evaluate(t,{},C),ni=Bt!=="none";let Yt;a.hasAnyIconTextFit===!1&&ni&&(a.hasAnyIconTextFit=!0),c&&ni&&(a.allowVerticalPlacement&&r.vertical&&(Yt=zb(c,r.vertical,Bt,ei,$,le)),ee&&(c=zb(c,ee,Bt,ei,$,le)));const yi=(Fi,di,Tn)=>{if(di.x<0||di.x>=un||di.y<0||di.y>=un)return;let ln=null;if(te){const{x:$i,y:Di,z:Kn}=R.projectTilePoint(di.x,di.y,Tn);ln={anchor:new pd($i,Di,Kn,0,void 0),up:R.upVector(Tn,di.x,di.y)}}(function($i,Di,Kn,bn,Cn,fr,Sr,Cr,xr,Vr,Br,Bs,Rs,lr,fs,xs,Js,vo,Oo,xo,co,Eo,Fo,Ta,Zs,Al,Du){const $c=$i.addToLineVertexArray(Di,bn);let Zc,Vf,wp,Gf,P_,gT,_T,yT=0,vT=0,xT=0,bT=0,Yv=-1,Kv=-1;const Mh={};let wT=Te("");const Hf=Kn?Kn.anchor:Di,Jv=xr.layout.get("icon-text-fit").evaluate(co,{},Zs)!=="none";let Qv=0,ex=0;if(xr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Qv,ex]=xr.layout.get("text-offset").evaluate(co,{},Zs).map(jl=>jl*zs):(Qv=xr.layout.get("text-radial-offset").evaluate(co,{},Zs)*zs,ex=xv),$i.allowVerticalPlacement&&Cn.vertical){const jl=Cn.vertical;if(fs)gT=wv(jl),Cr&&(_T=wv(Cr));else{const Wl=xr.layout.get("text-rotate").evaluate(co,{},Zs)+90;wp=ky(Vr,Hf,Di,Br,Bs,Rs,jl,lr,Wl,xs),Cr&&(Gf=ky(Vr,Hf,Di,Br,Bs,Rs,Cr,vo,Wl))}}if(fr){const jl=xr.layout.get("icon-rotate").evaluate(co,{},Zs),Wl=qb(fr,jl,Fo,Jv,Eo.iconScaleFactor),Xm=Cr?qb(Cr,jl,Fo,Jv,Eo.iconScaleFactor):void 0;Vf=ky(Vr,Hf,Di,Br,Bs,Rs,fr,vo,jl),yT=4*Wl.length;const TT=$i.iconSizeData;let jf=null;TT.kind==="source"?(jf=[Zo*xr.layout.get("icon-size").evaluate(co,{},Zs)*Eo.iconScaleFactor],jf[0]>yp&&Wn(`${$i.layerIds[0]}: Value for "icon-size" is >= ${f_}. Reduce your "icon-size".`)):TT.kind==="composite"&&(jf=[Zo*Eo.compositeIconSizes[0].evaluate(co,{},Zs)*Eo.iconScaleFactor,Zo*Eo.compositeIconSizes[1].evaluate(co,{},Zs)*Eo.iconScaleFactor],(jf[0]>yp||jf[1]>yp)&&Wn(`${$i.layerIds[0]}: Value for "icon-size" is >= ${f_}. Reduce your "icon-size".`)),$i.addSymbols($i.icon,Wl,jf,xo,Oo,co,!1,Kn,Di,$c.lineStartIndex,$c.lineLength,-1,Ta,Zs,Al,Du),Yv=$i.icon.placedSymbolArray.length-1,Xm&&(vT=4*Xm.length,$i.addSymbols($i.icon,Xm,jf,xo,Oo,co,cc.vertical,Kn,Di,$c.lineStartIndex,$c.lineLength,-1,Ta,Zs,Al,Du),Kv=$i.icon.placedSymbolArray.length-1)}for(const jl in Cn.horizontal){const Wl=Cn.horizontal[jl];Zc||(wT=Te(Wl.text),fs?P_=wv(Wl):Zc=ky(Vr,Hf,Di,Br,Bs,Rs,Wl,lr,xr.layout.get("text-rotate").evaluate(co,{},Zs),xs));const Xm=Wl.positionedLines.length===1;if(xT+=Xb($i,Kn,Di,Wl,Sr,xr,fs,co,xs,$c,Cn.vertical?cc.horizontal:cc.horizontalOnly,Xm?Object.keys(Cn.horizontal):[jl],Mh,Yv,Eo,Ta,Zs,Al),Xm)break}Cn.vertical&&(bT+=Xb($i,Kn,Di,Cn.vertical,Sr,xr,fs,co,xs,$c,cc.vertical,["vertical"],Mh,Kv,Eo,Ta,Zs,Al));let Tp=-1;const tx=(jl,Wl)=>jl?Math.max(jl,Wl):Wl;Tp=tx(P_,Tp),Tp=tx(gT,Tp),Tp=tx(_T,Tp);const U3=Tp>-1?1:0;$i.glyphOffsetArray.length>=65535&&Wn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),co.sortKey!==void 0&&$i.addToSortKeyRanges($i.symbolInstances.length,co.sortKey),$i.symbolInstances.emplaceBack(Di.x,Di.y,Hf.x,Hf.y,Hf.z,Mh.right>=0?Mh.right:-1,Mh.center>=0?Mh.center:-1,Mh.left>=0?Mh.left:-1,Mh.vertical>=0?Mh.vertical:-1,Yv,Kv,wT,Zc!==void 0?Zc:$i.collisionBoxArray.length,Zc!==void 0?Zc+1:$i.collisionBoxArray.length,wp!==void 0?wp:$i.collisionBoxArray.length,wp!==void 0?wp+1:$i.collisionBoxArray.length,Vf!==void 0?Vf:$i.collisionBoxArray.length,Vf!==void 0?Vf+1:$i.collisionBoxArray.length,Gf||$i.collisionBoxArray.length,Gf?Gf+1:$i.collisionBoxArray.length,Br,xT,bT,yT,vT,U3,0,Qv,ex,Tp,0,Jv?1:0)})(a,di,ln,Fi,r,c,f,Yt,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,He,yt,L,0,ze,ke,$,t,u,D,b,C,A,I)};if(dt==="line")for(const Fi of Vb(t.geometry,0,0,un,un)){const di=xA(Fi,Me,Be,r.vertical||ee,c,X,he,a.overscaling,un);for(const Tn of di)ee&&EA(a,ee.text,Et,Tn)||yi(Fi,Tn,C)}else if(dt==="line-center"){for(const Fi of t.geometry)if(Fi.length>1){const di=vA(Fi,Be,r.vertical||ee,c,X,he);di&&yi(Fi,di,C)}}else if(t.type==="Polygon")for(const Fi of Of(t.geometry,0)){const di=wA(Fi,16);yi(Fi[0],new pd(di.x,di.y,0,0,void 0),C)}else if(t.type==="LineString")for(const Fi of t.geometry)yi(Fi,new pd(Fi[0].x,Fi[0].y,0,0,void 0),C);else if(t.type==="Point")for(const Fi of t.geometry)for(const di of Fi)yi([di],new pd(di.x,di.y,0,0,void 0),C)}const f_=255,yp=f_*Zo;function Xb(a,t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W,$){const ee=function(le,he,Me,He,ze,Be,yt,ke){const dt=[];if(he.positionedLines.length===0)return dt;const Et=He.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,Ct=function(yi){const Fi=yi[0],di=yi[1],Tn=Fi*di;return Tn>0?[Fi,-di]:Tn<0?[-Fi,di]:Fi===0?[di,Fi]:[di,-Fi]}(Me);let Bt=Math.abs(he.top-he.bottom);for(const yi of he.positionedLines)Bt-=yi.lineOffset;const ei=he.positionedLines.length,ni=Bt/ei;let Yt=he.top-Me[1];for(let yi=0;yi<ei;++yi){const Fi=he.positionedLines[yi];Yt=bA(he,ni,Yt,yi);for(const di of Fi.positionedGlyphs){if(!di.rect)continue;const Tn=di.rect||{};let ln=Lb+1,$i=!0,Di=1,Kn=0;if(di.imageName){const xo=yt[di.imageName];if(!xo)continue;if(xo.sdf){Wn("SDF images are not supported in formatted text and will be ignored.");continue}$i=!1,Di=xo.pixelRatio,ln=d_/Di}const bn=(ze||ke)&&di.vertical,Cn=di.metrics.advance*di.scale/2,fr=di.metrics,Sr=di.rect;if(Sr===null)continue;ke&&he.verticalizable&&(Kn=di.imageName?Cn-di.metrics.width*di.scale/2:0);const Cr=ze?[di.x+Cn,di.y]:[0,0];let xr=[0,0],Vr=[0,0],Br=!1;ze||(bn?(Vr=[di.x+Cn+Ct[0],di.y+Ct[1]-Kn],Br=!0):xr=[di.x+Cn+Me[0],di.y+Me[1]-Kn]);const Bs=Sr.w*di.scale/(Di*(di.localGlyph?Lu:1)),Rs=Sr.h*di.scale/(Di*(di.localGlyph?Lu:1));let lr,fs,xs,Js;if(bn){const xo=di.y-Yt,co=new je(-Cn,Cn-xo),Eo=-Math.PI/2,Fo=new je(...Vr);lr=new je(-Cn+xr[0],xr[1]),lr._rotateAround(Eo,co)._add(Fo),lr.x+=-xo+Cn,lr.y-=(fr.left-ln)*di.scale;const Ta=di.imageName?fr.advance*di.scale:zs*di.scale,Zs=String.fromCodePoint(di.glyph);uA(Zs)?lr.x+=(1-ln)*di.scale:hA(Zs)?lr.x+=Ta-fr.height*di.scale+(-ln-1)*di.scale:lr.x+=di.imageName||fr.width+2*ln===Sr.w&&fr.height+2*ln===Sr.h?(Ta-Rs)/2:(Ta-(fr.height+2*ln)*di.scale)/2,fs=new je(lr.x,lr.y-Bs),xs=new je(lr.x+Rs,lr.y),Js=new je(lr.x+Rs,lr.y-Bs)}else{const xo=(fr.left-ln)*di.scale-Cn+xr[0],co=(-fr.top-ln)*di.scale+xr[1],Eo=xo+Bs,Fo=co+Rs;lr=new je(xo,co),fs=new je(Eo,co),xs=new je(xo,Fo),Js=new je(Eo,Fo)}if(Et){let xo;xo=ze?new je(0,0):Br?new je(Ct[0],Ct[1]):new je(Me[0],Me[1]),lr._rotateAround(Et,xo),fs._rotateAround(Et,xo),xs._rotateAround(Et,xo),Js._rotateAround(Et,xo)}const vo=new je(0,0),Oo=new je(0,0);dt.push({tl:lr,tr:fs,bl:xs,br:Js,texPrimary:Tn,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:Cr,sectionIndex:di.sectionIndex,isSDF:$i,pixelOffsetTL:vo,pixelOffsetBR:Oo,minFontScaleX:0,minFontScaleY:0})}}return dt}(0,c,L,u,m,T,f,a.allowVerticalPlacement),te=a.textSizeData;let X=null;te.kind==="source"?(X=[Zo*u.layout.get("text-size").evaluate(T,{},W)*I.textScaleFactor],X[0]>yp&&Wn(`${a.layerIds[0]}: Value for "text-size" is >= ${f_}. Reduce your "text-size".`)):te.kind==="composite"&&(X=[Zo*I.compositeTextSizes[0].evaluate(T,{},W)*I.textScaleFactor,Zo*I.compositeTextSizes[1].evaluate(T,{},W)*I.textScaleFactor],(X[0]>yp||X[1]>yp)&&Wn(`${a.layerIds[0]}: Value for "text-size" is >= ${f_}. Reduce your "text-size".`)),a.addSymbols(a.text,ee,X,L,m,T,b,t,r,D.lineStartIndex,D.lineLength,A,k,W,$,!1);for(const le of C)R[le]=a.text.placedSymbolArray.length-1;return 4*ee.length}function Yb(a){for(const t in a)return a[t];return null}function ky(a,t,r,c,f,u,m,T,L,D){let b=m.top,C=m.bottom,R=m.left,A=m.right;const I=m.collisionPadding;if(I&&(R-=I[0],b-=I[1],A+=I[2],C+=I[3]),L){const k=new je(R,b),W=new je(A,b),$=new je(R,C),ee=new je(A,C),te=Fe(L);let X=new je(0,0);D&&(X=new je(D[0],D[1])),k._rotateAround(te,X),W._rotateAround(te,X),$._rotateAround(te,X),ee._rotateAround(te,X),R=Math.min(k.x,W.x,$.x,ee.x),A=Math.max(k.x,W.x,$.x,ee.x),b=Math.min(k.y,W.y,$.y,ee.y),C=Math.max(k.y,W.y,$.y,ee.y)}return a.emplaceBack(t.x,t.y,t.z,r.x,r.y,R,b,A,C,T,c,f,u),a.length-1}function wv(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const t=a.bottom-a.top;return t>0?Math.max(10,t):null}function EA(a,t,r,c){const f=a.compareText;if(t in f){const u=f[t];for(let m=u.length-1;m>=0;m--)if(c.dist(u[m])<r)return!0}else f[t]=[];return f[t].push(c),!1}function Kb(a,t){const r=a.fovAboveCenter,c=a.elevation?a.elevation.getMinElevationBelowMSL()*t:0,f=(a._camera.position[2]*a.worldSize-c)/Math.cos(a._pitch),u=Math.sin(r)*f/Math.sin(Math.max(Math.PI/2-a._pitch-r,.01));let m=Math.sin(a._pitch)*u+f;const T=f*(1/a._horizonShift);return a.elevation&&a.elevation.exaggeration()!==0||(m*=1+Math.max(a.zoom-17,0)),Math.min(1.01*m,T)}function m_(a,t){if(!t.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:t};const r=Math.pow(2,-a.z),c=a.x*r,f=(a.x+1)*r,u=a.y*r,m=(a.y+1)*r,T=Oe(c),L=Oe(f),D=Ne(u),b=Ne(m),C=t.project(T,D),R=t.project(L,D),A=t.project(L,b),I=t.project(T,b);let k=Math.min(C.x,R.x,A.x,I.x),W=Math.min(C.y,R.y,A.y,I.y),$=Math.max(C.x,R.x,A.x,I.x),ee=Math.max(C.y,R.y,A.y,I.y);const te=r/16;function X(he,Me,He,ze,Be,yt){const ke=(He+Be)/2,dt=(ze+yt)/2,Et=t.project(Oe(ke),Ne(dt)),Ct=Math.max(0,k-Et.x,W-Et.y,Et.x-$,Et.y-ee);k=Math.min(k,Et.x),$=Math.max($,Et.x),W=Math.min(W,Et.y),ee=Math.max(ee,Et.y),Ct>te&&(X(he,Et,He,ze,ke,dt),X(Et,Me,ke,dt,Be,yt))}X(C,R,c,u,f,u),X(R,A,f,u,f,m),X(A,I,f,m,c,m),X(I,C,c,m,c,u),k-=te,W-=te,$+=te,ee+=te;const le=1/Math.max($-k,ee-W);return{scale:le,x:k*le,y:W*le,x2:$*le,y2:ee*le,projection:t}}function Jb(a,{x:t,y:r},c=0){return new je(((t-c)*a.scale-a.x)*un,(r*a.scale-a.y)*un)}const AA=Qe.mat4.identity(new Float32Array(16));class vp{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new H(0,0)}projectTilePoint(t,r,c){return{x:t,y:r,z:0}}locationPoint(t,r,c=!0){return t._coordinatePoint(t.locationCoordinate(r),c)}pixelsPerMeter(t,r){return ge(1,t)*r}pixelSpaceConversion(t,r,c){return 1}farthestPixelDistance(t){return Kb(t,t.pixelsPerMeter)}pointCoordinate(t,r,c,f){const u=t.horizonLineFromTop(!1),m=new je(r,Math.max(u,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(m,f))}pointCoordinate3D(t,r,c){const f=new je(r,c);if(t.elevation)return t.elevation.pointCoordinate(f);{const u=this.pointCoordinate(t,f.x,f.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(t,r){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,r.x,r.y);const c=t.horizonLineFromTop();return r.y<c}createInversionMatrix(t,r){return AA}createTileMatrix(t,r,c){let f,u,m;const T=c.canonical,L=Qe.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=m_(T,this);f=1,u=D.x+c.wrap*D.scale,m=D.y,Qe.mat4.scale(L,L,[f/D.scale,f/D.scale,t.pixelsPerMeter/r])}else f=r/t.zoomScale(T.z),u=(T.x+Math.pow(2,T.z)*c.wrap)*f,m=T.y*f;return Qe.mat4.translate(L,L,[u,m,0]),Qe.mat4.scale(L,L,[f/un,f/un,1]),L}upVector(t,r,c){return[0,0,1]}upVectorScale(t,r,c){return{metersToTile:1}}}class CA extends vp{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,c]=this.parallels=t.parallels||[29.5,45.5],f=Math.sin(Fe(r));this.n=(f+Math.sin(Fe(c)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:c,c:f,r0:u}=this,m=Fe(t-this.center[0]),T=Fe(r),L=Math.sqrt(f-2*c*Math.sin(T))/c;return{x:L*Math.sin(m*c),y:L*Math.cos(m*c)-u,z:0}}unproject(t,r){const{n:c,c:f,r0:u}=this,m=u+r;let T=Math.atan2(t,Math.abs(m))*Math.sign(m);m*c<0&&(T-=Math.PI*Math.sign(t)*Math.sign(m));const L=Fe(this.center[0])*c;T=xi(T,-Math.PI-L,Math.PI-L);const D=Mt(Ge(T/c)+this.center[0],-180,180),b=Math.asin(Mt((f-(t*t+m*m)*c*c)/(2*c),-1,1)),C=Mt(Ge(b),-$e,$e);return new H(D,C)}}const g_=1.340264,__=-.081106,y_=893e-6,v_=.003796,Fy=Math.sqrt(3)/2;class LA extends vp{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(Fy*Math.sin(r)),f=c*c,u=f*f*f;return{x:.5*(t*Math.cos(c)/(Fy*(g_+3*__*f+u*(7*y_+9*v_*f)))/Math.PI+.5),y:1-.5*(c*(g_+__*f+u*(y_+v_*f))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,f=c*c,u=f*f*f;for(let b,C,R,A=0;A<12&&(C=c*(g_+__*f+u*(y_+v_*f))-r,R=g_+3*__*f+u*(7*y_+9*v_*f),b=C/R,c=Mt(c-b,-Math.PI/3,Math.PI/3),f=c*c,u=f*f*f,!(Math.abs(b)<1e-12));++A);const m=Fy*t*(g_+3*__*f+u*(7*y_+9*v_*f))/Math.cos(c),T=Math.asin(Math.sin(c)/Fy),L=Mt(180*m/Math.PI,-180,180),D=Mt(180*T/Math.PI,-$e,$e);return new H(L,D)}}class IA extends vp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const c=360*(t-.5),f=Mt(360*(.5-r),-$e,$e);return new H(c,f)}}const Gm=Math.PI/2;function By(a){return Math.tan((Gm+a)/2)}class RA extends vp{constructor(t){super(t),this.center=t.center||[0,30];const[r,c]=this.parallels=t.parallels||[30,30];let f=Fe(r),u=Fe(c);this.southernCenter=f+u<0,this.southernCenter&&(f=-f,u=-u);const m=Math.cos(f),T=By(f);this.n=f===u?Math.sin(f):Math.log(m/Math.cos(u))/Math.log(By(u)/T),this.f=m*Math.pow(By(f),this.n)/this.n}project(t,r){r=Fe(r),this.southernCenter&&(r=-r),t=Fe(t-this.center[0]);const c=1e-6,{n:f,f:u}=this;u>0?r<-Gm+c&&(r=-Gm+c):r>Gm-c&&(r=Gm-c);const m=u/Math.pow(By(r),f);let T=m*Math.sin(f*t),L=u-m*Math.cos(f*t);return T=.5*(T/Math.PI+.5),L=.5*(L/Math.PI+.5),{x:T,y:this.southernCenter?L:1-L,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:c,f}=this,u=f-r,m=Math.sign(u),T=Math.sign(c)*Math.sqrt(t*t+u*u);let L=Math.atan2(t,Math.abs(u))*m;u*c<0&&(L-=Math.PI*Math.sign(t)*m);const D=Mt(Ge(L/c)+this.center[0],-180,180),b=Mt(Ge(2*Math.atan(Math.pow(f/T,1/c))-Gm),-$e,$e);return new H(D,this.southernCenter?-b:b)}}class Qb extends vp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:ue(t),y:_e(r),z:0}}unproject(t,r){const c=Oe(t),f=Ne(r);return new H(c,f)}}const ew=Fe($e);class PA extends vp{project(t,r){const c=(r=Fe(r))*r,f=c*c;return{x:.5*((t=Fe(t))*(.8707-.131979*c+f*(f*(.003971*c-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+c*(.015085+f*(.028874*c-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,f=25,u=0,m=c*c;do{m=c*c;const D=m*m;u=(c*(1.007226+m*(.015085+D*(.028874*m-.044475-.005916*D)))-r)/(1.007226+m*(.045255+D*(.259866*m-.311325-.005916*11*D))),c=Mt(c-u,-ew,ew)}while(Math.abs(u)>1e-6&&--f>0);m=c*c;const T=Mt(Ge(t/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),L=Ge(c);return new H(T,L)}}const tw=Fe($e);class DA extends vp{project(t,r){r=Fe(r),t=Fe(t);const c=Math.cos(r),f=2/Math.PI,u=Math.acos(c*Math.cos(t/2)),m=Math.sin(u)/u,T=.5*(t*f+2*c*Math.sin(t/2)/m)||0,L=.5*(r+Math.sin(r)/m)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(L/Math.PI+1),z:0}}unproject(t,r){let c=t=(2*t-.5)*Math.PI,f=r=(2*(1-r)-1)*Math.PI,u=25;const m=1e-6;let T=0,L=0;do{const D=Math.cos(f),b=Math.sin(f),C=2*b*D,R=b*b,A=D*D,I=Math.cos(c/2),k=Math.sin(c/2),W=2*I*k,$=k*k,ee=1-A*I*I,te=ee?1/ee:0,X=ee?Math.acos(D*I)*Math.sqrt(1/ee):0,le=.5*(2*X*D*k+2*c/Math.PI)-t,he=.5*(X*b+f)-r,Me=.5*te*(A*$+X*D*I*R)+1/Math.PI,He=te*(W*C/4-X*b*k),ze=.125*te*(C*k-X*b*A*W),Be=.5*te*(R*I+X*$*D)+.5,yt=He*ze-Be*Me;T=(he*He-le*Be)/yt,L=(le*ze-he*Me)/yt,c=Mt(c-T,-Math.PI,Math.PI),f=Mt(f-L,-tw,tw)}while((Math.abs(T)>m||Math.abs(L)>m)&&--u>0);return new H(Ge(c),Ge(f))}}class iw extends vp{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Fe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:c,cosPhi:f}=this;return{x:Fe(t)*f*c+.5,y:-Math.sin(Fe(r))/f*c+.5,z:0}}unproject(t,r){const{scale:c,cosPhi:f}=this,u=-(r-.5)/c,m=Mt(Ge((t-.5)/c)/f,-180,180),T=Math.asin(Mt(u*f,-1,1)),L=Mt(Ge(T),-$e,$e);return new H(m,L)}}class OA extends Qb{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,c){const f=Sf(t,r,c),u=Af(Hl(c));return Qe.vec3.transformMat4(f,f,u),{x:f[0],y:f[1],z:f[2]}}locationPoint(t,r){const c=O(r.lat,r.lng),f=Qe.vec3.normalize([],c),u=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude,m=ge(1,0)*un*u;Qe.vec3.scaleAndAdd(c,c,f,m);const T=Qe.mat4.identity(new Float64Array(16));return Qe.mat4.multiply(T,t.pixelMatrix,t.globeMatrix),Qe.vec3.transformMat4(c,c,T),new je(c[0],c[1])}pixelsPerMeter(t,r){return ge(1,0)*r}pixelSpaceConversion(t,r,c){const f=ge(1,t)*r,u=Pe(ge(1,45)*r,f,c);return this.pixelsPerMeter(t,r)/u}createTileMatrix(t,r,c){const f=Lm(Hl(c.canonical));return Qe.mat4.multiply(new Float64Array(16),t.globeMatrix,f)}createInversionMatrix(t,r){const{center:c}=t,f=Af(Hl(r));return Qe.mat4.rotateY(f,f,Fe(c.lng)),Qe.mat4.rotateX(f,f,Fe(c.lat)),Qe.mat4.scale(f,f,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(t,r,c,f){return Hc(t,r,c,!0)||new Lt(0,0)}pointCoordinate3D(t,r,c){const f=this.pointCoordinate(t,r,c,0);return[f.x,f.y,f.z]}isPointAboveHorizon(t,r){return!Hc(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=function(f,u){const m=f.cameraToCenterDistance,T=f._centerAltitude*u,L=f._camera,D=f._camera.forward(),b=Qe.vec3.add([],Qe.vec3.scale([],D,-m),[0,0,T]),C=f.worldSize/(2*Math.PI),R=[0,0,-C],A=f.width/f.height,I=Math.tan(f.fovAboveCenter),k=Qe.vec3.scale([],L.up(),I),W=Qe.vec3.scale([],L.right(),I*A),$=Qe.vec3.normalize([],Qe.vec3.add([],Qe.vec3.add([],D,k),W)),ee=[];let te;if(new xa(b,$).closestPointOnSphere(R,C,ee)){const X=Qe.vec3.add([],ee,R),le=Qe.vec3.sub([],X,b);te=Math.cos(f.fovAboveCenter)*Qe.vec3.length(le)}else{const X=Qe.vec3.sub([],b,R),le=Qe.vec3.sub([],R,b);Qe.vec3.normalize(le,le);const he=Qe.vec3.length(X)-C;te=Math.sqrt(he*(he+2*C));const Me=Math.acos(te/(C+he))-Math.acos(Qe.vec3.dot(D,le));te*=Math.cos(Me)}return 1.01*te}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=jc(t.zoom);if(c>0){const f=Kb(t,ge(1,t.center.lat)*t.worldSize),u=t.worldSize/(2*Math.PI),m=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Pe(r,f+u*(1-Math.cos(m)),Math.pow(c,10))}return r}upVector(t,r,c){return Sf(r,c,t,1)}upVectorScale(t){return{metersToTile:Gc(Ef(Hl(t)))}}}function nw(a){const t=a.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(a.name){case"mercator":return new Qb(a);case"equirectangular":return new IA(a);case"naturalEarth":return new PA(a);case"equalEarth":return new LA(a);case"winkelTripel":return new DA(a);case"albers":return r?new iw(a):new CA(a);case"lambertConformalConic":return r?new iw(a):new RA(a);case"globe":return new OA(a)}throw new Error(`Invalid projection name: ${a.name}`)}const zA=oe.VectorTileFeature.types,kA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ny(a,t,r,c,f,u,m,T,L,D,b,C,R){const A=T?Math.min(yp,Math.round(T[0])):0,I=T?Math.min(yp,Math.round(T[1])):0;a.emplaceBack(t,r,Math.round(32*c),Math.round(32*f),u,m,(A<<1)+(L?1:0),I,16*D,16*b,256*C,256*R)}function Uy(a,t,r){a.emplaceBack(t,r)}function Vy(a,t,r,c,f,u,m){a.emplaceBack(t,r,c,f,u,m)}function Gy(a,t,r,c,f){a.emplaceBack(t,r,c,f),a.emplaceBack(t,r,c,f),a.emplaceBack(t,r,c,f),a.emplaceBack(t,r,c,f)}function FA(a){for(const t of a.sections)if(Bg(t.text))return!0;return!1}class Tv{constructor(t){this.layoutVertexArray=new _u,this.indexArray=new qs,this.programConfigurations=t,this.segments=new Ks,this.dynamicLayoutVertexArray=new va,this.opacityVertexArray=new uh,this.placedSymbolArray=new tp,this.iconTransitioningVertexArray=new il,this.globeExtVertexArray=new Kd,this.zOffsetVertexArray=new Ra}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,r,c,f,u){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$s.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ss.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,kA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,ko.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,As.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,dd.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Sn(Tv,"SymbolBuffers");class Mv{constructor(t,r,c){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new c,this.segments=new Ks,this.collisionVertexArray=new vu,this.collisionVertexArrayExt=new va}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,bh.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,lc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Sn(Mv,"CollisionBuffers");class Hy{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qe.mat4.identity([]),this.placementViewportMatrix=Qe.mat4.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ca(this.zoom,r["text-size"]),this.iconSizeData=ca(this.zoom,r["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),u=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>cc[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Tv(new Gl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new Tv(new Gl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new Tu,this.lineVertexArray=new Ha,this.symbolInstances=new Nl}calculateGlyphDependencies(t,r,c,f,u){for(const m of t){const T=m.codePointAt(0);if(T===void 0)break;if(r[T]=!0,f&&u&&T<=65535){const L=u_[m];L&&(r[L.charCodeAt(0)]=!0)}}}updateFootprints(t,r){}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!vi(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(t,r,c,f){const u=this.layers[0],m=u.layout,T=this.projection.name==="globe",L=m.get("text-font"),D=m.get("text-field"),b=m.get("icon-image"),C=(D.value.kind!=="constant"||D.value.value instanceof to&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),R=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,A=m.get("symbol-sort-key");if(this.features=[],!C&&!R)return;const I=r.iconDependencies,k=r.glyphDependencies,W=r.availableImages,$=new Qs(this.zoom);for(const{feature:ee,id:te,index:X,sourceLayerIndex:le}of t){const he=u._featureFilter.needGeometry,Me=wi(ee,he);if(!u._featureFilter.filter($,Me,c))continue;if(he||(Me.geometry=Wt(ee,c,f)),T&&ee.type!==1&&c.z<=5){const yt=Me.geometry,ke=.98078528056,dt=(Et,Ct)=>{const Bt=Sf(Et.x,Et.y,c,1),ei=Sf(Ct.x,Ct.y,c,1);return Qe.vec3.dot(Bt,ei)<ke};for(let Et=0;Et<yt.length;Et++)yt[Et]=hi(yt[Et],dt)}let He,ze;if(C){const yt=u.getValueAndResolveTokens("text-field",Me,c,W),ke=to.factory(yt);FA(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||mf()==="unavailable"||this.hasRTLText&&oa.isParsed())&&(He=cA(ke,u,Me))}if(R){const yt=u.getValueAndResolveTokens("icon-image",Me,c,W);ze=yt instanceof Xs?yt:Xs.fromString(yt)}if(!He&&!ze)continue;const Be=this.sortFeaturesByKey?A.evaluate(Me,{},c):void 0;if(this.features.push({id:te,text:He,icon:ze,index:X,sourceLayerIndex:le,geometry:Me.geometry,properties:ee.properties,type:zA[ee.type],sortKey:Be}),ze&&(I[ze.namePrimary]=!0,ze.nameSecondary&&(I[ze.nameSecondary]=!0)),He){const yt=L.evaluate(Me,{},c).join(","),ke=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(cc.vertical)>=0;for(const dt of He.sections)if(dt.image)I[dt.image.namePrimary]=!0;else{const Et=hf(He.toString()),Ct=dt.fontStack||yt,Bt=k[Ct]=k[Ct]||{};this.calculateGlyphDependencies(dt.text,Bt,ke,this.allowVerticalPlacement,Et)}}}m.get("symbol-placement")==="line"&&(this.features=function(ee){const te={},X={},le=[];let he=0;function Me(yt){le.push(ee[yt]),he++}function He(yt,ke,dt){const Et=X[yt];return delete X[yt],X[ke]=Et,le[Et].geometry[0].pop(),le[Et].geometry[0]=le[Et].geometry[0].concat(dt[0]),Et}function ze(yt,ke,dt){const Et=te[ke];return delete te[ke],te[yt]=Et,le[Et].geometry[0].shift(),le[Et].geometry[0]=dt[0].concat(le[Et].geometry[0]),Et}function Be(yt,ke,dt){const Et=dt?ke[0][ke[0].length-1]:ke[0][0];return`${yt}:${Et.x}:${Et.y}`}for(let yt=0;yt<ee.length;yt++){const ke=ee[yt],dt=ke.geometry,Et=ke.text?ke.text.toString():null;if(!Et){Me(yt);continue}const Ct=Be(Et,dt),Bt=Be(Et,dt,!0);if(Ct in X&&Bt in te&&X[Ct]!==te[Bt]){const ei=ze(Ct,Bt,dt),ni=He(Ct,Bt,le[ei].geometry);delete te[Ct],delete X[Bt],X[Be(Et,le[ni].geometry,!0)]=ni,le[ei].geometry=null}else Ct in X?He(Ct,Bt,dt):Bt in te?ze(Ct,Bt,dt):(Me(yt),te[Ct]=he-1,X[Bt]=he-1)}return le.filter(yt=>yt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,te)=>ee.sortKey-te.sortKey)}update(t,r,c,f,u){const m=Object.keys(t).length!==0;if(m&&!this.stateDependentLayers.length)return;const T=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,r,T,c,f,u),this.icon.programConfigurations.updatePaintArrays(t,r,T,c,f,u)}updateZOffset(){const t=(u,m,T)=>{c+=m,c>u.length&&u.resize(c);for(let L=-m;L<0;L++)u.emplace(L+c,T)},r=(u,m,T)=>{f+=m,f>u.length&&u.resize(f);for(let L=-m;L<0;L++)u.emplace(L+f,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,f=0;for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:L,numIconVertices:D}=m,b=m.zOffset,C=D>0;if((T>0||L>0)&&(t(this.text.zOffsetVertexArray,T,b),t(this.text.zOffsetVertexArray,L,b)),C){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:A}=m;R>=0&&r(this.icon.zOffsetVertexArray,D,b),A>=0&&r(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,b)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=nw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:f,y:u}of r)this.lineVertexArray.emplaceBack(f,u);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,r,c,f,u,m,T,L,D,b,C,R,A,I,k,W){const $=t.indexArray,ee=t.layoutVertexArray,te=t.globeExtVertexArray,X=t.segments.prepareSegment(4*r.length,ee,$,this.canOverlap?m.sortKey:void 0),le=this.glyphOffsetArray.length,he=X.vertexLength,Me=this.allowVerticalPlacement&&T===cc.vertical?Math.PI/2:0,He=m.text&&m.text.sections;for(let Be=0;Be<r.length;Be++){const{tl:yt,tr:ke,bl:dt,br:Et,texPrimary:Ct,texSecondary:Bt,pixelOffsetTL:ei,pixelOffsetBR:ni,minFontScaleX:Yt,minFontScaleY:yi,glyphOffset:Fi,isSDF:di,sectionIndex:Tn}=r[Be],ln=X.vertexLength,$i=Fi[1];if(Ny(ee,D.x,D.y,yt.x,$i+yt.y,Ct.x,Ct.y,c,di,ei.x,ei.y,Yt,yi),Ny(ee,D.x,D.y,ke.x,$i+ke.y,Ct.x+Ct.w,Ct.y,c,di,ni.x,ei.y,Yt,yi),Ny(ee,D.x,D.y,dt.x,$i+dt.y,Ct.x,Ct.y+Ct.h,c,di,ei.x,ni.y,Yt,yi),Ny(ee,D.x,D.y,Et.x,$i+Et.y,Ct.x+Ct.w,Ct.y+Ct.h,c,di,ni.x,ni.y,Yt,yi),L){const{x:Di,y:Kn,z:bn}=L.anchor,[Cn,fr,Sr]=L.up;Vy(te,Di,Kn,bn,Cn,fr,Sr),Vy(te,Di,Kn,bn,Cn,fr,Sr),Vy(te,Di,Kn,bn,Cn,fr,Sr),Vy(te,Di,Kn,bn,Cn,fr,Sr),Gy(t.dynamicLayoutVertexArray,Di,Kn,bn,Me)}else Gy(t.dynamicLayoutVertexArray,D.x,D.y,D.z,Me);if(W){const Di=Bt||Ct;Uy(t.iconTransitioningVertexArray,Di.x,Di.y),Uy(t.iconTransitioningVertexArray,Di.x+Di.w,Di.y),Uy(t.iconTransitioningVertexArray,Di.x,Di.y+Di.h),Uy(t.iconTransitioningVertexArray,Di.x+Di.w,Di.y+Di.h)}$.emplaceBack(ln,ln+1,ln+2),$.emplaceBack(ln+1,ln+2,ln+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Fi[0]),Be!==r.length-1&&Tn===r[Be+1].sectionIndex||t.programConfigurations.populatePaintArrays(ee.length,m,m.index,{},A,I,k,He&&He[Tn])}const ze=L?L.anchor:D;t.placedSymbolArray.emplaceBack(ze.x,ze.y,ze.z,D.x,D.y,le,this.glyphOffsetArray.length-le,he,b,C,D.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],T,0,!1,0,R,0)}_commitLayoutVertex(t,r,c,f,u,m,T){t.emplaceBack(r,c,f,u,m,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(t,r,c,f,u,m,T){const L=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),D=L.vertexLength,b=T.tileAnchorX,C=T.tileAnchorY;for(let A=0;A<4;A++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,r,t.padding,T.zOffset),this._commitLayoutVertex(c.layoutVertexArray,f,u,m,b,C,new je(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,u,m,b,C,new je(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,u,m,b,C,new je(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,f,u,m,b,C,new je(t.x1,t.y2)),L.vertexLength+=4;const R=c.indexArray;R.emplaceBack(D,D+1),R.emplaceBack(D+1,D+2),R.emplaceBack(D+2,D+3),R.emplaceBack(D+3,D),L.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,c,f,u,m){for(let T=f;T<u;T++){const L=c.get(T),D=this.getSymbolInstanceTextSize(t,m,r,T);this._addCollisionDebugVertices(L,D,this.textCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(t,r,c,f,u,m){for(let T=f;T<u;T++){const L=c.get(T),D=this.getSymbolInstanceIconSize(t,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(L,D,this.iconCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,m)}}generateCollisionDebugBuffers(t,r,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Mv(Io,wh.members,il),this.iconCollisionBox=new Mv(Io,wh.members,il);const f=Da(this.iconSizeData,t),u=Da(this.textSizeData,t,c);for(let m=0;m<this.symbolInstances.length;m++){const T=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(u,t,r,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(u,t,r,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(f,t,r,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(f,t,r,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(t,r,c,f){const u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:f),m=sl(this.textSizeData,t,u)/zs;return this.tilePixelRatio*m}getSymbolInstanceIconSize(t,r,c){const f=this.icon.placedSymbolArray.get(c),u=sl(this.iconSizeData,t,f);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(t,r,c,f){t.emplaceBack(r,-c,-c,f),t.emplaceBack(r,c,-c,f),t.emplaceBack(r,c,c,f),t.emplaceBack(r,-c,c,f)}_updateTextDebugCollisionBoxes(t,r,c,f,u,m,T){for(let L=f;L<u;L++){const D=c.get(L),b=this.getSymbolInstanceTextSize(t,m,r,L);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,D.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(t,r,c,f,u,m,T){for(let L=f;L<u;L++){const D=c.get(L),b=this.getSymbolInstanceIconSize(t,r,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,D.padding,m.zOffset)}}updateCollisionDebugBuffers(t,r,c,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Da(this.iconSizeData,t,f),m=Da(this.textSizeData,t,c);for(let T=0;T<this.symbolInstances.length;T++){const L=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(m,t,r,L.textBoxStartIndex,L.textBoxEndIndex,L,c),this._updateTextDebugCollisionBoxes(m,t,r,L.verticalTextBoxStartIndex,L.verticalTextBoxEndIndex,L,c),this._updateIconDebugCollisionBoxes(u,t,r,L.iconBoxStartIndex,L.iconBoxEndIndex,L,f),this._updateIconDebugCollisionBoxes(u,t,r,L.verticalIconBoxStartIndex,L.verticalIconBoxEndIndex,L,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,c,f,u,m,T,L,D){const b={};if(r<c){const{x1:C,y1:R,x2:A,y2:I,padding:k,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:X,featureIndex:le}=t.get(r);b.textBox={x1:C,y1:R,x2:A,y2:I,padding:k,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:X},b.textFeatureIndex=le}if(f<u){const{x1:C,y1:R,x2:A,y2:I,padding:k,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:X,featureIndex:le}=t.get(f);b.verticalTextBox={x1:C,y1:R,x2:A,y2:I,padding:k,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:X},b.verticalTextFeatureIndex=le}if(m<T){const{x1:C,y1:R,x2:A,y2:I,padding:k,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:X,featureIndex:le}=t.get(m);b.iconBox={x1:C,y1:R,x2:A,y2:I,padding:k,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:X},b.iconFeatureIndex=le}if(L<D){const{x1:C,y1:R,x2:A,y2:I,padding:k,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:X,featureIndex:le}=t.get(L);b.verticalIconBox={x1:C,y1:R,x2:A,y2:I,padding:k,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:X},b.verticalIconFeatureIndex=le}return b}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,r){const c=t.placedSymbolArray.get(r),f=c.vertexStartIndex+4*c.numGlyphs;for(let u=c.vertexStartIndex;u<f;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),c=Math.cos(t),f=[],u=[],m=[];for(let T=0;T<this.symbolInstances.length;++T){m.push(T);const L=this.symbolInstances.get(T);f.push(0|Math.round(r*L.tileAnchorX+c*L.tileAnchorY)),u.push(L.featureIndex)}return m.sort((T,L)=>f[T]-f[L]||u[L]-u[T]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,r){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===r?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const c=this.symbolInstances.get(r);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:D}=c;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),u>=0&&u!==f&&this.addIndicesForPlacedSymbol(this.text,u),m>=0&&m!==u&&m!==f&&this.addIndicesForPlacedSymbol(this.text,m),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let rw,sw,Sv;Sn(Hy,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Hy.addDynamicAttributes=Gy;class ow{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Zi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Sn(ow,"FormatSectionOverride",{omit:["defaultValue"]});const Ev=()=>Sv||(Sv={layout:rw||(rw=new Ts({"symbol-placement":new qi(Jt.layout_symbol["symbol-placement"]),"symbol-spacing":new qi(Jt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qi(Jt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(Jt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qi(Jt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new qi(Jt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new qi(Jt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new qi(Jt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new qi(Jt.layout_symbol["icon-ignore-placement"]),"icon-optional":new qi(Jt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qi(Jt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(Jt.layout_symbol["icon-size"]),"icon-size-scale-range":new qi(Jt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new yn(Jt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yn(Jt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(Jt.layout_symbol["icon-image"]),"icon-rotate":new yn(Jt.layout_symbol["icon-rotate"]),"icon-padding":new qi(Jt.layout_symbol["icon-padding"]),"icon-keep-upright":new qi(Jt.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(Jt.layout_symbol["icon-offset"]),"icon-anchor":new yn(Jt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qi(Jt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qi(Jt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qi(Jt.layout_symbol["text-rotation-alignment"]),"text-field":new yn(Jt.layout_symbol["text-field"]),"text-font":new yn(Jt.layout_symbol["text-font"]),"text-size":new yn(Jt.layout_symbol["text-size"]),"text-size-scale-range":new qi(Jt.layout_symbol["text-size-scale-range"]),"text-max-width":new yn(Jt.layout_symbol["text-max-width"]),"text-line-height":new yn(Jt.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(Jt.layout_symbol["text-letter-spacing"]),"text-justify":new yn(Jt.layout_symbol["text-justify"]),"text-radial-offset":new yn(Jt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qi(Jt.layout_symbol["text-variable-anchor"]),"text-anchor":new yn(Jt.layout_symbol["text-anchor"]),"text-max-angle":new qi(Jt.layout_symbol["text-max-angle"]),"text-writing-mode":new qi(Jt.layout_symbol["text-writing-mode"]),"text-rotate":new yn(Jt.layout_symbol["text-rotate"]),"text-padding":new qi(Jt.layout_symbol["text-padding"]),"text-keep-upright":new qi(Jt.layout_symbol["text-keep-upright"]),"text-transform":new yn(Jt.layout_symbol["text-transform"]),"text-offset":new yn(Jt.layout_symbol["text-offset"]),"text-allow-overlap":new qi(Jt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new qi(Jt.layout_symbol["text-ignore-placement"]),"text-optional":new qi(Jt.layout_symbol["text-optional"]),visibility:new qi(Jt.layout_symbol.visibility)})),paint:sw||(sw=new Ts({"icon-opacity":new yn(Jt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new yn(Jt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new yn(Jt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new yn(Jt.paint_symbol["text-emissive-strength"]),"icon-color":new yn(Jt.paint_symbol["icon-color"]),"icon-halo-color":new yn(Jt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(Jt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(Jt.paint_symbol["icon-halo-blur"]),"icon-translate":new qi(Jt.paint_symbol["icon-translate"]),"icon-translate-anchor":new qi(Jt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new yn(Jt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new yn(Jt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new yn(Jt.paint_symbol["text-occlusion-opacity"]),"text-color":new yn(Jt.paint_symbol["text-color"],{runtimeType:Ln,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new yn(Jt.paint_symbol["text-halo-color"]),"text-halo-width":new yn(Jt.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(Jt.paint_symbol["text-halo-blur"]),"text-translate":new qi(Jt.paint_symbol["text-translate"]),"text-translate-anchor":new qi(Jt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new qi(Jt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new qi(Jt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new qi(Jt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new qi(Jt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new yn(Jt.paint_symbol["symbol-z-offset"])}))},Sv);class jy extends $o{constructor(t,r,c,f){super(t,Ev(),r,c,f),this._colorAdjustmentMatrix=Qe.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,r){super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const u of c)f.indexOf(u)<0&&f.push(u);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,r,c,f){return this._saturation===t&&this._contrast===r&&this._brightnessMin===c&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(u,m,T,L){u=ie(u),m=ye(m);const D=Qe.mat4.create(),b=u/3,C=1-2*b,R=[C,b,b,0,b,C,b,0,b,b,C,0,0,0,0,1],A=.5-.5*m,I=L-T;return Qe.mat4.multiply(D,[I,0,0,0,0,I,0,0,0,0,I,0,T,T,T,1],[m,0,0,0,0,m,0,0,0,0,m,0,A,A,A,1]),Qe.mat4.multiply(D,D,R),D}(t,r,c,f),this._saturation=t,this._contrast=r,this._brightnessMin=c,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,r,c,f){const u=this.layout.get(t).evaluate(r,{},c,f),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||Ju(m.value)||!u?u:function(T,L){return L.replace(/{([^{}]+)}/g,(D,b)=>b in T?String(T[b]):"")}(r.properties,u)}createBucket(t){return new Hy(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Ev().paint.overridableProperties){if(!jy.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),c=new ow(r),f=new Ud(c,r.property.specification,this.scope,this.options);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Vd("source",f):new el("composite",f,r.value.zoomStops,r.value._interpolationType),this.paint._values[t]=new Rc(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven())&&jy.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const c=t.get("text-field"),f=Ev().paint.properties[r];let u=!1;const m=T=>{for(const L of T)if(f.overrides&&f.overrides.hasOverride(L))return void(u=!0)};if(c.value.kind==="constant"&&c.value.value instanceof to)m(c.value.value.sections);else if(c.value.kind==="source"){const T=D=>{u||(D instanceof Yo&&hs(D.value)===gr?m(D.value.sections):D instanceof Zl?m(D.sections):D.eachChild(T))},L=c.value;L._styleExpression&&T(L._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,r,c){return{config:new sc(this,{zoom:r,lut:c}),overrideFog:!1}}}let aw,lw,cw,uw;var Av=Qr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Cv(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Lv(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Iv{constructor(t,r,c,f){this.context=t,this.format=c,this.useMipmap=f&&f.useMipmap,this.texture=t.gl.createTexture(),this.update(r,{premultiply:f&&f.premultiply})}update(t,r){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,f=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:u}=this,{gl:m}=u,{x:T,y:L}=r&&r.position?r.position:{x:0,y:0},D=Math.max(T+c,this.size?this.size[0]:0),b=Math.max(L+f,this.size?this.size[1]:0);!this.size||this.size[0]===D&&this.size[1]===b||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!r||r.premultiply!==!1));const C=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&D>0&&b>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(D,b)))+1:1;m.texStorage2D(m.TEXTURE_2D,R,this.format,D,b),this.size=[D,b]}if(this.size)if(C)m.texSubImage2D(m.TEXTURE_2D,0,T,L,Cv(this.format),Lv(this.format),t);else{const R=t.data;R&&m.texSubImage2D(m.TEXTURE_2D,0,T,L,c,f,Cv(this.format),Lv(this.format),R)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(t,r,c=!1){const{context:f}=this,{gl:u}=f;u.bindTexture(u.TEXTURE_2D,this.texture),t!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(t,r,c,f){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),this.magFilter=r),t!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?t===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),f!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,f),this.wrapT=f)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Wy{constructor(t,r){this.context=t,this.texture=r}bind(t,r){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),t!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,t),this.minFilter=t),r!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,r),this.wrapS=r)}}function qy(a,t,r,c,f,u,m,T){const L=[a,t,1,r,c,1,f,u,1],D=[m,T,1],b=Qe.mat3.adjoint([],L),[C,R,A]=Qe.vec3.transformMat3(D,D,b);return Qe.mat3.multiply(L,L,[C,0,0,0,R,0,0,0,A])}function hw(a,t,r,c,f,u,m,T){const L=function(D,b,C,R,A,I,k,W){const $=qy(0,0,1,0,1,1,0,1),ee=qy(D,b,C,R,A,I,k,W),te=Qe.mat3.adjoint([],$);return Qe.mat3.multiply(ee,ee,te)}(a,t,r,c,f,u,m,T);return[L[2]/L[8]/un,L[5]/L[8]/un]}function $y(a){return[a[0],Math.min(Math.max(a[1],-$e),$e)]}class dw extends bi{constructor(t,r,c,f){super(),this.id=t,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=r,this._dirty=!1}load(t,r){if(this._loaded=r||!1,this.fire(new Ve("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=pa(this.map._requestManager.transformRequest(this.url,na.Image),(c,f)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Pt(c)):f&&(this.image=f instanceof HTMLImageElement?tn.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Wy(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ve("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Wy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=t[0][1],c=t[0][1];for(const u of t)u[1]>c&&(c=u[1]),u[1]<r&&(r=u[1]);const f=(c+r)/2;if(f>$e?this.onNorthPole=!0:f<-$e&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=t.map(Lt.fromLngLat);this.tileID=function(m){let T=1/0,L=1/0,D=-1/0,b=-1/0;for(const k of m)T=Math.min(T,k.x),L=Math.min(L,k.y),D=Math.max(D,k.x),b=Math.max(b,k.y);const C=Math.max(D-T,b-L),R=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),A=Math.pow(2,R);let I=Math.floor((T+D)/2*A);return I>1&&(I-=1),new Mo(R,I,Math.floor((L+b)/2*A))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ve("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const $ in this.tiles){const ee=this.tiles[$];ee.state!=="loaded"&&(ee.state="loaded",ee.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=m_(new Mo(0,0,0),this.map.transform.projection),c=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const ee=$[1].x-$[0].x,te=$[1].y-$[0].y,X=$[2].x-$[1].x,le=$[2].y-$[1].y,he=$[3].x-$[2].x,Me=$[3].y-$[2].y,He=$[0].x-$[3].x,ze=$[0].y-$[3].y,Be=ee*le-X*te,yt=X*Me-he*le,ke=he*ze-He*Me,dt=He*te-ee*ze;return Be>0&&yt>0&&ke>0&&dt>0||Be<0&&yt<0&&ke<0&&dt<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=m_(this.tileID,this.map.transform.projection),[u,m,T,L]=this.coordinates.map($=>{const ee=f.projection.project($[0],$[1]);return Jb(f,ee)._round()});this.perspectiveTransform=hw(u.x,u.y,m.x,m.y,T.x,T.y,L.x,L.y);const D=this._boundsArray=new mu;D.emplaceBack(u.x,u.y,0,0),D.emplaceBack(m.x,m.y,un,0),D.emplaceBack(L.x,L.y,0,un),D.emplaceBack(T.x,T.y,un,un),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(D,Av.members),this.boundsSegments=Ks.simpleSegment(0,0,4,2);const b=[],C=[$y((R=this.coordinates)[0]),$y(R[1]),$y(R[2]),$y(R[3])];var R;const[A,I,k,W]=function($){let ee=$[0][0],te=ee,X=$[0][1],le=X;for(let he=1;he<$.length;he++)$[he][0]<ee?ee=$[he][0]:$[he][0]>te&&(te=$[he][0]),$[he][1]<X?X=$[he][1]:$[he][1]>le&&(le=$[he][1]);return[ee,X,te-ee,le-X]}(C);{const $=new mu,[ee,te,X,le]=function(ei){let ni=ei[0].x,Yt=ni,yi=ei[0].y,Fi=yi;for(let di=1;di<ei.length;di++)ei[di].x<ni?ni=ei[di].x:ei[di].x>Yt&&(Yt=ei[di].x),ei[di].y<yi?yi=ei[di].y:ei[di].y>Fi&&(Fi=ei[di].y);return[ni,yi,Yt-ni,Fi-yi]}(c),he=ei=>[(ei.x-ee)/X,(ei.y-te)/le],[Me,He,ze,Be]=c.map(he),yt=function(ei,ni,Yt,yi,Fi,di,Tn,ln){const $i=qy(0,0,1,0,1,1,0,1),Di=qy(ei,ni,Yt,yi,Fi,di,Tn,ln),Kn=Qe.mat3.adjoint([],Di);return Qe.mat3.multiply($i,$i,Kn)}(Me[0],Me[1],He[0],He[1],ze[0],ze[1],Be[0],Be[1]);this.elevatedGlobePerspectiveTransform=hw(Me[0],Me[1],He[0],He[1],ze[0],ze[1],Be[0],Be[1]);const ke=(ei,ni)=>{b.push(ei.lng);const Yt=Math.round((ei.lng-A)/k*un),yi=Math.round((ei.lat-I)/W*un),Fi=he(ni),di=Qe.vec3.transformMat3([],[Fi[0],Fi[1],1],yt),Tn=Math.round(di[0]/di[2]*un),ln=Math.round(di[1]/di[2]*un);$.emplaceBack(Yt,yi,Tn,ln)},dt=c[3].x-c[0].x,Et=c[3].y-c[0].y,Ct=c[2].x-c[1].x,Bt=c[2].y-c[1].y;for(let ei=0;ei<65;ei++){const ni=ei/64,Yt=[c[0].x+ni*dt,c[0].y+ni*Et],yi=[c[1].x+ni*Ct,c[1].y+ni*Bt],Fi=yi[0]-Yt[0],di=yi[1]-Yt[1];for(let Tn=0;Tn<65;Tn++){const ln=Tn/64,$i={x:Yt[0]+Fi*ln,y:Yt[1]+di*ln,z:0};ke(r.projection.unproject($i.x,$i.y),$i)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer($,Av.members)}{this.maxLongitudeTriangleSize=0;let $=[],ee=new qs;const te=(X,le,he)=>{ee.emplaceBack(X,le,he);const Me=b[X],He=b[le],ze=b[he],Be=Math.min(Math.min(Me,He),ze),yt=Math.max(Math.max(Me,He),ze)-Be;yt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=yt),$.push(Be+yt/2)};for(let X=0;X<64;X++)for(let le=0;le<64;le++){const he=65*X+le,Me=he+1,He=he+65,ze=He+1;te(he,He,Me),te(Me,He,ze)}[$,ee]=function(X,le){const he=Array.from({length:X.length},(ze,Be)=>Be);he.sort((ze,Be)=>X[ze]-X[Be]);const Me=[],He=new qs;for(let ze=0;ze<he.length;ze++){const Be=he[ze];Me.push(X[Be]);const yt=3*Be,ke=yt+1;He.emplaceBack(le.uint16[yt],le.uint16[ke],le.uint16[ke+1])}return[Me,He]}($,ee),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(ee)}this.elevatedGlobeSegments=Ks.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/un,0,W/un,0,0,I,A,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const r=this.map.painter.context,c=r.gl;!this._dirty||this.texture instanceof Wy||(this.texture?this.texture.update(this.image):(this.texture=new Iv(r,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(r)}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let f=(u=t+180)+360*Math.round((c[0]-u)/360);var u;const m=new Ks,T=(C,R)=>{m.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:r.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},L=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-f)<=L){const C=oi(c,0,c.length,f+L);return C===c.length||T(C,uo(c,C+1,c.length,f+360-L)-C),m}f<c[0]&&(f+=360);const D=uo(c,0,c.length,f-L);if(D===c.length)return T(0,c.length),m;T(0,D-0);const b=oi(c,D+1,c.length,f+L);return b!==c.length&&T(b,c.length-b),m}}const BA=(Math.pow(256,2)-1)/16907520;class pw extends $o{constructor(t,r,c,f){super(t,{layout:cw||(cw=new Ts({visibility:new qi(Jt.layout_raster.visibility)})),paint:uw||(uw=new Ts({"raster-opacity":new qi(Jt.paint_raster["raster-opacity"]),"raster-color":new pu(Jt.paint_raster["raster-color"]),"raster-color-mix":new qi(Jt.paint_raster["raster-color-mix"]),"raster-color-range":new qi(Jt.paint_raster["raster-color-range"]),"raster-hue-rotate":new qi(Jt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qi(Jt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qi(Jt.paint_raster["raster-brightness-max"]),"raster-saturation":new qi(Jt.paint_raster["raster-saturation"]),"raster-contrast":new qi(Jt.paint_raster["raster-contrast"]),"raster-resampling":new qi(Jt.paint_raster["raster-resampling"]),"raster-fade-duration":new qi(Jt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new qi(Jt.paint_raster["raster-emissive-strength"]),"raster-array-band":new qi(Jt.paint_raster["raster-array-band"]),"raster-elevation":new qi(Jt.paint_raster["raster-elevation"])}))},r,c,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof dw&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[c,f]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(f)||c===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=If({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,f])}}let fw,mw,gw,_w,yw;class vw extends $o{constructor(t,r,c,f){super(t,{layout:fw||(fw=new Ts({visibility:new qi(Jt["layout_raster-particle"].visibility)})),paint:mw||(mw=new Ts({"raster-particle-array-band":new qi(Jt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new qi(Jt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new pu(Jt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new qi(Jt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new qi(Jt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new qi(Jt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new qi(Jt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new qi(Jt["paint_raster-particle"]["raster-particle-elevation"])}))},r,c,f),this._updateColorRamp(),this.lastInvalidatedAt=tn.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=If({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=tn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class NA extends $o{constructor(t,r){super(t,{},r,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function Rv(a,t,r){const c=[0,0,1],f=Qe.quat.identity([]);return Qe.quat.rotateY(f,f,r?-Fe(a)+Math.PI:Fe(a)),Qe.quat.rotateX(f,f,-Fe(t)),Qe.vec3.transformQuat(c,c,f),Qe.vec3.normalize(c,c)}function xw(a,t){const r=Zy(a.projection,a.zoom,a.width,a.height),c=function(u,m,T,L,D){const b=new H(T.lng-180*xp,T.lat),C=new H(T.lng+180*xp,T.lat),R=u.project(b.lng,b.lat),A=u.project(C.lng,C.lat),I=-Math.atan2(A.y-R.y,A.x-R.x),k=Lt.fromLngLat(T);k.y=Mt(k.y,-1+xp,1-xp);const W=k.toLngLat(),$=u.project(W.lng,W.lat),ee=Lt.fromLngLat(W);ee.x+=xp;const te=ee.toLngLat(),X=u.project(te.lng,te.lat),le=ww(X.x-$.x,X.y-$.y,I),he=Lt.fromLngLat(W);he.y+=xp;const Me=he.toLngLat(),He=u.project(Me.lng,Me.lat),ze=ww(He.x-$.x,He.y-$.y,I),Be=Math.abs(le.x)/Math.abs(ze.y),yt=Qe.mat4.identity([]);Qe.mat4.rotateZ(yt,yt,-I*(1-(D?0:L)));const ke=Qe.mat4.identity([]);return Qe.mat4.scale(ke,ke,[1,1-(1-Be)*L,1]),ke[4]=-ze.x/ze.y*L,Qe.mat4.rotateZ(ke,ke,I),Qe.mat4.multiply(ke,yt,ke),ke}(a.projection,0,a.center,r,t),f=bw(a);return Qe.mat4.scale(c,c,[f,f,1]),c}function bw(a){const t=a.projection,r=Zy(a.projection,a.zoom,a.width,a.height),c=Pv(t,a.center),f=Pv(t,H.convert(t.center));return Math.pow(2,c*r+(1-r)*f)}function Zy(a,t,r,c,f=1/0){const u=a.range;if(!u)return 0;const m=Math.min(f,Math.max(r,c)),T=Math.log(m/1024)/Math.LN2;return ci(u[0]+T,u[1]+T,t)}const xp=1/4e4;function Pv(a,t){const r=Mt(t.lat,-$e,$e),c=new H(t.lng-180*xp,r),f=new H(t.lng+180*xp,r),u=a.project(c.lng,r),m=a.project(f.lng,r),T=Lt.fromLngLat(c),L=Lt.fromLngLat(f),D=m.x-u.x,b=m.y-u.y,C=L.x-T.x,R=L.y-T.y,A=Math.sqrt((C*C+R*R)/(D*D+b*b));return Math.log(A)/Math.LN2}function ww(a,t,r){const c=Math.cos(r),f=Math.sin(r);return{x:a*c-t*f,y:a*f+t*c}}function Tw(a,t,r){Qe.mat4.identity(a),Qe.mat4.rotateZ(a,a,Fe(t[2])),Qe.mat4.rotateX(a,a,Fe(t[0])),Qe.mat4.rotateY(a,a,Fe(t[1])),Qe.mat4.scale(a,a,r),Qe.mat4.multiply(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Xy(a,t,r,c,f,u,m,T){const L=[r[0]-t[0],r[1]-t[1],0],D=[c[0]-t[0],c[1]-t[1],0];if(Qe.vec3.length(L)<1e-12||Qe.vec3.length(D)<1e-12)return Qe.quat.identity(a);const b=Qe.vec3.cross([],L,D);Qe.vec3.normalize(b,b),Qe.vec3.subtract(D,c,t),L[2]=(u-f)*T,D[2]=(m-f)*T;const C=L;return Qe.vec3.cross(C,L,D),Qe.vec3.normalize(C,C),Qe.quat.rotationTo(a,b,C)}function Dv(a,t,r=!1){const c=jc(t.zoom),f=function(u,m,T){const L=m.worldSize,D=[u[12],u[13],u[14]],b=Ne(D[1]/L),C=Oe(D[0]/L),R=Qe.mat4.identity([]),A=ge(1,b)*L,I=ge(1,0)*L*Ze(b,m.zoom),k=1/Cf(L);let W=I*k;if(T){const X=Zy(m.projection,m.zoom,m.width,m.height,1024);W=k*m.projection.pixelSpaceConversion(m.center.lat,L,X)}const $=O(b,C);Qe.vec3.add($,$,Qe.vec3.scale([],Qe.vec3.normalize([],$),A*W*D[2]));const ee=function(X){const le=[X[0],X[1],X[2]];let he=[0,1,0];const Me=Qe.vec3.cross([],he,le);return Qe.vec3.cross(he,le,Me),Qe.vec3.squaredLength(he)===0&&(he=[0,1,0],Qe.vec3.cross(Me,le,he)),Qe.vec3.normalize(Me,Me),Qe.vec3.normalize(he,he),Qe.vec3.normalize(le,le),[Me[0],Me[1],Me[2],0,he[0],he[1],he[2],0,le[0],le[1],le[2],0,X[0],X[1],X[2],1]}($);Qe.mat4.scale(R,R,[W,W,W*A]),Qe.mat4.translate(R,R,[-D[0],-D[1],-D[2]]);const te=Qe.mat4.multiply([],m.globeMatrix,ee);return Qe.mat4.multiply(te,te,R),Qe.mat4.multiply(te,te,u),te}(a,t,r);if(c>0){const u=function(m,T){const L=T.worldSize,D=ge(1,0)*L*Ze(T.center.lat,T.zoom)/Cf(L),b=ge(1,T.center.lat)*L,C=Qe.mat4.identity([]);return Qe.mat4.rotateY(C,C,Fe(T.center.lng)),Qe.mat4.rotateX(C,C,Fe(T.center.lat)),Qe.mat4.translate(C,C,[0,0,Qo]),Qe.mat4.scale(C,C,[D,D,D*b]),Qe.mat4.translate(C,C,[T.point.x-.5*L,T.point.y-.5*L,0]),Qe.mat4.multiply(C,C,m),Qe.mat4.multiply(C,T.globeMatrix,C)}(a,t);return function(m,T,L){const D=(I,k,W)=>{const $=Qe.vec3.length(I),ee=Qe.vec3.length(k),te=Ml(I,k,W);return Qe.vec3.scale(te,te,1/Qe.vec3.length(te)*Pe($,ee,W))},b=D([m[0],m[1],m[2]],[T[0],T[1],T[2]],L),C=D([m[4],m[5],m[6]],[T[4],T[5],T[6]],L),R=D([m[8],m[9],m[10]],[T[8],T[9],T[10]],L),A=Ml([m[12],m[13],m[14]],[T[12],T[13],T[14]],L);return[b[0],b[1],b[2],0,C[0],C[1],C[2],0,R[0],R[1],R[2],0,A[0],A[1],A[2],1]}(f,u,c)}return f}function Mw(a,t,r,c){const f=ls.projectAabbCorners(c,r);let u=Number.MAX_VALUE,m=-1;for(let D=0;D<f.length;++D){const b=f[D];b[0]=(.5*b[0]+.5)*t.width,b[1]=(.5-.5*b[1])*t.height,b[2]<u&&(m=D,u=b[2])}const T=D=>new je(f[D][0],f[D][1]);let L;switch(m){case 0:case 6:L=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:L=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:L=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:L=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(mi(a,L))return u}const UA=Qr([{name:"a_pos_3f",components:3,type:"Float32"}]),VA=Qr([{name:"a_color_3f",components:3,type:"Float32"}]),GA=Qr([{name:"a_color_4f",components:4,type:"Float32"}]),HA=Qr([{name:"a_uv_2f",components:2,type:"Float32"}]),jA=Qr([{name:"a_normal_3f",components:3,type:"Float32"}]),WA=Qr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),qA=Qr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Sw={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Yy{constructor(t,r,c,f){this.message=(t?`${t}: `:"")+c,f&&(this.identifier=f),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ew(a,t){const r=a.indexOf("://")===-1;try{return new URL(a,r&&t?"http://example.com":void 0),!0}catch{return!1}}class Aw{constructor(t,r){this.feature=t,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Cw{constructor(){this.instancedDataArray=new Bc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Ov{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,r){}populate(t,r,c,f){this.tileToMeter=gt(c);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:T,index:L,sourceLayerIndex:D}of t){const b=T??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),C=wi(m,u);if(!this.layers[0]._featureFilter.filter(new Qs(this.zoom),C,c))continue;const R={id:b,sourceLayerIndex:D,index:L,geometry:u?C.geometry:Wt(m,c,f),properties:m.properties,type:m.type,patterns:{}},A=this.addFeature(R,R.geometry,C);A&&r.featureIndex.insert(m,R.geometry,L,D,this.index,this.instancesPerModel[A].instancedDataArray.length,un/32)}this.lookup=null}update(t,r,c,f){for(const u in this.instancesPerModel){const m=this.instancesPerModel[u];for(const T in t)m.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(m.features[m.idToFeaturesIndex[T]],t[T],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const c=this.instancesPerModel[r];for(const f of c.features){const u=this.layers[0],m=f.feature,T=this.canonical,L=u.paint.get("model-rotation").evaluate(m,{},T),D=u.paint.get("model-scale").evaluate(m,{},T),b=u.paint.get("model-translation").evaluate(m,{},T);Qe.vec3.exactEquals(f.rotation,L)&&Qe.vec3.exactEquals(f.scale,D)&&Qe.vec3.exactEquals(f.translation,b)||(this.evaluate(f,f.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,r,c,f){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(vi(this.activeReplacements,u))return!1;this.activeReplacements=u;let m=!1;for(const T in this.instancesPerModel){const L=this.instancesPerModel[T],D=L.instancedDataArray;for(const b of L.features){const C=b.instancedDataOffset,R=b.instancedDataCount;for(let A=0;A<R;A++){const I=16*(A+C);let k=D.float32[I+0];const W=k>un;k=W?k-un:k;const $=Math.floor(k),ee=D.float32[I+1];let te=!1;for(const X of this.activeReplacements)if(!ft(X,c,Sw.Model,f)&&!(X.min.x>$||$>X.max.x||X.min.y>ee||ee>X.max.y)&&(te=Ji(En($,ee,t.canonical,X.footprintTileId.canonical),X.footprint),te))break;D.float32[I]=te?k+un:k,m=m||te!==W}}}return m}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const r in this.instancesPerModel){const c=this.instancesPerModel[r];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,WA.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const c=this.instancesPerModel[r];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const r of this.modelUris)t.removeModel(r,"")}addFeature(t,r,c){const f=this.layers[0],u=f.layout.get("model-id").evaluate(c,{},this.canonical);if(!u)return Wn(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),u;Ew(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new Cw);const m=this.instancesPerModel[u],T=m.instancedDataArray,L=new Aw(c,T.length);for(const D of r)for(const b of D){if(b.x<0||b.x>=un||b.y<0||b.y>=un)continue;const C=(this.lookupDim-1)/un,R=this.lookupDim*(b.y*C|0)+b.x*C|0;if(this.lookup){if(this.lookup[R]!==0)continue;this.lookup[R]=1}this.instanceCount++;const A=T.length;T.resize(A+1),m.instancesEvaluatedElevation.push(0),T.float32[16*A]=b.x,T.float32[16*A+1]=b.y}return L.instancedDataCount=m.instancedDataArray.length-L.instancedDataOffset,L.instancedDataCount>0&&(t.id&&(m.idToFeaturesIndex[t.id]=m.features.length),m.features.push(L),this.evaluate(L,{},m,!1)),u}getModelUris(){return this.modelUris}evaluate(t,r,c,f){const u=this.layers[0],m=t.feature,T=this.canonical,L=t.rotation=u.paint.get("model-rotation").evaluate(m,r,T),D=t.scale=u.paint.get("model-scale").evaluate(m,r,T),b=t.translation=u.paint.get("model-translation").evaluate(m,r,T),C=u.paint.get("model-color").evaluate(m,r,T);C.a=u.paint.get("model-color-mix-intensity").evaluate(m,r,T);const R=[];this.maxVerticalOffset<b[2]&&(this.maxVerticalOffset=b[2]),this.maxScale=Math.max(Math.max(this.maxScale,D[0]),Math.max(D[1],D[2])),Tw(R,L,D);const A=Math.round(100*C.a)+C.b/1.05;for(let I=0;I<t.instancedDataCount;++I){const k=t.instancedDataOffset+I,W=16*k,$=c.instancedDataArray.float32;let ee=0;f&&(ee=$[W+6]-c.instancesEvaluatedElevation[k]);const te=0|$[W+1];$[W]=(0|$[W])+C.r/1.05,$[W+1]=te+C.g/1.05,$[W+2]=A,$[W+3]=1/(T.z>10?this.tileToMeter:gt(T,te)),$[W+4]=b[0],$[W+5]=b[1],$[W+6]=b[2]+ee,$[W+7]=R[0],$[W+8]=R[1],$[W+9]=R[2],$[W+10]=R[4],$[W+11]=R[5],$[W+12]=R[6],$[W+13]=R[8],$[W+14]=R[9],$[W+15]=R[10],c.instancesEvaluatedElevation[k]=b[2]}}}let Lw,Iw;Sn(Ov,"ModelBucket",{omit:["layers"]}),Sn(Cw,"PerModelAttributes"),Sn(Aw,"ModelFeature");const Bf=64,Hm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Rw(a,t,r,c,f,u,m,T,L,D=!1){const b=r.zoom,C=r.project(c),R=Ze(c.lat,b),A=1/R;Qe.mat4.identity(a),Qe.mat4.translate(a,a,[C.x+m[0]*A,C.y+m[1]*A,m[2]]);let I=1,k=1;const W=r.worldSize;if(D){if(r.projection.name==="mercator"){let X=0;r.elevation&&(X=r.elevation.getAtPointOrZero(new Lt(C.x/W,C.y/W),0));const le=Qe.vec4.transformMat4([],[C.x,C.y,X,1],r.projMatrix)[3]/r.cameraToCenterDistance;I=le,k=le*Ze(r.center.lat,b)}else if(r.projection.name==="globe"){const X=Dv(a,r),le=Qe.mat4.multiply([],r.projMatrix,X),he=[0,0,0,1];Qe.vec4.transformMat4(he,he,le);const Me=he[3]/r.cameraToCenterDistance,He=jc(b),ze=r.projection.pixelsPerMeter(c.lat,W)*Ze(c.lat,b),Be=r.projection.pixelsPerMeter(r.center.lat,W)*Ze(r.center.lat,b);I=Me/Pe(ze,Ke(r.center.lat),He),k=Me*R/ze,I*=Be,k*=Be}}else I=A;Qe.mat4.scale(a,a,[I,I,k]);const $=[...a],ee=t.orientation,te=[];if(Tw(te,[ee[0]+f[0],ee[1]+f[1],ee[2]+f[2]],u),Qe.mat4.multiply(a,$,te),T&&r.elevation){let X=0;const le=[];if(L&&r.elevation){X=function(He,ze,Be,yt,ke){const dt=ze.elevation;if(!dt)return 0;const Et=ls.projectAabbCorners(Be,yt),Ct=ge(1,ke.lat)*ze.worldSize,Bt=function(Kn,bn){const Cn=[0,0,1],fr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Sr of fr){const Cr=Kn[Sr.corners[0]],xr=Kn[Sr.corners[1]],Vr=Kn[Sr.corners[2]],Br=[xr[0]-Cr[0],xr[1]-Cr[1],bn*(xr[2]-Cr[2])],Bs=Qe.vec3.cross(Br,Br,[Vr[0]-Cr[0],Vr[1]-Cr[1],bn*(Vr[2]-Cr[2])]);Qe.vec3.normalize(Bs,Bs),Sr.dotProductWithUp=Qe.vec3.dot(Bs,Cn)}return fr.sort((Sr,Cr)=>Sr.dotProductWithUp-Cr.dotProductWithUp),fr[0].corners}(Et,Ct),ei=Et[Bt[0]],ni=Et[Bt[1]],Yt=Et[Bt[2]],yi=Et[Bt[3]],Fi=dt.getAtPointOrZero(new Lt(ei[0]/ze.worldSize,ei[1]/ze.worldSize),0),di=dt.getAtPointOrZero(new Lt(ni[0]/ze.worldSize,ni[1]/ze.worldSize),0),Tn=dt.getAtPointOrZero(new Lt(Yt[0]/ze.worldSize,Yt[1]/ze.worldSize),0),ln=dt.getAtPointOrZero(new Lt(yi[0]/ze.worldSize,yi[1]/ze.worldSize),0),$i=(Fi+ln)/2,Di=(di+Tn)/2;return $i>Di?di<Tn?Xy(He,ni,yi,ei,di,ln,Fi,Ct):Xy(He,Yt,ei,yi,Tn,Fi,ln,Ct):Fi<ln?Xy(He,ei,ni,Yt,Fi,di,Tn,Ct):Xy(He,yi,Yt,ni,ln,Tn,di,Ct),Math.max($i,Di)}(le,r,t.aabb,a,c);const he=Qe.mat4.fromQuat([],le),Me=Qe.mat4.multiply([],he,te);Qe.mat4.multiply(a,$,Me)}else X=r.elevation.getAtPointOrZero(new Lt(C.x/W,C.y/W),0);X!==0&&(a[14]+=X)}}function x_(a,t,r=!1){a.uploaded||(a.gfxTexture=new Iv(t,a.image,r?t.gl.R8:t.gl.RGBA8,{useMipmap:a.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function $A(a,t,r){a.indexBuffer=t.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=t.createVertexBuffer(a.vertexArray,UA.members,!1,!0),a.normalArray&&(a.normalBuffer=t.createVertexBuffer(a.normalArray,jA.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=t.createVertexBuffer(a.texcoordArray,HA.members,!1,!0)),a.colorArray&&(a.colorBuffer=t.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?VA:GA).members,!1,!0)),a.featureArray&&(a.pbrBuffer=t.createVertexBuffer(a.featureArray,qA.members,!0)),a.segments=Ks.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const c=a.material;c.pbrMetallicRoughness.baseColorTexture&&x_(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&x_(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&x_(c.normalTexture,t),c.occlusionTexture&&x_(c.occlusionTexture,t,r),c.emissionTexture&&x_(c.emissionTexture,t)}function zv(a,t,r){if(a.meshes)for(const c of a.meshes)$A(c,t,r);if(a.children)for(const c of a.children)zv(c,t,r)}function Ky(a){if(a.meshes)for(const t of a.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(a.children)for(const t of a.children)Ky(t)}function kv(a){if(a.meshes)for(const r of a.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(a.children)for(const r of a.children)kv(r)}class jm{constructor(t,r,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=c}static create(t,r,c){const f=c||t.findDEMTileFor(r);if(!f||!f.dem)return;const u=f.dem,m=f.tileID,T=1<<r.canonical.z-m.canonical.z;return new jm(f,u.dim/un/T,[(r.canonical.x/T-m.canonical.x)*u.dim,(r.canonical.y/T-m.canonical.y)*u.dim])}tileCoordToPixel(t,r){const c=r*this._scale+this._offset[1],f=Math.floor(t*this._scale+this._offset[0]),u=Math.floor(c);return new je(f,u)}getElevationAt(t,r,c,f){const u=t*this._scale+this._offset[0],m=r*this._scale+this._offset[1],T=Math.floor(u),L=Math.floor(m),D=this._dem;return f=!!f,c?Pe(Pe(D.get(T,L,f),D.get(T,L+1,f),m-L),Pe(D.get(T+1,L,f),D.get(T+1,L+1,f),m-L),u-T):D.get(T,L,f)}getElevationAtPixel(t,r,c){return this._dem.get(t,r,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ge(1,t)*this._dem.stride}}const Fv=new Float32Array(262144),Nf=new Uint8Array(262144);function Pw(a){let t=0;if(a.meshes)for(const r of a.meshes)t=Math.max(t,r.aabb.max[2]);if(a.children)for(const r of a.children)t=Math.max(t,Pw(r));return t}function Dw(a,t,r){if(a.meshes)for(const c of a.meshes){if(c.aabb.min[0]===1/0)continue;const f=ls.applyTransform(c.aabb,a.matrix);r.insert(t,f.min[0],f.min[1],f.max[0],f.max[1])}if(a.children)for(const c of a.children)Dw(c,t,r)}const Ow=["","wall","door","roof","window","lamp","logo"];class zw{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:Pw(t)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ls([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const r=new ls([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=ls.applyTransformFast(c.aabb,this.node.matrix),r.encapsulate(c.transformedAabb)),t++;this.aabb=r}return this.aabb}}class Jy{constructor(t,r,c,f,u,m,T){this.id=c,this.layers=t,this.layerIds=this.layers.map(L=>L.fqid),this.stateDependentLayerIds=this.layers.filter(L=>L.isStateDependent()).map(L=>L.id),this.modelTraits|=Hm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=Hm.HasMapboxMeshFeatures),u&&(this.modelTraits|=Hm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const L of r)this.nodesInfo.push(new zw(L)),Dw(L,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0)}updateFootprints(t,r){for(const c of this.getNodesInfo()){const f=c.node;f.footprint&&r.push({footprint:f.footprint,id:t})}}update(t){const r=Object.keys(t).length!==0;if(r&&!this.stateDependentLayers.length)return;const c=r?this.stateDependentLayers:this.layers;for(const f of c)this.evaluate(f,t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const c of r){const f=c.node;this.uploaded?this.updatePbrBuffer(f):zv(f,t,!0)}for(const c of r)Ky(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let r=!1;if(!t.meshes)return r;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),r=!0);return r}needsReEvaluation(t,r,c){const f=t.transform.projectionOptions,u=t.style.getBrightness(),m=this.brightness!==u;return!!(!this.uploaded||this.dirty||f.name!==this.projection.name||b_(c.paint.get("model-color").value,m)||b_(c.paint.get("model-color-mix-intensity").value,m)||b_(c.paint.get("model-roughness").value,m)||b_(c.paint.get("model-emissive-strength").value,m)||b_(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=f,this.brightness=u,!0)}evaluateScale(t,r){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),f=this.id.canonical;for(const u of c){const m=u.feature;u.evaluatedScale=r.paint.get("model-scale").evaluate(m,{},f)}}evaluate(t,r){const c=this.getNodesInfo();for(const f of c){if(!f.node.meshes)continue;const u=f.feature,m=r&&r[u.id],T=f.node.meshes&&f.node.meshes[0].featureData,L=f.evaluatedColor[2],D=f.evaluatedRMEA[2],b=this.id.canonical;if(f.hasTranslucentParts=!1,T){for(let C=0;C<Ow.length;C++){const R=Ow[C];R.length&&(u.properties.part=R);const A=t.paint.get("model-color").evaluate(u,m,b).toRenderColor(null),I=t.paint.get("model-color-mix-intensity").evaluate(u,m,b);f.evaluatedColor[C]=[A.r,A.g,A.b,I],f.evaluatedRMEA[C][0]=t.paint.get("model-roughness").evaluate(u,m,b),f.evaluatedRMEA[C][2]=t.paint.get("model-emissive-strength").evaluate(u,m,b),f.evaluatedRMEA[C][3]=A.a,f.emissionHeightBasedParams[C]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,m,b),!f.hasTranslucentParts&&A.a<1&&(f.hasTranslucentParts=!0)}delete u.properties.part,XA(f,L!==f.evaluatedColor[2]||D!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(u,m,b);f.evaluatedScale=t.paint.get("model-scale").evaluate(u,m,b),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,r,c,f){const u=t.findDEMTileFor(c);if(u&&(u.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const m=jm.create(t,c,u);if(!m)return;this.modelTraits&Hm.HasMapboxMeshFeatures&&this.updateDEM(t,m,c,f);for(const T of this.getNodesInfo()){const L=T.node;if(!L.footprint||!L.footprint.vertices||!L.footprint.vertices.length)continue;const D=L.footprint.vertices;let b=m.getElevationAt(D[0].x,D[0].y,!0,!0);for(let C=1;C<D.length;C++)b=Math.min(b,m.getElevationAt(D[C].x,D[C].y,!0,!0));L.elevation=b}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=r}}updateDEM(t,r,c,f){let u=r._dem._modifiedForSources[f];if(u===void 0&&(r._dem._modifiedForSources[f]=[],u=r._dem._modifiedForSources[f]),u.includes(c.canonical))return;const m=r._dem.dim;u.push(c.canonical);let T=!1;for(const L of this.getNodesInfo()){const D=L.node;if(!D.footprint||!D.footprint.grid)continue;const b=D.footprint.grid,C=r.tileCoordToPixel(b.min.x,b.min.y),R=r.tileCoordToPixel(b.max.x,b.max.y),A=Math.min(Math.min(m-R.y,C.x),Math.min(C.y,m-R.x));if(A<0)continue;const I=Mt(A,2,5);let k=Math.max(0,C.x-I),W=Math.max(0,C.y-I),$=Math.min(R.x+I,m-1),ee=Math.min(R.y+I,m-1);for(let he=W;he<=ee;++he)for(let Me=k;Me<=$;++Me)Nf[he*m+Me]=255;let te=0,X=0;for(let he=0;he<b.cellsY;++he)for(let Me=0;Me<b.cellsX;++Me){if(!b.cells[he*b.cellsX+Me])continue;const He=r.tileCoordToPixel(b.min.x+Me/b.xScale,b.min.y+he/b.yScale),ze=r.tileCoordToPixel(b.min.x+(Me+1)/b.xScale,b.min.y+(he+1)/b.yScale);for(let Be=He.y;Be<=Math.min(ze.y+1,m-1);++Be)for(let yt=He.x;yt<=Math.min(ze.x+1,m-1);++yt)Nf[Be*m+yt]===255&&(Nf[Be*m+yt]=0,te+=r.getElevationAtPixel(yt,Be),X++)}const le=te/X;k=Math.max(1,C.x-I),W=Math.max(1,C.y-I),$=Math.min(R.x+I,m-2),ee=Math.min(R.y+I,m-2),T=!0;for(let he=W;he<=ee;++he)for(let Me=k;Me<=$;++Me)Nf[he*m+Me]===0&&(Fv[he*m+Me]=r._dem.set(Me,he,le));for(let he=1;he<I;++he){k=Math.max(1,C.x-he),W=Math.max(1,C.y-he),$=Math.min(R.x+he,m-2),ee=Math.min(R.y+he,m-2);for(let Me=W;Me<=ee;++Me)for(let He=k;He<=$;++He){const ze=Me*m+He;if(Nf[ze]===255){let Be=0,yt=0,ke=-1,dt=-1;for(let Et=-1;Et<=1;++Et)for(let Ct=-1;Ct<=1;++Ct){const Bt=(Me+Et)*m+He+Ct;if(Nf[Bt]>=he)continue;const ei=Fv[Bt],ni=Math.abs(ei);ni>yt&&(Be=ei,yt=ni,ke=Ct,dt=Et)}if(yt>.1){const Et=1-(he+.5*Math.abs(ke*dt))/I;let Ct=r._dem.get(He,Me)+Be*Et;const Bt=r._dem.get(He+ke,Me+dt),ei=r._dem.get(He-ke,Me-dt,!0);(Ct-Bt)*(Ct-ei)>0&&(Ct=(Bt+ei)/2),Fv[ze]=r._dem.set(He,Me,Ct),Nf[ze]=he}}}}}T&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=tn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const r of t)Ky(r.node),kv(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(t.toUnwrapped()),f=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const m=f[u].node;f[u].hiddenByReplacement=!!m.footprint&&!c.find(T=>T.footprint===m.footprint)}}getHeightAtTileCoord(t,r){const c=this.getNodesInfo(),f=[],u=[0,0,0],m=Qe.mat4.identity([]);for(let T=0;T<this.nodesInfo.length;T++){const L=c[T],D=L.node.meshes[0],b=D.transformedAabb;if(t<b.min[0]||r<b.min[1]||t>b.max[0]||r>b.max[1])continue;if(L.node.hidden===!0)return{height:1/0,maxHeight:L.feature.properties.height,hidden:!1,verticalScale:L.evaluatedScale[2]};Qe.mat4.invert(m,L.node.matrix),u[0]=t,u[1]=r,Qe.vec3.transformMat4(u,u,m);const C=(u[0]-D.aabb.min[0])/(D.aabb.max[0]-D.aabb.min[0])*Bf|0,R=Math.min(63,(u[1]-D.aabb.min[1])/(D.aabb.max[1]-D.aabb.min[1])*Bf|0)*Bf+Math.min(63,C),A=D.heightmap[R];if(!(A<0&&L.node.footprint))return L.hiddenByReplacement?void 0:{height:A,maxHeight:L.feature.properties.height,hidden:!1,verticalScale:L.evaluatedScale[2]};if(L.node.footprint.grid.query(new je(t,r),new je(t,r),f),f.length>0)return{height:void 0,maxHeight:L.feature.properties.height,hidden:L.hiddenByReplacement,verticalScale:L.evaluatedScale[2]}}}}function b_(a,t){return!a.isLightConstant&&t}function ZA(a,t,r,c,f,u,m,T){let L=(61440&t|(61440&t)>>4)>>8,D=(3840&t|(3840&t)>>4)>>4,b=240&t|(240&t)>>4;r[3]>0&&(L=Pe(L,255*r[0],r[3]),D=Pe(D,255*r[1],r[3]),b=Pe(b,255*r[2],r[3]));const C=L<<8|D,R=b<<8|Math.floor(255*c[3]),A=function(he){const Me=Mt(he,0,2);return Math.min(Math.round(.5*Me*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],I=Mt(f[0],0,1),k=Mt(f[1],0,1),W=Mt(f[2],0,1),$=Mt(f[3],0,1);let ee,te,X,le;if(I!==k&&m!==u&&k!==I){const he=m-u;te=1/(he*(k-I)),X=-(u+he*I)/(he*(k-I));const Me=Mt(f[4],-1,1);le=Math.pow(10,Me),ee=255*W<<8|255*$}else ee=65535,te=0,X=1,le=1;if(a.emplaceBack(C,R,A,ee,te,X,le),T){const he=T.length;T.clear();for(let Me=0;Me<he;Me++)T.emplaceBack(C,R,A,ee,te,X,le)}}function XA(a,t,r){const c=a.node;let f=0;const u=r&Hm.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===f||!m.featureData)continue;m.featureArray=new bu,m.featureArray.reserve(m.featureData.length);let T=t;for(const L of m.featureData){const D=u?65535&L:L>>16&65535,b=u?L>>16&65535:65535&L,C=(15&b)<8?15&b:0,R=a.evaluatedRMEA[C],A=a.evaluatedColor[C],I=a.emissionHeightBasedParams[C];let k;if(T&&C===2&&c.lights&&(k=new bu,k.resize(10*c.lights.length)),ZA(m.featureArray,D,A,R,I,m.aabb.min[2],m.aabb.max[2],k),k&&T){T=!1;const W=c.meshes[c.lightMeshIndex];W.featureArray=k,W.featureArray._trim()}}m.featureArray._trim(),f++}}Sn(Jy,"Tiled3dModelBucket",{omit:["layers"]}),Sn(zw,"Tiled3dModelFeature");const YA=["id","tile","layer","source","sourceLayer","state"];class w_{constructor(t,r,c,f,u){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=c,this._y=f,this.properties=t.properties,this.id=u}clone(){const t=new w_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state={...this.state}),this.layer&&(t.layer={...this.layer}),this.namespace&&(t.namespace=this.namespace),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of YA)this[r]!==void 0&&(t[r]=this[r]);return t}}function kw(a,t,r,c){const f=1<<a.z;t.lat=Ne((c/un+a.y)/f),t.lng=Oe((r/un+a.x)/f)}const KA={circle:class extends $o{constructor(a,t,r,c){super(a,{layout:Er||(Er=new Ts({"circle-sort-key":new yn(Jt.layout_circle["circle-sort-key"]),visibility:new qi(Jt.layout_circle.visibility)})),paint:ts||(ts=new Ts({"circle-radius":new yn(Jt.paint_circle["circle-radius"]),"circle-color":new yn(Jt.paint_circle["circle-color"]),"circle-blur":new yn(Jt.paint_circle["circle-blur"]),"circle-opacity":new yn(Jt.paint_circle["circle-opacity"]),"circle-translate":new qi(Jt.paint_circle["circle-translate"]),"circle-translate-anchor":new qi(Jt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qi(Jt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qi(Jt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(Jt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(Jt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(Jt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new qi(Jt.paint_circle["circle-emissive-strength"])}))},t,r,c)}createBucket(a){return new Ci(a)}queryRadius(a){const t=a;return Ss("circle-radius",this,t)+Ss("circle-stroke-width",this,t)+br(this.paint.get("circle-translate"))}queryIntersectsFeature(a,t,r,c,f,u,m,T){const L=ps(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,a.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return gh(a,c,u,m,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",L,D)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,t,r){const c=$g(this);return{config:new sc(this,{zoom:t,lut:r}),defines:c,overrideFog:!1}}},heatmap:class extends $o{createBucket(a){return new _h(a)}constructor(a,t,r,c){super(a,{layout:Xg||(Xg=new Ts({visibility:new qi(Jt.layout_heatmap.visibility)})),paint:py||(py=new Ts({"heatmap-radius":new yn(Jt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(Jt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qi(Jt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pu(Jt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qi(Jt.paint_heatmap["heatmap-opacity"])}))},t,r,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=If({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Ss("heatmap-radius",this,a)}queryIntersectsFeature(a,t,r,c,f,u,m,T){const L=this.paint.get("heatmap-radius").evaluate(t,r);return gh(a,c,u,m,T,!0,!0,new je(0,0),L)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,t,r){return a==="heatmap"?{config:new sc(this,{zoom:t,lut:r}),overrideFog:!1}:{}}},hillshade:class extends $o{constructor(a,t,r,c){super(a,{layout:yh||(yh=new Ts({visibility:new qi(Jt.layout_hillshade.visibility)})),paint:Yg||(Yg=new Ts({"hillshade-illumination-direction":new qi(Jt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qi(Jt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qi(Jt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qi(Jt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qi(Jt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qi(Jt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new qi(Jt.paint_hillshade["hillshade-emissive-strength"])}))},t,r,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,t,r){return{overrideFog:!1}}},fill:class extends $o{constructor(a,t,r,c){super(a,{layout:zf||(zf=new Ts({"fill-sort-key":new yn(Jt.layout_fill["fill-sort-key"]),visibility:new qi(Jt.layout_fill.visibility),"fill-elevation-reference":new qi(Jt.layout_fill["fill-elevation-reference"])})),paint:Po||(Po=new Ts({"fill-antialias":new qi(Jt.paint_fill["fill-antialias"]),"fill-opacity":new yn(Jt.paint_fill["fill-opacity"]),"fill-color":new yn(Jt.paint_fill["fill-color"]),"fill-outline-color":new yn(Jt.paint_fill["fill-outline-color"]),"fill-translate":new qi(Jt.paint_fill["fill-translate"]),"fill-translate-anchor":new qi(Jt.paint_fill["fill-translate-anchor"]),"fill-pattern":new yn(Jt.paint_fill["fill-pattern"]),"fill-emissive-strength":new qi(Jt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new yn(Jt.paint_fill["fill-z-offset"])}))},t,r,c)}getProgramIds(){const a=this.paint.get("fill-pattern"),t=a&&a.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(a,t,r){return{config:new sc(this,{zoom:t,lut:r}),overrideFog:!1}}recalculate(a,t){super.recalculate(a,t);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new km(a)}queryRadius(){return br(this.paint.get("fill-translate"))}queryIntersectsFeature(a,t,r,c,f,u){return!a.queryGeometry.isAboveHorizon&&zn(ds(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,a.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends $o{constructor(a,t,r,c){super(a,{layout:xh||(xh=new Ts({visibility:new qi(Jt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new qi(Jt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Sl||(Sl=new Ts({"fill-extrusion-opacity":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yn(Jt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yn(Jt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yn(Jt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yn(Jt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new yn(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new yn(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new yn(Jt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new yn(Jt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new qi(Jt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},t,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new or(a)}queryRadius(){return br(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,t,r,c,f,u,m,T,L){const D=ps(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,a.pixelToTileUnitsFactor),b=this.paint.get("fill-extrusion-height").evaluate(t,r),C=this.paint.get("fill-extrusion-base").evaluate(t,r),R=[0,0],A=T&&u.elevation,I=u.elevation?u.elevation.exaggeration():1,k=a.tile.getBucket(this);if(A&&k instanceof or){const X=k.centroidVertexArray,le=L+1;le<X.length&&(R[0]=X.geta_centroid_pos0(le),R[1]=X.geta_centroid_pos1(le))}if(R[0]===0&&R[1]===1)return!1;u.projection.name==="globe"&&(c=vh([c],[new je(0,0),new je(un,un)],a.tileID.canonical).map(X=>X.polygon).flat());const W=A?T:null,[$,ee]=function(X,le,he,Me,He,ze,Be,yt,ke,dt,Et){return X.projection.name==="globe"?function(Ct,Bt,ei,ni,Yt,yi,Fi,di,Tn,ln,$i){const Di=[],Kn=[],bn=Ct.projection.upVectorScale($i,Ct.center.lat,Ct.worldSize).metersToTile,Cn=[0,0,0,1],fr=[0,0,0,1],Sr=(xr,Vr,Br,Bs)=>{xr[0]=Vr,xr[1]=Br,xr[2]=Bs,xr[3]=1},Cr=rl();ei>0&&(ei+=Cr),ni+=Cr;for(const xr of Bt){const Vr=[],Br=[];for(const Bs of xr){const Rs=Bs.x+Yt.x,lr=Bs.y+Yt.y,fs=Ct.projection.projectTilePoint(Rs,lr,$i),xs=Ct.projection.upVector($i,Bs.x,Bs.y);let Js=ei,vo=ni;if(Fi){const Oo=r_(Rs,lr,ei,ni,Fi,di,Tn,ln);Js+=Oo.base,vo+=Oo.top}ei!==0?Sr(Cn,fs.x+xs[0]*bn*Js,fs.y+xs[1]*bn*Js,fs.z+xs[2]*bn*Js):Sr(Cn,fs.x,fs.y,fs.z),Sr(fr,fs.x+xs[0]*bn*vo,fs.y+xs[1]*bn*vo,fs.z+xs[2]*bn*vo),Qe.vec3.transformMat4(Cn,Cn,yi),Qe.vec3.transformMat4(fr,fr,yi),Vr.push(new de(Cn[0],Cn[1],Cn[2])),Br.push(new de(fr[0],fr[1],fr[2]))}Di.push(Vr),Kn.push(Br)}return[Di,Kn]}(X,le,he,Me,He,ze,Be,yt,ke,dt,Et):Be?function(Ct,Bt,ei,ni,Yt,yi,Fi,di,Tn){const ln=[],$i=[],Di=[0,0,0,1];for(const Kn of Ct){const bn=[],Cn=[];for(const fr of Kn){const Sr=fr.x+ni.x,Cr=fr.y+ni.y,xr=r_(Sr,Cr,Bt,ei,yi,Fi,di,Tn);Di[0]=Sr,Di[1]=Cr,Di[2]=xr.base,Di[3]=1,Qe.vec4.transformMat4(Di,Di,Yt),Di[3]=Math.max(Di[3],1e-5);const Vr=new de(Di[0]/Di[3],Di[1]/Di[3],Di[2]/Di[3]);Di[0]=Sr,Di[1]=Cr,Di[2]=xr.top,Di[3]=1,Qe.vec4.transformMat4(Di,Di,Yt),Di[3]=Math.max(Di[3],1e-5);const Br=new de(Di[0]/Di[3],Di[1]/Di[3],Di[2]/Di[3]);bn.push(Vr),Cn.push(Br)}ln.push(bn),$i.push(Cn)}return[ln,$i]}(le,he,Me,He,ze,Be,yt,ke,dt):function(Ct,Bt,ei,ni,Yt){const yi=[],Fi=[],di=Yt[8]*Bt,Tn=Yt[9]*Bt,ln=Yt[10]*Bt,$i=Yt[11]*Bt,Di=Yt[8]*ei,Kn=Yt[9]*ei,bn=Yt[10]*ei,Cn=Yt[11]*ei;for(const fr of Ct){const Sr=[],Cr=[];for(const xr of fr){const Vr=xr.x+ni.x,Br=xr.y+ni.y,Bs=Yt[0]*Vr+Yt[4]*Br+Yt[12],Rs=Yt[1]*Vr+Yt[5]*Br+Yt[13],lr=Yt[2]*Vr+Yt[6]*Br+Yt[14],fs=Yt[3]*Vr+Yt[7]*Br+Yt[15],xs=Bs+di,Js=Rs+Tn,vo=lr+ln,Oo=Math.max(fs+$i,1e-5),xo=Bs+Di,co=Rs+Kn,Eo=lr+bn,Fo=Math.max(fs+Cn,1e-5);Sr.push(new de(xs/Oo,Js/Oo,vo/Oo)),Cr.push(new de(xo/Fo,co/Fo,Eo/Fo))}yi.push(Sr),Fi.push(Cr)}return[yi,Fi]}(le,he,Me,He,ze)}(u,c,C,b,D,m,W,R,I,u.center.lat,a.tileID.canonical),te=a.queryGeometry;return function(X,le,he){let Me=1/0;zn(he,le)&&(Me=Bn(he,le[0]));for(let He=0;He<le.length;He++){const ze=le[He],Be=X[He];for(let yt=0;yt<ze.length-1;yt++){const ke=ze[yt],dt=[ke,ze[yt+1],Be[yt+1],Be[yt],ke];mi(he,dt)&&(Me=Math.min(Me,Bn(he,dt)))}}return Me!==1/0&&Me}($,ee,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends $o{constructor(a,t,r,c){const f=Mr();super(a,f,t,r,c),f.layout&&(this.layout=new th(f.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Gh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,t){super.recalculate(a,t),this.paint._values["line-floorwidth"]=(()=>{if(cs)return cs;const r=Mr();return cs=new rs(r.paint.properties["line-width"].specification),cs.useIntegerZoom=!0,cs})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new gp(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,t,r){const c=sn(this);return{config:new sc(this,{zoom:t,lut:r}),defines:c,overrideFog:!1}}queryRadius(a){const t=a,r=so(Ss("line-width",this,t),Ss("line-gap-width",this,t)),c=Ss("line-offset",this,t);return r/2+Math.abs(c)+br(this.paint.get("line-translate"))}queryIntersectsFeature(a,t,r,c,f,u){if(a.queryGeometry.isAboveHorizon)return!1;const m=ds(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,a.pixelToTileUnitsFactor),T=a.pixelToTileUnitsFactor/2*so(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),L=this.paint.get("line-offset").evaluate(t,r);return L&&(c=function(D,b){const C=[],R=new je(0,0);for(let A=0;A<D.length;A++){const I=D[A],k=[];for(let W=0;W<I.length;W++){const $=I[W],ee=I[W+1],te=W===0?R:$.sub(I[W-1])._unit()._perp(),X=W===I.length-1?R:ee.sub($)._unit()._perp(),le=te._add(X)._unit();le._mult(1/(le.x*X.x+le.y*X.y)),k.push(le._mult(b)._add($))}C.push(k)}return C}(c,L*a.pixelToTileUnitsFactor)),function(D,b,C){for(let R=0;R<b.length;R++){const A=b[R];if(D.length>=3){for(let I=0;I<A.length;I++)if(Nr(D,A[I]))return!0}if($n(D,A,C))return!0}return!1}(m,c,T)}isTileClipped(){return!0}isDraped(a){const t=this.layout.get("line-z-offset"),r=t.isConstant()&&!t.constantOr(0),c=this.layout.get("line-elevation-reference");return!(c==="sea"||c==="ground")&&(r||c!=="none")}},symbol:jy,background:class extends $o{constructor(a,t,r,c){super(a,{layout:aw||(aw=new Ts({visibility:new qi(Jt.layout_background.visibility)})),paint:lw||(lw=new Ts({"background-pitch-alignment":new qi(Jt.paint_background["background-pitch-alignment"]),"background-color":new qi(Jt.paint_background["background-color"]),"background-pattern":new qi(Jt.paint_background["background-pattern"]),"background-opacity":new qi(Jt.paint_background["background-opacity"]),"background-emissive-strength":new qi(Jt.paint_background["background-emissive-strength"])}))},t,r,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,t,r){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:pw,"raster-particle":vw,sky:class extends $o{constructor(a,t,r,c){super(a,{layout:gw||(gw=new Ts({visibility:new qi(Jt.layout_sky.visibility)})),paint:_w||(_w=new Ts({"sky-type":new qi(Jt.paint_sky["sky-type"]),"sky-atmosphere-sun":new qi(Jt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new qi(Jt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new qi(Jt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new qi(Jt.paint_sky["sky-gradient-radius"]),"sky-gradient":new pu(Jt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new qi(Jt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new qi(Jt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new qi(Jt.paint_sky["sky-opacity"])}))},t,r,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=If({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(a,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),f=!c,u=a.style.light,m=u.properties.get("position");return f&&u.properties.get("anchor")==="viewport"&&Wn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Rv(m.azimuthal,90-m.polar,t):Rv(c[0],90-c[1],t)}const r=this.paint.get("sky-gradient-center");return Rv(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends $o{constructor(a,t,r,c){super(a,{paint:yw||(yw=new Ts({}))},t,null)}},model:class extends $o{constructor(a,t,r,c){super(a,{layout:Lw||(Lw=new Ts({visibility:new qi(Jt.layout_model.visibility),"model-id":new yn(Jt.layout_model["model-id"])})),paint:Iw||(Iw=new Ts({"model-opacity":new qi(Jt.paint_model["model-opacity"]),"model-rotation":new yn(Jt.paint_model["model-rotation"]),"model-scale":new yn(Jt.paint_model["model-scale"]),"model-translation":new yn(Jt.paint_model["model-translation"]),"model-color":new yn(Jt.paint_model["model-color"]),"model-color-mix-intensity":new yn(Jt.paint_model["model-color-mix-intensity"]),"model-type":new qi(Jt.paint_model["model-type"]),"model-cast-shadows":new qi(Jt.paint_model["model-cast-shadows"]),"model-receive-shadows":new qi(Jt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new qi(Jt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new yn(Jt.paint_model["model-emissive-strength"]),"model-roughness":new yn(Jt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new yn(Jt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new qi(Jt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new qi(Jt.paint_model["model-front-cutoff"])}))},t,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Ov(a)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof Jy?un-1:0}queryIntersectsFeature(a,t,r,c,f,u){if(!this.modelManager)return!1;const m=this.modelManager,T=a.tile.getBucket(this);if(!(T&&T instanceof Ov))return!1;const L=T;for(const D in L.instancesPerModel){const b=L.instancesPerModel[D],C=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(b.idToFeaturesIndex.hasOwnProperty(C)){const R=b.features[b.idToFeaturesIndex[C]],A=m.getModel(D,this.scope);if(!A)return!1;let I=Qe.mat4.create();const k=new H(0,0),W=L.canonical;let $=Number.MAX_VALUE;for(let ee=0;ee<R.instancedDataCount;++ee){const te=16*(R.instancedDataOffset+ee),X=b.instancedDataArray.float32,le=[X[te+4],X[te+5],X[te+6]];kw(W,k,X[te],0|X[te+1]),Rw(I,A,u,k,R.rotation,R.scale,le,!1,!1,!1),u.projection.name==="globe"&&(I=Dv(I,u));const he=Qe.mat4.multiply([],u.projMatrix,I),Me=a.queryGeometry,He=Mw(Me.isPointQuery()?Me.screenBounds:Me.screenGeometry,u,he,A.aabb);He!=null&&($=Math.min(He,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(a,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const t=this._transitionablePaint._values[a];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof el}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(a,t,r,c){const f=a.tile,u=f.getBucket(this);let m=null,T=Number.MAX_VALUE;if(!(u&&u instanceof Jy))return{queryFeature:m,intersectionZ:T};const L=u.getNodesInfo()[t];if(L.hiddenByReplacement||!L.node.meshes||!r.filter(new Qs(f.tileID.overscaledZ),L.feature,f.tileID.canonical))return{queryFeature:m,intersectionZ:T};const D=L.node,b=c.calculatePosMatrix(f.tileID.toUnwrapped(),c.worldSize),C=L.evaluatedScale;let R=0;c.elevation&&D.elevation&&(R=D.elevation*c.elevation.exaggeration()),Qe.mat4.translate(b,b,[(D.anchor?D.anchor[0]:0)*(C[0]-1),(D.anchor?D.anchor[1]:0)*(C[1]-1),R]),Qe.mat4.scale(b,b,C);const A=a.queryGeometry,I=A.isPointQuery()?A.screenBounds:A.screenGeometry,k=function(X){const le=Qe.mat4.multiply([],b,X.matrix);Qe.mat4.multiply(le,c.expandedFarZProjMatrix,le);for(let he=0;he<X.meshes.length;++he){const Me=X.meshes[he];if(he===X.lightMeshIndex)continue;const He=Mw(I,c,le,Me.aabb);He!=null&&(T=Math.min(He,T))}if(X.children)for(const he of X.children)k(he)};if(k(D),T===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:T};const W=new H(0,0);kw(f.tileID.canonical,W,L.node.anchor[0],L.node.anchor[1]);const{z:$,x:ee,y:te}=f.tileID.canonical;return m=new w_({},$,ee,te,L.feature.id),m.properties=L.feature.properties,m.geometry={type:"Point",coordinates:[W.lng,W.lat]},m.layer={...this.serialize(),id:this.fqid},m.state={},m.tile=f.tileID.canonical,{queryFeature:m,intersectionZ:T}}},clip:class extends $o{constructor(a,t,r,c){super(a,{layout:zo||(zo=new Ts({"clip-layer-types":new qi(Jt.layout_clip["clip-layer-types"]),"clip-layer-scope":new qi(Jt.layout_clip["clip-layer-scope"])})),paint:kf||(kf=new Ts({}))},t,r,c)}recalculate(a,t){super.recalculate(a,t)}createBucket(a){return new Ff(a)}isTileClipped(){return!0}is3D(){return!0}}};class JA{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class QA{constructor(){this.tasks={},this.taskQueue=[],jn(["process"],this),this.invoker=new JA(this.process),this.nextId=0}add(t,r){const c=this.nextId++,f=function({type:u,isSymbolTile:m,zoom:T}){return T=T||0,u==="message"?0:u!=="maybePrepare"||m?u!=="parseTile"||m?u==="parseTile"&&m?300-T:u==="maybePrepare"&&m?400-T:500:200-T:100-T}(r);if(f===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:r,priority:f,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let f=0;f<this.taskQueue.length;f++){const u=this.tasks[this.taskQueue[f]];u.priority<r&&(r=u.priority,t=f)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class Fw{constructor(t,r,c){this.target=t,this.parent=r,this.mapId=c,this.callbacks={},this.cancelCallbacks={},jn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new QA}send(t,r,c,f,u=!1,m){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[T]=c);const L=new Set;return this.target.postMessage({id:T,type:t,hasCallback:!!c,targetMapId:f,mustQueue:u,sourceMapId:this.mapId,data:Ql(r,L)},L),{cancel:()=>{c&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(t){const r=t.data,c=r.id;if(c&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const f=this.cancelCallbacks[c];delete this.cancelCallbacks[c],f&&f.cancel()}else if(r.mustQueue||_s()){const f=this.callbacks[c],u=this.scheduler.add(()=>this.processTask(c,r),f&&f.metadata||{type:"message"});u&&(this.cancelCallbacks[c]=u)}else this.processTask(c,r)}processTask(t,r){if(delete this.cancelCallbacks[t],r.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(r.error?c(Ia(r.error)):c(null,Ia(r.data)))}else{const c=new Set,f=r.hasCallback?(m,T)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:m?Ql(m):null,data:Ql(T,c)},c)}:()=>{},u=Ia(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,u,f);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],u.source,u.scope)[m[1]](u,f)}else f(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Wm{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Fn();const c=this.workerPool.acquire(this.id);for(let f=0;f<c.length;f++){const u=new Wm.Actor(c[f],r,this.id);u.name=`Worker ${f}`,this.actors.push(u)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,r,c){an(this.actors,(f,u)=>{f.send(t,r,u)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}Wm.Actor=Fw;class Bw{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const c=this.toIdx(t,r);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function Nw(a,t,r,c){let f=0,u=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(r[m]<a[m]||r[m]>t[m])return null}else{const T=1/c[m];let L=(a[m]-r[m])*T,D=(t[m]-r[m])*T;if(L>D){const b=L;L=D,D=b}if(L>f&&(f=L),D<u&&(u=D),f>u)return null}return f}function Uw(a,t,r,c,f,u,m,T,L,D,b){const C=c-a,R=f-t,A=u-r,I=m-a,k=T-t,W=L-r,$=b[1]*W-b[2]*k,ee=b[2]*I-b[0]*W,te=b[0]*k-b[1]*I,X=C*$+R*ee+A*te;if(Math.abs(X)<1e-15)return null;const le=1/X,he=D[0]-a,Me=D[1]-t,He=D[2]-r,ze=(he*$+Me*ee+He*te)*le;if(ze<0||ze>1)return null;const Be=Me*A-He*R,yt=He*C-he*A,ke=he*R-Me*C,dt=(b[0]*Be+b[1]*yt+b[2]*ke)*le;return dt<0||ze+dt>1?null:(I*Be+k*yt+W*ke)*le}function Vw(a,t,r){return(a-t)/(r-t)}function Gw(a,t,r,c,f,u,m,T,L){const D=1<<r,b=u-c,C=m-f,R=(a+1)/D*b+c,A=(t+0)/D*C+f,I=(t+1)/D*C+f;T[0]=(a+0)/D*b+c,T[1]=A,L[0]=R,L[1]=I}class Hw{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(u){const m=Math.ceil(Math.log2(u.dim/8)),T=[];let L=Math.ceil(Math.pow(2,m));const D=1/L,b=(A,I,k,W,$)=>{const ee=W?1:0,te=(A+1)*k-ee,X=I*k,le=(I+1)*k-ee;$[0]=A*k,$[1]=X,$[2]=te,$[3]=le};let C=new Bw(L);const R=[];for(let A=0;A<L*L;A++){b(A%L,Math.floor(A/L),D,!1,R);const I=bp(R[0],R[1],u),k=bp(R[2],R[1],u),W=bp(R[2],R[3],u),$=bp(R[0],R[3],u);C.minimums.push(Math.min(I,k,W,$)),C.maximums.push(Math.max(I,k,W,$)),C.leaves.push(1)}for(T.push(C),L/=2;L>=1;L/=2){const A=T[T.length-1];C=new Bw(L);for(let I=0;I<L*L;I++){b(I%L,Math.floor(I/L),2,!0,R);const k=A.getElevation(R[0],R[1]),W=A.getElevation(R[2],R[1]),$=A.getElevation(R[2],R[3]),ee=A.getElevation(R[0],R[3]),te=A.isLeaf(R[0],R[1]),X=A.isLeaf(R[2],R[1]),le=A.isLeaf(R[2],R[3]),he=A.isLeaf(R[0],R[3]),Me=Math.min(k.min,W.min,$.min,ee.min),He=Math.max(k.max,W.max,$.max,ee.max),ze=te&&X&&le&&he;C.maximums.push(He),C.minimums.push(Me),C.leaves.push(He-Me<=5&&ze?1:0)}T.push(C)}return T}(this.dem),c=r.length-1,f=r[c];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(r,0,0,c,0)}raycastRoot(t,r,c,f,u,m,T=1){return Nw([t,r,-100],[c,f,this.maximums[0]*T],u,m)}raycast(t,r,c,f,u,m,T=1){if(!this.nodeCount)return null;const L=this.raycastRoot(t,r,c,f,u,m,T);if(L==null)return null;const D=[],b=[],C=[],R=[],A=[{idx:0,t:L,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:I,t:k,nodex:W,nodey:$,depth:ee}=A.pop();if(this.leaves[I]){Gw(W,$,ee,t,r,c,f,C,R);const X=1<<ee,le=(W+0)/X,he=(W+1)/X,Me=($+0)/X,He=($+1)/X,ze=bp(le,Me,this.dem)*T,Be=bp(he,Me,this.dem)*T,yt=bp(he,He,this.dem)*T,ke=bp(le,He,this.dem)*T,dt=Uw(C[0],C[1],ze,R[0],C[1],Be,R[0],R[1],yt,u,m),Et=Uw(R[0],R[1],yt,C[0],R[1],ke,C[0],C[1],ze,u,m),Ct=Math.min(dt!==null?dt:Number.MAX_VALUE,Et!==null?Et:Number.MAX_VALUE);if(Ct!==Number.MAX_VALUE)return Ct;{const Bt=Qe.vec3.scaleAndAdd([],u,m,k);if(jw(ze,Be,ke,yt,Vw(Bt[0],C[0],R[0]),Vw(Bt[1],C[1],R[1]))>=Bt[2])return k}continue}let te=0;for(let X=0;X<this._siblingOffset.length;X++){Gw((W<<1)+this._siblingOffset[X][0],($<<1)+this._siblingOffset[X][1],ee+1,t,r,c,f,C,R),C[2]=-100,R[2]=this.maximums[this.childOffsets[I]+X]*T;const le=Nw(C,R,u,m);if(le!=null){const he=le;D[X]=he;let Me=!1;for(let He=0;He<te&&!Me;He++)he>=D[b[He]]&&(b.splice(He,0,X),Me=!0);Me||(b[te]=X),te++}}for(let X=0;X<te;X++){const le=b[X];A.push({idx:this.childOffsets[I]+le,t:D[le],nodex:(W<<1)+this._siblingOffset[le][0],nodey:($<<1)+this._siblingOffset[le][1],depth:ee+1})}}return null}_addNode(t,r,c){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,c,f,u){if(t[f].isLeaf(r,c)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const m=f-1,T=t[m];let L=0,D=0;for(let b=0;b<this._siblingOffset.length;b++){const C=2*r+this._siblingOffset[b][0],R=2*c+this._siblingOffset[b][1],A=T.getElevation(C,R),I=T.isLeaf(C,R),k=this._addNode(A.min,A.max,I);I&&(L|=1<<b),D||(D=k)}for(let b=0;b<this._siblingOffset.length;b++)L&1<<b||this._construct(t,2*r+this._siblingOffset[b][0],2*c+this._siblingOffset[b][1],m,D+b)}}function jw(a,t,r,c,f,u){return Pe(Pe(a,r,u),Pe(t,c,u),f)}function bp(a,t,r){const c=r.dim,f=Mt(a*c-.5,0,c-1),u=Mt(t*c-.5,0,c-1),m=Math.floor(f),T=Math.floor(u),L=Math.min(m+1,c-1),D=Math.min(T+1,c-1);return jw(r.get(m,T),r.get(L,T),r.get(m,D),r.get(L,D),f-m,u-T)}const e3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function t3(a,t,r){return(256*a*256+256*t+r)/10-1e4}function i3(a,t,r){return 256*a+t+r/256-32768}class Qy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,c,f=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void Wn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const u=this.dim=r.height-2,m=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let L=0;L<u;L++)m[this._idx(-1,L)]=m[this._idx(0,L)],m[this._idx(u,L)]=m[this._idx(u-1,L)],m[this._idx(L,-1)]=m[this._idx(L,0)],m[this._idx(L,u)]=m[this._idx(L,u-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(u,-1)]=m[this._idx(u-1,0)],m[this._idx(-1,u)]=m[this._idx(0,u-1)],m[this._idx(u,u)]=m[this._idx(u-1,u-1)]}const T=c==="terrarium"?i3:t3;for(let L=0;L<m.length;++L){const D=4*L;this.floatView[L]=T(this.pixels[D],this.pixels[D+1],this.pixels[D+2])}this._timestamp=tn.now()}_buildQuadTree(){this._tree=new Hw(this)}get(t,r,c=!1){c&&(t=Mt(t,-1,this.dim),r=Mt(r,-1,this.dim));const f=this._idx(t,r);return this.floatView[f]}set(t,r,c){const f=this._idx(t,r),u=this.floatView[f];return this.floatView[f]=c,c-u}static getUnpackVector(t){return e3[t]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}static pack(t,r){const c=[0,0,0,0],f=Qy.getUnpackVector(r);let u=Math.floor((t+f[3])/f[2]);return c[2]=u%256,u=Math.floor(u/256),c[1]=u%256,u=Math.floor(u/256),c[0]=u,c}getPixels(){return new my({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=r*this.dim,u=r*this.dim+this.dim,m=c*this.dim,T=c*this.dim+this.dim;switch(r){case-1:f=u-1;break;case 1:u=f+1}switch(c){case-1:m=T-1;break;case 1:T=m+1}const L=-r*this.dim,D=-c*this.dim;for(let b=m;b<T;b++)for(let C=f;C<u;C++){const R=4*this._idx(C,b),A=4*this._idx(C+L,b+D);this.pixels[R+0]=t.pixels[A+0],this.pixels[R+1]=t.pixels[A+1],this.pixels[R+2]=t.pixels[A+2],this.pixels[R+3]=t.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function n3(a,t,r){a===1?t.headerLength=r.readFixed32():a===2?t.x=r.readVarint():a===3?t.y=r.readVarint():a===4?t.z=r.readVarint():a===5&&t.layers.push(function(c,f){return c.readFields(l3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(r,r.readVarint()+r.pos))}function r3(a,t,r){a===1?(t.delta_filter=function(c,f){return c.readFields(s3,{blockSize:0},f)}(r,r.readVarint()+r.pos),t.filter="delta_filter"):a===2?(r.readVarint(),t.filter="zigzag_filter"):a===3?(r.readVarint(),t.filter="bitshuffle_filter"):a===4&&(r.readVarint(),t.filter="byteshuffle_filter")}function s3(a,t,r){a===1&&(t.blockSize=r.readVarint())}function o3(a,t,r){a===1?(r.readVarint(),t.codec="gzip_data"):a===2?(r.readVarint(),t.codec="jpeg_image"):a===3?(r.readVarint(),t.codec="webp_image"):a===4&&(r.readVarint(),t.codec="png_image")}function a3(a,t,r){let c=0,f=0;a===1?t.firstByte=r.readFixed64():a===2?t.lastByte=r.readFixed64():a===3?t.filters.push(function(u,m){return u.readFields(r3,{},m)}(r,r.readVarint()+r.pos)):a===4?t.codec=function(u,m){return u.readFields(o3,{},m)}(r,r.readVarint()+r.pos):a===5?f=r.readFloat():a===6?c=r.readFloat():a===7?t.bands.push(r.readString()):a===8?t.offset=r.readDouble():a===9&&(t.scale=r.readDouble()),t.offset===0&&(t.offset=f),t.scale===0&&(t.scale=c)}function l3(a,t,r){a===1?t.version=r.readVarint():a===2?t.name=r.readString():a===3?t.units=r.readString():a===4?t.tileSize=r.readVarint():a===5?t.buffer=r.readVarint():a===6?t.pixelFormat=r.readVarint():a===7&&t.dataIndex.push(function(c,f){return c.readFields(a3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(r,r.readVarint()+r.pos))}function c3(a,t,r){if(a===2)(function(c,f,u){c.readFields(u3,u,f)})(r,r.readVarint()+r.pos,t);else if(a===3)throw new Error("Not implemented")}function u3(a,t,r){if(a===1){let c=0;const f=r.readVarint()+r.pos;for(;r.pos<f;)t[c++]=r.readVarint()}}Sn(Qy,"DEMData"),Sn(Hw,"DemMinMaxQuadTree",{omit:["dem"]});class h3{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const r=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,r),r}put(t,r){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,r)}}function d3(a,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let r=t[3];for(let c=2;c>=1;c--){const f=c===1?1:0,u=c===2?1:0;for(let m=0;m<t[0];m++){const T=t[1]*m;for(let L=f;L<t[1];L++){const D=t[2]*(L+T);for(let b=u;b<t[2];b++){const C=t[3]*(b+D);for(let R=0;R<t[3];R++){const A=C+R;a[A]+=a[A-r]}}}}r*=t[c]}return a}function p3(a){for(let t=0,r=a.length;t<r;t++)a[t]=a[t]>>>1^-(1&a[t]);return a}function f3(a,t){switch(t){case"uint32":return a;case"uint16":for(let r=0;r<a.length;r+=2){const c=a[r],f=a[r+1];a[r]=(240&c)>>4|(61440&c)>>8|(240&f)<<4|61440&f,a[r+1]=15&c|(3840&c)>>4|(15&f)<<8|(3840&f)<<4}return a;case"uint8":for(let r=0;r<a.length;r+=4){const c=a[r],f=a[r+1],u=a[r+2],m=a[r+3];a[r+0]=(192&c)>>6|(192&f)>>4|(192&u)>>2|192&m,a[r+1]=(48&c)>>4|(48&f)>>2|48&u|(48&m)<<2,a[r+2]=(12&c)>>2|12&f|(12&u)<<2|(12&m)<<4,a[r+3]=3&c|(3&f)<<2|(3&u)<<4|(3&m)<<6}return a;default:throw new Error(`Invalid pixel format, "${t}"`)}}var uc=Uint8Array,T_=Uint16Array,m3=Int32Array,Ww=new uc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),qw=new uc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g3=new uc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$w=function(a,t){for(var r=new T_(31),c=0;c<31;++c)r[c]=t+=1<<a[c-1];var f=new m3(r[30]);for(c=1;c<30;++c)for(var u=r[c];u<r[c+1];++u)f[u]=u-r[c]<<5|c;return{b:r,r:f}},Zw=$w(Ww,2),Xw=Zw.b,_3=Zw.r;Xw[28]=258,_3[258]=28;for(var y3=$w(qw,0).b,Yw=new T_(32768),Do=0;Do<32768;++Do){var qm=(43690&Do)>>1|(21845&Do)<<1;Yw[Do]=((65280&(qm=(61680&(qm=(52428&qm)>>2|(13107&qm)<<2))>>4|(3855&qm)<<4))>>8|(255&qm)<<8)>>1}var M_=function(a,t,r){for(var c=a.length,f=0,u=new T_(t);f<c;++f)a[f]&&++u[a[f]-1];var m,T=new T_(t);for(f=1;f<t;++f)T[f]=T[f-1]+u[f-1]<<1;m=new T_(1<<t);var L=15-t;for(f=0;f<c;++f)if(a[f])for(var D=f<<4|a[f],b=t-a[f],C=T[a[f]-1]++<<b,R=C|(1<<b)-1;C<=R;++C)m[Yw[C]>>L]=D;return m},S_=new uc(288);for(Do=0;Do<144;++Do)S_[Do]=8;for(Do=144;Do<256;++Do)S_[Do]=9;for(Do=256;Do<280;++Do)S_[Do]=7;for(Do=280;Do<288;++Do)S_[Do]=8;var Kw=new uc(32);for(Do=0;Do<32;++Do)Kw[Do]=5;var v3=M_(S_,9),x3=M_(Kw,5),Bv=function(a){for(var t=a[0],r=1;r<a.length;++r)a[r]>t&&(t=a[r]);return t},Iu=function(a,t,r){var c=t/8|0;return(a[c]|a[c+1]<<8)>>(7&t)&r},Nv=function(a,t){var r=t/8|0;return(a[r]|a[r+1]<<8|a[r+2]<<16)>>(7&t)},b3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ru=function(a,t,r){var c=new Error(t||b3[a]);if(c.code=a,Error.captureStackTrace&&Error.captureStackTrace(c,Ru),!r)throw c;return c},w3=new uc(0),T3=typeof TextDecoder<"u"&&new TextDecoder;try{T3.decode(w3,{stream:!0})}catch{}const M3={gzip_data:"gzip"};class qc extends Error{constructor(t){super(t),this.name="MRTError"}}const S3={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Jw={uint32:1,uint16:2,uint8:4},E3={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Uv;class Vv{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const r=this.layers[t];if(!r)throw new qc(`Layer '${t}' not found`);return r}getHeaderLength(t){const r=new Uint8Array(t),c=new DataView(t);if(r[0]!==13)throw new qc("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const r=new Uint8Array(t),c=this.getHeaderLength(t);if(r.length<c)throw new qc(`Expected header with length >= ${c} but got buffer of length ${r.length}`);const f=function(u,m){return u.readFields(n3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Uv(r.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new qc(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const u of f.layers)this.layers[u.name]=new A3(u,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const r=[],c=this.getLayer(t.layerName);for(let f of t.blockIndices){const u=c.dataIndex[f],m=u.firstByte-t.firstByte,T=u.lastByte-t.firstByte;if(c._blocksInProgress.has(f))continue;const L={layerName:c.name,firstByte:m,lastByte:T,pixelFormat:c.pixelFormat,blockIndex:f,blockShape:[u.bands.length].concat(c.bandShape),buffer:c.buffer,codec:u.codec.codec,filters:u.filters.map(D=>D.filter)};c._blocksInProgress.add(f),r.push(L)}return new Qw(r,()=>{r.forEach(f=>c._blocksInProgress.delete(f.blockIndex))},(f,u)=>{if(r.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),f)throw f;u.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class A3{constructor({version:t,name:r,units:c,tileSize:f,pixelFormat:u,buffer:m,dataIndex:T},L){if(this.version=t,this.version!==1)throw new qc(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=r,this.units=c,this.tileSize=f,this.buffer=m,this.pixelFormat=S3[u],this.dataIndex=T,this.bandShape=[f+2*m,f+2*m,Jw[this.pixelFormat]],this._decodedBlocks=new h3(L?L.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Jw[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const r=t.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,t.data)}getBlockForBand(t){let r=0;switch(typeof t){case"string":for(const[c,f]of this.dataIndex.entries()){for(const[u,m]of f.bands.entries())if(m===t)return{bandIndex:r+u,blockIndex:c,blockBandIndex:u};r+=f.bands.length}break;case"number":for(const[c,f]of this.dataIndex.entries()){if(t>=r&&t<r+f.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-r};r+=f.bands.length}break;default:throw new qc(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new qc(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let r=1/0,c=-1/0;const f=[],u=new Set;for(const m of t){const{blockIndex:T}=this.getBlockForBand(m);if(T<0)throw new qc(`Invalid band: ${JSON.stringify(m)}`);const L=this.dataIndex[T];f.includes(T)||f.push(T),u.add(T),r=Math.min(r,L.firstByte),c=Math.max(c,L.lastByte)}if(u.size>this.cacheSize)throw new qc(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:c,blockIndices:f}}hasBand(t){const{blockIndex:r}=this.getBlockForBand(t);return r>=0}hasDataForBand(t){const{blockIndex:r}=this.getBlockForBand(t);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(t){const{blockIndex:r,blockBandIndex:c}=this.getBlockForBand(t),f=this._decodedBlocks.get(r.toString());if(!f)throw new qc(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[r],m=this.bandShape.reduce((D,b)=>D*b,1),T=c*m,L=f.subarray(T,T+m);return{data:L,bytes:new Uint8Array(L.buffer).subarray(L.byteOffset,L.byteOffset+L.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}Vv.setPbf=function(a){Uv=a};class Qw{constructor(t,r,c){this.tasks=t,this._onCancel=r,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,r){this._finalized||(this._onComplete(t,r),this._finalized=!0)}}Vv.performDecoding=function(a,t){const r=new Uint8Array(a);return Promise.all(t.tasks.map(c=>{const{layerName:f,firstByte:u,lastByte:m,pixelFormat:T,blockShape:L,blockIndex:D,filters:b,codec:C}=c,R=r.subarray(u,m+1),A=new Uint32Array(L[0]*L[1]*L[2]);let I;if(C!=="gzip_data")throw new qc(`Unhandled codec: ${C}`);return I=function(k,W){if(!globalThis.DecompressionStream&&W==="gzip_data")return Promise.resolve(((X=function(Me){Me[0]==31&&Me[1]==139&&Me[2]==8||Ru(6,"invalid gzip data");var He=Me[3],ze=10;4&He&&(ze+=2+(Me[10]|Me[11]<<8));for(var Be=(He>>3&1)+(He>>4&1);Be>0;Be-=!Me[ze++]);return ze+(2&He)}(te=k))+8>te.length&&Ru(6,"invalid gzip data"),function(Me,He,ze,Be){var yt=Me.length;if(!yt||He.f&&!He.l)return ze||new uc(0);var ke=!ze,dt=ke||He.i!=2,Et=He.i;ke&&(ze=new uc(3*yt));var Ct,Bt,ei=function(wp){var Gf=ze.length;if(wp>Gf){var P_=new uc(Math.max(2*Gf,wp));P_.set(ze),ze=P_}},ni=He.f||0,Yt=He.p||0,yi=He.b||0,Fi=He.l,di=He.d,Tn=He.m,ln=He.n,$i=8*yt;do{if(!Fi){ni=Iu(Me,Yt,1);var Di=Iu(Me,Yt+1,3);if(Yt+=3,!Di){var Kn=Me[(lr=4+((Yt+7)/8|0))-4]|Me[lr-3]<<8,bn=lr+Kn;if(bn>yt){Et&&Ru(0);break}dt&&ei(yi+Kn),ze.set(Me.subarray(lr,bn),yi),He.b=yi+=Kn,He.p=Yt=8*bn,He.f=ni;continue}if(Di==1)Fi=v3,di=x3,Tn=9,ln=5;else if(Di==2){var Cn=Iu(Me,Yt,31)+257,fr=Iu(Me,Yt+10,15)+4,Sr=Cn+Iu(Me,Yt+5,31)+1;Yt+=14;for(var Cr=new uc(Sr),xr=new uc(19),Vr=0;Vr<fr;++Vr)xr[g3[Vr]]=Iu(Me,Yt+3*Vr,7);Yt+=3*fr;var Br=Bv(xr),Bs=(1<<Br)-1,Rs=M_(xr,Br);for(Vr=0;Vr<Sr;){var lr,fs=Rs[Iu(Me,Yt,Bs)];if(Yt+=15&fs,(lr=fs>>4)<16)Cr[Vr++]=lr;else{var xs=0,Js=0;for(lr==16?(Js=3+Iu(Me,Yt,3),Yt+=2,xs=Cr[Vr-1]):lr==17?(Js=3+Iu(Me,Yt,7),Yt+=3):lr==18&&(Js=11+Iu(Me,Yt,127),Yt+=7);Js--;)Cr[Vr++]=xs}}var vo=Cr.subarray(0,Cn),Oo=Cr.subarray(Cn);Tn=Bv(vo),ln=Bv(Oo),Fi=M_(vo,Tn),di=M_(Oo,ln)}else Ru(1);if(Yt>$i){Et&&Ru(0);break}}dt&&ei(yi+131072);for(var xo=(1<<Tn)-1,co=(1<<ln)-1,Eo=Yt;;Eo=Yt){var Fo=(xs=Fi[Nv(Me,Yt)&xo])>>4;if((Yt+=15&xs)>$i){Et&&Ru(0);break}if(xs||Ru(2),Fo<256)ze[yi++]=Fo;else{if(Fo==256){Eo=Yt,Fi=null;break}var Ta=Fo-254;Fo>264&&(Ta=Iu(Me,Yt,(1<<(Du=Ww[Vr=Fo-257]))-1)+Xw[Vr],Yt+=Du);var Zs=di[Nv(Me,Yt)&co],Al=Zs>>4;if(Zs||Ru(3),Yt+=15&Zs,Oo=y3[Al],Al>3){var Du=qw[Al];Oo+=Nv(Me,Yt)&(1<<Du)-1,Yt+=Du}if(Yt>$i){Et&&Ru(0);break}dt&&ei(yi+131072);var $c=yi+Ta;if(yi<Oo){var Zc=0-Oo,Vf=Math.min(Oo,$c);for(Zc+yi<0&&Ru(3);yi<Vf;++yi)ze[yi]=(void 0)[Zc+yi]}for(;yi<$c;++yi)ze[yi]=ze[yi-Oo]}}He.l=Fi,He.p=Eo,He.b=yi,He.f=ni,Fi&&(ni=1,He.m=Tn,He.d=di,He.n=ln)}while(!ni);return yi!=ze.length&&ke?(Ct=ze,((Bt=yi)==null||Bt>Ct.length)&&(Bt=Ct.length),new uc(Ct.subarray(0,Bt))):ze.subarray(0,yi)}(te.subarray(X,-8),{i:2},new uc((($=te)[(ee=$.length)-4]|$[ee-3]<<8|$[ee-2]<<16|$[ee-1]<<24)>>>0))));var $,ee,te,X;const le=M3[W];if(!le)throw new Error(`Unhandled codec: ${W}`);const he=new globalThis.DecompressionStream(le);return new Response(new Blob([k]).stream().pipeThrough(he)).arrayBuffer().then(Me=>new Uint8Array(Me))}(R,C).then(k=>(function(W,$){W.readFields(c3,$)}(new Uv(k),A),new E3[T](A.buffer))),I.then(k=>{for(let W=b.length-1;W>=0;W--)switch(b[W]){case"delta_filter":d3(k,L);break;case"zigzag_filter":p3(k);break;case"bitshuffle_filter":f3(k,T);break;default:throw new qc(`Unhandled filter "${b[W]}"`)}return{layerName:f,blockIndex:D,data:k}}).catch(k=>{throw k})}))},Sn(Qw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var E_={workerUrl:"",workerClass:null,workerParams:void 0};const Gv="mapboxgl_preloaded_worker_pool";class A_{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<A_.workerCount;)this.workers.push(E_.workerClass!=null?new E_.workerClass:new self.Worker(E_.workerUrl,E_.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Gv]}numActive(){return Object.keys(this.active).length}}let C_;function e0(){return C_||(C_=new A_),C_}A_.workerCount=2;let L_,Hv,Pu,$m,jv,Zm=null;function eT(){return _s()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Hv||qe.DRACO_URL}function tT(){if(_s()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if($m)return $m;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return $m=WebAssembly.validate(a)?qe.MESHOPT_SIMD_URL:qe.MESHOPT_URL,$m}const t0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},C3={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},I_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function iT(a,t,r){const c=r.json.bufferViews.length,f=r.buffers.length;t.bufferView=c,r.json.bufferViews[c]={buffer:f,byteLength:a.byteLength},r.buffers[f]=a}const Wv="KHR_draco_mesh_compression";function L3(a,t){const r=a.extensions&&a.extensions[Wv];if(!r)return;const c=new Pu.Decoder,f=oT(t,r.bufferView),u=new Pu.Mesh;if(!c.DecodeArrayToMesh(f,f.byteLength,u))throw new Error("Failed to decode Draco mesh");const m=t.json.accessors[a.indices],T=t0[m.componentType],L=m.count*T.BYTES_PER_ELEMENT,D=Pu._malloc(L);T===Uint16Array?c.GetTrianglesUInt16Array(u,L,D):c.GetTrianglesUInt32Array(u,L,D),iT(Pu.memory.buffer.slice(D,D+L),m,t),Pu._free(D);for(const b of Object.keys(r.attributes)){const C=c.GetAttributeByUniqueId(u,r.attributes[b]),R=t.json.accessors[a.attributes[b]],A=C3[R.componentType],I=R.count*I_[R.type]*t0[R.componentType].BYTES_PER_ELEMENT,k=Pu._malloc(I);c.GetAttributeDataArrayForAllPoints(u,C,Pu[A],I,k),iT(Pu.memory.buffer.slice(k,k+I),R,t),Pu._free(k)}c.destroy(),u.destroy(),delete a.extensions[Wv]}const i0="EXT_meshopt_compression";function I3(a,t){if(!a.extensions||!a.extensions[i0])return;const r=a.extensions[i0],c=new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),f=new Uint8Array(r.count*r.byteStride);jv.decodeGltfBuffer(f,r.count,r.byteStride,c,r.mode,r.filter),a.buffer=t.buffers.length,a.byteOffset=0,t.buffers[a.buffer]=f.buffer,delete a.extensions[i0]}const nT=1179937895,rT=new TextDecoder("utf8");function sT(a,t){return new URL(a,t).href}function R3(a,t,r,c){return fetch(sT(a.uri,c)).then(f=>f.arrayBuffer()).then(f=>{t.buffers[r]=f})}function oT(a,t){const r=a.json.bufferViews[t];return new Uint8Array(a.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function P3(a,t,r,c){if(a.uri){const f=sT(a.uri,c);return fetch(f).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{t.images[r]=u})}if(a.bufferView!==void 0){const f=oT(t,a.bufferView),u=new Blob([f],{type:a.mimeType});return createImageBitmap(u).then(m=>{t.images[r]=m})}}function aT(a,t=0,r){const c={json:null,images:[],buffers:[]};if(new Uint32Array(a,t,1)[0]===nT){const b=new Uint32Array(a,t);let C=2;const R=(b[C++]>>2)-3,A=b[C++]>>2;if(C++,c.json=JSON.parse(rT.decode(b.subarray(C,C+A))),C+=A,C<R){const I=b[C++];C++;const k=t+(C<<2);c.buffers[0]=a.slice(k,k+I)}}else c.json=JSON.parse(rT.decode(new Uint8Array(a,t)));const{buffers:f,images:u,meshes:m,extensionsUsed:T,bufferViews:L}=c.json;let D=Promise.resolve();if(f){const b=[];for(let C=0;C<f.length;C++){const R=f[C];R.uri?b.push(R3(R,c,C,r)):c.buffers[C]||(c.buffers[C]=null)}D=Promise.all(b)}return D.then(()=>{const b=[],C=T&&T.includes(Wv),R=T&&T.includes(i0);if(C&&b.push(function(){if(!Pu)return L_??(L_=function(A){let I,k=null;function W(){I=new Uint8Array(k.buffer)}function $(){throw new Error("Unexpected Draco error.")}const ee={a:{a:$,d:function(te,X,le){return I.copyWithin(te,X,X+le)},c:function(te){const X=I.length,le=Math.max(te>>>0,Math.ceil(1.2*X)),he=Math.ceil((le-X)/65536);try{return k.grow(he),W(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,ee):A.then(te=>te.arrayBuffer()).then(te=>WebAssembly.instantiate(te,ee))).then(te=>{const{Rb:X,Qb:le,P:he,T:Me,X:He,Ja:ze,La:Be,Qa:yt,Va:ke,Wa:dt,eb:Et,jb:Ct,f:Bt,e:ei,yb:ni,zb:Yt,Ab:yi,Bb:Fi,Db:di,Gb:Tn}=te.instance.exports;k=ei;const ln=(()=>{let $i=0,Di=0,Kn=0,bn=0;return Cn=>{Kn&&(X(bn),X($i),Di+=Kn,Kn=$i=0),$i||(Di+=128,$i=le(Di));const fr=Cn.length+7&-8;let Sr=$i;fr>=Di&&(Kn=fr,Sr=bn=le(fr));for(let Cr=0;Cr<Cn.length;Cr++)I[Sr+Cr]=Cn[Cr];return Sr}})();return W(),Bt(),{memory:ei,_free:X,_malloc:le,Mesh:class{constructor(){this.ptr=he()}destroy(){Me(this.ptr)}},Decoder:class{constructor(){this.ptr=ze()}destroy(){Ct(this.ptr)}DecodeArrayToMesh($i,Di,Kn){const bn=ln($i),Cn=Be(this.ptr,bn,Di,Kn.ptr);return!!He(Cn)}GetAttributeByUniqueId($i,Di){return{ptr:yt(this.ptr,$i.ptr,Di)}}GetTrianglesUInt16Array($i,Di,Kn){ke(this.ptr,$i.ptr,Di,Kn)}GetTrianglesUInt32Array($i,Di,Kn){dt(this.ptr,$i.ptr,Di,Kn)}GetAttributeDataArrayForAllPoints($i,Di,Kn,bn,Cn){Et(this.ptr,$i.ptr,Di.ptr,Kn,bn,Cn)}},DT_INT8:ni(),DT_UINT8:Yt(),DT_INT16:yi(),DT_UINT16:Fi(),DT_UINT32:di(),DT_FLOAT32:Tn()}})}(fetch(eT())),L_.then(A=>{Pu=A,L_=void 0}))}()),R&&b.push(function(){if(jv)return;const A=function(I){let k;const W=WebAssembly.instantiateStreaming(I,{}).then(te=>{k=te.instance,k.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ee={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:W,supported:!0,decodeGltfBuffer(te,X,le,he,Me,He){(function(ze,Be,yt,ke,dt,Et,Ct){const Bt=ze.exports.sbrk,ei=ke+3&-4,ni=Bt(ei*dt),Yt=Bt(Et.length),yi=new Uint8Array(ze.exports.memory.buffer);yi.set(Et,Yt);const Fi=Be(ni,ke,dt,Yt,Et.length);if(Fi===0&&Ct&&Ct(ni,ei,dt),yt.set(yi.subarray(ni,ni+ke*dt)),Bt(ni-Bt(0)),Fi!==0)throw new Error(`Malformed buffer data: ${Fi}`)})(k,k.exports[ee[Me]],te,X,le,he,k.exports[$[He]])}}}(fetch(tT()));return A.ready.then(()=>{jv=A})}()),u)for(let A=0;A<u.length;A++)b.push(P3(u[A],c,A,r));return(b.length?Promise.all(b):Promise.resolve()).then(()=>{if(C&&m)for(const{primitives:A}of m)for(const I of A)L3(I,c);if(R&&m&&L)for(const A of L)I3(A,c);return c})})}function Uf(a,t){const r=a.json.bufferViews[t.bufferView],c=t0[t.componentType];return new c(a.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*(r.byteStride&&r.byteStride!==I_[t.type]*c.BYTES_PER_ELEMENT?r.byteStride/c.BYTES_PER_ELEMENT:I_[t.type]))}function qv(a,t,r,c){const f=t0[t.componentType],u=function(b){switch(b){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),m=a.json.bufferViews[t.bufferView],T=m.byteStride?m.byteStride/f.BYTES_PER_ELEMENT:I_[t.type],L=r.float32,D=L.length/r.capacity;for(let b=0,C=0;b<t.count*T;b+=T,C+=D)for(let R=0;R<D;R++)L[C+R]=c[b+R]*u;r._trim()}function D3(a,t,r){const c=a.indices,f=a.attributes,u={};u.indexArray=new qs;const m=t.json.accessors[c],T=m.count/3;u.indexArray.reserve(T);const L=Uf(t,m);for(let R=0;R<T;R++)u.indexArray.emplaceBack(L[3*R],L[3*R+1],L[3*R+2]);u.indexArray._trim(),u.vertexArray=new tc;const D=t.json.accessors[f.POSITION];u.vertexArray.reserve(D.count);const b=Uf(t,D);for(let R=0;R<D.count;R++)u.vertexArray.emplaceBack(b[3*R],b[3*R+1],b[3*R+2]);if(u.vertexArray._trim(),u.aabb=new ls(D.min,D.max),u.centroid=function(R,A){const I=[0,0,0],k=R.length;if(k>0){for(let W=0;W<k;W++){const $=3*R[W];I[0]+=A[$],I[1]+=A[$+1],I[2]+=A[$+2]}I[0]/=k,I[1]/=k,I[2]/=k}return I}(L,b),f.COLOR_0!==void 0){const R=t.json.accessors[f.COLOR_0],A=I_[R.type],I=Uf(t,R);u.colorArray=A===3?new tc:new va,u.colorArray.resize(R.count),qv(t,R,u.colorArray,I)}if(f.NORMAL!==void 0){u.normalArray=new tc;const R=t.json.accessors[f.NORMAL];u.normalArray.resize(R.count);const A=Uf(t,R);qv(t,R,u.normalArray,A)}if(f.TEXCOORD_0!==void 0&&r.length>0){u.texcoordArray=new xu;const R=t.json.accessors[f.TEXCOORD_0];u.texcoordArray.resize(R.count);const A=Uf(t,R);qv(t,R,u.texcoordArray,A)}if(f._FEATURE_ID_RGBA4444!==void 0){const R=t.json.accessors[f._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Uf(t,R))}f._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Uf(t,t.json.accessors[f._FEATURE_RGBA4444]).buffer));const C=a.material;return u.material=function(R,A){const{emissiveFactor:I=[0,0,0],alphaMode:k="OPAQUE",alphaCutoff:W=.5,normalTexture:$,occlusionTexture:ee,emissiveTexture:te,doubleSided:X}=R,{baseColorFactor:le=[1,1,1,1],metallicFactor:he=1,roughnessFactor:Me=1,baseColorTexture:He,metallicRoughnessTexture:ze}=R.pbrMetallicRoughness||{},Be=ee?A[ee.index]:void 0;if(ee&&ee.extensions&&ee.extensions.KHR_texture_transform&&Be){const yt=ee.extensions.KHR_texture_transform;Be.offsetScale=[yt.offset[0],yt.offset[1],yt.scale[0],yt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ee(...le),metallicFactor:he,roughnessFactor:Me,baseColorTexture:He?A[He.index]:void 0,metallicRoughnessTexture:ze?A[ze.index]:void 0},doubleSided:X,emissiveFactor:I,alphaMode:k,alphaCutoff:W,normalTexture:$?A[$.index]:void 0,occlusionTexture:Be,emissionTexture:te?A[te.index]:void 0,defined:R.defined===void 0}}(C!==void 0?t.json.materials[C]:{defined:!1},r),u}function lT(a,t,r){const{matrix:c,rotation:f,translation:u,scale:m,mesh:T,extras:L,children:D}=a,b={};if(b.matrix=c||Qe.mat4.fromRotationTranslationScale([],f||[0,0,0,1],u||[0,0,0],m||[1,1,1]),T!==void 0){b.meshes=r[T];const C=b.anchor=[0,0];for(const R of b.meshes){const{min:A,max:I}=R.aabb;C[0]+=A[0]+I[0],C[1]+=A[1]+I[1]}C[0]=Math.floor(C[0]/b.meshes.length/2),C[1]=Math.floor(C[1]/b.meshes.length/2)}if(L&&(L.id&&(b.id=L.id),L.lights&&(b.lights=function(C){if(!C.length)return[];const R=function($){const ee=atob($),te=new Uint8Array(ee.length);for(let X=0;X<ee.length;X++)te[X]=ee.codePointAt(X);return te}(C),A=[],I=R.length/24,k=new Uint16Array(R.buffer),W=new Float32Array(R.buffer);for(let $=0;$<I;$++){const ee=k[2*$*6]/30,te=k[2*$*6+1]/30,X=k[2*$*6+10]/100,le=W[6*$+1],he=W[6*$+2],Me=W[6*$+3],He=W[6*$+4],ze=Me-le,Be=He-he,yt=Math.hypot(ze,Be);A.push({pos:[le+.5*ze,he+.5*Be,te],normal:[Be/yt,-ze/yt,0],width:yt,height:ee,depth:X,points:[le,he,Me,He]})}return A}(L.lights))),D){const C=[];for(const R of D)C.push(lT(t.json.nodes[R],t,r));b.children=C}return b}function O3(a){if(a.vertices.length===0||a.indices.length===0)return null;const t=new Fm(a.vertices,a.indices,8,256),[r,c]=[t.min.clone(),t.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:t,min:r,max:c}}function z3(a){if(!a.extras||!a.extras.ground)return null;const t=a.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const r=t[0];if(!r||!Array.isArray(r)||r.length===0)return null;const c=[];for(const m of r){if(!Array.isArray(m)||m.length!==2)continue;const T=m[0],L=m[1];typeof T=="number"&&typeof L=="number"&&c.push(new je(T,L))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let f=0;for(let m=0;m<c.length;m++){const T=c[m],L=c[(m+1)%c.length],D=c[(m+2)%c.length];f+=(T.x-L.x)*(D.y-L.y)-(D.x-L.x)*(T.y-L.y)}f>0&&c.reverse();const u=Rf(c.flatMap(m=>[m.x,m.y]),[]);return u.length===0?null:{vertices:c,indices:u}}function k3(a,t){const r=[],c=[];let f=0;const u=[];for(const m of a){f=r.length;const T=m.vertexArray.float32,L=m.indexArray.uint16;for(let D=0;D<m.vertexArray.length;D++)u[0]=T[3*D+0],u[1]=T[3*D+1],u[2]=T[3*D+2],Qe.vec3.transformMat4(u,u,t),r.push(new je(u[0],u[1]));for(let D=0;D<3*m.indexArray.length;D++)c.push(L[D]+f)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const T=r[c[m+0]],L=r[c[m+1]],D=r[c[m+2]];(T.x-L.x)*(D.y-L.y)-(D.x-L.x)*(T.y-L.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:r,indices:c}}function cT(a){const t=function(L,D){const b=[],C=WebGL2RenderingContext;if(L.json.textures)for(const R of L.json.textures){const A={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};R.sampler!==void 0&&Object.assign(A,L.json.samplers[R.sampler]),b.push({image:D[R.source],sampler:A,uploaded:!1})}return b}(a,a.images),r=function(L,D){const b=[];for(const C of L.json.meshes){const R=[];for(const A of C.primitives)R.push(D3(A,L,D));b.push(R)}return b}(a,t),{scenes:c,scene:f,nodes:u}=a.json,m=c?c[f||0].nodes:u,T=[];for(const L of m)T.push(lT(u[L],a,r));return function(L,D,b){const C={},R=new Set;for(let A=0;A<L.length;A++){const I=b[D[A]];if(!I.extras)continue;const k=I.extras["mapbox:footprint:version"],W=I.extras["mapbox:footprint:id"];(k||W)&&R.add(A),k==="1.0.0"&&W&&(C[W]=A)}for(let A=0;A<L.length;A++){if(R.has(A))continue;const I=L[A],k=b[D[A]];if(!k.extras)continue;let W=null;I.id in C&&(W=k3(L[C[I.id]].meshes,I.matrix)),W||(W=z3(k)),W&&(I.footprint=O3(W))}if(R.size>0){const A=Array.from(R.values()).sort((I,k)=>I-k);for(let I=A.length-1;I>=0;I--)L.splice(A[I],1)}}(T,m,a.json.nodes),T}function F3(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const t=a.vertexArray.float32,r=a.aabb.min[0]-1,c=a.aabb.min[1]-1,f=Bf/(a.aabb.max[0]-r+2),u=Bf/(a.aabb.max[1]-c+2);for(let m=0;m<t.length;m+=3){const T=t[m+2],L=(t[m+0]-r)*f|0,D=(t[m+1]-c)*u|0;T>a.heightmap[D*Bf+L]&&(a.heightmap[D*Bf+L]=T)}}function B3(a,t){const r={};r.indexArray=new qs,r.indexArray.reserve(4*a.length),r.vertexArray=new tc,r.vertexArray.reserve(10*a.length),r.colorArray=new va,r.vertexArray.reserve(10*a.length);let c=0;for(const m of a){const T=Math.min(10,Math.max(4,1.3*m.height))*t,L=[-m.normal[1],m.normal[0],0],D=Math.min(.29,.1*m.width/m.depth),b=m.width-2*m.depth*t*(D+.01),C=Qe.vec3.scaleAndAdd([],m.pos,L,b/2),R=Qe.vec3.scaleAndAdd([],m.pos,L,-b/2),A=[C[0],C[1],C[2]+m.height],I=[R[0],R[1],R[2]+m.height],k=Qe.vec3.scaleAndAdd([],m.normal,L,D);Qe.vec3.scale(k,k,T);const W=Qe.vec3.scaleAndAdd([],m.normal,L,-D);Qe.vec3.scale(W,W,T),Qe.vec3.add(k,C,k),Qe.vec3.add(W,R,W),C[2]+=.1,R[2]+=.1,r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(W[0],W[1],W[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(W[0],W[1],W[2]);const $=b/T/2;r.colorArray.emplaceBack(-$-D,-1,$,.8),r.colorArray.emplaceBack($+D,-1,$,.8),r.colorArray.emplaceBack(-$,0,$,1.3),r.colorArray.emplaceBack($,0,$,1.3),r.colorArray.emplaceBack($+D,-.8,$,.7),r.colorArray.emplaceBack($+D,-.8,$,.7),r.colorArray.emplaceBack(0,0,$,1.3),r.colorArray.emplaceBack(0,0,$,1.3),r.colorArray.emplaceBack($+D,-1.2,$,.8),r.colorArray.emplaceBack($+D,-1.2,$,.8),r.indexArray.emplaceBack(6+c,4+c,8+c),r.indexArray.emplaceBack(7+c,9+c,5+c),r.indexArray.emplaceBack(0+c,1+c,2+c),r.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const f={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Ee.white,f.pbrMetallicRoughness=u,r.material=f,r.aabb=new ls([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class uT{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const c=t[r];this._stringToNumber[c]=r,this._numberToString[r]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class hT{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new hu(un,16,0),this.featureIndexArray=new td,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,r,c,f,u,m=0,T=0){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,u,m);const D=this.grid;for(let b=0;b<r.length;b++){const C=r[b],R=[1/0,1/0,-1/0,-1/0];for(let A=0;A<C.length;A++){const I=C[A];R[0]=Math.min(R[0],I.x),R[1]=Math.min(R[1],I.y),R[2]=Math.max(R[2],I.x),R[3]=Math.max(R[3],I.y)}T!==0&&(R[0]-=T,R[1]-=T,R[2]+=T,R[3]+=T),R[0]<un&&R[1]<un&&R[2]>=0&&R[3]>=0&&D.insert(L,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new oe.VectorTile(new Ry(this.rawTileData)).layers,this.sourceLayerCoder=new uT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r,c){this.loadVTLayers(),this.serializedLayersCache.clear();const f=yl(t.filter),u=t.tileResult,m=t.transform,T=u.bufferedTilespaceBounds,L=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(R,A,I,k)=>as(u.bufferedTilespaceGeometry,R,A,I,k));L.sort(N3);let D=null;m.elevation&&L.length>0&&(D=jm.create(m.elevation,this.tileID));const b={};let C;for(let R=0;R<L.length;R++){const A=L[R];if(A===C)continue;C=A;const I=this.featureIndexArray.get(A);let k=null;if(this.is3DTile){const W=this.bucketLayerIDs[0][0],$=r[W];if($.type!=="model")continue;const{queryFeature:ee,intersectionZ:te}=$.queryIntersectsMatchingFeature(u,I.featureIndex,f,m);ee&&this.appendToResult(b,W,I.featureIndex,ee,te)}else this.loadMatchingFeature(b,I,f,t.layers,t.availableImages,r,c,(W,$,ee,te=0)=>(k||(k=Wt(W,this.tileID.canonical,t.tileTransform)),$.queryIntersectsFeature(u,W,ee,k,this.z,t.transform,t.pixelPosMatrix,D,te)))}return b}loadMatchingFeature(t,r,c,f,u,m,T,L){const{featureIndex:D,bucketIndex:b,sourceLayerIndex:C,layoutVertexArrayOffset:R}=r,A=this.bucketLayerIDs[b];if(f.length&&!function($,ee){for(let te=0;te<$.length;te++)if(ee.indexOf($[te])>=0)return!0;return!1}(f,A))return;const I=this.sourceLayerCoder.decode(C),k=this.vtLayers[I].feature(D);if(c.needGeometry){const $=wi(k,!0);if(!c.filter(new Qs(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!c.filter(new Qs(this.tileID.overscaledZ),k))return;const W=this.getId(k,I);for(let $=0;$<A.length;$++){const ee=A[$];if(f.length&&f.indexOf(ee)<0)continue;const te=m[ee];if(!te)continue;let X={};W!==void 0&&T&&(X=T.getState(te.sourceLayer||"_geojsonTileLayer",W));const le=!L||L(k,te,X,R);if(!le)continue;const he=new w_(k,this.z,this.x,this.y,W);let Me=this.serializedLayersCache.get(ee);Me||(Me=te.serialize(),Me.id=ee,this.serializedLayersCache.set(ee,Me)),he.layer=cn({},Me),he.tile=this.tileID.canonical,he.layer.paint=dT(Me.paint,te.paint,k,X,u),he.layer.layout=dT(Me.layout,te.layout,k,X,u),this.appendToResult(t,ee,D,he,le)}}appendToResult(t,r,c,f,u){let m=t[r];m===void 0&&(m=t[r]=[]),m.push({featureIndex:c,feature:f,intersectionZ:u})}lookupSymbolFeatures(t,r,c,f,u,m,T){const L={};this.loadVTLayers();const D=yl(f);for(const b of t)this.loadMatchingFeature(L,{bucketIndex:r,sourceLayerIndex:c,featureIndex:b,layoutVertexArrayOffset:0},D,u,m,T);return L}loadFeature(t){const{featureIndex:r,sourceLayerIndex:c}=t;this.loadVTLayers();const f=this.sourceLayerCoder.decode(c),u=this.vtFeatures[f];if(u[r])return u[r];const m=this.vtLayers[f].feature(r);return u[r]=m,m}hasLayer(t){for(const r of this.bucketLayerIDs)for(const c of r)if(t===c)return!0;return!1}getId(t,r){let c=t.id;if(this.promoteId){const f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];f!=null&&(c=t.properties[f]),typeof c=="boolean"&&(c=Number(c))}return c}}function dT(a,t,r,c,f){return Tr(a,(u,m)=>{const T=t instanceof th?t.get(m):null;return T&&T.evaluate?T.evaluate(r,c,f):T})}function N3(a,t){return t-a}Sn(hT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const pT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $v{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,c]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const u=pT[15&c];if(!u)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[T]=new Uint32Array(t,4,1);return new $v(T,m,u,t)}constructor(t,r=64,c=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const u=pT.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,T=t*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-T%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+L,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+T+L),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+L,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=r,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Zv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:m,nodeSize:T}=this,L=[0,u.length-1,0],D=[];for(;L.length;){const b=L.pop()||0,C=L.pop()||0,R=L.pop()||0;if(C-R<=T){for(let W=R;W<=C;W++){const $=m[2*W],ee=m[2*W+1];$>=t&&$<=c&&ee>=r&&ee<=f&&D.push(u[W])}continue}const A=R+C>>1,I=m[2*A],k=m[2*A+1];I>=t&&I<=c&&k>=r&&k<=f&&D.push(u[A]),(b===0?t<=I:r<=k)&&(L.push(R),L.push(A-1),L.push(1-b)),(b===0?c>=I:f>=k)&&(L.push(A+1),L.push(C),L.push(1-b))}return D}within(t,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:u,nodeSize:m}=this,T=[0,f.length-1,0],L=[],D=c*c;for(;T.length;){const b=T.pop()||0,C=T.pop()||0,R=T.pop()||0;if(C-R<=m){for(let W=R;W<=C;W++)mT(u[2*W],u[2*W+1],t,r)<=D&&L.push(f[W]);continue}const A=R+C>>1,I=u[2*A],k=u[2*A+1];mT(I,k,t,r)<=D&&L.push(f[A]),(b===0?t-c<=I:r-c<=k)&&(T.push(R),T.push(A-1),T.push(1-b)),(b===0?t+c>=I:r+c>=k)&&(T.push(A+1),T.push(C),T.push(1-b))}return L}}function Zv(a,t,r,c,f,u){if(f-c<=r)return;const m=c+f>>1;fT(a,t,m,c,f,u),Zv(a,t,r,c,m-1,1-u),Zv(a,t,r,m+1,f,1-u)}function fT(a,t,r,c,f,u){for(;f>c;){if(f-c>600){const D=f-c+1,b=r-c+1,C=Math.log(D),R=.5*Math.exp(2*C/3),A=.5*Math.sqrt(C*R*(D-R)/D)*(b-D/2<0?-1:1);fT(a,t,r,Math.max(c,Math.floor(r-b*R/D+A)),Math.min(f,Math.floor(r+(D-b)*R/D+A)),u)}const m=t[2*r+u];let T=c,L=f;for(R_(a,t,c,r),t[2*f+u]>m&&R_(a,t,c,f);T<L;){for(R_(a,t,T,L),T++,L--;t[2*T+u]<m;)T++;for(;t[2*L+u]>m;)L--}t[2*c+u]===m?R_(a,t,c,L):(L++,R_(a,t,L,f)),L<=r&&(c=L+1),r<=L&&(f=L-1)}}function R_(a,t,r,c){Xv(a,r,c),Xv(t,2*r,2*c),Xv(t,2*r+1,2*c+1)}function Xv(a,t,r){const c=a[t];a[t]=a[r],a[r]=c}function mT(a,t,r,c){const f=a-r,u=t-c;return f*f+u*u}n.$=_f,n.A=class extends Yy{},n.B=pl,n.C=Wi,n.D=ih,n.E=bi,n.F=of,n.G=cu,n.H=sf,n.I=yv,n.J=Ju,n.K=Va,n.L=Cc,n.M=uu,n.N=Pd,n.O=au,n.P=je,n.Q=ju,n.R=na,n.S=jo,n.T=Iv,n.U=me,n.V=Yy,n.W=yo,n.X=af,n.Y=wm,n.Z=function(a){const t=a.value;let r=[];if(!t)return r;const c=pl(t);return c!=="string"?(r=r.concat([new Yy(a.key,t,`string expected, "${c}" found`)]),r):(Ew(t,!0)||(r=r.concat([new Yy(a.key,t,`invalid url "${t}"`)])),r)},n._=Jt,n.a=function(a){return qe.API_CDN_URL_REGEX.test(a)},n.a$=ec,n.a0=Ts,n.a1=qi,n.a2=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return Lo(a.expression.evaluate(t))}interpolate(a,t,r){return{x:Pe(a.x,t.x,r),y:Pe(a.y,t.y,r),z:Pe(a.z,t.z,r),azimuthal:Pe(a.azimuthal,t.azimuthal,r),polar:Pe(a.polar,t.polar,r)}}},n.a3=Qs,n.a4=el,n.a5=Lt,n.a6=Qe,n.a7=ci,n.a8=th,n.a9=jc,n.aA=Hr,n.aB=pw,n.aC=vw,n.aD=dw,n.aE=function(a,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let c=0;c<a.length;c++){const f=document.createElement("source");ra(a[c])||(r.crossOrigin="Anonymous"),f.src=a[c],r.appendChild(f)}return{cancel:()=>{}}},n.aF=Wy,n.aG=function(a){return fetch(a).then(t=>t.arrayBuffer()).then(t=>aT(t,0,a))},n.aH=cT,n.aI=class{constructor(a,t,r,c){this.id=a,this.position=t!=null?new H(t[0],t[1]):new H(0,0),this.orientation=r??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new ls([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,t){if(Qe.mat4.multiply(a.matrix,t,a.matrix),a.meshes)for(const r of a.meshes){const c=ls.applyTransformFast(r.aabb,a.matrix);this.aabb.encapsulate(c)}if(a.children)for(const r of a.children)this._applyTransformations(r,a.matrix)}computeBoundsAndApplyParent(){const a=Qe.mat4.identity([]);for(const t of this.nodes)this._applyTransformations(t,a)}computeModelMatrix(a,t,r,c,f,u,m=!1){Rw(this.matrix,this,a.transform,this.position,t,r,c,f,u,m)}upload(a){if(!this.uploaded){for(const t of this.nodes)zv(t,a);for(const t of this.nodes)Ky(t);this.uploaded=!0}}destroy(){for(const a of this.nodes)kv(a)}},n.aJ=jn,n.aK=function(a){return a.indexOf(oh)>=0},n.aL=m_,n.aM=Oe,n.aN=Ne,n.aO=mu,n.aP=qs,n.aQ=Fn,n.aR=dh,n.aS=Hy,n.aT=function(){oa.isLoading()||oa.isLoaded()||mf()!=="deferred"||Kh()},n.aU=yl,n.aV=wi,n.aW=w_,n.aX=js,n.aY=gp,n.aZ=km,n.a_=Wt,n.aa=Pe,n.ab=un,n.ac=li,n.ad=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return function([r,c]){const f=Lo([1,r,c]);return{x:f.x,y:f.y,z:f.z}}(a.expression.evaluate(t))}interpolate(a,t,r){return{x:Pe(a.x,t.x,r),y:Pe(a.y,t.y,r),z:Pe(a.z,t.z,r)}}},n.ae=function(a,t,r=0,c=!0){const f=new je(r,r),u=a.sub(f),m=t.add(f),T=[u,new je(m.x,u.y),m,new je(u.x,m.y)];return c&&T.push(u.clone()),T},n.af=function(a,t){const r=[];for(let c=0;c<a.length;c++){const f=xi(c-1,-1,a.length-1),u=xi(c+1,-1,a.length-1),m=a[c],T=a[u],L=a[f].sub(m).unit(),D=T.sub(m).unit(),b=D.angleWithSep(L.x,L.y),C=L.add(D).unit().mult(-1*t/Math.sin(b/2));r.push(m.add(C))}return r},n.ag=Jb,n.ah=as,n.ai=function(a,t,r=0){return Qe.vec3.fromValues(((t.x-r)*a.scale-a.x)*un,(t.y*a.scale-a.y)*un,Ue(t.z,t.y))},n.aj=xa,n.ak=c_,n.al=function(a){let t=1/0,r=1/0,c=-1/0,f=-1/0;for(const u of a)t=Math.min(t,u.x),r=Math.min(r,u.y),c=Math.max(c,u.x),f=Math.max(f,u.y);return{min:new je(t,r),max:new je(c,f)}},n.am=ue,n.an=Nr,n.ao=vt,n.ap=Mt,n.aq=Qo,n.ar=function(a,t){const r={};for(let c=0;c<t.length;c++){const f=t[c];f in a&&(r[f]=a[f])}return r},n.as=Z,n.at=_e,n.au=class{constructor(a){this.entries={},this.scheduler=a}request(a,t,r,c){const f=this.entries[a]=this.entries[a]||{callbacks:[]};if(f.result){const[u,m]=f.result;return this.scheduler?this.scheduler.add(()=>{c(u,m)},t):c(u,m),()=>{}}return f.callbacks.push(c),f.cancel||(f.cancel=r((u,m)=>{f.result=[u,m];for(const T of f.callbacks)this.scheduler?this.scheduler.add(()=>{T(u,m)},t):T(u,m);setTimeout(()=>delete this.entries[a],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(u=>u!==c),f.callbacks.length||(f.cancel(),delete this.entries[a]))}}},n.av=ah,n.aw=function(a,t,r){const c=JSON.stringify(a.request);return a.data&&(this.deduped.entries[c]={result:[null,a.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const u=Bo(a.request,(m,T,L,D)=>{m?f(m):T&&f(null,{vectorTile:r?void 0:new oe.VectorTile(new Ry(T)),rawData:T,cacheControl:L,expires:D})});return()=>{u.cancel(),f()}},t)},n.ax=function(a){Ns++,Ns>er&&(a.getActor().send("enforceCacheSizeLimit",ar),Ns=0)},n.ay=Pi,n.az=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},n.b=function(a){return qe.API_FONTS_REGEX.test(a)},n.b$=aa,n.b0=ep,n.b1=Tl,n.b2=Ks,n.b3=Rf,n.b4=Av,n.b5=function(a,t){const r=jc(t.zoom);if(r===0)return Hl(a);const c=dp(a),f=Cm(c),u=ue(c.getWest())*t.worldSize,m=ue(c.getEast())*t.worldSize,T=_e(c.getNorth())*t.worldSize,L=_e(c.getSouth())*t.worldSize,D=[u,T,0],b=[m,T,0],C=[u,L,0],R=[m,L,0],A=Qe.mat4.invert([],t.globeMatrix);return Qe.vec3.transformMat4(D,D,A),Qe.vec3.transformMat4(b,b,A),Qe.vec3.transformMat4(C,C,A),Qe.vec3.transformMat4(R,R,A),f[0]=Ml(f[0],C,r),f[1]=Ml(f[1],R,r),f[2]=Ml(f[2],b,r),f[3]=Ml(f[3],D,r),ls.fromPoints(f)},n.b6=Af,n.b7=Sf,n.b8=Ml,n.b9=Yd,n.bA=Ee,n.bB=xi,n.bC=Fe,n.bD=no,n.bE=ge,n.bF=function(a,t,r){a[4*t+0]=r[0],a[4*t+1]=r[1],a[4*t+2]=r[2],a[4*t+3]=r[3]},n.bG=Eu,n.bH=Wa,n.bI=nd,n.bJ=lo,n.bK=bl,n.bL=H,n.bM=nw,n.bN=Wr,n.bO=Pa,n.bP=bw,n.bQ=Mo,n.bR=Mf,n.bS=function(a,t,r,c,f,u,m,T,L){if(L.name==="globe")return Mf(a,t,new Mo(r,c,f),!1);const D=m_({z:r,x:c,y:f},L);return new ls([(u+D.x/D.scale)*t,t*(D.y/D.scale),m],[(u+D.x2/D.scale)*t,t*(D.y2/D.scale),T])},n.bT=function(a,t,r){let c=0;for(let f=0;f<2;++f)a[f]>0&&(c+=(a[f]-0)*(a[f]-0)),t[f]<0&&(c+=(0-t[f])*(0-t[f]));return c},n.bU=$e,n.bV=h,n.bW=function(a){const t=Qe.mat4.identity(new Float64Array(16));Qe.mat4.multiply(t,a.pixelMatrix,a.globeMatrix);const r=[0,x,0],c=[0,w,0];return Qe.vec3.transformMat4(r,r,t),Qe.vec3.transformMat4(c,c,t),[r[0]>0&&r[0]<=a.width&&r[1]>0&&r[1]<=a.height&&!Im(a,new H(a.center.lat,90)),c[0]>0&&c[0]<=a.width&&c[1]>0&&c[1]<=a.height&&!Im(a,new H(a.center.lat,-90))]},n.bX=function(a,t){const{scale:r}=a.tileTransform,c=r*un/(a.tileSize*Math.pow(2,t.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return Qe.mat2.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},n.bY=Zy,n.bZ=xw,n.b_=function(a){const t=xw(a,!0);return Qe.mat2.invert([],[t[0],t[1],t[4],t[5]])},n.ba=Ro,n.bb=Vv,n.bc=Ry,n.bd=Bo,n.be=function(a){const t=[];for(const r in a)t.push(a[r]);return t},n.bf=function(a,t){const r=[];for(const c in a)c in t||r.push(c);return r},n.bg=an,n.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bi=Ot,n.bj=function(a,t){const{x:r,y:c}=a.point,f=Lf(r,c,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Qe.mat4.multiply(f,f,Lm(Hl(t)))},n.bk=Da,n.bl=cc,n.bm=sl,n.bn=function(a,t,r,c,f){const u=5*t+2;a.float32[u+0]=r,a.float32[u+1]=c,a.float32[u+2]=f},n.bo=Gy,n.bp=Vb,n.bq=mi,n.br=zs,n.bs=ft,n.bt=Sw,n.bu=En,n.bv=Ji,n.bw=bv,n.bx=Zb,n.by=_v,n.bz=$v,n.c=ut,n.c$=is,n.c0=function(a){const{x:t,y:r}=a.point,{lng:c,lat:f}=a._center;return Lf(t,r,a.worldSize,c,f)},n.c1=Ge,n.c2=Yr,n.c3=ho,n.c4=function(a){const t=Math.round((a+45+360)%360/90)%4;return Je[t]},n.c5=45,n.c6=pe,n.c7=Vc,n.c8=function(a,t,r){const c=Math.sqrt(a*a+t*t+r*r),f=c>0?Math.acos(r/c)*Ie:0;let u=a!==0||t!==0?Math.atan2(-t,-a)*Ie+90:0;return u<0&&(u+=360),[c,u,f]},n.c9=gt,n.cA=function(a){const t=$e-5;a=Mt(a,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(Fe(a))),3);return Math.round(r*(d.length-1))},n.cB=function(a,t,r,c){const f=t.getNorth(),u=t.getSouth(),m=t.getWest(),T=t.getEast(),L=1<<a.z,D=T-m,b=f-u,C=D/s,R=-b/d[r],A=[0,C,0,R,0,0,f,m,0];if(a.z>0){const I=180/c;Qe.mat3.multiply(A,A,[I/D+1,0,0,0,I/b+1,0,-.5*I/C,.5*I/R,1])}return A[2]=L,A[5]=a.x,A[8]=a.y,A},n.cC=Hl,n.cD=function(a,t,r){const c=Qe.mat4.identity(new Float64Array(16)),f=(t/(1<<a)-.5)*Math.PI*2;return Qe.mat4.rotateY(c,r.globeMatrix,f),Float32Array.from(c)},n.cE=class{isDataAvailableAtPoint(a){const t=this._source();if(this.isUsingMockSource()||!t||a.y<0||a.y>1)return!1;const r=t.getSource().maxzoom,c=1<<r,f=Math.floor(a.x),u=Math.floor((a.x-f)*c),m=Math.floor(a.y*c),T=this.findDEMTileFor(new Hr(r,f,r,u,m));return!(!T||!T.dem)}getAtPointOrZero(a,t=0){return this.getAtPoint(a,t)||0}getAtPoint(a,t,r=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||a.y<0||a.y>1)return t;const f=c.getSource().maxzoom,u=1<<f,m=Math.floor(a.x),T=a.x-m,L=new Hr(f,m,f,Math.floor(T*u),Math.floor(a.y*u)),D=this.findDEMTileFor(L);if(!D||!D.dem)return t;const b=D.dem,C=1<<D.tileID.canonical.z,R=(T*C-D.tileID.canonical.x)*b.dim,A=(a.y*C-D.tileID.canonical.y)*b.dim,I=Math.floor(R),k=Math.floor(A);return(r?this.exaggeration():1)*Pe(Pe(b.get(I,k),b.get(I,k+1),A-k),Pe(b.get(I+1,k),b.get(I+1,k+1),A-k),R-I)}getAtTileOffset(a,t,r){const c=1<<a.canonical.z;return this.getAtPointOrZero(new Lt(a.wrap+(a.canonical.x+t/un)/c,(a.canonical.y+r/un)/c))}getAtTileOffsetFunc(a,t,r,c){return f=>{const u=this.getAtTileOffset(a,f.x,f.y),m=c.upVector(a.canonical,f.x,f.y),T=c.upVectorScale(a.canonical,t,r).metersToTile;return Qe.vec3.scale(m,m,u*T),m}}getForTilePoints(a,t,r,c){if(this.isUsingMockSource())return!1;const f=jm.create(this,a,c);return!!f&&(t.forEach(u=>{u[2]=this.exaggeration()*f.getElevationAt(u[0],u[1],r)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(a);if(!t||!t.dem)return null;const r=t.dem.tree,c=t.tileID,f=1<<a.canonical.z-c.canonical.z;let u=a.canonical.x/f-c.canonical.x,m=a.canonical.y/f-c.canonical.y,T=0;for(let L=0;L<a.canonical.z-c.canonical.z&&!r.leaves[T];L++){u*=2,m*=2;const D=2*Math.floor(m)+Math.floor(u);T=r.childOffsets[T]+D,u%=1,m%=1}return{min:this.exaggeration()*r.minimums[T],max:this.exaggeration()*r.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let t=!1,r=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const f of a){const u=this.getMinMaxForTile(f.tileID);u&&(r=Math.min(r,u.min),c=Math.max(c,u.max),t=!0)}return t?{min:r,max:c}:null}},n.cF=my,n.cG=Gc,n.cH=function(a,t){return[Math.pow(a[0],2.2)*t,Math.pow(a[1],2.2)*t,Math.pow(a[2],2.2)*t]},n.cI=ay,n.cJ=ie,n.cK=ye,n.cL=256,n.cM=function(a,t){const r=[0,0,0],c=Af(Hl(t.canonical));return Qe.vec3.transformMat4(r,r,c),Qe.vec3.transformMat4(r,r,a),r},n.cN=a=>({u_camera_to_center_distance:new lo(a),u_extrude_scale:new cp(a),u_device_pixel_ratio:new lo(a),u_matrix:new Eu(a),u_inv_rot_matrix:new Eu(a),u_merc_center:new Wa(a),u_tile_id:new nd(a),u_zoom_transition:new lo(a),u_up_dir:new nd(a),u_emissive_strength:new lo(a)}),n.cO=a=>({u_matrix:new Eu(a),u_pixels_to_tile_units:new cp(a),u_device_pixel_ratio:new lo(a),u_units_to_pixels:new Wa(a),u_dash_image:new bl(a),u_gradient_image:new bl(a),u_image_height:new lo(a),u_texsize:new Wa(a),u_tile_units_to_pixels:new lo(a),u_alpha_discard_threshold:new lo(a),u_trim_offset:new Wa(a),u_trim_fade_range:new Wa(a),u_trim_color:new Vc(a),u_emissive_strength:new lo(a),u_zbias_factor:new lo(a),u_tile_to_meter:new lo(a)}),n.cP=a=>({u_matrix:new Eu(a),u_texsize:new Wa(a),u_pixels_to_tile_units:new cp(a),u_device_pixel_ratio:new lo(a),u_image:new bl(a),u_units_to_pixels:new Wa(a),u_tile_units_to_pixels:new lo(a),u_alpha_discard_threshold:new lo(a),u_trim_offset:new Wa(a),u_emissive_strength:new lo(a),u_zbias_factor:new lo(a),u_tile_to_meter:new lo(a)}),n.cQ=yu,n.cR=Th,n.cS=lA,n.cT=$g,n.cU=(a,t,r,c,f,u)=>{const m=a.transform,T=m.projection.name==="globe";let L;if(u.paint.get("circle-pitch-alignment")==="map")if(T){const b=ay(m.zoom,t.canonical)*m._pixelsPerMercatorPixel;L=Float32Array.from([b,0,0,b])}else L=m.calculatePixelsToTileUnitsMatrix(r);else L=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(m.projection),u_matrix:a.translatePosMatrix(t.projMatrix,r,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:tn.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:uy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(T){D.u_inv_rot_matrix=c,D.u_merc_center=f,D.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],D.u_zoom_transition=jc(m.zoom);const b=f[0]*un,C=f[1]*un;D.u_up_dir=m.projection.upVector(new Mo(0,0,0),b,C)}return D},n.cV=sn,n.cW=(a,t,r,c,f,u)=>{const m=a.transform,T=m.pitch<15?jt(.07,.7,Mt((14-m.zoom)/5,0,1)):.07;return{u_matrix:Ri(a,t,r,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:f,u_image:0,u_tile_units_to_pixels:rn(t,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u,u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:T,u_tile_to_meter:gt(t.tileID.canonical,0)}},n.cX=(a,t,r,c,f,u,m)=>{const T=a.transform,L=T.calculatePixelsToTileUnitsMatrix(t),D=T.pitch<15?jt(.07,.7,Mt((14-T.zoom)/5,0,1)):.07;return{u_matrix:Ri(a,t,r,c),u_pixels_to_tile_units:L,u_device_pixel_ratio:u,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:On(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:rn(t,a.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:gt(t.tileID.canonical,0)}},n.cY=Mn,n.cZ=If,n.c_=rl,n.ca=ls,n.cb=Lo,n.cc=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},n.cd=function(a){return a({pluginStatus:Ko,pluginURL:Ua}),qd.on("pluginStateChange",a),a},n.ce=Wm,n.cf=e0,n.cg=Um,n.ch=vv,n.ci=Go,n.cj=Am,n.ck=Jn,n.cl=Te,n.cm=$r,n.cn=function(a){const t=a.indexOf(oh);return t>=0?a.slice(0,t):a},n.co=function(a){const t=a.indexOf(oh);return t>=0?a.slice(t+1):""},n.cp=function(a){const t=[],r=a.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},n.cq=function(a,t,r,c){return a.type==="custom"?new NA(a,t):new KA[a.type](a,t,r,c)},n.cr=eo,n.cs=qd,n.ct=fo,n.cu=op,n.cv=class extends Ul{constructor(a){super(a),this.current=ap}set(a,t,r){if(this.fetchUniformLocation(a,t)){for(let c=0;c<9;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.cw=st,n.cx=function(a,t,r){const c=jc(r.zoom),f=a.style.map._antialias,u=t.options.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return c===0&&!f&&!u},n.cy=function(a){const t=a.pixelsPerMeter,r=t/ge(1,a.center.lat),c=Qe.mat4.identity(new Float64Array(16));return Qe.mat4.translate(c,c,[a.point.x,a.point.y,0]),Qe.mat4.scale(c,c,[r,r,t]),Float32Array.from(c)},n.cz=dp,n.d=function(a){return qe.API_TILEJSON_REGEX.test(a)},n.d$=J,n.d0=or,n.d1=ti,n.d2=450,n.d3=7,n.d4=BA,n.d5=Qr,n.d6=Nc,n.d7=256,n.d8=Lm,n.d9=tc,n.dA=Wg,n.dB=function(a){const t=[0,0,0],r=Qe.mat4.identity(new Float64Array(16));return Qe.mat4.multiply(r,a.pixelMatrix,a.globeMatrix),Qe.vec3.transformMat4(t,t,r),new je(t[0],t[1])},n.dC=function(a,t,r=!1){if(Ko===pf||Ko===Qu||Ko===eh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ua=tn.resolveURL(a),Ko=pf,Wd=t,ff(),r||Kh()},n.dD=mf,n.dE=function(){e0().acquire(Gv)},n.dF=function(){const a=C_;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(Gv),C_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dG=A_,n.dH=function(a){const t=Jr();if(!t)return;const r=t.delete(sr);a&&r.catch(a).then(()=>a())},n.dI=E_,n.dJ=eT,n.dK=function(a){Hv=tn.resolveURL(a),Zm||(Zm=new Wm(e0(),new bi)),Zm.broadcast("setDracoUrl",Hv)},n.dL=tT,n.dM=function(a){$m=tn.resolveURL(a),Zm||(Zm=new Wm(e0(),new bi)),Zm.broadcast("setMeshoptUrl",$m)},n.dN=Sn,n.dO=Wc,n.dP=Lu,n.dQ=uT,n.dR=hT,n.dS=o_,n.dT=Tr,n.dU=Hb,n.dV=function(a,t,r,c,f,u,m,T,L,D,b=1,C){a.createArrays(),a.tilePixelRatio=un/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const R=a.layers[0].layout,A=a.layers[0]._unevaluatedLayout._values,I={};if(I.scaleFactor=b,I.textSizeScaleRange=R.get("text-size-scale-range"),I.iconSizeScaleRange=R.get("icon-size-scale-range"),I.textScaleFactor=Mt(I.scaleFactor,I.textSizeScaleRange[0],I.textSizeScaleRange[1]),I.iconScaleFactor=Mt(I.scaleFactor,I.iconSizeScaleRange[0],I.iconSizeScaleRange[1]),a.textSizeData.kind==="composite"){const{minZoom:ee,maxZoom:te}=a.textSizeData;I.compositeTextSizes=[A["text-size"].possiblyEvaluate(new Qs(ee),T),A["text-size"].possiblyEvaluate(new Qs(te),T)]}if(a.iconSizeData.kind==="composite"){const{minZoom:ee,maxZoom:te}=a.iconSizeData;I.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new Qs(ee),T),A["icon-size"].possiblyEvaluate(new Qs(te),T)]}I.layoutTextSize=A["text-size"].possiblyEvaluate(new Qs(L+1),T),I.layoutIconSize=A["icon-size"].possiblyEvaluate(new Qs(L+1),T),I.textMaxSize=A["text-size"].possiblyEvaluate(new Qs(18),T);const k=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",W=R.get("text-size");let $=!1;for(const ee of a.features)if(ee.icon&&ee.icon.nameSecondary){$=!0;break}for(const ee of a.features){const te=R.get("text-font").evaluate(ee,{},T).join(","),X=W.evaluate(ee,{},T)*I.textScaleFactor,le=I.layoutTextSize.evaluate(ee,{},T)*I.textScaleFactor,he=(I.layoutIconSize.evaluate(ee,{},T),{horizontal:{},vertical:void 0}),Me=ee.text;let He,ze=[0,0];if(Me){const ke=Me.toString(),dt=R.get("text-letter-spacing").evaluate(ee,{},T)*zs,Et=R.get("text-line-height").evaluate(ee,{},T)*zs,Ct=df(ke)?dt:0,Bt=R.get("text-anchor").evaluate(ee,{},T),ei=R.get("text-variable-anchor");if(!ei){const di=R.get("text-radial-offset").evaluate(ee,{},T);ze=di?Zb(Bt,[di*zs,xv]):R.get("text-offset").evaluate(ee,{},T).map(Tn=>Tn*zs)}let ni=k?"center":R.get("text-justify").evaluate(ee,{},T);const Yt=R.get("symbol-placement")==="point",yi=Yt?R.get("text-max-width").evaluate(ee,{},T)*zs:1/0,Fi=di=>{a.allowVerticalPlacement&&hf(ke)&&(he.vertical=gv(Me,t,r,f,te,yi,Et,Bt,di,Ct,ze,cc.vertical,!0,le,X))};if(!k&&ei){const di=ni==="auto"?ei.map(ln=>bv(ln)):[ni];let Tn=!1;for(let ln=0;ln<di.length;ln++){const $i=di[ln];if(!he.horizontal[$i])if(Tn)he.horizontal[$i]=he.horizontal[0];else{const Di=gv(Me,t,r,f,te,yi,Et,"center",$i,Ct,ze,cc.horizontal,!1,le,X);Di&&(he.horizontal[$i]=Di,Tn=Di.positionedLines.length===1)}}Fi("left")}else{if(ni==="auto"&&(ni=bv(Bt)),Yt||R.get("text-writing-mode").indexOf("horizontal")>=0||!hf(ke)){const di=gv(Me,t,r,f,te,yi,Et,Bt,ni,Ct,ze,cc.horizontal,!1,le,X);di&&(he.horizontal[ni]=di)}Fi(Yt?"left":ni)}}let Be=!1;if(ee.icon&&ee.icon.namePrimary){const ke=c[ee.icon.namePrimary];ke&&(He=yA(f[ee.icon.namePrimary],ee.icon.nameSecondary?f[ee.icon.nameSecondary]:void 0,R.get("icon-offset").evaluate(ee,{},T),R.get("icon-anchor").evaluate(ee,{},T)),Be=ke.sdf,a.sdfIcons===void 0?a.sdfIcons=ke.sdf:a.sdfIcons!==ke.sdf&&Wn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==a.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}const yt=Yb(he.horizontal)||he.vertical;a.iconsInText||(a.iconsInText=!!yt&&yt.iconsInText),(yt||He)&&SA(a,ee,he,He,c,I,le,0,ze,Be,m,T,D,C,$)}u&&a.generateCollisionDebugBuffers(L,a.collisionBoxArray,I.textScaleFactor)},n.dW=oe,n.dX=Qy,n.dY=bt,n.dZ=ne,n.d_=Cb,n.da=Fc,n.db=Jd,n.dc=function(a,t,r,c,f){return Mt((a-t)/(r-t)*(f-c)+c,c,f)},n.dd=Bd,n.de=Ze,n.df=class{constructor(a,t,r,c){this.context=a,this.format=c,this.size=r,this.texture=a.gl.createTexture();const[f,u,m]=this.size,{gl:T}=a;T.bindTexture(T.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,f,u,m,0,Cv(this.format),Lv(this.format),t.data)}bind(a,t){const{context:r}=this,{gl:c}=r;c.bindTexture(c.TEXTURE_3D,this.texture),a!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,a),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,a),this.minFilter=a),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},n.dg=Dv,n.dh=[1,1,1],n.di=jm,n.dj=Hm,n.dk=il,n.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new je(1/0,1/0),max:new je(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,t=!1){const r=Bi(new je(0,0),new je(un,un),a),c=[];if(t&&!_i(r,this._globalClipBounds))return c;for(const f of this._activeRegions){if(f.hiddenByOverlap||!_i(r,f))continue;const u=Li(f.min,f.max,a);c.push({min:u.min,max:u.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return c}setSources(a){this._setSources(a.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const r=[];for(const c of t.cache.getVisibleCoordinates()){const f=t.cache.getTile(c).buckets[t.layer];f&&f.updateFootprints(c.toUnwrapped(),r)}return r},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(a){const t=a.getFootprints();if(t.length===0)return;const r=a.getOrder(),c=a.getClipMask(),f=a.getClipScope();for(const u of t){if(!u.footprint)continue;const m=Bi(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:r,clipMask:c,clipScope:f})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,r)=>t.priority-r.priority||Ht(t.min,r.min)||Ht(t.max,r.max)||t.order-r.order||t.clipMask-r.clipMask||function(c,f){const u=(m,T)=>m+T;return c.length-f.length||c.reduce(u,"").localeCompare(f.reduce(u,""))}(t.clipScope,r.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let t=0;for(;!a&&t!==this._activeRegions.length;){const r=this._activeRegions[t],c=this._prevRegions[t];a=r.priority!==c.priority||!Xt(r,c)||r.order!==c.order||r.clipMask!==c.clipMask||!Ot(r.clipScope,c.clipScope),++t}}if(a){++this._updateTime;for(const r of this._activeRegions)r.order!==xt&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const t=r=>{const c=this._activeRegions;if(r>=c.length)return r;const f=c[r].priority;for(;r<c.length&&c[r].priority===f;)++r;return r};if(this._sourceIds.length>1){let r=0,c=t(r);for(;r!==c;){let f=r;const u=r;for(;f!==c;){const m=this._activeRegions[f];m.hiddenByOverlap=!1;for(let T=0;T<u;T++){const L=this._activeRegions[T];if(!L.hiddenByOverlap&&m.order===xt&&_i(m,L)&&(m.hiddenByOverlap=Zn(m.footprint,m.tileId,L.footprint,L.tileId),m.hiddenByOverlap))break}++f}r=c,c=t(r)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=a.length-1;t>=0;t--)this._addSource(a[t]);this._computeReplacement()}},n.dm=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,t){const r=new ec,c=new qs,f=[],u=a+1+2,m=t[0]+1,T=t[0]+1+(1+t.length),L=(D,b,C)=>{let R=D===u-1?D-2:D===0?D:D-1;return R+=C?24575:0,[R,b]};for(let D=0;D<u;++D)r.emplaceBack(...L(D,0,!0));for(let D=0;D<m;++D)for(let b=0;b<u;++b)r.emplaceBack(...L(b,D,(b===0||b===u-1)&&!0));for(let D=0;D<t.length;++D){const b=t[D];for(let C=0;C<u;++C)r.emplaceBack(...L(C,b,!0))}for(let D=0;D<t.length;++D){const b=c.length,C=t[D]+1+2,R=new qs;for(let k=0;k<C-1;k++){const W=k===C-2,$=W?u*(T-t.length+D-k):u;for(let ee=0;ee<u-1;ee++){const te=k*u+ee;k===0||W||ee===0||ee===u-2?(R.emplaceBack(te+1,te,te+$),R.emplaceBack(te+$,te+$+1,te+1)):(c.emplaceBack(te+1,te,te+$),c.emplaceBack(te+$,te+$+1,te+1))}}const A=Ks.simpleSegment(0,b,r.length,c.length-b);for(let k=0;k<R.uint16.length;k+=3)c.emplaceBack(R.uint16[k],R.uint16[k+1],R.uint16[k+2]);const I=Ks.simpleSegment(0,b,r.length,c.length-b);f.push({withoutSkirts:A,withSkirts:I})}return{vertices:r,indices:c,segments:f}}_createGrid(a){const t=this._fillGridMeshWithLods(s,d);this._gridSegments=t.segments,this._gridBuffer=a.createVertexBuffer(t.vertices,Tl.members),this._gridIndexBuffer=a.createIndexBuffer(t.indices,!0)}_createPoles(a){const t=new qs;for(let m=0;m<=s;m++)t.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=a.createIndexBuffer(t,!0);const r=new Fc,c=new Fc,f=new Fc,u=new Fc;this._poleSegments=[];for(let m=0,T=0;m<ho;m++){const L=360/(1<<m);r.emplaceBack(0,-Qo,0,.5,0),c.emplaceBack(0,-Qo,0,.5,1),f.emplaceBack(0,-Qo,0,.5,.5),u.emplaceBack(0,-Qo,0,.5,.5);for(let D=0;D<=s;D++){let b=D/s,C=0;const R=Pe(0,L,b),[A,I,k]=E(ly,cy,R,Qo);r.emplaceBack(A,I,k,b,C),c.emplaceBack(A,I,k,b,1-C);const W=Fe(R);b=.5+.5*Math.sin(W),C=.5+.5*Math.cos(W),f.emplaceBack(A,I,k,b,C),u.emplaceBack(A,I,k,b,1-C)}this._poleSegments.push(Ks.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(r,Os,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(c,Os,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(f,Os,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(u,Os,!1)}getGridBuffers(a,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},n.dn=xt,n.dp=lt,n.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.dr=Tt,n.ds=it,n.dt=O,n.du=function([a,t,r]){const c=Math.hypot(a,t,r),f=Math.atan2(a,r),u=.5*Math.PI-Math.acos(-t/c);return new H(Ge(f),Ge(u))},n.dv=Pv,n.dw=B,n.dx=function(a){const t=a.navigator?a.navigator.userAgent:null;return!!function(r){if(Dr==null){const c=r.navigator?r.navigator.userAgent:null;Dr=!!r.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Dr}(a)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dy=function(a,t){ar=a,er=t},n.dz=Im,n.e=qe,n.e0=function(a){let t=0;if(new Uint32Array(a,0,1)[0]!==nT){const r=new Uint32Array(a,0,7),[,,c,f,u,m]=r;t=r.byteLength+f+u+m+u,(c!==a.byteLength||t>=a.byteLength)&&Wn("Invalid b3dm header information.")}return aT(a,t)},n.e1=function(a,t){const r=cT(a);for(const c of r){for(const f of c.meshes)F3(f);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(B3(c.lights,t)))}return r},n.e2=Jy,n.e3=Fw,n.e4=oa,n.e5=function(a){us(),Gr!=null&&Gr.then(t=>{t.keys().then(r=>{for(let c=0;c<r.length-a;c++)t.delete(r[c])})})},n.f=function(a){return a.indexOf("mapbox:")===0},n.g=function(a,t){return fo(cn(a,{method:"GET"}),t)},n.h=St,n.i=function(a){return qe.API_STYLE_REGEX.test(a)&&!ut(a)},n.j=function(a){return decodeURIComponent(atob(a).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(t,r)=>String.fromCharCode(+("0x"+r))))},n.l=cn,n.m=es,n.n=function(a,t){return fo(cn(a,{type:"json"}),t)},n.o=pa,n.p=function(a,t){return fo(cn(a,{method:"POST"}),t)},n.q=tn,n.r=wa,n.s=function(a){try{const t=self[a];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Pt,n.u=function(){return function a(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},n.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},n.w=Wn,n.x=Ve,n.y=2,n.z=Gb}),q(["./shared"],function(n){function J(oi){const ye=oi?oi.url.toString():void 0;return ye?performance.getEntriesByName(ye):[]}function re(oi){if(typeof oi=="number"||typeof oi=="boolean"||typeof oi=="string"||oi==null)return JSON.stringify(oi);if(Array.isArray(oi)){let ie="[";for(const qe of oi)ie+=`${re(qe)},`;return`${ie}]`}let ye="{";for(const ie of Object.keys(oi).sort())ye+=`${ie}:${re(oi[ie])},`;return`${ye}}`}function ce(oi){let ye="";for(const ie of n.bh)ye+=`/${re(oi[ie])}`;return ye}class Se{constructor(ye){this.keyCache={},this._layers={},this._layerConfigs={},ye&&this.replace(ye)}replace(ye,ie){this._layerConfigs={},this._layers={},this.update(ye,[],ie)}update(ye,ie,qe){this._options=qe;for(const ut of ye)this._layerConfigs[ut.id]=ut,(this._layers[ut.id]=n.cq(ut,this.scope,null,this._options)).compileFilter(qe),this.keyCache[ut.id]&&delete this.keyCache[ut.id];for(const ut of ie)delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut];this.familiesBySource={};const St=function(ut,Ft){const si={};for(let ai=0;ai<ut.length;ai++){const fi=Ft&&Ft[ut[ai].id]||ce(ut[ai]);Ft&&(Ft[ut[ai].id]=fi);let pi=si[fi];pi||(pi=si[fi]=[]),pi.push(ut[ai])}const $t=[];for(const ai in si)$t.push(si[ai]);return $t}(n.be(this._layerConfigs),this.keyCache);for(const ut of St){const Ft=ut.map(Pi=>this._layers[Pi.id]),si=Ft[0];if(si.visibility==="none")continue;const $t=si.source||"";let ai=this.familiesBySource[$t];ai||(ai=this.familiesBySource[$t]={});const fi=si.sourceLayer||"_geojsonTileLayer";let pi=ai[fi];pi||(pi=ai[fi]=[]),pi.push(Ft)}}}const Xe=1*n.dP;class ht{constructor(ye){const ie={},qe=[];for(const si in ye){const $t=ye[si],ai=ie[si]={};for(const fi in $t.glyphs){const pi=$t.glyphs[+fi];if(!pi||pi.bitmap.width===0||pi.bitmap.height===0)continue;const Pi=pi.metrics.localGlyph?Xe:1,tn={x:0,y:0,w:pi.bitmap.width+2*Pi,h:pi.bitmap.height+2*Pi};qe.push(tn),ai[fi]=tn}}const{w:St,h:ut}=n.z(qe),Ft=new n.dO({width:St||1,height:ut||1});for(const si in ye){const $t=ye[si];for(const ai in $t.glyphs){const fi=$t.glyphs[+ai];if(!fi||fi.bitmap.width===0||fi.bitmap.height===0)continue;const pi=ie[si][ai],Pi=fi.metrics.localGlyph?Xe:1;n.dO.copy(fi.bitmap,Ft,{x:0,y:0},{x:pi.x+Pi,y:pi.y+Pi},fi.bitmap)}}this.image=Ft,this.positions=ie}}n.dN(ht,"GlyphAtlas");class Ut{constructor(ye){this.tileID=new n.aA(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),this.tileZoom=ye.tileZoom,this.uid=ye.uid,this.zoom=ye.zoom,this.lut=ye.lut,this.canonical=ye.tileID.canonical,this.pixelRatio=ye.pixelRatio,this.tileSize=ye.tileSize,this.source=ye.source,this.scope=ye.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ye.showCollisionBoxes,this.collectResourceTiming=!!ye.request&&ye.request.collectResourceTiming,this.promoteId=ye.promoteId,this.isSymbolTile=ye.isSymbolTile,this.tileTransform=n.aL(ye.tileID.canonical,ye.projection),this.projection=ye.projection,this.worldview=ye.worldview,this.localizableLayerIds=ye.localizableLayerIds,this.brightness=ye.brightness,this.extraShadowCaster=!!ye.extraShadowCaster,this.tessellationStep=ye.tessellationStep,this.scaleFactor=ye.scaleFactor}parse(ye,ie,qe,St,ut){this.status="parsing",this.data=ye,this.collisionBoxArray=new n.aR;const Ft=new n.dQ(Object.keys(ye.layers).sort()),si=new n.dR(this.tileID,this.promoteId);si.bucketLayerIDs=[];const $t={},ai=new n.dS(256,256),fi={featureIndex:si,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:ai,availableImages:qe,brightness:this.brightness},pi=ie.familiesBySource[this.source];for(const er in pi){const Zr=ye.layers[er];if(!Zr)continue;let Gr=!1,yr=!1,Jr=!1;for(const es of pi[er])es[0].type==="symbol"?Gr=!0:yr=!0,es[0].is3D()&&es[0].type!=="model"&&(Jr=!0);if(this.extraShadowCaster&&!Jr||this.isSymbolTile===!0&&!Gr||this.isSymbolTile===!1&&!yr)continue;Zr.version===1&&n.w(`Vector tile source "${this.source}" layer "${er}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const us=Ft.encode(er),Ns=[];for(let es=0,Fs=0;es<Zr.length;es++){const Ps=Zr.feature(es),wo=si.getId(Ps,er);if(this.localizableLayerIds&&this.localizableLayerIds.has(er)){const Xo=Ps.properties?Ps.properties.worldview:null;if(this.worldview&&typeof Xo=="string")if(Xo==="all")Ps.properties.$localized=!0;else{if(!Xo.split(",").includes(this.worldview))continue;Ps.properties.$localized=!0,Ps.properties.worldview=this.worldview}}Ns.push({feature:Ps,id:wo,index:Fs,sourceLayerIndex:us}),Fs++}for(const es of pi[er]){const Fs=es[0];(!this.extraShadowCaster||Fs.is3D()&&Fs.type!=="model")&&(this.isSymbolTile!==void 0&&Fs.type==="symbol"!==this.isSymbolTile||Fs.minzoom&&this.zoom<Math.floor(Fs.minzoom)||Fs.maxzoom&&this.zoom>=Fs.maxzoom||Fs.visibility!=="none"&&(ct(es,this.zoom,fi.brightness,qe),($t[Fs.id]=Fs.createBucket({index:si.bucketLayerIDs.length,layers:es,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:us,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ns,fi,this.tileID.canonical,this.tileTransform),si.bucketLayerIDs.push(es.map(Ps=>n.av(Ps.id,Ps.scope)))))}}let Pi,tn,xn,Jn;ai.trim();const sr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ar=()=>{if(Pi)return this.status="done",ut(Pi);if(this.extraShadowCaster)this.status="done",ut(null,{buckets:n.be($t).filter(er=>!er.isEmpty()),featureIndex:si,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:fi.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(tn&&xn&&Jn){const er=new ht(tn),Zr=new n.dU(xn,Jn,this.lut);for(const Gr in $t){const yr=$t[Gr];yr instanceof n.aS?(ct(yr.layers,this.zoom,fi.brightness,qe),n.dV(yr,tn,er.positions,xn,Zr.iconPositions,this.showCollisionBoxes,qe,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):yr.hasPattern&&(yr instanceof n.aY||yr instanceof n.aZ||yr instanceof n.d0)&&(ct(yr.layers,this.zoom,fi.brightness,qe),yr.addFeatures(fi,this.tileID.canonical,Zr.patternPositions,qe,this.tileTransform,this.brightness))}this.status="done",ut(null,{buckets:n.be($t).filter(Gr=>!Gr.isEmpty()),featureIndex:si,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:er.image,lineAtlas:ai,imageAtlas:Zr,brightness:fi.brightness})}};if(!this.extraShadowCaster){const er=n.dT(fi.glyphDependencies,yr=>Object.keys(yr).map(Number));Object.keys(er).length?St.send("getGlyphs",{uid:this.uid,stacks:er,scope:this.scope},(yr,Jr)=>{Pi||(Pi=yr,tn=Jr,ar())},void 0,!1,sr):tn={};const Zr=Object.keys(fi.iconDependencies);Zr.length?St.send("getImages",{icons:Zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(yr,Jr)=>{Pi||(Pi=yr,xn=Jr,ar())},void 0,!1,sr):xn={};const Gr=Object.keys(fi.patternDependencies);Gr.length?St.send("getImages",{icons:Gr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(yr,Jr)=>{Pi||(Pi=yr,Jn=Jr,ar())},void 0,!1,sr):Jn={}}ar()}}function ct(oi,ye,ie,qe){const St=new n.a3(ye,{brightness:ie});for(const ut of oi)ut.recalculate(St,qe)}class Dt extends n.E{constructor(ye,ie,qe,St,ut,Ft){super(),this.actor=ye,this.layerIndex=ie,this.availableImages=qe,this.loadVectorData=ut||n.aw,this.loading={},this.loaded={},this.deduped=new n.au(ye.scheduler),this.isSpriteLoaded=St,this.scheduler=ye.scheduler,this.brightness=Ft}loadTile(ye,ie){const qe=ye.uid,St=ye&&ye.request,ut=St&&St.collectResourceTiming,Ft=this.loading[qe]=new Ut(ye);Ft.abort=this.loadVectorData(ye,(si,$t)=>{const ai=!this.loading[qe];if(delete this.loading[qe],ai||si||!$t)return Ft.status="done",ai||(this.loaded[qe]=Ft),ie(si);const fi=$t.rawData,pi={};$t.expires&&(pi.expires=$t.expires),$t.cacheControl&&(pi.cacheControl=$t.cacheControl),Ft.vectorTile=$t.vectorTile||new n.dW.VectorTile(new n.bc(fi));const Pi=()=>{Ft.parse(Ft.vectorTile,this.layerIndex,this.availableImages,this.actor,(tn,xn)=>{if(tn||!xn)return ie(tn);const Jn={};if(ut){const sr=J(St);sr.length>0&&(Jn.resourceTiming=JSON.parse(JSON.stringify(sr)))}ie(null,n.l({rawTileData:fi.slice(0)},xn,pi,Jn))})};this.isSpriteLoaded?Pi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Pi,{type:"parseTile",isSymbolTile:ye.isSymbolTile,zoom:ye.tileZoom}):Pi()}),this.loaded=this.loaded||{},this.loaded[qe]=Ft})}reloadTile(ye,ie){const qe=this.loaded,St=ye.uid;if(qe&&qe[St]){const ut=qe[St];ut.scaleFactor=ye.scaleFactor,ut.showCollisionBoxes=ye.showCollisionBoxes,ut.projection=ye.projection,ut.brightness=ye.brightness,ut.tileTransform=n.aL(ye.tileID.canonical,ye.projection),ut.extraShadowCaster=ye.extraShadowCaster,ut.lut=ye.lut;const Ft=(si,$t)=>{const ai=ut.reloadCallback;ai&&(delete ut.reloadCallback,ut.parse(ut.vectorTile,this.layerIndex,this.availableImages,this.actor,ai)),ie(si,$t)};ut.status==="parsing"?ut.reloadCallback=Ft:ut.status==="done"&&(ut.vectorTile?ut.parse(ut.vectorTile,this.layerIndex,this.availableImages,this.actor,Ft):Ft())}else ie(null,void 0)}abortTile(ye,ie){const qe=ye.uid,St=this.loading[qe];St&&(St.abort&&St.abort(),delete this.loading[qe]),ie()}removeTile(ye,ie){const qe=this.loaded,St=ye.uid;qe&&qe[St]&&delete qe[St],ie()}}class rt{loadTile(ye,ie){const{uid:qe,encoding:St,rawImageData:ut,padding:Ft}=ye,si=ImageBitmap&&ut instanceof ImageBitmap?this.getImageData(ut,Ft):ut;ie(null,new n.dX(qe,si,St,Ft<1))}getImageData(ye,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ye.width,ye.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ye.width,this.offscreenCanvas.height=ye.height,this.offscreenCanvasContext.drawImage(ye,0,0,ye.width,ye.height);const qe=this.offscreenCanvasContext.getImageData(-ie,-ie,ye.width+2*ie,ye.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),qe}}n.bb.setPbf(n.bc);class pt{decodeRasterArray({task:ye,buffer:ie},qe){n.bb.performDecoding(ie,ye).then(St=>{qe(null,St)},St=>{qe(St)})}}const gi=n.dW.VectorTileFeature.prototype.toGeoJSON;class Zt{constructor(ye){this._feature=ye,this.extent=n.ab,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){const ye=[];for(const ie of this._feature.geometry)ye.push([new n.P(ie[0],ie[1])]);return ye}{const ye=[];for(const ie of this._feature.geometry){const qe=[];for(const St of ie)qe.push(new n.P(St[0],St[1]));ye.push(qe)}return ye}}toGeoJSON(ye,ie,qe){return gi.call(this,ye,ie,qe)}}class At{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ab,this.length=ye.length,this._features=ye}feature(ye){return new Zt(this._features[ye])}}const It=64/4096,Ye=128;class ot{constructor(){this.features=new Map}clear(){this.features.clear()}load(ye=[],ie){for(const qe of ye){const St=qe.id;if(St==null)continue;let ut=this.features.get(St);ut&&this.updateCache(ut,ie),qe.geometry?(ut=et(qe),this.updateCache(ut,ie),this.features.set(St,ut)):this.features.delete(St),this.updateCache(ut,ie)}}updateCache(ye,ie){for(const{canonical:qe,uid:St}of Object.values(ie)){const{z:ut,x:Ft,y:si}=qe;tt(ye,Math.pow(2,ut),Ft,si)&&delete ie[St]}}getTile(ye,ie,qe){const St=Math.pow(2,ye),ut=[];for(const Ft of this.features.values())tt(Ft,St,ie,qe)&&ut.push(Qt(Ft,St,ie,qe));return{features:ut}}getFeatures(){return[...this.features.values()]}}function tt({minX:oi,minY:ye,maxX:ie,maxY:qe},St,ut,Ft){return oi<(ut+1+It)/St&&ye<(Ft+1+It)/St&&ie>(ut-It)/St&&qe>(Ft-It)/St}function et(oi){const{id:ye,geometry:ie,properties:qe}=oi;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:St,coordinates:ut}=ie,Ft={id:ye,type:1,geometry:[],tags:qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},si=Ft.geometry;if(St==="Point")Rt(ut,si,Ft);else if(St==="MultiPoint")for(const $t of ut)Rt($t,si,Ft);else if(St==="LineString")Ft.type=2,at(ut,si,Ft);else if(St==="MultiLineString")Ft.type=2,_t(ut,si,Ft);else if(St==="Polygon")Ft.type=3,_t(ut,si,Ft,!0);else{if(St!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ft.type=3;for(const $t of ut)_t($t,si,Ft,!0)}return Ft}function Rt([oi,ye],ie,qe){const St=n.am(oi);let ut=n.at(ye);ut=ut<0?0:ut>1?1:ut,ie.push(St,ut),qe.minX=Math.min(qe.minX,St),qe.minY=Math.min(qe.minY,ut),qe.maxX=Math.max(qe.maxX,St),qe.maxY=Math.max(qe.maxY,ut)}function at(oi,ye,ie,qe=!1,St=!1){const ut=[];for(const Ft of oi)Rt(Ft,ut,ie);ye.push(ut),qe&&function(Ft,si){let $t=0;for(let ai=0,fi=Ft.length,pi=fi-2;ai<fi;pi=ai,ai+=2)$t+=(Ft[ai]-Ft[pi])*(Ft[ai+1]+Ft[pi+1]);if($t>0===si)for(let ai=0,fi=Ft.length;ai<fi/2;ai+=2){const pi=Ft[ai],Pi=Ft[ai+1];Ft[ai]=Ft[fi-2-ai],Ft[ai+1]=Ft[fi-1-ai],Ft[fi-2-ai]=pi,Ft[fi-1-ai]=Pi}}(ut,St)}function _t(oi,ye,ie,qe=!1){for(let St=0;St<oi.length;St++)at(oi[St],ye,ie,qe,St===0)}function Qt(oi,ye,ie,qe){const{id:St,type:ut,geometry:Ft,tags:si}=oi,$t=[];if(ut===1)(function(ai,fi,pi,Pi,tn){for(let xn=0;xn<ai.length;xn+=2){const Jn=Math.round(n.ab*(ai[xn+0]*fi-pi)),sr=Math.round(n.ab*(ai[xn+1]*fi-Pi));tn.push([Jn,sr])}})(Ft,ye,ie,qe,$t);else for(const ai of Ft)ae(ai,ye,ie,qe,$t);return{id:St,type:ut,geometry:$t,tags:si}}function ae(oi,ye,ie,qe,St){const ut=-Ye,Ft=n.ab+Ye;let si;for(let $t=0;$t<oi.length-2;$t+=2){let ai=Math.round(n.ab*(oi[$t+0]*ye-ie)),fi=Math.round(n.ab*(oi[$t+1]*ye-qe)),pi=Math.round(n.ab*(oi[$t+2]*ye-ie)),Pi=Math.round(n.ab*(oi[$t+3]*ye-qe));const tn=pi-ai,xn=Pi-fi;ai<ut&&pi<ut||(ai<ut?(fi+=Math.round(xn*((ut-ai)/tn)),ai=ut):pi<ut&&(Pi=fi+Math.round(xn*((ut-ai)/tn)),pi=ut),fi<ut&&Pi<ut||(fi<ut?(ai+=Math.round(tn*((ut-fi)/xn)),fi=ut):Pi<ut&&(pi=ai+Math.round(tn*((ut-fi)/xn)),Pi=ut),ai>=Ft&&pi>=Ft||(ai>=Ft?(fi+=Math.round(xn*((Ft-ai)/tn)),ai=Ft):pi>=Ft&&(Pi=fi+Math.round(xn*((Ft-ai)/tn)),pi=Ft),fi>=Ft&&Pi>=Ft||(fi>=Ft?(ai+=Math.round(tn*((Ft-fi)/xn)),fi=Ft):Pi>=Ft&&(pi=ai+Math.round(tn*((Ft-fi)/xn)),Pi=Ft),si&&ai===si[si.length-1][0]&&fi===si[si.length-1][1]||(si=[[ai,fi]],St.push(si)),si.push([pi,Pi])))))}}var be,ve,De,Ce={exports:{}},Vt=function(){if(De)return Ce.exports;De=1;var oi=n.d_(),ye=function(){if(ve)return be;ve=1;var fi=n.dY(),pi=n.dZ().VectorTileFeature;function Pi(xn,Jn){this.options=Jn||{},this.features=xn,this.length=xn.length}function tn(xn,Jn){this.id=typeof xn.id=="number"?xn.id:void 0,this.type=xn.type,this.rawGeometry=xn.type===1?[xn.geometry]:xn.geometry,this.properties=xn.tags,this.extent=Jn||4096}return be=Pi,Pi.prototype.feature=function(xn){return new tn(this.features[xn],this.options.extent)},tn.prototype.loadGeometry=function(){var xn=this.rawGeometry;this.geometry=[];for(var Jn=0;Jn<xn.length;Jn++){for(var sr=xn[Jn],ar=[],er=0;er<sr.length;er++)ar.push(new fi(sr[er][0],sr[er][1]));this.geometry.push(ar)}return this.geometry},tn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var xn=this.geometry,Jn=1/0,sr=-1/0,ar=1/0,er=-1/0,Zr=0;Zr<xn.length;Zr++)for(var Gr=xn[Zr],yr=0;yr<Gr.length;yr++){var Jr=Gr[yr];Jn=Math.min(Jn,Jr.x),sr=Math.max(sr,Jr.x),ar=Math.min(ar,Jr.y),er=Math.max(er,Jr.y)}return[Jn,ar,sr,er]},tn.prototype.toGeoJSON=pi.prototype.toGeoJSON,be}();function ie(fi){var pi=new oi;return function(Pi,tn){for(var xn in Pi.layers)tn.writeMessage(3,qe,Pi.layers[xn])}(fi,pi),pi.finish()}function qe(fi,pi){var Pi;pi.writeVarintField(15,fi.version||1),pi.writeStringField(1,fi.name||""),pi.writeVarintField(5,fi.extent||4096);var tn={keys:[],values:[],keycache:{},valuecache:{}};for(Pi=0;Pi<fi.length;Pi++)tn.feature=fi.feature(Pi),pi.writeMessage(2,St,tn);var xn=tn.keys;for(Pi=0;Pi<xn.length;Pi++)pi.writeStringField(3,xn[Pi]);var Jn=tn.values;for(Pi=0;Pi<Jn.length;Pi++)pi.writeMessage(4,ai,Jn[Pi])}function St(fi,pi){var Pi=fi.feature;Pi.id!==void 0&&pi.writeVarintField(1,Pi.id),pi.writeMessage(2,ut,fi),pi.writeVarintField(3,Pi.type),pi.writeMessage(4,$t,Pi)}function ut(fi,pi){var Pi=fi.feature,tn=fi.keys,xn=fi.values,Jn=fi.keycache,sr=fi.valuecache;for(var ar in Pi.properties){var er=Pi.properties[ar],Zr=Jn[ar];if(er!==null){Zr===void 0&&(tn.push(ar),Jn[ar]=Zr=tn.length-1),pi.writeVarint(Zr);var Gr=typeof er;Gr!=="string"&&Gr!=="boolean"&&Gr!=="number"&&(er=JSON.stringify(er));var yr=Gr+":"+er,Jr=sr[yr];Jr===void 0&&(xn.push(er),sr[yr]=Jr=xn.length-1),pi.writeVarint(Jr)}}}function Ft(fi,pi){return(pi<<3)+(7&fi)}function si(fi){return fi<<1^fi>>31}function $t(fi,pi){for(var Pi=fi.loadGeometry(),tn=fi.type,xn=0,Jn=0,sr=Pi.length,ar=0;ar<sr;ar++){var er=Pi[ar],Zr=1;tn===1&&(Zr=er.length),pi.writeVarint(Ft(1,Zr));for(var Gr=tn===3?er.length-1:er.length,yr=0;yr<Gr;yr++){yr===1&&tn!==1&&pi.writeVarint(Ft(2,Gr-1));var Jr=er[yr].x-xn,us=er[yr].y-Jn;pi.writeVarint(si(Jr)),pi.writeVarint(si(us)),xn+=Jr,Jn+=us}tn===3&&pi.writeVarint(Ft(7,1))}}function ai(fi,pi){var Pi=typeof fi;Pi==="string"?pi.writeStringField(1,fi):Pi==="boolean"?pi.writeBooleanField(7,fi):Pi==="number"&&(fi%1!=0?pi.writeDoubleField(3,fi):fi<0?pi.writeSVarintField(6,fi):pi.writeVarintField(5,fi))}return Ce.exports=ie,Ce.exports.fromVectorTileJs=ie,Ce.exports.fromGeojsonVt=function(fi,pi){pi=pi||{};var Pi={};for(var tn in fi)Pi[tn]=new ye(fi[tn].features,pi),Pi[tn].name=tn,Pi[tn].version=pi.version,Pi[tn].extent=pi.extent;return ie({layers:Pi})},Ce.exports.GeoJSONWrapper=ye,Ce.exports}(),zt=n.d$(Vt);const mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oi=>oi},Nt=Math.fround||(Gt=new Float32Array(1),oi=>(Gt[0]=+oi,Gt[0]));var Gt;const ii=3,zi=5,Hi=6;class on{constructor(ye){this.options=Object.assign(Object.create(mt),ye),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ye){const{log:ie,minZoom:qe,maxZoom:St}=this.options;ie&&console.time("total time");const ut=`prepare ${ye.length} points`;ie&&console.time(ut),this.points=ye;const Ft=[];for(let $t=0;$t<ye.length;$t++){const ai=ye[$t];if(!ai.geometry)continue;const[fi,pi]=ai.geometry.coordinates,Pi=Nt(Yn(fi)),tn=Nt(pr(pi));Ft.push(Pi,tn,1/0,$t,-1,1),this.options.reduce&&Ft.push(0)}let si=this.trees[St+1]=this._createTree(Ft);ie&&console.timeEnd(ut);for(let $t=St;$t>=qe;$t--){const ai=+Date.now();si=this.trees[$t]=this._createTree(this._cluster(si,$t)),ie&&console.log("z%d: %d clusters in %dms",$t,si.numItems,+Date.now()-ai)}return ie&&console.timeEnd("total time"),this}getClusters(ye,ie){let qe=((ye[0]+180)%360+360)%360-180;const St=Math.max(-90,Math.min(90,ye[1]));let ut=ye[2]===180?180:((ye[2]+180)%360+360)%360-180;const Ft=Math.max(-90,Math.min(90,ye[3]));if(ye[2]-ye[0]>=360)qe=-180,ut=180;else if(qe>ut){const pi=this.getClusters([qe,St,180,Ft],ie),Pi=this.getClusters([-180,St,ut,Ft],ie);return pi.concat(Pi)}const si=this.trees[this._limitZoom(ie)],$t=si.range(Yn(qe),pr(Ft),Yn(ut),pr(St)),ai=si.data,fi=[];for(const pi of $t){const Pi=this.stride*pi;fi.push(ai[Pi+zi]>1?mn(ai,Pi,this.clusterProps):this.points[ai[Pi+ii]])}return fi}getChildren(ye){const ie=this._getOriginId(ye),qe=this._getOriginZoom(ye),St="No cluster with the specified id.",ut=this.trees[qe];if(!ut)throw new Error(St);const Ft=ut.data;if(ie*this.stride>=Ft.length)throw new Error(St);const si=this.options.radius/(this.options.extent*Math.pow(2,qe-1)),$t=ut.within(Ft[ie*this.stride],Ft[ie*this.stride+1],si),ai=[];for(const fi of $t){const pi=fi*this.stride;Ft[pi+4]===ye&&ai.push(Ft[pi+zi]>1?mn(Ft,pi,this.clusterProps):this.points[Ft[pi+ii]])}if(ai.length===0)throw new Error(St);return ai}getLeaves(ye,ie,qe){const St=[];return this._appendLeaves(St,ye,ie=ie||10,qe=qe||0,0),St}getTile(ye,ie,qe){const St=this.trees[this._limitZoom(ye)],ut=Math.pow(2,ye),{extent:Ft,radius:si}=this.options,$t=si/Ft,ai=(qe-$t)/ut,fi=(qe+1+$t)/ut,pi={features:[]};return this._addTileFeatures(St.range((ie-$t)/ut,ai,(ie+1+$t)/ut,fi),St.data,ie,qe,ut,pi),ie===0&&this._addTileFeatures(St.range(1-$t/ut,ai,1,fi),St.data,ut,qe,ut,pi),ie===ut-1&&this._addTileFeatures(St.range(0,ai,$t/ut,fi),St.data,-1,qe,ut,pi),pi.features.length?pi:null}getClusterExpansionZoom(ye){let ie=this._getOriginZoom(ye)-1;for(;ie<=this.options.maxZoom;){const qe=this.getChildren(ye);if(ie++,qe.length!==1)break;ye=qe[0].properties.cluster_id}return ie}_appendLeaves(ye,ie,qe,St,ut){const Ft=this.getChildren(ie);for(const si of Ft){const $t=si.properties;if($t&&$t.cluster?ut+$t.point_count<=St?ut+=$t.point_count:ut=this._appendLeaves(ye,$t.cluster_id,qe,St,ut):ut<St?ut++:ye.push(si),ye.length===qe)break}return ut}_createTree(ye){const ie=new n.bz(ye.length/this.stride|0,this.options.nodeSize,Float32Array);for(let qe=0;qe<ye.length;qe+=this.stride)ie.add(ye[qe],ye[qe+1]);return ie.finish(),ie.data=ye,ie}_addTileFeatures(ye,ie,qe,St,ut,Ft){for(const si of ye){const $t=si*this.stride,ai=ie[$t+zi]>1;let fi,pi,Pi;if(ai)fi=Qe(ie,$t,this.clusterProps),pi=ie[$t],Pi=ie[$t+1];else{const Jn=this.points[ie[$t+ii]];fi=Jn.properties;const[sr,ar]=Jn.geometry.coordinates;pi=Yn(sr),Pi=pr(ar)}const tn={type:1,geometry:[[Math.round(this.options.extent*(pi*ut-qe)),Math.round(this.options.extent*(Pi*ut-St))]],tags:fi};let xn;xn=ai||this.options.generateId?ie[$t+ii]:this.points[ie[$t+ii]].id,xn!==void 0&&(tn.id=xn),Ft.features.push(tn)}}_limitZoom(ye){return Math.max(this.options.minZoom,Math.min(Math.floor(+ye),this.options.maxZoom+1))}_cluster(ye,ie){const{radius:qe,extent:St,reduce:ut,minPoints:Ft}=this.options,si=qe/(St*Math.pow(2,ie)),$t=ye.data,ai=[],fi=this.stride;for(let pi=0;pi<$t.length;pi+=fi){if($t[pi+2]<=ie)continue;$t[pi+2]=ie;const Pi=$t[pi],tn=$t[pi+1],xn=ye.within($t[pi],$t[pi+1],si),Jn=$t[pi+zi];let sr=Jn;for(const ar of xn){const er=ar*fi;$t[er+2]>ie&&(sr+=$t[er+zi])}if(sr>Jn&&sr>=Ft){let ar,er=Pi*Jn,Zr=tn*Jn,Gr=-1;const yr=(pi/fi<<5)+(ie+1)+this.points.length;for(const Jr of xn){const us=Jr*fi;if($t[us+2]<=ie)continue;$t[us+2]=ie;const Ns=$t[us+zi];er+=$t[us]*Ns,Zr+=$t[us+1]*Ns,$t[us+4]=yr,ut&&(ar||(ar=this._map($t,pi,!0),Gr=this.clusterProps.length,this.clusterProps.push(ar)),ut(ar,this._map($t,us)))}$t[pi+4]=yr,ai.push(er/sr,Zr/sr,1/0,yr,-1,sr),ut&&ai.push(Gr)}else{for(let ar=0;ar<fi;ar++)ai.push($t[pi+ar]);if(sr>1)for(const ar of xn){const er=ar*fi;if(!($t[er+2]<=ie)){$t[er+2]=ie;for(let Zr=0;Zr<fi;Zr++)ai.push($t[er+Zr])}}}}return ai}_getOriginId(ye){return ye-this.points.length>>5}_getOriginZoom(ye){return(ye-this.points.length)%32}_map(ye,ie,qe){if(ye[ie+zi]>1){const Ft=this.clusterProps[ye[ie+Hi]];return qe?Object.assign({},Ft):Ft}const St=this.points[ye[ie+ii]].properties,ut=this.options.map(St);return qe&&ut===St?Object.assign({},ut):ut}}function mn(oi,ye,ie){return{type:"Feature",id:oi[ye+ii],properties:Qe(oi,ye,ie),geometry:{type:"Point",coordinates:[(qe=oi[ye],360*(qe-.5)),bt(oi[ye+1])]}};var qe}function Qe(oi,ye,ie){const qe=oi[ye+zi],St=qe>=1e4?`${Math.round(qe/1e3)}k`:qe>=1e3?Math.round(qe/100)/10+"k":qe,ut=oi[ye+Hi],Ft=ut===-1?{}:Object.assign({},ie[ut]);return Object.assign(Ft,{cluster:!0,cluster_id:oi[ye+ii],point_count:qe,point_count_abbreviated:St})}function Yn(oi){return oi/360+.5}function pr(oi){const ye=Math.sin(oi*Math.PI/180),ie=.5-.25*Math.log((1+ye)/(1-ye))/Math.PI;return ie<0?0:ie>1?1:ie}function bt(oi){const ye=(180-360*oi)*Math.PI/180;return 360*Math.atan(Math.exp(ye))/Math.PI-90}function je(oi,ye,ie,qe){let St=qe;const ut=ye+(ie-ye>>1);let Ft,si=ie-ye;const $t=oi[ye],ai=oi[ye+1],fi=oi[ie],pi=oi[ie+1];for(let Pi=ye+3;Pi<ie;Pi+=3){const tn=Ot(oi[Pi],oi[Pi+1],$t,ai,fi,pi);if(tn>St)Ft=Pi,St=tn;else if(tn===St){const xn=Math.abs(Pi-ut);xn<si&&(Ft=Pi,si=xn)}}St>qe&&(Ft-ye>3&&je(oi,ye,Ft,qe),oi[Ft+2]=St,ie-Ft>3&&je(oi,Ft,ie,qe))}function Ot(oi,ye,ie,qe,St,ut){let Ft=St-ie,si=ut-qe;if(Ft!==0||si!==0){const $t=((oi-ie)*Ft+(ye-qe)*si)/(Ft*Ft+si*si);$t>1?(ie=St,qe=ut):$t>0&&(ie+=Ft*$t,qe+=si*$t)}return Ft=oi-ie,si=ye-qe,Ft*Ft+si*si}function Le(oi,ye,ie,qe){const St={id:oi??null,type:ye,geometry:ie,tags:qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ie(St,ie);else if(ye==="Polygon")Ie(St,ie[0]);else if(ye==="MultiLineString")for(const ut of ie)Ie(St,ut);else if(ye==="MultiPolygon")for(const ut of ie)Ie(St,ut[0]);return St}function Ie(oi,ye){for(let ie=0;ie<ye.length;ie+=3)oi.minX=Math.min(oi.minX,ye[ie]),oi.minY=Math.min(oi.minY,ye[ie+1]),oi.maxX=Math.max(oi.maxX,ye[ie]),oi.maxY=Math.max(oi.maxY,ye[ie+1])}function Fe(oi,ye,ie,qe){if(!ye.geometry)return;const St=ye.geometry.coordinates;if(St&&St.length===0)return;const ut=ye.geometry.type,Ft=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let si=[],$t=ye.id;if(ie.promoteId?$t=ye.properties[ie.promoteId]:ie.generateId&&($t=qe||0),ut==="Point")Ge(St,si);else if(ut==="MultiPoint")for(const ai of St)Ge(ai,si);else if(ut==="LineString")Je(St,si,Ft,!1);else if(ut==="MultiLineString"){if(ie.lineMetrics){for(const ai of St)si=[],Je(ai,si,Ft,!1),oi.push(Le($t,"LineString",si,ye.properties));return}st(St,si,Ft,!1)}else if(ut==="Polygon")st(St,si,Ft,!0);else{if(ut!=="MultiPolygon"){if(ut==="GeometryCollection"){for(const ai of ye.geometry.geometries)Fe(oi,{id:$t,geometry:ai,properties:ye.properties},ie,qe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ai of St){const fi=[];st(ai,fi,Ft,!0),si.push(fi)}}oi.push(Le($t,ut,si,ye.properties))}function Ge(oi,ye){ye.push(lt(oi[0]),Tt(oi[1]),0)}function Je(oi,ye,ie,qe){let St,ut,Ft=0;for(let $t=0;$t<oi.length;$t++){const ai=lt(oi[$t][0]),fi=Tt(oi[$t][1]);ye.push(ai,fi,0),$t>0&&(Ft+=qe?(St*fi-ai*ut)/2:Math.sqrt(Math.pow(ai-St,2)+Math.pow(fi-ut,2))),St=ai,ut=fi}const si=ye.length-3;ye[2]=1,je(ye,0,si,ie),ye[si+2]=1,ye.size=Math.abs(Ft),ye.start=0,ye.end=ye.size}function st(oi,ye,ie,qe){for(let St=0;St<oi.length;St++){const ut=[];Je(oi[St],ut,ie,qe),ye.push(ut)}}function lt(oi){return oi/360+.5}function Tt(oi){const ye=Math.sin(oi*Math.PI/180),ie=.5-.25*Math.log((1+ye)/(1-ye))/Math.PI;return ie<0?0:ie>1?1:ie}function Mt(oi,ye,ie,qe,St,ut,Ft,si){if(qe/=ye,ut>=(ie/=ye)&&Ft<qe)return oi;if(Ft<ie||ut>=qe)return null;const $t=[];for(const ai of oi){const fi=ai.geometry;let pi=ai.type;const Pi=St===0?ai.minX:ai.minY,tn=St===0?ai.maxX:ai.maxY;if(Pi>=ie&&tn<qe){$t.push(ai);continue}if(tn<ie||Pi>=qe)continue;let xn=[];if(pi==="Point"||pi==="MultiPoint")ci(fi,xn,ie,qe,St);else if(pi==="LineString")xi(fi,xn,ie,qe,St,!1,si.lineMetrics);else if(pi==="MultiLineString")cn(fi,xn,ie,qe,St,!1);else if(pi==="Polygon")cn(fi,xn,ie,qe,St,!0);else if(pi==="MultiPolygon")for(const Jn of fi){const sr=[];cn(Jn,sr,ie,qe,St,!0),sr.length&&xn.push(sr)}if(xn.length){if(si.lineMetrics&&pi==="LineString"){for(const Jn of xn)$t.push(Le(ai.id,pi,Jn,ai.tags));continue}pi!=="LineString"&&pi!=="MultiLineString"||(xn.length===1?(pi="LineString",xn=xn[0]):pi="MultiLineString"),pi!=="Point"&&pi!=="MultiPoint"||(pi=xn.length===3?"Point":"MultiPoint"),$t.push(Le(ai.id,pi,xn,ai.tags))}}return $t.length?$t:null}function ci(oi,ye,ie,qe,St){for(let ut=0;ut<oi.length;ut+=3){const Ft=oi[ut+St];Ft>=ie&&Ft<=qe&&_n(ye,oi[ut],oi[ut+1],oi[ut+2])}}function xi(oi,ye,ie,qe,St,ut,Ft){let si=an(oi);const $t=St===0?Fn:Mn;let ai,fi,pi=oi.start;for(let sr=0;sr<oi.length-3;sr+=3){const ar=oi[sr],er=oi[sr+1],Zr=oi[sr+2],Gr=oi[sr+3],yr=oi[sr+4],Jr=St===0?ar:er,us=St===0?Gr:yr;let Ns=!1;Ft&&(ai=Math.sqrt(Math.pow(ar-Gr,2)+Math.pow(er-yr,2))),Jr<ie?us>ie&&(fi=$t(si,ar,er,Gr,yr,ie),Ft&&(si.start=pi+ai*fi)):Jr>qe?us<qe&&(fi=$t(si,ar,er,Gr,yr,qe),Ft&&(si.start=pi+ai*fi)):_n(si,ar,er,Zr),us<ie&&Jr>=ie&&(fi=$t(si,ar,er,Gr,yr,ie),Ns=!0),us>qe&&Jr<=qe&&(fi=$t(si,ar,er,Gr,yr,qe),Ns=!0),!ut&&Ns&&(Ft&&(si.end=pi+ai*fi),ye.push(si),si=an(oi)),Ft&&(pi+=ai)}let Pi=oi.length-3;const tn=oi[Pi],xn=oi[Pi+1],Jn=St===0?tn:xn;Jn>=ie&&Jn<=qe&&_n(si,tn,xn,oi[Pi+2]),Pi=si.length-3,ut&&Pi>=3&&(si[Pi]!==si[0]||si[Pi+1]!==si[1])&&_n(si,si[0],si[1],si[2]),si.length&&ye.push(si)}function an(oi){const ye=[];return ye.size=oi.size,ye.start=oi.start,ye.end=oi.end,ye}function cn(oi,ye,ie,qe,St,ut){for(const Ft of oi)xi(Ft,ye,ie,qe,St,ut,!1)}function _n(oi,ye,ie,qe){oi.push(ye,ie,qe)}function Fn(oi,ye,ie,qe,St,ut){const Ft=(ut-ye)/(qe-ye);return _n(oi,ut,ie+(St-ie)*Ft,1),Ft}function Mn(oi,ye,ie,qe,St,ut){const Ft=(ut-ie)/(St-ie);return _n(oi,ye+(qe-ye)*Ft,ut,1),Ft}function jn(oi,ye){const ie=[];for(let qe=0;qe<oi.length;qe++){const St=oi[qe],ut=St.type;let Ft;if(ut==="Point"||ut==="MultiPoint"||ut==="LineString")Ft=Lr(St.geometry,ye);else if(ut==="MultiLineString"||ut==="Polygon"){Ft=[];for(const si of St.geometry)Ft.push(Lr(si,ye))}else if(ut==="MultiPolygon"){Ft=[];for(const si of St.geometry){const $t=[];for(const ai of si)$t.push(Lr(ai,ye));Ft.push($t)}}ie.push(Le(St.id,ut,Ft,St.tags))}return ie}function Lr(oi,ye){const ie=[];ie.size=oi.size,oi.start!==void 0&&(ie.start=oi.start,ie.end=oi.end);for(let qe=0;qe<oi.length;qe+=3)ie.push(oi[qe]+ye,oi[qe+1],oi[qe+2]);return ie}function Tr(oi,ye){if(oi.transformed)return oi;const ie=1<<oi.z,qe=oi.x,St=oi.y;for(const ut of oi.features){const Ft=ut.geometry,si=ut.type;if(ut.geometry=[],si===1)for(let $t=0;$t<Ft.length;$t+=2)ut.geometry.push(eo(Ft[$t],Ft[$t+1],ye,ie,qe,St));else for(let $t=0;$t<Ft.length;$t++){const ai=[];for(let fi=0;fi<Ft[$t].length;fi+=2)ai.push(eo(Ft[$t][fi],Ft[$t][fi+1],ye,ie,qe,St));ut.geometry.push(ai)}}return oi.transformed=!0,oi}function eo(oi,ye,ie,qe,St,ut){return[Math.round(ie*(oi*qe-St)),Math.round(ie*(ye*qe-ut))]}function $r(oi,ye,ie,qe,St){const ut=ye===St.maxZoom?0:St.tolerance/((1<<ye)*St.extent),Ft={features:[],numPoints:0,numSimplified:0,numFeatures:oi.length,source:null,x:ie,y:qe,z:ye,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const si of oi)en(Ft,si,ut,St);return Ft}function en(oi,ye,ie,qe){const St=ye.geometry,ut=ye.type,Ft=[];if(oi.minX=Math.min(oi.minX,ye.minX),oi.minY=Math.min(oi.minY,ye.minY),oi.maxX=Math.max(oi.maxX,ye.maxX),oi.maxY=Math.max(oi.maxY,ye.maxY),ut==="Point"||ut==="MultiPoint")for(let si=0;si<St.length;si+=3)Ft.push(St[si],St[si+1]),oi.numPoints++,oi.numSimplified++;else if(ut==="LineString")Wn(Ft,St,oi,ie,!1,!1);else if(ut==="MultiLineString"||ut==="Polygon")for(let si=0;si<St.length;si++)Wn(Ft,St[si],oi,ie,ut==="Polygon",si===0);else if(ut==="MultiPolygon")for(let si=0;si<St.length;si++){const $t=St[si];for(let ai=0;ai<$t.length;ai++)Wn(Ft,$t[ai],oi,ie,!0,ai===0)}if(Ft.length){let si=ye.tags||null;if(ut==="LineString"&&qe.lineMetrics){si={};for(const ai in ye.tags)si[ai]=ye.tags[ai];si.mapbox_clip_start=St.start/St.size,si.mapbox_clip_end=St.end/St.size}const $t={geometry:Ft,type:ut==="Polygon"||ut==="MultiPolygon"?3:ut==="LineString"||ut==="MultiLineString"?2:1,tags:si};ye.id!==null&&($t.id=ye.id),oi.features.push($t)}}function Wn(oi,ye,ie,qe,St,ut){const Ft=qe*qe;if(qe>0&&ye.size<(St?Ft:qe))return void(ie.numPoints+=ye.length/3);const si=[];for(let $t=0;$t<ye.length;$t+=3)(qe===0||ye[$t+2]>Ft)&&(ie.numSimplified++,si.push(ye[$t],ye[$t+1])),ie.numPoints++;St&&function($t,ai){let fi=0;for(let pi=0,Pi=$t.length,tn=Pi-2;pi<Pi;tn=pi,pi+=2)fi+=($t[pi]-$t[tn])*($t[pi+1]+$t[tn+1]);if(fi>0===ai)for(let pi=0,Pi=$t.length;pi<Pi/2;pi+=2){const tn=$t[pi],xn=$t[pi+1];$t[pi]=$t[Pi-2-pi],$t[pi+1]=$t[Pi-1-pi],$t[Pi-2-pi]=tn,$t[Pi-1-pi]=xn}}(si,ut),oi.push(si)}const Ls={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class bo{constructor(ye,ie){const qe=(ie=this.options=function(ut,Ft){for(const si in Ft)ut[si]=Ft[si];return ut}(Object.create(Ls),ie)).debug;if(qe&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let St=function(ut,Ft){const si=[];if(ut.type==="FeatureCollection")for(let $t=0;$t<ut.features.length;$t++)Fe(si,ut.features[$t],Ft,$t);else Fe(si,ut.type==="Feature"?ut:{geometry:ut},Ft);return si}(ye,ie);this.tiles={},this.tileCoords=[],qe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),St=function(ut,Ft){const si=Ft.buffer/Ft.extent;let $t=ut;const ai=Mt(ut,1,-1-si,si,0,-1,2,Ft),fi=Mt(ut,1,1-si,2+si,0,-1,2,Ft);return(ai||fi)&&($t=Mt(ut,1,-si,1+si,0,-1,2,Ft)||[],ai&&($t=jn(ai,1).concat($t)),fi&&($t=$t.concat(jn(fi,-1)))),$t}(St,ie),St.length&&this.splitTile(St,0,0,0),qe&&(St.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ye,ie,qe,St,ut,Ft,si){const $t=[ye,ie,qe,St],ai=this.options,fi=ai.debug;for(;$t.length;){St=$t.pop(),qe=$t.pop(),ie=$t.pop(),ye=$t.pop();const pi=1<<ie,Pi=Lo(ie,qe,St);let tn=this.tiles[Pi];if(!tn&&(fi>1&&console.time("creation"),tn=this.tiles[Pi]=$r(ye,ie,qe,St,ai),this.tileCoords.push({z:ie,x:qe,y:St}),fi)){fi>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,qe,St,tn.numFeatures,tn.numPoints,tn.numSimplified),console.timeEnd("creation"));const Ns=`z${ie}`;this.stats[Ns]=(this.stats[Ns]||0)+1,this.total++}if(tn.source=ye,ut==null){if(ie===ai.indexMaxZoom||tn.numPoints<=ai.indexMaxPoints)continue}else{if(ie===ai.maxZoom||ie===ut)continue;if(ut!=null){const Ns=ut-ie;if(qe!==Ft>>Ns||St!==si>>Ns)continue}}if(tn.source=null,ye.length===0)continue;fi>1&&console.time("clipping");const xn=.5*ai.buffer/ai.extent,Jn=.5-xn,sr=.5+xn,ar=1+xn;let er=null,Zr=null,Gr=null,yr=null,Jr=Mt(ye,pi,qe-xn,qe+sr,0,tn.minX,tn.maxX,ai),us=Mt(ye,pi,qe+Jn,qe+ar,0,tn.minX,tn.maxX,ai);ye=null,Jr&&(er=Mt(Jr,pi,St-xn,St+sr,1,tn.minY,tn.maxY,ai),Zr=Mt(Jr,pi,St+Jn,St+ar,1,tn.minY,tn.maxY,ai),Jr=null),us&&(Gr=Mt(us,pi,St-xn,St+sr,1,tn.minY,tn.maxY,ai),yr=Mt(us,pi,St+Jn,St+ar,1,tn.minY,tn.maxY,ai),us=null),fi>1&&console.timeEnd("clipping"),$t.push(er||[],ie+1,2*qe,2*St),$t.push(Zr||[],ie+1,2*qe,2*St+1),$t.push(Gr||[],ie+1,2*qe+1,2*St),$t.push(yr||[],ie+1,2*qe+1,2*St+1)}}getTile(ye,ie,qe){ye=+ye,ie=+ie,qe=+qe;const St=this.options,{extent:ut,debug:Ft}=St;if(ye<0||ye>24)return null;const si=1<<ye,$t=Lo(ye,ie=ie+si&si-1,qe);if(this.tiles[$t])return Tr(this.tiles[$t],ut);Ft>1&&console.log("drilling down to z%d-%d-%d",ye,ie,qe);let ai,fi=ye,pi=ie,Pi=qe;for(;!ai&&fi>0;)fi--,pi>>=1,Pi>>=1,ai=this.tiles[Lo(fi,pi,Pi)];return ai&&ai.source?(Ft>1&&(console.log("found parent tile z%d-%d-%d",fi,pi,Pi),console.time("drilling down")),this.splitTile(ai.source,fi,pi,Pi,ye,ie,qe),Ft>1&&console.timeEnd("drilling down"),this.tiles[$t]?Tr(this.tiles[$t],ut):null):null}}function Lo(oi,ye,ie){return 32*((1<<oi)*ie+ye)+oi}function _s(oi,ye){const ie=oi.tileID.canonical;if(!this._geoJSONIndex)return void ye(null,null);const qe=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!qe)return void ye(null,null);const St=new At(qe.features);let ut=zt(St);ut.byteOffset===0&&ut.byteLength===ut.buffer.byteLength||(ut=new Uint8Array(ut)),ye(null,{vectorTile:St,rawData:ut.buffer})}class js extends Dt{constructor(ye,ie,qe,St,ut,Ft){super(ye,ie,qe,St,_s,Ft),ut&&(this.loadGeoJSON=ut),this._dynamicIndex=new ot}loadData(ye,ie){const qe=ye&&ye.request,St=qe&&qe.collectResourceTiming;this.loadGeoJSON(ye,(ut,Ft)=>{if(ut||!Ft)return ie(ut);if(typeof Ft!="object")return ie(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`));{try{if(ye.filter){const $t=n.M(ye.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($t.result==="error")throw new Error($t.value.map(ai=>`${ai.key}: ${ai.message}`).join(", "));Ft.features=Ft.features.filter(ai=>$t.value.evaluate({zoom:0},ai))}ye.dynamic?(Ft.type==="Feature"&&(Ft={type:"FeatureCollection",features:[Ft]}),ye.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ft.features,this.loaded),ye.cluster&&(Ft.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ye.cluster?new on(function({superclusterOptions:$t,clusterProperties:ai}){if(!ai||!$t)return $t;const fi={},pi={},Pi={accumulated:null,zoom:0},tn={properties:null},xn=Object.keys(ai);for(const Jn of xn){const[sr,ar]=ai[Jn],er=n.M(ar),Zr=n.M(typeof sr=="string"?[sr,["accumulated"],["get",Jn]]:sr);fi[Jn]=er.value,pi[Jn]=Zr.value}return $t.map=Jn=>{tn.properties=Jn;const sr={};for(const ar of xn)sr[ar]=fi[ar].evaluate(Pi,tn);return sr},$t.reduce=(Jn,sr)=>{tn.properties=sr;for(const ar of xn)Pi.accumulated=Jn[ar],Jn[ar]=pi[ar].evaluate(Pi,tn)},$t}(ye)).load(Ft.features):ye.dynamic?this._dynamicIndex:function($t,ai){return new bo($t,ai)}(Ft,ye.geojsonVtOptions)}catch($t){return ie($t)}const si={};if(St){const $t=J(qe);$t&&(si.resourceTiming={},si.resourceTiming[ye.source]=JSON.parse(JSON.stringify($t)))}ie(null,si)}})}reloadTile(ye,ie){const qe=this.loaded;return qe&&qe[ye.uid]?ye.partial?ie(null,void 0):super.reloadTile(ye,ie):this.loadTile(ye,ie)}loadGeoJSON(ye,ie){if(ye.request)n.n(ye.request,ie);else{if(typeof ye.data!="string")return ie(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(ye.data))}catch{return ie(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ye,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(ye.clusterId))}catch(qe){ie(qe)}}getClusterChildren(ye,ie){try{ie(null,this._geoJSONIndex.getChildren(ye.clusterId))}catch(qe){ie(qe)}}getClusterLeaves(ye,ie){try{ie(null,this._geoJSONIndex.getLeaves(ye.clusterId,ye.limit,ye.offset))}catch(qe){ie(qe)}}}class Dr{constructor(ye,ie){this.tileID=new n.aA(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),this.tileZoom=ye.tileZoom,this.uid=ye.uid,this.zoom=ye.zoom,this.canonical=ye.tileID.canonical,this.pixelRatio=ye.pixelRatio,this.tileSize=ye.tileSize,this.source=ye.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ye.projection,this.brightness=ie}parse(ye,ie,qe,St){this.status="parsing";const ut=new n.aA(qe.tileID.overscaledZ,qe.tileID.wrap,qe.tileID.canonical.z,qe.tileID.canonical.x,qe.tileID.canonical.y),Ft=[],si=ie.familiesBySource[qe.source],$t=new n.dR(ut,qe.promoteId);return $t.bucketLayerIDs=[],$t.is3DTile=!0,n.e0(ye).then(ai=>{if(!ai)return St(new Error("Could not parse tile"));const fi=n.e1(ai,1/n.c9(qe.tileID.canonical)),pi=ai.json.extensionsUsed&&ai.json.extensionsUsed.includes("MAPBOX_mesh_features")||ai.json.asset.extras&&ai.json.asset.extras.MAPBOX_mesh_features,Pi=ai.json.extensionsUsed&&ai.json.extensionsUsed.includes("EXT_meshopt_compression"),tn=new n.a3(this.zoom,{brightness:this.brightness});for(const xn in si)for(const Jn of si[xn]){const sr=Jn[0];$t.bucketLayerIDs.push(Jn.map(er=>n.av(er.id,er.scope))),sr.recalculate(tn,[]);const ar=new n.e2(Jn,fi,ut,pi,Pi,this.brightness,$t);pi||(ar.needsUpload=!0),Ft.push(ar),ar.evaluate(sr)}this.status="done",St(null,{buckets:Ft,featureIndex:$t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ai=>St(new Error(ai.message)))}}class no{constructor(ye,ie,qe,St,ut,Ft){this.actor=ye,this.layerIndex=ie,this.availableImages=qe,this.brightness=Ft,this.loading={},this.loaded={}}loadTile(ye,ie){const qe=ye.uid,St=this.loading[qe]=new Dr(ye,this.brightness);n.bd(ye.request,(ut,Ft)=>{const si=!this.loading[qe];return delete this.loading[qe],si||ut?(St.status="done",si||(this.loaded[qe]=St),ie(ut)):Ft&&Ft.byteLength!==0?void St.parse(Ft,this.layerIndex,ye,($t,ai)=>{St.status="done",this.loaded=this.loaded||{},this.loaded[qe]=St,$t||!ai?ie($t):ie(null,ai)}):(St.status="done",this.loaded[qe]=St,ie())})}reloadTile(ye,ie){const qe=this.loaded,St=ye.uid;if(qe&&qe[St]){const ut=qe[St];ut.projection=ye.projection,ut.brightness=ye.brightness;const Ft=(si,$t)=>{ut.reloadCallback&&(delete ut.reloadCallback,this.loadTile(ye,ie)),ie(si,$t)};ut.status==="parsing"?ut.reloadCallback=Ft:ut.status==="done"&&this.loadTile(ye,ie)}}abortTile(ye,ie){const qe=ye.uid;this.loading[qe]&&delete this.loading[qe],ie()}removeTile(ye,ie){const qe=this.loaded,St=ye.uid;qe&&qe[St]&&delete qe[St],ie()}}class uo{constructor(ye){this.self=ye,this.actor=new n.e3(ye,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.bM({name:"mercator"}),this.workerSourceTypes={vector:Dt,geojson:js,"batched-model":no},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,qe)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=qe},this.self.registerRTLTextPlugin=ie=>{if(n.e4.isParsed())throw new Error("RTL text plugin already registered.");n.e4.applyArabicShaping=ie.applyArabicShaping,n.e4.processBidirectionalText=ie.processBidirectionalText,n.e4.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(ye,ie,qe){delete this.layerIndexes[ye],delete this.availableImages[ye],delete this.workerSources[ye],delete this.demWorkerSources[ye],delete this.rasterArrayWorkerSource,qe()}checkIfReady(ye,ie,qe){qe()}setReferrer(ye,ie){this.referrer=ie}spriteLoaded(ye,{scope:ie,isLoaded:qe}){if(this.isSpriteLoaded[ye]||(this.isSpriteLoaded[ye]={}),this.isSpriteLoaded[ye][ie]=qe,this.workerSources[ye]&&this.workerSources[ye][ie])for(const St in this.workerSources[ye][ie]){const ut=this.workerSources[ye][ie][St];for(const Ft in ut){const si=ut[Ft];si instanceof Dt&&(si.isSpriteLoaded=qe,si.fire(new n.x("isSpriteLoaded")))}}}setImages(ye,{scope:ie,images:qe},St){if(this.availableImages[ye]||(this.availableImages[ye]={}),this.availableImages[ye][ie]=qe,this.workerSources[ye]&&this.workerSources[ye][ie]){for(const ut in this.workerSources[ye][ie]){const Ft=this.workerSources[ye][ie][ut];for(const si in Ft)Ft[si].availableImages=qe}St()}else St()}setProjection(ye,ie){this.projections[ye]=n.bM(ie)}setBrightness(ye,ie,qe){this.brightness=ie,qe()}setLayers(ye,ie,qe){this.getLayerIndex(ye,ie.scope).replace(ie.layers,ie.options),qe()}updateLayers(ye,ie,qe){this.getLayerIndex(ye,ie.scope).update(ie.layers,ie.removedIds,ie.options),qe()}loadTile(ye,ie,qe){ie.projection=this.projections[ye]||this.defaultProjection,this.getWorkerSource(ye,ie.type,ie.source,ie.scope).loadTile(ie,qe)}loadDEMTile(ye,ie,qe){this.getDEMWorkerSource(ye,ie.source,ie.scope).loadTile(ie,qe)}decodeRasterArray(ye,ie,qe){this.getRasterArrayWorkerSource().decodeRasterArray(ie,qe)}reloadTile(ye,ie,qe){ie.projection=this.projections[ye]||this.defaultProjection,this.getWorkerSource(ye,ie.type,ie.source,ie.scope).reloadTile(ie,qe)}abortTile(ye,ie,qe){this.getWorkerSource(ye,ie.type,ie.source,ie.scope).abortTile(ie,qe)}removeTile(ye,ie,qe){this.getWorkerSource(ye,ie.type,ie.source,ie.scope).removeTile(ie,qe)}removeSource(ye,ie,qe){if(!(this.workerSources[ye]&&this.workerSources[ye][ie.scope]&&this.workerSources[ye][ie.scope][ie.type]&&this.workerSources[ye][ie.scope][ie.type][ie.source]))return;const St=this.workerSources[ye][ie.scope][ie.type][ie.source];delete this.workerSources[ye][ie.scope][ie.type][ie.source],St.removeSource!==void 0?St.removeSource(ie,qe):qe()}loadWorkerSource(ye,ie,qe){try{this.self.importScripts(ie.url),qe()}catch(St){qe(St.toString())}}syncRTLPluginState(ye,ie,qe){try{n.e4.setState(ie);const St=n.e4.getPluginURL();if(n.e4.isLoaded()&&!n.e4.isParsed()&&St!=null){this.self.importScripts(St);const ut=n.e4.isParsed();qe(ut?void 0:new Error(`RTL Text Plugin failed to import scripts from ${St}`),ut)}}catch(St){qe(St.toString())}}setDracoUrl(ye,ie){this.dracoUrl=ie}getAvailableImages(ye,ie){this.availableImages[ye]||(this.availableImages[ye]={});let qe=this.availableImages[ye][ie];return qe||(qe=[]),qe}getLayerIndex(ye,ie){this.layerIndexes[ye]||(this.layerIndexes[ye]={});let qe=this.layerIndexes[ye][ie];return qe||(qe=this.layerIndexes[ye][ie]=new Se,qe.scope=ie),qe}getWorkerSource(ye,ie,qe,St){return this.workerSources[ye]||(this.workerSources[ye]={}),this.workerSources[ye][St]||(this.workerSources[ye][St]={}),this.workerSources[ye][St][ie]||(this.workerSources[ye][St][ie]={}),this.isSpriteLoaded[ye]||(this.isSpriteLoaded[ye]={}),this.workerSources[ye][St][ie][qe]||(this.workerSources[ye][St][ie][qe]=new this.workerSourceTypes[ie]({send:(ut,Ft,si,$t,ai,fi)=>{this.actor.send(ut,Ft,si,ye,ai,fi)},scheduler:this.actor.scheduler},this.getLayerIndex(ye,St),this.getAvailableImages(ye,St),this.isSpriteLoaded[ye][St],void 0,this.brightness)),this.workerSources[ye][St][ie][qe]}getDEMWorkerSource(ye,ie,qe){return this.demWorkerSources[ye]||(this.demWorkerSources[ye]={}),this.demWorkerSources[ye][qe]||(this.demWorkerSources[ye][qe]={}),this.demWorkerSources[ye][qe][ie]||(this.demWorkerSources[ye][qe][ie]=new rt),this.demWorkerSources[ye][qe][ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new pt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ye,ie){n.e5(ie)}getWorkerPerformanceMetrics(ye,ie,qe){qe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new uo(self)),uo}),q(["./shared"],function(n){var J="3.8.0";const re={create:"create",load:"load",fullLoad:"fullLoad"},ce={mark(h){performance.mark(h)},measure(h,i,s){performance.measure(h,i,s)}};function Se(h){const i=h.name.split("?")[0];return n.a(i)&&i.includes("mapbox-gl.js")?"javascript":n.a(i)&&i.includes("mapbox-gl.css")?"css":n.b(i)?"fontRange":n.c(i)?"sprite":n.i(i)?"style":n.d(i)?"tilejson":"other"}var Xe,ht={},Ut=function(){if(Xe)return ht;function h(d){return!i(d)}function i(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,E,O=new Blob([""],{type:"text/javascript"}),B=URL.createObjectURL(O);try{E=new Worker(B),w=!0}catch{w=!1}return E&&E.terminate(),URL.revokeObjectURL(B),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var E=w.getContext("2d");if(!E)return!1;var O=E.getImageData(0,0,1,1);return O&&O.width===w.width}()?(s[x=d&&d.failIfMajorPerformanceCaveat]===void 0&&(s[x]=function(w){var E,O=function(B){var j=document.createElement("canvas"),H=Object.create(h.webGLContextAttributes);return H.failIfMajorPerformanceCaveat=B,j.getContext("webgl2",H)}(w);if(!O)return!1;try{E=O.createShader(O.VERTEX_SHADER)}catch{return!1}return!(!E||O.isContextLost())&&(O.shaderSource(E,"void main() {}"),O.compileShader(E),O.getShaderParameter(E,O.COMPILE_STATUS)===!0)}(x)),s[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}Xe=1,ht.supported=h,ht.notSupportedReason=i;var s={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ht}();function ct(h,i,s){const d=document.createElement(h);return i!=null&&(d.className=i),s&&s.appendChild(d),d}function Dt(h,i,s){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const x of Object.keys(i))d.setAttributeNS(null,x,String(i[x]));return s&&s.appendChild(d),d}const rt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,pt=rt&&rt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let gi;function Zt(){rt&&pt&&(gi=rt[pt],rt[pt]="none")}function At(){rt&&pt&&(rt[pt]=gi)}function It(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",It,!0)}function Ye(){window.addEventListener("click",It,!0),window.setTimeout(()=>{window.removeEventListener("click",It,!0)},0)}function ot(h,i){const s=h.getBoundingClientRect();return Rt(h,s,i)}function tt(h,i){const s=h.getBoundingClientRect(),d=[];for(let x=0;x<i.length;x++)d.push(Rt(h,s,i[x]));return d}function et(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Rt(h,i,s){const d=h.offsetWidth===i.width?1:h.offsetWidth/i.width;return new n.P((s.clientX-i.left)*d,(s.clientY-i.top)*d)}const at="01",_t="NO_ACCESS_TOKEN";class Qt{constructor(i,s,d){this._transformRequestFn=i,this._customAccessToken=s,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const i=function(){let s="";for(let d=0;d<10;d++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",at,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,s){return this._transformRequestFn&&this._transformRequestFn(i,s)||{url:i}}normalizeStyleURL(i,s){if(!n.f(i))return i;const d=be(i);return d.params.push(`sdk=js-${J}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeGlyphsURL(i,s){if(!n.f(i))return i;const d=be(i);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeModelURL(i,s){if(!n.f(i))return i;const d=be(i);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeSourceURL(i,s,d,x){if(!n.f(i))return i;const w=be(i);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),d&&w.params.push(`language=${d}`),x&&w.params.push(`worldview=${x}`),this._makeAPIURL(w,this._customAccessToken||s)}normalizeSpriteURL(i,s,d,x){const w=be(i);return n.f(i)?(w.path=`/styles/v1${w.path}/sprite${s}${d}`,this._makeAPIURL(w,this._customAccessToken||x)):(w.path+=`${s}${d}`,ve(w))}normalizeTileURL(i,s,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!n.f(i))return i;const x=be(i);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||d&&x.authority!=="raster"&&d===512?"@2x":""}${n.m.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${n.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${n.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${n.e.TILE_URL_VERSION}${x.path}`);const w=this._customAccessToken||function(E){for(const O of E){const B=O.match(/^access_token=(.*)$/);if(B)return B[1]}return null}(x.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,w)}canonicalizeTileURL(i,s){const d=be(i);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return i;let x="mapbox://";d.path.match(/^\/raster\/v1\//)?x+=`raster/${d.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${d.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${d.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let w=d.params;return s&&(w=w.filter(E=>!E.match(/^access_token=/))),w.length&&(x+=`?${w.join("&")}`),x}canonicalizeTileset(i,s){const d=!!s&&n.f(s),x=[];for(const w of i.tiles||[])n.h(w)?x.push(this.canonicalizeTileURL(w,d)):x.push(w);return x}_makeAPIURL(i,s){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=be(n.e.API_URL);if(i.protocol=x.protocol,i.authority=x.authority,i.protocol==="http"){const w=i.params.indexOf("secure");w>=0&&i.params.splice(w,1)}if(x.path!=="/"&&(i.path=`${x.path}${i.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return ve(i);if(s=s||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return i.params=i.params.filter(w=>w.indexOf("access_token")===-1),i.params.push(`access_token=${s||""}`),ve(i)}}const ae=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function be(h){const i=h.match(ae);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function ve(h){const i=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${i}`}const De="mapbox.eventData";function Ce(h){if(!h)return null;const i=h.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(n.j(i[1]))}catch{return null}}class Vt{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const s=Ce(n.e.ACCESS_TOKEN);let d="";return d=s&&s.u?n.k(s.u):n.e.ACCESS_TOKEN||"",i?`${De}.${i}:${d}`:`${De}:${d}`}fetchEventData(){const i=n.s("localStorage"),s=this.getStorageKey(),d=this.getStorageKey("uuid");if(i)try{const x=localStorage.getItem(s);x&&(this.eventData=JSON.parse(x));const w=localStorage.getItem(d);w&&(this.anonId=w)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const i=n.s("localStorage"),s=this.getStorageKey(),d=this.getStorageKey("uuid"),x=this.anonId;if(i&&x)try{localStorage.setItem(d,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,s,d,x){if(!n.e.EVENTS_URL)return;const w=be(n.e.EVENTS_URL);w.params.push(`access_token=${x||n.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(i).toISOString()},O=s?n.l(E,s):E,B={url:ve(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=n.p(B,j=>{this.pendingRequest=null,d(j),this.saveEventData(),this.processRequests(x)})}queueRequest(i,s){this.queue.push(i),this.processRequests(s)}}const zt=new class extends Vt{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,i){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(s=>n.f(s)||n.h(s))&&this.queueRequest(Date.now(),i)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ce(n.e.ACCESS_TOKEN),s=i?i.u:n.e.ACCESS_TOKEN;let d=s!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),d=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),E=new Date(x),O=(x-this.eventData.lastSuccess)/864e5;d=d||O>=1||O<-1||w.getDate()!==E.getDate()}else d=!0;d?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:J,skuId:at,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=x,this.eventData.tokenU=s)},h):this.processRequests()}},mt=zt.postTurnstileEvent.bind(zt),Nt=new class extends Vt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,i,s,d){this.skuToken=i,this.errorCb=d,n.e.EVENTS_URL&&(s||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},s):this.errorCb(new Error(_t)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:J,skuId:at,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):i&&(this.success[i]=!0)},h))}remove(){this.errorCb=null}},Gt=Nt.postMapLoadEvent.bind(Nt),ii=new class extends Vt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let i=this.mapInstanceIdMap.get(h);return i||(i=n.u(),this.mapInstanceIdMap.set(h,i)),i}getEventId(h){const i=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,i+1),i}postStyleLoadEvent(h,i){const{map:s,style:d,importedStyles:x}=i;if(!n.e.EVENTS_URL||!h&&!n.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(s),E={mapInstanceId:w,eventId:this.getEventId(w),style:d};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:s}=this.queue.shift();this.postEvent(i,s,()=>{},h)}},zi=ii.postStyleLoadEvent.bind(ii),Hi=new class extends Vt{constructor(){super("gljs.performance")}postPerformanceEvent(h,i){n.e.EVENTS_URL&&(h||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:s}=this.queue.shift(),d=function(x){const w=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),O=function(se){const pe={};if(se){for(const ue in se)if(ue!=="other")for(const _e of se[ue]){const ge=`${ue}ResolveRangeMin`,Oe=`${ue}ResolveRangeMax`,Ne=`${ue}RequestCount`,Ue=`${ue}RequestCachedCount`;pe[ge]=Math.min(pe[ge]||1/0,_e.startTime),pe[Oe]=Math.max(pe[Oe]||-1/0,_e.responseEnd);const $e=Ke=>{pe[Ke]===void 0&&(pe[Ke]=0),++pe[Ke]};_e.transferSize!==void 0&&_e.transferSize===0&&$e(Ue),$e(Ne)}}return pe}(function(se,pe){const ue={};if(se)for(const _e of se){const ge=pe(_e);ue[ge]===void 0&&(ue[ge]=[]),ue[ge].push(_e)}return ue}(w,Se)),B=window.devicePixelRatio,j=navigator.connection||navigator.mozConnection||navigator.webkitConnection,H=j?j.effectiveType:void 0,Z={counters:[],metadata:[],attributes:[]},Y=(se,pe,ue)=>{ue!=null&&se.push({name:pe,value:ue.toString()})};for(const se in O)Y(Z.counters,se,O[se]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(Y(Z.counters,"interactionRangeMin",x.interactionRange[0]),Y(Z.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const se of Object.keys(re)){const pe=re[se],ue=E.find(_e=>_e.name===pe);ue&&Y(Z.counters,pe,ue.startTime)}return Y(Z.counters,"visibilityHidden",x.visibilityHidden),Y(Z.attributes,"style",function(se){if(se)for(const pe of se){const ue=pe.name.split("?")[0];if(n.i(ue)){const _e=ue.split("/").slice(-2);if(_e.length===2)return`mapbox://styles/${_e[0]}/${_e[1]}`}}}(w)),Y(Z.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),Y(Z.attributes,"fogEnabled",x.fogEnabled?"true":"false"),Y(Z.attributes,"projection",x.projection),Y(Z.attributes,"zoom",x.zoom),Y(Z.metadata,"devicePixelRatio",B),Y(Z.metadata,"connectionEffectiveType",H),Y(Z.metadata,"navigatorUserAgent",navigator.userAgent),Y(Z.metadata,"screenWidth",window.screen.width),Y(Z.metadata,"screenHeight",window.screen.height),Y(Z.metadata,"windowWidth",window.innerWidth),Y(Z.metadata,"windowHeight",window.innerHeight),Y(Z.metadata,"mapWidth",x.width/B),Y(Z.metadata,"mapHeight",x.height/B),Y(Z.metadata,"webglRenderer",x.renderer),Y(Z.metadata,"webglVendor",x.vendor),Y(Z.metadata,"sdkVersion",J),Y(Z.metadata,"sdkIdentifier","mapbox-gl-js"),Z}(s);for(const x of d.metadata);for(const x of d.counters);for(const x of d.attributes);this.postEvent(i,d,()=>{},h)}},on=Hi.postPerformanceEvent.bind(Hi),mn=new class extends Vt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,i,s,d){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const x=be(n.e.API_URL+n.e.SESSION_PATH);x.params.push(`sku=${i||""}`),x.params.push(`access_token=${d||n.e.ACCESS_TOKEN||""}`);const w={url:ve(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(w,E=>{this.pendingRequest=null,s(E),this.saveEventData(),this.processRequests(d)})}getSessionAPI(h,i,s,d){this.skuToken=i,this.errorCb=d,n.e.SESSION_PATH&&n.e.API_URL&&(s||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},s):this.errorCb(new Error(_t)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||this.getSession(s,this.skuToken,d=>{d?this.errorCb(d):i&&(this.success[i]=!0)},h)}remove(){this.errorCb=null}},Qe=mn.getSessionAPI.bind(mn),Yn=new Set;function pr(h,i){i?Yn.add(h):Yn.delete(h)}class bt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,s){this._updatedSourceCaches[i]=s,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const s=i.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(i.id),this.setDirty()}removeLayer(i){const s=i.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][i.id]=i,this._updatedLayers[s].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const s in this._updatedLayers)i[s]=i[s]||{},i[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)i[s]=i[s]||{},i[s].removedIds=Object.keys(this._removedLayers[s]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function je(h){const{userImage:i}=h;return!!(i&&i.render&&i.render())&&(h.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ot extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new n.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,s){if(this.loaded[s]!==i&&(this.loaded[s]=i,i)){for(const{ids:d,callback:x}of this.requestors)this._notify(d,s,x);this.requestors=[]}}hasImage(i,s){return!!this.getImage(i,s)}getImage(i,s){return this.images[s][i]}addImage(i,s,d){this._validate(i,d)&&(this.images[s][i]=d)}_validate(i,s){let d=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new n.t(new Error(`Image "${i}" has invalid "stretchX" value`))),d=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new n.t(new Error(`Image "${i}" has invalid "stretchY" value`))),d=!1),this._validateContent(s.content,s)||(this.fire(new n.t(new Error(`Image "${i}" has invalid "content" value`))),d=!1),d}_validateStretch(i,s){if(!i)return!0;let d=0;for(const x of i){if(x[0]<d||x[1]<x[0]||s<x[1])return!1;d=x[1]}return!0}_validateContent(i,s){return!(i&&(i.length!==4||i[0]<0||s.data.width<i[0]||i[1]<0||s.data.height<i[1]||i[2]<0||s.data.width<i[2]||i[3]<0||s.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,s,d){d.version=this.images[s][i].version+1,this.images[s][i]=d,this.updatedImages[s][i]=!0}removeImage(i,s){const d=this.images[s][i];delete this.images[s][i],delete this.patterns[s][i],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,s,d){let x=!0;const w=!!this.loaded[s];if(!w)for(const E of i)this.images[s][E]||(x=!1);w||x?this._notify(i,s,d):this.requestors.push({ids:i,scope:s,callback:d})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,s,d){const x={};for(const w of i){this.images[s][w]||this.fire(new n.x("styleimagemissing",{id:w}));const E=this.images[s][w];E?x[w]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:n.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,x)}getPixelSize(i){const{width:s,height:d}=this.atlasImage[i];return{width:s,height:d}}getPattern(i,s,d){const x=this.patterns[s][i],w=this.getImage(i,s);if(!w)return null;if(x&&x.position.version===w.version)return x.position;if(x)x.position.version=w.version;else{const E={w:w.data.width+2*n.y,h:w.data.height+2*n.y,x:0,y:0},O=new n.I(E,w,n.y);this.patterns[s][i]={bin:E,position:O}}return this._updatePatternAtlas(s,d),this.patterns[s][i].position}bind(i,s){const d=i.gl;let x=this.atlasTexture[s];x?this.dirty&&(x.update(this.atlasImage[s]),this.dirty=!1):(x=new n.T(i,this.atlasImage[s],d.RGBA8),this.atlasTexture[s]=x),x.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(i,s){const d=[];for(const O in this.patterns[i])d.push(this.patterns[i][O].bin);const{w:x,h:w}=n.z(d),E=this.atlasImage[i];E.resize({width:x||1,height:w||1});for(const O in this.patterns[i]){const{bin:B,position:j}=this.patterns[i][O];let H=j.padding;const Z=B.x+H,Y=B.y+H,se=this.images[i][O].data,pe=se.width,ue=se.height;H=H>1?H-1:H,n.r.copy(se,E,{x:0,y:0},{x:Z,y:Y},{width:pe,height:ue},s),n.r.copy(se,E,{x:0,y:ue-H},{x:Z,y:Y-H},{width:pe,height:H},s),n.r.copy(se,E,{x:0,y:0},{x:Z,y:Y+ue},{width:pe,height:H},s),n.r.copy(se,E,{x:pe-H,y:0},{x:Z-H,y:Y},{width:H,height:ue},s),n.r.copy(se,E,{x:0,y:0},{x:Z+pe,y:Y},{width:H,height:ue},s),n.r.copy(se,E,{x:pe-H,y:ue-H},{x:Z-H,y:Y-H},{width:H,height:H},s),n.r.copy(se,E,{x:0,y:ue-H},{x:Z+pe,y:Y-H},{width:H,height:H},s),n.r.copy(se,E,{x:0,y:0},{x:Z+pe,y:Y+ue},{width:H,height:H},s),n.r.copy(se,E,{x:pe-H,y:0},{x:Z-H,y:Y+ue},{width:H,height:H},s)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,s){for(const d of i){if(this.callbackDispatchedThisFrame[s][d])continue;this.callbackDispatchedThisFrame[s][d]=!0;const x=this.images[s][d];je(x)&&this.updateImage(d,s,x)}}}function Le(h){const i=h.key,s=h.value,d=h.valueSpec||{},x=h.objectElementValidators||{},w=h.style,E=h.styleSpec;let O=[];const B=n.B(s);if(B!=="object")return[new n.V(i,s,`object expected, ${B} found`)];for(const j in s){const H=j.split(".")[0];let Z;x[H]?Z=x[H]:d[H]?Z=Wn:x["*"]?Z=x["*"]:d["*"]&&(Z=Wn),Z?O=O.concat(Z({key:(i&&`${i}.`)+j,value:s[j],valueSpec:d[H]||d["*"],style:w,styleSpec:E,object:s,objectKey:j},s)):O.push(new n.A(i,s[j],`unknown property "${j}"`))}for(const j in d)x[j]||d[j].required&&d[j].default===void 0&&s[j]===void 0&&O.push(new n.V(i,s,`missing required property "${j}"`));return O}function Ie(h){const i=h.value,s=h.valueSpec,d=h.style,x=h.styleSpec,w=h.key,E=h.arrayElementValidator||Wn;if(n.B(i)!=="array")return[new n.V(w,i,`array expected, ${n.B(i)} found`)];if(s.length&&i.length!==s.length)return[new n.V(w,i,`array length ${s.length} expected, length ${i.length} found`)];if(s["min-length"]&&i.length<s["min-length"])return[new n.V(w,i,`array length at least ${s["min-length"]} expected, length ${i.length} found`)];let O={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};x.$version<7&&(O.function=s.function),n.B(s.value)==="object"&&(O=s.value);let B=[];for(let j=0;j<i.length;j++)B=B.concat(E({array:i,arrayIndex:j,value:i[j],valueSpec:O,style:d,styleSpec:x,key:`${w}[${j}]`},!0));return B}function Fe(h){const i=h.key,s=h.value,d=h.valueSpec;let x=n.B(s);if(x==="number"&&s!=s&&(x="NaN"),x!=="number")return[new n.V(i,s,`number expected, ${x} found`)];if("minimum"in d){let w=d.minimum;if(n.B(d.minimum)==="array"&&(w=d.minimum[h.arrayIndex]),s<w)return[new n.V(i,s,`${s} is less than the minimum value ${w}`)]}if("maximum"in d){let w=d.maximum;if(n.B(d.maximum)==="array"&&(w=d.maximum[h.arrayIndex]),s>w)return[new n.V(i,s,`${s} is greater than the maximum value ${w}`)]}return[]}function Ge(h){const i=h.valueSpec,s=n.D(h.value.type);let d,x,w,E={};const O=s!=="categorical"&&h.value.property===void 0,B=!O,j=n.B(h.value.stops)==="array"&&n.B(h.value.stops[0])==="array"&&n.B(h.value.stops[0][0])==="object",H=Le({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(se){if(s==="identity")return[new n.V(se.key,se.value,'identity function may not have a "stops" property')];let pe=[];const ue=se.value;return pe=pe.concat(Ie({key:se.key,value:ue,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:Z})),n.B(ue)==="array"&&ue.length===0&&pe.push(new n.V(se.key,ue,"array must have at least one stop")),pe},default:function(se){return Wn({key:se.key,value:se.value,valueSpec:i,style:se.style,styleSpec:se.styleSpec})}}});return s==="identity"&&O&&H.push(new n.V(h.key,h.value,'missing required property "property"')),s==="identity"||h.value.stops||H.push(new n.V(h.key,h.value,'missing required property "stops"')),s==="exponential"&&h.valueSpec.expression&&!n.F(h.valueSpec)&&H.push(new n.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(B&&!n.G(h.valueSpec)?H.push(new n.V(h.key,h.value,"property functions not supported")):O&&!n.H(h.valueSpec)&&H.push(new n.V(h.key,h.value,"zoom functions not supported"))),s!=="categorical"&&!j||h.value.property!==void 0||H.push(new n.V(h.key,h.value,'"property" property is required')),H;function Z(se){let pe=[];const ue=se.value,_e=se.key;if(n.B(ue)!=="array")return[new n.V(_e,ue,`array expected, ${n.B(ue)} found`)];if(ue.length!==2)return[new n.V(_e,ue,`array length 2 expected, length ${ue.length} found`)];if(j){if(n.B(ue[0])!=="object")return[new n.V(_e,ue,`object expected, ${n.B(ue[0])} found`)];if(ue[0].zoom===void 0)return[new n.V(_e,ue,"object stop key must have zoom")];if(ue[0].value===void 0)return[new n.V(_e,ue,"object stop key must have value")];const ge=n.D(ue[0].zoom);if(typeof ge!="number")return[new n.V(_e,ue[0].zoom,"stop zoom values must be numbers")];if(w&&w>ge)return[new n.V(_e,ue[0].zoom,"stop zoom values must appear in ascending order")];ge!==w&&(w=ge,x=void 0,E={}),pe=pe.concat(Le({key:`${_e}[0]`,value:ue[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:Fe,value:Y}}))}else pe=pe.concat(Y({key:`${_e}[0]`,value:ue[0],valueSpec:{},style:se.style,styleSpec:se.styleSpec},ue));return n.J(n.K(ue[1]))?pe.concat([new n.V(`${_e}[1]`,ue[1],"expressions are not allowed in function stops.")]):pe.concat(Wn({key:`${_e}[1]`,value:ue[1],valueSpec:i,style:se.style,styleSpec:se.styleSpec}))}function Y(se,pe){const ue=n.B(se.value),_e=n.D(se.value),ge=se.value!==null?se.value:pe;if(d){if(ue!==d)return[new n.V(se.key,ge,`${ue} stop domain type must match previous stop domain type ${d}`)]}else d=ue;if(ue!=="number"&&ue!=="string"&&ue!=="boolean"&&typeof _e!="number"&&typeof _e!="string"&&typeof _e!="boolean")return[new n.V(se.key,ge,"stop domain value must be a number, string, or boolean")];if(ue!=="number"&&s!=="categorical"){let Oe=`number expected, ${ue} found`;return n.G(i)&&s===void 0&&(Oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(se.key,ge,Oe)]}return s!=="categorical"||ue!=="number"||typeof _e=="number"&&isFinite(_e)&&Math.floor(_e)===_e?s!=="categorical"&&ue==="number"&&typeof _e=="number"&&typeof x=="number"&&x!==void 0&&_e<x?[new n.V(se.key,ge,"stop domain values must appear in ascending order")]:(x=_e,s==="categorical"&&_e in E?[new n.V(se.key,ge,"stop domain values must be unique")]:(E[_e]=!0,[])):[new n.V(se.key,ge,`integer expected, found ${String(_e)}`)]}}function Je(h){const i=(h.expressionContext==="property"?n.L:n.M)(n.K(h.value),h.valueSpec);if(i.result==="error")return i.value.map(d=>new n.V(`${h.key}${d.key}`,h.value,d.message));const s=i.value.expression||i.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!s.outputDefined())return[new n.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!n.N(s))return[new n.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return st(s,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!n.O(s,["zoom","feature-state"]))return[new n.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!n.Q(s))return[new n.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function st(h,i){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const x of i.valueSpec.expression.parameters)s.delete(x);if(s.size===0)return[];const d=[];return h instanceof n.S&&s.has(h.name)?[new n.V(i.key,i.value,`["${h.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(h.eachChild(x=>{d.push(...st(x,i))}),d)}function lt(h){const i=h.key,s=h.value,d=h.valueSpec,x=[];return Array.isArray(d.values)?d.values.indexOf(n.D(s))===-1&&x.push(new n.V(i,s,`expected one of [${d.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(d.values).indexOf(n.D(s))===-1&&x.push(new n.V(i,s,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(s)} found`)),x}function Tt(h){return n.W(n.K(h.value))?Je(n.C({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Mt(h)}function Mt(h){const i=h.value,s=h.key;if(n.B(i)!=="array")return[new n.V(s,i,`array expected, ${n.B(i)} found`)];const d=h.styleSpec;let x,w=[];if(i.length<1)return[new n.V(s,i,"filter array must have at least 1 element")];switch(w=w.concat(lt({key:`${s}[0]`,value:i[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),n.D(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&n.D(i[1])==="$type"&&w.push(new n.V(s,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new n.V(s,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(x=n.B(i[1]),x!=="string"&&w.push(new n.V(`${s}[1]`,i[1],`string expected, ${x} found`)));for(let E=2;E<i.length;E++)x=n.B(i[E]),n.D(i[1])==="$type"?w=w.concat(lt({key:`${s}[${E}]`,value:i[E],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&w.push(new n.V(`${s}[${E}]`,i[E],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let E=1;E<i.length;E++)w=w.concat(Mt({key:`${s}[${E}]`,value:i[E],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":x=n.B(i[1]),i.length!==2?w.push(new n.V(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):x!=="string"&&w.push(new n.V(`${s}[1]`,i[1],`string expected, ${x} found`))}return w}function ci(h,i){const s=h.key,d=h.style,x=h.layer,w=h.styleSpec,E=h.value,O=h.objectKey,B=w[`${i}_${h.layerType}`];if(!B)return[];const j=O.match(/^(.*)-transition$/);if(i==="paint"&&j&&B[j[1]]&&B[j[1]].transition)return Wn({key:s,value:E,valueSpec:w.transition,style:d,styleSpec:w});const H=h.valueSpec||B[O];if(!H)return[new n.A(s,E,`unknown property "${O}"`)];let Z;if(n.B(E)==="string"&&n.G(H)&&!H.tokens&&(Z=/^{([^}]+)}$/.exec(E))){const se=`\`{ "type": "identity", "property": ${Z?JSON.stringify(Z[1]):'"_"'} }\``;return[new n.V(s,E,`"${O}" does not support interpolation syntax
Use an identity property function instead: ${se}.`)]}const Y=[];if(h.layerType==="symbol")O!=="text-field"||!d||d.glyphs||d.imports||Y.push(new n.V(s,E,'use of "text-field" requires a style "glyphs" property')),O==="text-font"&&n.X(n.K(E))&&n.D(E.type)==="identity"&&Y.push(new n.V(s,E,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&i==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&n.G(H)&&(n.Y(H)||n.H(H))){const se=n.L(n.K(E),H),pe=se.value.expression||se.value._styleExpression.expression;pe&&!n.O(pe,["measure-light"])&&(O==="model-emissive-strength"&&n.Q(pe)&&n.N(pe)||Y.push(new n.V(s,E,`${O} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Y.concat(Wn({key:h.key,value:E,valueSpec:H,style:d,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:O}))}function xi(h){return ci(h,"paint")}function an(h){return ci(h,"layout")}function cn(h){let i=[];const s=h.value,d=h.key,x=h.style,w=h.styleSpec;s.type||s.ref||i.push(new n.V(d,s,'either "type" or "ref" is required'));let E=n.D(s.type);const O=n.D(s.ref);if(s.id){const B=n.D(s.id);for(let j=0;j<h.arrayIndex;j++){const H=x.layers[j];n.D(H.id)===B&&i.push(new n.V(d,s.id,`duplicate layer id "${s.id}", previously used at line ${H.id.__line__}`))}}if("ref"in s){let B;["type","source","source-layer","filter","layout"].forEach(j=>{j in s&&i.push(new n.V(d,s[j],`"${j}" is prohibited for ref layers`))}),x.layers.forEach(j=>{n.D(j.id)===O&&(B=j)}),B?B.ref?i.push(new n.V(d,s.ref,"ref cannot reference another ref layer")):E=n.D(B.type):typeof O=="string"&&i.push(new n.V(d,s.ref,`ref layer "${O}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(s.source){const B=x.sources&&x.sources[s.source],j=B&&n.D(B.type);B?j==="vector"&&E==="raster"?i.push(new n.V(d,s.source,`layer "${s.id}" requires a raster source`)):j==="raster"&&E!=="raster"?i.push(new n.V(d,s.source,`layer "${s.id}" requires a vector source`)):j!=="vector"||s["source-layer"]?j==="raster-dem"&&E!=="hillshade"?i.push(new n.V(d,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):j!=="raster-array"||["raster","raster-particle"].includes(E)?E!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||j==="geojson"&&B.lineMetrics?E==="raster-particle"&&j!=="raster-array"&&i.push(new n.V(d,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):i.push(new n.V(d,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new n.V(d,s.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new n.V(d,s,`layer "${s.id}" must specify a "source-layer"`)):i.push(new n.V(d,s.source,`source "${s.source}" not found`))}else i.push(new n.V(d,s,'missing required property "source"'));return i=i.concat(Le({key:d,value:s,valueSpec:w.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wn({key:`${d}.type`,value:s.type,valueSpec:w.layer.type,style:h.style,styleSpec:h.styleSpec,object:s,objectKey:"type"}),filter:B=>Tt(n.C({layerType:E},B)),layout:B=>Le({layer:s,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":j=>an(n.C({layerType:E},j))}}),paint:B=>Le({layer:s,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":j=>xi(n.C({layerType:E,layer:s},j))}})}})),i}function _n(h){const i=h.value,s=h.key,d=n.B(i);return d!=="string"?[new n.V(s,i,`string expected, ${d} found`)]:[]}const Fn={promoteId:function({key:h,value:i}){if(n.B(i)==="string")return _n({key:h,value:i});{const s=[];for(const d in i)s.push(..._n({key:`${h}.${d}`,value:i[d]}));return s}}};function Mn(h){const i=h.value,s=h.key,d=h.styleSpec,x=h.style;if(!i.type)return[new n.V(s,i,'"type" is required')];const w=n.D(i.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(i.url||i.tiles||E.push(new n.A(s,i,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Le({key:s,value:i,valueSpec:d[`source_${w.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:Fn})),E;case"geojson":if(E=Le({key:s,value:i,valueSpec:d.source_geojson,style:x,styleSpec:d,objectElementValidators:Fn}),i.cluster)for(const O in i.clusterProperties){const[B,j]=i.clusterProperties[O],H=typeof B=="string"?[B,["accumulated"],["get",O]]:B;E.push(...Je({key:`${s}.${O}.map`,value:j,expressionContext:"cluster-map"})),E.push(...Je({key:`${s}.${O}.reduce`,value:H,expressionContext:"cluster-reduce"}))}return E;case"video":return Le({key:s,value:i,valueSpec:d.source_video,style:x,styleSpec:d});case"image":return Le({key:s,value:i,valueSpec:d.source_image,style:x,styleSpec:d});case"canvas":return[new n.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lt({key:`${s}.type`,value:i.type,valueSpec:{values:jn(d)},style:x,styleSpec:d})}}function jn(h){return h.source.reduce((i,s)=>{const d=h[s];return d.type.type==="enum"&&(i=i.concat(Object.keys(d.type.values))),i},[])}function Lr(h){const i=h.value,s=h.styleSpec,d=s.light,x=h.style;let w=[];const E=n.B(i);if(i===void 0)return w;if(E!=="object")return w=w.concat([new n.V("light",i,`object expected, ${E} found`)]),w;for(const O in i){const B=O.match(/^(.*)-transition$/);w=w.concat(B&&d[B[1]]&&d[B[1]].transition?Wn({key:O,value:i[O],valueSpec:s.transition,style:x,styleSpec:s}):d[O]?Wn({key:O,value:i[O],valueSpec:d[O],style:x,styleSpec:s}):[new n.V(O,i[O],`unknown property "${O}"`)])}return w}function Tr(h){const i=h.value;let s=[];if(!i)return s;const d=n.B(i);if(d!=="object")return s=s.concat([new n.V("light-3d",i,`object expected, ${d} found`)]),s;const x=h.styleSpec,w=x["light-3d"],E=h.key,O=h.style,B=h.style.lights;for(const Z of["type","id"])if(!(Z in i))return s=s.concat([new n.V("light-3d",i,`missing property ${Z} on light`)]),s;if(i.type&&B)for(let Z=0;Z<h.arrayIndex;Z++){const Y=n.D(i.type),se=B[Z];n.D(se.type)===Y&&s.push(new n.V(E,i.id,`duplicate light type "${i.type}", previously defined at line ${se.id.__line__}`))}const j=`properties_light_${i.type}`;if(!(j in x))return s=s.concat([new n.V("light-3d",i,`Invalid light type ${i.type}`)]),s;const H=x[j];for(const Z in i)if(Z==="properties"){const Y=i[Z],se=n.B(Y);if(se!=="object")return s=s.concat([new n.V("properties",Y,`object expected, ${se} found`)]),s;for(const pe in Y)s=s.concat(H[pe]?Wn({key:pe,value:Y[pe],valueSpec:H[pe],style:O,styleSpec:x}):[new n.A(h.key,Y[pe],`unknown property "${pe}"`)])}else{const Y=Z.match(/^(.*)-transition$/);s=s.concat(Y&&w[Y[1]]&&w[Y[1]].transition?Wn({key:Z,value:i[Z],valueSpec:x.transition,style:O,styleSpec:x}):w[Z]?Wn({key:Z,value:i[Z],valueSpec:w[Z],style:O,styleSpec:x}):[new n.A(Z,i[Z],`unknown property "${Z}"`)])}return s}function eo(h){const i=h.value,s=h.key,d=h.style,x=h.styleSpec,w=x.terrain;let E=[];const O=n.B(i);if(i===void 0||O==="null")return E;if(O!=="object")return E=E.concat([new n.V("terrain",i,`object expected, ${O} found`)]),E;for(const B in i){const j=B.match(/^(.*)-transition$/);E=E.concat(j&&w[j[1]]&&w[j[1]].transition?Wn({key:B,value:i[B],valueSpec:x.transition,style:d,styleSpec:x}):w[B]?Wn({key:B,value:i[B],valueSpec:w[B],style:d,styleSpec:x}):[new n.A(B,i[B],`unknown property "${B}"`)])}if(i.source){const B=d.sources&&d.sources[i.source],j=B&&n.D(B.type);B?j!=="raster-dem"&&E.push(new n.V(s,i.source,`terrain cannot be used with a source of type ${String(j)}, it only be used with a "raster-dem" source type`)):E.push(new n.V(s,i.source,`source "${i.source}" not found`))}else E.push(new n.V(s,i,'terrain is missing required property "source"'));return E}function $r(h){const i=h.value,s=h.style,d=h.styleSpec,x=d.fog;let w=[];const E=n.B(i);if(i===void 0)return w;if(E!=="object")return w=w.concat([new n.V("fog",i,`object expected, ${E} found`)]),w;for(const O in i){const B=O.match(/^(.*)-transition$/);w=w.concat(B&&x[B[1]]&&x[B[1]].transition?Wn({key:O,value:i[O],valueSpec:d.transition,style:s,styleSpec:d}):x[O]?Wn({key:O,value:i[O],valueSpec:x[O],style:s,styleSpec:d}):[new n.A(O,i[O],`unknown property "${O}"`)])}return w}const en={"*":()=>[],array:Ie,boolean:function(h){const i=h.value,s=h.key,d=n.B(i);return d!=="boolean"?[new n.V(s,i,`boolean expected, ${d} found`)]:[]},number:Fe,color:function(h){const i=h.key,s=h.value,d=n.B(s);return d!=="string"?[new n.V(i,s,`color expected, ${d} found`)]:n.U.parseCSSColor(s)===null?[new n.V(i,s,`color expected, "${s}" found`)]:[]},enum:lt,filter:Tt,function:Ge,layer:cn,object:Le,source:Mn,model:n.Z,light:Lr,"light-3d":Tr,terrain:eo,fog:$r,string:_n,formatted:function(h){return _n(h).length===0?[]:Je(h)},resolvedImage:function(h){return _n(h).length===0?[]:Je(h)},projection:function(h){const i=h.value,s=h.styleSpec,d=s.projection,x=h.style;let w=[];const E=n.B(i);if(E==="object")for(const O in i)w=w.concat(Wn({key:O,value:i[O],valueSpec:d[O],style:x,styleSpec:s}));else E!=="string"&&(w=w.concat([new n.V("projection",i,`object or string expected, ${E} found`)]));return w},import:function(h){const{value:i,styleSpec:s}=h,{data:d,...x}=i;Object.defineProperty(x,"__line__",{value:i.__line__,enumerable:!1});let w=Le(n.C({},h,{value:x,valueSpec:s.import}));return n.D(x.id)===""&&w.push(new n.V(`${h.key}.id`,x,"import id can't be an empty string")),d&&(w=w.concat(bo(d,s,{key:`${h.key}.data`}))),w}};function Wn(h,i=!1){const s=h.value,d=h.valueSpec,x=h.styleSpec;if(d.expression&&n.X(n.D(s)))return Ge(h);if(d.expression&&n.J(n.K(s)))return Je(h);if(d.type&&en[d.type]){const w=en[d.type](h);return i===!0&&w.length>0&&n.B(h.value)==="array"?Je(h):w}return Le(n.C({},h,{valueSpec:d.type?x[d.type]:d}))}function Ls(h){const i=h.value,s=h.key,d=_n(h);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new n.V(s,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new n.V(s,i,'"glyphs" url must include a "{range}" token'))),d}function bo(h,i=n._,s={}){return Wn({key:s.key||"",value:h,valueSpec:i.$root,styleSpec:i,style:h,objectElementValidators:{glyphs:Ls,"*":()=>[]}})}function Lo(h,i=n._){return ut(bo(h,i))}const _s=h=>ut(Mn(h)),js=h=>ut(Lr(h)),Dr=h=>ut(Tr(h)),no=h=>ut(eo(h)),uo=h=>ut($r(h)),oi=h=>ut(cn(h)),ye=h=>ut(Tt(h)),ie=h=>ut(xi(h)),qe=h=>ut(an(h)),St=h=>ut(n.Z(h));function ut(h){return h.slice().sort((i,s)=>i.line&&s.line?i.line-s.line:0)}function Ft(h,i){let s=!1;if(i&&i.length)for(const d of i)d instanceof n.A?n.w(d.message):(h.fire(new n.t(new Error(d.message))),s=!0);return s}let si;class $t extends n.E{constructor(i,s="flat"){super(),this._transitionable=new n.$(si||(si=new n.a0({anchor:new n.a1(n._.light.anchor),position:new n.a2(n._.light.position),color:new n.a1(n._.light.color),intensity:new n.a1(n._.light.intensity)}))),this.setLight(i,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,s,d={}){this._validate(js,i,d)||(this._transitionable.setTransitionOrValue(i),this.id=s)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,s,d){return(!d||d.validate!==!1)&&Ft(this,i.call(Lo,n.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}let ai=class extends n.E{constructor(h,i,s,d){super(),this.scope=s,this._transitionable=new n.$(new n.a0({source:new n.a1(n._.terrain.source),exaggeration:new n.a1(n._.terrain.exaggeration)}),s,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(h,i){this._transitionable.setTransitionOrValue(h,i)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new n.a3(h)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const i=h.value.expression;if(!i)return null;let s=-1,d=-1,x=1;for(const w of i.zoomStops)x=i.evaluate(new n.a3(w)),x>.01?(s=w,d=-1):d=w;return x<.01&&s>0&&d>s?[s,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof n.a4}};const fi=45,pi=65,Pi=.05;function tn(h,i,s,d){const x=n.a7(fi,pi,s),[w,E]=xn(h,d);let O=1-Math.min(1,Math.exp((i-w)/(E-w)*-6));return O*=O*O,O=Math.min(1,1.00747*O),O*x*h.alpha}function xn(h,i){const s=.5/Math.tan(.5*i);return[h.range[0]+s,h.range[1]+s]}function Jn(h,i,s,d,x){const w=n.a6.vec3.transformMat4([],[i,s,d],x.mercatorFogMatrix);return tn(h,n.a6.vec3.length(w),x.pitch,x._fov)}function sr(h,i,s,d,x,w,E){const O=[[s,d,0],[x,d,0],[x,w,0],[s,w,0]];let B=Number.MAX_VALUE,j=-Number.MAX_VALUE;for(const H of O){const Z=n.a6.vec3.transformMat4([],H,i),Y=n.a6.vec3.length(Z);B=Math.min(B,Y),j=Math.max(j,Y)}return[tn(h,B,E.pitch,E._fov),tn(h,j,E.pitch,E._fov)]}class ar extends n.E{constructor(i,s,d,x){super();const w=new n.a0({range:new n.a1(n._.fog.range),color:new n.a1(n._.fog.color),"high-color":new n.a1(n._.fog["high-color"]),"space-color":new n.a1(n._.fog["space-color"]),"horizon-blend":new n.a1(n._.fog["horizon-blend"]),"star-intensity":new n.a1(n._.fog["star-intensity"]),"vertical-range":new n.a1(n._.fog["vertical-range"])});this._transitionable=new n.$(w,d,new Map(x)),this.set(i,x),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new n.a8(w),this.scope=d}get state(){const i=this._transform,s=i.projection.name==="globe",d=n.a9(i.zoom),x=this.properties.get("range"),w=[.5,3];return{range:s?[n.aa(w[0],x[0],d),n.aa(w[1],x[1],d)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,s,d={}){if(this._validate(uo,i,d))return;const x=n.l({},i);for(const w of Object.keys(n._.fog))x[w]===void 0&&(x[w]=n._.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.a7(fi,pi,i))*s.a}getOpacityAtLatLng(i,s){return this._transform.projection.supportsFog?function(d,x,w){const E=n.a5.fromLngLat(x),O=w.elevation?w.elevation.getAtPointOrZero(E):0;return Jn(d,E.x,E.y,O,w)}(this.state,i,s):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(i.toUnwrapped());return sr(this.state,s,0,0,n.ab,n.ab,this._transform)}getOpacityForBounds(i,s,d,x,w){return this._transform.projection.supportsFog?sr(this.state,i,s,d,x,w,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?xn(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const d of s){const x=i.points[d];let w;if(x[2]>=0)w=x;else{const E=i.points[d-4];w=n.ac(E,x,E[2]/(E[2]-x[2]))}if(Jn(this.state,w[0],w[1],0,this._transform)>=Pi)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,s,d){return(!d||d.validate!==!1)&&Ft(this,i.call(Lo,n.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}class er extends n.E{constructor(i,s,d,x){super(),this.scope=d,this._options=i,this.properties=new n.a8(s),this._transitionable=new n.$(s,d,new Map(x)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,s){this._options=i,this._transitionable.setTransitionOrValue(i.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Zr,Gr;class yr{constructor(i,s,d,x){this.screenBounds=i,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,s){let d,x;if(i instanceof n.P||typeof i[0]=="number"){const w=n.P.convert(i);d=[w],x=s.isPointAboveHorizon(w)}else{const w=n.P.convert(i[0]),E=n.P.convert(i[1]);d=[w,E],x=n.ae(w,E).every(O=>s.isPointAboveHorizon(O))}return new yr(d,s.getCameraPoint(),x,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return n.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],x=n.ae(s,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<d.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?x[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(x[3]=this.cameraPoint)),n.af(x,i)}bufferedCameraGeometryGlobe(i){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],x=n.ae(s,d,i),w=this.cameraPoint.clone();switch(3*((w.y>s.y)+(w.y>d.y))+((w.x>s.x)+(w.x>d.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(i,s,d,x=0){const w=i.queryPadding/s._pixelsPerMercatorPixel+1,E=d?this._bufferedCameraMercator(w,s):this._bufferedScreenMercator(w,s);let O=i.tileID.wrap+(E.unwrapped?x:0);const B=E.polygon.map(_e=>n.ag(i.tileTransform,_e,O));if(!n.ah(B,0,0,n.ab,n.ab))return;O=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const j=this.screenGeometryMercator.polygon.map(_e=>n.ai(i.tileTransform,_e,O)),H=j.map(_e=>new n.P(_e[0],_e[1])),Z=s.getFreeCameraOptions().position||new n.a5(0,0,0),Y=n.ai(i.tileTransform,Z,O),se=j.map(_e=>{const ge=n.a6.vec3.sub(_e,_e,Y);return n.a6.vec3.normalize(ge,ge),new n.aj(Y,ge)}),pe=n.ak(i,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:se,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(ue=n.al(B),ue.min.x=n.ap(ue.min.x,0,n.ab),ue.min.y=n.ap(ue.min.y,0,n.ab),ue.max.x=n.ap(ue.max.x,0,n.ab),ue.max.y=n.ap(ue.max.y,0,n.ab),ue),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:pe};var ue}_bufferedScreenMercator(i,s){const d=Ns(i);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let x;return x=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),s):{polygon:this.bufferedScreenGeometry(i).map(w=>s.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[d]=x,x}}_bufferedCameraMercator(i,s){const d=Ns(i);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let x;return x=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),s):{polygon:this.bufferedCameraGeometry(i).map(w=>s.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[d]=x,x}}_projectAndResample(i,s){const d=function(w,E){const O=n.a6.mat4.multiply([],E.pixelMatrix,E.globeMatrix),B=[0,-n.aq,0,1],j=[0,n.aq,0,1],H=[0,0,0,1];n.a6.vec4.transformMat4(B,B,O),n.a6.vec4.transformMat4(j,j,O),n.a6.vec4.transformMat4(H,H,O);const Z=new n.P(B[0]/B[3],B[1]/B[3]),Y=new n.P(j[0]/j[3],j[1]/j[3]),se=n.an(w,Z)&&B[3]<H[3],pe=n.an(w,Y)&&j[3]<H[3];if(!se&&!pe)return null;const ue=function(Ze,it,gt){for(let Lt=1;Lt<Ze.length;Lt++){const wt=us(it.pointCoordinate3D(Ze[Lt-1]).x),vt=us(it.pointCoordinate3D(Ze[Lt]).x);if(gt<0){if(wt<vt)return{idx:Lt,t:-wt/(vt-1-wt)}}else if(vt<wt)return{idx:Lt,t:(1-wt)/(vt+1-wt)}}return null}(w,E,se?-1:1);if(!ue)return null;const{idx:_e,t:ge}=ue;let Oe=_e>1?Jr(w.slice(0,_e),E):[],Ne=_e<w.length?Jr(w.slice(_e),E):[];Oe=Oe.map(Ze=>new n.P(us(Ze.x),Ze.y)),Ne=Ne.map(Ze=>new n.P(us(Ze.x),Ze.y));const Ue=[...Oe];Ue.length===0&&Ue.push(Ne[Ne.length-1]);const $e=n.aa(Ue[Ue.length-1].y,(Ne.length===0?Oe[0]:Ne[0]).y,ge);let Ke;return Ke=se?[new n.P(0,$e),new n.P(0,0),new n.P(1,0),new n.P(1,$e)]:[new n.P(1,$e),new n.P(1,1),new n.P(0,1),new n.P(0,$e)],Ue.push(...Ke),Ne.length===0?Ue.push(Oe[0]):Ue.push(...Ne),{polygon:Ue.map(Ze=>new n.a5(Ze.x,Ze.y)),unwrapped:!1}}(i,s);if(d)return d;const x=function(w,E){let O=!1,B=-1/0,j=0;for(let Z=0;Z<w.length-1;Z++)w[Z].x>B&&(B=w[Z].x,j=Z);for(let Z=0;Z<w.length-1;Z++){const Y=(j+Z)%(w.length-1),se=w[Y],pe=w[Y+1];Math.abs(se.x-pe.x)>.5&&(se.x<pe.x?(se.x+=1,Y===0&&(w[w.length-1].x+=1)):(pe.x+=1,Y+1===w.length-1&&(w[0].x+=1)),O=!0)}const H=n.am(E.center.lng);return O&&H<Math.abs(H-1)&&w.forEach(Z=>{Z.x-=1}),{polygon:w,unwrapped:O}}(Jr(i,s).map(w=>new n.P(us(w.x),w.y)),s);return{polygon:x.polygon.map(w=>new n.a5(w.x,w.y)),unwrapped:x.unwrapped}}}function Jr(h,i){return n.ao(h,s=>{const d=i.pointCoordinate3D(s);s.x=d.x,s.y=d.y},1/256)}function us(h){return h<0?1+h%1:h%1}function Ns(h){return 100*h|0}function es(h,i,s,d,x){const w=function(O,B){if(O)return x(O);if(B){if(h.url&&B.tiles&&h.tiles&&delete h.tiles,B.variants){if(!Array.isArray(B.variants))return x(new Error("variants must be an array"));for(const H of B.variants){if(H==null||typeof H!="object"||H.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(H.capabilities))return x(new Error("capabilities must be an array"));if(H.capabilities.length===1&&H.capabilities[0]==="meshopt"){B=n.l(B,H);break}}}const j=n.ar(n.l({},B,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);j.tiles=i.canonicalizeTileset(j,h.url),x(null,j)}},E=function(O,B,j){if(!O)return null;if(!B&&!j)return O;j=j||O.worldview_default;const H=Object.values(O.language||{});if(H.length===0)return null;const Z=Object.values(O.worldview||{});if(Z.length===0)return null;const Y=H.every(pe=>pe===B),se=Z.every(pe=>pe===j);return Y&&se?O:B in(O.language_options||{})||j in(O.worldview_options||{})?null:O.language_options&&O.worldview_options?O:null}(h.data,s,d);return E?n.q.frame(()=>w(null,E)):h.url?n.n(i.transformRequest(i.normalizeSourceURL(h.url,null,s,d),n.R.Source),w):n.q.frame(()=>{const{data:O,...B}=h;w(null,B)})}class Fs{constructor(i,s,d){this.bounds=n.as.convert(this.validateBounds(i)),this.minzoom=s||0,this.maxzoom=d||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const s=Math.pow(2,i.z),d=Math.floor(n.am(this.bounds.getWest())*s),x=Math.floor(n.at(this.bounds.getNorth())*s),w=Math.ceil(n.am(this.bounds.getEast())*s),E=Math.ceil(n.at(this.bounds.getSouth())*s);return i.x>=d&&i.x<w&&i.y>=x&&i.y<E}}class Ps extends n.E{constructor(i,s,d,x){if(super(),this.id=i,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ar(s,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new n.au}load(i){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=es(this._options,this.map._requestManager,s,d,(x,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new n.t(x));else if(w){if(n.l(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of w.vector_layers)this.vectorLayerIds.push(E.id),w.worldview&&w.worldview[E.source]&&this.localizableLayerIds.add(E.id)}w.bounds&&(this.tileBounds=new Fs(w.bounds,this.minzoom,this.maxzoom)),mt(w.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}i&&i(x)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(i,s){const d=i.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(d),w=this.map._requestManager.transformRequest(x,n.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,O=E?{image:E.image.clone()}:null,B={request:w,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:O,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(d)&&(B.worldview=this.map.getWorldview()||this.worldviewDefault,B.localizableLayerIds=this.localizableLayerIds),B.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=s:i.request=i.actor.send("reloadTile",B,j.bind(this));else if(i.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",B,j.bind(this),void 0,!0);else{const H=n.aw.call({deduped:this._deduped},B,(Z,Y)=>{Z||!Y?j.call(this,Z):(B.data={cacheControl:Y.cacheControl,expires:Y.expires,rawData:Y.rawData.slice(0)},i.actor&&i.actor.send("loadTile",B,j.bind(this),void 0,!0))},!0);i.request={cancel:H}}function j(H,Z){return delete i.request,i.aborted?s(null):H&&H.status!==404?s(H):(Z&&Z.resourceTiming&&(i.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&i.setExpiryData(Z),i.loadVectorData(Z,this.map.painter),n.ax(this.dispatcher),s(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,s){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class wo extends n.E{constructor(i,s,d,x){super(),this.id=i,this.dispatcher=d,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},s),n.l(this,n.ar(s,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._tileJSONRequest=es(this._options,this.map._requestManager,null,null,(s,d)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new n.t(s)):d&&(n.l(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),d.bounds&&(this.tileBounds=new Fs(d.bounds,this.minzoom,this.maxzoom)),mt(d.tiles),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),i&&i(s)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,s){const d=n.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);i.request=n.o(this.map._requestManager.transformRequest(x,n.R.Tile),(w,E,O,B)=>(delete i.request,i.aborted?(i.state="unloaded",s(null)):w?(i.state="errored",s(w)):E?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:O,expires:B}),i.setTexture(E,this.map.painter),i.state="loaded",n.ax(this.dispatcher),void s(null)):s(null)))}abortTile(i,s){i.request&&(i.request.cancel(),delete i.request),s&&s()}unloadTile(i,s){i.texture&&i.texture instanceof n.T?(i.destroy(!0),i.texture&&i.texture instanceof n.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Xo extends wo{constructor(i,s,d,x){super(i,s,d,x),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},s)}triggerRepaint(i){const s=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);s&&s.enabled&&d&&s._clearRenderCacheForTile(d.id,i.tileID),this.map.triggerRepaint()}loadTile(i,s){const d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(d,n.R.Tile);i.requestParams=x,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(w,E,O,B)=>{if(delete i.request,i.aborted)return i.state="unloaded",s(null);if(w)return w.code===20?void 0:(i.state="errored",s(w));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:O,expires:B}),i.state="empty",s(null)})}unloadTile(i,s){const d=i.texture;d&&d instanceof n.T?(i.destroy(!0),this.map.painter.saveTileTexture(d)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,s,d){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(s,d,(x,w)=>{if(x)return i.state="errored",this.fire(new n.t(x)),void this.triggerRepaint(i);w&&(i.setTexture(w,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:w})=>w===i),d=s&&s.fields,x=d&&d.bands&&d.bands;return x?x[0]:0}getTextureDescriptor(i,s,d){if(!i)return;const x=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;s instanceof n.aB?w=s.paint.get("raster-array-band"):s instanceof n.aC&&(w=s.paint.get("raster-particle-array-band"));const E=w||this.getInitialBand(x);if(E!=null)if(i.textureDescriptor){if(!i.updateNeeded(x,E)||d)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,x,E)}}const ka={vector:Ps,raster:wo,"raster-dem":class extends wo{constructor(h,i,s,d){super(h,i,s,d),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(h,i){const s=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(x,w){x&&(h.state="errored",i(x)),w&&(h.dem=w,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",i(null))}h.request=n.o(this.map._requestManager.transformRequest(s,n.R.Tile),(function(x,w,E,O){if(delete h.request,h.aborted)h.state="unloaded",i(null);else if(x)h.state="errored",i(x);else if(w){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:E,expires:O});const B=ImageBitmap&&w instanceof ImageBitmap&&n.ay(),j=1-(w.width-n.az(w.width))/2;j<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const H=B?w:n.q.getImageData(w,j),Z={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:H,encoding:this.encoding,padding:j};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",Z,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const i=h.canonical,s=Math.pow(2,i.z),d=(i.x-1+s)%s,x=i.x===0?h.wrap-1:h.wrap,w=(i.x+1+s)%s,E=i.x+1===s?h.wrap+1:h.wrap,O={};return O[new n.aA(h.overscaledZ,x,i.z,d,i.y).key]={backfilled:!1},O[new n.aA(h.overscaledZ,E,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(O[new n.aA(h.overscaledZ,x,i.z,d,i.y-1).key]={backfilled:!1},O[new n.aA(h.overscaledZ,h.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},O[new n.aA(h.overscaledZ,E,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<s&&(O[new n.aA(h.overscaledZ,x,i.z,d,i.y+1).key]={backfilled:!1},O[new n.aA(h.overscaledZ,h.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},O[new n.aA(h.overscaledZ,E,i.z,w,i.y+1).key]={backfilled:!1}),O}},"raster-array":Xo,geojson:class extends n.E{constructor(h,i,s,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(d),this._data=i.data,this._options=n.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=n.ab/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:n.ab,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:n.ab,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new n.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new n.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const s of this._data.features)i.set(s.id,s);for(const s of h.features)i.set(s.id,s);this._data.features=[...i.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},i),this}getClusterChildren(h,i){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},i),this}getClusterLeaves(h,i,s,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:i,offset:s},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.x("dataloading",{dataType:"source"})),this._loaded=!1;const i=n.l({append:h},this.workerOptions);i.scope=this.scope;const s=this._data;typeof s=="string"?(i.request=this.map._requestManager.transformRequest(n.q.resolveURL(s),n.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(d,x)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new n.t(d));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new n.x("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,i){const s=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,x=d?{image:d.image.clone()}:null,w=this._partialReload,E={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:w};h.request=this.actor.send(s,E,(O,B)=>w&&!B?(h.state="loaded",i(null)):(delete h.request,h.destroy(),h.aborted?i(null):O?i(O):(h.loadVectorData(B,this.map.painter,s==="reloadTile"),i(null))),void 0,s==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,i){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aD{constructor(h,i,s,d){super(h,i,s,d),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const i of h.urls)this.urls.push(this.map._requestManager.transformRequest(i,n.R.Source).url);n.aE(this.urls,(i,s)=>{this._loaded=!0,i?this.fire(new n.t(i)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const i=this.video.seekable;h<i.start(0)||h>i.end(0)?this.fire(new n.t(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,i=h.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(h,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aD,model:class extends n.E{constructor(h,i,s,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const h=[];for(const i in this._options.models){const s=this._options.models[i],d=n.aG(this.map._requestManager.transformRequest(s.uri,n.R.Model).url).then(x=>{if(!x)return;const w=n.aH(x),E=new n.aI(i,s.position,s.orientation,w);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(x=>{this.fire(new n.t(new Error(`Could not load model ${i} from ${s.uri}: ${x.message}`)))});h.push(d)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new n.t(new Error(`Could not load models: ${i.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,i){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(h,i,s,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=es(this._options,this.map._requestManager,i,s,(d,x)=>{this._tileJSONRequest=null,this._loaded=!0,d?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new n.t(d))):x&&(n.l(this,x),x.bounds&&(this.tileBounds=new Fs(x.bounds,this.minzoom,this.maxzoom)),mt(x.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,i){const s=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(s,n.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=i;else{if(h.buckets){const w=Object.values(h.buckets);for(const E of w)E.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,x.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,x.bind(this),void 0,!0);function x(w,E){return h.aborted?i(null):w&&w.status!==404?i(w):(this.map._refreshExpiredTiles&&E&&h.setExpiryData(E),h.loadModelData(E,this.map.painter),h.state="loaded",void i(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aD{constructor(h,i,s,d){super(h,i,s,d),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new n.t(new n.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.t(new n.V(`sources.${h}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new n.t(new n.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new n.t(new n.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.t(new n.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof n.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends n.E{constructor(h,i,s,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=i,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Fs(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ar(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:i,y:s,z:d}=h.canonical;return this._implementation.hasTile({x:i,y:s,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,i){const{x:s,y:d,z:x}=h.tileID.canonical,w=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:s,y:d,z:x},{signal:w.signal})).then((function(E){return delete h.request,h.aborted?(h.state="unloaded",i(null)):E===void 0?(h.state="errored",i(null)):E===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",i(null)):function(O){return O instanceof ImageData||O instanceof HTMLCanvasElement||O instanceof ImageBitmap||O instanceof HTMLImageElement}(E)?(this.loadTileData(h,E),h.state="loaded",void i(null)):(h.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(h.state="errored",i(E))}),h.request.cancel=()=>w.abort()}loadTileData(h,i){h.setTexture(i,this.map.painter)}unloadTile(h,i){if(h.texture&&h.texture instanceof n.T?(h.destroy(!0),h.texture&&h.texture instanceof n.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:s,y:d,z:x}=h.tileID.canonical;this._implementation.unloadTile({x:s,y:d,z:x})}i&&i()}abortTile(h,i){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=n.av(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}}},ll=function(h,i,s,d){const x=new ka[i.type](h,i,s,d);if(x.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${x.id}`);return n.aJ(["load","abort","unload","serialize","prepare"],x),x};function na(h,i){const s=n.a6.mat4.identity([]);return n.a6.mat4.scale(s,s,[.5*h.width,.5*-h.height,1]),n.a6.mat4.translate(s,s,[1,-1,0]),n.a6.mat4.multiply(s,s,h.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(s)}function nr(h,i,s,d,x,w,E,O,B=!1){const j=h.tilesIn(s,O,B);j.sort(fo);const H=[];for(const Y of j)H.push({wrappedTileID:Y.tile.tileID.wrapped().key,queryResults:Y.tile.queryRenderedFeatures(i,h._state,Y,d,x,w,E,na(h.transform,Y.tile.tileID),B)});const Z=function(Y){const se={},pe={};for(const ue of Y){const _e=ue.queryResults,ge=ue.wrappedTileID,Oe=pe[ge]=pe[ge]||{};for(const Ne in _e){const Ue=_e[Ne],$e=Oe[Ne]=Oe[Ne]||{},Ke=se[Ne]=se[Ne]||[];for(const Ze of Ue)$e[Ze.featureIndex]||($e[Ze.featureIndex]=!0,Ke.push(Ze))}}return se}(H);for(const Y in Z)Z[Y].forEach(se=>{const pe=se.feature,ue=pe.layer;ue&&ue.type!=="background"&&ue.type!=="sky"&&ue.type!=="slot"&&(n.aK(Y)||(pe.source=ue.source,ue["source-layer"]&&(pe.sourceLayer=ue["source-layer"])),pe.state=pe.id!==void 0?h.getFeatureState(ue["source-layer"],pe.id):{})});return Z}function Go(h,i){const s=h.getRenderableIds().map(w=>h.getTileByID(w)),d=[],x={};for(let w=0;w<s.length;w++){const E=s[w],O=E.tileID.canonical.key;x[O]||(x[O]=!0,E.querySourceFeatures(d,i))}return d}function fo(h,i){const s=h.tileID,d=i.tileID;return s.overscaledZ-d.overscaledZ||s.canonical.y-d.canonical.y||s.wrap-d.wrap||s.canonical.x-d.canonical.x}function Bo(h,i){const s={};if(!i)return s;for(const d of h){const x=d.layerIds.map(w=>i.getLayer(w)).filter(Boolean);if(x.length!==0){d.layers=x,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(w=>x.filter(E=>E.id===w)[0]));for(const w of x)s[w.fqid]=d}}return s}const ra=32,mo=33,Ho=new Uint16Array(8184);for(let h=0;h<2046;h++){let i=h+2,s=0,d=0,x=0,w=0,E=0,O=0;for(1&i?x=w=E=ra:s=d=O=ra;(i>>=1)>1;){const j=s+x>>1,H=d+w>>1;1&i?(x=s,w=d,s=E,d=O):(s=x,d=w,x=E,w=O),E=j,O=H}const B=4*h;Ho[B+0]=s,Ho[B+1]=d,Ho[B+2]=x,Ho[B+3]=w}const Ws=new Uint16Array(2178),pa=new Uint8Array(1089),cl=new Uint16Array(1089);function Fa(h){return h===0?-.03125:h===32?.03125:0}const zl={type:2,extent:n.ab,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ab+1,0),new n.P(n.ab+1,n.ab+1),new n.P(0,n.ab+1),new n.P(0,0)]]};class Us{constructor(i,s,d,x,w){this.tileID=i,this.uid=n.aQ(),this.uses=0,this.tileSize=s,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection)}registerFadeDuration(i){const s=i+this.timeAdded;s<n.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,s,d){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=Bo(i.buckets,s.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const w=this.buckets[x];if(w instanceof n.aS){if(this.hasSymbolBuckets=!0,!d)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const w=this.buckets[x];if(w instanceof n.aS&&w.hasRTLText){this.hasRTLText=!0,n.aT();break}}this.queryPadding=0;for(const x in this.buckets){const w=this.buckets[x],E=s.style.getOwnLayer(x);if(!E)continue;const O=E.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,O)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new n.aR}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,s,d){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets={...this.buckets,...Bo(i.buckets,s.style)},i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const x in this.buckets){const w=this.buckets[x];w.uploadPending()&&w.upload(i)}const s=i.gl,d=this.imageAtlas;if(d&&!d.uploaded){const x=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new n.T(i,d.image,s.RGBA8,{useMipmap:x}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(i,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(i,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(i,s,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,d),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=s.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this._lastUpdatedBrightness=x,this.updateBuckets(s)))}queryRenderedFeatures(i,s,d,x,w,E,O,B,j){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:B,transform:O,filter:x,layers:w,availableImages:E,tileTransform:this.tileTransform},i,s):{}}querySourceFeatures(i,s){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const x=d.loadVTLayers(),w=s?s.sourceLayer:"",E=x._geojsonTileLayer||x[w];if(!E)return;const O=n.aU(s&&s.filter),{z:B,x:j,y:H}=this.tileID.canonical,Z={z:B,x:j,y:H};for(let Y=0;Y<E.length;Y++){const se=E.feature(Y);if(O.needGeometry){const _e=n.aV(se,!0);if(!O.filter(new n.a3(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!O.filter(new n.a3(this.tileID.overscaledZ),se))continue;const pe=d.getId(se,w),ue=new n.aW(se,B,j,H,pe);ue.tile=Z,i.push(ue)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const s=this.expirationTime;if(i.cacheControl){const d=n.aX(i.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const d=Date.now();let x=!1;if(this.expirationTime>d)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{const w=this.expirationTime-s;w?this.expirationTime=d+Math.max(w,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),d=i.style.listImages(),x=i.style.getBrightness();for(const w in this.buckets){if(!i.style.hasLayer(w))continue;const E=this.buckets[w],O=E.layers[0],B=O.sourceLayer||"_geojsonTileLayer",j=s[B],H=i.style.getSourceCache(O.source,O.scope);let Z={};H&&(Z=H._state.getState(B,void 0)),E.update(Z,j,d,this.imageAtlas&&this.imageAtlas.patternPositions||{},x),(E instanceof n.aY||E instanceof n.aZ)&&i._terrain&&i._terrain.enabled&&H&&E.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(H.id,this.tileID);const Y=i&&i.style&&i.style.getOwnLayer(w);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=n.q.now()+i}setTexture(i,s){const d=s.context,x=d.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture&&this.texture instanceof n.T?this.texture.update(i):(this.texture=new n.T(d,i,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(i,s){const d={};for(const x of s)d[x]=!0;this.dependencies[i]=d}hasDependency(i,s){for(const d of i){const x=this.dependencies[d];if(x){for(const w of s)if(x[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const d=n.a_(zl,this.tileID.canonical,this.tileTransform)[0],x=new n.a$,w=new n.b0;for(let E=0;E<d.length;E++){const{x:O,y:B}=d[E];x.emplaceBack(O,B),w.emplaceBack(E)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(x,n.b1.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,x.length,w.length)}_makeTileBoundsBuffers(i,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const d=n.a_(zl,this.tileID.canonical,this.tileTransform)[0];let x,w;if(this.isRaster){const E=function(O,B){const j=n.aL(O,B),H=Math.pow(2,O.z);for(let _e=0;_e<mo;_e++)for(let ge=0;ge<mo;ge++){const Oe=n.aM((O.x+(ge+Fa(ge))/ra)/H),Ne=n.aN((O.y+(_e+Fa(_e))/ra)/H),Ue=B.project(Oe,Ne),$e=_e*mo+ge;Ws[2*$e+0]=Math.round((Ue.x*j.scale-j.x)*n.ab),Ws[2*$e+1]=Math.round((Ue.y*j.scale-j.y)*n.ab)}pa.fill(0),cl.fill(0);for(let _e=2045;_e>=0;_e--){const ge=4*_e,Oe=Ho[ge+0],Ne=Ho[ge+1],Ue=Ho[ge+2],$e=Ho[ge+3],Ke=Oe+Ue>>1,Ze=Ne+$e>>1,it=Ke+Ze-Ne,gt=Ze+Oe-Ke,Lt=Ne*mo+Oe,wt=$e*mo+Ue,vt=Ze*mo+Ke,ri=Math.hypot((Ws[2*Lt+0]+Ws[2*wt+0])/2-Ws[2*vt+0],(Ws[2*Lt+1]+Ws[2*wt+1])/2-Ws[2*vt+1])>=16;pa[vt]=pa[vt]||(ri?1:0),_e<1022&&(pa[vt]=pa[vt]||pa[(Ne+gt>>1)*mo+(Oe+it>>1)]||pa[($e+gt>>1)*mo+(Ue+it>>1)])}const Z=new n.aO,Y=new n.aP;let se=0;function pe(_e,ge){const Oe=ge*mo+_e;return cl[Oe]===0&&(Z.emplaceBack(Ws[2*Oe+0],Ws[2*Oe+1],_e*n.ab/ra,ge*n.ab/ra),cl[Oe]=++se),cl[Oe]-1}function ue(_e,ge,Oe,Ne,Ue,$e){const Ke=_e+Oe>>1,Ze=ge+Ne>>1;if(Math.abs(_e-Ue)+Math.abs(ge-$e)>1&&pa[Ze*mo+Ke])ue(Ue,$e,_e,ge,Ke,Ze),ue(Oe,Ne,Ue,$e,Ke,Ze);else{const it=pe(_e,ge),gt=pe(Oe,Ne),Lt=pe(Ue,$e);Y.emplaceBack(it,gt,Lt)}}return ue(0,0,ra,ra,ra,0),ue(ra,ra,0,0,0,ra),{vertices:Z,indices:Y}}(this.tileID.canonical,s);x=E.vertices,w=E.indices}else{x=new n.aO,w=new n.aP;for(const{x:O,y:B}of d)x.emplaceBack(O,B,0,0);const E=n.b3(x.int16,void 0,4);for(let O=0;O<E.length;O+=3)w.emplaceBack(E[O],E[O+1],E[O+2])}this._tileBoundsBuffer=i.createVertexBuffer(x,n.b4.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=n.b2.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugBuffers(i,s){const d=s.projection;if(!d||d.name!=="globe"||s.freezeTileCoverage)return;const x=this.tileID.canonical,w=n.b5(x,s),E=n.b6(w),O=n.a9(s.zoom);let B;O>0&&(B=n.a6.mat4.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,x,s,E,B,O),this._makeGlobeTileDebugTextBuffer(i,x,s,E,B,O)}_globePoint(i,s,d,x,w,E,O){let B=n.b7(i,s,d);if(E){const j=1<<d.z,H=n.am(x.center.lng),Z=n.at(x.center.lat),Y=(d.x+.5)/j-H;let se=0;Y>.5?se=-1:Y<-.5&&(se=1);let pe=(i/n.ab+d.x)/j+se,ue=(s/n.ab+d.y)/j;pe=(pe-H)*x._pixelsPerMercatorPixel+H,ue=(ue-Z)*x._pixelsPerMercatorPixel+Z;const _e=[pe*x.worldSize,ue*x.worldSize,0];n.a6.vec3.transformMat4(_e,_e,E),B=n.b8(B,_e,O)}return n.a6.vec3.transformMat4(B,B,w)}_makeGlobeTileDebugBorderBuffer(i,s,d,x,w,E){const O=new n.a$,B=new n.b0,j=new n.b9,H=(Y,se,pe,ue,_e)=>{const ge=(pe-Y)/(_e-1),Oe=(ue-se)/(_e-1),Ne=O.length;for(let Ue=0;Ue<_e;Ue++){const $e=Y+Ue*ge,Ke=se+Ue*Oe;O.emplaceBack($e,Ke);const Ze=this._globePoint($e,Ke,s,d,x,w,E);j.emplaceBack(Ze[0],Ze[1],Ze[2]),B.emplaceBack(Ne+Ue)}},Z=n.ab;H(0,0,Z,0,16),H(Z,0,Z,Z,16),H(Z,Z,0,Z,16),H(0,Z,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(B),this._tileDebugBuffer=i.createVertexBuffer(O,n.b1.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(j,n.ba.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,O.length,B.length)}_makeGlobeTileDebugTextBuffer(i,s,d,x,w,E){const O=n.ab/4,B=new n.a$,j=new n.aP,H=new n.b9,Z=25;j.reserve(32),B.reserve(Z),H.reserve(Z);const Y=(se,pe)=>Z*se+pe;for(let se=0;se<Z;se++){const pe=se*O;for(let ue=0;ue<Z;ue++){const _e=ue*O;B.emplaceBack(_e,pe);const ge=this._globePoint(_e,pe,s,d,x,w,E);H.emplaceBack(ge[0],ge[1],ge[2])}}for(let se=0;se<4;se++)for(let pe=0;pe<4;pe++){const ue=Y(se,pe),_e=Y(se,pe+1),ge=Y(se+1,pe),Oe=Y(se+1,pe+1);j.emplaceBack(ue,_e,ge),j.emplaceBack(ge,_e,Oe)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(j),this._tileDebugTextBuffer=i.createVertexBuffer(B,n.b1.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(H,n.ba.members),this._tileDebugTextSegments=n.b2.simpleSegment(0,0,Z,32)}destroy(i=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bb.setPbf(n.bc);class ul extends Us{constructor(i,s,d,x,w){super(i,s,d,x,w),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,s){const d=s.context,x=d.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture&&this.texture instanceof n.T?this.texture.update(i,{premultiply:!1}):this.texture=new n.T(d,i,x.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,s){const d=this._mrt=new n.bb(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=n.bd(x,(w,E,O,B)=>{if(w)s(w);else try{const j=d.getHeaderLength(E);if(j>i)return void(this.request=this.fetchHeader(j,s));d.parseHeader(E),this._isHeaderLoaded=!0;let H=0;for(const Z of Object.values(d.layers))H=Math.max(H,Z.dataIndex[Z.dataIndex.length-1].last_byte);E.byteLength>=H&&(this.entireBuffer=E),s(null,this.entireBuffer||E,O,B)}catch(j){s(j)}}),this.request}fetchBand(i,s,d){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void d(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void d(new Error("Can't fetch tile band without an actor"));let E;const O=(Z,Y)=>{E.complete(Z,Y),Z?d(Z):(this.updateTextureDescriptor(i,s),d(null,this.textureDescriptor&&this.textureDescriptor.img))},B=(Z,Y)=>{if(Z)return d(Z);const se=w.send("decodeRasterArray",{buffer:Y,task:E},O,void 0,!0);this._workQueue.push(()=>{se&&se.cancel(),E.cancel()})},j=x.getLayer(i);if(!j)return void d(new Error(`Unknown sourceLayer "${i}"`));if(j.hasDataForBand(s))return this.updateTextureDescriptor(i,s),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const H=j.getDataRange([s]);if(E=x.createDecodingTask(H),!E||E.tasks.length)if(this.flushQueues(),this.entireBuffer)B(null,this.entireBuffer.slice(H.firstByte,H.lastByte+1));else{const Z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${H.firstByte}-${H.lastByte}`}}),Y=n.bd(Z,B);this._fetchQueue.push(()=>{Y.cancel(),E.cancel()})}else d(null)}updateNeeded(i,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,s){if(!this._mrt)return;const d=this._mrt.getLayer(i);if(!d||!d.hasBand(s)||!d.hasDataForBand(s))return;const{bytes:x,tileSize:w,buffer:E,offset:O,scale:B}=d.getBandView(s),j=w+2*E,H={data:x,width:j,height:j},Z=this.texture;Z&&Z instanceof n.T&&Z.update(H,{premultiply:!1}),this.textureDescriptor={layer:i,band:s,img:H,buffer:E,offset:O,tileSize:w,format:d.pixelFormat,mix:[B,256*B,65536*B,16777216*B]}}}class hl{constructor(i,s){this.max=i,this.onRemove=s,this.reset()}reset(){for(const i in this.data)for(const s of this.data[i])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(i,s,d){const x=i.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const w={value:s,timeout:void 0};if(d!==void 0&&(w.timeout=setTimeout(()=>{this.remove(i,w)},d)),this.data[x].push(w),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const s=this.data[i].shift();return s.timeout&&clearTimeout(s.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),s.value}getByKey(i){const s=this.data[i];return s?s[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,s){if(!this.has(i))return this;const d=i.wrapped().key,x=s===void 0?0:this.data[d].indexOf(s),w=this.data[d][x];return this.data[d].splice(x,1),w.timeout&&clearTimeout(w.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(w.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(i){const s=[];for(const d in this.data)for(const x of this.data[d])i(x.value)||s.push(x);for(const d of s)this.remove(d.value.tileID,d)}}class Ae{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,s,d){const x=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][x]=this.stateChanges[i][x]||{},n.l(this.stateChanges[i][x],d),this.deletedStates[i]===null){this.deletedStates[i]={};for(const w in this.state[i])w!==x&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][x]===null){this.deletedStates[i][x]={};for(const w in this.state[i][x])d[w]||(this.deletedStates[i][x][w]=null)}else for(const w in d)this.deletedStates[i]&&this.deletedStates[i][x]&&this.deletedStates[i][x][w]===null&&delete this.deletedStates[i][x][w]}removeFeatureState(i,s,d){if(this.deletedStates[i]===null)return;const x=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},d&&s!==void 0)this.deletedStates[i][x]!==null&&(this.deletedStates[i][x]=this.deletedStates[i][x]||{},this.deletedStates[i][x][d]=null);else if(s!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][x])for(d in this.deletedStates[i][x]={},this.stateChanges[i][x])this.deletedStates[i][x][d]=null;else this.deletedStates[i][x]=null;else this.deletedStates[i]=null}getState(i,s){const d=this.state[i]||{},x=this.stateChanges[i]||{},w=this.deletedStates[i];if(w===null)return{};if(s!==void 0){const O=String(s),B=n.l({},d[O],x[O]);if(w){const j=w[s];if(j===null)return{};for(const H in j)delete B[H]}return B}const E=n.l({},d,x);if(w)for(const O in w)delete E[O];return E}initializeTileState(i,s){i.refreshFeatureState(s)}coalesceChanges(i,s){const d={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const w={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),n.l(this.state[x][E],this.stateChanges[x][E]),w[E]=this.state[x][E];d[x]=w}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const w={};if(this.deletedStates[x]===null)for(const E in this.state[x])w[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const O of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][O];w[E]=this.state[x][E]}d[x]=d[x]||{},n.l(d[x],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const x in i)i[x].refreshFeatureState(s)}}class Te extends n.E{constructor(i,s,d){super(),this.id=i,this._onlySymbols=d,s.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new hl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ae,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const s=this._tiles[i];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,s){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,s)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const d=this._tiles[s];d.upload(i),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.be(this._tiles).map(i=>i.tileID).sort(Ve).map(i=>i.key)}getRenderableIds(i,s){const d=[];for(const x in this._tiles)this._isIdRenderable(+x,i,s)&&d.push(this._tiles[x]);return i?d.sort((x,w)=>{const E=x.tileID,O=w.tileID,B=new n.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),j=new n.P(O.canonical.x,O.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-O.overscaledZ||j.y-B.y||j.x-B.x}).map(x=>x.tileID.key):d.map(x=>x.tileID).sort(Ve).map(x=>x.key)}hasRenderableParent(i){const s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(i,s,d){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())&&(d||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,s){const d=this._tiles[i];d&&(d.state!=="loading"&&(d.state=s),this._loadTile(d,this._tileLoaded.bind(this,d,i,s)))}_tileLoaded(i,s,d,x){if(x)if(i.state="errored",x.status!==404)this._source.fire(new n.t(x,{tile:i}));else{if(this._source.fire(new n.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=n.q.now(),d==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new n.x("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const s=this.getRenderableIds();for(let x=0;x<s.length;x++){const w=s[x];if(i.neighboringTiles&&i.neighboringTiles[w]){const E=this.getTileByID(w);d(i,E),d(E,i)}}function d(x,w){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=w.tileID.canonical.x-x.tileID.canonical.x;const O=w.tileID.canonical.y-x.tileID.canonical.y,B=Math.pow(2,x.tileID.canonical.z),j=w.tileID.key;E===0&&O===0||Math.abs(O)>1||(Math.abs(E)>1&&(Math.abs(E+B)===1?E+=B:Math.abs(E-B)===1&&(E-=B)),w.dem&&x.dem&&(x.dem.backfillBorder(w.dem,E,O),x.neighboringTiles&&x.neighboringTiles[j]&&(x.neighboringTiles[j].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,s,d,x){for(const w in this._tiles){let E=this._tiles[w];if(x[w]||!E.hasData()||E.tileID.overscaledZ<=s||E.tileID.overscaledZ>d)continue;let O=E.tileID;for(;E&&E.tileID.overscaledZ>s+1;){const j=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[j.key],E&&E.hasData()&&(O=j)}let B=O;for(;B.overscaledZ>s;)if(B=B.scaledTo(B.overscaledZ-1),i[B.key]){x[O.key]=O;break}}}findLoadedParent(i,s){if(i.key in this._loadedParentTiles){const d=this._loadedParentTiles[i.key];return d&&d.tileID.overscaledZ>=s?d:null}for(let d=i.overscaledZ-1;d>=s;d--){const x=i.scaledTo(d),w=this._getLoadedTile(x);if(w)return w}}_getLoadedTile(i){const s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,s){s=s||this._source.tileSize;const d=Math.ceil(i.width/s)+1,x=Math.ceil(i.height/s)+1,w=Math.floor(d*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,O=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(O)}handleWrapJump(i){const s=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,s){const d={};for(const x in this._tiles){const w=this._tiles[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),d[w.tileID.key]=w}this._tiles=d;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(i,s,d,x){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(i,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let E,O=this._source.maxzoom;const B=this.map&&this.map.painter?this.map.painter._terrain:null;if(B&&B.sourceCache===this&&B.attenuationRange()){const Z=B.attenuationRange()[0],Y=Math.floor(Z)-Math.log2(B.getDemUpscale());O>Y&&(O=Y)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(Z=>new n.aA(Z.canonical.z,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y));else if(this.tileCoverLift!==0){const Z=i.clone();Z.tileCoverLift=this.tileCoverLift,E=Z.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&i.projection.name==="globe"&&(E.push(new n.aA(1,0,1,0,0)),E.push(new n.aA(1,0,1,1,0)),E.push(new n.aA(1,0,1,0,1)),E.push(new n.aA(1,0,1,1,1)))}else if(E=i.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const Z=this._source.hasTile.bind(this._source);E=E.filter(Y=>Z(Y))}}else E=[];if(E.length>0&&this.castsShadows&&x&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Pt(this._source.type)){const Z=i.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),Y=Math.min(Z,this._source.maxzoom);if(w){const se=i.extendTileCover(E,Y);for(const pe of se)E.push(pe)}else{const se=i.extendTileCover(E,Y,x);for(const pe of se)this._shadowCasterTiles[pe.key]=!0,E.push(pe)}}const j=this._updateRetainedTiles(E);if(Pt(this._source.type)&&E.length!==0){const Z={},Y={},se=Object.keys(j);for(const ue of se){const _e=j[ue],ge=this._tiles[ue];if(!ge||ge.fadeEndTime&&ge.fadeEndTime<=n.q.now())continue;const Oe=this.findLoadedParent(_e,Math.max(_e.overscaledZ-Te.maxOverzooming,this._source.minzoom));Oe&&(this._addTile(Oe.tileID),Z[Oe.tileID.key]=Oe.tileID),Y[ue]=_e}const pe=E[E.length-1].overscaledZ;for(const ue in this._tiles){const _e=this._tiles[ue];if(j[ue]||!_e.hasData())continue;let ge=_e.tileID;for(;ge.overscaledZ>pe;){ge=ge.scaledTo(ge.overscaledZ-1);const Oe=this._tiles[ge.key];if(Oe&&Oe.hasData()&&Y[ge.key]){j[ue]=_e.tileID;break}}}for(const ue in Z)j[ue]||(this._coveredTiles[ue]=!0,j[ue]=Z[ue])}for(const Z in j)this._tiles[Z].clearFadeHold();const H=n.bf(this._tiles,j);for(const Z of H){const Y=this._tiles[Z];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(+Z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const s={};if(i.length===0)return s;const d={},x=i.reduce((j,H)=>Math.min(j,H.overscaledZ),1/0),w=i[0].overscaledZ,E=Math.max(w-Te.maxOverzooming,this._source.minzoom),O=Math.max(w+Te.maxUnderzooming,this._source.minzoom),B={};for(const j of i){const H=this._addTile(j);s[j.key]=j,H.hasData()||x<this._source.maxzoom&&(B[j.key]=j)}this._retainLoadedChildren(B,x,O,s);for(const j of i){let H=this._tiles[j.key];if(H.hasData())continue;if(j.canonical.z>=this._source.maxzoom){const Y=j.children(this._source.maxzoom)[0],se=this.getTile(Y);if(se&&se.hasData()){s[Y.key]=Y;continue}}else{const Y=j.children(this._source.maxzoom);if(s[Y[0].key]&&s[Y[1].key]&&s[Y[2].key]&&s[Y[3].key])continue}let Z=H.wasRequested();for(let Y=j.overscaledZ-1;Y>=E;--Y){const se=j.scaledTo(Y);if(d[se.key]||(d[se.key]=!0,H=this.getTile(se),!H&&Z&&(H=this._addTile(se)),H&&(s[se.key]=se,Z=H.wasRequested(),H.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const s=[];let d,x=this._tiles[i].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){d=this._loadedParentTiles[x.key];break}s.push(x.key);const w=x.scaledTo(x.overscaledZ-1);if(d=this._getLoadedTile(w),d)break;x=w}for(const w of s)this._loadedParentTiles[w]=d}}_addTile(i){let s=this._tiles[i.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),s;s=this._cache.getAndRemove(i),s&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));const d=!!s;if(!d){const x=this.map?this.map.painter:null,w=this._source.tileSize*i.overscaleFactor();s=this._source.type==="raster-array"?new ul(i,w,this.transform.tileZoom,x,this._isRaster):new Us(i,w,this.transform.tileZoom,x,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))}return s?(s.uses++,this._tiles[i.key]=s,d||this._source.fire(new n.x("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(i,s){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const d=s.getExpiryTimeout();d&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},d))}_removeTile(i){const s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,s,d){const x=[],w=this.transform;if(!w)return x;const E=w.projection.name==="globe",O=n.am(w.center.lng);for(const B in this._tiles){const j=this._tiles[B];if(d&&j.clearQueryDebugViz(),j.holdingForFade())continue;let H;if(E){const Z=j.tileID.canonical;if(Z.z===0){const Y=[Math.abs(n.ap(O,...Ai(Z,-1))-O),Math.abs(n.ap(O,...Ai(Z,1))-O)];H=[0,2*Y.indexOf(Math.min(...Y))-1]}else{const Y=[Math.abs(n.ap(O,...Ai(Z,-1))-O),Math.abs(n.ap(O,...Ai(Z,0))-O),Math.abs(n.ap(O,...Ai(Z,1))-O)];H=[Y.indexOf(Math.min(...Y))-1]}}else H=[0];for(const Z of H){const Y=i.containsTile(j,w,s,Z);Y&&x.push(Y)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,s){const d=this.getRenderableIds(i,s).map(w=>this._tiles[w].tileID),x=this.transform.projection.name==="globe";for(const w of d)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=x?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return d}sortCoordinatesByDistance(i){const s=i.slice(),d=this.transform._camera.position,x=this.transform._camera.forward(),w={};for(const E of s){const O=1/(1<<E.canonical.z);w[E.key]=((E.canonical.x+.5)*O+E.wrap-d[0])*x[0]+((E.canonical.y+.5)*O-d[1])*x[1]-d[2]*x[2]}return s.sort((E,O)=>w[E.key]-w[O.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Pt(this._source.type))for(const i in this._tiles){const s=this._tiles[i];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(i,s,d){this._state.updateState(i=i||"_geojsonTileLayer",s,d)}removeFeatureState(i,s,d){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,d)}getFeatureState(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)}setDependencies(i,s,d){const x=this._tiles[i];x&&x.setDependencies(s,d)}reloadTilesForDependencies(i,s){for(const d in this._tiles)this._tiles[d].hasDependency(i,s)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(i,s))}_preloadTiles(i,s){if(!this._sourceLoaded){const B=()=>{this._sourceLoaded&&(this._source.off("data",B),this._preloadTiles(i,s))};return void this._source.on("data",B)}const d=new Map,x=Array.isArray(i)?i:[i],w=this.map.painter.terrain,E=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const B of x){const j=B.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const H of j)d.set(H.key,H);this.usedForTerrain&&B.updateElevation(!1)}const O=Array.from(d.values());n.bg(O,(B,j)=>{const H=new Us(B,this._source.tileSize*B.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(H,Z=>{this._source.type==="raster-dem"&&H.dem&&this._backfillDEM(H),j(Z,H)})},s)}}function Ve(h,i){const s=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*i.wrap)-+(i.wrap<0);return h.overscaledZ-i.overscaledZ||d-s||i.canonical.y-h.canonical.y||i.canonical.x-h.canonical.x}function Pt(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Ai(h,i){const s=1<<h.z;return[h.x/s+i,(h.x+1)/s+i]}Te.maxOverzooming=10,Te.maxUnderzooming=3;class Ui{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,s=!1;for(const d in this.style._mergedLayers){const x=this.style._mergedLayers[d];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:i,visibilityChanged:s});else if(x.type==="model"){const w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:i,visibilityChanged:s})}}}onNewFrame(i){this.layersGotHidden=!1;for(const s of this.layers){const d=s.layer;let x=!1;d.type==="fill-extrusion"?x=!d.isHidden(i)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(x=!d.isHidden(i)&&d.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&s.visible,s.visible=x}}updateZOffset(i,s){this.currentBuildingBuckets=[];for(const x of this.layers){const w=x.layer,E=this.style.getLayerSourceCache(w);let O=1;w.type==="fill-extrusion"&&(O=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let B=E?E.getTile(s):null;if(!B&&E&&s.canonical.z>E.getSource().minzoom){let j=s.scaledTo(Math.min(E.getSource().maxzoom,s.overscaledZ-1));for(;j.overscaledZ>=E.getSource().minzoom&&(B=E.getTile(j),!B&&j.overscaledZ!==0);)j=j.scaledTo(j.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:B?B.getBucket(w):null,tileID:B?B.tileID:s,verticalScale:O})}i.hasAnyZOffset=!1;let d=!1;for(let x=0;x<i.symbolInstances.length;x++){const w=i.symbolInstances.get(x),E=w.zOffset,O=this._getHeightAtTileOffset(s,w.tileAnchorX,w.tileAnchorY);w.zOffset=O!==Number.NEGATIVE_INFINITY?O:E,d||E===w.zOffset||(d=!0),i.hasAnyZOffset||w.zOffset===0||(i.hasAnyZOffset=!0)}d&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,s,d,x){let w=s,E=d;if(i.canonical.z!==x.canonical.z){const O=x.canonical,B=1/(1<<i.canonical.z-O.z);w=(s+i.canonical.x*n.ab)*B-O.x*n.ab|0,E=(d+i.canonical.y*n.ab)*B-O.y*n.ab|0}return{tileX:w,tileY:E}}_getHeightAtTileOffset(i,s,d){let x,w;for(let E=0;E<this.layers.length;++E){if(this.layers[E].layer.type!=="fill-extrusion")continue;const{bucket:O,tileID:B,verticalScale:j}=this.currentBuildingBuckets[E];if(!O)continue;const{tileX:H,tileY:Z}=this._mapCoordToOverlappingTile(i,s,d,B),Y=O.getHeightAtTileCoord(H,Z);Y&&Y.height!==void 0&&(Y.hidden?x=Y.height:w=Math.max(Y.height*j,w||0))}if(w!==void 0)return w;for(let E=0;E<this.layers.length;++E){const O=this.layers[E];if(O.layer.type!=="model"||!O.visible)continue;const{bucket:B,tileID:j}=this.currentBuildingBuckets[E];if(!B)continue;const{tileX:H,tileY:Z}=this._mapCoordToOverlappingTile(i,s,d,j),Y=B.getHeightAtTileCoord(H,Z);if(Y&&!Y.hidden)return Y.height===void 0&&x!==void 0?Math.min(Y.maxHeight,x)*Y.verticalScale:Y.height?Y.height*Y.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function bi(h,i){const s={};for(const d in h)d!=="ref"&&(s[d]=h[d]);return n.bh.forEach(d=>{d in i&&(s[d]=i[d])}),s}function Yi(h){h=h.slice();const i=Object.create(null);for(let s=0;s<h.length;s++)i[h[s].id]=h[s];for(let s=0;s<h.length;s++)"ref"in h[s]&&(h[s]=bi(h[s],i[h[s].ref]));return h}const fe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function me(h,i,s){s.push({command:fe.addSource,args:[h,i[h]]})}function Ee(h,i,s){i.push({command:fe.removeSource,args:[h]}),s[h]=!0}function We(h,i,s,d){Ee(h,s,d),me(h,i,s)}function Pe(h,i,s){let d;for(d in h[s])if(h[s].hasOwnProperty(d)&&d!=="data"&&!n.bi(h[s][d],i[s][d]))return!1;for(d in i[s])if(i[s].hasOwnProperty(d)&&d!=="data"&&!n.bi(h[s][d],i[s][d]))return!1;return!0}function li(h,i,s,d,x,w){let E;for(E in i=i||{},h=h||{})h.hasOwnProperty(E)&&(n.bi(h[E],i[E])||s.push({command:w,args:[d,E,i[E],x]}));for(E in i)i.hasOwnProperty(E)&&!h.hasOwnProperty(E)&&(n.bi(h[E],i[E])||s.push({command:w,args:[d,E,i[E],x]}))}function Mi(h){return h.id}function Wi(h,i){return h[i.id]=i,h}class hn{constructor(i,s){this.reset(i,s)}reset(i,s){this.points=i||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=n.ap(i,0,1);let s=1,d=this._distances[s];const x=i*this.paddedLength+this.padding;for(;d<x&&s<this._distances.length;)d=this._distances[++s];const w=s-1,E=this._distances[w],O=d-E,B=O>0?(x-E)/O:0;return this.points[w].mult(1-B).add(this.points[s].mult(B))}}class Dn{constructor(i,s,d){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/d),this.yCellCount=Math.ceil(s/d);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=s,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,s,d,x,w){this._forEachCell(s,d,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(i,s,d,x){this._forEachCell(s-x,d-x,s+x,d+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(s),this.circles.push(d),this.circles.push(x)}_insertBoxCell(i,s,d,x,w,E){this.boxCells[w].push(E)}_insertCircleCell(i,s,d,x,w,E){this.circleCells[w].push(E)}_query(i,s,d,x,w,E){if(d<0||i>this.width||x<0||s>this.height)return!w&&[];const O=[];if(i<=0&&s<=0&&this.width<=d&&this.height<=x){if(w)return!0;for(let B=0;B<this.boxKeys.length;B++)O.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const j=this.circles[3*B],H=this.circles[3*B+1],Z=this.circles[3*B+2];O.push({key:this.circleKeys[B],x1:j-Z,y1:H-Z,x2:j+Z,y2:H+Z})}return E?O.filter(E):O}return this._forEachCell(i,s,d,x,this._queryCell,O,{hitTest:w,seenUids:{box:{},circle:{}}},E),w?O.length>0:O}_queryCircle(i,s,d,x,w){const E=i-d,O=i+d,B=s-d,j=s+d;if(O<0||E>this.width||j<0||B>this.height)return!x&&[];const H=[];return this._forEachCell(E,B,O,j,this._queryCellCircle,H,{hitTest:x,circle:{x:i,y:s,radius:d},seenUids:{box:{},circle:{}}},w),x?H.length>0:H}query(i,s,d,x,w){return this._query(i,s,d,x,!1,w)}hitTest(i,s,d,x,w){return this._query(i,s,d,x,!0,w)}hitTestCircle(i,s,d,x){return this._queryCircle(i,s,d,!0,x)}_queryCell(i,s,d,x,w,E,O,B){const j=O.seenUids,H=this.boxCells[w];if(H!==null){const Y=this.bboxes;for(const se of H)if(!j.box[se]){j.box[se]=!0;const pe=4*se;if(i<=Y[pe+2]&&s<=Y[pe+3]&&d>=Y[pe+0]&&x>=Y[pe+1]&&(!B||B(this.boxKeys[se]))){if(O.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[se],x1:Y[pe],y1:Y[pe+1],x2:Y[pe+2],y2:Y[pe+3]})}}}const Z=this.circleCells[w];if(Z!==null){const Y=this.circles;for(const se of Z)if(!j.circle[se]){j.circle[se]=!0;const pe=3*se;if(this._circleAndRectCollide(Y[pe],Y[pe+1],Y[pe+2],i,s,d,x)&&(!B||B(this.circleKeys[se]))){if(O.hitTest)return E.push(!0),!0;{const ue=Y[pe],_e=Y[pe+1],ge=Y[pe+2];E.push({key:this.circleKeys[se],x1:ue-ge,y1:_e-ge,x2:ue+ge,y2:_e+ge})}}}}}_queryCellCircle(i,s,d,x,w,E,O,B){const j=O.circle,H=O.seenUids,Z=this.boxCells[w];if(Z!==null){const se=this.bboxes;for(const pe of Z)if(!H.box[pe]){H.box[pe]=!0;const ue=4*pe;if(this._circleAndRectCollide(j.x,j.y,j.radius,se[ue+0],se[ue+1],se[ue+2],se[ue+3])&&(!B||B(this.boxKeys[pe])))return E.push(!0),!0}}const Y=this.circleCells[w];if(Y!==null){const se=this.circles;for(const pe of Y)if(!H.circle[pe]){H.circle[pe]=!0;const ue=3*pe;if(this._circlesCollide(se[ue],se[ue+1],se[ue+2],j.x,j.y,j.radius)&&(!B||B(this.circleKeys[pe])))return E.push(!0),!0}}}_forEachCell(i,s,d,x,w,E,O,B){const j=this._convertToXCellCoord(i),H=this._convertToYCellCoord(s),Z=this._convertToXCellCoord(d),Y=this._convertToYCellCoord(x);for(let se=j;se<=Z;se++)for(let pe=H;pe<=Y;pe++)if(w.call(this,i,s,d,x,this.xCellCount*pe+se,E,O,B))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,s,d,x,w,E){const O=x-i,B=w-s,j=d+E;return j*j>O*O+B*B}_circleAndRectCollide(i,s,d,x,w,E,O){const B=(E-x)/2,j=Math.abs(i-(x+B));if(j>B+d)return!1;const H=(O-w)/2,Z=Math.abs(s-(w+H));if(Z>H+d)return!1;if(j<=B||Z<=H)return!0;const Y=j-B,se=Z-H;return Y*Y+se*se<=d*d}}const Zi={unknown:0,flipRequired:1,flipNotRequired:2},Kt=Math.tan(85*Math.PI/180);function nn(h,i,s,d,x,w,E){const O=n.a6.mat4.create();if(s)if(w.name==="globe"){const B=n.bj(x,i);n.a6.mat4.multiply(O,O,B)}else{const B=n.a6.mat2.invert([],E);O[0]=B[0],O[1]=B[1],O[4]=B[2],O[5]=B[3],d||n.a6.mat4.rotateZ(O,O,x.angle)}else n.a6.mat4.multiply(O,x.labelPlaneMatrix,h);return O}function Ei(h,i,s,d,x,w,E){const O=nn(h,i,s,d,x,w,E);return w.name==="globe"&&s||(O[2]=O[6]=O[10]=O[14]=0),O}function Ln(h,i,s,d,x,w,E){if(s){if(w.name==="globe"){const O=nn(h,i,s,d,x,w,E);return n.a6.mat4.invert(O,O),n.a6.mat4.multiply(O,h,O),O}{const O=n.a6.mat4.clone(h),B=n.a6.mat4.identity([]);return B[0]=E[0],B[1]=E[1],B[4]=E[2],B[5]=E[3],n.a6.mat4.multiply(O,O,B),d||n.a6.mat4.rotateZ(O,O,-x.angle),O}}return x.glCoordMatrix}function Vi(h,i,s,d){const x=[h,i,s,1];s?n.a6.vec4.transformMat4(x,x,d):Or(x,x,d);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function fn(h,i){return Math.min(.5+h/i*.5,1.5)}function cr(h,i){const s=h[0]/h[3],d=h[1]/h[3];return s>=-i[0]&&s<=i[0]&&d>=-i[1]&&d<=i[1]}function gr(h,i,s,d,x,w,E,O,B,j){const H=s.transform,Z=d?h.textSizeData:h.iconSizeData,Y=n.bk(Z,s.transform.zoom),se=H.projection.name==="globe",pe=[256/s.width*2+1,256/s.height*2+1],ue=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ue.clear();let _e=null;se&&(_e=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const ge=h.lineVertexArray,Oe=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,Ne=s.transform.width/s.transform.height;let Ue,$e=!1;for(let Ke=0;Ke<Oe.length;Ke++){const Ze=Oe.get(Ke),{numGlyphs:it,writingMode:gt}=Ze;if(gt!==n.bl.vertical||$e||Ue===n.bl.horizontal||($e=!0),Ue=gt,(Ze.hidden||gt===n.bl.vertical)&&!$e){Vs(it,ue);continue}$e=!1;const Lt=new n.P(Ze.tileAnchorX,Ze.tileAnchorY);let{x:wt,y:vt,z:ri}=H.projection.projectTilePoint(Lt.x,Lt.y,j.canonical);if(B){const[mi,Xi,zn]=B(Lt);wt+=mi,vt+=Xi,ri+=zn}const hi=[wt,vt,ri,1];if(n.a6.vec4.transformMat4(hi,hi,i),!cr(hi,pe)){Vs(it,ue);continue}const Si=hi[3],Gi=fn(s.transform.getCameraToCenterDistance(H.projection),Si),Ki=n.bm(Z,Y,Ze),Wt=E?Ki/Gi:Ki*Gi,wi=Vi(wt,vt,ri,x);if(wi[3]<=0){Vs(it,ue);continue}let ui={};const Ti=E?null:B,Ci=ur(Ze,Wt,!1,O,i,x,w,h.glyphOffsetArray,ge,ue,_e,wi,Lt,ui,Ne,Ti,H.projection,j,E);$e=Ci.useVertical,Ti&&Ci.needsFlipping&&(ui={}),(Ci.notEnoughRoom||$e||Ci.needsFlipping&&ur(Ze,Wt,!0,O,i,x,w,h.glyphOffsetArray,ge,ue,_e,wi,Lt,ui,Ne,Ti,H.projection,j,E).notEnoughRoom)&&Vs(it,ue)}d?(h.text.dynamicLayoutVertexBuffer.updateData(ue),_e&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(_e)):(h.icon.dynamicLayoutVertexBuffer.updateData(ue),_e&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(_e))}function _r(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue){const{lineStartIndex:_e,glyphStartIndex:ge,segment:Oe}=O,Ne=ge+O.numGlyphs,Ue=_e+O.lineLength,$e=i.getoffsetX(ge),Ke=i.getoffsetX(Ne-1),Ze=wr(h*$e,s,d,x,w,E,Oe,_e,Ue,B,j,H,Z,Y,!0,se,pe,ue);if(!Ze)return null;const it=wr(h*Ke,s,d,x,w,E,Oe,_e,Ue,B,j,H,Z,Y,!0,se,pe,ue);return it?{first:Ze,last:it}:null}function Rr(h,i,s,d){return h===n.bl.horizontal&&Math.abs(d)>Math.abs(s)?{useVertical:!0}:h===n.bl.vertical?d>0?{needsFlipping:!0}:null:i!==Zi.unknown&&function(x,w){return x===0||Math.abs(w/x)>Kt}(s,d)?i===Zi.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function ur(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e,ge,Oe){const Ne=i/24,Ue=h.lineOffsetX*Ne,$e=h.lineOffsetY*Ne,{lineStartIndex:Ke,glyphStartIndex:Ze,numGlyphs:it,segment:gt,writingMode:Lt,flipState:wt}=h,vt=Ke+h.lineLength,ri=hi=>{if(H){const[Wt,wi,ui]=hi.up,Ti=j.length;n.bn(H,Ti+0,Wt,wi,ui),n.bn(H,Ti+1,Wt,wi,ui),n.bn(H,Ti+2,Wt,wi,ui),n.bn(H,Ti+3,Wt,wi,ui)}const[Si,Gi,Ki]=hi.point;n.bo(j,Si,Gi,Ki,hi.angle)};if(it>1){const hi=_r(Ne,O,Ue,$e,s,Z,Y,h,B,w,se,ue,!1,_e,ge,Oe);if(!hi)return{notEnoughRoom:!0};if(d&&!s){let[Si,Gi,Ki]=hi.first.point,[Wt,wi,ui]=hi.last.point;[Si,Gi]=Vi(Si,Gi,Ki,E),[Wt,wi]=Vi(Wt,wi,ui,E);const Ti=Rr(Lt,wt,(Wt-Si)*pe,wi-Gi);if(h.flipState=Ti&&Ti.needsFlipping?Zi.flipRequired:Zi.flipNotRequired,Ti)return Ti}ri(hi.first);for(let Si=Ze+1;Si<Ze+it-1;Si++){const Gi=wr(Ne*O.getoffsetX(Si),Ue,$e,s,Z,Y,gt,Ke,vt,B,w,se,ue,!1,!1,_e,ge,Oe);if(!Gi)return j.length-=4*(Si-Ze),{notEnoughRoom:!0};ri(Gi)}ri(hi.last)}else{if(d&&!s){const Si=Vi(Y.x,Y.y,0,x),Gi=Ke+gt+1,Ki=new n.P(B.getx(Gi),B.gety(Gi)),Wt=Vi(Ki.x,Ki.y,0,x),wi=Wt[3]>0?Wt:ws(Y,Ki,Si,1,x,void 0,_e,ge.canonical),ui=Rr(Lt,wt,(wi[0]-Si[0])*pe,wi[1]-Si[1]);if(h.flipState=ui&&ui.needsFlipping?Zi.flipRequired:Zi.flipNotRequired,ui)return ui}const hi=wr(Ne*O.getoffsetX(Ze),Ue,$e,s,Z,Y,gt,Ke,vt,B,w,se,ue,!1,!1,_e,ge,Oe);if(!hi)return{notEnoughRoom:!0};ri(hi)}return{}}function wn(h,i,s,d,x){const{x:w,y:E,z:O}=d.projectTilePoint(h.x,h.y,i);if(!x)return Vi(w,E,O,s);const[B,j,H]=x(h);return Vi(w+B,E+j,O+H,s)}function ws(h,i,s,d,x,w,E,O){const B=wn(h.sub(i)._unit()._add(h),O,x,E,w);return n.a6.vec3.sub(B,s,B),n.a6.vec3.normalize(B,B),n.a6.vec3.scaleAndAdd(B,s,B,d)}function wr(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e,ge){const Oe=d?h-i:h+i;let Ne=Oe>0?1:-1,Ue=0;d&&(Ne*=-1,Ue=Math.PI),Ne<0&&(Ue+=Math.PI);let $e=O+E+(Ne>0?0:1)|0,Ke=x,Ze=x,it=0,gt=0;const Lt=Math.abs(Oe),wt=[],vt=[];let ri=w,hi=ri;const Si=()=>ws(hi,ri,Ze,Lt-it+1,H,Y,ue,_e.canonical);for(;it+gt<=Lt;){if($e+=Ne,$e<O||$e>=B)return null;if(Ze=Ke,hi=ri,wt.push(Ze),se&&vt.push(hi),ri=new n.P(j.getx($e),j.gety($e)),Ke=Z[$e],!Ke){const Xi=wn(ri,_e.canonical,H,ue,Y);Ke=Xi[3]>0?Z[$e]=Xi:Si()}it+=gt,gt=n.a6.vec3.distance(Ze,Ke)}pe&&Y&&(Z[$e]&&(Ke=Si(),gt=n.a6.vec3.distance(Ze,Ke)),Z[$e]=Ke);const Gi=(Lt-it)/gt,Ki=ri.sub(hi)._mult(Gi)._add(hi),Wt=n.a6.vec3.sub([],Ke,Ze),wi=n.a6.vec3.scaleAndAdd([],Ze,Wt,Gi);let ui=[0,0,1],Ti=Wt[0],Ci=Wt[1];if(ge&&(ui=ue.upVector(_e.canonical,Ki.x,Ki.y),ui[0]!==0||ui[1]!==0||ui[2]!==1)){const Xi=[ui[2],0,-ui[0]],zn=n.a6.vec3.cross([],ui,Xi);n.a6.vec3.normalize(Xi,Xi),n.a6.vec3.normalize(zn,zn),Ti=n.a6.vec3.dot(Wt,Xi),Ci=n.a6.vec3.dot(Wt,zn)}if(s){const Xi=n.a6.vec3.cross([],ui,Wt);n.a6.vec3.normalize(Xi,Xi),n.a6.vec3.scaleAndAdd(wi,wi,Xi,s*Ne)}const mi=Ue+Math.atan2(Ci,Ti);return wt.push(wi),se&&vt.push(Ki),{point:wi,angle:mi,path:wt,tilePath:vt,up:ui}}function Vs(h,i){const s=i.length,d=s+4*h;i.resize(d),i.float32.fill(-1/0,4*s,4*d)}function Or(h,i,s){const d=i[0],x=i[1];return h[0]=s[0]*d+s[4]*x+s[12],h[1]=s[1]*d+s[5]*x+s[13],h[3]=s[3]*d+s[7]*x+s[15],h}const ro=100;class to{constructor(i,s,d=new Dn(i.width+200,i.height+200,25),x=new Dn(i.width+200,i.height+200,25)){this.transform=i,this.grid=d,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+ro,this.screenBottomBoundary=i.height+ro,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=s}placeCollisionBox(i,s,d,x,w,E,O,B){let j=d.projectedAnchorX,H=d.projectedAnchorY,Z=d.projectedAnchorZ;const Y=d.elevation,se=d.tileID,pe=i.getProjection();if(Y&&se){const[Ke,Ze,it]=pe.upVector(se.canonical,d.tileAnchorX,d.tileAnchorY),gt=pe.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;j+=Ke*Y*gt,H+=Ze*Y*gt,Z+=it*Y*gt}const ue=this.projectAndGetPerspectiveRatio(O,j,H,Z,d.tileID,pe.name==="globe"||!!Y||this.transform.pitch>0,pe),_e=E*ue.perspectiveRatio,ge=(d.x1*s+x.x-d.padding)*_e+ue.point.x,Oe=(d.y1*s+x.y-d.padding)*_e+ue.point.y,Ne=(d.x2*s+x.x+d.padding)*_e+ue.point.x,Ue=(d.y2*s+x.y+d.padding)*_e+ue.point.y,$e=ue.perspectiveRatio<=.55||ue.occluded;return!this.isInsideGrid(ge,Oe,Ne,Ue)||!w&&this.grid.hitTest(ge,Oe,Ne,Ue,B)||$e?{box:[],offscreen:!1,occluded:ue.occluded}:{box:[ge,Oe,Ne,Ue],offscreen:this.isOffscreen(ge,Oe,Ne,Ue),occluded:!1}}placeCollisionCircles(i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue){const _e=[],ge=this.transform.elevation,Oe=i.getProjection(),Ne=ge?ge.getAtTileOffsetFunc(ue,this.transform.center.lat,this.transform.worldSize,Oe):null,Ue=new n.P(d.tileAnchorX,d.tileAnchorY);let{x:$e,y:Ke,z:Ze}=Oe.projectTilePoint(Ue.x,Ue.y,ue.canonical);if(Ne){const[Ki,Wt,wi]=Ne(Ue);$e+=Ki,Ke+=Wt,Ze+=wi}const it=Oe.name==="globe",gt=this.projectAndGetPerspectiveRatio(O,$e,Ke,Ze,ue,it||!!ge||this.transform.pitch>0,Oe),{perspectiveRatio:Lt}=gt,wt=(Z?E/Lt:E*Lt)/n.br,vt=Vi($e,Ke,Ze,B),ri=gt.signedDistanceFromCamera>0?_r(wt,w,d.lineOffsetX*wt,d.lineOffsetY*wt,!1,vt,Ue,d,x,B,{},ge&&!Z?Ne:null,Z&&!!ge,Oe,ue,Z):null;let hi=!1,Si=!1,Gi=!0;if(ri&&!gt.occluded){const Ki=.5*se*Lt+pe,Wt=new n.P(-100,-100),wi=new n.P(this.screenRightBoundary,this.screenBottomBoundary),ui=new hn,{first:Ti,last:Ci}=ri,mi=Ti.path.length;let Xi=[];for(let An=mi-1;An>=1;An--)Xi.push(Ti.path[An]);for(let An=1;An<Ci.path.length;An++)Xi.push(Ci.path[An]);const zn=2.5*Ki;j&&(Xi=Xi.map(([An,kn,dn],tr)=>(Ne&&!it&&(dn=Ne(tr<mi-1?Ti.tilePath[mi-1-tr]:Ci.tilePath[tr-mi+2])[2]),Vi(An,kn,dn,j))),Xi.some(An=>An[3]<=0)&&(Xi=[]));let $n=[];if(Xi.length>0){let An=1/0,kn=-1/0,dn=1/0,tr=-1/0;for(const dr of Xi)An=Math.min(An,dr[0]),dn=Math.min(dn,dr[1]),kn=Math.max(kn,dr[0]),tr=Math.max(tr,dr[1]);kn>=Wt.x&&An<=wi.x&&tr>=Wt.y&&dn<=wi.y&&($n=[Xi.map(dr=>new n.P(dr[0],dr[1]))],(An<Wt.x||kn>wi.x||dn<Wt.y||tr>wi.y)&&($n=n.bp($n,Wt.x,Wt.y,wi.x,wi.y)))}for(const An of $n){ui.reset(An,.25*Ki);let kn=0;kn=ui.length<=.5*Ki?1:Math.ceil(ui.paddedLength/zn)+1;for(let dn=0;dn<kn;dn++){const tr=dn/Math.max(kn-1,1),dr=ui.lerp(tr),Nr=dr.x+ro,as=dr.y+ro;_e.push(Nr,as,Ki,0);const Ur=Nr-Ki,vs=as-Ki,Xr=Nr+Ki,Ss=as+Ki;if(Gi=Gi&&this.isOffscreen(Ur,vs,Xr,Ss),Si=Si||this.isInsideGrid(Ur,vs,Xr,Ss),!s&&this.grid.hitTestCircle(Nr,as,Ki,Y)&&(hi=!0,!H))return{circles:[],offscreen:!1,collisionDetected:hi,occluded:!1}}}}return{circles:!H&&hi||!Si?[]:_e,offscreen:Gi,collisionDetected:hi,occluded:gt.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let d=1/0,x=1/0,w=-1/0,E=-1/0;for(const H of i){const Z=new n.P(H.x+ro,H.y+ro);d=Math.min(d,Z.x),x=Math.min(x,Z.y),w=Math.max(w,Z.x),E=Math.max(E,Z.y),s.push(Z)}const O=this.grid.query(d,x,w,E).concat(this.ignoredGrid.query(d,x,w,E)),B={},j={};for(const H of O){const Z=H.key;if(B[Z.bucketInstanceId]===void 0&&(B[Z.bucketInstanceId]={}),B[Z.bucketInstanceId][Z.featureIndex])continue;const Y=[new n.P(H.x1,H.y1),new n.P(H.x2,H.y1),new n.P(H.x2,H.y2),new n.P(H.x1,H.y2)];n.bq(s,Y)&&(B[Z.bucketInstanceId][Z.featureIndex]=!0,j[Z.bucketInstanceId]===void 0&&(j[Z.bucketInstanceId]=[]),j[Z.bucketInstanceId].push(Z.featureIndex))}return j}insertCollisionBox(i,s,d,x,w){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:x,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,s,d,x,w){const E=s?this.ignoredGrid:this.grid,O={bucketInstanceId:d,featureIndex:x,collisionGroupID:w};for(let B=0;B<i.length;B+=4)E.insertCircle(O,i[B],i[B+1],i[B+2])}projectAndGetPerspectiveRatio(i,s,d,x,w,E,O){const B=[s,d,x,1];let j=!1;x||this.transform.pitch>0?(n.a6.vec4.transformMat4(B,B,i),this.fogState&&w&&O.name!=="globe"&&(j=function(Y,se,pe,ue,_e,ge){const Oe=ge.calculateFogTileMatrix(_e),Ne=[se,pe,ue];return n.a6.vec3.transformMat4(Ne,Ne,Oe),tn(Y,n.a6.vec3.length(Ne),ge.pitch,ge._fov)}(this.fogState,s,d,x,w.toUnwrapped(),this.transform)>.9)):Or(B,B,i);const H=B[3];return{point:new n.P((B[0]/H+1)/2*this.transform.width+ro,(-B[1]/H+1)/2*this.transform.height+ro),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(O)/H*.5,1.5),signedDistanceFromCamera:H,occluded:E&&B[2]>H||j}}isOffscreen(i,s,d,x){return d<ro||i>=this.screenRightBoundary||x<ro||s>this.screenBottomBoundary}isInsideGrid(i,s,d,x){return d>=0&&i<this.gridRightBoundary&&x>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const i=n.a6.mat4.identity([]);return n.a6.mat4.translate(i,i,[-100,-100,0]),i}}function Xs(h,i,s){const d=i.createTileMatrix(h,h.worldSize,s.toUnwrapped());return n.a6.mat4.multiply(new Float32Array(16),h.projMatrix,d)}function Ba(h,i,s){if(i.projection.name===s.projection.name)return h.projMatrix;const d=s.clone();return d.setProjection(i.projection),Xs(d,i.getProjection(),h)}function To(h,i,s){return i.name===s.projection.name?h.projMatrix:Xs(s,i,h)}class hs{constructor(i,s,d,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?s:-s))):x&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Is{constructor(i,s,d,x,w,E=!1){this.text=new hs(i?i.text:null,s,d,w),this.icon=new hs(i?i.icon:null,s,x,w),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yo{constructor(i,s,d,x=!1){this.text=i,this.icon=s,this.skipFade=d,this.clipped=x}}class Un{constructor(){this.invProjMatrix=n.a6.mat4.create(),this.viewportMatrix=n.a6.mat4.create(),this.circles=[]}}class dl{constructor(i,s,d,x,w){this.bucketInstanceId=i,this.featureIndex=s,this.sourceLayerIndex=d,this.bucketIndex=x,this.tileID=w}}class fa{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const s=++this.maxGroupID;this.collisionGroups[i]={ID:s,predicate:d=>d.collisionGroupID===s}}return this.collisionGroups[i]}}function Zl(h,i,s,d,x){const{horizontalAlign:w,verticalAlign:E}=n.by(h),O=-(w-.5)*i,B=-(E-.5)*s,j=n.bx(h,d);return new n.P(O+j[0]*x,B+j[1]*x)}function ma(h,i,s,d,x){const w=new n.P(h,i);return s&&w._rotate(d?x:-x),w}class pl{constructor(i,s,d,x,w,E){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new to(this.transform,w),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new fa(d),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,s,d,x,w=1){const E=d.getBucket(s),O=d.latestFeatureIndex;if(!E||!O||s.fqid!==E.layerIds[0])return;const B=E.layers[0].layout,j=E.layers[0].paint,H=d.collisionBoxArray,Z=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),Y=d.tileSize/n.ab,se=d.tileID.toUnwrapped();this.transform.setProjection(E.projection);const pe=(ue=d.tileID,_e=E.getProjection(),ge=this.transform,_e.name===this.projection?ge.calculateProjMatrix(ue.toUnwrapped()):Xs(ge,_e,ue));var ue,_e,ge;const Oe=B.get("text-pitch-alignment")==="map",Ne=B.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const Ue=s.dynamicFilter(),$e=s.dynamicFilterNeedsFeature(),Ke=this.transform.calculatePixelsToTileUnitsMatrix(d),Ze=Ei(pe,d.tileID.canonical,Oe,Ne,this.transform,E.getProjection(),Ke);let it=null;if(Oe){const Si=Ln(pe,d.tileID.canonical,Oe,Ne,this.transform,E.getProjection(),Ke);it=n.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Si)}let gt=null;Ue&&d.latestFeatureIndex&&(gt={unwrappedTileID:se,dynamicFilter:Ue,dynamicFilterNeedsFeature:$e}),this.retainedQueryData[E.bucketInstanceId]=new dl(E.bucketInstanceId,O,E.sourceLayerIndex,E.index,d.tileID);const Lt=E.layers[0].layout.get("text-size-scale-range"),wt=n.ap(w,Lt[0],Lt[1]),vt=E.layers[0].layout.get("icon-size-scale-range"),ri=n.ap(w,vt[0],vt[1]),hi={bucket:E,layout:B,paint:j,posMatrix:pe,textLabelPlaneMatrix:Ze,labelToScreenMatrix:it,clippingData:gt,scale:Z,textPixelRatio:Y,holdingForFade:d.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:n.bk(E.textSizeData,this.transform.zoom,wt),partiallyEvaluatedIconSize:n.bk(E.iconSizeData,this.transform.zoom,ri),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(x)for(const Si of E.sortKeyRanges){const{sortKey:Gi,symbolInstanceStart:Ki,symbolInstanceEnd:Wt}=Si;i.push({sortKey:Gi,symbolInstanceStart:Ki,symbolInstanceEnd:Wt,parameters:hi})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:hi})}attemptAnchorPlacement(i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e,ge,Oe){const{textOffset0:Ne,textOffset1:Ue,crossTileID:$e}=Y,Ke=[Ne,Ue],Ze=Zl(i,d,x,Ke,w),it=this.collisionIndex.placeCollisionBox(pe,w,s,ma(Ze.x,Ze.y,E,O,this.transform.angle),Z,B,j,H.predicate);if(_e){const gt=pe.getSymbolInstanceIconSize(Oe,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(pe,gt,_e,ma(Ze.x,Ze.y,E,O,this.transform.angle),Z,B,j,H.predicate).box.length===0)return}if(it.box.length>0){let gt;return this.prevPlacement&&this.prevPlacement.variableOffsets[$e]&&this.prevPlacement.placements[$e]&&this.prevPlacement.placements[$e].text&&(gt=this.prevPlacement.variableOffsets[$e].anchor),this.variableOffsets[$e]={textOffset:Ke,width:d,height:x,anchor:i,textScale:w,prevAnchor:gt},this.markUsedJustification(pe,i,Y,ue),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,ue,Y),this.placedOrientations[$e]=ue),{shift:Ze,placedGlyphBoxes:it}}}placeLayerBucketPart(i,s,d,x,w=1){const{bucket:E,layout:O,paint:B,posMatrix:j,textLabelPlaneMatrix:H,labelToScreenMatrix:Z,clippingData:Y,textPixelRatio:se,holdingForFade:pe,collisionBoxArray:ue,partiallyEvaluatedTextSize:_e,partiallyEvaluatedIconSize:ge,collisionGroup:Oe,latestFeatureIndex:Ne}=i.parameters,Ue=O.get("text-optional"),$e=O.get("icon-optional"),Ke=O.get("text-allow-overlap"),Ze=O.get("icon-allow-overlap"),it=O.get("text-rotation-alignment")==="map",gt=O.get("text-pitch-alignment")==="map",Lt=O.get("symbol-z-elevate"),wt=B.get("symbol-z-offset"),vt=O.get("symbol-elevation-reference")==="sea",ri=O.get("text-size-scale-range"),hi=O.get("icon-size-scale-range"),Si=n.ap(w,ri[0],ri[1]),Gi=n.ap(w,hi[0],hi[1]);this.transform.setProjection(E.projection);let Ki=Ke&&(Ze||!E.hasIconData()||$e),Wt=Ze&&(Ke||!E.hasTextData()||Ue);const wi=!wt.isConstant();!E.collisionArrays&&ue&&E.deserializeCollisionBoxes(ue),d&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,ue,Si,Gi);const ui=(Ti,Ci,mi)=>{const{crossTileID:Xi,numVerticalGlyphVertices:zn}=Ti;let $n=null;if(Y&&Y.dynamicFilterNeedsFeature||wi){const Wr=this.retainedQueryData[E.bucketInstanceId];$n=Ne.loadFeature({featureIndex:Ti.featureIndex,bucketIndex:Wr.bucketIndex,sourceLayerIndex:Wr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(Y&&!(0,Y.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},$n,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new n.P(Ti.tileAnchorX,Ti.tileAnchorY),this.transform.calculateDistanceTileData(Y.unwrappedTileID)))return this.placements[Xi]=new Yo(!1,!1,!1,!0),void s.add(Xi);const An=wt.evaluate($n,{});if(s.has(Xi))return;if(pe)return void(this.placements[Xi]=new Yo(!1,!1,!1));let kn=!1,dn=!1,tr=!0,dr=!1,Nr=!1,as=null,Ur={box:null,offscreen:null,occluded:null},vs={box:null,offscreen:null,occluded:null},Xr=null,Ss=null,br=null,ds=0,ps=0,Er=0;mi.textFeatureIndex?ds=mi.textFeatureIndex:Ti.useRuntimeCollisionCircles&&(ds=Ti.featureIndex),mi.verticalTextFeatureIndex&&(ps=mi.verticalTextFeatureIndex);const ts=Wr=>{Wr.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Hr=this.transform.elevation;Wr.elevation=vt?An:An+(Hr?Hr.getAtTileOffset(Wr.tileID,Wr.tileAnchorX,Wr.tileAnchorY):0),Wr.elevation+=Ti.zOffset},Gs=mi.textBox;if(Gs){ts(Gs);const Wr=Yr=>{let is=n.bl.horizontal;if(E.allowVerticalPlacement&&!Yr&&this.prevPlacement){const Es=this.prevPlacement.placedOrientations[Xi];Es&&(this.placedOrientations[Xi]=Es,is=Es,this.markUsedOrientation(E,is,Ti))}return is},Hr=(Yr,is)=>{if(E.allowVerticalPlacement&&zn>0&&mi.verticalTextBox){for(const Es of E.writingModes)if(Es===n.bl.vertical?(Ur=is(),vs=Ur):Ur=Yr(),Ur&&Ur.box&&Ur.box.length)break}else Ur=Yr()};if(O.get("text-variable-anchor")){let Yr=O.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Xi]){const Os=this.prevPlacement.variableOffsets[Xi];Yr.indexOf(Os.anchor)>0&&(Yr=Yr.filter(Ro=>Ro!==Os.anchor),Yr.unshift(Os.anchor))}const is=(Os,Ro,Tl)=>{const xa=E.getSymbolInstanceTextSize(_e,Ti,this.transform.zoom,Ci),aa=(Os.x2-Os.x1)*xa+2*Os.padding,$a=(Os.y2-Os.y1)*xa+2*Os.padding,Za=Ti.hasIconTextFit&&!Ze?Ro:null;Za&&ts(Za);let ba={box:[],offscreen:!1,occluded:!1};const Xa=Ke?2*Yr.length:Yr.length;for(let Pa=0;Pa<Xa;++Pa){const ls=this.attemptAnchorPlacement(Yr[Pa%Yr.length],Os,aa,$a,xa,it,gt,se,j,Oe,Pa>=Yr.length,Ti,Ci,E,Tl,Za,_e,ge);if(ls&&(ba=ls.placedGlyphBoxes,ba&&ba.box&&ba.box.length)){kn=!0,as=ls.shift;break}}return ba};Hr(()=>is(Gs,mi.iconBox,n.bl.horizontal),()=>{const Os=mi.verticalTextBox;return Os&&ts(Os),E.allowVerticalPlacement&&!(Ur&&Ur.box&&Ur.box.length)&&zn>0&&Os?is(Os,mi.verticalIconBox,n.bl.vertical):{box:null,offscreen:null,occluded:null}}),Ur&&(kn=Ur.box,tr=Ur.offscreen,dr=Ur.occluded);const Es=Wr(!(!Ur||!Ur.box));if(!kn&&this.prevPlacement){const Os=this.prevPlacement.variableOffsets[Xi];Os&&(this.variableOffsets[Xi]=Os,this.markUsedJustification(E,Os.anchor,Ti,Es))}}else{const Yr=(is,Es)=>{const Os=E.getSymbolInstanceTextSize(_e,Ti,this.transform.zoom,Ci,w),Ro=this.collisionIndex.placeCollisionBox(E,Os,is,new n.P(0,0),Ke,se,j,Oe.predicate);return Ro&&Ro.box&&Ro.box.length&&(this.markUsedOrientation(E,Es,Ti),this.placedOrientations[Xi]=Es),Ro};Hr(()=>Yr(Gs,n.bl.horizontal),()=>{const is=mi.verticalTextBox;return E.allowVerticalPlacement&&zn>0&&is?(ts(is),Yr(is,n.bl.vertical)):{box:null,offscreen:null,occluded:null}}),Wr(!!(Ur&&Ur.box&&Ur.box.length))}}if(Xr=Ur,kn=Xr&&Xr.box&&Xr.box.length>0,tr=Xr&&Xr.offscreen,dr=Xr&&Xr.occluded,Ti.useRuntimeCollisionCircles){const Wr=E.text.placedSymbolArray.get(Ti.centerJustifiedTextSymbolIndex>=0?Ti.centerJustifiedTextSymbolIndex:Ti.verticalPlacedTextSymbolIndex),Hr=n.bm(E.textSizeData,_e,Wr),Yr=O.get("text-padding");Ss=this.collisionIndex.placeCollisionCircles(E,Ke,Wr,E.lineVertexArray,E.glyphOffsetArray,Hr,j,H,Z,d,gt,Oe.predicate,Ti.collisionCircleDiameter*Hr/n.br,Yr,this.retainedQueryData[E.bucketInstanceId].tileID),kn=Ke||Ss.circles.length>0&&!Ss.collisionDetected,tr=tr&&Ss.offscreen,dr=Ss.occluded}if(mi.iconFeatureIndex&&(Er=mi.iconFeatureIndex),mi.iconBox){const Wr=Hr=>{ts(Hr);const Yr=Ti.hasIconTextFit&&as?ma(as.x,as.y,it,gt,this.transform.angle):new n.P(0,0),is=E.getSymbolInstanceIconSize(ge,this.transform.zoom,Ti.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,is,Hr,Yr,Ze,se,j,Oe.predicate)};vs&&vs.box&&vs.box.length&&mi.verticalIconBox?(br=Wr(mi.verticalIconBox),dn=br.box.length>0):(br=Wr(mi.iconBox),dn=br.box.length>0),tr=tr&&br.offscreen,Nr=br.occluded}const ea=Ue||Ti.numHorizontalGlyphVertices===0&&zn===0,qa=$e||Ti.numIconVertices===0;if(ea||qa?qa?ea||(dn=dn&&kn):kn=dn&&kn:dn=kn=dn&&kn,kn&&Xr&&Xr.box&&this.collisionIndex.insertCollisionBox(Xr.box,O.get("text-ignore-placement"),E.bucketInstanceId,vs&&vs.box&&ps?ps:ds,Oe.ID),dn&&br&&this.collisionIndex.insertCollisionBox(br.box,O.get("icon-ignore-placement"),E.bucketInstanceId,Er,Oe.ID),Ss&&(kn&&this.collisionIndex.insertCollisionCircles(Ss.circles,O.get("text-ignore-placement"),E.bucketInstanceId,ds,Oe.ID),d)){const Wr=E.bucketInstanceId;let Hr=this.collisionCircleArrays[Wr];Hr===void 0&&(Hr=this.collisionCircleArrays[Wr]=new Un);for(let Yr=0;Yr<Ss.circles.length;Yr+=4)Hr.circles.push(Ss.circles[Yr+0]),Hr.circles.push(Ss.circles[Yr+1]),Hr.circles.push(Ss.circles[Yr+2]),Hr.circles.push(Ss.collisionDetected?1:0)}const Mo=E.projection.name!=="globe";Ki=Ki&&(Mo||!dr),Wt=Wt&&(Mo||!Nr),this.placements[Xi]=new Yo(kn||Ki,dn||Wt,tr||E.justReloaded),s.add(Xi)};if(Lt&&this.buildingIndex&&(this.buildingIndex.updateZOffset(E,this.retainedQueryData[E.bucketInstanceId].tileID),E.updateZOffset()),E.sortFeaturesByY){const Ti=E.getSortedSymbolIndexes(this.transform.angle);for(let Ci=Ti.length-1;Ci>=0;--Ci){const mi=Ti[Ci];ui(E.symbolInstances.get(mi),mi,E.collisionArrays[mi])}E.hasAnyZOffset&&n.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const Ti=E.getSortedIndexesByZOffset();for(let Ci=0;Ci<Ti.length;++Ci){const mi=Ti[Ci];ui(E.symbolInstances.get(mi),mi,E.collisionArrays[mi])}}else for(let Ti=i.symbolInstanceStart;Ti<i.symbolInstanceEnd;Ti++)ui(E.symbolInstances.get(Ti),Ti,E.collisionArrays[Ti]);if(d&&E.bucketInstanceId in this.collisionCircleArrays){const Ti=this.collisionCircleArrays[E.bucketInstanceId];n.a6.mat4.invert(Ti.invProjMatrix,j),Ti.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(i,s,d,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:B,crossTileID:j}=d,H=n.bw(s),Z=x===n.bl.vertical?B:H==="left"?w:H==="center"?E:H==="right"?O:-1;w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=Z>=0&&w!==Z?0:j),E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=Z>=0&&E!==Z?0:j),O>=0&&(i.text.placedSymbolArray.get(O).crossTileID=Z>=0&&O!==Z?0:j),B>=0&&(i.text.placedSymbolArray.get(B).crossTileID=Z>=0&&B!==Z?0:j)}markUsedOrientation(i,s,d){const x=s===n.bl.horizontal||s===n.bl.horizontalOnly?s:0,w=s===n.bl.vertical?s:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:j}=d,H=i.text.placedSymbolArray;E>=0&&(H.get(E).placedOrientation=x),O>=0&&(H.get(O).placedOrientation=x),B>=0&&(H.get(B).placedOrientation=x),j>=0&&(H.get(j).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let d=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const x=s?s.symbolFadeChange(i):1,w=s?s.opacities:{},E=s?s.variableOffsets:{},O=s?s.placedOrientations:{};for(const B in this.placements){const j=this.placements[B],H=w[B];H?(this.opacities[B]=new Is(H,x,j.text,j.icon,null,j.clipped),d=d||j.text!==H.text.placed||j.icon!==H.icon.placed):(this.opacities[B]=new Is(null,x,j.text,j.icon,j.skipFade,j.clipped),d=d||j.text||j.icon)}for(const B in w){const j=w[B];if(!this.opacities[B]){const H=new Is(j,x,!1,!1);H.isHidden()||(this.opacities[B]=H,d=d||j.text.placed||j.icon.placed)}}for(const B in E)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=E[B]);for(const B in O)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=O[B]);d?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:i)}updateLayerOpacities(i,s,d,x){const w=new Set;for(const E of s){const O=E.getBucket(i);O&&E.latestFeatureIndex&&i.fqid===O.layerIds[0]&&(this.updateBucketOpacities(O,w,E,E.collisionBoxArray,d,x,E.tileID,i.scope),O.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(O,E.tileID),O.updateZOffset()))}}updateBucketOpacities(i,s,d,x,w,E,O,B){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const j=i.layers[0].layout,H=i.layers[0].paint,Z=!!i.layers[0].dynamicFilter(),Y=new Is(null,0,!1,!1,!0),se=j.get("text-allow-overlap"),pe=j.get("icon-allow-overlap"),ue=j.get("text-variable-anchor"),_e=j.get("text-rotation-alignment")==="map",ge=j.get("text-pitch-alignment")==="map",Oe=H.get("symbol-z-offset"),Ne=j.get("symbol-elevation-reference")==="sea",Ue=!Oe.isConstant(),$e=new Is(null,0,se&&(pe||!i.hasIconData()||j.get("icon-optional")),pe&&(se||!i.hasTextData()||j.get("text-optional")),!0);!i.collisionArrays&&x&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(x);const Ke=(it,gt,Lt)=>{for(let wt=0;wt<gt/4;wt++)it.opacityVertexArray.emplaceBack(Lt)};let Ze=0;E&&i.updateReplacement(O,E);for(let it=0;it<i.symbolInstances.length;it++){const gt=i.symbolInstances.get(it),{numHorizontalGlyphVertices:Lt,numVerticalGlyphVertices:wt,crossTileID:vt,numIconVertices:ri,tileAnchorX:hi,tileAnchorY:Si}=gt;let Gi=null;const Ki=this.retainedQueryData[i.bucketInstanceId];Ue&&gt&&Ki&&(Gi=d.latestFeatureIndex.loadFeature({featureIndex:gt.featureIndex,bucketIndex:Ki.bucketIndex,sourceLayerIndex:Ki.sourceLayerIndex,layoutVertexArrayOffset:0}));const Wt=Oe.evaluate(Gi,{}),wi=s.has(vt);let ui=this.opacities[vt];wi?ui=Y:ui||(ui=$e,this.opacities[vt]=ui),s.add(vt);const Ti=Lt>0||wt>0,Ci=ri>0,mi=this.placedOrientations[vt],Xi=mi===n.bl.vertical,zn=mi===n.bl.horizontal||mi===n.bl.horizontalOnly;!Ti&&!Ci||ui.isHidden()||Ze++;let $n=!1;if((Ti||Ci)&&E)for(const An of i.activeReplacements){if(n.bs(An,w,n.bt.Symbol,B)||An.min.x>hi||hi>An.max.x||An.min.y>Si||Si>An.max.y)continue;const kn=n.bu(hi,Si,O.canonical,An.footprintTileId.canonical);if($n=n.bv(kn,An.footprint),$n)break}if(Ti){const An=$n?yc:ml(ui.text);Ke(i.text,Lt,Xi?yc:An),Ke(i.text,wt,zn?yc:An);const kn=ui.text.isHidden(),{leftJustifiedTextSymbolIndex:dn,centerJustifiedTextSymbolIndex:tr,rightJustifiedTextSymbolIndex:dr,verticalPlacedTextSymbolIndex:Nr}=gt,as=i.text.placedSymbolArray,Ur=kn||Xi?1:0;dn>=0&&(as.get(dn).hidden=Ur),tr>=0&&(as.get(tr).hidden=Ur),dr>=0&&(as.get(dr).hidden=Ur),Nr>=0&&(as.get(Nr).hidden=kn||zn?1:0);const vs=this.variableOffsets[vt];vs&&this.markUsedJustification(i,vs.anchor,gt,mi);const Xr=this.placedOrientations[vt];Xr&&(this.markUsedJustification(i,"left",gt,Xr),this.markUsedOrientation(i,Xr,gt))}if(Ci){const An=$n?yc:ml(ui.icon),{placedIconSymbolIndex:kn,verticalPlacedIconSymbolIndex:dn}=gt,tr=i.icon.placedSymbolArray,dr=ui.icon.isHidden()?1:0;kn>=0&&(Ke(i.icon,ri,Xi?yc:An),tr.get(kn).hidden=dr),dn>=0&&(Ke(i.icon,gt.numVerticalIconVertices,zn?yc:An),tr.get(dn).hidden=dr)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const An=i.collisionArrays[it];if(An){let kn=new n.P(0,0),dn=!0;if(An.textBox||An.verticalTextBox){if(ue){const dr=this.variableOffsets[vt];dr?(kn=Zl(dr.anchor,dr.width,dr.height,dr.textOffset,dr.textScale),_e&&kn._rotate(ge?this.transform.angle:-this.transform.angle)):dn=!1}Z&&(dn=!ui.clipped),An.textBox&&ga(i.textCollisionBox.collisionVertexArray,ui.text.placed,!dn||Xi,Wt,Ne,kn.x,kn.y),An.verticalTextBox&&ga(i.textCollisionBox.collisionVertexArray,ui.text.placed,!dn||zn,Wt,Ne,kn.x,kn.y)}const tr=dn&&!!(!zn&&An.verticalIconBox);An.iconBox&&ga(i.iconCollisionBox.collisionVertexArray,ui.icon.placed,tr,Wt,Ne,gt.hasIconTextFit?kn.x:0,gt.hasIconTextFit?kn.y:0),An.verticalIconBox&&ga(i.iconCollisionBox.collisionVertexArray,ui.icon.placed,!tr,Wt,Ne,gt.hasIconTextFit?kn.x:0,gt.hasIconTextFit?kn.y:0)}}}if(i.fullyClipped=Ze===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=it.invProjMatrix,i.placementViewportMatrix=it.viewportMatrix,i.collisionCircleArray=it.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,s){const d=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*d>i}setStale(){this.stale=!0}}function ga(h,i,s,d,x,w,E){h.emplaceBack(i?1:0,s?1:0,w||0,E||0,d,x?1:0),h.emplaceBack(i?1:0,s?1:0,w||0,E||0,d,x?1:0),h.emplaceBack(i?1:0,s?1:0,w||0,E||0,d,x?1:0),h.emplaceBack(i?1:0,s?1:0,w||0,E||0,d,x?1:0)}const fl=Math.pow(2,25),Nu=Math.pow(2,24),Ma=Math.pow(2,17),jo=Math.pow(2,16),Wo=Math.pow(2,9),Pr=Math.pow(2,8),Vp=Math.pow(2,1);function ml(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const i=h.placed?1:0,s=Math.floor(127*h.opacity);return s*fl+i*Nu+s*Ma+i*jo+s*Wo+i*Pr+s*Vp+i}const yc=0;class vc{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,s,d,x,w,E){const O=this._bucketParts;for(;this._currentTileIndex<i.length;)if(s.getBucketParts(O,x,i[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((B,j)=>B.sortKey-j.sortKey));this._currentPartIndex<O.length;){const B=O[this._currentPartIndex];if(s.placeLayerBucketPart(B,this._seenCrossTileIDs,d,B.symbolInstanceStart===0,E),this._currentPartIndex++,w())return!0}return!1}}class Ka{constructor(i,s,d,x,w,E,O,B,j){this.placement=new pl(i,w,E,O,B,j),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,s,d,x,w){const E=n.q.now(),O=()=>{const B=n.q.now()-E;return!this._forceFullPlacement&&B>2};for(;this._currentPlacementIndex>=0;){const B=s[i[this._currentPlacementIndex]],j=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=j)&&(!B.maxzoom||B.maxzoom>j)){const H=B,Z=H.layout.get("symbol-z-elevate"),Y=H.layout.get("symbol-sort-key").constantOr(1)!==void 0,se=H.layout.get("symbol-z-order"),pe=se==="viewport-y"||se==="auto"&&!(se!=="viewport-y"&&Y),ue=H.layout.get("text-allow-overlap")||H.layout.get("icon-allow-overlap")||H.layout.get("text-ignore-placement")||H.layout.get("icon-ignore-placement"),_e=pe&&ue,ge=this._inProgressLayer=this._inProgressLayer||new vc(H),Oe=n.av(B.source,B.scope);if(ge.continuePlacement(Z||_e?x[Oe]:d[Oe],this.placement,this._showCollisionBoxes,B,O,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Sa=512/n.ab/2;class Gp{constructor(i,s,d){this.tileID=i,this.bucketInstanceId=d,this.index=new n.bz(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*n.ab,w=i.canonical.y*n.ab;for(let E=0;E<s.length;E++){const{key:O,crossTileID:B,tileAnchorX:j,tileAnchorY:H}=s.get(E),Z=Math.floor((x+j)*Sa),Y=Math.floor((w+H)*Sa);this.index.add(Z,Y),this.keys.push(O),this.crossTileIDs.push(B)}this.index.finish()}findMatches(i,s,d){const x=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),w=Sa/Math.pow(2,s.canonical.z-this.tileID.canonical.z),E=s.canonical.x*n.ab,O=s.canonical.y*n.ab;for(let B=0;B<i.length;B++){const j=i.get(B);if(j.crossTileID)continue;const{key:H,tileAnchorX:Z,tileAnchorY:Y}=j,se=Math.floor((E+Z)*w),pe=Math.floor((O+Y)*w),ue=this.index.range(se-x,pe-x,se+x,pe+x);for(const _e of ue){const ge=this.crossTileIDs[_e];if(this.keys[_e]===H&&!d.has(ge)){d.add(ge),j.crossTileID=ge;break}}}}}class xc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ld{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const s=Math.round((i-this.lng)/360);if(s!==0)for(const d in this.indexes){const x=this.indexes[d],w={};for(const E in x){const O=x[E];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+s),w[O.tileID.key]=O}this.indexes[d]=w}this.lng=i}addBucket(i,s,d){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<s.symbolInstances.length;w++)s.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const E=this.indexes[w];if(Number(w)>i.overscaledZ)for(const O in E){const B=E[O];B.tileID.isChildOf(i)&&B.findMatches(s.symbolInstances,i,x)}else{const O=E[i.scaledTo(Number(w)).key];O&&O.findMatches(s.symbolInstances,i,x)}}for(let w=0;w<s.symbolInstances.length;w++){const E=s.symbolInstances.get(w);E.crossTileID||(E.crossTileID=d.generate(),x.add(E.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Gp(i,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(i,s){for(const d of s.crossTileIDs)this.usedCrossTileIDs[i].delete(d)}removeStaleBuckets(i){let s=!1;for(const d in this.indexes){const x=this.indexes[d];for(const w in x)i[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,x[w]),delete x[w],s=!0)}return s}}class tu{constructor(){this.layerIndexes={},this.crossTileIDs=new xc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,s,d,x){let w=this.layerIndexes[i.fqid];w===void 0&&(w=this.layerIndexes[i.fqid]=new Ld);let E=!1;const O={};x.name!=="globe"&&w.handleWrapJump(d);for(const B of s){const j=B.getBucket(i);j&&i.fqid===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(B.tileID,j,this.crossTileIDs)&&(E=!0),O[j.bucketInstanceId]=!0)}return w.removeStaleBuckets(O)&&(E=!0),E}pruneUnusedLayers(i){const s={};i.forEach(d=>{s[d]=!0});for(const d in this.layerIndexes)s[d]||delete this.layerIndexes[d]}}const sa=771;class Ir{constructor(i,s,d,x){this.blendFunction=i,this.blendColor=s,this.mask=d,this.blendEquation=x}}Ir.Replace=[1,0,1,0],Ir.disabled=new Ir(Ir.Replace,n.bA.transparent,[!1,!1,!1,!1]),Ir.unblended=new Ir(Ir.Replace,n.bA.transparent,[!0,!0,!0,!0]),Ir.alphaBlended=new Ir([1,sa,1,sa],n.bA.transparent,[!0,!0,!0,!0]),Ir.alphaBlendedNonPremultiplied=new Ir([770,sa,770,sa],n.bA.transparent,[!0,!0,!0,!0]),Ir.multiply=new Ir([774,0,774,0],n.bA.transparent,[!0,!0,!0,!0]);class Xn{constructor(i,s,d){this.func=i,this.mask=s,this.range=d}}Xn.ReadOnly=!1,Xn.ReadWrite=!0,Xn.disabled=new Xn(519,Xn.ReadOnly,[0,1]);const Uu=7680;class hr{constructor(i,s,d,x,w,E){this.test=i,this.ref=s,this.mask=d,this.fail=x,this.depthFail=w,this.pass=E}}hr.disabled=new hr({func:519,mask:0},0,0,Uu,Uu,Uu);const kh=1029,bc=2305;class qn{constructor(i,s,d){this.enable=i,this.mode=s,this.frontFace=d}}function Vu(h,i){const s=n.bD(h,3);n.a6.mat4.fromQuat(h,i),n.bF(h,3,s)}function Ja(h,i){const s=n.a6.quat.identity([]);return n.a6.quat.rotateZ(s,s,-i),n.a6.quat.rotateX(s,s,-h),s}function wc(h,i){const s=[h[0],h[1],0],d=[i[0],i[1],0];if(n.a6.vec3.length(s)>=1e-15){const E=n.a6.vec3.normalize([],s);n.a6.vec3.scale(d,E,n.a6.vec3.dot(d,E)),i[0]=d[0],i[1]=d[1]}const x=n.a6.vec3.cross([],i,h);if(n.a6.vec3.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return Ja(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),w)}qn.disabled=new qn(!1,kh,bc),qn.backCCW=new qn(!0,kh,bc),qn.backCW=new qn(!0,kh,2304),qn.frontCW=new qn(!0,1028,2304),qn.frontCCW=new qn(!0,1028,bc);class go{constructor(i,s){this.position=i,this.orientation=s}get position(){return this._position}set position(i){if(i){const s=i instanceof n.a5?i:new n.a5(i[0],i[1],i[2]);this._renderWorldCopies&&(s.x=n.bB(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(i,s){if(this.orientation=null,!this.position)return;const d=this.position,x=this._elevation?this._elevation.getAtPointOrZero(n.a5.fromLngLat(i)):0,w=n.a5.fromLngLat(i,x),E=[w.x-d.x,w.y-d.y,w.z-d.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=wc(E,s)}setPitchBearing(i,s){this.orientation=Ja(n.bC(i),n.bC(-s))}}class Tc{constructor(i,s){this._transform=n.a6.mat4.identity([]),this.orientation=s,this.position=i}get mercatorPosition(){const i=this.position;return new n.a5(i[0],i[1],i[2])}get position(){const i=n.bD(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var s;i&&n.bF(this._transform,3,[(s=i)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||n.a6.quat.identity([]),i&&Vu(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,s){this._orientation=Ja(i,s),Vu(this._transform,this._orientation)}forward(){const i=n.bD(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=n.bD(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=n.bD(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,s){const d=new Float64Array(16);return n.a6.mat4.invert(d,this.getWorldToCamera(i,s)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,s,d){const x=this.position;n.a6.vec3.scale(x,x,-i);const w=new Float64Array(16);return n.a6.mat4.fromScaling(w,[d,d,d]),n.a6.mat4.translate(w,w,x),w[10]*=s,w}getWorldToCamera(i,s){const d=new Float64Array(16),x=new Float64Array(4),w=this.position;return n.a6.quat.conjugate(x,this._orientation),n.a6.vec3.scale(w,w,-i),n.a6.mat4.fromQuat(d,x),n.a6.mat4.translate(d,d,w),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=s,d[9]*=s,d[10]*=s,d[11]*=s,d}getCameraToClipPerspective(i,s,d,x){const w=new Float64Array(16);return n.a6.mat4.perspective(w,i,s,d,x),w}getCameraToClipOrthographic(i,s,d,x,w,E){const O=new Float64Array(16);return n.a6.mat4.ortho(O,i,s,d,x,w,E),O}getDistanceToElevation(i,s=!1){const d=i===0?0:n.bE(i,s?n.aN(this.position[1]):this.position[1]),x=this.forward();return(d-this.position[2])/x[2]}clone(){return new Tc([...this.position],[...this.orientation])}}const ao={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Mc{constructor(i=0,s=0,d=0,x=0){if(isNaN(i)||i<0||isNaN(s)||s<0||isNaN(d)||d<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=s,this.left=d,this.right=x}interpolate(i,s,d){return s.top!=null&&i.top!=null&&(this.top=n.aa(i.top,s.top,d)),s.bottom!=null&&i.bottom!=null&&(this.bottom=n.aa(i.bottom,s.bottom,d)),s.left!=null&&i.left!=null&&(this.left=n.aa(i.left,s.left,d)),s.right!=null&&i.right!=null&&(this.right=n.aa(i.right,s.right,d)),this}getCenter(i,s){const d=n.ap((this.left+i-this.right)/2,0,i),x=n.ap((this.top+s-this.bottom)/2,0,s);return new n.P(d,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Mc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const _o=(h,i,s)=>(1-s)*h+s*i,gl=h=>h*h*h*h*h;class iu{constructor(i,s,d,x,w,E,O){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=i||0,this._maxZoom=s||22,this._minPitch=d??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(O),this.width=0,this.height=0,this._center=new n.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Mc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Tc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new iu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,s=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(i||d)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return n.ar(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=n.bM(this.projectionOptions);const d=this.getProjection(),x=!n.bi(s,d);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bM({name:"mercator"});const s=i!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bB(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const s=-i*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=n.a6.mat2.create(),n.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const s=n.ap(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=n.bC(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const s=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let x=0,w=0;for(let E=0;E<s.length;E++){const O=new n.P(s[E][0]*this.width,d+s[E][1]*(this.height-d)),B=i.pointCoordinate(O);if(!B)continue;const j=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);x+=B[3]*j,w+=j}return w===0?NaN:x/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*s,x=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-d,w);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let d;d=i.z<this._camera.position[2]?[s.x,s.y,s.z]:[i.x,i.y,i.z];const x=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,d));return n.ap(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let s=!1;if(i.orientation&&!n.a6.quat.exactEquals(i.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(i.orientation)),i.position){const d=[i.position.x,i.position.y,i.position.z];n.a6.vec3.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,s=new go;return s.position=new n.a5(i[0],i[1],i[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(i){if(!n.a6.quat.length(i))return!1;n.a6.quat.normalize(i,i);const s=n.a6.vec3.transformQuat([],[0,0,-1],i),d=n.a6.vec3.transformQuat([],[0,-1,0],i);if(d[2]<0)return!1;const x=wc(s,d);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const s=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=n.ap(i[2],x/d,x/s),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,s,d){this._unmodified=!1,this._edgeInsets.interpolate(i,s,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const s=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(i){const s=[new n.bN(0,i)];if(this.renderWorldCopies){const d=this.pointCoordinate(new n.P(0,0)),x=this.pointCoordinate(new n.P(this.width,0)),w=this.pointCoordinate(new n.P(this.width,this.height)),E=this.pointCoordinate(new n.P(0,this.height)),O=Math.floor(Math.min(d.x,x.x,w.x,E.x)),B=Math.floor(Math.max(d.x,x.x,w.x,E.x)),j=1;for(let H=O-j;H<=B+j;H++)H!==0&&s.push(new n.bN(H,i))}return s}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,s,d){let x=[];const w=d!==void 0,E=!w;if(E&&this.zoom<s||w&&d[0]===0&&d[1]===0)return x;const O=new Set,B=(H,Z,Y,se,pe)=>{const ue=n.c2(Z,H,Y,se,pe);O.has(ue)||(x.push(new n.aA(H,Z,Y,se,pe)),O.add(ue))};for(let H=0;H<i.length;H++){const Z=i[H];if(E&&Z.canonical.z!==s)continue;const Y=Z.canonical,se=Z.overscaledZ,pe=Z.wrap,ue=1<<Y.z,_e=Y.x+1<ue,ge=Y.x>0,Oe=Y.y+1<ue,Ne=Y.y>0,Ue=Z.wrap-(ge?0:1),$e=Z.wrap+(_e?0:1),Ke=ge?Y.x-1:ue-1,Ze=_e?Y.x+1:0;if(w)d[0]<0?(B(se,$e,Y.z,Ze,Y.y),d[1]<0&&Oe&&(B(se,pe,Y.z,Y.x,Y.y+1),B(se,$e,Y.z,Ze,Y.y+1)),d[1]>0&&Ne&&(B(se,pe,Y.z,Y.x,Y.y-1),B(se,$e,Y.z,Ze,Y.y-1))):d[0]>0?(B(se,Ue,Y.z,Ke,Y.y),d[1]<0&&Oe&&(B(se,pe,Y.z,Y.x,Y.y+1),B(se,Ue,Y.z,Ke,Y.y+1)),d[1]>0&&Ne&&(B(se,pe,Y.z,Y.x,Y.y-1),B(se,Ue,Y.z,Ke,Y.y-1))):d[1]<0&&Oe?B(se,pe,Y.z,Y.x,Y.y+1):Ne&&B(se,pe,Y.z,Y.x,Y.y-1);else{const it=Z.visibleQuadrants;1&it&&(B(se,Ue,Y.z,Ke,Y.y),Ne&&(B(se,pe,Y.z,Y.x,Y.y-1),B(se,Ue,Y.z,Ke,Y.y-1))),2&it&&(B(se,$e,Y.z,Ze,Y.y),Ne&&(B(se,pe,Y.z,Y.x,Y.y-1),B(se,$e,Y.z,Ze,Y.y-1))),4&it&&(B(se,Ue,Y.z,Ke,Y.y),Oe&&(B(se,pe,Y.z,Y.x,Y.y+1),B(se,Ue,Y.z,Ke,Y.y+1))),8&it&&(B(se,$e,Y.z,Ze,Y.y),Oe&&(B(se,pe,Y.z,Y.x,Y.y+1),B(se,$e,Y.z,Ze,Y.y+1)))}}const j=[];for(const H of x)x.some(Z=>H.isChildOf(Z))||j.push(H);if(x=j.filter(H=>!i.some(Z=>!!(H.overscaledZ<s&&Z.isChildOf(H))||H.equals(Z)||H.isChildOf(Z))),E){const H=1<<s,Z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=[H*Z.x,H*Z.y],se=4,pe=se*se;x=x.filter(ue=>{const _e=ue.canonical.x+.5-Y[0],ge=ue.canonical.y+.5-Y[1];return _e*_e+ge*ge<pe})}return x}coveringTiles(i){let s=this.coveringZoomLevel(i);const d=s,x=this.elevation&&this.elevation.exaggeration(),w=x&&!i.isTerrainDEM,E=this.projection.name==="mercator";if(i.minzoom!==void 0&&s<i.minzoom)return[];i.maxzoom!==void 0&&s>i.maxzoom&&(s=i.maxzoom);const O=this.locationCoordinate(this.center),B=this.center.lat,j=1<<s,H=[j*O.x,j*O.y,0],Z=this.projection.name==="globe",Y=!Z,se=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,Y),pe=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ue=j*n.bE(1,this.center.lat),_e=this._camera.position[2]/n.bE(1,this.center.lat),ge=[j*pe.x,j*pe.y,_e*(Y?1:ue)],Oe=Z||x,Ne=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Ue=this.isLODDisabled(!0)?s:0;let $e;if(this._elevation&&i.isTerrainDEM)$e=1e4*this._elevation.exaggeration();else if(this._elevation){const Wt=this._elevation.getMinMaxForVisibleTiles();$e=Wt?Wt.max:this._centerAltitude}else $e=this._centerAltitude;const Ke=i.isTerrainDEM?-$e:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ze=this.projection.isReprojectedInTileSpace?n.bP(this):1,it=Wt=>{const ui=new n.a5(Wt.x+25e-6,Wt.y,Wt.z),Ti=new n.a5(Wt.x,Wt.y+25e-6,Wt.z),Ci=Wt.toLngLat(),mi=ui.toLngLat(),Xi=Ti.toLngLat(),zn=this.locationCoordinate(Ci),$n=this.locationCoordinate(mi),An=this.locationCoordinate(Xi),kn=Math.hypot($n.x-zn.x,$n.y-zn.y),dn=Math.hypot(An.x-zn.x,An.y-zn.y);return Math.sqrt(kn*dn)*Ze/25e-6},gt=Wt=>{const wi=$e,ui=Ke;return{aabb:n.bS(this,j,0,0,0,Wt,ui,wi,this.projection),zoom:0,x:0,y:0,minZ:ui,maxZ:wi,wrap:Wt,fullyVisible:!1}},Lt=[];let wt=[];const vt=s,ri=i.reparseOverscaled?d:s,hi=(_e-this._centerAltitude)*ue,Si=Wt=>{if(!this._elevation||!Wt.tileID||!E)return;const wi=this._elevation.getMinMaxForTile(Wt.tileID),ui=Wt.aabb;wi?(ui.min[2]=wi.min,ui.max[2]=wi.max,ui.center[2]=(ui.min[2]+ui.max[2])/2):(Wt.shouldSplit=Ki(Wt),Wt.shouldSplit||(ui.min[2]=ui.max[2]=ui.center[2]=this._centerAltitude))},Gi=(Wt,wi)=>{if(.707*wi<Wt)return 1;const ui=wi/Wt;return ui/(1.4144271570014144+(Math.pow(1.1,ui-1.4144271570014144+1)-1)/(1.1-1)-1)},Ki=Wt=>{if(Wt.zoom<Ue)return!0;if(Wt.zoom===vt)return!1;if(Wt.shouldSplit!=null)return Wt.shouldSplit;const wi=Wt.aabb.distanceX(ge),ui=Wt.aabb.distanceY(ge);let Ti=hi,Ci=1;if(Z){Ti=Wt.aabb.distanceZ(ge);const dn=Math.pow(2,Wt.zoom),tr=n.aN((Wt.y+1)/dn),dr=n.aN(Wt.y/dn),Nr=Math.min(Math.max(B,tr),dr),as=n.c6(Nr)/n.c6(B);if(Ci=Nr===B?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,as/this._mercatorScaleRatio),this.zoom<=n.c3&&Wt.zoom===vt-1&&as>=.9)return!0}else if(w&&(Ti=Wt.aabb.distanceZ(ge)*ue),this.projection.isReprojectedInTileSpace&&d<=5){const dn=Math.pow(2,Wt.zoom),tr=it(new n.a5((Wt.x+.5)/dn,(Wt.y+.5)/dn));Ci=tr>.85?1:tr}if(!E){const dn=Math.sqrt(wi*wi+ui*ui+Ti*Ti);let tr=(1<<vt-Wt.zoom)*Ne*Ci;return tr*=Gi(Math.max(Ti,hi),dn),dn<tr}let mi=Number.MAX_VALUE,Xi=0;const zn=Wt.aabb.getCorners(),$n=[];for(const dn of zn){n.a6.vec3.sub($n,dn,ge),Z||(w?$n[2]*=ue:$n[2]=hi);const tr=n.a6.vec3.dot($n,this._camera.forward());tr<mi&&(mi=tr,Xi=Math.abs($n[2]))}let An=(1<<vt-Wt.zoom)*Ne*Ci;if(An*=Gi(Math.max(Xi,hi),mi),mi<An)return!0;const kn=Wt.aabb.closestPoint(H);return kn[0]===H[0]&&kn[1]===H[1]};if(this.renderWorldCopies)for(let Wt=1;Wt<=3;Wt++)Lt.push(gt(-Wt)),Lt.push(gt(Wt));for(Lt.push(gt(0));Lt.length>0;){const Wt=Lt.pop(),wi=Wt.x,ui=Wt.y;let Ti=Wt.fullyVisible;const Ci=()=>this.projection.name==="globe"&&(Wt.y===0||Wt.y===(1<<Wt.zoom)-1);if(!Ti){let mi=Oe?Wt.aabb.intersects(se):Wt.aabb.intersectsFlat(se);if(mi===0&&Ci()){const Xi=new n.bQ(Wt.zoom,wi,ui);mi=n.bR(this,j,Xi,!0).intersects(se)}if(mi===0)continue;Ti=mi===2}if(Wt.zoom!==vt&&Ki(Wt))for(let mi=0;mi<4;mi++){const Xi=(wi<<1)+mi%2,zn=(ui<<1)+(mi>>1),$n={aabb:E?Wt.aabb.quadrant(mi):n.bS(this,j,Wt.zoom+1,Xi,zn,Wt.wrap,Wt.minZ,Wt.maxZ,this.projection),zoom:Wt.zoom+1,x:Xi,y:zn,wrap:Wt.wrap,fullyVisible:Ti,tileID:void 0,shouldSplit:void 0,minZ:Wt.minZ,maxZ:Wt.maxZ};w&&!Z&&($n.tileID=new n.aA(Wt.zoom+1===vt?ri:Wt.zoom+1,Wt.wrap,Wt.zoom+1,Xi,zn),Si($n)),Lt.push($n)}else{const mi=Wt.zoom===vt?ri:Wt.zoom;if(i.minzoom&&i.minzoom>mi)continue;let Xi=0;if(!Ti){let kn=Oe?Wt.aabb.intersectsPrecise(se):Wt.aabb.intersectsPreciseFlat(se);if(kn===0&&Ci()){const dn=new n.bQ(Wt.zoom,wi,ui);kn=n.bR(this,j,dn,!0).intersectsPrecise(se)}if(kn===0)continue;if(i.calculateQuadrantVisibility)if(se.containsPoint(Wt.aabb.center))Xi=15;else for(let dn=0;dn<4;dn++)Wt.aabb.quadrant(dn).intersects(se)!==0&&(Xi|=1<<dn)}const zn=H[0]-(.5+wi+(Wt.wrap<<Wt.zoom))*(1<<s-Wt.zoom),$n=H[1]-.5-ui,An=Wt.tileID?Wt.tileID:new n.aA(mi,Wt.wrap,Wt.zoom,wi,ui);i.calculateQuadrantVisibility&&(An.visibleQuadrants=Xi),wt.push({tileID:An,distanceSq:zn*zn+$n*$n})}}if(this.fogCullDistSq){const Wt=this.fogCullDistSq,wi=this.horizonLineFromTop();wt=wt.filter(ui=>{const Ti=[0,0,0,1],Ci=[n.ab,n.ab,0,1],mi=this.calculateFogTileMatrix(ui.tileID.toUnwrapped());n.a6.vec4.transformMat4(Ti,Ti,mi),n.a6.vec4.transformMat4(Ci,Ci,mi);const Xi=n.a6.vec4.min([],Ti,Ci),zn=n.a6.vec4.max([],Ti,Ci),$n=n.bT(Xi,zn);if($n===0)return!0;let An=!1;const kn=this._elevation;if(kn&&$n>Wt&&wi!==0){const dn=this.calculateProjMatrix(ui.tileID.toUnwrapped());let tr;i.isTerrainDEM||(tr=kn.getMinMaxForTile(ui.tileID)),tr||(tr={min:Ke,max:$e});const dr=n.c4(this.rotation),Nr=[dr[0]*n.ab,dr[1]*n.ab,tr.max];n.a6.vec3.transformMat4(Nr,Nr,dn),An=(1-Nr[1])*this.height*.5<wi}return $n<Wt||An})}return wt.sort((Wt,wi)=>Wt.distanceSq-wi.distanceSq).map(Wt=>Wt.tileID)}resize(i,s){this.width=i,this.height=s,this.pixelsToGLUnits=[2/i,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const s=n.ap(i.lat,-n.bU,n.bU),d=this.projection.project(i.lng,s);return new n.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,s){let d,x;const w=this.centerPoint;if(this.projection.name==="globe"){const O=this.worldSize;d=(s.x-w.x)/O,x=(s.y-w.y)/O}else{const O=this.pointCoordinate(s),B=this.pointCoordinate(w);d=O.x-B.x,x=O.y-B.y}const E=this.locationCoordinate(i);this.setLocation(new n.a5(E.x-d,E.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,s){const d=s?n.bE(s,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new n.a5(x.x,x.y,d)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,s){const d=s??this._centerAltitude,x=[i.x,i.y,0,1],w=[i.x,i.y,1,1];n.a6.vec4.transformMat4(x,x,this.pixelMatrixInverse),n.a6.vec4.transformMat4(w,w,this.pixelMatrixInverse);const E=w[3];n.a6.vec4.scale(x,x,1/x[3]),n.a6.vec4.scale(w,w,1/E);const O=x[2],B=w[2];return{p0:x,p1:w,t:O===B?0:(d-O)/(B-O)}}screenPointToMercatorRay(i){const s=[i.x,i.y,0,1],d=[i.x,i.y,1,1];return n.a6.vec4.transformMat4(s,s,this.pixelMatrixInverse),n.a6.vec4.transformMat4(d,d,this.pixelMatrixInverse),n.a6.vec4.scale(s,s,1/s[3]),n.a6.vec4.scale(d,d,1/d[3]),s[2]=n.bE(s[2],this._center.lat)*this.worldSize,d[2]=n.bE(d[2],this._center.lat)*this.worldSize,n.a6.vec4.scale(s,s,1/this.worldSize),n.a6.vec4.scale(d,d,1/this.worldSize),new n.aj([s[0],s[1],s[2]],n.a6.vec3.normalize([],n.a6.vec3.sub([],d,s)))}rayIntersectionCoordinate(i){const{p0:s,p1:d,t:x}=i,w=n.bE(s[2],this._center.lat),E=n.bE(d[2],this._center.lat);return new n.a5(n.aa(s[0],d[0],x)/this.worldSize,n.aa(s[1],d[1],x)/this.worldSize,n.aa(w,E,x))}pointCoordinate(i,s=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,s)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let s=this.projection.pointCoordinate3D(this,i.x,i.y);if(s)return new n.a5(s[0],s[1],s[2]);let d=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const w=.02*x,E=i.clone();for(let O=0;O<10&&x-d>w;O++){E.y=n.aa(d,x,.66);const B=this.projection.pointCoordinate3D(this,E.x,E.y);B?(x=E.y,s=B):d=E.y}return s?new n.a5(s[0],s[1],s[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=n.bV)return!this.isPointAboveHorizon(i);const s=this.pointCoordinate(i);return s.y>=0&&s.y<=1}_coordinatePoint(i,s){const d=s&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,d+i.toAltitude(),1];return n.a6.vec4.transformMat4(x,x,this.pixelMatrix),x[3]>0?new n.P(x[0]/x[3],x[1]/x[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:s}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new n.P(s,i)),E=this.pointLocation3D(new n.P(x,i)),O=this.pointLocation3D(new n.P(x,d)),B=this.pointLocation3D(new n.P(s,d));let j=Math.min(w.lng,E.lng,O.lng,B.lng),H=Math.max(w.lng,E.lng,O.lng,B.lng),Z=Math.min(w.lat,E.lat,O.lat,B.lat),Y=Math.max(w.lat,E.lat,O.lat,B.lat);const se=Math.pow(2,-this.zoom)/16*270,pe=this.projection.name==="globe"?1:4,ue=(_e,ge,Oe,Ne,Ue)=>{const $e=(_e+Oe)/2,Ke=(ge+Ne)/2,Ze=new n.P($e,Ke),{lng:it,lat:gt}=this.pointLocation3D(Ze),Lt=Math.max(0,j-it,Z-gt,it-H,gt-Y);j=Math.min(j,it),H=Math.max(H,it),Z=Math.min(Z,gt),Y=Math.max(Y,gt),(Ue<pe||Lt>se)&&(ue(_e,ge,$e,Ke,Ue+1),ue($e,Ke,Oe,Ne,Ue+1))};if(ue(s,i,x,i,1),ue(x,i,x,d,1),ue(x,d,s,d,1),ue(s,d,s,i,1),this.projection.name==="globe"){const[_e,ge]=n.bW(this);_e?(Y=90,H=180,j=-180):ge&&(Z=-90,H=180,j=-180)}return new n.as(new n.bL(j,Z),new n.bL(H,Y))}_getBoundsRectangular(i,s){const{top:d,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,O=new n.P(x,d),B=new n.P(E,d),j=new n.P(E,w),H=new n.P(x,w);let Z=this.pointCoordinate(O,i),Y=this.pointCoordinate(B,i);const se=this.pointCoordinate(j,s),pe=this.pointCoordinate(H,s),ue=(_e,ge)=>(ge.y-_e.y)/(ge.x-_e.x);return Z.y>1&&Y.y>=0?Z=new n.a5((1-pe.y)/ue(pe,Z)+pe.x,1):Z.y<0&&Y.y<=1&&(Z=new n.a5(-pe.y/ue(pe,Z)+pe.x,0)),Y.y>1&&Z.y>=0?Y=new n.a5((1-se.y)/ue(se,Y)+se.x,1):Y.y<0&&Z.y<=1&&(Y=new n.a5(-se.y/ue(se,Y)+se.x,0)),new n.as().extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(pe)).extend(this.coordinateLocation(se))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=i.visibleDemTiles.reduce((d,x)=>{if(x.dem){const w=x.dem.tree;d.min=Math.min(d.min,w.minimums[0]),d.max=Math.max(d.max,w.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*i.exaggeration(),s.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-s*(1-this._horizonShift);return i?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-n.bU,this.maxLat=n.bU,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.am(this.minLng)*this.tileSize,this.worldMaxX=n.am(this.maxLng)*this.tileSize,this.worldMinY=n.at(this.maxLat)*this.tileSize,this.worldMaxY=n.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,s){return this.projection.createTileMatrix(this,s,i)}calculateDistanceTileData(i){const s=i.key,d=this._distanceTileDataCache;if(d[s])return d[s];const x=i.canonical,w=1/this.height,E=this.cameraWorldSize,O=E/this.zoomScale(x.z),B=(x.x+Math.pow(2,x.z)*i.wrap)*O,j=x.y*O,H=this.point;H.x*=E/this.worldSize,H.y*=E/this.worldSize;const Z=this.angle,Y=Math.sin(-Z),se=-Math.cos(-Z);return d[s]={bearing:[Y,se],center:[(H.x-B)*w,(H.y-j)*w],scale:O/n.ab*w},d[s]}calculateFogTileMatrix(i){const s=i.key,d=this._fogTileMatrixCache;if(d[s])return d[s];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return n.a6.mat4.multiply(x,this.worldToFogMatrix,x),d[s]=new Float32Array(x),d[s]}calculateProjMatrix(i,s=!1,d=!1){const x=i.key;let w;if(w=d?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const E=this.calculatePosMatrix(i,this.worldSize);let O;return O=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,n.a6.mat4.multiply(E,O,E),w[x]=new Float32Array(E),w[x]}calculatePixelsToTileUnitsMatrix(i){const s=i.tileID.key,d=this._pixelsToTileUnitsCache;if(d[s])return d[s];const x=n.bX(i,this);return d[s]=x,d[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,s=n.a6.mat4.fromScaling([],[i,i,i]);return n.a6.mat4.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const s=n.bE(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(s),x=this._camera.forward(),w=n.bE(1,this._center.lat);d[2]/=w,x[2]/=w,n.a6.vec3.normalize(x,x);const E=i.raycast(d,x,i.exaggeration());if(E){const O=n.a6.vec3.scaleAndAdd([],d,x,E),B=new n.a5(O[0],O[1],n.bE(O[2],n.aN(O[1]))),j=(B.z+n.a6.vec3.length([B.x-d[0],B.y-d[1],B.z-d[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(j),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const s=this._elevation,d=n.bE(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(d),w=s.getAtPointOrZero(new n.a5(...x)),E=this.pixelsPerMeter/this.worldSize*w,O=this._minimumHeightOverTerrain(),B=x[2]-E;if(B<=O)if(B<0||i){const j=this.locationCoordinate(this._center,this._centerAltitude),H=[x[0],x[1],j.z-x[2]],Z=n.a6.vec3.length(H);H[2]-=(O-B)/this._pixelsPerMercatorPixel;const Y=n.a6.vec3.length(H);if(Y===0)return;n.a6.vec3.scale(H,H,Z/Y*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],j.z*this._pixelsPerMercatorPixel-H[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const Y=this.center;return Y.lat=n.ap(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(Y.lng=n.ap(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const s=this._unmodified,{x:d,y:x}=this.point;let w=0,E=d,O=x;const B=this.width/2,j=this.height/2,H=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(x-j<H&&(O=H+j),x+j>Z&&(O=Z-j),Z-H<this.height&&(w=Math.max(w,this.height/(Z-H)),O=(Z+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,pe=this.worldSize/2-(Y+se)/2;E=(d+pe+this.worldSize)%this.worldSize-pe,E-B<Y&&(E=Y+B),E+B>se&&(E=se-B),se-Y<this.width&&(w=Math.max(w,this.width/(se-Y)),E=(se+Y)/2)}E===d&&O===x||(this.center=this.unproject(new n.P(E,O))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,s=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bE(1,this.center.lat)/n.bE(1,n.c5));const x=n.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?d:1,E=this._camera.getWorldToCamera(this.worldSize,w);let O;const B=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(B[8]=2*-i.x/this.width,B[9]=2*i.y/this.height,this.isOrthographic){let gt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Lt=gt*this.aspect,wt=-Lt,vt=-gt;Lt-=i.x,wt-=i.x,gt+=i.y,vt+=i.y,O=this._camera.getCameraToClipOrthographic(wt,Lt,vt,gt,this._nearZ,this._farZ),((ri,hi,Si,Gi)=>{for(let Ki=0;Ki<16;Ki++)ri[Ki]=_o(hi[Ki],Si[Ki],Gi)})(O,O,B,gl(this.pitch>=15?1:this.pitch/15))}else O=B;const j=n.a6.mat4.mul([],B,E);let H=n.a6.mat4.mul([],O,E);if(this.projection.isReprojectedInTileSpace){const gt=this.locationCoordinate(this.center),Lt=n.a6.mat4.identity([]);n.a6.mat4.translate(Lt,Lt,[gt.x*this.worldSize,gt.y*this.worldSize,0]),n.a6.mat4.multiply(Lt,Lt,n.bZ(this)),n.a6.mat4.translate(Lt,Lt,[-gt.x*this.worldSize,-gt.y*this.worldSize,0]),n.a6.mat4.multiply(H,H,Lt),n.a6.mat4.multiply(j,j,Lt),this.inverseAdjustmentMatrix=n.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.a6.mat4.scale([],H,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=H,this.invProjMatrix=n.a6.mat4.invert(new Float64Array(16),this.projMatrix),s){const gt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);gt[8]=2*-i.x/this.width,gt[9]=2*i.y/this.height,this.expandedFarZProjMatrix=n.a6.mat4.mul([],gt,E)}else this.expandedFarZProjMatrix=this.projMatrix;const Z=n.a6.mat4.invert([],O);this.frustumCorners=n.b$.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const Y=new Float32Array(16);n.a6.mat4.identity(Y),n.a6.mat4.scale(Y,Y,[1,-1,1]),n.a6.mat4.rotateX(Y,Y,this._pitch),n.a6.mat4.rotateZ(Y,Y,this.angle);const se=n.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.a6.mat4.clone(se);const pe=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;se[8]=2*-i.x/this.width,se[9]=2*(i.y+pe)/this.height,this.skyboxMatrix=n.a6.mat4.multiply(Y,se,Y);const ue=this.point,_e=ue.x,ge=ue.y,Oe=this.width%2/2,Ne=this.height%2/2,Ue=Math.cos(this.angle),$e=Math.sin(this.angle),Ke=_e-Math.round(_e)+Ue*Oe+$e*Ne,Ze=ge-Math.round(ge)+Ue*Ne+$e*Oe,it=new Float64Array(H);if(n.a6.mat4.translate(it,it,[Ke>.5?Ke-1:Ke,Ze>.5?Ze-1:Ze,0]),this.alignedProjMatrix=it,H=n.a6.mat4.create(),n.a6.mat4.scale(H,H,[this.width/2,-this.height/2,1]),n.a6.mat4.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=n.a6.mat4.create(),n.a6.mat4.scale(H,H,[1,-1,1]),n.a6.mat4.translate(H,H,[-1,-1,0]),n.a6.mat4.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=n.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,j),this._calcFogMatrices(),this._distanceTileDataCache={},H=n.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!H)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=H,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.c0(this);const gt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.a6.vec3.transformMat4(gt,gt,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=H;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,d=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[i,i,s];n.a6.vec3.scale(w,w,x),n.a6.vec3.scale(d,d,-1),n.a6.vec3.multiply(d,d,w);const E=n.a6.mat4.create();n.a6.mat4.translate(E,E,d),n.a6.mat4.scale(E,E,w),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,s,x)}_computeCameraPosition(i){const s=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-d[0]*w,x.y/this.worldSize-d[1]*w,i/this.worldSize*this._centerAltitude-d[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],x=i[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((s-d)/x,1)),this._camera.position=n.a6.vec3.scaleAndAdd([],this._camera.position,i,w),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,s=this._camera.forward(),{pitch:d,bearing:x}=this._camera.getPitchBearing(),w=n.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.bC(this._maxPitch)),O=Math.max((i[2]-w)/Math.cos(d),E),B=this._zoomFromMercatorZ(O);n.a6.vec3.scaleAndAdd(i,i,s,O),this._pitch=n.ap(d,n.bC(this.minPitch),n.bC(this.maxPitch)),this.angle=n.bB(x,-Math.PI,Math.PI),this._setZoom(n.ap(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.a5(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let s=0,d=n.bV,x=0,w=1/0;for(;d-s>1e-6&&d>s;){const E=s+.5*(d-s),O=this.tileSize*Math.pow(2,E),B=this.getCameraToCenterDistance(this.projection,E,O),j=this.scaleZoom(B/(i*this.tileSize)),H=Math.abs(E-j);H<w&&(w=H,x=E),E<j?s=E:d=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,s){const d=Math.min(i.x,s.x),x=Math.max(i.x,s.x),w=Math.min(i.y,s.y),E=Math.max(i.y,s.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const O=[new n.P(d,w),new n.P(x,E),new n.P(d,E),new n.P(x,w)],B=this.renderWorldCopies?-3:0,j=this.renderWorldCopies?4:1;for(const H of O){const Z=this.pointRayIntersection(H);if(Z.t<0)return!0;const Y=this.rayIntersectionCoordinate(Z);if(Y.x<B||Y.y<0||Y.x>j||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(i,s){const d=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(d)+s;return d-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([s,d,x],w){const E=[s,d,x,1];n.a6.vec4.transformMat4(E,E,w);const O=E[3]=Math.max(E[3],1e-6);return E[0]/=O,E[1]/=O,E[2]/=O,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,i))}}getCameraToCenterDistance(i,s=this.zoom,d=this.worldSize){const x=n.bY(i,s,this.width,this.height,1024),w=i.pixelSpaceConversion(this.center.lat,d,x);let E=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(E=_o(1,E,gl(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.a6.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Ea=(h,i)=>{if(i>0&&h.terrain&&n.w("Cutoff is currently disabled on terrain"),i<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=h.transform,d=Math.max(Math.abs(s._zoom-(h.minCutoffZoom-1)),1),x=s.isLODDisabled(!1)?n.a7(60,45,s.pitch):n.a7(30,15,s.pitch),w=s._farZ-s._nearZ,E=i*s.height,O=((1-(B=x))*s.cameraToCenterDistance+B*(s._farZ+E))*d;var B;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(O-s._nearZ)/w,(O-E-s._nearZ)/w]}}},Ys={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Fh{constructor(i,s){this.aabb=i,this.lastCascade=s}}class un{add(i,s){const d=this.receivers[i.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],s.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],s.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],s.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],s.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],s.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],s.max[2])):this.receivers[i.key]=new Fh(s,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,s,d){const x=n.ca.fromPoints(i.points);let w=0;for(const E in this.receivers){const O=this.receivers[E];if(!O||!x.intersectsAabb(O.aabb))continue;O.aabb.min=x.closestPoint(O.aabb.min),O.aabb.max=x.closestPoint(O.aabb.max);const B=O.aabb.getCorners();for(let j=0;j<d.length;j++){let H=!0;for(const Z of B){const Y=[Z[0]*s,Z[1]*s,Z[2]];if(n.a6.vec3.transformMat4(Y,Y,d[j].matrix),Y[0]<-1||Y[0]>1||Y[1]<-1||Y[1]>1){H=!1;break}}if(O.lastCascade=j,w=Math.max(w,j),H)break}}return w+1}}class om{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new un,this._depthMode=new Xn(i.context.gl.LEQUAL,Xn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Ys,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Ys,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Ys,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,s){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const x=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||x<=0||(this._shadowLayerCount=d.style.order.reduce((pe,ue)=>{const _e=d.style._mergedLayers[ue];return pe+(_e.hasShadowPass()&&!_e.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=d.context,E=Ys.shadowMapResolution,O=Ys.shadowMapResolution;if(this._cascades.length===0||Ys.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let pe=0;pe<Ys.cascadeCount;++pe){const ue=d._shadowMapDebug,_e=w.gl,ge=w.createFramebuffer(E,O,ue,"texture"),Oe=new n.T(w,{width:E,height:O,data:null},_e.DEPTH_COMPONENT16);if(ge.depthAttachment.set(Oe.texture),ue){const Ne=new n.T(w,{width:E,height:O,data:null},_e.RGBA8);ge.colorAttachment.set(Ne.texture)}this._cascades.push({framebuffer:ge,texture:Oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bO,scale:0})}}this.shadowDirection=Xl(s);let B=0;if(i.elevation){const pe=i.elevation,ue=[1e4,-1e4];pe.visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{const ge=_e.dem.tree;ue[0]=Math.min(ue[0],ge.minimums[0]),ue[1]=Math.max(ue[1],ge.maximums[0])}),ue[0]!==1e4&&(B=(ue[1]-ue[0])*pe.exaggeration())}const j=1.5*i.cameraToCenterDistance,H=3*j,Z=new Float64Array(16);for(let pe=0;pe<this._cascades.length;++pe){const ue=this._cascades[pe];let _e=i.height/50,ge=1;Ys.cascadeCount===1?ge=H:pe===0?ge=j:(_e=j,ge=H);const[Oe,Ne]=Sc(i,this.shadowDirection,_e,ge,Ys.shadowMapResolution,B);ue.scale=i.scale,ue.matrix=Oe,ue.boundingSphereRadius=Ne,n.a6.mat4.invert(Z,ue.matrix),ue.frustum=n.bO.fromInvProjectionMatrix(Z,1,0,!0),ue.far=ge}const Y=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Y].far,this._cascades[Y].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ys.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ys.shadowMapResolution,this._uniformValues.u_shadowmap_0=ao.ShadowMap0,this._uniformValues.u_shadowmap_1=ao.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const se=d.transform.elevation;for(const pe of this._groundShadowTiles){let ue={min:0,max:0};if(se){const _e=se.getMinMaxForTile(pe);_e&&(ue=_e)}this.addShadowReceiver(pe.toUnwrapped(),ue.min,ue.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,s){if(!this.enabled)return;const d=this.painter,x=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),x.viewport.set([0,0,Ys.shadowMapResolution,Ys.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){d.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:n.bA.white,depth:1});for(const E of i.order){const O=i._mergedLayers[E];if(!O.hasShadowPass()||O.isHidden(d.transform.zoom))continue;const B=i.getLayerSourceCache(O),j=B?s[B.id]:void 0;(O.type==="model"||j&&j.length)&&d.renderLayer(d,B,O,j)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,s=i.style,d=i.context,x=s.directionalLight,w=s.ambientLight;if(!x||!w)return;const E=[],O=Ea(i,i.longestCutoffRange);O.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const B=nu(s,x,w),j=new Xn(d.gl.LEQUAL,Xn.ReadOnly,i.depthRangeFor3D);for(const H of this._groundShadowTiles){const Z=H.toUnwrapped(),Y=i.isTileAffectedByFog(H),se=i.getOrCreateProgram("groundShadow",{defines:E,overrideFog:Y});this.setupShadows(Z,se),i.uploadCommonUniforms(d,se,Z,null,O);const pe={u_matrix:i.transform.calculateProjMatrix(Z),u_ground_shadow_factor:B};se.draw(i,d.gl.TRIANGLES,j,hr.disabled,Ir.multiply,qn.disabled,pe,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ir.unblended:Ir.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const s=this.painter.transform,d=s.calculatePosMatrix(i,s.worldSize);return n.a6.mat4.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(i){return n.a6.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,s,d,x=0){if(!this.enabled)return;const w=this.painter.transform,E=this.painter.context,O=E.gl,B=this._uniformValues,j=new Float64Array(16),H=w.calculatePosMatrix(i,w.worldSize);for(let Z=0;Z<this._cascades.length;Z++)n.a6.mat4.multiply(j,this._cascades[Z].matrix,H),B[Z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(j),E.activeTexture.set(O.TEXTURE0+ao.ShadowMap0+Z),this._cascades[Z].texture.bind(O.NEAREST,O.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){const Z=n.c9(i.canonical),Y=2/w.tileSize*n.ab/Ys.shadowMapResolution,se=Y*this._cascades[0].boundingSphereRadius,pe=Y*this._cascades[this._cascades.length-1].boundingSphereRadius,ue=(d==="vector-tile"?1:3)/Math.pow(2,x-i.canonical.z-(1-w.zoom+Math.floor(w.zoom)));B.u_shadow_normal_offset=[Z,se*ue,pe*ue],B.u_shadow_bias=[6e-5,.0012,.012]}else B.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(E,B)}setupShadowsFromMatrix(i,s,d=!1){if(!this.enabled)return;const x=this.painter.context,w=x.gl,E=this._uniformValues,O=new Float64Array(16);for(let B=0;B<Ys.cascadeCount;B++)n.a6.mat4.multiply(O,this._cascades[B].matrix,i),E[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),x.activeTexture.set(w.TEXTURE0+ao.ShadowMap0+B),this._cascades[B].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=d,d){const B=Ys.normalOffset;E.u_shadow_normal_offset=[1,B,B],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,s,d,x){if(x[2]>=0)return{};const w=function(B,j,H){const Z=H/(1<<B.canonical.z);return new n.ca([B.canonical.x*Z+B.wrap*H,B.canonical.y*Z+B.wrap*H,0],[(B.canonical.x+1)*Z+B.wrap*H,(B.canonical.y+1)*Z+B.wrap*H,j])}(i,s,d).getCorners(),E=s/-x[2];x[0]<0?(n.a6.vec3.add(w[0],w[0],[x[0]*E,0,0]),n.a6.vec3.add(w[3],w[3],[x[0]*E,0,0])):x[0]>0&&(n.a6.vec3.add(w[1],w[1],[x[0]*E,0,0]),n.a6.vec3.add(w[2],w[2],[x[0]*E,0,0])),x[1]<0?(n.a6.vec3.add(w[0],w[0],[0,x[1]*E,0]),n.a6.vec3.add(w[1],w[1],[0,x[1]*E,0])):x[1]>0&&(n.a6.vec3.add(w[2],w[2],[0,x[1]*E,0]),n.a6.vec3.add(w[3],w[3],[0,x[1]*E,0]));const O={};return O.vertices=w,O.planes=[_a(w[1],w[0],w[4]),_a(w[2],w[1],w[5]),_a(w[3],w[2],w[6]),_a(w[0],w[3],w[7])],O}addShadowReceiver(i,s,d){this._receivers.add(i,n.ca.fromTileIdAndHeight(i,s,d))}getMaxCascadeForTile(i){const s=this._receivers.get(i);return s&&s.lastCascade?s.lastCascade:0}}function _a(h,i,s){const d=n.a6.vec3.sub([],s,i),x=n.a6.vec3.sub([],h,i),w=n.a6.vec3.cross([],d,x),E=n.a6.vec3.length(w);return E===0?[0,0,1,0]:(n.a6.vec3.scale(w,w,1/E),[w[0],w[1],w[2],-n.a6.vec3.dot(w,i)])}function Xl(h){const i=h.properties.get("direction"),s=n.c8(i.x,i.y,i.z);s[2]=n.ap(s[2],0,75);const d=n.cb([s[0],s[1],s[2]]);return n.a6.vec3.fromValues(d.x,d.y,d.z)}function nu(h,i,s){const d=i.properties.get("color"),x=i.properties.get("intensity"),w=i.properties.get("direction"),E=[w.x,w.y,w.z],O=s.properties.get("color"),B=s.properties.get("intensity"),j=Math.max(n.a6.vec3.dot([0,0,1],E),0),H=[0,0,0];n.a6.vec3.scale(H,O.toRenderColor(h.getLut(i.scope)).toArray01Linear().slice(0,3),B);const Z=[0,0,0];return n.a6.vec3.scale(Z,d.toRenderColor(h.getLut(s.scope)).toArray01Linear().slice(0,3),j*x),n.cc([H[0]>0?H[0]/(H[0]+Z[0]):0,H[1]>0?H[1]/(H[1]+Z[1]):0,H[2]>0?H[2]/(H[2]+Z[2]):0])}function Sc(h,i,s,d,x,w){const E=h.zoom,O=h.scale,B=h.worldSize,j=1/B,H=h.aspect,Z=Math.sqrt(1+H*H)*Math.tan(.5*h.fovX),Y=Z*Z,se=d-s,pe=d+s;let ue,_e;Y>se/pe?(ue=d,_e=d*Z):(ue=.5*pe*(1+Y),_e=.5*Math.sqrt(se*se+2*(d*d+s*s)*Y+pe*pe*Y*Y));const ge=h.projection.pixelsPerMeter(h.center.lat,B),Oe=h._camera.getCameraToWorldMercator(),Ne=[0,0,-ue*j];n.a6.vec3.transformMat4(Ne,Ne,Oe);let Ue=_e*j;const $e=h._edgeInsets;if(!($e.left===0&&$e.top===0&&$e.right===0&&$e.bottom===0||$e.left===$e.right&&$e.top===$e.bottom)){const Ti=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?ge:1),Ci=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,s,d);Ci[8]=2*-h.centerOffset.x/h.width,Ci[9]=2*h.centerOffset.y/h.height;const mi=new Float64Array(16);n.a6.mat4.mul(mi,Ci,Ti);const Xi=new Float64Array(16);n.a6.mat4.invert(Xi,mi);const zn=n.bO.fromInvProjectionMatrix(Xi,B,E,!0);for(const $n of zn.points){const An=((Ke=$n)[0]/=O,Ke[1]/=O,Ke[2]=n.bE(Ke[2],h._center.lat),Ke);Ue=Math.max(Ue,n.a6.vec3.len(n.a6.vec3.subtract([],Ne,An)))}}var Ke;Ue*=x/(x-1);const Ze=Math.acos(i[2]),it=Math.atan2(-i[0],-i[1]),gt=new Tc;gt.position=Ne,gt.setPitchBearing(Ze,it);const Lt=gt.getWorldToCamera(B,ge),wt=Ue*B,vt=Math.min(h._mercatorZfromZoom(17)*B*-2,-2*wt),ri=gt.getCameraToClipOrthographic(-wt,wt,-wt,wt,vt,(wt+w*ge)/i[2]),hi=new Float64Array(16);n.a6.mat4.multiply(hi,ri,Lt);const Si=n.a6.vec3.fromValues(Math.floor(1e6*Ne[0])/1e6*B,Math.floor(1e6*Ne[1])/1e6*B,0),Gi=.5*x,Ki=[0,0,0];n.a6.vec3.transformMat4(Ki,Si,hi),n.a6.vec3.scale(Ki,Ki,Gi);const Wt=[Math.floor(Ki[0]),Math.floor(Ki[1]),Math.floor(Ki[2])],wi=[0,0,0];n.a6.vec3.sub(wi,Ki,Wt),n.a6.vec3.scale(wi,wi,-1/Gi);const ui=new Float64Array(16);return n.a6.mat4.identity(ui),n.a6.mat4.translate(ui,ui,wi),n.a6.mat4.multiply(hi,ui,hi),[hi,wt]}class kl extends n.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,s){return n.aG(this.requestManager.transformRequest(s,n.R.Model).url).then(d=>{if(!d)return;const x=n.aH(d),w=new n.aI(i,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w}).catch(d=>{if(d&&d.status===404)return null;this.fire(new n.t(new Error(`Could not load model ${i} from ${s}: ${d.message}`)))})}load(i,s){this.models[s]||(this.models[s]={});const d=Object.keys(i);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+d.length;const x=[];for(const w of d)x.push(this.loadModel(w,i[w]));Promise.allSettled(x).then(w=>{for(let E=0;E<w.length;E++){const{status:O,value:B}=w[E];O==="fulfilled"&&B&&(this.models[s][d[E]]={model:B,numReferences:1})}this.numModelsLoading[s]-=d.length,this.fire(new n.x("data",{dataType:"style"}))}).catch(w=>{this.fire(new n.t(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,s){return!!this.getModel(i,s)}getModel(i,s){return this.models[s]||(this.models[s]={}),this.models[s][i]?this.models[s][i].model:void 0}addModel(i,s,d){this.models[d]||(this.models[d]={}),this.hasModel(i,d)&&this.models[d][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(s)},d)}addModels(i,s){this.models[s]||(this.models[s]={});const d={};for(const x in i)this.models[s][x]={},d[x]=this.requestManager.normalizeModelURL(i[x]);this.load(d,s)}addModelsFromBucket(i,s){this.models[s]||(this.models[s]={});const d={};for(const x of i)this.hasModel(x,s)?this.models[s][x].numReferences++:d[x]=this.requestManager.normalizeModelURL(x);this.load(d,s)}removeModel(i,s){if(this.models[s]&&this.models[s][i]&&(this.models[s][i].numReferences--,this.models[s][i].numReferences===0)){const d=this.models[s][i].model;delete this.models[s][i],d.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,s){this.models[s]||(this.models[s]={});for(const d in this.models[s])this.models[s][d].model&&this.models[s][d].model.upload(i.context)}}const Hp=new n.a0({data:new n.a1(n._.colorTheme.data)}),No=(h,i)=>Ft(h,i&&i.filter(s=>s.identifier!=="source.canvas")),os=n.ar(fe,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Qn=n.ar(fe,["setCenter","setZoom","setBearing","setPitch"]),Qa={version:8,layers:[],sources:{}},am={duration:300,delay:0};class Na extends n.E{constructor(i,s={}){super(),this.map=i,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=n.l({},am),this._buildingIndex=new Ui(this),this.crossTileSymbolIndex=new tu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new bt,this.dispatcher=s.dispatcher?s.dispatcher:new n.ce(n.cf(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Ot,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new n.cg(i._requestManager,s.localFontFamily?n.ch.all:s.localIdeographFontFamily?n.ch.ideographs:n.ch.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new kl(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",n.ci());const d=this;this._rtlTextPluginCallback=Na.registerForPluginStateChange(x=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,E)=>{if(n.cj(w),E&&E.every(O=>O))for(const O in d._sourceCaches){const B=d._sourceCaches[O],j=B.getSource().type;j!=="vector"&&j!=="geojson"||B.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const E in this._layers){const O=this._layers[E];O.source===w.id&&this._validateLayer(O)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(n.f(i))return i;const s=n.ck(i);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${n.cl(JSON.stringify(i))}`}_diffStyle(i,s,d){this.globalId=this._getGlobalId(i);const x=(w,E)=>{try{E(null,this.setState(w,d))}catch(O){E(O,!1)}};if(typeof i=="string"){const w=this.map._requestManager.normalizeStyleURL(i),E=this.map._requestManager.transformRequest(w,n.R.Style);n.n(E,(O,B)=>{O?this.fire(new n.t(O)):B&&x(B,s)})}else typeof i=="object"&&x(i,s)}loadURL(i,s={}){this.fire(new n.x("dataloading",{dataType:"style"}));const d=typeof s.validate=="boolean"?s.validate:!n.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,s.accessToken),this.resolvedImports.add(i);const x=this.importsCache.get(i);if(x)return this._load(x,d);const w=this.map._requestManager.transformRequest(i,n.R.Style);this._request=n.n(w,(E,O)=>{if(this._request=null,E)this.fire(new n.t(E));else if(O)return this.importsCache.set(i,O),this._load(O,d)})}loadJSON(i,s={}){this.fire(new n.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=n.q.frame(()=>{this._request=null,this._load(i,s.validate!==!1)})}loadEmpty(){this.fire(new n.x("dataloading",{dataType:"style"})),this._load(Qa,!1)}_loadImports(i,s,d){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of i){const E=this._createFragmentStyle(w),O=new Promise(H=>{E.once("style.import.load",H),E.once("error",H)}).then(()=>this.mergeAll());if(x.push(O),this.resolvedImports.has(w.url)){E.loadEmpty();continue}const B=w.data||this.importsCache.get(w.url);B?(E.loadJSON(B,{validate:s}),this._isInternalStyle(B)&&(E.globalId=null)):w.url?E.loadURL(w.url,{validate:s}):E.loadEmpty();const j={style:E,id:w.id,config:w.config};if(d){const H=this.fragments.findIndex(({id:Z})=>Z===d);this.fragments=this.fragments.slice(0,H).concat(j).concat(this.fragments.slice(H))}else this.fragments.push(j)}return Promise.allSettled(x)}getImportGlobalIds(i=this,s=new Set){for(const d of i.fragments)d.style.globalId&&s.add(d.style.globalId),this.getImportGlobalIds(d.style,s);return[...s.values()]}_createFragmentStyle(i){const s=this.scope?n.av(i.id,this.scope):i.id;let d;const x=this._initialConfig&&this._initialConfig[s];(i.config||x)&&(d=n.l({},i.config,x));const w=new Na(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,s){const d=i.schema;if(this._isInternalStyle(i)){const E=n.l({},Qa,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(E,s)}if(this.updateConfig(this._config,d),s&&No(this,Lo(i)))return;this._loaded=!0,this.stylesheet=n.cm(i);const x=()=>{for(const j in i.sources)this.addSource(j,i.sources[j],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const E=Yi(this.stylesheet.layers);if(this._order=E.map(j=>j.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const j=this.stylesheet.lights[0];this.light=new $t(j.properties,j.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new $t(this.stylesheet.light)),this._layers={};for(const j of E){const H=n.cq(j,this.scope,this._styleColorTheme.lut,this.options);H.configDependencies.size!==0&&this._configDependentLayers.add(H.fqid),H.setEventedParent(this,{layer:{id:H.id}}),this._layers[H.id]=H;const Z=this.getOwnLayerSourceCache(H),Y=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Z&&H.canCastShadows()&&Y&&(Z.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const O=this.stylesheet.terrain;O&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(O,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.x("data",{dataType:"style"}));const B=this.isRootStyle();i.imports?this._loadImports(i.imports,s).then(()=>{this._reloadImports(),this.fire(new n.x(B?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.x(B?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const E=this._evaluateColorThemeData(w);this._loadColorTheme(E).then(()=>{x()}).catch(O=>{n.w(`Couldn't load color theme from the stylesheet: ${O}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,s,d,x,w,E,O,B;const j={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(H=>{if(H.stylesheet){if(H.light!=null&&(i=H.light),H.stylesheet.lights)for(const Z of H.stylesheet.lights)Z.type==="ambient"&&H.ambientLight!=null&&(s=H.ambientLight),Z.type==="directional"&&H.directionalLight!=null&&(d=H.directionalLight);x=this._prioritizeTerrain(x,H.terrain,H.stylesheet.terrain),H.stylesheet.fog&&H.fog!=null&&(w=H.fog),H.stylesheet.camera!=null&&(B=H.stylesheet.camera),H.stylesheet.projection!=null&&(E=H.stylesheet.projection),H.stylesheet.transition!=null&&(O=H.stylesheet.transition),j[H.scope]=H._styleColorTheme}}),this.light=i,this.ambientLight=s,this.directionalLight=d,this.fog=w,this._styleColorThemeForScope=j,x===null?delete this.terrain:this.terrain=x,this.camera=B||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=n.l({},am,O),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const s=d=>{for(const x of d.fragments)s(x.style);i(d)};s(this)}_prioritizeTerrain(i,s,d){const x=i&&i.drapeRenderMode===0;return d===null?s&&s.drapeRenderMode===0?s:x?i:null:s!=null&&(!i||x||s&&s.drapeRenderMode===1)?s:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{i=this._prioritizeTerrain(i,s.terrain,s.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(i=s.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},s={},d={};this.forEachFragmentStyle(x=>{for(const w in x._sourceCaches){const E=n.av(w,x.scope);i[E]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const E=n.av(w,x.scope);s[E]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const E=n.av(w,x.scope);d[E]=x._symbolSourceCaches[w]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=d}mergeLayers(){const i={},s=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(w=>{for(const O of w._order){const B=w._layers[O];if(B.type==="slot"){const j=n.cn(O);if(i[j])continue;i[j]=[]}B.slot&&i[B.slot]?i[B.slot].push(B):s.push(B)}const{featuresets:E}=w.stylesheet||{};if(E)for(const O in E){const{selectors:B}=E[O];for(const j of B){const H=w._layers[j.layer],Z=this._mergedLayerSelectors.get(H.fqid)||[];let Y;if(j.properties)for(const se in j.properties){const pe=n.M(j.properties[se]);pe.result==="success"&&(Y=Y||{},Y[se]=pe.value)}Z.push({featuresetId:O,featureNamespace:j.featureNamespace,properties:Y}),this._mergedLayerSelectors.set(H.fqid,Z)}}}),this._mergedOrder=[];const x=(w=[])=>{for(const E of w)if(E.type==="slot"){const O=n.cn(E.id);i[O]&&x(i[O]),this._mergedSlots.push(O)}else{const O=n.av(E.id,E.scope);this._mergedOrder.push(O),d[O]=E,E.is3D()&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};x(s),this._mergedOrder.sort((w,E)=>{const O=d[w],B=d[E];return O.hasInitialOcclusionOpacityProperties?B.is3D()?1:0:O.is3D()&&B.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=n.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(s,d,x){const w=n.l({},d);for(const O of Object.keys(n._.colorTheme))w[O]===void 0&&(w[O]=n._.colorTheme[O].default);const E=new n.$(Hp,s,new Map(x));return E.setTransitionOrValue(w,x),E.untransitioned().possiblyEvaluate(new n.a3(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,x)=>{const w="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let E=i;E.startsWith(w)||(E=w+E);const O="mapbox-reserved-lut",B=new Image;B.src=E,B.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},B.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void d();this._styleColorTheme.lutLoading=!1;const{width:j,height:H,data:Z}=n.q.getImageData(B);if(H>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(j!==H*H)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(O)&&this.removeImage(O),this.addImage(O,{data:new n.r({width:j,height:H},Z),pixelRatio:1,sdf:!1,version:0});const Y=this.imageManager.getImage(O,this.scope);Y?(this._styleColorTheme.lut={image:Y.data,data:i},d()):x(new Error("Missing LUT image."))}})}getLut(i){const s=this._styleColorThemeForScope[i];return s?s.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(s,d,x){let w,E,O;const B=n.q.devicePixelRatio>1?"@2x":"";let j=n.n(d.transformRequest(d.normalizeSpriteURL(s,B,".json"),n.R.SpriteJSON),(Y,se)=>{j=null,O||(O=Y,w=se,Z())}),H=n.o(d.transformRequest(d.normalizeSpriteURL(s,B,".png"),n.R.SpriteImage),(Y,se)=>{H=null,O||(O=Y,E=se,Z())});function Z(){if(O)x(O);else if(w&&E){const Y=n.q.getImageData(E),se={};for(const pe in w){const{width:ue,height:_e,x:ge,y:Oe,sdf:Ne,pixelRatio:Ue,stretchX:$e,stretchY:Ke,content:Ze}=w[pe],it=new n.r({width:ue,height:_e});n.r.copy(Y,it,{x:ge,y:Oe},{x:0,y:0},{width:ue,height:_e},null),se[pe]={data:it,pixelRatio:Ue,sdf:Ne,stretchX:$e,stretchY:Ke,content:Ze}}x(null,se)}}return{cancel(){j&&(j.cancel(),j=null),H&&(H.cancel(),H=null)}}}(i,this.map._requestManager,(s,d)=>{if(this._spriteRequest=null,s)this.fire(new n.t(s));else if(d)for(const x in d)this.imageManager.addImage(x,this.scope,d[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.x("data",{dataType:"style"}))})}_validateLayer(i){const s=this.getOwnSource(i.source);if(!s)return;const d=i.sourceLayer;d&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(d)===-1)&&this.fire(new n.t(new Error(`Source layer "${d}" does not exist on source "${s.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,s)=>{const d=this.fragments[s];return d&&d.style&&(i.data=d.style.serialize()),i})}_serializeSources(){const i={};for(const s in this._sourceCaches){const d=this._sourceCaches[s].getSource();i[d.id]||(i[d.id]=d.serialize())}return i}_serializeLayers(i){const s=[];for(const d of i){const x=this._layers[d];x&&x.type!=="custom"&&s.push(x.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const s=this.getOwnLayer(i);if(s)return s;this.fire(new n.t(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const s=this.getOwnSource(i);if(s)return s;this.fire(new n.t(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,s){const d=this.map.painter;if(d)for(let x=i.minzoom||0;x<(i.maxzoom||25.5);x++){const w=i.getProgramIds();if(w)for(const E of w){const O=i.getDefaultProgramParams(E,s.zoom,this._styleColorTheme.lut);O&&(d.style=this,this.fog&&(d._fogVisible=!0,O.overrideFog=!0,d.getOrCreateProgram(E,O)),d._fogVisible=!1,O.overrideFog=!1,d.getOrCreateProgram(E,O),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(O.overrideRtt=!0,d.getOrCreateProgram(E,O)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const s=this.calculateLightsBrightness();i.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const d=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const O in E){const{updatedIds:B,removedIds:j}=E[O];(B||j)&&(this._updateWorkerLayers(O,B,j),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const w={};for(const E in this._mergedSourceCaches){const O=this._mergedSourceCaches[E];w[E]=O.used,O.used=!1,O.tileCoverLift=0}for(const E of this._mergedOrder){const O=this._mergedLayers[E];if(O.recalculate(i,this._availableImages),!O.isHidden(i.zoom)){const B=this.getLayerSourceCache(O);B&&(B.used=!0,B.tileCoverLift=Math.max(B.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(O,i)}):this.precompilePrograms(O,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(const E in w){const O=this._mergedSourceCaches[E];w[E]!==O.used&&O.getSource().fire(new n.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new n.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,s,d){const x=this.getFragmentStyle(i);x&&this.dispatcher.broadcast("updateLayers",{layers:s?x._serializeLayers(s):[],scope:i,removedIds:d||[],options:x.options})}setState(i,s){if(this._checkLoaded(),No(this,Lo(i)))return!1;(i=n.cm(i)).layers=Yi(i.layers);const d=function(E,O){if(!E)return[{command:fe.setStyle,args:[O]}];let B=[];try{if(!n.bi(E.version,O.version))return[{command:fe.setStyle,args:[O]}];if(n.bi(E.center,O.center)||B.push({command:fe.setCenter,args:[O.center]}),n.bi(E.zoom,O.zoom)||B.push({command:fe.setZoom,args:[O.zoom]}),n.bi(E.bearing,O.bearing)||B.push({command:fe.setBearing,args:[O.bearing]}),n.bi(E.pitch,O.pitch)||B.push({command:fe.setPitch,args:[O.pitch]}),n.bi(E.sprite,O.sprite)||B.push({command:fe.setSprite,args:[O.sprite]}),n.bi(E.glyphs,O.glyphs)||B.push({command:fe.setGlyphs,args:[O.glyphs]}),n.bi(E.imports,O.imports)||function(se=[],pe=[],ue){pe=pe||[];const _e=(se=se||[]).map(Mi),ge=pe.map(Mi),Oe=se.reduce(Wi,{}),Ne=pe.reduce(Wi,{}),Ue=_e.slice();let $e,Ke,Ze,it;for($e=0,Ke=0;$e<_e.length;$e++)Ze=_e[$e],Ne.hasOwnProperty(Ze)?Ke++:(ue.push({command:fe.removeImport,args:[Ze]}),Ue.splice(Ue.indexOf(Ze,Ke),1));for($e=0,Ke=0;$e<ge.length;$e++)Ze=ge[ge.length-1-$e],Ue[Ue.length-1-$e]!==Ze&&(Oe.hasOwnProperty(Ze)?(ue.push({command:fe.removeImport,args:[Ze]}),Ue.splice(Ue.lastIndexOf(Ze,Ue.length-Ke),1)):Ke++,it=Ue[Ue.length-$e],ue.push({command:fe.addImport,args:[Ne[Ze],it]}),Ue.splice(Ue.length-$e,0,Ze));for(const gt of pe){const Lt=Oe[gt.id];Lt&&!n.bi(Lt,gt)&&ue.push({command:fe.updateImport,args:[gt.id,gt]})}}(E.imports,O.imports,B),n.bi(E.transition,O.transition)||B.push({command:fe.setTransition,args:[O.transition]}),n.bi(E.light,O.light)||B.push({command:fe.setLight,args:[O.light]}),n.bi(E.fog,O.fog)||B.push({command:fe.setFog,args:[O.fog]}),n.bi(E.projection,O.projection)||B.push({command:fe.setProjection,args:[O.projection]}),n.bi(E.lights,O.lights)||B.push({command:fe.setLights,args:[O.lights]}),n.bi(E.camera,O.camera)||B.push({command:fe.setCamera,args:[O.camera]}),!n.bi(E["color-theme"],O["color-theme"]))return[{command:fe.setStyle,args:[O]}];const j={},H=[];(function(se,pe,ue,_e){let ge;for(ge in pe=pe||{},se=se||{})se.hasOwnProperty(ge)&&(pe.hasOwnProperty(ge)||Ee(ge,ue,_e));for(ge in pe){if(!pe.hasOwnProperty(ge))continue;const Oe=pe[ge];se.hasOwnProperty(ge)?n.bi(se[ge],Oe)||(se[ge].type==="geojson"&&Oe.type==="geojson"&&Pe(se,pe,ge)?ue.push({command:fe.setGeoJSONSourceData,args:[ge,Oe.data]}):We(ge,pe,ue,_e)):me(ge,pe,ue)}})(E.sources,O.sources,H,j);const Z=[];E.layers&&E.layers.forEach(se=>{se.source&&j[se.source]?B.push({command:fe.removeLayer,args:[se.id]}):Z.push(se)});let Y=E.terrain;Y&&j[Y.source]&&(B.push({command:fe.setTerrain,args:[void 0]}),Y=void 0),B=B.concat(H),n.bi(Y,O.terrain)||B.push({command:fe.setTerrain,args:[O.terrain]}),function(se,pe,ue){pe=pe||[];const _e=(se=se||[]).map(Mi),ge=pe.map(Mi),Oe=se.reduce(Wi,{}),Ne=pe.reduce(Wi,{}),Ue=_e.slice(),$e=Object.create(null);let Ke,Ze,it,gt,Lt,wt,vt;for(Ke=0,Ze=0;Ke<_e.length;Ke++)it=_e[Ke],Ne.hasOwnProperty(it)?Ze++:(ue.push({command:fe.removeLayer,args:[it]}),Ue.splice(Ue.indexOf(it,Ze),1));for(Ke=0,Ze=0;Ke<ge.length;Ke++)it=ge[ge.length-1-Ke],Ue[Ue.length-1-Ke]!==it&&(Oe.hasOwnProperty(it)?(ue.push({command:fe.removeLayer,args:[it]}),Ue.splice(Ue.lastIndexOf(it,Ue.length-Ze),1)):Ze++,wt=Ue[Ue.length-Ke],ue.push({command:fe.addLayer,args:[Ne[it],wt]}),Ue.splice(Ue.length-Ke,0,it),$e[it]=!0);for(Ke=0;Ke<ge.length;Ke++)if(it=ge[Ke],gt=Oe[it],Lt=Ne[it],!$e[it]&&!n.bi(gt,Lt))if(n.bi(gt.source,Lt.source)&&n.bi(gt["source-layer"],Lt["source-layer"])&&n.bi(gt.type,Lt.type)){for(vt in li(gt.layout,Lt.layout,ue,it,null,fe.setLayoutProperty),li(gt.paint,Lt.paint,ue,it,null,fe.setPaintProperty),n.bi(gt.slot,Lt.slot)||ue.push({command:fe.setSlot,args:[it,Lt.slot]}),n.bi(gt.filter,Lt.filter)||ue.push({command:fe.setFilter,args:[it,Lt.filter]}),n.bi(gt.minzoom,Lt.minzoom)&&n.bi(gt.maxzoom,Lt.maxzoom)||ue.push({command:fe.setLayerZoomRange,args:[it,Lt.minzoom,Lt.maxzoom]}),gt)gt.hasOwnProperty(vt)&&vt!=="layout"&&vt!=="paint"&&vt!=="filter"&&vt!=="metadata"&&vt!=="minzoom"&&vt!=="maxzoom"&&vt!=="slot"&&(vt.indexOf("paint.")===0?li(gt[vt],Lt[vt],ue,it,vt.slice(6),fe.setPaintProperty):n.bi(gt[vt],Lt[vt])||ue.push({command:fe.setLayerProperty,args:[it,vt,Lt[vt]]}));for(vt in Lt)Lt.hasOwnProperty(vt)&&!gt.hasOwnProperty(vt)&&vt!=="layout"&&vt!=="paint"&&vt!=="filter"&&vt!=="metadata"&&vt!=="minzoom"&&vt!=="maxzoom"&&vt!=="slot"&&(vt.indexOf("paint.")===0?li(gt[vt],Lt[vt],ue,it,vt.slice(6),fe.setPaintProperty):n.bi(gt[vt],Lt[vt])||ue.push({command:fe.setLayerProperty,args:[it,vt,Lt[vt]]}))}else ue.push({command:fe.removeLayer,args:[it]}),wt=Ue[Ue.lastIndexOf(it)+1],ue.push({command:fe.addLayer,args:[Lt,wt]})}(Z,O.layers,B)}catch(j){console.warn("Unable to compute style diff:",j),B=[{command:fe.setStyle,args:[O]}]}return B}(this.serialize(),i).filter(E=>!(E.command in Qn));if(d.length===0)return!1;const x=d.filter(E=>!(E.command in os));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);const w=[];return d.forEach(E=>{w.push(this[E.command].apply(this,E.args))}),s&&Promise.all(w).then(s),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,s){return this.getImage(i)?this.fire(new n.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,s),this._afterImageUpdated(i),this)}updateImage(i,s){this.imageManager.updateImage(i,this.scope,s)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new n.t(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,s,d={}){return this._checkLoaded(),this._validate(St,`models.${i}`,s,null,d)||(this.modelManager.addModel(i,s,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new n.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,s,d={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(_s,`sources.${i}`,s,null,d))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const x=ll(i,s,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const w=E=>{const O=(E?"symbol:":"other:")+x.id,B=n.av(O,this.scope),j=this._sourceCaches[O]=new Te(B,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=j,j.onAdd(this.map)};w(!1),s.type!=="vector"&&s.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const s=this.getOwnSource(i);if(!s)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new n.t(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new n.t(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const d=this.getOwnSourceCaches(i);for(const x of d){const w=n.cn(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new n.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,s){this._checkLoaded(),this.getOwnSource(i).setData(s),this._changes.setDirty()}getOwnSource(i){const s=this.getOwnSourceCache(i);return s&&s.getSource()}getOwnSources(){const i=[];for(const s in this._otherSourceCaches){const d=this.getOwnSourceCache(s);d&&i.push(d.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const s in i){const d=i[s]._tiles;for(const x in d){const w=d[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const x of i){if(this._validate(Dr,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(s)}else this.ambientLight=new er(x,Zr||(Zr=new n.a0({color:new n.a1(n._.properties_light_ambient.color),intensity:new n.a1(n._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(s)}else this.directionalLight=new er(x,Gr||(Gr=new n.a0({direction:new n.ad(n._.properties_light_directional.direction),color:new n.a1(n._.properties_light_directional.color),intensity:new n.a1(n._.properties_light_directional.intensity),"cast-shadows":new n.a1(n._.properties_light_directional["cast-shadows"]),"shadow-intensity":new n.a1(n._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=new n.a3(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,s=this.ambientLight;if(!i||!s)return;const d=Y=>.2126*(Y[0]<=.03928?Y[0]/12.92:Math.pow((Y[0]+.055)/1.055,2.4))+.7152*(Y[1]<=.03928?Y[1]/12.92:Math.pow((Y[1]+.055)/1.055,2.4))+.0722*(Y[2]<=.03928?Y[2]/12.92:Math.pow((Y[2]+.055)/1.055,2.4)),x=i.properties.get("color").toRenderColor(null).toArray01(),w=i.properties.get("intensity"),E=i.properties.get("direction"),O=1-n.c8(E.x,E.y,E.z)[2]/90,B=d(x)*w*O,j=s.properties.get("color").toRenderColor(null).toArray01(),H=s.properties.get("intensity"),Z=d(j)*H;return Number(((B+Z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(n.aK(i)){const s=n.co(i),d=this.fragments.find(({id:w})=>w===s);if(!d)throw new Error(`Style import '${i}' not found`);const x=n.cn(i);return d.style.getFragmentStyle(x)}{const s=this.fragments.find(({id:d})=>d===i);if(!s)throw new Error(`Style import '${i}' not found`);return s.style}}getFeaturesetDescriptors(i){const s=this.getFragmentStyle(i);if(!s||!s.stylesheet.featuresets)return[];const d=[];for(const x in s.stylesheet.featuresets)d.push({featuresetId:x,importId:s.scope?s.scope:void 0});return d}getFeaturesetLayers(i,s){const d=this.getFragmentStyle(s),x=d.stylesheet.featuresets;if(!x||!x[i])return this.fire(new n.t(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const E of x[i].selectors){const O=d.getOwnLayer(E.layer);O&&w.push(O)}return w}getConfigProperty(i,s){const d=this.getFragmentStyle(i);if(!d)return null;const x=n.av(s,d.scope),w=d.options.get(x),E=w?w.value||w.default:null;return E?E.serialize():null}setConfigProperty(i,s,d){const x=this.getFragmentStyle(i);if(!x)return;const w=x.stylesheet.schema;if(!w||!w[s])return;const E=n.M(d);if(E.result!=="success")return void No(this,E.value);const O=E.value.expression,B=n.av(s,x.scope),j=x.options.get(B);if(!j)return;let H;const{minValue:Z,maxValue:Y,stepValue:se,type:pe,values:ue}=w[s],_e=n.M(w[s].default);_e.result==="success"&&(H=_e.value.expression),H?(this.options.set(B,{...j,value:O,default:H,minValue:Z,maxValue:Y,stepValue:se,type:pe,values:ue}),this.updateConfigDependencies(s)):this.fire(new n.t(new Error(`No schema defined for the config option "${s}" in the "${i}" fragment.`)))}getConfig(i){const s=this.getFragmentStyle(i);if(!s)return null;const d=s.stylesheet.schema;if(!d)return null;const x={};for(const w in d){const E=n.av(w,s.scope),O=s.options.get(E),B=O?O.value||O.default:null;x[w]=B?B.serialize():null}return x}setConfig(i,s){const d=this.getFragmentStyle(i);d&&(d.updateConfig(s,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const s=this.getFragmentStyle(i);return s?s.stylesheet.schema:null}setSchema(i,s){const d=this.getFragmentStyle(i);d&&(d.stylesheet.schema=s,d.updateConfig(d._config,s),this.updateConfigDependencies())}updateConfig(i,s){if(this._config=i,i||s)if(s)for(const d in s){let x,w;const E=n.M(s[d].default);if(E.result==="success"&&(x=E.value.expression),i&&i[d]!==void 0){const Y=n.M(i[d]);Y.result==="success"&&(w=Y.value.expression)}const{minValue:O,maxValue:B,stepValue:j,type:H,values:Z}=s[d];if(x){const Y=n.av(d,this.scope);this.options.set(Y,{default:x,value:w,minValue:O,maxValue:B,stepValue:j,type:H,values:Z})}else this.fire(new n.t(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new n.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const s of this._configDependentLayers){const d=this.getLayer(s);if(d){if(i&&!d.configDependencies.has(i))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(s=>{if(s._styleColorTheme.colorTheme){const d=s._evaluateColorThemeData(s._styleColorTheme.colorTheme);(!s._styleColorTheme.lut&&d!==""||s._styleColorTheme.lut&&d!==s._styleColorTheme.lut.data)&&s.setColorTheme(s._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,s,d={}){this._checkLoaded();const x=i.id;if(this._layers[x])return void this.fire(new n.t(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(i.type==="custom"){if(No(this,n.cp(i)))return;w=n.cq(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=n.cm(i),i=n.l(i,{source:x})),this._validate(oi,`layers.${x}`,i,{arrayIndex:-1},d))return;w=n.cq(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}})}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let E=this._order.length;if(s){const H=this._order.indexOf(s);if(H===-1)return void this.fire(new n.t(new Error(`Layer with id "${s}" does not exist on this map.`)));w.slot===this._layers[s].slot?E=H:n.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const O=this.getOwnLayerSourceCache(w),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&w.canCastShadows()&&B&&(O.castsShadows=!0);const j=this._changes.getRemovedLayer(w);if(j&&w.source&&O&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const H=n.av(w.source,w.scope);j.type!==w.type?this._changes.updateSourceCache(H,"clear"):(this._changes.updateSourceCache(H,"reload"),O.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(i,s){this._checkLoaded();const d=this._checkLayer(i);if(!d||i===s)return;const x=this._order.indexOf(i);this._order.splice(x,1);let w=this._order.length;if(s){const E=this._order.indexOf(s);if(E===-1)return void this.fire(new n.t(new Error(`Layer with id "${s}" does not exist on this map.`)));d.slot===this._layers[s].slot?w=E:n.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const s=this._checkLayer(i);if(!s)return;s.setEventedParent(null);const d=this._order.indexOf(i);this._order.splice(d,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const x=this.getOwnLayerSourceCache(s);if(x&&x.castsShadows){let w=!1;for(const E in this._layers)if(this._layers[E].source===s.source&&this._layers[E].canCastShadows()){w=!0;break}x.castsShadows=w}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const s in this._layers)if(this._layers[s].type===i)return!0;return!1}setLayerZoomRange(i,s,d){this._checkLoaded();const x=this._checkLayer(i);x&&(x.minzoom===s&&x.maxzoom===d||(s!=null&&(x.minzoom=s),d!=null&&(x.maxzoom=d),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,s){this._checkLoaded();const d=this._checkLayer(i);d&&d.slot!==s&&(d.slot=s,this._updateLayer(d))}setFilter(i,s,d={}){this._checkLoaded();const x=this._checkLayer(i);if(x&&!n.bi(x.filter,s))return s==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(ye,`layers.${x.id}.filter`,s,{layerType:x.type},d)||(x.filter=n.cm(s),this._updateLayer(x)))}getFilter(i){const s=this._checkLayer(i);if(s)return n.cm(s.filter)}setLayoutProperty(i,s,d,x={}){this._checkLoaded();const w=this._checkLayer(i);if(w&&!n.bi(w.getLayoutProperty(s),d)){if(d!=null&&(!x||x.validate!==!1)&&No(w,qe.call(Lo,{key:`layers.${i}.layout.${s}`,layerType:w.type,objectKey:s,value:d,styleSpec:n._,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(s,d),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(i,s){const d=this._checkLayer(i);if(d)return d.getLayoutProperty(s)}setPaintProperty(i,s,d,x={}){this._checkLoaded();const w=this._checkLayer(i);if(!w||n.bi(w.getPaintProperty(s),d)||d!=null&&(!x||x.validate!==!1)&&No(w,ie.call(Lo,{key:`layers.${i}.paint.${s}`,layerType:w.type,objectKey:s,value:d,styleSpec:n._})))return;const E=w.setPaintProperty(s,d);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),E&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(i,s){const d=this._checkLayer(i);if(d)return d.getPaintProperty(s)}setFeatureState(i,s){this._checkLoaded();const d=i.featureset;if(d){if("featuresetId"in d){const j=this.getFragmentStyle(d.importId),H=j.getFeaturesetLayers(d.featuresetId);for(const{source:Z,sourceLayer:Y}of H)j.setFeatureState({id:i.id,source:Z,sourceLayer:Y},s)}else if("layerId"in d){const j=this.getLayer(d.layerId);this.setFeatureState({id:i.id,source:j.source,sourceLayer:j.sourceLayer},s)}return}const x=i.source,w=i.sourceLayer,E=this._checkSource(x);if(!E)return;const O=E.type;if(O==="geojson"&&w)return void this.fire(new n.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(O==="vector"&&!w)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided.")));const B=this.getOwnSourceCaches(x);for(const j of B)j.setFeatureState(w,i.id,s)}removeFeatureState(i,s){this._checkLoaded();const d=i.featureset;if(d){if("featuresetId"in d){const j=this.getFragmentStyle(d.importId),H=j.getFeaturesetLayers(d.featuresetId);for(const{source:Z,sourceLayer:Y}of H)j.removeFeatureState({id:i.id,source:Z,sourceLayer:Y},s)}else if("layerId"in d){const j=this.getLayer(d.layerId);this.removeFeatureState({id:i.id,source:j.source,sourceLayer:j.sourceLayer},s)}return}const x=i.source,w=this._checkSource(x);if(!w)return;const E=w.type,O=E==="vector"?i.sourceLayer:void 0;if(E==="vector"&&!O)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new n.t(new Error("A feature id is required to remove its specific state property.")));const B=this.getOwnSourceCaches(x);for(const j of B)j.removeFeatureState(O,i.id,s)}getFeatureState(i){this._checkLoaded();const s=i.featureset;if(s){let E;if("featuresetId"in s){const O=this.getFragmentStyle(s.importId),B=O.getFeaturesetLayers(s.featuresetId);for(const{source:j,sourceLayer:H}of B){const Z=O.getFeatureState({id:i.id,source:j,sourceLayer:H});if(Z&&!E)E=Z;else if(!n.bi(E,Z))return void this.fire(new n.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i){const O=this.getLayer(s.layerId);E=this.getFeatureState({id:i.id,source:O.source,sourceLayer:O.sourceLayer})}return E}const d=i.source,x=i.sourceLayer,w=this._checkSource(d);if(w){if(w.type!=="vector"||x)return i.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(x,i.id);this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=n.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),s=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return n.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(i){for(const s of Object.values(this._mergedLayers))i(s)&&this._updateLayer(s)}_updateLayer(i){this._changes.updateLayer(i);const s=this.getLayerSourceCache(i),d=n.av(i.source,i.scope),x=this._changes.getUpdatedSourceCaches();i.source&&!x[d]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),s.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const s=O=>this._mergedLayers[O].is3D(),d=this.order,x={},w=[];for(let O=d.length-1;O>=0;O--){const B=d[O];if(s(B)){x[B]=O;for(const j of i){const H=j[B];if(H)for(const Z of H)w.push(Z)}}}w.sort((O,B)=>B.intersectionZ-O.intersectionZ);const E=[];for(let O=d.length-1;O>=0;O--){const B=d[O];if(s(B))for(let j=w.length-1;j>=0;j--){const H=w[j].feature;if(H.layer&&x[H.layer.id]<O)break;E.push(H),w.pop()}else for(const j of i){const H=j[B];if(H)for(const Z of H)E.push(Z.feature)}}return E}queryRenderedFeatures(i,s,d){s&&!Array.isArray(s)&&s.filter&&this._validate(ye,"queryRenderedFeatures.filter",s.filter,null,s);let x,w=!1;const E=new Set;if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new n.t(new Error("parameters.layers must be an Array."))),[];x=[];for(const H of s.layers){const Z=this._mergedLayers[H];if(!Z)return this.fire(new n.t(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];Z.is3D()&&(w=!0),E.add(Z.source),x.push(H)}}else w=this.has3DLayers();const O=this._queryRenderedFeatures(i,d,{layerIds:x,filter:s.filter,has3DLayers:w,includedSources:E}),B=this._flattenAndSortRenderedFeatures(O),j=[];for(const H of B)n.co(H.layer.id)===this.scope&&j.push(H);return j}queryRenderedFeaturesForInteractions(i,s,d){let x=[];for(const{featureset:B,filter:j,radius:H}of s){let Z=!1;const Y=[],se=new Set;if("featuresetId"in B){const ue=this.getFeaturesetLayers(B.featuresetId,B.importId);if(ue.length===0)continue;for(const _e of ue)_e.is3D()&&(Z=!0),se.add(_e.source),Y.push(_e.fqid)}else if("layerId"in B){const ue=this._mergedLayers[B.layerId];if(!ue)return this.fire(new n.t(new Error(`The layer '${B.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];ue.is3D()&&(Z=!0),se.add(ue.source),Y.push(B.layerId)}let pe=i;if(H)if(i instanceof n.P||typeof i[0]=="number"){const ue=n.P.convert(i);pe=[[ue.x-H,ue.y-H],[ue.x+H,ue.y+H]]}else{const ue=n.P.convert(i[0]),_e=n.P.convert(i[1]);pe=[[ue.x-H,ue.y-H],[_e.x+H,_e.y+H]]}x=x.concat(this._queryRenderedFeatures(pe,d,{layerIds:Y,filter:j,has3DLayers:Z,includedSources:se}))}const w=this._flattenAndSortRenderedFeatures(x),E=(B,j,H)=>{const Z=B.clone();if(delete Z.layer,Z.featureset=j,H&&H.featureNamespace&&(Z.namespace=H.featureNamespace),H&&H.properties){const Y={},se=this.map.transform.zoom;for(const pe of Object.keys(H.properties)){const ue=H.properties[pe].evaluate({zoom:se},B._vectorTileFeature,B.state,B.tile,this._availableImages);ue!=null&&(Y[pe]=ue)}Z.properties=Y}return Z},O=[];for(const B of w){const j=B.layer.id,H=n.cn(j),Z=n.co(j);for(const{featureset:Y}of s){if("layerId"in Y&&Y.layerId!==j)continue;if("layerId"in Y&&Y.layerId===j){const pe=E(B,Y);O.push(pe);continue}if("featuresetId"in Y&&(Y.importId!==Z||!this.getFeaturesetLayers(Y.featuresetId,Y.importId).map(pe=>pe.id).includes(H)))continue;const se=this._mergedLayerSelectors.get(j)||[];for(const pe of se){const ue=E(B,Y,pe);O.push(ue)}}}return O}_queryRenderedFeatures(i,s,d){const{layerIds:x,filter:w,has3DLayers:E,includedSources:O}=d,B=[],j=yr.createFromScreenPoints(i,s);for(const H in this._mergedSourceCaches){if(!this._mergedSourceCaches[H].getSource())continue;const Z=this._mergedSourceCaches[H].getSource().id;x&&!O.has(Z)||B.push(nr(this._mergedSourceCaches[H],this._mergedLayers,j,w,x||[],this._availableImages,s,E,!!this.map._showQueryGeometry))}return this.placement&&B.push(function(H,Z,Y,se,pe,ue,_e,ge){const Oe={},Ne=_e.queryRenderedSymbols(Y),Ue=[];for(const $e of Object.keys(Ne).map(Number))Ue.push(ge[$e]);Ue.sort(fo);for(const $e of Ue){const Ke=$e.featureIndex.lookupSymbolFeatures(Ne[$e.bucketInstanceId],$e.bucketIndex,$e.sourceLayerIndex,se,pe,ue,H);for(const Ze in Ke){const it=Oe[Ze]=Oe[Ze]||[],gt=Ke[Ze];gt.sort((Lt,wt)=>{const vt=$e.featureSortOrder;if(vt){const ri=vt.indexOf(Lt.featureIndex);return vt.indexOf(wt.featureIndex)-ri}return wt.featureIndex-Lt.featureIndex});for(const Lt of gt)it.push(Lt)}}for(const $e in Oe)Oe[$e].forEach(Ke=>{const Ze=Ke.feature,it=H[$e],gt=Z(it);if(!gt)return;const Lt=gt.getFeatureState(Ze.layer["source-layer"],Ze.id);Ze.state=Lt,n.aK(it.id)||(Ze.source=Ze.layer.source,Ze.layer["source-layer"]&&(Ze.sourceLayer=Ze.layer["source-layer"]))});return Oe}(this._mergedLayers,this.getLayerSourceCache.bind(this),j.screenGeometry,w,x||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),B}querySourceFeatures(i,s){const d=s&&s.filter;d&&this._validate(ye,"querySourceFeatures.filter",d,null,s);let x=[];const w=this.getOwnSourceCaches(i);for(const E of w)x=x.concat(Go(E,s));return x}addSourceType(i,s,d){return Na.getSourceType(i)?d(new Error(`A source type called "${i}" already exists.`)):(Na.setSourceType(i,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:s.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,s,d={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const O in i)if(!n.bi(i[O],x[O])){w=!0;break}if(!w)return;const E=this._getTransitionParameters();this.light.setLight(i,s,d),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,s=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=i;const x=i.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const O="terrain-dem-src";this.addSource(O,d.source),d=n.cm(d),d=n.l(d,{source:O})}const w=n.l({},d),E={};if(this.terrain&&x){w.source=this.terrain.get().source;const O=this.terrain?this.getFragmentStyle(this.terrain.scope):null;O&&(E.style=O.serialize())}if(this._validate(no,"terrain",w,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&s!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,s),this.fire(new n.x("data",{dataType:"style"}))}else{const w=this.terrain,E=w.get();for(const O of Object.keys(n._.terrain))!d.hasOwnProperty(O)&&n._.terrain[O].default&&(d[O]=n._.terrain[O].default);for(const O in i)if(!n.bi(i[O],E[O])){w.set(i,this.options),this.stylesheet.terrain=i;const B=this._getTransitionParameters({duration:0});w.updateTransitions(B),this.fire(new n.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const s=this.fog=new ar(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!n.bi(s.get(),i)){s.set(i,this.options),this.stylesheet.fog=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();const s=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void s();const d=this._evaluateColorThemeData(i);this._loadColorTheme(d).then(()=>{this.fire(new n.x("colorthemeset")),s()}).catch(x=>{n.w(`Couldn't set color theme: ${x}`)})}_getTransitionParameters(i){return{now:n.q.now(),transition:n.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],s=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?i.push(d):s.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...s)}_createTerrain(i,s){const d=this.terrain=new ai(i,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});d.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const s=this._layers[i];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const s=this._layers[i];s.type==="symbol"&&this._updateLayer(s)}}_validate(i,s,d,x,w={}){if(w&&w.validate===!1)return!1;const E=n.l({},this.serialize());return No(this,i.call(Lo,n.l({key:s,style:E,value:d,styleSpec:n._},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const s=this.getSourceCaches(i);for(const d of s)d.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const s=this.getSourceCaches(i);for(const d of s)d.resume(),d.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let s;this.directionalLight&&(s=Xl(this.directionalLight));for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(i,void 0,void 0,s)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const s=this._sourceCaches[i];s.resume(),s.reload()}}_updatePlacement(i,s,d,x,w,E,O=!1){let B=!1,j=!1;const H={},Z={};for(const Y of this._mergedOrder){const se=this._mergedLayers[Y];if(se.type!=="symbol")continue;const pe=n.av(se.source,se.scope);let ue=H[pe];if(!ue){const ge=this.getLayerSourceCache(se);if(!ge)continue;const Oe=ge.getRenderableIds(!0).map(Ne=>ge.getTileByID(Ne));Z[pe]=Oe.slice(),ue=H[pe]=Oe.sort((Ne,Ue)=>Ue.tileID.overscaledZ-Ne.tileID.overscaledZ||(Ne.tileID.isLessThan(Ue.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(se,ue,s.center.lng,s.projection);B=B||_e}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),O=O||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new n.x("neworder")),(O||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),s.zoom))&&(this.pauseablePlacement=new Ka(s,this._mergedOrder,O,d,x,w,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,H,Z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),j=!0),B&&this.pauseablePlacement.placement.setStale()),j||B){this._buildingIndex.onNewFrame(s.zoom);for(let Y=0;Y<this._mergedOrder.length;Y++){const se=this._mergedLayers[this._mergedOrder[Y]];if(se.type!=="symbol")continue;const pe=this.isLayerClipped(se);this.placement.updateLayerOpacities(se,H[n.av(se.source,se.scope)],Y,pe?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,s){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:w})=>w===i.id)!==-1)return void this.fire(new n.t(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!s)return d.push(i),this._loadImports([i],!0);const x=d.findIndex(({id:w})=>w===s);return x===-1&&this.fire(new n.t(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,x).concat(i).concat(d.slice(x)),this._loadImports([i],!0,s)}updateImport(i,s){this._checkLoaded();const d=this.stylesheet.imports||[],x=this.getImportIndex(i);return x===-1?this:typeof s=="string"?(this.setImportUrl(i,s),this):(s.url&&s.url!==d[x].url&&this.setImportUrl(i,s.url),n.bi(s.config,d[x].config)||this.setImportConfig(i,s.config),n.bi(s.data,d[x].data)||this.setImportData(i,s.data),this)}moveImport(i,s){this._checkLoaded();let d=this.stylesheet.imports||[];const x=this.getImportIndex(i);if(x===-1)return this;const w=this.getImportIndex(s);if(w===-1)return this;const E=d[x],O=this.fragments[x];return d=d.filter(({id:B})=>B!==i),this.fragments=this.fragments.filter(({id:B})=>B!==i),this.stylesheet.imports=d.slice(0,w).concat(E).concat(d.slice(w)),this.fragments=this.fragments.slice(0,w).concat(O).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(i,s){this._checkLoaded();const d=this.stylesheet.imports||[],x=this.getImportIndex(i);if(x===-1)return this;d[x].url=s;const w=this.fragments[x];return w.style=this._createFragmentStyle(d[x]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(s),this}setImportData(i,s){this._checkLoaded();const d=this.getImportIndex(i),x=this.stylesheet.imports||[];return d===-1?this:s?(this.fragments[d].style.setState(s),this._reloadImports(),this):(delete x[d].data,this.setImportUrl(i,x[d].url))}setImportConfig(i,s){this._checkLoaded();const d=this.getImportIndex(i),x=this.stylesheet.imports||[];if(d===-1)return this;s?x[d].config=s:delete x[d].config;const w=this.fragments[d],E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=s,w.style.updateConfig(s,E),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const s=this.stylesheet.imports||[],d=this.getImportIndex(i);d!==-1&&(s.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(i){const s=(this.stylesheet.imports||[]).findIndex(d=>d.id===i);return s===-1&&this.fire(new n.t(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),s}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const s in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[s];d&&i.push(d.getSource())}return i}getSource(i,s){const d=this.getSourceCache(i,s);return d&&d.getSource()}getLayerSource(i){const s=this.getLayerSourceCache(i);return s&&s.getSource()}getSourceCache(i,s){const d=n.av(i,s);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(i){const s=n.av(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[i]&&s.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&s.push(this._mergedSymbolSourceCaches[i]),s}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const s in i){const d=i[s];d==="reload"?this.reloadSource(s):d==="clear"&&this.clearSource(s)}}updateLayers(i){const s=this._changes.getUpdatedPaintProperties();for(const d of s){const x=this.getLayer(d);x&&x.updateTransitions(i)}}getImages(i,s,d){this.imageManager.getImages(s.icons,s.scope,d),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(s.tileID.key,s.type,s.icons)};x(this._otherSourceCaches[s.source]),x(this._symbolSourceCaches[s.source])}getGlyphs(i,s,d){this.glyphManager.getGlyphs(s.stacks,s.scope,d)}getResource(i,s,d){return n.ct(s,d)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const s=[];return this._otherSourceCaches[i]&&s.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&s.push(this._symbolSourceCaches[i]),s}_isSourceCacheLoaded(i){const s=this.getOwnSourceCaches(i);return s.length===0?(this.fire(new n.t(new Error(`There is no source with ID '${i}'`))),!1):s.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,s){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const d=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(d||s&&s.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Na.getSourceType=function(h){return ka[h]},Na.setSourceType=function(h,i){ka[h]=i},Na.registerForPluginStateChange=n.cd;var lm=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,jp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Wp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Id="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,ru=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,_l=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,qp=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Rd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Bh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Aa=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Hu=[];Ca(lm,Hu),Ca(Wp,Hu),Ca(jp,Hu);const Yl={"_prelude_fog.vertex.glsl":ru,"_prelude_terrain.vertex.glsl":Gu,"_prelude_shadow.vertex.glsl":Bh,"_prelude_fog.fragment.glsl":_l,"_prelude_shadow.fragment.glsl":Aa,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":qp,"_prelude_raster_particle.glsl":Rd},su={};zr("",Gu),zr(_l,ru),zr(Aa,Bh),zr(qp,""),zr(Rd,"");const Ec=zr(jp,Wp),Nh=lm;var Fl={background:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:zr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:zr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:zr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:zr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:zr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:zr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:zr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:zr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:zr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:zr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:zr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:zr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:zr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:zr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:zr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Id),skyboxGradient:zr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Id),skyboxCapture:zr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:zr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:zr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:zr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:zr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:zr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),occlusion:zr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ca(h,i){const s=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of s)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=d.split(" ");for(const w of x)i.includes(w)||i.push(w)}}function zr(h,i){const s=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(j=>{const H=j.split(" ");return H[H.length-1]}),x=[...new Set(x)]);const w={},E=[],O=[];if(h=h.replace(s,(j,H)=>(O.push(H),"")),(i=i.replace(s,(j,H)=>(E.push(H),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let B=[...Hu];Ca(h,B),Ca(i,B);for(const j of[...E,...O])Yl[j]||console.error(`Undefined include: ${j}`),su[j]||(su[j]=[],Ca(Yl[j],su[j])),B=[...B,...su[j]];return{fragmentSource:h=h.replace(d,(j,H,Z,Y,se)=>(w[se]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
in ${Z} ${Y} ${se};
#else
uniform ${Z} ${Y} u_${se};
#endif
`:H==="initialize"?`
#ifdef HAS_UNIFORM_u_${se}
    ${Z} ${Y} ${se} = u_${se};
#endif
`:H==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${se}
    in ${Z} ${Y} ${se};
#endif
`:H==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(d,(j,H,Z,Y,se)=>{const pe=Y==="float"?"vec2":Y,ue=se.match(/color/)?"color":pe;return H==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${se}
in ${Z} ${Y} a_${se};
#endif
`:w[se]?H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
uniform lowp float u_${se}_t;
in ${Z} ${pe} a_${se};
out ${Z} ${Y} ${se};
#else
uniform ${Z} ${Y} u_${se};
#endif
`:H==="initialize"?ue==="vec4"?`
#ifndef HAS_UNIFORM_u_${se}
    ${se} = a_${se};
#else
    ${Z} ${Y} ${se} = u_${se};
#endif
`:`
#ifndef HAS_UNIFORM_u_${se}
    ${se} = unpack_mix_${ue}(a_${se}, u_${se}_t);
#else
    ${Z} ${Y} ${se} = u_${se};
#endif
`:H==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${se}
    in ${Z} ${Y} a_${se};
    out ${Z} ${Y} ${se};
#endif
`:H==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${se}
    ${se} = a_${se};
#endif
`:void 0:H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
uniform lowp float u_${se}_t;
in ${Z} ${pe} a_${se};
#else
uniform ${Z} ${Y} u_${se};
#endif
`:H==="define-instanced"?ue==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${se}0;
in vec4 a_${se}1;
in vec4 a_${se}2;
in vec4 a_${se}3;
#else
uniform ${Z} ${Y} u_${se};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Z} ${pe} a_${se};
#else
uniform ${Z} ${Y} u_${se};
#endif
`:H==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${se}
    ${Z} ${Y} ${se} = a_${se};
#endif
`:ue==="vec4"?`
#ifndef HAS_UNIFORM_u_${se}
    ${Z} ${Y} ${se} = a_${se};
#else
    ${Z} ${Y} ${se} = u_${se};
#endif
`:`
#ifndef HAS_UNIFORM_u_${se}
    ${Z} ${Y} ${se} = unpack_mix_${ue}(a_${se}, u_${se}_t);
#else
    ${Z} ${Y} ${se} = u_${se};
#endif
`}),staticAttributes:x,usedDefines:B,vertexIncludes:E,fragmentIncludes:O}}class ou{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,s,d,x,w,E,O,B){this.context=i;let j=this.boundPaintVertexBuffers.length!==x.length;for(let Z=0;!j&&Z<x.length;Z++)this.boundPaintVertexBuffers[Z]!==x[Z]&&(j=!0);let H=this.boundDynamicVertexBuffers.length!==O.length;for(let Z=0;!H&&Z<O.length;Z++)this.boundDynamicVertexBuffers[Z]!==O[Z]&&(H=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==d||j||H||this.boundIndexBuffer!==w||this.boundVertexOffset!==E)this.freshBind(s,d,x,w,E,O,B);else{i.bindVertexArrayOES.set(this.vao);for(const Z of O)Z&&(Z.bind(),B&&Z.instanceCount&&Z.setVertexAttribDivisor(i.gl,s,B));w&&w.dynamicDraw&&w.bind()}}freshBind(i,s,d,x,w,E,O){const B=i.numAttributes,j=this.context,H=j.gl;this.vao&&this.destroy(),this.vao=j.gl.createVertexArray(),j.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=E,s.enableAttributes(H,i),s.bind(),s.setVertexAttribPointers(H,i,w);for(const Z of d)Z.enableAttributes(H,i),Z.bind(),Z.setVertexAttribPointers(H,i,w);for(const Z of E)Z&&(Z.enableAttributes(H,i),Z.bind(),Z.setVertexAttribPointers(H,i,w),O&&Z.instanceCount&&Z.setVertexAttribDivisor(H,i,O));x&&x.bind(),j.currentNumAttributes=B}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ju(h,i){const s=Math.pow(2,i.canonical.z),d=i.canonical.y;return[new n.a5(0,d/s).toLngLat().lat,new n.a5(0,(d+1)/s).toLngLat().lat]}function Pd(h,i,s,d,x,w,E){const O=h.context,B=O.gl,j=s.hillshadeFBO;if(!j)return;h.prepareDrawTile();const H=h.isTileAffectedByFog(i),Z=h.getOrCreateProgram("hillshade",{overrideFog:H});O.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,j.colorAttachment.get());const Y=((_e,ge,Oe,Ne)=>{const Ue=Oe.paint.get("hillshade-shadow-color"),$e=Oe.paint.get("hillshade-highlight-color"),Ke=Oe.paint.get("hillshade-accent-color"),Ze=Oe.paint.get("hillshade-emissive-strength");let it=n.bC(Oe.paint.get("hillshade-illumination-direction"));if(Oe.paint.get("hillshade-illumination-anchor")==="viewport")it-=_e.transform.angle;else if(_e.style&&_e.style.enable3dLights()&&_e.style.directionalLight){const Lt=_e.style.directionalLight.properties.get("direction"),wt=n.c8(Lt.x,Lt.y,Lt.z);it=n.bC(wt[1])}const gt=!_e.options.moving;return{u_matrix:Ne||_e.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),gt),u_image:0,u_latrange:ju(0,ge.tileID),u_light:[Oe.paint.get("hillshade-exaggeration"),it],u_shadow:Ue.toRenderColor(Oe.lut),u_highlight:$e.toRenderColor(Oe.lut),u_emissive_strength:Ze,u_accent:Ke.toRenderColor(Oe.lut)}})(h,s,d,h.terrain?i.projMatrix:null);h.uploadCommonUniforms(O,Z,i.toUnwrapped());const{tileBoundsBuffer:se,tileBoundsIndexBuffer:pe,tileBoundsSegments:ue}=h.getTileBoundsBuffers(s);Z.draw(h,B.TRIANGLES,x,w,E,qn.disabled,Y,d.id,se,pe,ue)}function Uh(h,i,s){if(!i.needsDEMTextureUpload)return;const d=h.context,x=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||h.getTileTexture(s.stride);const w=s.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new n.T(d,w,x.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function au(h,i,s){const d=h.context,x=d.gl;if(!i.dem)return;const w=i.dem;if(d.activeTexture.set(x.TEXTURE1),Uh(h,i,w),!i.demTexture)return;i.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=w.dim;d.activeTexture.set(x.TEXTURE0);let O=i.hillshadeFBO;if(!O){const Y=new n.T(d,{width:E,height:E,data:null},x.RGBA8);Y.bind(x.LINEAR,x.CLAMP_TO_EDGE),O=i.hillshadeFBO=d.createFramebuffer(E,E,!0,"renderbuffer"),O.colorAttachment.set(Y.texture)}d.bindFramebuffer.set(O.framebuffer),d.viewport.set([0,0,E,E]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:j,tileBoundsSegments:H}=h.getMercatorTileBoundsBuffers(),Z=[];h.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:Z}).draw(h,x.TRIANGLES,Xn.disabled,hr.disabled,Ir.unblended,qn.disabled,((Y,se)=>{const pe=se.stride,ue=n.a6.mat4.create();return n.a6.mat4.ortho(ue,0,n.ab,-n.ab,0,0,1),n.a6.mat4.translate(ue,ue,[0,-n.ab,0]),{u_matrix:ue,u_image:1,u_dimension:[pe,pe],u_zoom:Y.overscaledZ}})(i.tileID,w),s.id,B,j,H),i.needsHillshadePrepare=!1}class ys{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Dd extends ys{getDefault(){return n.bA.transparent}set(i){const s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class $p extends ys{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Vh extends ys{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Wu extends ys{getDefault(){return[!0,!0,!0,!0]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Gh extends ys{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class cm extends ys{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class um extends ys{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const s=this.current;(i.func!==s.func||i.ref!==s.ref||i.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class hm extends ys{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class qu extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=i,this.dirty=!1}}class dm extends ys{getDefault(){return[0,1]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Rg extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=i,this.dirty=!1}}class Pg extends ys{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Dg extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.BLEND):s.disable(s.BLEND),this.current=i,this.dirty=!1}}class Hh extends ys{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class jh extends ys{getDefault(){return n.bA.transparent}set(i){const s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Od extends ys{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class Zp extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=i,this.dirty=!1}}class pm extends ys{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Xp extends ys{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let fm=class extends ys{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class $u extends ys{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Zu extends ys{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Yp extends ys{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class La extends ys{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ac extends ys{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class qo extends ys{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Uo extends ys{getDefault(){return null}set(i){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class zd extends ys{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class Kp extends ys{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class kd extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Jp extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Wh extends ys{constructor(i,s){super(i),this.context=i,this.parent=s}getDefault(){return null}}class Fd extends Wh{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Qp extends Wh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class mm extends Wh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Xu extends Qp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Og=(h,i,s)=>({u_matrix:h,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:s}),gm=(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:s,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:E,u_frustum_tr:O,u_frustum_br:B,u_frustum_bl:j,u_globe_pos:H,u_globe_radius:Z,u_viewport:Y,u_grid_matrix:ue?Float32Array.from(ue):new Float32Array(9),u_skirt_height:se,u_far_z_cutoff:pe});function _m(h,i){return h!=null&&i!=null&&!(!h.hasData()||!i.hasData())&&h.demTexture!=null&&i.demTexture!=null&&h.tileID.key!==i.tileID.key}const Yu=new class{constructor(){this.operations={}}newMorphing(h,i,s,d,x){if(h in this.operations){const w=this.operations[h];w.to.tileID.key!==s.tileID.key&&(w.queued=s)}else this.operations[h]={startTime:d,phase:0,duration:x,from:i,to:s,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const i=this.operations[h];return{from:i.from,to:i.to,phase:i.phase}}update(h){for(const i in this.operations){const s=this.operations[i];for(s.phase=(h-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,h)){delete this.operations[i];break}}}_nextOp(h,i){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=i,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},ym={0:null,1:"TERRAIN_VERTEX_MORPHING"};function vm(h,i,s){if(i===0)return 0;const d=i<1&&s===514?.25/i:1;return 6*Math.pow(1.5,22-h)*Math.max(i,1)*d}function ef(h,i){const s=1<<h.z;return!i&&(h.x===0||h.x===s-1)||h.y===0||h.y===s-1}const qh=h=>({u_matrix:h});function Bd(h,i,s,d,x){if(x>0){const w=n.q.now(),E=(w-h.timeAdded)/x,O=i?(w-i.timeAdded)/x:-1,B=s.getSource(),j=d.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),H=!i||Math.abs(i.tileID.overscaledZ-j)>Math.abs(h.tileID.overscaledZ-j),Z=H&&h.refreshedUponExpiration?1:n.ap(H?E:1-O,0,1);return h.refreshedUponExpiration&&E>=1&&(h.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class Ku extends Te{constructor(i){const s={type:"raster-dem",maxzoom:i.transform.maxZoom},d=new n.ce(n.cf(),null),x=ll("mock-dem",s,d,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,s){i.state="loaded",s(null)}}class xm extends Te{constructor(i){const s=ll("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new n.ce(n.cf(),null),i.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,s,d){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,E)=>{if(w[E.key]="",!this._tiles[E.key]){const O=new Us(E,this._source.tileSize*E.overscaleFactor(),i.tileZoom);O.state="loaded",this._tiles[E.key]=O}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const s=this.proxyCachedFBO[i];if(s!==void 0){const d=Object.values(s);this.renderCachePool.push(...d),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class tf extends n.aA{constructor(i,s,d){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=s,this.projMatrix=d}}class nf extends n.cE{constructor(i,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,x,w]=function(B){const j=new n.a$,H=new n.aP,Z=131;j.reserve(17161),H.reserve(33800);const Y=n.ab/128,se=n.ab+Y/2,pe=se+Y;for(let _e=-Y;_e<pe;_e+=Y)for(let ge=-Y;ge<pe;ge+=Y){const Oe=ge<0||ge>se||_e<0||_e>se?24575:0,Ne=n.ap(Math.round(ge),0,n.ab),Ue=n.ap(Math.round(_e),0,n.ab);j.emplaceBack(Ne+Oe,Ue)}const ue=(_e,ge)=>{const Oe=ge*Z+_e;H.emplaceBack(Oe+1,Oe,Oe+Z),H.emplaceBack(Oe+Z,Oe+Z+1,Oe+1)};for(let _e=1;_e<129;_e++)for(let ge=1;ge<129;ge++)ue(ge,_e);return[0,129].forEach(_e=>{for(let ge=0;ge<130;ge++)ue(ge,_e),ue(_e,ge)}),[j,H,32768]}(),E=i.context;this.gridBuffer=E.createVertexBuffer(d,n.b1.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=n.b2.simpleSegment(0,0,d.length,x.length),this.gridNoSkirtSegments=n.b2.simpleSegment(0,0,d.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new xm(s.map),this.orthoMatrix=n.a6.mat4.create(),n.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ab,0,n.ab,0,1);const O=E.gl;this._overlapStencilMode=new hr({func:O.GEQUAL,mask:255},0,255,O.KEEP,O.KEEP,O.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ku(s.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,s,d){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const x=i.terrain.properties,w=i.terrain.drapeRenderMode===0,E=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();const O=i.terrain&&i.terrain.scope,B=x.get("source"),j=w?this._mockSourceCache:i.getSourceCache(B,O);if(!j)return void n.w(`Couldn't find terrain source "${B}".`);if(this.sourceCache=j,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(s):x.get("exaggeration"),!s.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const H=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Z=this.getScaledDemTileSize();this.sourceCache.update(s,Z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,H(),this._initializing=!0),H(),s.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const s=this._previousCameraAltitude,d=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=d;const x=s!=null?d-s:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=i.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(w);let O=w-this._previousZoom;const B=this._previousUpdateTimestamp;let j=w;this._evaluationZoom!=null&&(j=this._evaluationZoom,Math.abs(w-j)>.5&&(O=.5*(w-j+O)),O*x<0&&(j+=O)),this._evaluationZoom=j;const H=E.getExaggeration(j),Z=H===E.getExaggeration(Math.max(0,j-.1));if(Z&&Math.abs(H-this._exaggeration)<.01)return H;let Y=Math.min(.1,.00375*(this._updateTimestamp-B));return(Z||H<.1||Math.abs(O)<1e-4)&&(Y=Math.min(.2,4*Y)),n.aa(this._exaggeration,H,Y)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(n.a5.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=s.getIds().map(B=>{const j=s.getTileByID(B).tileID;return j.projMatrix=d.calculateProjMatrix(j.toUnwrapped()),j});(function(B,j){const H=j.transform.pointCoordinate(j.transform.getCameraPoint()),Z=new n.P(H.x,H.y);B.sort((Y,se)=>{if(se.overscaledZ-Y.overscaledZ)return se.overscaledZ-Y.overscaledZ;const pe=new n.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ue=new n.P(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),_e=Z.mult(1<<Y.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(pe)-_e.distSqr(ue)})})(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const B in E){const j=E[B];if(!j.used||(j!==this.sourceCache&&this.resetTileLookupCache(j.id),this._setupProxiedCoordsForOrtho(j,i[B],w),j.usedForTerrain))continue;const H=i[B];j.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[s.id]=x.map(B=>new tf(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const O={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const j=this.terrainTileForTile[B.key];if(!j)continue;const H=j.tileID.key;H in O||(this._visibleDemTiles.push(j),O[H]=H)}}_assignTerrainTiles(i){this._initializing||i.forEach(s=>{if(this.terrainTileForTile[s.key])return;const d=this._findTileCoveringTileID(s,this.sourceCache);d&&(this.terrainTileForTile[s.key]=d)})}_prepareDEMTextures(){const i=this.painter.context,s=i.gl;for(const d in this.terrainTileForTile){const x=this.terrainTileForTile[d],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(s.TEXTURE1),Uh(this.painter,x,w))}}_prepareDemTileUniforms(i,s,d,x){if(!s||s.demTexture==null)return!1;const w=i.tileID.canonical,E=Math.pow(2,s.tileID.canonical.z-w.z),O=x||"";return d[`u_dem_tl${O}`]=[w.x*E%1,w.y*E%1],d[`u_dem_scale${O}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const s=this._visibleDemTiles.reduce((d,x)=>{if(!x.dem)return d;const w=x.dem.tree.minimums[0];return w>0&&i++,d+w},0);return i?s/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,s=i.gl;i.activeTexture.set(s.TEXTURE2);const d=this._getLoadedAreaMinimum(),x=new n.cF({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new n.T(i,x,s.R32F,{premultiply:!1}),w}setupElevationDraw(i,s,d){const x=this.painter.context,w=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let O=null,B=null,j=1;if(d&&d.morphing&&this._useVertexMorphing){const se=d.morphing.srcDemTile,pe=d.morphing.dstDemTile;j=d.morphing.phase,se&&pe&&(this._prepareDemTileUniforms(i,se,E,"_prev")&&(B=se),this._prepareDemTileUniforms(i,pe,E)&&(O=pe))}const H=se=>se&&se.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let Z=null;var Y;if(this.enabled?B&&O?(Z=O.demTexture,x.activeTexture.set(w.TEXTURE4),B.demTexture.bind(H(B),w.CLAMP_TO_EDGE),E.u_dem_lerp=j):(O=this.terrainTileForTile[i.tileID.key],Z=this._prepareDemTileUniforms(i,O,E)?O.demTexture:this.emptyDEMTexture):Z=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),Z&&(E.u_dem_size=(Y=Z).size[0]===1?1:Y.size[0]-2,Z.bind(H(O),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,s,E),d&&d.useMeterToDem&&O){const se=(1<<O.tileID.canonical.z)*n.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=se}if(d&&d.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),s.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const se=this.globeUniformValues(this.painter.transform,i.tileID.canonical,d&&d.useDenormalizedUpVectorScale);s.setGlobeUniformValues(x,se)}}globeUniformValues(i,s,d){const x=i.projection;return{u_tile_tl_up:x.upVector(s,0,0),u_tile_tr_up:x.upVector(s,n.ab,0),u_tile_br_up:x.upVector(s,n.ab,n.ab),u_tile_bl_up:x.upVector(s,0,n.ab),u_tile_up_scale:d?n.cG(1):x.upVectorScale(s,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const s=this.painter,d=this.painter.context;i.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,E,O,B){if(x.transform.projection.name==="globe")(function(j,H,Z,Y,se){const pe=j.context,ue=pe.gl;let _e,ge;const Oe=j.transform,Ne=n.cx(j,pe,Oe),Ue=(ri,hi)=>{if(ge===hi)return;const Si=[ym[hi],"PROJECTION_GLOBE_VIEW"];Ne&&Si.push("CUSTOM_ANTIALIASING");const Gi=j.isTileAffectedByFog(ri);_e=j.getOrCreateProgram("globeRaster",{defines:Si,overrideFog:Gi}),ge=hi},$e=j.colorModeForRenderPass(),Ke=new Xn(ue.LEQUAL,Xn.ReadWrite,j.depthRangeFor3D);Yu.update(se);const Ze=n.cy(Oe),it=[n.am(Oe.center.lng),n.at(Oe.center.lat)],gt=j.globeSharedBuffers,Lt=[Oe.width*n.q.devicePixelRatio,Oe.height*n.q.devicePixelRatio],wt=Float32Array.from(Oe.globeMatrix),vt={useDenormalizedUpVectorScale:!0};{const ri=j.transform,hi=vm(ri.zoom,H.exaggeration(),H.sourceCache._source.tileSize);ge=-1;const Si=ue.TRIANGLES;for(const Gi of Y){const Ki=Z.getTile(Gi),Wt=hr.disabled,wi=H.prevTerrainTileForTile[Gi.key],ui=H.terrainTileForTile[Gi.key];_m(wi,ui)&&Yu.newMorphing(Gi.key,wi,ui,se,250),pe.activeTexture.set(ue.TEXTURE0),Ki.texture&&Ki.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Ti=Yu.getMorphValuesForProxy(Gi.key),Ci=Ti?1:0;Ti&&n.C(vt,{morphing:{srcDemTile:Ti.from,dstDemTile:Ti.to,phase:n.cw(Ti.phase)}});const mi=n.cz(Gi.canonical),Xi=n.cA(mi.getCenter().lat),zn=n.cB(Gi.canonical,mi,Xi,ri.worldSize/ri._pixelsPerMercatorPixel),$n=n.b6(n.cC(Gi.canonical)),An=gm(ri.expandedFarZProjMatrix,wt,Ze,$n,n.a9(ri.zoom),it,ri.frustumCorners.TL,ri.frustumCorners.TR,ri.frustumCorners.BR,ri.frustumCorners.BL,ri.globeCenterInViewSpace,ri.globeRadius,Lt,hi,ri._farZ,zn);if(Ue(Gi,Ci),_e&&(H.setupElevationDraw(Ki,_e,vt),j.uploadCommonUniforms(pe,_e,Gi.toUnwrapped()),gt)){const[kn,dn,tr]=gt.getGridBuffers(Xi,hi!==0);_e.draw(j,Si,Ke,Wt,$e,qn.backCCW,An,"globe_raster",kn,dn,tr)}}}if(gt&&(j.renderDefaultNorthPole||j.renderDefaultSouthPole)){const ri=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ne&&ri.push("CUSTOM_ANTIALIASING"),_e=j.getOrCreateProgram("globeRaster",{defines:ri});for(const hi of Y){const{x:Si,y:Gi,z:Ki}=hi.canonical,Wt=Gi===0,wi=Gi===(1<<Ki)-1,[ui,Ti,Ci,mi]=gt.getPoleBuffers(Ki,!1);if(mi&&(Wt||wi)){const Xi=Z.getTile(hi);pe.activeTexture.set(ue.TEXTURE0),Xi.texture&&Xi.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let zn=n.cD(Ki,Si,Oe);const $n=n.b6(n.cC(hi.canonical)),An=(kn,dn)=>kn.draw(j,ue.TRIANGLES,Ke,hr.disabled,$e,qn.disabled,gm(Oe.expandedFarZProjMatrix,zn,zn,$n,0,it,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,Lt,0,Oe._farZ),"globe_pole_raster",dn,Ci,mi);H.setupElevationDraw(Xi,_e,vt),j.uploadCommonUniforms(pe,_e,hi.toUnwrapped()),Wt&&j.renderDefaultNorthPole&&An(_e,ui),wi&&j.renderDefaultSouthPole&&(zn=n.a6.mat4.scale(n.a6.mat4.create(),zn,[1,-1,1]),An(_e,Ti))}}}})(x,w,E,O,B);else{const j=x.context,H=j.gl;let Z,Y;const se=x.shadowRenderer,pe=Ea(x,x.longestCutoffRange),ue=$e=>{if(Y===$e)return;const Ke=[];Ke.push(ym[$e]),pe.shouldRenderCutoff&&Ke.push("RENDER_CUTOFF"),se&&(Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),se.useNormalOffset&&Ke.push("NORMAL_OFFSET")),Z=x.getOrCreateProgram("terrainRaster",{defines:Ke}),Y=$e},_e=x.colorModeForRenderPass(),ge=new Xn(H.LEQUAL,Xn.ReadWrite,x.depthRangeFor3D);Yu.update(B);const Oe=x.transform,Ne=vm(Oe.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let Ue=[0,0,0];if(se){const $e=x.style.directionalLight,Ke=x.style.ambientLight;$e&&Ke&&(Ue=nu(x.style,$e,Ke))}{Y=-1;const $e=H.TRIANGLES,[Ke,Ze]=[w.gridIndexBuffer,w.gridSegments];for(const it of O){const gt=E.getTile(it),Lt=hr.disabled,wt=w.prevTerrainTileForTile[it.key],vt=w.terrainTileForTile[it.key];_m(wt,vt)&&Yu.newMorphing(it.key,wt,vt,B,250),j.activeTexture.set(H.TEXTURE0),gt.texture&&gt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const ri=Yu.getMorphValuesForProxy(it.key),hi=ri?1:0;let Si;ri&&(Si={morphing:{srcDemTile:ri.from,dstDemTile:ri.to,phase:n.cw(ri.phase)}});const Gi=Og(it.projMatrix,ef(it.canonical,Oe.renderWorldCopies)?Ne/10:Ne,Ue);if(ue(hi),!Z)continue;w.setupElevationDraw(gt,Z,Si);const Ki=it.toUnwrapped();se&&se.setupShadows(Ki,Z),x.uploadCommonUniforms(j,Z,Ki,null,pe),Z.draw(x,$e,ge,Lt,_e,qn.backCCW,Gi,"terrain_raster",w.gridBuffer,Ke,Ze)}}}}(s,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const s=this.painter,d=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),O=s.style.order,B=[];let j=0;for(const H of w){const Z=x.getTileByID(H.proxyTileKey),Y=x.proxyCachedFBO[H.key]?x.proxyCachedFBO[H.key][i]:void 0,se=Y!==void 0?x.renderCache[Y]:this.pool[j++],pe=Y!==void 0;if(Z.texture=se.tex,pe&&!se.dirty){B.push(Z.tileID);continue}let ue;d.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(d.clear({color:n.bA.transparent,stencil:0}),se.dirty=!1);for(let _e=E.start;_e<=E.end;++_e){const ge=s.style._mergedLayers[O[_e]];if(ge.isHidden(s.transform.zoom))continue;const Oe=s.style.getLayerSourceCache(ge),Ne=Oe?this.proxyToSource[H.key][Oe.id]:[H];if(!Ne)continue;const Ue=Ne;d.viewport.set([0,0,se.fb.width,se.fb.height]),ue!==(Oe?Oe.id:null)&&(this._setupStencil(se,Ne,ge,Oe),ue=Oe?Oe.id:null),s.renderLayer(s,Oe,ge,Ue)}if(this._drapedRenderBatches.length===0)for(const _e of this._pendingGroundEffectLayers){const ge=s.style._mergedLayers[O[_e]];if(ge.isHidden(s.transform.zoom))continue;const Oe=s.style.getLayerSourceCache(ge),Ne=Oe?this.proxyToSource[H.key][Oe.id]:[H];if(!Ne)continue;const Ue=Ne;d.viewport.set([0,0,se.fb.width,se.fb.height]),ue!==(Oe?Oe.id:null)&&(this._setupStencil(se,Ne,ge,Oe),ue=Oe?Oe.id:null),s.renderLayer(s,Oe,ge,Ue)}this.renderedToTile?(se.dirty=!0,B.push(Z.tileID)):pe||--j,j===5&&(j=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),E.end+1}postRender(){}isLayerOrderingCorrect(i){const s=i.order.length;let d=-1,x=s;for(let w=0;w<s;++w)this._style.isLayerDraped(i._mergedLayers[i.order[w]])?d=Math.max(d,w):x=Math.min(x,w);return x>d}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{i=Math.min(i,s.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,s,d){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const E=w.tileID,O=1<<E.overscaledZ,{x:B,y:j}=E.canonical,H=B/O,Z=(B+1)/O,Y=j/O,se=(j+1)/O;return{minx:H,miny:Y,maxx:Z,maxy:se,t:w.dem.tree.raycastRoot(H,Y,Z,se,i,s,d),tile:w}});x.sort((w,E)=>(w.t!==null?w.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const E=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,s,d);if(E!=null)return E}return null}_createFBO(){const i=this.painter.context,s=i.gl,d=this.drapeBufferSize;i.activeTexture.set(s.TEXTURE0);const x=new n.T(i,{width:d[0],height:d[1],data:null},s.RGBA8);x.bind(s.LINEAR,s.CLAMP_TO_EDGE);const w=i.createFramebuffer(d[0],d[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new Xu(i,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const s=this._style._mergedLayers[i],d=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!d&&s.shouldRedrape():!d&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const d of this._style.getSources())if(d instanceof Ps){i=!0;break}if(!i)return;const s={};for(let d=0;d<this._style.order.length;++d){const x=this._style._mergedLayers[this._style.order[d]],w=this._style.getLayerSourceCache(x);if(w&&!s[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof n.a4){s[w.id]=!0;for(const E of this.proxyCoords){const O=this.proxyToSource[E.key][w.id];if(O)for(const B of O)this._clearRenderCacheForTile(w.id,B)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof wo){i=!0;break}if(!i)return;const s={};for(let d=0;d<this._style.order.length;++d){const x=this._style._mergedLayers[this._style.order[d]],w=this._style.getLayerSourceCache(x);if(!w||s[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const O of this.proxyCoords){const B=this.proxyToSource[O.key][w.id];if(B)for(const j of B){const H=Bd(w.getTile(j),w.findLoadedParent(j,0),w,this.painter.transform,E);(H.opacity!==1||H.mix!==0)&&this._clearRenderCacheForTile(w.id,j)}}}}_setupDrapedRenderBatches(){const i=this._style.order,s=i.length;if(s===0)return;const d=[];this._pendingGroundEffectLayers=[];let x,w=0,E=this._style._mergedLayers[i[w]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++w<s;)E=this._style._mergedLayers[i[w]];for(;w<s;++w){const O=this._style._mergedLayers[i[w]];O.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(O)?x===void 0&&(x=w):(O.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(d.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&d.push({start:x,end:w-1}),d.length!==0){const O=d[d.length-1];this._pendingGroundEffectLayers.every(B=>B>O.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(i){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const E=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let O=0;O<E.length;++O){const B=Object.values(E[O]);s.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,x=this._tilesDirty;for(let E=d.length-1;E>=0;E--){const O=d[E];if(s.getTileByID(O.key),s.proxyCachedFBO[O.key]!==void 0){const B=i[O.key],j=this.proxyToSource[O.key];let H=0;for(const Z in j){const Y=j[Z],se=B[Z];if(!se||se.length!==Y.length||Y.some((pe,ue)=>pe!==se[ue]||x[Z]&&x[Z].hasOwnProperty(pe.key))){H=-1;break}++H}for(const Z in s.proxyCachedFBO[O.key])s.renderCache[s.proxyCachedFBO[O.key][Z]].dirty=H<0||H!==Object.values(B).length}}const w=[...this._drapedRenderBatches];w.sort((E,O)=>O.end-O.start-(E.end-E.start));for(const E of w)for(const O of d){if(s.proxyCachedFBO[O.key])continue;let B=s.renderCachePool.pop();B===void 0&&s.renderCache.length<50&&(B=s.renderCache.length,s.renderCache.push(this._createFBO())),B!==void 0&&(s.proxyCachedFBO[O.key]={},s.proxyCachedFBO[O.key][E.start]=B,s.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(i,s,d,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,E=w.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let O;if(d.isTileClipped())O=s.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);O=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+O>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=O,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):hr.disabled}_renderTileClippingMasks(i,s){const d=this.painter,x=this.painter.context,w=x.gl;d._tileClippingMaskIDs={},x.setColorMode(Ir.disabled),x.setDepthMode(Xn.disabled);const E=d.getOrCreateProgram("clippingMask");for(const O of i){const B=d._tileClippingMaskIDs[O.key]=--s;E.draw(d,w.TRIANGLES,Xn.disabled,new hr({func:w.ALWAYS,mask:0},B,255,w.KEEP,w.KEEP,w.REPLACE),Ir.disabled,qn.disabled,qh(O.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(i){const s=this.painter.transform;if(i.x<0||i.x>s.width||i.y<0||i.y>s.height)return null;const d=[i.x,i.y,1,1];n.a6.vec4.transformMat4(d,d,s.pixelMatrixInverse),n.a6.vec4.scale(d,d,1/d[3]),d[0]/=s.worldSize,d[1]/=s.worldSize;const x=s._camera.position,w=n.bE(1,s.center.lat),E=[x[0],x[1],x[2]/w,0],O=n.a6.vec3.subtract([],d.slice(0,3),E);n.a6.vec3.normalize(O,O);const B=this.raycast(E,O,this._exaggeration);return B!==null&&B?(n.a6.vec3.scaleAndAdd(E,E,O,B),E[3]=E[2],E[2]*=w,E):null}_setupProxiedCoordsForOrtho(i,s,d){if(i.getSource()instanceof n.aD)return this._setupProxiedCoordsForImageSource(i,s,d);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let B=0;B<w.length;B++){const j=w[B],H=this._findTileCoveringTileID(j,i);if(H){const Z=this._createProxiedId(j,H,d[j.key]&&d[j.key][i.id]);x.push(Z),this.proxyToSource[j.key][i.id]=[Z]}}let E=!1;const O=new Set;for(let B=0;B<s.length;B++){const j=i.getTile(s[B]);if(!j||!j.hasData())continue;const H=this._findTileCoveringTileID(j.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==j.tileID.canonical.z){const Z=this.proxyToSource[H.tileID.key][i.id],Y=this._createProxiedId(H.tileID,j,d[H.tileID.key]&&d[H.tileID.key][i.id]);Z?Z.splice(Z.length-1,0,Y):this.proxyToSource[H.tileID.key][i.id]=[Y];const se=this.proxyToSource[H.tileID.key][i.id];O.has(se)||O.add(se),x.push(Y),E=!0}}if(this._sourceTilesOverlap[i.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const B of O)B.sort((j,H)=>H.overscaledZ-j.overscaledZ)}_setupProxiedCoordsForImageSource(i,s,d){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords,E=i.getSource(),O=E.tileID;if(!O)return;const B=new n.P(O.x,O.y)._div(1<<O.z),j=E.coordinates.map(n.a5.fromLngLat).reduce((Z,Y)=>(Z.min.x=Math.min(Z.min.x,Y.x-B.x),Z.min.y=Math.min(Z.min.y,Y.y-B.y),Z.max.x=Math.max(Z.max.x,Y.x-B.x),Z.max.y=Math.max(Z.max.y,Y.y-B.y),Z),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(Z,Y)=>{const se=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),pe=Z.canonical.y/(1<<Z.canonical.z),ue=n.ab/(1<<Z.canonical.z),_e=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),ge=Y.canonical.y/(1<<Y.canonical.z);return se+ue<_e+j.min.x||se>_e+j.max.x||pe+ue<ge+j.min.y||pe>ge+j.max.y};for(let Z=0;Z<w.length;Z++){const Y=w[Z];for(let se=0;se<s.length;se++){const pe=i.getTile(s[se]);if(!pe||!pe.hasData()||H(Y,pe.tileID))continue;const ue=this._createProxiedId(Y,pe,d[Y.key]&&d[Y.key][i.id]),_e=this.proxyToSource[Y.key][i.id];_e?_e.push(ue):this.proxyToSource[Y.key][i.id]=[ue],x.push(ue)}}}_createProxiedId(i,s,d){let x=this.orthoMatrix;if(d){const w=d.find(E=>E.key===s.tileID.key);if(w)return w}if(s.tileID.key!==i.key){const w=i.canonical.z-s.tileID.canonical.z;let E,O,B;x=n.a6.mat4.create();const j=s.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(E=n.ab>>w,O=E*((s.tileID.canonical.x<<w)-i.canonical.x+j),B=E*((s.tileID.canonical.y<<w)-i.canonical.y)):(E=n.ab<<-w,O=n.ab*(s.tileID.canonical.x-(i.canonical.x+j<<-w)),B=n.ab*(s.tileID.canonical.y-(i.canonical.y<<-w))),n.a6.mat4.ortho(x,0,E,0,E,0,1),n.a6.mat4.translate(x,x,[O,B,0])}return new tf(s.tileID,i.key,x)}_findTileCoveringTileID(i,s){let d=s.getTile(i);if(d&&d.hasData())return d;const x=this._findCoveringTileCache[s.id],w=x[i.key];if(d=w?s.getTileByID(w):null,d&&d.hasData()||w===null)return d;let E=d?d.tileID:i,O=E.overscaledZ;const B=s.getSource().minzoom,j=[];if(!w){const Z=s.getSource().maxzoom;if(i.canonical.z>=Z){const Y=i.canonical.z-Z;s.getSource().reparseOverscaled?(O=Math.max(i.canonical.z+2,s.transform.tileZoom),E=new n.aA(O,i.wrap,Z,i.canonical.x>>Y,i.canonical.y>>Y)):Y!==0&&(O=Z,E=new n.aA(O,i.wrap,Z,i.canonical.x>>Y,i.canonical.y>>Y))}E.key!==i.key&&(j.push(E.key),d=s.getTile(E))}const H=Z=>{j.forEach(Y=>{x[Y]=Z}),j.length=0};for(O-=1;O>=B&&(!d||!d.hasData());O--){d&&H(d.tileID.key);const Z=E.calculateScaledKey(O);if(d=s.getTileByID(Z),d&&d.hasData())break;const Y=x[Z];if(Y===null)break;Y===void 0?j.push(Z):d=s.getTileByID(Y)}return H(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,s){let d=this._tilesDirty[i];d||(d=this._tilesDirty[i]={}),d[s.key]=!0}}function rf(h,i,s){const d=function(O,B,j){const H=n.a6.vec3.dot(B,O),Z=n.a6.vec3.dot(j,[.2126,.7152,.0722]),Y=(pe,ue,_e)=>(1-_e)*pe+_e*ue,se=Y(1-.3*Math.min(Z,1),1,Math.min(H+1,1));return Y(.92,1,Math.asin(n.ap(B[2],-1,1))/Math.PI+.5)*se}(h,[0,0,1],i),x=[0,0,0];n.a6.vec3.scale(x,s.slice(0,3),d);const w=[0,0,0];n.a6.vec3.scale(w,i.slice(0,3),h[2]);const E=[0,0,0];return n.a6.vec3.add(E,x,w),n.cc(E)}const lu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],bm=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Kl{static cacheKey(i,s,d,x){let w=`${s}${x?x.cacheKey:""}`;for(const E of d)i.usedDefines.includes(E)&&(w+=`/${E}`);return w}constructor(i,s,d,x,w,E){const O=i.gl;this.program=O.createProgram(),this.configuration=x,this.name=s,this.fixedDefines=[...E];const B=x?x.getBinderAttributes():[],j=(d.staticAttributes||[]).concat(B);let H=x?x.defines():[];H=H.concat(E.map(_e=>`#define ${_e}`));const Z=`#version 300 es
`;let Y=Z+H.concat("precision mediump float;",Nh,Ec.fragmentSource).join(`
`);for(const _e of d.fragmentIncludes)Y+=`
${Yl[_e]}`;Y+=`
${d.fragmentSource}`;let se=Z+H.concat("precision highp float;",Nh,Ec.vertexSource).join(`
`);for(const _e of d.vertexIncludes)se+=`
${Yl[_e]}`;se+=`
${d.vertexSource}`;const pe=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(pe,Y),O.compileShader(pe),O.attachShader(this.program,pe);const ue=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())this.failedToCreate=!0;else{O.shaderSource(ue,se),O.compileShader(ue),O.attachShader(this.program,ue),this.attributes={},this.numAttributes=j.length;for(let _e=0;_e<this.numAttributes;_e++)if(j[_e]){const ge=j[_e].startsWith("a_")?j[_e]:`a_${j[_e]}`;O.bindAttribLocation(this.program,_e,ge),this.attributes[ge]=_e}O.linkProgram(this.program),O.deleteShader(ue),O.deleteShader(pe),this.fixedUniforms=w(i),this.binderUniforms=x?x.getUniforms(i):[],(E.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(_e=>({u_dem:new n.bK(_e),u_dem_prev:new n.bK(_e),u_dem_tl:new n.bH(_e),u_dem_scale:new n.bJ(_e),u_dem_tl_prev:new n.bH(_e),u_dem_scale_prev:new n.bJ(_e),u_dem_size:new n.bJ(_e),u_dem_lerp:new n.bJ(_e),u_exaggeration:new n.bJ(_e),u_depth:new n.bK(_e),u_depth_size_inv:new n.bH(_e),u_depth_range_unpack:new n.bH(_e),u_occluder_half_size:new n.bJ(_e),u_occlusion_depth_offset:new n.bJ(_e),u_meter_to_dem:new n.bJ(_e),u_label_plane_matrix_inv:new n.bG(_e)}))(i)),E.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new n.bI(_e),u_tile_tr_up:new n.bI(_e),u_tile_br_up:new n.bI(_e),u_tile_bl_up:new n.bI(_e),u_tile_up_scale:new n.bJ(_e)}))(i)),E.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new n.bG(_e),u_fog_range:new n.bH(_e),u_fog_color:new n.c7(_e),u_fog_horizon_blend:new n.bJ(_e),u_fog_vertical_limit:new n.bH(_e),u_fog_temporal_offset:new n.bJ(_e),u_frustum_tl:new n.bI(_e),u_frustum_tr:new n.bI(_e),u_frustum_br:new n.bI(_e),u_frustum_bl:new n.bI(_e),u_globe_pos:new n.bI(_e),u_globe_radius:new n.bJ(_e),u_globe_transition:new n.bJ(_e),u_is_globe:new n.bK(_e),u_viewport:new n.bH(_e)}))(i)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(_e=>({u_cutoff_params:new n.c7(_e)}))(i)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(_e=>({u_lighting_ambient_color:new n.bI(_e),u_lighting_directional_dir:new n.bI(_e),u_lighting_directional_color:new n.bI(_e),u_ground_radiance:new n.bI(_e)}))(i)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(_e=>({u_light_matrix_0:new n.bG(_e),u_light_matrix_1:new n.bG(_e),u_fade_range:new n.bH(_e),u_shadow_normal_offset:new n.bI(_e),u_shadow_intensity:new n.bJ(_e),u_shadow_texel_size:new n.bJ(_e),u_shadow_map_resolution:new n.bJ(_e),u_shadow_direction:new n.bI(_e),u_shadow_bias:new n.bI(_e),u_shadowmap_0:new n.bK(_e),u_shadowmap_1:new n.bK(_e)}))(i))}}setTerrainUniformValues(i,s){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)d[x]&&d[x].set(this.program,x,s[x])}}setGlobeUniformValues(i,s){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)d[x]&&d[x].set(this.program,x,s[x])}}setFogUniformValues(i,s){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)d[x].set(this.program,x,s[x])}}setCutoffUniformValues(i,s){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)d[x].set(this.program,x,s[x])}}setLightsUniformValues(i,s){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)d[x].set(this.program,x,s[x])}}setShadowUniformValues(i,s){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;i.program.set(this.program);for(const x in s)d[x].set(this.program,x,s[x])}_drawDebugWireframe(i,s,d,x,w,E,O,B,j,H){const Z=i.options.wireframe;if(Z.terrain===!1&&Z.layers2D===!1&&Z.layers3D===!1)return;const Y=i.context;if(!(!(!Z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Z.layers2D||i._terrain&&i._terrain.renderingToTexture||!lu.includes(this.name))||!(!Z.layers3D||!bm.includes(this.name))))return;const se=Y.gl,pe=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,w,Y);if(!pe)return;const ue=[...this.fixedDefines];ue.push("DEBUG_WIREFRAME");const _e=i.getOrCreateProgram(this.name,{config:this.configuration,defines:ue});Y.program.set(_e.program);const ge=(Ue,$e,Ke)=>{if($e[Ue]&&Ke[Ue])for(const Ze in $e[Ue])Ke[Ue][Ze]&&Ke[Ue][Ze].set(Ke.program,Ze,$e[Ue][Ze].current)};j&&j.setUniforms(_e.program,Y,_e.binderUniforms,O,{zoom:B}),ge("fixedUniforms",this,_e),ge("terrainUniforms",this,_e),ge("globeUniforms",this,_e),ge("fogUniforms",this,_e),ge("lightsUniforms",this,_e),ge("shadowUniforms",this,_e),pe.bind(),Y.setColorMode(new Ir([se.ONE,se.ONE_MINUS_SRC_ALPHA,se.ZERO,se.ONE],n.bA.transparent,[!0,!0,!0,!1])),Y.setDepthMode(new Xn(s.func===se.LESS?se.LEQUAL:s.func,Xn.ReadOnly,s.range)),Y.setStencilMode(hr.disabled);const Oe=3*E.primitiveLength*2,Ne=3*E.primitiveOffset*2*2;H&&H>1?se.drawElementsInstanced(se.LINES,Oe,se.UNSIGNED_SHORT,Ne,H):se.drawElements(se.LINES,Oe,se.UNSIGNED_SHORT,Ne),w.bind(),Y.program.set(this.program),Y.setDepthMode(s),Y.setStencilMode(d),Y.setColorMode(x)}checkUniforms(i,s,d){if(this.fixedDefines.includes(s)){for(const x of Object.keys(d))if(!d[x].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${x} not set but required by ${s} being defined`)}}draw(i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e){const ge=i.context,Oe=ge.gl;if(this.failedToCreate)return;ge.program.set(this.program),ge.setDepthMode(d),ge.setStencilMode(x),ge.setColorMode(w),ge.setCullFace(E);for(const $e of Object.keys(this.fixedUniforms))this.fixedUniforms[$e].set(this.program,$e,O[$e]);pe&&pe.setUniforms(this.program,ge,this.binderUniforms,Y,{zoom:se});const Ne={[Oe.POINTS]:1,[Oe.LINES]:2,[Oe.TRIANGLES]:3,[Oe.LINE_STRIP]:1}[s];this.checkUniforms(B,"RENDER_SHADOWS",this.shadowUniforms);const Ue=_e&&_e>0?1:void 0;for(const $e of Z.get()){const Ke=$e.vaos||($e.vaos={});(Ke[B]||(Ke[B]=new ou)).bind(ge,this,j,pe?pe.getPaintVertexBuffers():[],H,$e.vertexOffset,ue||[],Ue),_e&&_e>1?Oe.drawElementsInstanced(s,$e.primitiveLength*Ne,Oe.UNSIGNED_SHORT,$e.primitiveOffset*Ne*2,_e):H?Oe.drawElements(s,$e.primitiveLength*Ne,Oe.UNSIGNED_SHORT,$e.primitiveOffset*Ne*2):Oe.drawArrays(s,$e.vertexOffset,$e.vertexLength),s===Oe.TRIANGLES&&H&&this._drawDebugWireframe(i,d,x,w,H,$e,Y,se,pe,_e)}}}function Nd(h,i){const s=Math.pow(2,i.tileID.overscaledZ),d=i.tileSize*Math.pow(2,h.transform.tileZoom)/s,x=d*(i.tileID.canonical.x+i.tileID.wrap*s),w=d*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ak(i,1,h.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const cu={terrain:0,flat:1},wm=n.a6.mat4.create(),sf=(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e,ge)=>{const Oe=i.style.light,Ne=Oe.properties.get("position"),Ue=[Ne.x,Ne.y,Ne.z],$e=n.a6.mat3.create();Oe.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation($e,-i.transform.angle),n.a6.vec3.transformMat3(Ue,Ue,$e));const Ke=Oe.properties.get("color"),Ze=i.transform,it={u_matrix:h,u_lightpos:Ue,u_lightintensity:Oe.properties.get("intensity"),u_lightcolor:[Ke.r,Ke.g,Ke.b],u_vertical_gradient:+s,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:cu[j],u_base_type:cu[H],u_ao:x,u_edge_radius:w,u_width_scale:E,u_flood_light_color:pe,u_vertical_scale:ue,u_flood_light_intensity:_e,u_ground_shadow_factor:ge};return Ze.projection.name==="globe"&&(it.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],it.u_zoom_transition=Z,it.u_inv_rot_matrix=se,it.u_merc_center=Y,it.u_up_dir=Ze.projection.upVector(new n.bQ(0,0,0),Y[0]*n.ab,Y[1]*n.ab),it.u_height_lift=B),it},of=(h,i,s,d,x,w)=>({u_matrix:h,u_edge_radius:i,u_width_scale:s,u_vertical_scale:d,u_height_type:cu[x],u_base_type:cu[w]}),af=(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e)=>{const ge=sf(h,i,s,d,x,w,E,O,j,H,Z,Y,se,pe,ue,_e,1,[0,0,0]),Oe={u_height_factor:-Math.pow(2,O.overscaledZ)/B.tileSize/8};return n.l(ge,Nd(i,B),Oe)},Tm=(h,i)=>({u_matrix:h,u_emissive_strength:i}),lf=(h,i,s,d)=>n.l(Tm(h,i),Nd(s,d)),$h=(h,i,s)=>({u_matrix:h,u_world:s,u_emissive_strength:i}),zg=(h,i,s,d,x)=>n.l(lf(h,i,s,d),{u_world:x}),kg=(h,i,s,d)=>{const x=n.ab/s.tileSize;return{u_matrix:h,u_camera_to_center_distance:i.getCameraToCenterDistance(d),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},cf=(h,i,s=1)=>({u_matrix:h,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),Mm=n.a6.mat4.create(),Ud=(h,i,s,d,x,w,E)=>{const O=h.transform,B=O.projection.name==="globe",j=B?n.cI(O.zoom,i.canonical)*O._pixelsPerMercatorPixel:n.ak(s,1,w),H={u_matrix:i.projMatrix,u_extrude_scale:j,u_intensity:E,u_inv_rot_matrix:Mm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){H.u_inv_rot_matrix=d,H.u_merc_center=x,H.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],H.u_zoom_transition=n.a9(O.zoom);const Z=x[0]*n.ab,Y=x[1]*n.ab;H.u_up_dir=O.projection.upVector(new n.bQ(0,0,0),Z,Y)}return H};function Ju(h,[i,s,d,x],[w,E]){if(w===E)return[0,0,0,0];const O=255*(h-1)/(h*(E-w));return[i*O,s*O,d*O,x*O]}function uu(h,i,[s,d]){return s===d?0:.5/h+(i-s)*(h-1)/(h*(d-s))}const Vd=(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e,ge,Oe,Ne,Ue)=>({u_matrix:h,u_normalize_matrix:i,u_globe_matrix:s,u_merc_matrix:d,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:j,u_fade_t:H.mix,u_opacity:H.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:n.cJ(Z.paint.get("raster-saturation")),u_contrast_factor:n.cK(Z.paint.get("raster-contrast")),u_spin_weights:el(Z.paint.get("raster-hue-rotate")),u_perspective_transform:Y,u_raster_elevation:se,u_zoom_transition:E,u_merc_center:O,u_cutoff_params:B,u_colorization_mix:Ju(n.cL,ue,ge),u_colorization_offset:uu(n.cL,_e,ge),u_color_ramp:pe,u_texture_offset:[Ne/(Oe+2*Ne),Oe/(Oe+2*Ne)],u_texture_res:[Oe+2*Ne,Oe+2*Ne],u_emissive_strength:Ue});function el(h){h*=Math.PI/180;const i=Math.sin(h),s=Math.cos(h);return[(2*s+1)/3,(-Math.sqrt(3)*i-s+1)/3,(Math.sqrt(3)*i-s+1)/3]}const Cc=.05,Gd=(h,i,s,d,x,w,E,O,B,j,H,Z)=>({u_matrix:h,u_normalize_matrix:i,u_globe_matrix:s,u_merc_matrix:d,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:j,u_fade_t:H.mix,u_opacity:H.opacity,u_image0:0,u_image1:1,u_raster_elevation:Z,u_zoom_transition:E,u_merc_center:O,u_cutoff_params:B}),Zh=(h,i,s,d,x,w,E,O,B,j)=>({u_particle_texture:h,u_particle_texture_side_len:i,u_tile_offset:s,u_velocity:d,u_color_ramp:w,u_velocity_res:x,u_max_speed:E,u_uv_offset:O,u_data_scale:[255*B[0],255*B[1]],u_data_offset:j,u_particle_pos_scale:1.1,u_particle_pos_offset:[Cc,Cc]}),Hd=(h,i,s,d,x,w,E,O,B,j)=>({u_particle_texture:h,u_particle_texture_side_len:i,u_velocity:s,u_velocity_res:d,u_max_speed:x,u_speed_factor:w,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:O,u_data_scale:[255*B[0],255*B[1]],u_data_offset:j,u_particle_pos_scale:1.1,u_particle_pos_offset:[Cc,Cc]}),Lc=n.a6.mat4.create(),Sm=(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e,ge,Oe,Ne,Ue,$e)=>{const Ke=x.transform,Ze={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Ke.getCameraToCenterDistance(Oe),u_rotate_symbol:+s,u_aspect_ratio:Ke.width/Ke.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:E,u_coord_matrix:O,u_is_text:+j,u_elevation_from_sea:B?1:0,u_pitch_with_map:+d,u_texsize:H,u_texsize_icon:Z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Lc,u_up_vector:[0,-1,0],u_color_adj_mat:Ne,u_icon_transition:Ue||0,u_gamma_scale:d?x.transform.getCameraToCenterDistance(Oe)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:+Y,u_scale_factor:$e||1};return Oe.name==="globe"&&(Ze.u_tile_id=[se.canonical.x,se.canonical.y,1<<se.canonical.z],Ze.u_zoom_transition=pe,Ze.u_inv_rot_matrix=_e,Ze.u_merc_center=ue,Ze.u_camera_forward=Ke._camera.forward(),Ze.u_ecef_origin=n.cM(Ke.globeMatrix,se.toUnwrapped()),Ze.u_tile_matrix=Float32Array.from(Ke.globeMatrix),Ze.u_up_vector=ge),Ze},hu=(h,i,s,d)=>({u_matrix:h,u_emissive_strength:i,u_opacity:s,u_color:d}),Jl=(h,i,s,d,x,w,E,O,B)=>n.l(function(j,H,Z,Y,se,pe){const{width:ue,height:_e}=Y.imageManager.getPixelSize(H),ge=Math.pow(2,pe.tileID.overscaledZ),Oe=pe.tileSize*Math.pow(2,Y.transform.tileZoom)/ge,Ne=Oe*(pe.tileID.canonical.x+pe.tileID.wrap*ge),Ue=Oe*pe.tileID.canonical.y;return{u_image:0,u_pattern_tl:Z.tl,u_pattern_br:Z.br,u_texsize:[ue,_e],u_pattern_size:Z.displaySize,u_pattern_units_to_pixels:se?[Y.transform.width,-1*Y.transform.height]:[1/n.ak(pe,1,Y.transform.tileZoom),1/n.ak(pe,1,Y.transform.tileZoom)],u_pixel_coord_upper:[Ne>>16,Ue>>16],u_pixel_coord_lower:[65535&Ne,65535&Ue]}}(0,w,E,d,O,B),{u_matrix:h,u_emissive_strength:i,u_opacity:s}),Sn=new Float32Array(n.a6.mat4.identity([])),Xh=(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se=[0,0,0],pe)=>{const ue=x.style.light,_e=ue.properties.get("position"),ge=[-_e.x,-_e.y,_e.z],Oe=n.a6.mat3.create();ue.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(Oe,-x.transform.angle),n.a6.vec3.transformMat3(ge,ge,Oe));const Ne=H.alphaMode==="MASK",Ue=ue.properties.get("color").toRenderColor(null),$e=Y.paint.get("model-ambient-occlusion-intensity"),Ke=Y.paint.get("model-color").constantOr(n.bA.white).toRenderColor(null),Ze=Y.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:i,u_normal_matrix:s,u_node_matrix:d||Sn,u_lightpos:ge,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[Ue.r,Ue.g,Ue.b],u_camera_pos:se,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Ne,u_alphaCutoff:H.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[O[0],O[1],O[2],1],u_metallicFactor:B,u_roughnessFactor:j,u_baseColorTexture:ao.BaseColor,u_metallicRoughnessTexture:ao.MetallicRoughness,u_normalTexture:ao.Normal,u_occlusionTexture:ao.Occlusion,u_emissionTexture:ao.Emission,u_lutTexture:ao.LUT,u_color_mix:[Ke.r,Ke.g,Ke.b,Ze],u_aoIntensity:$e,u_emissive_strength:Z,u_occlusionTextureTransform:pe||[0,0,0,0]}},uf=(h,i=Sn,s=Sn)=>({u_matrix:h,u_instance:i,u_node_matrix:s}),Ql={fillExtrusion:h=>({u_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_vertical_gradient:new n.bJ(h),u_opacity:new n.bJ(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_ao:new n.bH(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_up_dir:new n.bI(h),u_height_lift:new n.bJ(h),u_flood_light_color:new n.bI(h),u_vertical_scale:new n.bJ(h),u_flood_light_intensity:new n.bJ(h),u_ground_shadow_factor:new n.bI(h)}),fillExtrusionDepth:h=>({u_matrix:new n.bG(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_vertical_scale:new n.bJ(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h)}),fillExtrusionPattern:h=>({u_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_vertical_gradient:new n.bJ(h),u_height_factor:new n.bJ(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_ao:new n.bH(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_up_dir:new n.bI(h),u_height_lift:new n.bJ(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h),u_opacity:new n.bJ(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new n.bG(h),u_opacity:new n.bJ(h),u_ao_pass:new n.bJ(h),u_meter_to_tile:new n.bJ(h),u_ao:new n.bH(h),u_flood_light_intensity:new n.bJ(h),u_flood_light_color:new n.bI(h),u_attenuation:new n.bJ(h),u_edge_radius:new n.bJ(h),u_fb:new n.bK(h),u_fb_size:new n.bJ(h),u_dynamic_offset:new n.bJ(h)}),fill:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h)}),fillPattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h)}),fillOutline:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_world:new n.bH(h)}),fillOutlinePattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_world:new n.bH(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h)}),circle:n.cN,collisionBox:h=>({u_matrix:new n.bG(h),u_camera_to_center_distance:new n.bJ(h),u_extrude_scale:new n.bH(h)}),collisionCircle:h=>({u_matrix:new n.bG(h),u_inv_matrix:new n.bG(h),u_camera_to_center_distance:new n.bJ(h),u_viewport_size:new n.bH(h)}),debug:h=>({u_color:new n.cu(h),u_matrix:new n.bG(h),u_overlay:new n.bK(h),u_overlay_scale:new n.bJ(h)}),clippingMask:h=>({u_matrix:new n.bG(h)}),heatmap:h=>({u_extrude_scale:new n.bJ(h),u_intensity:new n.bJ(h),u_matrix:new n.bG(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_up_dir:new n.bI(h)}),heatmapTexture:h=>({u_image:new n.bK(h),u_color_ramp:new n.bK(h),u_opacity:new n.bJ(h)}),hillshade:h=>({u_matrix:new n.bG(h),u_image:new n.bK(h),u_latrange:new n.bH(h),u_light:new n.bH(h),u_shadow:new n.cu(h),u_highlight:new n.cu(h),u_emissive_strength:new n.bJ(h),u_accent:new n.cu(h)}),hillshadePrepare:h=>({u_matrix:new n.bG(h),u_image:new n.bK(h),u_dimension:new n.bH(h),u_zoom:new n.bJ(h)}),line:n.cO,linePattern:n.cP,raster:h=>({u_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_grid_matrix:new n.cv(h),u_tl_parent:new n.bH(h),u_scale_parent:new n.bJ(h),u_fade_t:new n.bJ(h),u_opacity:new n.bJ(h),u_image0:new n.bK(h),u_image1:new n.bK(h),u_brightness_low:new n.bJ(h),u_brightness_high:new n.bJ(h),u_saturation_factor:new n.bJ(h),u_contrast_factor:new n.bJ(h),u_spin_weights:new n.bI(h),u_perspective_transform:new n.bH(h),u_raster_elevation:new n.bJ(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_cutoff_params:new n.c7(h),u_colorization_mix:new n.c7(h),u_colorization_offset:new n.bJ(h),u_color_ramp:new n.bK(h),u_texture_offset:new n.bH(h),u_texture_res:new n.bH(h),u_emissive_strength:new n.bJ(h)}),rasterParticle:h=>({u_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_grid_matrix:new n.cv(h),u_tl_parent:new n.bH(h),u_scale_parent:new n.bJ(h),u_fade_t:new n.bJ(h),u_opacity:new n.bJ(h),u_image0:new n.bK(h),u_image1:new n.bK(h),u_raster_elevation:new n.bJ(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_cutoff_params:new n.c7(h)}),rasterParticleTexture:h=>({u_texture:new n.bK(h),u_opacity:new n.bJ(h)}),rasterParticleDraw:h=>({u_particle_texture:new n.bK(h),u_particle_texture_side_len:new n.bJ(h),u_tile_offset:new n.bH(h),u_velocity:new n.bK(h),u_color_ramp:new n.bK(h),u_velocity_res:new n.bH(h),u_max_speed:new n.bJ(h),u_uv_offset:new n.bH(h),u_data_scale:new n.bH(h),u_data_offset:new n.bJ(h),u_particle_pos_scale:new n.bJ(h),u_particle_pos_offset:new n.bH(h)}),rasterParticleUpdate:h=>({u_particle_texture:new n.bK(h),u_particle_texture_side_len:new n.bJ(h),u_velocity:new n.bK(h),u_velocity_res:new n.bH(h),u_max_speed:new n.bJ(h),u_speed_factor:new n.bJ(h),u_reset_rate:new n.bJ(h),u_rand_seed:new n.bJ(h),u_uv_offset:new n.bH(h),u_data_scale:new n.bH(h),u_data_offset:new n.bJ(h),u_particle_pos_scale:new n.bJ(h),u_particle_pos_offset:new n.bH(h)}),symbol:h=>({u_is_size_zoom_constant:new n.bK(h),u_is_size_feature_constant:new n.bK(h),u_size_t:new n.bJ(h),u_size:new n.bJ(h),u_camera_to_center_distance:new n.bJ(h),u_rotate_symbol:new n.bK(h),u_aspect_ratio:new n.bJ(h),u_fade_change:new n.bJ(h),u_matrix:new n.bG(h),u_label_plane_matrix:new n.bG(h),u_coord_matrix:new n.bG(h),u_is_text:new n.bK(h),u_elevation_from_sea:new n.bK(h),u_pitch_with_map:new n.bK(h),u_texsize:new n.bH(h),u_texsize_icon:new n.bH(h),u_texture:new n.bK(h),u_texture_icon:new n.bK(h),u_gamma_scale:new n.bJ(h),u_device_pixel_ratio:new n.bJ(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_camera_forward:new n.bI(h),u_tile_matrix:new n.bG(h),u_up_vector:new n.bI(h),u_ecef_origin:new n.bI(h),u_is_halo:new n.bK(h),u_icon_transition:new n.bJ(h),u_color_adj_mat:new n.bG(h),u_scale_factor:new n.bJ(h)}),background:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_opacity:new n.bJ(h),u_color:new n.cu(h)}),backgroundPattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_opacity:new n.bJ(h),u_image:new n.bK(h),u_pattern_tl:new n.bH(h),u_pattern_br:new n.bH(h),u_texsize:new n.bH(h),u_pattern_size:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_pattern_units_to_pixels:new n.bH(h)}),terrainRaster:h=>({u_matrix:new n.bG(h),u_image0:new n.bK(h),u_skirt_height:new n.bJ(h),u_ground_shadow_factor:new n.bI(h)}),skybox:h=>({u_matrix:new n.bG(h),u_sun_direction:new n.bI(h),u_cubemap:new n.bK(h),u_opacity:new n.bJ(h),u_temporal_offset:new n.bJ(h)}),skyboxGradient:h=>({u_matrix:new n.bG(h),u_color_ramp:new n.bK(h),u_center_direction:new n.bI(h),u_radius:new n.bJ(h),u_opacity:new n.bJ(h),u_temporal_offset:new n.bJ(h)}),skyboxCapture:h=>({u_matrix_3f:new n.cv(h),u_sun_direction:new n.bI(h),u_sun_intensity:new n.bJ(h),u_color_tint_r:new n.c7(h),u_color_tint_m:new n.c7(h),u_luminance:new n.bJ(h)}),globeRaster:h=>({u_proj_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_image0:new n.bK(h),u_grid_matrix:new n.cv(h),u_skirt_height:new n.bJ(h),u_far_z_cutoff:new n.bJ(h),u_frustum_tl:new n.bI(h),u_frustum_tr:new n.bI(h),u_frustum_br:new n.bI(h),u_frustum_bl:new n.bI(h),u_globe_pos:new n.bI(h),u_globe_radius:new n.bJ(h),u_viewport:new n.bH(h)}),globeAtmosphere:h=>({u_frustum_tl:new n.bI(h),u_frustum_tr:new n.bI(h),u_frustum_br:new n.bI(h),u_frustum_bl:new n.bI(h),u_horizon:new n.bJ(h),u_transition:new n.bJ(h),u_fadeout_range:new n.bJ(h),u_color:new n.c7(h),u_high_color:new n.c7(h),u_space_color:new n.c7(h),u_temporal_offset:new n.bJ(h),u_horizon_angle:new n.bJ(h)}),model:h=>({u_matrix:new n.bG(h),u_lighting_matrix:new n.bG(h),u_normal_matrix:new n.bG(h),u_node_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_camera_pos:new n.bI(h),u_opacity:new n.bJ(h),u_baseColorFactor:new n.c7(h),u_emissiveFactor:new n.c7(h),u_metallicFactor:new n.bJ(h),u_roughnessFactor:new n.bJ(h),u_baseTextureIsAlpha:new n.bK(h),u_alphaMask:new n.bK(h),u_alphaCutoff:new n.bJ(h),u_baseColorTexture:new n.bK(h),u_metallicRoughnessTexture:new n.bK(h),u_normalTexture:new n.bK(h),u_occlusionTexture:new n.bK(h),u_emissionTexture:new n.bK(h),u_lutTexture:new n.bK(h),u_color_mix:new n.c7(h),u_aoIntensity:new n.bJ(h),u_emissive_strength:new n.bJ(h),u_occlusionTextureTransform:new n.c7(h)}),modelDepth:h=>({u_matrix:new n.bG(h),u_instance:new n.bG(h),u_node_matrix:new n.bG(h)}),groundShadow:h=>({u_matrix:new n.bG(h),u_ground_shadow_factor:new n.bI(h)}),stars:h=>({u_matrix:new n.bG(h),u_up:new n.bI(h),u_right:new n.bI(h),u_intensity_multiplier:new n.bJ(h)}),snowParticle:h=>({u_modelview:new n.bG(h),u_projection:new n.bG(h),u_time:new n.bJ(h),u_cam_pos:new n.bI(h),u_velocityConeAperture:new n.bJ(h),u_velocity:new n.bJ(h),u_horizontalOscillationRadius:new n.bJ(h),u_horizontalOscillationRate:new n.bJ(h),u_boxSize:new n.bJ(h),u_billboardSize:new n.bJ(h),u_simpleShapeParameters:new n.bH(h),u_screenSize:new n.bH(h),u_thinningCenterPos:new n.bH(h),u_thinningShape:new n.bI(h),u_thinningAffectedRatio:new n.bJ(h),u_thinningParticleOffset:new n.bJ(h),u_particleColor:new n.c7(h),u_direction:new n.bI(h)}),rainParticle:h=>({u_modelview:new n.bG(h),u_projection:new n.bG(h),u_time:new n.bJ(h),u_cam_pos:new n.bI(h),u_texScreen:new n.bK(h),u_velocityConeAperture:new n.bJ(h),u_velocity:new n.bJ(h),u_boxSize:new n.bJ(h),u_rainDropletSize:new n.bH(h),u_distortionStrength:new n.bJ(h),u_rainDirection:new n.bI(h),u_color:new n.c7(h),u_screenSize:new n.bH(h),u_thinningCenterPos:new n.bH(h),u_thinningShape:new n.bI(h),u_thinningAffectedRatio:new n.bJ(h),u_thinningParticleOffset:new n.bJ(h),u_shapeDirectionalPower:new n.bJ(h),u_mode:new n.bJ(h)}),occlusion:h=>({u_matrix:new n.bG(h),u_anchorPos:new n.bI(h),u_screenSizePx:new n.bH(h),u_occluderSizePx:new n.bH(h),u_color:new n.c7(h)})};class Ia{constructor(i,s,d,x){this.id=Ia.uniqueIdxCounter,Ia.uniqueIdxCounter++,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||x||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Ia.uniqueIdxCounter,Ia.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ia.uniqueIdxCounter=0;const Gn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hf{constructor(i,s,d,x,w,E){this.length=s.length,this.attributes=d,this.itemSize=s.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=i;const O=i.gl;this.buffer=O.createBuffer(),i.bindVertexBuffer.set(this.buffer),O.bufferData(O.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||w||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,s){for(let d=0;d<this.attributes.length;d++){const x=s.attributes[this.attributes[d].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,s,d){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],E=s.attributes[w.name];E!==void 0&&i.vertexAttribPointer(E,w.components,i[Gn[w.type]],!1,this.itemSize,w.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(i,s,d){for(let x=0;x<this.attributes.length;x++){const w=s.attributes[this.attributes[x].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(w,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class df{constructor(i,s,d,x,w){this.context=i,this.width=s,this.height=d;const E=this.framebuffer=i.gl.createFramebuffer();x&&(this.colorAttachment=new Fd(i,E)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new Qp(i,E):new mm(i,E))}destroy(){const i=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&i.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&i.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&i.deleteTexture(s)}i.deleteFramebuffer(this.framebuffer)}}class Fg{constructor(i,s){this.gl=i,this.clearColor=new Dd(this),this.clearDepth=new $p(this),this.clearStencil=new Vh(this),this.colorMask=new Wu(this),this.depthMask=new Gh(this),this.stencilMask=new cm(this),this.stencilFunc=new um(this),this.stencilOp=new hm(this),this.stencilTest=new qu(this),this.depthRange=new dm(this),this.depthTest=new Rg(this),this.depthFunc=new Pg(this),this.blend=new Dg(this),this.blendFunc=new Hh(this),this.blendColor=new jh(this),this.blendEquation=new Od(this),this.cullFace=new Zp(this),this.cullFaceSide=new pm(this),this.frontFace=new Xp(this),this.program=new fm(this),this.activeTexture=new $u(this),this.viewport=new Zu(this),this.bindFramebuffer=new Yp(this),this.bindRenderbuffer=new La(this),this.bindTexture=new Ac(this),this.bindVertexBuffer=new qo(this),this.bindElementBuffer=new Uo(this),this.bindVertexArrayOES=new zd(this),this.pixelStoreUnpack=new Kp(this),this.pixelStoreUnpackPremultiplyAlpha=new kd(this),this.pixelStoreUnpackFlipY=new Jp(this),this.options=s?{...s}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,s,d){return new Ia(this,i,s,d)}createVertexBuffer(i,s,d,x,w){return new hf(this,i,s,d,x,w)}createRenderbuffer(i,s,d){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,i,s,d),this.bindRenderbuffer.set(null),w}createFramebuffer(i,s,d,x){return new df(this,i,s,d,x)}clear({color:i,depth:s,stencil:d,colorMask:x}){const w=this.gl;let E=0;i&&(E|=w.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(x||[!0,!0,!0,!0])),s!==void 0&&(E|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),d!==void 0&&(E|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),w.clear(E)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){n.bi(i.blendFunction,Ir.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let du;function jd(h,i,s,d,x,w,E){const O=h.context,B=O.gl,j=h.transform,H=h.getOrCreateProgram("collisionBox"),Z=[];let Y=0,se=0;for(let Ue=0;Ue<d.length;Ue++){const $e=d[Ue],Ke=i.getTile($e),Ze=Ke.getBucket(s);if(!Ze)continue;const it=Ba($e,Ze,j);let gt=it;x[0]===0&&x[1]===0||(gt=h.translatePosMatrix(it,Ke,x,w));const Lt=E?Ze.textCollisionBox:Ze.iconCollisionBox,wt=Ze.collisionCircleArray;if(wt.length>0){const vt=n.a6.mat4.create(),ri=gt;n.a6.mat4.mul(vt,Ze.placementInvProjMatrix,j.glCoordMatrix),n.a6.mat4.mul(vt,vt,Ze.placementViewportMatrix),Z.push({circleArray:wt,circleOffset:se,transform:ri,invTransform:vt,projection:Ze.getProjection()}),Y+=wt.length/4,se=Y}Lt&&(h.terrain&&h.terrain.setupElevationDraw(Ke,H),H.draw(h,B.LINES,Xn.disabled,hr.disabled,h.colorModeForRenderPass(),qn.disabled,kg(gt,j,Ke,Ze.getProjection()),s.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,null,j.zoom,null,[Lt.collisionVertexBuffer,Lt.collisionVertexBufferExt]))}if(!E||!Z.length)return;const pe=h.getOrCreateProgram("collisionCircle"),ue=new n.cQ;ue.resize(4*Y),ue._trim();let _e=0;for(const Ue of Z)for(let $e=0;$e<Ue.circleArray.length/4;$e++){const Ke=4*$e,Ze=Ue.circleArray[Ke+0],it=Ue.circleArray[Ke+1],gt=Ue.circleArray[Ke+2],Lt=Ue.circleArray[Ke+3];ue.emplace(_e++,Ze,it,gt,Lt,0),ue.emplace(_e++,Ze,it,gt,Lt,1),ue.emplace(_e++,Ze,it,gt,Lt,2),ue.emplace(_e++,Ze,it,gt,Lt,3)}(!du||du.length<2*Y)&&(du=function(Ue){const $e=2*Ue,Ke=new n.aP;Ke.resize($e),Ke._trim();for(let Ze=0;Ze<$e;Ze++){const it=6*Ze;Ke.uint16[it+0]=4*Ze+0,Ke.uint16[it+1]=4*Ze+1,Ke.uint16[it+2]=4*Ze+2,Ke.uint16[it+3]=4*Ze+2,Ke.uint16[it+4]=4*Ze+3,Ke.uint16[it+5]=4*Ze+0}return Ke}(Y));const ge=O.createIndexBuffer(du,!0),Oe=O.createVertexBuffer(ue,n.cR.members,!0);for(const Ue of Z){const $e={u_matrix:Ue.transform,u_inv_matrix:Ue.invTransform,u_camera_to_center_distance:(Ne=j).getCameraToCenterDistance(Ue.projection),u_viewport_size:[Ne.width,Ne.height]};pe.draw(h,B.TRIANGLES,Xn.disabled,hr.disabled,h.colorModeForRenderPass(),qn.disabled,$e,s.id,Oe,ge,n.b2.simpleSegment(0,2*Ue.circleOffset,Ue.circleArray.length,Ue.circleArray.length/2),null,j.zoom)}var Ne;Oe.destroy(),ge.destroy()}const Yh=n.a6.mat4.create();function Em(h){const i=h._camera.getWorldToCamera(h.worldSize,1),s=n.a6.mat4.multiply([],i,h.globeMatrix);n.a6.mat4.invert(s,s);const d=[0,0,0],x=[0,1,0,0];return n.a6.vec4.transformMat4(x,x,s),d[0]=x[0],d[1]=x[1],d[2]=x[2],n.a6.vec3.normalize(d,d),d}function Bg({width:h,height:i,anchor:s,textOffset:d,textScale:x},w){const{horizontalAlign:E,verticalAlign:O}=n.by(s),B=-(E-.5)*h,j=-(O-.5)*i,H=n.bx(s,d);return new n.P((B/x+H[0])*w,(j/x+H[1])*w)}function pf(h,i,s,d,x,w,E,O,B,j,H){const Z=h.text.placedSymbolArray,Y=h.text.dynamicLayoutVertexArray,se=h.icon.dynamicLayoutVertexArray,pe={},ue=h.getProjection(),_e=To(O,ue,w),ge=w.elevation,Oe=ue.upVectorScale(O.canonical,w.center.lat,w.worldSize).metersToTile;Y.clear();for(let Ne=0;Ne<Z.length;Ne++){const Ue=Z.get(Ne),{tileAnchorX:$e,tileAnchorY:Ke,numGlyphs:Ze}=Ue,it=Ue.hidden||!Ue.crossTileID||h.allowVerticalPlacement&&!Ue.placedOrientation?null:d[Ue.crossTileID];if(it){let gt=0,Lt=0,wt=0;if(ge){const ui=ge?ge.getAtTileOffset(O,$e,Ke):0,[Ti,Ci,mi]=ue.upVector(O.canonical,$e,Ke);gt=ui*Ti*Oe,Lt=ui*Ci*Oe,wt=ui*mi*Oe}let[vt,ri,hi,Si]=Vi(Ue.projectedAnchorX+gt,Ue.projectedAnchorY+Lt,Ue.projectedAnchorZ+wt,s?_e:E);const Gi=fn(w.getCameraToCenterDistance(ue),Si);let Ki=x.evaluateSizeForFeature(h.textSizeData,j,Ue)*Gi/n.br;s&&(Ki*=h.tilePixelRatio/B);const Wt=Bg(it,Ki);s?({x:vt,y:ri,z:hi}=ue.projectTilePoint($e+Wt.x,Ke+Wt.y,O.canonical),[vt,ri,hi]=Vi(vt+gt,ri+Lt,hi+wt,E)):(i&&Wt._rotate(-w.angle),vt+=Wt.x,ri+=Wt.y,hi=0);const wi=h.allowVerticalPlacement&&Ue.placedOrientation===n.bl.vertical?Math.PI/2:0;for(let ui=0;ui<Ze;ui++)n.bo(Y,vt,ri,hi,wi);H&&Ue.associatedIconIndex>=0&&(pe[Ue.associatedIconIndex]={x:vt,y:ri,z:hi,angle:wi})}else Vs(Ze,Y)}if(H){se.clear();const Ne=h.icon.placedSymbolArray;for(let Ue=0;Ue<Ne.length;Ue++){const $e=Ne.get(Ue),{numGlyphs:Ke}=$e,Ze=pe[Ue];if($e.hidden||!Ze)Vs(Ke,se);else{const{x:it,y:gt,z:Lt,angle:wt}=Ze;for(let vt=0;vt<Ke;vt++)n.bo(se,it,gt,Lt,wt)}}h.icon.dynamicLayoutVertexBuffer.updateData(se)}h.text.dynamicLayoutVertexBuffer.updateData(Y)}function Qu(h,i,s,d,x,w,E={}){const O=s.paint.get("icon-translate"),B=s.paint.get("text-translate"),j=s.paint.get("icon-translate-anchor"),H=s.paint.get("text-translate-anchor"),Z=s.layout.get("icon-rotation-alignment"),Y=s.layout.get("text-rotation-alignment"),se=s.layout.get("icon-pitch-alignment"),pe=s.layout.get("text-pitch-alignment"),ue=s.layout.get("icon-keep-upright"),_e=s.layout.get("text-keep-upright"),ge=s.paint.get("icon-color-saturation"),Oe=s.paint.get("icon-color-contrast"),Ne=s.paint.get("icon-color-brightness-min"),Ue=s.paint.get("icon-color-brightness-max"),$e=s.layout.get("symbol-elevation-reference")==="sea",Ke=h.context,Ze=Ke.gl,it=h.transform,gt=Z==="map",Lt=Y==="map",wt=se==="map",vt=pe==="map",ri=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let hi=!1;const Si=h.depthModeForSublayer(0,Xn.ReadOnly),Gi=[n.am(it.center.lng),n.at(it.center.lat)],Ki=s.layout.get("text-variable-anchor"),Wt=it.projection.name==="globe",wi=[],ui=[0,-1,0];for(const Ti of d){const Ci=i.getTile(Ti),mi=Ci.getBucket(s);if(!mi||mi.projection.name==="mercator"&&Wt||mi.fullyClipped)continue;const Xi=mi.projection.name==="globe",zn=Xi?n.a9(it.zoom):0,$n=To(Ti,mi.getProjection(),it),An=it.calculatePixelsToTileUnitsMatrix(Ci),kn=Ki&&mi.hasTextData(),dn=mi.hasIconTextFit()&&kn&&mi.hasIconData(),tr=mi.getProjection().createInversionMatrix(it,Ti.canonical),dr=ps=>{it.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||h.terrain)&&(ps.push("DEPTH_D24"),ps.push("DEPTH_OCCLUSION"))},Nr=()=>{const ps=gt&&s.layout.get("symbol-placement")!=="point",Er=[];dr(Er);const ts=ps||dn,Gs=s.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&wt&&Er.push("PITCH_WITH_MAP_TERRAIN"),Xi&&(Er.push("PROJECTION_GLOBE_VIEW"),ts&&Er.push("PROJECTED_POS_ON_VIEWPORT")),Gs>0&&Er.push("ICON_TRANSITION"),mi.icon.zOffsetVertexBuffer&&Er.push("Z_OFFSET"),ge===0&&Oe===0&&Ne===0&&Ue===1||Er.push("COLOR_ADJUSTMENT"),mi.sdfIcons&&Er.push("RENDER_SDF");const ea=mi.icon.programConfigurations.get(s.id),qa=h.getOrCreateProgram("symbol",{config:ea,defines:Er}),Mo=Ci.imageAtlasTexture?Ci.imageAtlasTexture.size:[0,0],Wr=mi.iconSizeData,Hr=n.bk(Wr,it.zoom),Yr=wt||it.pitch!==0,is=nn($n,Ci.tileID.canonical,wt,gt,it,mi.getProjection(),An),Es=Ln($n,Ci.tileID.canonical,wt,gt,it,mi.getProjection(),An),Os=h.translatePosMatrix(Es,Ci,O,j,!0),Ro=h.translatePosMatrix($n,Ci,O,j),Tl=ts?Yh:is,xa=gt&&!wt&&!ps;let aa=ui;!Wt&&!it.mercatorFromTransition||gt||(aa=Em(it));const $a=Xi?aa:ui,Za=s.getColorAdjustmentMatrix(ge,Oe,Ne,Ue),ba=Sm(Wr.kind,Hr,xa,wt,h,Ro,Tl,Os,$e,!1,Mo,[0,0],!0,Ti,zn,Gi,tr,$a,mi.getProjection(),Za,Gs),Xa=Ci.imageAtlasTexture?Ci.imageAtlasTexture:null,Pa=s.layout.get("icon-size").constantOr(0)!==1||mi.iconsNeedLinear,ls=mi.sdfIcons||h.options.rotating||h.options.zooming||Pa||Yr?Ze.LINEAR:Ze.NEAREST,Gc=mi.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,hp=h.terrain&&wt&&ps?n.a6.mat4.invert(n.a6.mat4.create(),is):Yh;if(ps&&mi.icon){const Hc=it.elevation,sd=Hc?Hc.getAtTileOffsetFunc(Ti,it.center.lat,it.worldSize,mi.getProjection()):null,Cu=Ei($n,Ci.tileID.canonical,wt,gt,it,mi.getProjection(),An);gr(mi,$n,h,!1,Cu,Es,wt,ue,sd,Ti)}return{program:qa,buffers:mi.icon,uniformValues:ba,atlasTexture:Xa,atlasTextureIcon:null,atlasInterpolation:ls,atlasInterpolationIcon:null,isSDF:mi.sdfIcons,hasHalo:Gc,tile:Ci,labelPlaneMatrixInv:hp}},as=()=>{const ps=Lt&&s.layout.get("symbol-placement")!=="point",Er=[],ts=ps||Ki||dn;h.terrainRenderModeElevated()&&vt&&Er.push("PITCH_WITH_MAP_TERRAIN"),Xi&&(Er.push("PROJECTION_GLOBE_VIEW"),ts&&Er.push("PROJECTED_POS_ON_VIEWPORT")),mi.text.zOffsetVertexBuffer&&Er.push("Z_OFFSET"),mi.iconsInText&&Er.push("RENDER_TEXT_AND_SYMBOL"),Er.push("RENDER_SDF"),dr(Er);const Gs=mi.text.programConfigurations.get(s.id),ea=h.getOrCreateProgram("symbol",{config:Gs,defines:Er});let qa,Mo=[0,0],Wr=null;const Hr=mi.textSizeData;mi.iconsInText&&(Mo=Ci.imageAtlasTexture?Ci.imageAtlasTexture.size:[0,0],Wr=Ci.imageAtlasTexture?Ci.imageAtlasTexture:null,qa=vt||it.pitch!==0||h.options.rotating||h.options.zooming||Hr.kind==="composite"||Hr.kind==="camera"?Ze.LINEAR:Ze.NEAREST);const Yr=Ci.glyphAtlasTexture?Ci.glyphAtlasTexture.size:[0,0],is=s.layout.get("text-size-scale-range"),Es=n.ap(h.scaleFactor,is[0],is[1]),Os=n.bk(Hr,it.zoom,Es),Ro=nn($n,Ci.tileID.canonical,vt,Lt,it,mi.getProjection(),An),Tl=Ln($n,Ci.tileID.canonical,vt,Lt,it,mi.getProjection(),An),xa=h.translatePosMatrix(Tl,Ci,B,H,!0),aa=h.translatePosMatrix($n,Ci,B,H),$a=ts?Yh:Ro,Za=Lt&&!vt&&!ps;let ba=ui;!Wt&&!it.mercatorFromTransition||Lt||(ba=Em(it));const Xa=Sm(Hr.kind,Os,Za,vt,h,aa,$a,xa,$e,!0,Yr,Mo,!0,Ti,zn,Gi,tr,Xi?ba:ui,mi.getProjection(),null,null,Es),Pa=Ci.glyphAtlasTexture?Ci.glyphAtlasTexture:null,ls=Ze.LINEAR,Gc=s.paint.get("text-halo-width").constantOr(1)!==0,hp=h.terrain&&vt&&ps?n.a6.mat4.invert(n.a6.mat4.create(),Ro):Yh;if(ps&&mi.text){const Hc=it.elevation,sd=Hc?Hc.getAtTileOffsetFunc(Ti,it.center.lat,it.worldSize,mi.getProjection()):null,Cu=Ei($n,Ci.tileID.canonical,vt,Lt,it,mi.getProjection(),An);gr(mi,$n,h,!0,Cu,Tl,vt,_e,sd,Ti)}return{program:ea,buffers:mi.text,uniformValues:Xa,atlasTexture:Pa,atlasTextureIcon:Wr,atlasInterpolation:ls,atlasInterpolationIcon:qa,isSDF:!0,hasHalo:Gc,tile:Ci,labelPlaneMatrixInv:hp}},Ur=mi.icon.segments.get().length,vs=mi.text.segments.get().length,Xr=Ur&&!E.onlyText?Nr():null,Ss=vs&&!E.onlyIcons?as():null,br=s.paint.get("icon-opacity").constantOr(1),ds=s.paint.get("text-opacity").constantOr(1);if(ri&&mi.canOverlap){hi=!0;const ps=br&&!E.onlyText?mi.icon.segments.get():[],Er=ds&&!E.onlyIcons?mi.text.segments.get():[];for(const ts of ps)wi.push({segments:new n.b2([ts]),sortKey:ts.sortKey,state:Xr});for(const ts of Er)wi.push({segments:new n.b2([ts]),sortKey:ts.sortKey,state:Ss})}else E.onlyText||wi.push({segments:br?mi.icon.segments:new n.b2([]),sortKey:0,state:Xr}),E.onlyIcons||wi.push({segments:ds?mi.text.segments:new n.b2([]),sortKey:0,state:Ss})}hi&&wi.sort((Ti,Ci)=>Ti.sortKey-Ci.sortKey);for(const Ti of wi){const Ci=Ti.state;if(Ci)if(h.terrain?h.terrain.setupElevationDraw(Ci.tile,Ci.program,{useDepthForOcclusion:it.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ci.labelPlaneMatrixInv}):h.setupDepthForOcclusion(it.depthOcclusionForSymbolsAndCircles,Ci.program),Ke.activeTexture.set(Ze.TEXTURE0),Ci.atlasTexture&&Ci.atlasTexture.bind(Ci.atlasInterpolation,Ze.CLAMP_TO_EDGE,!0),Ci.atlasTextureIcon&&(Ke.activeTexture.set(Ze.TEXTURE1),Ci.atlasTextureIcon&&Ci.atlasTextureIcon.bind(Ci.atlasInterpolationIcon,Ze.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,Ci.program),Ci.hasHalo){const mi=Ci.uniformValues;mi.u_is_halo=1,eh(Ci.buffers,Ti.segments,s,h,Ci.program,Si,x,w,mi,2),mi.u_is_halo=0}else{if(Ci.isSDF){const mi=Ci.uniformValues;Ci.hasHalo&&(mi.u_is_halo=1,eh(Ci.buffers,Ti.segments,s,h,Ci.program,Si,x,w,mi,1)),mi.u_is_halo=0}eh(Ci.buffers,Ti.segments,s,h,Ci.program,Si,x,w,Ci.uniformValues,1)}}}function eh(h,i,s,d,x,w,E,O,B,j){const H=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];x.draw(d,d.context.gl.TRIANGLES,w,E,O,qn.disabled,B,s.id,h.layoutVertexBuffer,h.indexBuffer,i,s.paint,d.transform.zoom,h.programConfigurations.get(s.id),H,j)}function Wd(h,i,s,d,x,w,E){const O=h.context.gl,B=s.paint.get("fill-pattern"),j=s.is3D(),H=j?h.stencilModeFor3D():hr.disabled,Z=B&&B.constantOr(1);let Y,se,pe,ue,_e;E?(se=Z&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=O.LINES):(se=Z?"fillPattern":"fill",Y=O.TRIANGLES);for(const ge of d){const Oe=i.getTile(ge);if(Z&&!Oe.patternsLoaded())continue;const Ne=Oe.getBucket(s);if(!Ne)continue;h.prepareDrawTile();const Ue=Ne.programConfigurations.get(s.id),$e=h.isTileAffectedByFog(ge),Ke=h.getOrCreateProgram(se,{config:Ue,overrideFog:$e});Z&&(h.context.activeTexture.set(O.TEXTURE0),Oe.imageAtlasTexture&&Oe.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ue.updatePaintBuffers());const Ze=B.constantOr(null);if(Ze&&Oe.imageAtlas){const Lt=Oe.imageAtlas.patternPositions[Ze.toString()];Lt&&Ue.setConstantPatternPositions(Lt)}const it=h.translatePosMatrix(ge.projMatrix,Oe,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),gt=s.paint.get("fill-emissive-strength");if(E){ue=Ne.indexBuffer2,_e=Ne.segments2;const Lt=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[O.drawingBufferWidth,O.drawingBufferHeight];pe=se==="fillOutlinePattern"&&Z?zg(it,gt,h,Oe,Lt):$h(it,gt,Lt)}else ue=Ne.indexBuffer,_e=Ne.segments,pe=Z?lf(it,gt,h,Oe):Tm(it,gt);h.uploadCommonUniforms(h.context,Ke,ge.toUnwrapped()),Ke.draw(h,Y,x,j?H:h.stencilModeForClipping(ge),w,qn.disabled,pe,s.id,Ne.layoutVertexBuffer,ue,_e,s.paint,h.transform.zoom,Ue,void 0)}}function Ko(h,i,s,d,x,w,E,O){s.resetLayerRenderingStats(h);const B=h.context,j=B.gl,H=h.transform,Z=s.paint.get("fill-extrusion-pattern"),Y=Z.constantOr(1),se=s.paint.get("fill-extrusion-opacity"),pe=h.style.enable3dLights(),ue=s.paint.get(pe&&!Y?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_e=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue],ge=s.layout.get("fill-extrusion-edge-radius"),Oe=ge>0&&!s.paint.get("fill-extrusion-rounded-roof"),Ne=Oe?0:ge,Ue=H.projection.name==="globe"?n.c_():0,$e=H.projection.name==="globe",Ke=$e?n.a9(H.zoom):0,Ze=[n.am(H.center.lng),n.at(H.center.lat)],it=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(s.lut).toArray01().slice(0,3),gt=s.paint.get("fill-extrusion-flood-light-intensity"),Lt=s.paint.get("fill-extrusion-vertical-scale"),wt=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,vt=s.paint.get("fill-extrusion-height-alignment"),ri=s.paint.get("fill-extrusion-base-alignment"),hi=Ea(h,s.paint.get("fill-extrusion-cutoff-fade-range")),Si=[];let Gi;$e&&Si.push("PROJECTION_GLOBE_VIEW"),_e[0]>0&&Si.push("FAUX_AO"),Oe&&Si.push("ZERO_ROOF_RADIUS"),O&&Si.push("HAS_CENTROID"),gt>0&&Si.push("FLOOD_LIGHT"),hi.shouldRenderCutoff&&Si.push("RENDER_CUTOFF"),wt&&Si.push("RENDER_WALL_MODE");const Ki=h.renderPass==="shadow",Wt=h.shadowRenderer,wi=Ki&&!!Wt;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let ui=[0,0,0];if(Wt){const mi=h.style.directionalLight,Xi=h.style.ambientLight;mi&&Xi&&(ui=nu(h.style,mi,Xi)),Ki||(Si.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Wt.useNormalOffset&&Si.push("NORMAL_OFFSET")),Gi=Si.concat(["SHADOWS_SINGLE_CASCADE"])}const Ti=wi?"fillExtrusionDepth":Y?"fillExtrusionPattern":"fillExtrusion",Ci=s.getLayerRenderingStats();for(const mi of d){const Xi=i.getTile(mi),zn=Xi.getBucket(s);if(!zn||zn.projection.name!==H.projection.name)continue;let $n=!1;Wt&&($n=Wt.getMaxCascadeForTile(mi.toUnwrapped())===0);const An=h.isTileAffectedByFog(mi),kn=zn.programConfigurations.get(s.id),dn=h.getOrCreateProgram(Ti,{config:kn,defines:$n?Gi:Si,overrideFog:An});if(h.terrain&&h.terrain.setupElevationDraw(Xi,dn,{useMeterToDem:!0}),!zn.centroidVertexBuffer){const Xr=dn.attributes.a_centroid_pos;Xr!==void 0&&j.vertexAttrib2f(Xr,0,0)}!Ki&&Wt&&Wt.setupShadows(Xi.tileID.toUnwrapped(),dn,"vector-tile",Xi.tileID.overscaledZ),Y&&(h.context.activeTexture.set(j.TEXTURE0),Xi.imageAtlasTexture&&Xi.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),kn.updatePaintBuffers());const tr=Z.constantOr(null);if(tr&&Xi.imageAtlas){const Xr=Xi.imageAtlas.patternPositions[tr.toString()];Xr&&kn.setConstantPatternPositions(Xr)}const dr=s.paint.get("fill-extrusion-vertical-gradient"),Nr=1/zn.tileToMeter;let as;if(Ki&&Wt){if(Kh(Xi.tileID,zn,h))continue;const Xr=Wt.calculateShadowPassMatrixFromTile(Xi.tileID.toUnwrapped());as=of(Xr,Ne,Nr,Lt,vt,ri)}else{const Xr=h.translatePosMatrix(mi.expandedProjMatrix,Xi,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ss=H.projection.createInversionMatrix(H,mi.canonical);as=Y?af(Xr,h,dr,se,_e,Ne,Nr,mi,Xi,Ue,vt,ri,Ke,Ze,Ss,it,Lt):sf(Xr,h,dr,se,_e,Ne,Nr,mi,Ue,vt,ri,Ke,Ze,Ss,it,Lt,gt,ui)}h.uploadCommonUniforms(B,dn,mi.toUnwrapped(),null,hi);let Ur=zn.segments;if(H.projection.name==="mercator"&&!Ki&&(Ur=zn.getVisibleSegments(Xi.tileID,h.terrain,h.transform.getFrustum(0)),!Ur.get().length))continue;if(Ci)if(Ki)for(const Xr of Ur.get())Ci.numRenderedVerticesInShadowPass+=Xr.primitiveLength;else for(const Xr of Ur.get())Ci.numRenderedVerticesInTransparentPass+=Xr.primitiveLength;const vs=[];(h.terrain||O)&&vs.push(zn.centroidVertexBuffer),$e&&vs.push(zn.layoutVertexExtBuffer),wt&&vs.push(zn.wallVertexBuffer),dn.draw(h,B.gl.TRIANGLES,x,w,E,qn.backCCW,as,s.id,zn.layoutVertexBuffer,zn.indexBuffer,Ur,s.paint,h.transform.zoom,kn,vs)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function Ua(h,i,s,d,x,w,E,O,B,j,H,Z,Y,se,pe,ue,_e,ge,Oe){const Ne=h.context,Ue=Ne.gl,$e=h.transform,Ke=h.transform.zoom,Ze=[],it=Ea(h,s.paint.get("fill-extrusion-cutoff-fade-range"));j==="clear"?(Ze.push("CLEAR_SUBPASS"),Oe&&(Ze.push("CLEAR_FROM_TEXTURE"),Ne.activeTexture.set(Ue.TEXTURE0),Oe.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE))):j==="sdf"&&Ze.push("SDF_SUBPASS"),_e&&Ze.push("HAS_CENTROID"),it.shouldRenderCutoff&&Ze.push("RENDER_CUTOFF");const gt=s.layout.get("fill-extrusion-edge-radius"),Lt=(wt,vt,ri,hi,Si)=>{const Gi=vt.programConfigurations.get(s.id),Ki=h.isTileAffectedByFog(wt),Wt=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:Gi,defines:Ze,overrideFog:Ki}),wi=((Ti,Ci,mi,Xi,zn,$n,An,kn,dn,tr,dr)=>({u_matrix:Ci,u_opacity:mi,u_ao_pass:Xi?1:0,u_meter_to_tile:zn,u_ao:$n,u_flood_light_intensity:An,u_flood_light_color:kn,u_attenuation:dn,u_edge_radius:tr,u_fb:0,u_fb_size:dr,u_dynamic_offset:1}))(0,hi,H,B,Si,[Z,Y*Si],se,pe,ue,Ke>=17?0:gt*Si,Oe?Oe.size[0]:0),ui=[];_e&&ui.push(vt.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(Ne,Wt,wt.toUnwrapped(),null,it),Wt.draw(h,Ne.gl.TRIANGLES,x,w,E,O,wi,s.id,vt.vertexBuffer,vt.indexBuffer,ri,s.paint,Ke,Gi,ui)};for(const wt of d){const vt=i.getTile(wt),ri=vt.getBucket(s);if(!ri||ri.projection.name!==$e.projection.name||!ri.groundEffect||ri.groundEffect&&!ri.groundEffect.hasData())continue;const hi=ri.groundEffect,Si=1/ri.tileToMeter;{const Gi=h.translatePosMatrix(wt.projMatrix,vt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ki=hi.getDefaultSegment();Lt(wt,hi,Ki,Gi,Si)}if(ge)for(let Gi=0;Gi<4;Gi++){const Ki=n.c$[Gi](wt),Wt=i.getTile(Ki);if(!Wt)continue;const wi=Wt.getBucket(s);if(!wi||wi.projection.name!==$e.projection.name||!wi.groundEffect||wi.groundEffect&&!wi.groundEffect.hasData())continue;const ui=wi.groundEffect;let Ti,Ci;Gi===0?(Ti=[-n.ab,0,0],Ci=1):Gi===1?(Ti=[n.ab,0,0],Ci=0):Gi===2?(Ti=[0,-n.ab,0],Ci=3):(Ti=[0,n.ab,0],Ci=2);const mi=ui.regionSegments[Ci];if(!mi)continue;const Xi=new Float32Array(16);n.a6.mat4.translate(Xi,wt.projMatrix,Ti),Lt(wt,ui,mi,h.translatePosMatrix(Xi,vt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Si)}}}function Am(h,i,s,d,x,w,E){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const O=w?w.findDEMTileFor(s):null;if(!(O&&O.dem||E))return;const B=ge=>new n.P(Math.ceil((ge+n.d2)*n.d3),0),j=ge=>{const Oe=i.getSource().minzoom,Ne=$e=>{const Ke=i.getTileByID($e);if(Ke&&Ke.hasData())return Ke.getBucket(x)},Ue=[0,-1,1];for(const $e of Ue){if(ge.overscaledZ+$e<Oe)continue;const Ke=Ne(ge.calculateScaledKey(ge.overscaledZ+$e));if(Ke)return Ke}},H=[0,0,0],Z=(ge,Oe)=>(H[0]=Math.min(ge.min.y,Oe.min.y),H[1]=Math.max(ge.max.y,Oe.max.y),H[2]=n.ab-Oe.min.x>ge.max.x?Oe.min.x-n.ab:ge.max.x,H),Y=(ge,Oe)=>(H[0]=Math.min(ge.min.x,Oe.min.x),H[1]=Math.max(ge.max.x,Oe.max.x),H[2]=n.ab-Oe.min.y>ge.max.y?Oe.min.y-n.ab:ge.max.y,H),se=[(ge,Oe)=>Z(ge,Oe),(ge,Oe)=>Z(Oe,ge),(ge,Oe)=>Y(ge,Oe),(ge,Oe)=>Y(Oe,ge)],pe=(ge,Oe,Ne,Ue,$e,Ke,Ze)=>{if(!w)return 0;const it=[[Ke?Ne:ge,Ke?ge:Ne,0],[Ke?Ne:Oe,Ke?Oe:Ne,0]],gt=Ze<0?n.ab+Ze:Ze,Lt=[Ke?gt:(ge+Oe)/2,Ke?(ge+Oe)/2:gt,0];return Ne===0&&Ze<0||Ne!==0&&Ze>0?w.getForTilePoints($e,[Lt],!0,Ue):it.push(Lt),w.getForTilePoints(s,it,!0,O),Math.max(it[0][2],it[1][2],Lt[2])/w.exaggeration()};for(let ge=0;ge<4;ge++){const Oe=d.borderFeatureIndices[ge];if(Oe.length===0)continue;const Ne=n.c$[ge](s),Ue=j(Ne);if(!(Ue&&Ue instanceof n.d0)||d.borderDoneWithNeighborZ[ge]===Ue.canonical.z)continue;Ue.centroidVertexArray.length===0&&Ue.createCentroidsBuffer();const $e=w?w.findDEMTileFor(Ne):null;if(!($e&&$e.dem||E))continue;const Ke=(ge<2?1:5)-ge,Ze=Ue.borderDoneWithNeighborZ[Ke]!==d.canonical.z,it=Ue.borderFeatureIndices[Ke];let gt=0;if(d.canonical.z!==Ue.canonical.z){for(const Lt of Oe)d.showCentroid(d.featuresOnBorder[Lt]);if(Ze)for(const Lt of it)Ue.showCentroid(Ue.featuresOnBorder[Lt]);d.borderDoneWithNeighborZ[ge]=Ue.canonical.z,Ue.borderDoneWithNeighborZ[Ke]=d.canonical.z}for(const Lt of Oe){const wt=d.featuresOnBorder[Lt],vt=d.centroidData[wt.centroidDataIndex],ri=wt.borders[ge];let hi;for(;gt<it.length;){hi=Ue.featuresOnBorder[it[gt]];const Si=hi.borders[Ke];if(Si[1]>ri[0]+3||Si[0]>ri[0]-3)break;Ue.showCentroid(hi),gt++}if(hi&&gt<it.length){const Si=gt;let Gi=0;for(;!(hi.borders[Ke][0]>ri[1]-3)&&(Gi++,++gt!==it.length);)hi=Ue.featuresOnBorder[it[gt]];hi=Ue.featuresOnBorder[it[Si]];let Ki=!1;if(Gi>=1){const ui=hi.borders[Ke];Math.abs(ri[0]-ui[0])<3&&Math.abs(ri[1]-ui[1])<3&&(Gi=1,Ki=!0,gt=Si+1)}else if(Gi===0){d.showCentroid(wt);continue}const Wt=Ue.centroidData[hi.centroidDataIndex];E&&Ki&&(((ue=vt).flags|(_e=Wt).flags)&n.d1?(ue.flags|=n.d1,_e.flags|=n.d1):(ue.flags&=~n.d1,_e.flags&=~n.d1));const wi=wt.intersectsCount()>1||hi.intersectsCount()>1;if(Gi>1)gt=Si,vt.centroidXY=Wt.centroidXY=new n.P(0,0);else if($e&&$e.dem&&!wi){const ui=se[ge](vt,Wt),Ti=ge%2?n.ab-1:0,Ci=pe(ui[0],Math.min(n.ab-1,ui[1]),Ti,$e,Ne,ge<2,ui[2]);vt.centroidXY=Wt.centroidXY=B(Ci)}else wi?vt.centroidXY=Wt.centroidXY=new n.P(0,0):(vt.centroidXY=d.encodeBorderCentroid(wt),Wt.centroidXY=Ue.encodeBorderCentroid(hi));d.writeCentroidToBuffer(vt),Ue.writeCentroidToBuffer(Wt)}else d.showCentroid(wt)}d.borderDoneWithNeighborZ[ge]=Ue.canonical.z,Ue.borderDoneWithNeighborZ[Ke]=d.canonical.z}var ue,_e;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const ff=[1,0,0],qd=[0,1,0],mf=[0,0,1];function Kh(h,i,s){const d=s.transform,x=s.shadowRenderer;if(!x)return!0;const w=h.toUnwrapped(),E=d.tileSize*x._cascades[s.currentShadowCascade].scale;let O=i.maxHeight;if(d.elevation){const ue=d.elevation.getMinMaxForTile(h);ue&&(O+=ue.max)}const B=[...x.shadowDirection];B[2]=-B[2];const j=x.computeSimplifiedTileShadowVolume(w,O,E,B);if(!j)return!1;const H=[ff,qd,mf,B,[B[0],0,B[2]],[0,B[1],B[2]]],Z=d.projection.name==="globe",Y=d.scaleZoom(E),se=n.bO.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,Y,!Z),pe=x.getCurrentCascadeFrustum();return se.intersectsPrecise(j.vertices,j.planes,H)===0||pe.intersectsPrecise(j.vertices,j.planes,H)===0}function oa(h){return[h[0]*n.d4,h[1]*n.d4,h[2]*n.d4,0]}function Qs(h,i,s,d,x,w,E,O,B){const j=d.getSource(),H=s.globeSharedBuffers;if(!H)return;let Z,Y,se;if(i&&(Z=d.getTile(i)),j instanceof n.aD?(Y=j.texture,se=n.cD(0,0,s.transform)):Z&&i&&(Y=Z.texture,se=n.cD(i.canonical.z,i.canonical.x,s.transform)),!Y||!se)return;h||(se=n.a6.mat4.scale(n.a6.mat4.create(),se,[1,-1,1]));const pe=s.context,ue=pe.gl,_e=x.paint.get("raster-resampling")==="nearest"?ue.NEAREST:ue.LINEAR,ge=s.colorModeForDrapableLayerRenderPass(w),Oe=E.defines;Oe.push("GLOBE_POLES");const Ne=new Xn(ue.LEQUAL,Xn.ReadWrite,s.depthRangeFor3D),Ue=Float32Array.from(s.transform.expandedFarZProjMatrix),$e=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),pe.activeTexture.set(ue.TEXTURE0),Y.bind(_e,ue.CLAMP_TO_EDGE),pe.activeTexture.set(ue.TEXTURE1),Y.bind(_e,ue.CLAMP_TO_EDGE),Y.useMipmap&&pe.extTextureFilterAnisotropic&&s.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,pe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,pe.extTextureFilterAnisotropicMax);const[Ke,Ze,it,gt]=i?H.getPoleBuffers(i.canonical.z,!1):H.getPoleBuffers(0,!0),Lt=x.paint.get("raster-elevation");let wt;h?(wt=Ke,s.renderDefaultNorthPole=Lt!==0):(wt=Ze,s.renderDefaultSouthPole=Lt!==0);const vt=oa(E.mix),ri=((Si,Gi,Ki,Wt,wi,ui,Ti,Ci,mi,Xi,zn,$n,An)=>Vd(Si,Gi,Ki,new Float32Array(16),new Float32Array(9),[0,0],Wt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ui,[0,0],Ci,2,Xi,zn,$n,1,0,An))(Ue,$e,se,n.a9(s.transform.zoom),0,x,0,Lt,0,vt,E.offset,E.range,w),hi=s.getOrCreateProgram("raster",{defines:Oe});s.uploadCommonUniforms(pe,hi,null),hi.draw(s,ue.TRIANGLES,Ne,B,ge,O,ri,x.id,wt,it,gt)}function $d(h){const i=h._nearZ,s=h.projection.farthestPixelDistance(h),d=s-i,x=.2*h.height,w=i+x;return[i,s,(w-x-i)/d,(w-i)/d]}function gf(h,i,s,d){if(h)return i instanceof Xo&&h instanceof ul?i.getTextureDescriptor(h,s,!0):{texture:h.texture,mix:oa(d.mix),offset:d.offset,buffer:0,tileSize:1}}var _f=n.d5([{name:"a_index",type:"Int16",components:1}]);class Zd{constructor(i,s,d,x){const w={width:d[0],height:d[1],data:null},E=i.gl;this.targetColorTexture=new n.T(i,w,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(i,w,E.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(s,x),this.lastInvalidatedAt=0}updateParticleTexture(i,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,x=s.width*s.height;this.particleTexture0=new n.T(this.context,s,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,s,d.RGBA8,{premultiply:!1,useMipmap:!1});const w=new n.d6;w.reserve(x);for(let E=0;E<x;E++)w.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(w,_f.members,!0),this.particleSegment=n.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ic(h,i,s){if(!h)return null;const d=i.getTextureDescriptor(h,s,!0);if(!d)return null;let{texture:x,mix:w,offset:E,tileSize:O,buffer:B,format:j}=d;if(!x||!j)return null;let H=!1;return j==="uint32"&&(H=!0,w[3]=0,w=Ju(n.d7,w,[0,s.paint.get("raster-particle-max-speed")]),E=uu(n.d7,E,[0,s.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[B/(O+2*B),O/(O+2*B)],tileSize:O,scalarData:H,scale:w,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[j]]}}function Ng(h){const i=h._nearZ,s=h.projection.farthestPixelDistance(h),d=s-i,x=.2*h.height,w=i+x;return[i,s,(w-x-i)/d,(w-i)/d]}const Rc=new n.bA(1,0,0,1),th=new n.bA(0,1,0,1),qi=new n.bA(0,0,1,1),yn=new n.bA(1,0,1,1),pu=new n.bA(0,1,1,1);function Ts(h,i,s,d,x,w,E){const O=h.context,B=h.transform,j=O.gl,H=B.projection.name==="globe",Z=H?["PROJECTION_GLOBE_VIEW"]:[];let Y=n.a6.mat4.clone(s.projMatrix);if(H&&n.a9(B.zoom)>0){const vt=n.b5(s.canonical,B),ri=n.d8(vt);Y=n.a6.mat4.multiply(new Float32Array(16),B.globeMatrix,ri),n.a6.mat4.multiply(Y,B.projMatrix,Y)}const se=n.a6.mat4.create();se[12]+=2*x/(n.q.devicePixelRatio*B.width),se[13]+=2*w/(n.q.devicePixelRatio*B.height),n.a6.mat4.multiply(Y,se,Y);const pe=h.getOrCreateProgram("debug",{defines:Z}),ue=i.getTileByID(s.key);h.terrain&&h.terrain.setupElevationDraw(ue,pe);const _e=Xn.disabled,ge=hr.disabled,Oe=h.colorModeForRenderPass(),Ne="$debug";O.activeTexture.set(j.TEXTURE0),h.emptyTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),H?ue._makeGlobeTileDebugBuffers(h.context,B):ue._makeDebugTileBoundsBuffers(h.context,B.projection);const Ue=ue._tileDebugBuffer||h.debugBuffer,$e=ue._tileDebugIndexBuffer||h.debugIndexBuffer,Ke=ue._tileDebugSegments||h.debugSegments;if(pe.draw(h,j.LINE_STRIP,_e,ge,Oe,qn.disabled,cf(Y,d),Ne,Ue,$e,Ke,null,null,null,[ue._globeTileDebugBorderBuffer]),E){const vt=ue.latestRawTileData,ri=Math.floor((vt&&vt.byteLength||0)/1024);let hi=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(hi+=` => ${s.overscaledZ}`),hi+=` ${ue.state}`,hi+=` ${ri}kb`,function(Si,Gi){Si.initDebugOverlayCanvas();const Ki=Si.debugOverlayCanvas,Wt=Si.context.gl,wi=Si.debugOverlayCanvas.getContext("2d");wi.clearRect(0,0,Ki.width,Ki.height),wi.shadowColor="white",wi.shadowBlur=2,wi.lineWidth=1.5,wi.strokeStyle="white",wi.textBaseline="top",wi.font="bold 36px Open Sans, sans-serif",wi.fillText(Gi,5,5),wi.strokeText(Gi,5,5),Si.debugOverlayTexture.update(Ki),Si.debugOverlayTexture.bind(Wt.LINEAR,Wt.CLAMP_TO_EDGE)}(h,hi)}const Ze=i.getTile(s).tileSize,it=512/Math.min(Ze,512)*(s.overscaledZ/B.zoom)*.5,gt=ue._tileDebugTextBuffer||h.debugBuffer,Lt=ue._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,wt=ue._tileDebugTextSegments||h.debugSegments;pe.draw(h,j.TRIANGLES,_e,ge,Ir.alphaBlended,qn.disabled,cf(Y,n.bA.transparent,it),Ne,gt,Lt,wt,null,null,null,[ue._globeTileDebugTextBuffer])}function Jt(h,i,s,d){Va(h,0,i+s/2,h.transform.width,s,d)}function ih(h,i,s,d){Va(h,i-s/2,0,s,h.transform.height,d)}function Va(h,i,s,d,x,w){const E=h.context,O=E.gl;O.enable(O.SCISSOR_TEST),O.scissor(i*n.q.devicePixelRatio,s*n.q.devicePixelRatio,d*n.q.devicePixelRatio,x*n.q.devicePixelRatio),E.clear({color:w}),O.disable(O.SCISSOR_TEST)}const yo=n.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:yl}=yo;function tl(h,i,s,d){h.emplaceBack(i,s,d)}class Pc{constructor(i){this.vertexArray=new n.d9,this.indices=new n.aP,tl(this.vertexArray,-1,-1,1),tl(this.vertexArray,1,-1,1),tl(this.vertexArray,-1,1,1),tl(this.vertexArray,1,1,1),tl(this.vertexArray,-1,-1,-1),tl(this.vertexArray,1,-1,-1),tl(this.vertexArray,-1,1,-1),tl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,yl),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=n.b2.simpleSegment(0,0,36,12)}}function ya(h,i,s,d,x,w){const E=h.context.gl,O=i.paint.get("sky-atmosphere-color"),B=i.paint.get("sky-atmosphere-halo-color"),j=i.paint.get("sky-atmosphere-sun-intensity"),H=((Z,Y,se,pe,ue)=>({u_matrix_3f:Z,u_sun_direction:Y,u_sun_intensity:se,u_color_tint_r:[pe.r,pe.g,pe.b,pe.a],u_color_tint_m:[ue.r,ue.g,ue.b,ue.a],u_luminance:5e-5}))(n.a6.mat3.fromMat4(n.a6.mat3.create(),d),x,j,O,B);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),s.draw(h,E.TRIANGLES,Xn.disabled,hr.disabled,Ir.unblended,qn.frontCW,H,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const nh=n.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class rh{constructor(i){const s=new n.da;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const d=new n.aP;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(s,nh.members),this.indexBuffer=i.createIndexBuffer(d),this.segments=n.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const fu=n.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Dc{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Xd{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Ir([1,sa,1,sa],n.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ir([1,0,1,0],n.bA.transparent,[!1,!1,!1,!0]),this.params=new Dc,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const s=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new rh(s);const d=this.params.sizeRange,x=this.params.intensityRange,w=function(H){const Z=n.dd(30),Y=[];for(let se=0;se<H;++se){const pe=2*Math.PI*Z(),ue=Math.acos(1-2*Z())-.5*Math.PI;Y.push(n.a6.vec3.fromValues(Math.cos(ue)*Math.cos(pe),Math.cos(ue)*Math.sin(pe),Math.sin(ue)))}return Y}(this.params.starsCount),E=n.dd(300),O=new n.db,B=new n.aP;let j=0;for(let H=0;H<w.length;++H){const Z=n.a6.vec3.scale([],w[H],200),Y=Math.max(0,1+.01*d*(1*E()-.5)),se=Math.max(0,1+.01*x*(1*E()-.5));O.emplaceBack(Z[0],Z[1],Z[2],-1,-1,Y,se),O.emplaceBack(Z[0],Z[1],Z[2],1,-1,Y,se),O.emplaceBack(Z[0],Z[1],Z[2],1,1,Y,se),O.emplaceBack(Z[0],Z[1],Z[2],-1,1,Y,se),B.emplaceBack(j+0,j+1,j+2),B.emplaceBack(j+0,j+2,j+3),j+=4}this.starsVx=s.createVertexBuffer(O,fu.members),this.starsIdx=s.createIndexBuffer(B),this.starsSegments=n.b2.simpleSegment(0,0,O.length,B.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,s){const d=i.context,x=d.gl,w=i.transform,E=new Xn(x.LEQUAL,Xn.ReadOnly,[0,1]),O=n.a9(w.zoom),B=i.style.getLut(s.scope),j=s.properties.get("color").toRenderColor(B).toArray01(),H=s.properties.get("high-color").toRenderColor(B).toArray01(),Z=s.properties.get("space-color").toRenderColor(B).toArray01PremultipliedAlpha(),Y=5e-4,se=n.dc(s.properties.get("horizon-blend"),0,1,Y,.25),pe=n.cx(i,d,w)&&se===Y?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,ue=i.frameCounter/1e3%1,_e=n.a6.vec3.length(w.globeCenterInViewSpace),ge=Math.sqrt(Math.pow(_e,2)-Math.pow(pe,2)),Oe=Math.acos(ge/_e),Ne=Ue=>{const $e=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ue&&$e.push("ALPHA_PASS");const Ke=i.getOrCreateProgram("globeAtmosphere",{defines:$e}),Ze=((gt,Lt,wt,vt,ri,hi,Si,Gi,Ki,Wt,wi,ui)=>({u_frustum_tl:gt,u_frustum_tr:Lt,u_frustum_br:wt,u_frustum_bl:vt,u_horizon:ri,u_transition:hi,u_fadeout_range:Si,u_color:Gi,u_high_color:Ki,u_space_color:Wt,u_temporal_offset:wi,u_horizon_angle:ui}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,O,se,j,H,Z,ue,Oe);i.uploadCommonUniforms(d,Ke);const it=this.atmosphereBuffer;it&&Ke.draw(i,x.TRIANGLES,E,hr.disabled,Ue?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,qn.backCW,Ze,Ue?"atmosphere_glow_alpha":"atmosphere_glow",it.vertexBuffer,it.indexBuffer,it.segments)};Ne(!1),Ne(!0)}drawStars(i,s){const d=n.ap(s.properties.get("star-intensity"),0,1);if(d===0)return;const x=i.context,w=x.gl,E=i.transform,O=i.getOrCreateProgram("stars"),B=n.a6.quat.identity([]);n.a6.quat.rotateX(B,B,-E._pitch),n.a6.quat.rotateZ(B,B,-E.angle),n.a6.quat.rotateX(B,B,n.bC(E._center.lat)),n.a6.quat.rotateY(B,B,-n.bC(E._center.lng));const j=n.a6.mat4.fromQuat(new Float32Array(16),B),H=n.a6.mat4.multiply([],E.starsProjMatrix,j),Z=n.a6.mat3.fromMat4([],j),Y=n.a6.mat3.invert([],Z),se=[0,1,0];n.a6.vec3.transformMat3(se,se,Y),n.a6.vec3.scale(se,se,this.params.sizeMultiplier);const pe=[1,0,0];n.a6.vec3.transformMat3(pe,pe,Y),n.a6.vec3.scale(pe,pe,this.params.sizeMultiplier);const ue=(_e=se,ge=pe,Oe=d,{u_matrix:Float32Array.from(H),u_up:_e,u_right:ge,u_intensity_multiplier:Oe});var _e,ge,Oe;i.uploadCommonUniforms(x,O),this.starsVx&&this.starsIdx&&O.draw(i,w.TRIANGLES,Xn.disabled,hr.disabled,this.colorModeAlphaBlendedWriteRGB,qn.disabled,ue,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function sh(h,i){const s=[...h],d=i.cameraWorldSizeForFog/i.worldSize,x=n.a6.mat4.identity([]);return n.a6.mat4.scale(x,x,[d,d,1]),n.a6.mat4.multiply(s,x,s),n.a6.mat4.multiply(s,i.worldToFogMatrix,s),s}function Oc(h,i,s,d,x){const w=s.material,E=d.context,{baseColorTexture:O,metallicRoughnessTexture:B}=w.pbrMetallicRoughness,{normalTexture:j,occlusionTexture:H,emissionTexture:Z}=w;function Y(pe,ue,_e){if(pe&&(h.push(ue),E.activeTexture.set(E.gl.TEXTURE0+_e),pe.gfxTexture)){const{minFilter:ge,magFilter:Oe,wrapS:Ne,wrapT:Ue}=pe.sampler;pe.gfxTexture.bindExtraParam(ge,Oe,Ne,Ue)}}Y(O,"HAS_TEXTURE_u_baseColorTexture",ao.BaseColor),Y(B,"HAS_TEXTURE_u_metallicRoughnessTexture",ao.MetallicRoughness),Y(j,"HAS_TEXTURE_u_normalTexture",ao.Normal),Y(H,"HAS_TEXTURE_u_occlusionTexture",ao.Occlusion),Y(Z,"HAS_TEXTURE_u_emissionTexture",ao.Emission),x&&(x.texture||(x.texture=new n.df(d.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+ao.LUT),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(s.texcoordBuffer)),s.colorBuffer&&(h.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(s.colorBuffer)),s.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(s.normalBuffer)),s.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(s.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES");const se=d.shadowRenderer;se&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),se.useNormalOffset&&h.push("NORMAL_OFFSET"))}function Bl(h,i,s,d,x,w){const E=s.paint.get("model-opacity"),O=i.context,B=new Xn(i.context.gl.LEQUAL,Xn.ReadWrite,i.depthRangeFor3D),j=i.transform,H=h.mesh,Z=H.material,Y=Z.pbrMetallicRoughness,se=i.style.fog;let pe;pe=i.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:n.a6.mat4.multiply([],d.zScaleMatrix,h.nodeModelMatrix),n.a6.mat4.multiply(pe,d.negCameraPosMatrix,pe);const ue=n.a6.mat4.invert([],pe);n.a6.mat4.transpose(ue,ue);const _e=s.paint.get("model-emissive-strength").constantOr(0),ge=Xh(new Float32Array(h.worldViewProjection),new Float32Array(pe),new Float32Array(ue),null,i,E,Y.baseColorFactor.toRenderColor(null),Z.emissiveFactor,Y.metallicFactor,Y.roughnessFactor,Z,_e,s),Oe={defines:[]},Ne=[],Ue=i.shadowRenderer;Ue&&(Ue.useNormalOffset=!1),Oc(Oe.defines,Ne,H,i,s.lut);let $e=null;if(se){const it=sh(h.nodeModelMatrix,i.transform);if($e=new Float32Array(it),j.projection.name!=="globe"){const gt=H.aabb.min,Lt=H.aabb.max,[wt,vt]=se.getOpacityForBounds(it,gt[0],gt[1],Lt[0],Lt[1]);Oe.overrideFog=wt>=Pi||vt>=Pi}}const Ke=Ea(i,s.paint.get("model-cutoff-fade-range"));Ke.shouldRenderCutoff&&Oe.defines.push("RENDER_CUTOFF");const Ze=i.getOrCreateProgram("model",Oe);i.uploadCommonUniforms(O,Ze,null,$e,Ke),i.renderPass!=="shadow"&&Ue&&Ue.setupShadowsFromMatrix(h.nodeModelMatrix,Ze),Ze.draw(i,O.gl.TRIANGLES,B,x,w,H.material.doubleSided?qn.disabled:qn.backCCW,ge,s.id,H.vertexBuffer,H.indexBuffer,H.segments,s.paint,i.transform.zoom,void 0,Ne)}function oh(h,i,s,d,x,w,E){let O;O=h.projection.name==="globe"?n.dg(s,h):[...s],n.a6.mat4.multiply(O,O,i.matrix);const B=n.a6.mat4.multiply([],d,O);if(i.meshes)for(const j of i.meshes){if(j.material.alphaMode!=="BLEND"){E.push({mesh:j,depth:0,modelIndex:x,worldViewProjection:B,nodeModelMatrix:O});continue}const H=n.a6.vec3.transformMat4([],j.centroid,B);H[2]>0&&w.push({mesh:j,depth:H[2],modelIndex:x,worldViewProjection:B,nodeModelMatrix:O})}if(i.children)for(const j of i.children)oh(h,j,s,d,x,w,E)}function ah(h,i,s,d){const x=s.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),O=x.calculateShadowPassMatrixFromMatrix(i),B=uf(O);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,w,hr.disabled,E,qn.backCCW,B,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,s.transform.zoom,void 0,void 0)}function yf(h,i,s){const d=i.updateZoomBasedPaintProperties(),x=function(w,E,O){let B,j,H,Z=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&Z>0){const Y=w.terrain,se=Y.findDEMTileFor(O);se&&se.dem?B=n.di.create(Y,O,se):Z=0}if(Z===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),Z===E.validForExaggeration&&(Z===0||B&&B._demTile&&B._demTile.tileID===E.validForDEMTile.id&&B._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const Y in E.instancesPerModel){const se=E.instancesPerModel[Y];for(let pe=0;pe<se.instancedDataArray.length;++pe){const ue=(B?Z*B.getElevationAt(0|se.instancedDataArray.float32[16*pe],0|se.instancedDataArray.float32[16*pe+1],!0,!0):0)+se.instancesEvaluatedElevation[pe];se.instancedDataArray.float32[16*pe+6]=ue,j=j?Math.min(E.terrainElevationMin,ue):ue,H=H?Math.max(E.terrainElevationMax,ue):ue}}return E.terrainElevationMin=j||0,E.terrainElevationMax=H||0,E.validForExaggeration=Z,E.validForDEMTile=B&&B._demTile?{id:B._demTile.tileID,timestamp:B._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,i,s);(d||x)&&(i.uploaded=!1,i.upload(h.context))}const Ga={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.ca([0,0,0],[n.ab,n.ab,0])};function $o(h,i){const s=1<<h.canonical.z,d=i.getFreeCameraOptions().position,x=i.elevation,w=h.canonical.x/s,E=(h.canonical.x+1)/s,O=h.canonical.y/s,B=(h.canonical.y+1)/s;let j=i._centerAltitude;if(x){const se=x.getMinMaxForTile(h);se&&se.max>j&&(j=se.max)}const H=n.ap(d.x,w,E)-d.x,Z=n.ap(d.y,O,B)-d.y,Y=n.bE(j,i.center.lat)-d.z;return i._zoomFromMercatorZ(Math.sqrt(H*H+Z*Z+Y*Y))}function Jh(h,i,s,d,x,w,E){const O=h.context,B=h.renderPass==="shadow",j=h.shadowRenderer,H=B&&j?j.getShadowPassDepthMode():new Xn(O.gl.LEQUAL,Xn.ReadWrite,h.depthRangeFor3D),Z=h.isTileAffectedByFog(w);if(s.meshes)for(const Y of s.meshes){const se=["MODEL_POSITION_ON_GPU"],pe=[];let ue,_e,ge;d.instancedDataArray.length>20&&se.push("INSTANCED_ARRAYS");const Oe=Ea(h,i.paint.get("model-cutoff-fade-range"));if(Oe.shouldRenderCutoff&&se.push("RENDER_CUTOFF"),B&&j)ue=h.getOrCreateProgram("modelDepth",{defines:se}),_e=uf(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(s.matrix)),ge=j.getShadowPassColorMode();else{Oc(se,pe,Y,h,i.lut),ue=h.getOrCreateProgram("model",{defines:se,overrideFog:Z});const Ue=Y.material,$e=Ue.pbrMetallicRoughness,Ke=i.paint.get("model-opacity"),Ze=i.paint.get("model-emissive-strength").constantOr(0);_e=Xh(w.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,h,Ke,$e.baseColorFactor.toRenderColor(null),Ue.emissiveFactor,$e.metallicFactor,$e.roughnessFactor,Ue,Ze,i,x),j&&(E.shadowUniformsInitialized?ue.setShadowUniformValues(O,j.getShadowUniformValues()):(j.setupShadows(w.toUnwrapped(),ue,"model-tile",w.overscaledZ),E.shadowUniformsInitialized=!0)),ge=Oe.shouldRenderCutoff||Ke<1||Ue.alphaMode!=="OPAQUE"?Ir.alphaBlended:Ir.unblended}h.uploadCommonUniforms(O,ue,w.toUnwrapped(),null,Oe);const Ne=Y.material.doubleSided?qn.disabled:qn.backCCW;if(d.instancedDataArray.length>20)pe.push(d.instancedDataBuffer),ue.draw(h,O.gl.TRIANGLES,H,hr.disabled,ge,Ne,_e,i.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,i.paint,h.transform.zoom,void 0,pe,d.instancedDataArray.length);else{const Ue=B?"u_instance":"u_normal_matrix";for(let $e=0;$e<d.instancedDataArray.length;++$e)_e[Ue]=new Float32Array(d.instancedDataArray.arrayBuffer,64*$e,16),ue.draw(h,O.gl.TRIANGLES,H,hr.disabled,ge,Ne,_e,i.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,i.paint,h.transform.zoom,void 0,pe)}}if(s.children)for(const Y of s.children)Jh(h,i,Y,d,x,w,E)}const lh=[1,-1,1];function Ds(h,i,s,d){if(!s.modelManager)return!0;const x=s.modelManager;if(!s.shadowRenderer)return!0;const w=s.shadowRenderer,E=i.aabb;let O=!0,B=h.maxHeight;if(B===0){let H=0;for(const Z in h.instancesPerModel){const Y=x.getModel(Z,d);Y?H=Math.max(H,Math.max(Math.max(Y.aabb.max[0],Y.aabb.max[1]),Y.aabb.max[2])):O=!1}B=h.maxScale*H*1.41+h.maxVerticalOffset,O&&(h.maxHeight=B)}E.max[2]=B,E.min[2]+=h.terrainElevationMin,E.max[2]+=h.terrainElevationMax,n.a6.vec3.transformMat4(E.min,E.min,i.tileMatrix),n.a6.vec3.transformMat4(E.max,E.max,i.tileMatrix);const j=E.intersects(w.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=j===2),j===0}function Qr(h,i){const s=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],x=h.uniformValues.u_cutoff_params[2],w=h.uniformValues.u_cutoff_params[3];return d===s||w===x?1:n.ap(((i-s)/(d-s)-x)/(w-x),0,1)}function vf(h,i,s,d){if(i.pitch<20)return 1;const x=i.getWorldToCameraMatrix();n.a6.mat4.multiply(x,x,h);const w=n.a6.vec4.fromValues(s.min[0],s.min[1],s.min[2],1);let E=n.a6.vec4.transformMat4(n.a6.vec4.create(),w,x),O=E,B=E;w[1]=s.max[1],E=n.a6.vec4.transformMat4(n.a6.vec4.create(),w,x),O=E[1]<O[1]?E:O,B=E[1]>B[1]?E:B,w[0]=s.max[0],E=n.a6.vec4.transformMat4(n.a6.vec4.create(),w,x),O=E[1]<O[1]?E:O,B=E[1]>B[1]?E:B,w[1]=s.min[1],E=n.a6.vec4.transformMat4(n.a6.vec4.create(),w,x),O=E[1]<O[1]?E:O,B=E[1]>B[1]?E:B;const j=n.ap(d[0],0,1),H=100*i.pixelsPerMeter*n.ap(d[1],0,1),Z=n.ap(d[2],0,1),Y=n.a6.vec4.lerp(n.a6.vec4.create(),O,B,j),se=Math.tan(.5*i.fovX),pe=-Y[2]*se;if(H===0)return Y[1]<-Math.abs(pe)?Z:1;const ue=(-Math.abs(pe)-Y[1])/H,_e=(Oe,Ne,Ue)=>(1-Ue)*Oe+Ue*Ne,ge=n.ap(_e(1,Z,ue),Z,1);return _e(1,ge,n.ap((i.pitch-20)/20,0,1))}class ec{}class Yd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,s,d){{const Z=this._storage.get(s.id);if(Z)return Z.lastUsedFrameIdx=i,Z.buf}const x=d.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(w),O=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const B=new n.dk;for(let Z=0;Z<w/2;Z+=3){const Y=O[Z],se=O[Z+1],pe=O[Z+2];B.emplaceBack(Y,se),B.emplaceBack(se,pe),B.emplaceBack(pe,Y)}const j=d.bindVertexArrayOES.current,H=new ec;return H.buf=new Ia(d,B),H.lastUsedFrameIdx=i,this._storage.set(s.id,H),d.bindVertexArrayOES.set(j),H.buf}update(i){for(const[s,d]of this._storage)i-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(s))}destroy(){for(const[i,s]of this._storage)s.buf.destroy(),this._storage.delete(i)}}class mu{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class ch{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const zc={symbol:function(h,i,s,d,x){if(h.renderPass!=="translucent")return;const w=hr.disabled,E=h.colorModeForRenderPass(),O=s.layout.get("text-variable-anchor"),B=s.layout.get("text-size-scale-range"),j=n.ap(h.scaleFactor,B[0],B[1]);O&&function(Y,se,pe,ue,_e,ge,Oe,Ne){const Ue=se.transform,$e=_e==="map",Ke=ge==="map";for(const Ze of Y){const it=ue.getTile(Ze),gt=it.getBucket(pe);if(!gt||!gt.text||!gt.text.segments.get().length)continue;const Lt=n.bk(gt.textSizeData,Ue.zoom,Ne),wt=To(Ze,gt.getProjection(),Ue),vt=Ue.calculatePixelsToTileUnitsMatrix(it),ri=nn(wt,it.tileID.canonical,Ke,$e,Ue,gt.getProjection(),vt),hi=gt.hasIconTextFit()&&gt.hasIconData();if(Lt){const Si=Math.pow(2,Ue.zoom-it.tileID.overscaledZ);pf(gt,$e,Ke,Oe,n.cS,Ue,ri,Ze,Si,Lt,hi)}}}(d,h,s,i,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),x,j);const H=s.paint.get("icon-opacity").constantOr(1)!==0,Z=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(H||Z)?Qu(h,i,s,d,w,E):(H&&Qu(h,i,s,d,w,E,{onlyIcons:!0}),Z&&Qu(h,i,s,d,w,E,{onlyText:!0})),i.map.showCollisionBoxes&&(jd(h,i,s,d,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),jd(h,i,s,d,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(h,i,s,d){if(h.renderPass!=="translucent")return;const x=s.paint.get("circle-opacity"),w=s.paint.get("circle-stroke-width"),E=s.paint.get("circle-stroke-opacity"),O=s.layout.get("circle-sort-key").constantOr(1)!==void 0,B=s.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||E.constantOr(1)===0))return;const j=h.context,H=j.gl,Z=h.transform,Y=h.depthModeForSublayer(0,Xn.ReadOnly),se=hr.disabled,pe=h.colorModeForDrapableLayerRenderPass(B),ue=Z.projection.name==="globe",_e=[n.am(Z.center.lng),n.at(Z.center.lat)],ge=[];for(let Ne=0;Ne<d.length;Ne++){const Ue=d[Ne],$e=i.getTile(Ue),Ke=$e.getBucket(s);if(!Ke||Ke.projection.name!==Z.projection.name)continue;const Ze=Ke.programConfigurations.get(s.id),it=n.cT(s),gt=h.isTileAffectedByFog(Ue);ue&&it.push("PROJECTION_GLOBE_VIEW"),it.push("DEPTH_D24"),h.terrain&&Z.depthOcclusionForSymbolsAndCircles&&it.push("DEPTH_OCCLUSION");const Lt=h.getOrCreateProgram("circle",{config:Ze,defines:it,overrideFog:gt}),wt=Ke.layoutVertexBuffer,vt=Ke.globeExtVertexBuffer,ri=Ke.indexBuffer,hi=Z.projection.createInversionMatrix(Z,Ue.canonical),Si={programConfiguration:Ze,program:Lt,layoutVertexBuffer:wt,globeExtVertexBuffer:vt,indexBuffer:ri,uniformValues:n.cU(h,Ue,$e,hi,_e,s),tile:$e};if(O){const Gi=Ke.segments.get();for(const Ki of Gi)ge.push({segments:new n.b2([Ki]),sortKey:Ki.sortKey,state:Si})}else ge.push({segments:Ke.segments,sortKey:0,state:Si})}O&&ge.sort((Ne,Ue)=>Ne.sortKey-Ue.sortKey);const Oe={useDepthForOcclusion:Z.depthOcclusionForSymbolsAndCircles};for(const Ne of ge){const{programConfiguration:Ue,program:$e,layoutVertexBuffer:Ke,globeExtVertexBuffer:Ze,indexBuffer:it,uniformValues:gt,tile:Lt}=Ne.state,wt=Ne.segments;h.terrain&&h.terrain.setupElevationDraw(Lt,$e,Oe),h.uploadCommonUniforms(j,$e,Lt.tileID.toUnwrapped()),$e.draw(h,H.TRIANGLES,Y,se,pe,qn.disabled,gt,s.id,Ke,it,wt,s.paint,Z.zoom,Ue,[Ze])}},heatmap:function(h,i,s,d){if(s.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const x=h.context,w=x.gl,E=hr.disabled,O=new Ir([w.ONE,w.ONE,w.ONE,w.ONE],n.bA.transparent,[!0,!0,!0,!0]);(function(se,pe,ue,_e){const ge=se.gl,Oe=pe.width*_e,Ne=pe.height*_e;se.activeTexture.set(ge.TEXTURE1),se.viewport.set([0,0,Oe,Ne]);let Ue=ue.heatmapFbo;if(!Ue||Ue&&(Ue.width!==Oe||Ue.height!==Ne)){Ue&&Ue.destroy();const $e=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,$e),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Ue=ue.heatmapFbo=se.createFramebuffer(Oe,Ne,!0,null),function(Ke,Ze,it,gt,Lt,wt){const vt=Ke.gl;vt.texImage2D(vt.TEXTURE_2D,0,Ke.extRenderToTextureHalfFloat?vt.RGBA16F:vt.RGBA,Lt,wt,0,vt.RGBA,Ke.extRenderToTextureHalfFloat?vt.HALF_FLOAT:vt.UNSIGNED_BYTE,null),gt.colorAttachment.set(it)}(se,0,$e,Ue,Oe,Ne)}else ge.bindTexture(ge.TEXTURE_2D,Ue.colorAttachment.get()),se.bindFramebuffer.set(Ue.framebuffer)})(x,h,s,h.transform.projection.name==="globe"?.5:.25),x.clear({color:n.bA.transparent});const B=h.transform,j=B.projection.name==="globe",H=j?["PROJECTION_GLOBE_VIEW"]:[],Z=j?qn.frontCCW:qn.disabled,Y=[n.am(B.center.lng),n.at(B.center.lat)];for(let se=0;se<d.length;se++){const pe=d[se];if(i.hasRenderableParent(pe))continue;const ue=i.getTile(pe),_e=ue.getBucket(s);if(!_e||_e.projection.name!==B.projection.name)continue;const ge=h.isTileAffectedByFog(pe),Oe=_e.programConfigurations.get(s.id),Ne=h.getOrCreateProgram("heatmap",{config:Oe,defines:H,overrideFog:ge}),{zoom:Ue}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ue,Ne),h.uploadCommonUniforms(x,Ne,pe.toUnwrapped());const $e=B.projection.createInversionMatrix(B,pe.canonical);Ne.draw(h,w.TRIANGLES,Xn.disabled,E,O,Z,Ud(h,pe,ue,$e,Y,Ue,s.paint.get("heatmap-intensity")),s.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,s.paint,h.transform.zoom,Oe,j?[_e.globeExtVertexBuffer]:null)}x.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(x,w){const E=x.context,O=E.gl,B=w.heatmapFbo;if(!B)return;E.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,B.colorAttachment.get()),E.activeTexture.set(O.TEXTURE1);let j=w.colorRampTexture;j||(j=w.colorRampTexture=new n.T(E,w.colorRamp,O.RGBA8)),j.bind(O.LINEAR,O.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,O.TRIANGLES,Xn.disabled,hr.disabled,x.colorModeForRenderPass(),qn.disabled,((H,Z,Y,se)=>({u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(h,s))},line:function(h,i,s,d){if(h.renderPass!=="translucent")return;const x=s.paint.get("line-opacity"),w=s.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const E=s.paint.get("line-emissive-strength"),O=s.paint.get("line-occlusion-opacity"),B=s.layout.get("line-elevation-reference")==="sea",j=h.context,H=j.gl,Z=!s.isDraped();if(Z&&h.transform.projection.name==="globe")return;const Y=s.layout.get("line-cross-slope"),se=Y!==void 0,pe=Y<1,ue=Z?new Xn(h.depthOcclusion?H.GREATER:H.LEQUAL,Xn.ReadOnly,h.depthRangeFor3D):h.depthModeForSublayer(0,Xn.ReadOnly),_e=h.colorModeForDrapableLayerRenderPass(E),ge=h.terrain&&h.terrain.renderingToTexture,Oe=ge?1:n.q.devicePixelRatio,Ne=s.paint.get("line-dasharray"),Ue=Ne.constantOr(1),$e=s.layout.get("line-cap"),Ke=Ne.constantOr(null),Ze=$e.constantOr(null),it=s.paint.get("line-pattern"),gt=it.constantOr(1),Lt=it.constantOr(null),wt=s.paint.get("line-opacity").constantOr(1);let vt=!gt&&wt!==1||h.depthOcclusion&&O>0&&O<1;const ri=s.paint.get("line-gradient"),hi=gt?"linePattern":"line",Si=n.cV(s);let Gi;if(ge&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(vt=!1),O!==0&&h.depthOcclusion){const Wt=s.paint._values["line-opacity"];Wt&&Wt.value&&Wt.value.kind==="constant"?Gi=Wt.value:n.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}if(Z&&(h.forceTerrainMode=!0),!Z&&O!==0&&h.terrain&&!ge)return void n.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`);const Ki=vt&&Z?h.stencilModeFor3D():hr.disabled;Z&&(Si.push("ELEVATED"),se&&Si.push(pe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),B&&Si.push("ELEVATION_REFERENCE_SEA"));for(const Wt of d){const wi=i.getTile(Wt);if(gt&&!wi.patternsLoaded())continue;const ui=wi.getBucket(s);if(!ui)continue;h.prepareDrawTile();const Ti=ui.programConfigurations.get(s.id),Ci=h.isTileAffectedByFog(Wt),mi=h.getOrCreateProgram(hi,{config:Ti,defines:Si,overrideFog:Ci,overrideRtt:!Z&&void 0});if(Lt&&wi.imageAtlas){const dn=wi.imageAtlas.patternPositions[Lt.toString()];dn&&Ti.setConstantPatternPositions(dn)}if(!gt&&Ke&&Ze&&wi.lineAtlas){const dn=wi.lineAtlas.getDash(Ke,Ze);dn&&Ti.setConstantPatternPositions(dn)}let[Xi,zn]=s.paint.get("line-trim-offset");(Ze==="round"||Ze==="square")&&Xi!==zn&&(Xi===0&&(Xi-=1),zn===1&&(zn+=1));const $n=ge?Wt.projMatrix:null,An=gt?n.cW(h,wi,s,$n,Oe,[Xi,zn]):n.cX(h,wi,s,$n,ui.lineClipsArray.length,Oe,[Xi,zn]);if(ri){const dn=ui.gradients[s.id];let tr=dn.texture;if(s.gradientVersion!==dn.version){let dr=256;if(s.stepInterpolant){const Nr=i.getSource().maxzoom,as=Wt.canonical.z===Nr?Math.ceil(1<<h.transform.maxZoom-Wt.canonical.z):1;dr=n.ap(n.cY(ui.maxLineLength/n.ab*1024*as),256,j.maxTextureSize)}dn.gradient=n.cZ({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:dr,image:dn.gradient||void 0,clips:ui.lineClipsArray}),dn.texture?dn.texture.update(dn.gradient):dn.texture=new n.T(j,dn.gradient,H.RGBA8),dn.version=s.gradientVersion,tr=dn.texture}j.activeTexture.set(H.TEXTURE1),tr.bind(s.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}Ue&&(j.activeTexture.set(H.TEXTURE0),wi.lineAtlasTexture&&wi.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),Ti.updatePaintBuffers()),gt&&(j.activeTexture.set(H.TEXTURE0),wi.imageAtlasTexture&&wi.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ti.updatePaintBuffers()),Z&&!B&&h.terrain.setupElevationDraw(wi,mi),h.uploadCommonUniforms(j,mi,Wt.toUnwrapped());const kn=dn=>{Gi!=null&&(Gi.value=wt*O),mi.draw(h,H.TRIANGLES,ue,dn,_e,qn.disabled,An,s.id,ui.layoutVertexBuffer,ui.indexBuffer,ui.segments,s.paint,h.transform.zoom,Ti,[ui.layoutVertexBuffer2,ui.patternVertexBuffer,ui.zOffsetVertexBuffer]),Gi!=null&&(Gi.value=wt)};if(vt&&!Z){const dn=h.stencilModeForClipping(Wt).ref;dn===0&&ge&&j.clear({stencil:0});const tr={func:H.EQUAL,mask:255};An.u_alpha_discard_threshold=.8,kn(new hr(tr,dn,255,H.KEEP,H.KEEP,H.INVERT)),An.u_alpha_discard_threshold=0,kn(new hr(tr,dn,255,H.KEEP,H.KEEP,H.KEEP))}else vt&&Z&&(An.u_alpha_discard_threshold=.001),kn(Z?Ki:h.stencilModeForClipping(Wt))}Z&&(h.forceTerrainMode=!1),vt&&(h.resetStencilClippingMasks(),ge&&j.clear({stencil:0})),O===0||h.depthOcclusion||ge||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,i,s,d){const x=s.paint.get("fill-color"),w=s.paint.get("fill-opacity"),E=s.is3D(),O=new Xn(h.context.gl.LEQUAL,Xn.ReadWrite,h.depthRangeFor3D);if(w.constantOr(1)===0)return;const B=s.paint.get("fill-emissive-strength"),j=h.colorModeForDrapableLayerRenderPass(B),H=s.paint.get("fill-pattern"),Z=h.opaquePassEnabledForLayer()&&!H.constantOr(1)&&x.constantOr(n.bA.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===Z){const Y=E?O:h.depthModeForSublayer(1,h.renderPass==="opaque"?Xn.ReadWrite:Xn.ReadOnly);Wd(h,i,s,d,Y,j,!1)}if(!E&&h.renderPass==="translucent"&&s.paint.get("fill-antialias")){const Y=E?O:h.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Xn.ReadOnly);Wd(h,i,s,d,Y,j,!0)}},"fill-extrusion":function(h,i,s,d){const x=s.paint.get("fill-extrusion-opacity"),w=h.context,E=w.gl,O=h.terrain,B=O&&O.renderingToTexture;if(x===0)return;const j=h.conflationActive&&h.style.isLayerClipped(s,i.getSource()),H=h.style.order.indexOf(s.fqid);if(j&&function(Z,Y,se,pe,ue){for(const _e of pe){const ge=Y.getTile(_e).getBucket(se);ge&&(ge.updateReplacement(_e,Z.replacementSource,ue),ge.uploadCentroid(Z.context))}}(h,i,s,d,H),O||j)for(const Z of d){const Y=i.getTile(Z).getBucket(s);Y&&Am(h.context,i,Z,Y,s,O,j)}if(h.renderPass==="shadow"&&h.shadowRenderer){const Z=h.shadowRenderer;if(O&&x<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a4)return;const Y=Z.getShadowPassDepthMode(),se=Z.getShadowPassColorMode();Ko(h,i,s,d,Y,hr.disabled,se,j)}else if(h.renderPass==="translucent"){const Z=!s.paint.get("fill-extrusion-pattern").constantOr(1),Y=s.paint.get("fill-extrusion-color").constantOr(n.bA.white);if(!B&&Y.a!==0){const se=new Xn(h.context.gl.LEQUAL,Xn.ReadWrite,h.depthRangeFor3D);x===1&&Z?Ko(h,i,s,d,se,hr.disabled,Ir.unblended,j):(Ko(h,i,s,d,se,hr.disabled,Ir.disabled,j),Ko(h,i,s,d,se,h.stencilModeFor3D(),h.colorModeForRenderPass(),j),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&Z&&(!O&&h.transform.projection.name!=="globe"||B)){const se=s.paint.get("fill-extrusion-opacity"),pe=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),_e=s.paint.get("fill-extrusion-flood-light-intensity"),ge=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(s.lut).toArray01().slice(0,3),Oe=pe>0&&ue>0,Ne=_e>0,Ue=(Ke,Ze,it)=>(1-it)*Ke+it*Ze,$e=Ke=>{const Ze=h.depthModeForSublayer(1,Xn.ReadOnly,E.LEQUAL,!0),it=s.paint.get(Ke?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),gt=Ue(.1,3,it),Lt=h._showOverdrawInspector;if(!Lt){const wt=new hr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),vt=new Ir([E.ONE,E.ONE,E.ONE,E.ONE],n.bA.transparent,[!1,!1,!1,!0],E.MIN);Ua(h,i,s,d,Ze,wt,vt,qn.disabled,Ke,"sdf",se,pe,ue,_e,ge,gt,j,!1)}{const wt=Lt?hr.disabled:new hr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),vt=Lt?h.colorModeForRenderPass():new Ir([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],n.bA.transparent,[!0,!0,!0,!0]);Ua(h,i,s,d,Ze,wt,vt,qn.disabled,Ke,"color",se,pe,ue,_e,ge,gt,j,!1)}};if(B){const Ke=(Ze,it,gt)=>{const Lt=h.depthModeForSublayer(1,Xn.ReadOnly,E.LEQUAL,!1),wt=s.paint.get(Ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),vt=Ue(.1,3,wt);{const ri=new Ir([E.ONE,E.ONE,E.ONE,E.ONE],n.bA.transparent,[!1,!1,!1,!0]);Ua(h,i,s,d,Lt,hr.disabled,ri,qn.disabled,Ze,"clear",se,pe,ue,_e,ge,vt,j,it)}{const ri=new hr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),hi=new Ir([E.ONE,E.ONE,E.ONE,E.ONE],n.bA.transparent,[!1,!1,!1,!0],E.MIN);Ua(h,i,s,d,Lt,ri,hi,qn.disabled,Ze,"sdf",se,pe,ue,_e,ge,vt,j,it)}{const ri=Ze?E.ZERO:E.ONE_MINUS_DST_ALPHA,hi=new hr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Si=new Ir([ri,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],n.bA.transparent,[!0,!0,!0,!0]);Ua(h,i,s,d,Lt,hi,Si,qn.disabled,Ze,"color",se,pe,ue,_e,ge,vt,j,it)}{const ri=new Ir([E.ONE,E.ONE,E.ONE,Ze?E.ZERO:E.ONE],n.bA.transparent,[!1,!1,!1,!0],Ze?E.FUNC_ADD:E.MAX);Ua(h,i,s,d,Lt,hr.disabled,ri,qn.disabled,Ze,"clear",se,pe,ue,_e,ge,vt,j,it,gt)}};if(Oe||Ne){let Ze;if(h.prepareDrawTile(),O){const it=O.drapeBufferSize[0],gt=O.drapeBufferSize[1];Ze=O.framebufferCopyTexture,Ze&&(!Ze||Ze.size[0]===it&&Ze.size[1]===gt)||(Ze&&Ze.destroy(),Ze=O.framebufferCopyTexture=new n.T(w,new n.r({width:it,height:gt}),E.RGBA8)),Ze.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,it,gt)}Oe&&Ke(!0,!1,Ze),Ne&&Ke(!1,!0,Ze)}}else Oe&&$e(!0),Ne&&$e(!1),(Oe||Ne)&&h.resetStencilClippingMasks()}}},hillshade:function(h,i,s,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const x=h.context,w=h.terrain&&h.terrain.renderingToTexture,[E,O]=h.renderPass!=="translucent"||w?[{},d]:h.stencilConfigForOverlap(d);for(const B of O){const j=i.getTile(B);if(j.needsHillshadePrepare&&h.renderPass==="offscreen")au(h,j,s);else if(h.renderPass==="translucent"){const H=h.depthModeForSublayer(0,Xn.ReadOnly),Z=s.paint.get("hillshade-emissive-strength"),Y=h.colorModeForDrapableLayerRenderPass(Z),se=w&&h.terrain?h.terrain.stencilModeForRTTOverlap(B):E[B.overscaledZ];Pd(h,B,j,s,H,se,Y)}}x.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,i,s,d,x,w){if(h.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const E=h.transform.projection.name==="globe",O=s.paint.get("raster-elevation")!==0,B=O&&E;if(h.renderElevatedRasterBackface&&!B)return;const j=h.context,H=j.gl,Z=i.getSource(),Y=function(Ke,Ze,it,gt){const Lt=Ze.paint.get("raster-color"),wt=Ke.type==="raster-array",vt=[],ri=Ze.paint.get("raster-resampling"),hi=Ze.paint.get("raster-color-mix");let Si=Ze.paint.get("raster-color-range");const Gi=[hi[0],hi[1],hi[2],0],Ki=hi[3];let Wt=ri==="nearest"?gt.NEAREST:gt.LINEAR;if(wt&&(vt.push("RASTER_ARRAY"),Lt||vt.push("RASTER_COLOR"),ri==="linear"&&vt.push("RASTER_ARRAY_LINEAR"),Wt=gt.NEAREST,!Si&&Ke.rasterLayers)){const wi=Ke.rasterLayers.find(({id:ui})=>ui===Ze.sourceLayer);wi&&wi.fields&&wi.fields.range&&(Si=wi.fields.range)}if(Si=Si||[0,1],Lt){vt.push("RASTER_COLOR"),it.activeTexture.set(gt.TEXTURE2),Ze.updateColorRamp(Si);let wi=Ze.colorRampTexture;wi||(wi=Ze.colorRampTexture=new n.T(it,Ze.colorRamp,gt.RGBA8)),wi.bind(gt.LINEAR,gt.CLAMP_TO_EDGE)}return{mix:Gi,range:Si,offset:Ki,defines:vt,resampling:Wt}}(Z,s,j,H);if(Z instanceof n.aD&&!d.length&&!E)return;const se=s.paint.get("raster-emissive-strength"),pe=h.colorModeForDrapableLayerRenderPass(se),ue=h.terrain&&h.terrain.renderingToTexture,_e=!h.options.moving,ge=s.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;if(Z instanceof n.aD&&!d.length&&(Z.onNorthPole||Z.onSouthPole)){const Ke=O?h.stencilModeFor3D():hr.disabled;return void Qs(!!Z.onNorthPole,null,h,i,s,se,Y,qn.disabled,Ke)}if(!d.length)return;const[Oe,Ne]=Z instanceof n.aD||ue?[{},d]:h.stencilConfigForOverlap(d),Ue=Ne[Ne.length-1].overscaledZ;B&&Y.defines.push("PROJECTION_GLOBE_VIEW"),O&&Y.defines.push("RENDER_CUTOFF");const $e=(Ke,Ze,it)=>{for(const gt of Ke){const Lt=gt.toUnwrapped(),wt=i.getTile(gt);if(ue&&(!wt||!wt.hasData()))continue;j.activeTexture.set(H.TEXTURE0);const vt=gf(wt,Z,s,Y);if(!vt||!vt.texture)continue;const{texture:ri,mix:hi,offset:Si,tileSize:Gi,buffer:Ki}=vt;let Wt,wi;ue?(Wt=Xn.disabled,wi=gt.projMatrix):O?(Wt=new Xn(H.LEQUAL,Xn.ReadWrite,h.depthRangeFor3D),wi=E?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Lt,_e)):(Wt=h.depthModeForSublayer(gt.overscaledZ-Ue,s.paint.get("raster-opacity")===1?Xn.ReadWrite:Xn.ReadOnly,H.LESS),wi=h.transform.calculateProjMatrix(Lt,_e));const ui=h.terrain&&ue?h.terrain.stencilModeForRTTOverlap(gt):Oe[gt.overscaledZ],Ti=w?0:s.paint.get("raster-fade-duration");wt.registerFadeDuration(Ti);const Ci=i.findLoadedParent(gt,0),mi=Bd(wt,Ci,i,h.transform,Ti);let Xi,zn;h.terrain&&h.terrain.prepareDrawTile(),j.activeTexture.set(H.TEXTURE0),ri.bind(ge,H.CLAMP_TO_EDGE),j.activeTexture.set(H.TEXTURE1),Ci?(Ci.texture&&Ci.texture.bind(ge,H.CLAMP_TO_EDGE),Xi=Math.pow(2,Ci.tileID.overscaledZ-wt.tileID.overscaledZ),zn=[wt.tileID.canonical.x*Xi%1,wt.tileID.canonical.y*Xi%1]):ri.bind(ge,H.CLAMP_TO_EDGE),ri.useMipmap&&j.extTextureFilterAnisotropic&&h.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const $n=h.transform;let An;const kn=O?$d($n):[0,0,0,0];let dn,tr,dr,Nr,as,Ur=0;if(B&&Z instanceof n.aD&&Z.coordinates.length>3)dn=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0)))),tr=Float32Array.from($n.globeMatrix),dr=Float32Array.from(n.cy($n)),Nr=[n.am($n.center.lng),n.at($n.center.lat)],An=Z.elevatedGlobePerspectiveTransform,as=Z.elevatedGlobeGridMatrix||new Float32Array(9);else if(B){const br=n.cz(gt.canonical);Ur=n.cA(br.getCenter().lat),dn=Float32Array.from(n.b6(n.cC(gt.canonical))),tr=Float32Array.from($n.globeMatrix),dr=Float32Array.from(n.cy($n)),Nr=[n.am($n.center.lng),n.at($n.center.lat)],An=[0,0],as=Float32Array.from(n.cB(gt.canonical,br,Ur,$n.worldSize/$n._pixelsPerMercatorPixel))}else An=Z instanceof n.aD?Z.perspectiveTransform:[0,0],dn=new Float32Array(16),tr=new Float32Array(9),dr=new Float32Array(16),Nr=[0,0],as=new Float32Array(9);const vs=Vd(wi,dn,tr,dr,as,zn||[0,0],n.a9(h.transform.zoom),Nr,kn,Xi||1,mi,s,An,O?s.paint.get("raster-elevation"):0,2,hi,Si,Y.range,Gi,Ki,se),Xr=h.isTileAffectedByFog(gt),Ss=h.getOrCreateProgram("raster",{defines:Y.defines,overrideFog:Xr});if(h.uploadCommonUniforms(j,Ss,Lt),Z instanceof n.aD){const br=Z.elevatedGlobeVertexBuffer,ds=Z.elevatedGlobeIndexBuffer;if(ue||!E)Z.boundsBuffer&&Z.boundsSegments&&Ss.draw(h,H.TRIANGLES,Wt,hr.disabled,pe,qn.disabled,vs,s.id,Z.boundsBuffer,h.quadTriangleIndexBuffer,Z.boundsSegments);else if(br&&ds){const ps=$n.zoom<=n.c3?Z.elevatedGlobeSegments:Z.getSegmentsForLongitude($n.center.lng);ps&&Ss.draw(h,H.TRIANGLES,Wt,hr.disabled,pe,Ze,vs,s.id,br,ds,ps)}}else if(B){Wt=new Xn(H.LEQUAL,Xn.ReadOnly,h.depthRangeFor3D);const br=h.globeSharedBuffers;if(br){const[ds,ps,Er]=br.getGridBuffers(Ur,!1);Ss.draw(h,H.TRIANGLES,Wt,it||ui,h.colorModeForRenderPass(),Ze,vs,s.id,ds,ps,Er)}}else{const{tileBoundsBuffer:br,tileBoundsIndexBuffer:ds,tileBoundsSegments:ps}=h.getTileBoundsBuffers(wt);Ss.draw(h,H.TRIANGLES,Wt,ui,pe,qn.disabled,vs,s.id,br,ds,ps)}}if(!(Z instanceof n.aD)&&B)for(const gt of Ke){const Lt=gt.canonical.y===(1<<gt.canonical.z)-1;gt.canonical.y===0&&Qs(!0,gt,h,i,s,se,Y,Ze,it||hr.disabled),Lt&&Qs(!1,gt,h,i,s,se,Y,Ze===qn.frontCW?qn.backCW:qn.frontCW,it||hr.disabled)}};B?$e(Ne,h.renderElevatedRasterBackface?qn.backCW:qn.frontCW,h.stencilModeFor3D()):$e(Ne,qn.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,i,s,d,x,w){h.renderPass==="offscreen"&&function(E,O,B,j){if(!j.length)return;const H=E.context,Z=H.gl,Y=O.getSource();if(!(Y instanceof Xo))return;const se=Math.ceil(Math.sqrt(B.paint.get("raster-particle-count")));let pe=B.particlePositionRGBAImage;if(!pe||pe.width!==se){const Ne=function(Ue){const $e=Ue*Ue,Ke=new Uint8Array(4*$e),Ze=function(gt){return gt|=0,gt=Math.imul(2747636419^gt,2654435769),gt=Math.imul(gt^gt>>>16,2654435769),((gt=Math.imul(gt^gt>>>16,2654435769))>>>0)/4294967296},it=1/1.1;for(let gt=0;gt<$e;gt++){const Lt=it*(Ze(2*gt+0)+Cc),wt=it*(Ze(2*gt+1)+Cc),vt=255*Lt%1,ri=255*wt%1,hi=vt,Si=wt-ri/255,Gi=ri;Ke[4*gt+0]=255*(Lt-vt/255),Ke[4*gt+1]=255*hi,Ke[4*gt+2]=255*Si,Ke[4*gt+3]=255*Gi}return Ke}(se);pe=B.particlePositionRGBAImage=new n.r({width:se,height:se},Ne)}let ue=B.particleFramebuffer;ue?ue.width!==se&&(ue.destroy(),ue=B.particleFramebuffer=H.createFramebuffer(se,se,!0,null)):ue=B.particleFramebuffer=H.createFramebuffer(se,se,!0,null);const _e=[];for(const Ne of j){const Ue=O.getTile(Ne);if(!(Ue instanceof ul))continue;const $e=Ic(Ue,Y,B);if(!$e)continue;const Ke=[Ue.tileSize,Ue.tileSize];let Ze=B.tileFramebuffer;Ze||(Ze=B.tileFramebuffer=H.createFramebuffer(Ke[0],Ke[1],!0,null));let it=Ue.rasterParticleState;it||(it=Ue.rasterParticleState=new Zd(H,Ne,Ke,pe));const gt=it.update(B.lastInvalidatedAt);it.particleTextureDimension!==se&&it.updateParticleTexture(Ne,pe);const Lt=it.targetColorTexture;it.targetColorTexture=it.backgroundColorTexture,it.backgroundColorTexture=Lt;const wt=it.particleTexture0;it.particleTexture0=it.particleTexture1,it.particleTexture1=wt,_e.push([Ne,$e,it,gt])}if(_e.length===0)return;const ge=n.q.now(),Oe=B.previousDrawTimestamp?.001*(ge-B.previousDrawTimestamp):.0167;if(B.previousDrawTimestamp=ge,B.hasColorMap()){H.activeTexture.set(Z.TEXTURE0+2);let Ne=B.colorRampTexture;Ne||(Ne=B.colorRampTexture=new n.T(H,B.colorRamp,Z.RGBA8)),Ne.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}H.bindFramebuffer.set(B.tileFramebuffer.framebuffer),function(Ne,Ue,$e){const Ke=Ne.context,Ze=Ke.gl,it=Ue.tileFramebuffer;Ke.activeTexture.set(Ze.TEXTURE0);const gt={u_texture:0,u_opacity:1.05*(wt=Ue.paint.get("raster-particle-fade-opacity-factor"))/(wt+.05)},Lt=Ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var wt;for(const vt of $e){const[,,ri,hi]=vt;it.colorAttachment.set(ri.targetColorTexture.texture),Ke.viewport.set([0,0,it.width,it.height]),Ke.clear({color:n.bA.transparent}),hi&&(ri.backgroundColorTexture.bind(Ze.NEAREST,Ze.CLAMP_TO_EDGE),Lt.draw(Ne,Ze.TRIANGLES,Xn.disabled,hr.disabled,Ir.alphaBlended,qn.disabled,gt,Ue.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments))}}(E,B,_e),function(Ne,Ue,$e,Ke){const Ze=Ne.context,it=Ze.gl,gt=$e.tileFramebuffer,Lt=Ne.transform.projection.name==="globe",wt=$e.paint.get("raster-particle-max-speed");for(const vt of Ke){const[ri,hi,Si]=vt;Ze.activeTexture.set(it.TEXTURE0+0),hi.texture.bind(it.LINEAR,it.CLAMP_TO_EDGE),gt.colorAttachment.set(Si.targetColorTexture.texture);const Gi=Ne.getOrCreateProgram("rasterParticleDraw",{defines:hi.defines,overrideFog:!1});Ze.activeTexture.set(it.TEXTURE0+1);const Ki=hi.scalarData?[]:[0,1,2,3].map(ui=>n.c$[ui](ri));Ki.push(ri);const Wt=ri.canonical.x,wi=ri.canonical.y;for(const ui of Ki){const Ti=Ue.getTile(Lt?ui.wrapped():ui);if(!Ti)continue;const Ci=Ti.rasterParticleState;if(!Ci)continue;const mi=ui.canonical.x+(1<<ui.canonical.z)*(ui.wrap-ri.wrap),Xi=ui.canonical.y;Ci.particleTexture0.bind(it.NEAREST,it.CLAMP_TO_EDGE);const zn=Zh(1,Ci.particleTexture0.size[0],[mi-Wt,Xi-wi],0,hi.texture.size,2,wt,hi.textureOffset,hi.scale,hi.offset);Gi.draw(Ne,it.POINTS,Xn.disabled,hr.disabled,Ir.alphaBlended,qn.disabled,zn,$e.id,Ci.particleIndexBuffer,void 0,Ci.particleSegment)}}}(E,O,B,_e),H.bindFramebuffer.set(B.particleFramebuffer.framebuffer),function(Ne,Ue,$e,Ke){const Ze=Ne.context,it=Ze.gl,gt=Ue.paint.get("raster-particle-max-speed"),Lt=Ke*Ue.paint.get("raster-particle-speed-factor")*.15,wt=function(ri){return Math.pow(ri,6)}(.01+1*Ue.paint.get("raster-particle-reset-rate-factor")),vt=Ue.particleFramebuffer;Ze.viewport.set([0,0,vt.width,vt.height]);for(const ri of $e){const[,hi,Si]=ri;Ze.activeTexture.set(it.TEXTURE0+0),hi.texture.bind(it.LINEAR,it.CLAMP_TO_EDGE),Ze.activeTexture.set(it.TEXTURE0+1);const Gi=Si.particleTexture0;Gi.bind(it.NEAREST,it.CLAMP_TO_EDGE);const Ki=Hd(1,Gi.size[0],0,hi.texture.size,gt,Lt,wt,hi.textureOffset,hi.scale,hi.offset);vt.colorAttachment.set(Si.particleTexture1.texture),Ze.clear({color:n.bA.transparent}),Ne.getOrCreateProgram("rasterParticleUpdate",{defines:hi.defines}).draw(Ne,it.TRIANGLES,Xn.disabled,hr.disabled,Ir.unblended,qn.disabled,Ki,Ue.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments)}}(E,B,_e,Oe)}(h,i,s,d),h.renderPass==="translucent"&&(function(E,O,B,j,H){const Z=E.context,Y=Z.gl,se=O.getSource().tileSize,pe=5*(1-n.a7(n.bV,n.bV+1,E.transform.zoom))*se+B.paint.get("raster-particle-elevation"),ue=!E.options.moving,_e=E.transform.projection.name==="globe";if(!j.length)return;const[ge,Oe]=E.stencilConfigForOverlap(j),Ne=[];_e&&Ne.push("PROJECTION_GLOBE_VIEW");const Ue=E.stencilModeFor3D();for(const $e of Oe){const Ke=$e.toUnwrapped(),Ze=O.getTile($e);if(!Ze.rasterParticleState)continue;const it=Ze.rasterParticleState,gt=100;Ze.registerFadeDuration(gt);const Lt=O.findLoadedParent($e,0),wt=Bd(Ze,Lt,O,E.transform,gt);let vt,ri;E.terrain&&E.terrain.prepareDrawTile(),Z.activeTexture.set(Y.TEXTURE0),it.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Z.activeTexture.set(Y.TEXTURE1),Lt&&Lt.rasterParticleState?(Lt.rasterParticleState.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),vt=Math.pow(2,Lt.tileID.overscaledZ-Ze.tileID.overscaledZ),ri=[Ze.tileID.canonical.x*vt%1,Ze.tileID.canonical.y*vt%1]):it.targetColorTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const hi=_e?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ke,ue),Si=E.transform,Gi=Ng(Si),Ki=n.cz($e.canonical),Wt=n.cA(Ki.getCenter().lat);let wi,ui,Ti,Ci,mi;_e?(wi=Float32Array.from(n.b6(n.cC($e.canonical))),ui=Float32Array.from(Si.globeMatrix),Ti=Float32Array.from(n.cy(Si)),Ci=[n.am(Si.center.lng),n.at(Si.center.lat)],mi=Float32Array.from(n.cB($e.canonical,Ki,Wt,Si.worldSize/Si._pixelsPerMercatorPixel))):(wi=new Float32Array(16),ui=new Float32Array(9),Ti=new Float32Array(16),Ci=[0,0],mi=new Float32Array(9));const Xi=Gd(hi,wi,ui,Ti,mi,ri||[0,0],n.a9(E.transform.zoom),Ci,Gi,vt||1,wt,pe),zn=E.isTileAffectedByFog($e),$n=E.getOrCreateProgram("rasterParticle",{defines:Ne,overrideFog:zn});if(E.uploadCommonUniforms(Z,$n,Ke),_e){const An=new Xn(Y.LEQUAL,Xn.ReadOnly,E.depthRangeFor3D),kn=0,dn=E.globeSharedBuffers;if(dn){const[tr,dr,Nr]=dn.getGridBuffers(Wt,kn!==0);$n.draw(E,Y.TRIANGLES,An,Ue,Ir.alphaBlended,E.renderElevatedRasterBackface?qn.frontCCW:qn.backCCW,Xi,B.id,tr,dr,Nr)}}else{const An=E.depthModeForSublayer(0,Xn.ReadOnly),kn=ge[$e.overscaledZ],{tileBoundsBuffer:dn,tileBoundsIndexBuffer:tr,tileBoundsSegments:dr}=E.getTileBoundsBuffers(Ze);$n.draw(E,Y.TRIANGLES,An,kn,Ir.alphaBlended,qn.disabled,Xi,B.id,dn,tr,dr)}}E.resetStencilClippingMasks()}(h,i,s,d),h.style.map.triggerRepaint())},background:function(h,i,s,d){const x=s.paint.get("background-color"),w=s.paint.get("background-opacity"),E=s.paint.get("background-emissive-strength"),O=s.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const B=h.context,j=B.gl,H=h.transform,Z=H.tileSize,Y=s.paint.get("background-pattern");let se;if(Y!==void 0&&(Y===null||(se=h.imageManager.getPattern(Y.toString(),s.scope,h.style.getLut(s.scope)),!se)))return;const pe=!Y&&x.a===1&&w===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==pe)return;const ue=hr.disabled,_e=h.depthModeForSublayer(0,pe==="opaque"?Xn.ReadWrite:Xn.ReadOnly),ge=h.colorModeForDrapableLayerRenderPass(E),Oe=Y?"backgroundPattern":"background";let Ne,Ue=d;if(Ue||(Ne=h.getBackgroundTiles(),Ue=Object.values(Ne).map($e=>$e.tileID)),Y&&(B.activeTexture.set(j.TEXTURE0),h.imageManager.bind(h.context,s.scope)),O){const $e=h.getOrCreateProgram(Oe,{overrideFog:!1,overrideRtt:!0}),Ke=new Float32Array(n.a6.mat4.identity([])),Ze=new n.aA(0,0,0,0,0),it=Y?Jl(Ke,E,w,h,0,s.scope,se,O,{tileID:Ze,tileSize:Z}):hu(Ke,E,w,x.toRenderColor(s.lut));$e.draw(h,j.TRIANGLES,_e,ue,ge,qn.disabled,it,s.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const $e of Ue){const Ke=h.isTileAffectedByFog($e),Ze=h.getOrCreateProgram(Oe,{overrideFog:Ke}),it=$e.toUnwrapped(),gt=d?$e.projMatrix:h.transform.calculateProjMatrix(it);h.prepareDrawTile();const Lt=i?i.getTile($e):Ne?Ne[$e.key]:new Us($e,Z,H.zoom,h),wt=Y?Jl(gt,E,w,h,0,s.scope,se,O,{tileID:$e,tileSize:Z}):hu(gt,E,w,x.toRenderColor(s.lut));h.uploadCommonUniforms(B,Ze,it);const{tileBoundsBuffer:vt,tileBoundsIndexBuffer:ri,tileBoundsSegments:hi}=h.getTileBoundsBuffers(Lt);Ze.draw(h,j.TRIANGLES,_e,ue,ge,qn.disabled,wt,s.id,vt,ri,hi)}},sky:function(h,i,s){const d=h._atmosphere?n.a9(h.transform.zoom):1,x=s.paint.get("sky-opacity")*d;if(x===0)return;const w=h.context,E=s.paint.get("sky-type"),O=new Xn(w.gl.LEQUAL,Xn.ReadOnly,[0,1]),B=h.frameCounter/1e3%1;E==="atmosphere"?h.renderPass==="offscreen"?s.needsSkyboxCapture(h)&&(function(j,H,Z,Y){const se=j.context,pe=se.gl;let ue=H.skyboxFbo;if(!ue){ue=H.skyboxFbo=se.createFramebuffer(32,32,!0,null),H.skyboxGeometry=new Pc(se),H.skyboxTexture=se.gl.createTexture(),pe.bindTexture(pe.TEXTURE_CUBE_MAP,H.skyboxTexture),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MAG_FILTER,pe.LINEAR);for(let Ne=0;Ne<6;++Ne)pe.texImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,pe.RGBA,32,32,0,pe.RGBA,pe.UNSIGNED_BYTE,null)}se.bindFramebuffer.set(ue.framebuffer),se.viewport.set([0,0,32,32]);const _e=H.getCenter(j,!0),ge=j.getOrCreateProgram("skyboxCapture"),Oe=new Float64Array(16);n.a6.mat4.identity(Oe),n.a6.mat4.rotateY(Oe,Oe,.5*-Math.PI),ya(j,H,ge,Oe,_e,0),n.a6.mat4.identity(Oe),n.a6.mat4.rotateY(Oe,Oe,.5*Math.PI),ya(j,H,ge,Oe,_e,1),n.a6.mat4.identity(Oe),n.a6.mat4.rotateX(Oe,Oe,.5*-Math.PI),ya(j,H,ge,Oe,_e,2),n.a6.mat4.identity(Oe),n.a6.mat4.rotateX(Oe,Oe,.5*Math.PI),ya(j,H,ge,Oe,_e,3),n.a6.mat4.identity(Oe),ya(j,H,ge,Oe,_e,4),n.a6.mat4.identity(Oe),n.a6.mat4.rotateY(Oe,Oe,Math.PI),ya(j,H,ge,Oe,_e,5),se.viewport.set([0,0,j.width,j.height])}(h,s),s.markSkyboxValid(h)):h.renderPass==="sky"&&function(j,H,Z,Y,se){const pe=j.context,ue=pe.gl,_e=j.transform,ge=j.getOrCreateProgram("skybox");pe.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_CUBE_MAP,H.skyboxTexture);const Oe=((Ne,Ue,$e,Ke,Ze)=>({u_matrix:Ne,u_sun_direction:Ue,u_cubemap:0,u_opacity:Ke,u_temporal_offset:Ze}))(_e.skyboxMatrix,H.getCenter(j,!1),0,Y,se);j.uploadCommonUniforms(pe,ge),ge.draw(j,ue.TRIANGLES,Z,hr.disabled,j.colorModeForRenderPass(),qn.backCW,Oe,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(h,s,O,x,B):E==="gradient"&&h.renderPass==="sky"&&function(j,H,Z,Y,se){const pe=j.context,ue=pe.gl,_e=j.transform,ge=j.getOrCreateProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new Pc(pe)),pe.activeTexture.set(ue.TEXTURE0);let Oe=H.colorRampTexture;Oe||(Oe=H.colorRampTexture=new n.T(pe,H.colorRamp,ue.RGBA8)),Oe.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Ne=((Ue,$e,Ke,Ze,it)=>({u_matrix:Ue,u_color_ramp:0,u_center_direction:$e,u_radius:n.bC(Ke),u_opacity:Ze,u_temporal_offset:it}))(_e.skyboxMatrix,H.getCenter(j,!1),H.paint.get("sky-gradient-radius"),Y,se);j.uploadCommonUniforms(pe,ge),ge.draw(j,ue.TRIANGLES,Z,hr.disabled,j.colorModeForRenderPass(),qn.backCW,Ne,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(h,s,O,x,B)},debug:function(h,i,s,d,x,w){for(let E=0;E<s.length;E++)if(x){const j=new n.bA(d.r*.8,d.g*.8,d.b*.8,1);Ts(h,i,s[E],d,-1,-1,w),Ts(h,i,s[E],d,-1,1,w),Ts(h,i,s[E],d,1,1,w),Ts(h,i,s[E],d,1,-1,w),Ts(h,i,s[E],j,0,0,w)}else Ts(h,i,s[E],d,0,0,w)},custom:function(h,i,s,d){const x=h.context,w=s.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&s.isDraped(i)){if(h.renderPass==="offscreen"){const E=w.prerender;if(E){if(h.setCustomLayerDefaults(),x.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const O=h.transform.pointMerc;E.call(w,x.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.a9(h.transform.zoom),[O.x,O.y],h.transform.pixelsPerMeterRatio)}else E.call(w,x.gl,h.transform.customLayerMatrix());x.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const O=w.renderToTile;if(O){const B=d[0].canonical,j=new n.a5(B.x+d[0].wrap*(1<<B.z),B.y,B.z);x.setDepthMode(Xn.disabled),x.setStencilMode(hr.disabled),x.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),O.call(w,x.gl,j),x.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),x.setColorMode(h.colorModeForRenderPass()),x.setStencilMode(hr.disabled);const E=w.renderingMode==="3d"?new Xn(h.context.gl.LEQUAL,Xn.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Xn.ReadOnly);if(x.setDepthMode(E),h.transform.projection.name==="globe"){const O=h.transform.pointMerc;w.render(x.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.a9(h.transform.zoom),[O.x,O.y],h.transform.pixelsPerMeterRatio)}else w.render(x.gl,h.transform.customLayerMatrix());x.setDirty(),h.setBaseState(),x.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,i,s,d){if(h.renderPass==="opaque")return;const x=s.paint.get("model-opacity");if(x===0)return;const w=s.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!w||h.terrain&&x<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof n.a4))return;const E=h.shadowRenderer,O=s.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,O||(E.enabled=!1));const B=()=>{E&&(E.useNormalOffset=!0,O||(E.enabled=!0))},j=i.getSource();if(h.renderPass==="light-beam"&&j.type!=="batched-model")return;if(j.type==="vector"||j.type==="geojson")return function(ge,Oe,Ne,Ue,$e){const Ke=ge.transform;if(Ke.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${Ke.projection.name} projection is not yet implemented`);const Ze=Ke.getFreeCameraOptions().position;if(!ge.modelManager)return;const it=ge.modelManager;Ne.modelManager=it;const gt=ge.shadowRenderer;if(!Ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Lt=Ne._unevaluatedLayout._values["model-id"],wt={...Ne.layout.get("model-id").parameters},vt=ge.style.order.indexOf(Ne.fqid);for(const ri of Ue){const hi=Oe.getTile(ri).getBucket(Ne);if(!hi||hi.projection.name!==Ke.projection.name)continue;const Si=hi.getModelUris();Si&&!hi.modelsRequested&&(it.addModelsFromBucket(Si,$e),hi.modelsRequested=!0);const Gi=$o(ri,Ke);wt.zoom=Gi;const Ki=Lt.possiblyEvaluate(wt);if(yf(ge,hi,ri),Ga.shadowUniformsInitialized=!1,Ga.useSingleShadowCascade=!!gt&&gt.getMaxCascadeForTile(ri.toUnwrapped())===0,ge.renderPass==="shadow"&&gt){if(ge.currentShadowCascade===1&&hi.isInsideFirstShadowMapFrustum)continue;const ui=Ke.calculatePosMatrix(ri.toUnwrapped(),Ke.worldSize);if(Ga.tileMatrix.set(ui),Ga.shadowTileMatrix=Float32Array.from(gt.calculateShadowPassMatrixFromMatrix(ui)),Ga.aabb.min.fill(0),Ga.aabb.max[0]=Ga.aabb.max[1]=n.ab,Ga.aabb.max[2]=0,Ds(hi,Ga,ge,Ne.scope))continue}const Wt=1<<ri.canonical.z,wi=[((Ze.x-ri.wrap)*Wt-ri.canonical.x)*n.ab,(Ze.y*Wt-ri.canonical.y)*n.ab,Ze.z*Wt*n.ab];ge.conflationActive&&Object.keys(hi.instancesPerModel).length>0&&ge.style.isLayerClipped(Ne,Oe.getSource())&&hi.updateReplacement(ri,ge.replacementSource,vt,$e)&&(hi.uploaded=!1,hi.upload(ge.context));for(let ui in hi.instancesPerModel){const Ti=hi.instancesPerModel[ui];Ti.features.length>0&&(ui=Ki.evaluate(Ti.features[0].feature,{}));const Ci=it.getModel(ui,$e);if(Ci&&Ci.uploaded)for(const mi of Ci.nodes)Jh(ge,Ne,mi,Ti,wi,ri,Ga)}}}(h,i,s,d,j.type==="vector"?s.scope:""),void B();if(!j.loaded())return;if(j.type==="batched-model")return function(ge,Oe,Ne,Ue){Ne.resetLayerRenderingStats(ge);const $e=ge.context,Ke=ge.transform,Ze=ge.style.fog,it=ge.shadowRenderer;if(Ke.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${Ke.projection.name} projection is not yet implemented`);const gt=ge.transform.getFreeCameraOptions().position,Lt=n.a6.vec3.scale([],[gt.x,gt.y,gt.z],ge.transform.worldSize),wt=n.a6.vec3.negate([],Lt),vt=n.a6.mat4.identity([]),ri=n.de(Ke.center.lat,Ke.zoom),hi=n.a6.mat4.fromScaling([],[1,1,1/ri]);n.a6.mat4.translate(vt,vt,wt);const Si=Ne.paint.get("model-opacity"),Gi=new Xn($e.gl.LEQUAL,Xn.ReadWrite,ge.depthRangeFor3D),Ki=new Xn($e.gl.LEQUAL,Xn.ReadOnly,ge.depthRangeFor3D),Wt=new n.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),wi=ge.renderPass==="shadow",ui=wi&&it?it.getCurrentCascadeFrustum():Ke.getFrustum(Ke.scaleZoom(Ke.worldSize)),Ti=Ne.paint.get("model-front-cutoff"),Ci=Ti[2]<1,mi=Ea(ge,Ne.paint.get("model-cutoff-fade-range")),Xi=Ne.getLayerRenderingStats();(function(zn,$n,An,kn){const dn=zn.terrain?zn.terrain.exaggeration():0,tr=zn.transform.zoom;for(const dr of kn){const Nr=$n.getTile(dr).getBucket(An);Nr&&(zn.conflationActive&&Nr.updateReplacement(dr,zn.replacementSource),Nr.evaluateScale(zn,An),zn.terrain&&dn>0&&Nr.elevationUpdate(zn.terrain,dn,dr,An.source),Nr.needsReEvaluation(zn,tr,An)&&Nr.evaluate(An))}})(ge,Oe,Ne,Ue),function(){let zn,$n,An;Ci?(zn=Ue.length-1,$n=-1,An=-1):(zn=0,$n=Ue.length,An=1);const kn=new Float64Array(16),dn=n.a6.vec3.create(),tr=new n.P(0,0);for(let dr=zn;dr!==$n;dr+=An){const Nr=Ue[dr],as=Oe.getTile(Nr).getBucket(Ne);if(!as||!as.uploaded)continue;let Ur=!1;it&&(Ur=it.getMaxCascadeForTile(Nr.toUnwrapped())===0);const vs=Ke.calculatePosMatrix(Nr.toUnwrapped(),Ke.worldSize),Xr=as.modelTraits;!wi&&Ci&&(n.a6.mat4.invert(kn,vs),n.a6.vec3.transformMat4(dn,Lt,kn),tr.x=dn[0],tr.y=dn[1]);const Ss=[];for(const br of as.getNodesInfo()){if(br.hiddenByReplacement||!br.node.meshes)continue;const ds=br.node;let ps=0;ge.terrain&&ds.elevation&&(ps=ds.elevation*ge.terrain.exaggeration());const Er=(()=>{const Es=br.aabb;return Wt.min=[...Es.min],Wt.max=[...Es.max],Wt.min[2]+=ps,Wt.max[2]+=ps,n.a6.vec3.transformMat4(Wt.min,Wt.min,vs),n.a6.vec3.transformMat4(Wt.max,Wt.max,vs),Wt})(),ts=br.evaluatedScale;if(ts[0]<=1&&ts[1]<=1&&ts[2]<=1&&Er.intersects(ui)===0)continue;if(!wi&&Ci){const Es=.16666666666666666;br.cameraCollisionOpacity=Lt[0]>Er.min[0]&&Lt[0]<Er.max[0]&&Lt[1]>Er.min[1]&&Lt[1]<Er.max[1]&&Lt[2]*ri<Er.max[2]&&ds.footprint&&n.bv(tr,ds.footprint)?Math.max(br.cameraCollisionOpacity-Es,0):Math.min(1,br.cameraCollisionOpacity+Es)}const Gs=[...vs],ea=ds.anchor?ds.anchor[0]:0,qa=ds.anchor?ds.anchor[1]:0;n.a6.mat4.translate(Gs,Gs,[ea*(ts[0]-1),qa*(ts[1]-1),ps]),n.a6.vec3.exactEquals(ts,n.dh)||n.a6.mat4.scale(Gs,Gs,ts);const Mo=n.a6.mat4.multiply([],Gs,ds.matrix),Wr=n.a6.mat4.multiply([],Ke.expandedFarZProjMatrix,Mo),Hr=n.a6.mat4.multiply([],Ke.expandedFarZProjMatrix,Gs),Yr=n.a6.vec4.transformMat4([],[ea,qa,ps,1],Wr)[2];ds.hidden=!1;let is=Si;wi||(Ci&&(is*=br.cameraCollisionOpacity,is*=vf(Gs,Ke,br.aabb,Ti)),is*=Qr(mi,Yr)),is!==0?Ss.push({nodeInfo:br,depth:Yr,opacity:is,wvpForNode:Wr,wvpForTile:Hr,nodeModelMatrix:Mo,tileModelMatrix:Gs}):ds.hidden=!0}wi||Ss.sort((br,ds)=>!Ci||br.opacity===1&&ds.opacity===1?br.depth<ds.depth?-1:1:br.opacity===1?-1:ds.opacity===1?1:br.depth>ds.depth?-1:1);for(const br of Ss){const ds=br.nodeInfo,ps=ds.node;let Er=n.a6.mat4.multiply([],hi,br.tileModelMatrix);n.a6.mat4.multiply(Er,vt,Er);const ts=n.a6.mat4.invert([],Er);n.a6.mat4.transpose(ts,ts),n.a6.mat4.scale(ts,ts,lh),Er=n.a6.mat4.multiply(Er,Er,ps.matrix);const Gs=ge.renderPass==="light-beam",ea=Xr&n.dj.HasMapboxMeshFeatures,qa=ea?0:ds.evaluatedRMEA[0][2];for(let Mo=0;Mo<ps.meshes.length;++Mo){const Wr=ps.meshes[Mo],Hr=Mo===ps.lightMeshIndex;let Yr=br.wvpForNode;if(Hr){if(!Gs&&!ge.terrain&&ge.shadowRenderer){ge.currentLayer<ge.firstLightBeamLayer&&(ge.firstLightBeamLayer=ge.currentLayer);continue}Yr=br.wvpForTile}else if(Gs)continue;const is={defines:[]},Es=[];if(!wi&&it&&(it.useNormalOffset=!!Wr.normalBuffer),Oc(is.defines,Es,Wr,ge,Ne.lut),ea||is.defines.push("DIFFUSE_SHADED"),Ur&&is.defines.push("SHADOWS_SINGLE_CASCADE"),Xi&&(wi?Xi.numRenderedVerticesInShadowPass+=Wr.vertexArray.length:Xi.numRenderedVerticesInTransparentPass+=Wr.vertexArray.length),wi){ah(Wr,br.nodeModelMatrix,ge,Ne);continue}let Os=null;if(Ze){const Za=sh(br.nodeModelMatrix,ge.transform);if(Os=new Float32Array(Za),Ke.projection.name!=="globe"){const ba=Wr.aabb.min,Xa=Wr.aabb.max,[Pa,ls]=Ze.getOpacityForBounds(Za,ba[0],ba[1],Xa[0],Xa[1]);is.overrideFog=Pa>=Pi||ls>=Pi}}const Ro=Wr.material;let Tl;Ro.occlusionTexture&&Ro.occlusionTexture.offsetScale&&(Tl=Ro.occlusionTexture.offsetScale,is.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const xa=ge.getOrCreateProgram("model",is);!wi&&it&&it.setupShadowsFromMatrix(br.tileModelMatrix,xa,it.useNormalOffset),ge.uploadCommonUniforms($e,xa,null,Os);const aa=Ro.pbrMetallicRoughness;aa.metallicFactor=.9,aa.roughnessFactor=.5;const $a=Xh(new Float32Array(Yr),new Float32Array(Er),new Float32Array(ts),new Float32Array(ps.matrix),ge,br.opacity,aa.baseColorFactor.toRenderColor(null),Ro.emissiveFactor,aa.metallicFactor,aa.roughnessFactor,Ro,qa,Ne,[0,0,0],Tl);!Hr&&(ds.hasTranslucentParts||br.opacity<1)&&xa.draw(ge,$e.gl.TRIANGLES,Gi,hr.disabled,Ir.disabled,qn.backCCW,$a,Ne.id,Wr.vertexBuffer,Wr.indexBuffer,Wr.segments,Ne.paint,ge.transform.zoom,void 0,Es),xa.draw(ge,$e.gl.TRIANGLES,Hr?Ki:Gi,hr.disabled,Hr||br.opacity<1||ds.hasTranslucentParts?Ir.alphaBlended:Ir.unblended,qn.backCCW,$a,Ne.id,Wr.vertexBuffer,Wr.indexBuffer,Wr.segments,Ne.paint,ge.transform.zoom,void 0,Es)}}}}()}(h,i,s,d),void B();if(j.type!=="model")return;const H=j.getModels(),Z=[],Y=h.transform.getFreeCameraOptions().position,se=n.a6.vec3.scale([],[Y.x,Y.y,Y.z],h.transform.worldSize);n.a6.vec3.negate(se,se);const pe=[],ue=[];let _e=0;for(const ge of H){const Oe=s.paint.get("model-rotation").constantOr(null),Ne=s.paint.get("model-scale").constantOr(null),Ue=s.paint.get("model-translation").constantOr(null);ge.computeModelMatrix(h,Oe,Ne,Ue,!0,!0,!1);const $e=n.a6.mat4.identity([]),Ke=n.de(ge.position.lat,h.transform.zoom),Ze=n.a6.mat4.fromScaling([],[1,1,1/Ke]);n.a6.mat4.translate($e,$e,se),Z.push({zScaleMatrix:Ze,negCameraPosMatrix:$e});for(const it of ge.nodes)oh(h.transform,it,ge.matrix,h.transform.expandedFarZProjMatrix,_e,pe,ue);_e++}if(pe.sort((ge,Oe)=>Oe.depth-ge.depth),h.renderPass!=="shadow"){if(x===1)for(const ge of ue)Bl(ge,h,s,Z[ge.modelIndex],hr.disabled,h.colorModeForRenderPass());else{for(const ge of ue)Bl(ge,h,s,Z[ge.modelIndex],hr.disabled,Ir.disabled);for(const ge of ue)Bl(ge,h,s,Z[ge.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const ge of pe)Bl(ge,h,s,Z[ge.modelIndex],hr.disabled,h.colorModeForRenderPass());B()}else{for(const ge of ue)ah(ge.mesh,ge.nodeModelMatrix,h,s);for(const ge of pe)ah(ge.mesh,ge.nodeModelMatrix,h,s);B()}}},va={model:function(h,i,s){const d=i.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,d.type==="vector"?h.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const x=d.getModels();for(const w of x)w.upload(s.context)},raster:function(h,i,s){const d=i.getSource();if(!(d instanceof Xo&&d.loaded()))return;const x=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!x)return;const w=h.paint.get("raster-array-band")||d.getInitialBand(x);if(w==null)return;const E=i.getIds().map(O=>i.getTileByID(O));for(const O of E)O.updateNeeded(x,w)&&d.prepareTile(O,x,w)},"raster-particle":function(h,i,s){const d=i.getSource();if(!(d instanceof Xo&&d.loaded()))return;const x=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!x)return;const w=h.paint.get("raster-particle-array-band")||d.getInitialBand(x);if(w==null)return;const E=i.getIds().map(O=>i.getTileByID(O));for(const O of E)O.updateNeeded(x,w)&&d.prepareTile(O,x,w)}};class tc{constructor(i,s,d,x,w){this.context=new Fg(i,s),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const B of E)this._debugParams.enabledLayers[B]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const B of E)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],B);this.occlusionParams=new mu(w),this.setup(),this.numSublayers=Te.maxUnderzooming+Te.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new om(this),this._wireframeDebugCache=new Yd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const O=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,O,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x}updateTerrain(i,s){const d=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new nf(this,i));const x=this._terrain;this.transform.elevation=d?x:null,x.update(i,this.transform,s),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(i){const s=i.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,x]=s.getFovAdjustedRange(this.transform._fov);if(d>x)return void(this.transform.fogCullDistSq=null);const w=d+.78*(x-d);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new nf(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,s){if(this.width=i*n.q.devicePixelRatio,this.height=s*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const i=this.context,s=new n.a$;s.emplaceBack(0,0),s.emplaceBack(n.ab,0),s.emplaceBack(0,n.ab),s.emplaceBack(n.ab,n.ab),this.tileExtentBuffer=i.createVertexBuffer(s,n.b1.members),this.tileExtentSegments=n.b2.simpleSegment(0,0,4,2);const d=new n.a$;d.emplaceBack(0,0),d.emplaceBack(n.ab,0),d.emplaceBack(0,n.ab),d.emplaceBack(n.ab,n.ab),this.debugBuffer=i.createVertexBuffer(d,n.b1.members),this.debugSegments=n.b2.simpleSegment(0,0,4,5);const x=new n.a$;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,n.b1.members),this.viewportSegments=n.b2.simpleSegment(0,0,4,2);const w=new n.aO;w.emplaceBack(0,0,0,0),w.emplaceBack(n.ab,0,n.ab,0),w.emplaceBack(0,n.ab,0,n.ab),w.emplaceBack(n.ab,n.ab,n.ab,n.ab),this.mercatorBoundsBuffer=i.createVertexBuffer(w,n.b4.members),this.mercatorBoundsSegments=n.b2.simpleSegment(0,0,4,2);const E=new n.aP;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const O=new n.b0;for(const j of[0,1,3,2,0])O.emplaceBack(j);this.debugIndexBuffer=i.createIndexBuffer(O),this.emptyTexture=new n.T(i,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=n.a6.mat4.create();const B=this.context.gl;this.stencilClearMode=new hr({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Xn.disabled,this.stencilClearMode,Ir.disabled,qn.disabled,qh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,s,d){if(!s||this.currentStencilSource===s.id||!i.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let O=!1;for(const B of d)if(this._tileClippingMaskIDs[B.key]===void 0){O=!0;break}if(!O)return}this.currentStencilSource=s.id;const x=this.context,w=x.gl;this.nextStencilID+d.length>256&&this.clearStencil(),x.setColorMode(Ir.disabled),x.setDepthMode(Xn.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const O of d){const B=s.getTile(O),j=this._tileClippingMaskIDs[O.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:Z,tileBoundsSegments:Y}=this.getTileBoundsBuffers(B);E.draw(this,w.TRIANGLES,Xn.disabled,new hr({func:w.ALWAYS,mask:0},j,255,w.KEEP,w.KEEP,w.REPLACE),Ir.disabled,qn.disabled,qh(O.projMatrix),"$clipping",H,Z,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,s=this.context.gl;return new hr({func:s.NOTEQUAL,mask:255},i,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const s=this.context.gl;return new hr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(i){const s=this.context.gl,d=i.sort((E,O)=>O.overscaledZ-E.overscaledZ),x=d[d.length-1].overscaledZ,w=d[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const E={};for(let O=0;O<w;O++)E[O+x]=new hr({func:s.GEQUAL,mask:255},O+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=w,[E,d]}return[{[x]:hr.disabled},d]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Ir([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new n.bA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ir.unblended:Ir.alphaBlended}colorModeForDrapableLayerRenderPass(i){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ir([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new n.bA(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,s,d,x=!1){if(this.depthOcclusion)return new Xn(this.context.gl.GREATER,Xn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Xn.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Xn(d||this.context.gl.LEQUAL,s,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,s=Math.ceil(this.width),d=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),w=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&d!==0&&(this.depthFBO=new df(this.context,s,d,!1,"texture"),this.depthTexture=new n.T(this.context,{width:s,height:d,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),i.bindTexture(i.TEXTURE_2D,w),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,s,d,0,0,s,d,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,s)=>i+s/this._fpsHistory.length,0))}render(i,s){const d=n.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=s;const x=this.style._mergedLayers,w=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(wt=>{const vt=x[wt];return!(vt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[vt.type]});let E=!1,O=!1;for(const wt of w){const vt=x[wt];vt.type==="circle"&&(E=!0),vt.type==="symbol"&&(vt.hasInitialOcclusionOpacityProperties?O=!0:E=!0)}const B=w.map(wt=>x[wt]),j=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let H=0,Z=!1;for(const wt in j){const vt=j[wt];vt.used&&(vt.prepare(this.context),vt.getSource().usedInConflation&&++H)}let Y=!1;for(const wt of B)wt.isHidden(this.transform.zoom)||(wt.type==="clip"&&(Y=!0),this.prepareLayer(wt));const se={},pe={},ue={},_e={},ge={};for(const wt in j){const vt=j[wt];se[wt]=vt.getVisibleCoordinates(),pe[wt]=se[wt].slice().reverse(),ue[wt]=vt.getVisibleCoordinates(!0).reverse(),_e[wt]=vt.getShadowCasterCoordinates(),ge[wt]=vt.sortCoordinatesByDistance(se[wt])}const Oe=wt=>{const vt=this.style.getLayerSourceCache(wt);return vt&&vt.used?vt.getSource():null};if(H||Y||this._clippingActiveLastFrame){const wt=[],vt=[];let ri=0;for(const hi of B)this.isSourceForClippingOrConflation(hi,Oe(hi))&&(wt.push(hi),vt.push(ri)),ri++;if(wt&&(Y||wt.length>1)||this._clippingActiveLastFrame){Y=!1;const hi=[];for(let Si=0;Si<wt.length;Si++){const Gi=wt[Si],Ki=vt[Si],Wt=this.style.getLayerSourceCache(Gi);if(!Wt||!Wt.used||!Wt.getSource().usedInConflation&&Gi.type!=="clip")continue;let wi=n.dn,ui=n.bt.None;const Ti=[];let Ci=!0;if(Gi.type==="clip"){wi=Ki;for(const mi of Gi.layout.get("clip-layer-types"))ui|=mi==="model"?n.bt.Model:mi==="symbol"?n.bt.Symbol:n.bt.FillExtrusion;for(const mi of Gi.layout.get("clip-layer-scope"))Ti.push(mi);Gi.isHidden(this.transform.zoom)?Ci=!1:Y=!0}Ci&&hi.push({layer:Gi.fqid,cache:Wt,order:wi,clipMask:ui,clipScope:Ti})}this.replacementSource.setSources(hi),Z=!0}}this._clippingActiveLastFrame=Y,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let wt=0;wt<B.length;wt++){const vt=B[wt],ri=vt.cutoffRange();if(this.longestCutoffRange=Math.max(ri,this.longestCutoffRange),ri>0){const hi=Oe(vt);hi&&(this.minCutoffZoom=Math.max(hi.minzoom,this.minCutoffZoom)),vt.minzoom&&(this.minCutoffZoom=Math.max(vt.minzoom,this.minCutoffZoom))}vt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=wt),this._lastOcclusionLayer=wt)}const Ne=this.style&&this.style.fog;Ne?(this._fogVisible=Ne.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ne.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0);const Ue=this._shadowRenderer;if(Ue){Ue.updateShadowParameters(this.transform,this.style.directionalLight);for(const wt in j)for(const vt of se[wt]){let ri={min:0,max:0};this.terrain&&(ri=this.terrain.getMinMaxForTile(vt)||ri),Ue.addShadowReceiver(vt.toUnwrapped(),ri.min,ri.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Xd(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Yn.has(this.context.gl))return;this.renderPass="offscreen";for(const wt of B){const vt=i.getLayerSourceCache(wt);if(!wt.hasOffscreenPass()||wt.isHidden(this.transform.zoom))continue;const ri=vt?pe[vt.id]:void 0;(wt.type==="custom"||wt.type==="raster"||wt.type==="raster-particle"||wt.isSky()||ri&&ri.length)&&this.renderLayer(this,vt,wt,ri)}this.depthRangeFor3D=[0,1-(B.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_e)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const $e=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ke=(()=>{if(s.showOverdrawInspector)return n.bA.black;const wt=this.style.fog;if(wt&&this.transform.projection.supportsFog){const vt=this.style.getLut(wt.scope);if(!$e){const ri=wt.properties.get("color").toRenderColor(vt).toArray01();return new n.bA(...ri)}if($e){const ri=wt.properties.get("space-color").toRenderColor(vt).toArray01();return new n.bA(...ri)}}return n.bA.transparent})();if(this.context.clear({color:Ke,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&$e&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const wt=B[this.currentLayer],vt=i.getLayerSourceCache(wt);if(wt.isSky())continue;const ri=vt?(wt.is3D()?ge:pe)[vt.id]:void 0;this._renderTileClippingMasks(wt,vt,ri),this.renderLayer(this,vt,wt,ri)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&$e&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const wt=B[this.currentLayer],vt=i.getLayerSourceCache(wt);wt.isSky()&&this.renderLayer(this,vt,wt,vt?pe[vt.id]:void 0)}function Ze(wt,vt){let ri;return vt&&(ri=(wt.type==="symbol"?ue:wt.is3D()?ge:pe)[vt.id]),ri}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const wt=B[this.currentLayer];if(wt.type==="raster"||wt.type==="raster-particle"){const vt=i.getLayerSourceCache(wt);this.renderLayer(this,vt,wt,Ze(wt,vt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let it=0;Ue&&(it=Ue.getShadowCastingLayerCount());let gt=!1,Lt=-1;for(let wt=0;wt<w.length;++wt){const vt=B[wt];vt.isHidden(this.transform.zoom)||vt.is3D()&&(Lt=wt)}for(O&&Lt===-1&&(E=!0);this.currentLayer<w.length;){const wt=B[this.currentLayer],vt=i.getLayerSourceCache(wt);if(wt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(wt)){if(wt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(E&&!gt&&this.terrain&&!this.transform.isOrthographic&&(gt=!0,this.blitDepth()),O&&Lt!==-1&&this.currentLayer===Lt+1&&!this.transform.isOrthographic&&this.blitDepth(),wt.is3D()||this.terrain||this._renderTileClippingMasks(wt,vt,vt?se[vt.id]:void 0),this.renderLayer(this,vt,wt,Ze(wt,vt)),!this.terrain&&Ue&&it>0&&wt.hasShadowPass()&&--it==0&&(Ue.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ri=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ri;this.currentLayer++){const hi=B[this.currentLayer];if(!hi.hasLightBeamPass())continue;const Si=i.getLayerSourceCache(hi);this.renderLayer(this,Si,hi,Si?pe[Si.id]:void 0)}this.currentLayer=ri,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ri=this.currentLayer;this.depthOcclusion=!0;for(const hi of this.layersWithOcclusionOpacity){this.currentLayer=hi;const Si=B[this.currentLayer],Gi=i.getLayerSourceCache(Si),Ki=Gi?pe[Gi.id]:void 0;Si.is3D()||this.terrain||this._renderTileClippingMasks(Si,Gi,Gi?se[Gi.id]:void 0),this.renderLayer(this,Gi,Si,Ki)}this.depthOcclusion=!1,this.currentLayer=ri,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let wt=null;B.forEach(vt=>{const ri=i.getLayerSourceCache(vt);ri&&!vt.isHidden(this.transform.zoom)&&ri.getVisibleCoordinates().length&&(!wt||wt.getSource().maxzoom<ri.getSource().maxzoom)&&(wt=ri)}),wt&&this.options.showTileBoundaries&&zc.debug(this,wt,wt.getVisibleCoordinates(),n.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&zc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(wt){const vt=wt.transform.padding;Jt(wt,wt.transform.height-(vt.top||0),3,Rc),Jt(wt,vt.bottom||0,3,th),ih(wt,vt.left||0,3,qi),ih(wt,wt.transform.width-(vt.right||0),3,yn);const ri=wt.transform.centerPoint;(function(hi,Si,Gi,Ki){Va(hi,Si-1,Gi-10,2,20,Ki),Va(hi,Si-10,Gi-1,20,2,Ki)})(wt,ri.x,wt.transform.height-ri.y,pu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:s}=this.transform.projection,d=!s||!s.includes(i.type);if(va[i.type]&&(d||this.terrain&&i.type==="custom")){const x=this.style.getLayerSourceCache(i);va[i.type](i,x,this)}this.gpuTimingEnd()}renderLayer(i,s,d,x){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||x&&x.length)&&(this.id=d.id,this.gpuTimingStart(d),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(d.type)&&(!i.terrain||d.type!=="custom")||d.type==="clip"||zc[d.type](i,s,d,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,d=this.context.gl;let x=this.gpuTimers[i.id];x||(x=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:d.createQuery()}),x.calls++,d.beginQuery(s.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,s=this.context.gl,d=s.createQuery();this.deferredRenderGpuTimeQueries.push(d),s.beginQuery(i.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const s={};for(const d in i){const x=i[d],w=this.context.extTimerQuery,E=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),s[d]=E}return s}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let d=0;for(const x of i)d+=s.getQueryParameter(x,s.QUERY_RESULT)/1e6,s.deleteQuery(x);return d}translatePosMatrix(i,s,d,x,w){if(!d[0]&&!d[1])return i;const E=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const j=Math.sin(E),H=Math.cos(E);d=[d[0]*H-d[1]*j,d[0]*j+d[1]*H]}const O=[w?d[0]:n.ak(s,d[0],this.transform.zoom),w?d[1]:n.ak(s,d[1],this.transform.zoom),0],B=new Float32Array(16);return n.a6.mat4.translate(B,i,O),B}saveTileTexture(i){const s=i.size[0],d=this._tileTextures[s];d?d.push(i):this._tileTextures[s]=[i]}getTileTexture(i){const s=this._tileTextures[i];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,s,d){const x=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,w=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||s!==void 0&&!s||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(i,s){this.cache=this.cache||{};const d=s&&s.defines||[],x=s&&s.config,w=this.currentGlobalDefines(i,s&&s.overrideFog,s&&s.overrideRtt).concat(d),E=Kl.cacheKey(Fl[i],i,w,x);return this.cache[E]||(this.cache[E]=new Kl(this.context,i,Fl[i],x,Ql[i],w)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,s){if(this.style.enable3dLights()){const d=this.style.directionalLight,x=this.style.ambientLight;if(d&&x){const w=((E,O,B)=>{const j=E.properties.get("direction"),H=E.properties.get("color").toRenderColor(B.getLut(E.scope)).toArray01(),Z=E.properties.get("intensity"),Y=O.properties.get("color").toRenderColor(B.getLut(O.scope)).toArray01(),se=O.properties.get("intensity"),pe=[j.x,j.y,j.z],ue=n.cH(Y,se),_e=n.cH(H,Z);return{u_lighting_ambient_color:ue,u_lighting_directional_dir:pe,u_lighting_directional_color:_e,u_ground_radiance:rf(pe,_e,ue)}})(d,x,this.style);s.setLightsUniformValues(i,w)}}}uploadCommonUniforms(i,s,d,x,w){if(this.uploadCommonLightUniforms(i,s),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const O=E.getOpacity(this.transform.pitch),B=((j,H,Z,Y,se,pe,ue,_e,ge,Oe,Ne,Ue)=>{const $e=j.transform,Ke=H.properties.get("color").toRenderColor(j.style.getLut(H.scope)).toArray01();Ke[3]=Y;const Ze=j.frameCounter/1e3%1,[it,gt]=H.properties.get("vertical-range");return{u_fog_matrix:Z?$e.calculateFogTileMatrix(Z):Ue||j.identityMat,u_fog_range:H.getFovAdjustedRange($e._fov),u_fog_color:Ke,u_fog_horizon_blend:H.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(it,gt),gt],u_fog_temporal_offset:Ze,u_frustum_tl:se,u_frustum_tr:pe,u_frustum_br:ue,u_frustum_bl:_e,u_globe_pos:ge,u_globe_radius:Oe,u_viewport:Ne,u_globe_transition:n.a9($e.zoom),u_is_globe:+($e.projection.name==="globe")}})(this,E,d,O,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],x);s.setFogUniformValues(i,B)}w&&s.setCutoffUniformValues(i,w.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,s=i.createTexture();return i.bindTexture(i.TEXTURE_2D,s),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,s=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const x of d)s[x.key]=i[x.key]||new Us(x,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,s){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[i.key];return s||(this._cachedTileFogOpacities[i.key]=s=this.style.fog.getOpacityForTile(i)),s[0]>=Pi||s[1]>=Pi}setupDepthForOcclusion(i,s,d){const x=this.context,w=x.gl,E=!!d;var O;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(w.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((O=this.depthRangeFor3D)[1]-O[0]),-1-2*O[0]/(O[1]-O[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE0),E||s.setTerrainUniformValues(x,d)}}function ic(h,i){let s=!1,d=null;const x=()=>{d=null,s&&(h(),d=setTimeout(x,i),s=!1)};return()=>(s=!0,d||x(),d)}class gu{constructor(i){this._hashName=i&&encodeURIComponent(i),n.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ic(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const s=vl(i);if(this._hashName){const d=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map(E=>{const O=E.split("=")[0];return O===d?(x=!0,`${O}=${s}`):E}).filter(E=>E);return x||w.push(`${d}=${s}`),`#${w.join("&")}`}return`#${s}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let s;return i.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(s=d)}),(s&&s[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(d=>isNaN(d))){const d=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(s[3]||0):i.getBearing();return i.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:d,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function vl(h,i){const s=h.getCenter(),d=Math.round(100*h.getZoom())/100,x=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),E=Math.round(s.lng*w)/w,O=Math.round(s.lat*w)/w,B=h.getBearing(),j=h.getPitch();let H=i?`/${E}/${O}/${d}`:`${d}/${O}/${E}`;return(B||j)&&(H+="/"+Math.round(10*B)/10),j&&(H+=`/${Math.round(j)}`),H}const _u={linearity:.3,easing:n.dp(0,0,.3,1)},Kd=n.l({deceleration:2500,maxSpeed:1400},_u),uh=n.l({deceleration:20,maxSpeed:1400},_u),il=n.l({deceleration:1e3,maxSpeed:360},_u),Qh=n.l({deceleration:1e3,maxSpeed:90},_u);class Io{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,s=n.q.now();for(;i.length>0&&s-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)s.zoom+=w.zoomDelta||0,s.bearing+=w.bearingDelta||0,s.pitch+=w.pitchDelta||0,w.panDelta&&s.pan._add(w.panDelta),w.around&&(s.around=w.around),w.pinchAround&&(s.pinchAround=w.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(s.pan.mag()){const w=vu(s.pan.mag(),d,n.l({},Kd,i||{}));x.offset=s.pan.mult(w.amount/s.pan.mag()),x.center=this._map.transform.center,yu(x,w)}if(s.zoom){const w=vu(s.zoom,d,uh);x.zoom=this._map.transform.zoom+w.amount,yu(x,w)}if(s.bearing){const w=vu(s.bearing,d,il);x.bearing=this._map.transform.bearing+n.ap(w.amount,-179,179),yu(x,w)}if(s.pitch){const w=vu(s.pitch,d,Qh);x.pitch=this._map.transform.pitch+w.amount,yu(x,w)}if(x.zoom||x.bearing){const w=s.pinchAround===void 0?s.around:s.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function yu(h,i){(!h.duration||h.duration<i.duration)&&(h.duration=i.duration,h.easing=i.easing)}function vu(h,i,s){const{maxSpeed:d,linearity:x,deceleration:w}=s,E=n.ap(h*x/(i/1e3),-d,d),O=Math.abs(E)/(w*x);return{easing:s.easing,duration:1e3*O,amount:E*(O/2)}}class qs extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s,d,x={}){const w=ot(s.getCanvasContainer(),d),E=s.unproject(w);super(i,n.l({point:w,lngLat:E,originalEvent:d},x)),this._defaultPrevented=!1,this.target=s}}class kc extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s,d){const x=i==="touchend"?d.changedTouches:d.touches,w=tt(s.getCanvasContainer(),x),E=w.map(B=>s.unproject(B)),O=w.reduce((B,j,H,Z)=>B.add(j.div(Z.length)),new n.P(0,0));super(i,{points:w,point:O,lngLats:E,lngLat:s.unproject(O),originalEvent:d}),this._defaultPrevented=!1}}class hh extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class Ra{constructor(i,s){this._map=i,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new hh(this._map,i))}mousedown(i,s){return this._mousedownPos=s,this._firePreventable(new qs(i.type,this._map,i))}mouseup(i){this._map.fire(new qs(i.type,this._map,i))}preclick(i){const s=n.l({},i);s.type="preclick",this._map.fire(new qs(s.type,this._map,s))}click(i,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(i),this._map.fire(new qs(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new qs(i.type,this._map,i))}mouseover(i){this._map.fire(new qs(i.type,this._map,i))}mouseout(i){this._map.fire(new qs(i.type,this._map,i))}touchstart(i){return this._firePreventable(new kc(i.type,this._map,i))}touchmove(i){this._map.fire(new kc(i.type,this._map,i))}touchend(i){this._map.fire(new kc(i.type,this._map,i))}touchcancel(i){this._map.fire(new kc(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fc{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new qs(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new qs(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jd{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,s){this.isEnabled()&&i.shiftKey&&i.button===0&&(Zt(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(i,s){if(!this._active)return;const d=s,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(d)||!this._box&&d.dist(x)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=ct("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const E=Math.min(x.x,d.x),O=Math.max(x.x,d.x),B=Math.min(x.y,d.y),j=Math.max(x.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${B}px)`,this._box.style.width=O-E+"px",this._box.style.height=j-B+"px")})}mouseupWindow(i,s){if(!this._active)return;const d=this._startPos,x=s;if(d&&i.button===0){if(this.reset(),Ye(),d.x!==x.x||d.y!==x.y)return this._map.fire(new n.x("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(d,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),At(),delete this._startPos,delete this._lastPos}_fireEvent(i,s){return this._map.fire(new n.x(i,{originalEvent:s}))}}function Jo(h,i){const s={};for(let d=0;d<h.length;d++)s[h[d].identifier]=i[d];return s}class Qd{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,s,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),d.length===this.numTouches&&(this.centroid=function(x){const w=new n.P(0,0);for(const E of x)w._add(E);return w.div(x.length)}(s),this.touches=Jo(d,s)))}touchmove(i,s,d){if(this.aborted||!this.centroid)return;const x=Jo(d,s);for(const w in this.touches){const E=x[w];(!E||E.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(i,s,d){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class xl{constructor(i){this.singleTap=new Qd(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,s,d){this.singleTap.touchstart(i,s,d)}touchmove(i,s,d){this.singleTap.touchmove(i,s,d)}touchend(i,s,d){const x=this.singleTap.touchend(i,s,d);if(x){const w=i.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(w&&E||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class ep{constructor(){this._zoomIn=new xl({numTouches:1,numTaps:2}),this._zoomOut=new xl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,s,d){this._zoomIn.touchstart(i,s,d),this._zoomOut.touchstart(i,s,d)}touchmove(i,s,d){this._zoomIn.touchmove(i,s,d),this._zoomOut.touchmove(i,s,d)}touchend(i,s,d){const x=this._zoomIn.touchend(i,s,d),w=this._zoomOut.touchend(i,s,d);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xu={0:1,2:2};class Bc{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,s){return!1}_move(i,s){return{}}mousedown(i,s){if(this._lastPoint)return;const d=et(i);this._correctButton(i,d)&&(this._lastPoint=s,this._eventButton=d)}mousemoveWindow(i,s){const d=this._lastPoint;if(d){if(i.preventDefault(),this._eventButton!=null&&function(x,w){const E=xu[w];return x.buttons===void 0||(x.buttons&E)!==E}(i,this._eventButton))this.reset();else if(this._moved||!(s.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(d,s)}}mouseupWindow(i){this._lastPoint&&et(i)===this._eventButton&&(this._moved&&Ye(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bu extends Bc{mousedown(i,s){super.mousedown(i,s),this._lastPoint&&(this._active=!0)}_correctButton(i,s){return s===0&&!i.ctrlKey}_move(i,s){return{around:s,panDelta:s.sub(i)}}}class Nc extends Bc{_correctButton(i,s){return s===0&&i.ctrlKey||s===2}_move(i,s){const d=.8*(s.x-i.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(i){i.preventDefault()}}class ed extends Bc{_correctButton(i,s){return s===0&&i.ctrlKey||s===2}_move(i,s){const d=-.5*(s.y-i.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(i){i.preventDefault()}}class xf{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),n.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(i,s,d){return this._calculateTransform(i,s,d)}touchmove(i,s,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!n.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,s,d)}}touchend(i,s,d){this._calculateTransform(i,s,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,s,d){d.length>0&&(this._active=!0);const x=Jo(d,s),w=new n.P(0,0),E=new n.P(0,0);let O=0;for(const j in x){const H=x[j],Z=this._touches[j];Z&&(w._add(H),E._add(H.sub(Z)),O++,x[j]=H)}if(this._touches=x,O<this._minTouches||!E.mag())return;const B=E.div(O);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(O),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ct("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class dh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,s,d){return{}}touchstart(i,s,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([s[0],s[1]]))}touchmove(i,s,d){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[w,E]=x,O=ph(d,s,w),B=ph(d,s,E);if(!O||!B)return;const j=this._aroundCenter?null:O.add(B).div(2);return this._move([O,B],j,i)}touchend(i,s,d){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,E=ph(d,s,x),O=ph(d,s,w);E&&O||(this._active&&Ye(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ph(h,i,s){for(let d=0;d<h.length;d++)if(h[d].identifier===s)return i[d]}function tp(h,i){return Math.log(h/i)/Math.LN2}class wu extends dh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,s){const d=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(tp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tp(this._distance,d),pinchAround:s}}}function Nl(h,i){return 180*h.angleWith(i)/Math.PI}class Tu extends dh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,s){const d=this._vector;if(this._vector=i[0].sub(i[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Nl(this._vector,d),pinchAround:s}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const s=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const x=Nl(i,d);return Math.abs(x)<s}}function Ha(h){return Math.abs(h.y)>Math.abs(h.x)}class Mu extends dh{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Ha(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,s,d){const x=this._lastPoints;if(!x)return;const w=i[0].sub(x[0]),E=i[1].sub(x[1]);return this._map._cooperativeGestures&&!n.dq()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(w,E,d.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+E.y)/2*-.5})}gestureBeginsVertically(i,s,d){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,w=s.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const E=i.y>0==s.y>0;return Ha(i)&&Ha(s)&&E}}const td={panStep:100,bearingStep:15,pitchStep:10};class id{constructor(){const i=td;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let s=0,d=0,x=0,w=0,E=0;switch(i.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:i.shiftKey?d=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?d=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),E=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(d=0,x=0),{cameraAnimation:O=>{const B=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:ip,zoom:s?Math.round(B)+s*(i.shiftKey?2:1):B,bearing:O.getBearing()+d*this._bearingStep,pitch:O.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:O.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ip(h){return h*(2-h)}const fh=4.000244140625,bf=1/450;class ja{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=bf,n.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||n.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const d=n.q.now(),x=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,s!==0&&s%fh==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),i.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=i,this._delta-=s,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=ot(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const j=this._type==="wheel"&&Math.abs(this._delta)>fh?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&H!==0&&(H=1/H);const Z=s(),Y=Math.pow(2,Z),se=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):Y;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(se*H))),this._type==="wheel"&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s(),x=this._startZoom,w=this._easing;let E,O=!1;if(this._type==="wheel"&&x&&w){const j=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),H=w(j);E=n.aa(x,d,H),j<1?this._frameId||(this._frameId=!0):O=!0}else E=d,O=!0;this._active=!0,O&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let B=E-s();return B*this._lastDelta<0&&(B=0),{noInertia:!0,needsRenderFrame:!O,zoomDelta:B,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let s=n.dr;if(this._prevEase){const d=this._prevEase,x=(n.q.now()-d.start)/d.duration,w=d.easing(x+.01)-d.easing(x),E=.27/Math.sqrt(w*w+1e-4)*.01,O=Math.sqrt(.0729-E*E);s=n.dp(E,O,.25,1)}return this._prevEase={start:n.q.now(),duration:i,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ct("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ks{constructor(i,s){this._clickZoom=i,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class np{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,s){return i.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(i.shiftKey?-1:1),around:d.unproject(s)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wf{constructor(){this._tap=new xl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,s,d){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=s[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(i,s,d))}touchmove(i,s,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const x=s[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,s,d)}touchend(i,s,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(i,s,d)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rp{constructor(i,s,d){this._el=i,this._mousePan=s,this._touchPan=d}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Su{constructor(i,s,d){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=s,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class sp{constructor(i,s,d,x){this._el=i,this._touchZoom=s,this._touchRotate=d,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Uc=h=>h.zoom||h.drag||h.pitch||h.rotate;class mh extends n.x{}class Ul{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,s){const d=n.a6.vec3.sub([],s,i);this.radius=n.a6.vec3.length(d[2]<0?n.a6.vec3.div([],d,this.constants):[d[0],d[1],0])}projectRay(i){n.a6.vec3.div(i,i,this.constants),n.a6.vec3.normalize(i,i),n.a6.vec3.mul(i,i,this.constants);const s=n.a6.vec3.scale([],i,this.radius);if(s[2]>0){const d=n.a6.vec3.scale([],[0,0,1],n.a6.vec3.dot(s,[0,0,1])),x=n.a6.vec3.scale([],n.a6.vec3.normalize([],[s[0],s[1],0]),this.radius),w=n.a6.vec3.add([],s,n.a6.vec3.scale([],n.a6.vec3.sub([],n.a6.vec3.add([],x,d),s),2));s[0]=w[0],s[1]=w[1]}return s}}function bl(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class lo{constructor(i,s){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Io(i),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ul,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),n.aJ(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,E]of this._listeners){const O=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,O,E)}}destroy(){for(const[i,s,d]of this._listeners){const x=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(s,x,d)}}_addDefaultHandlers(i){const s=this._map,d=s.getCanvasContainer();this._add("mapEvent",new Ra(s,i));const x=s.boxZoom=new Jd(s,i);this._add("boxZoom",x);const w=new ep,E=new np;s.doubleClickZoom=new Ks(E,w),this._add("tapZoom",w),this._add("clickZoom",E);const O=new wf;this._add("tapDragZoom",O);const B=s.touchPitch=new Mu(s);this._add("touchPitch",B);const j=new Nc(i),H=new ed(i);s.dragRotate=new Su(i,j,H),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const Z=new bu(i),Y=new xf(s,i);s.dragPan=new rp(d,Z,Y),this._add("mousePan",Z),this._add("touchPan",Y,["touchZoom","touchRotate"]);const se=new Tu,pe=new wu;s.touchZoomRotate=new sp(d,pe,se,O),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",pe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fc(s));const ue=s.scrollZoom=new ja(s,this);this._add("scrollZoom",ue,["mousePan"]);const _e=s.keyboard=new id;this._add("keyboard",_e);for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[ge]&&s[ge].enable(i[ge])}_add(i,s,d){this._handlers.push({handlerName:i,handler:s,allowed:d}),this._handlersById[i]=s}stop(i){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Uc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,s,d){for(const x in i)if(x!==d&&(!s||s.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const s=[];for(const d of i)this._el.contains(d.target)&&s.push(d);return s}handleEvent(i,s){this._updatingCamera=!0;const d=i.type==="renderFrame",x=d?void 0:i,w={needsRenderFrame:!1},E={},O={},B=i.touches?this._getMapTouches(i.touches):void 0,j=B?tt(this._el,B):d?void 0:ot(this._el,i);for(const{handlerName:Y,handler:se,allowed:pe}of this._handlers){if(!se.isEnabled())continue;let ue;this._blockedByActive(O,pe,Y)?se.reset():se[s||i.type]&&(ue=se[s||i.type](i,j,B),this.mergeHandlerResult(w,E,ue,Y,x),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||se.isActive())&&(O[Y]=se)}const H={};for(const Y in this._previousActiveHandlers)O[Y]||(H[Y]=x);this._previousActiveHandlers=O,(Object.keys(H).length||bl(w))&&(this._changes.push([w,E,H]),this._triggerRenderFrame()),(Object.keys(O).length||bl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=w;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(i,s,d,x,w){if(!d)return;n.l(i,d);const E={handlerName:x,originalEvent:d.originalEvent||w};d.zoomDelta!==void 0&&(s.zoom=E),d.panDelta!==void 0&&(s.drag=E),d.pitchDelta!==void 0&&(s.pitch=E),d.bearingDelta!==void 0&&(s.rotate=E)}_applyChanges(){const i={},s={},d={};for(const[x,w,E]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new n.P(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),n.l(s,w),n.l(d,E);this._updateMapTransform(i,s,d),this._changes=[]}_updateMapTransform(i,s,d){const x=this._map,w=x.transform,E=Oe=>[Oe.x,Oe.y,Oe.z];if((Oe=>{const Ne=this._eventsInProgress.drag;return Ne&&!this._handlersById[Ne.handlerName].isActive()})()&&!bl(i)){const Oe=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),Oe!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!bl(i))return void this._fireEvents(s,d,!0);let{panDelta:O,zoomDelta:B,bearingDelta:j,pitchDelta:H,around:Z,aroundCoord:Y,pinchAround:se}=i;w._isCameraConstrained&&(B>0&&(B=0),w._isCameraConstrained=!1),se!==void 0&&(Z=se),(B||(Oe=>s[Oe]&&!this._eventsInProgress[Oe])("drag"))&&Z&&(this._dragOrigin=E(w.pointCoordinate3D(Z)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),Z=Z||x.transform.centerPoint,j&&(w.bearing+=j),H&&(w.pitch+=H),w._updateCameraState();const pe=[0,0,0];if(O)if(w.projection.name==="mercator"){const Oe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(Z).dir),Ne=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(Z.sub(O)).dir);pe[0]=Ne[0]-Oe[0],pe[1]=Ne[1]-Oe[1]}else{const Oe=w.pointCoordinate(Z);if(w.projection.name==="globe"){O=O.rotate(-w.angle);const Ne=w._pixelsPerMercatorPixel/w.worldSize;pe[0]=-O.x*n.ds(n.aN(Oe.y))*Ne,pe[1]=-O.y*n.ds(w.center.lat)*Ne}else{const Ne=w.pointCoordinate(Z.sub(O));Oe&&Ne&&(pe[0]=Ne.x-Oe.x,pe[1]=Ne.y-Oe.y)}}const ue=w.zoom,_e=[0,0,0];if(B){const Oe=E(Y||w.pointCoordinate3D(Z)),Ne={dir:n.a6.vec3.normalize([],n.a6.vec3.sub([],Oe,w._camera.position))};if(Ne.dir[2]<0){const Ue=w.zoomDeltaToMovement(Oe,B);n.a6.vec3.scale(_e,Ne.dir,Ue)}}const ge=n.a6.vec3.add(pe,pe,_e);w._translateCameraConstrained(ge),B&&Math.abs(w.zoom-ue)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(s,d,!0)}_fireEvents(i,s,d){const x=Uc(this._eventsInProgress),w=Uc(i),E={};for(const H in i){const{originalEvent:Z}=i[H];this._eventsInProgress[H]||(E[`${H}start`]=Z),this._eventsInProgress[H]=i[H]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const H in E)this._fireEvent(H,E[H]);w&&this._fireEvent("move",w.originalEvent);for(const H in i){const{originalEvent:Z}=i[H];this._fireEvent(H,Z)}const O={};let B;for(const H in this._eventsInProgress){const{handlerName:Z,originalEvent:Y}=this._eventsInProgress[H];this._handlersById[Z].isActive()||(delete this._eventsInProgress[H],B=s[Z]||Y,O[`${H}end`]=B)}for(const H in O)this._fireEvent(H,O[H]);const j=Uc(this._eventsInProgress);if(d&&(x||w)&&!j){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;H?(Z(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:B})):(this._map.fire(new n.x("moveend",{originalEvent:B})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,s){this._map.fire(new n.x(i,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new mh("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Wa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class nd extends n.E{constructor(i,s){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,n.aJ(["_renderFrameCallback"],this)}getCenter(){return new n.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(i,s){return this.jumpTo({center:i},s)}panBy(i,s,d){return i=n.P.convert(i).mult(-1),this.panTo(this.transform.center,n.l({offset:i},s),d)}panTo(i,s,d){return this.easeTo(n.l({center:i},s),d)}getZoom(){return this.transform.zoom}setZoom(i,s){return this.jumpTo({zoom:i},s),this}zoomTo(i,s,d){return this.easeTo(n.l({zoom:i},s),d)}zoomIn(i,s){return this.zoomTo(this.getZoom()+1,i,s),this}zoomOut(i,s){return this.zoomTo(this.getZoom()-1,i,s),this}getBearing(){return this.transform.bearing}setBearing(i,s){return this.jumpTo({bearing:i},s),this}getPadding(){return this.transform.padding}setPadding(i,s){return this.jumpTo({padding:i},s),this}rotateTo(i,s,d){return this.easeTo(n.l({bearing:i},s),d)}resetNorth(i,s){return this.rotateTo(0,n.l({duration:1e3},i),s),this}resetNorthPitch(i,s){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},i),s),this}snapToNorth(i,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,s):this}getPitch(){return this.transform.pitch}setPitch(i,s){return this.jumpTo({pitch:i},s),this}cameraForBounds(i,s){i=n.as.convert(i);const d=s&&s.bearing||0,x=s&&s.pitch||0,w=i.getNorthWest(),E=i.getSouthEast();return this._cameraForBounds(this.transform,w,E,d,x,s)}_extendPadding(i){const s={top:0,right:0,bottom:0,left:0};return i==null?n.l({},s,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:n.l({},s,i)}_extendCameraOptions(i){return(i=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,s){const d=s.max[0]-s.min[0],x=s.max[1]-s.min[1];return d/x>i.aspect?d/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,s,d,x,w,E){const O=i.clone(),B=this._extendCameraOptions(E);O.bearing=x,O.pitch=w;const j=n.bL.convert(s),H=n.bL.convert(d),Z=.5*(j.lat+H.lat),Y=.5*(j.lng+H.lng),se=n.dt(Z,Y),pe=n.a6.vec3.normalize([],se),ue=n.a6.vec3.normalize([],n.a6.vec3.cross([],pe,[0,1,0])),_e=n.a6.vec3.cross([],ue,pe),ge=[ue[0],ue[1],ue[2],0,_e[0],_e[1],_e[2],0,pe[0],pe[1],pe[2],0,0,0,0,1],Oe=[se,n.dt(j.lat,j.lng),n.dt(H.lat,j.lng),n.dt(H.lat,H.lng),n.dt(j.lat,H.lng),n.dt(Z,j.lng),n.dt(Z,H.lng),n.dt(j.lat,Y),n.dt(H.lat,Y)];let Ne=n.ca.fromPoints(Oe.map(ui=>[n.a6.vec3.dot(ue,ui),n.a6.vec3.dot(_e,ui),n.a6.vec3.dot(pe,ui)]));const Ue=n.a6.vec3.transformMat4([],Ne.center,ge);n.a6.vec3.squaredLength(Ue)===0&&n.a6.vec3.set(Ue,0,0,1),n.a6.vec3.normalize(Ue,Ue),n.a6.vec3.scale(Ue,Ue,n.aq),O.center=n.du(Ue);const $e=O.getWorldToCameraMatrix(),Ke=n.a6.mat4.invert(new Float64Array(16),$e);Ne=n.ca.applyTransform(Ne,n.a6.mat4.multiply([],$e,ge));const Ze=this._extendAABB(Ne,O,B,x);if(!Ze)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ne=Ze,n.a6.vec3.transformMat4(Ue,Ue,$e);const it=.5*(Ne.max[2]-Ne.min[2]),gt=this._minimumAABBFrustumDistance(O,Ne),Lt=n.a6.vec3.scale([],[0,0,1],it),wt=n.a6.vec3.add(Lt,Ue,Lt),vt=gt+(O.pitch===0?0:n.a6.vec3.distance(Ue,wt)),ri=O.globeCenterInViewSpace,hi=n.a6.vec3.sub([],Ue,[ri[0],ri[1],ri[2]]);n.a6.vec3.normalize(hi,hi),n.a6.vec3.scale(hi,hi,vt);const Si=n.a6.vec3.add([],Ue,hi);n.a6.vec3.transformMat4(Si,Si,Ke);const Gi=n.dw/n.aq,Ki=n.a6.vec3.length(Si),Wt=n.bE(Math.max(Ki*Gi-n.dw,Number.EPSILON),0),wi=Math.min(O.zoomFromMercatorZAdjusted(Wt),B.maxZoom);return wi>.5*(n.c3+n.bV)?(O.setProjection({name:"mercator"}),O.zoom=wi,this._cameraForBounds(O,s,d,x,w,E)):{center:O.center,zoom:wi,bearing:x,pitch:w}}_extendAABB(i,s,d,x){const w=.5*((d.padding.left||0)+(d.padding.right||0)),E=.5*((d.padding.top||0)+(d.padding.bottom||0)),O=E,B=w,j=w,H=E,Z=s.width-(B+j),Y=s.height-(O+H),se=n.a6.vec3.sub([],i.max,i.min),pe=Math.min(Z/se[0],Y/se[1]),ue=Math.min(s.scaleZoom(s.scale*pe),d.maxZoom);if(isNaN(ue))return null;const _e=s.scale/s.zoomScale(ue),ge=new n.ca([i.min[0]-B*_e,i.min[1]-H*_e,i.min[2]],[i.max[0]+j*_e,i.max[1]+O*_e,i.max[2]]),Oe=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new n.P(d.offset.x,d.offset.y):n.P.convert(d.offset)).rotate(-n.bC(x));return ge.center[0]-=Oe.x*_e,ge.center[1]+=Oe.y*_e,ge}queryTerrainElevation(i,s){const d=this.transform.elevation;return d?(s=n.l({},{exaggerated:!0},s),d.getAtPoint(n.a5.fromLngLat(i),null,s.exaggerated)):null}_cameraForBounds(i,s,d,x,w,E){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,s,d,x,w,E);const O=i.clone(),B=this._extendCameraOptions(E);O.bearing=x,O.pitch=w;const j=n.bL.convert(s),H=n.bL.convert(d),Z=new n.bL(j.lng,H.lat),Y=new n.bL(H.lng,j.lat),se=O.project(j),pe=O.project(H),ue=this.queryTerrainElevation(j),_e=this.queryTerrainElevation(H),ge=this.queryTerrainElevation(Z),Oe=this.queryTerrainElevation(Y),Ne=[[se.x,se.y,Math.min(ue||0,_e||0,ge||0,Oe||0)],[pe.x,pe.y,Math.max(ue||0,_e||0,ge||0,Oe||0)]];let Ue=n.ca.fromPoints(Ne);const $e=O.getWorldToCameraMatrix(),Ke=n.a6.mat4.invert(new Float64Array(16),$e);Ue=n.ca.applyTransform(Ue,$e);const Ze=this._extendAABB(Ue,O,B,x);if(!Ze)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ue=Ze;const it=.5*n.a6.vec3.sub([],Ue.max,Ue.min)[2],gt=this._minimumAABBFrustumDistance(O,Ue),Lt=[0,0,1,0];n.a6.vec4.transformMat4(Lt,Lt,$e),n.a6.vec4.normalize(Lt,Lt);const wt=n.a6.vec3.scale([],Lt,gt+it),vt=n.a6.vec3.add([],Ue.center,wt);n.a6.vec3.transformMat4(Ue.center,Ue.center,Ke),n.a6.vec3.transformMat4(vt,vt,Ke);const ri=O.unproject(new n.P(Ue.center[0],Ue.center[1])),hi=n.dv(O.projection,ri),Si=Math.pow(2,hi),Gi=Math.min(O._zoomFromMercatorZ(vt[2]*O.pixelsPerMeter*Si/O.worldSize),B.maxZoom);return O.mercatorFromTransition&&Gi<.5*(n.c3+n.bV)?(O.setProjection({name:"globe"}),O.zoom=Gi,this._cameraForBounds(O,s,d,x,w,E)):{center:ri,zoom:Gi,bearing:x,pitch:w}}fitBounds(i,s,d){const x=this.cameraForBounds(i,s);return this._fitInternal(x,s,d)}fitScreenCoordinates(i,s,d,x,w){const E=n.P.convert(i),O=n.P.convert(s),B=new n.P(Math.min(E.x,O.x),Math.min(E.y,O.y)),j=new n.P(Math.max(E.x,O.x),Math.max(E.y,O.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,O))return this;const H=this.transform.pointLocation3D(B),Z=this.transform.pointLocation3D(j),Y=this.transform.pointLocation3D(new n.P(B.x,j.y)),se=this.transform.pointLocation3D(new n.P(j.x,B.y)),pe=[Math.min(H.lng,Z.lng,Y.lng,se.lng),Math.min(H.lat,Z.lat,Y.lat,se.lat)],ue=[Math.max(H.lng,Z.lng,Y.lng,se.lng),Math.max(H.lat,Z.lat,Y.lat,se.lat)],_e=x&&x.pitch?x.pitch:this.getPitch(),ge=this._cameraForBounds(this.transform,pe,ue,d,_e,x);return this._fitInternal(ge,x,w)}_fitInternal(i,s,d){return i?(s=n.l(i,s)).linear?this.easeTo(s,d):this.flyTo(s,d):this}jumpTo(i,s){this.stop();const d=i.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,E=!1;"zoom"in i&&d.zoom!==+i.zoom&&(x=!0,d.zoom=+i.zoom),i.center!==void 0&&(d.center=n.bL.convert(i.center)),"bearing"in i&&d.bearing!==+i.bearing&&(w=!0,d.bearing=+i.bearing),"pitch"in i&&d.pitch!==+i.pitch&&(E=!0,d.pitch=+i.pitch);const O=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!d.isPaddingEqual(O))if(i.retainPadding===!1){const B=d.clone();B.padding=O,d.setLocationAtPoint(d.center,B.centerPoint)}else d.padding=O;return i.preloadOnly?(this._preloadTiles(d),this):(this.fire(new n.x("movestart",s)).fire(new n.x("move",s)),x&&this.fire(new n.x("zoomstart",s)).fire(new n.x("zoom",s)).fire(new n.x("zoomend",s)),w&&this.fire(new n.x("rotatestart",s)).fire(new n.x("rotate",s)).fire(new n.x("rotateend",s)),E&&this.fire(new n.x("pitchstart",s)).fire(new n.x("pitch",s)).fire(new n.x("pitchend",s)),this.fire(new n.x("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Wa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,s){const d=this.transform;if(!d.projection.supportsFreeCamera)return n.w(Wa),this;this.stop();const x=d.zoom,w=d.pitch,E=d.bearing;d.setFreeCameraOptions(i);const O=x!==d.zoom,B=w!==d.pitch,j=E!==d.bearing;return this.fire(new n.x("movestart",s)).fire(new n.x("move",s)),O&&this.fire(new n.x("zoomstart",s)).fire(new n.x("zoom",s)).fire(new n.x("zoomend",s)),j&&this.fire(new n.x("rotatestart",s)).fire(new n.x("rotate",s)).fire(new n.x("rotateend",s)),B&&this.fire(new n.x("pitchstart",s)).fire(new n.x("pitch",s)).fire(new n.x("pitchend",s)),this.fire(new n.x("moveend",s)),this}easeTo(i,s){this._stop(!1,i.easeId),((i=n.l({offset:[0,0],duration:500,easing:n.dr},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const d=this.transform,x=this.getZoom(),w=this.getBearing(),E=this.getPitch(),O=this.getPadding(),B="zoom"in i?+i.zoom:x,j="bearing"in i?this._normalizeBearing(i.bearing,w):w,H="pitch"in i?+i.pitch:E,Z=this._extendPadding(i.padding),Y=n.P.convert(i.offset);let se,pe,ue;if(d.projection.name==="globe"){const Lt=n.a5.fromLngLat(d.center),wt=Y.rotate(-d.angle);Lt.x+=wt.x/d.worldSize,Lt.y+=wt.y/d.worldSize;const vt=Lt.toLngLat(),ri=n.bL.convert(i.center||vt);this._normalizeCenter(ri),se=d.centerPoint.add(wt),pe=new n.P(Lt.x,Lt.y).mult(d.worldSize),ue=new n.P(n.am(ri.lng),n.at(ri.lat)).mult(d.worldSize).sub(pe)}else{se=d.centerPoint.add(Y);const Lt=d.pointLocation(se),wt=n.bL.convert(i.center||Lt);this._normalizeCenter(wt),pe=d.project(Lt),ue=d.project(wt).sub(pe)}const _e=d.zoomScale(B-x);let ge,Oe;i.around&&(ge=n.bL.convert(i.around),Oe=d.locationPoint(ge));const Ne=this._zooming||B!==x,Ue=this._rotating||w!==j,$e=this._pitching||H!==E,Ke=!d.isPaddingEqual(Z),Ze=i.retainPadding===!1?d.clone():d,it=Lt=>wt=>{if(Ne&&(Lt.zoom=n.aa(x,B,wt)),Ue&&(Lt.bearing=n.aa(w,j,wt)),$e&&(Lt.pitch=n.aa(E,H,wt)),Ke&&(Ze.interpolatePadding(O,Z,wt),se=Ze.centerPoint.add(Y)),ge)Lt.setLocationAtPoint(ge,Oe);else{const vt=Lt.zoomScale(Lt.zoom-x),ri=B>x?Math.min(2,_e):Math.max(.5,_e),hi=Math.pow(ri,1-wt),Si=Lt.unproject(pe.add(ue.mult(wt*hi)).mult(vt));Lt.setLocationAtPoint(Lt.renderWorldCopies?Si.wrap():Si,se)}return i.preloadOnly||this._fireMoveEvents(s),Lt};if(i.preloadOnly){const Lt=this._emulate(it,i.duration,d);return this._preloadTiles(Lt),this}const gt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ne,this._rotating=Ue,this._pitching=$e,this._padding=Ke,this._easeId=i.easeId,this._prepareEase(s,i.noMoveStart,gt),this._ease(it(d),Lt=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(s,Lt)},i),this}_prepareEase(i,s,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||d.moving||this.fire(new n.x("movestart",i)),this._zooming&&!d.zooming&&this.fire(new n.x("zoomstart",i)),this._rotating&&!d.rotating&&this.fire(new n.x("rotatestart",i)),this._pitching&&!d.pitching&&this.fire(new n.x("pitchstart",i))}_fireMoveEvents(i){this.fire(new n.x("move",i)),this._zooming&&this.fire(new n.x("zoom",i)),this._rotating&&this.fire(new n.x("rotate",i)),this._pitching&&this.fire(new n.x("pitch",i))}_afterEase(i,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new n.x("zoomend",i)),x&&this.fire(new n.x("rotateend",i)),w&&this.fire(new n.x("pitchend",i)),this.fire(new n.x("moveend",i))}flyTo(i,s){if(this._prefersReducedMotion(i)){const ui=n.ar(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ui,s)}this.stop(),i=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dr},i);const d=this.transform,x=this.getZoom(),w=this.getBearing(),E=this.getPitch(),O=this.getPadding(),B="zoom"in i?n.ap(+i.zoom,d.minZoom,d.maxZoom):x,j="bearing"in i?this._normalizeBearing(i.bearing,w):w,H="pitch"in i?+i.pitch:E,Z=this._extendPadding(i.padding),Y=d.zoomScale(B-x),se=n.P.convert(i.offset);let pe=d.centerPoint.add(se);const ue=d.pointLocation(pe),_e=n.bL.convert(i.center||ue);this._normalizeCenter(_e);const ge=d.project(ue),Oe=d.project(_e).sub(ge);let Ne=i.curve;const Ue=Math.max(d.width,d.height),$e=Ue/Y,Ke=Oe.mag();if("minZoom"in i){const ui=n.ap(Math.min(i.minZoom,x,B),d.minZoom,d.maxZoom),Ti=Ue/d.zoomScale(ui-x);Ne=Math.sqrt(Ti/Ke*2)}const Ze=Ne*Ne;function it(ui){const Ti=($e*$e-Ue*Ue+(ui?-1:1)*Ze*Ze*Ke*Ke)/(2*(ui?$e:Ue)*Ze*Ke);return Math.log(Math.sqrt(Ti*Ti+1)-Ti)}function gt(ui){return(Math.exp(ui)-Math.exp(-ui))/2}function Lt(ui){return(Math.exp(ui)+Math.exp(-ui))/2}const wt=it(0);let vt=function(ui){return Lt(wt)/Lt(wt+Ne*ui)},ri=function(ui){return Ue*((Lt(wt)*(gt(Ti=wt+Ne*ui)/Lt(Ti))-gt(wt))/Ze)/Ke;var Ti},hi=(it(1)-wt)/Ne;if(Math.abs(Ke)<1e-6||!isFinite(hi)){if(Math.abs(Ue-$e)<1e-6)return this.easeTo(i,s);const ui=$e<Ue?-1:1;hi=Math.abs(Math.log($e/Ue))/Ne,ri=function(){return 0},vt=function(Ti){return Math.exp(ui*Ne*Ti)}}i.duration="duration"in i?+i.duration:1e3*hi/("screenSpeed"in i?+i.screenSpeed/Ne:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Si=w!==j,Gi=H!==E,Ki=!d.isPaddingEqual(Z),Wt=i.retainPadding===!1?d.clone():d,wi=ui=>Ti=>{const Ci=Ti*hi,mi=1/vt(Ci);ui.zoom=Ti===1?B:x+ui.scaleZoom(mi),Si&&(ui.bearing=n.aa(w,j,Ti)),Gi&&(ui.pitch=n.aa(E,H,Ti)),Ki&&(Wt.interpolatePadding(O,Z,Ti),pe=Wt.centerPoint.add(se));const Xi=Ti===1?_e:ui.unproject(ge.add(Oe.mult(ri(Ci))).mult(mi));return ui.setLocationAtPoint(ui.renderWorldCopies?Xi.wrap():Xi,pe),ui._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(s),ui};if(i.preloadOnly){const ui=this._emulate(wi,i.duration,d);return this._preloadTiles(ui),this}return this._zooming=!0,this._rotating=Si,this._pitching=Gi,this._padding=Ki,this._prepareEase(s,!1),this._ease(wi(d),()=>this._afterEase(s),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,s)}if(!i){const d=this.handlers;d&&d.stop(!1)}return this}_ease(i,s,d){d.animate===!1||d.duration===0?(i(1),s()):(this._easeStart=n.q.now(),this._easeOptions=d,this._onEaseFrame=i,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,s){i=n.bB(i,-180,180);const d=Math.abs(i-s);return Math.abs(i-360-s)<d&&(i-=360),Math.abs(i+360-s)<d&&(i+=360),i}_normalizeCenter(i){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const d=i.lng-s.center.lng;i.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,s,d){const x=Math.ceil(15*s/1e3),w=[],E=i(d.clone());for(let O=0;O<=x;O++){const B=E(O/x);w.push(B.clone())}return w}_preloadTiles(i,s){}}class Vc{constructor(i={}){this.options=i,n.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const s=this.options&&this.options.compact,d=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ct("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const x=ct("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",d),this._innerContainer=ct("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(i){const d=s.reduce((x,w,E)=>(w.value&&(x+=`${w.key}=${w.value}${E<s.length-1?"&":""}`),x),"?");i.href=`${n.e.FEEDBACK_URL}/${d}#${vl(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const s=this._map.style._mergedSourceCaches;for(const x in s){const w=s[x];if(w.used){const E=w.getSource();E.attribution&&i.indexOf(E.attribution)<0&&i.push(E.attribution)}}i.sort((x,w)=>x.length-w.length),i=i.filter((x,w)=>{for(let E=w+1;E<i.length;E++)if(i[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const d=i.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,i.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class op{constructor(){n.aJ(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=ct("div","mapboxgl-ctrl");const s=ct("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const s in i){const d=i[s].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const s=i[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class rd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const s=++this._id;return this._queue.push({callback:i,id:s,cancelled:!1}),s}remove(i){const s=this._currentlyRunning,d=s?this._queue.concat(s):this._queue;for(const x of d)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const d of s)if(!d.cancelled&&(d.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Eu{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const s=n.cw((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,s,d){this._start=this.getValue(s),this._end=i,this._startTime=s,this._endTime=s+d}}const ap={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},lp=["mouseenter","mouseover","mouseleave","mouseout"];class cp extends n.x{constructor(i,s,d,x){const{point:w,lngLat:E,originalEvent:O,target:B}=i;super(i.type,{point:w,lngLat:E,originalEvent:O,target:B}),this.preventDefault=()=>{i.preventDefault()},this.id=s,this.interaction=d,this.feature=x}}class up{constructor(i){this.map=i,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(i,s){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const{type:d,filter:x}=s;if(x){const E=n.M(x,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(E.result==="error")throw new Error(E.value.map(O=>`${O.key}: ${O.message}`).join(", "));this.filters.set(i,E.value)}const w=this.interactionsByType.get(d)||new Map;w.size===0&&(lp.includes(d)?this.map.on(d,s.featureset,this.handleType):this.map.on(d,this.handleType),this.interactionsByType.set(d,w)),w.set(i,s),this.typeById.set(i,d)}remove(i){const s=this.typeById.get(i);if(!s)return;this.typeById.delete(i),this.filters.delete(i);const d=this.interactionsByType.get(s);d&&(d.delete(i),d.size===0&&this.map.off(s,this.handleType))}handleType(i){const s=this.interactionsByType.get(i.type),d=Array.from(s).reverse(),x=[];for(const[,O]of d)O.featureset&&x.push({featureset:O.featureset,filter:O.filter,radius:O.radius});let w=this.map.style.queryRenderedFeaturesForInteractions(i.point,x,this.map.transform);!w.length&&lp.includes(i.type)&&(w=[null]);let E=!1;for(const O of w){for(const[B,j]of d){const{handler:H,featureset:Z}=j;if(Z&&(O==null||n.bi(O.featureset,Z))&&H(new cp(i,B,j,O))!==!1){E=!0;break}}if(E)break}if(!E)for(const[O,B]of d){const{handler:j,featureset:H}=B;if(!H&&j(new cp(i,O,B,null))!==!1)break}}}function nl(h,i){if(Array.isArray(h)&&Array.isArray(i)){const s=new Set(h),d=new Set(i);return s.size===d.size&&h.every(x=>d.has(x))}return n.bi(h,i)}const Vl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class wl{constructor(i,s,d=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Nc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,d&&(this.mousePitch=new ed({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),n.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(i,s){this.mouseRotate.mousedown(i,s),this.mousePitch&&this.mousePitch.mousedown(i,s),Zt()}move(i,s){const d=this.map,x=this.mouseRotate.mousemoveWindow(i,s),w=x&&x.bearingDelta;if(w&&d.setBearing(d.getBearing()+w),this.mousePitch){const E=this.mousePitch.mousemoveWindow(i,s),O=E&&E.pitchDelta;O&&d.setPitch(d.getPitch()+O)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){At(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(n.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),ot(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,ot(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=tt(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=tt(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function rc(h,i,s){if(h=new n.bL(h.lng,h.lat),i){const d=new n.bL(h.lng-360,h.lat),x=new n.bL(h.lng+360,h.lat),w=360*Math.ceil(Math.abs(h.lng-s.center.lng)/360),E=s.locationPoint(h).distSqr(i),O=i.x<0||i.y<0||i.x>s.width||i.y>s.height;s.locationPoint(d).distSqr(i)<E&&(O||Math.abs(d.lng-s.center.lng)<w)?h=d:s.locationPoint(x).distSqr(i)<E&&(O||Math.abs(x.lng-s.center.lng)<w)&&(h=x)}for(;Math.abs(h.lng-s.center.lng)>180;){const d=s.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=s.width&&d.y<=s.height)break;h.lng>s.center.lng?h.lng-=360:h.lng+=360}return h}const sc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Gl extends n.E{constructor(i,s){if(super(),(i instanceof HTMLElement||s)&&(i=n.l({element:i},s)),n.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=n.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=ct("div");const w=41,E=27,O=Dt("svg",{display:"block",height:w*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${w}`},this._element),B=Dt("radialGradient",{id:"shadowGradient"},Dt("defs",{},O));Dt("stop",{offset:"10%","stop-opacity":.4},B),Dt("stop",{offset:"100%","stop-opacity":.05},B),Dt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},O),Dt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},O),Dt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},O),Dt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},O),this._offset=n.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const d=this._element.classList;for(const w in sc)d.remove(`mapboxgl-marker-anchor-${w}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=i&&i.className?i.className.trim().split(/\s+/):[];d.add(...x),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=n.bL.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const s=i.code,d=i.charCode||i.keyCode;s!=="Space"&&s!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(i){const s=i.originalEvent.target,d=this._element;this._popup&&(s===d||d.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,s=this._pos;if(!i||!s)return!1;const d=i.unproject(s),x=i.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(d)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const s=this._pos;if(!s||s.x<0||s.x>i.transform.width||s.y<0||s.y>i.transform.height)return void this._clearFadeTimer();const d=i.unproject(s);let x;i._showingGlobe()&&n.dz(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(d),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${sc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const i=this._pos,s=this._map,d=this.getPitchAlignment();if(!s||!i||d!=="map")return"";if(!s._showingGlobe()){const B=s.getPitch();return B?`rotateX(${B}deg)`:""}const x=n.c1(n.dA(s.transform,this._lngLat)),w=i.sub(n.dB(s.transform)),E=Math.abs(w.x)+Math.abs(w.y);if(E===0)return"";const O=x/E;return`rotateX(${-w.y*O}deg) rotateY(${w.x*O}deg)`}_calculateZTransform(){const i=this._pos,s=this._map;if(!s||!i)return"";let d=0;const x=this.getRotationAlignment();if(x==="map")if(s._showingGlobe()){const w=s.project(new n.bL(this._lngLat.lng,this._lngLat.lat+.001)),E=s.project(new n.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);d=n.c1(Math.atan2(E.y,E.x))-90}else d=-s.getBearing();else if(x==="horizon"){const w=n.a7(4,6,s.getZoom()),E=n.dB(s.transform);E.y+=w*s.transform.height;const O=i.sub(E),B=n.c1(Math.atan2(O.y,O.x));d=(B>90?B-270:B+90)*(1-w)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=rc(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=n.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const s=this._map;if(!s)return;const d=this._pointerdownPos,x=this._positionDelta;if(d&&x){if(!this._isDragging){const w=this._clickTolerance||s._clickTolerance;if(i.point.dist(d)<w)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.x("dragstart"))),this.fire(new n.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.x("dragend")),this._state="inactive"}_addDragHandler(i){const s=this._map,d=this._pos;s&&d&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(d),this._pointerdownPos=i.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const s=this._map;return s&&(i?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ug={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vg={maxWidth:100,unit:"metric"},Tf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Gg={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Au=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qo(h=new n.P(0,0),i="bottom"){if(typeof h=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(i){case"top":return new n.P(0,h);case"top-left":return new n.P(s,s);case"top-right":return new n.P(-s,s);case"bottom":return new n.P(0,-h);case"bottom-left":return new n.P(s,-s);case"bottom-right":return new n.P(-s,-s);case"left":return new n.P(h,0);case"right":return new n.P(-h,0)}return new n.P(0,0)}return h instanceof n.P||Array.isArray(h)?n.P.convert(h):n.P.convert(h[i]||[0,0])}return{version:J,supported:Ut.supported,setRTLTextPlugin:n.dC,getRTLTextPluginStatus:n.dD,Map:class extends nd{constructor(h){ce.mark(re.create);const i=h;if((h=n.l({},Vl,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&n.dx(window)&&(h.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new iu(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new rd,this._domRenderTaskQueue=new rd,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aQ(),this._locale=n.l({},ap,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Eu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new Qt(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?{...h.contextCreateOptions}:{},typeof h.container=="string"){const s=document.getElementById(h.container);if(!s)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=s}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),n.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new ch),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new lo(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||n.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new gu(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const s=h.bounds;s&&(this.resize(),this.fitBounds(s,n.l({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Vc({customAttribution:h.customAttribution})),this._logoControl=new op,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new n.x(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new n.x(`${s.dataType}dataloading`,s))}),this._interactions=new up(this)}_getMapId(){return this._mapId}addControl(h,i){if(i===void 0&&(i=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new n.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[i];return i.indexOf("bottom")!==-1?d.insertBefore(s,d.firstChild):d.appendChild(s),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new n.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(h);return i>-1&&this._controls.splice(i,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new n.x("movestart",h)).fire(new n.x("move",h)),this.fire(new n.x("resize",h)),i&&this.fire(new n.x("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(n.as.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(i=>i==="auto"?navigator.language:i):h}setLanguage(h){const i=this._parseLanguage(h);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,i=h.projection.name;let s;i==="globe"&&h.zoom>=n.bV?(h.setMercatorFromTransition(),s=!0):i==="mercator"&&h.zoom<n.bV&&(h.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,i){return this._updateProjection(h||i||{name:"mercator"})}_updateProjection(h){let i;return i=h.name==="globe"&&this.transform.zoom>=n.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(n.bL.convert(h))}unproject(h){return this.transform.pointLocation3D(n.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,i,s){const d=x=>{let w=[];if(Array.isArray(i)){const E=i.filter(O=>this.getLayer(O));w=E.length?this.queryRenderedFeatures(x,{layers:E}):[]}else w=this.queryRenderedFeatures(x,{featureset:i});return w};if(h==="mouseenter"||h==="mouseover"){let x=!1;return{listener:s,targets:i,delegates:{mousemove:E=>{const O=d(E.point);O.length?x||(x=!0,s.call(this,new qs(h,this,E.originalEvent,{features:O}))):x=!1},mouseout:()=>{x=!1}}}}if(h==="mouseleave"||h==="mouseout"){let x=!1;return{listener:s,targets:i,delegates:{mousemove:O=>{d(O.point).length?x=!0:x&&(x=!1,s.call(this,new qs(h,this,O.originalEvent)))},mouseout:O=>{x&&(x=!1,s.call(this,new qs(h,this,O.originalEvent)))}}}}{const x=w=>{const E=d(w.point);E.length&&(w.features=E,s.call(this,w),delete w.features)};return{listener:s,targets:i,delegates:{[h]:x}}}}on(h,i,s){if(typeof i=="function"||s===void 0)return super.on(h,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._createDelegatedListener(h,i,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const x in d.delegates)this.on(x,d.delegates[x]);return this}once(h,i,s){if(typeof i=="function"||s===void 0)return super.once(h,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._createDelegatedListener(h,i,s);for(const x in d.delegates)this.once(x,d.delegates[x]);return this}off(h,i,s){if(typeof i=="function"||s===void 0)return super.off(h,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(x=>{for(let w=0;w<x.length;w++){const E=x[w];if(E.listener===s&&nl(E.targets,i)){for(const O in E.delegates)this.off(O,E.delegates[O]);return x.splice(w,1),this}}})(d),this}queryRenderedFeatures(h,i){if(!this.style)return[];if(i!==void 0||h===void 0||h instanceof n.P||Array.isArray(h)||(i=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(i=i||{}))return this._isFeaturesetDescriptorValid(i.featureset)?this.style.queryRenderedFeaturesForInteractions(h,[i],this.transform):[];if(i.layers&&Array.isArray(i.layers)){for(const s of i.layers)if(!this._isValidId(s))return[]}return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(h,i){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,i)}isPointOnSurface(h){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&n.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(h))}addInteraction(h,i){return this._interactions.add(h,i),this}removeInteraction(h){return this._interactions.remove(h),this}setStyle(h,i){return i=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&h&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(h,(s,d)=>{s?(n.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(h,i)):d&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(h,i))}_getUIString(h){const i=this._locale[h];if(i==null)throw new Error(`Missing UI string '${h}'`);return i}_updateStyle(h,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const s=n.l({},i);i&&i.config&&(s.initialConfig=i.config,delete s.config),this.style=new Na(this,s).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new n.t(new Error("IDs can't be empty."))),!1):!n.aK(h)||(this.fire(new n.t(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isFeaturesetDescriptorValid(h){return"featuresetId"in h?this._isValidId(h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const i of h)if(!this._isValidId(i))return!1;return!0}return this._isFeaturesetDescriptorValid(h)}addSource(h,i){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,i),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,i,s){this._lazyInitEmptyStyle(),this.style.addSourceType(h,i,s)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,i,{pixelRatio:s=1,sdf:d=!1,stretchX:x,stretchY:w,content:E}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:O,height:B,data:j}=n.q.getImageData(i);this.style.addImage(h,{data:new n.r({width:O,height:B},j),pixelRatio:s,stretchX:x,stretchY:w,content:E,sdf:d,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new n.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:B}=i,j=i;this.style.addImage(h,{data:new n.r({width:O,height:B},new Uint8Array(j.data)),pixelRatio:s,stretchX:x,stretchY:w,content:E,sdf:d,version:0,userImage:j}),j.onAdd&&j.onAdd(this,h)}}updateImage(h,i){this._lazyInitEmptyStyle();const s=this.style.getImage(h);if(!s)return void this.fire(new n.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?n.q.getImageData(i):i,{width:x,height:w,data:E}=d;if(x===void 0||w===void 0)return void this.fire(new n.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==s.data.width||w!==s.data.height)return void this.fire(new n.t(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`)));const O=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);s.data.replace(E,O),this.style.updateImage(h,s)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new n.t(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,i){n.o(this._requestManager.transformRequest(h,n.R.Image),(s,d)=>{i(s,d instanceof HTMLImageElement?n.q.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(h,i){this._lazyInitEmptyStyle(),this.style.addModel(h,i)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new n.t(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,i){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,i),this._update(!0)):this}getSlot(h){const i=this.getLayer(h);return i&&i.slot||null}setSlot(h,i){return this.style.setSlot(h,i),this.style.mergeLayers(),this._update(!0)}addImport(h,i){return this.style.addImport(h,i),this}updateImport(h,i){return typeof i!="string"&&i.id!==h?(this.removeImport(h),this.addImport(i)):(this.style.updateImport(h,i),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,i){return this.style.moveImport(h,i),this._update(!0)}moveLayer(h,i){return this._isValidId(h)?(this.style.moveLayer(h,i),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const i=this.style.getOwnLayer(h);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,i,s){return this._isValidId(h)?(this.style.setLayerZoomRange(h,i,s),this._update(!0)):this}setFilter(h,i,s={}){return this._isValidId(h)?(this.style.setFilter(h,i,s),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,i,s,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,i,s,d),this._update(!0)):this}getPaintProperty(h,i){return this._isValidId(h)?this.style.getPaintProperty(h,i):null}setLayoutProperty(h,i,s,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,i,s,d),this._update(!0)):this}getLayoutProperty(h,i){return this._isValidId(h)?this.style.getLayoutProperty(h,i):null}getSchema(h){return this.style.getSchema(h)}setSchema(h,i){return this.style.setSchema(h,i),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,i){return this.style.setConfig(h,i),this._update(!0)}getConfigProperty(h,i){return this.style.getConfigProperty(h,i)}setConfigProperty(h,i,s){return this.style.setConfigProperty(h,i,s),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const i=h[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bL.convert(h),this.transform):0}setFeatureState(h,i){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,i),this._update())}removeFeatureState(h,i){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,i),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let s,d,x,w=this._container;for(;w&&(!d||!x);){const E=window.getComputedStyle(w).transform;E&&E!=="none"&&(s=E.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(d=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(x=s[3])),w=w.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=ct("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=ct("div","mapboxgl-canvas-container",h);this._canvas=ct("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=ct("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{d[x]=ct("div",`mapboxgl-ctrl-${x}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,i){const s=n.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(h),this._canvas.height=s*Math.ceil(i),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${i}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const i=this._markers.indexOf(h);i!==-1&&this._markers.splice(i,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const i=this._popups.indexOf(h);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const h=n.l({},Ut.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",h);i?(pr(i,!0),this.painter=new tc(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(i)):this.fire(new n.t(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.x("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new n.x("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let i;this.fire(new n.x("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,d=n.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=x.createQuery(),x.beginQuery(s.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,H=this.transform.pitch,Z=n.q.now(),Y=new n.a3(j,{now:Z,fadeDuration:w,pitch:H,transition:this.style.transition});this.style.update(Y)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(d);const O=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),O&&(this._placementDirty=O.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ce.mark(re.load),this.fire(new n.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const j=n.q.now()-d;x.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const H=x.getQueryParameter(i,x.QUERY_RESULT)/1e6;x.deleteQuery(i),this.fire(new n.x("gpu-timing-frame",{cpuTime:j,gpuTime:H}))},50)}if(this.listens("gpu-timing-layer")){const j=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(j);this.fire(new n.x("gpu-timing-layer",{layerTimes:H}))},50)}if(this.listens("gpu-timing-deferred-render")){const j=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const H=this.painter.queryGpuTimeDeferredRender(j);this.fire(new n.x("gpu-timing-deferred-render",{gpuTime:H}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(B||this._repaint)this.triggerRepaint();else{const j=this.idle();if(j&&(E=this._updateAverageElevation(d,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),j&&(this.fire(new n.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new n.x("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,ce.mark(re.fullLoad),this._performanceMetricsCollection&&on(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const i of this._markers)h&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!h||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(h,i=!1){const s=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(i||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=h;const E=Math.abs(x-w);if(E>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(w),s(w);this._averageElevation.easeTo(w,h,300)}else if(E>1e-4)return this._averageElevation.jumpTo(w),s(w)}return!!this._averageElevation.isEasing(h)&&s(this._averageElevation.getValue(h))}_authenticate(){Qe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===_t||h.status===401)){const i=this.painter.context.gl;pr(i,!1),this._logoControl instanceof op&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Gt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&zi(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const s=this.painter.context.gl,d=s.createFramebuffer();function x(w){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,w,0);const E=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,E),E}return s.bindFramebuffer(s.FRAMEBUFFER,d),this._canvasPixelComparison(x(h),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(h,i,s){let d=s[1]-s[0];const x=h.length/4;for(let w=0;w<i.length;w++){const E=i[w];let O=0;for(let B=0;B<E.length;B+=4)E[B]===h[B]&&E[B+1]===h[B+1]&&E[B+2]===h[B+2]&&E[B+3]===h[B+3]&&(O+=1);d+=(s[w+2]-s[w+1])*(1-O/x)}return d}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Yn.delete(this.painter.context.gl),mn.remove(),Nt.remove(),this._removed=!0,this.fire(new n.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=n.q.frame(i=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(i)}))}_preloadTiles(h){const i=this.style?this.style.getSourceCaches():[];return n.bg(i,(s,d)=>s._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,i){n.dy(h,i)}get version(){return J}},NavigationControl:class{constructor(h={}){this.options=n.l({},nc,h),this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(n.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),ct("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),ct("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:i}):s.resetNorth({},{originalEvent:i}))}),this._compassIcon=ct("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const i=h.getZoom(),s=i===h.getMaxZoom(),d=i===h.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wl(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,i){const s=ct("button",h,this._container);return s.type="button",s.addEventListener("click",i),s}_setButtonTitle(h,i){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${i}`);h.setAttribute("aria-label",s),h.firstElementChild&&h.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends n.E{constructor(h={}){super();const i=navigator.geolocation;this.options=n.l({geolocation:i},Ug,h),n.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ic(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const i=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,h(s)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>i(s.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(h){const i=this._map.getMaxBounds(),s=h.coords;return!!i&&(s.longitude<i.getWest()||s.longitude>i.getEast()||s.latitude<i.getSouth()||s.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.x("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("geolocate",h)),this._finish()}}_updateCamera(h){const i=new n.bL(h.coords.longitude,h.coords.latitude),s=h.coords.accuracy,d=this._map.getBearing(),x=n.l({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(s),x,{geolocateSource:!0})}_updateMarker(h){if(h){const i=new n.bL(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,i=n.bE(1,h._center.lat)*h.worldSize,s=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=ct("button","mapboxgl-ctrl-geolocate",this._container),ct("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ct("div","mapboxgl-user-location"),this._dotElement.appendChild(ct("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ct("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ct("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.x("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Vc,ScaleControl:class{constructor(h={}){this.options=n.l({},Vg,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,i=this._map,s=i._containerHeight/2,d=i._containerWidth/2-h/2,x=i.unproject([d,s]),w=i.unproject([d+h,s]),E=x.distanceTo(w);if(this.options.unit==="imperial"){const O=3.2808*E;O>5280?this._setScale(h,O/5280,"mile"):this._setScale(h,O,"foot")}else this.options.unit==="nautical"?this._setScale(h,E/1852,"nautical-mile"):E>=1e3?this._setScale(h,E/1e3,"kilometer"):this._setScale(h,E,"meter")}_setScale(h,i,s){this._map._requestDomTask(()=>{const d=function(w){const E=Math.pow(10,`${Math.floor(w)}`.length-1);let O=w/E;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(B){const j=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*j)/j}(O),E*O}(i),x=d/i;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(d):`${d}&nbsp;${Tf[s]}`,this._container.style.width=h*x+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=ct("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:n.w("Full screen control 'container' must be a DOM element.")),n.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=ct("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ct("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(h){super(),this.options=n.l(Object.create(Gg),h),n.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new n.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new n.x("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=n.bL.convert(h),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const i=document.createDocumentFragment(),s=document.createElement("body");let d;for(s.innerHTML=h;d=s.firstChild,d;)i.appendChild(d);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=ct("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(h),this.options.closeButton){const s=this._closeButton=ct("button","mapboxgl-popup-close-button",i);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let i;return this._classList.delete(h)?i=!1:(this._classList.add(h),i=!0),this._updateClassList(),i}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const i=this._map,s=this._container,d=this._pos;if(!i||!s||!d)return"bottom";const x=s.offsetWidth,w=s.offsetHeight,E=d.x<x/2,O=d.x>i.transform.width-x/2;if(d.y+h<w)return E?"top-left":O?"top-right":"top";if(d.y>i.transform.height-w){if(E)return"bottom-left";if(O)return"bottom-right"}return E?"left":O?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),h.className=i.join(" ")}_update(h){const i=this._map,s=this._content;if(!i||!this._lngLat&&!this._trackPointer||!s)return;let d=this._container;if(d||(d=this._container=ct("div","mapboxgl-popup",i.getContainer()),this._tip=ct("div","mapboxgl-popup-tip",d),d.appendChild(s)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rc(this._lngLat,this._pos,i.transform)),!this._trackPointer||h){const x=this._pos=this._trackPointer&&h instanceof n.P?h:i.project(this._lngLat),w=Qo(this.options.offset),E=this._anchor=this._getAnchor(w.y),O=Qo(this.options.offset,E),B=x.add(O).round();i._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${sc[E]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=n.dz(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Au);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Gl,Style:Na,LngLat:n.bL,LngLatBounds:n.as,Point:n.P,MercatorCoordinate:n.a5,FreeCameraOptions:go,Evented:n.E,config:n.e,prewarm:n.dE,clearPrewarmedResources:n.dF,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(h){n.e.ACCESS_TOKEN=h},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(h){n.e.API_URL=h},get workerCount(){return n.dG.workerCount},set workerCount(h){n.dG.workerCount=h},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){n.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){n.dH(h)},get workerUrl(){return n.dI.workerUrl},set workerUrl(h){n.dI.workerUrl=h},get workerClass(){return n.dI.workerClass},set workerClass(h){n.dI.workerClass=h},get workerParams(){return n.dI.workerParams},set workerParams(h){n.dI.workerParams=h},get dracoUrl(){return n.dJ()},set dracoUrl(h){n.dK(h)},get meshoptUrl(){return n.dL()},set meshoptUrl(h){n.dM(h)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var V=F;return V})}(b0)),b0.exports}var pI=dI();const JT=L2(pI);var w0={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/var fI=w0.exports,QT;function mI(){return QT||(QT=1,function(v,y){(function(p,z){v.exports=z()})(fI,function p(){var z=typeof self<"u"?self:typeof window<"u"?window:z!==void 0?z:{},F=!z.document&&!!z.postMessage,q=z.IS_PAPA_WORKER||!1,V={},n=0,J={parse:function(ot,tt){var et=(tt=tt||{}).dynamicTyping||!1;if(Ye(et)&&(tt.dynamicTypingFunction=et,et={}),tt.dynamicTyping=et,tt.transform=!!Ye(tt.transform)&&tt.transform,tt.worker&&J.WORKERS_SUPPORTED){var Rt=function(){if(!J.WORKERS_SUPPORTED)return!1;var _t=(ae=z.URL||z.webkitURL||null,be=p.toString(),J.BLOB_URL||(J.BLOB_URL=ae.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",be,")();"],{type:"text/javascript"})))),Qt=new z.Worker(_t),ae,be;return Qt.onmessage=pt,Qt.id=n++,V[Qt.id]=Qt}();return Rt.userStep=tt.step,Rt.userChunk=tt.chunk,Rt.userComplete=tt.complete,Rt.userError=tt.error,tt.step=Ye(tt.step),tt.chunk=Ye(tt.chunk),tt.complete=Ye(tt.complete),tt.error=Ye(tt.error),delete tt.worker,void Rt.postMessage({input:ot,config:tt,workerId:Rt.id})}var at=null;return J.NODE_STREAM_INPUT,typeof ot=="string"?(ot=function(_t){return _t.charCodeAt(0)===65279?_t.slice(1):_t}(ot),at=tt.download?new Se(tt):new ht(tt)):ot.readable===!0&&Ye(ot.read)&&Ye(ot.on)?at=new Ut(tt):(z.File&&ot instanceof File||ot instanceof Object)&&(at=new Xe(tt)),at.stream(ot)},unparse:function(ot,tt){var et=!1,Rt=!0,at=",",_t=`\r
`,Qt='"',ae=Qt+Qt,be=!1,ve=null,De=!1;(function(){if(typeof tt=="object"){if(typeof tt.delimiter!="string"||J.BAD_DELIMITERS.filter(function(mt){return tt.delimiter.indexOf(mt)!==-1}).length||(at=tt.delimiter),(typeof tt.quotes=="boolean"||typeof tt.quotes=="function"||Array.isArray(tt.quotes))&&(et=tt.quotes),typeof tt.skipEmptyLines!="boolean"&&typeof tt.skipEmptyLines!="string"||(be=tt.skipEmptyLines),typeof tt.newline=="string"&&(_t=tt.newline),typeof tt.quoteChar=="string"&&(Qt=tt.quoteChar),typeof tt.header=="boolean"&&(Rt=tt.header),Array.isArray(tt.columns)){if(tt.columns.length===0)throw new Error("Option columns is empty");ve=tt.columns}tt.escapeChar!==void 0&&(ae=tt.escapeChar+Qt),(typeof tt.escapeFormulae=="boolean"||tt.escapeFormulae instanceof RegExp)&&(De=tt.escapeFormulae instanceof RegExp?tt.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var Ce=new RegExp(Dt(Qt),"g");if(typeof ot=="string"&&(ot=JSON.parse(ot)),Array.isArray(ot)){if(!ot.length||Array.isArray(ot[0]))return Vt(null,ot,be);if(typeof ot[0]=="object")return Vt(ve||Object.keys(ot[0]),ot,be)}else if(typeof ot=="object")return typeof ot.data=="string"&&(ot.data=JSON.parse(ot.data)),Array.isArray(ot.data)&&(ot.fields||(ot.fields=ot.meta&&ot.meta.fields||ve),ot.fields||(ot.fields=Array.isArray(ot.data[0])?ot.fields:typeof ot.data[0]=="object"?Object.keys(ot.data[0]):[]),Array.isArray(ot.data[0])||typeof ot.data[0]=="object"||(ot.data=[ot.data])),Vt(ot.fields||[],ot.data||[],be);throw new Error("Unable to serialize unrecognized input");function Vt(mt,Nt,Gt){var ii="";typeof mt=="string"&&(mt=JSON.parse(mt)),typeof Nt=="string"&&(Nt=JSON.parse(Nt));var zi=Array.isArray(mt)&&0<mt.length,Hi=!Array.isArray(Nt[0]);if(zi&&Rt){for(var on=0;on<mt.length;on++)0<on&&(ii+=at),ii+=zt(mt[on],on);0<Nt.length&&(ii+=_t)}for(var mn=0;mn<Nt.length;mn++){var Qe=zi?mt.length:Nt[mn].length,Yn=!1,pr=zi?Object.keys(Nt[mn]).length===0:Nt[mn].length===0;if(Gt&&!zi&&(Yn=Gt==="greedy"?Nt[mn].join("").trim()==="":Nt[mn].length===1&&Nt[mn][0].length===0),Gt==="greedy"&&zi){for(var bt=[],je=0;je<Qe;je++){var Ot=Hi?mt[je]:je;bt.push(Nt[mn][Ot])}Yn=bt.join("").trim()===""}if(!Yn){for(var Le=0;Le<Qe;Le++){0<Le&&!pr&&(ii+=at);var Ie=zi&&Hi?mt[Le]:Le;ii+=zt(Nt[mn][Ie],Le)}mn<Nt.length-1&&(!Gt||0<Qe&&!pr)&&(ii+=_t)}}return ii}function zt(mt,Nt){if(mt==null)return"";if(mt.constructor===Date)return JSON.stringify(mt).slice(1,25);var Gt=!1;De&&typeof mt=="string"&&De.test(mt)&&(mt="'"+mt,Gt=!0);var ii=mt.toString().replace(Ce,ae);return(Gt=Gt||et===!0||typeof et=="function"&&et(mt,Nt)||Array.isArray(et)&&et[Nt]||function(zi,Hi){for(var on=0;on<Hi.length;on++)if(-1<zi.indexOf(Hi[on]))return!0;return!1}(ii,J.BAD_DELIMITERS)||-1<ii.indexOf(at)||ii.charAt(0)===" "||ii.charAt(ii.length-1)===" ")?Qt+ii+Qt:ii}}};if(J.RECORD_SEP="",J.UNIT_SEP="",J.BYTE_ORDER_MARK="\uFEFF",J.BAD_DELIMITERS=["\r",`
`,'"',J.BYTE_ORDER_MARK],J.WORKERS_SUPPORTED=!F&&!!z.Worker,J.NODE_STREAM_INPUT=1,J.LocalChunkSize=10485760,J.RemoteChunkSize=5242880,J.DefaultDelimiter=",",J.Parser=rt,J.ParserHandle=ct,J.NetworkStreamer=Se,J.FileStreamer=Xe,J.StringStreamer=ht,J.ReadableStreamStreamer=Ut,z.jQuery){var re=z.jQuery;re.fn.parse=function(ot){var tt=ot.config||{},et=[];return this.each(function(_t){if(!(re(this).prop("tagName").toUpperCase()==="INPUT"&&re(this).attr("type").toLowerCase()==="file"&&z.FileReader)||!this.files||this.files.length===0)return!0;for(var Qt=0;Qt<this.files.length;Qt++)et.push({file:this.files[Qt],inputElem:this,instanceConfig:re.extend({},tt)})}),Rt(),this;function Rt(){if(et.length!==0){var _t,Qt,ae,be,ve=et[0];if(Ye(ot.before)){var De=ot.before(ve.file,ve.inputElem);if(typeof De=="object"){if(De.action==="abort")return _t="AbortError",Qt=ve.file,ae=ve.inputElem,be=De.reason,void(Ye(ot.error)&&ot.error({name:_t},Qt,ae,be));if(De.action==="skip")return void at();typeof De.config=="object"&&(ve.instanceConfig=re.extend(ve.instanceConfig,De.config))}else if(De==="skip")return void at()}var Ce=ve.instanceConfig.complete;ve.instanceConfig.complete=function(Vt){Ye(Ce)&&Ce(Vt,ve.file,ve.inputElem),at()},J.parse(ve.file,ve.instanceConfig)}else Ye(ot.complete)&&ot.complete()}function at(){et.splice(0,1),Rt()}}}function ce(ot){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(tt){var et=At(tt);et.chunkSize=parseInt(et.chunkSize),tt.step||tt.chunk||(et.chunkSize=null),this._handle=new ct(et),(this._handle.streamer=this)._config=et}).call(this,ot),this.parseChunk=function(tt,et){if(this.isFirstChunk&&Ye(this._config.beforeFirstChunk)){var Rt=this._config.beforeFirstChunk(tt);Rt!==void 0&&(tt=Rt)}this.isFirstChunk=!1,this._halted=!1;var at=this._partialLine+tt;this._partialLine="";var _t=this._handle.parse(at,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var Qt=_t.meta.cursor;this._finished||(this._partialLine=at.substring(Qt-this._baseIndex),this._baseIndex=Qt),_t&&_t.data&&(this._rowCount+=_t.data.length);var ae=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(q)z.postMessage({results:_t,workerId:J.WORKER_ID,finished:ae});else if(Ye(this._config.chunk)&&!et){if(this._config.chunk(_t,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);_t=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(_t.data),this._completeResults.errors=this._completeResults.errors.concat(_t.errors),this._completeResults.meta=_t.meta),this._completed||!ae||!Ye(this._config.complete)||_t&&_t.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),ae||_t&&_t.meta.paused||this._nextChunk(),_t}this._halted=!0},this._sendError=function(tt){Ye(this._config.error)?this._config.error(tt):q&&this._config.error&&z.postMessage({workerId:J.WORKER_ID,error:tt,finished:!1})}}function Se(ot){var tt;(ot=ot||{}).chunkSize||(ot.chunkSize=J.RemoteChunkSize),ce.call(this,ot),this._nextChunk=F?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(et){this._input=et,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(tt=new XMLHttpRequest,this._config.withCredentials&&(tt.withCredentials=this._config.withCredentials),F||(tt.onload=It(this._chunkLoaded,this),tt.onerror=It(this._chunkError,this)),tt.open(this._config.downloadRequestBody?"POST":"GET",this._input,!F),this._config.downloadRequestHeaders){var et=this._config.downloadRequestHeaders;for(var Rt in et)tt.setRequestHeader(Rt,et[Rt])}if(this._config.chunkSize){var at=this._start+this._config.chunkSize-1;tt.setRequestHeader("Range","bytes="+this._start+"-"+at)}try{tt.send(this._config.downloadRequestBody)}catch(_t){this._chunkError(_t.message)}F&&tt.status===0&&this._chunkError()}},this._chunkLoaded=function(){tt.readyState===4&&(tt.status<200||400<=tt.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:tt.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(et){var Rt=et.getResponseHeader("Content-Range");return Rt===null?-1:parseInt(Rt.substring(Rt.lastIndexOf("/")+1))}(tt),this.parseChunk(tt.responseText)))},this._chunkError=function(et){var Rt=tt.statusText||et;this._sendError(new Error(Rt))}}function Xe(ot){var tt,et;(ot=ot||{}).chunkSize||(ot.chunkSize=J.LocalChunkSize),ce.call(this,ot);var Rt=typeof FileReader<"u";this.stream=function(at){this._input=at,et=at.slice||at.webkitSlice||at.mozSlice,Rt?((tt=new FileReader).onload=It(this._chunkLoaded,this),tt.onerror=It(this._chunkError,this)):tt=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var at=this._input;if(this._config.chunkSize){var _t=Math.min(this._start+this._config.chunkSize,this._input.size);at=et.call(at,this._start,_t)}var Qt=tt.readAsText(at,this._config.encoding);Rt||this._chunkLoaded({target:{result:Qt}})},this._chunkLoaded=function(at){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(at.target.result)},this._chunkError=function(){this._sendError(tt.error)}}function ht(ot){var tt;ce.call(this,ot=ot||{}),this.stream=function(et){return tt=et,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var et,Rt=this._config.chunkSize;return Rt?(et=tt.substring(0,Rt),tt=tt.substring(Rt)):(et=tt,tt=""),this._finished=!tt,this.parseChunk(et)}}}function Ut(ot){ce.call(this,ot=ot||{});var tt=[],et=!0,Rt=!1;this.pause=function(){ce.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){ce.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(at){this._input=at,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){Rt&&tt.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),tt.length?this.parseChunk(tt.shift()):et=!0},this._streamData=It(function(at){try{tt.push(typeof at=="string"?at:at.toString(this._config.encoding)),et&&(et=!1,this._checkIsFinished(),this.parseChunk(tt.shift()))}catch(_t){this._streamError(_t)}},this),this._streamError=It(function(at){this._streamCleanUp(),this._sendError(at)},this),this._streamEnd=It(function(){this._streamCleanUp(),Rt=!0,this._streamData("")},this),this._streamCleanUp=It(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ct(ot){var tt,et,Rt,at=Math.pow(2,53),_t=-at,Qt=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ae=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,be=this,ve=0,De=0,Ce=!1,Vt=!1,zt=[],mt={data:[],errors:[],meta:{}};if(Ye(ot.step)){var Nt=ot.step;ot.step=function(mn){if(mt=mn,zi())ii();else{if(ii(),mt.data.length===0)return;ve+=mn.data.length,ot.preview&&ve>ot.preview?et.abort():(mt.data=mt.data[0],Nt(mt,be))}}}function Gt(mn){return ot.skipEmptyLines==="greedy"?mn.join("").trim()==="":mn.length===1&&mn[0].length===0}function ii(){return mt&&Rt&&(on("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+J.DefaultDelimiter+"'"),Rt=!1),ot.skipEmptyLines&&(mt.data=mt.data.filter(function(mn){return!Gt(mn)})),zi()&&function(){if(!mt)return;function mn(Yn,pr){Ye(ot.transformHeader)&&(Yn=ot.transformHeader(Yn,pr)),zt.push(Yn)}if(Array.isArray(mt.data[0])){for(var Qe=0;zi()&&Qe<mt.data.length;Qe++)mt.data[Qe].forEach(mn);mt.data.splice(0,1)}else mt.data.forEach(mn)}(),function(){if(!mt||!ot.header&&!ot.dynamicTyping&&!ot.transform)return mt;function mn(Yn,pr){var bt,je=ot.header?{}:[];for(bt=0;bt<Yn.length;bt++){var Ot=bt,Le=Yn[bt];ot.header&&(Ot=bt>=zt.length?"__parsed_extra":zt[bt]),ot.transform&&(Le=ot.transform(Le,Ot)),Le=Hi(Ot,Le),Ot==="__parsed_extra"?(je[Ot]=je[Ot]||[],je[Ot].push(Le)):je[Ot]=Le}return ot.header&&(bt>zt.length?on("FieldMismatch","TooManyFields","Too many fields: expected "+zt.length+" fields but parsed "+bt,De+pr):bt<zt.length&&on("FieldMismatch","TooFewFields","Too few fields: expected "+zt.length+" fields but parsed "+bt,De+pr)),je}var Qe=1;return!mt.data.length||Array.isArray(mt.data[0])?(mt.data=mt.data.map(mn),Qe=mt.data.length):mt.data=mn(mt.data,0),ot.header&&mt.meta&&(mt.meta.fields=zt),De+=Qe,mt}()}function zi(){return ot.header&&zt.length===0}function Hi(mn,Qe){return Yn=mn,ot.dynamicTypingFunction&&ot.dynamicTyping[Yn]===void 0&&(ot.dynamicTyping[Yn]=ot.dynamicTypingFunction(Yn)),(ot.dynamicTyping[Yn]||ot.dynamicTyping)===!0?Qe==="true"||Qe==="TRUE"||Qe!=="false"&&Qe!=="FALSE"&&(function(pr){if(Qt.test(pr)){var bt=parseFloat(pr);if(_t<bt&&bt<at)return!0}return!1}(Qe)?parseFloat(Qe):ae.test(Qe)?new Date(Qe):Qe===""?null:Qe):Qe;var Yn}function on(mn,Qe,Yn,pr){var bt={type:mn,code:Qe,message:Yn};pr!==void 0&&(bt.row=pr),mt.errors.push(bt)}this.parse=function(mn,Qe,Yn){var pr=ot.quoteChar||'"';if(ot.newline||(ot.newline=function(Ot,Le){Ot=Ot.substring(0,1048576);var Ie=new RegExp(Dt(Le)+"([^]*?)"+Dt(Le),"gm"),Fe=(Ot=Ot.replace(Ie,"")).split("\r"),Ge=Ot.split(`
`),Je=1<Ge.length&&Ge[0].length<Fe[0].length;if(Fe.length===1||Je)return`
`;for(var st=0,lt=0;lt<Fe.length;lt++)Fe[lt][0]===`
`&&st++;return st>=Fe.length/2?`\r
`:"\r"}(mn,pr)),Rt=!1,ot.delimiter)Ye(ot.delimiter)&&(ot.delimiter=ot.delimiter(mn),mt.meta.delimiter=ot.delimiter);else{var bt=function(Ot,Le,Ie,Fe,Ge){var Je,st,lt,Tt;Ge=Ge||[",","	","|",";",J.RECORD_SEP,J.UNIT_SEP];for(var Mt=0;Mt<Ge.length;Mt++){var ci=Ge[Mt],xi=0,an=0,cn=0;lt=void 0;for(var _n=new rt({comments:Fe,delimiter:ci,newline:Le,preview:10}).parse(Ot),Fn=0;Fn<_n.data.length;Fn++)if(Ie&&Gt(_n.data[Fn]))cn++;else{var Mn=_n.data[Fn].length;an+=Mn,lt!==void 0?0<Mn&&(xi+=Math.abs(Mn-lt),lt=Mn):lt=Mn}0<_n.data.length&&(an/=_n.data.length-cn),(st===void 0||xi<=st)&&(Tt===void 0||Tt<an)&&1.99<an&&(st=xi,Je=ci,Tt=an)}return{successful:!!(ot.delimiter=Je),bestDelimiter:Je}}(mn,ot.newline,ot.skipEmptyLines,ot.comments,ot.delimitersToGuess);bt.successful?ot.delimiter=bt.bestDelimiter:(Rt=!0,ot.delimiter=J.DefaultDelimiter),mt.meta.delimiter=ot.delimiter}var je=At(ot);return ot.preview&&ot.header&&je.preview++,tt=mn,et=new rt(je),mt=et.parse(tt,Qe,Yn),ii(),Ce?{meta:{paused:!0}}:mt||{meta:{paused:!1}}},this.paused=function(){return Ce},this.pause=function(){Ce=!0,et.abort(),tt=Ye(ot.chunk)?"":tt.substring(et.getCharIndex())},this.resume=function(){be.streamer._halted?(Ce=!1,be.streamer.parseChunk(tt,!0)):setTimeout(be.resume,3)},this.aborted=function(){return Vt},this.abort=function(){Vt=!0,et.abort(),mt.meta.aborted=!0,Ye(ot.complete)&&ot.complete(mt),tt=""}}function Dt(ot){return ot.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function rt(ot){var tt,et=(ot=ot||{}).delimiter,Rt=ot.newline,at=ot.comments,_t=ot.step,Qt=ot.preview,ae=ot.fastMode,be=tt=ot.quoteChar===void 0||ot.quoteChar===null?'"':ot.quoteChar;if(ot.escapeChar!==void 0&&(be=ot.escapeChar),(typeof et!="string"||-1<J.BAD_DELIMITERS.indexOf(et))&&(et=","),at===et)throw new Error("Comment character same as delimiter");at===!0?at="#":(typeof at!="string"||-1<J.BAD_DELIMITERS.indexOf(at))&&(at=!1),Rt!==`
`&&Rt!=="\r"&&Rt!==`\r
`&&(Rt=`
`);var ve=0,De=!1;this.parse=function(Ce,Vt,zt){if(typeof Ce!="string")throw new Error("Input must be a string");var mt=Ce.length,Nt=et.length,Gt=Rt.length,ii=at.length,zi=Ye(_t),Hi=[],on=[],mn=[],Qe=ve=0;if(!Ce)return jn();if(ot.header&&!Vt){var Yn=Ce.split(Rt)[0].split(et),pr=[],bt={},je=!1;for(var Ot in Yn){var Le=Yn[Ot];Ye(ot.transformHeader)&&(Le=ot.transformHeader(Le,Ot));var Ie=Le,Fe=bt[Le]||0;for(0<Fe&&(je=!0,Ie=Le+"_"+Fe),bt[Le]=Fe+1;pr.includes(Ie);)Ie=Ie+"_"+Fe;pr.push(Ie)}if(je){var Ge=Ce.split(Rt);Ge[0]=pr.join(et),Ce=Ge.join(Rt)}}if(ae||ae!==!1&&Ce.indexOf(tt)===-1){for(var Je=Ce.split(Rt),st=0;st<Je.length;st++){if(mn=Je[st],ve+=mn.length,st!==Je.length-1)ve+=Rt.length;else if(zt)return jn();if(!at||mn.substring(0,ii)!==at){if(zi){if(Hi=[],cn(mn.split(et)),Lr(),De)return jn()}else cn(mn.split(et));if(Qt&&Qt<=st)return Hi=Hi.slice(0,Qt),jn(!0)}}return jn()}for(var lt=Ce.indexOf(et,ve),Tt=Ce.indexOf(Rt,ve),Mt=new RegExp(Dt(be)+Dt(tt),"g"),ci=Ce.indexOf(tt,ve);;)if(Ce[ve]!==tt)if(at&&mn.length===0&&Ce.substring(ve,ve+ii)===at){if(Tt===-1)return jn();ve=Tt+Gt,Tt=Ce.indexOf(Rt,ve),lt=Ce.indexOf(et,ve)}else if(lt!==-1&&(lt<Tt||Tt===-1))mn.push(Ce.substring(ve,lt)),ve=lt+Nt,lt=Ce.indexOf(et,ve);else{if(Tt===-1)break;if(mn.push(Ce.substring(ve,Tt)),Mn(Tt+Gt),zi&&(Lr(),De))return jn();if(Qt&&Hi.length>=Qt)return jn(!0)}else for(ci=ve,ve++;;){if((ci=Ce.indexOf(tt,ci+1))===-1)return zt||on.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Hi.length,index:ve}),Fn();if(ci===mt-1)return Fn(Ce.substring(ve,ci).replace(Mt,tt));if(tt!==be||Ce[ci+1]!==be){if(tt===be||ci===0||Ce[ci-1]!==be){lt!==-1&&lt<ci+1&&(lt=Ce.indexOf(et,ci+1)),Tt!==-1&&Tt<ci+1&&(Tt=Ce.indexOf(Rt,ci+1));var xi=_n(Tt===-1?lt:Math.min(lt,Tt));if(Ce.substr(ci+1+xi,Nt)===et){mn.push(Ce.substring(ve,ci).replace(Mt,tt)),Ce[ve=ci+1+xi+Nt]!==tt&&(ci=Ce.indexOf(tt,ve)),lt=Ce.indexOf(et,ve),Tt=Ce.indexOf(Rt,ve);break}var an=_n(Tt);if(Ce.substring(ci+1+an,ci+1+an+Gt)===Rt){if(mn.push(Ce.substring(ve,ci).replace(Mt,tt)),Mn(ci+1+an+Gt),lt=Ce.indexOf(et,ve),ci=Ce.indexOf(tt,ve),zi&&(Lr(),De))return jn();if(Qt&&Hi.length>=Qt)return jn(!0);break}on.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Hi.length,index:ve}),ci++}}else ci++}return Fn();function cn(Tr){Hi.push(Tr),Qe=ve}function _n(Tr){var eo=0;if(Tr!==-1){var $r=Ce.substring(ci+1,Tr);$r&&$r.trim()===""&&(eo=$r.length)}return eo}function Fn(Tr){return zt||(Tr===void 0&&(Tr=Ce.substring(ve)),mn.push(Tr),ve=mt,cn(mn),zi&&Lr()),jn()}function Mn(Tr){ve=Tr,cn(mn),mn=[],Tt=Ce.indexOf(Rt,ve)}function jn(Tr){return{data:Hi,errors:on,meta:{delimiter:et,linebreak:Rt,aborted:De,truncated:!!Tr,cursor:Qe+(Vt||0)}}}function Lr(){_t(jn()),Hi=[],on=[]}},this.abort=function(){De=!0},this.getCharIndex=function(){return ve}}function pt(ot){var tt=ot.data,et=V[tt.workerId],Rt=!1;if(tt.error)et.userError(tt.error,tt.file);else if(tt.results&&tt.results.data){var at={abort:function(){Rt=!0,gi(tt.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Zt,resume:Zt};if(Ye(et.userStep)){for(var _t=0;_t<tt.results.data.length&&(et.userStep({data:tt.results.data[_t],errors:tt.results.errors,meta:tt.results.meta},at),!Rt);_t++);delete tt.results}else Ye(et.userChunk)&&(et.userChunk(tt.results,at,tt.file),delete tt.results)}tt.finished&&!Rt&&gi(tt.workerId,tt.results)}function gi(ot,tt){var et=V[ot];Ye(et.userComplete)&&et.userComplete(tt),et.terminate(),delete V[ot]}function Zt(){throw new Error("Not implemented.")}function At(ot){if(typeof ot!="object"||ot===null)return ot;var tt=Array.isArray(ot)?[]:{};for(var et in ot)tt[et]=At(ot[et]);return tt}function It(ot,tt){return function(){ot.apply(tt,arguments)}}function Ye(ot){return typeof ot=="function"}return q&&(z.onmessage=function(ot){var tt=ot.data;if(J.WORKER_ID===void 0&&tt&&(J.WORKER_ID=tt.workerId),typeof tt.input=="string")z.postMessage({workerId:J.WORKER_ID,results:J.parse(tt.input,tt.config),finished:!0});else if(z.File&&tt.input instanceof File||tt.input instanceof Object){var et=J.parse(tt.input,tt.config);et&&z.postMessage({workerId:J.WORKER_ID,results:et,finished:!0})}}),(Se.prototype=Object.create(ce.prototype)).constructor=Se,(Xe.prototype=Object.create(ce.prototype)).constructor=Xe,(ht.prototype=Object.create(ht.prototype)).constructor=ht,(Ut.prototype=Object.create(ce.prototype)).constructor=Ut,J})}(w0)),w0.exports}var gI=mI();const eM=L2(gI);var mx={exports:{}},gx={exports:{}},B_={exports:{}};/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */var _I=B_.exports,tM;function za(){return tM||(tM=1,function(v,y){(function(p,z){z(y)})(_I,function(p){const z="132",Tt="300 es";class Mt{addEventListener(e,l){this._listeners===void 0&&(this._listeners={});const g=this._listeners;g[e]===void 0&&(g[e]=[]),g[e].indexOf(l)===-1&&g[e].push(l)}hasEventListener(e,l){if(this._listeners===void 0)return!1;const g=this._listeners;return g[e]!==void 0&&g[e].indexOf(l)!==-1}removeEventListener(e,l){if(this._listeners===void 0)return;const g=this._listeners[e];if(g!==void 0){const _=g.indexOf(l);_!==-1&&g.splice(_,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const l=this._listeners[e.type];if(l!==void 0){e.target=this;const g=l.slice(0);for(let _=0,M=g.length;_<M;_++)g[_].call(this,e);e.target=null}}}const ci=[];for(let S=0;S<256;S++)ci[S]=(S<16?"0":"")+S.toString(16);let xi=1234567;const an=Math.PI/180,cn=180/Math.PI;function _n(){const S=4294967295*Math.random()|0,e=4294967295*Math.random()|0,l=4294967295*Math.random()|0,g=4294967295*Math.random()|0;return(ci[255&S]+ci[S>>8&255]+ci[S>>16&255]+ci[S>>24&255]+"-"+ci[255&e]+ci[e>>8&255]+"-"+ci[e>>16&15|64]+ci[e>>24&255]+"-"+ci[63&l|128]+ci[l>>8&255]+"-"+ci[l>>16&255]+ci[l>>24&255]+ci[255&g]+ci[g>>8&255]+ci[g>>16&255]+ci[g>>24&255]).toUpperCase()}function Fn(S,e,l){return Math.max(e,Math.min(l,S))}function Mn(S,e){return(S%e+e)%e}function jn(S,e,l){return(1-l)*S+l*e}function Lr(S){return(S&S-1)==0&&S!==0}function Tr(S){return Math.pow(2,Math.ceil(Math.log(S)/Math.LN2))}function eo(S){return Math.pow(2,Math.floor(Math.log(S)/Math.LN2))}var $r=Object.freeze({__proto__:null,DEG2RAD:an,RAD2DEG:cn,generateUUID:_n,clamp:Fn,euclideanModulo:Mn,mapLinear:function(S,e,l,g,_){return g+(S-e)*(_-g)/(l-e)},inverseLerp:function(S,e,l){return S!==e?(l-S)/(e-S):0},lerp:jn,damp:function(S,e,l,g){return jn(S,e,1-Math.exp(-l*g))},pingpong:function(S,e=1){return e-Math.abs(Mn(S,2*e)-e)},smoothstep:function(S,e,l){return S<=e?0:S>=l?1:(S=(S-e)/(l-e))*S*(3-2*S)},smootherstep:function(S,e,l){return S<=e?0:S>=l?1:(S=(S-e)/(l-e))*S*S*(S*(6*S-15)+10)},randInt:function(S,e){return S+Math.floor(Math.random()*(e-S+1))},randFloat:function(S,e){return S+Math.random()*(e-S)},randFloatSpread:function(S){return S*(.5-Math.random())},seededRandom:function(S){return S!==void 0&&(xi=S%2147483647),xi=16807*xi%2147483647,(xi-1)/2147483646},degToRad:function(S){return S*an},radToDeg:function(S){return S*cn},isPowerOfTwo:Lr,ceilPowerOfTwo:Tr,floorPowerOfTwo:eo,setQuaternionFromProperEuler:function(S,e,l,g,_){const M=Math.cos,P=Math.sin,N=M(l/2),U=P(l/2),G=M((e+g)/2),K=P((e+g)/2),Q=M((e-g)/2),ne=P((e-g)/2),oe=M((g-e)/2),de=P((g-e)/2);switch(_){case"XYX":S.set(N*K,U*Q,U*ne,N*G);break;case"YZY":S.set(U*ne,N*K,U*Q,N*G);break;case"ZXZ":S.set(U*Q,U*ne,N*K,N*G);break;case"XZX":S.set(N*K,U*de,U*oe,N*G);break;case"YXY":S.set(U*oe,N*K,U*de,N*G);break;case"ZYZ":S.set(U*de,U*oe,N*K,N*G);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+_)}}});class en{constructor(e=0,l=0){this.x=e,this.y=l}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,l){return this.x=e,this.y=l,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,l){switch(e){case 0:this.x=l;break;case 1:this.y=l;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,l){return l!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,l)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,l){return this.x=e.x+l.x,this.y=e.y+l.y,this}addScaledVector(e,l){return this.x+=e.x*l,this.y+=e.y*l,this}sub(e,l){return l!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,l)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,l){return this.x=e.x-l.x,this.y=e.y-l.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const l=this.x,g=this.y,_=e.elements;return this.x=_[0]*l+_[3]*g+_[6],this.y=_[1]*l+_[4]*g+_[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,l){return this.x=Math.max(e.x,Math.min(l.x,this.x)),this.y=Math.max(e.y,Math.min(l.y,this.y)),this}clampScalar(e,l){return this.x=Math.max(e,Math.min(l,this.x)),this.y=Math.max(e,Math.min(l,this.y)),this}clampLength(e,l){const g=this.length();return this.divideScalar(g||1).multiplyScalar(Math.max(e,Math.min(l,g)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const l=this.x-e.x,g=this.y-e.y;return l*l+g*g}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,l){return this.x+=(e.x-this.x)*l,this.y+=(e.y-this.y)*l,this}lerpVectors(e,l,g){return this.x=e.x+(l.x-e.x)*g,this.y=e.y+(l.y-e.y)*g,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,l=0){return this.x=e[l],this.y=e[l+1],this}toArray(e=[],l=0){return e[l]=this.x,e[l+1]=this.y,e}fromBufferAttribute(e,l,g){return g!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(l),this.y=e.getY(l),this}rotateAround(e,l){const g=Math.cos(l),_=Math.sin(l),M=this.x-e.x,P=this.y-e.y;return this.x=M*g-P*_+e.x,this.y=M*_+P*g+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}en.prototype.isVector2=!0;class Wn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,l,g,_,M,P,N,U,G){const K=this.elements;return K[0]=e,K[1]=_,K[2]=N,K[3]=l,K[4]=M,K[5]=U,K[6]=g,K[7]=P,K[8]=G,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const l=this.elements,g=e.elements;return l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3],l[4]=g[4],l[5]=g[5],l[6]=g[6],l[7]=g[7],l[8]=g[8],this}extractBasis(e,l,g){return e.setFromMatrix3Column(this,0),l.setFromMatrix3Column(this,1),g.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const l=e.elements;return this.set(l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,l){const g=e.elements,_=l.elements,M=this.elements,P=g[0],N=g[3],U=g[6],G=g[1],K=g[4],Q=g[7],ne=g[2],oe=g[5],de=g[8],xe=_[0],Re=_[3],we=_[6],nt=_[1],xt=_[4],ft=_[7],Ht=_[2],Xt=_[5],_i=_[8];return M[0]=P*xe+N*nt+U*Ht,M[3]=P*Re+N*xt+U*Xt,M[6]=P*we+N*ft+U*_i,M[1]=G*xe+K*nt+Q*Ht,M[4]=G*Re+K*xt+Q*Xt,M[7]=G*we+K*ft+Q*_i,M[2]=ne*xe+oe*nt+de*Ht,M[5]=ne*Re+oe*xt+de*Xt,M[8]=ne*we+oe*ft+de*_i,this}multiplyScalar(e){const l=this.elements;return l[0]*=e,l[3]*=e,l[6]*=e,l[1]*=e,l[4]*=e,l[7]*=e,l[2]*=e,l[5]*=e,l[8]*=e,this}determinant(){const e=this.elements,l=e[0],g=e[1],_=e[2],M=e[3],P=e[4],N=e[5],U=e[6],G=e[7],K=e[8];return l*P*K-l*N*G-g*M*K+g*N*U+_*M*G-_*P*U}invert(){const e=this.elements,l=e[0],g=e[1],_=e[2],M=e[3],P=e[4],N=e[5],U=e[6],G=e[7],K=e[8],Q=K*P-N*G,ne=N*U-K*M,oe=G*M-P*U,de=l*Q+g*ne+_*oe;if(de===0)return this.set(0,0,0,0,0,0,0,0,0);const xe=1/de;return e[0]=Q*xe,e[1]=(_*G-K*g)*xe,e[2]=(N*g-_*P)*xe,e[3]=ne*xe,e[4]=(K*l-_*U)*xe,e[5]=(_*M-N*l)*xe,e[6]=oe*xe,e[7]=(g*U-G*l)*xe,e[8]=(P*l-g*M)*xe,this}transpose(){let e;const l=this.elements;return e=l[1],l[1]=l[3],l[3]=e,e=l[2],l[2]=l[6],l[6]=e,e=l[5],l[5]=l[7],l[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const l=this.elements;return e[0]=l[0],e[1]=l[3],e[2]=l[6],e[3]=l[1],e[4]=l[4],e[5]=l[7],e[6]=l[2],e[7]=l[5],e[8]=l[8],this}setUvTransform(e,l,g,_,M,P,N){const U=Math.cos(M),G=Math.sin(M);return this.set(g*U,g*G,-g*(U*P+G*N)+P+e,-_*G,_*U,-_*(-G*P+U*N)+N+l,0,0,1),this}scale(e,l){const g=this.elements;return g[0]*=e,g[3]*=e,g[6]*=e,g[1]*=l,g[4]*=l,g[7]*=l,this}rotate(e){const l=Math.cos(e),g=Math.sin(e),_=this.elements,M=_[0],P=_[3],N=_[6],U=_[1],G=_[4],K=_[7];return _[0]=l*M+g*U,_[3]=l*P+g*G,_[6]=l*N+g*K,_[1]=-g*M+l*U,_[4]=-g*P+l*G,_[7]=-g*N+l*K,this}translate(e,l){const g=this.elements;return g[0]+=e*g[2],g[3]+=e*g[5],g[6]+=e*g[8],g[1]+=l*g[2],g[4]+=l*g[5],g[7]+=l*g[8],this}equals(e){const l=this.elements,g=e.elements;for(let _=0;_<9;_++)if(l[_]!==g[_])return!1;return!0}fromArray(e,l=0){for(let g=0;g<9;g++)this.elements[g]=e[g+l];return this}toArray(e=[],l=0){const g=this.elements;return e[l]=g[0],e[l+1]=g[1],e[l+2]=g[2],e[l+3]=g[3],e[l+4]=g[4],e[l+5]=g[5],e[l+6]=g[6],e[l+7]=g[7],e[l+8]=g[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let Ls;Wn.prototype.isMatrix3=!0;class bo{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let l;if(e instanceof HTMLCanvasElement)l=e;else{Ls===void 0&&(Ls=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ls.width=e.width,Ls.height=e.height;const g=Ls.getContext("2d");e instanceof ImageData?g.putImageData(e,0,0):g.drawImage(e,0,0,e.width,e.height),l=Ls}return l.width>2048||l.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),l.toDataURL("image/jpeg",.6)):l.toDataURL("image/png")}}let Lo=0;class _s extends Mt{constructor(e=_s.DEFAULT_IMAGE,l=_s.DEFAULT_MAPPING,g=1001,_=1001,M=1006,P=1008,N=1023,U=1009,G=1,K=3e3){super(),Object.defineProperty(this,"id",{value:Lo++}),this.uuid=_n(),this.name="",this.image=e,this.mipmaps=[],this.mapping=l,this.wrapS=g,this.wrapT=_,this.magFilter=M,this.minFilter=P,this.anisotropy=G,this.format=N,this.internalFormat=null,this.type=U,this.offset=new en(0,0),this.repeat=new en(1,1),this.center=new en(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=K,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const l=e===void 0||typeof e=="string";if(!l&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const g={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const _=this.image;if(_.uuid===void 0&&(_.uuid=_n()),!l&&e.images[_.uuid]===void 0){let M;if(Array.isArray(_)){M=[];for(let P=0,N=_.length;P<N;P++)_[P].isDataTexture?M.push(js(_[P].image)):M.push(js(_[P]))}else M=js(_);e.images[_.uuid]={uuid:_.uuid,url:M}}g.image=_.uuid}return l||(e.textures[this.uuid]=g),g}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}function js(S){return typeof HTMLImageElement<"u"&&S instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&S instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&S instanceof ImageBitmap?bo.getDataURL(S):S.data?{data:Array.prototype.slice.call(S.data),width:S.width,height:S.height,type:S.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}_s.DEFAULT_IMAGE=void 0,_s.DEFAULT_MAPPING=300,_s.prototype.isTexture=!0;class Dr{constructor(e=0,l=0,g=0,_=1){this.x=e,this.y=l,this.z=g,this.w=_}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,l,g,_){return this.x=e,this.y=l,this.z=g,this.w=_,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,l){switch(e){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;case 3:this.w=l;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,l){return l!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,l)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,l){return this.x=e.x+l.x,this.y=e.y+l.y,this.z=e.z+l.z,this.w=e.w+l.w,this}addScaledVector(e,l){return this.x+=e.x*l,this.y+=e.y*l,this.z+=e.z*l,this.w+=e.w*l,this}sub(e,l){return l!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,l)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,l){return this.x=e.x-l.x,this.y=e.y-l.y,this.z=e.z-l.z,this.w=e.w-l.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const l=this.x,g=this.y,_=this.z,M=this.w,P=e.elements;return this.x=P[0]*l+P[4]*g+P[8]*_+P[12]*M,this.y=P[1]*l+P[5]*g+P[9]*_+P[13]*M,this.z=P[2]*l+P[6]*g+P[10]*_+P[14]*M,this.w=P[3]*l+P[7]*g+P[11]*_+P[15]*M,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const l=Math.sqrt(1-e.w*e.w);return l<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/l,this.y=e.y/l,this.z=e.z/l),this}setAxisAngleFromRotationMatrix(e){let l,g,_,M;const U=e.elements,G=U[0],K=U[4],Q=U[8],ne=U[1],oe=U[5],de=U[9],xe=U[2],Re=U[6],we=U[10];if(Math.abs(K-ne)<.01&&Math.abs(Q-xe)<.01&&Math.abs(de-Re)<.01){if(Math.abs(K+ne)<.1&&Math.abs(Q+xe)<.1&&Math.abs(de+Re)<.1&&Math.abs(G+oe+we-3)<.1)return this.set(1,0,0,0),this;l=Math.PI;const xt=(G+1)/2,ft=(oe+1)/2,Ht=(we+1)/2,Xt=(K+ne)/4,_i=(Q+xe)/4,vi=(de+Re)/4;return xt>ft&&xt>Ht?xt<.01?(g=0,_=.707106781,M=.707106781):(g=Math.sqrt(xt),_=Xt/g,M=_i/g):ft>Ht?ft<.01?(g=.707106781,_=0,M=.707106781):(_=Math.sqrt(ft),g=Xt/_,M=vi/_):Ht<.01?(g=.707106781,_=.707106781,M=0):(M=Math.sqrt(Ht),g=_i/M,_=vi/M),this.set(g,_,M,l),this}let nt=Math.sqrt((Re-de)*(Re-de)+(Q-xe)*(Q-xe)+(ne-K)*(ne-K));return Math.abs(nt)<.001&&(nt=1),this.x=(Re-de)/nt,this.y=(Q-xe)/nt,this.z=(ne-K)/nt,this.w=Math.acos((G+oe+we-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,l){return this.x=Math.max(e.x,Math.min(l.x,this.x)),this.y=Math.max(e.y,Math.min(l.y,this.y)),this.z=Math.max(e.z,Math.min(l.z,this.z)),this.w=Math.max(e.w,Math.min(l.w,this.w)),this}clampScalar(e,l){return this.x=Math.max(e,Math.min(l,this.x)),this.y=Math.max(e,Math.min(l,this.y)),this.z=Math.max(e,Math.min(l,this.z)),this.w=Math.max(e,Math.min(l,this.w)),this}clampLength(e,l){const g=this.length();return this.divideScalar(g||1).multiplyScalar(Math.max(e,Math.min(l,g)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,l){return this.x+=(e.x-this.x)*l,this.y+=(e.y-this.y)*l,this.z+=(e.z-this.z)*l,this.w+=(e.w-this.w)*l,this}lerpVectors(e,l,g){return this.x=e.x+(l.x-e.x)*g,this.y=e.y+(l.y-e.y)*g,this.z=e.z+(l.z-e.z)*g,this.w=e.w+(l.w-e.w)*g,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,l=0){return this.x=e[l],this.y=e[l+1],this.z=e[l+2],this.w=e[l+3],this}toArray(e=[],l=0){return e[l]=this.x,e[l+1]=this.y,e[l+2]=this.z,e[l+3]=this.w,e}fromBufferAttribute(e,l,g){return g!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(l),this.y=e.getY(l),this.z=e.getZ(l),this.w=e.getW(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Dr.prototype.isVector4=!0;class no extends Mt{constructor(e,l,g={}){super(),this.width=e,this.height=l,this.depth=1,this.scissor=new Dr(0,0,e,l),this.scissorTest=!1,this.viewport=new Dr(0,0,e,l),this.texture=new _s(void 0,g.mapping,g.wrapS,g.wrapT,g.magFilter,g.minFilter,g.format,g.type,g.anisotropy,g.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:l,depth:1},this.texture.generateMipmaps=g.generateMipmaps!==void 0&&g.generateMipmaps,this.texture.internalFormat=g.internalFormat!==void 0?g.internalFormat:null,this.texture.minFilter=g.minFilter!==void 0?g.minFilter:1006,this.depthBuffer=g.depthBuffer===void 0||g.depthBuffer,this.stencilBuffer=g.stencilBuffer!==void 0&&g.stencilBuffer,this.depthTexture=g.depthTexture!==void 0?g.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,l,g=1){this.width===e&&this.height===l&&this.depth===g||(this.width=e,this.height=l,this.depth=g,this.texture.image.width=e,this.texture.image.height=l,this.texture.image.depth=g,this.dispose()),this.viewport.set(0,0,e,l),this.scissor.set(0,0,e,l)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}no.prototype.isWebGLRenderTarget=!0;class uo extends no{constructor(e,l,g){super(e,l);const _=this.texture;this.texture=[];for(let M=0;M<g;M++)this.texture[M]=_.clone()}setSize(e,l,g=1){if(this.width!==e||this.height!==l||this.depth!==g){this.width=e,this.height=l,this.depth=g;for(let _=0,M=this.texture.length;_<M;_++)this.texture[_].image.width=e,this.texture[_].image.height=l,this.texture[_].image.depth=g;this.dispose()}return this.viewport.set(0,0,e,l),this.scissor.set(0,0,e,l),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let l=0,g=e.texture.length;l<g;l++)this.texture[l]=e.texture[l].clone();return this}}uo.prototype.isWebGLMultipleRenderTargets=!0;class oi extends no{constructor(e,l,g){super(e,l,g),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}oi.prototype.isWebGLMultisampleRenderTarget=!0;class ye{constructor(e=0,l=0,g=0,_=1){this._x=e,this._y=l,this._z=g,this._w=_}static slerp(e,l,g,_){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),g.slerpQuaternions(e,l,_)}static slerpFlat(e,l,g,_,M,P,N){let U=g[_+0],G=g[_+1],K=g[_+2],Q=g[_+3];const ne=M[P+0],oe=M[P+1],de=M[P+2],xe=M[P+3];if(N===0)return e[l+0]=U,e[l+1]=G,e[l+2]=K,void(e[l+3]=Q);if(N===1)return e[l+0]=ne,e[l+1]=oe,e[l+2]=de,void(e[l+3]=xe);if(Q!==xe||U!==ne||G!==oe||K!==de){let Re=1-N;const we=U*ne+G*oe+K*de+Q*xe,nt=we>=0?1:-1,xt=1-we*we;if(xt>Number.EPSILON){const Ht=Math.sqrt(xt),Xt=Math.atan2(Ht,we*nt);Re=Math.sin(Re*Xt)/Ht,N=Math.sin(N*Xt)/Ht}const ft=N*nt;if(U=U*Re+ne*ft,G=G*Re+oe*ft,K=K*Re+de*ft,Q=Q*Re+xe*ft,Re===1-N){const Ht=1/Math.sqrt(U*U+G*G+K*K+Q*Q);U*=Ht,G*=Ht,K*=Ht,Q*=Ht}}e[l]=U,e[l+1]=G,e[l+2]=K,e[l+3]=Q}static multiplyQuaternionsFlat(e,l,g,_,M,P){const N=g[_],U=g[_+1],G=g[_+2],K=g[_+3],Q=M[P],ne=M[P+1],oe=M[P+2],de=M[P+3];return e[l]=N*de+K*Q+U*oe-G*ne,e[l+1]=U*de+K*ne+G*Q-N*oe,e[l+2]=G*de+K*oe+N*ne-U*Q,e[l+3]=K*de-N*Q-U*ne-G*oe,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,l,g,_){return this._x=e,this._y=l,this._z=g,this._w=_,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,l){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const g=e._x,_=e._y,M=e._z,P=e._order,N=Math.cos,U=Math.sin,G=N(g/2),K=N(_/2),Q=N(M/2),ne=U(g/2),oe=U(_/2),de=U(M/2);switch(P){case"XYZ":this._x=ne*K*Q+G*oe*de,this._y=G*oe*Q-ne*K*de,this._z=G*K*de+ne*oe*Q,this._w=G*K*Q-ne*oe*de;break;case"YXZ":this._x=ne*K*Q+G*oe*de,this._y=G*oe*Q-ne*K*de,this._z=G*K*de-ne*oe*Q,this._w=G*K*Q+ne*oe*de;break;case"ZXY":this._x=ne*K*Q-G*oe*de,this._y=G*oe*Q+ne*K*de,this._z=G*K*de+ne*oe*Q,this._w=G*K*Q-ne*oe*de;break;case"ZYX":this._x=ne*K*Q-G*oe*de,this._y=G*oe*Q+ne*K*de,this._z=G*K*de-ne*oe*Q,this._w=G*K*Q+ne*oe*de;break;case"YZX":this._x=ne*K*Q+G*oe*de,this._y=G*oe*Q+ne*K*de,this._z=G*K*de-ne*oe*Q,this._w=G*K*Q-ne*oe*de;break;case"XZY":this._x=ne*K*Q-G*oe*de,this._y=G*oe*Q-ne*K*de,this._z=G*K*de+ne*oe*Q,this._w=G*K*Q+ne*oe*de;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+P)}return l!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,l){const g=l/2,_=Math.sin(g);return this._x=e.x*_,this._y=e.y*_,this._z=e.z*_,this._w=Math.cos(g),this._onChangeCallback(),this}setFromRotationMatrix(e){const l=e.elements,g=l[0],_=l[4],M=l[8],P=l[1],N=l[5],U=l[9],G=l[2],K=l[6],Q=l[10],ne=g+N+Q;if(ne>0){const oe=.5/Math.sqrt(ne+1);this._w=.25/oe,this._x=(K-U)*oe,this._y=(M-G)*oe,this._z=(P-_)*oe}else if(g>N&&g>Q){const oe=2*Math.sqrt(1+g-N-Q);this._w=(K-U)/oe,this._x=.25*oe,this._y=(_+P)/oe,this._z=(M+G)/oe}else if(N>Q){const oe=2*Math.sqrt(1+N-g-Q);this._w=(M-G)/oe,this._x=(_+P)/oe,this._y=.25*oe,this._z=(U+K)/oe}else{const oe=2*Math.sqrt(1+Q-g-N);this._w=(P-_)/oe,this._x=(M+G)/oe,this._y=(U+K)/oe,this._z=.25*oe}return this._onChangeCallback(),this}setFromUnitVectors(e,l){let g=e.dot(l)+1;return g<Number.EPSILON?(g=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=g):(this._x=0,this._y=-e.z,this._z=e.y,this._w=g)):(this._x=e.y*l.z-e.z*l.y,this._y=e.z*l.x-e.x*l.z,this._z=e.x*l.y-e.y*l.x,this._w=g),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Fn(this.dot(e),-1,1)))}rotateTowards(e,l){const g=this.angleTo(e);if(g===0)return this;const _=Math.min(1,l/g);return this.slerp(e,_),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,l){return l!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,l)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,l){const g=e._x,_=e._y,M=e._z,P=e._w,N=l._x,U=l._y,G=l._z,K=l._w;return this._x=g*K+P*N+_*G-M*U,this._y=_*K+P*U+M*N-g*G,this._z=M*K+P*G+g*U-_*N,this._w=P*K-g*N-_*U-M*G,this._onChangeCallback(),this}slerp(e,l){if(l===0)return this;if(l===1)return this.copy(e);const g=this._x,_=this._y,M=this._z,P=this._w;let N=P*e._w+g*e._x+_*e._y+M*e._z;if(N<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,N=-N):this.copy(e),N>=1)return this._w=P,this._x=g,this._y=_,this._z=M,this;const U=1-N*N;if(U<=Number.EPSILON){const oe=1-l;return this._w=oe*P+l*this._w,this._x=oe*g+l*this._x,this._y=oe*_+l*this._y,this._z=oe*M+l*this._z,this.normalize(),this._onChangeCallback(),this}const G=Math.sqrt(U),K=Math.atan2(G,N),Q=Math.sin((1-l)*K)/G,ne=Math.sin(l*K)/G;return this._w=P*Q+this._w*ne,this._x=g*Q+this._x*ne,this._y=_*Q+this._y*ne,this._z=M*Q+this._z*ne,this._onChangeCallback(),this}slerpQuaternions(e,l,g){this.copy(e).slerp(l,g)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,l=0){return this._x=e[l],this._y=e[l+1],this._z=e[l+2],this._w=e[l+3],this._onChangeCallback(),this}toArray(e=[],l=0){return e[l]=this._x,e[l+1]=this._y,e[l+2]=this._z,e[l+3]=this._w,e}fromBufferAttribute(e,l){return this._x=e.getX(l),this._y=e.getY(l),this._z=e.getZ(l),this._w=e.getW(l),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ye.prototype.isQuaternion=!0;class ie{constructor(e=0,l=0,g=0){this.x=e,this.y=l,this.z=g}set(e,l,g){return g===void 0&&(g=this.z),this.x=e,this.y=l,this.z=g,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,l){switch(e){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,l){return l!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,l)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,l){return this.x=e.x+l.x,this.y=e.y+l.y,this.z=e.z+l.z,this}addScaledVector(e,l){return this.x+=e.x*l,this.y+=e.y*l,this.z+=e.z*l,this}sub(e,l){return l!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,l)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,l){return this.x=e.x-l.x,this.y=e.y-l.y,this.z=e.z-l.z,this}multiply(e,l){return l!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,l)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,l){return this.x=e.x*l.x,this.y=e.y*l.y,this.z=e.z*l.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(St.setFromEuler(e))}applyAxisAngle(e,l){return this.applyQuaternion(St.setFromAxisAngle(e,l))}applyMatrix3(e){const l=this.x,g=this.y,_=this.z,M=e.elements;return this.x=M[0]*l+M[3]*g+M[6]*_,this.y=M[1]*l+M[4]*g+M[7]*_,this.z=M[2]*l+M[5]*g+M[8]*_,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const l=this.x,g=this.y,_=this.z,M=e.elements,P=1/(M[3]*l+M[7]*g+M[11]*_+M[15]);return this.x=(M[0]*l+M[4]*g+M[8]*_+M[12])*P,this.y=(M[1]*l+M[5]*g+M[9]*_+M[13])*P,this.z=(M[2]*l+M[6]*g+M[10]*_+M[14])*P,this}applyQuaternion(e){const l=this.x,g=this.y,_=this.z,M=e.x,P=e.y,N=e.z,U=e.w,G=U*l+P*_-N*g,K=U*g+N*l-M*_,Q=U*_+M*g-P*l,ne=-M*l-P*g-N*_;return this.x=G*U+ne*-M+K*-N-Q*-P,this.y=K*U+ne*-P+Q*-M-G*-N,this.z=Q*U+ne*-N+G*-P-K*-M,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const l=this.x,g=this.y,_=this.z,M=e.elements;return this.x=M[0]*l+M[4]*g+M[8]*_,this.y=M[1]*l+M[5]*g+M[9]*_,this.z=M[2]*l+M[6]*g+M[10]*_,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,l){return this.x=Math.max(e.x,Math.min(l.x,this.x)),this.y=Math.max(e.y,Math.min(l.y,this.y)),this.z=Math.max(e.z,Math.min(l.z,this.z)),this}clampScalar(e,l){return this.x=Math.max(e,Math.min(l,this.x)),this.y=Math.max(e,Math.min(l,this.y)),this.z=Math.max(e,Math.min(l,this.z)),this}clampLength(e,l){const g=this.length();return this.divideScalar(g||1).multiplyScalar(Math.max(e,Math.min(l,g)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,l){return this.x+=(e.x-this.x)*l,this.y+=(e.y-this.y)*l,this.z+=(e.z-this.z)*l,this}lerpVectors(e,l,g){return this.x=e.x+(l.x-e.x)*g,this.y=e.y+(l.y-e.y)*g,this.z=e.z+(l.z-e.z)*g,this}cross(e,l){return l!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,l)):this.crossVectors(this,e)}crossVectors(e,l){const g=e.x,_=e.y,M=e.z,P=l.x,N=l.y,U=l.z;return this.x=_*U-M*N,this.y=M*P-g*U,this.z=g*N-_*P,this}projectOnVector(e){const l=e.lengthSq();if(l===0)return this.set(0,0,0);const g=e.dot(this)/l;return this.copy(e).multiplyScalar(g)}projectOnPlane(e){return qe.copy(this).projectOnVector(e),this.sub(qe)}reflect(e){return this.sub(qe.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const l=Math.sqrt(this.lengthSq()*e.lengthSq());if(l===0)return Math.PI/2;const g=this.dot(e)/l;return Math.acos(Fn(g,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const l=this.x-e.x,g=this.y-e.y,_=this.z-e.z;return l*l+g*g+_*_}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,l,g){const _=Math.sin(l)*e;return this.x=_*Math.sin(g),this.y=Math.cos(l)*e,this.z=_*Math.cos(g),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,l,g){return this.x=e*Math.sin(l),this.y=g,this.z=e*Math.cos(l),this}setFromMatrixPosition(e){const l=e.elements;return this.x=l[12],this.y=l[13],this.z=l[14],this}setFromMatrixScale(e){const l=this.setFromMatrixColumn(e,0).length(),g=this.setFromMatrixColumn(e,1).length(),_=this.setFromMatrixColumn(e,2).length();return this.x=l,this.y=g,this.z=_,this}setFromMatrixColumn(e,l){return this.fromArray(e.elements,4*l)}setFromMatrix3Column(e,l){return this.fromArray(e.elements,3*l)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,l=0){return this.x=e[l],this.y=e[l+1],this.z=e[l+2],this}toArray(e=[],l=0){return e[l]=this.x,e[l+1]=this.y,e[l+2]=this.z,e}fromBufferAttribute(e,l,g){return g!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(l),this.y=e.getY(l),this.z=e.getZ(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}ie.prototype.isVector3=!0;const qe=new ie,St=new ye;class ut{constructor(e=new ie(1/0,1/0,1/0),l=new ie(-1/0,-1/0,-1/0)){this.min=e,this.max=l}set(e,l){return this.min.copy(e),this.max.copy(l),this}setFromArray(e){let l=1/0,g=1/0,_=1/0,M=-1/0,P=-1/0,N=-1/0;for(let U=0,G=e.length;U<G;U+=3){const K=e[U],Q=e[U+1],ne=e[U+2];K<l&&(l=K),Q<g&&(g=Q),ne<_&&(_=ne),K>M&&(M=K),Q>P&&(P=Q),ne>N&&(N=ne)}return this.min.set(l,g,_),this.max.set(M,P,N),this}setFromBufferAttribute(e){let l=1/0,g=1/0,_=1/0,M=-1/0,P=-1/0,N=-1/0;for(let U=0,G=e.count;U<G;U++){const K=e.getX(U),Q=e.getY(U),ne=e.getZ(U);K<l&&(l=K),Q<g&&(g=Q),ne<_&&(_=ne),K>M&&(M=K),Q>P&&(P=Q),ne>N&&(N=ne)}return this.min.set(l,g,_),this.max.set(M,P,N),this}setFromPoints(e){this.makeEmpty();for(let l=0,g=e.length;l<g;l++)this.expandByPoint(e[l]);return this}setFromCenterAndSize(e,l){const g=si.copy(l).multiplyScalar(.5);return this.min.copy(e).sub(g),this.max.copy(e).add(g),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const l=e.geometry;l!==void 0&&(l.boundingBox===null&&l.computeBoundingBox(),$t.copy(l.boundingBox),$t.applyMatrix4(e.matrixWorld),this.union($t));const g=e.children;for(let _=0,M=g.length;_<M;_++)this.expandByObject(g[_]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,l){return l.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,si),si.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let l,g;return e.normal.x>0?(l=e.normal.x*this.min.x,g=e.normal.x*this.max.x):(l=e.normal.x*this.max.x,g=e.normal.x*this.min.x),e.normal.y>0?(l+=e.normal.y*this.min.y,g+=e.normal.y*this.max.y):(l+=e.normal.y*this.max.y,g+=e.normal.y*this.min.y),e.normal.z>0?(l+=e.normal.z*this.min.z,g+=e.normal.z*this.max.z):(l+=e.normal.z*this.max.z,g+=e.normal.z*this.min.z),l<=-e.constant&&g>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Jn),sr.subVectors(this.max,Jn),ai.subVectors(e.a,Jn),fi.subVectors(e.b,Jn),pi.subVectors(e.c,Jn),Pi.subVectors(fi,ai),tn.subVectors(pi,fi),xn.subVectors(ai,pi);let l=[0,-Pi.z,Pi.y,0,-tn.z,tn.y,0,-xn.z,xn.y,Pi.z,0,-Pi.x,tn.z,0,-tn.x,xn.z,0,-xn.x,-Pi.y,Pi.x,0,-tn.y,tn.x,0,-xn.y,xn.x,0];return!!Zr(l,ai,fi,pi,sr)&&(l=[1,0,0,0,1,0,0,0,1],!!Zr(l,ai,fi,pi,sr)&&(ar.crossVectors(Pi,tn),l=[ar.x,ar.y,ar.z],Zr(l,ai,fi,pi,sr)))}clampPoint(e,l){return l.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return si.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(si).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ft[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ft[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ft[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ft[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ft[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ft[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ft[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ft[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ft)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}ut.prototype.isBox3=!0;const Ft=[new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie],si=new ie,$t=new ut,ai=new ie,fi=new ie,pi=new ie,Pi=new ie,tn=new ie,xn=new ie,Jn=new ie,sr=new ie,ar=new ie,er=new ie;function Zr(S,e,l,g,_){for(let M=0,P=S.length-3;M<=P;M+=3){er.fromArray(S,M);const N=_.x*Math.abs(er.x)+_.y*Math.abs(er.y)+_.z*Math.abs(er.z),U=e.dot(er),G=l.dot(er),K=g.dot(er);if(Math.max(-Math.max(U,G,K),Math.min(U,G,K))>N)return!1}return!0}const Gr=new ut,yr=new ie,Jr=new ie,us=new ie;class Ns{constructor(e=new ie,l=-1){this.center=e,this.radius=l}set(e,l){return this.center.copy(e),this.radius=l,this}setFromPoints(e,l){const g=this.center;l!==void 0?g.copy(l):Gr.setFromPoints(e).getCenter(g);let _=0;for(let M=0,P=e.length;M<P;M++)_=Math.max(_,g.distanceToSquared(e[M]));return this.radius=Math.sqrt(_),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const l=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=l*l}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,l){const g=this.center.distanceToSquared(e);return l.copy(e),g>this.radius*this.radius&&(l.sub(this.center).normalize(),l.multiplyScalar(this.radius).add(this.center)),l}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){us.subVectors(e,this.center);const l=us.lengthSq();if(l>this.radius*this.radius){const g=Math.sqrt(l),_=.5*(g-this.radius);this.center.add(us.multiplyScalar(_/g)),this.radius+=_}return this}union(e){return Jr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(yr.copy(e.center).add(Jr)),this.expandByPoint(yr.copy(e.center).sub(Jr)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const es=new ie,Fs=new ie,Ps=new ie,wo=new ie,Xo=new ie,ka=new ie,ll=new ie;class na{constructor(e=new ie,l=new ie(0,0,-1)){this.origin=e,this.direction=l}set(e,l){return this.origin.copy(e),this.direction.copy(l),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,l){return l.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,es)),this}closestPointToPoint(e,l){l.subVectors(e,this.origin);const g=l.dot(this.direction);return g<0?l.copy(this.origin):l.copy(this.direction).multiplyScalar(g).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const l=es.subVectors(e,this.origin).dot(this.direction);return l<0?this.origin.distanceToSquared(e):(es.copy(this.direction).multiplyScalar(l).add(this.origin),es.distanceToSquared(e))}distanceSqToSegment(e,l,g,_){Fs.copy(e).add(l).multiplyScalar(.5),Ps.copy(l).sub(e).normalize(),wo.copy(this.origin).sub(Fs);const M=.5*e.distanceTo(l),P=-this.direction.dot(Ps),N=wo.dot(this.direction),U=-wo.dot(Ps),G=wo.lengthSq(),K=Math.abs(1-P*P);let Q,ne,oe,de;if(K>0)if(Q=P*U-N,ne=P*N-U,de=M*K,Q>=0)if(ne>=-de)if(ne<=de){const xe=1/K;Q*=xe,ne*=xe,oe=Q*(Q+P*ne+2*N)+ne*(P*Q+ne+2*U)+G}else ne=M,Q=Math.max(0,-(P*ne+N)),oe=-Q*Q+ne*(ne+2*U)+G;else ne=-M,Q=Math.max(0,-(P*ne+N)),oe=-Q*Q+ne*(ne+2*U)+G;else ne<=-de?(Q=Math.max(0,-(-P*M+N)),ne=Q>0?-M:Math.min(Math.max(-M,-U),M),oe=-Q*Q+ne*(ne+2*U)+G):ne<=de?(Q=0,ne=Math.min(Math.max(-M,-U),M),oe=ne*(ne+2*U)+G):(Q=Math.max(0,-(P*M+N)),ne=Q>0?M:Math.min(Math.max(-M,-U),M),oe=-Q*Q+ne*(ne+2*U)+G);else ne=P>0?-M:M,Q=Math.max(0,-(P*ne+N)),oe=-Q*Q+ne*(ne+2*U)+G;return g&&g.copy(this.direction).multiplyScalar(Q).add(this.origin),_&&_.copy(Ps).multiplyScalar(ne).add(Fs),oe}intersectSphere(e,l){es.subVectors(e.center,this.origin);const g=es.dot(this.direction),_=es.dot(es)-g*g,M=e.radius*e.radius;if(_>M)return null;const P=Math.sqrt(M-_),N=g-P,U=g+P;return N<0&&U<0?null:N<0?this.at(U,l):this.at(N,l)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const l=e.normal.dot(this.direction);if(l===0)return e.distanceToPoint(this.origin)===0?0:null;const g=-(this.origin.dot(e.normal)+e.constant)/l;return g>=0?g:null}intersectPlane(e,l){const g=this.distanceToPlane(e);return g===null?null:this.at(g,l)}intersectsPlane(e){const l=e.distanceToPoint(this.origin);return l===0?!0:e.normal.dot(this.direction)*l<0}intersectBox(e,l){let g,_,M,P,N,U;const G=1/this.direction.x,K=1/this.direction.y,Q=1/this.direction.z,ne=this.origin;return G>=0?(g=(e.min.x-ne.x)*G,_=(e.max.x-ne.x)*G):(g=(e.max.x-ne.x)*G,_=(e.min.x-ne.x)*G),K>=0?(M=(e.min.y-ne.y)*K,P=(e.max.y-ne.y)*K):(M=(e.max.y-ne.y)*K,P=(e.min.y-ne.y)*K),g>P||M>_?null:((M>g||g!=g)&&(g=M),(P<_||_!=_)&&(_=P),Q>=0?(N=(e.min.z-ne.z)*Q,U=(e.max.z-ne.z)*Q):(N=(e.max.z-ne.z)*Q,U=(e.min.z-ne.z)*Q),g>U||N>_?null:((N>g||g!=g)&&(g=N),(U<_||_!=_)&&(_=U),_<0?null:this.at(g>=0?g:_,l)))}intersectsBox(e){return this.intersectBox(e,es)!==null}intersectTriangle(e,l,g,_,M){Xo.subVectors(l,e),ka.subVectors(g,e),ll.crossVectors(Xo,ka);let P,N=this.direction.dot(ll);if(N>0){if(_)return null;P=1}else{if(!(N<0))return null;P=-1,N=-N}wo.subVectors(this.origin,e);const U=P*this.direction.dot(ka.crossVectors(wo,ka));if(U<0)return null;const G=P*this.direction.dot(Xo.cross(wo));if(G<0||U+G>N)return null;const K=-P*wo.dot(ll);return K<0?null:this.at(K/N,M)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class nr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,l,g,_,M,P,N,U,G,K,Q,ne,oe,de,xe,Re){const we=this.elements;return we[0]=e,we[4]=l,we[8]=g,we[12]=_,we[1]=M,we[5]=P,we[9]=N,we[13]=U,we[2]=G,we[6]=K,we[10]=Q,we[14]=ne,we[3]=oe,we[7]=de,we[11]=xe,we[15]=Re,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new nr().fromArray(this.elements)}copy(e){const l=this.elements,g=e.elements;return l[0]=g[0],l[1]=g[1],l[2]=g[2],l[3]=g[3],l[4]=g[4],l[5]=g[5],l[6]=g[6],l[7]=g[7],l[8]=g[8],l[9]=g[9],l[10]=g[10],l[11]=g[11],l[12]=g[12],l[13]=g[13],l[14]=g[14],l[15]=g[15],this}copyPosition(e){const l=this.elements,g=e.elements;return l[12]=g[12],l[13]=g[13],l[14]=g[14],this}setFromMatrix3(e){const l=e.elements;return this.set(l[0],l[3],l[6],0,l[1],l[4],l[7],0,l[2],l[5],l[8],0,0,0,0,1),this}extractBasis(e,l,g){return e.setFromMatrixColumn(this,0),l.setFromMatrixColumn(this,1),g.setFromMatrixColumn(this,2),this}makeBasis(e,l,g){return this.set(e.x,l.x,g.x,0,e.y,l.y,g.y,0,e.z,l.z,g.z,0,0,0,0,1),this}extractRotation(e){const l=this.elements,g=e.elements,_=1/Go.setFromMatrixColumn(e,0).length(),M=1/Go.setFromMatrixColumn(e,1).length(),P=1/Go.setFromMatrixColumn(e,2).length();return l[0]=g[0]*_,l[1]=g[1]*_,l[2]=g[2]*_,l[3]=0,l[4]=g[4]*M,l[5]=g[5]*M,l[6]=g[6]*M,l[7]=0,l[8]=g[8]*P,l[9]=g[9]*P,l[10]=g[10]*P,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const l=this.elements,g=e.x,_=e.y,M=e.z,P=Math.cos(g),N=Math.sin(g),U=Math.cos(_),G=Math.sin(_),K=Math.cos(M),Q=Math.sin(M);if(e.order==="XYZ"){const ne=P*K,oe=P*Q,de=N*K,xe=N*Q;l[0]=U*K,l[4]=-U*Q,l[8]=G,l[1]=oe+de*G,l[5]=ne-xe*G,l[9]=-N*U,l[2]=xe-ne*G,l[6]=de+oe*G,l[10]=P*U}else if(e.order==="YXZ"){const ne=U*K,oe=U*Q,de=G*K,xe=G*Q;l[0]=ne+xe*N,l[4]=de*N-oe,l[8]=P*G,l[1]=P*Q,l[5]=P*K,l[9]=-N,l[2]=oe*N-de,l[6]=xe+ne*N,l[10]=P*U}else if(e.order==="ZXY"){const ne=U*K,oe=U*Q,de=G*K,xe=G*Q;l[0]=ne-xe*N,l[4]=-P*Q,l[8]=de+oe*N,l[1]=oe+de*N,l[5]=P*K,l[9]=xe-ne*N,l[2]=-P*G,l[6]=N,l[10]=P*U}else if(e.order==="ZYX"){const ne=P*K,oe=P*Q,de=N*K,xe=N*Q;l[0]=U*K,l[4]=de*G-oe,l[8]=ne*G+xe,l[1]=U*Q,l[5]=xe*G+ne,l[9]=oe*G-de,l[2]=-G,l[6]=N*U,l[10]=P*U}else if(e.order==="YZX"){const ne=P*U,oe=P*G,de=N*U,xe=N*G;l[0]=U*K,l[4]=xe-ne*Q,l[8]=de*Q+oe,l[1]=Q,l[5]=P*K,l[9]=-N*K,l[2]=-G*K,l[6]=oe*Q+de,l[10]=ne-xe*Q}else if(e.order==="XZY"){const ne=P*U,oe=P*G,de=N*U,xe=N*G;l[0]=U*K,l[4]=-Q,l[8]=G*K,l[1]=ne*Q+xe,l[5]=P*K,l[9]=oe*Q-de,l[2]=de*Q-oe,l[6]=N*K,l[10]=xe*Q+ne}return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Bo,e,ra)}lookAt(e,l,g){const _=this.elements;return Ws.subVectors(e,l),Ws.lengthSq()===0&&(Ws.z=1),Ws.normalize(),mo.crossVectors(g,Ws),mo.lengthSq()===0&&(Math.abs(g.z)===1?Ws.x+=1e-4:Ws.z+=1e-4,Ws.normalize(),mo.crossVectors(g,Ws)),mo.normalize(),Ho.crossVectors(Ws,mo),_[0]=mo.x,_[4]=Ho.x,_[8]=Ws.x,_[1]=mo.y,_[5]=Ho.y,_[9]=Ws.y,_[2]=mo.z,_[6]=Ho.z,_[10]=Ws.z,this}multiply(e,l){return l!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,l)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,l){const g=e.elements,_=l.elements,M=this.elements,P=g[0],N=g[4],U=g[8],G=g[12],K=g[1],Q=g[5],ne=g[9],oe=g[13],de=g[2],xe=g[6],Re=g[10],we=g[14],nt=g[3],xt=g[7],ft=g[11],Ht=g[15],Xt=_[0],_i=_[4],vi=_[8],Bi=_[12],Li=_[1],ki=_[5],Zn=_[9],En=_[13],Ji=_[2],In=_[6],ir=_[10],rr=_[14],vr=_[3],kr=_[7],Fr=_[11],Rn=_[15];return M[0]=P*Xt+N*Li+U*Ji+G*vr,M[4]=P*_i+N*ki+U*In+G*kr,M[8]=P*vi+N*Zn+U*ir+G*Fr,M[12]=P*Bi+N*En+U*rr+G*Rn,M[1]=K*Xt+Q*Li+ne*Ji+oe*vr,M[5]=K*_i+Q*ki+ne*In+oe*kr,M[9]=K*vi+Q*Zn+ne*ir+oe*Fr,M[13]=K*Bi+Q*En+ne*rr+oe*Rn,M[2]=de*Xt+xe*Li+Re*Ji+we*vr,M[6]=de*_i+xe*ki+Re*In+we*kr,M[10]=de*vi+xe*Zn+Re*ir+we*Fr,M[14]=de*Bi+xe*En+Re*rr+we*Rn,M[3]=nt*Xt+xt*Li+ft*Ji+Ht*vr,M[7]=nt*_i+xt*ki+ft*In+Ht*kr,M[11]=nt*vi+xt*Zn+ft*ir+Ht*Fr,M[15]=nt*Bi+xt*En+ft*rr+Ht*Rn,this}multiplyScalar(e){const l=this.elements;return l[0]*=e,l[4]*=e,l[8]*=e,l[12]*=e,l[1]*=e,l[5]*=e,l[9]*=e,l[13]*=e,l[2]*=e,l[6]*=e,l[10]*=e,l[14]*=e,l[3]*=e,l[7]*=e,l[11]*=e,l[15]*=e,this}determinant(){const e=this.elements,l=e[0],g=e[4],_=e[8],M=e[12],P=e[1],N=e[5],U=e[9],G=e[13],K=e[2],Q=e[6],ne=e[10],oe=e[14];return e[3]*(+M*U*Q-_*G*Q-M*N*ne+g*G*ne+_*N*oe-g*U*oe)+e[7]*(+l*U*oe-l*G*ne+M*P*ne-_*P*oe+_*G*K-M*U*K)+e[11]*(+l*G*Q-l*N*oe-M*P*Q+g*P*oe+M*N*K-g*G*K)+e[15]*(-_*N*K-l*U*Q+l*N*ne+_*P*Q-g*P*ne+g*U*K)}transpose(){const e=this.elements;let l;return l=e[1],e[1]=e[4],e[4]=l,l=e[2],e[2]=e[8],e[8]=l,l=e[6],e[6]=e[9],e[9]=l,l=e[3],e[3]=e[12],e[12]=l,l=e[7],e[7]=e[13],e[13]=l,l=e[11],e[11]=e[14],e[14]=l,this}setPosition(e,l,g){const _=this.elements;return e.isVector3?(_[12]=e.x,_[13]=e.y,_[14]=e.z):(_[12]=e,_[13]=l,_[14]=g),this}invert(){const e=this.elements,l=e[0],g=e[1],_=e[2],M=e[3],P=e[4],N=e[5],U=e[6],G=e[7],K=e[8],Q=e[9],ne=e[10],oe=e[11],de=e[12],xe=e[13],Re=e[14],we=e[15],nt=Q*Re*G-xe*ne*G+xe*U*oe-N*Re*oe-Q*U*we+N*ne*we,xt=de*ne*G-K*Re*G-de*U*oe+P*Re*oe+K*U*we-P*ne*we,ft=K*xe*G-de*Q*G+de*N*oe-P*xe*oe-K*N*we+P*Q*we,Ht=de*Q*U-K*xe*U-de*N*ne+P*xe*ne+K*N*Re-P*Q*Re,Xt=l*nt+g*xt+_*ft+M*Ht;if(Xt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _i=1/Xt;return e[0]=nt*_i,e[1]=(xe*ne*M-Q*Re*M-xe*_*oe+g*Re*oe+Q*_*we-g*ne*we)*_i,e[2]=(N*Re*M-xe*U*M+xe*_*G-g*Re*G-N*_*we+g*U*we)*_i,e[3]=(Q*U*M-N*ne*M-Q*_*G+g*ne*G+N*_*oe-g*U*oe)*_i,e[4]=xt*_i,e[5]=(K*Re*M-de*ne*M+de*_*oe-l*Re*oe-K*_*we+l*ne*we)*_i,e[6]=(de*U*M-P*Re*M-de*_*G+l*Re*G+P*_*we-l*U*we)*_i,e[7]=(P*ne*M-K*U*M+K*_*G-l*ne*G-P*_*oe+l*U*oe)*_i,e[8]=ft*_i,e[9]=(de*Q*M-K*xe*M-de*g*oe+l*xe*oe+K*g*we-l*Q*we)*_i,e[10]=(P*xe*M-de*N*M+de*g*G-l*xe*G-P*g*we+l*N*we)*_i,e[11]=(K*N*M-P*Q*M-K*g*G+l*Q*G+P*g*oe-l*N*oe)*_i,e[12]=Ht*_i,e[13]=(K*xe*_-de*Q*_+de*g*ne-l*xe*ne-K*g*Re+l*Q*Re)*_i,e[14]=(de*N*_-P*xe*_-de*g*U+l*xe*U+P*g*Re-l*N*Re)*_i,e[15]=(P*Q*_-K*N*_+K*g*U-l*Q*U-P*g*ne+l*N*ne)*_i,this}scale(e){const l=this.elements,g=e.x,_=e.y,M=e.z;return l[0]*=g,l[4]*=_,l[8]*=M,l[1]*=g,l[5]*=_,l[9]*=M,l[2]*=g,l[6]*=_,l[10]*=M,l[3]*=g,l[7]*=_,l[11]*=M,this}getMaxScaleOnAxis(){const e=this.elements,l=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],g=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],_=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(l,g,_))}makeTranslation(e,l,g){return this.set(1,0,0,e,0,1,0,l,0,0,1,g,0,0,0,1),this}makeRotationX(e){const l=Math.cos(e),g=Math.sin(e);return this.set(1,0,0,0,0,l,-g,0,0,g,l,0,0,0,0,1),this}makeRotationY(e){const l=Math.cos(e),g=Math.sin(e);return this.set(l,0,g,0,0,1,0,0,-g,0,l,0,0,0,0,1),this}makeRotationZ(e){const l=Math.cos(e),g=Math.sin(e);return this.set(l,-g,0,0,g,l,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,l){const g=Math.cos(l),_=Math.sin(l),M=1-g,P=e.x,N=e.y,U=e.z,G=M*P,K=M*N;return this.set(G*P+g,G*N-_*U,G*U+_*N,0,G*N+_*U,K*N+g,K*U-_*P,0,G*U-_*N,K*U+_*P,M*U*U+g,0,0,0,0,1),this}makeScale(e,l,g){return this.set(e,0,0,0,0,l,0,0,0,0,g,0,0,0,0,1),this}makeShear(e,l,g,_,M,P){return this.set(1,g,M,0,e,1,P,0,l,_,1,0,0,0,0,1),this}compose(e,l,g){const _=this.elements,M=l._x,P=l._y,N=l._z,U=l._w,G=M+M,K=P+P,Q=N+N,ne=M*G,oe=M*K,de=M*Q,xe=P*K,Re=P*Q,we=N*Q,nt=U*G,xt=U*K,ft=U*Q,Ht=g.x,Xt=g.y,_i=g.z;return _[0]=(1-(xe+we))*Ht,_[1]=(oe+ft)*Ht,_[2]=(de-xt)*Ht,_[3]=0,_[4]=(oe-ft)*Xt,_[5]=(1-(ne+we))*Xt,_[6]=(Re+nt)*Xt,_[7]=0,_[8]=(de+xt)*_i,_[9]=(Re-nt)*_i,_[10]=(1-(ne+xe))*_i,_[11]=0,_[12]=e.x,_[13]=e.y,_[14]=e.z,_[15]=1,this}decompose(e,l,g){const _=this.elements;let M=Go.set(_[0],_[1],_[2]).length();const P=Go.set(_[4],_[5],_[6]).length(),N=Go.set(_[8],_[9],_[10]).length();this.determinant()<0&&(M=-M),e.x=_[12],e.y=_[13],e.z=_[14],fo.copy(this);const U=1/M,G=1/P,K=1/N;return fo.elements[0]*=U,fo.elements[1]*=U,fo.elements[2]*=U,fo.elements[4]*=G,fo.elements[5]*=G,fo.elements[6]*=G,fo.elements[8]*=K,fo.elements[9]*=K,fo.elements[10]*=K,l.setFromRotationMatrix(fo),g.x=M,g.y=P,g.z=N,this}makePerspective(e,l,g,_,M,P){P===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const N=this.elements,U=2*M/(l-e),G=2*M/(g-_),K=(l+e)/(l-e),Q=(g+_)/(g-_),ne=-(P+M)/(P-M),oe=-2*P*M/(P-M);return N[0]=U,N[4]=0,N[8]=K,N[12]=0,N[1]=0,N[5]=G,N[9]=Q,N[13]=0,N[2]=0,N[6]=0,N[10]=ne,N[14]=oe,N[3]=0,N[7]=0,N[11]=-1,N[15]=0,this}makeOrthographic(e,l,g,_,M,P){const N=this.elements,U=1/(l-e),G=1/(g-_),K=1/(P-M),Q=(l+e)*U,ne=(g+_)*G,oe=(P+M)*K;return N[0]=2*U,N[4]=0,N[8]=0,N[12]=-Q,N[1]=0,N[5]=2*G,N[9]=0,N[13]=-ne,N[2]=0,N[6]=0,N[10]=-2*K,N[14]=-oe,N[3]=0,N[7]=0,N[11]=0,N[15]=1,this}equals(e){const l=this.elements,g=e.elements;for(let _=0;_<16;_++)if(l[_]!==g[_])return!1;return!0}fromArray(e,l=0){for(let g=0;g<16;g++)this.elements[g]=e[g+l];return this}toArray(e=[],l=0){const g=this.elements;return e[l]=g[0],e[l+1]=g[1],e[l+2]=g[2],e[l+3]=g[3],e[l+4]=g[4],e[l+5]=g[5],e[l+6]=g[6],e[l+7]=g[7],e[l+8]=g[8],e[l+9]=g[9],e[l+10]=g[10],e[l+11]=g[11],e[l+12]=g[12],e[l+13]=g[13],e[l+14]=g[14],e[l+15]=g[15],e}}nr.prototype.isMatrix4=!0;const Go=new ie,fo=new nr,Bo=new ie(0,0,0),ra=new ie(1,1,1),mo=new ie,Ho=new ie,Ws=new ie,pa=new nr,cl=new ye;class Fa{constructor(e=0,l=0,g=0,_=Fa.DefaultOrder){this._x=e,this._y=l,this._z=g,this._order=_}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,l,g,_=this._order){return this._x=e,this._y=l,this._z=g,this._order=_,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,l=this._order,g=!0){const _=e.elements,M=_[0],P=_[4],N=_[8],U=_[1],G=_[5],K=_[9],Q=_[2],ne=_[6],oe=_[10];switch(l){case"XYZ":this._y=Math.asin(Fn(N,-1,1)),Math.abs(N)<.9999999?(this._x=Math.atan2(-K,oe),this._z=Math.atan2(-P,M)):(this._x=Math.atan2(ne,G),this._z=0);break;case"YXZ":this._x=Math.asin(-Fn(K,-1,1)),Math.abs(K)<.9999999?(this._y=Math.atan2(N,oe),this._z=Math.atan2(U,G)):(this._y=Math.atan2(-Q,M),this._z=0);break;case"ZXY":this._x=Math.asin(Fn(ne,-1,1)),Math.abs(ne)<.9999999?(this._y=Math.atan2(-Q,oe),this._z=Math.atan2(-P,G)):(this._y=0,this._z=Math.atan2(U,M));break;case"ZYX":this._y=Math.asin(-Fn(Q,-1,1)),Math.abs(Q)<.9999999?(this._x=Math.atan2(ne,oe),this._z=Math.atan2(U,M)):(this._x=0,this._z=Math.atan2(-P,G));break;case"YZX":this._z=Math.asin(Fn(U,-1,1)),Math.abs(U)<.9999999?(this._x=Math.atan2(-K,G),this._y=Math.atan2(-Q,M)):(this._x=0,this._y=Math.atan2(N,oe));break;case"XZY":this._z=Math.asin(-Fn(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(ne,G),this._y=Math.atan2(N,M)):(this._x=Math.atan2(-K,oe),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+l)}return this._order=l,g===!0&&this._onChangeCallback(),this}setFromQuaternion(e,l,g){return pa.makeRotationFromQuaternion(e),this.setFromRotationMatrix(pa,l,g)}setFromVector3(e,l=this._order){return this.set(e.x,e.y,e.z,l)}reorder(e){return cl.setFromEuler(this),this.setFromQuaternion(cl,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],l=0){return e[l]=this._x,e[l+1]=this._y,e[l+2]=this._z,e[l+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new ie(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Fa.prototype.isEuler=!0,Fa.DefaultOrder="XYZ",Fa.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class zl{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}}let Us=0;const ul=new ie,hl=new ye,Ae=new nr,Te=new ie,Ve=new ie,Pt=new ie,Ai=new ye,Ui=new ie(1,0,0),bi=new ie(0,1,0),Yi=new ie(0,0,1),fe={type:"added"},me={type:"removed"};class Ee extends Mt{constructor(){super(),Object.defineProperty(this,"id",{value:Us++}),this.uuid=_n(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ee.DefaultUp.clone();const e=new ie,l=new Fa,g=new ye,_=new ie(1,1,1);l._onChange(function(){g.setFromEuler(l,!1)}),g._onChange(function(){l.setFromQuaternion(g,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:l},quaternion:{configurable:!0,enumerable:!0,value:g},scale:{configurable:!0,enumerable:!0,value:_},modelViewMatrix:{value:new nr},normalMatrix:{value:new Wn}}),this.matrix=new nr,this.matrixWorld=new nr,this.matrixAutoUpdate=Ee.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new zl,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,l){this.quaternion.setFromAxisAngle(e,l)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,l){return hl.setFromAxisAngle(e,l),this.quaternion.multiply(hl),this}rotateOnWorldAxis(e,l){return hl.setFromAxisAngle(e,l),this.quaternion.premultiply(hl),this}rotateX(e){return this.rotateOnAxis(Ui,e)}rotateY(e){return this.rotateOnAxis(bi,e)}rotateZ(e){return this.rotateOnAxis(Yi,e)}translateOnAxis(e,l){return ul.copy(e).applyQuaternion(this.quaternion),this.position.add(ul.multiplyScalar(l)),this}translateX(e){return this.translateOnAxis(Ui,e)}translateY(e){return this.translateOnAxis(bi,e)}translateZ(e){return this.translateOnAxis(Yi,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ae.copy(this.matrixWorld).invert())}lookAt(e,l,g){e.isVector3?Te.copy(e):Te.set(e,l,g);const _=this.parent;this.updateWorldMatrix(!0,!1),Ve.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ae.lookAt(Ve,Te,this.up):Ae.lookAt(Te,Ve,this.up),this.quaternion.setFromRotationMatrix(Ae),_&&(Ae.extractRotation(_.matrixWorld),hl.setFromRotationMatrix(Ae),this.quaternion.premultiply(hl.invert()))}add(e){if(arguments.length>1){for(let l=0;l<arguments.length;l++)this.add(arguments[l]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(fe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let g=0;g<arguments.length;g++)this.remove(arguments[g]);return this}const l=this.children.indexOf(e);return l!==-1&&(e.parent=null,this.children.splice(l,1),e.dispatchEvent(me)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const l=this.children[e];l.parent=null,l.dispatchEvent(me)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ae.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ae.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ae),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,l){if(this[e]===l)return this;for(let g=0,_=this.children.length;g<_;g++){const M=this.children[g].getObjectByProperty(e,l);if(M!==void 0)return M}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ve,e,Pt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ve,Ai,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return e.set(l[8],l[9],l[10]).normalize()}raycast(){}traverse(e){e(this);const l=this.children;for(let g=0,_=l.length;g<_;g++)l[g].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const l=this.children;for(let g=0,_=l.length;g<_;g++)l[g].traverseVisible(e)}traverseAncestors(e){const l=this.parent;l!==null&&(e(l),l.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const l=this.children;for(let g=0,_=l.length;g<_;g++)l[g].updateMatrixWorld(e)}updateWorldMatrix(e,l){const g=this.parent;if(e===!0&&g!==null&&g.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),l===!0){const _=this.children;for(let M=0,P=_.length;M<P;M++)_[M].updateWorldMatrix(!1,!0)}}toJSON(e){const l=e===void 0||typeof e=="string",g={};l&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},g.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const _={};function M(N,U){return N[U.uuid]===void 0&&(N[U.uuid]=U.toJSON(e)),U.uuid}if(_.uuid=this.uuid,_.type=this.type,this.name!==""&&(_.name=this.name),this.castShadow===!0&&(_.castShadow=!0),this.receiveShadow===!0&&(_.receiveShadow=!0),this.visible===!1&&(_.visible=!1),this.frustumCulled===!1&&(_.frustumCulled=!1),this.renderOrder!==0&&(_.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(_.userData=this.userData),_.layers=this.layers.mask,_.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(_.matrixAutoUpdate=!1),this.isInstancedMesh&&(_.type="InstancedMesh",_.count=this.count,_.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(_.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?_.background=this.background.toJSON():this.background.isTexture&&(_.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(_.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){_.geometry=M(e.geometries,this.geometry);const N=this.geometry.parameters;if(N!==void 0&&N.shapes!==void 0){const U=N.shapes;if(Array.isArray(U))for(let G=0,K=U.length;G<K;G++){const Q=U[G];M(e.shapes,Q)}else M(e.shapes,U)}}if(this.isSkinnedMesh&&(_.bindMode=this.bindMode,_.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(M(e.skeletons,this.skeleton),_.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const N=[];for(let U=0,G=this.material.length;U<G;U++)N.push(M(e.materials,this.material[U]));_.material=N}else _.material=M(e.materials,this.material);if(this.children.length>0){_.children=[];for(let N=0;N<this.children.length;N++)_.children.push(this.children[N].toJSON(e).object)}if(this.animations.length>0){_.animations=[];for(let N=0;N<this.animations.length;N++){const U=this.animations[N];_.animations.push(M(e.animations,U))}}if(l){const N=P(e.geometries),U=P(e.materials),G=P(e.textures),K=P(e.images),Q=P(e.shapes),ne=P(e.skeletons),oe=P(e.animations);N.length>0&&(g.geometries=N),U.length>0&&(g.materials=U),G.length>0&&(g.textures=G),K.length>0&&(g.images=K),Q.length>0&&(g.shapes=Q),ne.length>0&&(g.skeletons=ne),oe.length>0&&(g.animations=oe)}return g.object=_,g;function P(N){const U=[];for(const G in N){const K=N[G];delete K.metadata,U.push(K)}return U}}clone(e){return new this.constructor().copy(this,e)}copy(e,l=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),l===!0)for(let g=0;g<e.children.length;g++){const _=e.children[g];this.add(_.clone())}return this}}Ee.DefaultUp=new ie(0,1,0),Ee.DefaultMatrixAutoUpdate=!0,Ee.prototype.isObject3D=!0;const We=new ie,Pe=new ie,li=new ie,Mi=new ie,Wi=new ie,hn=new ie,Dn=new ie,Zi=new ie,Kt=new ie,nn=new ie;class Ei{constructor(e=new ie,l=new ie,g=new ie){this.a=e,this.b=l,this.c=g}static getNormal(e,l,g,_){_.subVectors(g,l),We.subVectors(e,l),_.cross(We);const M=_.lengthSq();return M>0?_.multiplyScalar(1/Math.sqrt(M)):_.set(0,0,0)}static getBarycoord(e,l,g,_,M){We.subVectors(_,l),Pe.subVectors(g,l),li.subVectors(e,l);const P=We.dot(We),N=We.dot(Pe),U=We.dot(li),G=Pe.dot(Pe),K=Pe.dot(li),Q=P*G-N*N;if(Q===0)return M.set(-2,-1,-1);const ne=1/Q,oe=(G*U-N*K)*ne,de=(P*K-N*U)*ne;return M.set(1-oe-de,de,oe)}static containsPoint(e,l,g,_){return this.getBarycoord(e,l,g,_,Mi),Mi.x>=0&&Mi.y>=0&&Mi.x+Mi.y<=1}static getUV(e,l,g,_,M,P,N,U){return this.getBarycoord(e,l,g,_,Mi),U.set(0,0),U.addScaledVector(M,Mi.x),U.addScaledVector(P,Mi.y),U.addScaledVector(N,Mi.z),U}static isFrontFacing(e,l,g,_){return We.subVectors(g,l),Pe.subVectors(e,l),We.cross(Pe).dot(_)<0}set(e,l,g){return this.a.copy(e),this.b.copy(l),this.c.copy(g),this}setFromPointsAndIndices(e,l,g,_){return this.a.copy(e[l]),this.b.copy(e[g]),this.c.copy(e[_]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return We.subVectors(this.c,this.b),Pe.subVectors(this.a,this.b),.5*We.cross(Pe).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ei.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,l){return Ei.getBarycoord(e,this.a,this.b,this.c,l)}getUV(e,l,g,_,M){return Ei.getUV(e,this.a,this.b,this.c,l,g,_,M)}containsPoint(e){return Ei.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ei.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,l){const g=this.a,_=this.b,M=this.c;let P,N;Wi.subVectors(_,g),hn.subVectors(M,g),Zi.subVectors(e,g);const U=Wi.dot(Zi),G=hn.dot(Zi);if(U<=0&&G<=0)return l.copy(g);Kt.subVectors(e,_);const K=Wi.dot(Kt),Q=hn.dot(Kt);if(K>=0&&Q<=K)return l.copy(_);const ne=U*Q-K*G;if(ne<=0&&U>=0&&K<=0)return P=U/(U-K),l.copy(g).addScaledVector(Wi,P);nn.subVectors(e,M);const oe=Wi.dot(nn),de=hn.dot(nn);if(de>=0&&oe<=de)return l.copy(M);const xe=oe*G-U*de;if(xe<=0&&G>=0&&de<=0)return N=G/(G-de),l.copy(g).addScaledVector(hn,N);const Re=K*de-oe*Q;if(Re<=0&&Q-K>=0&&oe-de>=0)return Dn.subVectors(M,_),N=(Q-K)/(Q-K+(oe-de)),l.copy(_).addScaledVector(Dn,N);const we=1/(Re+xe+ne);return P=xe*we,N=ne*we,l.copy(g).addScaledVector(Wi,P).addScaledVector(hn,N)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Ln=0;class Vi extends Mt{constructor(){super(),Object.defineProperty(this,"id",{value:Ln++}),this.uuid=_n(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=1023,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const l in e){const g=e[l];if(g===void 0){console.warn("THREE.Material: '"+l+"' parameter is undefined.");continue}if(l==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=g===1;continue}const _=this[l];_!==void 0?_&&_.isColor?_.set(g):_&&_.isVector3&&g&&g.isVector3?_.copy(g):this[l]=g:console.warn("THREE."+this.type+": '"+l+"' is not a property of this material.")}}toJSON(e){const l=e===void 0||typeof e=="string";l&&(e={textures:{},images:{}});const g={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function _(M){const P=[];for(const N in M){const U=M[N];delete U.metadata,P.push(U)}return P}if(g.uuid=this.uuid,g.type=this.type,this.name!==""&&(g.name=this.name),this.color&&this.color.isColor&&(g.color=this.color.getHex()),this.roughness!==void 0&&(g.roughness=this.roughness),this.metalness!==void 0&&(g.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(g.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(g.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(g.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(g.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(g.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(g.specularTint=this.specularTint.getHex()),this.shininess!==void 0&&(g.shininess=this.shininess),this.clearcoat!==void 0&&(g.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(g.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(g.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(g.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(g.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,g.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(g.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(g.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(g.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(g.lightMap=this.lightMap.toJSON(e).uuid,g.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(g.aoMap=this.aoMap.toJSON(e).uuid,g.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(g.bumpMap=this.bumpMap.toJSON(e).uuid,g.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(g.normalMap=this.normalMap.toJSON(e).uuid,g.normalMapType=this.normalMapType,g.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(g.displacementMap=this.displacementMap.toJSON(e).uuid,g.displacementScale=this.displacementScale,g.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(g.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(g.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(g.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(g.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(g.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(g.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(g.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(g.combine=this.combine)),this.envMapIntensity!==void 0&&(g.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(g.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(g.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(g.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(g.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(g.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(g.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(g.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(g.attenuationDistance=this.attenuationDistance),this.attenuationTint!==void 0&&(g.attenuationTint=this.attenuationTint.getHex()),this.size!==void 0&&(g.size=this.size),this.shadowSide!==null&&(g.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(g.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(g.blending=this.blending),this.side!==0&&(g.side=this.side),this.vertexColors&&(g.vertexColors=!0),this.opacity<1&&(g.opacity=this.opacity),this.format!==1023&&(g.format=this.format),this.transparent===!0&&(g.transparent=this.transparent),g.depthFunc=this.depthFunc,g.depthTest=this.depthTest,g.depthWrite=this.depthWrite,g.colorWrite=this.colorWrite,g.stencilWrite=this.stencilWrite,g.stencilWriteMask=this.stencilWriteMask,g.stencilFunc=this.stencilFunc,g.stencilRef=this.stencilRef,g.stencilFuncMask=this.stencilFuncMask,g.stencilFail=this.stencilFail,g.stencilZFail=this.stencilZFail,g.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(g.rotation=this.rotation),this.polygonOffset===!0&&(g.polygonOffset=!0),this.polygonOffsetFactor!==0&&(g.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(g.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(g.linewidth=this.linewidth),this.dashSize!==void 0&&(g.dashSize=this.dashSize),this.gapSize!==void 0&&(g.gapSize=this.gapSize),this.scale!==void 0&&(g.scale=this.scale),this.dithering===!0&&(g.dithering=!0),this.alphaTest>0&&(g.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(g.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(g.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(g.wireframe=this.wireframe),this.wireframeLinewidth>1&&(g.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(g.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(g.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(g.flatShading=this.flatShading),this.visible===!1&&(g.visible=!1),this.toneMapped===!1&&(g.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(g.userData=this.userData),l){const M=_(e.textures),P=_(e.images);M.length>0&&(g.textures=M),P.length>0&&(g.images=P)}return g}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const l=e.clippingPlanes;let g=null;if(l!==null){const _=l.length;g=new Array(_);for(let M=0;M!==_;++M)g[M]=l[M].clone()}return this.clippingPlanes=g,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}Vi.prototype.isMaterial=!0;const fn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},cr={h:0,s:0,l:0},gr={h:0,s:0,l:0};function _r(S,e,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?S+6*(e-S)*l:l<.5?e:l<2/3?S+6*(e-S)*(2/3-l):S}function Rr(S){return S<.04045?.0773993808*S:Math.pow(.9478672986*S+.0521327014,2.4)}function ur(S){return S<.0031308?12.92*S:1.055*Math.pow(S,.41666)-.055}class wn{constructor(e,l,g){return l===void 0&&g===void 0?this.set(e):this.setRGB(e,l,g)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,l,g){return this.r=e,this.g=l,this.b=g,this}setHSL(e,l,g){if(e=Mn(e,1),l=Fn(l,0,1),g=Fn(g,0,1),l===0)this.r=this.g=this.b=g;else{const _=g<=.5?g*(1+l):g+l-g*l,M=2*g-_;this.r=_r(M,_,e+1/3),this.g=_r(M,_,e),this.b=_r(M,_,e-1/3)}return this}setStyle(e){function l(_){_!==void 0&&parseFloat(_)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let g;if(g=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let _;const M=g[1],P=g[2];switch(M){case"rgb":case"rgba":if(_=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(P))return this.r=Math.min(255,parseInt(_[1],10))/255,this.g=Math.min(255,parseInt(_[2],10))/255,this.b=Math.min(255,parseInt(_[3],10))/255,l(_[4]),this;if(_=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(P))return this.r=Math.min(100,parseInt(_[1],10))/100,this.g=Math.min(100,parseInt(_[2],10))/100,this.b=Math.min(100,parseInt(_[3],10))/100,l(_[4]),this;break;case"hsl":case"hsla":if(_=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(P)){const N=parseFloat(_[1])/360,U=parseInt(_[2],10)/100,G=parseInt(_[3],10)/100;return l(_[4]),this.setHSL(N,U,G)}}}else if(g=/^\#([A-Fa-f\d]+)$/.exec(e)){const _=g[1],M=_.length;if(M===3)return this.r=parseInt(_.charAt(0)+_.charAt(0),16)/255,this.g=parseInt(_.charAt(1)+_.charAt(1),16)/255,this.b=parseInt(_.charAt(2)+_.charAt(2),16)/255,this;if(M===6)return this.r=parseInt(_.charAt(0)+_.charAt(1),16)/255,this.g=parseInt(_.charAt(2)+_.charAt(3),16)/255,this.b=parseInt(_.charAt(4)+_.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const l=fn[e.toLowerCase()];return l!==void 0?this.setHex(l):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,l=2){return this.r=Math.pow(e.r,l),this.g=Math.pow(e.g,l),this.b=Math.pow(e.b,l),this}copyLinearToGamma(e,l=2){const g=l>0?1/l:1;return this.r=Math.pow(e.r,g),this.g=Math.pow(e.g,g),this.b=Math.pow(e.b,g),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Rr(e.r),this.g=Rr(e.g),this.b=Rr(e.b),this}copyLinearToSRGB(e){return this.r=ur(e.r),this.g=ur(e.g),this.b=ur(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const l=this.r,g=this.g,_=this.b,M=Math.max(l,g,_),P=Math.min(l,g,_);let N,U;const G=(P+M)/2;if(P===M)N=0,U=0;else{const K=M-P;switch(U=G<=.5?K/(M+P):K/(2-M-P),M){case l:N=(g-_)/K+(g<_?6:0);break;case g:N=(_-l)/K+2;break;case _:N=(l-g)/K+4}N/=6}return e.h=N,e.s=U,e.l=G,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,l,g){return this.getHSL(cr),cr.h+=e,cr.s+=l,cr.l+=g,this.setHSL(cr.h,cr.s,cr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,l){return this.r=e.r+l.r,this.g=e.g+l.g,this.b=e.b+l.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,l){return this.r+=(e.r-this.r)*l,this.g+=(e.g-this.g)*l,this.b+=(e.b-this.b)*l,this}lerpColors(e,l,g){return this.r=e.r+(l.r-e.r)*g,this.g=e.g+(l.g-e.g)*g,this.b=e.b+(l.b-e.b)*g,this}lerpHSL(e,l){this.getHSL(cr),e.getHSL(gr);const g=jn(cr.h,gr.h,l),_=jn(cr.s,gr.s,l),M=jn(cr.l,gr.l,l);return this.setHSL(g,_,M),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,l=0){return this.r=e[l],this.g=e[l+1],this.b=e[l+2],this}toArray(e=[],l=0){return e[l]=this.r,e[l+1]=this.g,e[l+2]=this.b,e}fromBufferAttribute(e,l){return this.r=e.getX(l),this.g=e.getY(l),this.b=e.getZ(l),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}wn.NAMES=fn,wn.prototype.isColor=!0,wn.prototype.r=1,wn.prototype.g=1,wn.prototype.b=1;class ws extends Vi{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new wn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}ws.prototype.isMeshBasicMaterial=!0;const wr=new ie,Vs=new en;class Or{constructor(e,l,g){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=l,this.count=e!==void 0?e.length/l:0,this.normalized=g===!0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,l,g){e*=this.itemSize,g*=l.itemSize;for(let _=0,M=this.itemSize;_<M;_++)this.array[e+_]=l.array[g+_];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const l=this.array;let g=0;for(let _=0,M=e.length;_<M;_++){let P=e[_];P===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",_),P=new wn),l[g++]=P.r,l[g++]=P.g,l[g++]=P.b}return this}copyVector2sArray(e){const l=this.array;let g=0;for(let _=0,M=e.length;_<M;_++){let P=e[_];P===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",_),P=new en),l[g++]=P.x,l[g++]=P.y}return this}copyVector3sArray(e){const l=this.array;let g=0;for(let _=0,M=e.length;_<M;_++){let P=e[_];P===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",_),P=new ie),l[g++]=P.x,l[g++]=P.y,l[g++]=P.z}return this}copyVector4sArray(e){const l=this.array;let g=0;for(let _=0,M=e.length;_<M;_++){let P=e[_];P===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",_),P=new Dr),l[g++]=P.x,l[g++]=P.y,l[g++]=P.z,l[g++]=P.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let l=0,g=this.count;l<g;l++)Vs.fromBufferAttribute(this,l),Vs.applyMatrix3(e),this.setXY(l,Vs.x,Vs.y);else if(this.itemSize===3)for(let l=0,g=this.count;l<g;l++)wr.fromBufferAttribute(this,l),wr.applyMatrix3(e),this.setXYZ(l,wr.x,wr.y,wr.z);return this}applyMatrix4(e){for(let l=0,g=this.count;l<g;l++)wr.x=this.getX(l),wr.y=this.getY(l),wr.z=this.getZ(l),wr.applyMatrix4(e),this.setXYZ(l,wr.x,wr.y,wr.z);return this}applyNormalMatrix(e){for(let l=0,g=this.count;l<g;l++)wr.x=this.getX(l),wr.y=this.getY(l),wr.z=this.getZ(l),wr.applyNormalMatrix(e),this.setXYZ(l,wr.x,wr.y,wr.z);return this}transformDirection(e){for(let l=0,g=this.count;l<g;l++)wr.x=this.getX(l),wr.y=this.getY(l),wr.z=this.getZ(l),wr.transformDirection(e),this.setXYZ(l,wr.x,wr.y,wr.z);return this}set(e,l=0){return this.array.set(e,l),this}getX(e){return this.array[e*this.itemSize]}setX(e,l){return this.array[e*this.itemSize]=l,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,l){return this.array[e*this.itemSize+1]=l,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,l){return this.array[e*this.itemSize+2]=l,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,l){return this.array[e*this.itemSize+3]=l,this}setXY(e,l,g){return e*=this.itemSize,this.array[e+0]=l,this.array[e+1]=g,this}setXYZ(e,l,g,_){return e*=this.itemSize,this.array[e+0]=l,this.array[e+1]=g,this.array[e+2]=_,this}setXYZW(e,l,g,_,M){return e*=this.itemSize,this.array[e+0]=l,this.array[e+1]=g,this.array[e+2]=_,this.array[e+3]=M,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==35044&&(e.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(e.updateRange=this.updateRange),e}}Or.prototype.isBufferAttribute=!0;class ro extends Or{constructor(e,l,g){super(new Int8Array(e),l,g)}}class to extends Or{constructor(e,l,g){super(new Uint8Array(e),l,g)}}class Xs extends Or{constructor(e,l,g){super(new Uint8ClampedArray(e),l,g)}}class Ba extends Or{constructor(e,l,g){super(new Int16Array(e),l,g)}}class To extends Or{constructor(e,l,g){super(new Uint16Array(e),l,g)}}class hs extends Or{constructor(e,l,g){super(new Int32Array(e),l,g)}}class Is extends Or{constructor(e,l,g){super(new Uint32Array(e),l,g)}}class Yo extends Or{constructor(e,l,g){super(new Uint16Array(e),l,g)}}Yo.prototype.isFloat16BufferAttribute=!0;class Un extends Or{constructor(e,l,g){super(new Float32Array(e),l,g)}}class dl extends Or{constructor(e,l,g){super(new Float64Array(e),l,g)}}function fa(S){if(S.length===0)return-1/0;let e=S[0];for(let l=1,g=S.length;l<g;++l)S[l]>e&&(e=S[l]);return e}const Zl={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ma(S,e){return new Zl[S](e)}let pl=0;const ga=new nr,fl=new Ee,Nu=new ie,Ma=new ut,jo=new ut,Wo=new ie;class Pr extends Mt{constructor(){super(),Object.defineProperty(this,"id",{value:pl++}),this.uuid=_n(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(fa(e)>65535?Is:To)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,l){return this.attributes[e]=l,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,l,g=0){this.groups.push({start:e,count:l,materialIndex:g})}clearGroups(){this.groups=[]}setDrawRange(e,l){this.drawRange.start=e,this.drawRange.count=l}applyMatrix4(e){const l=this.attributes.position;l!==void 0&&(l.applyMatrix4(e),l.needsUpdate=!0);const g=this.attributes.normal;if(g!==void 0){const M=new Wn().getNormalMatrix(e);g.applyNormalMatrix(M),g.needsUpdate=!0}const _=this.attributes.tangent;return _!==void 0&&(_.transformDirection(e),_.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ga.makeRotationFromQuaternion(e),this.applyMatrix4(ga),this}rotateX(e){return ga.makeRotationX(e),this.applyMatrix4(ga),this}rotateY(e){return ga.makeRotationY(e),this.applyMatrix4(ga),this}rotateZ(e){return ga.makeRotationZ(e),this.applyMatrix4(ga),this}translate(e,l,g){return ga.makeTranslation(e,l,g),this.applyMatrix4(ga),this}scale(e,l,g){return ga.makeScale(e,l,g),this.applyMatrix4(ga),this}lookAt(e){return fl.lookAt(e),fl.updateMatrix(),this.applyMatrix4(fl.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Nu).negate(),this.translate(Nu.x,Nu.y,Nu.z),this}setFromPoints(e){const l=[];for(let g=0,_=e.length;g<_;g++){const M=e[g];l.push(M.x,M.y,M.z||0)}return this.setAttribute("position",new Un(l,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ut);const e=this.attributes.position,l=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ie(-1/0,-1/0,-1/0),new ie(1/0,1/0,1/0));if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),l)for(let g=0,_=l.length;g<_;g++){const M=l[g];Ma.setFromBufferAttribute(M),this.morphTargetsRelative?(Wo.addVectors(this.boundingBox.min,Ma.min),this.boundingBox.expandByPoint(Wo),Wo.addVectors(this.boundingBox.max,Ma.max),this.boundingBox.expandByPoint(Wo)):(this.boundingBox.expandByPoint(Ma.min),this.boundingBox.expandByPoint(Ma.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ns);const e=this.attributes.position,l=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ie,1/0);if(e){const g=this.boundingSphere.center;if(Ma.setFromBufferAttribute(e),l)for(let M=0,P=l.length;M<P;M++){const N=l[M];jo.setFromBufferAttribute(N),this.morphTargetsRelative?(Wo.addVectors(Ma.min,jo.min),Ma.expandByPoint(Wo),Wo.addVectors(Ma.max,jo.max),Ma.expandByPoint(Wo)):(Ma.expandByPoint(jo.min),Ma.expandByPoint(jo.max))}Ma.getCenter(g);let _=0;for(let M=0,P=e.count;M<P;M++)Wo.fromBufferAttribute(e,M),_=Math.max(_,g.distanceToSquared(Wo));if(l)for(let M=0,P=l.length;M<P;M++){const N=l[M],U=this.morphTargetsRelative;for(let G=0,K=N.count;G<K;G++)Wo.fromBufferAttribute(N,G),U&&(Nu.fromBufferAttribute(e,G),Wo.add(Nu)),_=Math.max(_,g.distanceToSquared(Wo))}this.boundingSphere.radius=Math.sqrt(_),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,l=this.attributes;if(e===null||l.position===void 0||l.normal===void 0||l.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const g=e.array,_=l.position.array,M=l.normal.array,P=l.uv.array,N=_.length/3;l.tangent===void 0&&this.setAttribute("tangent",new Or(new Float32Array(4*N),4));const U=l.tangent.array,G=[],K=[];for(let Li=0;Li<N;Li++)G[Li]=new ie,K[Li]=new ie;const Q=new ie,ne=new ie,oe=new ie,de=new en,xe=new en,Re=new en,we=new ie,nt=new ie;function xt(Li,ki,Zn){Q.fromArray(_,3*Li),ne.fromArray(_,3*ki),oe.fromArray(_,3*Zn),de.fromArray(P,2*Li),xe.fromArray(P,2*ki),Re.fromArray(P,2*Zn),ne.sub(Q),oe.sub(Q),xe.sub(de),Re.sub(de);const En=1/(xe.x*Re.y-Re.x*xe.y);isFinite(En)&&(we.copy(ne).multiplyScalar(Re.y).addScaledVector(oe,-xe.y).multiplyScalar(En),nt.copy(oe).multiplyScalar(xe.x).addScaledVector(ne,-Re.x).multiplyScalar(En),G[Li].add(we),G[ki].add(we),G[Zn].add(we),K[Li].add(nt),K[ki].add(nt),K[Zn].add(nt))}let ft=this.groups;ft.length===0&&(ft=[{start:0,count:g.length}]);for(let Li=0,ki=ft.length;Li<ki;++Li){const Zn=ft[Li],En=Zn.start;for(let Ji=En,In=En+Zn.count;Ji<In;Ji+=3)xt(g[Ji+0],g[Ji+1],g[Ji+2])}const Ht=new ie,Xt=new ie,_i=new ie,vi=new ie;function Bi(Li){_i.fromArray(M,3*Li),vi.copy(_i);const ki=G[Li];Ht.copy(ki),Ht.sub(_i.multiplyScalar(_i.dot(ki))).normalize(),Xt.crossVectors(vi,ki);const Zn=Xt.dot(K[Li])<0?-1:1;U[4*Li]=Ht.x,U[4*Li+1]=Ht.y,U[4*Li+2]=Ht.z,U[4*Li+3]=Zn}for(let Li=0,ki=ft.length;Li<ki;++Li){const Zn=ft[Li],En=Zn.start;for(let Ji=En,In=En+Zn.count;Ji<In;Ji+=3)Bi(g[Ji+0]),Bi(g[Ji+1]),Bi(g[Ji+2])}}computeVertexNormals(){const e=this.index,l=this.getAttribute("position");if(l!==void 0){let g=this.getAttribute("normal");if(g===void 0)g=new Or(new Float32Array(3*l.count),3),this.setAttribute("normal",g);else for(let ne=0,oe=g.count;ne<oe;ne++)g.setXYZ(ne,0,0,0);const _=new ie,M=new ie,P=new ie,N=new ie,U=new ie,G=new ie,K=new ie,Q=new ie;if(e)for(let ne=0,oe=e.count;ne<oe;ne+=3){const de=e.getX(ne+0),xe=e.getX(ne+1),Re=e.getX(ne+2);_.fromBufferAttribute(l,de),M.fromBufferAttribute(l,xe),P.fromBufferAttribute(l,Re),K.subVectors(P,M),Q.subVectors(_,M),K.cross(Q),N.fromBufferAttribute(g,de),U.fromBufferAttribute(g,xe),G.fromBufferAttribute(g,Re),N.add(K),U.add(K),G.add(K),g.setXYZ(de,N.x,N.y,N.z),g.setXYZ(xe,U.x,U.y,U.z),g.setXYZ(Re,G.x,G.y,G.z)}else for(let ne=0,oe=l.count;ne<oe;ne+=3)_.fromBufferAttribute(l,ne+0),M.fromBufferAttribute(l,ne+1),P.fromBufferAttribute(l,ne+2),K.subVectors(P,M),Q.subVectors(_,M),K.cross(Q),g.setXYZ(ne+0,K.x,K.y,K.z),g.setXYZ(ne+1,K.x,K.y,K.z),g.setXYZ(ne+2,K.x,K.y,K.z);this.normalizeNormals(),g.needsUpdate=!0}}merge(e,l){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);l===void 0&&(l=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const g=this.attributes;for(const _ in g){if(e.attributes[_]===void 0)continue;const M=g[_].array,P=e.attributes[_],N=P.array,U=P.itemSize*l,G=Math.min(N.length,M.length-U);for(let K=0,Q=U;K<G;K++,Q++)M[Q]=N[K]}return this}normalizeNormals(){const e=this.attributes.normal;for(let l=0,g=e.count;l<g;l++)Wo.fromBufferAttribute(e,l),Wo.normalize(),e.setXYZ(l,Wo.x,Wo.y,Wo.z)}toNonIndexed(){function e(N,U){const G=N.array,K=N.itemSize,Q=N.normalized,ne=new G.constructor(U.length*K);let oe=0,de=0;for(let xe=0,Re=U.length;xe<Re;xe++){oe=N.isInterleavedBufferAttribute?U[xe]*N.data.stride+N.offset:U[xe]*K;for(let we=0;we<K;we++)ne[de++]=G[oe++]}return new Or(ne,K,Q)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const l=new Pr,g=this.index.array,_=this.attributes;for(const N in _){const U=e(_[N],g);l.setAttribute(N,U)}const M=this.morphAttributes;for(const N in M){const U=[],G=M[N];for(let K=0,Q=G.length;K<Q;K++){const ne=e(G[K],g);U.push(ne)}l.morphAttributes[N]=U}l.morphTargetsRelative=this.morphTargetsRelative;const P=this.groups;for(let N=0,U=P.length;N<U;N++){const G=P[N];l.addGroup(G.start,G.count,G.materialIndex)}return l}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const U=this.parameters;for(const G in U)U[G]!==void 0&&(e[G]=U[G]);return e}e.data={attributes:{}};const l=this.index;l!==null&&(e.data.index={type:l.array.constructor.name,array:Array.prototype.slice.call(l.array)});const g=this.attributes;for(const U in g){const G=g[U];e.data.attributes[U]=G.toJSON(e.data)}const _={};let M=!1;for(const U in this.morphAttributes){const G=this.morphAttributes[U],K=[];for(let Q=0,ne=G.length;Q<ne;Q++){const oe=G[Q];K.push(oe.toJSON(e.data))}K.length>0&&(_[U]=K,M=!0)}M&&(e.data.morphAttributes=_,e.data.morphTargetsRelative=this.morphTargetsRelative);const P=this.groups;P.length>0&&(e.data.groups=JSON.parse(JSON.stringify(P)));const N=this.boundingSphere;return N!==null&&(e.data.boundingSphere={center:N.center.toArray(),radius:N.radius}),e}clone(){return new Pr().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const l={};this.name=e.name;const g=e.index;g!==null&&this.setIndex(g.clone(l));const _=e.attributes;for(const G in _){const K=_[G];this.setAttribute(G,K.clone(l))}const M=e.morphAttributes;for(const G in M){const K=[],Q=M[G];for(let ne=0,oe=Q.length;ne<oe;ne++)K.push(Q[ne].clone(l));this.morphAttributes[G]=K}this.morphTargetsRelative=e.morphTargetsRelative;const P=e.groups;for(let G=0,K=P.length;G<K;G++){const Q=P[G];this.addGroup(Q.start,Q.count,Q.materialIndex)}const N=e.boundingBox;N!==null&&(this.boundingBox=N.clone());const U=e.boundingSphere;return U!==null&&(this.boundingSphere=U.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}Pr.prototype.isBufferGeometry=!0;const Vp=new nr,ml=new na,yc=new Ns,vc=new ie,Ka=new ie,Sa=new ie,Gp=new ie,xc=new ie,Ld=new ie,tu=new ie,sa=new ie,Ir=new ie,Xn=new en,Uu=new en,hr=new en,kh=new ie,bc=new ie;class qn extends Ee{constructor(e=new Pr,l=new ws){super(),this.type="Mesh",this.geometry=e,this.material=l,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const l=e.morphAttributes,g=Object.keys(l);if(g.length>0){const _=l[g[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let M=0,P=_.length;M<P;M++){const N=_[M].name||String(M);this.morphTargetInfluences.push(0),this.morphTargetDictionary[N]=M}}}}else{const l=e.morphTargets;l!==void 0&&l.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,l){const g=this.geometry,_=this.material,M=this.matrixWorld;if(_===void 0||(g.boundingSphere===null&&g.computeBoundingSphere(),yc.copy(g.boundingSphere),yc.applyMatrix4(M),e.ray.intersectsSphere(yc)===!1)||(Vp.copy(M).invert(),ml.copy(e.ray).applyMatrix4(Vp),g.boundingBox!==null&&ml.intersectsBox(g.boundingBox)===!1))return;let P;if(g.isBufferGeometry){const N=g.index,U=g.attributes.position,G=g.morphAttributes.position,K=g.morphTargetsRelative,Q=g.attributes.uv,ne=g.attributes.uv2,oe=g.groups,de=g.drawRange;if(N!==null)if(Array.isArray(_))for(let xe=0,Re=oe.length;xe<Re;xe++){const we=oe[xe],nt=_[we.materialIndex];for(let xt=Math.max(we.start,de.start),ft=Math.min(we.start+we.count,de.start+de.count);xt<ft;xt+=3){const Ht=N.getX(xt),Xt=N.getX(xt+1),_i=N.getX(xt+2);P=Vu(this,nt,e,ml,U,G,K,Q,ne,Ht,Xt,_i),P&&(P.faceIndex=Math.floor(xt/3),P.face.materialIndex=we.materialIndex,l.push(P))}}else for(let xe=Math.max(0,de.start),Re=Math.min(N.count,de.start+de.count);xe<Re;xe+=3){const we=N.getX(xe),nt=N.getX(xe+1),xt=N.getX(xe+2);P=Vu(this,_,e,ml,U,G,K,Q,ne,we,nt,xt),P&&(P.faceIndex=Math.floor(xe/3),l.push(P))}else if(U!==void 0)if(Array.isArray(_))for(let xe=0,Re=oe.length;xe<Re;xe++){const we=oe[xe],nt=_[we.materialIndex];for(let xt=Math.max(we.start,de.start),ft=Math.min(we.start+we.count,de.start+de.count);xt<ft;xt+=3)P=Vu(this,nt,e,ml,U,G,K,Q,ne,xt,xt+1,xt+2),P&&(P.faceIndex=Math.floor(xt/3),P.face.materialIndex=we.materialIndex,l.push(P))}else for(let xe=Math.max(0,de.start),Re=Math.min(U.count,de.start+de.count);xe<Re;xe+=3)P=Vu(this,_,e,ml,U,G,K,Q,ne,xe,xe+1,xe+2),P&&(P.faceIndex=Math.floor(xe/3),l.push(P))}else g.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Vu(S,e,l,g,_,M,P,N,U,G,K,Q){vc.fromBufferAttribute(_,G),Ka.fromBufferAttribute(_,K),Sa.fromBufferAttribute(_,Q);const ne=S.morphTargetInfluences;if(M&&ne){tu.set(0,0,0),sa.set(0,0,0),Ir.set(0,0,0);for(let de=0,xe=M.length;de<xe;de++){const Re=ne[de],we=M[de];Re!==0&&(Gp.fromBufferAttribute(we,G),xc.fromBufferAttribute(we,K),Ld.fromBufferAttribute(we,Q),P?(tu.addScaledVector(Gp,Re),sa.addScaledVector(xc,Re),Ir.addScaledVector(Ld,Re)):(tu.addScaledVector(Gp.sub(vc),Re),sa.addScaledVector(xc.sub(Ka),Re),Ir.addScaledVector(Ld.sub(Sa),Re)))}vc.add(tu),Ka.add(sa),Sa.add(Ir)}S.isSkinnedMesh&&(S.boneTransform(G,vc),S.boneTransform(K,Ka),S.boneTransform(Q,Sa));const oe=function(de,xe,Re,we,nt,xt,ft,Ht){let Xt;if(Xt=xe.side===1?we.intersectTriangle(ft,xt,nt,!0,Ht):we.intersectTriangle(nt,xt,ft,xe.side!==2,Ht),Xt===null)return null;bc.copy(Ht),bc.applyMatrix4(de.matrixWorld);const _i=Re.ray.origin.distanceTo(bc);return _i<Re.near||_i>Re.far?null:{distance:_i,point:bc.clone(),object:de}}(S,e,l,g,vc,Ka,Sa,kh);if(oe){N&&(Xn.fromBufferAttribute(N,G),Uu.fromBufferAttribute(N,K),hr.fromBufferAttribute(N,Q),oe.uv=Ei.getUV(kh,vc,Ka,Sa,Xn,Uu,hr,new en)),U&&(Xn.fromBufferAttribute(U,G),Uu.fromBufferAttribute(U,K),hr.fromBufferAttribute(U,Q),oe.uv2=Ei.getUV(kh,vc,Ka,Sa,Xn,Uu,hr,new en));const de={a:G,b:K,c:Q,normal:new ie,materialIndex:0};Ei.getNormal(vc,Ka,Sa,de.normal),oe.face=de}return oe}qn.prototype.isMesh=!0;class Ja extends Pr{constructor(e=1,l=1,g=1,_=1,M=1,P=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:l,depth:g,widthSegments:_,heightSegments:M,depthSegments:P};const N=this;_=Math.floor(_),M=Math.floor(M),P=Math.floor(P);const U=[],G=[],K=[],Q=[];let ne=0,oe=0;function de(xe,Re,we,nt,xt,ft,Ht,Xt,_i,vi,Bi){const Li=ft/_i,ki=Ht/vi,Zn=ft/2,En=Ht/2,Ji=Xt/2,In=_i+1,ir=vi+1;let rr=0,vr=0;const kr=new ie;for(let Fr=0;Fr<ir;Fr++){const Rn=Fr*ki-En;for(let qt=0;qt<In;qt++){const ti=qt*Li-Zn;kr[xe]=ti*nt,kr[Re]=Rn*xt,kr[we]=Ji,G.push(kr.x,kr.y,kr.z),kr[xe]=0,kr[Re]=0,kr[we]=Xt>0?1:-1,K.push(kr.x,kr.y,kr.z),Q.push(qt/_i),Q.push(1-Fr/vi),rr+=1}}for(let Fr=0;Fr<vi;Fr++)for(let Rn=0;Rn<_i;Rn++){const qt=ne+Rn+In*Fr,ti=ne+Rn+In*(Fr+1),Qi=ne+(Rn+1)+In*(Fr+1),ji=ne+(Rn+1)+In*Fr;U.push(qt,ti,ji),U.push(ti,Qi,ji),vr+=6}N.addGroup(oe,vr,Bi),oe+=vr,ne+=rr}de("z","y","x",-1,-1,g,l,e,P,M,0),de("z","y","x",1,-1,g,l,-e,P,M,1),de("x","z","y",1,1,e,g,l,_,P,2),de("x","z","y",1,-1,e,g,-l,_,P,3),de("x","y","z",1,-1,e,l,g,_,M,4),de("x","y","z",-1,-1,e,l,-g,_,M,5),this.setIndex(U),this.setAttribute("position",new Un(G,3)),this.setAttribute("normal",new Un(K,3)),this.setAttribute("uv",new Un(Q,2))}static fromJSON(e){return new Ja(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function wc(S){const e={};for(const l in S){e[l]={};for(const g in S[l]){const _=S[l][g];_&&(_.isColor||_.isMatrix3||_.isMatrix4||_.isVector2||_.isVector3||_.isVector4||_.isTexture||_.isQuaternion)?e[l][g]=_.clone():Array.isArray(_)?e[l][g]=_.slice():e[l][g]=_}}return e}function go(S){const e={};for(let l=0;l<S.length;l++){const g=wc(S[l]);for(const _ in g)e[_]=g[_]}return e}const Tc={clone:wc,merge:go};class ao extends Vi{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=wc(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const l=super.toJSON(e);l.glslVersion=this.glslVersion,l.uniforms={};for(const _ in this.uniforms){const M=this.uniforms[_].value;M&&M.isTexture?l.uniforms[_]={type:"t",value:M.toJSON(e).uuid}:M&&M.isColor?l.uniforms[_]={type:"c",value:M.getHex()}:M&&M.isVector2?l.uniforms[_]={type:"v2",value:M.toArray()}:M&&M.isVector3?l.uniforms[_]={type:"v3",value:M.toArray()}:M&&M.isVector4?l.uniforms[_]={type:"v4",value:M.toArray()}:M&&M.isMatrix3?l.uniforms[_]={type:"m3",value:M.toArray()}:M&&M.isMatrix4?l.uniforms[_]={type:"m4",value:M.toArray()}:l.uniforms[_]={value:M}}Object.keys(this.defines).length>0&&(l.defines=this.defines),l.vertexShader=this.vertexShader,l.fragmentShader=this.fragmentShader;const g={};for(const _ in this.extensions)this.extensions[_]===!0&&(g[_]=!0);return Object.keys(g).length>0&&(l.extensions=g),l}}ao.prototype.isShaderMaterial=!0;class Mc extends Ee{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new nr,this.projectionMatrix=new nr,this.projectionMatrixInverse=new nr}copy(e,l){return super.copy(e,l),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return e.set(-l[8],-l[9],-l[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,l){super.updateWorldMatrix(e,l),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}Mc.prototype.isCamera=!0;class _o extends Mc{constructor(e=50,l=1,g=.1,_=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=g,this.far=_,this.focus=10,this.aspect=l,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,l){return super.copy(e,l),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const l=.5*this.getFilmHeight()/e;this.fov=2*cn*Math.atan(l),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*an*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*cn*Math.atan(Math.tan(.5*an*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,l,g,_,M,P){this.aspect=e/l,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=l,this.view.offsetX=g,this.view.offsetY=_,this.view.width=M,this.view.height=P,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let l=e*Math.tan(.5*an*this.fov)/this.zoom,g=2*l,_=this.aspect*g,M=-.5*_;const P=this.view;if(this.view!==null&&this.view.enabled){const U=P.fullWidth,G=P.fullHeight;M+=P.offsetX*_/U,l-=P.offsetY*g/G,_*=P.width/U,g*=P.height/G}const N=this.filmOffset;N!==0&&(M+=e*N/this.getFilmWidth()),this.projectionMatrix.makePerspective(M,M+_,l,l-g,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const l=super.toJSON(e);return l.object.fov=this.fov,l.object.zoom=this.zoom,l.object.near=this.near,l.object.far=this.far,l.object.focus=this.focus,l.object.aspect=this.aspect,this.view!==null&&(l.object.view=Object.assign({},this.view)),l.object.filmGauge=this.filmGauge,l.object.filmOffset=this.filmOffset,l}}_o.prototype.isPerspectiveCamera=!0;const gl=90;class iu extends Ee{constructor(e,l,g){if(super(),this.type="CubeCamera",g.isWebGLCubeRenderTarget!==!0)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=g;const _=new _o(gl,1,e,l);_.layers=this.layers,_.up.set(0,-1,0),_.lookAt(new ie(1,0,0)),this.add(_);const M=new _o(gl,1,e,l);M.layers=this.layers,M.up.set(0,-1,0),M.lookAt(new ie(-1,0,0)),this.add(M);const P=new _o(gl,1,e,l);P.layers=this.layers,P.up.set(0,0,1),P.lookAt(new ie(0,1,0)),this.add(P);const N=new _o(gl,1,e,l);N.layers=this.layers,N.up.set(0,0,-1),N.lookAt(new ie(0,-1,0)),this.add(N);const U=new _o(gl,1,e,l);U.layers=this.layers,U.up.set(0,-1,0),U.lookAt(new ie(0,0,1)),this.add(U);const G=new _o(gl,1,e,l);G.layers=this.layers,G.up.set(0,-1,0),G.lookAt(new ie(0,0,-1)),this.add(G)}update(e,l){this.parent===null&&this.updateMatrixWorld();const g=this.renderTarget,[_,M,P,N,U,G]=this.children,K=e.xr.enabled,Q=e.getRenderTarget();e.xr.enabled=!1;const ne=g.texture.generateMipmaps;g.texture.generateMipmaps=!1,e.setRenderTarget(g,0),e.render(l,_),e.setRenderTarget(g,1),e.render(l,M),e.setRenderTarget(g,2),e.render(l,P),e.setRenderTarget(g,3),e.render(l,N),e.setRenderTarget(g,4),e.render(l,U),g.texture.generateMipmaps=ne,e.setRenderTarget(g,5),e.render(l,G),e.setRenderTarget(Q),e.xr.enabled=K}}class Ea extends _s{constructor(e,l,g,_,M,P,N,U,G,K){super(e=e!==void 0?e:[],l=l!==void 0?l:301,g,_,M,P,N=N!==void 0?N:1022,U,G,K),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ea.prototype.isCubeTexture=!0;class Ys extends no{constructor(e,l,g){Number.isInteger(l)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),l=g),super(e,e,l),l=l||{},this.texture=new Ea(void 0,l.mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,l.format,l.type,l.anisotropy,l.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=l.generateMipmaps!==void 0&&l.generateMipmaps,this.texture.minFilter=l.minFilter!==void 0?l.minFilter:1006,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,l){this.texture.type=l.type,this.texture.format=1023,this.texture.encoding=l.encoding,this.texture.generateMipmaps=l.generateMipmaps,this.texture.minFilter=l.minFilter,this.texture.magFilter=l.magFilter;const g={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},_=new Ja(5,5,5),M=new ao({name:"CubemapFromEquirect",uniforms:wc(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,side:1,blending:0});M.uniforms.tEquirect.value=l;const P=new qn(_,M),N=l.minFilter;return l.minFilter===1008&&(l.minFilter=1006),new iu(1,10,this).update(e,P),l.minFilter=N,P.geometry.dispose(),P.material.dispose(),this}clear(e,l,g,_){const M=e.getRenderTarget();for(let P=0;P<6;P++)e.setRenderTarget(this,P),e.clear(l,g,_);e.setRenderTarget(M)}}Ys.prototype.isWebGLCubeRenderTarget=!0;const Fh=new ie,un=new ie,om=new Wn;class _a{constructor(e=new ie(1,0,0),l=0){this.normal=e,this.constant=l}set(e,l){return this.normal.copy(e),this.constant=l,this}setComponents(e,l,g,_){return this.normal.set(e,l,g),this.constant=_,this}setFromNormalAndCoplanarPoint(e,l){return this.normal.copy(e),this.constant=-l.dot(this.normal),this}setFromCoplanarPoints(e,l,g){const _=Fh.subVectors(g,l).cross(un.subVectors(e,l)).normalize();return this.setFromNormalAndCoplanarPoint(_,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,l){return l.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,l){const g=e.delta(Fh),_=this.normal.dot(g);if(_===0)return this.distanceToPoint(e.start)===0?l.copy(e.start):null;const M=-(e.start.dot(this.normal)+this.constant)/_;return M<0||M>1?null:l.copy(g).multiplyScalar(M).add(e.start)}intersectsLine(e){const l=this.distanceToPoint(e.start),g=this.distanceToPoint(e.end);return l<0&&g>0||g<0&&l>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,l){const g=l||om.getNormalMatrix(e),_=this.coplanarPoint(Fh).applyMatrix4(e),M=this.normal.applyMatrix3(g).normalize();return this.constant=-_.dot(M),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}_a.prototype.isPlane=!0;const Xl=new Ns,nu=new ie;class Sc{constructor(e=new _a,l=new _a,g=new _a,_=new _a,M=new _a,P=new _a){this.planes=[e,l,g,_,M,P]}set(e,l,g,_,M,P){const N=this.planes;return N[0].copy(e),N[1].copy(l),N[2].copy(g),N[3].copy(_),N[4].copy(M),N[5].copy(P),this}copy(e){const l=this.planes;for(let g=0;g<6;g++)l[g].copy(e.planes[g]);return this}setFromProjectionMatrix(e){const l=this.planes,g=e.elements,_=g[0],M=g[1],P=g[2],N=g[3],U=g[4],G=g[5],K=g[6],Q=g[7],ne=g[8],oe=g[9],de=g[10],xe=g[11],Re=g[12],we=g[13],nt=g[14],xt=g[15];return l[0].setComponents(N-_,Q-U,xe-ne,xt-Re).normalize(),l[1].setComponents(N+_,Q+U,xe+ne,xt+Re).normalize(),l[2].setComponents(N+M,Q+G,xe+oe,xt+we).normalize(),l[3].setComponents(N-M,Q-G,xe-oe,xt-we).normalize(),l[4].setComponents(N-P,Q-K,xe-de,xt-nt).normalize(),l[5].setComponents(N+P,Q+K,xe+de,xt+nt).normalize(),this}intersectsObject(e){const l=e.geometry;return l.boundingSphere===null&&l.computeBoundingSphere(),Xl.copy(l.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Xl)}intersectsSprite(e){return Xl.center.set(0,0,0),Xl.radius=.7071067811865476,Xl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Xl)}intersectsSphere(e){const l=this.planes,g=e.center,_=-e.radius;for(let M=0;M<6;M++)if(l[M].distanceToPoint(g)<_)return!1;return!0}intersectsBox(e){const l=this.planes;for(let g=0;g<6;g++){const _=l[g];if(nu.x=_.normal.x>0?e.max.x:e.min.x,nu.y=_.normal.y>0?e.max.y:e.min.y,nu.z=_.normal.z>0?e.max.z:e.min.z,_.distanceToPoint(nu)<0)return!1}return!0}containsPoint(e){const l=this.planes;for(let g=0;g<6;g++)if(l[g].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function kl(){let S=null,e=!1,l=null,g=null;function _(M,P){l(M,P),g=S.requestAnimationFrame(_)}return{start:function(){e!==!0&&l!==null&&(g=S.requestAnimationFrame(_),e=!0)},stop:function(){S.cancelAnimationFrame(g),e=!1},setAnimationLoop:function(M){l=M},setContext:function(M){S=M}}}function Hp(S,e){const l=e.isWebGL2,g=new WeakMap;return{get:function(_){return _.isInterleavedBufferAttribute&&(_=_.data),g.get(_)},remove:function(_){_.isInterleavedBufferAttribute&&(_=_.data);const M=g.get(_);M&&(S.deleteBuffer(M.buffer),g.delete(_))},update:function(_,M){if(_.isGLBufferAttribute){const N=g.get(_);return void((!N||N.version<_.version)&&g.set(_,{buffer:_.buffer,type:_.type,bytesPerElement:_.elementSize,version:_.version}))}_.isInterleavedBufferAttribute&&(_=_.data);const P=g.get(_);P===void 0?g.set(_,function(N,U){const G=N.array,K=N.usage,Q=S.createBuffer();S.bindBuffer(U,Q),S.bufferData(U,G,K),N.onUploadCallback();let ne=5126;return G instanceof Float32Array?ne=5126:G instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):G instanceof Uint16Array?N.isFloat16BufferAttribute?l?ne=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):ne=5123:G instanceof Int16Array?ne=5122:G instanceof Uint32Array?ne=5125:G instanceof Int32Array?ne=5124:G instanceof Int8Array?ne=5120:(G instanceof Uint8Array||G instanceof Uint8ClampedArray)&&(ne=5121),{buffer:Q,type:ne,bytesPerElement:G.BYTES_PER_ELEMENT,version:N.version}}(_,M)):P.version<_.version&&(function(N,U,G){const K=U.array,Q=U.updateRange;S.bindBuffer(G,N),Q.count===-1?S.bufferSubData(G,0,K):(l?S.bufferSubData(G,Q.offset*K.BYTES_PER_ELEMENT,K,Q.offset,Q.count):S.bufferSubData(G,Q.offset*K.BYTES_PER_ELEMENT,K.subarray(Q.offset,Q.offset+Q.count)),Q.count=-1)}(P.buffer,_,M),P.version=_.version)}}}class No extends Pr{constructor(e=1,l=1,g=1,_=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:l,widthSegments:g,heightSegments:_};const M=e/2,P=l/2,N=Math.floor(g),U=Math.floor(_),G=N+1,K=U+1,Q=e/N,ne=l/U,oe=[],de=[],xe=[],Re=[];for(let we=0;we<K;we++){const nt=we*ne-P;for(let xt=0;xt<G;xt++){const ft=xt*Q-M;de.push(ft,-nt,0),xe.push(0,0,1),Re.push(xt/N),Re.push(1-we/U)}}for(let we=0;we<U;we++)for(let nt=0;nt<N;nt++){const xt=nt+G*we,ft=nt+G*(we+1),Ht=nt+1+G*(we+1),Xt=nt+1+G*we;oe.push(xt,ft,Xt),oe.push(ft,Ht,Xt)}this.setIndex(oe),this.setAttribute("position",new Un(de,3)),this.setAttribute("normal",new Un(xe,3)),this.setAttribute("uv",new Un(Re,2))}static fromJSON(e){return new No(e.width,e.height,e.widthSegments,e.heightSegments)}}const os={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotVH = saturate( dot( geometry.viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float NoH ) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float NoV, float NoL ) {
	return saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );
}
vec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in GeometricContext geometry ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularTintFactor = specularTint;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARTINTMAP
			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularTintFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenTint = sheenTint;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenTint;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationTint, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = transmission.a;
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationTint;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularTint;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARTINTMAP
		uniform sampler2D specularTintMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenTint;
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},Qn={common:{diffuse:{value:new wn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Wn},uv2Transform:{value:new Wn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new en(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new wn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new wn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wn}},sprite:{diffuse:{value:new wn(16777215)},opacity:{value:1},center:{value:new en(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wn}}},Qa={basic:{uniforms:go([Qn.common,Qn.specularmap,Qn.envmap,Qn.aomap,Qn.lightmap,Qn.fog]),vertexShader:os.meshbasic_vert,fragmentShader:os.meshbasic_frag},lambert:{uniforms:go([Qn.common,Qn.specularmap,Qn.envmap,Qn.aomap,Qn.lightmap,Qn.emissivemap,Qn.fog,Qn.lights,{emissive:{value:new wn(0)}}]),vertexShader:os.meshlambert_vert,fragmentShader:os.meshlambert_frag},phong:{uniforms:go([Qn.common,Qn.specularmap,Qn.envmap,Qn.aomap,Qn.lightmap,Qn.emissivemap,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,Qn.fog,Qn.lights,{emissive:{value:new wn(0)},specular:{value:new wn(1118481)},shininess:{value:30}}]),vertexShader:os.meshphong_vert,fragmentShader:os.meshphong_frag},standard:{uniforms:go([Qn.common,Qn.envmap,Qn.aomap,Qn.lightmap,Qn.emissivemap,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,Qn.roughnessmap,Qn.metalnessmap,Qn.fog,Qn.lights,{emissive:{value:new wn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:os.meshphysical_vert,fragmentShader:os.meshphysical_frag},toon:{uniforms:go([Qn.common,Qn.aomap,Qn.lightmap,Qn.emissivemap,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,Qn.gradientmap,Qn.fog,Qn.lights,{emissive:{value:new wn(0)}}]),vertexShader:os.meshtoon_vert,fragmentShader:os.meshtoon_frag},matcap:{uniforms:go([Qn.common,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,Qn.fog,{matcap:{value:null}}]),vertexShader:os.meshmatcap_vert,fragmentShader:os.meshmatcap_frag},points:{uniforms:go([Qn.points,Qn.fog]),vertexShader:os.points_vert,fragmentShader:os.points_frag},dashed:{uniforms:go([Qn.common,Qn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:os.linedashed_vert,fragmentShader:os.linedashed_frag},depth:{uniforms:go([Qn.common,Qn.displacementmap]),vertexShader:os.depth_vert,fragmentShader:os.depth_frag},normal:{uniforms:go([Qn.common,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,{opacity:{value:1}}]),vertexShader:os.meshnormal_vert,fragmentShader:os.meshnormal_frag},sprite:{uniforms:go([Qn.sprite,Qn.fog]),vertexShader:os.sprite_vert,fragmentShader:os.sprite_frag},background:{uniforms:{uvTransform:{value:new Wn},t2D:{value:null}},vertexShader:os.background_vert,fragmentShader:os.background_frag},cube:{uniforms:go([Qn.envmap,{opacity:{value:1}}]),vertexShader:os.cube_vert,fragmentShader:os.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:os.equirect_vert,fragmentShader:os.equirect_frag},distanceRGBA:{uniforms:go([Qn.common,Qn.displacementmap,{referencePosition:{value:new ie},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:os.distanceRGBA_vert,fragmentShader:os.distanceRGBA_frag},shadow:{uniforms:go([Qn.lights,Qn.fog,{color:{value:new wn(0)},opacity:{value:1}}]),vertexShader:os.shadow_vert,fragmentShader:os.shadow_frag}};function am(S,e,l,g,_){const M=new wn(0);let P,N,U=0,G=null,K=0,Q=null;function ne(oe,de){l.buffers.color.setClear(oe.r,oe.g,oe.b,de,_)}return{getClearColor:function(){return M},setClearColor:function(oe,de=1){M.set(oe),U=de,ne(M,U)},getClearAlpha:function(){return U},setClearAlpha:function(oe){U=oe,ne(M,U)},render:function(oe,de){let xe=!1,Re=de.isScene===!0?de.background:null;Re&&Re.isTexture&&(Re=e.get(Re));const we=S.xr,nt=we.getSession&&we.getSession();nt&&nt.environmentBlendMode==="additive"&&(Re=null),Re===null?ne(M,U):Re&&Re.isColor&&(ne(Re,1),xe=!0),(S.autoClear||xe)&&S.clear(S.autoClearColor,S.autoClearDepth,S.autoClearStencil),Re&&(Re.isCubeTexture||Re.mapping===306)?(N===void 0&&(N=new qn(new Ja(1,1,1),new ao({name:"BackgroundCubeMaterial",uniforms:wc(Qa.cube.uniforms),vertexShader:Qa.cube.vertexShader,fragmentShader:Qa.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),N.geometry.deleteAttribute("normal"),N.geometry.deleteAttribute("uv"),N.onBeforeRender=function(xt,ft,Ht){this.matrixWorld.copyPosition(Ht.matrixWorld)},Object.defineProperty(N.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),g.update(N)),N.material.uniforms.envMap.value=Re,N.material.uniforms.flipEnvMap.value=Re.isCubeTexture&&Re.isRenderTargetTexture===!1?-1:1,G===Re&&K===Re.version&&Q===S.toneMapping||(N.material.needsUpdate=!0,G=Re,K=Re.version,Q=S.toneMapping),oe.unshift(N,N.geometry,N.material,0,0,null)):Re&&Re.isTexture&&(P===void 0&&(P=new qn(new No(2,2),new ao({name:"BackgroundMaterial",uniforms:wc(Qa.background.uniforms),vertexShader:Qa.background.vertexShader,fragmentShader:Qa.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),Object.defineProperty(P.material,"map",{get:function(){return this.uniforms.t2D.value}}),g.update(P)),P.material.uniforms.t2D.value=Re,Re.matrixAutoUpdate===!0&&Re.updateMatrix(),P.material.uniforms.uvTransform.value.copy(Re.matrix),G===Re&&K===Re.version&&Q===S.toneMapping||(P.material.needsUpdate=!0,G=Re,K=Re.version,Q=S.toneMapping),oe.unshift(P,P.geometry,P.material,0,0,null))}}}function Na(S,e,l,g){const _=S.getParameter(34921),M=g.isWebGL2?null:e.get("OES_vertex_array_object"),P=g.isWebGL2||M!==null,N={},U=ne(null);let G=U;function K(ft){return g.isWebGL2?S.bindVertexArray(ft):M.bindVertexArrayOES(ft)}function Q(ft){return g.isWebGL2?S.deleteVertexArray(ft):M.deleteVertexArrayOES(ft)}function ne(ft){const Ht=[],Xt=[],_i=[];for(let vi=0;vi<_;vi++)Ht[vi]=0,Xt[vi]=0,_i[vi]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ht,enabledAttributes:Xt,attributeDivisors:_i,object:ft,attributes:{},index:null}}function oe(){const ft=G.newAttributes;for(let Ht=0,Xt=ft.length;Ht<Xt;Ht++)ft[Ht]=0}function de(ft){xe(ft,0)}function xe(ft,Ht){const Xt=G.newAttributes,_i=G.enabledAttributes,vi=G.attributeDivisors;Xt[ft]=1,_i[ft]===0&&(S.enableVertexAttribArray(ft),_i[ft]=1),vi[ft]!==Ht&&((g.isWebGL2?S:e.get("ANGLE_instanced_arrays"))[g.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ft,Ht),vi[ft]=Ht)}function Re(){const ft=G.newAttributes,Ht=G.enabledAttributes;for(let Xt=0,_i=Ht.length;Xt<_i;Xt++)Ht[Xt]!==ft[Xt]&&(S.disableVertexAttribArray(Xt),Ht[Xt]=0)}function we(ft,Ht,Xt,_i,vi,Bi){g.isWebGL2!==!0||Xt!==5124&&Xt!==5125?S.vertexAttribPointer(ft,Ht,Xt,_i,vi,Bi):S.vertexAttribIPointer(ft,Ht,Xt,vi,Bi)}function nt(){xt(),G!==U&&(G=U,K(G.object))}function xt(){U.geometry=null,U.program=null,U.wireframe=!1}return{setup:function(ft,Ht,Xt,_i,vi){let Bi=!1;if(P){const Li=function(ki,Zn,En){const Ji=En.wireframe===!0;let In=N[ki.id];In===void 0&&(In={},N[ki.id]=In);let ir=In[Zn.id];ir===void 0&&(ir={},In[Zn.id]=ir);let rr=ir[Ji];return rr===void 0&&(rr=ne(g.isWebGL2?S.createVertexArray():M.createVertexArrayOES()),ir[Ji]=rr),rr}(_i,Xt,Ht);G!==Li&&(G=Li,K(G.object)),Bi=function(ki,Zn){const En=G.attributes,Ji=ki.attributes;let In=0;for(const ir in Ji){const rr=En[ir],vr=Ji[ir];if(rr===void 0||rr.attribute!==vr||rr.data!==vr.data)return!0;In++}return G.attributesNum!==In||G.index!==Zn}(_i,vi),Bi&&function(ki,Zn){const En={},Ji=ki.attributes;let In=0;for(const ir in Ji){const rr=Ji[ir],vr={};vr.attribute=rr,rr.data&&(vr.data=rr.data),En[ir]=vr,In++}G.attributes=En,G.attributesNum=In,G.index=Zn}(_i,vi)}else{const Li=Ht.wireframe===!0;G.geometry===_i.id&&G.program===Xt.id&&G.wireframe===Li||(G.geometry=_i.id,G.program=Xt.id,G.wireframe=Li,Bi=!0)}ft.isInstancedMesh===!0&&(Bi=!0),vi!==null&&l.update(vi,34963),Bi&&(function(Li,ki,Zn,En){if(g.isWebGL2===!1&&(Li.isInstancedMesh||En.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;oe();const Ji=En.attributes,In=Zn.getAttributes(),ir=ki.defaultAttributeValues;for(const rr in In){const vr=In[rr];if(vr.location>=0){let kr=Ji[rr];if(kr===void 0&&(rr==="instanceMatrix"&&Li.instanceMatrix&&(kr=Li.instanceMatrix),rr==="instanceColor"&&Li.instanceColor&&(kr=Li.instanceColor)),kr!==void 0){const Fr=kr.normalized,Rn=kr.itemSize,qt=l.get(kr);if(qt===void 0)continue;const ti=qt.buffer,Qi=qt.type,ji=qt.bytesPerElement;if(kr.isInterleavedBufferAttribute){const Oi=kr.data,Nn=Oi.stride,Hn=kr.offset;if(Oi&&Oi.isInstancedInterleavedBuffer){for(let Ni=0;Ni<vr.locationSize;Ni++)xe(vr.location+Ni,Oi.meshPerAttribute);Li.isInstancedMesh!==!0&&En._maxInstanceCount===void 0&&(En._maxInstanceCount=Oi.meshPerAttribute*Oi.count)}else for(let Ni=0;Ni<vr.locationSize;Ni++)de(vr.location+Ni);S.bindBuffer(34962,ti);for(let Ni=0;Ni<vr.locationSize;Ni++)we(vr.location+Ni,Rn/vr.locationSize,Qi,Fr,Nn*ji,(Hn+Rn/vr.locationSize*Ni)*ji)}else{if(kr.isInstancedBufferAttribute){for(let Oi=0;Oi<vr.locationSize;Oi++)xe(vr.location+Oi,kr.meshPerAttribute);Li.isInstancedMesh!==!0&&En._maxInstanceCount===void 0&&(En._maxInstanceCount=kr.meshPerAttribute*kr.count)}else for(let Oi=0;Oi<vr.locationSize;Oi++)de(vr.location+Oi);S.bindBuffer(34962,ti);for(let Oi=0;Oi<vr.locationSize;Oi++)we(vr.location+Oi,Rn/vr.locationSize,Qi,Fr,Rn*ji,Rn/vr.locationSize*Oi*ji)}}else if(ir!==void 0){const Fr=ir[rr];if(Fr!==void 0)switch(Fr.length){case 2:S.vertexAttrib2fv(vr.location,Fr);break;case 3:S.vertexAttrib3fv(vr.location,Fr);break;case 4:S.vertexAttrib4fv(vr.location,Fr);break;default:S.vertexAttrib1fv(vr.location,Fr)}}}}Re()}(ft,Ht,Xt,_i),vi!==null&&S.bindBuffer(34963,l.get(vi).buffer))},reset:nt,resetDefaultState:xt,dispose:function(){nt();for(const ft in N){const Ht=N[ft];for(const Xt in Ht){const _i=Ht[Xt];for(const vi in _i)Q(_i[vi].object),delete _i[vi];delete Ht[Xt]}delete N[ft]}},releaseStatesOfGeometry:function(ft){if(N[ft.id]===void 0)return;const Ht=N[ft.id];for(const Xt in Ht){const _i=Ht[Xt];for(const vi in _i)Q(_i[vi].object),delete _i[vi];delete Ht[Xt]}delete N[ft.id]},releaseStatesOfProgram:function(ft){for(const Ht in N){const Xt=N[Ht];if(Xt[ft.id]===void 0)continue;const _i=Xt[ft.id];for(const vi in _i)Q(_i[vi].object),delete _i[vi];delete Xt[ft.id]}},initAttributes:oe,enableAttribute:de,disableUnusedAttributes:Re}}function lm(S,e,l,g){const _=g.isWebGL2;let M;this.setMode=function(P){M=P},this.render=function(P,N){S.drawArrays(M,P,N),l.update(N,M,1)},this.renderInstances=function(P,N,U){if(U===0)return;let G,K;if(_)G=S,K="drawArraysInstanced";else if(G=e.get("ANGLE_instanced_arrays"),K="drawArraysInstancedANGLE",G===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");G[K](M,P,N,U),l.update(N,M,U)}}function jp(S,e,l){let g;function _(ft){if(ft==="highp"){if(S.getShaderPrecisionFormat(35633,36338).precision>0&&S.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";ft="mediump"}return ft==="mediump"&&S.getShaderPrecisionFormat(35633,36337).precision>0&&S.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const M=typeof WebGL2RenderingContext<"u"&&S instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&S instanceof WebGL2ComputeRenderingContext;let P=l.precision!==void 0?l.precision:"highp";const N=_(P);N!==P&&(console.warn("THREE.WebGLRenderer:",P,"not supported, using",N,"instead."),P=N);const U=M||e.has("WEBGL_draw_buffers"),G=l.logarithmicDepthBuffer===!0,K=S.getParameter(34930),Q=S.getParameter(35660),ne=S.getParameter(3379),oe=S.getParameter(34076),de=S.getParameter(34921),xe=S.getParameter(36347),Re=S.getParameter(36348),we=S.getParameter(36349),nt=Q>0,xt=M||e.has("OES_texture_float");return{isWebGL2:M,drawBuffers:U,getMaxAnisotropy:function(){if(g!==void 0)return g;if(e.has("EXT_texture_filter_anisotropic")===!0){const ft=e.get("EXT_texture_filter_anisotropic");g=S.getParameter(ft.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else g=0;return g},getMaxPrecision:_,precision:P,logarithmicDepthBuffer:G,maxTextures:K,maxVertexTextures:Q,maxTextureSize:ne,maxCubemapSize:oe,maxAttributes:de,maxVertexUniforms:xe,maxVaryings:Re,maxFragmentUniforms:we,vertexTextures:nt,floatFragmentTextures:xt,floatVertexTextures:nt&&xt,maxSamples:M?S.getParameter(36183):0}}function Wp(S){const e=this;let l=null,g=0,_=!1,M=!1;const P=new _a,N=new Wn,U={value:null,needsUpdate:!1};function G(){U.value!==l&&(U.value=l,U.needsUpdate=g>0),e.numPlanes=g,e.numIntersection=0}function K(Q,ne,oe,de){const xe=Q!==null?Q.length:0;let Re=null;if(xe!==0){if(Re=U.value,de!==!0||Re===null){const we=oe+4*xe,nt=ne.matrixWorldInverse;N.getNormalMatrix(nt),(Re===null||Re.length<we)&&(Re=new Float32Array(we));for(let xt=0,ft=oe;xt!==xe;++xt,ft+=4)P.copy(Q[xt]).applyMatrix4(nt,N),P.normal.toArray(Re,ft),Re[ft+3]=P.constant}U.value=Re,U.needsUpdate=!0}return e.numPlanes=xe,e.numIntersection=0,Re}this.uniform=U,this.numPlanes=0,this.numIntersection=0,this.init=function(Q,ne,oe){const de=Q.length!==0||ne||g!==0||_;return _=ne,l=K(Q,oe,0),g=Q.length,de},this.beginShadows=function(){M=!0,K(null)},this.endShadows=function(){M=!1,G()},this.setState=function(Q,ne,oe){const de=Q.clippingPlanes,xe=Q.clipIntersection,Re=Q.clipShadows,we=S.get(Q);if(!_||de===null||de.length===0||M&&!Re)M?K(null):G();else{const nt=M?0:g,xt=4*nt;let ft=we.clippingState||null;U.value=ft,ft=K(de,ne,xt,oe);for(let Ht=0;Ht!==xt;++Ht)ft[Ht]=l[Ht];we.clippingState=ft,this.numIntersection=xe?this.numPlanes:0,this.numPlanes+=nt}}}function Id(S){let e=new WeakMap;function l(_,M){return M===303?_.mapping=301:M===304&&(_.mapping=302),_}function g(_){const M=_.target;M.removeEventListener("dispose",g);const P=e.get(M);P!==void 0&&(e.delete(M),P.dispose())}return{get:function(_){if(_&&_.isTexture&&_.isRenderTargetTexture===!1){const M=_.mapping;if(M===303||M===304){if(e.has(_))return l(e.get(_).texture,_.mapping);{const P=_.image;if(P&&P.height>0){const N=S.getRenderTarget(),U=new Ys(P.height/2);return U.fromEquirectangularTexture(S,_),e.set(_,U),S.setRenderTarget(N),_.addEventListener("dispose",g),l(U.texture,_.mapping)}return null}}}return _},dispose:function(){e=new WeakMap}}}Qa.physical={uniforms:go([Qa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new en(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new wn(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new en},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new wn(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new wn(1,1,1)},specularTintMap:{value:null}}]),vertexShader:os.meshphysical_vert,fragmentShader:os.meshphysical_frag};class Gu extends Mc{constructor(e=-1,l=1,g=1,_=-1,M=.1,P=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=l,this.top=g,this.bottom=_,this.near=M,this.far=P,this.updateProjectionMatrix()}copy(e,l){return super.copy(e,l),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,l,g,_,M,P){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=l,this.view.offsetX=g,this.view.offsetY=_,this.view.width=M,this.view.height=P,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),g=(this.right+this.left)/2,_=(this.top+this.bottom)/2;let M=g-e,P=g+e,N=_+l,U=_-l;if(this.view!==null&&this.view.enabled){const G=(this.right-this.left)/this.view.fullWidth/this.zoom,K=(this.top-this.bottom)/this.view.fullHeight/this.zoom;M+=G*this.view.offsetX,P=M+G*this.view.width,N-=K*this.view.offsetY,U=N-K*this.view.height}this.projectionMatrix.makeOrthographic(M,P,N,U,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const l=super.toJSON(e);return l.object.zoom=this.zoom,l.object.left=this.left,l.object.right=this.right,l.object.top=this.top,l.object.bottom=this.bottom,l.object.near=this.near,l.object.far=this.far,this.view!==null&&(l.object.view=Object.assign({},this.view)),l}}Gu.prototype.isOrthographicCamera=!0;class ru extends ao{constructor(e){super(e),this.type="RawShaderMaterial"}}ru.prototype.isRawShaderMaterial=!0;const _l=Math.pow(2,8),qp=[.125,.215,.35,.446,.526,.582],Rd=5+qp.length,Bh=20,Aa={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Hu=new Gu,{_lodPlanes:Yl,_sizeLods:su,_sigmas:Ec}=Uh(),Nh=new wn;let Fl=null;const Ca=(1+Math.sqrt(5))/2,zr=1/Ca,ou=[new ie(1,1,1),new ie(-1,1,1),new ie(1,1,-1),new ie(-1,1,-1),new ie(0,Ca,zr),new ie(0,Ca,-zr),new ie(zr,0,Ca),new ie(-zr,0,Ca),new ie(Ca,zr,0),new ie(-Ca,zr,0)];class ju{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(l){const g=new Float32Array(l),_=new ie(0,1,0);return new ru({name:"SphericalGaussianBlur",defines:{n:l},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:g},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:_},inputEncoding:{value:Aa[3e3]},outputEncoding:{value:Aa[3e3]}},vertexShader:Vh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${Wu()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}(Bh),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,l=0,g=.1,_=100){Fl=this._renderer.getRenderTarget();const M=this._allocateTargets();return this._sceneToCubeUV(e,g,_,M),l>0&&this._blur(M,0,0,l),this._applyPMREM(M),this._cleanup(M),M}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=$p(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=Dd(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Yl.length;e++)Yl[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Fl),e.scissorTest=!1,ys(e,0,0,e.width,e.height)}_fromTexture(e){Fl=this._renderer.getRenderTarget();const l=this._allocateTargets(e);return this._textureToCubeUV(e,l),this._applyPMREM(l),this._cleanup(l),l}_allocateTargets(e){const l={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:Pd(e)?e.encoding:3002,depthBuffer:!1},g=au(l);return g.depthBuffer=!e,this._pingPongRenderTarget=au(l),g}_compileMaterial(e){const l=new qn(Yl[0],e);this._renderer.compile(l,Hu)}_sceneToCubeUV(e,l,g,_){const M=new _o(90,1,l,g),P=[1,-1,1,1,1,1],N=[1,1,1,-1,-1,-1],U=this._renderer,G=U.autoClear,K=U.outputEncoding,Q=U.toneMapping;U.getClearColor(Nh),U.toneMapping=0,U.outputEncoding=3e3,U.autoClear=!1;const ne=new ws({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),oe=new qn(new Ja,ne);let de=!1;const xe=e.background;xe?xe.isColor&&(ne.color.copy(xe),e.background=null,de=!0):(ne.color.copy(Nh),de=!0);for(let Re=0;Re<6;Re++){const we=Re%3;we==0?(M.up.set(0,P[Re],0),M.lookAt(N[Re],0,0)):we==1?(M.up.set(0,0,P[Re]),M.lookAt(0,N[Re],0)):(M.up.set(0,P[Re],0),M.lookAt(0,0,N[Re])),ys(_,we*_l,Re>2?_l:0,_l,_l),U.setRenderTarget(_),de&&U.render(oe,M),U.render(e,M)}oe.geometry.dispose(),oe.material.dispose(),U.toneMapping=Q,U.outputEncoding=K,U.autoClear=G,e.background=xe}_textureToCubeUV(e,l){const g=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=$p()):this._equirectShader==null&&(this._equirectShader=Dd());const _=e.isCubeTexture?this._cubemapShader:this._equirectShader,M=new qn(Yl[0],_),P=_.uniforms;P.envMap.value=e,e.isCubeTexture||P.texelSize.value.set(1/e.image.width,1/e.image.height),P.inputEncoding.value=Aa[e.encoding],P.outputEncoding.value=Aa[l.texture.encoding],ys(l,0,0,3*_l,2*_l),g.setRenderTarget(l),g.render(M,Hu)}_applyPMREM(e){const l=this._renderer,g=l.autoClear;l.autoClear=!1;for(let _=1;_<Rd;_++){const M=Math.sqrt(Ec[_]*Ec[_]-Ec[_-1]*Ec[_-1]),P=ou[(_-1)%ou.length];this._blur(e,_-1,_,M,P)}l.autoClear=g}_blur(e,l,g,_,M){const P=this._pingPongRenderTarget;this._halfBlur(e,P,l,g,_,"latitudinal",M),this._halfBlur(P,e,g,g,_,"longitudinal",M)}_halfBlur(e,l,g,_,M,P,N){const U=this._renderer,G=this._blurMaterial;P!=="latitudinal"&&P!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const K=new qn(Yl[_],G),Q=G.uniforms,ne=su[g]-1,oe=isFinite(M)?Math.PI/(2*ne):2*Math.PI/39,de=M/oe,xe=isFinite(M)?1+Math.floor(3*de):Bh;xe>Bh&&console.warn(`sigmaRadians, ${M}, is too large and will clip, as it requested ${xe} samples when the maximum is set to 20`);const Re=[];let we=0;for(let xt=0;xt<Bh;++xt){const ft=xt/de,Ht=Math.exp(-ft*ft/2);Re.push(Ht),xt==0?we+=Ht:xt<xe&&(we+=2*Ht)}for(let xt=0;xt<Re.length;xt++)Re[xt]=Re[xt]/we;Q.envMap.value=e.texture,Q.samples.value=xe,Q.weights.value=Re,Q.latitudinal.value=P==="latitudinal",N&&(Q.poleAxis.value=N),Q.dTheta.value=oe,Q.mipInt.value=8-g,Q.inputEncoding.value=Aa[e.texture.encoding],Q.outputEncoding.value=Aa[e.texture.encoding];const nt=su[_];ys(l,3*Math.max(0,_l-2*nt),(_===0?0:2*_l)+2*nt*(_>4?_-8+4:0),3*nt,2*nt),U.setRenderTarget(l),U.render(K,Hu)}}function Pd(S){return S!==void 0&&S.type===1009&&(S.encoding===3e3||S.encoding===3001||S.encoding===3007)}function Uh(){const S=[],e=[],l=[];let g=8;for(let _=0;_<Rd;_++){const M=Math.pow(2,g);e.push(M);let P=1/M;_>4?P=qp[_-8+4-1]:_==0&&(P=0),l.push(P);const N=1/(M-1),U=-N/2,G=1+N/2,K=[U,U,G,U,G,G,U,U,G,G,U,G],Q=6,ne=6,oe=3,de=2,xe=1,Re=new Float32Array(oe*ne*Q),we=new Float32Array(de*ne*Q),nt=new Float32Array(xe*ne*Q);for(let ft=0;ft<Q;ft++){const Ht=ft%3*2/3-1,Xt=ft>2?0:-1,_i=[Ht,Xt,0,Ht+2/3,Xt,0,Ht+2/3,Xt+1,0,Ht,Xt,0,Ht+2/3,Xt+1,0,Ht,Xt+1,0];Re.set(_i,oe*ne*ft),we.set(K,de*ne*ft);const vi=[ft,ft,ft,ft,ft,ft];nt.set(vi,xe*ne*ft)}const xt=new Pr;xt.setAttribute("position",new Or(Re,oe)),xt.setAttribute("uv",new Or(we,de)),xt.setAttribute("faceIndex",new Or(nt,xe)),S.push(xt),g>4&&g--}return{_lodPlanes:S,_sizeLods:e,_sigmas:l}}function au(S){const e=new no(3*_l,3*_l,S);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function ys(S,e,l,g,_){S.viewport.set(e,l,g,_),S.scissor.set(e,l,g,_)}function Dd(){const S=new en(1,1);return new ru({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:S},inputEncoding:{value:Aa[3e3]},outputEncoding:{value:Aa[3e3]}},vertexShader:Vh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${Wu()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function $p(){return new ru({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Aa[3e3]},outputEncoding:{value:Aa[3e3]}},vertexShader:Vh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${Wu()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function Vh(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Wu(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function Gh(S){let e=new WeakMap,l=null;function g(_){const M=_.target;M.removeEventListener("dispose",g);const P=e.get(M);P!==void 0&&(e.delete(M),P.dispose())}return{get:function(_){if(_&&_.isTexture&&_.isRenderTargetTexture===!1){const M=_.mapping,P=M===303||M===304,N=M===301||M===302;if(P||N){if(e.has(_))return e.get(_).texture;{const U=_.image;if(P&&U&&U.height>0||N&&U&&function(G){let K=0;const Q=6;for(let ne=0;ne<Q;ne++)G[ne]!==void 0&&K++;return K===Q}(U)){const G=S.getRenderTarget();l===null&&(l=new ju(S));const K=P?l.fromEquirectangular(_):l.fromCubemap(_);return e.set(_,K),S.setRenderTarget(G),_.addEventListener("dispose",g),K.texture}return null}}}return _},dispose:function(){e=new WeakMap,l!==null&&(l.dispose(),l=null)}}}function cm(S){const e={};function l(g){if(e[g]!==void 0)return e[g];let _;switch(g){case"WEBGL_depth_texture":_=S.getExtension("WEBGL_depth_texture")||S.getExtension("MOZ_WEBGL_depth_texture")||S.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":_=S.getExtension("EXT_texture_filter_anisotropic")||S.getExtension("MOZ_EXT_texture_filter_anisotropic")||S.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":_=S.getExtension("WEBGL_compressed_texture_s3tc")||S.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":_=S.getExtension("WEBGL_compressed_texture_pvrtc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:_=S.getExtension(g)}return e[g]=_,_}return{has:function(g){return l(g)!==null},init:function(g){g.isWebGL2?l("EXT_color_buffer_float"):(l("WEBGL_depth_texture"),l("OES_texture_float"),l("OES_texture_half_float"),l("OES_texture_half_float_linear"),l("OES_standard_derivatives"),l("OES_element_index_uint"),l("OES_vertex_array_object"),l("ANGLE_instanced_arrays")),l("OES_texture_float_linear"),l("EXT_color_buffer_half_float")},get:function(g){const _=l(g);return _===null&&console.warn("THREE.WebGLRenderer: "+g+" extension not supported."),_}}}function um(S,e,l,g){const _={},M=new WeakMap;function P(U){const G=U.target;G.index!==null&&e.remove(G.index);for(const Q in G.attributes)e.remove(G.attributes[Q]);G.removeEventListener("dispose",P),delete _[G.id];const K=M.get(G);K&&(e.remove(K),M.delete(G)),g.releaseStatesOfGeometry(G),G.isInstancedBufferGeometry===!0&&delete G._maxInstanceCount,l.memory.geometries--}function N(U){const G=[],K=U.index,Q=U.attributes.position;let ne=0;if(K!==null){const xe=K.array;ne=K.version;for(let Re=0,we=xe.length;Re<we;Re+=3){const nt=xe[Re+0],xt=xe[Re+1],ft=xe[Re+2];G.push(nt,xt,xt,ft,ft,nt)}}else{const xe=Q.array;ne=Q.version;for(let Re=0,we=xe.length/3-1;Re<we;Re+=3){const nt=Re+0,xt=Re+1,ft=Re+2;G.push(nt,xt,xt,ft,ft,nt)}}const oe=new(fa(G)>65535?Is:To)(G,1);oe.version=ne;const de=M.get(U);de&&e.remove(de),M.set(U,oe)}return{get:function(U,G){return _[G.id]===!0||(G.addEventListener("dispose",P),_[G.id]=!0,l.memory.geometries++),G},update:function(U){const G=U.attributes;for(const Q in G)e.update(G[Q],34962);const K=U.morphAttributes;for(const Q in K){const ne=K[Q];for(let oe=0,de=ne.length;oe<de;oe++)e.update(ne[oe],34962)}},getWireframeAttribute:function(U){const G=M.get(U);if(G){const K=U.index;K!==null&&G.version<K.version&&N(U)}else N(U);return M.get(U)}}}function hm(S,e,l,g){const _=g.isWebGL2;let M,P,N;this.setMode=function(U){M=U},this.setIndex=function(U){P=U.type,N=U.bytesPerElement},this.render=function(U,G){S.drawElements(M,G,P,U*N),l.update(G,M,1)},this.renderInstances=function(U,G,K){if(K===0)return;let Q,ne;if(_)Q=S,ne="drawElementsInstanced";else if(Q=e.get("ANGLE_instanced_arrays"),ne="drawElementsInstancedANGLE",Q===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Q[ne](M,G,P,U*N,K),l.update(G,M,K)}}function qu(S){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(l,g,_){switch(e.calls++,g){case 4:e.triangles+=_*(l/3);break;case 1:e.lines+=_*(l/2);break;case 3:e.lines+=_*(l-1);break;case 2:e.lines+=_*l;break;case 0:e.points+=_*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",g)}}}}function dm(S,e){return S[0]-e[0]}function Rg(S,e){return Math.abs(e[1])-Math.abs(S[1])}function Pg(S){const e={},l=new Float32Array(8),g=[];for(let _=0;_<8;_++)g[_]=[_,0];return{update:function(_,M,P,N){const U=_.morphTargetInfluences,G=U===void 0?0:U.length;let K=e[M.id];if(K===void 0||K.length!==G){K=[];for(let xe=0;xe<G;xe++)K[xe]=[xe,0];e[M.id]=K}for(let xe=0;xe<G;xe++){const Re=K[xe];Re[0]=xe,Re[1]=U[xe]}K.sort(Rg);for(let xe=0;xe<8;xe++)xe<G&&K[xe][1]?(g[xe][0]=K[xe][0],g[xe][1]=K[xe][1]):(g[xe][0]=Number.MAX_SAFE_INTEGER,g[xe][1]=0);g.sort(dm);const Q=M.morphAttributes.position,ne=M.morphAttributes.normal;let oe=0;for(let xe=0;xe<8;xe++){const Re=g[xe],we=Re[0],nt=Re[1];we!==Number.MAX_SAFE_INTEGER&&nt?(Q&&M.getAttribute("morphTarget"+xe)!==Q[we]&&M.setAttribute("morphTarget"+xe,Q[we]),ne&&M.getAttribute("morphNormal"+xe)!==ne[we]&&M.setAttribute("morphNormal"+xe,ne[we]),l[xe]=nt,oe+=nt):(Q&&M.hasAttribute("morphTarget"+xe)===!0&&M.deleteAttribute("morphTarget"+xe),ne&&M.hasAttribute("morphNormal"+xe)===!0&&M.deleteAttribute("morphNormal"+xe),l[xe]=0)}const de=M.morphTargetsRelative?1:1-oe;N.getUniforms().setValue(S,"morphTargetBaseInfluence",de),N.getUniforms().setValue(S,"morphTargetInfluences",l)}}}function Dg(S,e,l,g){let _=new WeakMap;function M(P){const N=P.target;N.removeEventListener("dispose",M),l.remove(N.instanceMatrix),N.instanceColor!==null&&l.remove(N.instanceColor)}return{update:function(P){const N=g.render.frame,U=P.geometry,G=e.get(P,U);return _.get(G)!==N&&(e.update(G),_.set(G,N)),P.isInstancedMesh&&(P.hasEventListener("dispose",M)===!1&&P.addEventListener("dispose",M),l.update(P.instanceMatrix,34962),P.instanceColor!==null&&l.update(P.instanceColor,34962)),G},dispose:function(){_=new WeakMap}}}class Hh extends _s{constructor(e=null,l=1,g=1,_=1){super(null),this.image={data:e,width:l,height:g,depth:_},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Hh.prototype.isDataTexture2DArray=!0;class jh extends _s{constructor(e=null,l=1,g=1,_=1){super(null),this.image={data:e,width:l,height:g,depth:_},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}jh.prototype.isDataTexture3D=!0;const Od=new _s,Zp=new Hh,pm=new jh,Xp=new Ea,fm=[],$u=[],Zu=new Float32Array(16),Yp=new Float32Array(9),La=new Float32Array(4);function Ac(S,e,l){const g=S[0];if(g<=0||g>0)return S;const _=e*l;let M=fm[_];if(M===void 0&&(M=new Float32Array(_),fm[_]=M),e!==0){g.toArray(M,0);for(let P=1,N=0;P!==e;++P)N+=l,S[P].toArray(M,N)}return M}function qo(S,e){if(S.length!==e.length)return!1;for(let l=0,g=S.length;l<g;l++)if(S[l]!==e[l])return!1;return!0}function Uo(S,e){for(let l=0,g=e.length;l<g;l++)S[l]=e[l]}function zd(S,e){let l=$u[e];l===void 0&&(l=new Int32Array(e),$u[e]=l);for(let g=0;g!==e;++g)l[g]=S.allocateTextureUnit();return l}function Kp(S,e){const l=this.cache;l[0]!==e&&(S.uniform1f(this.addr,e),l[0]=e)}function kd(S,e){const l=this.cache;if(e.x!==void 0)l[0]===e.x&&l[1]===e.y||(S.uniform2f(this.addr,e.x,e.y),l[0]=e.x,l[1]=e.y);else{if(qo(l,e))return;S.uniform2fv(this.addr,e),Uo(l,e)}}function Jp(S,e){const l=this.cache;if(e.x!==void 0)l[0]===e.x&&l[1]===e.y&&l[2]===e.z||(S.uniform3f(this.addr,e.x,e.y,e.z),l[0]=e.x,l[1]=e.y,l[2]=e.z);else if(e.r!==void 0)l[0]===e.r&&l[1]===e.g&&l[2]===e.b||(S.uniform3f(this.addr,e.r,e.g,e.b),l[0]=e.r,l[1]=e.g,l[2]=e.b);else{if(qo(l,e))return;S.uniform3fv(this.addr,e),Uo(l,e)}}function Wh(S,e){const l=this.cache;if(e.x!==void 0)l[0]===e.x&&l[1]===e.y&&l[2]===e.z&&l[3]===e.w||(S.uniform4f(this.addr,e.x,e.y,e.z,e.w),l[0]=e.x,l[1]=e.y,l[2]=e.z,l[3]=e.w);else{if(qo(l,e))return;S.uniform4fv(this.addr,e),Uo(l,e)}}function Fd(S,e){const l=this.cache,g=e.elements;if(g===void 0){if(qo(l,e))return;S.uniformMatrix2fv(this.addr,!1,e),Uo(l,e)}else{if(qo(l,g))return;La.set(g),S.uniformMatrix2fv(this.addr,!1,La),Uo(l,g)}}function Qp(S,e){const l=this.cache,g=e.elements;if(g===void 0){if(qo(l,e))return;S.uniformMatrix3fv(this.addr,!1,e),Uo(l,e)}else{if(qo(l,g))return;Yp.set(g),S.uniformMatrix3fv(this.addr,!1,Yp),Uo(l,g)}}function mm(S,e){const l=this.cache,g=e.elements;if(g===void 0){if(qo(l,e))return;S.uniformMatrix4fv(this.addr,!1,e),Uo(l,e)}else{if(qo(l,g))return;Zu.set(g),S.uniformMatrix4fv(this.addr,!1,Zu),Uo(l,g)}}function Xu(S,e){const l=this.cache;l[0]!==e&&(S.uniform1i(this.addr,e),l[0]=e)}function Og(S,e){const l=this.cache;qo(l,e)||(S.uniform2iv(this.addr,e),Uo(l,e))}function gm(S,e){const l=this.cache;qo(l,e)||(S.uniform3iv(this.addr,e),Uo(l,e))}function _m(S,e){const l=this.cache;qo(l,e)||(S.uniform4iv(this.addr,e),Uo(l,e))}function Yu(S,e){const l=this.cache;l[0]!==e&&(S.uniform1ui(this.addr,e),l[0]=e)}function ym(S,e){const l=this.cache;qo(l,e)||(S.uniform2uiv(this.addr,e),Uo(l,e))}function vm(S,e){const l=this.cache;qo(l,e)||(S.uniform3uiv(this.addr,e),Uo(l,e))}function ef(S,e){const l=this.cache;qo(l,e)||(S.uniform4uiv(this.addr,e),Uo(l,e))}function qh(S,e,l){const g=this.cache,_=l.allocateTextureUnit();g[0]!==_&&(S.uniform1i(this.addr,_),g[0]=_),l.safeSetTexture2D(e||Od,_)}function Bd(S,e,l){const g=this.cache,_=l.allocateTextureUnit();g[0]!==_&&(S.uniform1i(this.addr,_),g[0]=_),l.setTexture3D(e||pm,_)}function Ku(S,e,l){const g=this.cache,_=l.allocateTextureUnit();g[0]!==_&&(S.uniform1i(this.addr,_),g[0]=_),l.safeSetTextureCube(e||Xp,_)}function xm(S,e,l){const g=this.cache,_=l.allocateTextureUnit();g[0]!==_&&(S.uniform1i(this.addr,_),g[0]=_),l.setTexture2DArray(e||Zp,_)}function tf(S,e){S.uniform1fv(this.addr,e)}function nf(S,e){const l=Ac(e,this.size,2);S.uniform2fv(this.addr,l)}function rf(S,e){const l=Ac(e,this.size,3);S.uniform3fv(this.addr,l)}function lu(S,e){const l=Ac(e,this.size,4);S.uniform4fv(this.addr,l)}function bm(S,e){const l=Ac(e,this.size,4);S.uniformMatrix2fv(this.addr,!1,l)}function Kl(S,e){const l=Ac(e,this.size,9);S.uniformMatrix3fv(this.addr,!1,l)}function Nd(S,e){const l=Ac(e,this.size,16);S.uniformMatrix4fv(this.addr,!1,l)}function cu(S,e){S.uniform1iv(this.addr,e)}function wm(S,e){S.uniform2iv(this.addr,e)}function sf(S,e){S.uniform3iv(this.addr,e)}function of(S,e){S.uniform4iv(this.addr,e)}function af(S,e){S.uniform1uiv(this.addr,e)}function Tm(S,e){S.uniform2uiv(this.addr,e)}function lf(S,e){S.uniform3uiv(this.addr,e)}function $h(S,e){S.uniform4uiv(this.addr,e)}function zg(S,e,l){const g=e.length,_=zd(l,g);S.uniform1iv(this.addr,_);for(let M=0;M!==g;++M)l.safeSetTexture2D(e[M]||Od,_[M])}function kg(S,e,l){const g=e.length,_=zd(l,g);S.uniform1iv(this.addr,_);for(let M=0;M!==g;++M)l.safeSetTextureCube(e[M]||Xp,_[M])}function cf(S,e,l){this.id=S,this.addr=l,this.cache=[],this.setValue=function(g){switch(g){case 5126:return Kp;case 35664:return kd;case 35665:return Jp;case 35666:return Wh;case 35674:return Fd;case 35675:return Qp;case 35676:return mm;case 5124:case 35670:return Xu;case 35667:case 35671:return Og;case 35668:case 35672:return gm;case 35669:case 35673:return _m;case 5125:return Yu;case 36294:return ym;case 36295:return vm;case 36296:return ef;case 35678:case 36198:case 36298:case 36306:case 35682:return qh;case 35679:case 36299:case 36307:return Bd;case 35680:case 36300:case 36308:case 36293:return Ku;case 36289:case 36303:case 36311:case 36292:return xm}}(e.type)}function Mm(S,e,l){this.id=S,this.addr=l,this.cache=[],this.size=e.size,this.setValue=function(g){switch(g){case 5126:return tf;case 35664:return nf;case 35665:return rf;case 35666:return lu;case 35674:return bm;case 35675:return Kl;case 35676:return Nd;case 5124:case 35670:return cu;case 35667:case 35671:return wm;case 35668:case 35672:return sf;case 35669:case 35673:return of;case 5125:return af;case 36294:return Tm;case 36295:return lf;case 36296:return $h;case 35678:case 36198:case 36298:case 36306:case 35682:return zg;case 35680:case 36300:case 36308:case 36293:return kg}}(e.type)}function Ud(S){this.id=S,this.seq=[],this.map={}}Mm.prototype.updateCache=function(S){const e=this.cache;S instanceof Float32Array&&e.length!==S.length&&(this.cache=new Float32Array(S.length)),Uo(e,S)},Ud.prototype.setValue=function(S,e,l){const g=this.seq;for(let _=0,M=g.length;_!==M;++_){const P=g[_];P.setValue(S,e[P.id],l)}};const Ju=/(\w+)(\])?(\[|\.)?/g;function uu(S,e){S.seq.push(e),S.map[e.id]=e}function Vd(S,e,l){const g=S.name,_=g.length;for(Ju.lastIndex=0;;){const M=Ju.exec(g),P=Ju.lastIndex;let N=M[1];const U=M[2]==="]",G=M[3];if(U&&(N|=0),G===void 0||G==="["&&P+2===_){uu(l,G===void 0?new cf(N,S,e):new Mm(N,S,e));break}{let K=l.map[N];K===void 0&&(K=new Ud(N),uu(l,K)),l=K}}}function el(S,e){this.seq=[],this.map={};const l=S.getProgramParameter(e,35718);for(let g=0;g<l;++g){const _=S.getActiveUniform(e,g);Vd(_,S.getUniformLocation(e,_.name),this)}}function Cc(S,e,l){const g=S.createShader(e);return S.shaderSource(g,l),S.compileShader(g),g}el.prototype.setValue=function(S,e,l,g){const _=this.map[e];_!==void 0&&_.setValue(S,l,g)},el.prototype.setOptional=function(S,e,l){const g=e[l];g!==void 0&&this.setValue(S,l,g)},el.upload=function(S,e,l,g){for(let _=0,M=e.length;_!==M;++_){const P=e[_],N=l[P.id];N.needsUpdate!==!1&&P.setValue(S,N.value,g)}},el.seqWithValue=function(S,e){const l=[];for(let g=0,_=S.length;g!==_;++g){const M=S[g];M.id in e&&l.push(M)}return l};let Gd=0;function Zh(S){switch(S){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",S),["Linear","( value )"]}}function Hd(S,e,l){const g=S.getShaderParameter(e,35713),_=S.getShaderInfoLog(e).trim();return g&&_===""?"":l.toUpperCase()+`

`+_+`

`+function(M){const P=M.split(`
`);for(let N=0;N<P.length;N++)P[N]=N+1+": "+P[N];return P.join(`
`)}(S.getShaderSource(e))}function Lc(S,e){const l=Zh(e);return"vec4 "+S+"( vec4 value ) { return "+l[0]+"ToLinear"+l[1]+"; }"}function Sm(S,e){const l=Zh(e);return"vec4 "+S+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"}function hu(S,e){let l;switch(e){case 1:l="Linear";break;case 2:l="Reinhard";break;case 3:l="OptimizedCineon";break;case 4:l="ACESFilmic";break;case 5:l="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),l="Linear"}return"vec3 "+S+"( vec3 color ) { return "+l+"ToneMapping( color ); }"}function Jl(S){return S!==""}function Sn(S,e){return S.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Xh(S,e){return S.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const uf=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ql(S){return S.replace(uf,Ia)}function Ia(S,e){const l=os[e];if(l===void 0)throw new Error("Can not resolve #include <"+e+">");return Ql(l)}const Gn=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,hf=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function df(S){return S.replace(hf,du).replace(Gn,Fg)}function Fg(S,e,l,g){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),du(S,e,l,g)}function du(S,e,l,g){let _="";for(let M=parseInt(e);M<parseInt(l);M++)_+=g.replace(/\[\s*i\s*\]/g,"[ "+M+" ]").replace(/UNROLLED_LOOP_INDEX/g,M);return _}function jd(S){let e="precision "+S.precision+` float;
precision `+S.precision+" int;";return S.precision==="highp"?e+=`
#define HIGH_PRECISION`:S.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:S.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Yh(S,e,l,g){const _=S.getContext(),M=l.defines;let P=l.vertexShader,N=l.fragmentShader;const U=function(vi){let Bi="SHADOWMAP_TYPE_BASIC";return vi.shadowMapType===1?Bi="SHADOWMAP_TYPE_PCF":vi.shadowMapType===2?Bi="SHADOWMAP_TYPE_PCF_SOFT":vi.shadowMapType===3&&(Bi="SHADOWMAP_TYPE_VSM"),Bi}(l),G=function(vi){let Bi="ENVMAP_TYPE_CUBE";if(vi.envMap)switch(vi.envMapMode){case 301:case 302:Bi="ENVMAP_TYPE_CUBE";break;case 306:case 307:Bi="ENVMAP_TYPE_CUBE_UV"}return Bi}(l),K=function(vi){let Bi="ENVMAP_MODE_REFLECTION";if(vi.envMap)switch(vi.envMapMode){case 302:case 307:Bi="ENVMAP_MODE_REFRACTION"}return Bi}(l),Q=function(vi){let Bi="ENVMAP_BLENDING_NONE";if(vi.envMap)switch(vi.combine){case 0:Bi="ENVMAP_BLENDING_MULTIPLY";break;case 1:Bi="ENVMAP_BLENDING_MIX";break;case 2:Bi="ENVMAP_BLENDING_ADD"}return Bi}(l),ne=S.gammaFactor>0?S.gammaFactor:1,oe=l.isWebGL2?"":function(vi){return[vi.extensionDerivatives||vi.envMapCubeUV||vi.bumpMap||vi.tangentSpaceNormalMap||vi.clearcoatNormalMap||vi.flatShading||vi.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(vi.extensionFragDepth||vi.logarithmicDepthBuffer)&&vi.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",vi.extensionDrawBuffers&&vi.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(vi.extensionShaderTextureLOD||vi.envMap||vi.transmission)&&vi.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Jl).join(`
`)}(l),de=function(vi){const Bi=[];for(const Li in vi){const ki=vi[Li];ki!==!1&&Bi.push("#define "+Li+" "+ki)}return Bi.join(`
`)}(M),xe=_.createProgram();let Re,we,nt=l.glslVersion?"#version "+l.glslVersion+`
`:"";l.isRawShaderMaterial?(Re=[de].filter(Jl).join(`
`),Re.length>0&&(Re+=`
`),we=[oe,de].filter(Jl).join(`
`),we.length>0&&(we+=`
`)):(Re=[jd(l),"#define SHADER_NAME "+l.shaderName,de,l.instancing?"#define USE_INSTANCING":"",l.instancingColor?"#define USE_INSTANCING_COLOR":"",l.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+ne,"#define MAX_BONES "+l.maxBones,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+K:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.displacementMap&&l.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",l.specularTintMap?"#define USE_SPECULARTINTMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&l.flatShading===!1?"#define USE_MORPHNORMALS":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+U:"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Jl).join(`
`),we=[oe,jd(l),"#define SHADER_NAME "+l.shaderName,de,"#define GAMMA_FACTOR "+ne,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.matcap?"#define USE_MATCAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+G:"",l.envMap?"#define "+K:"",l.envMap?"#define "+Q:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoat?"#define USE_CLEARCOAT":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",l.specularTintMap?"#define USE_SPECULARTINTMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.alphaTest?"#define USE_ALPHATEST":"",l.sheenTint?"#define USE_SHEEN":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors||l.instancingColor?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.gradientMap?"#define USE_GRADIENTMAP":"",l.flatShading?"#define FLAT_SHADED":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+U:"",l.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",l.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(l.extensionShaderTextureLOD||l.envMap)&&l.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",l.toneMapping!==0?"#define TONE_MAPPING":"",l.toneMapping!==0?os.tonemapping_pars_fragment:"",l.toneMapping!==0?hu("toneMapping",l.toneMapping):"",l.dithering?"#define DITHERING":"",l.format===1022?"#define OPAQUE":"",os.encodings_pars_fragment,l.map?Lc("mapTexelToLinear",l.mapEncoding):"",l.matcap?Lc("matcapTexelToLinear",l.matcapEncoding):"",l.envMap?Lc("envMapTexelToLinear",l.envMapEncoding):"",l.emissiveMap?Lc("emissiveMapTexelToLinear",l.emissiveMapEncoding):"",l.specularTintMap?Lc("specularTintMapTexelToLinear",l.specularTintMapEncoding):"",l.lightMap?Lc("lightMapTexelToLinear",l.lightMapEncoding):"",Sm("linearToOutputTexel",l.outputEncoding),l.depthPacking?"#define DEPTH_PACKING "+l.depthPacking:"",`
`].filter(Jl).join(`
`)),P=Ql(P),P=Sn(P,l),P=Xh(P,l),N=Ql(N),N=Sn(N,l),N=Xh(N,l),P=df(P),N=df(N),l.isWebGL2&&l.isRawShaderMaterial!==!0&&(nt=`#version 300 es
`,Re=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Re,we=["#define varying in",l.glslVersion===Tt?"":"out highp vec4 pc_fragColor;",l.glslVersion===Tt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+we);const xt=nt+we+N,ft=Cc(_,35633,nt+Re+P),Ht=Cc(_,35632,xt);if(_.attachShader(xe,ft),_.attachShader(xe,Ht),l.index0AttributeName!==void 0?_.bindAttribLocation(xe,0,l.index0AttributeName):l.morphTargets===!0&&_.bindAttribLocation(xe,0,"position"),_.linkProgram(xe),S.debug.checkShaderErrors){const vi=_.getProgramInfoLog(xe).trim(),Bi=_.getShaderInfoLog(ft).trim(),Li=_.getShaderInfoLog(Ht).trim();let ki=!0,Zn=!0;if(_.getProgramParameter(xe,35714)===!1){ki=!1;const En=Hd(_,ft,"vertex"),Ji=Hd(_,Ht,"fragment");console.error("THREE.WebGLProgram: Shader Error "+_.getError()+" - VALIDATE_STATUS "+_.getProgramParameter(xe,35715)+`

Program Info Log: `+vi+`
`+En+`
`+Ji)}else vi!==""?console.warn("THREE.WebGLProgram: Program Info Log:",vi):Bi!==""&&Li!==""||(Zn=!1);Zn&&(this.diagnostics={runnable:ki,programLog:vi,vertexShader:{log:Bi,prefix:Re},fragmentShader:{log:Li,prefix:we}})}let Xt,_i;return _.deleteShader(ft),_.deleteShader(Ht),this.getUniforms=function(){return Xt===void 0&&(Xt=new el(_,xe)),Xt},this.getAttributes=function(){return _i===void 0&&(_i=function(vi,Bi){const Li={},ki=vi.getProgramParameter(Bi,35721);for(let Zn=0;Zn<ki;Zn++){const En=vi.getActiveAttrib(Bi,Zn),Ji=En.name;let In=1;En.type===35674&&(In=2),En.type===35675&&(In=3),En.type===35676&&(In=4),Li[Ji]={type:En.type,location:vi.getAttribLocation(Bi,Ji),locationSize:In}}return Li}(_,xe)),_i},this.destroy=function(){g.releaseStatesOfProgram(this),_.deleteProgram(xe),this.program=void 0},this.name=l.shaderName,this.id=Gd++,this.cacheKey=e,this.usedTimes=1,this.program=xe,this.vertexShader=ft,this.fragmentShader=Ht,this}function Em(S,e,l,g,_,M,P){const N=[],U=_.isWebGL2,G=_.logarithmicDepthBuffer,K=_.floatVertexTextures,Q=_.maxVertexUniforms,ne=_.vertexTextures;let oe=_.precision;const de={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},xe=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function Re(we){let nt;return we&&we.isTexture?nt=we.encoding:we&&we.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),nt=we.texture.encoding):nt=3e3,nt}return{getParameters:function(we,nt,xt,ft,Ht){const Xt=ft.fog,_i=we.isMeshStandardMaterial?ft.environment:null,vi=(we.isMeshStandardMaterial?l:e).get(we.envMap||_i),Bi=de[we.type],Li=Ht.isSkinnedMesh?function(ir){const rr=ir.skeleton.bones;if(K)return 1024;{const vr=Q,kr=Math.floor((vr-20)/4),Fr=Math.min(kr,rr.length);return Fr<rr.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+rr.length+" bones. This GPU supports "+Fr+"."),0):Fr}}(Ht):0;let ki,Zn;if(we.precision!==null&&(oe=_.getMaxPrecision(we.precision),oe!==we.precision&&console.warn("THREE.WebGLProgram.getParameters:",we.precision,"not supported, using",oe,"instead.")),Bi){const ir=Qa[Bi];ki=ir.vertexShader,Zn=ir.fragmentShader}else ki=we.vertexShader,Zn=we.fragmentShader;const En=S.getRenderTarget(),Ji=we.alphaTest>0,In=we.clearcoat>0;return{isWebGL2:U,shaderID:Bi,shaderName:we.type,vertexShader:ki,fragmentShader:Zn,defines:we.defines,isRawShaderMaterial:we.isRawShaderMaterial===!0,glslVersion:we.glslVersion,precision:oe,instancing:Ht.isInstancedMesh===!0,instancingColor:Ht.isInstancedMesh===!0&&Ht.instanceColor!==null,supportsVertexTextures:ne,outputEncoding:En!==null?Re(En.texture):S.outputEncoding,map:!!we.map,mapEncoding:Re(we.map),matcap:!!we.matcap,matcapEncoding:Re(we.matcap),envMap:!!vi,envMapMode:vi&&vi.mapping,envMapEncoding:Re(vi),envMapCubeUV:!!vi&&(vi.mapping===306||vi.mapping===307),lightMap:!!we.lightMap,lightMapEncoding:Re(we.lightMap),aoMap:!!we.aoMap,emissiveMap:!!we.emissiveMap,emissiveMapEncoding:Re(we.emissiveMap),bumpMap:!!we.bumpMap,normalMap:!!we.normalMap,objectSpaceNormalMap:we.normalMapType===1,tangentSpaceNormalMap:we.normalMapType===0,clearcoat:In,clearcoatMap:In&&!!we.clearcoatMap,clearcoatRoughnessMap:In&&!!we.clearcoatRoughnessMap,clearcoatNormalMap:In&&!!we.clearcoatNormalMap,displacementMap:!!we.displacementMap,roughnessMap:!!we.roughnessMap,metalnessMap:!!we.metalnessMap,specularMap:!!we.specularMap,specularIntensityMap:!!we.specularIntensityMap,specularTintMap:!!we.specularTintMap,specularTintMapEncoding:Re(we.specularTintMap),alphaMap:!!we.alphaMap,alphaTest:Ji,gradientMap:!!we.gradientMap,sheenTint:!!we.sheenTint&&(we.sheenTint.r>0||we.sheenTint.g>0||we.sheenTint.b>0),transmission:we.transmission>0,transmissionMap:!!we.transmissionMap,thicknessMap:!!we.thicknessMap,combine:we.combine,vertexTangents:!!we.normalMap&&!!Ht.geometry&&!!Ht.geometry.attributes.tangent,vertexColors:we.vertexColors,vertexAlphas:we.vertexColors===!0&&!!Ht.geometry&&!!Ht.geometry.attributes.color&&Ht.geometry.attributes.color.itemSize===4,vertexUvs:!!(we.map||we.bumpMap||we.normalMap||we.specularMap||we.alphaMap||we.emissiveMap||we.roughnessMap||we.metalnessMap||we.clearcoatMap||we.clearcoatRoughnessMap||we.clearcoatNormalMap||we.displacementMap||we.transmissionMap||we.thicknessMap||we.specularIntensityMap||we.specularTintMap),uvsVertexOnly:!(we.map||we.bumpMap||we.normalMap||we.specularMap||we.alphaMap||we.emissiveMap||we.roughnessMap||we.metalnessMap||we.clearcoatNormalMap||we.transmission>0||we.transmissionMap||we.thicknessMap||we.specularIntensityMap||we.specularTintMap||!we.displacementMap),fog:!!Xt,useFog:we.fog,fogExp2:Xt&&Xt.isFogExp2,flatShading:!!we.flatShading,sizeAttenuation:we.sizeAttenuation,logarithmicDepthBuffer:G,skinning:Ht.isSkinnedMesh===!0&&Li>0,maxBones:Li,useVertexTexture:K,morphTargets:!!Ht.geometry&&!!Ht.geometry.morphAttributes.position,morphNormals:!!Ht.geometry&&!!Ht.geometry.morphAttributes.normal,numDirLights:nt.directional.length,numPointLights:nt.point.length,numSpotLights:nt.spot.length,numRectAreaLights:nt.rectArea.length,numHemiLights:nt.hemi.length,numDirLightShadows:nt.directionalShadowMap.length,numPointLightShadows:nt.pointShadowMap.length,numSpotLightShadows:nt.spotShadowMap.length,numClippingPlanes:P.numPlanes,numClipIntersection:P.numIntersection,format:we.format,dithering:we.dithering,shadowMapEnabled:S.shadowMap.enabled&&xt.length>0,shadowMapType:S.shadowMap.type,toneMapping:we.toneMapped?S.toneMapping:0,physicallyCorrectLights:S.physicallyCorrectLights,premultipliedAlpha:we.premultipliedAlpha,doubleSided:we.side===2,flipSided:we.side===1,depthPacking:we.depthPacking!==void 0&&we.depthPacking,index0AttributeName:we.index0AttributeName,extensionDerivatives:we.extensions&&we.extensions.derivatives,extensionFragDepth:we.extensions&&we.extensions.fragDepth,extensionDrawBuffers:we.extensions&&we.extensions.drawBuffers,extensionShaderTextureLOD:we.extensions&&we.extensions.shaderTextureLOD,rendererExtensionFragDepth:U||g.has("EXT_frag_depth"),rendererExtensionDrawBuffers:U||g.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:U||g.has("EXT_shader_texture_lod"),customProgramCacheKey:we.customProgramCacheKey()}},getProgramCacheKey:function(we){const nt=[];if(we.shaderID?nt.push(we.shaderID):(nt.push(we.fragmentShader),nt.push(we.vertexShader)),we.defines!==void 0)for(const xt in we.defines)nt.push(xt),nt.push(we.defines[xt]);if(we.isRawShaderMaterial===!1){for(let xt=0;xt<xe.length;xt++)nt.push(we[xe[xt]]);nt.push(S.outputEncoding),nt.push(S.gammaFactor)}return nt.push(we.customProgramCacheKey),nt.join()},getUniforms:function(we){const nt=de[we.type];let xt;if(nt){const ft=Qa[nt];xt=Tc.clone(ft.uniforms)}else xt=we.uniforms;return xt},acquireProgram:function(we,nt){let xt;for(let ft=0,Ht=N.length;ft<Ht;ft++){const Xt=N[ft];if(Xt.cacheKey===nt){xt=Xt,++xt.usedTimes;break}}return xt===void 0&&(xt=new Yh(S,nt,we,M),N.push(xt)),xt},releaseProgram:function(we){if(--we.usedTimes==0){const nt=N.indexOf(we);N[nt]=N[N.length-1],N.pop(),we.destroy()}},programs:N}}function Bg(){let S=new WeakMap;return{get:function(e){let l=S.get(e);return l===void 0&&(l={},S.set(e,l)),l},remove:function(e){S.delete(e)},update:function(e,l,g){S.get(e)[l]=g},dispose:function(){S=new WeakMap}}}function pf(S,e){return S.groupOrder!==e.groupOrder?S.groupOrder-e.groupOrder:S.renderOrder!==e.renderOrder?S.renderOrder-e.renderOrder:S.program!==e.program?S.program.id-e.program.id:S.material.id!==e.material.id?S.material.id-e.material.id:S.z!==e.z?S.z-e.z:S.id-e.id}function Qu(S,e){return S.groupOrder!==e.groupOrder?S.groupOrder-e.groupOrder:S.renderOrder!==e.renderOrder?S.renderOrder-e.renderOrder:S.z!==e.z?e.z-S.z:S.id-e.id}function eh(S){const e=[];let l=0;const g=[],_=[],M=[],P={id:-1};function N(U,G,K,Q,ne,oe){let de=e[l];const xe=S.get(K);return de===void 0?(de={id:U.id,object:U,geometry:G,material:K,program:xe.program||P,groupOrder:Q,renderOrder:U.renderOrder,z:ne,group:oe},e[l]=de):(de.id=U.id,de.object=U,de.geometry=G,de.material=K,de.program=xe.program||P,de.groupOrder=Q,de.renderOrder=U.renderOrder,de.z=ne,de.group=oe),l++,de}return{opaque:g,transmissive:_,transparent:M,init:function(){l=0,g.length=0,_.length=0,M.length=0},push:function(U,G,K,Q,ne,oe){const de=N(U,G,K,Q,ne,oe);K.transmission>0?_.push(de):K.transparent===!0?M.push(de):g.push(de)},unshift:function(U,G,K,Q,ne,oe){const de=N(U,G,K,Q,ne,oe);K.transmission>0?_.unshift(de):K.transparent===!0?M.unshift(de):g.unshift(de)},finish:function(){for(let U=l,G=e.length;U<G;U++){const K=e[U];if(K.id===null)break;K.id=null,K.object=null,K.geometry=null,K.material=null,K.program=null,K.group=null}},sort:function(U,G){g.length>1&&g.sort(U||pf),_.length>1&&_.sort(G||Qu),M.length>1&&M.sort(G||Qu)}}}function Wd(S){let e=new WeakMap;return{get:function(l,g){let _;return e.has(l)===!1?(_=new eh(S),e.set(l,[_])):g>=e.get(l).length?(_=new eh(S),e.get(l).push(_)):_=e.get(l)[g],_},dispose:function(){e=new WeakMap}}}function Ko(){const S={};return{get:function(e){if(S[e.id]!==void 0)return S[e.id];let l;switch(e.type){case"DirectionalLight":l={direction:new ie,color:new wn};break;case"SpotLight":l={position:new ie,direction:new ie,color:new wn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":l={position:new ie,color:new wn,distance:0,decay:0};break;case"HemisphereLight":l={direction:new ie,skyColor:new wn,groundColor:new wn};break;case"RectAreaLight":l={color:new wn,position:new ie,halfWidth:new ie,halfHeight:new ie}}return S[e.id]=l,l}}}let Ua=0;function Am(S,e){return(e.castShadow?1:0)-(S.castShadow?1:0)}function ff(S,e){const l=new Ko,g=function(){const U={};return{get:function(G){if(U[G.id]!==void 0)return U[G.id];let K;switch(G.type){case"DirectionalLight":case"SpotLight":K={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new en};break;case"PointLight":K={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new en,shadowCameraNear:1,shadowCameraFar:1e3}}return U[G.id]=K,K}}}(),_={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let U=0;U<9;U++)_.probe.push(new ie);const M=new ie,P=new nr,N=new nr;return{setup:function(U,G){let K=0,Q=0,ne=0;for(let _i=0;_i<9;_i++)_.probe[_i].set(0,0,0);let oe=0,de=0,xe=0,Re=0,we=0,nt=0,xt=0,ft=0;U.sort(Am);const Ht=G!==!0?Math.PI:1;for(let _i=0,vi=U.length;_i<vi;_i++){const Bi=U[_i],Li=Bi.color,ki=Bi.intensity,Zn=Bi.distance,En=Bi.shadow&&Bi.shadow.map?Bi.shadow.map.texture:null;if(Bi.isAmbientLight)K+=Li.r*ki*Ht,Q+=Li.g*ki*Ht,ne+=Li.b*ki*Ht;else if(Bi.isLightProbe)for(let Ji=0;Ji<9;Ji++)_.probe[Ji].addScaledVector(Bi.sh.coefficients[Ji],ki);else if(Bi.isDirectionalLight){const Ji=l.get(Bi);if(Ji.color.copy(Bi.color).multiplyScalar(Bi.intensity*Ht),Bi.castShadow){const In=Bi.shadow,ir=g.get(Bi);ir.shadowBias=In.bias,ir.shadowNormalBias=In.normalBias,ir.shadowRadius=In.radius,ir.shadowMapSize=In.mapSize,_.directionalShadow[oe]=ir,_.directionalShadowMap[oe]=En,_.directionalShadowMatrix[oe]=Bi.shadow.matrix,nt++}_.directional[oe]=Ji,oe++}else if(Bi.isSpotLight){const Ji=l.get(Bi);if(Ji.position.setFromMatrixPosition(Bi.matrixWorld),Ji.color.copy(Li).multiplyScalar(ki*Ht),Ji.distance=Zn,Ji.coneCos=Math.cos(Bi.angle),Ji.penumbraCos=Math.cos(Bi.angle*(1-Bi.penumbra)),Ji.decay=Bi.decay,Bi.castShadow){const In=Bi.shadow,ir=g.get(Bi);ir.shadowBias=In.bias,ir.shadowNormalBias=In.normalBias,ir.shadowRadius=In.radius,ir.shadowMapSize=In.mapSize,_.spotShadow[xe]=ir,_.spotShadowMap[xe]=En,_.spotShadowMatrix[xe]=Bi.shadow.matrix,ft++}_.spot[xe]=Ji,xe++}else if(Bi.isRectAreaLight){const Ji=l.get(Bi);Ji.color.copy(Li).multiplyScalar(ki),Ji.halfWidth.set(.5*Bi.width,0,0),Ji.halfHeight.set(0,.5*Bi.height,0),_.rectArea[Re]=Ji,Re++}else if(Bi.isPointLight){const Ji=l.get(Bi);if(Ji.color.copy(Bi.color).multiplyScalar(Bi.intensity*Ht),Ji.distance=Bi.distance,Ji.decay=Bi.decay,Bi.castShadow){const In=Bi.shadow,ir=g.get(Bi);ir.shadowBias=In.bias,ir.shadowNormalBias=In.normalBias,ir.shadowRadius=In.radius,ir.shadowMapSize=In.mapSize,ir.shadowCameraNear=In.camera.near,ir.shadowCameraFar=In.camera.far,_.pointShadow[de]=ir,_.pointShadowMap[de]=En,_.pointShadowMatrix[de]=Bi.shadow.matrix,xt++}_.point[de]=Ji,de++}else if(Bi.isHemisphereLight){const Ji=l.get(Bi);Ji.skyColor.copy(Bi.color).multiplyScalar(ki*Ht),Ji.groundColor.copy(Bi.groundColor).multiplyScalar(ki*Ht),_.hemi[we]=Ji,we++}}Re>0&&(e.isWebGL2||S.has("OES_texture_float_linear")===!0?(_.rectAreaLTC1=Qn.LTC_FLOAT_1,_.rectAreaLTC2=Qn.LTC_FLOAT_2):S.has("OES_texture_half_float_linear")===!0?(_.rectAreaLTC1=Qn.LTC_HALF_1,_.rectAreaLTC2=Qn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),_.ambient[0]=K,_.ambient[1]=Q,_.ambient[2]=ne;const Xt=_.hash;Xt.directionalLength===oe&&Xt.pointLength===de&&Xt.spotLength===xe&&Xt.rectAreaLength===Re&&Xt.hemiLength===we&&Xt.numDirectionalShadows===nt&&Xt.numPointShadows===xt&&Xt.numSpotShadows===ft||(_.directional.length=oe,_.spot.length=xe,_.rectArea.length=Re,_.point.length=de,_.hemi.length=we,_.directionalShadow.length=nt,_.directionalShadowMap.length=nt,_.pointShadow.length=xt,_.pointShadowMap.length=xt,_.spotShadow.length=ft,_.spotShadowMap.length=ft,_.directionalShadowMatrix.length=nt,_.pointShadowMatrix.length=xt,_.spotShadowMatrix.length=ft,Xt.directionalLength=oe,Xt.pointLength=de,Xt.spotLength=xe,Xt.rectAreaLength=Re,Xt.hemiLength=we,Xt.numDirectionalShadows=nt,Xt.numPointShadows=xt,Xt.numSpotShadows=ft,_.version=Ua++)},setupView:function(U,G){let K=0,Q=0,ne=0,oe=0,de=0;const xe=G.matrixWorldInverse;for(let Re=0,we=U.length;Re<we;Re++){const nt=U[Re];if(nt.isDirectionalLight){const xt=_.directional[K];xt.direction.setFromMatrixPosition(nt.matrixWorld),M.setFromMatrixPosition(nt.target.matrixWorld),xt.direction.sub(M),xt.direction.transformDirection(xe),K++}else if(nt.isSpotLight){const xt=_.spot[ne];xt.position.setFromMatrixPosition(nt.matrixWorld),xt.position.applyMatrix4(xe),xt.direction.setFromMatrixPosition(nt.matrixWorld),M.setFromMatrixPosition(nt.target.matrixWorld),xt.direction.sub(M),xt.direction.transformDirection(xe),ne++}else if(nt.isRectAreaLight){const xt=_.rectArea[oe];xt.position.setFromMatrixPosition(nt.matrixWorld),xt.position.applyMatrix4(xe),N.identity(),P.copy(nt.matrixWorld),P.premultiply(xe),N.extractRotation(P),xt.halfWidth.set(.5*nt.width,0,0),xt.halfHeight.set(0,.5*nt.height,0),xt.halfWidth.applyMatrix4(N),xt.halfHeight.applyMatrix4(N),oe++}else if(nt.isPointLight){const xt=_.point[Q];xt.position.setFromMatrixPosition(nt.matrixWorld),xt.position.applyMatrix4(xe),Q++}else if(nt.isHemisphereLight){const xt=_.hemi[de];xt.direction.setFromMatrixPosition(nt.matrixWorld),xt.direction.transformDirection(xe),xt.direction.normalize(),de++}}},state:_}}function qd(S,e){const l=new ff(S,e),g=[],_=[];return{init:function(){g.length=0,_.length=0},state:{lightsArray:g,shadowsArray:_,lights:l},setupLights:function(M){l.setup(g,M)},setupLightsView:function(M){l.setupView(g,M)},pushLight:function(M){g.push(M)},pushShadow:function(M){_.push(M)}}}function mf(S,e){let l=new WeakMap;return{get:function(g,_=0){let M;return l.has(g)===!1?(M=new qd(S,e),l.set(g,[M])):_>=l.get(g).length?(M=new qd(S,e),l.get(g).push(M)):M=l.get(g)[_],M},dispose:function(){l=new WeakMap}}}class Kh extends Vi{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Kh.prototype.isMeshDepthMaterial=!0;class oa extends Vi{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new ie,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}oa.prototype.isMeshDistanceMaterial=!0;function Qs(S,e,l){let g=new Sc;const _=new en,M=new en,P=new Dr,N=new Kh({depthPacking:3201}),U=new oa,G={},K=l.maxTextureSize,Q={0:1,1:0,2:2},ne=new ao({uniforms:{shadow_pass:{value:null},resolution:{value:new en},radius:{value:4},samples:{value:8}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
uniform float samples;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),oe=ne.clone();oe.defines.HORIZONTAL_PASS=1;const de=new Pr;de.setAttribute("position",new Or(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const xe=new qn(de,ne),Re=this;function we(ft,Ht){const Xt=e.update(xe);ne.uniforms.shadow_pass.value=ft.map.texture,ne.uniforms.resolution.value=ft.mapSize,ne.uniforms.radius.value=ft.radius,ne.uniforms.samples.value=ft.blurSamples,S.setRenderTarget(ft.mapPass),S.clear(),S.renderBufferDirect(Ht,null,Xt,ne,xe,null),oe.uniforms.shadow_pass.value=ft.mapPass.texture,oe.uniforms.resolution.value=ft.mapSize,oe.uniforms.radius.value=ft.radius,oe.uniforms.samples.value=ft.blurSamples,S.setRenderTarget(ft.map),S.clear(),S.renderBufferDirect(Ht,null,Xt,oe,xe,null)}function nt(ft,Ht,Xt,_i,vi,Bi,Li){let ki=null;const Zn=_i.isPointLight===!0?ft.customDistanceMaterial:ft.customDepthMaterial;if(ki=Zn!==void 0?Zn:_i.isPointLight===!0?U:N,S.localClippingEnabled&&Xt.clipShadows===!0&&Xt.clippingPlanes.length!==0||Xt.displacementMap&&Xt.displacementScale!==0||Xt.alphaMap&&Xt.alphaTest>0){const En=ki.uuid,Ji=Xt.uuid;let In=G[En];In===void 0&&(In={},G[En]=In);let ir=In[Ji];ir===void 0&&(ir=ki.clone(),In[Ji]=ir),ki=ir}return ki.visible=Xt.visible,ki.wireframe=Xt.wireframe,ki.side=Li===3?Xt.shadowSide!==null?Xt.shadowSide:Xt.side:Xt.shadowSide!==null?Xt.shadowSide:Q[Xt.side],ki.alphaMap=Xt.alphaMap,ki.alphaTest=Xt.alphaTest,ki.clipShadows=Xt.clipShadows,ki.clippingPlanes=Xt.clippingPlanes,ki.clipIntersection=Xt.clipIntersection,ki.displacementMap=Xt.displacementMap,ki.displacementScale=Xt.displacementScale,ki.displacementBias=Xt.displacementBias,ki.wireframeLinewidth=Xt.wireframeLinewidth,ki.linewidth=Xt.linewidth,_i.isPointLight===!0&&ki.isMeshDistanceMaterial===!0&&(ki.referencePosition.setFromMatrixPosition(_i.matrixWorld),ki.nearDistance=vi,ki.farDistance=Bi),ki}function xt(ft,Ht,Xt,_i,vi){if(ft.visible===!1)return;if(ft.layers.test(Ht.layers)&&(ft.isMesh||ft.isLine||ft.isPoints)&&(ft.castShadow||ft.receiveShadow&&vi===3)&&(!ft.frustumCulled||g.intersectsObject(ft))){ft.modelViewMatrix.multiplyMatrices(Xt.matrixWorldInverse,ft.matrixWorld);const Li=e.update(ft),ki=ft.material;if(Array.isArray(ki)){const Zn=Li.groups;for(let En=0,Ji=Zn.length;En<Ji;En++){const In=Zn[En],ir=ki[In.materialIndex];if(ir&&ir.visible){const rr=nt(ft,0,ir,_i,Xt.near,Xt.far,vi);S.renderBufferDirect(Xt,null,Li,rr,ft,In)}}}else if(ki.visible){const Zn=nt(ft,0,ki,_i,Xt.near,Xt.far,vi);S.renderBufferDirect(Xt,null,Li,Zn,ft,null)}}const Bi=ft.children;for(let Li=0,ki=Bi.length;Li<ki;Li++)xt(Bi[Li],Ht,Xt,_i,vi)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(ft,Ht,Xt){if(Re.enabled===!1||Re.autoUpdate===!1&&Re.needsUpdate===!1||ft.length===0)return;const _i=S.getRenderTarget(),vi=S.getActiveCubeFace(),Bi=S.getActiveMipmapLevel(),Li=S.state;Li.setBlending(0),Li.buffers.color.setClear(1,1,1,1),Li.buffers.depth.setTest(!0),Li.setScissorTest(!1);for(let ki=0,Zn=ft.length;ki<Zn;ki++){const En=ft[ki],Ji=En.shadow;if(Ji===void 0){console.warn("THREE.WebGLShadowMap:",En,"has no shadow.");continue}if(Ji.autoUpdate===!1&&Ji.needsUpdate===!1)continue;_.copy(Ji.mapSize);const In=Ji.getFrameExtents();if(_.multiply(In),M.copy(Ji.mapSize),(_.x>K||_.y>K)&&(_.x>K&&(M.x=Math.floor(K/In.x),_.x=M.x*In.x,Ji.mapSize.x=M.x),_.y>K&&(M.y=Math.floor(K/In.y),_.y=M.y*In.y,Ji.mapSize.y=M.y)),Ji.map===null&&!Ji.isPointLightShadow&&this.type===3){const rr={minFilter:1006,magFilter:1006,format:1023};Ji.map=new no(_.x,_.y,rr),Ji.map.texture.name=En.name+".shadowMap",Ji.mapPass=new no(_.x,_.y,rr),Ji.camera.updateProjectionMatrix()}if(Ji.map===null){const rr={minFilter:1003,magFilter:1003,format:1023};Ji.map=new no(_.x,_.y,rr),Ji.map.texture.name=En.name+".shadowMap",Ji.camera.updateProjectionMatrix()}S.setRenderTarget(Ji.map),S.clear();const ir=Ji.getViewportCount();for(let rr=0;rr<ir;rr++){const vr=Ji.getViewport(rr);P.set(M.x*vr.x,M.y*vr.y,M.x*vr.z,M.y*vr.w),Li.viewport(P),Ji.updateMatrices(En,rr),g=Ji.getFrustum(),xt(Ht,Xt,Ji.camera,En,this.type)}Ji.isPointLightShadow||this.type!==3||we(Ji,Xt),Ji.needsUpdate=!1}Re.needsUpdate=!1,S.setRenderTarget(_i,vi,Bi)}}function $d(S,e,l){const g=l.isWebGL2,_=new function(){let kt=!1;const Ii=new Dr;let gn=null;const vn=new Dr(0,0,0,0);return{setMask:function(pn){gn===pn||kt||(S.colorMask(pn,pn,pn,pn),gn=pn)},setLocked:function(pn){kt=pn},setClear:function(pn,or,Ar,mr,ns){ns===!0&&(pn*=mr,or*=mr,Ar*=mr),Ii.set(pn,or,Ar,mr),vn.equals(Ii)===!1&&(S.clearColor(pn,or,Ar,mr),vn.copy(Ii))},reset:function(){kt=!1,gn=null,vn.set(-1,0,0,0)}}},M=new function(){let kt=!1,Ii=null,gn=null,vn=null;return{setTest:function(pn){pn?Rn(2929):qt(2929)},setMask:function(pn){Ii===pn||kt||(S.depthMask(pn),Ii=pn)},setFunc:function(pn){if(gn!==pn){if(pn)switch(pn){case 0:S.depthFunc(512);break;case 1:S.depthFunc(519);break;case 2:S.depthFunc(513);break;case 3:S.depthFunc(515);break;case 4:S.depthFunc(514);break;case 5:S.depthFunc(518);break;case 6:S.depthFunc(516);break;case 7:S.depthFunc(517);break;default:S.depthFunc(515)}else S.depthFunc(515);gn=pn}},setLocked:function(pn){kt=pn},setClear:function(pn){vn!==pn&&(S.clearDepth(pn),vn=pn)},reset:function(){kt=!1,Ii=null,gn=null,vn=null}}},P=new function(){let kt=!1,Ii=null,gn=null,vn=null,pn=null,or=null,Ar=null,mr=null,ns=null;return{setTest:function(Kr){kt||(Kr?Rn(2960):qt(2960))},setMask:function(Kr){Ii===Kr||kt||(S.stencilMask(Kr),Ii=Kr)},setFunc:function(Kr,ta,io){gn===Kr&&vn===ta&&pn===io||(S.stencilFunc(Kr,ta,io),gn=Kr,vn=ta,pn=io)},setOp:function(Kr,ta,io){or===Kr&&Ar===ta&&mr===io||(S.stencilOp(Kr,ta,io),or=Kr,Ar=ta,mr=io)},setLocked:function(Kr){kt=Kr},setClear:function(Kr){ns!==Kr&&(S.clearStencil(Kr),ns=Kr)},reset:function(){kt=!1,Ii=null,gn=null,vn=null,pn=null,or=null,Ar=null,mr=null,ns=null}}};let N={},U=null,G={},K=null,Q=!1,ne=null,oe=null,de=null,xe=null,Re=null,we=null,nt=null,xt=!1,ft=null,Ht=null,Xt=null,_i=null,vi=null;const Bi=S.getParameter(35661);let Li=!1,ki=0;const Zn=S.getParameter(7938);Zn.indexOf("WebGL")!==-1?(ki=parseFloat(/^WebGL (\d)/.exec(Zn)[1]),Li=ki>=1):Zn.indexOf("OpenGL ES")!==-1&&(ki=parseFloat(/^OpenGL ES (\d)/.exec(Zn)[1]),Li=ki>=2);let En=null,Ji={};const In=S.getParameter(3088),ir=S.getParameter(2978),rr=new Dr().fromArray(In),vr=new Dr().fromArray(ir);function kr(kt,Ii,gn){const vn=new Uint8Array(4),pn=S.createTexture();S.bindTexture(kt,pn),S.texParameteri(kt,10241,9728),S.texParameteri(kt,10240,9728);for(let or=0;or<gn;or++)S.texImage2D(Ii+or,0,6408,1,1,0,6408,5121,vn);return pn}const Fr={};function Rn(kt){N[kt]!==!0&&(S.enable(kt),N[kt]=!0)}function qt(kt){N[kt]!==!1&&(S.disable(kt),N[kt]=!1)}Fr[3553]=kr(3553,3553,1),Fr[34067]=kr(34067,34069,6),_.setClear(0,0,0,1),M.setClear(1),P.setClear(0),Rn(2929),M.setFunc(3),Oi(!1),Nn(1),Rn(2884),ji(0);const ti={100:32774,101:32778,102:32779};if(g)ti[103]=32775,ti[104]=32776;else{const kt=e.get("EXT_blend_minmax");kt!==null&&(ti[103]=kt.MIN_EXT,ti[104]=kt.MAX_EXT)}const Qi={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function ji(kt,Ii,gn,vn,pn,or,Ar,mr){if(kt!==0){if(Q===!1&&(Rn(3042),Q=!0),kt===5)pn=pn||Ii,or=or||gn,Ar=Ar||vn,Ii===oe&&pn===Re||(S.blendEquationSeparate(ti[Ii],ti[pn]),oe=Ii,Re=pn),gn===de&&vn===xe&&or===we&&Ar===nt||(S.blendFuncSeparate(Qi[gn],Qi[vn],Qi[or],Qi[Ar]),de=gn,xe=vn,we=or,nt=Ar),ne=kt,xt=null;else if(kt!==ne||mr!==xt){if(oe===100&&Re===100||(S.blendEquation(32774),oe=100,Re=100),mr)switch(kt){case 1:S.blendFuncSeparate(1,771,1,771);break;case 2:S.blendFunc(1,1);break;case 3:S.blendFuncSeparate(0,0,769,771);break;case 4:S.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",kt)}else switch(kt){case 1:S.blendFuncSeparate(770,771,1,771);break;case 2:S.blendFunc(770,1);break;case 3:S.blendFunc(0,769);break;case 4:S.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",kt)}de=null,xe=null,we=null,nt=null,ne=kt,xt=mr}}else Q===!0&&(qt(3042),Q=!1)}function Oi(kt){ft!==kt&&(kt?S.frontFace(2304):S.frontFace(2305),ft=kt)}function Nn(kt){kt!==0?(Rn(2884),kt!==Ht&&(kt===1?S.cullFace(1029):kt===2?S.cullFace(1028):S.cullFace(1032))):qt(2884),Ht=kt}function Hn(kt,Ii,gn){kt?(Rn(32823),_i===Ii&&vi===gn||(S.polygonOffset(Ii,gn),_i=Ii,vi=gn)):qt(32823)}function Ni(kt){kt===void 0&&(kt=33984+Bi-1),En!==kt&&(S.activeTexture(kt),En=kt)}return{buffers:{color:_,depth:M,stencil:P},enable:Rn,disable:qt,bindFramebuffer:function(kt,Ii){return Ii===null&&U!==null&&(Ii=U),G[kt]!==Ii&&(S.bindFramebuffer(kt,Ii),G[kt]=Ii,g&&(kt===36009&&(G[36160]=Ii),kt===36160&&(G[36009]=Ii)),!0)},bindXRFramebuffer:function(kt){kt!==U&&(S.bindFramebuffer(36160,kt),U=kt)},useProgram:function(kt){return K!==kt&&(S.useProgram(kt),K=kt,!0)},setBlending:ji,setMaterial:function(kt,Ii){kt.side===2?qt(2884):Rn(2884);let gn=kt.side===1;Ii&&(gn=!gn),Oi(gn),kt.blending===1&&kt.transparent===!1?ji(0):ji(kt.blending,kt.blendEquation,kt.blendSrc,kt.blendDst,kt.blendEquationAlpha,kt.blendSrcAlpha,kt.blendDstAlpha,kt.premultipliedAlpha),M.setFunc(kt.depthFunc),M.setTest(kt.depthTest),M.setMask(kt.depthWrite),_.setMask(kt.colorWrite);const vn=kt.stencilWrite;P.setTest(vn),vn&&(P.setMask(kt.stencilWriteMask),P.setFunc(kt.stencilFunc,kt.stencilRef,kt.stencilFuncMask),P.setOp(kt.stencilFail,kt.stencilZFail,kt.stencilZPass)),Hn(kt.polygonOffset,kt.polygonOffsetFactor,kt.polygonOffsetUnits),kt.alphaToCoverage===!0?Rn(32926):qt(32926)},setFlipSided:Oi,setCullFace:Nn,setLineWidth:function(kt){kt!==Xt&&(Li&&S.lineWidth(kt),Xt=kt)},setPolygonOffset:Hn,setScissorTest:function(kt){kt?Rn(3089):qt(3089)},activeTexture:Ni,bindTexture:function(kt,Ii){En===null&&Ni();let gn=Ji[En];gn===void 0&&(gn={type:void 0,texture:void 0},Ji[En]=gn),gn.type===kt&&gn.texture===Ii||(S.bindTexture(kt,Ii||Fr[kt]),gn.type=kt,gn.texture=Ii)},unbindTexture:function(){const kt=Ji[En];kt!==void 0&&kt.type!==void 0&&(S.bindTexture(kt.type,null),kt.type=void 0,kt.texture=void 0)},compressedTexImage2D:function(){try{S.compressedTexImage2D.apply(S,arguments)}catch(kt){console.error("THREE.WebGLState:",kt)}},texImage2D:function(){try{S.texImage2D.apply(S,arguments)}catch(kt){console.error("THREE.WebGLState:",kt)}},texImage3D:function(){try{S.texImage3D.apply(S,arguments)}catch(kt){console.error("THREE.WebGLState:",kt)}},scissor:function(kt){rr.equals(kt)===!1&&(S.scissor(kt.x,kt.y,kt.z,kt.w),rr.copy(kt))},viewport:function(kt){vr.equals(kt)===!1&&(S.viewport(kt.x,kt.y,kt.z,kt.w),vr.copy(kt))},reset:function(){S.disable(3042),S.disable(2884),S.disable(2929),S.disable(32823),S.disable(3089),S.disable(2960),S.disable(32926),S.blendEquation(32774),S.blendFunc(1,0),S.blendFuncSeparate(1,0,1,0),S.colorMask(!0,!0,!0,!0),S.clearColor(0,0,0,0),S.depthMask(!0),S.depthFunc(513),S.clearDepth(1),S.stencilMask(4294967295),S.stencilFunc(519,0,4294967295),S.stencilOp(7680,7680,7680),S.clearStencil(0),S.cullFace(1029),S.frontFace(2305),S.polygonOffset(0,0),S.activeTexture(33984),S.bindFramebuffer(36160,null),g===!0&&(S.bindFramebuffer(36009,null),S.bindFramebuffer(36008,null)),S.useProgram(null),S.lineWidth(1),S.scissor(0,0,S.canvas.width,S.canvas.height),S.viewport(0,0,S.canvas.width,S.canvas.height),N={},En=null,Ji={},U=null,G={},K=null,Q=!1,ne=null,oe=null,de=null,xe=null,Re=null,we=null,nt=null,xt=!1,ft=null,Ht=null,Xt=null,_i=null,vi=null,rr.set(0,0,S.canvas.width,S.canvas.height),vr.set(0,0,S.canvas.width,S.canvas.height),_.reset(),M.reset(),P.reset()}}}function gf(S,e,l,g,_,M,P){const N=_.isWebGL2,U=_.maxTextures,G=_.maxCubemapSize,K=_.maxTextureSize,Q=_.maxSamples,ne=new WeakMap;let oe,de=!1;try{de=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function xe(qt,ti){return de?new OffscreenCanvas(qt,ti):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function Re(qt,ti,Qi,ji){let Oi=1;if((qt.width>ji||qt.height>ji)&&(Oi=ji/Math.max(qt.width,qt.height)),Oi<1||ti===!0){if(typeof HTMLImageElement<"u"&&qt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&qt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&qt instanceof ImageBitmap){const Nn=ti?eo:Math.floor,Hn=Nn(Oi*qt.width),Ni=Nn(Oi*qt.height);oe===void 0&&(oe=xe(Hn,Ni));const kt=Qi?xe(Hn,Ni):oe;return kt.width=Hn,kt.height=Ni,kt.getContext("2d").drawImage(qt,0,0,Hn,Ni),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+qt.width+"x"+qt.height+") to ("+Hn+"x"+Ni+")."),kt}return"data"in qt&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+qt.width+"x"+qt.height+")."),qt}return qt}function we(qt){return Lr(qt.width)&&Lr(qt.height)}function nt(qt,ti){return qt.generateMipmaps&&ti&&qt.minFilter!==1003&&qt.minFilter!==1006}function xt(qt,ti,Qi,ji,Oi=1){S.generateMipmap(qt),g.get(ti).__maxMipLevel=Math.log2(Math.max(Qi,ji,Oi))}function ft(qt,ti,Qi){if(N===!1)return ti;if(qt!==null){if(S[qt]!==void 0)return S[qt];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+qt+"'")}let ji=ti;return ti===6403&&(Qi===5126&&(ji=33326),Qi===5131&&(ji=33325),Qi===5121&&(ji=33321)),ti===6407&&(Qi===5126&&(ji=34837),Qi===5131&&(ji=34843),Qi===5121&&(ji=32849)),ti===6408&&(Qi===5126&&(ji=34836),Qi===5131&&(ji=34842),Qi===5121&&(ji=32856)),ji!==33325&&ji!==33326&&ji!==34842&&ji!==34836||e.get("EXT_color_buffer_float"),ji}function Ht(qt){return qt===1003||qt===1004||qt===1005?9728:9729}function Xt(qt){const ti=qt.target;ti.removeEventListener("dispose",Xt),function(Qi){const ji=g.get(Qi);ji.__webglInit!==void 0&&(S.deleteTexture(ji.__webglTexture),g.remove(Qi))}(ti),ti.isVideoTexture&&ne.delete(ti),P.memory.textures--}function _i(qt){const ti=qt.target;ti.removeEventListener("dispose",_i),function(Qi){const ji=Qi.texture,Oi=g.get(Qi),Nn=g.get(ji);if(Qi){if(Nn.__webglTexture!==void 0&&(S.deleteTexture(Nn.__webglTexture),P.memory.textures--),Qi.depthTexture&&Qi.depthTexture.dispose(),Qi.isWebGLCubeRenderTarget)for(let Hn=0;Hn<6;Hn++)S.deleteFramebuffer(Oi.__webglFramebuffer[Hn]),Oi.__webglDepthbuffer&&S.deleteRenderbuffer(Oi.__webglDepthbuffer[Hn]);else S.deleteFramebuffer(Oi.__webglFramebuffer),Oi.__webglDepthbuffer&&S.deleteRenderbuffer(Oi.__webglDepthbuffer),Oi.__webglMultisampledFramebuffer&&S.deleteFramebuffer(Oi.__webglMultisampledFramebuffer),Oi.__webglColorRenderbuffer&&S.deleteRenderbuffer(Oi.__webglColorRenderbuffer),Oi.__webglDepthRenderbuffer&&S.deleteRenderbuffer(Oi.__webglDepthRenderbuffer);if(Qi.isWebGLMultipleRenderTargets)for(let Hn=0,Ni=ji.length;Hn<Ni;Hn++){const kt=g.get(ji[Hn]);kt.__webglTexture&&(S.deleteTexture(kt.__webglTexture),P.memory.textures--),g.remove(ji[Hn])}g.remove(ji),g.remove(Qi)}}(ti)}let vi=0;function Bi(qt,ti){const Qi=g.get(qt);if(qt.isVideoTexture&&function(ji){const Oi=P.render.frame;ne.get(ji)!==Oi&&(ne.set(ji,Oi),ji.update())}(qt),qt.version>0&&Qi.__version!==qt.version){const ji=qt.image;if(ji===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(ji.complete!==!1)return void In(Qi,qt,ti);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}l.activeTexture(33984+ti),l.bindTexture(3553,Qi.__webglTexture)}function Li(qt,ti){const Qi=g.get(qt);qt.version>0&&Qi.__version!==qt.version?function(ji,Oi,Nn){if(Oi.image.length!==6)return;Ji(ji,Oi),l.activeTexture(33984+Nn),l.bindTexture(34067,ji.__webglTexture),S.pixelStorei(37440,Oi.flipY),S.pixelStorei(37441,Oi.premultiplyAlpha),S.pixelStorei(3317,Oi.unpackAlignment),S.pixelStorei(37443,0);const Hn=Oi&&(Oi.isCompressedTexture||Oi.image[0].isCompressedTexture),Ni=Oi.image[0]&&Oi.image[0].isDataTexture,kt=[];for(let mr=0;mr<6;mr++)kt[mr]=Hn||Ni?Ni?Oi.image[mr].image:Oi.image[mr]:Re(Oi.image[mr],!1,!0,G);const Ii=kt[0],gn=we(Ii)||N,vn=M.convert(Oi.format),pn=M.convert(Oi.type),or=ft(Oi.internalFormat,vn,pn);let Ar;if(En(34067,Oi,gn),Hn){for(let mr=0;mr<6;mr++){Ar=kt[mr].mipmaps;for(let ns=0;ns<Ar.length;ns++){const Kr=Ar[ns];Oi.format!==1023&&Oi.format!==1022?vn!==null?l.compressedTexImage2D(34069+mr,ns,or,Kr.width,Kr.height,0,Kr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):l.texImage2D(34069+mr,ns,or,Kr.width,Kr.height,0,vn,pn,Kr.data)}}ji.__maxMipLevel=Ar.length-1}else{Ar=Oi.mipmaps;for(let mr=0;mr<6;mr++)if(Ni){l.texImage2D(34069+mr,0,or,kt[mr].width,kt[mr].height,0,vn,pn,kt[mr].data);for(let ns=0;ns<Ar.length;ns++){const Kr=Ar[ns].image[mr].image;l.texImage2D(34069+mr,ns+1,or,Kr.width,Kr.height,0,vn,pn,Kr.data)}}else{l.texImage2D(34069+mr,0,or,vn,pn,kt[mr]);for(let ns=0;ns<Ar.length;ns++){const Kr=Ar[ns];l.texImage2D(34069+mr,ns+1,or,vn,pn,Kr.image[mr])}}ji.__maxMipLevel=Ar.length}nt(Oi,gn)&&xt(34067,Oi,Ii.width,Ii.height),ji.__version=Oi.version,Oi.onUpdate&&Oi.onUpdate(Oi)}(Qi,qt,ti):(l.activeTexture(33984+ti),l.bindTexture(34067,Qi.__webglTexture))}const ki={1e3:10497,1001:33071,1002:33648},Zn={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function En(qt,ti,Qi){if(Qi?(S.texParameteri(qt,10242,ki[ti.wrapS]),S.texParameteri(qt,10243,ki[ti.wrapT]),qt!==32879&&qt!==35866||S.texParameteri(qt,32882,ki[ti.wrapR]),S.texParameteri(qt,10240,Zn[ti.magFilter]),S.texParameteri(qt,10241,Zn[ti.minFilter])):(S.texParameteri(qt,10242,33071),S.texParameteri(qt,10243,33071),qt!==32879&&qt!==35866||S.texParameteri(qt,32882,33071),ti.wrapS===1001&&ti.wrapT===1001||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),S.texParameteri(qt,10240,Ht(ti.magFilter)),S.texParameteri(qt,10241,Ht(ti.minFilter)),ti.minFilter!==1003&&ti.minFilter!==1006&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const ji=e.get("EXT_texture_filter_anisotropic");if(ti.type===1015&&e.has("OES_texture_float_linear")===!1||N===!1&&ti.type===1016&&e.has("OES_texture_half_float_linear")===!1)return;(ti.anisotropy>1||g.get(ti).__currentAnisotropy)&&(S.texParameterf(qt,ji.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ti.anisotropy,_.getMaxAnisotropy())),g.get(ti).__currentAnisotropy=ti.anisotropy)}}function Ji(qt,ti){qt.__webglInit===void 0&&(qt.__webglInit=!0,ti.addEventListener("dispose",Xt),qt.__webglTexture=S.createTexture(),P.memory.textures++)}function In(qt,ti,Qi){let ji=3553;ti.isDataTexture2DArray&&(ji=35866),ti.isDataTexture3D&&(ji=32879),Ji(qt,ti),l.activeTexture(33984+Qi),l.bindTexture(ji,qt.__webglTexture),S.pixelStorei(37440,ti.flipY),S.pixelStorei(37441,ti.premultiplyAlpha),S.pixelStorei(3317,ti.unpackAlignment),S.pixelStorei(37443,0);const Oi=function(pn){return!N&&(pn.wrapS!==1001||pn.wrapT!==1001||pn.minFilter!==1003&&pn.minFilter!==1006)}(ti)&&we(ti.image)===!1,Nn=Re(ti.image,Oi,!1,K),Hn=we(Nn)||N,Ni=M.convert(ti.format);let kt,Ii=M.convert(ti.type),gn=ft(ti.internalFormat,Ni,Ii);En(ji,ti,Hn);const vn=ti.mipmaps;if(ti.isDepthTexture)gn=6402,N?gn=ti.type===1015?36012:ti.type===1014?33190:ti.type===1020?35056:33189:ti.type===1015&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ti.format===1026&&gn===6402&&ti.type!==1012&&ti.type!==1014&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ti.type=1012,Ii=M.convert(ti.type)),ti.format===1027&&gn===6402&&(gn=34041,ti.type!==1020&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ti.type=1020,Ii=M.convert(ti.type))),l.texImage2D(3553,0,gn,Nn.width,Nn.height,0,Ni,Ii,null);else if(ti.isDataTexture)if(vn.length>0&&Hn){for(let pn=0,or=vn.length;pn<or;pn++)kt=vn[pn],l.texImage2D(3553,pn,gn,kt.width,kt.height,0,Ni,Ii,kt.data);ti.generateMipmaps=!1,qt.__maxMipLevel=vn.length-1}else l.texImage2D(3553,0,gn,Nn.width,Nn.height,0,Ni,Ii,Nn.data),qt.__maxMipLevel=0;else if(ti.isCompressedTexture){for(let pn=0,or=vn.length;pn<or;pn++)kt=vn[pn],ti.format!==1023&&ti.format!==1022?Ni!==null?l.compressedTexImage2D(3553,pn,gn,kt.width,kt.height,0,kt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):l.texImage2D(3553,pn,gn,kt.width,kt.height,0,Ni,Ii,kt.data);qt.__maxMipLevel=vn.length-1}else if(ti.isDataTexture2DArray)l.texImage3D(35866,0,gn,Nn.width,Nn.height,Nn.depth,0,Ni,Ii,Nn.data),qt.__maxMipLevel=0;else if(ti.isDataTexture3D)l.texImage3D(32879,0,gn,Nn.width,Nn.height,Nn.depth,0,Ni,Ii,Nn.data),qt.__maxMipLevel=0;else if(vn.length>0&&Hn){for(let pn=0,or=vn.length;pn<or;pn++)kt=vn[pn],l.texImage2D(3553,pn,gn,Ni,Ii,kt);ti.generateMipmaps=!1,qt.__maxMipLevel=vn.length-1}else l.texImage2D(3553,0,gn,Ni,Ii,Nn),qt.__maxMipLevel=0;nt(ti,Hn)&&xt(ji,ti,Nn.width,Nn.height),qt.__version=ti.version,ti.onUpdate&&ti.onUpdate(ti)}function ir(qt,ti,Qi,ji,Oi){const Nn=M.convert(Qi.format),Hn=M.convert(Qi.type),Ni=ft(Qi.internalFormat,Nn,Hn);Oi===32879||Oi===35866?l.texImage3D(Oi,0,Ni,ti.width,ti.height,ti.depth,0,Nn,Hn,null):l.texImage2D(Oi,0,Ni,ti.width,ti.height,0,Nn,Hn,null),l.bindFramebuffer(36160,qt),S.framebufferTexture2D(36160,ji,Oi,g.get(Qi).__webglTexture,0),l.bindFramebuffer(36160,null)}function rr(qt,ti,Qi){if(S.bindRenderbuffer(36161,qt),ti.depthBuffer&&!ti.stencilBuffer){let ji=33189;if(Qi){const Oi=ti.depthTexture;Oi&&Oi.isDepthTexture&&(Oi.type===1015?ji=36012:Oi.type===1014&&(ji=33190));const Nn=kr(ti);S.renderbufferStorageMultisample(36161,Nn,ji,ti.width,ti.height)}else S.renderbufferStorage(36161,ji,ti.width,ti.height);S.framebufferRenderbuffer(36160,36096,36161,qt)}else if(ti.depthBuffer&&ti.stencilBuffer){if(Qi){const ji=kr(ti);S.renderbufferStorageMultisample(36161,ji,35056,ti.width,ti.height)}else S.renderbufferStorage(36161,34041,ti.width,ti.height);S.framebufferRenderbuffer(36160,33306,36161,qt)}else{const ji=ti.isWebGLMultipleRenderTargets===!0?ti.texture[0]:ti.texture,Oi=M.convert(ji.format),Nn=M.convert(ji.type),Hn=ft(ji.internalFormat,Oi,Nn);if(Qi){const Ni=kr(ti);S.renderbufferStorageMultisample(36161,Ni,Hn,ti.width,ti.height)}else S.renderbufferStorage(36161,Hn,ti.width,ti.height)}S.bindRenderbuffer(36161,null)}function vr(qt){const ti=g.get(qt),Qi=qt.isWebGLCubeRenderTarget===!0;if(qt.depthTexture){if(Qi)throw new Error("target.depthTexture not supported in Cube render targets");(function(ji,Oi){if(Oi&&Oi.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(l.bindFramebuffer(36160,ji),!Oi.depthTexture||!Oi.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");g.get(Oi.depthTexture).__webglTexture&&Oi.depthTexture.image.width===Oi.width&&Oi.depthTexture.image.height===Oi.height||(Oi.depthTexture.image.width=Oi.width,Oi.depthTexture.image.height=Oi.height,Oi.depthTexture.needsUpdate=!0),Bi(Oi.depthTexture,0);const Nn=g.get(Oi.depthTexture).__webglTexture;if(Oi.depthTexture.format===1026)S.framebufferTexture2D(36160,36096,3553,Nn,0);else{if(Oi.depthTexture.format!==1027)throw new Error("Unknown depthTexture format");S.framebufferTexture2D(36160,33306,3553,Nn,0)}})(ti.__webglFramebuffer,qt)}else if(Qi){ti.__webglDepthbuffer=[];for(let ji=0;ji<6;ji++)l.bindFramebuffer(36160,ti.__webglFramebuffer[ji]),ti.__webglDepthbuffer[ji]=S.createRenderbuffer(),rr(ti.__webglDepthbuffer[ji],qt,!1)}else l.bindFramebuffer(36160,ti.__webglFramebuffer),ti.__webglDepthbuffer=S.createRenderbuffer(),rr(ti.__webglDepthbuffer,qt,!1);l.bindFramebuffer(36160,null)}function kr(qt){return N&&qt.isWebGLMultisampleRenderTarget?Math.min(Q,qt.samples):0}let Fr=!1,Rn=!1;this.allocateTextureUnit=function(){const qt=vi;return qt>=U&&console.warn("THREE.WebGLTextures: Trying to use "+qt+" texture units while this GPU supports only "+U),vi+=1,qt},this.resetTextureUnits=function(){vi=0},this.setTexture2D=Bi,this.setTexture2DArray=function(qt,ti){const Qi=g.get(qt);qt.version>0&&Qi.__version!==qt.version?In(Qi,qt,ti):(l.activeTexture(33984+ti),l.bindTexture(35866,Qi.__webglTexture))},this.setTexture3D=function(qt,ti){const Qi=g.get(qt);qt.version>0&&Qi.__version!==qt.version?In(Qi,qt,ti):(l.activeTexture(33984+ti),l.bindTexture(32879,Qi.__webglTexture))},this.setTextureCube=Li,this.setupRenderTarget=function(qt){const ti=qt.texture,Qi=g.get(qt),ji=g.get(ti);qt.addEventListener("dispose",_i),qt.isWebGLMultipleRenderTargets!==!0&&(ji.__webglTexture=S.createTexture(),ji.__version=ti.version,P.memory.textures++);const Oi=qt.isWebGLCubeRenderTarget===!0,Nn=qt.isWebGLMultipleRenderTargets===!0,Hn=qt.isWebGLMultisampleRenderTarget===!0,Ni=ti.isDataTexture3D||ti.isDataTexture2DArray,kt=we(qt)||N;if(!N||ti.format!==1022||ti.type!==1015&&ti.type!==1016||(ti.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Oi){Qi.__webglFramebuffer=[];for(let Ii=0;Ii<6;Ii++)Qi.__webglFramebuffer[Ii]=S.createFramebuffer()}else if(Qi.__webglFramebuffer=S.createFramebuffer(),Nn)if(_.drawBuffers){const Ii=qt.texture;for(let gn=0,vn=Ii.length;gn<vn;gn++){const pn=g.get(Ii[gn]);pn.__webglTexture===void 0&&(pn.__webglTexture=S.createTexture(),P.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(Hn)if(N){Qi.__webglMultisampledFramebuffer=S.createFramebuffer(),Qi.__webglColorRenderbuffer=S.createRenderbuffer(),S.bindRenderbuffer(36161,Qi.__webglColorRenderbuffer);const Ii=M.convert(ti.format),gn=M.convert(ti.type),vn=ft(ti.internalFormat,Ii,gn),pn=kr(qt);S.renderbufferStorageMultisample(36161,pn,vn,qt.width,qt.height),l.bindFramebuffer(36160,Qi.__webglMultisampledFramebuffer),S.framebufferRenderbuffer(36160,36064,36161,Qi.__webglColorRenderbuffer),S.bindRenderbuffer(36161,null),qt.depthBuffer&&(Qi.__webglDepthRenderbuffer=S.createRenderbuffer(),rr(Qi.__webglDepthRenderbuffer,qt,!0)),l.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Oi){l.bindTexture(34067,ji.__webglTexture),En(34067,ti,kt);for(let Ii=0;Ii<6;Ii++)ir(Qi.__webglFramebuffer[Ii],qt,ti,36064,34069+Ii);nt(ti,kt)&&xt(34067,ti,qt.width,qt.height),l.unbindTexture()}else if(Nn){const Ii=qt.texture;for(let gn=0,vn=Ii.length;gn<vn;gn++){const pn=Ii[gn],or=g.get(pn);l.bindTexture(3553,or.__webglTexture),En(3553,pn,kt),ir(Qi.__webglFramebuffer,qt,pn,36064+gn,3553),nt(pn,kt)&&xt(3553,pn,qt.width,qt.height)}l.unbindTexture()}else{let Ii=3553;Ni&&(N?Ii=ti.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),l.bindTexture(Ii,ji.__webglTexture),En(Ii,ti,kt),ir(Qi.__webglFramebuffer,qt,ti,36064,Ii),nt(ti,kt)&&xt(Ii,ti,qt.width,qt.height,qt.depth),l.unbindTexture()}qt.depthBuffer&&vr(qt)},this.updateRenderTargetMipmap=function(qt){const ti=we(qt)||N,Qi=qt.isWebGLMultipleRenderTargets===!0?qt.texture:[qt.texture];for(let ji=0,Oi=Qi.length;ji<Oi;ji++){const Nn=Qi[ji];if(nt(Nn,ti)){const Hn=qt.isWebGLCubeRenderTarget?34067:3553,Ni=g.get(Nn).__webglTexture;l.bindTexture(Hn,Ni),xt(Hn,Nn,qt.width,qt.height),l.unbindTexture()}}},this.updateMultisampleRenderTarget=function(qt){if(qt.isWebGLMultisampleRenderTarget)if(N){const ti=qt.width,Qi=qt.height;let ji=16384;qt.depthBuffer&&(ji|=256),qt.stencilBuffer&&(ji|=1024);const Oi=g.get(qt);l.bindFramebuffer(36008,Oi.__webglMultisampledFramebuffer),l.bindFramebuffer(36009,Oi.__webglFramebuffer),S.blitFramebuffer(0,0,ti,Qi,0,0,ti,Qi,ji,9728),l.bindFramebuffer(36008,null),l.bindFramebuffer(36009,Oi.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(qt,ti){qt&&qt.isWebGLRenderTarget&&(Fr===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Fr=!0),qt=qt.texture),Bi(qt,ti)},this.safeSetTextureCube=function(qt,ti){qt&&qt.isWebGLCubeRenderTarget&&(Rn===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Rn=!0),qt=qt.texture),Li(qt,ti)}}function _f(S,e,l){const g=l.isWebGL2;return{convert:function(_){let M;if(_===1009)return 5121;if(_===1017)return 32819;if(_===1018)return 32820;if(_===1019)return 33635;if(_===1010)return 5120;if(_===1011)return 5122;if(_===1012)return 5123;if(_===1013)return 5124;if(_===1014)return 5125;if(_===1015)return 5126;if(_===1016)return g?5131:(M=e.get("OES_texture_half_float"),M!==null?M.HALF_FLOAT_OES:null);if(_===1021)return 6406;if(_===1022)return 6407;if(_===1023)return 6408;if(_===1024)return 6409;if(_===1025)return 6410;if(_===1026)return 6402;if(_===1027)return 34041;if(_===1028)return 6403;if(_===1029)return 36244;if(_===1030)return 33319;if(_===1031)return 33320;if(_===1032)return 36248;if(_===1033)return 36249;if(_===33776||_===33777||_===33778||_===33779){if(M=e.get("WEBGL_compressed_texture_s3tc"),M===null)return null;if(_===33776)return M.COMPRESSED_RGB_S3TC_DXT1_EXT;if(_===33777)return M.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(_===33778)return M.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(_===33779)return M.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(_===35840||_===35841||_===35842||_===35843){if(M=e.get("WEBGL_compressed_texture_pvrtc"),M===null)return null;if(_===35840)return M.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(_===35841)return M.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(_===35842)return M.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(_===35843)return M.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(_===36196)return M=e.get("WEBGL_compressed_texture_etc1"),M!==null?M.COMPRESSED_RGB_ETC1_WEBGL:null;if((_===37492||_===37496)&&(M=e.get("WEBGL_compressed_texture_etc"),M!==null)){if(_===37492)return M.COMPRESSED_RGB8_ETC2;if(_===37496)return M.COMPRESSED_RGBA8_ETC2_EAC}return _===37808||_===37809||_===37810||_===37811||_===37812||_===37813||_===37814||_===37815||_===37816||_===37817||_===37818||_===37819||_===37820||_===37821||_===37840||_===37841||_===37842||_===37843||_===37844||_===37845||_===37846||_===37847||_===37848||_===37849||_===37850||_===37851||_===37852||_===37853?(M=e.get("WEBGL_compressed_texture_astc"),M!==null?_:null):_===36492?(M=e.get("EXT_texture_compression_bptc"),M!==null?_:null):_===1020?g?34042:(M=e.get("WEBGL_depth_texture"),M!==null?M.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Zd extends _o{constructor(e=[]){super(),this.cameras=e}}Zd.prototype.isArrayCamera=!0;class Ic extends Ee{constructor(){super(),this.type="Group"}}Ic.prototype.isGroup=!0;const Ng={type:"move"};class Rc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ic,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ic,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ie,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ie),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ic,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ie,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ie),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,l,g){let _=null,M=null,P=null;const N=this._targetRay,U=this._grip,G=this._hand;if(e&&l.session.visibilityState!=="visible-blurred")if(N!==null&&(_=l.getPose(e.targetRaySpace,g),_!==null&&(N.matrix.fromArray(_.transform.matrix),N.matrix.decompose(N.position,N.rotation,N.scale),_.linearVelocity?(N.hasLinearVelocity=!0,N.linearVelocity.copy(_.linearVelocity)):N.hasLinearVelocity=!1,_.angularVelocity?(N.hasAngularVelocity=!0,N.angularVelocity.copy(_.angularVelocity)):N.hasAngularVelocity=!1,this.dispatchEvent(Ng))),G&&e.hand){P=!0;for(const xe of e.hand.values()){const Re=l.getJointPose(xe,g);if(G.joints[xe.jointName]===void 0){const nt=new Ic;nt.matrixAutoUpdate=!1,nt.visible=!1,G.joints[xe.jointName]=nt,G.add(nt)}const we=G.joints[xe.jointName];Re!==null&&(we.matrix.fromArray(Re.transform.matrix),we.matrix.decompose(we.position,we.rotation,we.scale),we.jointRadius=Re.radius),we.visible=Re!==null}const K=G.joints["index-finger-tip"],Q=G.joints["thumb-tip"],ne=K.position.distanceTo(Q.position),oe=.02,de=.005;G.inputState.pinching&&ne>oe+de?(G.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!G.inputState.pinching&&ne<=oe-de&&(G.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else U!==null&&e.gripSpace&&(M=l.getPose(e.gripSpace,g),M!==null&&(U.matrix.fromArray(M.transform.matrix),U.matrix.decompose(U.position,U.rotation,U.scale),M.linearVelocity?(U.hasLinearVelocity=!0,U.linearVelocity.copy(M.linearVelocity)):U.hasLinearVelocity=!1,M.angularVelocity?(U.hasAngularVelocity=!0,U.angularVelocity.copy(M.angularVelocity)):U.hasAngularVelocity=!1));return N!==null&&(N.visible=_!==null),U!==null&&(U.visible=M!==null),G!==null&&(G.visible=P!==null),this}}class th extends Mt{constructor(e,l){super();const g=this,_=e.state;let M=null,P=1,N=null,U="local-floor",G=null,K=null,Q=null,ne=null,oe=null,de=!1,xe=null,Re=null,we=null,nt=null,xt=null,ft=null;const Ht=[],Xt=new Map,_i=new _o;_i.layers.enable(1),_i.viewport=new Dr;const vi=new _o;vi.layers.enable(2),vi.viewport=new Dr;const Bi=[_i,vi],Li=new Zd;Li.layers.enable(1),Li.layers.enable(2);let ki=null,Zn=null;function En(Rn){const qt=Xt.get(Rn.inputSource);qt&&qt.dispatchEvent({type:Rn.type,data:Rn.inputSource})}function Ji(){Xt.forEach(function(Rn,qt){Rn.disconnect(qt)}),Xt.clear(),ki=null,Zn=null,_.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),Q&&l.deleteFramebuffer(Q),xe&&l.deleteFramebuffer(xe),Re&&l.deleteRenderbuffer(Re),we&&l.deleteRenderbuffer(we),Q=null,xe=null,Re=null,we=null,oe=null,ne=null,K=null,M=null,Fr.stop(),g.isPresenting=!1,g.dispatchEvent({type:"sessionend"})}function In(Rn){const qt=M.inputSources;for(let ti=0;ti<Ht.length;ti++)Xt.set(qt[ti],Ht[ti]);for(let ti=0;ti<Rn.removed.length;ti++){const Qi=Rn.removed[ti],ji=Xt.get(Qi);ji&&(ji.dispatchEvent({type:"disconnected",data:Qi}),Xt.delete(Qi))}for(let ti=0;ti<Rn.added.length;ti++){const Qi=Rn.added[ti],ji=Xt.get(Qi);ji&&ji.dispatchEvent({type:"connected",data:Qi})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Rn){let qt=Ht[Rn];return qt===void 0&&(qt=new Rc,Ht[Rn]=qt),qt.getTargetRaySpace()},this.getControllerGrip=function(Rn){let qt=Ht[Rn];return qt===void 0&&(qt=new Rc,Ht[Rn]=qt),qt.getGripSpace()},this.getHand=function(Rn){let qt=Ht[Rn];return qt===void 0&&(qt=new Rc,Ht[Rn]=qt),qt.getHandSpace()},this.setFramebufferScaleFactor=function(Rn){P=Rn,g.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Rn){U=Rn,g.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return N},this.getBaseLayer=function(){return ne!==null?ne:oe},this.getBinding=function(){return K},this.getFrame=function(){return nt},this.getSession=function(){return M},this.setSession=async function(Rn){if(M=Rn,M!==null){M.addEventListener("select",En),M.addEventListener("selectstart",En),M.addEventListener("selectend",En),M.addEventListener("squeeze",En),M.addEventListener("squeezestart",En),M.addEventListener("squeezeend",En),M.addEventListener("end",Ji),M.addEventListener("inputsourceschange",In);const qt=l.getContextAttributes();if(qt.xrCompatible!==!0&&await l.makeXRCompatible(),M.renderState.layers===void 0){const ti={antialias:qt.antialias,alpha:qt.alpha,depth:qt.depth,stencil:qt.stencil,framebufferScaleFactor:P};oe=new XRWebGLLayer(M,l,ti),M.updateRenderState({baseLayer:oe})}else if(l instanceof WebGLRenderingContext){const ti={antialias:!0,alpha:qt.alpha,depth:qt.depth,stencil:qt.stencil,framebufferScaleFactor:P};oe=new XRWebGLLayer(M,l,ti),M.updateRenderState({layers:[oe]})}else{de=qt.antialias;let ti=null;qt.depth&&(ft=256,qt.stencil&&(ft|=1024),xt=qt.stencil?33306:36096,ti=qt.stencil?35056:33190);const Qi={colorFormat:qt.alpha?32856:32849,depthFormat:ti,scaleFactor:P};K=new XRWebGLBinding(M,l),ne=K.createProjectionLayer(Qi),Q=l.createFramebuffer(),M.updateRenderState({layers:[ne]}),de&&(xe=l.createFramebuffer(),Re=l.createRenderbuffer(),l.bindRenderbuffer(36161,Re),l.renderbufferStorageMultisample(36161,4,32856,ne.textureWidth,ne.textureHeight),_.bindFramebuffer(36160,xe),l.framebufferRenderbuffer(36160,36064,36161,Re),l.bindRenderbuffer(36161,null),ti!==null&&(we=l.createRenderbuffer(),l.bindRenderbuffer(36161,we),l.renderbufferStorageMultisample(36161,4,ti,ne.textureWidth,ne.textureHeight),l.framebufferRenderbuffer(36160,xt,36161,we),l.bindRenderbuffer(36161,null)),_.bindFramebuffer(36160,null))}N=await M.requestReferenceSpace(U),Fr.setContext(M),Fr.start(),g.isPresenting=!0,g.dispatchEvent({type:"sessionstart"})}};const ir=new ie,rr=new ie;function vr(Rn,qt){qt===null?Rn.matrixWorld.copy(Rn.matrix):Rn.matrixWorld.multiplyMatrices(qt.matrixWorld,Rn.matrix),Rn.matrixWorldInverse.copy(Rn.matrixWorld).invert()}this.updateCamera=function(Rn){if(M===null)return;Li.near=vi.near=_i.near=Rn.near,Li.far=vi.far=_i.far=Rn.far,ki===Li.near&&Zn===Li.far||(M.updateRenderState({depthNear:Li.near,depthFar:Li.far}),ki=Li.near,Zn=Li.far);const qt=Rn.parent,ti=Li.cameras;vr(Li,qt);for(let ji=0;ji<ti.length;ji++)vr(ti[ji],qt);Li.matrixWorld.decompose(Li.position,Li.quaternion,Li.scale),Rn.position.copy(Li.position),Rn.quaternion.copy(Li.quaternion),Rn.scale.copy(Li.scale),Rn.matrix.copy(Li.matrix),Rn.matrixWorld.copy(Li.matrixWorld);const Qi=Rn.children;for(let ji=0,Oi=Qi.length;ji<Oi;ji++)Qi[ji].updateMatrixWorld(!0);ti.length===2?function(ji,Oi,Nn){ir.setFromMatrixPosition(Oi.matrixWorld),rr.setFromMatrixPosition(Nn.matrixWorld);const Hn=ir.distanceTo(rr),Ni=Oi.projectionMatrix.elements,kt=Nn.projectionMatrix.elements,Ii=Ni[14]/(Ni[10]-1),gn=Ni[14]/(Ni[10]+1),vn=(Ni[9]+1)/Ni[5],pn=(Ni[9]-1)/Ni[5],or=(Ni[8]-1)/Ni[0],Ar=(kt[8]+1)/kt[0],mr=Ii*or,ns=Ii*Ar,Kr=Hn/(-or+Ar),ta=Kr*-or;Oi.matrixWorld.decompose(ji.position,ji.quaternion,ji.scale),ji.translateX(ta),ji.translateZ(Kr),ji.matrixWorld.compose(ji.position,ji.quaternion,ji.scale),ji.matrixWorldInverse.copy(ji.matrixWorld).invert();const io=Ii+Kr,ia=gn+Kr,rl=mr-ta,vh=ns+(Hn-ta),ud=vn*gn/ia*io,xh=pn*gn/ia*io;ji.projectionMatrix.makePerspective(rl,vh,ud,xh,io,ia)}(Li,_i,vi):Li.projectionMatrix.copy(_i.projectionMatrix)},this.getCamera=function(){return Li},this.getFoveation=function(){return ne!==null?ne.fixedFoveation:oe!==null?oe.fixedFoveation:void 0},this.setFoveation=function(Rn){ne!==null&&(ne.fixedFoveation=Rn),oe!==null&&oe.fixedFoveation!==void 0&&(oe.fixedFoveation=Rn)};let kr=null;const Fr=new kl;Fr.setAnimationLoop(function(Rn,qt){if(G=qt.getViewerPose(N),nt=qt,G!==null){const Qi=G.views;oe!==null&&_.bindXRFramebuffer(oe.framebuffer);let ji=!1;Qi.length!==Li.cameras.length&&(Li.cameras.length=0,ji=!0);for(let Oi=0;Oi<Qi.length;Oi++){const Nn=Qi[Oi];let Hn=null;if(oe!==null)Hn=oe.getViewport(Nn);else{const kt=K.getViewSubImage(ne,Nn);_.bindXRFramebuffer(Q),kt.depthStencilTexture!==void 0&&l.framebufferTexture2D(36160,xt,3553,kt.depthStencilTexture,0),l.framebufferTexture2D(36160,36064,3553,kt.colorTexture,0),Hn=kt.viewport}const Ni=Bi[Oi];Ni.matrix.fromArray(Nn.transform.matrix),Ni.projectionMatrix.fromArray(Nn.projectionMatrix),Ni.viewport.set(Hn.x,Hn.y,Hn.width,Hn.height),Oi===0&&Li.matrix.copy(Ni.matrix),ji===!0&&Li.cameras.push(Ni)}de&&(_.bindXRFramebuffer(xe),ft!==null&&l.clear(ft))}const ti=M.inputSources;for(let Qi=0;Qi<Ht.length;Qi++){const ji=Ht[Qi],Oi=ti[Qi];ji.update(Oi,qt,N)}if(kr&&kr(Rn,qt),de){const Qi=ne.textureWidth,ji=ne.textureHeight;_.bindFramebuffer(36008,xe),_.bindFramebuffer(36009,Q),l.invalidateFramebuffer(36008,[xt]),l.invalidateFramebuffer(36009,[xt]),l.blitFramebuffer(0,0,Qi,ji,0,0,Qi,ji,16384,9728),l.invalidateFramebuffer(36008,[36064]),_.bindFramebuffer(36008,null),_.bindFramebuffer(36009,null),_.bindFramebuffer(36160,xe)}nt=null}),this.setAnimationLoop=function(Rn){kr=Rn},this.dispose=function(){}}}function qi(S){function e(g,_){g.opacity.value=_.opacity,_.color&&g.diffuse.value.copy(_.color),_.emissive&&g.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(g.map.value=_.map),_.alphaMap&&(g.alphaMap.value=_.alphaMap),_.specularMap&&(g.specularMap.value=_.specularMap),_.alphaTest>0&&(g.alphaTest.value=_.alphaTest);const M=S.get(_).envMap;if(M){g.envMap.value=M,g.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=_.reflectivity,g.ior.value=_.ior,g.refractionRatio.value=_.refractionRatio;const U=S.get(M).__maxMipLevel;U!==void 0&&(g.maxMipLevel.value=U)}let P,N;_.lightMap&&(g.lightMap.value=_.lightMap,g.lightMapIntensity.value=_.lightMapIntensity),_.aoMap&&(g.aoMap.value=_.aoMap,g.aoMapIntensity.value=_.aoMapIntensity),_.map?P=_.map:_.specularMap?P=_.specularMap:_.displacementMap?P=_.displacementMap:_.normalMap?P=_.normalMap:_.bumpMap?P=_.bumpMap:_.roughnessMap?P=_.roughnessMap:_.metalnessMap?P=_.metalnessMap:_.alphaMap?P=_.alphaMap:_.emissiveMap?P=_.emissiveMap:_.clearcoatMap?P=_.clearcoatMap:_.clearcoatNormalMap?P=_.clearcoatNormalMap:_.clearcoatRoughnessMap?P=_.clearcoatRoughnessMap:_.specularIntensityMap?P=_.specularIntensityMap:_.specularTintMap?P=_.specularTintMap:_.transmissionMap?P=_.transmissionMap:_.thicknessMap&&(P=_.thicknessMap),P!==void 0&&(P.isWebGLRenderTarget&&(P=P.texture),P.matrixAutoUpdate===!0&&P.updateMatrix(),g.uvTransform.value.copy(P.matrix)),_.aoMap?N=_.aoMap:_.lightMap&&(N=_.lightMap),N!==void 0&&(N.isWebGLRenderTarget&&(N=N.texture),N.matrixAutoUpdate===!0&&N.updateMatrix(),g.uv2Transform.value.copy(N.matrix))}function l(g,_){g.roughness.value=_.roughness,g.metalness.value=_.metalness,_.roughnessMap&&(g.roughnessMap.value=_.roughnessMap),_.metalnessMap&&(g.metalnessMap.value=_.metalnessMap),_.emissiveMap&&(g.emissiveMap.value=_.emissiveMap),_.bumpMap&&(g.bumpMap.value=_.bumpMap,g.bumpScale.value=_.bumpScale,_.side===1&&(g.bumpScale.value*=-1)),_.normalMap&&(g.normalMap.value=_.normalMap,g.normalScale.value.copy(_.normalScale),_.side===1&&g.normalScale.value.negate()),_.displacementMap&&(g.displacementMap.value=_.displacementMap,g.displacementScale.value=_.displacementScale,g.displacementBias.value=_.displacementBias),S.get(_).envMap&&(g.envMapIntensity.value=_.envMapIntensity)}return{refreshFogUniforms:function(g,_){g.fogColor.value.copy(_.color),_.isFog?(g.fogNear.value=_.near,g.fogFar.value=_.far):_.isFogExp2&&(g.fogDensity.value=_.density)},refreshMaterialUniforms:function(g,_,M,P,N){_.isMeshBasicMaterial?e(g,_):_.isMeshLambertMaterial?(e(g,_),function(U,G){G.emissiveMap&&(U.emissiveMap.value=G.emissiveMap)}(g,_)):_.isMeshToonMaterial?(e(g,_),function(U,G){G.gradientMap&&(U.gradientMap.value=G.gradientMap),G.emissiveMap&&(U.emissiveMap.value=G.emissiveMap),G.bumpMap&&(U.bumpMap.value=G.bumpMap,U.bumpScale.value=G.bumpScale,G.side===1&&(U.bumpScale.value*=-1)),G.normalMap&&(U.normalMap.value=G.normalMap,U.normalScale.value.copy(G.normalScale),G.side===1&&U.normalScale.value.negate()),G.displacementMap&&(U.displacementMap.value=G.displacementMap,U.displacementScale.value=G.displacementScale,U.displacementBias.value=G.displacementBias)}(g,_)):_.isMeshPhongMaterial?(e(g,_),function(U,G){U.specular.value.copy(G.specular),U.shininess.value=Math.max(G.shininess,1e-4),G.emissiveMap&&(U.emissiveMap.value=G.emissiveMap),G.bumpMap&&(U.bumpMap.value=G.bumpMap,U.bumpScale.value=G.bumpScale,G.side===1&&(U.bumpScale.value*=-1)),G.normalMap&&(U.normalMap.value=G.normalMap,U.normalScale.value.copy(G.normalScale),G.side===1&&U.normalScale.value.negate()),G.displacementMap&&(U.displacementMap.value=G.displacementMap,U.displacementScale.value=G.displacementScale,U.displacementBias.value=G.displacementBias)}(g,_)):_.isMeshStandardMaterial?(e(g,_),_.isMeshPhysicalMaterial?function(U,G,K){l(U,G),U.ior.value=G.ior,G.sheenTint&&U.sheenTint.value.copy(G.sheenTint),G.clearcoat>0&&(U.clearcoat.value=G.clearcoat,U.clearcoatRoughness.value=G.clearcoatRoughness,G.clearcoatMap&&(U.clearcoatMap.value=G.clearcoatMap),G.clearcoatRoughnessMap&&(U.clearcoatRoughnessMap.value=G.clearcoatRoughnessMap),G.clearcoatNormalMap&&(U.clearcoatNormalScale.value.copy(G.clearcoatNormalScale),U.clearcoatNormalMap.value=G.clearcoatNormalMap,G.side===1&&U.clearcoatNormalScale.value.negate())),G.transmission>0&&(U.transmission.value=G.transmission,U.transmissionSamplerMap.value=K.texture,U.transmissionSamplerSize.value.set(K.width,K.height),G.transmissionMap&&(U.transmissionMap.value=G.transmissionMap),U.thickness.value=G.thickness,G.thicknessMap&&(U.thicknessMap.value=G.thicknessMap),U.attenuationDistance.value=G.attenuationDistance,U.attenuationTint.value.copy(G.attenuationTint)),U.specularIntensity.value=G.specularIntensity,U.specularTint.value.copy(G.specularTint),G.specularIntensityMap&&(U.specularIntensityMap.value=G.specularIntensityMap),G.specularTintMap&&(U.specularTintMap.value=G.specularTintMap)}(g,_,N):l(g,_)):_.isMeshMatcapMaterial?(e(g,_),function(U,G){G.matcap&&(U.matcap.value=G.matcap),G.bumpMap&&(U.bumpMap.value=G.bumpMap,U.bumpScale.value=G.bumpScale,G.side===1&&(U.bumpScale.value*=-1)),G.normalMap&&(U.normalMap.value=G.normalMap,U.normalScale.value.copy(G.normalScale),G.side===1&&U.normalScale.value.negate()),G.displacementMap&&(U.displacementMap.value=G.displacementMap,U.displacementScale.value=G.displacementScale,U.displacementBias.value=G.displacementBias)}(g,_)):_.isMeshDepthMaterial?(e(g,_),function(U,G){G.displacementMap&&(U.displacementMap.value=G.displacementMap,U.displacementScale.value=G.displacementScale,U.displacementBias.value=G.displacementBias)}(g,_)):_.isMeshDistanceMaterial?(e(g,_),function(U,G){G.displacementMap&&(U.displacementMap.value=G.displacementMap,U.displacementScale.value=G.displacementScale,U.displacementBias.value=G.displacementBias),U.referencePosition.value.copy(G.referencePosition),U.nearDistance.value=G.nearDistance,U.farDistance.value=G.farDistance}(g,_)):_.isMeshNormalMaterial?(e(g,_),function(U,G){G.bumpMap&&(U.bumpMap.value=G.bumpMap,U.bumpScale.value=G.bumpScale,G.side===1&&(U.bumpScale.value*=-1)),G.normalMap&&(U.normalMap.value=G.normalMap,U.normalScale.value.copy(G.normalScale),G.side===1&&U.normalScale.value.negate()),G.displacementMap&&(U.displacementMap.value=G.displacementMap,U.displacementScale.value=G.displacementScale,U.displacementBias.value=G.displacementBias)}(g,_)):_.isLineBasicMaterial?(function(U,G){U.diffuse.value.copy(G.color),U.opacity.value=G.opacity}(g,_),_.isLineDashedMaterial&&function(U,G){U.dashSize.value=G.dashSize,U.totalSize.value=G.dashSize+G.gapSize,U.scale.value=G.scale}(g,_)):_.isPointsMaterial?function(U,G,K,Q){U.diffuse.value.copy(G.color),U.opacity.value=G.opacity,U.size.value=G.size*K,U.scale.value=.5*Q,G.map&&(U.map.value=G.map),G.alphaMap&&(U.alphaMap.value=G.alphaMap),G.alphaTest>0&&(U.alphaTest.value=G.alphaTest);let ne;G.map?ne=G.map:G.alphaMap&&(ne=G.alphaMap),ne!==void 0&&(ne.matrixAutoUpdate===!0&&ne.updateMatrix(),U.uvTransform.value.copy(ne.matrix))}(g,_,M,P):_.isSpriteMaterial?function(U,G){U.diffuse.value.copy(G.color),U.opacity.value=G.opacity,U.rotation.value=G.rotation,G.map&&(U.map.value=G.map),G.alphaMap&&(U.alphaMap.value=G.alphaMap),G.alphaTest>0&&(U.alphaTest.value=G.alphaTest);let K;G.map?K=G.map:G.alphaMap&&(K=G.alphaMap),K!==void 0&&(K.matrixAutoUpdate===!0&&K.updateMatrix(),U.uvTransform.value.copy(K.matrix))}(g,_):_.isShadowMaterial?(g.color.value.copy(_.color),g.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}}}function yn(S={}){const e=S.canvas!==void 0?S.canvas:function(){const jt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return jt.style.display="block",jt}(),l=S.context!==void 0?S.context:null,g=S.alpha!==void 0&&S.alpha,_=S.depth===void 0||S.depth,M=S.stencil===void 0||S.stencil,P=S.antialias!==void 0&&S.antialias,N=S.premultipliedAlpha===void 0||S.premultipliedAlpha,U=S.preserveDrawingBuffer!==void 0&&S.preserveDrawingBuffer,G=S.powerPreference!==void 0?S.powerPreference:"default",K=S.failIfMajorPerformanceCaveat!==void 0&&S.failIfMajorPerformanceCaveat;let Q=null,ne=null;const oe=[],de=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const xe=this;let Re=!1,we=0,nt=0,xt=null,ft=-1,Ht=null;const Xt=new Dr,_i=new Dr;let vi=null,Bi=e.width,Li=e.height,ki=1,Zn=null,En=null;const Ji=new Dr(0,0,Bi,Li),In=new Dr(0,0,Bi,Li);let ir=!1;const rr=[],vr=new Sc;let kr=!1,Fr=!1,Rn=null;const qt=new nr,ti=new ie,Qi={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ji(){return xt===null?ki:1}let Oi,Nn,Hn,Ni,kt,Ii,gn,vn,pn,or,Ar,mr,ns,Kr,ta,io,ia,rl,vh,ud,xh,Sl,la,Bn=l;function r_(jt,rn){for(let Ri=0;Ri<jt.length;Ri++){const sn=jt[Ri],On=e.getContext(sn,rn);if(On!==null)return On}return null}try{const jt={alpha:g,depth:_,stencil:M,antialias:P,premultipliedAlpha:N,preserveDrawingBuffer:U,powerPreference:G,failIfMajorPerformanceCaveat:K};if(e.addEventListener("webglcontextlost",Sy,!1),e.addEventListener("webglcontextrestored",Ey,!1),Bn===null){const rn=["webgl2","webgl","experimental-webgl"];if(xe.isWebGL1Renderer===!0&&rn.shift(),Bn=r_(rn,jt),Bn===null)throw r_(rn)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Bn.getShaderPrecisionFormat===void 0&&(Bn.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(jt){throw console.error("THREE.WebGLRenderer: "+jt.message),jt}function My(){Oi=new cm(Bn),Nn=new jp(Bn,Oi,S),Oi.init(Nn),Sl=new _f(Bn,Oi,Nn),Hn=new $d(Bn,Oi,Nn),rr[0]=1029,Ni=new qu,kt=new Bg,Ii=new gf(Bn,Oi,Hn,kt,Nn,Sl,Ni),gn=new Id(xe),vn=new Gh(xe),pn=new Hp(Bn,Nn),la=new Na(Bn,Oi,pn,Nn),or=new um(Bn,pn,Ni,la),Ar=new Dg(Bn,or,pn,Ni),vh=new Pg(Bn),io=new Wp(kt),mr=new Em(xe,gn,vn,Oi,Nn,la,io),ns=new qi(kt),Kr=new Wd(kt),ta=new mf(Oi,Nn),rl=new am(xe,gn,Hn,Ar,N),ia=new Qs(xe,Ar,Nn),ud=new lm(Bn,Oi,Ni,Nn),xh=new hm(Bn,Oi,Ni,Nn),Ni.programs=mr.programs,xe.capabilities=Nn,xe.extensions=Oi,xe.properties=kt,xe.renderLists=Kr,xe.shadowMap=ia,xe.state=Hn,xe.info=Ni}My();const El=new th(xe,Bn);function Sy(jt){jt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Re=!0}function Ey(){console.log("THREE.WebGLRenderer: Context Restored."),Re=!1;const jt=Ni.autoReset,rn=ia.enabled,Ri=ia.autoUpdate,sn=ia.needsUpdate,On=ia.type;My(),Ni.autoReset=jt,ia.enabled=rn,ia.autoUpdate=Ri,ia.needsUpdate=sn,ia.type=On}function Ay(jt){const rn=jt.target;rn.removeEventListener("dispose",Ay),function(Ri){(function(sn){const On=kt.get(sn).programs;On!==void 0&&On.forEach(function(qr){mr.releaseProgram(qr)})})(Ri),kt.remove(Ri)}(rn)}this.xr=El,this.getContext=function(){return Bn},this.getContextAttributes=function(){return Bn.getContextAttributes()},this.forceContextLoss=function(){const jt=Oi.get("WEBGL_lose_context");jt&&jt.loseContext()},this.forceContextRestore=function(){const jt=Oi.get("WEBGL_lose_context");jt&&jt.restoreContext()},this.getPixelRatio=function(){return ki},this.setPixelRatio=function(jt){jt!==void 0&&(ki=jt,this.setSize(Bi,Li,!1))},this.getSize=function(jt){return jt.set(Bi,Li)},this.setSize=function(jt,rn,Ri){El.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Bi=jt,Li=rn,e.width=Math.floor(jt*ki),e.height=Math.floor(rn*ki),Ri!==!1&&(e.style.width=jt+"px",e.style.height=rn+"px"),this.setViewport(0,0,jt,rn))},this.getDrawingBufferSize=function(jt){return jt.set(Bi*ki,Li*ki).floor()},this.setDrawingBufferSize=function(jt,rn,Ri){Bi=jt,Li=rn,ki=Ri,e.width=Math.floor(jt*Ri),e.height=Math.floor(rn*Ri),this.setViewport(0,0,jt,rn)},this.getCurrentViewport=function(jt){return jt.copy(Xt)},this.getViewport=function(jt){return jt.copy(Ji)},this.setViewport=function(jt,rn,Ri,sn){jt.isVector4?Ji.set(jt.x,jt.y,jt.z,jt.w):Ji.set(jt,rn,Ri,sn),Hn.viewport(Xt.copy(Ji).multiplyScalar(ki).floor())},this.getScissor=function(jt){return jt.copy(In)},this.setScissor=function(jt,rn,Ri,sn){jt.isVector4?In.set(jt.x,jt.y,jt.z,jt.w):In.set(jt,rn,Ri,sn),Hn.scissor(_i.copy(In).multiplyScalar(ki).floor())},this.getScissorTest=function(){return ir},this.setScissorTest=function(jt){Hn.setScissorTest(ir=jt)},this.setOpaqueSort=function(jt){Zn=jt},this.setTransparentSort=function(jt){En=jt},this.getClearColor=function(jt){return jt.copy(rl.getClearColor())},this.setClearColor=function(){rl.setClearColor.apply(rl,arguments)},this.getClearAlpha=function(){return rl.getClearAlpha()},this.setClearAlpha=function(){rl.setClearAlpha.apply(rl,arguments)},this.clear=function(jt,rn,Ri){let sn=0;(jt===void 0||jt)&&(sn|=16384),(rn===void 0||rn)&&(sn|=256),(Ri===void 0||Ri)&&(sn|=1024),Bn.clear(sn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Sy,!1),e.removeEventListener("webglcontextrestored",Ey,!1),Kr.dispose(),ta.dispose(),kt.dispose(),gn.dispose(),vn.dispose(),Ar.dispose(),la.dispose(),El.dispose(),El.removeEventListener("sessionstart",Cy),El.removeEventListener("sessionend",o_),Rn&&(Rn.dispose(),Rn=null),hd.stop()},this.renderBufferImmediate=function(jt,rn){la.initAttributes();const Ri=kt.get(jt);jt.hasPositions&&!Ri.position&&(Ri.position=Bn.createBuffer()),jt.hasNormals&&!Ri.normal&&(Ri.normal=Bn.createBuffer()),jt.hasUvs&&!Ri.uv&&(Ri.uv=Bn.createBuffer()),jt.hasColors&&!Ri.color&&(Ri.color=Bn.createBuffer());const sn=rn.getAttributes();jt.hasPositions&&(Bn.bindBuffer(34962,Ri.position),Bn.bufferData(34962,jt.positionArray,35048),la.enableAttribute(sn.position.location),Bn.vertexAttribPointer(sn.position.location,3,5126,!1,0,0)),jt.hasNormals&&(Bn.bindBuffer(34962,Ri.normal),Bn.bufferData(34962,jt.normalArray,35048),la.enableAttribute(sn.normal.location),Bn.vertexAttribPointer(sn.normal.location,3,5126,!1,0,0)),jt.hasUvs&&(Bn.bindBuffer(34962,Ri.uv),Bn.bufferData(34962,jt.uvArray,35048),la.enableAttribute(sn.uv.location),Bn.vertexAttribPointer(sn.uv.location,2,5126,!1,0,0)),jt.hasColors&&(Bn.bindBuffer(34962,Ri.color),Bn.bufferData(34962,jt.colorArray,35048),la.enableAttribute(sn.color.location),Bn.vertexAttribPointer(sn.color.location,3,5126,!1,0,0)),la.disableUnusedAttributes(),Bn.drawArrays(4,0,jt.count),jt.count=0},this.renderBufferDirect=function(jt,rn,Ri,sn,On,qr){rn===null&&(rn=Qi);const Mr=On.isMesh&&On.matrixWorld.determinant()<0,rs=c_(jt,rn,sn,On);Hn.setMaterial(sn,Mr);let cs=Ri.index;const so=Ri.attributes.position;if(cs===null){if(so===void 0||so.count===0)return}else if(cs.count===0)return;let $s,As=1;sn.wireframe===!0&&(cs=or.getWireframeAttribute(Ri),As=2),Ri.morphAttributes.position===void 0&&Ri.morphAttributes.normal===void 0||vh.update(On,Ri,sn,rs),la.setup(On,sn,rs,Ri,cs);let ss=ud;cs!==null&&($s=pn.get(cs),ss=xh,ss.setIndex($s));const dd=cs!==null?cs.count:so.count,ko=Ri.drawRange.start*As,bh=Ri.drawRange.count*As,lc=qr!==null?qr.start*As:0,wh=qr!==null?qr.count*As:1/0,Th=Math.max(ko,lc),zs=Math.min(dd,ko+bh,lc+wh)-1,Zo=Math.max(0,zs-Th+1);if(Zo!==0){if(On.isMesh)sn.wireframe===!0?(Hn.setLineWidth(sn.wireframeLinewidth*ji()),ss.setMode(1)):ss.setMode(4);else if(On.isLine){let ca=sn.linewidth;ca===void 0&&(ca=1),Hn.setLineWidth(ca*ji()),On.isLineSegments?ss.setMode(1):On.isLineLoop?ss.setMode(2):ss.setMode(3)}else On.isPoints?ss.setMode(0):On.isSprite&&ss.setMode(4);if(On.isInstancedMesh)ss.renderInstances(Th,Zo,On.count);else if(Ri.isInstancedBufferGeometry){const ca=Math.min(Ri.instanceCount,Ri._maxInstanceCount);ss.renderInstances(Th,Zo,ca)}else ss.render(Th,Zo)}},this.compile=function(jt,rn){ne=ta.get(jt),ne.init(),de.push(ne),jt.traverseVisible(function(Ri){Ri.isLight&&Ri.layers.test(rn.layers)&&(ne.pushLight(Ri),Ri.castShadow&&ne.pushShadow(Ri))}),ne.setupLights(xe.physicallyCorrectLights),jt.traverse(function(Ri){const sn=Ri.material;if(sn)if(Array.isArray(sn))for(let On=0;On<sn.length;On++)Bm(sn[On],jt,Ri);else Bm(sn,jt,Ri)}),de.pop(),ne=null};let s_=null;function Cy(){hd.stop()}function o_(){hd.start()}const hd=new kl;function Ly(jt,rn,Ri,sn){if(jt.visible===!1)return;if(jt.layers.test(rn.layers)){if(jt.isGroup)Ri=jt.renderOrder;else if(jt.isLOD)jt.autoUpdate===!0&&jt.update(rn);else if(jt.isLight)ne.pushLight(jt),jt.castShadow&&ne.pushShadow(jt);else if(jt.isSprite){if(!jt.frustumCulled||vr.intersectsSprite(jt)){sn&&ti.setFromMatrixPosition(jt.matrixWorld).applyMatrix4(qt);const qr=Ar.update(jt),Mr=jt.material;Mr.visible&&Q.push(jt,qr,Mr,Ri,ti.z,null)}}else if(jt.isImmediateRenderObject)sn&&ti.setFromMatrixPosition(jt.matrixWorld).applyMatrix4(qt),Q.push(jt,null,jt.material,Ri,ti.z,null);else if((jt.isMesh||jt.isLine||jt.isPoints)&&(jt.isSkinnedMesh&&jt.skeleton.frame!==Ni.render.frame&&(jt.skeleton.update(),jt.skeleton.frame=Ni.render.frame),!jt.frustumCulled||vr.intersectsObject(jt))){sn&&ti.setFromMatrixPosition(jt.matrixWorld).applyMatrix4(qt);const qr=Ar.update(jt),Mr=jt.material;if(Array.isArray(Mr)){const rs=qr.groups;for(let cs=0,so=rs.length;cs<so;cs++){const $s=rs[cs],As=Mr[$s.materialIndex];As&&As.visible&&Q.push(jt,qr,As,Ri,ti.z,$s)}}else Mr.visible&&Q.push(jt,qr,Mr,Ri,ti.z,null)}}const On=jt.children;for(let qr=0,Mr=On.length;qr<Mr;qr++)Ly(On[qr],rn,Ri,sn)}function Iy(jt,rn,Ri,sn){const On=jt.opaque,qr=jt.transmissive,Mr=jt.transparent;ne.setupLightsView(Ri),qr.length>0&&function(rs,cs,so){if(Rn===null){const ss=P===!0&&Nn.isWebGL2===!0;Rn=new(ss?oi:no)(1024,1024,{generateMipmaps:!0,type:Sl.convert(1016)!==null?1016:1009,minFilter:1008,magFilter:1003,wrapS:1001,wrapT:1001})}const $s=xe.getRenderTarget();xe.setRenderTarget(Rn),xe.clear();const As=xe.toneMapping;xe.toneMapping=0,gp(rs,cs,so),xe.toneMapping=As,Ii.updateMultisampleRenderTarget(Rn),Ii.updateRenderTargetMipmap(Rn),xe.setRenderTarget($s)}(On,rn,Ri),sn&&Hn.viewport(Xt.copy(sn)),On.length>0&&gp(On,rn,Ri),qr.length>0&&gp(qr,rn,Ri),Mr.length>0&&gp(Mr,rn,Ri)}function gp(jt,rn,Ri){const sn=rn.isScene===!0?rn.overrideMaterial:null;for(let On=0,qr=jt.length;On<qr;On++){const Mr=jt[On],rs=Mr.object,cs=Mr.geometry,so=sn===null?Mr.material:sn,$s=Mr.group;rs.layers.test(Ri.layers)&&a_(rs,rn,Ri,cs,so,$s)}}function a_(jt,rn,Ri,sn,On,qr){if(jt.onBeforeRender(xe,rn,Ri,sn,On,qr),jt.modelViewMatrix.multiplyMatrices(Ri.matrixWorldInverse,jt.matrixWorld),jt.normalMatrix.getNormalMatrix(jt.modelViewMatrix),jt.isImmediateRenderObject){const Mr=c_(Ri,rn,On,jt);Hn.setMaterial(On),la.reset(),function(rs,cs){rs.render(function(so){xe.renderBufferImmediate(so,cs)})}(jt,Mr)}else On.transparent===!0&&On.side===2?(On.side=1,On.needsUpdate=!0,xe.renderBufferDirect(Ri,rn,sn,On,jt,qr),On.side=0,On.needsUpdate=!0,xe.renderBufferDirect(Ri,rn,sn,On,jt,qr),On.side=2):xe.renderBufferDirect(Ri,rn,sn,On,jt,qr);jt.onAfterRender(xe,rn,Ri,sn,On,qr)}function Bm(jt,rn,Ri){rn.isScene!==!0&&(rn=Qi);const sn=kt.get(jt),On=ne.state.lights,qr=ne.state.shadowsArray,Mr=On.state.version,rs=mr.getParameters(jt,On.state,qr,rn,Ri),cs=mr.getProgramCacheKey(rs);let so=sn.programs;sn.environment=jt.isMeshStandardMaterial?rn.environment:null,sn.fog=rn.fog,sn.envMap=(jt.isMeshStandardMaterial?vn:gn).get(jt.envMap||sn.environment),so===void 0&&(jt.addEventListener("dispose",Ay),so=new Map,sn.programs=so);let $s=so.get(cs);if($s!==void 0){if(sn.currentProgram===$s&&sn.lightsStateVersion===Mr)return l_(jt,rs),$s}else rs.uniforms=mr.getUniforms(jt),jt.onBuild(rs,xe),jt.onBeforeCompile(rs,xe),$s=mr.acquireProgram(rs,cs),so.set(cs,$s),sn.uniforms=rs.uniforms;const As=sn.uniforms;(jt.isShaderMaterial||jt.isRawShaderMaterial)&&jt.clipping!==!0||(As.clippingPlanes=io.uniform),l_(jt,rs),sn.needsLights=function(ko){return ko.isMeshLambertMaterial||ko.isMeshToonMaterial||ko.isMeshPhongMaterial||ko.isMeshStandardMaterial||ko.isShadowMaterial||ko.isShaderMaterial&&ko.lights===!0}(jt),sn.lightsStateVersion=Mr,sn.needsLights&&(As.ambientLightColor.value=On.state.ambient,As.lightProbe.value=On.state.probe,As.directionalLights.value=On.state.directional,As.directionalLightShadows.value=On.state.directionalShadow,As.spotLights.value=On.state.spot,As.spotLightShadows.value=On.state.spotShadow,As.rectAreaLights.value=On.state.rectArea,As.ltc_1.value=On.state.rectAreaLTC1,As.ltc_2.value=On.state.rectAreaLTC2,As.pointLights.value=On.state.point,As.pointLightShadows.value=On.state.pointShadow,As.hemisphereLights.value=On.state.hemi,As.directionalShadowMap.value=On.state.directionalShadowMap,As.directionalShadowMatrix.value=On.state.directionalShadowMatrix,As.spotShadowMap.value=On.state.spotShadowMap,As.spotShadowMatrix.value=On.state.spotShadowMatrix,As.pointShadowMap.value=On.state.pointShadowMap,As.pointShadowMatrix.value=On.state.pointShadowMatrix);const ss=$s.getUniforms(),dd=el.seqWithValue(ss.seq,As);return sn.currentProgram=$s,sn.uniformsList=dd,$s}function l_(jt,rn){const Ri=kt.get(jt);Ri.outputEncoding=rn.outputEncoding,Ri.instancing=rn.instancing,Ri.skinning=rn.skinning,Ri.morphTargets=rn.morphTargets,Ri.morphNormals=rn.morphNormals,Ri.numClippingPlanes=rn.numClippingPlanes,Ri.numIntersection=rn.numClipIntersection,Ri.vertexAlphas=rn.vertexAlphas,Ri.vertexTangents=rn.vertexTangents}function c_(jt,rn,Ri,sn){rn.isScene!==!0&&(rn=Qi),Ii.resetTextureUnits();const On=rn.fog,qr=Ri.isMeshStandardMaterial?rn.environment:null,Mr=xt===null?xe.outputEncoding:xt.texture.encoding,rs=(Ri.isMeshStandardMaterial?vn:gn).get(Ri.envMap||qr),cs=Ri.vertexColors===!0&&!!sn.geometry&&!!sn.geometry.attributes.color&&sn.geometry.attributes.color.itemSize===4,so=!!sn.geometry&&!!sn.geometry.attributes.tangent,$s=!!sn.geometry&&!!sn.geometry.morphAttributes.position,As=!!sn.geometry&&!!sn.geometry.morphAttributes.normal,ss=kt.get(Ri),dd=ne.state.lights;if(kr===!0&&(Fr===!0||jt!==Ht)){const Da=jt===Ht&&Ri.id===ft;io.setState(Ri,jt,Da)}let ko=!1;Ri.version===ss.__version?ss.needsLights&&ss.lightsStateVersion!==dd.state.version||ss.outputEncoding!==Mr||sn.isInstancedMesh&&ss.instancing===!1?ko=!0:sn.isInstancedMesh||ss.instancing!==!0?sn.isSkinnedMesh&&ss.skinning===!1?ko=!0:sn.isSkinnedMesh||ss.skinning!==!0?ss.envMap!==rs||Ri.fog&&ss.fog!==On?ko=!0:ss.numClippingPlanes===void 0||ss.numClippingPlanes===io.numPlanes&&ss.numIntersection===io.numIntersection?(ss.vertexAlphas!==cs||ss.vertexTangents!==so||ss.morphTargets!==$s||ss.morphNormals!==As)&&(ko=!0):ko=!0:ko=!0:ko=!0:(ko=!0,ss.__version=Ri.version);let bh=ss.currentProgram;ko===!0&&(bh=Bm(Ri,rn,sn));let lc=!1,wh=!1,Th=!1;const zs=bh.getUniforms(),Zo=ss.uniforms;if(Hn.useProgram(bh.program)&&(lc=!0,wh=!0,Th=!0),Ri.id!==ft&&(ft=Ri.id,wh=!0),lc||Ht!==jt){if(zs.setValue(Bn,"projectionMatrix",jt.projectionMatrix),Nn.logarithmicDepthBuffer&&zs.setValue(Bn,"logDepthBufFC",2/(Math.log(jt.far+1)/Math.LN2)),Ht!==jt&&(Ht=jt,wh=!0,Th=!0),Ri.isShaderMaterial||Ri.isMeshPhongMaterial||Ri.isMeshToonMaterial||Ri.isMeshStandardMaterial||Ri.envMap){const Da=zs.map.cameraPosition;Da!==void 0&&Da.setValue(Bn,ti.setFromMatrixPosition(jt.matrixWorld))}(Ri.isMeshPhongMaterial||Ri.isMeshToonMaterial||Ri.isMeshLambertMaterial||Ri.isMeshBasicMaterial||Ri.isMeshStandardMaterial||Ri.isShaderMaterial)&&zs.setValue(Bn,"isOrthographic",jt.isOrthographicCamera===!0),(Ri.isMeshPhongMaterial||Ri.isMeshToonMaterial||Ri.isMeshLambertMaterial||Ri.isMeshBasicMaterial||Ri.isMeshStandardMaterial||Ri.isShaderMaterial||Ri.isShadowMaterial||sn.isSkinnedMesh)&&zs.setValue(Bn,"viewMatrix",jt.matrixWorldInverse)}if(sn.isSkinnedMesh){zs.setOptional(Bn,sn,"bindMatrix"),zs.setOptional(Bn,sn,"bindMatrixInverse");const Da=sn.skeleton;Da&&(Nn.floatVertexTextures?(Da.boneTexture===null&&Da.computeBoneTexture(),zs.setValue(Bn,"boneTexture",Da.boneTexture,Ii),zs.setValue(Bn,"boneTextureSize",Da.boneTextureSize)):zs.setOptional(Bn,Da,"boneMatrices"))}var ca,sl;return(wh||ss.receiveShadow!==sn.receiveShadow)&&(ss.receiveShadow=sn.receiveShadow,zs.setValue(Bn,"receiveShadow",sn.receiveShadow)),wh&&(zs.setValue(Bn,"toneMappingExposure",xe.toneMappingExposure),ss.needsLights&&(sl=Th,(ca=Zo).ambientLightColor.needsUpdate=sl,ca.lightProbe.needsUpdate=sl,ca.directionalLights.needsUpdate=sl,ca.directionalLightShadows.needsUpdate=sl,ca.pointLights.needsUpdate=sl,ca.pointLightShadows.needsUpdate=sl,ca.spotLights.needsUpdate=sl,ca.spotLightShadows.needsUpdate=sl,ca.rectAreaLights.needsUpdate=sl,ca.hemisphereLights.needsUpdate=sl),On&&Ri.fog&&ns.refreshFogUniforms(Zo,On),ns.refreshMaterialUniforms(Zo,Ri,ki,Li,Rn),el.upload(Bn,ss.uniformsList,Zo,Ii)),Ri.isShaderMaterial&&Ri.uniformsNeedUpdate===!0&&(el.upload(Bn,ss.uniformsList,Zo,Ii),Ri.uniformsNeedUpdate=!1),Ri.isSpriteMaterial&&zs.setValue(Bn,"center",sn.center),zs.setValue(Bn,"modelViewMatrix",sn.modelViewMatrix),zs.setValue(Bn,"normalMatrix",sn.normalMatrix),zs.setValue(Bn,"modelMatrix",sn.matrixWorld),bh}hd.setAnimationLoop(function(jt){s_&&s_(jt)}),typeof window<"u"&&hd.setContext(window),this.setAnimationLoop=function(jt){s_=jt,El.setAnimationLoop(jt),jt===null?hd.stop():hd.start()},El.addEventListener("sessionstart",Cy),El.addEventListener("sessionend",o_),this.render=function(jt,rn){if(rn!==void 0&&rn.isCamera!==!0)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(Re===!0)return;jt.autoUpdate===!0&&jt.updateMatrixWorld(),rn.parent===null&&rn.updateMatrixWorld(),El.enabled===!0&&El.isPresenting===!0&&(El.cameraAutoUpdate===!0&&El.updateCamera(rn),rn=El.getCamera()),jt.isScene===!0&&jt.onBeforeRender(xe,jt,rn,xt),ne=ta.get(jt,de.length),ne.init(),de.push(ne),qt.multiplyMatrices(rn.projectionMatrix,rn.matrixWorldInverse),vr.setFromProjectionMatrix(qt),Fr=this.localClippingEnabled,kr=io.init(this.clippingPlanes,Fr,rn),Q=Kr.get(jt,oe.length),Q.init(),oe.push(Q),Ly(jt,rn,0,xe.sortObjects),Q.finish(),xe.sortObjects===!0&&Q.sort(Zn,En),kr===!0&&io.beginShadows();const Ri=ne.state.shadowsArray;if(ia.render(Ri,jt,rn),kr===!0&&io.endShadows(),this.info.autoReset===!0&&this.info.reset(),rl.render(Q,jt),ne.setupLights(xe.physicallyCorrectLights),rn.isArrayCamera){const sn=rn.cameras;for(let On=0,qr=sn.length;On<qr;On++){const Mr=sn[On];Iy(Q,jt,Mr,Mr.viewport)}}else Iy(Q,jt,rn);xt!==null&&(Ii.updateMultisampleRenderTarget(xt),Ii.updateRenderTargetMipmap(xt)),jt.isScene===!0&&jt.onAfterRender(xe,jt,rn),Hn.buffers.depth.setTest(!0),Hn.buffers.depth.setMask(!0),Hn.buffers.color.setMask(!0),Hn.setPolygonOffset(!1),la.resetDefaultState(),ft=-1,Ht=null,de.pop(),ne=de.length>0?de[de.length-1]:null,oe.pop(),Q=oe.length>0?oe[oe.length-1]:null},this.getActiveCubeFace=function(){return we},this.getActiveMipmapLevel=function(){return nt},this.getRenderTarget=function(){return xt},this.setRenderTarget=function(jt,rn=0,Ri=0){xt=jt,we=rn,nt=Ri,jt&&kt.get(jt).__webglFramebuffer===void 0&&Ii.setupRenderTarget(jt);let sn=null,On=!1,qr=!1;if(jt){const Mr=jt.texture;(Mr.isDataTexture3D||Mr.isDataTexture2DArray)&&(qr=!0);const rs=kt.get(jt).__webglFramebuffer;jt.isWebGLCubeRenderTarget?(sn=rs[rn],On=!0):sn=jt.isWebGLMultisampleRenderTarget?kt.get(jt).__webglMultisampledFramebuffer:rs,Xt.copy(jt.viewport),_i.copy(jt.scissor),vi=jt.scissorTest}else Xt.copy(Ji).multiplyScalar(ki).floor(),_i.copy(In).multiplyScalar(ki).floor(),vi=ir;if(Hn.bindFramebuffer(36160,sn)&&Nn.drawBuffers){let Mr=!1;if(jt)if(jt.isWebGLMultipleRenderTargets){const rs=jt.texture;if(rr.length!==rs.length||rr[0]!==36064){for(let cs=0,so=rs.length;cs<so;cs++)rr[cs]=36064+cs;rr.length=rs.length,Mr=!0}}else rr.length===1&&rr[0]===36064||(rr[0]=36064,rr.length=1,Mr=!0);else rr.length===1&&rr[0]===1029||(rr[0]=1029,rr.length=1,Mr=!0);Mr&&(Nn.isWebGL2?Bn.drawBuffers(rr):Oi.get("WEBGL_draw_buffers").drawBuffersWEBGL(rr))}if(Hn.viewport(Xt),Hn.scissor(_i),Hn.setScissorTest(vi),On){const Mr=kt.get(jt.texture);Bn.framebufferTexture2D(36160,36064,34069+rn,Mr.__webglTexture,Ri)}else if(qr){const Mr=kt.get(jt.texture),rs=rn||0;Bn.framebufferTextureLayer(36160,36064,Mr.__webglTexture,Ri||0,rs)}ft=-1},this.readRenderTargetPixels=function(jt,rn,Ri,sn,On,qr,Mr){if(!jt||!jt.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let rs=kt.get(jt).__webglFramebuffer;if(jt.isWebGLCubeRenderTarget&&Mr!==void 0&&(rs=rs[Mr]),rs){Hn.bindFramebuffer(36160,rs);try{const cs=jt.texture,so=cs.format,$s=cs.type;if(so!==1023&&Sl.convert(so)!==Bn.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const As=$s===1016&&(Oi.has("EXT_color_buffer_half_float")||Nn.isWebGL2&&Oi.has("EXT_color_buffer_float"));if(!($s===1009||Sl.convert($s)===Bn.getParameter(35738)||$s===1015&&(Nn.isWebGL2||Oi.has("OES_texture_float")||Oi.has("WEBGL_color_buffer_float"))||As))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Bn.checkFramebufferStatus(36160)===36053?rn>=0&&rn<=jt.width-sn&&Ri>=0&&Ri<=jt.height-On&&Bn.readPixels(rn,Ri,sn,On,Sl.convert(so),Sl.convert($s),qr):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const cs=xt!==null?kt.get(xt).__webglFramebuffer:null;Hn.bindFramebuffer(36160,cs)}}},this.copyFramebufferToTexture=function(jt,rn,Ri=0){const sn=Math.pow(2,-Ri),On=Math.floor(rn.image.width*sn),qr=Math.floor(rn.image.height*sn);let Mr=Sl.convert(rn.format);Nn.isWebGL2&&(Mr===6407&&(Mr=32849),Mr===6408&&(Mr=32856)),Ii.setTexture2D(rn,0),Bn.copyTexImage2D(3553,Ri,Mr,jt.x,jt.y,On,qr,0),Hn.unbindTexture()},this.copyTextureToTexture=function(jt,rn,Ri,sn=0){const On=rn.image.width,qr=rn.image.height,Mr=Sl.convert(Ri.format),rs=Sl.convert(Ri.type);Ii.setTexture2D(Ri,0),Bn.pixelStorei(37440,Ri.flipY),Bn.pixelStorei(37441,Ri.premultiplyAlpha),Bn.pixelStorei(3317,Ri.unpackAlignment),rn.isDataTexture?Bn.texSubImage2D(3553,sn,jt.x,jt.y,On,qr,Mr,rs,rn.image.data):rn.isCompressedTexture?Bn.compressedTexSubImage2D(3553,sn,jt.x,jt.y,rn.mipmaps[0].width,rn.mipmaps[0].height,Mr,rn.mipmaps[0].data):Bn.texSubImage2D(3553,sn,jt.x,jt.y,Mr,rs,rn.image),sn===0&&Ri.generateMipmaps&&Bn.generateMipmap(3553),Hn.unbindTexture()},this.copyTextureToTexture3D=function(jt,rn,Ri,sn,On=0){if(xe.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const qr=jt.max.x-jt.min.x+1,Mr=jt.max.y-jt.min.y+1,rs=jt.max.z-jt.min.z+1,cs=Sl.convert(sn.format),so=Sl.convert(sn.type);let $s;if(sn.isDataTexture3D)Ii.setTexture3D(sn,0),$s=32879;else{if(!sn.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Ii.setTexture2DArray(sn,0),$s=35866}Bn.pixelStorei(37440,sn.flipY),Bn.pixelStorei(37441,sn.premultiplyAlpha),Bn.pixelStorei(3317,sn.unpackAlignment);const As=Bn.getParameter(3314),ss=Bn.getParameter(32878),dd=Bn.getParameter(3316),ko=Bn.getParameter(3315),bh=Bn.getParameter(32877),lc=Ri.isCompressedTexture?Ri.mipmaps[0]:Ri.image;Bn.pixelStorei(3314,lc.width),Bn.pixelStorei(32878,lc.height),Bn.pixelStorei(3316,jt.min.x),Bn.pixelStorei(3315,jt.min.y),Bn.pixelStorei(32877,jt.min.z),Ri.isDataTexture||Ri.isDataTexture3D?Bn.texSubImage3D($s,On,rn.x,rn.y,rn.z,qr,Mr,rs,cs,so,lc.data):Ri.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Bn.compressedTexSubImage3D($s,On,rn.x,rn.y,rn.z,qr,Mr,rs,cs,lc.data)):Bn.texSubImage3D($s,On,rn.x,rn.y,rn.z,qr,Mr,rs,cs,so,lc),Bn.pixelStorei(3314,As),Bn.pixelStorei(32878,ss),Bn.pixelStorei(3316,dd),Bn.pixelStorei(3315,ko),Bn.pixelStorei(32877,bh),On===0&&sn.generateMipmaps&&Bn.generateMipmap($s),Hn.unbindTexture()},this.initTexture=function(jt){Ii.setTexture2D(jt,0),Hn.unbindTexture()},this.resetState=function(){we=0,nt=0,xt=null,Hn.reset(),la.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class pu extends yn{}pu.prototype.isWebGL1Renderer=!0;class Ts{constructor(e,l=25e-5){this.name="",this.color=new wn(e),this.density=l}clone(){return new Ts(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Ts.prototype.isFogExp2=!0;class Jt{constructor(e,l=1,g=1e3){this.name="",this.color=new wn(e),this.near=l,this.far=g}clone(){return new Jt(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Jt.prototype.isFog=!0;class ih extends Ee{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,l){return super.copy(e,l),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const l=super.toJSON(e);return this.fog!==null&&(l.object.fog=this.fog.toJSON()),l}}ih.prototype.isScene=!0;class Va{constructor(e,l){this.array=e,this.stride=l,this.count=e!==void 0?e.length/l:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=_n()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,l,g){e*=this.stride,g*=l.stride;for(let _=0,M=this.stride;_<M;_++)this.array[e+_]=l.array[g+_];return this}set(e,l=0){return this.array.set(e,l),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_n()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const l=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),g=new this.constructor(l,this.stride);return g.setUsage(this.usage),g}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_n()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Va.prototype.isInterleavedBuffer=!0;const yo=new ie;class yl{constructor(e,l,g,_=!1){this.name="",this.data=e,this.itemSize=l,this.offset=g,this.normalized=_===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let l=0,g=this.data.count;l<g;l++)yo.x=this.getX(l),yo.y=this.getY(l),yo.z=this.getZ(l),yo.applyMatrix4(e),this.setXYZ(l,yo.x,yo.y,yo.z);return this}applyNormalMatrix(e){for(let l=0,g=this.count;l<g;l++)yo.x=this.getX(l),yo.y=this.getY(l),yo.z=this.getZ(l),yo.applyNormalMatrix(e),this.setXYZ(l,yo.x,yo.y,yo.z);return this}transformDirection(e){for(let l=0,g=this.count;l<g;l++)yo.x=this.getX(l),yo.y=this.getY(l),yo.z=this.getZ(l),yo.transformDirection(e),this.setXYZ(l,yo.x,yo.y,yo.z);return this}setX(e,l){return this.data.array[e*this.data.stride+this.offset]=l,this}setY(e,l){return this.data.array[e*this.data.stride+this.offset+1]=l,this}setZ(e,l){return this.data.array[e*this.data.stride+this.offset+2]=l,this}setW(e,l){return this.data.array[e*this.data.stride+this.offset+3]=l,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,l,g){return e=e*this.data.stride+this.offset,this.data.array[e+0]=l,this.data.array[e+1]=g,this}setXYZ(e,l,g,_){return e=e*this.data.stride+this.offset,this.data.array[e+0]=l,this.data.array[e+1]=g,this.data.array[e+2]=_,this}setXYZW(e,l,g,_,M){return e=e*this.data.stride+this.offset,this.data.array[e+0]=l,this.data.array[e+1]=g,this.data.array[e+2]=_,this.data.array[e+3]=M,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const l=[];for(let g=0;g<this.count;g++){const _=g*this.data.stride+this.offset;for(let M=0;M<this.itemSize;M++)l.push(this.data.array[_+M])}return new Or(new this.array.constructor(l),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new yl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const l=[];for(let g=0;g<this.count;g++){const _=g*this.data.stride+this.offset;for(let M=0;M<this.itemSize;M++)l.push(this.data.array[_+M])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:l,normalized:this.normalized}}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}yl.prototype.isInterleavedBufferAttribute=!0;class tl extends Vi{constructor(e){super(),this.type="SpriteMaterial",this.color=new wn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Pc;tl.prototype.isSpriteMaterial=!0;const ya=new ie,nh=new ie,rh=new ie,fu=new en,Dc=new en,Xd=new nr,sh=new ie,Oc=new ie,Bl=new ie,oh=new en,ah=new en,yf=new en;class Ga extends Ee{constructor(e){if(super(),this.type="Sprite",Pc===void 0){Pc=new Pr;const l=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),g=new Va(l,5);Pc.setIndex([0,1,2,0,2,3]),Pc.setAttribute("position",new yl(g,3,0,!1)),Pc.setAttribute("uv",new yl(g,2,3,!1))}this.geometry=Pc,this.material=e!==void 0?e:new tl,this.center=new en(.5,.5)}raycast(e,l){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),nh.setFromMatrixScale(this.matrixWorld),Xd.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),rh.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&nh.multiplyScalar(-rh.z);const g=this.material.rotation;let _,M;g!==0&&(M=Math.cos(g),_=Math.sin(g));const P=this.center;$o(sh.set(-.5,-.5,0),rh,P,nh,_,M),$o(Oc.set(.5,-.5,0),rh,P,nh,_,M),$o(Bl.set(.5,.5,0),rh,P,nh,_,M),oh.set(0,0),ah.set(1,0),yf.set(1,1);let N=e.ray.intersectTriangle(sh,Oc,Bl,!1,ya);if(N===null&&($o(Oc.set(-.5,.5,0),rh,P,nh,_,M),ah.set(0,1),N=e.ray.intersectTriangle(sh,Bl,Oc,!1,ya),N===null))return;const U=e.ray.origin.distanceTo(ya);U<e.near||U>e.far||l.push({distance:U,point:ya.clone(),uv:Ei.getUV(ya,sh,Oc,Bl,oh,ah,yf,new en),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function $o(S,e,l,g,_,M){fu.subVectors(S,l).addScalar(.5).multiply(g),_!==void 0?(Dc.x=M*fu.x-_*fu.y,Dc.y=_*fu.x+M*fu.y):Dc.copy(fu),S.copy(e),S.x+=Dc.x,S.y+=Dc.y,S.applyMatrix4(Xd)}Ga.prototype.isSprite=!0;const Jh=new ie,lh=new ie;class Ds extends Ee{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const l=e.levels;for(let g=0,_=l.length;g<_;g++){const M=l[g];this.addLevel(M.object.clone(),M.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,l=0){l=Math.abs(l);const g=this.levels;let _;for(_=0;_<g.length&&!(l<g[_].distance);_++);return g.splice(_,0,{distance:l,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const l=this.levels;if(l.length>0){let g,_;for(g=1,_=l.length;g<_&&!(e<l[g].distance);g++);return l[g-1].object}return null}raycast(e,l){if(this.levels.length>0){Jh.setFromMatrixPosition(this.matrixWorld);const g=e.ray.origin.distanceTo(Jh);this.getObjectForDistance(g).raycast(e,l)}}update(e){const l=this.levels;if(l.length>1){Jh.setFromMatrixPosition(e.matrixWorld),lh.setFromMatrixPosition(this.matrixWorld);const g=Jh.distanceTo(lh)/e.zoom;let _,M;for(l[0].object.visible=!0,_=1,M=l.length;_<M&&g>=l[_].distance;_++)l[_-1].object.visible=!1,l[_].object.visible=!0;for(this._currentLevel=_-1;_<M;_++)l[_].object.visible=!1}}toJSON(e){const l=super.toJSON(e);this.autoUpdate===!1&&(l.object.autoUpdate=!1),l.object.levels=[];const g=this.levels;for(let _=0,M=g.length;_<M;_++){const P=g[_];l.object.levels.push({object:P.object.uuid,distance:P.distance})}return l}}const Qr=new ie,vf=new Dr,ec=new Dr,Yd=new ie,mu=new nr;class ch extends qn{constructor(e,l){super(e,l),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new nr,this.bindMatrixInverse=new nr}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,l){this.skeleton=e,l===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),l=this.matrixWorld),this.bindMatrix.copy(l),this.bindMatrixInverse.copy(l).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Dr,l=this.geometry.attributes.skinWeight;for(let g=0,_=l.count;g<_;g++){e.x=l.getX(g),e.y=l.getY(g),e.z=l.getZ(g),e.w=l.getW(g);const M=1/e.manhattanLength();M!==1/0?e.multiplyScalar(M):e.set(1,0,0,0),l.setXYZW(g,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,l){const g=this.skeleton,_=this.geometry;vf.fromBufferAttribute(_.attributes.skinIndex,e),ec.fromBufferAttribute(_.attributes.skinWeight,e),Qr.fromBufferAttribute(_.attributes.position,e).applyMatrix4(this.bindMatrix),l.set(0,0,0);for(let M=0;M<4;M++){const P=ec.getComponent(M);if(P!==0){const N=vf.getComponent(M);mu.multiplyMatrices(g.bones[N].matrixWorld,g.boneInverses[N]),l.addScaledVector(Yd.copy(Qr).applyMatrix4(mu),P)}}return l.applyMatrix4(this.bindMatrixInverse)}}ch.prototype.isSkinnedMesh=!0;class zc extends Ee{constructor(){super(),this.type="Bone"}}zc.prototype.isBone=!0;class va extends _s{constructor(e=null,l=1,g=1,_,M,P,N,U,G=1003,K=1003,Q,ne){super(null,P,N,U,G,K,_,M,Q,ne),this.image={data:e,width:l,height:g},this.magFilter=G,this.minFilter=K,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}va.prototype.isDataTexture=!0;const tc=new nr,ic=new nr;class gu{constructor(e=[],l=[]){this.uuid=_n(),this.bones=e.slice(0),this.boneInverses=l,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,l=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),l.length===0)this.calculateInverses();else if(e.length!==l.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let g=0,_=this.bones.length;g<_;g++)this.boneInverses.push(new nr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,l=this.bones.length;e<l;e++){const g=new nr;this.bones[e]&&g.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(g)}}pose(){for(let e=0,l=this.bones.length;e<l;e++){const g=this.bones[e];g&&g.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,l=this.bones.length;e<l;e++){const g=this.bones[e];g&&(g.parent&&g.parent.isBone?(g.matrix.copy(g.parent.matrixWorld).invert(),g.matrix.multiply(g.matrixWorld)):g.matrix.copy(g.matrixWorld),g.matrix.decompose(g.position,g.quaternion,g.scale))}}update(){const e=this.bones,l=this.boneInverses,g=this.boneMatrices,_=this.boneTexture;for(let M=0,P=e.length;M<P;M++){const N=e[M]?e[M].matrixWorld:ic;tc.multiplyMatrices(N,l[M]),tc.toArray(g,16*M)}_!==null&&(_.needsUpdate=!0)}clone(){return new gu(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Tr(e),e=Math.max(e,4);const l=new Float32Array(e*e*4);l.set(this.boneMatrices);const g=new va(l,e,e,1023,1015);return this.boneMatrices=l,this.boneTexture=g,this.boneTextureSize=e,this}getBoneByName(e){for(let l=0,g=this.bones.length;l<g;l++){const _=this.bones[l];if(_.name===e)return _}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,l){this.uuid=e.uuid;for(let g=0,_=e.bones.length;g<_;g++){const M=e.bones[g];let P=l[M];P===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",M),P=new zc),this.bones.push(P),this.boneInverses.push(new nr().fromArray(e.boneInverses[g]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const l=this.bones,g=this.boneInverses;for(let _=0,M=l.length;_<M;_++){const P=l[_];e.bones.push(P.uuid);const N=g[_];e.boneInverses.push(N.toArray())}return e}}class vl extends Or{constructor(e,l,g,_=1){typeof g=="number"&&(_=g,g=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,l,g),this.meshPerAttribute=_}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}vl.prototype.isInstancedBufferAttribute=!0;const _u=new nr,Kd=new nr,uh=[],il=new qn;class Qh extends qn{constructor(e,l,g){super(e,l),this.instanceMatrix=new vl(new Float32Array(16*g),16),this.instanceColor=null,this.count=g,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,l){l.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,l){l.fromArray(this.instanceMatrix.array,16*e)}raycast(e,l){const g=this.matrixWorld,_=this.count;if(il.geometry=this.geometry,il.material=this.material,il.material!==void 0)for(let M=0;M<_;M++){this.getMatrixAt(M,_u),Kd.multiplyMatrices(g,_u),il.matrixWorld=Kd,il.raycast(e,uh);for(let P=0,N=uh.length;P<N;P++){const U=uh[P];U.instanceId=M,U.object=this,l.push(U)}uh.length=0}}setColorAt(e,l){this.instanceColor===null&&(this.instanceColor=new vl(new Float32Array(3*this.instanceMatrix.count),3)),l.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,l){l.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Qh.prototype.isInstancedMesh=!0;class Io extends Vi{constructor(e){super(),this.type="LineBasicMaterial",this.color=new wn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Io.prototype.isLineBasicMaterial=!0;const yu=new ie,vu=new ie,qs=new nr,kc=new na,hh=new Ns;class Ra extends Ee{constructor(e=new Pr,l=new Io){super(),this.type="Line",this.geometry=e,this.material=l,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const l=e.attributes.position,g=[0];for(let _=1,M=l.count;_<M;_++)yu.fromBufferAttribute(l,_-1),vu.fromBufferAttribute(l,_),g[_]=g[_-1],g[_]+=yu.distanceTo(vu);e.setAttribute("lineDistance",new Un(g,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,l){const g=this.geometry,_=this.matrixWorld,M=e.params.Line.threshold,P=g.drawRange;if(g.boundingSphere===null&&g.computeBoundingSphere(),hh.copy(g.boundingSphere),hh.applyMatrix4(_),hh.radius+=M,e.ray.intersectsSphere(hh)===!1)return;qs.copy(_).invert(),kc.copy(e.ray).applyMatrix4(qs);const N=M/((this.scale.x+this.scale.y+this.scale.z)/3),U=N*N,G=new ie,K=new ie,Q=new ie,ne=new ie,oe=this.isLineSegments?2:1;if(g.isBufferGeometry){const de=g.index,xe=g.attributes.position;if(de!==null)for(let Re=Math.max(0,P.start),we=Math.min(de.count,P.start+P.count)-1;Re<we;Re+=oe){const nt=de.getX(Re),xt=de.getX(Re+1);if(G.fromBufferAttribute(xe,nt),K.fromBufferAttribute(xe,xt),kc.distanceSqToSegment(G,K,ne,Q)>U)continue;ne.applyMatrix4(this.matrixWorld);const ft=e.ray.origin.distanceTo(ne);ft<e.near||ft>e.far||l.push({distance:ft,point:Q.clone().applyMatrix4(this.matrixWorld),index:Re,face:null,faceIndex:null,object:this})}else for(let Re=Math.max(0,P.start),we=Math.min(xe.count,P.start+P.count)-1;Re<we;Re+=oe){if(G.fromBufferAttribute(xe,Re),K.fromBufferAttribute(xe,Re+1),kc.distanceSqToSegment(G,K,ne,Q)>U)continue;ne.applyMatrix4(this.matrixWorld);const nt=e.ray.origin.distanceTo(ne);nt<e.near||nt>e.far||l.push({distance:nt,point:Q.clone().applyMatrix4(this.matrixWorld),index:Re,face:null,faceIndex:null,object:this})}}else g.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const l=e.morphAttributes,g=Object.keys(l);if(g.length>0){const _=l[g[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let M=0,P=_.length;M<P;M++){const N=_[M].name||String(M);this.morphTargetInfluences.push(0),this.morphTargetDictionary[N]=M}}}}else{const l=e.morphTargets;l!==void 0&&l.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Ra.prototype.isLine=!0;const Fc=new ie,Jd=new ie;class Jo extends Ra{constructor(e,l){super(e,l),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const l=e.attributes.position,g=[];for(let _=0,M=l.count;_<M;_+=2)Fc.fromBufferAttribute(l,_),Jd.fromBufferAttribute(l,_+1),g[_]=_===0?0:g[_-1],g[_+1]=g[_]+Fc.distanceTo(Jd);e.setAttribute("lineDistance",new Un(g,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Jo.prototype.isLineSegments=!0;class Qd extends Ra{constructor(e,l){super(e,l),this.type="LineLoop"}}Qd.prototype.isLineLoop=!0;class xl extends Vi{constructor(e){super(),this.type="PointsMaterial",this.color=new wn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}xl.prototype.isPointsMaterial=!0;const ep=new nr,xu=new na,Bc=new Ns,bu=new ie;class Nc extends Ee{constructor(e=new Pr,l=new xl){super(),this.type="Points",this.geometry=e,this.material=l,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,l){const g=this.geometry,_=this.matrixWorld,M=e.params.Points.threshold,P=g.drawRange;if(g.boundingSphere===null&&g.computeBoundingSphere(),Bc.copy(g.boundingSphere),Bc.applyMatrix4(_),Bc.radius+=M,e.ray.intersectsSphere(Bc)===!1)return;ep.copy(_).invert(),xu.copy(e.ray).applyMatrix4(ep);const N=M/((this.scale.x+this.scale.y+this.scale.z)/3),U=N*N;if(g.isBufferGeometry){const G=g.index,K=g.attributes.position;if(G!==null)for(let Q=Math.max(0,P.start),ne=Math.min(G.count,P.start+P.count);Q<ne;Q++){const oe=G.getX(Q);bu.fromBufferAttribute(K,oe),ed(bu,oe,U,_,e,l,this)}else for(let Q=Math.max(0,P.start),ne=Math.min(K.count,P.start+P.count);Q<ne;Q++)bu.fromBufferAttribute(K,Q),ed(bu,Q,U,_,e,l,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const l=e.morphAttributes,g=Object.keys(l);if(g.length>0){const _=l[g[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let M=0,P=_.length;M<P;M++){const N=_[M].name||String(M);this.morphTargetInfluences.push(0),this.morphTargetDictionary[N]=M}}}}else{const l=e.morphTargets;l!==void 0&&l.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function ed(S,e,l,g,_,M,P){const N=xu.distanceSqToPoint(S);if(N<l){const U=new ie;xu.closestPointToPoint(S,U),U.applyMatrix4(g);const G=_.ray.origin.distanceTo(U);if(G<_.near||G>_.far)return;M.push({distance:G,distanceToRay:Math.sqrt(N),point:U,index:e,face:null,object:P})}}Nc.prototype.isPoints=!0;class xf extends _s{constructor(e,l,g,_,M,P,N,U,G){super(e,l,g,_,M,P,N,U,G),this.format=N!==void 0?N:1022,this.minFilter=P!==void 0?P:1006,this.magFilter=M!==void 0?M:1006,this.generateMipmaps=!1;const K=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function Q(){K.needsUpdate=!0,e.requestVideoFrameCallback(Q)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}xf.prototype.isVideoTexture=!0;class dh extends _s{constructor(e,l,g,_,M,P,N,U,G,K,Q,ne){super(null,P,N,U,G,K,_,M,Q,ne),this.image={width:l,height:g},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}dh.prototype.isCompressedTexture=!0;class ph extends _s{constructor(e,l,g,_,M,P,N,U,G){super(e,l,g,_,M,P,N,U,G),this.needsUpdate=!0}}ph.prototype.isCanvasTexture=!0;class tp extends _s{constructor(e,l,g,_,M,P,N,U,G,K){if((K=K!==void 0?K:1026)!==1026&&K!==1027)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");g===void 0&&K===1026&&(g=1012),g===void 0&&K===1027&&(g=1020),super(null,_,M,P,N,U,K,g,G),this.image={width:e,height:l},this.magFilter=N!==void 0?N:1003,this.minFilter=U!==void 0?U:1003,this.flipY=!1,this.generateMipmaps=!1}}tp.prototype.isDepthTexture=!0;class wu extends Pr{constructor(e=1,l=8,g=0,_=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:l,thetaStart:g,thetaLength:_},l=Math.max(3,l);const M=[],P=[],N=[],U=[],G=new ie,K=new en;P.push(0,0,0),N.push(0,0,1),U.push(.5,.5);for(let Q=0,ne=3;Q<=l;Q++,ne+=3){const oe=g+Q/l*_;G.x=e*Math.cos(oe),G.y=e*Math.sin(oe),P.push(G.x,G.y,G.z),N.push(0,0,1),K.x=(P[ne]/e+1)/2,K.y=(P[ne+1]/e+1)/2,U.push(K.x,K.y)}for(let Q=1;Q<=l;Q++)M.push(Q,Q+1,0);this.setIndex(M),this.setAttribute("position",new Un(P,3)),this.setAttribute("normal",new Un(N,3)),this.setAttribute("uv",new Un(U,2))}static fromJSON(e){return new wu(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Nl extends Pr{constructor(e=1,l=1,g=1,_=8,M=1,P=!1,N=0,U=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:l,height:g,radialSegments:_,heightSegments:M,openEnded:P,thetaStart:N,thetaLength:U};const G=this;_=Math.floor(_),M=Math.floor(M);const K=[],Q=[],ne=[],oe=[];let de=0;const xe=[],Re=g/2;let we=0;function nt(xt){const ft=de,Ht=new en,Xt=new ie;let _i=0;const vi=xt===!0?e:l,Bi=xt===!0?1:-1;for(let ki=1;ki<=_;ki++)Q.push(0,Re*Bi,0),ne.push(0,Bi,0),oe.push(.5,.5),de++;const Li=de;for(let ki=0;ki<=_;ki++){const Zn=ki/_*U+N,En=Math.cos(Zn),Ji=Math.sin(Zn);Xt.x=vi*Ji,Xt.y=Re*Bi,Xt.z=vi*En,Q.push(Xt.x,Xt.y,Xt.z),ne.push(0,Bi,0),Ht.x=.5*En+.5,Ht.y=.5*Ji*Bi+.5,oe.push(Ht.x,Ht.y),de++}for(let ki=0;ki<_;ki++){const Zn=ft+ki,En=Li+ki;xt===!0?K.push(En,En+1,Zn):K.push(En+1,En,Zn),_i+=3}G.addGroup(we,_i,xt===!0?1:2),we+=_i}(function(){const xt=new ie,ft=new ie;let Ht=0;const Xt=(l-e)/g;for(let _i=0;_i<=M;_i++){const vi=[],Bi=_i/M,Li=Bi*(l-e)+e;for(let ki=0;ki<=_;ki++){const Zn=ki/_,En=Zn*U+N,Ji=Math.sin(En),In=Math.cos(En);ft.x=Li*Ji,ft.y=-Bi*g+Re,ft.z=Li*In,Q.push(ft.x,ft.y,ft.z),xt.set(Ji,Xt,In).normalize(),ne.push(xt.x,xt.y,xt.z),oe.push(Zn,1-Bi),vi.push(de++)}xe.push(vi)}for(let _i=0;_i<_;_i++)for(let vi=0;vi<M;vi++){const Bi=xe[vi][_i],Li=xe[vi+1][_i],ki=xe[vi+1][_i+1],Zn=xe[vi][_i+1];K.push(Bi,Li,Zn),K.push(Li,ki,Zn),Ht+=6}G.addGroup(we,Ht,0),we+=Ht})(),P===!1&&(e>0&&nt(!0),l>0&&nt(!1)),this.setIndex(K),this.setAttribute("position",new Un(Q,3)),this.setAttribute("normal",new Un(ne,3)),this.setAttribute("uv",new Un(oe,2))}static fromJSON(e){return new Nl(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Tu extends Nl{constructor(e=1,l=1,g=8,_=1,M=!1,P=0,N=2*Math.PI){super(0,e,l,g,_,M,P,N),this.type="ConeGeometry",this.parameters={radius:e,height:l,radialSegments:g,heightSegments:_,openEnded:M,thetaStart:P,thetaLength:N}}static fromJSON(e){return new Tu(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ha extends Pr{constructor(e,l,g=1,_=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:l,radius:g,detail:_};const M=[],P=[];function N(ne,oe,de,xe){const Re=xe+1,we=[];for(let nt=0;nt<=Re;nt++){we[nt]=[];const xt=ne.clone().lerp(de,nt/Re),ft=oe.clone().lerp(de,nt/Re),Ht=Re-nt;for(let Xt=0;Xt<=Ht;Xt++)we[nt][Xt]=Xt===0&&nt===Re?xt:xt.clone().lerp(ft,Xt/Ht)}for(let nt=0;nt<Re;nt++)for(let xt=0;xt<2*(Re-nt)-1;xt++){const ft=Math.floor(xt/2);xt%2==0?(U(we[nt][ft+1]),U(we[nt+1][ft]),U(we[nt][ft])):(U(we[nt][ft+1]),U(we[nt+1][ft+1]),U(we[nt+1][ft]))}}function U(ne){M.push(ne.x,ne.y,ne.z)}function G(ne,oe){const de=3*ne;oe.x=e[de+0],oe.y=e[de+1],oe.z=e[de+2]}function K(ne,oe,de,xe){xe<0&&ne.x===1&&(P[oe]=ne.x-1),de.x===0&&de.z===0&&(P[oe]=xe/2/Math.PI+.5)}function Q(ne){return Math.atan2(ne.z,-ne.x)}(function(ne){const oe=new ie,de=new ie,xe=new ie;for(let Re=0;Re<l.length;Re+=3)G(l[Re+0],oe),G(l[Re+1],de),G(l[Re+2],xe),N(oe,de,xe,ne)})(_),function(ne){const oe=new ie;for(let de=0;de<M.length;de+=3)oe.x=M[de+0],oe.y=M[de+1],oe.z=M[de+2],oe.normalize().multiplyScalar(ne),M[de+0]=oe.x,M[de+1]=oe.y,M[de+2]=oe.z}(g),function(){const ne=new ie;for(let de=0;de<M.length;de+=3){ne.x=M[de+0],ne.y=M[de+1],ne.z=M[de+2];const xe=Q(ne)/2/Math.PI+.5,Re=(oe=ne,Math.atan2(-oe.y,Math.sqrt(oe.x*oe.x+oe.z*oe.z))/Math.PI+.5);P.push(xe,1-Re)}var oe;(function(){const de=new ie,xe=new ie,Re=new ie,we=new ie,nt=new en,xt=new en,ft=new en;for(let Ht=0,Xt=0;Ht<M.length;Ht+=9,Xt+=6){de.set(M[Ht+0],M[Ht+1],M[Ht+2]),xe.set(M[Ht+3],M[Ht+4],M[Ht+5]),Re.set(M[Ht+6],M[Ht+7],M[Ht+8]),nt.set(P[Xt+0],P[Xt+1]),xt.set(P[Xt+2],P[Xt+3]),ft.set(P[Xt+4],P[Xt+5]),we.copy(de).add(xe).add(Re).divideScalar(3);const _i=Q(we);K(nt,Xt+0,de,_i),K(xt,Xt+2,xe,_i),K(ft,Xt+4,Re,_i)}})(),function(){for(let de=0;de<P.length;de+=6){const xe=P[de+0],Re=P[de+2],we=P[de+4],nt=Math.max(xe,Re,we),xt=Math.min(xe,Re,we);nt>.9&&xt<.1&&(xe<.2&&(P[de+0]+=1),Re<.2&&(P[de+2]+=1),we<.2&&(P[de+4]+=1))}}()}(),this.setAttribute("position",new Un(M,3)),this.setAttribute("normal",new Un(M.slice(),3)),this.setAttribute("uv",new Un(P,2)),_===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Ha(e.vertices,e.indices,e.radius,e.details)}}class Mu extends Ha{constructor(e=1,l=0){const g=(1+Math.sqrt(5))/2,_=1/g;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-_,-g,0,-_,g,0,_,-g,0,_,g,-_,-g,0,-_,g,0,_,-g,0,_,g,0,-g,0,-_,g,0,-_,-g,0,_,g,0,_],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,l),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:l}}static fromJSON(e){return new Mu(e.radius,e.detail)}}const td=new ie,id=new ie,ip=new ie,fh=new Ei;class bf extends Pr{constructor(e,l){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:l},l=l!==void 0?l:1,e.isGeometry===!0)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const g=Math.pow(10,4),_=Math.cos(an*l),M=e.getIndex(),P=e.getAttribute("position"),N=M?M.count:P.count,U=[0,0,0],G=["a","b","c"],K=new Array(3),Q={},ne=[];for(let oe=0;oe<N;oe+=3){M?(U[0]=M.getX(oe),U[1]=M.getX(oe+1),U[2]=M.getX(oe+2)):(U[0]=oe,U[1]=oe+1,U[2]=oe+2);const{a:de,b:xe,c:Re}=fh;if(de.fromBufferAttribute(P,U[0]),xe.fromBufferAttribute(P,U[1]),Re.fromBufferAttribute(P,U[2]),fh.getNormal(ip),K[0]=`${Math.round(de.x*g)},${Math.round(de.y*g)},${Math.round(de.z*g)}`,K[1]=`${Math.round(xe.x*g)},${Math.round(xe.y*g)},${Math.round(xe.z*g)}`,K[2]=`${Math.round(Re.x*g)},${Math.round(Re.y*g)},${Math.round(Re.z*g)}`,K[0]!==K[1]&&K[1]!==K[2]&&K[2]!==K[0])for(let we=0;we<3;we++){const nt=(we+1)%3,xt=K[we],ft=K[nt],Ht=fh[G[we]],Xt=fh[G[nt]],_i=`${xt}_${ft}`,vi=`${ft}_${xt}`;vi in Q&&Q[vi]?(ip.dot(Q[vi].normal)<=_&&(ne.push(Ht.x,Ht.y,Ht.z),ne.push(Xt.x,Xt.y,Xt.z)),Q[vi]=null):_i in Q||(Q[_i]={index0:U[we],index1:U[nt],normal:ip.clone()})}}for(const oe in Q)if(Q[oe]){const{index0:de,index1:xe}=Q[oe];td.fromBufferAttribute(P,de),id.fromBufferAttribute(P,xe),ne.push(td.x,td.y,td.z),ne.push(id.x,id.y,id.z)}this.setAttribute("position",new Un(ne,3))}}class ja{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,l){const g=this.getUtoTmapping(e);return this.getPoint(g,l)}getPoints(e=5){const l=[];for(let g=0;g<=e;g++)l.push(this.getPoint(g/e));return l}getSpacedPoints(e=5){const l=[];for(let g=0;g<=e;g++)l.push(this.getPointAt(g/e));return l}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const l=[];let g,_=this.getPoint(0),M=0;l.push(0);for(let P=1;P<=e;P++)g=this.getPoint(P/e),M+=g.distanceTo(_),l.push(M),_=g;return this.cacheArcLengths=l,l}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,l){const g=this.getLengths();let _=0;const M=g.length;let P;P=l||e*g[M-1];let N,U=0,G=M-1;for(;U<=G;)if(_=Math.floor(U+(G-U)/2),N=g[_]-P,N<0)U=_+1;else{if(!(N>0)){G=_;break}G=_-1}if(_=G,g[_]===P)return _/(M-1);const K=g[_];return(_+(P-K)/(g[_+1]-K))/(M-1)}getTangent(e,l){let _=e-1e-4,M=e+1e-4;_<0&&(_=0),M>1&&(M=1);const P=this.getPoint(_),N=this.getPoint(M),U=l||(P.isVector2?new en:new ie);return U.copy(N).sub(P).normalize(),U}getTangentAt(e,l){const g=this.getUtoTmapping(e);return this.getTangent(g,l)}computeFrenetFrames(e,l){const g=new ie,_=[],M=[],P=[],N=new ie,U=new nr;for(let oe=0;oe<=e;oe++){const de=oe/e;_[oe]=this.getTangentAt(de,new ie),_[oe].normalize()}M[0]=new ie,P[0]=new ie;let G=Number.MAX_VALUE;const K=Math.abs(_[0].x),Q=Math.abs(_[0].y),ne=Math.abs(_[0].z);K<=G&&(G=K,g.set(1,0,0)),Q<=G&&(G=Q,g.set(0,1,0)),ne<=G&&g.set(0,0,1),N.crossVectors(_[0],g).normalize(),M[0].crossVectors(_[0],N),P[0].crossVectors(_[0],M[0]);for(let oe=1;oe<=e;oe++){if(M[oe]=M[oe-1].clone(),P[oe]=P[oe-1].clone(),N.crossVectors(_[oe-1],_[oe]),N.length()>Number.EPSILON){N.normalize();const de=Math.acos(Fn(_[oe-1].dot(_[oe]),-1,1));M[oe].applyMatrix4(U.makeRotationAxis(N,de))}P[oe].crossVectors(_[oe],M[oe])}if(l===!0){let oe=Math.acos(Fn(M[0].dot(M[e]),-1,1));oe/=e,_[0].dot(N.crossVectors(M[0],M[e]))>0&&(oe=-oe);for(let de=1;de<=e;de++)M[de].applyMatrix4(U.makeRotationAxis(_[de],oe*de)),P[de].crossVectors(_[de],M[de])}return{tangents:_,normals:M,binormals:P}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ks extends ja{constructor(e=0,l=0,g=1,_=1,M=0,P=2*Math.PI,N=!1,U=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=l,this.xRadius=g,this.yRadius=_,this.aStartAngle=M,this.aEndAngle=P,this.aClockwise=N,this.aRotation=U}getPoint(e,l){const g=l||new en,_=2*Math.PI;let M=this.aEndAngle-this.aStartAngle;const P=Math.abs(M)<Number.EPSILON;for(;M<0;)M+=_;for(;M>_;)M-=_;M<Number.EPSILON&&(M=P?0:_),this.aClockwise!==!0||P||(M===_?M=-_:M-=_);const N=this.aStartAngle+e*M;let U=this.aX+this.xRadius*Math.cos(N),G=this.aY+this.yRadius*Math.sin(N);if(this.aRotation!==0){const K=Math.cos(this.aRotation),Q=Math.sin(this.aRotation),ne=U-this.aX,oe=G-this.aY;U=ne*K-oe*Q+this.aX,G=ne*Q+oe*K+this.aY}return g.set(U,G)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Ks.prototype.isEllipseCurve=!0;class np extends Ks{constructor(e,l,g,_,M,P){super(e,l,g,g,_,M,P),this.type="ArcCurve"}}function wf(){let S=0,e=0,l=0,g=0;function _(M,P,N,U){S=M,e=N,l=-3*M+3*P-2*N-U,g=2*M-2*P+N+U}return{initCatmullRom:function(M,P,N,U,G){_(P,N,G*(N-M),G*(U-P))},initNonuniformCatmullRom:function(M,P,N,U,G,K,Q){let ne=(P-M)/G-(N-M)/(G+K)+(N-P)/K,oe=(N-P)/K-(U-P)/(K+Q)+(U-N)/Q;ne*=K,oe*=K,_(P,N,ne,oe)},calc:function(M){const P=M*M;return S+e*M+l*P+g*(P*M)}}}np.prototype.isArcCurve=!0;const rp=new ie,Su=new wf,sp=new wf,Uc=new wf;class mh extends ja{constructor(e=[],l=!1,g="centripetal",_=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=l,this.curveType=g,this.tension=_}getPoint(e,l=new ie){const g=l,_=this.points,M=_.length,P=(M-(this.closed?0:1))*e;let N,U,G=Math.floor(P),K=P-G;this.closed?G+=G>0?0:(Math.floor(Math.abs(G)/M)+1)*M:K===0&&G===M-1&&(G=M-2,K=1),this.closed||G>0?N=_[(G-1)%M]:(rp.subVectors(_[0],_[1]).add(_[0]),N=rp);const Q=_[G%M],ne=_[(G+1)%M];if(this.closed||G+2<M?U=_[(G+2)%M]:(rp.subVectors(_[M-1],_[M-2]).add(_[M-1]),U=rp),this.curveType==="centripetal"||this.curveType==="chordal"){const oe=this.curveType==="chordal"?.5:.25;let de=Math.pow(N.distanceToSquared(Q),oe),xe=Math.pow(Q.distanceToSquared(ne),oe),Re=Math.pow(ne.distanceToSquared(U),oe);xe<1e-4&&(xe=1),de<1e-4&&(de=xe),Re<1e-4&&(Re=xe),Su.initNonuniformCatmullRom(N.x,Q.x,ne.x,U.x,de,xe,Re),sp.initNonuniformCatmullRom(N.y,Q.y,ne.y,U.y,de,xe,Re),Uc.initNonuniformCatmullRom(N.z,Q.z,ne.z,U.z,de,xe,Re)}else this.curveType==="catmullrom"&&(Su.initCatmullRom(N.x,Q.x,ne.x,U.x,this.tension),sp.initCatmullRom(N.y,Q.y,ne.y,U.y,this.tension),Uc.initCatmullRom(N.z,Q.z,ne.z,U.z,this.tension));return g.set(Su.calc(K),sp.calc(K),Uc.calc(K)),g}copy(e){super.copy(e),this.points=[];for(let l=0,g=e.points.length;l<g;l++){const _=e.points[l];this.points.push(_.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let l=0,g=this.points.length;l<g;l++){const _=this.points[l];e.points.push(_.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let l=0,g=e.points.length;l<g;l++){const _=e.points[l];this.points.push(new ie().fromArray(_))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Ul(S,e,l,g,_){const M=.5*(g-e),P=.5*(_-l),N=S*S;return(2*l-2*g+M+P)*(S*N)+(-3*l+3*g-2*M-P)*N+M*S+l}function bl(S,e,l,g){return function(_,M){const P=1-_;return P*P*M}(S,e)+function(_,M){return 2*(1-_)*_*M}(S,l)+function(_,M){return _*_*M}(S,g)}function lo(S,e,l,g,_){return function(M,P){const N=1-M;return N*N*N*P}(S,e)+function(M,P){const N=1-M;return 3*N*N*M*P}(S,l)+function(M,P){return 3*(1-M)*M*M*P}(S,g)+function(M,P){return M*M*M*P}(S,_)}mh.prototype.isCatmullRomCurve3=!0;class Wa extends ja{constructor(e=new en,l=new en,g=new en,_=new en){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=l,this.v2=g,this.v3=_}getPoint(e,l=new en){const g=l,_=this.v0,M=this.v1,P=this.v2,N=this.v3;return g.set(lo(e,_.x,M.x,P.x,N.x),lo(e,_.y,M.y,P.y,N.y)),g}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Wa.prototype.isCubicBezierCurve=!0;class nd extends ja{constructor(e=new ie,l=new ie,g=new ie,_=new ie){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=l,this.v2=g,this.v3=_}getPoint(e,l=new ie){const g=l,_=this.v0,M=this.v1,P=this.v2,N=this.v3;return g.set(lo(e,_.x,M.x,P.x,N.x),lo(e,_.y,M.y,P.y,N.y),lo(e,_.z,M.z,P.z,N.z)),g}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}nd.prototype.isCubicBezierCurve3=!0;class Vc extends ja{constructor(e=new en,l=new en){super(),this.type="LineCurve",this.v1=e,this.v2=l}getPoint(e,l=new en){const g=l;return e===1?g.copy(this.v2):(g.copy(this.v2).sub(this.v1),g.multiplyScalar(e).add(this.v1)),g}getPointAt(e,l){return this.getPoint(e,l)}getTangent(e,l){const g=l||new en;return g.copy(this.v2).sub(this.v1).normalize(),g}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Vc.prototype.isLineCurve=!0;class op extends ja{constructor(e=new ie,l=new ie){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=l}getPoint(e,l=new ie){const g=l;return e===1?g.copy(this.v2):(g.copy(this.v2).sub(this.v1),g.multiplyScalar(e).add(this.v1)),g}getPointAt(e,l){return this.getPoint(e,l)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class rd extends ja{constructor(e=new en,l=new en,g=new en){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=l,this.v2=g}getPoint(e,l=new en){const g=l,_=this.v0,M=this.v1,P=this.v2;return g.set(bl(e,_.x,M.x,P.x),bl(e,_.y,M.y,P.y)),g}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}rd.prototype.isQuadraticBezierCurve=!0;class Eu extends ja{constructor(e=new ie,l=new ie,g=new ie){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=l,this.v2=g}getPoint(e,l=new ie){const g=l,_=this.v0,M=this.v1,P=this.v2;return g.set(bl(e,_.x,M.x,P.x),bl(e,_.y,M.y,P.y),bl(e,_.z,M.z,P.z)),g}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Eu.prototype.isQuadraticBezierCurve3=!0;class ap extends ja{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,l=new en){const g=l,_=this.points,M=(_.length-1)*e,P=Math.floor(M),N=M-P,U=_[P===0?P:P-1],G=_[P],K=_[P>_.length-2?_.length-1:P+1],Q=_[P>_.length-3?_.length-1:P+2];return g.set(Ul(N,U.x,G.x,K.x,Q.x),Ul(N,U.y,G.y,K.y,Q.y)),g}copy(e){super.copy(e),this.points=[];for(let l=0,g=e.points.length;l<g;l++){const _=e.points[l];this.points.push(_.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let l=0,g=this.points.length;l<g;l++){const _=this.points[l];e.points.push(_.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let l=0,g=e.points.length;l<g;l++){const _=e.points[l];this.points.push(new en().fromArray(_))}return this}}ap.prototype.isSplineCurve=!0;var lp=Object.freeze({__proto__:null,ArcCurve:np,CatmullRomCurve3:mh,CubicBezierCurve:Wa,CubicBezierCurve3:nd,EllipseCurve:Ks,LineCurve:Vc,LineCurve3:op,QuadraticBezierCurve:rd,QuadraticBezierCurve3:Eu,SplineCurve:ap});const cp=function(S,e,l=2){const g=e&&e.length,_=g?e[0]*l:S.length;let M=up(S,0,_,l,!0);const P=[];if(!M||M.next===M.prev)return P;let N,U,G,K,Q,ne,oe;if(g&&(M=function(de,xe,Re,we){const nt=[];let xt,ft,Ht,Xt,_i;for(xt=0,ft=xe.length;xt<ft;xt++)Ht=xe[xt]*we,Xt=xt<ft-1?xe[xt+1]*we:de.length,_i=up(de,Ht,Xt,we,!1),_i===_i.next&&(_i.steiner=!0),nt.push(Gg(_i));for(nt.sort(Gl),xt=0;xt<nt.length;xt++)Ug(nt[xt],Re),Re=nl(Re,Re.next);return Re}(S,e,M,l)),S.length>80*l){N=G=S[0],U=K=S[1];for(let de=l;de<_;de+=l)Q=S[de],ne=S[de+1],Q<N&&(N=Q),ne<U&&(U=ne),Q>G&&(G=Q),ne>K&&(K=ne);oe=Math.max(G-N,K-U),oe=oe!==0?1/oe:0}return Vl(M,P,l,N,U,oe),P};function up(S,e,l,g,_){let M,P;if(_===function(N,U,G,K){let Q=0;for(let ne=U,oe=G-K;ne<G;ne+=K)Q+=(N[oe]-N[ne])*(N[ne+1]+N[oe+1]),oe=ne;return Q}(S,e,l,g)>0)for(M=e;M<l;M+=g)P=E(M,S[M],S[M+1],P);else for(M=l-g;M>=e;M-=g)P=E(M,S[M],S[M+1],P);return P&&h(P,P.next)&&(O(P),P=P.next),P}function nl(S,e){if(!S)return S;e||(e=S);let l,g=S;do if(l=!1,g.steiner||!h(g,g.next)&&ho(g.prev,g,g.next)!==0)g=g.next;else{if(O(g),g=e=g.prev,g===g.next)break;l=!0}while(l||g!==e);return e}function Vl(S,e,l,g,_,M,P){if(!S)return;!P&&M&&function(K,Q,ne,oe){let de=K;do de.z===null&&(de.z=Tf(de.x,de.y,Q,ne,oe)),de.prevZ=de.prev,de.nextZ=de.next,de=de.next;while(de!==K);de.prevZ.nextZ=null,de.prevZ=null,function(xe){let Re,we,nt,xt,ft,Ht,Xt,_i,vi=1;do{for(we=xe,xe=null,ft=null,Ht=0;we;){for(Ht++,nt=we,Xt=0,Re=0;Re<vi&&(Xt++,nt=nt.nextZ,nt);Re++);for(_i=vi;Xt>0||_i>0&&nt;)Xt!==0&&(_i===0||!nt||we.z<=nt.z)?(xt=we,we=we.nextZ,Xt--):(xt=nt,nt=nt.nextZ,_i--),ft?ft.nextZ=xt:xe=xt,xt.prevZ=ft,ft=xt;we=nt}ft.nextZ=null,vi*=2}while(Ht>1)}(de)}(S,g,_,M);let N,U,G=S;for(;S.prev!==S.next;)if(N=S.prev,U=S.next,M?wl(S,g,_,M):nc(S))e.push(N.i/l),e.push(S.i/l),e.push(U.i/l),O(S),S=U.next,G=U.next;else if((S=U)===G){P?P===1?Vl(S=rc(nl(S),e,l),e,l,g,_,M,2):P===2&&sc(S,e,l,g,_,M):Vl(nl(S),e,l,g,_,M,1);break}}function nc(S){const e=S.prev,l=S,g=S.next;if(ho(e,l,g)>=0)return!1;let _=S.next.next;for(;_!==S.prev;){if(Au(e.x,e.y,l.x,l.y,g.x,g.y,_.x,_.y)&&ho(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function wl(S,e,l,g){const _=S.prev,M=S,P=S.next;if(ho(_,M,P)>=0)return!1;const N=_.x<M.x?_.x<P.x?_.x:P.x:M.x<P.x?M.x:P.x,U=_.y<M.y?_.y<P.y?_.y:P.y:M.y<P.y?M.y:P.y,G=_.x>M.x?_.x>P.x?_.x:P.x:M.x>P.x?M.x:P.x,K=_.y>M.y?_.y>P.y?_.y:P.y:M.y>P.y?M.y:P.y,Q=Tf(N,U,e,l,g),ne=Tf(G,K,e,l,g);let oe=S.prevZ,de=S.nextZ;for(;oe&&oe.z>=Q&&de&&de.z<=ne;){if(oe!==S.prev&&oe!==S.next&&Au(_.x,_.y,M.x,M.y,P.x,P.y,oe.x,oe.y)&&ho(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,de!==S.prev&&de!==S.next&&Au(_.x,_.y,M.x,M.y,P.x,P.y,de.x,de.y)&&ho(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;oe&&oe.z>=Q;){if(oe!==S.prev&&oe!==S.next&&Au(_.x,_.y,M.x,M.y,P.x,P.y,oe.x,oe.y)&&ho(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;de&&de.z<=ne;){if(de!==S.prev&&de!==S.next&&Au(_.x,_.y,M.x,M.y,P.x,P.y,de.x,de.y)&&ho(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function rc(S,e,l){let g=S;do{const _=g.prev,M=g.next.next;!h(_,M)&&i(_,g,g.next,M)&&x(_,M)&&x(M,_)&&(e.push(_.i/l),e.push(g.i/l),e.push(M.i/l),O(g),O(g.next),g=S=M),g=g.next}while(g!==S);return nl(g)}function sc(S,e,l,g,_,M){let P=S;do{let N=P.next.next;for(;N!==P.prev;){if(P.i!==N.i&&Qo(P,N)){let U=w(P,N);return P=nl(P,P.next),U=nl(U,U.next),Vl(P,e,l,g,_,M),void Vl(U,e,l,g,_,M)}N=N.next}P=P.next}while(P!==S)}function Gl(S,e){return S.x-e.x}function Ug(S,e){if(e=function(l,g){let _=g;const M=l.x,P=l.y;let N,U=-1/0;do{if(P<=_.y&&P>=_.next.y&&_.next.y!==_.y){const de=_.x+(P-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(de<=M&&de>U){if(U=de,de===M){if(P===_.y)return _;if(P===_.next.y)return _.next}N=_.x<_.next.x?_:_.next}}_=_.next}while(_!==g);if(!N)return null;if(M===U)return N;const G=N,K=N.x,Q=N.y;let ne,oe=1/0;_=N;do M>=_.x&&_.x>=K&&M!==_.x&&Au(P<Q?M:U,P,K,Q,P<Q?U:M,P,_.x,_.y)&&(ne=Math.abs(P-_.y)/(M-_.x),x(_,l)&&(ne<oe||ne===oe&&(_.x>N.x||_.x===N.x&&Vg(N,_)))&&(N=_,oe=ne)),_=_.next;while(_!==G);return N}(S,e)){const l=w(e,S);nl(e,e.next),nl(l,l.next)}}function Vg(S,e){return ho(S.prev,S,e.prev)<0&&ho(e.next,S,S.next)<0}function Tf(S,e,l,g,_){return(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S=32767*(S-l)*_)|S<<8))|S<<4))|S<<2))|S<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-g)*_)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Gg(S){let e=S,l=S;do(e.x<l.x||e.x===l.x&&e.y<l.y)&&(l=e),e=e.next;while(e!==S);return l}function Au(S,e,l,g,_,M,P,N){return(_-P)*(e-N)-(S-P)*(M-N)>=0&&(S-P)*(g-N)-(l-P)*(e-N)>=0&&(l-P)*(M-N)-(_-P)*(g-N)>=0}function Qo(S,e){return S.next.i!==e.i&&S.prev.i!==e.i&&!function(l,g){let _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==g.i&&_.next.i!==g.i&&i(_,_.next,l,g))return!0;_=_.next}while(_!==l);return!1}(S,e)&&(x(S,e)&&x(e,S)&&function(l,g){let _=l,M=!1;const P=(l.x+g.x)/2,N=(l.y+g.y)/2;do _.y>N!=_.next.y>N&&_.next.y!==_.y&&P<(_.next.x-_.x)*(N-_.y)/(_.next.y-_.y)+_.x&&(M=!M),_=_.next;while(_!==l);return M}(S,e)&&(ho(S.prev,S,e.prev)||ho(S,e.prev,e))||h(S,e)&&ho(S.prev,S,S.next)>0&&ho(e.prev,e,e.next)>0)}function ho(S,e,l){return(e.y-S.y)*(l.x-e.x)-(e.x-S.x)*(l.y-e.y)}function h(S,e){return S.x===e.x&&S.y===e.y}function i(S,e,l,g){const _=d(ho(S,e,l)),M=d(ho(S,e,g)),P=d(ho(l,g,S)),N=d(ho(l,g,e));return _!==M&&P!==N||!(_!==0||!s(S,l,e))||!(M!==0||!s(S,g,e))||!(P!==0||!s(l,S,g))||!(N!==0||!s(l,e,g))}function s(S,e,l){return e.x<=Math.max(S.x,l.x)&&e.x>=Math.min(S.x,l.x)&&e.y<=Math.max(S.y,l.y)&&e.y>=Math.min(S.y,l.y)}function d(S){return S>0?1:S<0?-1:0}function x(S,e){return ho(S.prev,S,S.next)<0?ho(S,e,S.next)>=0&&ho(S,S.prev,e)>=0:ho(S,e,S.prev)<0||ho(S,S.next,e)<0}function w(S,e){const l=new B(S.i,S.x,S.y),g=new B(e.i,e.x,e.y),_=S.next,M=e.prev;return S.next=e,e.prev=S,l.next=_,_.prev=l,g.next=l,l.prev=g,M.next=g,g.prev=M,g}function E(S,e,l,g){const _=new B(S,e,l);return g?(_.next=g.next,_.prev=g,g.next.prev=_,g.next=_):(_.prev=_,_.next=_),_}function O(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function B(S,e,l){this.i=S,this.x=e,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class j{static area(e){const l=e.length;let g=0;for(let _=l-1,M=0;M<l;_=M++)g+=e[_].x*e[M].y-e[M].x*e[_].y;return .5*g}static isClockWise(e){return j.area(e)<0}static triangulateShape(e,l){const g=[],_=[],M=[];H(e),Z(g,e);let P=e.length;l.forEach(H);for(let U=0;U<l.length;U++)_.push(P),P+=l[U].length,Z(g,l[U]);const N=cp(g,_);for(let U=0;U<N.length;U+=3)M.push(N.slice(U,U+3));return M}}function H(S){const e=S.length;e>2&&S[e-1].equals(S[0])&&S.pop()}function Z(S,e){for(let l=0;l<e.length;l++)S.push(e[l].x),S.push(e[l].y)}class Y extends Pr{constructor(e,l){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:l},e=Array.isArray(e)?e:[e];const g=this,_=[],M=[];for(let N=0,U=e.length;N<U;N++)P(e[N]);function P(N){const U=[],G=l.curveSegments!==void 0?l.curveSegments:12,K=l.steps!==void 0?l.steps:1;let Q=l.depth!==void 0?l.depth:100,ne=l.bevelEnabled===void 0||l.bevelEnabled,oe=l.bevelThickness!==void 0?l.bevelThickness:6,de=l.bevelSize!==void 0?l.bevelSize:oe-2,xe=l.bevelOffset!==void 0?l.bevelOffset:0,Re=l.bevelSegments!==void 0?l.bevelSegments:3;const we=l.extrudePath,nt=l.UVGenerator!==void 0?l.UVGenerator:se;l.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),Q=l.amount);let xt,ft,Ht,Xt,_i,vi=!1;we&&(xt=we.getSpacedPoints(K),vi=!0,ne=!1,ft=we.computeFrenetFrames(K,!1),Ht=new ie,Xt=new ie,_i=new ie),ne||(Re=0,oe=0,de=0,xe=0);const Bi=N.extractPoints(G);let Li=Bi.shape;const ki=Bi.holes;if(!j.isClockWise(Li)){Li=Li.reverse();for(let Ni=0,kt=ki.length;Ni<kt;Ni++){const Ii=ki[Ni];j.isClockWise(Ii)&&(ki[Ni]=Ii.reverse())}}const Zn=j.triangulateShape(Li,ki),En=Li;for(let Ni=0,kt=ki.length;Ni<kt;Ni++){const Ii=ki[Ni];Li=Li.concat(Ii)}function Ji(Ni,kt,Ii){return kt||console.error("THREE.ExtrudeGeometry: vec does not exist"),kt.clone().multiplyScalar(Ii).add(Ni)}const In=Li.length,ir=Zn.length;function rr(Ni,kt,Ii){let gn,vn,pn;const or=Ni.x-kt.x,Ar=Ni.y-kt.y,mr=Ii.x-Ni.x,ns=Ii.y-Ni.y,Kr=or*or+Ar*Ar,ta=or*ns-Ar*mr;if(Math.abs(ta)>Number.EPSILON){const io=Math.sqrt(Kr),ia=Math.sqrt(mr*mr+ns*ns),rl=kt.x-Ar/io,vh=kt.y+or/io,ud=((Ii.x-ns/ia-rl)*ns-(Ii.y+mr/ia-vh)*mr)/(or*ns-Ar*mr);gn=rl+or*ud-Ni.x,vn=vh+Ar*ud-Ni.y;const xh=gn*gn+vn*vn;if(xh<=2)return new en(gn,vn);pn=Math.sqrt(xh/2)}else{let io=!1;or>Number.EPSILON?mr>Number.EPSILON&&(io=!0):or<-Number.EPSILON?mr<-Number.EPSILON&&(io=!0):Math.sign(Ar)===Math.sign(ns)&&(io=!0),io?(gn=-Ar,vn=or,pn=Math.sqrt(Kr)):(gn=or,vn=Ar,pn=Math.sqrt(Kr/2))}return new en(gn/pn,vn/pn)}const vr=[];for(let Ni=0,kt=En.length,Ii=kt-1,gn=Ni+1;Ni<kt;Ni++,Ii++,gn++)Ii===kt&&(Ii=0),gn===kt&&(gn=0),vr[Ni]=rr(En[Ni],En[Ii],En[gn]);const kr=[];let Fr,Rn=vr.concat();for(let Ni=0,kt=ki.length;Ni<kt;Ni++){const Ii=ki[Ni];Fr=[];for(let gn=0,vn=Ii.length,pn=vn-1,or=gn+1;gn<vn;gn++,pn++,or++)pn===vn&&(pn=0),or===vn&&(or=0),Fr[gn]=rr(Ii[gn],Ii[pn],Ii[or]);kr.push(Fr),Rn=Rn.concat(Fr)}for(let Ni=0;Ni<Re;Ni++){const kt=Ni/Re,Ii=oe*Math.cos(kt*Math.PI/2),gn=de*Math.sin(kt*Math.PI/2)+xe;for(let vn=0,pn=En.length;vn<pn;vn++){const or=Ji(En[vn],vr[vn],gn);Qi(or.x,or.y,-Ii)}for(let vn=0,pn=ki.length;vn<pn;vn++){const or=ki[vn];Fr=kr[vn];for(let Ar=0,mr=or.length;Ar<mr;Ar++){const ns=Ji(or[Ar],Fr[Ar],gn);Qi(ns.x,ns.y,-Ii)}}}const qt=de+xe;for(let Ni=0;Ni<In;Ni++){const kt=ne?Ji(Li[Ni],Rn[Ni],qt):Li[Ni];vi?(Xt.copy(ft.normals[0]).multiplyScalar(kt.x),Ht.copy(ft.binormals[0]).multiplyScalar(kt.y),_i.copy(xt[0]).add(Xt).add(Ht),Qi(_i.x,_i.y,_i.z)):Qi(kt.x,kt.y,0)}for(let Ni=1;Ni<=K;Ni++)for(let kt=0;kt<In;kt++){const Ii=ne?Ji(Li[kt],Rn[kt],qt):Li[kt];vi?(Xt.copy(ft.normals[Ni]).multiplyScalar(Ii.x),Ht.copy(ft.binormals[Ni]).multiplyScalar(Ii.y),_i.copy(xt[Ni]).add(Xt).add(Ht),Qi(_i.x,_i.y,_i.z)):Qi(Ii.x,Ii.y,Q/K*Ni)}for(let Ni=Re-1;Ni>=0;Ni--){const kt=Ni/Re,Ii=oe*Math.cos(kt*Math.PI/2),gn=de*Math.sin(kt*Math.PI/2)+xe;for(let vn=0,pn=En.length;vn<pn;vn++){const or=Ji(En[vn],vr[vn],gn);Qi(or.x,or.y,Q+Ii)}for(let vn=0,pn=ki.length;vn<pn;vn++){const or=ki[vn];Fr=kr[vn];for(let Ar=0,mr=or.length;Ar<mr;Ar++){const ns=Ji(or[Ar],Fr[Ar],gn);vi?Qi(ns.x,ns.y+xt[K-1].y,xt[K-1].x+Ii):Qi(ns.x,ns.y,Q+Ii)}}}function ti(Ni,kt){let Ii=Ni.length;for(;--Ii>=0;){const gn=Ii;let vn=Ii-1;vn<0&&(vn=Ni.length-1);for(let pn=0,or=K+2*Re;pn<or;pn++){const Ar=In*pn,mr=In*(pn+1);Oi(kt+gn+Ar,kt+vn+Ar,kt+vn+mr,kt+gn+mr)}}}function Qi(Ni,kt,Ii){U.push(Ni),U.push(kt),U.push(Ii)}function ji(Ni,kt,Ii){Nn(Ni),Nn(kt),Nn(Ii);const gn=_.length/3,vn=nt.generateTopUV(g,_,gn-3,gn-2,gn-1);Hn(vn[0]),Hn(vn[1]),Hn(vn[2])}function Oi(Ni,kt,Ii,gn){Nn(Ni),Nn(kt),Nn(gn),Nn(kt),Nn(Ii),Nn(gn);const vn=_.length/3,pn=nt.generateSideWallUV(g,_,vn-6,vn-3,vn-2,vn-1);Hn(pn[0]),Hn(pn[1]),Hn(pn[3]),Hn(pn[1]),Hn(pn[2]),Hn(pn[3])}function Nn(Ni){_.push(U[3*Ni+0]),_.push(U[3*Ni+1]),_.push(U[3*Ni+2])}function Hn(Ni){M.push(Ni.x),M.push(Ni.y)}(function(){const Ni=_.length/3;if(ne){let kt=0,Ii=In*kt;for(let gn=0;gn<ir;gn++){const vn=Zn[gn];ji(vn[2]+Ii,vn[1]+Ii,vn[0]+Ii)}kt=K+2*Re,Ii=In*kt;for(let gn=0;gn<ir;gn++){const vn=Zn[gn];ji(vn[0]+Ii,vn[1]+Ii,vn[2]+Ii)}}else{for(let kt=0;kt<ir;kt++){const Ii=Zn[kt];ji(Ii[2],Ii[1],Ii[0])}for(let kt=0;kt<ir;kt++){const Ii=Zn[kt];ji(Ii[0]+In*K,Ii[1]+In*K,Ii[2]+In*K)}}g.addGroup(Ni,_.length/3-Ni,0)})(),function(){const Ni=_.length/3;let kt=0;ti(En,kt),kt+=En.length;for(let Ii=0,gn=ki.length;Ii<gn;Ii++){const vn=ki[Ii];ti(vn,kt),kt+=vn.length}g.addGroup(Ni,_.length/3-Ni,1)}()}this.setAttribute("position",new Un(_,3)),this.setAttribute("uv",new Un(M,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(l,g,_){if(_.shapes=[],Array.isArray(l))for(let M=0,P=l.length;M<P;M++){const N=l[M];_.shapes.push(N.uuid)}else _.shapes.push(l.uuid);return g.extrudePath!==void 0&&(_.options.extrudePath=g.extrudePath.toJSON()),_}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,l){const g=[];for(let M=0,P=e.shapes.length;M<P;M++){const N=l[e.shapes[M]];g.push(N)}const _=e.options.extrudePath;return _!==void 0&&(e.options.extrudePath=new lp[_.type]().fromJSON(_)),new Y(g,e.options)}}const se={generateTopUV:function(S,e,l,g,_){const M=e[3*l],P=e[3*l+1],N=e[3*g],U=e[3*g+1],G=e[3*_],K=e[3*_+1];return[new en(M,P),new en(N,U),new en(G,K)]},generateSideWallUV:function(S,e,l,g,_,M){const P=e[3*l],N=e[3*l+1],U=e[3*l+2],G=e[3*g],K=e[3*g+1],Q=e[3*g+2],ne=e[3*_],oe=e[3*_+1],de=e[3*_+2],xe=e[3*M],Re=e[3*M+1],we=e[3*M+2];return Math.abs(N-K)<Math.abs(P-G)?[new en(P,1-U),new en(G,1-Q),new en(ne,1-de),new en(xe,1-we)]:[new en(N,1-U),new en(K,1-Q),new en(oe,1-de),new en(Re,1-we)]}};class pe extends Ha{constructor(e=1,l=0){const g=(1+Math.sqrt(5))/2;super([-1,g,0,1,g,0,-1,-g,0,1,-g,0,0,-1,g,0,1,g,0,-1,-g,0,1,-g,g,0,-1,g,0,1,-g,0,-1,-g,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,l),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:l}}static fromJSON(e){return new pe(e.radius,e.detail)}}class ue extends Pr{constructor(e,l=12,g=0,_=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:l,phiStart:g,phiLength:_},l=Math.floor(l),_=Fn(_,0,2*Math.PI);const M=[],P=[],N=[],U=1/l,G=new ie,K=new en;for(let Q=0;Q<=l;Q++){const ne=g+Q*U*_,oe=Math.sin(ne),de=Math.cos(ne);for(let xe=0;xe<=e.length-1;xe++)G.x=e[xe].x*oe,G.y=e[xe].y,G.z=e[xe].x*de,P.push(G.x,G.y,G.z),K.x=Q/l,K.y=xe/(e.length-1),N.push(K.x,K.y)}for(let Q=0;Q<l;Q++)for(let ne=0;ne<e.length-1;ne++){const oe=ne+Q*e.length,de=oe,xe=oe+e.length,Re=oe+e.length+1,we=oe+1;M.push(de,xe,we),M.push(xe,Re,we)}if(this.setIndex(M),this.setAttribute("position",new Un(P,3)),this.setAttribute("uv",new Un(N,2)),this.computeVertexNormals(),_===2*Math.PI){const Q=this.attributes.normal.array,ne=new ie,oe=new ie,de=new ie,xe=l*e.length*3;for(let Re=0,we=0;Re<e.length;Re++,we+=3)ne.x=Q[we+0],ne.y=Q[we+1],ne.z=Q[we+2],oe.x=Q[xe+we+0],oe.y=Q[xe+we+1],oe.z=Q[xe+we+2],de.addVectors(ne,oe).normalize(),Q[we+0]=Q[xe+we+0]=de.x,Q[we+1]=Q[xe+we+1]=de.y,Q[we+2]=Q[xe+we+2]=de.z}}static fromJSON(e){return new ue(e.points,e.segments,e.phiStart,e.phiLength)}}class _e extends Ha{constructor(e=1,l=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,l),this.type="OctahedronGeometry",this.parameters={radius:e,detail:l}}static fromJSON(e){return new _e(e.radius,e.detail)}}class ge extends Pr{constructor(e,l,g){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:l,stacks:g};const _=[],M=[],P=[],N=[],U=1e-5,G=new ie,K=new ie,Q=new ie,ne=new ie,oe=new ie;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const de=l+1;for(let xe=0;xe<=g;xe++){const Re=xe/g;for(let we=0;we<=l;we++){const nt=we/l;e(nt,Re,K),M.push(K.x,K.y,K.z),nt-U>=0?(e(nt-U,Re,Q),ne.subVectors(K,Q)):(e(nt+U,Re,Q),ne.subVectors(Q,K)),Re-U>=0?(e(nt,Re-U,Q),oe.subVectors(K,Q)):(e(nt,Re+U,Q),oe.subVectors(Q,K)),G.crossVectors(ne,oe).normalize(),P.push(G.x,G.y,G.z),N.push(nt,Re)}}for(let xe=0;xe<g;xe++)for(let Re=0;Re<l;Re++){const we=xe*de+Re,nt=xe*de+Re+1,xt=(xe+1)*de+Re+1,ft=(xe+1)*de+Re;_.push(we,nt,ft),_.push(nt,xt,ft)}this.setIndex(_),this.setAttribute("position",new Un(M,3)),this.setAttribute("normal",new Un(P,3)),this.setAttribute("uv",new Un(N,2))}}class Oe extends Pr{constructor(e=.5,l=1,g=8,_=1,M=0,P=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:l,thetaSegments:g,phiSegments:_,thetaStart:M,thetaLength:P},g=Math.max(3,g);const N=[],U=[],G=[],K=[];let Q=e;const ne=(l-e)/(_=Math.max(1,_)),oe=new ie,de=new en;for(let xe=0;xe<=_;xe++){for(let Re=0;Re<=g;Re++){const we=M+Re/g*P;oe.x=Q*Math.cos(we),oe.y=Q*Math.sin(we),U.push(oe.x,oe.y,oe.z),G.push(0,0,1),de.x=(oe.x/l+1)/2,de.y=(oe.y/l+1)/2,K.push(de.x,de.y)}Q+=ne}for(let xe=0;xe<_;xe++){const Re=xe*(g+1);for(let we=0;we<g;we++){const nt=we+Re,xt=nt,ft=nt+g+1,Ht=nt+g+2,Xt=nt+1;N.push(xt,ft,Xt),N.push(ft,Ht,Xt)}}this.setIndex(N),this.setAttribute("position",new Un(U,3)),this.setAttribute("normal",new Un(G,3)),this.setAttribute("uv",new Un(K,2))}static fromJSON(e){return new Oe(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Ne extends Pr{constructor(e,l=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:l};const g=[],_=[],M=[],P=[];let N=0,U=0;if(Array.isArray(e)===!1)G(e);else for(let K=0;K<e.length;K++)G(e[K]),this.addGroup(N,U,K),N+=U,U=0;function G(K){const Q=_.length/3,ne=K.extractPoints(l);let oe=ne.shape;const de=ne.holes;j.isClockWise(oe)===!1&&(oe=oe.reverse());for(let Re=0,we=de.length;Re<we;Re++){const nt=de[Re];j.isClockWise(nt)===!0&&(de[Re]=nt.reverse())}const xe=j.triangulateShape(oe,de);for(let Re=0,we=de.length;Re<we;Re++){const nt=de[Re];oe=oe.concat(nt)}for(let Re=0,we=oe.length;Re<we;Re++){const nt=oe[Re];_.push(nt.x,nt.y,0),M.push(0,0,1),P.push(nt.x,nt.y)}for(let Re=0,we=xe.length;Re<we;Re++){const nt=xe[Re],xt=nt[0]+Q,ft=nt[1]+Q,Ht=nt[2]+Q;g.push(xt,ft,Ht),U+=3}}this.setIndex(g),this.setAttribute("position",new Un(_,3)),this.setAttribute("normal",new Un(M,3)),this.setAttribute("uv",new Un(P,2))}toJSON(){const e=super.toJSON();return function(l,g){if(g.shapes=[],Array.isArray(l))for(let _=0,M=l.length;_<M;_++){const P=l[_];g.shapes.push(P.uuid)}else g.shapes.push(l.uuid);return g}(this.parameters.shapes,e)}static fromJSON(e,l){const g=[];for(let _=0,M=e.shapes.length;_<M;_++){const P=l[e.shapes[_]];g.push(P)}return new Ne(g,e.curveSegments)}}class Ue extends Pr{constructor(e=1,l=32,g=16,_=0,M=2*Math.PI,P=0,N=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:l,heightSegments:g,phiStart:_,phiLength:M,thetaStart:P,thetaLength:N},l=Math.max(3,Math.floor(l)),g=Math.max(2,Math.floor(g));const U=Math.min(P+N,Math.PI);let G=0;const K=[],Q=new ie,ne=new ie,oe=[],de=[],xe=[],Re=[];for(let we=0;we<=g;we++){const nt=[],xt=we/g;let ft=0;we==0&&P==0?ft=.5/l:we==g&&U==Math.PI&&(ft=-.5/l);for(let Ht=0;Ht<=l;Ht++){const Xt=Ht/l;Q.x=-e*Math.cos(_+Xt*M)*Math.sin(P+xt*N),Q.y=e*Math.cos(P+xt*N),Q.z=e*Math.sin(_+Xt*M)*Math.sin(P+xt*N),de.push(Q.x,Q.y,Q.z),ne.copy(Q).normalize(),xe.push(ne.x,ne.y,ne.z),Re.push(Xt+ft,1-xt),nt.push(G++)}K.push(nt)}for(let we=0;we<g;we++)for(let nt=0;nt<l;nt++){const xt=K[we][nt+1],ft=K[we][nt],Ht=K[we+1][nt],Xt=K[we+1][nt+1];(we!==0||P>0)&&oe.push(xt,ft,Xt),(we!==g-1||U<Math.PI)&&oe.push(ft,Ht,Xt)}this.setIndex(oe),this.setAttribute("position",new Un(de,3)),this.setAttribute("normal",new Un(xe,3)),this.setAttribute("uv",new Un(Re,2))}static fromJSON(e){return new Ue(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class $e extends Ha{constructor(e=1,l=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,l),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:l}}static fromJSON(e){return new $e(e.radius,e.detail)}}class Ke extends Y{constructor(e,l={}){const g=l.font;if(!g||!g.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Pr;const _=g.generateShapes(e,l.size);l.depth=l.height!==void 0?l.height:50,l.bevelThickness===void 0&&(l.bevelThickness=10),l.bevelSize===void 0&&(l.bevelSize=8),l.bevelEnabled===void 0&&(l.bevelEnabled=!1),super(_,l),this.type="TextGeometry"}}class Ze extends Pr{constructor(e=1,l=.4,g=8,_=6,M=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:l,radialSegments:g,tubularSegments:_,arc:M},g=Math.floor(g),_=Math.floor(_);const P=[],N=[],U=[],G=[],K=new ie,Q=new ie,ne=new ie;for(let oe=0;oe<=g;oe++)for(let de=0;de<=_;de++){const xe=de/_*M,Re=oe/g*Math.PI*2;Q.x=(e+l*Math.cos(Re))*Math.cos(xe),Q.y=(e+l*Math.cos(Re))*Math.sin(xe),Q.z=l*Math.sin(Re),N.push(Q.x,Q.y,Q.z),K.x=e*Math.cos(xe),K.y=e*Math.sin(xe),ne.subVectors(Q,K).normalize(),U.push(ne.x,ne.y,ne.z),G.push(de/_),G.push(oe/g)}for(let oe=1;oe<=g;oe++)for(let de=1;de<=_;de++){const xe=(_+1)*oe+de-1,Re=(_+1)*(oe-1)+de-1,we=(_+1)*(oe-1)+de,nt=(_+1)*oe+de;P.push(xe,Re,nt),P.push(Re,we,nt)}this.setIndex(P),this.setAttribute("position",new Un(N,3)),this.setAttribute("normal",new Un(U,3)),this.setAttribute("uv",new Un(G,2))}static fromJSON(e){return new Ze(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class it extends Pr{constructor(e=1,l=.4,g=64,_=8,M=2,P=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:l,tubularSegments:g,radialSegments:_,p:M,q:P},g=Math.floor(g),_=Math.floor(_);const N=[],U=[],G=[],K=[],Q=new ie,ne=new ie,oe=new ie,de=new ie,xe=new ie,Re=new ie,we=new ie;for(let xt=0;xt<=g;++xt){const ft=xt/g*M*Math.PI*2;nt(ft,M,P,e,oe),nt(ft+.01,M,P,e,de),Re.subVectors(de,oe),we.addVectors(de,oe),xe.crossVectors(Re,we),we.crossVectors(xe,Re),xe.normalize(),we.normalize();for(let Ht=0;Ht<=_;++Ht){const Xt=Ht/_*Math.PI*2,_i=-l*Math.cos(Xt),vi=l*Math.sin(Xt);Q.x=oe.x+(_i*we.x+vi*xe.x),Q.y=oe.y+(_i*we.y+vi*xe.y),Q.z=oe.z+(_i*we.z+vi*xe.z),U.push(Q.x,Q.y,Q.z),ne.subVectors(Q,oe).normalize(),G.push(ne.x,ne.y,ne.z),K.push(xt/g),K.push(Ht/_)}}for(let xt=1;xt<=g;xt++)for(let ft=1;ft<=_;ft++){const Ht=(_+1)*(xt-1)+(ft-1),Xt=(_+1)*xt+(ft-1),_i=(_+1)*xt+ft,vi=(_+1)*(xt-1)+ft;N.push(Ht,Xt,vi),N.push(Xt,_i,vi)}function nt(xt,ft,Ht,Xt,_i){const vi=Math.cos(xt),Bi=Math.sin(xt),Li=Ht/ft*xt,ki=Math.cos(Li);_i.x=Xt*(2+ki)*.5*vi,_i.y=Xt*(2+ki)*Bi*.5,_i.z=Xt*Math.sin(Li)*.5}this.setIndex(N),this.setAttribute("position",new Un(U,3)),this.setAttribute("normal",new Un(G,3)),this.setAttribute("uv",new Un(K,2))}static fromJSON(e){return new it(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class gt extends Pr{constructor(e,l=64,g=1,_=8,M=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:l,radius:g,radialSegments:_,closed:M};const P=e.computeFrenetFrames(l,M);this.tangents=P.tangents,this.normals=P.normals,this.binormals=P.binormals;const N=new ie,U=new ie,G=new en;let K=new ie;const Q=[],ne=[],oe=[],de=[];function xe(Re){K=e.getPointAt(Re/l,K);const we=P.normals[Re],nt=P.binormals[Re];for(let xt=0;xt<=_;xt++){const ft=xt/_*Math.PI*2,Ht=Math.sin(ft),Xt=-Math.cos(ft);U.x=Xt*we.x+Ht*nt.x,U.y=Xt*we.y+Ht*nt.y,U.z=Xt*we.z+Ht*nt.z,U.normalize(),ne.push(U.x,U.y,U.z),N.x=K.x+g*U.x,N.y=K.y+g*U.y,N.z=K.z+g*U.z,Q.push(N.x,N.y,N.z)}}(function(){for(let Re=0;Re<l;Re++)xe(Re);xe(M===!1?l:0),function(){for(let Re=0;Re<=l;Re++)for(let we=0;we<=_;we++)G.x=Re/l,G.y=we/_,oe.push(G.x,G.y)}(),function(){for(let Re=1;Re<=l;Re++)for(let we=1;we<=_;we++){const nt=(_+1)*(Re-1)+(we-1),xt=(_+1)*Re+(we-1),ft=(_+1)*Re+we,Ht=(_+1)*(Re-1)+we;de.push(nt,xt,Ht),de.push(xt,ft,Ht)}}()})(),this.setIndex(de),this.setAttribute("position",new Un(Q,3)),this.setAttribute("normal",new Un(ne,3)),this.setAttribute("uv",new Un(oe,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new gt(new lp[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Lt extends Pr{constructor(e){if(super(),this.type="WireframeGeometry",e.isGeometry===!0)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const l=[],g=new Set,_=new ie,M=new ie;if(e.index!==null){const P=e.attributes.position,N=e.index;let U=e.groups;U.length===0&&(U=[{start:0,count:N.count,materialIndex:0}]);for(let G=0,K=U.length;G<K;++G){const Q=U[G],ne=Q.start;for(let oe=ne,de=ne+Q.count;oe<de;oe+=3)for(let xe=0;xe<3;xe++){const Re=N.getX(oe+xe),we=N.getX(oe+(xe+1)%3);_.fromBufferAttribute(P,Re),M.fromBufferAttribute(P,we),wt(_,M,g)===!0&&(l.push(_.x,_.y,_.z),l.push(M.x,M.y,M.z))}}}else{const P=e.attributes.position;for(let N=0,U=P.count/3;N<U;N++)for(let G=0;G<3;G++){const K=3*N+G,Q=3*N+(G+1)%3;_.fromBufferAttribute(P,K),M.fromBufferAttribute(P,Q),wt(_,M,g)===!0&&(l.push(_.x,_.y,_.z),l.push(M.x,M.y,M.z))}}this.setAttribute("position",new Un(l,3))}}function wt(S,e,l){const g=`${S.x},${S.y},${S.z}-${e.x},${e.y},${e.z}`,_=`${e.x},${e.y},${e.z}-${S.x},${S.y},${S.z}`;return l.has(g)!==!0&&l.has(_)!==!0&&(l.add(g,_),!0)}var vt=Object.freeze({__proto__:null,BoxGeometry:Ja,BoxBufferGeometry:Ja,CircleGeometry:wu,CircleBufferGeometry:wu,ConeGeometry:Tu,ConeBufferGeometry:Tu,CylinderGeometry:Nl,CylinderBufferGeometry:Nl,DodecahedronGeometry:Mu,DodecahedronBufferGeometry:Mu,EdgesGeometry:bf,ExtrudeGeometry:Y,ExtrudeBufferGeometry:Y,IcosahedronGeometry:pe,IcosahedronBufferGeometry:pe,LatheGeometry:ue,LatheBufferGeometry:ue,OctahedronGeometry:_e,OctahedronBufferGeometry:_e,ParametricGeometry:ge,ParametricBufferGeometry:ge,PlaneGeometry:No,PlaneBufferGeometry:No,PolyhedronGeometry:Ha,PolyhedronBufferGeometry:Ha,RingGeometry:Oe,RingBufferGeometry:Oe,ShapeGeometry:Ne,ShapeBufferGeometry:Ne,SphereGeometry:Ue,SphereBufferGeometry:Ue,TetrahedronGeometry:$e,TetrahedronBufferGeometry:$e,TextGeometry:Ke,TextBufferGeometry:Ke,TorusGeometry:Ze,TorusBufferGeometry:Ze,TorusKnotGeometry:it,TorusKnotBufferGeometry:it,TubeGeometry:gt,TubeBufferGeometry:gt,WireframeGeometry:Lt});class ri extends Vi{constructor(e){super(),this.type="ShadowMaterial",this.color=new wn(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ri.prototype.isShadowMaterial=!0;class hi extends Vi{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new wn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}hi.prototype.isMeshStandardMaterial=!0;class Si extends hi{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new en(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Fn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(l){this.ior=(1+.4*l)/(1-.4*l)}}),this.sheenTint=new wn(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new wn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new wn(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheenTint.copy(e.sheenTint),this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}Si.prototype.isMeshPhysicalMaterial=!0;class Gi extends Vi{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new wn(16777215),this.specular=new wn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Gi.prototype.isMeshPhongMaterial=!0;class Ki extends Vi{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new wn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Ki.prototype.isMeshToonMaterial=!0;class Wt extends Vi{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Wt.prototype.isMeshNormalMaterial=!0;class wi extends Vi{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new wn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}wi.prototype.isMeshLambertMaterial=!0;class ui extends Vi{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new wn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}ui.prototype.isMeshMatcapMaterial=!0;class Ti extends Io{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Ti.prototype.isLineDashedMaterial=!0;var Ci=Object.freeze({__proto__:null,ShadowMaterial:ri,SpriteMaterial:tl,RawShaderMaterial:ru,ShaderMaterial:ao,PointsMaterial:xl,MeshPhysicalMaterial:Si,MeshStandardMaterial:hi,MeshPhongMaterial:Gi,MeshToonMaterial:Ki,MeshNormalMaterial:Wt,MeshLambertMaterial:wi,MeshDepthMaterial:Kh,MeshDistanceMaterial:oa,MeshBasicMaterial:ws,MeshMatcapMaterial:ui,LineDashedMaterial:Ti,LineBasicMaterial:Io,Material:Vi});const mi={arraySlice:function(S,e,l){return mi.isTypedArray(S)?new S.constructor(S.subarray(e,l!==void 0?l:S.length)):S.slice(e,l)},convertArray:function(S,e,l){return!S||!l&&S.constructor===e?S:typeof e.BYTES_PER_ELEMENT=="number"?new e(S):Array.prototype.slice.call(S)},isTypedArray:function(S){return ArrayBuffer.isView(S)&&!(S instanceof DataView)},getKeyframeOrder:function(S){const e=S.length,l=new Array(e);for(let g=0;g!==e;++g)l[g]=g;return l.sort(function(g,_){return S[g]-S[_]}),l},sortedArray:function(S,e,l){const g=S.length,_=new S.constructor(g);for(let M=0,P=0;P!==g;++M){const N=l[M]*e;for(let U=0;U!==e;++U)_[P++]=S[N+U]}return _},flattenJSON:function(S,e,l,g){let _=1,M=S[0];for(;M!==void 0&&M[g]===void 0;)M=S[_++];if(M===void 0)return;let P=M[g];if(P!==void 0)if(Array.isArray(P))do P=M[g],P!==void 0&&(e.push(M.time),l.push.apply(l,P)),M=S[_++];while(M!==void 0);else if(P.toArray!==void 0)do P=M[g],P!==void 0&&(e.push(M.time),P.toArray(l,l.length)),M=S[_++];while(M!==void 0);else do P=M[g],P!==void 0&&(e.push(M.time),l.push(P)),M=S[_++];while(M!==void 0)},subclip:function(S,e,l,g,_=30){const M=S.clone();M.name=e;const P=[];for(let U=0;U<M.tracks.length;++U){const G=M.tracks[U],K=G.getValueSize(),Q=[],ne=[];for(let oe=0;oe<G.times.length;++oe){const de=G.times[oe]*_;if(!(de<l||de>=g)){Q.push(G.times[oe]);for(let xe=0;xe<K;++xe)ne.push(G.values[oe*K+xe])}}Q.length!==0&&(G.times=mi.convertArray(Q,G.times.constructor),G.values=mi.convertArray(ne,G.values.constructor),P.push(G))}M.tracks=P;let N=1/0;for(let U=0;U<M.tracks.length;++U)N>M.tracks[U].times[0]&&(N=M.tracks[U].times[0]);for(let U=0;U<M.tracks.length;++U)M.tracks[U].shift(-1*N);return M.resetDuration(),M},makeClipAdditive:function(S,e=0,l=S,g=30){g<=0&&(g=30);const _=l.tracks.length,M=e/g;for(let P=0;P<_;++P){const N=l.tracks[P],U=N.ValueTypeName;if(U==="bool"||U==="string")continue;const G=S.tracks.find(function(we){return we.name===N.name&&we.ValueTypeName===U});if(G===void 0)continue;let K=0;const Q=N.getValueSize();N.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(K=Q/3);let ne=0;const oe=G.getValueSize();G.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(ne=oe/3);const de=N.times.length-1;let xe;if(M<=N.times[0]){const we=K,nt=Q-K;xe=mi.arraySlice(N.values,we,nt)}else if(M>=N.times[de]){const we=de*Q+K,nt=we+Q-K;xe=mi.arraySlice(N.values,we,nt)}else{const we=N.createInterpolant(),nt=K,xt=Q-K;we.evaluate(M),xe=mi.arraySlice(we.resultBuffer,nt,xt)}U==="quaternion"&&new ye().fromArray(xe).normalize().conjugate().toArray(xe);const Re=G.times.length;for(let we=0;we<Re;++we){const nt=we*oe+ne;if(U==="quaternion")ye.multiplyQuaternionsFlat(G.values,nt,xe,0,G.values,nt);else{const xt=oe-2*ne;for(let ft=0;ft<xt;++ft)G.values[nt+ft]-=xe[ft]}}}return S.blendMode=2501,S}};class Xi{constructor(e,l,g,_){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=_!==void 0?_:new l.constructor(g),this.sampleValues=l,this.valueSize=g,this.settings=null,this.DefaultSettings_={}}evaluate(e){const l=this.parameterPositions;let g=this._cachedIndex,_=l[g],M=l[g-1];e:{t:{let P;i:{n:if(!(e<_)){for(let N=g+2;;){if(_===void 0){if(e<M)break n;return g=l.length,this._cachedIndex=g,this.afterEnd_(g-1,e,M)}if(g===N)break;if(M=_,_=l[++g],e<_)break t}P=l.length;break i}if(e>=M)break e;{const N=l[1];e<N&&(g=2,M=N);for(let U=g-2;;){if(M===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,_);if(g===U)break;if(_=M,M=l[--g-1],e>=M)break t}P=g,g=0}}for(;g<P;){const N=g+P>>>1;e<l[N]?P=N:g=N+1}if(_=l[g],M=l[g-1],M===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,_);if(_===void 0)return g=l.length,this._cachedIndex=g,this.afterEnd_(g-1,M,e)}this._cachedIndex=g,this.intervalChanged_(g,M,_)}return this.interpolate_(g,M,e,_)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const l=this.resultBuffer,g=this.sampleValues,_=this.valueSize,M=e*_;for(let P=0;P!==_;++P)l[P]=g[M+P];return l}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Xi.prototype.beforeStart_=Xi.prototype.copySampleValue_,Xi.prototype.afterEnd_=Xi.prototype.copySampleValue_;class zn extends Xi{constructor(e,l,g,_){super(e,l,g,_),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,l,g){const _=this.parameterPositions;let M=e-2,P=e+1,N=_[M],U=_[P];if(N===void 0)switch(this.getSettings_().endingStart){case 2401:M=e,N=2*l-g;break;case 2402:M=_.length-2,N=l+_[M]-_[M+1];break;default:M=e,N=g}if(U===void 0)switch(this.getSettings_().endingEnd){case 2401:P=e,U=2*g-l;break;case 2402:P=1,U=g+_[1]-_[0];break;default:P=e-1,U=l}const G=.5*(g-l),K=this.valueSize;this._weightPrev=G/(l-N),this._weightNext=G/(U-g),this._offsetPrev=M*K,this._offsetNext=P*K}interpolate_(e,l,g,_){const M=this.resultBuffer,P=this.sampleValues,N=this.valueSize,U=e*N,G=U-N,K=this._offsetPrev,Q=this._offsetNext,ne=this._weightPrev,oe=this._weightNext,de=(g-l)/(_-l),xe=de*de,Re=xe*de,we=-ne*Re+2*ne*xe-ne*de,nt=(1+ne)*Re+(-1.5-2*ne)*xe+(-.5+ne)*de+1,xt=(-1-oe)*Re+(1.5+oe)*xe+.5*de,ft=oe*Re-oe*xe;for(let Ht=0;Ht!==N;++Ht)M[Ht]=we*P[K+Ht]+nt*P[G+Ht]+xt*P[U+Ht]+ft*P[Q+Ht];return M}}class $n extends Xi{constructor(e,l,g,_){super(e,l,g,_)}interpolate_(e,l,g,_){const M=this.resultBuffer,P=this.sampleValues,N=this.valueSize,U=e*N,G=U-N,K=(g-l)/(_-l),Q=1-K;for(let ne=0;ne!==N;++ne)M[ne]=P[G+ne]*Q+P[U+ne]*K;return M}}class An extends Xi{constructor(e,l,g,_){super(e,l,g,_)}interpolate_(e){return this.copySampleValue_(e-1)}}class kn{constructor(e,l,g,_){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(l===void 0||l.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=mi.convertArray(l,this.TimeBufferType),this.values=mi.convertArray(g,this.ValueBufferType),this.setInterpolation(_||this.DefaultInterpolation)}static toJSON(e){const l=e.constructor;let g;if(l.toJSON!==this.toJSON)g=l.toJSON(e);else{g={name:e.name,times:mi.convertArray(e.times,Array),values:mi.convertArray(e.values,Array)};const _=e.getInterpolation();_!==e.DefaultInterpolation&&(g.interpolation=_)}return g.type=e.ValueTypeName,g}InterpolantFactoryMethodDiscrete(e){return new An(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new $n(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new zn(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let l;switch(e){case 2300:l=this.InterpolantFactoryMethodDiscrete;break;case 2301:l=this.InterpolantFactoryMethodLinear;break;case 2302:l=this.InterpolantFactoryMethodSmooth}if(l===void 0){const g="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(g);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",g),this}return this.createInterpolant=l,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const l=this.times;for(let g=0,_=l.length;g!==_;++g)l[g]+=e}return this}scale(e){if(e!==1){const l=this.times;for(let g=0,_=l.length;g!==_;++g)l[g]*=e}return this}trim(e,l){const g=this.times,_=g.length;let M=0,P=_-1;for(;M!==_&&g[M]<e;)++M;for(;P!==-1&&g[P]>l;)--P;if(++P,M!==0||P!==_){M>=P&&(P=Math.max(P,1),M=P-1);const N=this.getValueSize();this.times=mi.arraySlice(g,M,P),this.values=mi.arraySlice(this.values,M*N,P*N)}return this}validate(){let e=!0;const l=this.getValueSize();l-Math.floor(l)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const g=this.times,_=this.values,M=g.length;M===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let P=null;for(let N=0;N!==M;N++){const U=g[N];if(typeof U=="number"&&isNaN(U)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,N,U),e=!1;break}if(P!==null&&P>U){console.error("THREE.KeyframeTrack: Out of order keys.",this,N,U,P),e=!1;break}P=U}if(_!==void 0&&mi.isTypedArray(_))for(let N=0,U=_.length;N!==U;++N){const G=_[N];if(isNaN(G)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,N,G),e=!1;break}}return e}optimize(){const e=mi.arraySlice(this.times),l=mi.arraySlice(this.values),g=this.getValueSize(),_=this.getInterpolation()===2302,M=e.length-1;let P=1;for(let N=1;N<M;++N){let U=!1;const G=e[N];if(G!==e[N+1]&&(N!==1||G!==e[0]))if(_)U=!0;else{const K=N*g,Q=K-g,ne=K+g;for(let oe=0;oe!==g;++oe){const de=l[K+oe];if(de!==l[Q+oe]||de!==l[ne+oe]){U=!0;break}}}if(U){if(N!==P){e[P]=e[N];const K=N*g,Q=P*g;for(let ne=0;ne!==g;++ne)l[Q+ne]=l[K+ne]}++P}}if(M>0){e[P]=e[M];for(let N=M*g,U=P*g,G=0;G!==g;++G)l[U+G]=l[N+G];++P}return P!==e.length?(this.times=mi.arraySlice(e,0,P),this.values=mi.arraySlice(l,0,P*g)):(this.times=e,this.values=l),this}clone(){const e=mi.arraySlice(this.times,0),l=mi.arraySlice(this.values,0),g=new this.constructor(this.name,e,l);return g.createInterpolant=this.createInterpolant,g}}kn.prototype.TimeBufferType=Float32Array,kn.prototype.ValueBufferType=Float32Array,kn.prototype.DefaultInterpolation=2301;class dn extends kn{}dn.prototype.ValueTypeName="bool",dn.prototype.ValueBufferType=Array,dn.prototype.DefaultInterpolation=2300,dn.prototype.InterpolantFactoryMethodLinear=void 0,dn.prototype.InterpolantFactoryMethodSmooth=void 0;class tr extends kn{}tr.prototype.ValueTypeName="color";class dr extends kn{}dr.prototype.ValueTypeName="number";class Nr extends Xi{constructor(e,l,g,_){super(e,l,g,_)}interpolate_(e,l,g,_){const M=this.resultBuffer,P=this.sampleValues,N=this.valueSize,U=(g-l)/(_-l);let G=e*N;for(let K=G+N;G!==K;G+=4)ye.slerpFlat(M,0,P,G-N,P,G,U);return M}}class as extends kn{InterpolantFactoryMethodLinear(e){return new Nr(this.times,this.values,this.getValueSize(),e)}}as.prototype.ValueTypeName="quaternion",as.prototype.DefaultInterpolation=2301,as.prototype.InterpolantFactoryMethodSmooth=void 0;class Ur extends kn{}Ur.prototype.ValueTypeName="string",Ur.prototype.ValueBufferType=Array,Ur.prototype.DefaultInterpolation=2300,Ur.prototype.InterpolantFactoryMethodLinear=void 0,Ur.prototype.InterpolantFactoryMethodSmooth=void 0;class vs extends kn{}vs.prototype.ValueTypeName="vector";class Xr{constructor(e,l=-1,g,_=2500){this.name=e,this.tracks=g,this.duration=l,this.blendMode=_,this.uuid=_n(),this.duration<0&&this.resetDuration()}static parse(e){const l=[],g=e.tracks,_=1/(e.fps||1);for(let P=0,N=g.length;P!==N;++P)l.push(Ss(g[P]).scale(_));const M=new this(e.name,e.duration,l,e.blendMode);return M.uuid=e.uuid,M}static toJSON(e){const l=[],g=e.tracks,_={name:e.name,duration:e.duration,tracks:l,uuid:e.uuid,blendMode:e.blendMode};for(let M=0,P=g.length;M!==P;++M)l.push(kn.toJSON(g[M]));return _}static CreateFromMorphTargetSequence(e,l,g,_){const M=l.length,P=[];for(let N=0;N<M;N++){let U=[],G=[];U.push((N+M-1)%M,N,(N+1)%M),G.push(0,1,0);const K=mi.getKeyframeOrder(U);U=mi.sortedArray(U,1,K),G=mi.sortedArray(G,1,K),_||U[0]!==0||(U.push(M),G.push(G[0])),P.push(new dr(".morphTargetInfluences["+l[N].name+"]",U,G).scale(1/g))}return new this(e,-1,P)}static findByName(e,l){let g=e;if(!Array.isArray(e)){const _=e;g=_.geometry&&_.geometry.animations||_.animations}for(let _=0;_<g.length;_++)if(g[_].name===l)return g[_];return null}static CreateClipsFromMorphTargetSequences(e,l,g){const _={},M=/^([\w-]*?)([\d]+)$/;for(let N=0,U=e.length;N<U;N++){const G=e[N],K=G.name.match(M);if(K&&K.length>1){const Q=K[1];let ne=_[Q];ne||(_[Q]=ne=[]),ne.push(G)}}const P=[];for(const N in _)P.push(this.CreateFromMorphTargetSequence(N,_[N],l,g));return P}static parseAnimation(e,l){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const g=function(K,Q,ne,oe,de){if(ne.length!==0){const xe=[],Re=[];mi.flattenJSON(ne,xe,Re,oe),xe.length!==0&&de.push(new K(Q,xe,Re))}},_=[],M=e.name||"default",P=e.fps||30,N=e.blendMode;let U=e.length||-1;const G=e.hierarchy||[];for(let K=0;K<G.length;K++){const Q=G[K].keys;if(Q&&Q.length!==0)if(Q[0].morphTargets){const ne={};let oe;for(oe=0;oe<Q.length;oe++)if(Q[oe].morphTargets)for(let de=0;de<Q[oe].morphTargets.length;de++)ne[Q[oe].morphTargets[de]]=-1;for(const de in ne){const xe=[],Re=[];for(let we=0;we!==Q[oe].morphTargets.length;++we){const nt=Q[oe];xe.push(nt.time),Re.push(nt.morphTarget===de?1:0)}_.push(new dr(".morphTargetInfluence["+de+"]",xe,Re))}U=ne.length*(P||1)}else{const ne=".bones["+l[K].name+"]";g(vs,ne+".position",Q,"pos",_),g(as,ne+".quaternion",Q,"rot",_),g(vs,ne+".scale",Q,"scl",_)}}return _.length===0?null:new this(M,U,_,N)}resetDuration(){let e=0;for(let l=0,g=this.tracks.length;l!==g;++l){const _=this.tracks[l];e=Math.max(e,_.times[_.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let l=0;l<this.tracks.length;l++)e=e&&this.tracks[l].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let l=0;l<this.tracks.length;l++)e.push(this.tracks[l].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ss(S){if(S.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dr;case"vector":case"vector2":case"vector3":case"vector4":return vs;case"color":return tr;case"quaternion":return as;case"bool":case"boolean":return dn;case"string":return Ur}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}(S.type);if(S.times===void 0){const l=[],g=[];mi.flattenJSON(S.keys,l,g,"value"),S.times=l,S.values=g}return e.parse!==void 0?e.parse(S):new e(S.name,S.times,S.values,S.interpolation)}const br={enabled:!1,files:{},add:function(S,e){this.enabled!==!1&&(this.files[S]=e)},get:function(S){if(this.enabled!==!1)return this.files[S]},remove:function(S){delete this.files[S]},clear:function(){this.files={}}};class ds{constructor(e,l,g){const _=this;let M,P=!1,N=0,U=0;const G=[];this.onStart=void 0,this.onLoad=e,this.onProgress=l,this.onError=g,this.itemStart=function(K){U++,P===!1&&_.onStart!==void 0&&_.onStart(K,N,U),P=!0},this.itemEnd=function(K){N++,_.onProgress!==void 0&&_.onProgress(K,N,U),N===U&&(P=!1,_.onLoad!==void 0&&_.onLoad())},this.itemError=function(K){_.onError!==void 0&&_.onError(K)},this.resolveURL=function(K){return M?M(K):K},this.setURLModifier=function(K){return M=K,this},this.addHandler=function(K,Q){return G.push(K,Q),this},this.removeHandler=function(K){const Q=G.indexOf(K);return Q!==-1&&G.splice(Q,2),this},this.getHandler=function(K){for(let Q=0,ne=G.length;Q<ne;Q+=2){const oe=G[Q],de=G[Q+1];if(oe.global&&(oe.lastIndex=0),oe.test(K))return de}return null}}}const ps=new ds;class Er{constructor(e){this.manager=e!==void 0?e:ps,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,l){const g=this;return new Promise(function(_,M){g.load(e,_,l,M)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const ts={};class Gs extends Er{constructor(e){super(e)}load(e,l,g,_){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const M=this,P=br.get(e);if(P!==void 0)return M.manager.itemStart(e),setTimeout(function(){l&&l(P),M.manager.itemEnd(e)},0),P;if(ts[e]!==void 0)return void ts[e].push({onLoad:l,onProgress:g,onError:_});const N=e.match(/^data:(.*?)(;base64)?,(.*)$/);let U;if(N){const G=N[1],K=!!N[2];let Q=N[3];Q=decodeURIComponent(Q),K&&(Q=atob(Q));try{let ne;const oe=(this.responseType||"").toLowerCase();switch(oe){case"arraybuffer":case"blob":const de=new Uint8Array(Q.length);for(let Re=0;Re<Q.length;Re++)de[Re]=Q.charCodeAt(Re);ne=oe==="blob"?new Blob([de.buffer],{type:G}):de.buffer;break;case"document":ne=new DOMParser().parseFromString(Q,G);break;case"json":ne=JSON.parse(Q);break;default:ne=Q}setTimeout(function(){l&&l(ne),M.manager.itemEnd(e)},0)}catch(ne){setTimeout(function(){_&&_(ne),M.manager.itemError(e),M.manager.itemEnd(e)},0)}}else{ts[e]=[],ts[e].push({onLoad:l,onProgress:g,onError:_}),U=new XMLHttpRequest,U.open("GET",e,!0),U.addEventListener("load",function(G){const K=this.response,Q=ts[e];if(delete ts[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),br.add(e,K);for(let ne=0,oe=Q.length;ne<oe;ne++){const de=Q[ne];de.onLoad&&de.onLoad(K)}M.manager.itemEnd(e)}else{for(let ne=0,oe=Q.length;ne<oe;ne++){const de=Q[ne];de.onError&&de.onError(G)}M.manager.itemError(e),M.manager.itemEnd(e)}},!1),U.addEventListener("progress",function(G){const K=ts[e];for(let Q=0,ne=K.length;Q<ne;Q++){const oe=K[Q];oe.onProgress&&oe.onProgress(G)}},!1),U.addEventListener("error",function(G){const K=ts[e];delete ts[e];for(let Q=0,ne=K.length;Q<ne;Q++){const oe=K[Q];oe.onError&&oe.onError(G)}M.manager.itemError(e),M.manager.itemEnd(e)},!1),U.addEventListener("abort",function(G){const K=ts[e];delete ts[e];for(let Q=0,ne=K.length;Q<ne;Q++){const oe=K[Q];oe.onError&&oe.onError(G)}M.manager.itemError(e),M.manager.itemEnd(e)},!1),this.responseType!==void 0&&(U.responseType=this.responseType),this.withCredentials!==void 0&&(U.withCredentials=this.withCredentials),U.overrideMimeType&&U.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const G in this.requestHeader)U.setRequestHeader(G,this.requestHeader[G]);U.send(null)}return M.manager.itemStart(e),U}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ea extends Er{constructor(e){super(e)}load(e,l,g,_){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const M=this,P=br.get(e);if(P!==void 0)return M.manager.itemStart(e),setTimeout(function(){l&&l(P),M.manager.itemEnd(e)},0),P;const N=document.createElementNS("http://www.w3.org/1999/xhtml","img");function U(){N.removeEventListener("load",U,!1),N.removeEventListener("error",G,!1),br.add(e,this),l&&l(this),M.manager.itemEnd(e)}function G(K){N.removeEventListener("load",U,!1),N.removeEventListener("error",G,!1),_&&_(K),M.manager.itemError(e),M.manager.itemEnd(e)}return N.addEventListener("load",U,!1),N.addEventListener("error",G,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(N.crossOrigin=this.crossOrigin),M.manager.itemStart(e),N.src=e,N}}class qa extends Er{constructor(e){super(e)}load(e,l,g,_){const M=new Ea,P=new ea(this.manager);P.setCrossOrigin(this.crossOrigin),P.setPath(this.path);let N=0;function U(G){P.load(e[G],function(K){M.images[G]=K,N++,N===6&&(M.needsUpdate=!0,l&&l(M))},void 0,_)}for(let G=0;G<e.length;++G)U(G);return M}}class Mo extends Er{constructor(e){super(e)}load(e,l,g,_){const M=this,P=new va,N=new Gs(this.manager);return N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(M.withCredentials),N.load(e,function(U){const G=M.parse(U);G&&(G.image!==void 0?P.image=G.image:G.data!==void 0&&(P.image.width=G.width,P.image.height=G.height,P.image.data=G.data),P.wrapS=G.wrapS!==void 0?G.wrapS:1001,P.wrapT=G.wrapT!==void 0?G.wrapT:1001,P.magFilter=G.magFilter!==void 0?G.magFilter:1006,P.minFilter=G.minFilter!==void 0?G.minFilter:1006,P.anisotropy=G.anisotropy!==void 0?G.anisotropy:1,G.encoding!==void 0&&(P.encoding=G.encoding),G.flipY!==void 0&&(P.flipY=G.flipY),G.format!==void 0&&(P.format=G.format),G.type!==void 0&&(P.type=G.type),G.mipmaps!==void 0&&(P.mipmaps=G.mipmaps,P.minFilter=1008),G.mipmapCount===1&&(P.minFilter=1006),G.generateMipmaps!==void 0&&(P.generateMipmaps=G.generateMipmaps),P.needsUpdate=!0,l&&l(P,G))},g,_),P}}class Wr extends Er{constructor(e){super(e)}load(e,l,g,_){const M=new _s,P=new ea(this.manager);return P.setCrossOrigin(this.crossOrigin),P.setPath(this.path),P.load(e,function(N){M.image=N;const U=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;M.format=U?1022:1023,M.needsUpdate=!0,l!==void 0&&l(M)},g,_),M}}class Hr extends ja{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),l=this.curves[this.curves.length-1].getPoint(1);e.equals(l)||this.curves.push(new Vc(l,e))}getPoint(e){const l=e*this.getLength(),g=this.getCurveLengths();let _=0;for(;_<g.length;){if(g[_]>=l){const M=g[_]-l,P=this.curves[_],N=P.getLength(),U=N===0?0:1-M/N;return P.getPointAt(U)}_++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let l=0;for(let g=0,_=this.curves.length;g<_;g++)l+=this.curves[g].getLength(),e.push(l);return this.cacheLengths=e,e}getSpacedPoints(e=40){const l=[];for(let g=0;g<=e;g++)l.push(this.getPoint(g/e));return this.autoClose&&l.push(l[0]),l}getPoints(e=12){const l=[];let g;for(let _=0,M=this.curves;_<M.length;_++){const P=M[_],N=P&&P.isEllipseCurve?2*e:P&&(P.isLineCurve||P.isLineCurve3)?1:P&&P.isSplineCurve?e*P.points.length:e,U=P.getPoints(N);for(let G=0;G<U.length;G++){const K=U[G];g&&g.equals(K)||(l.push(K),g=K)}}return this.autoClose&&l.length>1&&!l[l.length-1].equals(l[0])&&l.push(l[0]),l}copy(e){super.copy(e),this.curves=[];for(let l=0,g=e.curves.length;l<g;l++){const _=e.curves[l];this.curves.push(_.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let l=0,g=this.curves.length;l<g;l++){const _=this.curves[l];e.curves.push(_.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let l=0,g=e.curves.length;l<g;l++){const _=e.curves[l];this.curves.push(new lp[_.type]().fromJSON(_))}return this}}class Yr extends Hr{constructor(e){super(),this.type="Path",this.currentPoint=new en,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let l=1,g=e.length;l<g;l++)this.lineTo(e[l].x,e[l].y);return this}moveTo(e,l){return this.currentPoint.set(e,l),this}lineTo(e,l){const g=new Vc(this.currentPoint.clone(),new en(e,l));return this.curves.push(g),this.currentPoint.set(e,l),this}quadraticCurveTo(e,l,g,_){const M=new rd(this.currentPoint.clone(),new en(e,l),new en(g,_));return this.curves.push(M),this.currentPoint.set(g,_),this}bezierCurveTo(e,l,g,_,M,P){const N=new Wa(this.currentPoint.clone(),new en(e,l),new en(g,_),new en(M,P));return this.curves.push(N),this.currentPoint.set(M,P),this}splineThru(e){const l=[this.currentPoint.clone()].concat(e),g=new ap(l);return this.curves.push(g),this.currentPoint.copy(e[e.length-1]),this}arc(e,l,g,_,M,P){const N=this.currentPoint.x,U=this.currentPoint.y;return this.absarc(e+N,l+U,g,_,M,P),this}absarc(e,l,g,_,M,P){return this.absellipse(e,l,g,g,_,M,P),this}ellipse(e,l,g,_,M,P,N,U){const G=this.currentPoint.x,K=this.currentPoint.y;return this.absellipse(e+G,l+K,g,_,M,P,N,U),this}absellipse(e,l,g,_,M,P,N,U){const G=new Ks(e,l,g,_,M,P,N,U);if(this.curves.length>0){const Q=G.getPoint(0);Q.equals(this.currentPoint)||this.lineTo(Q.x,Q.y)}this.curves.push(G);const K=G.getPoint(1);return this.currentPoint.copy(K),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class is extends Yr{constructor(e){super(e),this.uuid=_n(),this.type="Shape",this.holes=[]}getPointsHoles(e){const l=[];for(let g=0,_=this.holes.length;g<_;g++)l[g]=this.holes[g].getPoints(e);return l}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let l=0,g=e.holes.length;l<g;l++){const _=e.holes[l];this.holes.push(_.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let l=0,g=this.holes.length;l<g;l++){const _=this.holes[l];e.holes.push(_.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let l=0,g=e.holes.length;l<g;l++){const _=e.holes[l];this.holes.push(new Yr().fromJSON(_))}return this}}class Es extends Ee{constructor(e,l=1){super(),this.type="Light",this.color=new wn(e),this.intensity=l}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const l=super.toJSON(e);return l.object.color=this.color.getHex(),l.object.intensity=this.intensity,this.groundColor!==void 0&&(l.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(l.object.distance=this.distance),this.angle!==void 0&&(l.object.angle=this.angle),this.decay!==void 0&&(l.object.decay=this.decay),this.penumbra!==void 0&&(l.object.penumbra=this.penumbra),this.shadow!==void 0&&(l.object.shadow=this.shadow.toJSON()),l}}Es.prototype.isLight=!0;class Os extends Es{constructor(e,l,g){super(e,g),this.type="HemisphereLight",this.position.copy(Ee.DefaultUp),this.updateMatrix(),this.groundColor=new wn(l)}copy(e){return Es.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}Os.prototype.isHemisphereLight=!0;const Ro=new nr,Tl=new ie,xa=new ie;class aa{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new en(512,512),this.map=null,this.mapPass=null,this.matrix=new nr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Sc,this._frameExtents=new en(1,1),this._viewportCount=1,this._viewports=[new Dr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const l=this.camera,g=this.matrix;Tl.setFromMatrixPosition(e.matrixWorld),l.position.copy(Tl),xa.setFromMatrixPosition(e.target.matrixWorld),l.lookAt(xa),l.updateMatrixWorld(),Ro.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ro),g.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),g.multiply(l.projectionMatrix),g.multiply(l.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class $a extends aa{constructor(){super(new _o(50,1,.5,500)),this.focus=1}updateMatrices(e){const l=this.camera,g=2*cn*e.angle*this.focus,_=this.mapSize.width/this.mapSize.height,M=e.distance||l.far;g===l.fov&&_===l.aspect&&M===l.far||(l.fov=g,l.aspect=_,l.far=M,l.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}$a.prototype.isSpotLightShadow=!0;class Za extends Es{constructor(e,l,g=0,_=Math.PI/3,M=0,P=1){super(e,l),this.type="SpotLight",this.position.copy(Ee.DefaultUp),this.updateMatrix(),this.target=new Ee,this.distance=g,this.angle=_,this.penumbra=M,this.decay=P,this.shadow=new $a}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Za.prototype.isSpotLight=!0;const ba=new nr,Xa=new ie,Pa=new ie;class ls extends aa{constructor(){super(new _o(90,1,.5,500)),this._frameExtents=new en(4,2),this._viewportCount=6,this._viewports=[new Dr(2,1,1,1),new Dr(0,1,1,1),new Dr(3,1,1,1),new Dr(1,1,1,1),new Dr(3,0,1,1),new Dr(1,0,1,1)],this._cubeDirections=[new ie(1,0,0),new ie(-1,0,0),new ie(0,0,1),new ie(0,0,-1),new ie(0,1,0),new ie(0,-1,0)],this._cubeUps=[new ie(0,1,0),new ie(0,1,0),new ie(0,1,0),new ie(0,1,0),new ie(0,0,1),new ie(0,0,-1)]}updateMatrices(e,l=0){const g=this.camera,_=this.matrix,M=e.distance||g.far;M!==g.far&&(g.far=M,g.updateProjectionMatrix()),Xa.setFromMatrixPosition(e.matrixWorld),g.position.copy(Xa),Pa.copy(g.position),Pa.add(this._cubeDirections[l]),g.up.copy(this._cubeUps[l]),g.lookAt(Pa),g.updateMatrixWorld(),_.makeTranslation(-Xa.x,-Xa.y,-Xa.z),ba.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ba)}}ls.prototype.isPointLightShadow=!0;class Gc extends Es{constructor(e,l,g=0,_=1){super(e,l),this.type="PointLight",this.distance=g,this.decay=_,this.shadow=new ls}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Gc.prototype.isPointLight=!0;class hp extends aa{constructor(){super(new Gu(-5,5,5,-5,.5,500))}}hp.prototype.isDirectionalLightShadow=!0;class Hc extends Es{constructor(e,l){super(e,l),this.type="DirectionalLight",this.position.copy(Ee.DefaultUp),this.updateMatrix(),this.target=new Ee,this.shadow=new hp}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Hc.prototype.isDirectionalLight=!0;class sd extends Es{constructor(e,l){super(e,l),this.type="AmbientLight"}}sd.prototype.isAmbientLight=!0;class Cu extends Es{constructor(e,l,g=10,_=10){super(e,l),this.type="RectAreaLight",this.width=g,this.height=_}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const l=super.toJSON(e);return l.object.width=this.width,l.object.height=this.height,l}}Cu.prototype.isRectAreaLight=!0;class Hl{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ie)}set(e){for(let l=0;l<9;l++)this.coefficients[l].copy(e[l]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,l){const g=e.x,_=e.y,M=e.z,P=this.coefficients;return l.copy(P[0]).multiplyScalar(.282095),l.addScaledVector(P[1],.488603*_),l.addScaledVector(P[2],.488603*M),l.addScaledVector(P[3],.488603*g),l.addScaledVector(P[4],g*_*1.092548),l.addScaledVector(P[5],_*M*1.092548),l.addScaledVector(P[6],.315392*(3*M*M-1)),l.addScaledVector(P[7],g*M*1.092548),l.addScaledVector(P[8],.546274*(g*g-_*_)),l}getIrradianceAt(e,l){const g=e.x,_=e.y,M=e.z,P=this.coefficients;return l.copy(P[0]).multiplyScalar(.886227),l.addScaledVector(P[1],1.023328*_),l.addScaledVector(P[2],1.023328*M),l.addScaledVector(P[3],1.023328*g),l.addScaledVector(P[4],.858086*g*_),l.addScaledVector(P[5],.858086*_*M),l.addScaledVector(P[6],.743125*M*M-.247708),l.addScaledVector(P[7],.858086*g*M),l.addScaledVector(P[8],.429043*(g*g-_*_)),l}add(e){for(let l=0;l<9;l++)this.coefficients[l].add(e.coefficients[l]);return this}addScaledSH(e,l){for(let g=0;g<9;g++)this.coefficients[g].addScaledVector(e.coefficients[g],l);return this}scale(e){for(let l=0;l<9;l++)this.coefficients[l].multiplyScalar(e);return this}lerp(e,l){for(let g=0;g<9;g++)this.coefficients[g].lerp(e.coefficients[g],l);return this}equals(e){for(let l=0;l<9;l++)if(!this.coefficients[l].equals(e.coefficients[l]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,l=0){const g=this.coefficients;for(let _=0;_<9;_++)g[_].fromArray(e,l+3*_);return this}toArray(e=[],l=0){const g=this.coefficients;for(let _=0;_<9;_++)g[_].toArray(e,l+3*_);return e}static getBasisAt(e,l){const g=e.x,_=e.y,M=e.z;l[0]=.282095,l[1]=.488603*_,l[2]=.488603*M,l[3]=.488603*g,l[4]=1.092548*g*_,l[5]=1.092548*_*M,l[6]=.315392*(3*M*M-1),l[7]=1.092548*g*M,l[8]=.546274*(g*g-_*_)}}Hl.prototype.isSphericalHarmonics3=!0;class Ml extends Es{constructor(e=new Hl,l=1){super(void 0,l),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const l=super.toJSON(e);return l.object.sh=this.sh.toArray(),l}}Ml.prototype.isLightProbe=!0;class Hg extends Er{constructor(e){super(e),this.textures={}}load(e,l,g,_){const M=this,P=new Gs(M.manager);P.setPath(M.path),P.setRequestHeader(M.requestHeader),P.setWithCredentials(M.withCredentials),P.load(e,function(N){try{l(M.parse(JSON.parse(N)))}catch(U){_?_(U):console.error(U),M.manager.itemError(e)}},g,_)}parse(e){const l=this.textures;function g(M){return l[M]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",M),l[M]}const _=new Ci[e.type];if(e.uuid!==void 0&&(_.uuid=e.uuid),e.name!==void 0&&(_.name=e.name),e.color!==void 0&&_.color!==void 0&&_.color.setHex(e.color),e.roughness!==void 0&&(_.roughness=e.roughness),e.metalness!==void 0&&(_.metalness=e.metalness),e.sheenTint!==void 0&&(_.sheenTint=new wn().setHex(e.sheenTint)),e.emissive!==void 0&&_.emissive!==void 0&&_.emissive.setHex(e.emissive),e.specular!==void 0&&_.specular!==void 0&&_.specular.setHex(e.specular),e.specularIntensity!==void 0&&(_.specularIntensity=e.specularIntensity),e.specularTint!==void 0&&_.specularTint!==void 0&&_.specularTint.setHex(e.specularTint),e.shininess!==void 0&&(_.shininess=e.shininess),e.clearcoat!==void 0&&(_.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(_.clearcoatRoughness=e.clearcoatRoughness),e.transmission!==void 0&&(_.transmission=e.transmission),e.thickness!==void 0&&(_.thickness=e.thickness),e.attenuationDistance!==void 0&&(_.attenuationDistance=e.attenuationDistance),e.attenuationTint!==void 0&&_.attenuationTint!==void 0&&_.attenuationTint.setHex(e.attenuationTint),e.fog!==void 0&&(_.fog=e.fog),e.flatShading!==void 0&&(_.flatShading=e.flatShading),e.blending!==void 0&&(_.blending=e.blending),e.combine!==void 0&&(_.combine=e.combine),e.side!==void 0&&(_.side=e.side),e.shadowSide!==void 0&&(_.shadowSide=e.shadowSide),e.opacity!==void 0&&(_.opacity=e.opacity),e.format!==void 0&&(_.format=e.format),e.transparent!==void 0&&(_.transparent=e.transparent),e.alphaTest!==void 0&&(_.alphaTest=e.alphaTest),e.depthTest!==void 0&&(_.depthTest=e.depthTest),e.depthWrite!==void 0&&(_.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(_.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(_.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(_.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(_.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(_.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(_.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(_.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(_.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(_.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(_.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(_.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(_.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(_.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(_.rotation=e.rotation),e.linewidth!==1&&(_.linewidth=e.linewidth),e.dashSize!==void 0&&(_.dashSize=e.dashSize),e.gapSize!==void 0&&(_.gapSize=e.gapSize),e.scale!==void 0&&(_.scale=e.scale),e.polygonOffset!==void 0&&(_.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(_.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(_.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(_.dithering=e.dithering),e.alphaToCoverage!==void 0&&(_.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(_.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(_.visible=e.visible),e.toneMapped!==void 0&&(_.toneMapped=e.toneMapped),e.userData!==void 0&&(_.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?_.vertexColors=e.vertexColors>0:_.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const M in e.uniforms){const P=e.uniforms[M];switch(_.uniforms[M]={},P.type){case"t":_.uniforms[M].value=g(P.value);break;case"c":_.uniforms[M].value=new wn().setHex(P.value);break;case"v2":_.uniforms[M].value=new en().fromArray(P.value);break;case"v3":_.uniforms[M].value=new ie().fromArray(P.value);break;case"v4":_.uniforms[M].value=new Dr().fromArray(P.value);break;case"m3":_.uniforms[M].value=new Wn().fromArray(P.value);break;case"m4":_.uniforms[M].value=new nr().fromArray(P.value);break;default:_.uniforms[M].value=P.value}}if(e.defines!==void 0&&(_.defines=e.defines),e.vertexShader!==void 0&&(_.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(_.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(const M in e.extensions)_.extensions[M]=e.extensions[M];if(e.shading!==void 0&&(_.flatShading=e.shading===1),e.size!==void 0&&(_.size=e.size),e.sizeAttenuation!==void 0&&(_.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(_.map=g(e.map)),e.matcap!==void 0&&(_.matcap=g(e.matcap)),e.alphaMap!==void 0&&(_.alphaMap=g(e.alphaMap)),e.bumpMap!==void 0&&(_.bumpMap=g(e.bumpMap)),e.bumpScale!==void 0&&(_.bumpScale=e.bumpScale),e.normalMap!==void 0&&(_.normalMap=g(e.normalMap)),e.normalMapType!==void 0&&(_.normalMapType=e.normalMapType),e.normalScale!==void 0){let M=e.normalScale;Array.isArray(M)===!1&&(M=[M,M]),_.normalScale=new en().fromArray(M)}return e.displacementMap!==void 0&&(_.displacementMap=g(e.displacementMap)),e.displacementScale!==void 0&&(_.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(_.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(_.roughnessMap=g(e.roughnessMap)),e.metalnessMap!==void 0&&(_.metalnessMap=g(e.metalnessMap)),e.emissiveMap!==void 0&&(_.emissiveMap=g(e.emissiveMap)),e.emissiveIntensity!==void 0&&(_.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(_.specularMap=g(e.specularMap)),e.specularIntensityMap!==void 0&&(_.specularIntensityMap=g(e.specularIntensityMap)),e.specularTintMap!==void 0&&(_.specularTintMap=g(e.specularTintMap)),e.envMap!==void 0&&(_.envMap=g(e.envMap)),e.envMapIntensity!==void 0&&(_.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(_.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(_.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(_.lightMap=g(e.lightMap)),e.lightMapIntensity!==void 0&&(_.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(_.aoMap=g(e.aoMap)),e.aoMapIntensity!==void 0&&(_.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(_.gradientMap=g(e.gradientMap)),e.clearcoatMap!==void 0&&(_.clearcoatMap=g(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(_.clearcoatRoughnessMap=g(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(_.clearcoatNormalMap=g(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(_.clearcoatNormalScale=new en().fromArray(e.clearcoatNormalScale)),e.transmissionMap!==void 0&&(_.transmissionMap=g(e.transmissionMap)),e.thicknessMap!==void 0&&(_.thicknessMap=g(e.thicknessMap)),_}setTextures(e){return this.textures=e,this}}class Mf{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let l="";for(let g=0,_=e.length;g<_;g++)l+=String.fromCharCode(e[g]);try{return decodeURIComponent(escape(l))}catch{return l}}static extractUrlBase(e){const l=e.lastIndexOf("/");return l===-1?"./":e.substr(0,l+1)}}class dp extends Pr{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}dp.prototype.isInstancedBufferGeometry=!0;class Cm extends Er{constructor(e){super(e)}load(e,l,g,_){const M=this,P=new Gs(M.manager);P.setPath(M.path),P.setRequestHeader(M.requestHeader),P.setWithCredentials(M.withCredentials),P.load(e,function(N){try{l(M.parse(JSON.parse(N)))}catch(U){_?_(U):console.error(U),M.manager.itemError(e)}},g,_)}parse(e){const l={},g={};function _(Q,ne){if(l[ne]!==void 0)return l[ne];const oe=Q.interleavedBuffers[ne],de=function(we,nt){if(g[nt]!==void 0)return g[nt];const xt=we.arrayBuffers[nt],ft=new Uint32Array(xt).buffer;return g[nt]=ft,ft}(Q,oe.buffer),xe=ma(oe.type,de),Re=new Va(xe,oe.stride);return Re.uuid=oe.uuid,l[ne]=Re,Re}const M=e.isInstancedBufferGeometry?new dp:new Pr,P=e.data.index;if(P!==void 0){const Q=ma(P.type,P.array);M.setIndex(new Or(Q,1))}const N=e.data.attributes;for(const Q in N){const ne=N[Q];let oe;if(ne.isInterleavedBufferAttribute){const de=_(e.data,ne.data);oe=new yl(de,ne.itemSize,ne.offset,ne.normalized)}else{const de=ma(ne.type,ne.array);oe=new(ne.isInstancedBufferAttribute?vl:Or)(de,ne.itemSize,ne.normalized)}ne.name!==void 0&&(oe.name=ne.name),ne.usage!==void 0&&oe.setUsage(ne.usage),ne.updateRange!==void 0&&(oe.updateRange.offset=ne.updateRange.offset,oe.updateRange.count=ne.updateRange.count),M.setAttribute(Q,oe)}const U=e.data.morphAttributes;if(U)for(const Q in U){const ne=U[Q],oe=[];for(let de=0,xe=ne.length;de<xe;de++){const Re=ne[de];let we;if(Re.isInterleavedBufferAttribute){const nt=_(e.data,Re.data);we=new yl(nt,Re.itemSize,Re.offset,Re.normalized)}else{const nt=ma(Re.type,Re.array);we=new Or(nt,Re.itemSize,Re.normalized)}Re.name!==void 0&&(we.name=Re.name),oe.push(we)}M.morphAttributes[Q]=oe}e.data.morphTargetsRelative&&(M.morphTargetsRelative=!0);const G=e.data.groups||e.data.drawcalls||e.data.offsets;if(G!==void 0)for(let Q=0,ne=G.length;Q!==ne;++Q){const oe=G[Q];M.addGroup(oe.start,oe.count,oe.materialIndex)}const K=e.data.boundingSphere;if(K!==void 0){const Q=new ie;K.center!==void 0&&Q.fromArray(K.center),M.boundingSphere=new Ns(Q,K.radius)}return e.name&&(M.name=e.name),e.userData&&(M.userData=e.userData),M}}const Sf={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Ef={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},jg={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};class Af extends Er{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,l,g,_){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const M=this,P=br.get(e);if(P!==void 0)return M.manager.itemStart(e),setTimeout(function(){l&&l(P),M.manager.itemEnd(e)},0),P;const N={};N.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",N.headers=this.requestHeader,fetch(e,N).then(function(U){return U.blob()}).then(function(U){return createImageBitmap(U,Object.assign(M.options,{colorSpaceConversion:"none"}))}).then(function(U){br.add(e,U),l&&l(U),M.manager.itemEnd(e)}).catch(function(U){_&&_(U),M.manager.itemError(e),M.manager.itemEnd(e)}),M.manager.itemStart(e)}}Af.prototype.isImageBitmapLoader=!0;class Lm{constructor(){this.type="ShapePath",this.color=new wn,this.subPaths=[],this.currentPath=null}moveTo(e,l){return this.currentPath=new Yr,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,l),this}lineTo(e,l){return this.currentPath.lineTo(e,l),this}quadraticCurveTo(e,l,g,_){return this.currentPath.quadraticCurveTo(e,l,g,_),this}bezierCurveTo(e,l,g,_,M,P){return this.currentPath.bezierCurveTo(e,l,g,_,M,P),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,l){function g(nt){const xt=[];for(let ft=0,Ht=nt.length;ft<Ht;ft++){const Xt=nt[ft],_i=new is;_i.curves=Xt.curves,xt.push(_i)}return xt}function _(nt,xt){const ft=xt.length;let Ht=!1;for(let Xt=ft-1,_i=0;_i<ft;Xt=_i++){let vi=xt[Xt],Bi=xt[_i],Li=Bi.x-vi.x,ki=Bi.y-vi.y;if(Math.abs(ki)>Number.EPSILON){if(ki<0&&(vi=xt[_i],Li=-Li,Bi=xt[Xt],ki=-ki),nt.y<vi.y||nt.y>Bi.y)continue;if(nt.y===vi.y){if(nt.x===vi.x)return!0}else{const Zn=ki*(nt.x-vi.x)-Li*(nt.y-vi.y);if(Zn===0)return!0;if(Zn<0)continue;Ht=!Ht}}else{if(nt.y!==vi.y)continue;if(Bi.x<=nt.x&&nt.x<=vi.x||vi.x<=nt.x&&nt.x<=Bi.x)return!0}}return Ht}const M=j.isClockWise,P=this.subPaths;if(P.length===0)return[];if(l===!0)return g(P);let N,U,G;const K=[];if(P.length===1)return U=P[0],G=new is,G.curves=U.curves,K.push(G),K;let Q=!M(P[0].getPoints());Q=e?!Q:Q;const ne=[],oe=[];let de,xe,Re=[],we=0;oe[we]=void 0,Re[we]=[];for(let nt=0,xt=P.length;nt<xt;nt++)U=P[nt],de=U.getPoints(),N=M(de),N=e?!N:N,N?(!Q&&oe[we]&&we++,oe[we]={s:new is,p:de},oe[we].s.curves=U.curves,Q&&we++,Re[we]=[]):Re[we].push({h:U,p:de[0]});if(!oe[0])return g(P);if(oe.length>1){let nt=!1;const xt=[];for(let ft=0,Ht=oe.length;ft<Ht;ft++)ne[ft]=[];for(let ft=0,Ht=oe.length;ft<Ht;ft++){const Xt=Re[ft];for(let _i=0;_i<Xt.length;_i++){const vi=Xt[_i];let Bi=!0;for(let Li=0;Li<oe.length;Li++)_(vi.p,oe[Li].p)&&(ft!==Li&&xt.push({froms:ft,tos:Li,hole:_i}),Bi?(Bi=!1,ne[Li].push(vi)):nt=!0);Bi&&ne[ft].push(vi)}}xt.length>0&&(nt||(Re=ne))}for(let nt=0,xt=oe.length;nt<xt;nt++){G=oe[nt].s,K.push(G),xe=Re[nt];for(let ft=0,Ht=xe.length;ft<Ht;ft++)G.holes.push(xe[ft].h)}return K}}class Cf{constructor(e){this.type="Font",this.data=e}generateShapes(e,l=100){const g=[],_=function(M,P,N){const U=Array.from(M),G=P/N.resolution,K=(N.boundingBox.yMax-N.boundingBox.yMin+N.underlineThickness)*G,Q=[];let ne=0,oe=0;for(let de=0;de<U.length;de++){const xe=U[de];if(xe===`
`)ne=0,oe-=K;else{const Re=ay(xe,G,ne,oe,N);ne+=Re.offsetX,Q.push(Re.path)}}return Q}(e,l,this.data);for(let M=0,P=_.length;M<P;M++)Array.prototype.push.apply(g,_[M].toShapes());return g}}function ay(S,e,l,g,_){const M=_.glyphs[S]||_.glyphs["?"];if(!M)return void console.error('THREE.Font: character "'+S+'" does not exists in font family '+_.familyName+".");const P=new Lm;let N,U,G,K,Q,ne,oe,de;if(M.o){const xe=M._cachedOutline||(M._cachedOutline=M.o.split(" "));for(let Re=0,we=xe.length;Re<we;)switch(xe[Re++]){case"m":N=xe[Re++]*e+l,U=xe[Re++]*e+g,P.moveTo(N,U);break;case"l":N=xe[Re++]*e+l,U=xe[Re++]*e+g,P.lineTo(N,U);break;case"q":G=xe[Re++]*e+l,K=xe[Re++]*e+g,Q=xe[Re++]*e+l,ne=xe[Re++]*e+g,P.quadraticCurveTo(Q,ne,G,K);break;case"b":G=xe[Re++]*e+l,K=xe[Re++]*e+g,Q=xe[Re++]*e+l,ne=xe[Re++]*e+g,oe=xe[Re++]*e+l,de=xe[Re++]*e+g,P.bezierCurveTo(Q,ne,oe,de,G,K)}}return{offsetX:M.ha*e,path:P}}Cf.prototype.isFont=!0;let Lf;const jc={getContext:function(){return Lf===void 0&&(Lf=new(window.AudioContext||window.webkitAudioContext)),Lf},setContext:function(S){Lf=S}};class Wg extends Er{constructor(e){super(e)}load(e,l,g,_){const M=this,P=new Gs(this.manager);P.setResponseType("arraybuffer"),P.setPath(this.path),P.setRequestHeader(this.requestHeader),P.setWithCredentials(this.withCredentials),P.load(e,function(N){try{const U=N.slice(0);jc.getContext().decodeAudioData(U,function(G){l(G)})}catch(U){_?_(U):console.error(U),M.manager.itemError(e)}},g,_)}}class Im extends Ml{constructor(e,l,g=1){super(void 0,g);const _=new wn().set(e),M=new wn().set(l),P=new ie(_.r,_.g,_.b),N=new ie(M.r,M.g,M.b),U=Math.sqrt(Math.PI),G=U*Math.sqrt(.75);this.sh.coefficients[0].copy(P).add(N).multiplyScalar(U),this.sh.coefficients[1].copy(P).sub(N).multiplyScalar(G)}}Im.prototype.isHemisphereLightProbe=!0;class qg extends Ml{constructor(e,l=1){super(void 0,l);const g=new wn().set(e);this.sh.coefficients[0].set(g.r,g.g,g.b).multiplyScalar(2*Math.sqrt(Math.PI))}}qg.prototype.isAmbientLightProbe=!0;const ly=new nr,cy=new nr;class uy{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=$g(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const l=$g();e=(l-this.oldTime)/1e3,this.oldTime=l,this.elapsedTime+=e}return e}}function $g(){return(typeof performance>"u"?Date:performance).now()}const gh=new ie,hy=new ye,dy=new ie,od=new ie;class Zg extends Ee{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const l=this.context.createBufferSource();return l.buffer=this.buffer,l.loop=this.loop,l.loopStart=this.loopStart,l.loopEnd=this.loopEnd,l.onended=this.onEnded.bind(this),l.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=l,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,l=this.filters.length;e<l;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,l=this.filters.length;e<l;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const _h=new ie,Xg=new ye,py=new ie,yh=new ie;class Yg{constructor(e,l=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=l,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const l=this.getFrequencyData();for(let g=0;g<l.length;g++)e+=l[g];return e/l.length}}class Kg{constructor(e,l,g){let _,M,P;switch(this.binding=e,this.valueSize=g,l){case"quaternion":_=this._slerp,M=this._slerpAdditive,P=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*g),this._workIndex=5;break;case"string":case"bool":_=this._select,M=this._select,P=this._setAdditiveIdentityOther,this.buffer=new Array(5*g);break;default:_=this._lerp,M=this._lerpAdditive,P=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*g)}this._mixBufferRegion=_,this._mixBufferRegionAdditive=M,this._setIdentity=P,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,l){const g=this.buffer,_=this.valueSize,M=e*_+_;let P=this.cumulativeWeight;if(P===0){for(let N=0;N!==_;++N)g[M+N]=g[N];P=l}else{P+=l;const N=l/P;this._mixBufferRegion(g,M,0,N,_)}this.cumulativeWeight=P}accumulateAdditive(e){const l=this.buffer,g=this.valueSize,_=g*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(l,_,0,e,g),this.cumulativeWeightAdditive+=e}apply(e){const l=this.valueSize,g=this.buffer,_=e*l+l,M=this.cumulativeWeight,P=this.cumulativeWeightAdditive,N=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,M<1){const U=l*this._origIndex;this._mixBufferRegion(g,_,U,1-M,l)}P>0&&this._mixBufferRegionAdditive(g,_,this._addIndex*l,1,l);for(let U=l,G=l+l;U!==G;++U)if(g[U]!==g[U+l]){N.setValue(g,_);break}}saveOriginalState(){const e=this.binding,l=this.buffer,g=this.valueSize,_=g*this._origIndex;e.getValue(l,_);for(let M=g,P=_;M!==P;++M)l[M]=l[_+M%g];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,l=e+this.valueSize;for(let g=e;g<l;g++)this.buffer[g]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,l=this._addIndex*this.valueSize;for(let g=0;g<this.valueSize;g++)this.buffer[l+g]=this.buffer[e+g]}_select(e,l,g,_,M){if(_>=.5)for(let P=0;P!==M;++P)e[l+P]=e[g+P]}_slerp(e,l,g,_){ye.slerpFlat(e,l,e,l,e,g,_)}_slerpAdditive(e,l,g,_,M){const P=this._workIndex*M;ye.multiplyQuaternionsFlat(e,P,e,l,e,g),ye.slerpFlat(e,l,e,l,e,P,_)}_lerp(e,l,g,_,M){const P=1-_;for(let N=0;N!==M;++N){const U=l+N;e[U]=e[U]*P+e[g+N]*_}}_lerpAdditive(e,l,g,_,M){for(let P=0;P!==M;++P){const N=l+P;e[N]=e[N]+e[g+P]*_}}}const fy="\\[\\]\\.:\\/",Jg=new RegExp("[\\[\\]\\.:\\/]","g"),Wc="[^\\[\\]\\.:\\/]",wa="[^"+fy.replace("\\.","")+"]",my=/((?:WC+[\/:])*)/.source.replace("WC",Wc),If=/(WCOD+)?/.source.replace("WCOD",wa),lv=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Wc),cv=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Wc),Rf=new RegExp("^"+my+If+lv+cv+"$"),gy=["material","materials","bones"];class Ms{constructor(e,l,g){this.path=l,this.parsedPath=g||Ms.parseTrackName(l),this.node=Ms.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,l,g){return e&&e.isAnimationObjectGroup?new Ms.Composite(e,l,g):new Ms(e,l,g)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Jg,"")}static parseTrackName(e){const l=Rf.exec(e);if(!l)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const g={nodeName:l[2],objectName:l[3],objectIndex:l[4],propertyName:l[5],propertyIndex:l[6]},_=g.nodeName&&g.nodeName.lastIndexOf(".");if(_!==void 0&&_!==-1){const M=g.nodeName.substring(_+1);gy.indexOf(M)!==-1&&(g.nodeName=g.nodeName.substring(0,_),g.objectName=M)}if(g.propertyName===null||g.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return g}static findNode(e,l){if(!l||l===""||l==="."||l===-1||l===e.name||l===e.uuid)return e;if(e.skeleton){const g=e.skeleton.getBoneByName(l);if(g!==void 0)return g}if(e.children){const g=function(M){for(let P=0;P<M.length;P++){const N=M[P];if(N.name===l||N.uuid===l)return N;const U=g(N.children);if(U)return U}return null},_=g(e.children);if(_)return _}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,l){e[l]=this.targetObject[this.propertyName]}_getValue_array(e,l){const g=this.resolvedProperty;for(let _=0,M=g.length;_!==M;++_)e[l++]=g[_]}_getValue_arrayElement(e,l){e[l]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,l){this.resolvedProperty.toArray(e,l)}_setValue_direct(e,l){this.targetObject[this.propertyName]=e[l]}_setValue_direct_setNeedsUpdate(e,l){this.targetObject[this.propertyName]=e[l],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,l){this.targetObject[this.propertyName]=e[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,l){const g=this.resolvedProperty;for(let _=0,M=g.length;_!==M;++_)g[_]=e[l++]}_setValue_array_setNeedsUpdate(e,l){const g=this.resolvedProperty;for(let _=0,M=g.length;_!==M;++_)g[_]=e[l++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,l){const g=this.resolvedProperty;for(let _=0,M=g.length;_!==M;++_)g[_]=e[l++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,l){this.resolvedProperty[this.propertyIndex]=e[l]}_setValue_arrayElement_setNeedsUpdate(e,l){this.resolvedProperty[this.propertyIndex]=e[l],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,l){this.resolvedProperty[this.propertyIndex]=e[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,l){this.resolvedProperty.fromArray(e,l)}_setValue_fromArray_setNeedsUpdate(e,l){this.resolvedProperty.fromArray(e,l),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,l){this.resolvedProperty.fromArray(e,l),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,l){this.bind(),this.getValue(e,l)}_setValue_unbound(e,l){this.bind(),this.setValue(e,l)}bind(){let e=this.node;const l=this.parsedPath,g=l.objectName,_=l.propertyName;let M=l.propertyIndex;if(e||(e=Ms.findNode(this.rootNode,l.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(g){let G=l.objectIndex;switch(g){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let K=0;K<e.length;K++)if(e[K].name===G){G=K;break}break;default:if(e[g]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[g]}if(G!==void 0){if(e[G]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[G]}}const P=e[_];if(P===void 0){const G=l.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+G+"."+_+" but it wasn't found.",e)}let N=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?N=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(N=this.Versioning.MatrixWorldNeedsUpdate);let U=this.BindingType.Direct;if(M!==void 0){if(_==="morphTargetInfluences"){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);e.morphTargetDictionary[M]!==void 0&&(M=e.morphTargetDictionary[M])}U=this.BindingType.ArrayElement,this.resolvedProperty=P,this.propertyIndex=M}else P.fromArray!==void 0&&P.toArray!==void 0?(U=this.BindingType.HasFromToArray,this.resolvedProperty=P):Array.isArray(P)?(U=this.BindingType.EntireArray,this.resolvedProperty=P):this.propertyName=_;this.getValue=this.GetterByBindingType[U],this.setValue=this.SetterByBindingTypeAndVersioning[U][N]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ms.Composite=class{constructor(S,e,l){const g=l||Ms.parseTrackName(e);this._targetGroup=S,this._bindings=S.subscribe_(e,g)}getValue(S,e){this.bind();const l=this._targetGroup.nCachedObjects_,g=this._bindings[l];g!==void 0&&g.getValue(S,e)}setValue(S,e){const l=this._bindings;for(let g=this._targetGroup.nCachedObjects_,_=l.length;g!==_;++g)l[g].setValue(S,e)}bind(){const S=this._bindings;for(let e=this._targetGroup.nCachedObjects_,l=S.length;e!==l;++e)S[e].bind()}unbind(){const S=this._bindings;for(let e=this._targetGroup.nCachedObjects_,l=S.length;e!==l;++e)S[e].unbind()}},Ms.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ms.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ms.prototype.GetterByBindingType=[Ms.prototype._getValue_direct,Ms.prototype._getValue_array,Ms.prototype._getValue_arrayElement,Ms.prototype._getValue_toArray],Ms.prototype.SetterByBindingTypeAndVersioning=[[Ms.prototype._setValue_direct,Ms.prototype._setValue_direct_setNeedsUpdate,Ms.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ms.prototype._setValue_array,Ms.prototype._setValue_array_setNeedsUpdate,Ms.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ms.prototype._setValue_arrayElement,Ms.prototype._setValue_arrayElement_setNeedsUpdate,Ms.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ms.prototype._setValue_fromArray,Ms.prototype._setValue_fromArray_setNeedsUpdate,Ms.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class pp{constructor(){this.uuid=_n(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let g=0,_=arguments.length;g!==_;++g)e[arguments[g].uuid]=g;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const l=this;this.stats={objects:{get total(){return l._objects.length},get inUse(){return this.total-l.nCachedObjects_}},get bindingsPerObject(){return l._bindings.length}}}add(){const e=this._objects,l=this._indicesByUUID,g=this._paths,_=this._parsedPaths,M=this._bindings,P=M.length;let N,U=e.length,G=this.nCachedObjects_;for(let K=0,Q=arguments.length;K!==Q;++K){const ne=arguments[K],oe=ne.uuid;let de=l[oe];if(de===void 0){de=U++,l[oe]=de,e.push(ne);for(let xe=0,Re=P;xe!==Re;++xe)M[xe].push(new Ms(ne,g[xe],_[xe]))}else if(de<G){N=e[de];const xe=--G,Re=e[xe];l[Re.uuid]=de,e[de]=Re,l[oe]=xe,e[xe]=ne;for(let we=0,nt=P;we!==nt;++we){const xt=M[we],ft=xt[xe];let Ht=xt[de];xt[de]=ft,Ht===void 0&&(Ht=new Ms(ne,g[we],_[we])),xt[xe]=Ht}}else e[de]!==N&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=G}remove(){const e=this._objects,l=this._indicesByUUID,g=this._bindings,_=g.length;let M=this.nCachedObjects_;for(let P=0,N=arguments.length;P!==N;++P){const U=arguments[P],G=U.uuid,K=l[G];if(K!==void 0&&K>=M){const Q=M++,ne=e[Q];l[ne.uuid]=K,e[K]=ne,l[G]=Q,e[Q]=U;for(let oe=0,de=_;oe!==de;++oe){const xe=g[oe],Re=xe[Q],we=xe[K];xe[K]=Re,xe[Q]=we}}}this.nCachedObjects_=M}uncache(){const e=this._objects,l=this._indicesByUUID,g=this._bindings,_=g.length;let M=this.nCachedObjects_,P=e.length;for(let N=0,U=arguments.length;N!==U;++N){const G=arguments[N].uuid,K=l[G];if(K!==void 0)if(delete l[G],K<M){const Q=--M,ne=e[Q],oe=--P,de=e[oe];l[ne.uuid]=K,e[K]=ne,l[de.uuid]=Q,e[Q]=de,e.pop();for(let xe=0,Re=_;xe!==Re;++xe){const we=g[xe],nt=we[Q],xt=we[oe];we[K]=nt,we[Q]=xt,we.pop()}}else{const Q=--P,ne=e[Q];Q>0&&(l[ne.uuid]=K),e[K]=ne,e.pop();for(let oe=0,de=_;oe!==de;++oe){const xe=g[oe];xe[K]=xe[Q],xe.pop()}}}this.nCachedObjects_=M}subscribe_(e,l){const g=this._bindingsIndicesByPath;let _=g[e];const M=this._bindings;if(_!==void 0)return M[_];const P=this._paths,N=this._parsedPaths,U=this._objects,G=U.length,K=this.nCachedObjects_,Q=new Array(G);_=M.length,g[e]=_,P.push(e),N.push(l),M.push(Q);for(let ne=K,oe=U.length;ne!==oe;++ne){const de=U[ne];Q[ne]=new Ms(de,e,l)}return Q}unsubscribe_(e){const l=this._bindingsIndicesByPath,g=l[e];if(g!==void 0){const _=this._paths,M=this._parsedPaths,P=this._bindings,N=P.length-1,U=P[N];l[e[N]]=g,P[g]=U,P.pop(),M[g]=M[N],M.pop(),_[g]=_[N],_.pop()}}}pp.prototype.isAnimationObjectGroup=!0;class uv{constructor(e,l,g=null,_=l.blendMode){this._mixer=e,this._clip=l,this._localRoot=g,this.blendMode=_;const M=l.tracks,P=M.length,N=new Array(P),U={endingStart:2400,endingEnd:2400};for(let G=0;G!==P;++G){const K=M[G].createInterpolant(null);N[G]=K,K.settings=U}this._interpolantSettings=U,this._interpolants=N,this._propertyBindings=new Array(P),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,l){return this.loop=e,this.repetitions=l,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,l,g){if(e.fadeOut(l),this.fadeIn(l),g){const _=this._clip.duration,M=e._clip.duration,P=M/_,N=_/M;e.warp(1,P,l),this.warp(N,1,l)}return this}crossFadeTo(e,l,g){return e.crossFadeFrom(this,l,g)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,l,g){const _=this._mixer,M=_.time,P=this.timeScale;let N=this._timeScaleInterpolant;N===null&&(N=_._lendControlInterpolant(),this._timeScaleInterpolant=N);const U=N.parameterPositions,G=N.sampleValues;return U[0]=M,U[1]=M+g,G[0]=e/P,G[1]=l/P,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,l,g,_){if(!this.enabled)return void this._updateWeight(e);const M=this._startTime;if(M!==null){const U=(e-M)*g;if(U<0||g===0)return;this._startTime=null,l=g*U}l*=this._updateTimeScale(e);const P=this._updateTime(l),N=this._updateWeight(e);if(N>0){const U=this._interpolants,G=this._propertyBindings;switch(this.blendMode){case 2501:for(let K=0,Q=U.length;K!==Q;++K)U[K].evaluate(P),G[K].accumulateAdditive(N);break;case 2500:default:for(let K=0,Q=U.length;K!==Q;++K)U[K].evaluate(P),G[K].accumulate(_,N)}}}_updateWeight(e){let l=0;if(this.enabled){l=this.weight;const g=this._weightInterpolant;if(g!==null){const _=g.evaluate(e)[0];l*=_,e>g.parameterPositions[1]&&(this.stopFading(),_===0&&(this.enabled=!1))}}return this._effectiveWeight=l,l}_updateTimeScale(e){let l=0;if(!this.paused){l=this.timeScale;const g=this._timeScaleInterpolant;g!==null&&(l*=g.evaluate(e)[0],e>g.parameterPositions[1]&&(this.stopWarping(),l===0?this.paused=!0:this.timeScale=l))}return this._effectiveTimeScale=l,l}_updateTime(e){const l=this._clip.duration,g=this.loop;let _=this.time+e,M=this._loopCount;const P=g===2202;if(e===0)return M===-1?_:P&&(1&M)==1?l-_:_;if(g===2200){M===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(_>=l)_=l;else{if(!(_<0)){this.time=_;break e}_=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=_,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(M===-1&&(e>=0?(M=0,this._setEndings(!0,this.repetitions===0,P)):this._setEndings(this.repetitions===0,!0,P)),_>=l||_<0){const N=Math.floor(_/l);_-=l*N,M+=Math.abs(N);const U=this.repetitions-M;if(U<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,_=e>0?l:0,this.time=_,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(U===1){const G=e<0;this._setEndings(G,!G,P)}else this._setEndings(!1,!1,P);this._loopCount=M,this.time=_,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:N})}}else this.time=_;if(P&&(1&M)==1)return l-_}return _}_setEndings(e,l,g){const _=this._interpolantSettings;g?(_.endingStart=2401,_.endingEnd=2401):(_.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,_.endingEnd=l?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,l,g){const _=this._mixer,M=_.time;let P=this._weightInterpolant;P===null&&(P=_._lendControlInterpolant(),this._weightInterpolant=P);const N=P.parameterPositions,U=P.sampleValues;return N[0]=M,U[0]=l,N[1]=M+e,U[1]=g,this}}class _y extends Mt{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,l){const g=e._localRoot||this._root,_=e._clip.tracks,M=_.length,P=e._propertyBindings,N=e._interpolants,U=g.uuid,G=this._bindingsByRootAndName;let K=G[U];K===void 0&&(K={},G[U]=K);for(let Q=0;Q!==M;++Q){const ne=_[Q],oe=ne.name;let de=K[oe];if(de!==void 0)P[Q]=de;else{if(de=P[Q],de!==void 0){de._cacheIndex===null&&(++de.referenceCount,this._addInactiveBinding(de,U,oe));continue}const xe=l&&l._propertyBindings[Q].binding.parsedPath;de=new Kg(Ms.create(g,oe,xe),ne.ValueTypeName,ne.getValueSize()),++de.referenceCount,this._addInactiveBinding(de,U,oe),P[Q]=de}N[Q].resultBuffer=de.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const g=(e._localRoot||this._root).uuid,_=e._clip.uuid,M=this._actionsByClip[_];this._bindAction(e,M&&M.knownActions[0]),this._addInactiveAction(e,_,g)}const l=e._propertyBindings;for(let g=0,_=l.length;g!==_;++g){const M=l[g];M.useCount++==0&&(this._lendBinding(M),M.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const l=e._propertyBindings;for(let g=0,_=l.length;g!==_;++g){const M=l[g];--M.useCount==0&&(M.restoreOriginalState(),this._takeBackBinding(M))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const l=e._cacheIndex;return l!==null&&l<this._nActiveActions}_addInactiveAction(e,l,g){const _=this._actions,M=this._actionsByClip;let P=M[l];if(P===void 0)P={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,M[l]=P;else{const N=P.knownActions;e._byClipCacheIndex=N.length,N.push(e)}e._cacheIndex=_.length,_.push(e),P.actionByRoot[g]=e}_removeInactiveAction(e){const l=this._actions,g=l[l.length-1],_=e._cacheIndex;g._cacheIndex=_,l[_]=g,l.pop(),e._cacheIndex=null;const M=e._clip.uuid,P=this._actionsByClip,N=P[M],U=N.knownActions,G=U[U.length-1],K=e._byClipCacheIndex;G._byClipCacheIndex=K,U[K]=G,U.pop(),e._byClipCacheIndex=null,delete N.actionByRoot[(e._localRoot||this._root).uuid],U.length===0&&delete P[M],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const l=e._propertyBindings;for(let g=0,_=l.length;g!==_;++g){const M=l[g];--M.referenceCount==0&&this._removeInactiveBinding(M)}}_lendAction(e){const l=this._actions,g=e._cacheIndex,_=this._nActiveActions++,M=l[_];e._cacheIndex=_,l[_]=e,M._cacheIndex=g,l[g]=M}_takeBackAction(e){const l=this._actions,g=e._cacheIndex,_=--this._nActiveActions,M=l[_];e._cacheIndex=_,l[_]=e,M._cacheIndex=g,l[g]=M}_addInactiveBinding(e,l,g){const _=this._bindingsByRootAndName,M=this._bindings;let P=_[l];P===void 0&&(P={},_[l]=P),P[g]=e,e._cacheIndex=M.length,M.push(e)}_removeInactiveBinding(e){const l=this._bindings,g=e.binding,_=g.rootNode.uuid,M=g.path,P=this._bindingsByRootAndName,N=P[_],U=l[l.length-1],G=e._cacheIndex;U._cacheIndex=G,l[G]=U,l.pop(),delete N[M],Object.keys(N).length===0&&delete P[_]}_lendBinding(e){const l=this._bindings,g=e._cacheIndex,_=this._nActiveBindings++,M=l[_];e._cacheIndex=_,l[_]=e,M._cacheIndex=g,l[g]=M}_takeBackBinding(e){const l=this._bindings,g=e._cacheIndex,_=--this._nActiveBindings,M=l[_];e._cacheIndex=_,l[_]=e,M._cacheIndex=g,l[g]=M}_lendControlInterpolant(){const e=this._controlInterpolants,l=this._nActiveControlInterpolants++;let g=e[l];return g===void 0&&(g=new $n(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),g.__cacheIndex=l,e[l]=g),g}_takeBackControlInterpolant(e){const l=this._controlInterpolants,g=e.__cacheIndex,_=--this._nActiveControlInterpolants,M=l[_];e.__cacheIndex=_,l[_]=e,M.__cacheIndex=g,l[g]=M}clipAction(e,l,g){const _=l||this._root,M=_.uuid;let P=typeof e=="string"?Xr.findByName(_,e):e;const N=P!==null?P.uuid:e,U=this._actionsByClip[N];let G=null;if(g===void 0&&(g=P!==null?P.blendMode:2500),U!==void 0){const Q=U.actionByRoot[M];if(Q!==void 0&&Q.blendMode===g)return Q;G=U.knownActions[0],P===null&&(P=G._clip)}if(P===null)return null;const K=new uv(this,P,l,g);return this._bindAction(K,G),this._addInactiveAction(K,N,M),K}existingAction(e,l){const g=l||this._root,_=g.uuid,M=typeof e=="string"?Xr.findByName(g,e):e,P=M?M.uuid:e,N=this._actionsByClip[P];return N!==void 0&&N.actionByRoot[_]||null}stopAllAction(){const e=this._actions;for(let l=this._nActiveActions-1;l>=0;--l)e[l].stop();return this}update(e){e*=this.timeScale;const l=this._actions,g=this._nActiveActions,_=this.time+=e,M=Math.sign(e),P=this._accuIndex^=1;for(let G=0;G!==g;++G)l[G]._update(_,e,M,P);const N=this._bindings,U=this._nActiveBindings;for(let G=0;G!==U;++G)N[G].apply(P);return this}setTime(e){this.time=0;for(let l=0;l<this._actions.length;l++)this._actions[l].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const l=this._actions,g=e.uuid,_=this._actionsByClip,M=_[g];if(M!==void 0){const P=M.knownActions;for(let N=0,U=P.length;N!==U;++N){const G=P[N];this._deactivateAction(G);const K=G._cacheIndex,Q=l[l.length-1];G._cacheIndex=null,G._byClipCacheIndex=null,Q._cacheIndex=K,l[K]=Q,l.pop(),this._removeInactiveBindingsForAction(G)}delete _[g]}}uncacheRoot(e){const l=e.uuid,g=this._actionsByClip;for(const M in g){const P=g[M].actionByRoot[l];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const _=this._bindingsByRootAndName[l];if(_!==void 0)for(const M in _){const P=_[M];P.restoreOriginalState(),this._removeInactiveBinding(P)}}uncacheAction(e,l){const g=this.existingAction(e,l);g!==null&&(this._deactivateAction(g),this._removeInactiveAction(g))}}_y.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Rm{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Rm(this.value.clone===void 0?this.value:this.value.clone())}}class yy extends Va{constructor(e,l,g=1){super(e,l),this.meshPerAttribute=g}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const l=super.clone(e);return l.meshPerAttribute=this.meshPerAttribute,l}toJSON(e){const l=super.toJSON(e);return l.isInstancedInterleavedBuffer=!0,l.meshPerAttribute=this.meshPerAttribute,l}}yy.prototype.isInstancedInterleavedBuffer=!0;class vy{constructor(e,l,g,_,M){this.buffer=e,this.type=l,this.itemSize=g,this.elementSize=_,this.count=M,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,l){return this.type=e,this.elementSize=l,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}vy.prototype.isGLBufferAttribute=!0;function xy(S,e){return S.distance-e.distance}function Qg(S,e,l,g){if(S.layers.test(e.layers)&&S.raycast(e,l),g===!0){const _=S.children;for(let M=0,P=_.length;M<P;M++)Qg(_[M],e,l,!0)}}const Pm=new en;class fp{constructor(e=new en(1/0,1/0),l=new en(-1/0,-1/0)){this.min=e,this.max=l}set(e,l){return this.min.copy(e),this.max.copy(l),this}setFromPoints(e){this.makeEmpty();for(let l=0,g=e.length;l<g;l++)this.expandByPoint(e[l]);return this}setFromCenterAndSize(e,l){const g=Pm.copy(l).multiplyScalar(.5);return this.min.copy(e).sub(g),this.max.copy(e).add(g),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,l){return l.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,l){return l.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Pm.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}fp.prototype.isBox2=!0;const ad=new ie,Dm=new ie;class So{constructor(e=new ie,l=new ie){this.start=e,this.end=l}set(e,l){return this.start.copy(e),this.end.copy(l),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,l){return this.delta(l).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,l){ad.subVectors(e,this.start),Dm.subVectors(this.end,this.start);const g=Dm.dot(Dm);let _=Dm.dot(ad)/g;return l&&(_=Fn(_,0,1)),_}closestPointToPoint(e,l,g){const _=this.closestPointToPointParameter(e,l);return this.delta(g).multiplyScalar(_).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}class Pf extends Ee{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}Pf.prototype.isImmediateRenderObject=!0;const e_=new ie,oc=new ie,ld=new nr,cd=new nr;class t_ extends Jo{constructor(e){const l=i_(e),g=new Pr,_=[],M=[],P=new wn(0,0,1),N=new wn(0,1,0);for(let U=0;U<l.length;U++){const G=l[U];G.parent&&G.parent.isBone&&(_.push(0,0,0),_.push(0,0,0),M.push(P.r,P.g,P.b),M.push(N.r,N.g,N.b))}g.setAttribute("position",new Un(_,3)),g.setAttribute("color",new Un(M,3)),super(g,new Io({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=l,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const l=this.bones,g=this.geometry,_=g.getAttribute("position");cd.copy(this.root.matrixWorld).invert();for(let M=0,P=0;M<l.length;M++){const N=l[M];N.parent&&N.parent.isBone&&(ld.multiplyMatrices(cd,N.matrixWorld),oc.setFromMatrixPosition(ld),_.setXYZ(P,oc.x,oc.y,oc.z),ld.multiplyMatrices(cd,N.parent.matrixWorld),oc.setFromMatrixPosition(ld),_.setXYZ(P+1,oc.x,oc.y,oc.z),P+=2)}g.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function i_(S){const e=[];S&&S.isBone&&e.push(S);for(let l=0;l<S.children.length;l++)e.push.apply(e,i_(S.children[l]));return e}const Df=new ie,Om=new wn,Of=new wn;class by extends Jo{constructor(e=10,l=10,g=4473924,_=8947848){g=new wn(g),_=new wn(_);const M=l/2,P=e/l,N=e/2,U=[],G=[];for(let Q=0,ne=0,oe=-N;Q<=l;Q++,oe+=P){U.push(-N,0,oe,N,0,oe),U.push(oe,0,-N,oe,0,N);const de=Q===M?g:_;de.toArray(G,ne),ne+=3,de.toArray(G,ne),ne+=3,de.toArray(G,ne),ne+=3,de.toArray(G,ne),ne+=3}const K=new Pr;K.setAttribute("position",new Un(U,3)),K.setAttribute("color",new Un(G,3)),super(K,new Io({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const zm=new ie,mp=new ie,km=new ie,zf=new ie,Po=new Mc;function zo(S,e,l,g,_,M,P){zf.set(_,M,P).unproject(g);const N=e[S];if(N!==void 0){const U=l.getAttribute("position");for(let G=0,K=N.length;G<K;G++)U.setXYZ(N[G],zf.x,zf.y,zf.z)}}const kf=new ut;class Fm extends Jo{constructor(e,l=16776960){const g=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_=new Float32Array(24),M=new Pr;M.setIndex(new Or(g,1)),M.setAttribute("position",new Or(_,3)),super(M,new Io({color:l,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&kf.setFromObject(this.object),kf.isEmpty())return;const l=kf.min,g=kf.max,_=this.geometry.attributes.position,M=_.array;M[0]=g.x,M[1]=g.y,M[2]=g.z,M[3]=l.x,M[4]=g.y,M[5]=g.z,M[6]=l.x,M[7]=l.y,M[8]=g.z,M[9]=g.x,M[10]=l.y,M[11]=g.z,M[12]=g.x,M[13]=g.y,M[14]=l.z,M[15]=l.x,M[16]=g.y,M[17]=l.z,M[18]=l.x,M[19]=l.y,M[20]=l.z,M[21]=g.x,M[22]=l.y,M[23]=l.z,_.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Jo.prototype.copy.call(this,e),this.object=e.object,this}}const ac=new ie;let Ff,n_;class wy extends Jo{constructor(e=1){const l=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],g=new Pr;g.setAttribute("position",new Un(l,3)),g.setAttribute("color",new Un([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(g,new Io({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,l,g){const _=new wn,M=this.geometry.attributes.color.array;return _.set(e),_.toArray(M,0),_.toArray(M,3),_.set(l),_.toArray(M,6),_.toArray(M,9),_.set(g),_.toArray(M,12),_.toArray(M,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Ty=new Float32Array(1),hv=new Int32Array(Ty.buffer);ja.create=function(S,e){return console.log("THREE.Curve.create() has been deprecated"),S.prototype=Object.create(ja.prototype),S.prototype.constructor=S,S.prototype.getPoint=e,S},Yr.prototype.fromPoints=function(S){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(S)},by.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},t_.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Er.prototype.extractUrlBase=function(S){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Mf.extractUrlBase(S)},Er.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},fp.prototype.center=function(S){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(S)},fp.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},fp.prototype.isIntersectionBox=function(S){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(S)},fp.prototype.size=function(S){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(S)},ut.prototype.center=function(S){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(S)},ut.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ut.prototype.isIntersectionBox=function(S){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(S)},ut.prototype.isIntersectionSphere=function(S){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(S)},ut.prototype.size=function(S){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(S)},Ns.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Sc.prototype.setFromMatrix=function(S){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(S)},So.prototype.center=function(S){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(S)},Wn.prototype.flattenToArrayOffset=function(S,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(S,e)},Wn.prototype.multiplyVector3=function(S){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),S.applyMatrix3(this)},Wn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Wn.prototype.applyToBufferAttribute=function(S){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),S.applyMatrix3(this)},Wn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Wn.prototype.getInverse=function(S){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(S).invert()},nr.prototype.extractPosition=function(S){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(S)},nr.prototype.flattenToArrayOffset=function(S,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(S,e)},nr.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new ie().setFromMatrixColumn(this,3)},nr.prototype.setRotationFromQuaternion=function(S){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(S)},nr.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},nr.prototype.multiplyVector3=function(S){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),S.applyMatrix4(this)},nr.prototype.multiplyVector4=function(S){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),S.applyMatrix4(this)},nr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},nr.prototype.rotateAxis=function(S){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),S.transformDirection(this)},nr.prototype.crossVector=function(S){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),S.applyMatrix4(this)},nr.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},nr.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},nr.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},nr.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},nr.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},nr.prototype.applyToBufferAttribute=function(S){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),S.applyMatrix4(this)},nr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},nr.prototype.makeFrustum=function(S,e,l,g,_,M){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(S,e,g,l,_,M)},nr.prototype.getInverse=function(S){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(S).invert()},_a.prototype.isIntersectionLine=function(S){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(S)},ye.prototype.multiplyVector3=function(S){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),S.applyQuaternion(this)},ye.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},na.prototype.isIntersectionBox=function(S){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(S)},na.prototype.isIntersectionPlane=function(S){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(S)},na.prototype.isIntersectionSphere=function(S){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(S)},Ei.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ei.prototype.barycoordFromPoint=function(S,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(S,e)},Ei.prototype.midpoint=function(S){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(S)},Ei.prototypenormal=function(S){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(S)},Ei.prototype.plane=function(S){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(S)},Ei.barycoordFromPoint=function(S,e,l,g,_){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ei.getBarycoord(S,e,l,g,_)},Ei.normal=function(S,e,l,g){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ei.getNormal(S,e,l,g)},is.prototype.extractAllPoints=function(S){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(S)},is.prototype.extrude=function(S){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Y(this,S)},is.prototype.makeGeometry=function(S){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ne(this,S)},en.prototype.fromAttribute=function(S,e,l){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(S,e,l)},en.prototype.distanceToManhattan=function(S){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(S)},en.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ie.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},ie.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},ie.prototype.getPositionFromMatrix=function(S){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(S)},ie.prototype.getScaleFromMatrix=function(S){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(S)},ie.prototype.getColumnFromMatrix=function(S,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,S)},ie.prototype.applyProjection=function(S){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(S)},ie.prototype.fromAttribute=function(S,e,l){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(S,e,l)},ie.prototype.distanceToManhattan=function(S){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(S)},ie.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Dr.prototype.fromAttribute=function(S,e,l){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(S,e,l)},Dr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ee.prototype.getChildByName=function(S){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(S)},Ee.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ee.prototype.translate=function(S,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,S)},Ee.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ee.prototype.applyMatrix=function(S){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(S)},Object.defineProperties(Ee.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(S){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=S}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),qn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(qn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ch.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},_o.prototype.setLens=function(S,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(S)},Object.defineProperties(Es.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(S){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=S}},shadowCameraLeft:{set:function(S){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=S}},shadowCameraRight:{set:function(S){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=S}},shadowCameraTop:{set:function(S){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=S}},shadowCameraBottom:{set:function(S){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=S}},shadowCameraNear:{set:function(S){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=S}},shadowCameraFar:{set:function(S){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=S}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(S){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=S}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(S){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=S}},shadowMapHeight:{set:function(S){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=S}}}),Object.defineProperties(Or.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===35048},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Or.prototype.setDynamic=function(S){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(S===!0?35048:35044),this},Or.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Or.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Pr.prototype.addIndex=function(S){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(S)},Pr.prototype.addAttribute=function(S,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?S==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(S,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(S,new Or(arguments[1],arguments[2])))},Pr.prototype.addDrawCall=function(S,e,l){l!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(S,e)},Pr.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Pr.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Pr.prototype.removeAttribute=function(S){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(S)},Pr.prototype.applyMatrix=function(S){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(S)},Object.defineProperties(Pr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Va.prototype.setDynamic=function(S){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(S===!0?35048:35044),this},Va.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Y.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Y.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Y.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},ih.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Rm.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Vi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new wn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(S){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=S===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(S){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=S}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(ao.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(S){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=S}}}),yn.prototype.clearTarget=function(S,e,l,g){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(S),this.clear(e,l,g)},yn.prototype.animate=function(S){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(S)},yn.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},yn.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},yn.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},yn.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},yn.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},yn.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},yn.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},yn.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},yn.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},yn.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},yn.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},yn.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},yn.prototype.enableScissorTest=function(S){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(S)},yn.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},yn.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},yn.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},yn.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},yn.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},yn.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},yn.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},yn.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},yn.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},yn.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(yn.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(S){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=S}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(S){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=S}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(S){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=S===!0?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Qs.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(no.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(S){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=S}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(S){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=S}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(S){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=S}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(S){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=S}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(S){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=S}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(S){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=S}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(S){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=S}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(S){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=S}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(S){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=S}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(S){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=S}}}),Zg.prototype.load=function(S){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new Wg().load(S,function(l){e.setBuffer(l)}),this},Yg.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},iu.prototype.updateCubeMap=function(S,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(S,e)},iu.prototype.clear=function(S,e,l,g){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(S,e,l,g)},bo.crossOrigin=void 0,bo.loadTexture=function(S,e,l,g){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const _=new Wr;_.setCrossOrigin(this.crossOrigin);const M=_.load(S,l,void 0,g);return e&&(M.mapping=e),M},bo.loadTextureCube=function(S,e,l,g){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const _=new qa;_.setCrossOrigin(this.crossOrigin);const M=_.load(S,l,void 0,g);return e&&(M.mapping=e),M},bo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},bo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const dv={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:z}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=z),p.ACESFilmicToneMapping=4,p.AddEquation=100,p.AddOperation=2,p.AdditiveAnimationBlendMode=2501,p.AdditiveBlending=2,p.AlphaFormat=1021,p.AlwaysDepth=1,p.AlwaysStencilFunc=519,p.AmbientLight=sd,p.AmbientLightProbe=qg,p.AnimationClip=Xr,p.AnimationLoader=class extends Er{constructor(S){super(S)}load(S,e,l,g){const _=this,M=new Gs(this.manager);M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(S,function(P){try{e(_.parse(JSON.parse(P)))}catch(N){g?g(N):console.error(N),_.manager.itemError(S)}},l,g)}parse(S){const e=[];for(let l=0;l<S.length;l++){const g=Xr.parse(S[l]);e.push(g)}return e}},p.AnimationMixer=_y,p.AnimationObjectGroup=pp,p.AnimationUtils=mi,p.ArcCurve=np,p.ArrayCamera=Zd,p.ArrowHelper=class extends Ee{constructor(S=new ie(0,0,1),e=new ie(0,0,0),l=1,g=16776960,_=.2*l,M=.2*_){super(),this.type="ArrowHelper",Ff===void 0&&(Ff=new Pr,Ff.setAttribute("position",new Un([0,0,0,0,1,0],3)),n_=new Nl(0,.5,1,5,1),n_.translate(0,-.5,0)),this.position.copy(e),this.line=new Ra(Ff,new Io({color:g,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new qn(n_,new ws({color:g,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(S),this.setLength(l,_,M)}setDirection(S){if(S.y>.99999)this.quaternion.set(0,0,0,1);else if(S.y<-.99999)this.quaternion.set(1,0,0,0);else{ac.set(S.z,0,-S.x).normalize();const e=Math.acos(S.y);this.quaternion.setFromAxisAngle(ac,e)}}setLength(S,e=.2*S,l=.2*e){this.line.scale.set(1,Math.max(1e-4,S-e),1),this.line.updateMatrix(),this.cone.scale.set(l,e,l),this.cone.position.y=S,this.cone.updateMatrix()}setColor(S){this.line.material.color.set(S),this.cone.material.color.set(S)}copy(S){return super.copy(S,!1),this.line.copy(S.line),this.cone.copy(S.cone),this}},p.Audio=Zg,p.AudioAnalyser=Yg,p.AudioContext=jc,p.AudioListener=class extends Ee{constructor(){super(),this.type="AudioListener",this.context=jc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new uy}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(S){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=S,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(S){return this.gain.gain.setTargetAtTime(S,this.context.currentTime,.01),this}updateMatrixWorld(S){super.updateMatrixWorld(S);const e=this.context.listener,l=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(gh,hy,dy),od.set(0,0,-1).applyQuaternion(hy),e.positionX){const g=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(gh.x,g),e.positionY.linearRampToValueAtTime(gh.y,g),e.positionZ.linearRampToValueAtTime(gh.z,g),e.forwardX.linearRampToValueAtTime(od.x,g),e.forwardY.linearRampToValueAtTime(od.y,g),e.forwardZ.linearRampToValueAtTime(od.z,g),e.upX.linearRampToValueAtTime(l.x,g),e.upY.linearRampToValueAtTime(l.y,g),e.upZ.linearRampToValueAtTime(l.z,g)}else e.setPosition(gh.x,gh.y,gh.z),e.setOrientation(od.x,od.y,od.z,l.x,l.y,l.z)}},p.AudioLoader=Wg,p.AxesHelper=wy,p.AxisHelper=function(S){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new wy(S)},p.BackSide=1,p.BasicDepthPacking=3200,p.BasicShadowMap=0,p.BinaryTextureLoader=function(S){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Mo(S)},p.Bone=zc,p.BooleanKeyframeTrack=dn,p.BoundingBoxHelper=function(S,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Fm(S,e)},p.Box2=fp,p.Box3=ut,p.Box3Helper=class extends Jo{constructor(S,e=16776960){const l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),g=new Pr;g.setIndex(new Or(l,1)),g.setAttribute("position",new Un([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(g,new Io({color:e,toneMapped:!1})),this.box=S,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(S){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(S))}},p.BoxBufferGeometry=Ja,p.BoxGeometry=Ja,p.BoxHelper=Fm,p.BufferAttribute=Or,p.BufferGeometry=Pr,p.BufferGeometryLoader=Cm,p.ByteType=1010,p.Cache=br,p.Camera=Mc,p.CameraHelper=class extends Jo{constructor(S){const e=new Pr,l=new Io({color:16777215,vertexColors:!0,toneMapped:!1}),g=[],_=[],M={},P=new wn(16755200),N=new wn(16711680),U=new wn(43775),G=new wn(16777215),K=new wn(3355443);function Q(oe,de,xe){ne(oe,xe),ne(de,xe)}function ne(oe,de){g.push(0,0,0),_.push(de.r,de.g,de.b),M[oe]===void 0&&(M[oe]=[]),M[oe].push(g.length/3-1)}Q("n1","n2",P),Q("n2","n4",P),Q("n4","n3",P),Q("n3","n1",P),Q("f1","f2",P),Q("f2","f4",P),Q("f4","f3",P),Q("f3","f1",P),Q("n1","f1",P),Q("n2","f2",P),Q("n3","f3",P),Q("n4","f4",P),Q("p","n1",N),Q("p","n2",N),Q("p","n3",N),Q("p","n4",N),Q("u1","u2",U),Q("u2","u3",U),Q("u3","u1",U),Q("c","t",G),Q("p","c",K),Q("cn1","cn2",K),Q("cn3","cn4",K),Q("cf1","cf2",K),Q("cf3","cf4",K),e.setAttribute("position",new Un(g,3)),e.setAttribute("color",new Un(_,3)),super(e,l),this.type="CameraHelper",this.camera=S,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=S.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=M,this.update()}update(){const S=this.geometry,e=this.pointMap;Po.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),zo("c",e,S,Po,0,0,-1),zo("t",e,S,Po,0,0,1),zo("n1",e,S,Po,-1,-1,-1),zo("n2",e,S,Po,1,-1,-1),zo("n3",e,S,Po,-1,1,-1),zo("n4",e,S,Po,1,1,-1),zo("f1",e,S,Po,-1,-1,1),zo("f2",e,S,Po,1,-1,1),zo("f3",e,S,Po,-1,1,1),zo("f4",e,S,Po,1,1,1),zo("u1",e,S,Po,.7,1.1,-1),zo("u2",e,S,Po,-.7,1.1,-1),zo("u3",e,S,Po,0,2,-1),zo("cf1",e,S,Po,-1,0,1),zo("cf2",e,S,Po,1,0,1),zo("cf3",e,S,Po,0,-1,1),zo("cf4",e,S,Po,0,1,1),zo("cn1",e,S,Po,-1,0,-1),zo("cn2",e,S,Po,1,0,-1),zo("cn3",e,S,Po,0,-1,-1),zo("cn4",e,S,Po,0,1,-1),S.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},p.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},p.CanvasTexture=ph,p.CatmullRomCurve3=mh,p.CineonToneMapping=3,p.CircleBufferGeometry=wu,p.CircleGeometry=wu,p.ClampToEdgeWrapping=1001,p.Clock=uy,p.Color=wn,p.ColorKeyframeTrack=tr,p.CompressedTexture=dh,p.CompressedTextureLoader=class extends Er{constructor(S){super(S)}load(S,e,l,g){const _=this,M=[],P=new dh,N=new Gs(this.manager);N.setPath(this.path),N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setWithCredentials(_.withCredentials);let U=0;function G(K){N.load(S[K],function(Q){const ne=_.parse(Q,!0);M[K]={width:ne.width,height:ne.height,format:ne.format,mipmaps:ne.mipmaps},U+=1,U===6&&(ne.mipmapCount===1&&(P.minFilter=1006),P.image=M,P.format=ne.format,P.needsUpdate=!0,e&&e(P))},l,g)}if(Array.isArray(S))for(let K=0,Q=S.length;K<Q;++K)G(K);else N.load(S,function(K){const Q=_.parse(K,!0);if(Q.isCubemap){const ne=Q.mipmaps.length/Q.mipmapCount;for(let oe=0;oe<ne;oe++){M[oe]={mipmaps:[]};for(let de=0;de<Q.mipmapCount;de++)M[oe].mipmaps.push(Q.mipmaps[oe*Q.mipmapCount+de]),M[oe].format=Q.format,M[oe].width=Q.width,M[oe].height=Q.height}P.image=M}else P.image.width=Q.width,P.image.height=Q.height,P.mipmaps=Q.mipmaps;Q.mipmapCount===1&&(P.minFilter=1006),P.format=Q.format,P.needsUpdate=!0,e&&e(P)},l,g);return P}},p.ConeBufferGeometry=Tu,p.ConeGeometry=Tu,p.CubeCamera=iu,p.CubeReflectionMapping=301,p.CubeRefractionMapping=302,p.CubeTexture=Ea,p.CubeTextureLoader=qa,p.CubeUVReflectionMapping=306,p.CubeUVRefractionMapping=307,p.CubicBezierCurve=Wa,p.CubicBezierCurve3=nd,p.CubicInterpolant=zn,p.CullFaceBack=1,p.CullFaceFront=2,p.CullFaceFrontBack=3,p.CullFaceNone=0,p.Curve=ja,p.CurvePath=Hr,p.CustomBlending=5,p.CustomToneMapping=5,p.CylinderBufferGeometry=Nl,p.CylinderGeometry=Nl,p.Cylindrical=class{constructor(S=1,e=0,l=0){return this.radius=S,this.theta=e,this.y=l,this}set(S,e,l){return this.radius=S,this.theta=e,this.y=l,this}copy(S){return this.radius=S.radius,this.theta=S.theta,this.y=S.y,this}setFromVector3(S){return this.setFromCartesianCoords(S.x,S.y,S.z)}setFromCartesianCoords(S,e,l){return this.radius=Math.sqrt(S*S+l*l),this.theta=Math.atan2(S,l),this.y=e,this}clone(){return new this.constructor().copy(this)}},p.DataTexture=va,p.DataTexture2DArray=Hh,p.DataTexture3D=jh,p.DataTextureLoader=Mo,p.DataUtils=class{static toHalfFloat(S){Ty[0]=S;const e=hv[0];let l=e>>16&32768,g=e>>12&2047;const _=e>>23&255;return _<103?l:_>142?(l|=31744,l|=(_==255?0:1)&&8388607&e,l):_<113?(g|=2048,l|=(g>>114-_)+(g>>113-_&1),l):(l|=_-112<<10|g>>1,l+=1&g,l)}},p.DecrementStencilOp=7683,p.DecrementWrapStencilOp=34056,p.DefaultLoadingManager=ps,p.DepthFormat=1026,p.DepthStencilFormat=1027,p.DepthTexture=tp,p.DirectionalLight=Hc,p.DirectionalLightHelper=class extends Ee{constructor(S,e,l){super(),this.light=S,this.light.updateMatrixWorld(),this.matrix=S.matrixWorld,this.matrixAutoUpdate=!1,this.color=l,e===void 0&&(e=1);let g=new Pr;g.setAttribute("position",new Un([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const _=new Io({fog:!1,toneMapped:!1});this.lightPlane=new Ra(g,_),this.add(this.lightPlane),g=new Pr,g.setAttribute("position",new Un([0,0,0,0,0,1],3)),this.targetLine=new Ra(g,_),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){zm.setFromMatrixPosition(this.light.matrixWorld),mp.setFromMatrixPosition(this.light.target.matrixWorld),km.subVectors(mp,zm),this.lightPlane.lookAt(mp),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(mp),this.targetLine.scale.z=km.length()}},p.DiscreteInterpolant=An,p.DodecahedronBufferGeometry=Mu,p.DodecahedronGeometry=Mu,p.DoubleSide=2,p.DstAlphaFactor=206,p.DstColorFactor=208,p.DynamicBufferAttribute=function(S,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Or(S,e).setUsage(35048)},p.DynamicCopyUsage=35050,p.DynamicDrawUsage=35048,p.DynamicReadUsage=35049,p.EdgesGeometry=bf,p.EdgesHelper=function(S,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Jo(new bf(S.geometry),new Io({color:e!==void 0?e:16777215}))},p.EllipseCurve=Ks,p.EqualDepth=4,p.EqualStencilFunc=514,p.EquirectangularReflectionMapping=303,p.EquirectangularRefractionMapping=304,p.Euler=Fa,p.EventDispatcher=Mt,p.ExtrudeBufferGeometry=Y,p.ExtrudeGeometry=Y,p.FaceColors=1,p.FileLoader=Gs,p.FlatShading=1,p.Float16BufferAttribute=Yo,p.Float32Attribute=function(S,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Un(S,e)},p.Float32BufferAttribute=Un,p.Float64Attribute=function(S,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new dl(S,e)},p.Float64BufferAttribute=dl,p.FloatType=1015,p.Fog=Jt,p.FogExp2=Ts,p.Font=Cf,p.FontLoader=class extends Er{constructor(S){super(S)}load(S,e,l,g){const _=this,M=new Gs(this.manager);M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(_.withCredentials),M.load(S,function(P){let N;try{N=JSON.parse(P)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),N=JSON.parse(P.substring(65,P.length-2))}const U=_.parse(N);e&&e(U)},l,g)}parse(S){return new Cf(S)}},p.FrontSide=0,p.Frustum=Sc,p.GLBufferAttribute=vy,p.GLSL1="100",p.GLSL3=Tt,p.GammaEncoding=3007,p.GreaterDepth=6,p.GreaterEqualDepth=5,p.GreaterEqualStencilFunc=518,p.GreaterStencilFunc=516,p.GridHelper=by,p.Group=Ic,p.HalfFloatType=1016,p.HemisphereLight=Os,p.HemisphereLightHelper=class extends Ee{constructor(S,e,l){super(),this.light=S,this.light.updateMatrixWorld(),this.matrix=S.matrixWorld,this.matrixAutoUpdate=!1,this.color=l;const g=new _e(e);g.rotateY(.5*Math.PI),this.material=new ws({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const _=g.getAttribute("position"),M=new Float32Array(3*_.count);g.setAttribute("color",new Or(M,3)),this.add(new qn(g,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const S=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=S.geometry.getAttribute("color");Om.copy(this.light.color),Of.copy(this.light.groundColor);for(let l=0,g=e.count;l<g;l++){const _=l<g/2?Om:Of;e.setXYZ(l,_.r,_.g,_.b)}e.needsUpdate=!0}S.lookAt(Df.setFromMatrixPosition(this.light.matrixWorld).negate())}},p.HemisphereLightProbe=Im,p.IcosahedronBufferGeometry=pe,p.IcosahedronGeometry=pe,p.ImageBitmapLoader=Af,p.ImageLoader=ea,p.ImageUtils=bo,p.ImmediateRenderObject=Pf,p.IncrementStencilOp=7682,p.IncrementWrapStencilOp=34055,p.InstancedBufferAttribute=vl,p.InstancedBufferGeometry=dp,p.InstancedInterleavedBuffer=yy,p.InstancedMesh=Qh,p.Int16Attribute=function(S,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ba(S,e)},p.Int16BufferAttribute=Ba,p.Int32Attribute=function(S,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new hs(S,e)},p.Int32BufferAttribute=hs,p.Int8Attribute=function(S,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ro(S,e)},p.Int8BufferAttribute=ro,p.IntType=1013,p.InterleavedBuffer=Va,p.InterleavedBufferAttribute=yl,p.Interpolant=Xi,p.InterpolateDiscrete=2300,p.InterpolateLinear=2301,p.InterpolateSmooth=2302,p.InvertStencilOp=5386,p.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},p.KeepStencilOp=7680,p.KeyframeTrack=kn,p.LOD=Ds,p.LatheBufferGeometry=ue,p.LatheGeometry=ue,p.Layers=zl,p.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},p.LessDepth=2,p.LessEqualDepth=3,p.LessEqualStencilFunc=515,p.LessStencilFunc=513,p.Light=Es,p.LightProbe=Ml,p.Line=Ra,p.Line3=So,p.LineBasicMaterial=Io,p.LineCurve=Vc,p.LineCurve3=op,p.LineDashedMaterial=Ti,p.LineLoop=Qd,p.LinePieces=1,p.LineSegments=Jo,p.LineStrip=0,p.LinearEncoding=3e3,p.LinearFilter=1006,p.LinearInterpolant=$n,p.LinearMipMapLinearFilter=1008,p.LinearMipMapNearestFilter=1007,p.LinearMipmapLinearFilter=1008,p.LinearMipmapNearestFilter=1007,p.LinearToneMapping=1,p.Loader=Er,p.LoaderUtils=Mf,p.LoadingManager=ds,p.LogLuvEncoding=3003,p.LoopOnce=2200,p.LoopPingPong=2202,p.LoopRepeat=2201,p.LuminanceAlphaFormat=1025,p.LuminanceFormat=1024,p.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},p.Material=Vi,p.MaterialLoader=Hg,p.Math=$r,p.MathUtils=$r,p.Matrix3=Wn,p.Matrix4=nr,p.MaxEquation=104,p.Mesh=qn,p.MeshBasicMaterial=ws,p.MeshDepthMaterial=Kh,p.MeshDistanceMaterial=oa,p.MeshFaceMaterial=function(S){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),S},p.MeshLambertMaterial=wi,p.MeshMatcapMaterial=ui,p.MeshNormalMaterial=Wt,p.MeshPhongMaterial=Gi,p.MeshPhysicalMaterial=Si,p.MeshStandardMaterial=hi,p.MeshToonMaterial=Ki,p.MinEquation=103,p.MirroredRepeatWrapping=1002,p.MixOperation=1,p.MultiMaterial=function(S=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),S.isMultiMaterial=!0,S.materials=S,S.clone=function(){return S.slice()},S},p.MultiplyBlending=4,p.MultiplyOperation=0,p.NearestFilter=1003,p.NearestMipMapLinearFilter=1005,p.NearestMipMapNearestFilter=1004,p.NearestMipmapLinearFilter=1005,p.NearestMipmapNearestFilter=1004,p.NeverDepth=0,p.NeverStencilFunc=512,p.NoBlending=0,p.NoColors=0,p.NoToneMapping=0,p.NormalAnimationBlendMode=2500,p.NormalBlending=1,p.NotEqualDepth=7,p.NotEqualStencilFunc=517,p.NumberKeyframeTrack=dr,p.Object3D=Ee,p.ObjectLoader=class extends Er{constructor(S){super(S)}load(S,e,l,g){const _=this,M=this.path===""?Mf.extractUrlBase(S):this.path;this.resourcePath=this.resourcePath||M;const P=new Gs(this.manager);P.setPath(this.path),P.setRequestHeader(this.requestHeader),P.setWithCredentials(this.withCredentials),P.load(S,function(N){let U=null;try{U=JSON.parse(N)}catch(K){return g!==void 0&&g(K),void console.error("THREE:ObjectLoader: Can't parse "+S+".",K.message)}const G=U.metadata;G!==void 0&&G.type!==void 0&&G.type.toLowerCase()!=="geometry"?_.parse(U,e):console.error("THREE.ObjectLoader: Can't load "+S)},l,g)}async loadAsync(S,e){const l=this.path===""?Mf.extractUrlBase(S):this.path;this.resourcePath=this.resourcePath||l;const g=new Gs(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials);const _=await g.loadAsync(S,e),M=JSON.parse(_),P=M.metadata;if(P===void 0||P.type===void 0||P.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+S);return await this.parseAsync(M)}parse(S,e){const l=this.parseAnimations(S.animations),g=this.parseShapes(S.shapes),_=this.parseGeometries(S.geometries,g),M=this.parseImages(S.images,function(){e!==void 0&&e(U)}),P=this.parseTextures(S.textures,M),N=this.parseMaterials(S.materials,P),U=this.parseObject(S.object,_,N,P,l),G=this.parseSkeletons(S.skeletons,U);if(this.bindSkeletons(U,G),e!==void 0){let K=!1;for(const Q in M)if(M[Q]instanceof HTMLImageElement){K=!0;break}K===!1&&e(U)}return U}async parseAsync(S){const e=this.parseAnimations(S.animations),l=this.parseShapes(S.shapes),g=this.parseGeometries(S.geometries,l),_=await this.parseImagesAsync(S.images),M=this.parseTextures(S.textures,_),P=this.parseMaterials(S.materials,M),N=this.parseObject(S.object,g,P,M,e),U=this.parseSkeletons(S.skeletons,N);return this.bindSkeletons(N,U),N}parseShapes(S){const e={};if(S!==void 0)for(let l=0,g=S.length;l<g;l++){const _=new is().fromJSON(S[l]);e[_.uuid]=_}return e}parseSkeletons(S,e){const l={},g={};if(e.traverse(function(_){_.isBone&&(g[_.uuid]=_)}),S!==void 0)for(let _=0,M=S.length;_<M;_++){const P=new gu().fromJSON(S[_],g);l[P.uuid]=P}return l}parseGeometries(S,e){const l={};if(S!==void 0){const g=new Cm;for(let _=0,M=S.length;_<M;_++){let P;const N=S[_];switch(N.type){case"BufferGeometry":case"InstancedBufferGeometry":P=g.parse(N);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:N.type in vt?P=vt[N.type].fromJSON(N,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${N.type}"`)}P.uuid=N.uuid,N.name!==void 0&&(P.name=N.name),P.isBufferGeometry===!0&&N.userData!==void 0&&(P.userData=N.userData),l[N.uuid]=P}}return l}parseMaterials(S,e){const l={},g={};if(S!==void 0){const _=new Hg;_.setTextures(e);for(let M=0,P=S.length;M<P;M++){const N=S[M];if(N.type==="MultiMaterial"){const U=[];for(let G=0;G<N.materials.length;G++){const K=N.materials[G];l[K.uuid]===void 0&&(l[K.uuid]=_.parse(K)),U.push(l[K.uuid])}g[N.uuid]=U}else l[N.uuid]===void 0&&(l[N.uuid]=_.parse(N)),g[N.uuid]=l[N.uuid]}}return g}parseAnimations(S){const e={};if(S!==void 0)for(let l=0;l<S.length;l++){const g=S[l],_=Xr.parse(g);e[_.uuid]=_}return e}parseImages(S,e){const l=this,g={};let _;function M(P){if(typeof P=="string"){const N=P;return function(U){return l.manager.itemStart(U),_.load(U,function(){l.manager.itemEnd(U)},void 0,function(){l.manager.itemError(U),l.manager.itemEnd(U)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(N)?N:l.resourcePath+N)}return P.data?{data:ma(P.type,P.data),width:P.width,height:P.height}:null}if(S!==void 0&&S.length>0){const P=new ds(e);_=new ea(P),_.setCrossOrigin(this.crossOrigin);for(let N=0,U=S.length;N<U;N++){const G=S[N],K=G.url;if(Array.isArray(K)){g[G.uuid]=[];for(let Q=0,ne=K.length;Q<ne;Q++){const oe=M(K[Q]);oe!==null&&(oe instanceof HTMLImageElement?g[G.uuid].push(oe):g[G.uuid].push(new va(oe.data,oe.width,oe.height)))}}else{const Q=M(G.url);Q!==null&&(g[G.uuid]=Q)}}}return g}async parseImagesAsync(S){const e=this,l={};let g;async function _(M){if(typeof M=="string"){const P=M,N=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(P)?P:e.resourcePath+P;return await g.loadAsync(N)}return M.data?{data:ma(M.type,M.data),width:M.width,height:M.height}:null}if(S!==void 0&&S.length>0){g=new ea(this.manager),g.setCrossOrigin(this.crossOrigin);for(let M=0,P=S.length;M<P;M++){const N=S[M],U=N.url;if(Array.isArray(U)){l[N.uuid]=[];for(let G=0,K=U.length;G<K;G++){const Q=U[G],ne=await _(Q);ne!==null&&(ne instanceof HTMLImageElement?l[N.uuid].push(ne):l[N.uuid].push(new va(ne.data,ne.width,ne.height)))}}else{const G=await _(N.url);G!==null&&(l[N.uuid]=G)}}}return l}parseTextures(S,e){function l(_,M){return typeof _=="number"?_:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",_),M[_])}const g={};if(S!==void 0)for(let _=0,M=S.length;_<M;_++){const P=S[_];let N;P.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',P.uuid),e[P.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",P.image);const U=e[P.image];Array.isArray(U)?(N=new Ea(U),U.length===6&&(N.needsUpdate=!0)):(N=U&&U.data?new va(U.data,U.width,U.height):new _s(U),U&&(N.needsUpdate=!0)),N.uuid=P.uuid,P.name!==void 0&&(N.name=P.name),P.mapping!==void 0&&(N.mapping=l(P.mapping,Sf)),P.offset!==void 0&&N.offset.fromArray(P.offset),P.repeat!==void 0&&N.repeat.fromArray(P.repeat),P.center!==void 0&&N.center.fromArray(P.center),P.rotation!==void 0&&(N.rotation=P.rotation),P.wrap!==void 0&&(N.wrapS=l(P.wrap[0],Ef),N.wrapT=l(P.wrap[1],Ef)),P.format!==void 0&&(N.format=P.format),P.type!==void 0&&(N.type=P.type),P.encoding!==void 0&&(N.encoding=P.encoding),P.minFilter!==void 0&&(N.minFilter=l(P.minFilter,jg)),P.magFilter!==void 0&&(N.magFilter=l(P.magFilter,jg)),P.anisotropy!==void 0&&(N.anisotropy=P.anisotropy),P.flipY!==void 0&&(N.flipY=P.flipY),P.premultiplyAlpha!==void 0&&(N.premultiplyAlpha=P.premultiplyAlpha),P.unpackAlignment!==void 0&&(N.unpackAlignment=P.unpackAlignment),g[P.uuid]=N}return g}parseObject(S,e,l,g,_){let M,P,N;function U(Q){return e[Q]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Q),e[Q]}function G(Q){if(Q!==void 0){if(Array.isArray(Q)){const ne=[];for(let oe=0,de=Q.length;oe<de;oe++){const xe=Q[oe];l[xe]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",xe),ne.push(l[xe])}return ne}return l[Q]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Q),l[Q]}}function K(Q){return g[Q]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Q),g[Q]}switch(S.type){case"Scene":M=new ih,S.background!==void 0&&(Number.isInteger(S.background)?M.background=new wn(S.background):M.background=K(S.background)),S.environment!==void 0&&(M.environment=K(S.environment)),S.fog!==void 0&&(S.fog.type==="Fog"?M.fog=new Jt(S.fog.color,S.fog.near,S.fog.far):S.fog.type==="FogExp2"&&(M.fog=new Ts(S.fog.color,S.fog.density)));break;case"PerspectiveCamera":M=new _o(S.fov,S.aspect,S.near,S.far),S.focus!==void 0&&(M.focus=S.focus),S.zoom!==void 0&&(M.zoom=S.zoom),S.filmGauge!==void 0&&(M.filmGauge=S.filmGauge),S.filmOffset!==void 0&&(M.filmOffset=S.filmOffset),S.view!==void 0&&(M.view=Object.assign({},S.view));break;case"OrthographicCamera":M=new Gu(S.left,S.right,S.top,S.bottom,S.near,S.far),S.zoom!==void 0&&(M.zoom=S.zoom),S.view!==void 0&&(M.view=Object.assign({},S.view));break;case"AmbientLight":M=new sd(S.color,S.intensity);break;case"DirectionalLight":M=new Hc(S.color,S.intensity);break;case"PointLight":M=new Gc(S.color,S.intensity,S.distance,S.decay);break;case"RectAreaLight":M=new Cu(S.color,S.intensity,S.width,S.height);break;case"SpotLight":M=new Za(S.color,S.intensity,S.distance,S.angle,S.penumbra,S.decay);break;case"HemisphereLight":M=new Os(S.color,S.groundColor,S.intensity);break;case"LightProbe":M=new Ml().fromJSON(S);break;case"SkinnedMesh":P=U(S.geometry),N=G(S.material),M=new ch(P,N),S.bindMode!==void 0&&(M.bindMode=S.bindMode),S.bindMatrix!==void 0&&M.bindMatrix.fromArray(S.bindMatrix),S.skeleton!==void 0&&(M.skeleton=S.skeleton);break;case"Mesh":P=U(S.geometry),N=G(S.material),M=new qn(P,N);break;case"InstancedMesh":P=U(S.geometry),N=G(S.material);const Q=S.count,ne=S.instanceMatrix,oe=S.instanceColor;M=new Qh(P,N,Q),M.instanceMatrix=new vl(new Float32Array(ne.array),16),oe!==void 0&&(M.instanceColor=new vl(new Float32Array(oe.array),oe.itemSize));break;case"LOD":M=new Ds;break;case"Line":M=new Ra(U(S.geometry),G(S.material));break;case"LineLoop":M=new Qd(U(S.geometry),G(S.material));break;case"LineSegments":M=new Jo(U(S.geometry),G(S.material));break;case"PointCloud":case"Points":M=new Nc(U(S.geometry),G(S.material));break;case"Sprite":M=new Ga(G(S.material));break;case"Group":M=new Ic;break;case"Bone":M=new zc;break;default:M=new Ee}if(M.uuid=S.uuid,S.name!==void 0&&(M.name=S.name),S.matrix!==void 0?(M.matrix.fromArray(S.matrix),S.matrixAutoUpdate!==void 0&&(M.matrixAutoUpdate=S.matrixAutoUpdate),M.matrixAutoUpdate&&M.matrix.decompose(M.position,M.quaternion,M.scale)):(S.position!==void 0&&M.position.fromArray(S.position),S.rotation!==void 0&&M.rotation.fromArray(S.rotation),S.quaternion!==void 0&&M.quaternion.fromArray(S.quaternion),S.scale!==void 0&&M.scale.fromArray(S.scale)),S.castShadow!==void 0&&(M.castShadow=S.castShadow),S.receiveShadow!==void 0&&(M.receiveShadow=S.receiveShadow),S.shadow&&(S.shadow.bias!==void 0&&(M.shadow.bias=S.shadow.bias),S.shadow.normalBias!==void 0&&(M.shadow.normalBias=S.shadow.normalBias),S.shadow.radius!==void 0&&(M.shadow.radius=S.shadow.radius),S.shadow.mapSize!==void 0&&M.shadow.mapSize.fromArray(S.shadow.mapSize),S.shadow.camera!==void 0&&(M.shadow.camera=this.parseObject(S.shadow.camera))),S.visible!==void 0&&(M.visible=S.visible),S.frustumCulled!==void 0&&(M.frustumCulled=S.frustumCulled),S.renderOrder!==void 0&&(M.renderOrder=S.renderOrder),S.userData!==void 0&&(M.userData=S.userData),S.layers!==void 0&&(M.layers.mask=S.layers),S.children!==void 0){const Q=S.children;for(let ne=0;ne<Q.length;ne++)M.add(this.parseObject(Q[ne],e,l,g,_))}if(S.animations!==void 0){const Q=S.animations;for(let ne=0;ne<Q.length;ne++){const oe=Q[ne];M.animations.push(_[oe])}}if(S.type==="LOD"){S.autoUpdate!==void 0&&(M.autoUpdate=S.autoUpdate);const Q=S.levels;for(let ne=0;ne<Q.length;ne++){const oe=Q[ne],de=M.getObjectByProperty("uuid",oe.object);de!==void 0&&M.addLevel(de,oe.distance)}}return M}bindSkeletons(S,e){Object.keys(e).length!==0&&S.traverse(function(l){if(l.isSkinnedMesh===!0&&l.skeleton!==void 0){const g=e[l.skeleton];g===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",l.skeleton):l.bind(g,l.bindMatrix)}})}setTexturePath(S){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(S)}},p.ObjectSpaceNormalMap=1,p.OctahedronBufferGeometry=_e,p.OctahedronGeometry=_e,p.OneFactor=201,p.OneMinusDstAlphaFactor=207,p.OneMinusDstColorFactor=209,p.OneMinusSrcAlphaFactor=205,p.OneMinusSrcColorFactor=203,p.OrthographicCamera=Gu,p.PCFShadowMap=1,p.PCFSoftShadowMap=2,p.PMREMGenerator=ju,p.ParametricBufferGeometry=ge,p.ParametricGeometry=ge,p.Particle=function(S){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ga(S)},p.ParticleBasicMaterial=function(S){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new xl(S)},p.ParticleSystem=function(S,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Nc(S,e)},p.ParticleSystemMaterial=function(S){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new xl(S)},p.Path=Yr,p.PerspectiveCamera=_o,p.Plane=_a,p.PlaneBufferGeometry=No,p.PlaneGeometry=No,p.PlaneHelper=class extends Ra{constructor(S,e=1,l=16776960){const g=l,_=new Pr;_.setAttribute("position",new Un([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),_.computeBoundingSphere(),super(_,new Io({color:g,toneMapped:!1})),this.type="PlaneHelper",this.plane=S,this.size=e;const M=new Pr;M.setAttribute("position",new Un([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),M.computeBoundingSphere(),this.add(new qn(M,new ws({color:g,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(S){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(S)}},p.PointCloud=function(S,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Nc(S,e)},p.PointCloudMaterial=function(S){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new xl(S)},p.PointLight=Gc,p.PointLightHelper=class extends qn{constructor(S,e,l){super(new Ue(e,4,2),new ws({wireframe:!0,fog:!1,toneMapped:!1})),this.light=S,this.light.updateMatrixWorld(),this.color=l,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},p.Points=Nc,p.PointsMaterial=xl,p.PolarGridHelper=class extends Jo{constructor(S=10,e=16,l=8,g=64,_=4473924,M=8947848){_=new wn(_),M=new wn(M);const P=[],N=[];for(let G=0;G<=e;G++){const K=G/e*(2*Math.PI),Q=Math.sin(K)*S,ne=Math.cos(K)*S;P.push(0,0,0),P.push(Q,0,ne);const oe=1&G?_:M;N.push(oe.r,oe.g,oe.b),N.push(oe.r,oe.g,oe.b)}for(let G=0;G<=l;G++){const K=1&G?_:M,Q=S-S/l*G;for(let ne=0;ne<g;ne++){let oe=ne/g*(2*Math.PI),de=Math.sin(oe)*Q,xe=Math.cos(oe)*Q;P.push(de,0,xe),N.push(K.r,K.g,K.b),oe=(ne+1)/g*(2*Math.PI),de=Math.sin(oe)*Q,xe=Math.cos(oe)*Q,P.push(de,0,xe),N.push(K.r,K.g,K.b)}}const U=new Pr;U.setAttribute("position",new Un(P,3)),U.setAttribute("color",new Un(N,3)),super(U,new Io({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},p.PolyhedronBufferGeometry=Ha,p.PolyhedronGeometry=Ha,p.PositionalAudio=class extends Zg{constructor(S){super(S),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(S){return this.panner.refDistance=S,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(S){return this.panner.rolloffFactor=S,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(S){return this.panner.distanceModel=S,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(S){return this.panner.maxDistance=S,this}setDirectionalCone(S,e,l){return this.panner.coneInnerAngle=S,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=l,this}updateMatrixWorld(S){if(super.updateMatrixWorld(S),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_h,Xg,py),yh.set(0,0,1).applyQuaternion(Xg);const e=this.panner;if(e.positionX){const l=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(_h.x,l),e.positionY.linearRampToValueAtTime(_h.y,l),e.positionZ.linearRampToValueAtTime(_h.z,l),e.orientationX.linearRampToValueAtTime(yh.x,l),e.orientationY.linearRampToValueAtTime(yh.y,l),e.orientationZ.linearRampToValueAtTime(yh.z,l)}else e.setPosition(_h.x,_h.y,_h.z),e.setOrientation(yh.x,yh.y,yh.z)}},p.PropertyBinding=Ms,p.PropertyMixer=Kg,p.QuadraticBezierCurve=rd,p.QuadraticBezierCurve3=Eu,p.Quaternion=ye,p.QuaternionKeyframeTrack=as,p.QuaternionLinearInterpolant=Nr,p.REVISION=z,p.RGBADepthPacking=3201,p.RGBAFormat=1023,p.RGBAIntegerFormat=1033,p.RGBA_ASTC_10x10_Format=37819,p.RGBA_ASTC_10x5_Format=37816,p.RGBA_ASTC_10x6_Format=37817,p.RGBA_ASTC_10x8_Format=37818,p.RGBA_ASTC_12x10_Format=37820,p.RGBA_ASTC_12x12_Format=37821,p.RGBA_ASTC_4x4_Format=37808,p.RGBA_ASTC_5x4_Format=37809,p.RGBA_ASTC_5x5_Format=37810,p.RGBA_ASTC_6x5_Format=37811,p.RGBA_ASTC_6x6_Format=37812,p.RGBA_ASTC_8x5_Format=37813,p.RGBA_ASTC_8x6_Format=37814,p.RGBA_ASTC_8x8_Format=37815,p.RGBA_BPTC_Format=36492,p.RGBA_ETC2_EAC_Format=37496,p.RGBA_PVRTC_2BPPV1_Format=35843,p.RGBA_PVRTC_4BPPV1_Format=35842,p.RGBA_S3TC_DXT1_Format=33777,p.RGBA_S3TC_DXT3_Format=33778,p.RGBA_S3TC_DXT5_Format=33779,p.RGBDEncoding=3006,p.RGBEEncoding=3002,p.RGBEFormat=1023,p.RGBFormat=1022,p.RGBIntegerFormat=1032,p.RGBM16Encoding=3005,p.RGBM7Encoding=3004,p.RGB_ETC1_Format=36196,p.RGB_ETC2_Format=37492,p.RGB_PVRTC_2BPPV1_Format=35841,p.RGB_PVRTC_4BPPV1_Format=35840,p.RGB_S3TC_DXT1_Format=33776,p.RGFormat=1030,p.RGIntegerFormat=1031,p.RawShaderMaterial=ru,p.Ray=na,p.Raycaster=class{constructor(S,e,l=0,g=1/0){this.ray=new na(S,e),this.near=l,this.far=g,this.camera=null,this.layers=new zl,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(S,e){this.ray.set(S,e)}setFromCamera(S,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(S.x,S.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(S.x,S.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(S,e=!1,l=[]){return Qg(S,this,l,e),l.sort(xy),l}intersectObjects(S,e=!1,l=[]){for(let g=0,_=S.length;g<_;g++)Qg(S[g],this,l,e);return l.sort(xy),l}},p.RectAreaLight=Cu,p.RedFormat=1028,p.RedIntegerFormat=1029,p.ReinhardToneMapping=2,p.RepeatWrapping=1e3,p.ReplaceStencilOp=7681,p.ReverseSubtractEquation=102,p.RingBufferGeometry=Oe,p.RingGeometry=Oe,p.SRGB8_ALPHA8_ASTC_10x10_Format=37851,p.SRGB8_ALPHA8_ASTC_10x5_Format=37848,p.SRGB8_ALPHA8_ASTC_10x6_Format=37849,p.SRGB8_ALPHA8_ASTC_10x8_Format=37850,p.SRGB8_ALPHA8_ASTC_12x10_Format=37852,p.SRGB8_ALPHA8_ASTC_12x12_Format=37853,p.SRGB8_ALPHA8_ASTC_4x4_Format=37840,p.SRGB8_ALPHA8_ASTC_5x4_Format=37841,p.SRGB8_ALPHA8_ASTC_5x5_Format=37842,p.SRGB8_ALPHA8_ASTC_6x5_Format=37843,p.SRGB8_ALPHA8_ASTC_6x6_Format=37844,p.SRGB8_ALPHA8_ASTC_8x5_Format=37845,p.SRGB8_ALPHA8_ASTC_8x6_Format=37846,p.SRGB8_ALPHA8_ASTC_8x8_Format=37847,p.Scene=ih,p.SceneUtils=dv,p.ShaderChunk=os,p.ShaderLib=Qa,p.ShaderMaterial=ao,p.ShadowMaterial=ri,p.Shape=is,p.ShapeBufferGeometry=Ne,p.ShapeGeometry=Ne,p.ShapePath=Lm,p.ShapeUtils=j,p.ShortType=1011,p.Skeleton=gu,p.SkeletonHelper=t_,p.SkinnedMesh=ch,p.SmoothShading=2,p.Sphere=Ns,p.SphereBufferGeometry=Ue,p.SphereGeometry=Ue,p.Spherical=class{constructor(S=1,e=0,l=0){return this.radius=S,this.phi=e,this.theta=l,this}set(S,e,l){return this.radius=S,this.phi=e,this.theta=l,this}copy(S){return this.radius=S.radius,this.phi=S.phi,this.theta=S.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(S){return this.setFromCartesianCoords(S.x,S.y,S.z)}setFromCartesianCoords(S,e,l){return this.radius=Math.sqrt(S*S+e*e+l*l),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(S,l),this.phi=Math.acos(Fn(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},p.SphericalHarmonics3=Hl,p.SplineCurve=ap,p.SpotLight=Za,p.SpotLightHelper=class extends Ee{constructor(S,e){super(),this.light=S,this.light.updateMatrixWorld(),this.matrix=S.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const l=new Pr,g=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let M=0,P=1,N=32;M<N;M++,P++){const U=M/N*Math.PI*2,G=P/N*Math.PI*2;g.push(Math.cos(U),Math.sin(U),1,Math.cos(G),Math.sin(G),1)}l.setAttribute("position",new Un(g,3));const _=new Io({fog:!1,toneMapped:!1});this.cone=new Jo(l,_),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const S=this.light.distance?this.light.distance:1e3,e=S*Math.tan(this.light.angle);this.cone.scale.set(e,e,S),e_.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e_),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},p.Sprite=Ga,p.SpriteMaterial=tl,p.SrcAlphaFactor=204,p.SrcAlphaSaturateFactor=210,p.SrcColorFactor=202,p.StaticCopyUsage=35046,p.StaticDrawUsage=35044,p.StaticReadUsage=35045,p.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new _o,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new _o,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(S){const e=this._cache;if(e.focus!==S.focus||e.fov!==S.fov||e.aspect!==S.aspect*this.aspect||e.near!==S.near||e.far!==S.far||e.zoom!==S.zoom||e.eyeSep!==this.eyeSep){e.focus=S.focus,e.fov=S.fov,e.aspect=S.aspect*this.aspect,e.near=S.near,e.far=S.far,e.zoom=S.zoom,e.eyeSep=this.eyeSep;const l=S.projectionMatrix.clone(),g=e.eyeSep/2,_=g*e.near/e.focus,M=e.near*Math.tan(an*e.fov*.5)/e.zoom;let P,N;cy.elements[12]=-g,ly.elements[12]=g,P=-M*e.aspect+_,N=M*e.aspect+_,l.elements[0]=2*e.near/(N-P),l.elements[8]=(N+P)/(N-P),this.cameraL.projectionMatrix.copy(l),P=-M*e.aspect-_,N=M*e.aspect-_,l.elements[0]=2*e.near/(N-P),l.elements[8]=(N+P)/(N-P),this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(S.matrixWorld).multiply(cy),this.cameraR.matrixWorld.copy(S.matrixWorld).multiply(ly)}},p.StreamCopyUsage=35042,p.StreamDrawUsage=35040,p.StreamReadUsage=35041,p.StringKeyframeTrack=Ur,p.SubtractEquation=101,p.SubtractiveBlending=3,p.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},p.TangentSpaceNormalMap=0,p.TetrahedronBufferGeometry=$e,p.TetrahedronGeometry=$e,p.TextBufferGeometry=Ke,p.TextGeometry=Ke,p.Texture=_s,p.TextureLoader=Wr,p.TorusBufferGeometry=Ze,p.TorusGeometry=Ze,p.TorusKnotBufferGeometry=it,p.TorusKnotGeometry=it,p.Triangle=Ei,p.TriangleFanDrawMode=2,p.TriangleStripDrawMode=1,p.TrianglesDrawMode=0,p.TubeBufferGeometry=gt,p.TubeGeometry=gt,p.UVMapping=300,p.Uint16Attribute=function(S,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new To(S,e)},p.Uint16BufferAttribute=To,p.Uint32Attribute=function(S,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Is(S,e)},p.Uint32BufferAttribute=Is,p.Uint8Attribute=function(S,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new to(S,e)},p.Uint8BufferAttribute=to,p.Uint8ClampedAttribute=function(S,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Xs(S,e)},p.Uint8ClampedBufferAttribute=Xs,p.Uniform=Rm,p.UniformsLib=Qn,p.UniformsUtils=Tc,p.UnsignedByteType=1009,p.UnsignedInt248Type=1020,p.UnsignedIntType=1014,p.UnsignedShort4444Type=1017,p.UnsignedShort5551Type=1018,p.UnsignedShort565Type=1019,p.UnsignedShortType=1012,p.VSMShadowMap=3,p.Vector2=en,p.Vector3=ie,p.Vector4=Dr,p.VectorKeyframeTrack=vs,p.Vertex=function(S,e,l){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new ie(S,e,l)},p.VertexColors=2,p.VideoTexture=xf,p.WebGL1Renderer=pu,p.WebGLCubeRenderTarget=Ys,p.WebGLMultipleRenderTargets=uo,p.WebGLMultisampleRenderTarget=oi,p.WebGLRenderTarget=no,p.WebGLRenderTargetCube=function(S,e,l){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ys(S,l)},p.WebGLRenderer=yn,p.WebGLUtils=_f,p.WireframeGeometry=Lt,p.WireframeHelper=function(S,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Jo(new Lt(S.geometry),new Io({color:e!==void 0?e:16777215}))},p.WrapAroundEnding=2402,p.XHRLoader=function(S){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Gs(S)},p.ZeroCurvatureEnding=2400,p.ZeroFactor=200,p.ZeroSlopeEnding=2401,p.ZeroStencilOp=0,p.sRGBEncoding=3001,Object.defineProperty(p,"__esModule",{value:!0})})}(B_,B_.exports)),B_.exports}var _x={exports:{}},yx={exports:{}},vx={exports:{}},iM;function K1(){return iM||(iM=1,function(v,y){const z=.0005555555555555556*Math.PI,F=Math.atan(3/4),q=63710088e-1,V=40075017;v.exports={WORLD_SIZE:1024e3,PROJECTION_WORLD_SIZE:1024e3/(q*Math.PI*2),MERCATOR_A:q,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_RADIUS:q,EARTH_CIRCUMFERENCE:2*Math.PI*q,EARTH_CIRCUMFERENCE_EQUATOR:V,FOV_ORTHO:z,FOV:F,FOV_DEGREES:F*180/Math.PI,TILE_SIZE:512}}(vx)),vx.exports}var xx={exports:{}},nM;function yI(){return nM||(nM=1,function(v,y){function p(){}p.prototype={Coords:function(z){if(z.constructor!==Array){console.error("Coords must be an array");return}if(z.length<2){console.error("Coords length must be at least 2");return}for(const F of z)if(F.constructor!==Number){console.error("Coords values must be numbers");return}if(Math.abs(z[1])>90){console.error("Latitude must be between -90 and 90");return}return z},Line:function(z){var F=this;if(z.constructor!==Array){console.error("Line must be an array");return}for(const q of z)if(!F.Coords(q)){console.error("Each coordinate in a line must be a valid Coords type");return}return z},Rotation:function(z){if(z.constructor===Number)z={z};else if(z.constructor===Object)for(const F of Object.keys(z)){if(!["x","y","z"].includes(F)){console.error("Rotation parameters must be x, y, or z");return}if(z[F].constructor!==Number){console.error("Individual rotation values must be numbers");return}}else{console.error("Rotation must be an object or a number");return}return z},Scale:function(z){if(z.constructor===Number)z={x:z,y:z,z};else if(z.constructor===Object)for(const F of Object.keys(z)){if(!["x","y","z"].includes(F)){console.error("Scale parameters must be x, y, or z");return}if(z[F].constructor!==Number){console.error("Individual scale values must be numbers");return}}else{console.error("Scale must be an object or a number");return}return z}},v.exports=p}(xx)),xx.exports}var rM;function _c(){return rM||(rM=1,function(v,y){var p=za(),z=K1(),F=yI(),q={prettyPrintMatrix:function(V){for(var n=0;n<4;n++){var J=[V[n],V[n+4],V[n+8],V[n+12]];console.log(J.map(function(re){return re.toFixed(4)}))}},makePerspectiveMatrix:function(V,n,J,re){var ce=new p.Matrix4,Se=1/Math.tan(V/2),Xe=1/(J-re),ht=[Se/n,0,0,0,0,Se,0,0,0,0,(re+J)*Xe,-1,0,0,2*re*J*Xe,0];return ce.elements=ht,ce},makeOrthographicMatrix:function(V,n,J,re,ce,Se){var Xe=new p.Matrix4;const ht=1/(n-V),Ut=1/(J-re),ct=1/(Se-ce),Dt=(n+V)*ht,rt=(J+re)*Ut,pt=ce*ct;var gi=[2*ht,0,0,0,0,2*Ut,0,0,0,0,-1*ct,0,-Dt,-rt,-pt,1];return Xe.elements=gi,Xe},radify:function(V){function n(J){return J=J||0,Math.PI*2*J/360}return typeof V=="object"?V.length>0?V.map(function(J){return n(J)}):[n(V.x),n(V.y),n(V.z)]:n(V)},degreeify:function(V){function n(J){return J=J||0,J*360/(Math.PI*2)}return typeof V=="object"?[n(V.x),n(V.y),n(V.z)]:n(V)},projectToWorld:function(V){var n=[-z.MERCATOR_A*z.DEG2RAD*V[0]*z.PROJECTION_WORLD_SIZE,-z.MERCATOR_A*Math.log(Math.tan(Math.PI*.25+.5*z.DEG2RAD*V[1]))*z.PROJECTION_WORLD_SIZE];if(!V[2])n.push(0);else{var J=this.projectedUnitsPerMeter(V[1]);n.push(V[2]*J)}var re=new p.Vector3(n[0],n[1],n[2]);return re},projectedUnitsPerMeter:function(V){return Math.abs(z.WORLD_SIZE/Math.cos(z.DEG2RAD*V)/z.EARTH_CIRCUMFERENCE)},_circumferenceAtLatitude:function(V){return z.EARTH_CIRCUMFERENCE*Math.cos(V*Math.PI/180)},mercatorZfromAltitude:function(V,n){return V/this._circumferenceAtLatitude(n)},_scaleVerticesToMeters:function(V,n){var J=this.projectedUnitsPerMeter(V[1]);this.projectToWorld(V);for(var re=0;re<n.length;re++)n[re].multiplyScalar(J);return n},projectToScreen:function(V){console.log("WARNING: Projecting to screen coordinates is not yet implemented")},unprojectFromScreen:function(V){console.log("WARNING: unproject is not yet implemented")},unprojectFromWorld:function(V){var n=[-V.x/(z.MERCATOR_A*z.DEG2RAD*z.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(V.y/(z.PROJECTION_WORLD_SIZE*-z.MERCATOR_A)))-Math.PI/4)/z.DEG2RAD],J=this.projectedUnitsPerMeter(n[1]),re=V.z||0;return n.push(re/J),n},toScreenPosition:function(V,n){var J=new p.Vector3,re=.5*renderer.context.canvas.width,ce=.5*renderer.context.canvas.height;return V.updateMatrixWorld(),J.setFromMatrixPosition(V.matrixWorld),J.project(n),J.x=J.x*re+re,J.y=-(J.y*ce)+ce,{x:J.x,y:J.y}},getFeatureCenter:function(n,J,re){let ce=[],Se=0,Xe=0,ht=0,Ut=[...n.geometry.coordinates[0]];return n.geometry.type==="Point"?ce=[...Ut[0]]:(n.geometry.type==="MultiPolygon"&&(Ut=Ut[0]),Ut.splice(-1,1),Ut.forEach(function(ct){Se+=ct[0],Xe+=ct[1]}),ce=[Se/Ut.length,Xe/Ut.length]),ht=this.getObjectHeightOnFloor(n,J,re),ce.length<3?ce.push(ht):ce[2]=ht,ce},getObjectHeightOnFloor:function(V,n,J=V.properties.level||0){let re=J*(V.properties.levelHeight||0),ce=V.properties.base_height||V.properties.min_height||0,Xe=(n&&n.model?0:V.properties.height-ce)+ce;return re+Xe},_flipMaterialSides:function(V){},normalizeVertices(V){let n=new p.BufferGeometry,J=[];for(var re=0;re<V.length;re++){let Xe=V[re];J.push(Xe.x,Xe.y,Xe.z),J.push(Xe.x,Xe.y,Xe.z)}n.setAttribute("position",new p.BufferAttribute(new Float32Array(J),3)),n.computeBoundingSphere();var ce=n.boundingSphere.center,Se=V.map(function(Xe){var ht=Xe.sub(ce);return ht});return{vertices:Se,position:ce}},flattenVectors(V){var n=[];for(let J of V)n.push(J.x,J.y,J.z);return n},lnglatsToWorld:function(V){var n=V.map(function(J){var re=q.projectToWorld(J),ce=new p.Vector3(re.x,re.y,re.z);return ce});return n},extend:function(V,n){for(let J in n)V[J]=n[J]},clone:function(V){var n={};for(let J in V)n[J]=V[J];return n},clamp:function(V,n,J){return Math.min(J,Math.max(n,V))},types:{rotation:function(V,n){V||(V=0),typeof V=="number"&&(V={z:V});var J=this.applyDefault([V.x,V.y,V.z],n),re=q.radify(J);return re},scale:function(V,n){return V||(V=1),typeof V=="number"?V=[V,V,V]:this.applyDefault([V.x,V.y,V.z],n)},applyDefault:function(V,n){var J=V.map(function(re,ce){return re=re||n[ce],re});return J}},toDecimal:function(V,n){return Number(V.toFixed(n))},equal:function(V,n){const J=Object.keys(V),re=Object.keys(n);if(J.length!==re.length||J.length==0&&re.length==0&&J!==re)return!1;for(const ce of J){const Se=V[ce],Xe=n[ce],ht=this.isObject(Se)&&this.isObject(Xe);if(ht&&!equal(Se,Xe)||!ht&&Se!==Xe)return!1}return!0},isObject:function(V){return V!=null&&typeof V=="object"},curveToLine:(V,n)=>{let{width:J,color:re}=n,ce=new p.BufferGeometry().setFromPoints(V.getPoints(100)),Se=new p.LineBasicMaterial({color:re,linewidth:J});return new p.Line(ce,Se)},curvesToLines:V=>{var n=[16711680,2031360,2490623],J=V.map((re,ce)=>{let Se={width:3,color:n[ce]||"purple"};return curveToLine(re,Se)});return J},_validate:function(V,n){V=V||{};var J={};q.extend(J,V);for(let re of Object.keys(n))if(V[re]===void 0)if(n[re]===null){console.error(re+" is required");return}else J[re]=n[re];else J[re]=V[re];return J},Validator:new F,exposedMethods:["projectToWorld","projectedUnitsPerMeter","extend","unprojectFromWorld"]};v.exports=q}(yx)),yx.exports}var sM;function vI(){return sM||(sM=1,function(v,y){const p=za(),z=_c(),F=K1();function q(V,n,J){this.map=V,this.camera=n,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=J||new p.Group,this.world.position.x=this.world.position.y=F.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1,this.state={translateCenter:new p.Matrix4().makeTranslation(F.WORLD_SIZE/2,-F.WORLD_SIZE/2,0),worldSizeRatio:F.TILE_SIZE/F.WORLD_SIZE,worldSize:F.TILE_SIZE*this.map.transform.scale};let re=this;this.map.on("move",function(){re.updateCamera()}).on("resize",function(){re.setupCamera()}),this.setupCamera()}q.prototype={setupCamera:function(){const V=this.map.transform;this.camera.aspect=V.width/V.height,this.halfFov=V._fov/2,this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*V.height;const n=V._maxPitch*Math.PI/180;this.acuteAngle=Math.PI/2-n,this.updateCamera()},updateCamera:function(V){if(!this.camera){console.log("nocamera");return}const n=this.map.transform;this.camera.aspect=n.width/n.height;const J=n.centerOffset||new p.Vector3;let re=0,ce=0;this.halfFov=n._fov/2;const Se=Math.PI/2+n._pitch,Xe=Math.cos(Math.PI/2-n._pitch);this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*n.height;let ht=1;const Ut=this.worldSize();if(this.map.tb.mapboxVersion>=2){ht=this.mercatorZfromAltitude(1,n.center.lat)*Ut;const et=n._fov*(.5+n.centerOffset.y/n.height),Rt=n.elevation?n.elevation.getMinElevationBelowMSL()*ht:0,at=(n._camera.position[2]*Ut-Rt)/Math.cos(n._pitch),_t=Math.sin(et)*at/Math.sin(z.clamp(Math.PI-Se-et,.01,Math.PI-.01));ce=Xe*_t+at;const Qt=at*(1/n._horizonShift);re=Math.min(ce*1.01,Qt)}else{const et=Math.sin(this.halfFov)*this.cameraToCenterDistance/Math.sin(Math.PI-Se-this.halfFov);ce=Xe*et+this.cameraToCenterDistance,re=ce*1.01}this.cameraTranslateZ=new p.Matrix4().makeTranslation(0,0,this.cameraToCenterDistance);const ct=n.height/50,Dt=Math.max(ct*Xe,ct),rt=n.height,pt=n.width;this.camera instanceof p.OrthographicCamera?this.camera.projectionMatrix=z.makeOrthographicMatrix(pt/-2,pt/2,rt/2,rt/-2,Dt,re):this.camera.projectionMatrix=z.makePerspectiveMatrix(n._fov,pt/rt,Dt,re),this.camera.projectionMatrix.elements[8]=-J.x*2/n.width,this.camera.projectionMatrix.elements[9]=J.y*2/n.height;let gi=this.calcCameraMatrix(n._pitch,n.angle);n.elevation&&(gi.elements[14]=n._camera.position[2]*Ut),this.camera.matrixWorld.copy(gi);let Zt=n.scale*this.state.worldSizeRatio,At=new p.Matrix4,It=new p.Matrix4,Ye=new p.Matrix4;At.makeScale(Zt,Zt,Zt);let ot=n.x||n.point.x,tt=n.y||n.point.y;It.makeTranslation(-ot,tt,0),Ye.makeRotationZ(Math.PI),this.world.matrix=new p.Matrix4().premultiply(Ye).premultiply(this.state.translateCenter).premultiply(At).premultiply(It),this.map.fire("CameraSynced",{detail:{nearZ:Dt,farZ:re,pitch:n._pitch,angle:n.angle,furthestDistance:ce,cameraToCenterDistance:this.cameraToCenterDistance,t:this.map.transform,tbProjMatrix:this.camera.projectionMatrix.elements,tbWorldMatrix:this.world.matrix.elements,cameraSyn:q}})},worldSize(){let V=this.map.transform;return V.tileSize*V.scale},worldSizeFromZoom(){let V=this.map.transform;return Math.pow(2,V.zoom)*V.tileSize},mercatorZfromAltitude(V,n){return V/this.circumferenceAtLatitude(n)},mercatorZfromZoom(){return this.cameraToCenterDistance/this.worldSizeFromZoom()},circumferenceAtLatitude(V){return F.EARTH_CIRCUMFERENCE*Math.cos(V*Math.PI/180)},calcCameraMatrix(V,n,J){const re=this.map.transform,ce=V===void 0?re._pitch:V,Se=n===void 0?re.angle:n,Xe=J===void 0?this.cameraTranslateZ:J;return new p.Matrix4().premultiply(Xe).premultiply(new p.Matrix4().makeRotationX(ce)).premultiply(new p.Matrix4().makeRotationZ(Se))},updateCameraState(){let V=this.map.transform;if(!V.height)return;const n=V._camera.forward(),J=V.cameraToCenterDistance,re=V.point;V._cameraZoom?V._cameraZoom:V._zoom;const Se=this.mercatorZfromZoom(V)-this.mercatorZfromAltitude(V._centerAltitude,V.center.lat),Xe=V.cameraToCenterDistance/Se;return[re.x/this.worldSize()-n[0]*J/Xe,re.y/this.worldSize()-n[1]*J/Xe,this.mercatorZfromAltitude(V._centerAltitude,V._center.lat)+-n[2]*J/Xe]},getWorldToCamera(V,n){let J=this.map.transform;const re=new p.Matrix4,ce=new p.Matrix4,Se=J._camera._orientation,Xe=J._camera.position,ht=new p.Vector3(Xe[0],Xe[1],Xe[2]),Ut=new p.Quaternion;Ut.set(Se[0],Se[1],Se[2],Se[3]);const ct=Ut.conjugate();return ht.multiplyScalar(-V),ce.makeTranslation(ht.x,ht.y,ht.z),re.makeRotationFromQuaternion(ct).premultiply(ce),re.elements[1]*=-1,re.elements[5]*=-1,re.elements[9]*=-1,re.elements[13]*=-1,re.elements[8]*=n,re.elements[9]*=n,re.elements[10]*=n,re.elements[11]*=n,re},translate(V,n,J){let re=J[0]||J.x,ce=J[1]||J.y,Se=J[2]||J.z,Xe,ht,Ut,ct,Dt,rt,pt,gi,Zt,At,It,Ye;return n===V?(V[12]=n[0]*re+n[4]*ce+n[8]*Se+n[12],V[13]=n[1]*re+n[5]*ce+n[9]*Se+n[13],V[14]=n[2]*re+n[6]*ce+n[10]*Se+n[14],V[15]=n[3]*re+n[7]*ce+n[11]*Se+n[15]):(Xe=n[0],ht=n[1],Ut=n[2],ct=n[3],Dt=n[4],rt=n[5],pt=n[6],gi=n[7],Zt=n[8],At=n[9],It=n[10],Ye=n[11],V[0]=Xe,V[1]=ht,V[2]=Ut,V[3]=ct,V[4]=Dt,V[5]=rt,V[6]=pt,V[7]=gi,V[8]=Zt,V[9]=At,V[10]=It,V[11]=Ye,V[12]=Xe*re+Dt*ce+Zt*Se+n[12],V[13]=ht*re+rt*ce+At*Se+n[13],V[14]=Ut*re+pt*ce+It*Se+n[14],V[15]=ct*re+gi*ce+Ye*Se+n[15]),V}},v.exports=q}(_x)),_x.exports}var bx={exports:{}},oM;function R2(){return oM||(oM=1,function(v,y){(function(){var p=Math.PI,z=Math.sin,F=Math.cos,q=Math.tan,V=Math.asin,n=Math.atan2,J=Math.acos,re=p/180,ce=1e3*60*60*24,Se=2440588,Xe=2451545;function ht(zt){return zt.valueOf()/ce-.5+Se}function Ut(zt){return new Date((zt+.5-Se)*ce)}function ct(zt){return ht(zt)-Xe}var Dt=re*23.4397;function rt(zt,mt){return n(z(zt)*F(Dt)-q(mt)*z(Dt),F(zt))}function pt(zt,mt){return V(z(mt)*F(Dt)+F(mt)*z(Dt)*z(zt))}function gi(zt,mt,Nt){return n(z(zt),F(zt)*z(mt)-q(Nt)*F(mt))}function Zt(zt,mt,Nt){return V(z(mt)*z(Nt)+F(mt)*F(Nt)*F(zt))}function At(zt,mt){return re*(280.16+360.9856235*zt)-mt}function It(zt){return zt<0&&(zt=0),2967e-7/Math.tan(zt+.00312536/(zt+.08901179))}function Ye(zt){return re*(357.5291+.98560028*zt)}function ot(zt){var mt=re*(1.9148*z(zt)+.02*z(2*zt)+3e-4*z(3*zt)),Nt=re*102.9372;return zt+mt+Nt+p}function tt(zt){var mt=Ye(zt),Nt=ot(mt);return{dec:pt(Nt,0),ra:rt(Nt,0)}}var et={};et.getPosition=function(zt,mt,Nt){var Gt=re*-Nt,ii=re*mt,zi=ct(zt),Hi=tt(zi),on=At(zi,Gt)-Hi.ra;return{azimuth:gi(on,ii,Hi.dec),altitude:Zt(on,ii,Hi.dec)}},et.toJulian=function(zt){return ht(zt)};var Rt=et.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];et.addTime=function(zt,mt,Nt){Rt.push([zt,mt,Nt])};var at=9e-4;function _t(zt,mt){return Math.round(zt-at-mt/(2*p))}function Qt(zt,mt,Nt){return at+(zt+mt)/(2*p)+Nt}function ae(zt,mt,Nt){return Xe+zt+.0053*z(mt)-.0069*z(2*Nt)}function be(zt,mt,Nt){return J((z(zt)-z(mt)*z(Nt))/(F(mt)*F(Nt)))}function ve(zt){return-2.076*Math.sqrt(zt)/60}function De(zt,mt,Nt,Gt,ii,zi,Hi){var on=be(zt,Nt,Gt),mn=Qt(on,mt,ii);return ae(mn,zi,Hi)}et.getTimes=function(zt,mt,Nt,Gt){Gt=Gt||0;var ii=re*-Nt,zi=re*mt,Hi=ve(Gt),on=ct(zt),mn=_t(on,ii),Qe=Qt(0,ii,mn),Yn=Ye(Qe),pr=ot(Yn),bt=pt(pr,0),je=ae(Qe,Yn,pr),Ot,Le,Ie,Fe,Ge,Je,st={solarNoon:Ut(je),nadir:Ut(je-.5)};for(Ot=0,Le=Rt.length;Ot<Le;Ot+=1)Ie=Rt[Ot],Fe=(Ie[0]+Hi)*re,Ge=De(Fe,ii,zi,bt,mn,Yn,pr),Je=je-(Ge-je),st[Ie[1]]=Ut(Je),st[Ie[2]]=Ut(Ge);return st};function Ce(zt){var mt=re*(218.316+13.176396*zt),Nt=re*(134.963+13.064993*zt),Gt=re*(93.272+13.22935*zt),ii=mt+re*6.289*z(Nt),zi=re*5.128*z(Gt),Hi=385001-20905*F(Nt);return{ra:rt(ii,zi),dec:pt(ii,zi),dist:Hi}}et.getMoonPosition=function(zt,mt,Nt){var Gt=re*-Nt,ii=re*mt,zi=ct(zt),Hi=Ce(zi),on=At(zi,Gt)-Hi.ra,mn=Zt(on,ii,Hi.dec),Qe=n(z(on),q(ii)*F(Hi.dec)-z(Hi.dec)*F(on));return mn=mn+It(mn),{azimuth:gi(on,ii,Hi.dec),altitude:mn,distance:Hi.dist,parallacticAngle:Qe}},et.getMoonIllumination=function(zt){var mt=ct(zt||new Date),Nt=tt(mt),Gt=Ce(mt),ii=149598e3,zi=J(z(Nt.dec)*z(Gt.dec)+F(Nt.dec)*F(Gt.dec)*F(Nt.ra-Gt.ra)),Hi=n(ii*z(zi),Gt.dist-ii*F(zi)),on=n(F(Nt.dec)*z(Nt.ra-Gt.ra),z(Nt.dec)*F(Gt.dec)-F(Nt.dec)*z(Gt.dec)*F(Nt.ra-Gt.ra));return{fraction:(1+F(Hi))/2,phase:.5+.5*Hi*(on<0?-1:1)/Math.PI,angle:on}};function Vt(zt,mt){return new Date(zt.valueOf()+mt*ce/24)}et.getMoonTimes=function(zt,mt,Nt,Gt){var ii=new Date(zt);Gt?ii.setUTCHours(0,0,0,0):ii.setHours(0,0,0,0);for(var zi=.133*re,Hi=et.getMoonPosition(ii,mt,Nt).altitude-zi,on,mn,Qe,Yn,pr,bt,je,Ot,Le,Ie,Fe,Ge,Je,st=1;st<=24&&(on=et.getMoonPosition(Vt(ii,st),mt,Nt).altitude-zi,mn=et.getMoonPosition(Vt(ii,st+1),mt,Nt).altitude-zi,pr=(Hi+mn)/2-on,bt=(mn-Hi)/2,je=-bt/(2*pr),Ot=(pr*je+bt)*je+on,Le=bt*bt-4*pr*on,Ie=0,Le>=0&&(Je=Math.sqrt(Le)/(Math.abs(pr)*2),Fe=je-Je,Ge=je+Je,Math.abs(Fe)<=1&&Ie++,Math.abs(Ge)<=1&&Ie++,Fe<-1&&(Fe=Ge)),Ie===1?Hi<0?Qe=st+Fe:Yn=st+Fe:Ie===2&&(Qe=st+(Ot<0?Ge:Fe),Yn=st+(Ot<0?Fe:Ge)),!(Qe&&Yn));st+=2)Hi=mn;var lt={};return Qe&&(lt.rise=Vt(ii,Qe)),Yn&&(lt.set=Vt(ii,Yn)),!Qe&&!Yn&&(lt[Ot>0?"alwaysUp":"alwaysDown"]=!0),lt},v.exports=et})()}(bx)),bx.exports}var wx={exports:{}},Tx={exports:{}},aM;function X0(){return aM||(aM=1,function(v,y){var p=_c(),z=za(),F={material:"MeshBasicMaterial",color:"black",opacity:1};function q(V){var n;V?(V=p._validate(V,F),V.material&&V.material.isMaterial?n=V.material:V.material||V.color||V.opacity?n=new z[V.material]({color:V.color,transparent:V.opacity<1}):n=J(),n.opacity=V.opacity,V.side&&(n.side=V.side)):n=J();function J(){return new z[F.material]({color:F.color})}return n}v.exports=q}(Tx)),Tx.exports}var Mx={exports:{}},lM;function xI(){return lM||(lM=1,function(v,y){const p=za(),z=_c();function F(V){this.map=V,this.enrolledObjects=[],this.previousFrameTime}F.prototype={unenroll:function(V){this.enrolledObjects.splice(this.enrolledObjects.indexOf(V),1)},enroll:function(V){if(V.clock=new p.Clock,V.hasDefaultAnimation=!1,V.defaultAction,V.actions=[],V.mixer,V.animations&&V.animations.length>0){V.hasDefaultAnimation=!0;let re=V.userData.defaultAnimation?V.userData.defaultAnimation:0;V.mixer=new p.AnimationMixer(V),n(re)}function n(re){for(let ce=0;ce<V.animations.length;ce++){re>V.animations.length&&console.log("The animation index "+re+" doesn't exist for this object");let Se=V.animations[ce],Xe=V.mixer.clipAction(Se);V.actions.push(Xe),re===ce?(V.defaultAction=Xe,Xe.setEffectiveWeight(1)):Xe.setEffectiveWeight(0),Xe.play()}}let J=!1;Object.defineProperty(V,"isPlaying",{get(){return J},set(re){J!=re&&(J=re,V.dispatchEvent({type:"IsPlayingChanged",detail:V}))}}),this.enrolledObjects.push(V),V.animationQueue=[],V.set=function(re){if(re.duration>0){let ce={start:Date.now(),expiration:Date.now()+re.duration,endState:{}};z.extend(re,ce);let Se=re.coords,Xe=re.rotation,ht=re.scale||re.scaleX||re.scaleY||re.scaleZ;if(Xe){let ct=V.rotation;re.startRotation=[ct.x,ct.y,ct.z],re.endState.rotation=z.types.rotation(re.rotation,re.startRotation),re.rotationPerMs=re.endState.rotation.map(function(Dt,rt){return(Dt-re.startRotation[rt])/re.duration})}if(ht){let ct=V.scale;re.startScale=[ct.x,ct.y,ct.z],re.endState.scale=z.types.scale(re.scale,re.startScale),re.scalePerMs=re.endState.scale.map(function(Dt,rt){return(Dt-re.startScale[rt])/re.duration})}Se&&(re.pathCurve=new p.CatmullRomCurve3(z.lnglatsToWorld([V.coordinates,re.coords])));let Ut={type:"set",parameters:re};this.animationQueue.push(Ut),tb.map.repaint=!0}else this.stop(),re.rotation=z.radify(re.rotation),this._setObject(re);return this},V.animationMethod=null,V.stop=function(re){return V.mixer&&(V.isPlaying=!1,cancelAnimationFrame(V.animationMethod)),this.animationQueue=[],this},V.followPath=function(re,ce){let Se={type:"followPath",parameters:z._validate(re,q.followPath)};return z.extend(Se.parameters,{pathCurve:new p.CatmullRomCurve3(z.lnglatsToWorld(re.path)),start:Date.now(),expiration:Date.now()+Se.parameters.duration,cb:ce}),this.animationQueue.push(Se),tb.map.repaint=!0,this},V._setObject=function(re){V.setScale();let ce=re.position,Se=re.rotation,Xe=re.scale,ht=re.worldCoordinates,Ut=re.quaternion,ct=re.translate,Dt=re.worldTranslate;if(ce){this.coordinates=ce;let pt=z.projectToWorld(ce);this.position.copy(pt)}if(ct){this.coordinates=[this.coordinates[0]+ct[0],this.coordinates[1]+ct[1],this.coordinates[2]+ct[2]];let pt=z.projectToWorld(ct);this.position.copy(pt),re.position=this.coordinates}if(Dt){this.translateX(Dt.x),this.translateY(Dt.y),this.translateZ(Dt.z);let pt=z.unprojectFromWorld(this.position);this.coordinates=re.position=pt}if(Se&&(this.rotation.set(Se[0],Se[1],Se[2]),re.rotation=new p.Vector3(Se[0],Se[1],Se[2])),Xe&&(this.scale.set(Xe[0],Xe[1],Xe[2]),re.scale=this.scale),Ut&&(this.quaternion.setFromAxisAngle(Ut[0],Ut[1]),re.rotation=Ut[0].multiplyScalar(Ut[1])),ht){this.position.copy(ht);let pt=z.unprojectFromWorld(ht);this.coordinates=re.position=pt}this.setBoundingBoxShadowFloor(),this.setReceiveShadowFloor(),this.updateMatrixWorld(),tb.map.repaint=!0;let rt={type:"ObjectChanged",detail:{object:this,action:{position:re.position,rotation:re.rotation,scale:re.scale}}};this.dispatchEvent(rt)},V.playDefault=function(re){if(V.mixer&&V.hasDefaultAnimation){let ce={start:Date.now(),expiration:Date.now()+re.duration,endState:{}};z.extend(re,ce),V.mixer.timeScale=re.speed||1;let Se={type:"playDefault",parameters:re};return this.animationQueue.push(Se),tb.map.repaint=!0,this}},V.playAnimation=function(re){V.mixer&&(re.animation&&n(re.animation),V.playDefault(re))},V.pauseAllActions=function(){V.mixer&&V.actions.forEach(function(re){re.paused=!0})},V.unPauseAllActions=function(){V.mixer&&V.actions.forEach(function(re){re.paused=!1})},V.deactivateAllActions=function(){V.mixer&&V.actions.forEach(function(re){re.stop()})},V.activateAllActions=function(){V.mixer&&V.actions.forEach(function(re){re.play()})},V.idle=function(){return V.mixer&&V.mixer.update(.01),tb.map.repaint=!0,this}},update:function(V){if(this.previousFrameTime===void 0&&(this.previousFrameTime=V),!this.enrolledObjects)return!1;for(let n=this.enrolledObjects.length-1;n>=0;n--){let J=this.enrolledObjects[n];if(!(!J.animationQueue||J.animationQueue.length===0))for(let re=J.animationQueue.length-1;re>=0;re--){let ce=J.animationQueue[re];if(!ce)continue;let Se=ce.parameters;if(!Se.expiration){J.animationQueue.splice(re,1),J.animationQueue[re]&&(J.animationQueue[re].parameters.start=V);return}if(V>=Se.expiration)Se.expiration=!1,ce.type==="playDefault"?J.stop():(Se.endState&&J._setObject(Se.endState),typeof Se.cb<"u"&&Se.cb());else{let ht=(V-Se.start)/Se.duration;if(ce.type==="set"){let Ut={};Se.pathCurve&&(Ut.worldCoordinates=Se.pathCurve.getPoint(ht)),Se.rotationPerMs&&(Ut.rotation=Se.startRotation.map(function(ct,Dt){return ct+Se.rotationPerMs[Dt]*ht*Se.duration})),Se.scalePerMs&&(Ut.scale=Se.startScale.map(function(ct,Dt){return ct+Se.scalePerMs[Dt]*ht*Se.duration})),J._setObject(Ut)}if(ce.type==="followPath"){let ct={worldCoordinates:Se.pathCurve.getPointAt(ht)};if(Se.trackHeading){let Dt=Se.pathCurve.getTangentAt(ht).normalize(),rt=new p.Vector3(0,0,0),pt=new p.Vector3(0,1,0);rt.crossVectors(pt,Dt).normalize();let gi=Math.acos(pt.dot(Dt));ct.quaternion=[rt,gi]}J._setObject(ct)}ce.type==="playDefault"&&(J.activateAllActions(),J.isPlaying=!0,J.animationMethod=requestAnimationFrame(this.update),J.mixer.update(J.clock.getDelta()),tb.map.repaint=!0)}}}this.previousFrameTime=V}};const q={followPath:{path:null,duration:1e3,trackHeading:!0}};v.exports=F}(Mx)),Mx.exports}var Sx={exports:{}},cM;function Y0(){return cM||(cM=1,function(v,y){const p=za();(function(){class z extends p.Object3D{constructor(Se){super(),this.element=Se||document.createElement("div"),this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.alwaysVisible=!1,Object.defineProperty(this,"layer",{get(){return this.parent&&this.parent.parent?this.parent.parent.layer:null}}),this.dispose=function(){this.remove(),this.element=null},this.remove=function(){this.element instanceof Element&&this.element.parentNode!==null&&this.element.parentNode.removeChild(this.element)},this.addEventListener("removed",function(){this.remove()})}copy(Se,Xe){return super.copy(Se,Xe),this.element=Se.element.cloneNode(!0),this}}z.prototype.isCSS2DObject=!0;const F=new p.Vector3,q=new p.Matrix4,V=new p.Matrix4,n=new p.Vector3,J=new p.Vector3;class re{constructor(){const Se=this;let Xe,ht,Ut,ct;const Dt={objects:new WeakMap,list:new Map};this.cacheList=Dt.list;const rt=document.createElement("div");rt.style.overflow="hidden",this.domElement=rt,this.getSize=function(){return{width:Xe,height:ht}},this.render=function(It,Ye){It.autoUpdate===!0&&It.updateMatrixWorld(),Ye.parent===null&&Ye.updateMatrixWorld(),q.copy(Ye.matrixWorldInverse),V.multiplyMatrices(Ye.projectionMatrix,q),pt(It,It,Ye),At(It)},this.setSize=function(It,Ye){Xe=It,ht=Ye,Ut=Xe/2,ct=ht/2,rt.style.width=It+"px",rt.style.height=Ye+"px"};function pt(It,Ye,ot){if(It.isCSS2DObject)if(!It.visible)Dt.objects.delete({key:It.uuid}),Dt.list.delete(It.uuid),It.remove();else{It.onBeforeRender(Se,Ye,ot),F.setFromMatrixPosition(It.matrixWorld),F.applyMatrix4(V);const et=It.element;var tt;/apple/i.test(navigator.vendor)?tt="translate(-50%,-50%) translate("+Math.round(F.x*Ut+Ut)+"px,"+Math.round(-F.y*ct+ct)+"px)":tt="translate(-50%,-50%) translate("+(F.x*Ut+Ut)+"px,"+(-F.y*ct+ct)+"px)",et.style.WebkitTransform=tt,et.style.MozTransform=tt,et.style.oTransform=tt,et.style.transform=tt,et.style.display=It.visible&&F.z>=-1&&F.z<=1?"":"none";const Rt={distanceToCameraSquared:gi(ot,It)};Dt.objects.set({key:It.uuid},Rt),Dt.list.set(It.uuid,It),et.parentNode!==rt&&rt.appendChild(et),It.onAfterRender(Se,Ye,ot)}for(let et=0,Rt=It.children.length;et<Rt;et++)pt(It.children[et],Ye,ot)}function gi(It,Ye){return n.setFromMatrixPosition(It.matrixWorld),J.setFromMatrixPosition(Ye.matrixWorld),n.distanceToSquared(J)}function Zt(It){const Ye=[];return It.traverse(function(ot){ot.isCSS2DObject&&Ye.push(ot)}),Ye}function At(It){const Ye=Zt(It).sort(function(tt,et){let Rt=Dt.objects.get({key:tt.uuid}),at=Dt.objects.get({key:et.uuid});if(Rt&&at){const _t=Rt.distanceToCameraSquared,Qt=at.distanceToCameraSquared;return _t-Qt}}),ot=Ye.length;for(let tt=0,et=Ye.length;tt<et;tt++)Ye[tt].element.style.zIndex=ot-tt}}}p.CSS2DObject=z,p.CSS2DRenderer=re})(),v.exports={CSS2DRenderer:p.CSS2DRenderer,CSS2DObject:p.CSS2DObject}}(Sx)),Sx.exports}var uM;function Ad(){return uM||(uM=1,function(v,y){const p=_c();X0();const z=za(),F=xI(),q=Y0();function V(){}V.prototype={line:function(n){n=p._validate(n,this._defaults.line);var J=p.lnglatsToWorld(n.geometry),re=p.normalizeVertices(J),ce=p.flattenVectors(re.vertices),Se=new Float32Array(ce),Xe=new z.BufferGeometry;Xe.setAttribute("position",new z.BufferAttribute(Se,3));var ht=new z.LineBasicMaterial({color:16711680,linewidth:21}),Ut=new z.Line(Xe,ht);return Ut.options=options||{},Ut.position.copy(re.position),Ut},extrusion:function(n){},unenroll:function(n,J){var re=this;J||re.animationManager.unenroll(n)},_addMethods:function(n,J){var re=this;const ce="label",Se="tooltip",Xe="help",ht="shadowPlane";if(!J){let rt=function(at,_t,Qt,ae){let be=p.radify(ae);at.position.sub(_t),at.position.applyAxisAngle(Qt,be),at.position.add(_t),at.rotateOnAxis(Qt,be),tb.map.repaint=!0},Rt=function(at){return Math.pow(2,at)};var ct=rt,Dt=Rt;n.coordinates||(n.coordinates=[0,0,0]),Object.defineProperty(n,"model",{get(){return n.getObjectByName("model")}}),Object.defineProperty(n,"animations",{get(){const at=n.model;return at?at.animations:null}}),re.animationManager.enroll(n),n.setCoords=function(at){return n.userData.topMargin&&n.userData.feature&&(at[2]+=((n.userData.feature.properties.height||0)-(n.userData.feature.properties.base_height||n.userData.feature.properties.min_height||0))*(n.userData.topMargin||0)),n.coordinates=at,n.set({position:at}),n},n.setTranslate=function(at){return n.set({translate:at}),n},n.setRotation=function(at){typeof at=="number"&&(at={z:at});var _t={x:p.radify(at.x)||n.rotation.x,y:p.radify(at.y)||n.rotation.y,z:p.radify(at.z)||n.rotation.z};n._setObject({rotation:[_t.x,_t.y,_t.z]})},n.calculateAdjustedPosition=function(at,_t,Qt){let ae=at.slice(),be=p.unprojectFromWorld(n.modelSize);return Qt?(ae[0]-=_t.x!=0?be[0]/_t.x:0,ae[1]-=_t.y!=0?be[1]/_t.y:0,ae[2]-=_t.z!=0?be[2]/_t.z:0):(ae[0]+=_t.x!=0?be[0]/_t.x:0,ae[1]+=_t.y!=0?be[1]/_t.y:0,ae[2]+=_t.z!=0?be[2]/_t.z:0),ae},n.setRotationAxis=function(at){typeof at=="number"&&(at={z:at});let _t=n.modelBox(),Qt=new z.Vector3(_t.max.x,_t.max.y,_t.min.z);at.x!=0&&rt(n,Qt,new z.Vector3(0,0,1),at.x),at.y!=0&&rt(n,Qt,new z.Vector3(0,0,1),at.y),at.z!=0&&rt(n,Qt,new z.Vector3(0,0,1),at.z)},Object.defineProperty(n,"scaleGroup",{get(){return n.getObjectByName("scaleGroup")}}),Object.defineProperty(n,"boxGroup",{get(){return n.getObjectByName("boxGroup")}}),Object.defineProperty(n,"boundingBox",{get(){return n.getObjectByName("boxModel")}}),Object.defineProperty(n,"boundingBoxShadow",{get(){return n.getObjectByName("boxShadow")}}),n.drawBoundingBox=function(){let at=n.box3(),_t=new z.Group;_t.name="boxGroup",_t.updateMatrixWorld(!0);let Qt=new z.Box3Helper(at,V.prototype._defaults.colors.yellow);Qt.name="boxModel",_t.add(Qt),Qt.layers.disable(0);let ae=at.clone();ae.max.z=ae.min.z;let be=new z.Box3Helper(ae,V.prototype._defaults.colors.black);be.name="boxShadow",_t.add(be),be.layers.disable(0),_t.visible=!1,n.scaleGroup.add(_t),n.setBoundingBoxShadowFloor()},n.setBoundingBoxShadowFloor=function(){if(n.boundingBoxShadow){let at=-n.modelHeight,_t=n.rotation,Qt=n.boundingBoxShadow;Qt.box.max.z=Qt.box.min.z=at,Qt.rotation.y=_t.y,Qt.rotation.x=-_t.x}},n.setAnchor=function(at){const _t=n.box3(),Qt=_t.getCenter(new z.Vector3);switch(n.none={x:0,y:0,z:0},n.center={x:Qt.x,y:Qt.y,z:_t.min.z},n.bottom={x:Qt.x,y:_t.max.y,z:_t.min.z},n.bottomLeft={x:_t.max.x,y:_t.max.y,z:_t.min.z},n.bottomRight={x:_t.min.x,y:_t.max.y,z:_t.min.z},n.top={x:Qt.x,y:_t.min.y,z:_t.min.z},n.topLeft={x:_t.max.x,y:_t.min.y,z:_t.min.z},n.topRight={x:_t.min.x,y:_t.min.y,z:_t.min.z},n.left={x:_t.max.x,y:Qt.y,z:_t.min.z},n.right={x:_t.min.x,y:Qt.y,z:_t.min.z},at){case"center":n.anchor=n.center;break;case"top":n.anchor=n.top;break;case"top-left":n.anchor=n.topLeft;break;case"top-right":n.anchor=n.topRight;break;case"left":n.anchor=n.left;break;case"right":n.anchor=n.right;break;case"bottom":n.anchor=n.bottom;break;case"bottom-left":default:n.anchor=n.bottomLeft;break;case"bottom-right":n.anchor=n.bottomRight;break;case"auto":case"none":n.anchor=n.none}n.model.position.set(-n.anchor.x,-n.anchor.y,-n.anchor.z)},n.setCenter=function(at){if(at&&(at.x!=0||at.y!=0||at.z!=0)){let _t=n.getSize();n.anchor={x:n.anchor.x-_t.x*at.x,y:n.anchor.y-_t.y*at.y,z:n.anchor.z-_t.z*at.z},n.model.position.set(-n.anchor.x,-n.anchor.y,-n.anchor.z)}},Object.defineProperty(n,"label",{get(){return n.getObjectByName(ce)}}),Object.defineProperty(n,"tooltip",{get(){return n.getObjectByName(Se)}}),Object.defineProperty(n,"help",{get(){return n.getObjectByName(Xe)}});let pt=!1;Object.defineProperty(n,"hidden",{get(){return pt},set(at){pt!=at&&(pt=at,n.visibility=!pt)}}),Object.defineProperty(n,"visibility",{get(){return n.visible},set(at){let _t=at;if(at=="visible"||at==!0)_t=!0,n.label&&(n.label.visible=_t);else if(at=="none"||at==!1)_t=!1,n.label&&n.label.alwaysVisible&&(n.label.visible=_t),n.tooltip&&(n.tooltip.visible=_t);else return;if(n.visible!=_t){if(n.hidden&&_t)return;n.visible=_t,n.model&&n.model.traverse(function(Qt){(Qt.type=="Mesh"||Qt.type=="SkinnedMesh")&&(_t&&n.raycasted?Qt.layers.enable(0):Qt.layers.disable(0)),Qt.type=="LineSegments"&&Qt.layers.disableAll()})}}}),n.addLabel=function(at,_t,Qt,ae){at&&n.drawLabelHTML(at,_t,Qt,ae)},n.removeLabel=function(){n.removeCSS2D(ce)},n.drawLabelHTML=function(at,_t=!1,Qt=n.anchor,ae=.5){let be=re.drawLabelHTML(at,V.prototype._defaults.label.cssClass),ve=n.addCSS2D(be,ce,Qt,ae);return ve.alwaysVisible=_t,ve.visible=_t,ve},n.addTooltip=function(at,_t,Qt,ae=!0,be=1){let ve=n.addHelp(at,Se,_t,Qt,be);ve.visible=!1,ve.custom=ae},n.removeTooltip=function(){n.removeCSS2D(Se)},n.addHelp=function(at,_t=Xe,Qt=!1,ae=n.anchor,be=0){let ve=re.drawTooltip(at,Qt),De=n.addCSS2D(ve,_t,ae,be);return De.visible=!0,De},n.removeHelp=function(){n.removeCSS2D(Xe)},n.addCSS2D=function(at,_t,Qt=n.anchor,ae=1){if(at){const be=n.box3(),ve=be.getSize(new z.Vector3);let De={x:be.max.x,y:be.max.y,z:be.min.z};n.removeCSS2D(_t);let Ce=new q.CSS2DObject(at);return Ce.name=_t,Ce.position.set(-ve.x*.5-n.model.position.x-Qt.x+De.x,-ve.y*.5-n.model.position.y-Qt.y+De.y,ve.z*ae),Ce.visible=!1,n.scaleGroup.add(Ce),Ce}},n.removeCSS2D=function(at){let _t=n.getObjectByName(at);if(_t){_t.dispose();let Qt=n.scaleGroup.children;Qt.splice(Qt.indexOf(_t),1)}},Object.defineProperty(n,"shadowPlane",{get(){return n.getObjectByName(ht)}});let gi=!1;Object.defineProperty(n,"castShadow",{get(){return gi},set(at){if(!(!n.model||gi===at)){if(n.model.traverse(function(_t){_t.isMesh&&(_t.castShadow=!0)}),at){const _t=n.modelSize,Qt=[_t.x,_t.y,_t.z,n.modelHeight],ae=Math.max(...Qt)*10,be=new z.PlaneBufferGeometry(ae,ae),ve=new z.ShadowMaterial;ve.opacity=.5;let De=new z.Mesh(be,ve);De.name=ht,De.layers.enable(1),De.layers.disable(0),De.receiveShadow=at,n.add(De)}else n.traverse(function(_t){_t.isMesh&&_t.material instanceof z.ShadowMaterial&&n.remove(_t)});gi=at}}}),n.setReceiveShadowFloor=function(){if(n.castShadow){let at=n.shadowPlane,_t=at.position,Qt=at.rotation;if(_t.z=-n.modelHeight,Qt.y=n.rotation.y,Qt.x=-n.rotation.x,n.userData.units==="meters"){const ae=n.modelSize,be=[ae.x,ae.y,ae.z,-_t.z],De=Math.max(...be)*10/at.geometry.parameters.width;at.scale.set(De,De,De)}}};let Zt=!1;Object.defineProperty(n,"receiveShadow",{get(){return Zt},set(at){!n.model||Zt===at||(n.model.traverse(function(_t){_t.isMesh&&(_t.receiveShadow=!0)}),Zt=at)}});let At=!1;Object.defineProperty(n,"wireframe",{get(){return At},set(at){!n.model||At===at||(n.model.traverse(function(_t){if(_t.type=="Mesh"||_t.type=="SkinnedMesh"){let Qt=[];Array.isArray(_t.material)?Qt=_t.material:Qt.push(_t.material);let ae=Qt[0];at?(_t.userData.materials=ae,_t.material=ae.clone(),_t.material.wireframe=_t.material.transparent=at,_t.material.opacity=.3):(_t.material.dispose(),_t.material=_t.userData.materials,_t.userData.materials.dispose(),_t.userData.materials=null),at?(_t.layers.disable(0),_t.layers.enable(1)):(_t.layers.disable(1),_t.layers.enable(0))}_t.type=="LineSegments"&&_t.layers.disableAll()}),At=at,n.dispatchEvent({type:"Wireframed",detail:n}))}});let It=null;Object.defineProperty(n,"color",{get(){return It},set(at){!n.model||It===at||(n.model.traverse(function(_t){if(_t.type=="Mesh"||_t.type=="SkinnedMesh"){let Qt=[];Array.isArray(_t.material)?Qt=_t.material:Qt.push(_t.material);let ae=Qt[0];at?(_t.userData.materials=ae,_t.material=new z.MeshStandardMaterial,_t.material.color.setHex(at)):(_t.material.dispose(),_t.material=_t.userData.materials,_t.userData.materials.dispose(),_t.userData.materials=null)}}),It=at)}});let Ye=!1;Object.defineProperty(n,"selected",{get(){return Ye},set(at){at?(n.userData.bbox&&!n.boundingBox&&n.drawBoundingBox(),n.boxGroup&&(n.boundingBox.material=V.prototype._defaults.materials.boxSelectedMaterial,n.boundingBox.parent.visible=!0,n.boundingBox.layers.enable(1),n.boundingBoxShadow.layers.enable(1)),n.label&&!n.label.alwaysVisible&&(n.label.visible=!0)):(n.boxGroup&&n.remove(n.boxGroup),n.label&&!n.label.alwaysVisible&&(n.label.visible=!1),n.removeHelp()),n.tooltip&&(n.tooltip.visible=at),Ye!=at&&(Ye=at,n.dispatchEvent({type:"SelectedChange",detail:n}))}});let ot=!0;Object.defineProperty(n,"raycasted",{get(){return ot},set(at){!n.model||ot===at||(n.model.traverse(function(_t){(_t.type=="Mesh"||_t.type=="SkinnedMesh")&&(at?(_t.layers.disable(1),_t.layers.enable(0)):(_t.layers.disable(0),_t.layers.enable(1)))}),ot=at)}});let tt=!1;Object.defineProperty(n,"over",{get(){return tt},set(at){at?(n.selected||(n.userData.bbox&&!n.boundingBox&&n.drawBoundingBox(),n.userData.tooltip&&!n.tooltip&&n.addTooltip(n.uuid,!0,n.anchor,!1),n.boxGroup&&(n.boundingBox.material=V.prototype._defaults.materials.boxOverMaterial,n.boundingBox.parent.visible=!0,n.boundingBox.layers.enable(1),n.boundingBoxShadow.layers.enable(1))),n.label&&!n.label.alwaysVisible&&(n.label.visible=!0),n.dispatchEvent({type:"ObjectMouseOver",detail:n})):(n.selected||(n.boxGroup&&(n.remove(n.boxGroup),n.tooltip&&!n.tooltip.custom&&n.removeTooltip()),n.label&&!n.label.alwaysVisible&&(n.label.visible=!1)),n.dispatchEvent({type:"ObjectMouseOut",detail:n})),n.tooltip&&(n.tooltip.visible=at||n.selected),tt=at}}),n.box3=function(){n.updateMatrix(),n.updateMatrixWorld(!0,!0);let at;if(n.model){let _t=n.clone(!0),Qt=n.model.clone();if(at=new z.Box3().setFromObject(Qt),n.parent){let ae=new z.Matrix4,be=new z.Matrix4;n.matrix.extractRotation(ae),be.copy(ae).invert(),_t.setRotationFromMatrix(be),at=new z.Box3().setFromObject(Qt)}}return at},n.modelBox=function(){return n.box3()},n.getSize=function(){return n.box3().getSize(new z.Vector3(0,0,0))};let et=!1;Object.defineProperty(n,"modelSize",{get(){return et=n.getSize(),et},set(at){et!=at&&(et=at)}}),Object.defineProperty(n,"modelHeight",{get(){let at=n.coordinates[2]||0;return n.userData.units==="scene"&&(at*=n.unitsPerMeter/n.scale.x),at}}),Object.defineProperty(n,"unitsPerMeter",{get(){return Number(p.projectedUnitsPerMeter(n.coordinates[1]).toFixed(7))}}),Object.defineProperty(n,"fixedZoom",{get(){return n.userData.fixedZoom},set(at){n.userData.fixedZoom!==at&&(n.userData.fixedZoom=at,n.userData.units=at?"scene":"meters")}}),n.setFixedZoom=function(at){if(n.fixedZoom!=null&&n.fixedZoom!=0){at||(at=n.userData.mapScale);let _t=Rt(n.fixedZoom);if(_t>at){let Qt=_t/at;n.scale.set(Qt,Qt,Qt)}else n.scale.set(1,1,1)}},n.setScale=function(at){if(n.userData.units!="scene"){let _t=n.unitsPerMeter;n.scale.set(_t,_t,_t)}else n.fixedZoom?(at&&(n.userData.mapScale=at),n.setFixedZoom(n.userData.mapScale)):n.scale.set(1,1,1)},n.setObjectScale=function(at){n.setScale(at),n.setBoundingBoxShadowFloor(),n.setReceiveShadowFloor()}}n.add=function(rt){return n.scaleGroup.add(rt),rt.position.z=n.coordinates[2]?-n.coordinates[2]:0,rt},n.remove=function(rt){rt&&(rt.traverse(pt=>{if(pt.geometry&&pt.geometry.dispose(),pt.material)if(pt.material.isMaterial)Ut(pt.material);else for(const gi of pt.material)Ut(gi);pt.dispose&&pt.dispose()}),n.scaleGroup.remove(rt),tb.map.repaint=!0)},n.duplicate=function(rt){let pt=n.clone(!0);if(pt.getObjectByName("model").animations=n.animations,pt.userData.feature&&(rt&&rt.feature&&(pt.userData.feature=rt.feature),pt.userData.feature.properties.uuid=pt.uuid),re._addMethods(pt),!rt||p.equal(rt.scale,n.userData.scale))return pt.copyAnchor(n),pt;{pt.userData=rt,pt.userData.isGeoGroup=!0,pt.remove(pt.boxGroup);const gi=p.types.rotation(rt.rotation,[0,0,0]),Zt=p.types.scale(rt.scale,[1,1,1]);return pt.model.position.set(0,0,0),pt.model.rotation.set(gi[0],gi[1],gi[2]),pt.model.scale.set(Zt[0],Zt[1],Zt[2]),pt.setAnchor(rt.anchor),pt.setCenter(rt.adjustment),pt}},n.copyAnchor=function(rt){n.anchor=rt.anchor,n.none={x:0,y:0,z:0},n.center=rt.center,n.bottom=rt.bottom,n.bottomLeft=rt.bottomLeft,n.bottomRight=rt.bottomRight,n.top=rt.top,n.topLeft=rt.topLeft,n.topRight=rt.topRight,n.left=rt.left,n.right=rt.right},n.dispose=function(){V.prototype.unenroll(n),n.traverse(rt=>{if(!(rt.parent&&rt.parent.name=="world")&&rt.name!=="threeboxObject"){if(rt.geometry&&rt.geometry.dispose(),rt.material)if(rt.material.isMaterial)Ut(rt.material);else for(const pt of rt.material)Ut(pt);rt.dispose&&rt.dispose()}}),n.children=[]};const Ut=rt=>{rt.dispose();for(const Zt of Object.keys(rt)){const At=rt[Zt];At&&typeof At=="object"&&"minFilter"in At&&At.dispose()}let pt=rt;(pt.map||pt.alphaMap||pt.aoMap||pt.bumpMap||pt.displacementMap||pt.emissiveMap||pt.envMap||pt.lightMap||pt.metalnessMap||pt.normalMap||pt.roughnessMap)&&(pt.map&&pt.map.dispose(),pt.alphaMap&&pt.alphaMap.dispose(),pt.aoMap&&pt.aoMap.dispose(),pt.bumpMap&&pt.bumpMap.dispose(),pt.displacementMap&&pt.displacementMap.dispose(),pt.emissiveMap&&pt.emissiveMap.dispose(),pt.envMap&&pt.envMap.dispose(),pt.lightMap&&pt.lightMap.dispose(),pt.metalnessMap&&pt.metalnessMap.dispose(),pt.normalMap&&pt.normalMap.dispose(),pt.roughnessMap&&pt.roughnessMap.dispose())};return n},_makeGroup:function(n,J){let re=new z.Group;re.name="scaleGroup",re.add(n);var ce=new z.Group;ce.userData=J||{},ce.userData.isGeoGroup=!0,ce.userData.feature&&(ce.userData.feature.properties.uuid=ce.uuid);var Se=re.length;if(Se)for(o of re)ce.add(o);else ce.add(re);return ce.name="threeboxObject",ce},animationManager:new F,drawTooltip:function(n,J=!1){if(n){let re;if(J){let ce=document.createElement("div");ce.className="mapboxgl-popup-content";let Se=document.createElement("strong");Se.innerHTML=n,ce.appendChild(Se);let Xe=document.createElement("div");Xe.className="mapboxgl-popup-tip";let ht=document.createElement("div");ht.className="marker mapboxgl-popup-anchor-bottom",ht.appendChild(Xe),ht.appendChild(ce),re=document.createElement("div"),re.className+="label3D",re.appendChild(ht)}else re=document.createElement("span"),re.className=this._defaults.tooltip.cssClass,re.innerHTML=n;return re}},drawLabelHTML:function(n,J){let re=document.createElement("div");return re.className+=J,typeof n=="string"?re.innerHTML=n:re.innerHTML=n.outerHTML,re},_defaults:{colors:{red:new z.Color(16711680),yellow:new z.Color(16776960),green:new z.Color(65280),black:new z.Color(0)},materials:{boxNormalMaterial:new z.LineBasicMaterial({color:new z.Color(16711680)}),boxOverMaterial:new z.LineBasicMaterial({color:new z.Color(16776960)}),boxSelectedMaterial:new z.LineBasicMaterial({color:new z.Color(65280)})},line:{geometry:null,color:"black",width:1,opacity:1},label:{htmlElement:null,cssClass:" label3D",alwaysVisible:!1,topMargin:-.5},tooltip:{text:"",cssClass:"toolTip text-xs",mapboxStyle:!1,topMargin:0},sphere:{position:[0,0,0],radius:1,sides:20,units:"scene",material:"MeshBasicMaterial",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},tube:{geometry:null,radius:1,sides:6,units:"scene",material:"MeshBasicMaterial",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0},loadObj:{type:null,obj:null,units:"scene",scale:1,rotation:0,defaultAnimation:0,anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0,clone:!0},Object3D:{obj:null,units:"scene",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},extrusion:{coordinates:[[[]]],geometryOptions:{},height:100,materials:new z.MeshPhongMaterial({color:6684672,side:z.DoubleSide}),scale:1,rotation:0,units:"scene",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0}},geometries:{line:["LineString"],tube:["LineString"],sphere:["Point"]}},v.exports=V}(wx)),wx.exports}var Ex={exports:{}},Ax={exports:{}},hM;function K0(){return hM||(hM=1,function(v,y){const p=Ad(),z=_c();function F(q){q=z._validate(q,p.prototype._defaults.Object3D);let V=q.obj;const n=z.types.rotation(q.rotation,[0,0,0]),J=z.types.scale(q.scale,[1,1,1]);V.rotation.set(n[0],n[1],n[2]),V.scale.set(J[0],J[1],J[2]),V.name="model";let re=p.prototype._makeGroup(V,q);return q.obj.name="model",p.prototype._addMethods(re),re.setAnchor(q.anchor),re.setCenter(q.adjustment),re.raycasted=q.raycasted,re.visibility=!0,re}v.exports=F}(Ax)),Ax.exports}var dM;function bI(){return dM||(dM=1,function(v,y){const p=_c(),z=X0(),F=za(),q=Ad(),V=K0();function n(J){J=p._validate(J,q.prototype._defaults.sphere);let re=new F.SphereBufferGeometry(J.radius,J.sides,J.sides),ce=z(J),Se=new F.Mesh(re,ce);return new V({obj:Se,units:J.units,anchor:J.anchor,adjustment:J.adjustment,bbox:J.bbox,tooltip:J.tooltip,raycasted:J.raycasted})}v.exports=n}(Ex)),Ex.exports}var Cx={exports:{}},pM;function wI(){return pM||(pM=1,function(v,y){const p=Ad(),z=_c(),F=za(),q=K0();function V(n){n=z._validate(n,p.prototype._defaults.extrusion);let J=V.prototype.buildShape(n.coordinates),re=V.prototype.buildGeometry(J,n.geometryOptions),ce=new F.Mesh(re,n.materials);return n.obj=ce,new q(n)}V.prototype={buildShape:function(n){if(n[0]instanceof(F.Vector2||F.Vector3))return new F.Shape(n);let J=new F.Shape;for(let re=0;re<n.length;re++)re===0?J=new F.Shape(this.buildPoints(n[0],n[0])):J.holes.push(new F.Path(this.buildPoints(n[re],n[0])));return J},buildPoints:function(n,J){const re=[];let ce=z.projectToWorld([J[0][0],J[0][1],0]);for(let Se=0;Se<n.length;Se++){let Xe=z.projectToWorld([n[Se][0],n[Se][1],0]);re.push(new F.Vector2(z.toDecimal(Xe.x-ce.x,9),z.toDecimal(Xe.y-ce.y,9)))}return re},buildGeometry:function(n,J){let re=new F.ExtrudeBufferGeometry(n,J);return re.computeBoundingBox(),re}},v.exports=V}(Cx)),Cx.exports}var Lx={exports:{}},fM;function TI(){return fM||(fM=1,function(v,y){const p=_c(),z=Ad(),F=Y0();function q(V){V=p._validate(V,z.prototype._defaults.label);let n=z.prototype.drawLabelHTML(V.htmlElement,V.cssClass),J=new F.CSS2DObject(n);J.name="label",J.visible=V.alwaysVisible,J.alwaysVisible=V.alwaysVisible;var re=z.prototype._makeGroup(J,V);return z.prototype._addMethods(re),re.visibility=V.alwaysVisible,re}v.exports=q}(Lx)),Lx.exports}var Ix={exports:{}},mM;function MI(){return mM||(mM=1,function(v,y){const p=_c(),z=Ad(),F=Y0();za();function q(V){if(V=p._validate(V,z.prototype._defaults.tooltip),V.text){let J=z.prototype.drawTooltip(V.text,V.mapboxStyle),re=new F.CSS2DObject(J);re.visible=!1,re.name="tooltip";var n=z.prototype._makeGroup(re,V);return z.prototype._addMethods(n),n}}v.exports=q}(Ix)),Ix.exports}var Rx={exports:{}},Px={exports:{}},gM;function SI(){return gM||(gM=1,function(v,y){const p=za();(function(){const z=/^[og]\s*(.+)?/,F=/^mtllib /,q=/^usemtl /,V=/^usemap /,n=new p.Vector3,J=new p.Vector3,re=new p.Vector3,ce=new p.Vector3,Se=new p.Vector3;function Xe(){const Ut={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(ct,Dt){if(this.object&&this.object.fromDeclaration===!1){this.object.name=ct,this.object.fromDeclaration=Dt!==!1;return}const rt=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:ct||"",fromDeclaration:Dt!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(pt,gi){const Zt=this._finalize(!1);Zt&&(Zt.inherited||Zt.groupCount<=0)&&this.materials.splice(Zt.index,1);const At={index:this.materials.length,name:pt||"",mtllib:Array.isArray(gi)&&gi.length>0?gi[gi.length-1]:"",smooth:Zt!==void 0?Zt.smooth:this.smooth,groupStart:Zt!==void 0?Zt.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(It){const Ye={index:typeof It=="number"?It:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return Ye.clone=this.clone.bind(Ye),Ye}};return this.materials.push(At),At},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(pt){const gi=this.currentMaterial();if(gi&&gi.groupEnd===-1&&(gi.groupEnd=this.geometry.vertices.length/3,gi.groupCount=gi.groupEnd-gi.groupStart,gi.inherited=!1),pt&&this.materials.length>1)for(let Zt=this.materials.length-1;Zt>=0;Zt--)this.materials[Zt].groupCount<=0&&this.materials.splice(Zt,1);return pt&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),gi}},rt&&rt.name&&typeof rt.clone=="function"){const pt=rt.clone(0);pt.inherited=!0,this.object.materials.push(pt)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(ct,Dt){const rt=parseInt(ct,10);return(rt>=0?rt-1:rt+Dt/3)*3},parseNormalIndex:function(ct,Dt){const rt=parseInt(ct,10);return(rt>=0?rt-1:rt+Dt/3)*3},parseUVIndex:function(ct,Dt){const rt=parseInt(ct,10);return(rt>=0?rt-1:rt+Dt/2)*2},addVertex:function(ct,Dt,rt){const pt=this.vertices,gi=this.object.geometry.vertices;gi.push(pt[ct+0],pt[ct+1],pt[ct+2]),gi.push(pt[Dt+0],pt[Dt+1],pt[Dt+2]),gi.push(pt[rt+0],pt[rt+1],pt[rt+2])},addVertexPoint:function(ct){const Dt=this.vertices;this.object.geometry.vertices.push(Dt[ct+0],Dt[ct+1],Dt[ct+2])},addVertexLine:function(ct){const Dt=this.vertices;this.object.geometry.vertices.push(Dt[ct+0],Dt[ct+1],Dt[ct+2])},addNormal:function(ct,Dt,rt){const pt=this.normals,gi=this.object.geometry.normals;gi.push(pt[ct+0],pt[ct+1],pt[ct+2]),gi.push(pt[Dt+0],pt[Dt+1],pt[Dt+2]),gi.push(pt[rt+0],pt[rt+1],pt[rt+2])},addFaceNormal:function(ct,Dt,rt){const pt=this.vertices,gi=this.object.geometry.normals;n.fromArray(pt,ct),J.fromArray(pt,Dt),re.fromArray(pt,rt),Se.subVectors(re,J),ce.subVectors(n,J),Se.cross(ce),Se.normalize(),gi.push(Se.x,Se.y,Se.z),gi.push(Se.x,Se.y,Se.z),gi.push(Se.x,Se.y,Se.z)},addColor:function(ct,Dt,rt){const pt=this.colors,gi=this.object.geometry.colors;pt[ct]!==void 0&&gi.push(pt[ct+0],pt[ct+1],pt[ct+2]),pt[Dt]!==void 0&&gi.push(pt[Dt+0],pt[Dt+1],pt[Dt+2]),pt[rt]!==void 0&&gi.push(pt[rt+0],pt[rt+1],pt[rt+2])},addUV:function(ct,Dt,rt){const pt=this.uvs,gi=this.object.geometry.uvs;gi.push(pt[ct+0],pt[ct+1]),gi.push(pt[Dt+0],pt[Dt+1]),gi.push(pt[rt+0],pt[rt+1])},addDefaultUV:function(){const ct=this.object.geometry.uvs;ct.push(0,0),ct.push(0,0),ct.push(0,0)},addUVLine:function(ct){const Dt=this.uvs;this.object.geometry.uvs.push(Dt[ct+0],Dt[ct+1])},addFace:function(ct,Dt,rt,pt,gi,Zt,At,It,Ye){const ot=this.vertices.length;let tt=this.parseVertexIndex(ct,ot),et=this.parseVertexIndex(Dt,ot),Rt=this.parseVertexIndex(rt,ot);if(this.addVertex(tt,et,Rt),this.addColor(tt,et,Rt),At!==void 0&&At!==""){const at=this.normals.length;tt=this.parseNormalIndex(At,at),et=this.parseNormalIndex(It,at),Rt=this.parseNormalIndex(Ye,at),this.addNormal(tt,et,Rt)}else this.addFaceNormal(tt,et,Rt);if(pt!==void 0&&pt!==""){const at=this.uvs.length;tt=this.parseUVIndex(pt,at),et=this.parseUVIndex(gi,at),Rt=this.parseUVIndex(Zt,at),this.addUV(tt,et,Rt),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(ct){this.object.geometry.type="Points";const Dt=this.vertices.length;for(let rt=0,pt=ct.length;rt<pt;rt++){const gi=this.parseVertexIndex(ct[rt],Dt);this.addVertexPoint(gi),this.addColor(gi)}},addLineGeometry:function(ct,Dt){this.object.geometry.type="Line";const rt=this.vertices.length,pt=this.uvs.length;for(let gi=0,Zt=ct.length;gi<Zt;gi++)this.addVertexLine(this.parseVertexIndex(ct[gi],rt));for(let gi=0,Zt=Dt.length;gi<Zt;gi++)this.addUVLine(this.parseUVIndex(Dt[gi],pt))}};return Ut.startObject("",!1),Ut}class ht extends p.Loader{constructor(ct){super(ct),this.materials=null}load(ct,Dt,rt,pt){const gi=this,Zt=new p.FileLoader(this.manager);Zt.setPath(this.path),Zt.setRequestHeader(this.requestHeader),Zt.setWithCredentials(this.withCredentials),Zt.load(ct,function(At){try{Dt(gi.parse(At))}catch(It){pt?pt(It):console.error(It),gi.manager.itemError(ct)}},rt,pt)}setMaterials(ct){return this.materials=ct,this}parse(ct){const Dt=new Xe;ct.indexOf(`\r
`)!==-1&&(ct=ct.replace(/\r\n/g,`
`)),ct.indexOf(`\\
`)!==-1&&(ct=ct.replace(/\\\n/g,""));const rt=ct.split(`
`);let pt="",gi="",Zt=0,At=[];const It=typeof"".trimLeft=="function";for(let tt=0,et=rt.length;tt<et;tt++)if(pt=rt[tt],pt=It?pt.trimLeft():pt.trim(),Zt=pt.length,Zt!==0&&(gi=pt.charAt(0),gi!=="#"))if(gi==="v"){const Rt=pt.split(/\s+/);switch(Rt[0]){case"v":Dt.vertices.push(parseFloat(Rt[1]),parseFloat(Rt[2]),parseFloat(Rt[3])),Rt.length>=7?Dt.colors.push(parseFloat(Rt[4]),parseFloat(Rt[5]),parseFloat(Rt[6])):Dt.colors.push(void 0,void 0,void 0);break;case"vn":Dt.normals.push(parseFloat(Rt[1]),parseFloat(Rt[2]),parseFloat(Rt[3]));break;case"vt":Dt.uvs.push(parseFloat(Rt[1]),parseFloat(Rt[2]));break}}else if(gi==="f"){const at=pt.substr(1).trim().split(/\s+/),_t=[];for(let ae=0,be=at.length;ae<be;ae++){const ve=at[ae];if(ve.length>0){const De=ve.split("/");_t.push(De)}}const Qt=_t[0];for(let ae=1,be=_t.length-1;ae<be;ae++){const ve=_t[ae],De=_t[ae+1];Dt.addFace(Qt[0],ve[0],De[0],Qt[1],ve[1],De[1],Qt[2],ve[2],De[2])}}else if(gi==="l"){const Rt=pt.substring(1).trim().split(" ");let at=[];const _t=[];if(pt.indexOf("/")===-1)at=Rt;else for(let Qt=0,ae=Rt.length;Qt<ae;Qt++){const be=Rt[Qt].split("/");be[0]!==""&&at.push(be[0]),be[1]!==""&&_t.push(be[1])}Dt.addLineGeometry(at,_t)}else if(gi==="p"){const at=pt.substr(1).trim().split(" ");Dt.addPointGeometry(at)}else if((At=z.exec(pt))!==null){const Rt=(" "+At[0].substr(1).trim()).substr(1);Dt.startObject(Rt)}else if(q.test(pt))Dt.object.startMaterial(pt.substring(7).trim(),Dt.materialLibraries);else if(F.test(pt))Dt.materialLibraries.push(pt.substring(7).trim());else if(V.test(pt))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(gi==="s"){if(At=pt.split(" "),At.length>1){const at=At[1].trim().toLowerCase();Dt.object.smooth=at!=="0"&&at!=="off"}else Dt.object.smooth=!0;const Rt=Dt.object.currentMaterial();Rt&&(Rt.smooth=Dt.object.smooth)}else{if(pt==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+pt+'"')}Dt.finalize();const Ye=new p.Group;if(Ye.materialLibraries=[].concat(Dt.materialLibraries),!(Dt.objects.length===1&&Dt.objects[0].geometry.vertices.length===0)===!0)for(let tt=0,et=Dt.objects.length;tt<et;tt++){const Rt=Dt.objects[tt],at=Rt.geometry,_t=Rt.materials,Qt=at.type==="Line",ae=at.type==="Points";let be=!1;if(at.vertices.length===0)continue;const ve=new p.BufferGeometry;ve.setAttribute("position",new p.Float32BufferAttribute(at.vertices,3)),at.normals.length>0&&ve.setAttribute("normal",new p.Float32BufferAttribute(at.normals,3)),at.colors.length>0&&(be=!0,ve.setAttribute("color",new p.Float32BufferAttribute(at.colors,3))),at.hasUVIndices===!0&&ve.setAttribute("uv",new p.Float32BufferAttribute(at.uvs,2));const De=[];for(let Vt=0,zt=_t.length;Vt<zt;Vt++){const mt=_t[Vt],Nt=mt.name+"_"+mt.smooth+"_"+be;let Gt=Dt.materials[Nt];if(this.materials!==null){if(Gt=this.materials.create(mt.name),Qt&&Gt&&!(Gt instanceof p.LineBasicMaterial)){const ii=new p.LineBasicMaterial;p.Material.prototype.copy.call(ii,Gt),ii.color.copy(Gt.color),Gt=ii}else if(ae&&Gt&&!(Gt instanceof p.PointsMaterial)){const ii=new p.PointsMaterial({size:10,sizeAttenuation:!1});p.Material.prototype.copy.call(ii,Gt),ii.color.copy(Gt.color),ii.map=Gt.map,Gt=ii}}Gt===void 0&&(Qt?Gt=new p.LineBasicMaterial:ae?Gt=new p.PointsMaterial({size:1,sizeAttenuation:!1}):Gt=new p.MeshPhongMaterial,Gt.name=mt.name,Gt.flatShading=!mt.smooth,Gt.vertexColors=be,Dt.materials[Nt]=Gt),De.push(Gt)}let Ce;if(De.length>1){for(let Vt=0,zt=_t.length;Vt<zt;Vt++){const mt=_t[Vt];ve.addGroup(mt.groupStart,mt.groupCount,Vt)}Qt?Ce=new p.LineSegments(ve,De):ae?Ce=new p.Points(ve,De):Ce=new p.Mesh(ve,De)}else Qt?Ce=new p.LineSegments(ve,De[0]):ae?Ce=new p.Points(ve,De[0]):Ce=new p.Mesh(ve,De[0]);Ce.name=Rt.name,Ye.add(Ce)}else if(Dt.vertices.length>0){const tt=new p.PointsMaterial({size:1,sizeAttenuation:!1}),et=new p.BufferGeometry;et.setAttribute("position",new p.Float32BufferAttribute(Dt.vertices,3)),Dt.colors.length>0&&Dt.colors[0]!==void 0&&(et.setAttribute("color",new p.Float32BufferAttribute(Dt.colors,3)),tt.vertexColors=!0);const Rt=new p.Points(et,tt);Ye.add(Rt)}return Ye}}p.OBJLoader=ht})(),v.exports=p.OBJLoader}(Px)),Px.exports}var Dx={exports:{}},_M;function EI(){return _M||(_M=1,function(v,y){const p=za();(function(){class z extends p.Loader{constructor(V){super(V)}load(V,n,J,re){const ce=this,Se=this.path===""?p.LoaderUtils.extractUrlBase(V||""):this.path,Xe=new p.FileLoader(this.manager);Xe.setPath(this.path),Xe.setRequestHeader(this.requestHeader),Xe.setWithCredentials(this.withCredentials),Xe.load(V,function(ht){try{n(ce.parse(ht,Se))}catch(Ut){re?re(Ut):console.error(Ut),ce.manager.itemError(V)}},J,re)}setMaterialOptions(V){return this.materialOptions=V,this}parse(V,n){const J=V.split(`
`);let re={};const ce=/\s+/,Se={};for(let ht=0;ht<J.length;ht++){let Ut=J[ht];if(Ut=Ut.trim(),Ut.length===0||Ut.charAt(0)==="#")continue;const ct=Ut.indexOf(" ");let Dt=ct>=0?Ut.substring(0,ct):Ut;Dt=Dt.toLowerCase();let rt=ct>=0?Ut.substring(ct+1):"";if(rt=rt.trim(),Dt==="newmtl")re={name:rt},Se[rt]=re;else if(Dt==="ka"||Dt==="kd"||Dt==="ks"||Dt==="ke"){const pt=rt.split(ce,3);re[Dt]=[parseFloat(pt[0]),parseFloat(pt[1]),parseFloat(pt[2])]}else re[Dt]=rt}const Xe=new F(this.resourcePath||n,this.materialOptions);return Xe.setCrossOrigin(this.crossOrigin),Xe.setManager(this.manager),Xe.setMaterials(Se),Xe}}class F{constructor(V="",n={}){this.baseUrl=V,this.options=n,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:p.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:p.RepeatWrapping}setCrossOrigin(V){return this.crossOrigin=V,this}setManager(V){this.manager=V}setMaterials(V){this.materialsInfo=this.convert(V),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(V){if(!this.options)return V;const n={};for(const J in V){const re=V[J],ce={};n[J]=ce;for(const Se in re){let Xe=!0,ht=re[Se];const Ut=Se.toLowerCase();switch(Ut){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(ht=[ht[0]/255,ht[1]/255,ht[2]/255]),this.options&&this.options.ignoreZeroRGBs&&ht[0]===0&&ht[1]===0&&ht[2]===0&&(Xe=!1);break}Xe&&(ce[Ut]=ht)}}return n}preload(){for(const V in this.materialsInfo)this.create(V)}getIndex(V){return this.nameLookup[V]}getAsArray(){let V=0;for(const n in this.materialsInfo)this.materialsArray[V]=this.create(n),this.nameLookup[n]=V,V++;return this.materialsArray}create(V){return this.materials[V]===void 0&&this.createMaterial_(V),this.materials[V]}createMaterial_(V){const n=this,J=this.materialsInfo[V],re={name:V,side:this.side};function ce(Xe,ht){return typeof ht!="string"||ht===""?"":/^https?:\/\//i.test(ht)?ht:Xe+ht}function Se(Xe,ht){if(re[Xe])return;const Ut=n.getTextureParams(ht,re),ct=n.loadTexture(ce(n.baseUrl,Ut.url));ct.repeat.copy(Ut.scale),ct.offset.copy(Ut.offset),ct.wrapS=n.wrap,ct.wrapT=n.wrap,re[Xe]=ct}for(const Xe in J){const ht=J[Xe];let Ut;if(ht!=="")switch(Xe.toLowerCase()){case"kd":re.color=new p.Color().fromArray(ht);break;case"ks":re.specular=new p.Color().fromArray(ht);break;case"ke":re.emissive=new p.Color().fromArray(ht);break;case"map_kd":Se("map",ht);break;case"map_ks":Se("specularMap",ht);break;case"map_ke":Se("emissiveMap",ht);break;case"norm":Se("normalMap",ht);break;case"map_bump":case"bump":Se("bumpMap",ht);break;case"map_d":Se("alphaMap",ht),re.transparent=!0;break;case"ns":re.shininess=parseFloat(ht);break;case"d":Ut=parseFloat(ht),Ut<1&&(re.opacity=Ut,re.transparent=!0);break;case"tr":Ut=parseFloat(ht),this.options&&this.options.invertTrProperty&&(Ut=1-Ut),Ut>0&&(re.opacity=1-Ut,re.transparent=!0);break}}return this.materials[V]=new p.MeshPhongMaterial(re),this.materials[V]}getTextureParams(V,n){const J={scale:new p.Vector2(1,1),offset:new p.Vector2(0,0)},re=V.split(/\s+/);let ce;return ce=re.indexOf("-bm"),ce>=0&&(n.bumpScale=parseFloat(re[ce+1]),re.splice(ce,2)),ce=re.indexOf("-s"),ce>=0&&(J.scale.set(parseFloat(re[ce+1]),parseFloat(re[ce+2])),re.splice(ce,4)),ce=re.indexOf("-o"),ce>=0&&(J.offset.set(parseFloat(re[ce+1]),parseFloat(re[ce+2])),re.splice(ce,4)),J.url=re.join(" ").trim(),J}loadTexture(V,n,J,re,ce){const Se=this.manager!==void 0?this.manager:p.DefaultLoadingManager;let Xe=Se.getHandler(V);Xe===null&&(Xe=new p.TextureLoader(Se)),Xe.setCrossOrigin&&Xe.setCrossOrigin(this.crossOrigin);const ht=Xe.load(V,J,re,ce);return n!==void 0&&(ht.mapping=n),ht}}p.MTLLoader=z})(),v.exports=p.MTLLoader}(Dx)),Dx.exports}var Ox={exports:{}},o0={exports:{}};/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
*/var yM;function AI(){return yM||(yM=1,function(v,y){(function(p){v.exports=p()})(function(){var p={};p.__esModule=!0;var z=function(Ae){var Te;try{Te("require('worker_threads')").Worker}catch{}return y.default=function(Ve,Pt,Ai,Ui,bi){setImmediate(function(){return bi(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var Yi=function(){};return{terminate:Yi,postMessage:Yi}},Ae}({}),F=Uint8Array,q=Uint16Array,V=Uint32Array,n=new F([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),J=new F([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),re=new F([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ce=function(Ae,Te){for(var Ve=new q(31),Pt=0;Pt<31;++Pt)Ve[Pt]=Te+=1<<Ae[Pt-1];var Ai=new V(Ve[30]);for(Pt=1;Pt<30;++Pt)for(var Ui=Ve[Pt];Ui<Ve[Pt+1];++Ui)Ai[Ui]=Ui-Ve[Pt]<<5|Pt;return[Ve,Ai]},Se=ce(n,2),Xe=Se[0],ht=Se[1];Xe[28]=258,ht[258]=28;for(var Ut=ce(J,0),ct=Ut[0],Dt=Ut[1],rt=new q(32768),pt=0;pt<32768;++pt){var gi=(43690&pt)>>>1|(21845&pt)<<1;rt[pt]=((65280&(gi=(61680&(gi=(52428&gi)>>>2|(13107&gi)<<2))>>>4|(3855&gi)<<4))>>>8|(255&gi)<<8)>>>1}var Zt=function(Ae,Te,Ve){for(var Pt=Ae.length,Ai=0,Ui=new q(Te);Ai<Pt;++Ai)++Ui[Ae[Ai]-1];var bi,Yi=new q(Te);for(Ai=0;Ai<Te;++Ai)Yi[Ai]=Yi[Ai-1]+Ui[Ai-1]<<1;if(Ve){bi=new q(1<<Te);var fe=15-Te;for(Ai=0;Ai<Pt;++Ai)if(Ae[Ai])for(var me=Ai<<4|Ae[Ai],Ee=Te-Ae[Ai],We=Yi[Ae[Ai]-1]++<<Ee,Pe=We|(1<<Ee)-1;We<=Pe;++We)bi[rt[We]>>>fe]=me}else for(bi=new q(Pt),Ai=0;Ai<Pt;++Ai)Ae[Ai]&&(bi[Ai]=rt[Yi[Ae[Ai]-1]++]>>>15-Ae[Ai]);return bi},At=new F(288);for(pt=0;pt<144;++pt)At[pt]=8;for(pt=144;pt<256;++pt)At[pt]=9;for(pt=256;pt<280;++pt)At[pt]=7;for(pt=280;pt<288;++pt)At[pt]=8;var It=new F(32);for(pt=0;pt<32;++pt)It[pt]=5;var Ye=Zt(At,9,0),ot=Zt(At,9,1),tt=Zt(It,5,0),et=Zt(It,5,1),Rt=function(Ae){for(var Te=Ae[0],Ve=1;Ve<Ae.length;++Ve)Ae[Ve]>Te&&(Te=Ae[Ve]);return Te},at=function(Ae,Te,Ve){var Pt=Te/8|0;return(Ae[Pt]|Ae[Pt+1]<<8)>>(7&Te)&Ve},_t=function(Ae,Te){var Ve=Te/8|0;return(Ae[Ve]|Ae[Ve+1]<<8|Ae[Ve+2]<<16)>>(7&Te)},Qt=function(Ae){return(Ae/8|0)+(7&Ae&&1)},ae=function(Ae,Te,Ve){(Te==null||Te<0)&&(Te=0),(Ve==null||Ve>Ae.length)&&(Ve=Ae.length);var Pt=new(Ae instanceof q?q:Ae instanceof V?V:F)(Ve-Te);return Pt.set(Ae.subarray(Te,Ve)),Pt},be=function(Ae,Te,Ve){var Pt=Ae.length;if(!Pt||Ve&&!Ve.l&&Pt<5)return Te||new F(0);var Ai=!Te||Ve,Ui=!Ve||Ve.i;Ve||(Ve={}),Te||(Te=new F(3*Pt));var bi=function(Yo){var Un=Te.length;if(Yo>Un){var dl=new F(Math.max(2*Un,Yo));dl.set(Te),Te=dl}},Yi=Ve.f||0,fe=Ve.p||0,me=Ve.b||0,Ee=Ve.l,We=Ve.d,Pe=Ve.m,li=Ve.n,Mi=8*Pt;do{if(!Ee){Ve.f=Yi=at(Ae,fe,1);var Wi=at(Ae,fe+1,3);if(fe+=3,!Wi){var hn=Ae[(_r=Qt(fe)+4)-4]|Ae[_r-3]<<8,Dn=_r+hn;if(Dn>Pt){if(Ui)throw"unexpected EOF";break}Ai&&bi(me+hn),Te.set(Ae.subarray(_r,Dn),me),Ve.b=me+=hn,Ve.p=fe=8*Dn;continue}if(Wi==1)Ee=ot,We=et,Pe=9,li=5;else{if(Wi!=2)throw"invalid block type";var Zi=at(Ae,fe,31)+257,Kt=at(Ae,fe+10,15)+4,nn=Zi+at(Ae,fe+5,31)+1;fe+=14;for(var Ei=new F(nn),Ln=new F(19),Vi=0;Vi<Kt;++Vi)Ln[re[Vi]]=at(Ae,fe+3*Vi,7);fe+=3*Kt;var fn=Rt(Ln),cr=(1<<fn)-1;if(!Ui&&fe+nn*(fn+7)>Mi)break;var gr=Zt(Ln,fn,1);for(Vi=0;Vi<nn;){var _r,Rr=gr[at(Ae,fe,cr)];if(fe+=15&Rr,(_r=Rr>>>4)<16)Ei[Vi++]=_r;else{var ur=0,wn=0;for(_r==16?(wn=3+at(Ae,fe,3),fe+=2,ur=Ei[Vi-1]):_r==17?(wn=3+at(Ae,fe,7),fe+=3):_r==18&&(wn=11+at(Ae,fe,127),fe+=7);wn--;)Ei[Vi++]=ur}}var ws=Ei.subarray(0,Zi),wr=Ei.subarray(Zi);Pe=Rt(ws),li=Rt(wr),Ee=Zt(ws,Pe,1),We=Zt(wr,li,1)}if(fe>Mi)throw"unexpected EOF"}Ai&&bi(me+131072);for(var Vs=(1<<Pe)-1,Or=(1<<li)-1,ro=Pe+li+18;Ui||fe+ro<Mi;){var to=(ur=Ee[_t(Ae,fe)&Vs])>>>4;if((fe+=15&ur)>Mi)throw"unexpected EOF";if(!ur)throw"invalid length/literal";if(to<256)Te[me++]=to;else{if(to==256){Ee=null;break}var Xs=to-254;to>264&&(Xs=at(Ae,fe,(1<<(hs=n[Vi=to-257]))-1)+Xe[Vi],fe+=hs);var Ba=We[_t(Ae,fe)&Or],To=Ba>>>4;if(!Ba)throw"invalid distance";if(fe+=15&Ba,wr=ct[To],To>3){var hs=J[To];wr+=_t(Ae,fe)&(1<<hs)-1,fe+=hs}if(fe>Mi)throw"unexpected EOF";Ai&&bi(me+131072);for(var Is=me+Xs;me<Is;me+=4)Te[me]=Te[me-wr],Te[me+1]=Te[me+1-wr],Te[me+2]=Te[me+2-wr],Te[me+3]=Te[me+3-wr];me=Is}}Ve.l=Ee,Ve.p=fe,Ve.b=me,Ee&&(Yi=1,Ve.m=Pe,Ve.d=We,Ve.n=li)}while(!Yi);return me==Te.length?Te:ae(Te,0,me)},ve=function(Ae,Te,Ve){var Pt=Te/8|0;Ae[Pt]|=Ve<<=7&Te,Ae[Pt+1]|=Ve>>>8},De=function(Ae,Te,Ve){var Pt=Te/8|0;Ae[Pt]|=Ve<<=7&Te,Ae[Pt+1]|=Ve>>>8,Ae[Pt+2]|=Ve>>>16},Ce=function(Ae,Te){for(var Ve=[],Pt=0;Pt<Ae.length;++Pt)Ae[Pt]&&Ve.push({s:Pt,f:Ae[Pt]});var Ai=Ve.length,Ui=Ve.slice();if(!Ai)return[zi,0];if(Ai==1){var bi=new F(Ve[0].s+1);return bi[Ve[0].s]=1,[bi,1]}Ve.sort(function(Ei,Ln){return Ei.f-Ln.f}),Ve.push({s:-1,f:25001});var Yi=Ve[0],fe=Ve[1],me=0,Ee=1,We=2;for(Ve[0]={s:-1,f:Yi.f+fe.f,l:Yi,r:fe};Ee!=Ai-1;)Yi=Ve[Ve[me].f<Ve[We].f?me++:We++],fe=Ve[me!=Ee&&Ve[me].f<Ve[We].f?me++:We++],Ve[Ee++]={s:-1,f:Yi.f+fe.f,l:Yi,r:fe};var Pe=Ui[0].s;for(Pt=1;Pt<Ai;++Pt)Ui[Pt].s>Pe&&(Pe=Ui[Pt].s);var li=new q(Pe+1),Mi=Vt(Ve[Ee-1],li,0);if(Mi>Te){Pt=0;var Wi=0,hn=Mi-Te,Dn=1<<hn;for(Ui.sort(function(Ei,Ln){return li[Ln.s]-li[Ei.s]||Ei.f-Ln.f});Pt<Ai;++Pt){var Zi=Ui[Pt].s;if(!(li[Zi]>Te))break;Wi+=Dn-(1<<Mi-li[Zi]),li[Zi]=Te}for(Wi>>>=hn;Wi>0;){var Kt=Ui[Pt].s;li[Kt]<Te?Wi-=1<<Te-li[Kt]++-1:++Pt}for(;Pt>=0&&Wi;--Pt){var nn=Ui[Pt].s;li[nn]==Te&&(--li[nn],++Wi)}Mi=Te}return[new F(li),Mi]},Vt=function(Ae,Te,Ve){return Ae.s==-1?Math.max(Vt(Ae.l,Te,Ve+1),Vt(Ae.r,Te,Ve+1)):Te[Ae.s]=Ve},zt=function(Ae){for(var Te=Ae.length;Te&&!Ae[--Te];);for(var Ve=new q(++Te),Pt=0,Ai=Ae[0],Ui=1,bi=function(fe){Ve[Pt++]=fe},Yi=1;Yi<=Te;++Yi)if(Ae[Yi]==Ai&&Yi!=Te)++Ui;else{if(!Ai&&Ui>2){for(;Ui>138;Ui-=138)bi(32754);Ui>2&&(bi(Ui>10?Ui-11<<5|28690:Ui-3<<5|12305),Ui=0)}else if(Ui>3){for(bi(Ai),--Ui;Ui>6;Ui-=6)bi(8304);Ui>2&&(bi(Ui-3<<5|8208),Ui=0)}for(;Ui--;)bi(Ai);Ui=1,Ai=Ae[Yi]}return[Ve.subarray(0,Pt),Te]},mt=function(Ae,Te){for(var Ve=0,Pt=0;Pt<Te.length;++Pt)Ve+=Ae[Pt]*Te[Pt];return Ve},Nt=function(Ae,Te,Ve){var Pt=Ve.length,Ai=Qt(Te+2);Ae[Ai]=255&Pt,Ae[Ai+1]=Pt>>>8,Ae[Ai+2]=255^Ae[Ai],Ae[Ai+3]=255^Ae[Ai+1];for(var Ui=0;Ui<Pt;++Ui)Ae[Ai+Ui+4]=Ve[Ui];return 8*(Ai+4+Pt)},Gt=function(Ae,Te,Ve,Pt,Ai,Ui,bi,Yi,fe,me,Ee){ve(Te,Ee++,Ve),++Ai[256];for(var We=Ce(Ai,15),Pe=We[0],li=We[1],Mi=Ce(Ui,15),Wi=Mi[0],hn=Mi[1],Dn=zt(Pe),Zi=Dn[0],Kt=Dn[1],nn=zt(Wi),Ei=nn[0],Ln=nn[1],Vi=new q(19),fn=0;fn<Zi.length;++fn)Vi[31&Zi[fn]]++;for(fn=0;fn<Ei.length;++fn)Vi[31&Ei[fn]]++;for(var cr=Ce(Vi,7),gr=cr[0],_r=cr[1],Rr=19;Rr>4&&!gr[re[Rr-1]];--Rr);var ur,wn,ws,wr,Vs=me+5<<3,Or=mt(Ai,At)+mt(Ui,It)+bi,ro=mt(Ai,Pe)+mt(Ui,Wi)+bi+14+3*Rr+mt(Vi,gr)+(2*Vi[16]+3*Vi[17]+7*Vi[18]);if(Vs<=Or&&Vs<=ro)return Nt(Te,Ee,Ae.subarray(fe,fe+me));if(ve(Te,Ee,1+(ro<Or)),Ee+=2,ro<Or){ur=Zt(Pe,li,0),wn=Pe,ws=Zt(Wi,hn,0),wr=Wi;var to=Zt(gr,_r,0);for(ve(Te,Ee,Kt-257),ve(Te,Ee+5,Ln-1),ve(Te,Ee+10,Rr-4),Ee+=14,fn=0;fn<Rr;++fn)ve(Te,Ee+3*fn,gr[re[fn]]);Ee+=3*Rr;for(var Xs=[Zi,Ei],Ba=0;Ba<2;++Ba){var To=Xs[Ba];for(fn=0;fn<To.length;++fn)ve(Te,Ee,to[hs=31&To[fn]]),Ee+=gr[hs],hs>15&&(ve(Te,Ee,To[fn]>>>5&127),Ee+=To[fn]>>>12)}}else ur=Ye,wn=At,ws=tt,wr=It;for(fn=0;fn<Yi;++fn)if(Pt[fn]>255){var hs;De(Te,Ee,ur[257+(hs=Pt[fn]>>>18&31)]),Ee+=wn[hs+257],hs>7&&(ve(Te,Ee,Pt[fn]>>>23&31),Ee+=n[hs]);var Is=31&Pt[fn];De(Te,Ee,ws[Is]),Ee+=wr[Is],Is>3&&(De(Te,Ee,Pt[fn]>>>5&8191),Ee+=J[Is])}else De(Te,Ee,ur[Pt[fn]]),Ee+=wn[Pt[fn]];return De(Te,Ee,ur[256]),Ee+wn[256]},ii=new V([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),zi=new F(0),Hi=function(Ae,Te,Ve,Pt,Ai,Ui){var bi=Ae.length,Yi=new F(Pt+bi+5*(1+Math.ceil(bi/7e3))+Ai),fe=Yi.subarray(Pt,Yi.length-Ai),me=0;if(!Te||bi<8)for(var Ee=0;Ee<=bi;Ee+=65535){var We=Ee+65535;We<bi?me=Nt(fe,me,Ae.subarray(Ee,We)):(fe[Ee]=Ui,me=Nt(fe,me,Ae.subarray(Ee,bi)))}else{for(var Pe=ii[Te-1],li=Pe>>>13,Mi=8191&Pe,Wi=(1<<Ve)-1,hn=new q(32768),Dn=new q(Wi+1),Zi=Math.ceil(Ve/3),Kt=2*Zi,nn=function(pl){return(Ae[pl]^Ae[pl+1]<<Zi^Ae[pl+2]<<Kt)&Wi},Ei=new V(25e3),Ln=new q(288),Vi=new q(32),fn=0,cr=0,gr=(Ee=0,0),_r=0,Rr=0;Ee<bi;++Ee){var ur=nn(Ee),wn=32767&Ee,ws=Dn[ur];if(hn[wn]=ws,Dn[ur]=wn,_r<=Ee){var wr=bi-Ee;if((fn>7e3||gr>24576)&&wr>423){me=Gt(Ae,fe,0,Ei,Ln,Vi,cr,gr,Rr,Ee-Rr,me),gr=fn=cr=0,Rr=Ee;for(var Vs=0;Vs<286;++Vs)Ln[Vs]=0;for(Vs=0;Vs<30;++Vs)Vi[Vs]=0}var Or=2,ro=0,to=Mi,Xs=wn-ws&32767;if(wr>2&&ur==nn(Ee-Xs))for(var Ba=Math.min(li,wr)-1,To=Math.min(32767,Ee),hs=Math.min(258,wr);Xs<=To&&--to&&wn!=ws;){if(Ae[Ee+Or]==Ae[Ee+Or-Xs]){for(var Is=0;Is<hs&&Ae[Ee+Is]==Ae[Ee+Is-Xs];++Is);if(Is>Or){if(Or=Is,ro=Xs,Is>Ba)break;var Yo=Math.min(Xs,Is-2),Un=0;for(Vs=0;Vs<Yo;++Vs){var dl=Ee-Xs+Vs+32768&32767,fa=dl-hn[dl]+32768&32767;fa>Un&&(Un=fa,ws=dl)}}}Xs+=(wn=ws)-(ws=hn[wn])+32768&32767}if(ro){Ei[gr++]=268435456|ht[Or]<<18|Dt[ro];var Zl=31&ht[Or],ma=31&Dt[ro];cr+=n[Zl]+J[ma],++Ln[257+Zl],++Vi[ma],_r=Ee+Or,++fn}else Ei[gr++]=Ae[Ee],++Ln[Ae[Ee]]}}me=Gt(Ae,fe,Ui,Ei,Ln,Vi,cr,gr,Rr,Ee-Rr,me),!Ui&&7&me&&(me=Nt(fe,me+1,zi))}return ae(Yi,0,Pt+Qt(me)+Ai)},on=function(){for(var Ae=new V(256),Te=0;Te<256;++Te){for(var Ve=Te,Pt=9;--Pt;)Ve=(1&Ve&&3988292384)^Ve>>>1;Ae[Te]=Ve}return Ae}(),mn=function(){var Ae=-1;return{p:function(Te){for(var Ve=Ae,Pt=0;Pt<Te.length;++Pt)Ve=on[255&Ve^Te[Pt]]^Ve>>>8;Ae=Ve},d:function(){return~Ae}}},Qe=function(){var Ae=1,Te=0;return{p:function(Ve){for(var Pt=Ae,Ai=Te,Ui=Ve.length,bi=0;bi!=Ui;){for(var Yi=Math.min(bi+2655,Ui);bi<Yi;++bi)Ai+=Pt+=Ve[bi];Pt=(65535&Pt)+15*(Pt>>16),Ai=(65535&Ai)+15*(Ai>>16)}Ae=Pt,Te=Ai},d:function(){return((Ae%=65521)>>>8<<16|(255&(Te%=65521))<<8|Te>>>8)+2*((255&Ae)<<23)}}},Yn=function(Ae,Te,Ve,Pt,Ai){return Hi(Ae,Te.level==null?6:Te.level,Te.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(Ae.length)))):12+Te.mem,Ve,Pt,!Ai)},pr=function(Ae,Te){var Ve={};for(var Pt in Ae)Ve[Pt]=Ae[Pt];for(var Pt in Te)Ve[Pt]=Te[Pt];return Ve},bt=function(Ae,Te,Ve){for(var Pt=Ae(),Ai=""+Ae,Ui=Ai.slice(Ai.indexOf("[")+1,Ai.lastIndexOf("]")).replace(/ /g,"").split(","),bi=0;bi<Pt.length;++bi){var Yi=Pt[bi],fe=Ui[bi];if(typeof Yi=="function"){Te+=";"+fe+"=";var me=""+Yi;if(Yi.prototype)if(me.indexOf("[native code]")!=-1){var Ee=me.indexOf(" ",8)+1;Te+=me.slice(Ee,me.indexOf("(",Ee))}else for(var We in Te+=me,Yi.prototype)Te+=";"+fe+".prototype."+We+"="+Yi.prototype[We];else Te+=me}else Ve[fe]=Yi}return[Te,Ve]},je=[],Ot=function(Ae){var Te=[];for(var Ve in Ae)(Ae[Ve]instanceof F||Ae[Ve]instanceof q||Ae[Ve]instanceof V)&&Te.push((Ae[Ve]=new Ae[Ve].constructor(Ae[Ve])).buffer);return Te},Le=function(Ae,Te,Ve,Pt){var Ai;if(!je[Ve]){for(var Ui="",bi={},Yi=Ae.length-1,fe=0;fe<Yi;++fe)Ui=(Ai=bt(Ae[fe],Ui,bi))[0],bi=Ai[1];je[Ve]=bt(Ae[Yi],Ui,bi)}var me=pr({},je[Ve][1]);return z.default(je[Ve][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+Te+"}",Ve,me,Ot(me),Pt)},Ie=function(){return[F,q,V,n,J,re,Xe,ct,ot,et,rt,Zt,Rt,at,_t,Qt,ae,be,uo,Tt,Mt]},Fe=function(){return[F,q,V,n,J,re,ht,Dt,Ye,At,tt,It,rt,ii,zi,Zt,ve,De,Ce,Vt,zt,mt,Nt,Gt,Qt,ae,Hi,Yn,_s,Tt]},Ge=function(){return[jn,eo,Mn,mn,on]},Je=function(){return[Lr,Tr]},st=function(){return[$r,Mn,Qe]},lt=function(){return[en]},Tt=function(Ae){return postMessage(Ae,[Ae.buffer])},Mt=function(Ae){return Ae&&Ae.size&&new F(Ae.size)},ci=function(Ae,Te,Ve,Pt,Ai,Ui){var bi=Le(Ve,Pt,Ai,function(Yi,fe){bi.terminate(),Ui(Yi,fe)});return bi.postMessage([Ae,Te],Te.consume?[Ae.buffer]:[]),function(){bi.terminate()}},xi=function(Ae){return Ae.ondata=function(Te,Ve){return postMessage([Te,Ve],[Te.buffer])},function(Te){return Ae.push(Te.data[0],Te.data[1])}},an=function(Ae,Te,Ve,Pt,Ai){var Ui,bi=Le(Ae,Pt,Ai,function(Yi,fe){Yi?(bi.terminate(),Te.ondata.call(Te,Yi)):(fe[1]&&bi.terminate(),Te.ondata.call(Te,Yi,fe[0],fe[1]))});bi.postMessage(Ve),Te.push=function(Yi,fe){if(Ui)throw"stream finished";if(!Te.ondata)throw"no stream handler";bi.postMessage([Yi,Ui=fe],[Yi.buffer])},Te.terminate=function(){bi.terminate()}},cn=function(Ae,Te){return Ae[Te]|Ae[Te+1]<<8},_n=function(Ae,Te){return(Ae[Te]|Ae[Te+1]<<8|Ae[Te+2]<<16)+2*(Ae[Te+3]<<23)},Fn=function(Ae,Te){return _n(Ae,Te)|4294967296*_n(Ae,Te)},Mn=function(Ae,Te,Ve){for(;Ve;++Te)Ae[Te]=Ve,Ve>>>=8},jn=function(Ae,Te){var Ve=Te.filename;if(Ae[0]=31,Ae[1]=139,Ae[2]=8,Ae[8]=Te.level<2?4:Te.level==9?2:0,Ae[9]=3,Te.mtime!=0&&Mn(Ae,4,Math.floor(new Date(Te.mtime||Date.now())/1e3)),Ve){Ae[3]=8;for(var Pt=0;Pt<=Ve.length;++Pt)Ae[Pt+10]=Ve.charCodeAt(Pt)}},Lr=function(Ae){if(Ae[0]!=31||Ae[1]!=139||Ae[2]!=8)throw"invalid gzip data";var Te=Ae[3],Ve=10;4&Te&&(Ve+=Ae[10]|2+(Ae[11]<<8));for(var Pt=(Te>>3&1)+(Te>>4&1);Pt>0;Pt-=!Ae[Ve++]);return Ve+(2&Te)},Tr=function(Ae){var Te=Ae.length;return(Ae[Te-4]|Ae[Te-3]<<8|Ae[Te-2]<<16)+2*(Ae[Te-1]<<23)},eo=function(Ae){return 10+(Ae.filename&&Ae.filename.length+1||0)},$r=function(Ae,Te){var Ve=Te.level,Pt=Ve==0?0:Ve<6?1:Ve==9?3:2;Ae[0]=120,Ae[1]=Pt<<6|(Pt?32-2*Pt:1)},en=function(Ae){if((15&Ae[0])!=8||Ae[0]>>>4>7||(Ae[0]<<8|Ae[1])%31)throw"invalid zlib data";if(32&Ae[1])throw"invalid zlib data: preset dictionaries not supported"};function Wn(Ae,Te){return Te||typeof Ae!="function"||(Te=Ae,Ae={}),this.ondata=Te,Ae}var Ls=function(){function Ae(Te,Ve){Ve||typeof Te!="function"||(Ve=Te,Te={}),this.ondata=Ve,this.o=Te||{}}return Ae.prototype.p=function(Te,Ve){this.ondata(Yn(Te,this.o,0,0,!Ve),Ve)},Ae.prototype.push=function(Te,Ve){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=Ve,this.p(Te,Ve||!1)},Ae}();p.Deflate=Ls;var bo=function(){return function(Ae,Te){an([Fe,function(){return[xi,Ls]}],this,Wn.call(this,Ae,Te),function(Ve){var Pt=new Ls(Ve.data);onmessage=xi(Pt)},6)}}();function Lo(Ae,Te,Ve){if(Ve||(Ve=Te,Te={}),typeof Ve!="function")throw"no callback";return ci(Ae,Te,[Fe],function(Pt){return Tt(_s(Pt.data[0],Pt.data[1]))},0,Ve)}function _s(Ae,Te){return Yn(Ae,Te||{},0,0)}p.AsyncDeflate=bo,p.deflate=Lo,p.deflateSync=_s;var js=function(){function Ae(Te){this.s={},this.p=new F(0),this.ondata=Te}return Ae.prototype.e=function(Te){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var Ve=this.p.length,Pt=new F(Ve+Te.length);Pt.set(this.p),Pt.set(Te,Ve),this.p=Pt},Ae.prototype.c=function(Te){this.d=this.s.i=Te||!1;var Ve=this.s.b,Pt=be(this.p,this.o,this.s);this.ondata(ae(Pt,Ve,this.s.b),this.d),this.o=ae(Pt,this.s.b-32768),this.s.b=this.o.length,this.p=ae(this.p,this.s.p/8|0),this.s.p&=7},Ae.prototype.push=function(Te,Ve){this.e(Te),this.c(Ve)},Ae}();p.Inflate=js;var Dr=function(){return function(Ae){this.ondata=Ae,an([Ie,function(){return[xi,js]}],this,0,function(){var Te=new js;onmessage=xi(Te)},7)}}();function no(Ae,Te,Ve){if(Ve||(Ve=Te,Te={}),typeof Ve!="function")throw"no callback";return ci(Ae,Te,[Ie],function(Pt){return Tt(uo(Pt.data[0],Mt(Pt.data[1])))},1,Ve)}function uo(Ae,Te){return be(Ae,Te)}p.AsyncInflate=Dr,p.inflate=no,p.inflateSync=uo;var oi=function(){function Ae(Te,Ve){this.c=mn(),this.l=0,this.v=1,Ls.call(this,Te,Ve)}return Ae.prototype.push=function(Te,Ve){Ls.prototype.push.call(this,Te,Ve)},Ae.prototype.p=function(Te,Ve){this.c.p(Te),this.l+=Te.length;var Pt=Yn(Te,this.o,this.v&&eo(this.o),Ve&&8,!Ve);this.v&&(jn(Pt,this.o),this.v=0),Ve&&(Mn(Pt,Pt.length-8,this.c.d()),Mn(Pt,Pt.length-4,this.l)),this.ondata(Pt,Ve)},Ae}();p.Gzip=oi,p.Compress=oi;var ye=function(){return function(Ae,Te){an([Fe,Ge,function(){return[xi,Ls,oi]}],this,Wn.call(this,Ae,Te),function(Ve){var Pt=new oi(Ve.data);onmessage=xi(Pt)},8)}}();function ie(Ae,Te,Ve){if(Ve||(Ve=Te,Te={}),typeof Ve!="function")throw"no callback";return ci(Ae,Te,[Fe,Ge,function(){return[qe]}],function(Pt){return Tt(qe(Pt.data[0],Pt.data[1]))},2,Ve)}function qe(Ae,Te){Te||(Te={});var Ve=mn(),Pt=Ae.length;Ve.p(Ae);var Ai=Yn(Ae,Te,eo(Te),8),Ui=Ai.length;return jn(Ai,Te),Mn(Ai,Ui-8,Ve.d()),Mn(Ai,Ui-4,Pt),Ai}p.AsyncGzip=ye,p.AsyncCompress=ye,p.gzip=ie,p.compress=ie,p.gzipSync=qe,p.compressSync=qe;var St=function(){function Ae(Te){this.v=1,js.call(this,Te)}return Ae.prototype.push=function(Te,Ve){if(js.prototype.e.call(this,Te),this.v){var Pt=this.p.length>3?Lr(this.p):4;if(Pt>=this.p.length&&!Ve)return;this.p=this.p.subarray(Pt),this.v=0}if(Ve){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}js.prototype.c.call(this,Ve)},Ae}();p.Gunzip=St;var ut=function(){return function(Ae){this.ondata=Ae,an([Ie,Je,function(){return[xi,js,St]}],this,0,function(){var Te=new St;onmessage=xi(Te)},9)}}();function Ft(Ae,Te,Ve){if(Ve||(Ve=Te,Te={}),typeof Ve!="function")throw"no callback";return ci(Ae,Te,[Ie,Je,function(){return[si]}],function(Pt){return Tt(si(Pt.data[0]))},3,Ve)}function si(Ae,Te){return be(Ae.subarray(Lr(Ae),-8),Te||new F(Tr(Ae)))}p.AsyncGunzip=ut,p.gunzip=Ft,p.gunzipSync=si;var $t=function(){function Ae(Te,Ve){this.c=Qe(),this.v=1,Ls.call(this,Te,Ve)}return Ae.prototype.push=function(Te,Ve){Ls.prototype.push.call(this,Te,Ve)},Ae.prototype.p=function(Te,Ve){this.c.p(Te);var Pt=Yn(Te,this.o,this.v&&2,Ve&&4,!Ve);this.v&&($r(Pt,this.o),this.v=0),Ve&&Mn(Pt,Pt.length-4,this.c.d()),this.ondata(Pt,Ve)},Ae}();p.Zlib=$t;var ai=function(){return function(Ae,Te){an([Fe,st,function(){return[xi,Ls,$t]}],this,Wn.call(this,Ae,Te),function(Ve){var Pt=new $t(Ve.data);onmessage=xi(Pt)},10)}}();function fi(Ae,Te,Ve){if(Ve||(Ve=Te,Te={}),typeof Ve!="function")throw"no callback";return ci(Ae,Te,[Fe,st,function(){return[pi]}],function(Pt){return Tt(pi(Pt.data[0],Pt.data[1]))},4,Ve)}function pi(Ae,Te){Te||(Te={});var Ve=Qe();Ve.p(Ae);var Pt=Yn(Ae,Te,2,4);return $r(Pt,Te),Mn(Pt,Pt.length-4,Ve.d()),Pt}p.AsyncZlib=ai,p.zlib=fi,p.zlibSync=pi;var Pi=function(){function Ae(Te){this.v=1,js.call(this,Te)}return Ae.prototype.push=function(Te,Ve){if(js.prototype.e.call(this,Te),this.v){if(this.p.length<2&&!Ve)return;this.p=this.p.subarray(2),this.v=0}if(Ve){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}js.prototype.c.call(this,Ve)},Ae}();p.Unzlib=Pi;var tn=function(){return function(Ae){this.ondata=Ae,an([Ie,lt,function(){return[xi,js,Pi]}],this,0,function(){var Te=new Pi;onmessage=xi(Te)},11)}}();function xn(Ae,Te,Ve){if(Ve||(Ve=Te,Te={}),typeof Ve!="function")throw"no callback";return ci(Ae,Te,[Ie,lt,function(){return[Jn]}],function(Pt){return Tt(Jn(Pt.data[0],Mt(Pt.data[1])))},5,Ve)}function Jn(Ae,Te){return be((en(Ae),Ae.subarray(2,-4)),Te)}p.AsyncUnzlib=tn,p.unzlib=xn,p.unzlibSync=Jn;var sr=function(){function Ae(Te){this.G=St,this.I=js,this.Z=Pi,this.ondata=Te}return Ae.prototype.push=function(Te,Ve){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(Te,Ve);else{if(this.p&&this.p.length){var Pt=new F(this.p.length+Te.length);Pt.set(this.p),Pt.set(Te,this.p.length)}else this.p=Te;if(this.p.length>2){var Ai=this,Ui=function(){Ai.ondata.apply(Ai,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(Ui):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(Ui):new this.Z(Ui),this.s.push(this.p,Ve),this.p=null}}},Ae}();p.Decompress=sr;var ar=function(){function Ae(Te){this.G=ut,this.I=Dr,this.Z=tn,this.ondata=Te}return Ae.prototype.push=function(Te,Ve){sr.prototype.push.call(this,Te,Ve)},Ae}();function er(Ae,Te,Ve){if(Ve||(Ve=Te,Te={}),typeof Ve!="function")throw"no callback";return Ae[0]==31&&Ae[1]==139&&Ae[2]==8?Ft(Ae,Te,Ve):(15&Ae[0])!=8||Ae[0]>>4>7||(Ae[0]<<8|Ae[1])%31?no(Ae,Te,Ve):xn(Ae,Te,Ve)}function Zr(Ae,Te){return Ae[0]==31&&Ae[1]==139&&Ae[2]==8?si(Ae,Te):(15&Ae[0])!=8||Ae[0]>>4>7||(Ae[0]<<8|Ae[1])%31?uo(Ae,Te):Jn(Ae,Te)}p.AsyncDecompress=ar,p.decompress=er,p.decompressSync=Zr;var Gr=function(Ae,Te,Ve,Pt){for(var Ai in Ae){var Ui=Ae[Ai],bi=Te+Ai;Ui instanceof F?Ve[bi]=[Ui,Pt]:Array.isArray(Ui)?Ve[bi]=[Ui[0],pr(Pt,Ui[1])]:Gr(Ui,bi+"/",Ve,Pt)}},yr=typeof TextEncoder<"u"&&new TextEncoder,Jr=typeof TextDecoder<"u"&&new TextDecoder,us=0;try{Jr.decode(zi,{stream:!0}),us=1}catch{}var Ns=function(Ae){for(var Te="",Ve=0;;){var Pt=Ae[Ve++],Ai=(Pt>127)+(Pt>223)+(Pt>239);if(Ve+Ai>Ae.length)return[Te,ae(Ae,Ve-1)];Ai?Ai==3?(Pt=((15&Pt)<<18|(63&Ae[Ve++])<<12|(63&Ae[Ve++])<<6|63&Ae[Ve++])-65536,Te+=String.fromCharCode(55296|Pt>>10,56320|1023&Pt)):Te+=String.fromCharCode(1&Ai?(31&Pt)<<6|63&Ae[Ve++]:(15&Pt)<<12|(63&Ae[Ve++])<<6|63&Ae[Ve++]):Te+=String.fromCharCode(Pt)}},es=function(){function Ae(Te){this.ondata=Te,us?this.t=new TextDecoder:this.p=zi}return Ae.prototype.push=function(Te,Ve){if(!this.ondata)throw"no callback";if(Ve||(Ve=!1),this.t)return this.ondata(this.t.decode(Te,{stream:!Ve}),Ve);var Pt=new F(this.p.length+Te.length);Pt.set(this.p),Pt.set(Te,this.p.length);var Ai=Ns(Pt),Ui=Ai[0],bi=Ai[1];if(Ve&&bi.length)throw"invalid utf-8 data";this.p=bi,this.ondata(Ui,Ve)},Ae}();p.DecodeUTF8=es;var Fs=function(){function Ae(Te){this.ondata=Te}return Ae.prototype.push=function(Te,Ve){if(!this.ondata)throw"no callback";this.ondata(Ps(Te),Ve||!1)},Ae}();function Ps(Ae,Te){if(Te){for(var Ve=new F(Ae.length),Pt=0;Pt<Ae.length;++Pt)Ve[Pt]=Ae.charCodeAt(Pt);return Ve}if(yr)return yr.encode(Ae);var Ai=Ae.length,Ui=new F(Ae.length+(Ae.length>>1)),bi=0,Yi=function(Ee){Ui[bi++]=Ee};for(Pt=0;Pt<Ai;++Pt){if(bi+5>Ui.length){var fe=new F(bi+8+(Ai-Pt<<1));fe.set(Ui),Ui=fe}var me=Ae.charCodeAt(Pt);me<128||Te?Yi(me):me<2048?(Yi(192|me>>>6),Yi(128|63&me)):me>55295&&me<57344?(Yi(240|(me=65536+(1047552&me)|1023&Ae.charCodeAt(++Pt))>>>18),Yi(128|me>>>12&63),Yi(128|me>>>6&63),Yi(128|63&me)):(Yi(224|me>>>12),Yi(128|me>>>6&63),Yi(128|63&me))}return ae(Ui,0,bi)}function wo(Ae,Te){if(Te){for(var Ve="",Pt=0;Pt<Ae.length;Pt+=16384)Ve+=String.fromCharCode.apply(null,Ae.subarray(Pt,Pt+16384));return Ve}if(Jr)return Jr.decode(Ae);var Ai=Ns(Ae);if(Ai[1].length)throw"invalid utf-8 data";return Ai[0]}p.EncodeUTF8=Fs,p.strToU8=Ps,p.strFromU8=wo;var Xo=function(Ae){return Ae==1?3:Ae<6?2:Ae==9?1:0},ka=function(Ae,Te){return Te+30+cn(Ae,Te+26)+cn(Ae,Te+28)},ll=function(Ae,Te,Ve){var Pt=cn(Ae,Te+28),Ai=wo(Ae.subarray(Te+46,Te+46+Pt),!(2048&cn(Ae,Te+8))),Ui=Te+46+Pt,bi=_n(Ae,Te+20),Yi=Ve&&bi==4294967295?na(Ae,Ui):[bi,_n(Ae,Te+24),_n(Ae,Te+42)],fe=Yi[0],me=Yi[1],Ee=Yi[2];return[cn(Ae,Te+10),fe,me,Ai,Ui+cn(Ae,Te+30)+cn(Ae,Te+32),Ee]},na=function(Ae,Te){for(;cn(Ae,Te)!=1;Te+=4+cn(Ae,Te+2));return[Fn(Ae,Te+12),Fn(Ae,Te+4),Fn(Ae,Te+20)]},nr=function(Ae){var Te=0;if(Ae)for(var Ve in Ae){var Pt=Ae[Ve].length;if(Pt>65535)throw"extra field too long";Te+=Pt+4}return Te},Go=function(Ae,Te,Ve,Pt,Ai,Ui,bi,Yi){var fe=Pt.length,me=Ve.extra,Ee=Yi&&Yi.length,We=nr(me);Mn(Ae,Te,bi!=null?33639248:67324752),Te+=4,bi!=null&&(Ae[Te++]=20,Ae[Te++]=Ve.os),Ae[Te]=20,Te+=2,Ae[Te++]=Ve.flag<<1|(Ui==null&&8),Ae[Te++]=Ai&&8,Ae[Te++]=255&Ve.compression,Ae[Te++]=Ve.compression>>8;var Pe=new Date(Ve.mtime==null?Date.now():Ve.mtime),li=Pe.getFullYear()-1980;if(li<0||li>119)throw"date not in range 1980-2099";if(Mn(Ae,Te,2*(li<<24)|Pe.getMonth()+1<<21|Pe.getDate()<<16|Pe.getHours()<<11|Pe.getMinutes()<<5|Pe.getSeconds()>>>1),Te+=4,Ui!=null&&(Mn(Ae,Te,Ve.crc),Mn(Ae,Te+4,Ui),Mn(Ae,Te+8,Ve.size)),Mn(Ae,Te+12,fe),Mn(Ae,Te+14,We),Te+=16,bi!=null&&(Mn(Ae,Te,Ee),Mn(Ae,Te+6,Ve.attrs),Mn(Ae,Te+10,bi),Te+=14),Ae.set(Pt,Te),Te+=fe,We)for(var Mi in me){var Wi=me[Mi],hn=Wi.length;Mn(Ae,Te,+Mi),Mn(Ae,Te+2,hn),Ae.set(Wi,Te+4),Te+=4+hn}return Ee&&(Ae.set(Yi,Te),Te+=Ee),Te},fo=function(Ae,Te,Ve,Pt,Ai){Mn(Ae,Te,101010256),Mn(Ae,Te+8,Ve),Mn(Ae,Te+10,Ve),Mn(Ae,Te+12,Pt),Mn(Ae,Te+16,Ai)},Bo=function(){function Ae(Te){this.filename=Te,this.c=mn(),this.size=0,this.compression=0}return Ae.prototype.process=function(Te,Ve){this.ondata(null,Te,Ve)},Ae.prototype.push=function(Te,Ve){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(Te),this.size+=Te.length,Ve&&(this.crc=this.c.d()),this.process(Te,Ve||!1)},Ae}();p.ZipPassThrough=Bo;var ra=function(){function Ae(Te,Ve){var Pt=this;Ve||(Ve={}),Bo.call(this,Te),this.d=new Ls(Ve,function(Ai,Ui){Pt.ondata(null,Ai,Ui)}),this.compression=8,this.flag=Xo(Ve.level)}return Ae.prototype.process=function(Te,Ve){try{this.d.push(Te,Ve)}catch(Pt){this.ondata(Pt,null,Ve)}},Ae.prototype.push=function(Te,Ve){Bo.prototype.push.call(this,Te,Ve)},Ae}();p.ZipDeflate=ra;var mo=function(){function Ae(Te,Ve){var Pt=this;Ve||(Ve={}),Bo.call(this,Te),this.d=new bo(Ve,function(Ai,Ui,bi){Pt.ondata(Ai,Ui,bi)}),this.compression=8,this.flag=Xo(Ve.level),this.terminate=this.d.terminate}return Ae.prototype.process=function(Te,Ve){this.d.push(Te,Ve)},Ae.prototype.push=function(Te,Ve){Bo.prototype.push.call(this,Te,Ve)},Ae}();p.AsyncZipDeflate=mo;var Ho=function(){function Ae(Te){this.ondata=Te,this.u=[],this.d=1}return Ae.prototype.add=function(Te){var Ve=this;if(2&this.d)throw"stream finished";var Pt=Ps(Te.filename),Ai=Pt.length,Ui=Te.comment,bi=Ui&&Ps(Ui),Yi=Ai!=Te.filename.length||bi&&Ui.length!=bi.length,fe=Ai+nr(Te.extra)+30;if(Ai>65535)throw"filename too long";var me=new F(fe);Go(me,0,Te,Pt,Yi);var Ee=[me],We=function(){for(var hn=0,Dn=Ee;hn<Dn.length;hn++)Ve.ondata(null,Dn[hn],!1);Ee=[]},Pe=this.d;this.d=0;var li=this.u.length,Mi=pr(Te,{f:Pt,u:Yi,o:bi,t:function(){Te.terminate&&Te.terminate()},r:function(){if(We(),Pe){var hn=Ve.u[li+1];hn?hn.r():Ve.d=1}Pe=1}}),Wi=0;Te.ondata=function(hn,Dn,Zi){if(hn)Ve.ondata(hn,Dn,Zi),Ve.terminate();else if(Wi+=Dn.length,Ee.push(Dn),Zi){var Kt=new F(16);Mn(Kt,0,134695760),Mn(Kt,4,Te.crc),Mn(Kt,8,Wi),Mn(Kt,12,Te.size),Ee.push(Kt),Mi.c=Wi,Mi.b=fe+Wi+16,Mi.crc=Te.crc,Mi.size=Te.size,Pe&&Mi.r(),Pe=1}else Pe&&We()},this.u.push(Mi)},Ae.prototype.end=function(){var Te=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&Te.d&&(Te.u.splice(-1,1),Te.e())},t:function(){}}),this.d=3},Ae.prototype.e=function(){for(var Te=0,Ve=0,Pt=0,Ai=0,Ui=this.u;Ai<Ui.length;Ai++)Pt+=46+(me=Ui[Ai]).f.length+nr(me.extra)+(me.o?me.o.length:0);for(var bi=new F(Pt+22),Yi=0,fe=this.u;Yi<fe.length;Yi++){var me;Go(bi,Te,me=fe[Yi],me.f,me.u,me.c,Ve,me.o),Te+=46+me.f.length+nr(me.extra)+(me.o?me.o.length:0),Ve+=me.b}fo(bi,Te,this.u.length,Pt,Ve),this.ondata(null,bi,!0),this.d=2},Ae.prototype.terminate=function(){for(var Te=0,Ve=this.u;Te<Ve.length;Te++)Ve[Te].t();this.d=2},Ae}();function Ws(Ae,Te,Ve){if(Ve||(Ve=Te,Te={}),typeof Ve!="function")throw"no callback";var Pt={};Gr(Ae,"",Pt,Te);var Ai=Object.keys(Pt),Ui=Ai.length,bi=0,Yi=0,fe=Ui,me=Array(Ui),Ee=[],We=function(){for(var Wi=0;Wi<Ee.length;++Wi)Ee[Wi]()},Pe=function(){var Wi=new F(Yi+22),hn=bi,Dn=Yi-bi;Yi=0;for(var Zi=0;Zi<fe;++Zi){var Kt=me[Zi];try{var nn=Kt.c.length;Go(Wi,Yi,Kt,Kt.f,Kt.u,nn);var Ei=30+Kt.f.length+nr(Kt.extra),Ln=Yi+Ei;Wi.set(Kt.c,Ln),Go(Wi,bi,Kt,Kt.f,Kt.u,nn,Yi,Kt.m),bi+=16+Ei+(Kt.m?Kt.m.length:0),Yi=Ln+nn}catch(Vi){return Ve(Vi,null)}}fo(Wi,bi,me.length,Dn,hn),Ve(null,Wi)};Ui||Pe();for(var li=function(Wi){var hn=Ai[Wi],Dn=Pt[hn],Zi=Dn[0],Kt=Dn[1],nn=mn(),Ei=Zi.length;nn.p(Zi);var Ln=Ps(hn),Vi=Ln.length,fn=Kt.comment,cr=fn&&Ps(fn),gr=cr&&cr.length,_r=nr(Kt.extra),Rr=Kt.level==0?0:8,ur=function(wn,ws){if(wn)We(),Ve(wn,null);else{var wr=ws.length;me[Wi]=pr(Kt,{size:Ei,crc:nn.d(),c:ws,f:Ln,m:cr,u:Vi!=hn.length||cr&&fn.length!=gr,compression:Rr}),bi+=30+Vi+_r+wr,Yi+=76+2*(Vi+_r)+(gr||0)+wr,--Ui||Pe()}};if(Vi>65535&&ur("filename too long",null),Rr)if(Ei<16e4)try{ur(null,_s(Zi,Kt))}catch(wn){ur(wn,null)}else Ee.push(Lo(Zi,Kt,ur));else ur(null,Zi)},Mi=0;Mi<fe;++Mi)li(Mi);return We}function pa(Ae,Te){Te||(Te={});var Ve={},Pt=[];Gr(Ae,"",Ve,Te);var Ai=0,Ui=0;for(var bi in Ve){var Yi=Ve[bi],fe=Yi[0],me=Yi[1],Ee=me.level==0?0:8,We=(Vi=Ps(bi)).length,Pe=me.comment,li=Pe&&Ps(Pe),Mi=li&&li.length,Wi=nr(me.extra);if(We>65535)throw"filename too long";var hn=Ee?_s(fe,me):fe,Dn=hn.length,Zi=mn();Zi.p(fe),Pt.push(pr(me,{size:fe.length,crc:Zi.d(),c:hn,f:Vi,m:li,u:We!=bi.length||li&&Pe.length!=Mi,o:Ai,compression:Ee})),Ai+=30+We+Wi+Dn,Ui+=76+2*(We+Wi)+(Mi||0)+Dn}for(var Kt=new F(Ui+22),nn=Ai,Ei=Ui-Ai,Ln=0;Ln<Pt.length;++Ln){var Vi;Go(Kt,(Vi=Pt[Ln]).o,Vi,Vi.f,Vi.u,Vi.c.length);var fn=30+Vi.f.length+nr(Vi.extra);Kt.set(Vi.c,Vi.o+fn),Go(Kt,Ai,Vi,Vi.f,Vi.u,Vi.c.length,Vi.o,Vi.m),Ai+=16+fn+(Vi.m?Vi.m.length:0)}return fo(Kt,Ai,Pt.length,Ei,nn),Kt}p.Zip=Ho,p.zip=Ws,p.zipSync=pa;var cl=function(){function Ae(){}return Ae.prototype.push=function(Te,Ve){this.ondata(null,Te,Ve)},Ae.compression=0,Ae}();p.UnzipPassThrough=cl;var Fa=function(){function Ae(){var Te=this;this.i=new js(function(Ve,Pt){Te.ondata(null,Ve,Pt)})}return Ae.prototype.push=function(Te,Ve){try{this.i.push(Te,Ve)}catch(Pt){this.ondata(Pt,Te,Ve)}},Ae.compression=8,Ae}();p.UnzipInflate=Fa;var zl=function(){function Ae(Te,Ve){var Pt=this;Ve<32e4?this.i=new js(function(Ai,Ui){Pt.ondata(null,Ai,Ui)}):(this.i=new Dr(function(Ai,Ui,bi){Pt.ondata(Ai,Ui,bi)}),this.terminate=this.i.terminate)}return Ae.prototype.push=function(Te,Ve){this.i.terminate&&(Te=ae(Te,0)),this.i.push(Te,Ve)},Ae.compression=8,Ae}();p.AsyncUnzipInflate=zl;var Us=function(){function Ae(Te){this.onfile=Te,this.k=[],this.o={0:cl},this.p=zi}return Ae.prototype.push=function(Te,Ve){var Pt=this;if(!this.onfile)throw"no callback";if(this.c>0){var Ai=Math.min(this.c,Te.length),Ui=Te.subarray(0,Ai);if(this.c-=Ai,this.d?this.d.push(Ui,!this.c):this.k[0].push(Ui),(Te=Te.subarray(Ai)).length)return this.push(Te,Ve)}else{var bi=0,Yi=0,fe=void 0,me=void 0;this.p.length?Te.length?((me=new F(this.p.length+Te.length)).set(this.p),me.set(Te,this.p.length)):me=this.p:me=Te;for(var Ee=me.length,We=this.c,Pe=We&&this.d,li=function(){var hn,Dn=_n(me,Yi);if(Dn==67324752){bi=1,fe=Yi,Mi.d=null,Mi.c=0;var Zi=cn(me,Yi+6),Kt=cn(me,Yi+8),nn=2048&Zi,Ei=8&Zi,Ln=cn(me,Yi+26),Vi=cn(me,Yi+28);if(Ee>Yi+30+Ln+Vi){var fn=[];Mi.k.unshift(fn),bi=2;var cr=_n(me,Yi+18),gr=_n(me,Yi+22),_r=wo(me.subarray(Yi+30,Yi+=30+Ln),!nn);cr==4294967295?(hn=Ei?[-2]:na(me,Yi),cr=hn[0],gr=hn[1]):Ei&&(cr=-1),Yi+=Vi,Mi.c=cr;var Rr={name:_r,compression:Kt,start:function(){if(!Rr.ondata)throw"no callback";if(cr){var ur=Pt.o[Kt];if(!ur)throw"unknown compression type "+Kt;var wn=cr<0?new ur(_r):new ur(_r,cr,gr);wn.ondata=function(Vs,Or,ro){Rr.ondata(Vs,Or,ro)};for(var ws=0,wr=fn;ws<wr.length;ws++)wn.push(wr[ws],!1);Pt.k[0]==fn?Pt.d=wn:wn.push(zi,!0)}else Rr.ondata(null,zi,!0)},terminate:function(){Pt.k[0]==fn&&Pt.d.terminate&&Pt.d.terminate()}};cr>=0&&(Rr.size=cr,Rr.originalSize=gr),Mi.onfile(Rr)}return"break"}if(We){if(Dn==134695760)return fe=Yi+=12+(We==-2&&8),bi=2,Mi.c=0,"break";if(Dn==33639248)return fe=Yi-=4,bi=2,Mi.c=0,"break"}},Mi=this;Yi<Ee-4&&li()!=="break";++Yi);if(this.p=zi,We<0){var Wi=me.subarray(0,bi?fe-12-(We==-2&&8)-(_n(me,fe-16)==134695760&&4):Yi);Pe?Pe.push(Wi,!!bi):this.k[+(bi==2)].push(Wi)}if(2&bi)return this.push(me.subarray(Yi),Ve);this.p=me.subarray(Yi)}if(Ve&&this.c)throw"invalid zip file"},Ae.prototype.register=function(Te){this.o[Te.compression]=Te},Ae}();function ul(Ae,Te){if(typeof Te!="function")throw"no callback";for(var Ve=[],Pt=function(){for(var Pe=0;Pe<Ve.length;++Pe)Ve[Pe]()},Ai={},Ui=Ae.length-22;_n(Ae,Ui)!=101010256;--Ui)if(!Ui||Ae.length-Ui>65558)return void Te("invalid zip file",null);var bi=cn(Ae,Ui+8);bi||Te(null,{});var Yi=bi,fe=_n(Ae,Ui+16),me=fe==4294967295;if(me){if(Ui=_n(Ae,Ui-12),_n(Ae,Ui)!=101075792)return void Te("invalid zip file",null);Yi=bi=_n(Ae,Ui+32),fe=_n(Ae,Ui+48)}for(var Ee=function(Pe){var li=ll(Ae,fe,me),Mi=li[0],Wi=li[1],hn=li[2],Dn=li[3],Zi=li[4],Kt=ka(Ae,li[5]);fe=Zi;var nn=function(Ln,Vi){Ln?(Pt(),Te(Ln,null)):(Ai[Dn]=Vi,--bi||Te(null,Ai))};if(Mi)if(Mi==8){var Ei=Ae.subarray(Kt,Kt+Wi);if(Wi<32e4)try{nn(null,uo(Ei,new F(hn)))}catch(Ln){nn(Ln,null)}else Ve.push(no(Ei,{size:hn},nn))}else nn("unknown compression type "+Mi,null);else nn(null,ae(Ae,Kt,Kt+Wi))},We=0;We<Yi;++We)Ee();return Pt}function hl(Ae){for(var Te={},Ve=Ae.length-22;_n(Ae,Ve)!=101010256;--Ve)if(!Ve||Ae.length-Ve>65558)throw"invalid zip file";var Pt=cn(Ae,Ve+8);if(!Pt)return{};var Ai=_n(Ae,Ve+16),Ui=Ai==4294967295;if(Ui){if(Ve=_n(Ae,Ve-12),_n(Ae,Ve)!=101075792)throw"invalid zip file";Pt=_n(Ae,Ve+32),Ai=_n(Ae,Ve+48)}for(var bi=0;bi<Pt;++bi){var Yi=ll(Ae,Ai,Ui),fe=Yi[0],me=Yi[1],Ee=Yi[2],We=Yi[3],Pe=Yi[4],li=ka(Ae,Yi[5]);if(Ai=Pe,fe){if(fe!=8)throw"unknown compression type "+fe;Te[We]=uo(Ae.subarray(li,li+me),new F(Ee))}else Te[We]=ae(Ae,li,li+me)}return Te}return p.Unzip=Us,p.unzip=ul,p.unzipSync=hl,p})}(o0,o0.exports)),o0.exports}var vM;function CI(){return vM||(vM=1,function(v,y){const p=za(),z=AI();(function(){let F,q,V;class n extends p.Loader{constructor(ae){super(ae)}load(ae,be,ve,De){const Ce=this,Vt=Ce.path===""?p.LoaderUtils.extractUrlBase(ae):Ce.path,zt=new p.FileLoader(this.manager);zt.setPath(Ce.path),zt.setResponseType("arraybuffer"),zt.setRequestHeader(Ce.requestHeader),zt.setWithCredentials(Ce.withCredentials),zt.load(ae,function(mt){try{be(Ce.parse(mt,Vt))}catch(Nt){De?De(Nt):console.error(Nt),Ce.manager.itemError(ae)}},ve,De)}parse(ae,be){if(ct(ae))F=new Xe().parse(ae);else{const De=et(ae);if(!Dt(De))throw new Error("THREE.FBXLoader: Unknown format.");if(rt(De)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+rt(De));F=new Se().parse(De)}const ve=new p.TextureLoader(this.manager).setPath(this.resourcePath||be).setCrossOrigin(this.crossOrigin);return new J(ve,this.manager).parse(F)}}class J{constructor(ae,be){this.textureLoader=ae,this.manager=be}parse(){q=this.parseConnections();const ae=this.parseImages(),be=this.parseTextures(ae),ve=this.parseMaterials(be),De=this.parseDeformers(),Ce=new re().parse(De);return this.parseScene(De,Ce,ve),V}parseConnections(){const ae=new Map;return"Connections"in F&&F.Connections.connections.forEach(function(ve){const De=ve[0],Ce=ve[1],Vt=ve[2];ae.has(De)||ae.set(De,{parents:[],children:[]});const zt={ID:Ce,relationship:Vt};ae.get(De).parents.push(zt),ae.has(Ce)||ae.set(Ce,{parents:[],children:[]});const mt={ID:De,relationship:Vt};ae.get(Ce).children.push(mt)}),ae}parseImages(){const ae={},be={};if("Video"in F.Objects){const ve=F.Objects.Video;for(const De in ve){const Ce=ve[De],Vt=parseInt(De);if(ae[Vt]=Ce.RelativeFilename||Ce.Filename,"Content"in Ce){const zt=Ce.Content instanceof ArrayBuffer&&Ce.Content.byteLength>0,mt=typeof Ce.Content=="string"&&Ce.Content!=="";if(zt||mt){const Nt=this.parseImage(ve[De]);be[Ce.RelativeFilename||Ce.Filename]=Nt}}}}for(const ve in ae){const De=ae[ve];be[De]!==void 0?ae[ve]=be[De]:ae[ve]=ae[ve].split("\\").pop()}return ae}parseImage(ae){const be=ae.Content,ve=ae.RelativeFilename||ae.Filename,De=ve.slice(ve.lastIndexOf(".")+1).toLowerCase();let Ce;switch(De){case"bmp":Ce="image/bmp";break;case"jpg":case"jpeg":Ce="image/jpeg";break;case"png":Ce="image/png";break;case"tif":Ce="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",ve),Ce="image/tga";break;default:console.warn('FBXLoader: Image type "'+De+'" is not supported.');return}if(typeof be=="string")return"data:"+Ce+";base64,"+be;{const Vt=new Uint8Array(be);return window.URL.createObjectURL(new Blob([Vt],{type:Ce}))}}parseTextures(ae){const be=new Map;if("Texture"in F.Objects){const ve=F.Objects.Texture;for(const De in ve){const Ce=this.parseTexture(ve[De],ae);be.set(parseInt(De),Ce)}}return be}parseTexture(ae,be){const ve=this.loadTexture(ae,be);ve.ID=ae.id,ve.name=ae.attrName;const De=ae.WrapModeU,Ce=ae.WrapModeV,Vt=De!==void 0?De.value:0,zt=Ce!==void 0?Ce.value:0;if(ve.wrapS=Vt===0?p.RepeatWrapping:p.ClampToEdgeWrapping,ve.wrapT=zt===0?p.RepeatWrapping:p.ClampToEdgeWrapping,"Scaling"in ae){const mt=ae.Scaling.value;ve.repeat.x=mt[0],ve.repeat.y=mt[1]}return ve}loadTexture(ae,be){let ve;const De=this.textureLoader.path,Ce=q.get(ae.id).children;Ce!==void 0&&Ce.length>0&&be[Ce[0].ID]!==void 0&&(ve=be[Ce[0].ID],(ve.indexOf("blob:")===0||ve.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let Vt;const zt=ae.FileName.slice(-3).toLowerCase();if(zt==="tga"){const mt=this.manager.getHandler(".tga");mt===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",ae.RelativeFilename),Vt=new p.Texture):(mt.setPath(this.textureLoader.path),Vt=mt.load(ve))}else zt==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",ae.RelativeFilename),Vt=new p.Texture):Vt=this.textureLoader.load(ve);return this.textureLoader.setPath(De),Vt}parseMaterials(ae){const be=new Map;if("Material"in F.Objects){const ve=F.Objects.Material;for(const De in ve){const Ce=this.parseMaterial(ve[De],ae);Ce!==null&&be.set(parseInt(De),Ce)}}return be}parseMaterial(ae,be){const ve=ae.id,De=ae.attrName;let Ce=ae.ShadingModel;if(typeof Ce=="object"&&(Ce=Ce.value),!q.has(ve))return null;const Vt=this.parseParameters(ae,be,ve);let zt;switch(Ce.toLowerCase()){case"phong":zt=new p.MeshPhongMaterial;break;case"lambert":zt=new p.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to THREE.MeshPhongMaterial.',Ce),zt=new p.MeshPhongMaterial;break}return zt.setValues(Vt),zt.name=De,zt}parseParameters(ae,be,ve){const De={};ae.BumpFactor&&(De.bumpScale=ae.BumpFactor.value),ae.Diffuse?De.color=new p.Color().fromArray(ae.Diffuse.value):ae.DiffuseColor&&(ae.DiffuseColor.type==="Color"||ae.DiffuseColor.type==="ColorRGB")&&(De.color=new p.Color().fromArray(ae.DiffuseColor.value)),ae.DisplacementFactor&&(De.displacementScale=ae.DisplacementFactor.value),ae.Emissive?De.emissive=new p.Color().fromArray(ae.Emissive.value):ae.EmissiveColor&&(ae.EmissiveColor.type==="Color"||ae.EmissiveColor.type==="ColorRGB")&&(De.emissive=new p.Color().fromArray(ae.EmissiveColor.value)),ae.EmissiveFactor&&(De.emissiveIntensity=parseFloat(ae.EmissiveFactor.value)),ae.Opacity&&(De.opacity=parseFloat(ae.Opacity.value)),De.opacity<1&&(De.transparent=!0),ae.ReflectionFactor&&(De.reflectivity=ae.ReflectionFactor.value),ae.Shininess&&(De.shininess=ae.Shininess.value),ae.Specular?De.specular=new p.Color().fromArray(ae.Specular.value):ae.SpecularColor&&ae.SpecularColor.type==="Color"&&(De.specular=new p.Color().fromArray(ae.SpecularColor.value));const Ce=this;return q.get(ve).children.forEach(function(Vt){const zt=Vt.relationship;switch(zt){case"Bump":De.bumpMap=Ce.getTexture(be,Vt.ID);break;case"Maya|TEX_ao_map":De.aoMap=Ce.getTexture(be,Vt.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":De.map=Ce.getTexture(be,Vt.ID),De.map!==void 0&&(De.map.encoding=p.sRGBEncoding);break;case"DisplacementColor":De.displacementMap=Ce.getTexture(be,Vt.ID);break;case"EmissiveColor":De.emissiveMap=Ce.getTexture(be,Vt.ID),De.emissiveMap!==void 0&&(De.emissiveMap.encoding=p.sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":De.normalMap=Ce.getTexture(be,Vt.ID);break;case"ReflectionColor":De.envMap=Ce.getTexture(be,Vt.ID),De.envMap!==void 0&&(De.envMap.mapping=p.EquirectangularReflectionMapping,De.envMap.encoding=p.sRGBEncoding);break;case"SpecularColor":De.specularMap=Ce.getTexture(be,Vt.ID),De.specularMap!==void 0&&(De.specularMap.encoding=p.sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":De.alphaMap=Ce.getTexture(be,Vt.ID),De.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",zt);break}}),De}getTexture(ae,be){return"LayeredTexture"in F.Objects&&be in F.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),be=q.get(be).children[0].ID),ae.get(be)}parseDeformers(){const ae={},be={};if("Deformer"in F.Objects){const ve=F.Objects.Deformer;for(const De in ve){const Ce=ve[De],Vt=q.get(parseInt(De));if(Ce.attrType==="Skin"){const zt=this.parseSkeleton(Vt,ve);zt.ID=De,Vt.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),zt.geometryID=Vt.parents[0].ID,ae[De]=zt}else if(Ce.attrType==="BlendShape"){const zt={id:De};zt.rawTargets=this.parseMorphTargets(Vt,ve),zt.id=De,Vt.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),be[De]=zt}}}return{skeletons:ae,morphTargets:be}}parseSkeleton(ae,be){const ve=[];return ae.children.forEach(function(De){const Ce=be[De.ID];if(Ce.attrType!=="Cluster")return;const Vt={ID:De.ID,indices:[],weights:[],transformLink:new p.Matrix4().fromArray(Ce.TransformLink.a)};"Indexes"in Ce&&(Vt.indices=Ce.Indexes.a,Vt.weights=Ce.Weights.a),ve.push(Vt)}),{rawBones:ve,bones:[]}}parseMorphTargets(ae,be){const ve=[];for(let De=0;De<ae.children.length;De++){const Ce=ae.children[De],Vt=be[Ce.ID],zt={name:Vt.attrName,initialWeight:Vt.DeformPercent,id:Vt.id,fullWeights:Vt.FullWeights.a};if(Vt.attrType!=="BlendShapeChannel")return;zt.geoID=q.get(parseInt(Ce.ID)).children.filter(function(mt){return mt.relationship===void 0})[0].ID,ve.push(zt)}return ve}parseScene(ae,be,ve){V=new p.Group;const De=this.parseModels(ae.skeletons,be,ve),Ce=F.Objects.Model,Vt=this;De.forEach(function(mt){const Nt=Ce[mt.ID];Vt.setLookAtProperties(mt,Nt),q.get(mt.ID).parents.forEach(function(ii){const zi=De.get(ii.ID);zi!==void 0&&zi.add(mt)}),mt.parent===null&&V.add(mt)}),this.bindSkeleton(ae.skeletons,be,De),this.createAmbientLight(),V.traverse(function(mt){if(mt.userData.transformData){mt.parent&&(mt.userData.transformData.parentMatrix=mt.parent.matrix,mt.userData.transformData.parentMatrixWorld=mt.parent.matrixWorld);const Nt=Ye(mt.userData.transformData);mt.applyMatrix4(Nt),mt.updateWorldMatrix()}});const zt=new ce().parse();V.children.length===1&&V.children[0].isGroup&&(V.children[0].animations=zt,V=V.children[0]),V.animations=zt}parseModels(ae,be,ve){const De=new Map,Ce=F.Objects.Model;for(const Vt in Ce){const zt=parseInt(Vt),mt=Ce[Vt],Nt=q.get(zt);let Gt=this.buildSkeleton(Nt,ae,zt,mt.attrName);if(!Gt){switch(mt.attrType){case"Camera":Gt=this.createCamera(Nt);break;case"Light":Gt=this.createLight(Nt);break;case"Mesh":Gt=this.createMesh(Nt,be,ve);break;case"NurbsCurve":Gt=this.createCurve(Nt,be);break;case"LimbNode":case"Root":Gt=new p.Bone;break;case"Null":default:Gt=new p.Group;break}Gt.name=mt.attrName?p.PropertyBinding.sanitizeNodeName(mt.attrName):"",Gt.ID=zt}this.getTransformData(Gt,mt),De.set(zt,Gt)}return De}buildSkeleton(ae,be,ve,De){let Ce=null;return ae.parents.forEach(function(Vt){for(const zt in be){const mt=be[zt];mt.rawBones.forEach(function(Nt,Gt){if(Nt.ID===Vt.ID){const ii=Ce;Ce=new p.Bone,Ce.matrixWorld.copy(Nt.transformLink),Ce.name=De?p.PropertyBinding.sanitizeNodeName(De):"",Ce.ID=ve,mt.bones[Gt]=Ce,ii!==null&&Ce.add(ii)}})}}),Ce}createCamera(ae){let be,ve;if(ae.children.forEach(function(De){const Ce=F.Objects.NodeAttribute[De.ID];Ce!==void 0&&(ve=Ce)}),ve===void 0)be=new p.Object3D;else{let De=0;ve.CameraProjectionType!==void 0&&ve.CameraProjectionType.value===1&&(De=1);let Ce=1;ve.NearPlane!==void 0&&(Ce=ve.NearPlane.value/1e3);let Vt=1e3;ve.FarPlane!==void 0&&(Vt=ve.FarPlane.value/1e3);let zt=window.innerWidth,mt=window.innerHeight;ve.AspectWidth!==void 0&&ve.AspectHeight!==void 0&&(zt=ve.AspectWidth.value,mt=ve.AspectHeight.value);const Nt=zt/mt;let Gt=45;ve.FieldOfView!==void 0&&(Gt=ve.FieldOfView.value);const ii=ve.FocalLength?ve.FocalLength.value:null;switch(De){case 0:be=new p.PerspectiveCamera(Gt,Nt,Ce,Vt),ii!==null&&be.setFocalLength(ii);break;case 1:be=new p.OrthographicCamera(-zt/2,zt/2,mt/2,-mt/2,Ce,Vt);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+De+"."),be=new p.Object3D;break}}return be}createLight(ae){let be,ve;if(ae.children.forEach(function(De){const Ce=F.Objects.NodeAttribute[De.ID];Ce!==void 0&&(ve=Ce)}),ve===void 0)be=new p.Object3D;else{let De;ve.LightType===void 0?De=0:De=ve.LightType.value;let Ce=16777215;ve.Color!==void 0&&(Ce=new p.Color().fromArray(ve.Color.value));let Vt=ve.Intensity===void 0?1:ve.Intensity.value/100;ve.CastLightOnObject!==void 0&&ve.CastLightOnObject.value===0&&(Vt=0);let zt=0;ve.FarAttenuationEnd!==void 0&&(ve.EnableFarAttenuation!==void 0&&ve.EnableFarAttenuation.value===0?zt=0:zt=ve.FarAttenuationEnd.value);const mt=1;switch(De){case 0:be=new p.PointLight(Ce,Vt,zt,mt);break;case 1:be=new p.DirectionalLight(Ce,Vt);break;case 2:let Nt=Math.PI/3;ve.InnerAngle!==void 0&&(Nt=p.MathUtils.degToRad(ve.InnerAngle.value));let Gt=0;ve.OuterAngle!==void 0&&(Gt=p.MathUtils.degToRad(ve.OuterAngle.value),Gt=Math.max(Gt,1)),be=new p.SpotLight(Ce,Vt,zt,Nt,Gt,mt);break;default:console.warn("THREE.FBXLoader: Unknown light type "+ve.LightType.value+", defaulting to a THREE.PointLight."),be=new p.PointLight(Ce,Vt);break}ve.CastShadows!==void 0&&ve.CastShadows.value===1&&(be.castShadow=!0)}return be}createMesh(ae,be,ve){let De,Ce=null,Vt=null;const zt=[];return ae.children.forEach(function(mt){be.has(mt.ID)&&(Ce=be.get(mt.ID)),ve.has(mt.ID)&&zt.push(ve.get(mt.ID))}),zt.length>1?Vt=zt:zt.length>0?Vt=zt[0]:(Vt=new p.MeshPhongMaterial({color:13421772}),zt.push(Vt)),"color"in Ce.attributes&&zt.forEach(function(mt){mt.vertexColors=!0}),Ce.FBX_Deformer?(De=new p.SkinnedMesh(Ce,Vt),De.normalizeSkinWeights()):De=new p.Mesh(Ce,Vt),De}createCurve(ae,be){const ve=ae.children.reduce(function(Ce,Vt){return be.has(Vt.ID)&&(Ce=be.get(Vt.ID)),Ce},null),De=new p.LineBasicMaterial({color:3342591,linewidth:1});return new p.Line(ve,De)}getTransformData(ae,be){const ve={};"InheritType"in be&&(ve.inheritType=parseInt(be.InheritType.value)),"RotationOrder"in be?ve.eulerOrder=ot(be.RotationOrder.value):ve.eulerOrder="ZYX","Lcl_Translation"in be&&(ve.translation=be.Lcl_Translation.value),"PreRotation"in be&&(ve.preRotation=be.PreRotation.value),"Lcl_Rotation"in be&&(ve.rotation=be.Lcl_Rotation.value),"PostRotation"in be&&(ve.postRotation=be.PostRotation.value),"Lcl_Scaling"in be&&(ve.scale=be.Lcl_Scaling.value),"ScalingOffset"in be&&(ve.scalingOffset=be.ScalingOffset.value),"ScalingPivot"in be&&(ve.scalingPivot=be.ScalingPivot.value),"RotationOffset"in be&&(ve.rotationOffset=be.RotationOffset.value),"RotationPivot"in be&&(ve.rotationPivot=be.RotationPivot.value),ae.userData.transformData=ve}setLookAtProperties(ae,be){"LookAtProperty"in be&&q.get(ae.ID).children.forEach(function(De){if(De.relationship==="LookAtProperty"){const Ce=F.Objects.Model[De.ID];if("Lcl_Translation"in Ce){const Vt=Ce.Lcl_Translation.value;ae.target!==void 0?(ae.target.position.fromArray(Vt),V.add(ae.target)):ae.lookAt(new p.Vector3().fromArray(Vt))}}})}bindSkeleton(ae,be,ve){const De=this.parsePoseNodes();for(const Ce in ae){const Vt=ae[Ce];q.get(parseInt(Vt.ID)).parents.forEach(function(mt){if(be.has(mt.ID)){const Nt=mt.ID;q.get(Nt).parents.forEach(function(ii){ve.has(ii.ID)&&ve.get(ii.ID).bind(new p.Skeleton(Vt.bones),De[ii.ID])})}})}}parsePoseNodes(){const ae={};if("Pose"in F.Objects){const be=F.Objects.Pose;for(const ve in be)if(be[ve].attrType==="BindPose"){const De=be[ve].PoseNode;Array.isArray(De)?De.forEach(function(Ce){ae[Ce.Node]=new p.Matrix4().fromArray(Ce.Matrix.a)}):ae[De.Node]=new p.Matrix4().fromArray(De.Matrix.a)}}return ae}createAmbientLight(){if("GlobalSettings"in F&&"AmbientColor"in F.GlobalSettings){const ae=F.GlobalSettings.AmbientColor.value,be=ae[0],ve=ae[1],De=ae[2];if(be!==0||ve!==0||De!==0){const Ce=new p.Color(be,ve,De);V.add(new p.AmbientLight(Ce,1))}}}}class re{parse(ae){const be=new Map;if("Geometry"in F.Objects){const ve=F.Objects.Geometry;for(const De in ve){const Ce=q.get(parseInt(De)),Vt=this.parseGeometry(Ce,ve[De],ae);be.set(parseInt(De),Vt)}}return be}parseGeometry(ae,be,ve){switch(be.attrType){case"Mesh":return this.parseMeshGeometry(ae,be,ve);case"NurbsCurve":return this.parseNurbsGeometry(be)}}parseMeshGeometry(ae,be,ve){const De=ve.skeletons,Ce=[],Vt=ae.parents.map(function(ii){return F.Objects.Model[ii.ID]});if(Vt.length===0)return;const zt=ae.children.reduce(function(ii,zi){return De[zi.ID]!==void 0&&(ii=De[zi.ID]),ii},null);ae.children.forEach(function(ii){ve.morphTargets[ii.ID]!==void 0&&Ce.push(ve.morphTargets[ii.ID])});const mt=Vt[0],Nt={};"RotationOrder"in mt&&(Nt.eulerOrder=ot(mt.RotationOrder.value)),"InheritType"in mt&&(Nt.inheritType=parseInt(mt.InheritType.value)),"GeometricTranslation"in mt&&(Nt.translation=mt.GeometricTranslation.value),"GeometricRotation"in mt&&(Nt.rotation=mt.GeometricRotation.value),"GeometricScaling"in mt&&(Nt.scale=mt.GeometricScaling.value);const Gt=Ye(Nt);return this.genGeometry(be,zt,Ce,Gt)}genGeometry(ae,be,ve,De){const Ce=new p.BufferGeometry;ae.attrName&&(Ce.name=ae.attrName);const Vt=this.parseGeoNode(ae,be),zt=this.genBuffers(Vt),mt=new p.Float32BufferAttribute(zt.vertex,3);if(mt.applyMatrix4(De),Ce.setAttribute("position",mt),zt.colors.length>0&&Ce.setAttribute("color",new p.Float32BufferAttribute(zt.colors,3)),be&&(Ce.setAttribute("skinIndex",new p.Uint16BufferAttribute(zt.weightsIndices,4)),Ce.setAttribute("skinWeight",new p.Float32BufferAttribute(zt.vertexWeights,4)),Ce.FBX_Deformer=be),zt.normal.length>0){const Nt=new p.Matrix3().getNormalMatrix(De),Gt=new p.Float32BufferAttribute(zt.normal,3);Gt.applyNormalMatrix(Nt),Ce.setAttribute("normal",Gt)}if(zt.uvs.forEach(function(Nt,Gt){let ii="uv"+(Gt+1).toString();Gt===0&&(ii="uv"),Ce.setAttribute(ii,new p.Float32BufferAttribute(zt.uvs[Gt],2))}),Vt.material&&Vt.material.mappingType!=="AllSame"){let Nt=zt.materialIndex[0],Gt=0;if(zt.materialIndex.forEach(function(ii,zi){ii!==Nt&&(Ce.addGroup(Gt,zi-Gt,Nt),Nt=ii,Gt=zi)}),Ce.groups.length>0){const ii=Ce.groups[Ce.groups.length-1],zi=ii.start+ii.count;zi!==zt.materialIndex.length&&Ce.addGroup(zi,zt.materialIndex.length-zi,Nt)}Ce.groups.length===0&&Ce.addGroup(0,zt.materialIndex.length,zt.materialIndex[0])}return this.addMorphTargets(Ce,ae,ve,De),Ce}parseGeoNode(ae,be){const ve={};if(ve.vertexPositions=ae.Vertices!==void 0?ae.Vertices.a:[],ve.vertexIndices=ae.PolygonVertexIndex!==void 0?ae.PolygonVertexIndex.a:[],ae.LayerElementColor&&(ve.color=this.parseVertexColors(ae.LayerElementColor[0])),ae.LayerElementMaterial&&(ve.material=this.parseMaterialIndices(ae.LayerElementMaterial[0])),ae.LayerElementNormal&&(ve.normal=this.parseNormals(ae.LayerElementNormal[0])),ae.LayerElementUV){ve.uv=[];let De=0;for(;ae.LayerElementUV[De];)ae.LayerElementUV[De].UV&&ve.uv.push(this.parseUVs(ae.LayerElementUV[De])),De++}return ve.weightTable={},be!==null&&(ve.skeleton=be,be.rawBones.forEach(function(De,Ce){De.indices.forEach(function(Vt,zt){ve.weightTable[Vt]===void 0&&(ve.weightTable[Vt]=[]),ve.weightTable[Vt].push({id:Ce,weight:De.weights[zt]})})})),ve}genBuffers(ae){const be={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let ve=0,De=0,Ce=!1,Vt=[],zt=[],mt=[],Nt=[],Gt=[],ii=[];const zi=this;return ae.vertexIndices.forEach(function(Hi,on){let mn,Qe=!1;Hi<0&&(Hi=Hi^-1,Qe=!0);let Yn=[],pr=[];if(Vt.push(Hi*3,Hi*3+1,Hi*3+2),ae.color){const bt=Zt(on,ve,Hi,ae.color);mt.push(bt[0],bt[1],bt[2])}if(ae.skeleton){if(ae.weightTable[Hi]!==void 0&&ae.weightTable[Hi].forEach(function(bt){pr.push(bt.weight),Yn.push(bt.id)}),pr.length>4){Ce||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),Ce=!0);const bt=[0,0,0,0],je=[0,0,0,0];pr.forEach(function(Ot,Le){let Ie=Ot,Fe=Yn[Le];je.forEach(function(Ge,Je,st){if(Ie>Ge){st[Je]=Ie,Ie=Ge;const lt=bt[Je];bt[Je]=Fe,Fe=lt}})}),Yn=bt,pr=je}for(;pr.length<4;)pr.push(0),Yn.push(0);for(let bt=0;bt<4;++bt)Gt.push(pr[bt]),ii.push(Yn[bt])}if(ae.normal){const bt=Zt(on,ve,Hi,ae.normal);zt.push(bt[0],bt[1],bt[2])}ae.material&&ae.material.mappingType!=="AllSame"&&(mn=Zt(on,ve,Hi,ae.material)[0]),ae.uv&&ae.uv.forEach(function(bt,je){const Ot=Zt(on,ve,Hi,bt);Nt[je]===void 0&&(Nt[je]=[]),Nt[je].push(Ot[0]),Nt[je].push(Ot[1])}),De++,Qe&&(zi.genFace(be,ae,Vt,mn,zt,mt,Nt,Gt,ii,De),ve++,De=0,Vt=[],zt=[],mt=[],Nt=[],Gt=[],ii=[])}),be}genFace(ae,be,ve,De,Ce,Vt,zt,mt,Nt,Gt){for(let ii=2;ii<Gt;ii++)ae.vertex.push(be.vertexPositions[ve[0]]),ae.vertex.push(be.vertexPositions[ve[1]]),ae.vertex.push(be.vertexPositions[ve[2]]),ae.vertex.push(be.vertexPositions[ve[(ii-1)*3]]),ae.vertex.push(be.vertexPositions[ve[(ii-1)*3+1]]),ae.vertex.push(be.vertexPositions[ve[(ii-1)*3+2]]),ae.vertex.push(be.vertexPositions[ve[ii*3]]),ae.vertex.push(be.vertexPositions[ve[ii*3+1]]),ae.vertex.push(be.vertexPositions[ve[ii*3+2]]),be.skeleton&&(ae.vertexWeights.push(mt[0]),ae.vertexWeights.push(mt[1]),ae.vertexWeights.push(mt[2]),ae.vertexWeights.push(mt[3]),ae.vertexWeights.push(mt[(ii-1)*4]),ae.vertexWeights.push(mt[(ii-1)*4+1]),ae.vertexWeights.push(mt[(ii-1)*4+2]),ae.vertexWeights.push(mt[(ii-1)*4+3]),ae.vertexWeights.push(mt[ii*4]),ae.vertexWeights.push(mt[ii*4+1]),ae.vertexWeights.push(mt[ii*4+2]),ae.vertexWeights.push(mt[ii*4+3]),ae.weightsIndices.push(Nt[0]),ae.weightsIndices.push(Nt[1]),ae.weightsIndices.push(Nt[2]),ae.weightsIndices.push(Nt[3]),ae.weightsIndices.push(Nt[(ii-1)*4]),ae.weightsIndices.push(Nt[(ii-1)*4+1]),ae.weightsIndices.push(Nt[(ii-1)*4+2]),ae.weightsIndices.push(Nt[(ii-1)*4+3]),ae.weightsIndices.push(Nt[ii*4]),ae.weightsIndices.push(Nt[ii*4+1]),ae.weightsIndices.push(Nt[ii*4+2]),ae.weightsIndices.push(Nt[ii*4+3])),be.color&&(ae.colors.push(Vt[0]),ae.colors.push(Vt[1]),ae.colors.push(Vt[2]),ae.colors.push(Vt[(ii-1)*3]),ae.colors.push(Vt[(ii-1)*3+1]),ae.colors.push(Vt[(ii-1)*3+2]),ae.colors.push(Vt[ii*3]),ae.colors.push(Vt[ii*3+1]),ae.colors.push(Vt[ii*3+2])),be.material&&be.material.mappingType!=="AllSame"&&(ae.materialIndex.push(De),ae.materialIndex.push(De),ae.materialIndex.push(De)),be.normal&&(ae.normal.push(Ce[0]),ae.normal.push(Ce[1]),ae.normal.push(Ce[2]),ae.normal.push(Ce[(ii-1)*3]),ae.normal.push(Ce[(ii-1)*3+1]),ae.normal.push(Ce[(ii-1)*3+2]),ae.normal.push(Ce[ii*3]),ae.normal.push(Ce[ii*3+1]),ae.normal.push(Ce[ii*3+2])),be.uv&&be.uv.forEach(function(zi,Hi){ae.uvs[Hi]===void 0&&(ae.uvs[Hi]=[]),ae.uvs[Hi].push(zt[Hi][0]),ae.uvs[Hi].push(zt[Hi][1]),ae.uvs[Hi].push(zt[Hi][(ii-1)*2]),ae.uvs[Hi].push(zt[Hi][(ii-1)*2+1]),ae.uvs[Hi].push(zt[Hi][ii*2]),ae.uvs[Hi].push(zt[Hi][ii*2+1])})}addMorphTargets(ae,be,ve,De){if(ve.length===0)return;ae.morphTargetsRelative=!0,ae.morphAttributes.position=[];const Ce=this;ve.forEach(function(Vt){Vt.rawTargets.forEach(function(zt){const mt=F.Objects.Geometry[zt.geoID];mt!==void 0&&Ce.genMorphGeometry(ae,be,mt,De,zt.name)})})}genMorphGeometry(ae,be,ve,De,Ce){const Vt=be.PolygonVertexIndex!==void 0?be.PolygonVertexIndex.a:[],zt=ve.Vertices!==void 0?ve.Vertices.a:[],mt=ve.Indexes!==void 0?ve.Indexes.a:[],Nt=ae.attributes.position.count*3,Gt=new Float32Array(Nt);for(let on=0;on<mt.length;on++){const mn=mt[on]*3;Gt[mn]=zt[on*3],Gt[mn+1]=zt[on*3+1],Gt[mn+2]=zt[on*3+2]}const ii={vertexIndices:Vt,vertexPositions:Gt},zi=this.genBuffers(ii),Hi=new p.Float32BufferAttribute(zi.vertex,3);Hi.name=Ce||ve.attrName,Hi.applyMatrix4(De),ae.morphAttributes.position.push(Hi)}parseNormals(ae){const be=ae.MappingInformationType,ve=ae.ReferenceInformationType,De=ae.Normals.a;let Ce=[];return ve==="IndexToDirect"&&("NormalIndex"in ae?Ce=ae.NormalIndex.a:"NormalsIndex"in ae&&(Ce=ae.NormalsIndex.a)),{dataSize:3,buffer:De,indices:Ce,mappingType:be,referenceType:ve}}parseUVs(ae){const be=ae.MappingInformationType,ve=ae.ReferenceInformationType,De=ae.UV.a;let Ce=[];return ve==="IndexToDirect"&&(Ce=ae.UVIndex.a),{dataSize:2,buffer:De,indices:Ce,mappingType:be,referenceType:ve}}parseVertexColors(ae){const be=ae.MappingInformationType,ve=ae.ReferenceInformationType,De=ae.Colors.a;let Ce=[];return ve==="IndexToDirect"&&(Ce=ae.ColorIndex.a),{dataSize:4,buffer:De,indices:Ce,mappingType:be,referenceType:ve}}parseMaterialIndices(ae){const be=ae.MappingInformationType,ve=ae.ReferenceInformationType;if(be==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:ve};const De=ae.Materials.a,Ce=[];for(let Vt=0;Vt<De.length;++Vt)Ce.push(Vt);return{dataSize:1,buffer:De,indices:Ce,mappingType:be,referenceType:ve}}parseNurbsGeometry(ae){if(p.NURBSCurve===void 0)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new p.BufferGeometry;const be=parseInt(ae.Order);if(isNaN(be))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",ae.Order,ae.id),new p.BufferGeometry;const ve=be-1,De=ae.KnotVector.a,Ce=[],Vt=ae.Points.a;for(let ii=0,zi=Vt.length;ii<zi;ii+=4)Ce.push(new p.Vector4().fromArray(Vt,ii));let zt,mt;if(ae.Form==="Closed")Ce.push(Ce[0]);else if(ae.Form==="Periodic"){zt=ve,mt=De.length-1-zt;for(let ii=0;ii<ve;++ii)Ce.push(Ce[ii])}const Gt=new p.NURBSCurve(ve,De,Ce,zt,mt).getPoints(Ce.length*12);return new p.BufferGeometry().setFromPoints(Gt)}}class ce{parse(){const ae=[],be=this.parseClips();if(be!==void 0)for(const ve in be){const De=be[ve],Ce=this.addClip(De);ae.push(Ce)}return ae}parseClips(){if(F.Objects.AnimationCurve===void 0)return;const ae=this.parseAnimationCurveNodes();this.parseAnimationCurves(ae);const be=this.parseAnimationLayers(ae);return this.parseAnimStacks(be)}parseAnimationCurveNodes(){const ae=F.Objects.AnimationCurveNode,be=new Map;for(const ve in ae){const De=ae[ve];if(De.attrName.match(/S|R|T|DeformPercent/)!==null){const Ce={id:De.id,attr:De.attrName,curves:{}};be.set(Ce.id,Ce)}}return be}parseAnimationCurves(ae){const be=F.Objects.AnimationCurve;for(const ve in be){const De={id:be[ve].id,times:be[ve].KeyTime.a.map(pt),values:be[ve].KeyValueFloat.a},Ce=q.get(De.id);if(Ce!==void 0){const Vt=Ce.parents[0].ID,zt=Ce.parents[0].relationship;zt.match(/X/)?ae.get(Vt).curves.x=De:zt.match(/Y/)?ae.get(Vt).curves.y=De:zt.match(/Z/)?ae.get(Vt).curves.z=De:zt.match(/d|DeformPercent/)&&ae.has(Vt)&&(ae.get(Vt).curves.morph=De)}}}parseAnimationLayers(ae){const be=F.Objects.AnimationLayer,ve=new Map;for(const De in be){const Ce=[],Vt=q.get(parseInt(De));Vt!==void 0&&(Vt.children.forEach(function(mt,Nt){if(ae.has(mt.ID)){const Gt=ae.get(mt.ID);if(Gt.curves.x!==void 0||Gt.curves.y!==void 0||Gt.curves.z!==void 0){if(Ce[Nt]===void 0){const ii=q.get(mt.ID).parents.filter(function(zi){return zi.relationship!==void 0})[0].ID;if(ii!==void 0){const zi=F.Objects.Model[ii.toString()];if(zi===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",mt);return}const Hi={modelName:zi.attrName?p.PropertyBinding.sanitizeNodeName(zi.attrName):"",ID:zi.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};V.traverse(function(on){on.ID===zi.id&&(Hi.transform=on.matrix,on.userData.transformData&&(Hi.eulerOrder=on.userData.transformData.eulerOrder))}),Hi.transform||(Hi.transform=new p.Matrix4),"PreRotation"in zi&&(Hi.preRotation=zi.PreRotation.value),"PostRotation"in zi&&(Hi.postRotation=zi.PostRotation.value),Ce[Nt]=Hi}}Ce[Nt]&&(Ce[Nt][Gt.attr]=Gt)}else if(Gt.curves.morph!==void 0){if(Ce[Nt]===void 0){const ii=q.get(mt.ID).parents.filter(function(Yn){return Yn.relationship!==void 0})[0].ID,zi=q.get(ii).parents[0].ID,Hi=q.get(zi).parents[0].ID,on=q.get(Hi).parents[0].ID,mn=F.Objects.Model[on],Qe={modelName:mn.attrName?p.PropertyBinding.sanitizeNodeName(mn.attrName):"",morphName:F.Objects.Deformer[ii].attrName};Ce[Nt]=Qe}Ce[Nt][Gt.attr]=Gt}}}),ve.set(parseInt(De),Ce))}return ve}parseAnimStacks(ae){const be=F.Objects.AnimationStack,ve={};for(const De in be){const Ce=q.get(parseInt(De)).children;Ce.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const Vt=ae.get(Ce[0].ID);ve[De]={name:be[De].attrName,layer:Vt}}return ve}addClip(ae){let be=[];const ve=this;return ae.layer.forEach(function(De){be=be.concat(ve.generateTracks(De))}),new p.AnimationClip(ae.name,-1,be)}generateTracks(ae){const be=[];let ve=new p.Vector3,De=new p.Quaternion,Ce=new p.Vector3;if(ae.transform&&ae.transform.decompose(ve,De,Ce),ve=ve.toArray(),De=new p.Euler().setFromQuaternion(De,ae.eulerOrder).toArray(),Ce=Ce.toArray(),ae.T!==void 0&&Object.keys(ae.T.curves).length>0){const Vt=this.generateVectorTrack(ae.modelName,ae.T.curves,ve,"position");Vt!==void 0&&be.push(Vt)}if(ae.R!==void 0&&Object.keys(ae.R.curves).length>0){const Vt=this.generateRotationTrack(ae.modelName,ae.R.curves,De,ae.preRotation,ae.postRotation,ae.eulerOrder);Vt!==void 0&&be.push(Vt)}if(ae.S!==void 0&&Object.keys(ae.S.curves).length>0){const Vt=this.generateVectorTrack(ae.modelName,ae.S.curves,Ce,"scale");Vt!==void 0&&be.push(Vt)}if(ae.DeformPercent!==void 0){const Vt=this.generateMorphTrack(ae);Vt!==void 0&&be.push(Vt)}return be}generateVectorTrack(ae,be,ve,De){const Ce=this.getTimesForAllAxes(be),Vt=this.getKeyframeTrackValues(Ce,be,ve);return new p.VectorKeyframeTrack(ae+"."+De,Ce,Vt)}generateRotationTrack(ae,be,ve,De,Ce,Vt){be.x!==void 0&&(this.interpolateRotations(be.x),be.x.values=be.x.values.map(p.MathUtils.degToRad)),be.y!==void 0&&(this.interpolateRotations(be.y),be.y.values=be.y.values.map(p.MathUtils.degToRad)),be.z!==void 0&&(this.interpolateRotations(be.z),be.z.values=be.z.values.map(p.MathUtils.degToRad));const zt=this.getTimesForAllAxes(be),mt=this.getKeyframeTrackValues(zt,be,ve);De!==void 0&&(De=De.map(p.MathUtils.degToRad),De.push(Vt),De=new p.Euler().fromArray(De),De=new p.Quaternion().setFromEuler(De)),Ce!==void 0&&(Ce=Ce.map(p.MathUtils.degToRad),Ce.push(Vt),Ce=new p.Euler().fromArray(Ce),Ce=new p.Quaternion().setFromEuler(Ce).invert());const Nt=new p.Quaternion,Gt=new p.Euler,ii=[];for(let zi=0;zi<mt.length;zi+=3)Gt.set(mt[zi],mt[zi+1],mt[zi+2],Vt),Nt.setFromEuler(Gt),De!==void 0&&Nt.premultiply(De),Ce!==void 0&&Nt.multiply(Ce),Nt.toArray(ii,zi/3*4);return new p.QuaternionKeyframeTrack(ae+".quaternion",zt,ii)}generateMorphTrack(ae){const be=ae.DeformPercent.curves.morph,ve=be.values.map(function(Ce){return Ce/100}),De=V.getObjectByName(ae.modelName).morphTargetDictionary[ae.morphName];return new p.NumberKeyframeTrack(ae.modelName+".morphTargetInfluences["+De+"]",be.times,ve)}getTimesForAllAxes(ae){let be=[];if(ae.x!==void 0&&(be=be.concat(ae.x.times)),ae.y!==void 0&&(be=be.concat(ae.y.times)),ae.z!==void 0&&(be=be.concat(ae.z.times)),be=be.sort(function(ve,De){return ve-De}),be.length>1){let ve=1,De=be[0];for(let Ce=1;Ce<be.length;Ce++){const Vt=be[Ce];Vt!==De&&(be[ve]=Vt,De=Vt,ve++)}be=be.slice(0,ve)}return be}getKeyframeTrackValues(ae,be,ve){const De=ve,Ce=[];let Vt=-1,zt=-1,mt=-1;return ae.forEach(function(Nt){if(be.x&&(Vt=be.x.times.indexOf(Nt)),be.y&&(zt=be.y.times.indexOf(Nt)),be.z&&(mt=be.z.times.indexOf(Nt)),Vt!==-1){const Gt=be.x.values[Vt];Ce.push(Gt),De[0]=Gt}else Ce.push(De[0]);if(zt!==-1){const Gt=be.y.values[zt];Ce.push(Gt),De[1]=Gt}else Ce.push(De[1]);if(mt!==-1){const Gt=be.z.values[mt];Ce.push(Gt),De[2]=Gt}else Ce.push(De[2])}),Ce}interpolateRotations(ae){for(let be=1;be<ae.values.length;be++){const ve=ae.values[be-1],De=ae.values[be]-ve,Ce=Math.abs(De);if(Ce>=180){const Vt=Ce/180,zt=De/Vt;let mt=ve+zt;const Nt=ae.times[be-1],ii=(ae.times[be]-Nt)/Vt;let zi=Nt+ii;const Hi=[],on=[];for(;zi<ae.times[be];)Hi.push(zi),zi+=ii,on.push(mt),mt+=zt;ae.times=_t(ae.times,be,Hi),ae.values=_t(ae.values,be,on)}}}}class Se{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(ae){this.nodeStack.push(ae),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(ae,be){this.currentProp=ae,this.currentPropName=be}parse(ae){this.currentIndent=0,this.allNodes=new Ut,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const be=this,ve=ae.split(/[\r\n]+/);return ve.forEach(function(De,Ce){const Vt=De.match(/^[\s\t]*;/),zt=De.match(/^[\s\t]*$/);if(Vt||zt)return;const mt=De.match("^\\t{"+be.currentIndent+"}(\\w+):(.*){",""),Nt=De.match("^\\t{"+be.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),Gt=De.match("^\\t{"+(be.currentIndent-1)+"}}");mt?be.parseNodeBegin(De,mt):Nt?be.parseNodeProperty(De,Nt,ve[++Ce]):Gt?be.popStack():De.match(/^[^\s\t}]/)&&be.parseNodePropertyContinued(De)}),this.allNodes}parseNodeBegin(ae,be){const ve=be[1].trim().replace(/^"/,"").replace(/"$/,""),De=be[2].split(",").map(function(mt){return mt.trim().replace(/^"/,"").replace(/"$/,"")}),Ce={name:ve},Vt=this.parseNodeAttr(De),zt=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(ve,Ce):ve in zt?(ve==="PoseNode"?zt.PoseNode.push(Ce):zt[ve].id!==void 0&&(zt[ve]={},zt[ve][zt[ve].id]=zt[ve]),Vt.id!==""&&(zt[ve][Vt.id]=Ce)):typeof Vt.id=="number"?(zt[ve]={},zt[ve][Vt.id]=Ce):ve!=="Properties70"&&(ve==="PoseNode"?zt[ve]=[Ce]:zt[ve]=Ce),typeof Vt.id=="number"&&(Ce.id=Vt.id),Vt.name!==""&&(Ce.attrName=Vt.name),Vt.type!==""&&(Ce.attrType=Vt.type),this.pushStack(Ce)}parseNodeAttr(ae){let be=ae[0];ae[0]!==""&&(be=parseInt(ae[0]),isNaN(be)&&(be=ae[0]));let ve="",De="";return ae.length>1&&(ve=ae[1].replace(/^(\w+)::/,""),De=ae[2]),{id:be,name:ve,type:De}}parseNodeProperty(ae,be,ve){let De=be[1].replace(/^"/,"").replace(/"$/,"").trim(),Ce=be[2].replace(/^"/,"").replace(/"$/,"").trim();De==="Content"&&Ce===","&&(Ce=ve.replace(/"/g,"").replace(/,$/,"").trim());const Vt=this.getCurrentNode();if(Vt.name==="Properties70"){this.parseNodeSpecialProperty(ae,De,Ce);return}if(De==="C"){const mt=Ce.split(",").slice(1),Nt=parseInt(mt[0]),Gt=parseInt(mt[1]);let ii=Ce.split(",").slice(3);ii=ii.map(function(zi){return zi.trim().replace(/^"/,"")}),De="connections",Ce=[Nt,Gt],Rt(Ce,ii),Vt[De]===void 0&&(Vt[De]=[])}De==="Node"&&(Vt.id=Ce),De in Vt&&Array.isArray(Vt[De])?Vt[De].push(Ce):De!=="a"?Vt[De]=Ce:Vt.a=Ce,this.setCurrentProp(Vt,De),De==="a"&&Ce.slice(-1)!==","&&(Vt.a=tt(Ce))}parseNodePropertyContinued(ae){const be=this.getCurrentNode();be.a+=ae,ae.slice(-1)!==","&&(be.a=tt(be.a))}parseNodeSpecialProperty(ae,be,ve){const De=ve.split('",').map(function(Gt){return Gt.trim().replace(/^\"/,"").replace(/\s/,"_")}),Ce=De[0],Vt=De[1],zt=De[2],mt=De[3];let Nt=De[4];switch(Vt){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":Nt=parseFloat(Nt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":Nt=tt(Nt);break}this.getPrevNode()[Ce]={type:Vt,type2:zt,flag:mt,value:Nt},this.setCurrentProp(this.getPrevNode(),Ce)}}class Xe{parse(ae){const be=new ht(ae);be.skip(23);const ve=be.getUint32();if(ve<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+ve);const De=new Ut;for(;!this.endOfContent(be);){const Ce=this.parseNode(be,ve);Ce!==null&&De.add(Ce.name,Ce)}return De}endOfContent(ae){return ae.size()%16===0?(ae.getOffset()+160+16&-16)>=ae.size():ae.getOffset()+160+16>=ae.size()}parseNode(ae,be){const ve={},De=be>=7500?ae.getUint64():ae.getUint32(),Ce=be>=7500?ae.getUint64():ae.getUint32();be>=7500?ae.getUint64():ae.getUint32();const Vt=ae.getUint8(),zt=ae.getString(Vt);if(De===0)return null;const mt=[];for(let zi=0;zi<Ce;zi++)mt.push(this.parseProperty(ae));const Nt=mt.length>0?mt[0]:"",Gt=mt.length>1?mt[1]:"",ii=mt.length>2?mt[2]:"";for(ve.singleProperty=Ce===1&&ae.getOffset()===De;De>ae.getOffset();){const zi=this.parseNode(ae,be);zi!==null&&this.parseSubNode(zt,ve,zi)}return ve.propertyList=mt,typeof Nt=="number"&&(ve.id=Nt),Gt!==""&&(ve.attrName=Gt),ii!==""&&(ve.attrType=ii),zt!==""&&(ve.name=zt),ve}parseSubNode(ae,be,ve){if(ve.singleProperty===!0){const De=ve.propertyList[0];Array.isArray(De)?(be[ve.name]=ve,ve.a=De):be[ve.name]=De}else if(ae==="Connections"&&ve.name==="C"){const De=[];ve.propertyList.forEach(function(Ce,Vt){Vt!==0&&De.push(Ce)}),be.connections===void 0&&(be.connections=[]),be.connections.push(De)}else if(ve.name==="Properties70")Object.keys(ve).forEach(function(Ce){be[Ce]=ve[Ce]});else if(ae==="Properties70"&&ve.name==="P"){let De=ve.propertyList[0],Ce=ve.propertyList[1];const Vt=ve.propertyList[2],zt=ve.propertyList[3];let mt;De.indexOf("Lcl ")===0&&(De=De.replace("Lcl ","Lcl_")),Ce.indexOf("Lcl ")===0&&(Ce=Ce.replace("Lcl ","Lcl_")),Ce==="Color"||Ce==="ColorRGB"||Ce==="Vector"||Ce==="Vector3D"||Ce.indexOf("Lcl_")===0?mt=[ve.propertyList[4],ve.propertyList[5],ve.propertyList[6]]:mt=ve.propertyList[4],be[De]={type:Ce,type2:Vt,flag:zt,value:mt}}else be[ve.name]===void 0?typeof ve.id=="number"?(be[ve.name]={},be[ve.name][ve.id]=ve):be[ve.name]=ve:ve.name==="PoseNode"?(Array.isArray(be[ve.name])||(be[ve.name]=[be[ve.name]]),be[ve.name].push(ve)):be[ve.name][ve.id]===void 0&&(be[ve.name][ve.id]=ve)}parseProperty(ae){const be=ae.getString(1);let ve;switch(be){case"C":return ae.getBoolean();case"D":return ae.getFloat64();case"F":return ae.getFloat32();case"I":return ae.getInt32();case"L":return ae.getInt64();case"R":return ve=ae.getUint32(),ae.getArrayBuffer(ve);case"S":return ve=ae.getUint32(),ae.getString(ve);case"Y":return ae.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const De=ae.getUint32(),Ce=ae.getUint32(),Vt=ae.getUint32();if(Ce===0)switch(be){case"b":case"c":return ae.getBooleanArray(De);case"d":return ae.getFloat64Array(De);case"f":return ae.getFloat32Array(De);case"i":return ae.getInt32Array(De);case"l":return ae.getInt64Array(De)}typeof z>"u"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const zt=z.unzlibSync(new Uint8Array(ae.getArrayBuffer(Vt))),mt=new ht(zt.buffer);switch(be){case"b":case"c":return mt.getBooleanArray(De);case"d":return mt.getFloat64Array(De);case"f":return mt.getFloat32Array(De);case"i":return mt.getInt32Array(De);case"l":return mt.getInt64Array(De)}default:throw new Error("THREE.FBXLoader: Unknown property type "+be)}}}class ht{constructor(ae,be){this.dv=new DataView(ae),this.offset=0,this.littleEndian=be!==void 0?be:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(ae){this.offset+=ae}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(ae){const be=[];for(let ve=0;ve<ae;ve++)be.push(this.getBoolean());return be}getUint8(){const ae=this.dv.getUint8(this.offset);return this.offset+=1,ae}getInt16(){const ae=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,ae}getInt32(){const ae=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,ae}getInt32Array(ae){const be=[];for(let ve=0;ve<ae;ve++)be.push(this.getInt32());return be}getUint32(){const ae=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,ae}getInt64(){let ae,be;return this.littleEndian?(ae=this.getUint32(),be=this.getUint32()):(be=this.getUint32(),ae=this.getUint32()),be&2147483648?(be=~be&4294967295,ae=~ae&4294967295,ae===4294967295&&(be=be+1&4294967295),ae=ae+1&4294967295,-(be*4294967296+ae)):be*4294967296+ae}getInt64Array(ae){const be=[];for(let ve=0;ve<ae;ve++)be.push(this.getInt64());return be}getUint64(){let ae,be;return this.littleEndian?(ae=this.getUint32(),be=this.getUint32()):(be=this.getUint32(),ae=this.getUint32()),be*4294967296+ae}getFloat32(){const ae=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,ae}getFloat32Array(ae){const be=[];for(let ve=0;ve<ae;ve++)be.push(this.getFloat32());return be}getFloat64(){const ae=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,ae}getFloat64Array(ae){const be=[];for(let ve=0;ve<ae;ve++)be.push(this.getFloat64());return be}getArrayBuffer(ae){const be=this.dv.buffer.slice(this.offset,this.offset+ae);return this.offset+=ae,be}getString(ae){let be=[];for(let De=0;De<ae;De++)be[De]=this.getUint8();const ve=be.indexOf(0);return ve>=0&&(be=be.slice(0,ve)),p.LoaderUtils.decodeText(new Uint8Array(be))}}class Ut{add(ae,be){this[ae]=be}}function ct(Qt){const ae="Kaydara FBX Binary  \0";return Qt.byteLength>=ae.length&&ae===et(Qt,0,ae.length)}function Dt(Qt){const ae=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let be=0;function ve(De){const Ce=Qt[De-1];return Qt=Qt.slice(be+De),be++,Ce}for(let De=0;De<ae.length;++De)if(ve(1)===ae[De])return!1;return!0}function rt(Qt){const ae=/FBXVersion: (\d+)/,be=Qt.match(ae);if(be)return parseInt(be[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function pt(Qt){return Qt/46186158e3}const gi=[];function Zt(Qt,ae,be,ve){let De;switch(ve.mappingType){case"ByPolygonVertex":De=Qt;break;case"ByPolygon":De=ae;break;case"ByVertice":De=be;break;case"AllSame":De=ve.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+ve.mappingType)}ve.referenceType==="IndexToDirect"&&(De=ve.indices[De]);const Ce=De*ve.dataSize,Vt=Ce+ve.dataSize;return at(gi,ve.buffer,Ce,Vt)}const At=new p.Euler,It=new p.Vector3;function Ye(Qt){const ae=new p.Matrix4,be=new p.Matrix4,ve=new p.Matrix4,De=new p.Matrix4,Ce=new p.Matrix4,Vt=new p.Matrix4,zt=new p.Matrix4,mt=new p.Matrix4,Nt=new p.Matrix4,Gt=new p.Matrix4,ii=new p.Matrix4,zi=new p.Matrix4,Hi=Qt.inheritType?Qt.inheritType:0;if(Qt.translation&&ae.setPosition(It.fromArray(Qt.translation)),Qt.preRotation){const Je=Qt.preRotation.map(p.MathUtils.degToRad);Je.push(Qt.eulerOrder),be.makeRotationFromEuler(At.fromArray(Je))}if(Qt.rotation){const Je=Qt.rotation.map(p.MathUtils.degToRad);Je.push(Qt.eulerOrder),ve.makeRotationFromEuler(At.fromArray(Je))}if(Qt.postRotation){const Je=Qt.postRotation.map(p.MathUtils.degToRad);Je.push(Qt.eulerOrder),De.makeRotationFromEuler(At.fromArray(Je)),De.invert()}Qt.scale&&Ce.scale(It.fromArray(Qt.scale)),Qt.scalingOffset&&zt.setPosition(It.fromArray(Qt.scalingOffset)),Qt.scalingPivot&&Vt.setPosition(It.fromArray(Qt.scalingPivot)),Qt.rotationOffset&&mt.setPosition(It.fromArray(Qt.rotationOffset)),Qt.rotationPivot&&Nt.setPosition(It.fromArray(Qt.rotationPivot)),Qt.parentMatrixWorld&&(ii.copy(Qt.parentMatrix),Gt.copy(Qt.parentMatrixWorld));const on=be.clone().multiply(ve).multiply(De),mn=new p.Matrix4;mn.extractRotation(Gt);const Qe=new p.Matrix4;Qe.copyPosition(Gt);const Yn=Qe.clone().invert().multiply(Gt),pr=mn.clone().invert().multiply(Yn),bt=Ce,je=new p.Matrix4;if(Hi===0)je.copy(mn).multiply(on).multiply(pr).multiply(bt);else if(Hi===1)je.copy(mn).multiply(pr).multiply(on).multiply(bt);else{const st=new p.Matrix4().scale(new p.Vector3().setFromMatrixScale(ii)).clone().invert(),lt=pr.clone().multiply(st);je.copy(mn).multiply(on).multiply(lt).multiply(bt)}const Ot=Nt.clone().invert(),Le=Vt.clone().invert();let Ie=ae.clone().multiply(mt).multiply(Nt).multiply(be).multiply(ve).multiply(De).multiply(Ot).multiply(zt).multiply(Vt).multiply(Ce).multiply(Le);const Fe=new p.Matrix4().copyPosition(Ie),Ge=Gt.clone().multiply(Fe);return zi.copyPosition(Ge),Ie=zi.clone().multiply(je),Ie.premultiply(Gt.invert()),Ie}function ot(Qt){Qt=Qt||0;const ae=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return Qt===6?(console.warn("THREE.FBXLoader: unsupported THREE.Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),ae[0]):ae[Qt]}function tt(Qt){return Qt.split(",").map(function(be){return parseFloat(be)})}function et(Qt,ae,be){return ae===void 0&&(ae=0),be===void 0&&(be=Qt.byteLength),p.LoaderUtils.decodeText(new Uint8Array(Qt,ae,be))}function Rt(Qt,ae){for(let be=0,ve=Qt.length,De=ae.length;be<De;be++,ve++)Qt[ve]=ae[be]}function at(Qt,ae,be,ve){for(let De=be,Ce=0;De<ve;De++,Ce++)Qt[Ce]=ae[De];return Qt}function _t(Qt,ae,be){return Qt.slice(0,ae).concat(be).concat(Qt.slice(ae))}p.FBXLoader=n})(),v.exports=p.FBXLoader}(Ox)),Ox.exports}var zx={exports:{}},xM;function LI(){return xM||(xM=1,function(v,y){const p=za();(function(){class z extends p.Loader{constructor(Le){super(Le),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(Ie){return new J(Ie)}),this.register(function(Ie){return new ht(Ie)}),this.register(function(Ie){return new Ut(Ie)}),this.register(function(Ie){return new re(Ie)}),this.register(function(Ie){return new ce(Ie)}),this.register(function(Ie){return new Se(Ie)}),this.register(function(Ie){return new Xe(Ie)}),this.register(function(Ie){return new V(Ie)}),this.register(function(Ie){return new ct(Ie)})}load(Le,Ie,Fe,Ge){const Je=this;let st;this.resourcePath!==""?st=this.resourcePath:this.path!==""?st=this.path:st=p.LoaderUtils.extractUrlBase(Le),this.manager.itemStart(Le);const lt=function(Mt){Ge?Ge(Mt):console.error(Mt),Je.manager.itemError(Le),Je.manager.itemEnd(Le)},Tt=new p.FileLoader(this.manager);Tt.setPath(this.path),Tt.setResponseType("arraybuffer"),Tt.setRequestHeader(this.requestHeader),Tt.setWithCredentials(this.withCredentials),Tt.load(Le,function(Mt){try{Je.parse(Mt,st,function(ci){Ie(ci),Je.manager.itemEnd(Le)},lt)}catch(ci){lt(ci)}},Fe,lt)}setDRACOLoader(Le){return this.dracoLoader=Le,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(Le){return this.ktx2Loader=Le,this}setMeshoptDecoder(Le){return this.meshoptDecoder=Le,this}register(Le){return this.pluginCallbacks.indexOf(Le)===-1&&this.pluginCallbacks.push(Le),this}unregister(Le){return this.pluginCallbacks.indexOf(Le)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(Le),1),this}parse(Le,Ie,Fe,Ge){let Je;const st={},lt={};if(typeof Le=="string")Je=Le;else if(p.LoaderUtils.decodeText(new Uint8Array(Le,0,4))===Dt){try{st[q.KHR_BINARY_GLTF]=new gi(Le)}catch(xi){Ge&&Ge(xi);return}Je=st[q.KHR_BINARY_GLTF].content}else Je=p.LoaderUtils.decodeText(new Uint8Array(Le));const Tt=JSON.parse(Je);if(Tt.asset===void 0||Tt.asset.version[0]<2){Ge&&Ge(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const Mt=new Qe(Tt,{path:Ie||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});Mt.fileLoader.setRequestHeader(this.requestHeader);for(let ci=0;ci<this.pluginCallbacks.length;ci++){const xi=this.pluginCallbacks[ci](Mt);lt[xi.name]=xi,st[xi.name]=!0}if(Tt.extensionsUsed)for(let ci=0;ci<Tt.extensionsUsed.length;++ci){const xi=Tt.extensionsUsed[ci],an=Tt.extensionsRequired||[];switch(xi){case q.KHR_MATERIALS_UNLIT:st[xi]=new n;break;case q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:st[xi]=new Ye;break;case q.KHR_DRACO_MESH_COMPRESSION:st[xi]=new Zt(Tt,this.dracoLoader);break;case q.KHR_TEXTURE_TRANSFORM:st[xi]=new At;break;case q.KHR_MESH_QUANTIZATION:st[xi]=new ot;break;default:an.indexOf(xi)>=0&&lt[xi]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+xi+'".')}}Mt.setExtensions(st),Mt.setPlugins(lt),Mt.parse(Fe,Ge)}}function F(){let Ot={};return{get:function(Le){return Ot[Le]},add:function(Le,Ie){Ot[Le]=Ie},remove:function(Le){delete Ot[Le]},removeAll:function(){Ot={}}}}const q={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class V{constructor(Le){this.parser=Le,this.name=q.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const Le=this.parser,Ie=this.parser.json.nodes||[];for(let Fe=0,Ge=Ie.length;Fe<Ge;Fe++){const Je=Ie[Fe];Je.extensions&&Je.extensions[this.name]&&Je.extensions[this.name].light!==void 0&&Le._addNodeRef(this.cache,Je.extensions[this.name].light)}}_loadLight(Le){const Ie=this.parser,Fe="light:"+Le;let Ge=Ie.cache.get(Fe);if(Ge)return Ge;const Je=Ie.json,Tt=((Je.extensions&&Je.extensions[this.name]||{}).lights||[])[Le];let Mt;const ci=new p.Color(16777215);Tt.color!==void 0&&ci.fromArray(Tt.color);const xi=Tt.range!==void 0?Tt.range:0;switch(Tt.type){case"directional":Mt=new p.DirectionalLight(ci),Mt.target.position.set(0,0,-1),Mt.add(Mt.target);break;case"point":Mt=new p.PointLight(ci),Mt.distance=xi;break;case"spot":Mt=new p.SpotLight(ci),Mt.distance=xi,Tt.spot=Tt.spot||{},Tt.spot.innerConeAngle=Tt.spot.innerConeAngle!==void 0?Tt.spot.innerConeAngle:0,Tt.spot.outerConeAngle=Tt.spot.outerConeAngle!==void 0?Tt.spot.outerConeAngle:Math.PI/4,Mt.angle=Tt.spot.outerConeAngle,Mt.penumbra=1-Tt.spot.innerConeAngle/Tt.spot.outerConeAngle,Mt.target.position.set(0,0,-1),Mt.add(Mt.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+Tt.type)}return Mt.position.set(0,0,0),Mt.decay=2,Tt.intensity!==void 0&&(Mt.intensity=Tt.intensity),Mt.name=Ie.createUniqueName(Tt.name||"light_"+Le),Ge=Promise.resolve(Mt),Ie.cache.add(Fe,Ge),Ge}createNodeAttachment(Le){const Ie=this,Fe=this.parser,Je=Fe.json.nodes[Le],lt=(Je.extensions&&Je.extensions[this.name]||{}).light;return lt===void 0?null:this._loadLight(lt).then(function(Tt){return Fe._getNodeRef(Ie.cache,lt,Tt)})}}class n{constructor(){this.name=q.KHR_MATERIALS_UNLIT}getMaterialType(){return p.MeshBasicMaterial}extendParams(Le,Ie,Fe){const Ge=[];Le.color=new p.Color(1,1,1),Le.opacity=1;const Je=Ie.pbrMetallicRoughness;if(Je){if(Array.isArray(Je.baseColorFactor)){const st=Je.baseColorFactor;Le.color.fromArray(st),Le.opacity=st[3]}Je.baseColorTexture!==void 0&&Ge.push(Fe.assignTexture(Le,"map",Je.baseColorTexture))}return Promise.all(Ge)}}class J{constructor(Le){this.parser=Le,this.name=q.KHR_MATERIALS_CLEARCOAT}getMaterialType(Le){const Fe=this.parser.json.materials[Le];return!Fe.extensions||!Fe.extensions[this.name]?null:p.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Fe=this.parser,Ge=Fe.json.materials[Le];if(!Ge.extensions||!Ge.extensions[this.name])return Promise.resolve();const Je=[],st=Ge.extensions[this.name];if(st.clearcoatFactor!==void 0&&(Ie.clearcoat=st.clearcoatFactor),st.clearcoatTexture!==void 0&&Je.push(Fe.assignTexture(Ie,"clearcoatMap",st.clearcoatTexture)),st.clearcoatRoughnessFactor!==void 0&&(Ie.clearcoatRoughness=st.clearcoatRoughnessFactor),st.clearcoatRoughnessTexture!==void 0&&Je.push(Fe.assignTexture(Ie,"clearcoatRoughnessMap",st.clearcoatRoughnessTexture)),st.clearcoatNormalTexture!==void 0&&(Je.push(Fe.assignTexture(Ie,"clearcoatNormalMap",st.clearcoatNormalTexture)),st.clearcoatNormalTexture.scale!==void 0)){const lt=st.clearcoatNormalTexture.scale;Ie.clearcoatNormalScale=new p.Vector2(lt,-lt)}return Promise.all(Je)}}class re{constructor(Le){this.parser=Le,this.name=q.KHR_MATERIALS_TRANSMISSION}getMaterialType(Le){const Fe=this.parser.json.materials[Le];return!Fe.extensions||!Fe.extensions[this.name]?null:p.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Fe=this.parser,Ge=Fe.json.materials[Le];if(!Ge.extensions||!Ge.extensions[this.name])return Promise.resolve();const Je=[],st=Ge.extensions[this.name];return st.transmissionFactor!==void 0&&(Ie.transmission=st.transmissionFactor),st.transmissionTexture!==void 0&&Je.push(Fe.assignTexture(Ie,"transmissionMap",st.transmissionTexture)),Promise.all(Je)}}class ce{constructor(Le){this.parser=Le,this.name=q.KHR_MATERIALS_VOLUME}getMaterialType(Le){const Fe=this.parser.json.materials[Le];return!Fe.extensions||!Fe.extensions[this.name]?null:p.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Fe=this.parser,Ge=Fe.json.materials[Le];if(!Ge.extensions||!Ge.extensions[this.name])return Promise.resolve();const Je=[],st=Ge.extensions[this.name];Ie.thickness=st.thicknessFactor!==void 0?st.thicknessFactor:0,st.thicknessTexture!==void 0&&Je.push(Fe.assignTexture(Ie,"thicknessMap",st.thicknessTexture)),Ie.attenuationDistance=st.attenuationDistance||0;const lt=st.attenuationColor||[1,1,1];return Ie.attenuationTint=new p.Color(lt[0],lt[1],lt[2]),Promise.all(Je)}}class Se{constructor(Le){this.parser=Le,this.name=q.KHR_MATERIALS_IOR}getMaterialType(Le){const Fe=this.parser.json.materials[Le];return!Fe.extensions||!Fe.extensions[this.name]?null:p.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Ge=this.parser.json.materials[Le];if(!Ge.extensions||!Ge.extensions[this.name])return Promise.resolve();const Je=Ge.extensions[this.name];return Ie.ior=Je.ior!==void 0?Je.ior:1.5,Promise.resolve()}}class Xe{constructor(Le){this.parser=Le,this.name=q.KHR_MATERIALS_SPECULAR}getMaterialType(Le){const Fe=this.parser.json.materials[Le];return!Fe.extensions||!Fe.extensions[this.name]?null:p.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Fe=this.parser,Ge=Fe.json.materials[Le];if(!Ge.extensions||!Ge.extensions[this.name])return Promise.resolve();const Je=[],st=Ge.extensions[this.name];Ie.specularIntensity=st.specularFactor!==void 0?st.specularFactor:1,st.specularTexture!==void 0&&Je.push(Fe.assignTexture(Ie,"specularIntensityMap",st.specularTexture));const lt=st.specularColorFactor||[1,1,1];return Ie.specularTint=new p.Color(lt[0],lt[1],lt[2]),st.specularColorTexture!==void 0&&Je.push(Fe.assignTexture(Ie,"specularTintMap",st.specularColorTexture).then(function(Tt){Tt.encoding=p.sRGBEncoding})),Promise.all(Je)}}class ht{constructor(Le){this.parser=Le,this.name=q.KHR_TEXTURE_BASISU}loadTexture(Le){const Ie=this.parser,Fe=Ie.json,Ge=Fe.textures[Le];if(!Ge.extensions||!Ge.extensions[this.name])return null;const Je=Ge.extensions[this.name],st=Fe.images[Je.source],lt=Ie.options.ktx2Loader;if(!lt){if(Fe.extensionsRequired&&Fe.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return Ie.loadTextureImage(Le,st,lt)}}class Ut{constructor(Le){this.parser=Le,this.name=q.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(Le){const Ie=this.name,Fe=this.parser,Ge=Fe.json,Je=Ge.textures[Le];if(!Je.extensions||!Je.extensions[Ie])return null;const st=Je.extensions[Ie],lt=Ge.images[st.source];let Tt=Fe.textureLoader;if(lt.uri){const Mt=Fe.options.manager.getHandler(lt.uri);Mt!==null&&(Tt=Mt)}return this.detectSupport().then(function(Mt){if(Mt)return Fe.loadTextureImage(Le,lt,Tt);if(Ge.extensionsRequired&&Ge.extensionsRequired.indexOf(Ie)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return Fe.loadTexture(Le)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(Le){const Ie=new Image;Ie.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",Ie.onload=Ie.onerror=function(){Le(Ie.height===1)}})),this.isSupported}}class ct{constructor(Le){this.name=q.EXT_MESHOPT_COMPRESSION,this.parser=Le}loadBufferView(Le){const Ie=this.parser.json,Fe=Ie.bufferViews[Le];if(Fe.extensions&&Fe.extensions[this.name]){const Ge=Fe.extensions[this.name],Je=this.parser.getDependency("buffer",Ge.buffer),st=this.parser.options.meshoptDecoder;if(!st||!st.supported){if(Ie.extensionsRequired&&Ie.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([Je,st.ready]).then(function(lt){const Tt=Ge.byteOffset||0,Mt=Ge.byteLength||0,ci=Ge.count,xi=Ge.byteStride,an=new ArrayBuffer(ci*xi),cn=new Uint8Array(lt[0],Tt,Mt);return st.decodeGltfBuffer(new Uint8Array(an),ci,xi,cn,Ge.mode,Ge.filter),an})}else return null}}const Dt="glTF",rt=12,pt={JSON:1313821514,BIN:5130562};class gi{constructor(Le){this.name=q.KHR_BINARY_GLTF,this.content=null,this.body=null;const Ie=new DataView(Le,0,rt);if(this.header={magic:p.LoaderUtils.decodeText(new Uint8Array(Le.slice(0,4))),version:Ie.getUint32(4,!0),length:Ie.getUint32(8,!0)},this.header.magic!==Dt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const Fe=this.header.length-rt,Ge=new DataView(Le,rt);let Je=0;for(;Je<Fe;){const st=Ge.getUint32(Je,!0);Je+=4;const lt=Ge.getUint32(Je,!0);if(Je+=4,lt===pt.JSON){const Tt=new Uint8Array(Le,rt+Je,st);this.content=p.LoaderUtils.decodeText(Tt)}else if(lt===pt.BIN){const Tt=rt+Je;this.body=Le.slice(Tt,Tt+st)}Je+=st}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Zt{constructor(Le,Ie){if(!Ie)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=q.KHR_DRACO_MESH_COMPRESSION,this.json=Le,this.dracoLoader=Ie,this.dracoLoader.preload()}decodePrimitive(Le,Ie){const Fe=this.json,Ge=this.dracoLoader,Je=Le.extensions[this.name].bufferView,st=Le.extensions[this.name].attributes,lt={},Tt={},Mt={};for(const ci in st){const xi=ve[ci]||ci.toLowerCase();lt[xi]=st[ci]}for(const ci in Le.attributes){const xi=ve[ci]||ci.toLowerCase();if(st[ci]!==void 0){const an=Fe.accessors[Le.attributes[ci]],cn=_t[an.componentType];Mt[xi]=cn,Tt[xi]=an.normalized===!0}}return Ie.getDependency("bufferView",Je).then(function(ci){return new Promise(function(xi){Ge.decodeDracoFile(ci,function(an){for(const cn in an.attributes){const _n=an.attributes[cn],Fn=Tt[cn];Fn!==void 0&&(_n.normalized=Fn)}xi(an)},lt,Mt)})})}}class At{constructor(){this.name=q.KHR_TEXTURE_TRANSFORM}extendTexture(Le,Ie){return Ie.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),Ie.offset===void 0&&Ie.rotation===void 0&&Ie.scale===void 0||(Le=Le.clone(),Ie.offset!==void 0&&Le.offset.fromArray(Ie.offset),Ie.rotation!==void 0&&(Le.rotation=Ie.rotation),Ie.scale!==void 0&&Le.repeat.fromArray(Ie.scale),Le.needsUpdate=!0),Le}}class It extends p.MeshStandardMaterial{constructor(Le){super(),this.isGLTFSpecularGlossinessMaterial=!0;const Ie=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),Fe=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),Ge=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),Je=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),st=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),lt={specular:{value:new p.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=lt,this.onBeforeCompile=function(Tt){for(const Mt in lt)Tt.uniforms[Mt]=lt[Mt];Tt.fragmentShader=Tt.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",Ie).replace("#include <metalnessmap_pars_fragment>",Fe).replace("#include <roughnessmap_fragment>",Ge).replace("#include <metalnessmap_fragment>",Je).replace("#include <lights_physical_fragment>",st)},Object.defineProperties(this,{specular:{get:function(){return lt.specular.value},set:function(Tt){lt.specular.value=Tt}},specularMap:{get:function(){return lt.specularMap.value},set:function(Tt){lt.specularMap.value=Tt,Tt?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return lt.glossiness.value},set:function(Tt){lt.glossiness.value=Tt}},glossinessMap:{get:function(){return lt.glossinessMap.value},set:function(Tt){lt.glossinessMap.value=Tt,Tt?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(Le)}copy(Le){return super.copy(Le),this.specularMap=Le.specularMap,this.specular.copy(Le.specular),this.glossinessMap=Le.glossinessMap,this.glossiness=Le.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Ye{constructor(){this.name=q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return It}extendParams(Le,Ie,Fe){const Ge=Ie.extensions[this.name];Le.color=new p.Color(1,1,1),Le.opacity=1;const Je=[];if(Array.isArray(Ge.diffuseFactor)){const st=Ge.diffuseFactor;Le.color.fromArray(st),Le.opacity=st[3]}if(Ge.diffuseTexture!==void 0&&Je.push(Fe.assignTexture(Le,"map",Ge.diffuseTexture)),Le.emissive=new p.Color(0,0,0),Le.glossiness=Ge.glossinessFactor!==void 0?Ge.glossinessFactor:1,Le.specular=new p.Color(1,1,1),Array.isArray(Ge.specularFactor)&&Le.specular.fromArray(Ge.specularFactor),Ge.specularGlossinessTexture!==void 0){const st=Ge.specularGlossinessTexture;Je.push(Fe.assignTexture(Le,"glossinessMap",st)),Je.push(Fe.assignTexture(Le,"specularMap",st))}return Promise.all(Je)}createMaterial(Le){const Ie=new It(Le);return Ie.fog=!0,Ie.color=Le.color,Ie.map=Le.map===void 0?null:Le.map,Ie.lightMap=null,Ie.lightMapIntensity=1,Ie.aoMap=Le.aoMap===void 0?null:Le.aoMap,Ie.aoMapIntensity=1,Ie.emissive=Le.emissive,Ie.emissiveIntensity=1,Ie.emissiveMap=Le.emissiveMap===void 0?null:Le.emissiveMap,Ie.bumpMap=Le.bumpMap===void 0?null:Le.bumpMap,Ie.bumpScale=1,Ie.normalMap=Le.normalMap===void 0?null:Le.normalMap,Ie.normalMapType=p.TangentSpaceNormalMap,Le.normalScale&&(Ie.normalScale=Le.normalScale),Ie.displacementMap=null,Ie.displacementScale=1,Ie.displacementBias=0,Ie.specularMap=Le.specularMap===void 0?null:Le.specularMap,Ie.specular=Le.specular,Ie.glossinessMap=Le.glossinessMap===void 0?null:Le.glossinessMap,Ie.glossiness=Le.glossiness,Ie.alphaMap=null,Ie.envMap=Le.envMap===void 0?null:Le.envMap,Ie.envMapIntensity=1,Ie.refractionRatio=.98,Ie}}class ot{constructor(){this.name=q.KHR_MESH_QUANTIZATION}}class tt extends p.Interpolant{constructor(Le,Ie,Fe,Ge){super(Le,Ie,Fe,Ge)}copySampleValue_(Le){const Ie=this.resultBuffer,Fe=this.sampleValues,Ge=this.valueSize,Je=Le*Ge*3+Ge;for(let st=0;st!==Ge;st++)Ie[st]=Fe[Je+st];return Ie}}tt.prototype.beforeStart_=tt.prototype.copySampleValue_,tt.prototype.afterEnd_=tt.prototype.copySampleValue_,tt.prototype.interpolate_=function(Ot,Le,Ie,Fe){const Ge=this.resultBuffer,Je=this.sampleValues,st=this.valueSize,lt=st*2,Tt=st*3,Mt=Fe-Le,ci=(Ie-Le)/Mt,xi=ci*ci,an=xi*ci,cn=Ot*Tt,_n=cn-Tt,Fn=-2*an+3*xi,Mn=an-xi,jn=1-Fn,Lr=Mn-xi+ci;for(let Tr=0;Tr!==st;Tr++){const eo=Je[_n+Tr+st],$r=Je[_n+Tr+lt]*Mt,en=Je[cn+Tr+st],Wn=Je[cn+Tr]*Mt;Ge[Tr]=jn*eo+Lr*$r+Fn*en+Mn*Wn}return Ge};const et=new p.Quaternion;class Rt extends tt{interpolate_(Le,Ie,Fe,Ge){const Je=super.interpolate_(Le,Ie,Fe,Ge);return et.fromArray(Je).normalize().toArray(Je),Je}}const at={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},_t={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qt={9728:p.NearestFilter,9729:p.LinearFilter,9984:p.NearestMipmapNearestFilter,9985:p.LinearMipmapNearestFilter,9986:p.NearestMipmapLinearFilter,9987:p.LinearMipmapLinearFilter},ae={33071:p.ClampToEdgeWrapping,33648:p.MirroredRepeatWrapping,10497:p.RepeatWrapping},be={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ve={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},De={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ce={CUBICSPLINE:void 0,LINEAR:p.InterpolateLinear,STEP:p.InterpolateDiscrete},Vt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function zt(Ot,Le){return typeof Ot!="string"||Ot===""?"":(/^https?:\/\//i.test(Le)&&/^\//.test(Ot)&&(Le=Le.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(Ot)||/^data:.*,.*$/i.test(Ot)||/^blob:.*$/i.test(Ot)?Ot:Le+Ot)}function mt(Ot){return Ot.DefaultMaterial===void 0&&(Ot.DefaultMaterial=new p.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:p.FrontSide})),Ot.DefaultMaterial}function Nt(Ot,Le,Ie){for(const Fe in Ie.extensions)Ot[Fe]===void 0&&(Le.userData.gltfExtensions=Le.userData.gltfExtensions||{},Le.userData.gltfExtensions[Fe]=Ie.extensions[Fe])}function Gt(Ot,Le){Le.extras!==void 0&&(typeof Le.extras=="object"?Object.assign(Ot.userData,Le.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+Le.extras))}function ii(Ot,Le,Ie){let Fe=!1,Ge=!1;for(let lt=0,Tt=Le.length;lt<Tt;lt++){const Mt=Le[lt];if(Mt.POSITION!==void 0&&(Fe=!0),Mt.NORMAL!==void 0&&(Ge=!0),Fe&&Ge)break}if(!Fe&&!Ge)return Promise.resolve(Ot);const Je=[],st=[];for(let lt=0,Tt=Le.length;lt<Tt;lt++){const Mt=Le[lt];if(Fe){const ci=Mt.POSITION!==void 0?Ie.getDependency("accessor",Mt.POSITION):Ot.attributes.position;Je.push(ci)}if(Ge){const ci=Mt.NORMAL!==void 0?Ie.getDependency("accessor",Mt.NORMAL):Ot.attributes.normal;st.push(ci)}}return Promise.all([Promise.all(Je),Promise.all(st)]).then(function(lt){const Tt=lt[0],Mt=lt[1];return Fe&&(Ot.morphAttributes.position=Tt),Ge&&(Ot.morphAttributes.normal=Mt),Ot.morphTargetsRelative=!0,Ot})}function zi(Ot,Le){if(Ot.updateMorphTargets(),Le.weights!==void 0)for(let Ie=0,Fe=Le.weights.length;Ie<Fe;Ie++)Ot.morphTargetInfluences[Ie]=Le.weights[Ie];if(Le.extras&&Array.isArray(Le.extras.targetNames)){const Ie=Le.extras.targetNames;if(Ot.morphTargetInfluences.length===Ie.length){Ot.morphTargetDictionary={};for(let Fe=0,Ge=Ie.length;Fe<Ge;Fe++)Ot.morphTargetDictionary[Ie[Fe]]=Fe}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Hi(Ot){const Le=Ot.extensions&&Ot.extensions[q.KHR_DRACO_MESH_COMPRESSION];let Ie;return Le?Ie="draco:"+Le.bufferView+":"+Le.indices+":"+on(Le.attributes):Ie=Ot.indices+":"+on(Ot.attributes)+":"+Ot.mode,Ie}function on(Ot){let Le="";const Ie=Object.keys(Ot).sort();for(let Fe=0,Ge=Ie.length;Fe<Ge;Fe++)Le+=Ie[Fe]+":"+Ot[Ie[Fe]]+";";return Le}function mn(Ot){switch(Ot){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Qe{constructor(Le={},Ie={}){this.json=Le,this.extensions={},this.plugins={},this.options=Ie,this.cache=new F,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new p.ImageBitmapLoader(this.options.manager):this.textureLoader=new p.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new p.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(Le){this.extensions=Le}setPlugins(Le){this.plugins=Le}parse(Le,Ie){const Fe=this,Ge=this.json,Je=this.extensions;this.cache.removeAll(),this._invokeAll(function(st){return st._markDefs&&st._markDefs()}),Promise.all(this._invokeAll(function(st){return st.beforeRoot&&st.beforeRoot()})).then(function(){return Promise.all([Fe.getDependencies("scene"),Fe.getDependencies("animation"),Fe.getDependencies("camera")])}).then(function(st){const lt={scene:st[0][Ge.scene||0],scenes:st[0],animations:st[1],cameras:st[2],asset:Ge.asset,parser:Fe,userData:{}};Nt(Je,lt,Ge),Gt(lt,Ge),Promise.all(Fe._invokeAll(function(Tt){return Tt.afterRoot&&Tt.afterRoot(lt)})).then(function(){Le(lt)})}).catch(Ie)}_markDefs(){const Le=this.json.nodes||[],Ie=this.json.skins||[],Fe=this.json.meshes||[];for(let Ge=0,Je=Ie.length;Ge<Je;Ge++){const st=Ie[Ge].joints;for(let lt=0,Tt=st.length;lt<Tt;lt++)Le[st[lt]].isBone=!0}for(let Ge=0,Je=Le.length;Ge<Je;Ge++){const st=Le[Ge];st.mesh!==void 0&&(this._addNodeRef(this.meshCache,st.mesh),st.skin!==void 0&&(Fe[st.mesh].isSkinnedMesh=!0)),st.camera!==void 0&&this._addNodeRef(this.cameraCache,st.camera)}}_addNodeRef(Le,Ie){Ie!==void 0&&(Le.refs[Ie]===void 0&&(Le.refs[Ie]=Le.uses[Ie]=0),Le.refs[Ie]++)}_getNodeRef(Le,Ie,Fe){if(Le.refs[Ie]<=1)return Fe;const Ge=Fe.clone();return Ge.name+="_instance_"+Le.uses[Ie]++,Ge}_invokeOne(Le){const Ie=Object.values(this.plugins);Ie.push(this);for(let Fe=0;Fe<Ie.length;Fe++){const Ge=Le(Ie[Fe]);if(Ge)return Ge}return null}_invokeAll(Le){const Ie=Object.values(this.plugins);Ie.unshift(this);const Fe=[];for(let Ge=0;Ge<Ie.length;Ge++){const Je=Le(Ie[Ge]);Je&&Fe.push(Je)}return Fe}getDependency(Le,Ie){const Fe=Le+":"+Ie;let Ge=this.cache.get(Fe);if(!Ge){switch(Le){case"scene":Ge=this.loadScene(Ie);break;case"node":Ge=this.loadNode(Ie);break;case"mesh":Ge=this._invokeOne(function(Je){return Je.loadMesh&&Je.loadMesh(Ie)});break;case"accessor":Ge=this.loadAccessor(Ie);break;case"bufferView":Ge=this._invokeOne(function(Je){return Je.loadBufferView&&Je.loadBufferView(Ie)});break;case"buffer":Ge=this.loadBuffer(Ie);break;case"material":Ge=this._invokeOne(function(Je){return Je.loadMaterial&&Je.loadMaterial(Ie)});break;case"texture":Ge=this._invokeOne(function(Je){return Je.loadTexture&&Je.loadTexture(Ie)});break;case"skin":Ge=this.loadSkin(Ie);break;case"animation":Ge=this.loadAnimation(Ie);break;case"camera":Ge=this.loadCamera(Ie);break;default:throw new Error("Unknown type: "+Le)}this.cache.add(Fe,Ge)}return Ge}getDependencies(Le){let Ie=this.cache.get(Le);if(!Ie){const Fe=this,Ge=this.json[Le+(Le==="mesh"?"es":"s")]||[];Ie=Promise.all(Ge.map(function(Je,st){return Fe.getDependency(Le,st)})),this.cache.add(Le,Ie)}return Ie}loadBuffer(Le){const Ie=this.json.buffers[Le],Fe=this.fileLoader;if(Ie.type&&Ie.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+Ie.type+" buffer type is not supported.");if(Ie.uri===void 0&&Le===0)return Promise.resolve(this.extensions[q.KHR_BINARY_GLTF].body);const Ge=this.options;return new Promise(function(Je,st){Fe.load(zt(Ie.uri,Ge.path),Je,void 0,function(){st(new Error('THREE.GLTFLoader: Failed to load buffer "'+Ie.uri+'".'))})})}loadBufferView(Le){const Ie=this.json.bufferViews[Le];return this.getDependency("buffer",Ie.buffer).then(function(Fe){const Ge=Ie.byteLength||0,Je=Ie.byteOffset||0;return Fe.slice(Je,Je+Ge)})}loadAccessor(Le){const Ie=this,Fe=this.json,Ge=this.json.accessors[Le];if(Ge.bufferView===void 0&&Ge.sparse===void 0)return Promise.resolve(null);const Je=[];return Ge.bufferView!==void 0?Je.push(this.getDependency("bufferView",Ge.bufferView)):Je.push(null),Ge.sparse!==void 0&&(Je.push(this.getDependency("bufferView",Ge.sparse.indices.bufferView)),Je.push(this.getDependency("bufferView",Ge.sparse.values.bufferView))),Promise.all(Je).then(function(st){const lt=st[0],Tt=be[Ge.type],Mt=_t[Ge.componentType],ci=Mt.BYTES_PER_ELEMENT,xi=ci*Tt,an=Ge.byteOffset||0,cn=Ge.bufferView!==void 0?Fe.bufferViews[Ge.bufferView].byteStride:void 0,_n=Ge.normalized===!0;let Fn,Mn;if(cn&&cn!==xi){const jn=Math.floor(an/cn),Lr="InterleavedBuffer:"+Ge.bufferView+":"+Ge.componentType+":"+jn+":"+Ge.count;let Tr=Ie.cache.get(Lr);Tr||(Fn=new Mt(lt,jn*cn,Ge.count*cn/ci),Tr=new p.InterleavedBuffer(Fn,cn/ci),Ie.cache.add(Lr,Tr)),Mn=new p.InterleavedBufferAttribute(Tr,Tt,an%cn/ci,_n)}else lt===null?Fn=new Mt(Ge.count*Tt):Fn=new Mt(lt,an,Ge.count*Tt),Mn=new p.BufferAttribute(Fn,Tt,_n);if(Ge.sparse!==void 0){const jn=be.SCALAR,Lr=_t[Ge.sparse.indices.componentType],Tr=Ge.sparse.indices.byteOffset||0,eo=Ge.sparse.values.byteOffset||0,$r=new Lr(st[1],Tr,Ge.sparse.count*jn),en=new Mt(st[2],eo,Ge.sparse.count*Tt);lt!==null&&(Mn=new p.BufferAttribute(Mn.array.slice(),Mn.itemSize,Mn.normalized));for(let Wn=0,Ls=$r.length;Wn<Ls;Wn++){const bo=$r[Wn];if(Mn.setX(bo,en[Wn*Tt]),Tt>=2&&Mn.setY(bo,en[Wn*Tt+1]),Tt>=3&&Mn.setZ(bo,en[Wn*Tt+2]),Tt>=4&&Mn.setW(bo,en[Wn*Tt+3]),Tt>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return Mn})}loadTexture(Le){const Ie=this.json,Fe=this.options,Ge=Ie.textures[Le],Je=Ie.images[Ge.source];let st=this.textureLoader;if(Je.uri){const lt=Fe.manager.getHandler(Je.uri);lt!==null&&(st=lt)}return this.loadTextureImage(Le,Je,st)}loadTextureImage(Le,Ie,Fe){const Ge=this,Je=this.json,st=this.options,lt=Je.textures[Le],Tt=(Ie.uri||Ie.bufferView)+":"+lt.sampler;if(this.textureCache[Tt])return this.textureCache[Tt];const Mt=self.URL||self.webkitURL;let ci=Ie.uri||"",xi=!1,an=!0;const cn=ci.search(/\.jpe?g($|\?)/i)>0||ci.search(/^data\:image\/jpeg/)===0;if((Ie.mimeType==="image/jpeg"||cn)&&(an=!1),Ie.bufferView!==void 0)ci=Ge.getDependency("bufferView",Ie.bufferView).then(function(Fn){if(Ie.mimeType==="image/png"){const jn=new DataView(Fn,25,1).getUint8(0,!1);an=jn===6||jn===4||jn===3}xi=!0;const Mn=new Blob([Fn],{type:Ie.mimeType});return ci=Mt.createObjectURL(Mn),ci});else if(Ie.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+Le+" is missing URI and bufferView");const _n=Promise.resolve(ci).then(function(Fn){return new Promise(function(Mn,jn){let Lr=Mn;Fe.isImageBitmapLoader===!0&&(Lr=function(Tr){const eo=new p.Texture(Tr);eo.needsUpdate=!0,Mn(eo)}),Fe.load(zt(Fn,st.path),Lr,void 0,jn)})}).then(function(Fn){xi===!0&&Mt.revokeObjectURL(ci),Fn.flipY=!1,lt.name&&(Fn.name=lt.name),an||(Fn.format=p.RGBFormat);const jn=(Je.samplers||{})[lt.sampler]||{};return Fn.magFilter=Qt[jn.magFilter]||p.LinearFilter,Fn.minFilter=Qt[jn.minFilter]||p.LinearMipmapLinearFilter,Fn.wrapS=ae[jn.wrapS]||p.RepeatWrapping,Fn.wrapT=ae[jn.wrapT]||p.RepeatWrapping,Ge.associations.set(Fn,{type:"textures",index:Le}),Fn}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",ci),null});return this.textureCache[Tt]=_n,_n}assignTexture(Le,Ie,Fe){const Ge=this;return this.getDependency("texture",Fe.index).then(function(Je){if(Fe.texCoord!==void 0&&Fe.texCoord!=0&&!(Ie==="aoMap"&&Fe.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+Fe.texCoord+" for texture "+Ie+" not yet supported."),Ge.extensions[q.KHR_TEXTURE_TRANSFORM]){const st=Fe.extensions!==void 0?Fe.extensions[q.KHR_TEXTURE_TRANSFORM]:void 0;if(st){const lt=Ge.associations.get(Je);Je=Ge.extensions[q.KHR_TEXTURE_TRANSFORM].extendTexture(Je,st),Ge.associations.set(Je,lt)}}return Le[Ie]=Je,Je})}assignFinalMaterial(Le){const Ie=Le.geometry;let Fe=Le.material;const Ge=Ie.attributes.tangent!==void 0,Je=Ie.attributes.color!==void 0,st=Ie.attributes.normal===void 0;if(Le.isPoints){const lt="PointsMaterial:"+Fe.uuid;let Tt=this.cache.get(lt);Tt||(Tt=new p.PointsMaterial,p.Material.prototype.copy.call(Tt,Fe),Tt.color.copy(Fe.color),Tt.map=Fe.map,Tt.sizeAttenuation=!1,this.cache.add(lt,Tt)),Fe=Tt}else if(Le.isLine){const lt="LineBasicMaterial:"+Fe.uuid;let Tt=this.cache.get(lt);Tt||(Tt=new p.LineBasicMaterial,p.Material.prototype.copy.call(Tt,Fe),Tt.color.copy(Fe.color),this.cache.add(lt,Tt)),Fe=Tt}if(Ge||Je||st){let lt="ClonedMaterial:"+Fe.uuid+":";Fe.isGLTFSpecularGlossinessMaterial&&(lt+="specular-glossiness:"),Ge&&(lt+="vertex-tangents:"),Je&&(lt+="vertex-colors:"),st&&(lt+="flat-shading:");let Tt=this.cache.get(lt);Tt||(Tt=Fe.clone(),Je&&(Tt.vertexColors=!0),st&&(Tt.flatShading=!0),Ge&&(Tt.normalScale&&(Tt.normalScale.y*=-1),Tt.clearcoatNormalScale&&(Tt.clearcoatNormalScale.y*=-1)),this.cache.add(lt,Tt),this.associations.set(Tt,this.associations.get(Fe))),Fe=Tt}Fe.aoMap&&Ie.attributes.uv2===void 0&&Ie.attributes.uv!==void 0&&Ie.setAttribute("uv2",Ie.attributes.uv),Le.material=Fe}getMaterialType(){return p.MeshStandardMaterial}loadMaterial(Le){const Ie=this,Fe=this.json,Ge=this.extensions,Je=Fe.materials[Le];let st;const lt={},Tt=Je.extensions||{},Mt=[];if(Tt[q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const xi=Ge[q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];st=xi.getMaterialType(),Mt.push(xi.extendParams(lt,Je,Ie))}else if(Tt[q.KHR_MATERIALS_UNLIT]){const xi=Ge[q.KHR_MATERIALS_UNLIT];st=xi.getMaterialType(),Mt.push(xi.extendParams(lt,Je,Ie))}else{const xi=Je.pbrMetallicRoughness||{};if(lt.color=new p.Color(1,1,1),lt.opacity=1,Array.isArray(xi.baseColorFactor)){const an=xi.baseColorFactor;lt.color.fromArray(an),lt.opacity=an[3]}xi.baseColorTexture!==void 0&&Mt.push(Ie.assignTexture(lt,"map",xi.baseColorTexture)),lt.metalness=xi.metallicFactor!==void 0?xi.metallicFactor:1,lt.roughness=xi.roughnessFactor!==void 0?xi.roughnessFactor:1,xi.metallicRoughnessTexture!==void 0&&(Mt.push(Ie.assignTexture(lt,"metalnessMap",xi.metallicRoughnessTexture)),Mt.push(Ie.assignTexture(lt,"roughnessMap",xi.metallicRoughnessTexture))),st=this._invokeOne(function(an){return an.getMaterialType&&an.getMaterialType(Le)}),Mt.push(Promise.all(this._invokeAll(function(an){return an.extendMaterialParams&&an.extendMaterialParams(Le,lt)})))}Je.doubleSided===!0&&(lt.side=p.DoubleSide);const ci=Je.alphaMode||Vt.OPAQUE;return ci===Vt.BLEND?(lt.transparent=!0,lt.depthWrite=!1):(lt.format=p.RGBFormat,lt.transparent=!1,ci===Vt.MASK&&(lt.alphaTest=Je.alphaCutoff!==void 0?Je.alphaCutoff:.5)),Je.normalTexture!==void 0&&st!==p.MeshBasicMaterial&&(Mt.push(Ie.assignTexture(lt,"normalMap",Je.normalTexture)),lt.normalScale=new p.Vector2(1,-1),Je.normalTexture.scale!==void 0&&lt.normalScale.set(Je.normalTexture.scale,-Je.normalTexture.scale)),Je.occlusionTexture!==void 0&&st!==p.MeshBasicMaterial&&(Mt.push(Ie.assignTexture(lt,"aoMap",Je.occlusionTexture)),Je.occlusionTexture.strength!==void 0&&(lt.aoMapIntensity=Je.occlusionTexture.strength)),Je.emissiveFactor!==void 0&&st!==p.MeshBasicMaterial&&(lt.emissive=new p.Color().fromArray(Je.emissiveFactor)),Je.emissiveTexture!==void 0&&st!==p.MeshBasicMaterial&&Mt.push(Ie.assignTexture(lt,"emissiveMap",Je.emissiveTexture)),Promise.all(Mt).then(function(){let xi;return st===It?xi=Ge[q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(lt):xi=new st(lt),Je.name&&(xi.name=Je.name),xi.map&&(xi.map.encoding=p.sRGBEncoding),xi.emissiveMap&&(xi.emissiveMap.encoding=p.sRGBEncoding),Gt(xi,Je),Ie.associations.set(xi,{type:"materials",index:Le}),Je.extensions&&Nt(Ge,xi,Je),xi})}createUniqueName(Le){const Ie=p.PropertyBinding.sanitizeNodeName(Le||"");let Fe=Ie;for(let Ge=1;this.nodeNamesUsed[Fe];++Ge)Fe=Ie+"_"+Ge;return this.nodeNamesUsed[Fe]=!0,Fe}loadGeometries(Le){const Ie=this,Fe=this.extensions,Ge=this.primitiveCache;function Je(lt){return Fe[q.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(lt,Ie).then(function(Tt){return bt(Tt,lt,Ie)})}const st=[];for(let lt=0,Tt=Le.length;lt<Tt;lt++){const Mt=Le[lt],ci=Hi(Mt),xi=Ge[ci];if(xi)st.push(xi.promise);else{let an;Mt.extensions&&Mt.extensions[q.KHR_DRACO_MESH_COMPRESSION]?an=Je(Mt):an=bt(new p.BufferGeometry,Mt,Ie),Ge[ci]={primitive:Mt,promise:an},st.push(an)}}return Promise.all(st)}loadMesh(Le){const Ie=this,Fe=this.json,Ge=this.extensions,Je=Fe.meshes[Le],st=Je.primitives,lt=[];for(let Tt=0,Mt=st.length;Tt<Mt;Tt++){const ci=st[Tt].material===void 0?mt(this.cache):this.getDependency("material",st[Tt].material);lt.push(ci)}return lt.push(Ie.loadGeometries(st)),Promise.all(lt).then(function(Tt){const Mt=Tt.slice(0,Tt.length-1),ci=Tt[Tt.length-1],xi=[];for(let cn=0,_n=ci.length;cn<_n;cn++){const Fn=ci[cn],Mn=st[cn];let jn;const Lr=Mt[cn];if(Mn.mode===at.TRIANGLES||Mn.mode===at.TRIANGLE_STRIP||Mn.mode===at.TRIANGLE_FAN||Mn.mode===void 0)jn=Je.isSkinnedMesh===!0?new p.SkinnedMesh(Fn,Lr):new p.Mesh(Fn,Lr),jn.isSkinnedMesh===!0&&!jn.geometry.attributes.skinWeight.normalized&&jn.normalizeSkinWeights(),Mn.mode===at.TRIANGLE_STRIP?jn.geometry=je(jn.geometry,p.TriangleStripDrawMode):Mn.mode===at.TRIANGLE_FAN&&(jn.geometry=je(jn.geometry,p.TriangleFanDrawMode));else if(Mn.mode===at.LINES)jn=new p.LineSegments(Fn,Lr);else if(Mn.mode===at.LINE_STRIP)jn=new p.Line(Fn,Lr);else if(Mn.mode===at.LINE_LOOP)jn=new p.LineLoop(Fn,Lr);else if(Mn.mode===at.POINTS)jn=new p.Points(Fn,Lr);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Mn.mode);Object.keys(jn.geometry.morphAttributes).length>0&&zi(jn,Je),jn.name=Ie.createUniqueName(Je.name||"mesh_"+Le),Gt(jn,Je),Mn.extensions&&Nt(Ge,jn,Mn),Ie.assignFinalMaterial(jn),xi.push(jn)}if(xi.length===1)return xi[0];const an=new p.Group;for(let cn=0,_n=xi.length;cn<_n;cn++)an.add(xi[cn]);return an})}loadCamera(Le){let Ie;const Fe=this.json.cameras[Le],Ge=Fe[Fe.type];if(!Ge){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return Fe.type==="perspective"?Ie=new p.PerspectiveCamera(p.MathUtils.radToDeg(Ge.yfov),Ge.aspectRatio||1,Ge.znear||1,Ge.zfar||2e6):Fe.type==="orthographic"&&(Ie=new p.OrthographicCamera(-Ge.xmag,Ge.xmag,Ge.ymag,-Ge.ymag,Ge.znear,Ge.zfar)),Fe.name&&(Ie.name=this.createUniqueName(Fe.name)),Gt(Ie,Fe),Promise.resolve(Ie)}loadSkin(Le){const Ie=this.json.skins[Le],Fe={joints:Ie.joints};return Ie.inverseBindMatrices===void 0?Promise.resolve(Fe):this.getDependency("accessor",Ie.inverseBindMatrices).then(function(Ge){return Fe.inverseBindMatrices=Ge,Fe})}loadAnimation(Le){const Fe=this.json.animations[Le],Ge=[],Je=[],st=[],lt=[],Tt=[];for(let Mt=0,ci=Fe.channels.length;Mt<ci;Mt++){const xi=Fe.channels[Mt],an=Fe.samplers[xi.sampler],cn=xi.target,_n=cn.node!==void 0?cn.node:cn.id,Fn=Fe.parameters!==void 0?Fe.parameters[an.input]:an.input,Mn=Fe.parameters!==void 0?Fe.parameters[an.output]:an.output;Ge.push(this.getDependency("node",_n)),Je.push(this.getDependency("accessor",Fn)),st.push(this.getDependency("accessor",Mn)),lt.push(an),Tt.push(cn)}return Promise.all([Promise.all(Ge),Promise.all(Je),Promise.all(st),Promise.all(lt),Promise.all(Tt)]).then(function(Mt){const ci=Mt[0],xi=Mt[1],an=Mt[2],cn=Mt[3],_n=Mt[4],Fn=[];for(let jn=0,Lr=ci.length;jn<Lr;jn++){const Tr=ci[jn],eo=xi[jn],$r=an[jn],en=cn[jn],Wn=_n[jn];if(Tr===void 0)continue;Tr.updateMatrix(),Tr.matrixAutoUpdate=!0;let Ls;switch(De[Wn.path]){case De.weights:Ls=p.NumberKeyframeTrack;break;case De.rotation:Ls=p.QuaternionKeyframeTrack;break;case De.position:case De.scale:default:Ls=p.VectorKeyframeTrack;break}const bo=Tr.name?Tr.name:Tr.uuid,Lo=en.interpolation!==void 0?Ce[en.interpolation]:p.InterpolateLinear,_s=[];De[Wn.path]===De.weights?Tr.traverse(function(Dr){Dr.isMesh===!0&&Dr.morphTargetInfluences&&_s.push(Dr.name?Dr.name:Dr.uuid)}):_s.push(bo);let js=$r.array;if($r.normalized){const Dr=mn(js.constructor),no=new Float32Array(js.length);for(let uo=0,oi=js.length;uo<oi;uo++)no[uo]=js[uo]*Dr;js=no}for(let Dr=0,no=_s.length;Dr<no;Dr++){const uo=new Ls(_s[Dr]+"."+De[Wn.path],eo.array,js,Lo);en.interpolation==="CUBICSPLINE"&&(uo.createInterpolant=function(ye){const ie=this instanceof p.QuaternionKeyframeTrack?Rt:tt;return new ie(this.times,this.values,this.getValueSize()/3,ye)},uo.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),Fn.push(uo)}}const Mn=Fe.name?Fe.name:"animation_"+Le;return new p.AnimationClip(Mn,void 0,Fn)})}createNodeMesh(Le){const Ie=this.json,Fe=this,Ge=Ie.nodes[Le];return Ge.mesh===void 0?null:Fe.getDependency("mesh",Ge.mesh).then(function(Je){const st=Fe._getNodeRef(Fe.meshCache,Ge.mesh,Je);return Ge.weights!==void 0&&st.traverse(function(lt){if(lt.isMesh)for(let Tt=0,Mt=Ge.weights.length;Tt<Mt;Tt++)lt.morphTargetInfluences[Tt]=Ge.weights[Tt]}),st})}loadNode(Le){const Ie=this.json,Fe=this.extensions,Ge=this,Je=Ie.nodes[Le],st=Je.name?Ge.createUniqueName(Je.name):"";return function(){const lt=[],Tt=Ge._invokeOne(function(Mt){return Mt.createNodeMesh&&Mt.createNodeMesh(Le)});return Tt&&lt.push(Tt),Je.camera!==void 0&&lt.push(Ge.getDependency("camera",Je.camera).then(function(Mt){return Ge._getNodeRef(Ge.cameraCache,Je.camera,Mt)})),Ge._invokeAll(function(Mt){return Mt.createNodeAttachment&&Mt.createNodeAttachment(Le)}).forEach(function(Mt){lt.push(Mt)}),Promise.all(lt)}().then(function(lt){let Tt;if(Je.isBone===!0?Tt=new p.Bone:lt.length>1?Tt=new p.Group:lt.length===1?Tt=lt[0]:Tt=new p.Object3D,Tt!==lt[0])for(let Mt=0,ci=lt.length;Mt<ci;Mt++)Tt.add(lt[Mt]);if(Je.name&&(Tt.userData.name=Je.name,Tt.name=st),Gt(Tt,Je),Je.extensions&&Nt(Fe,Tt,Je),Je.matrix!==void 0){const Mt=new p.Matrix4;Mt.fromArray(Je.matrix),Tt.applyMatrix4(Mt)}else Je.translation!==void 0&&Tt.position.fromArray(Je.translation),Je.rotation!==void 0&&Tt.quaternion.fromArray(Je.rotation),Je.scale!==void 0&&Tt.scale.fromArray(Je.scale);return Ge.associations.set(Tt,{type:"nodes",index:Le}),Tt})}loadScene(Le){const Ie=this.json,Fe=this.extensions,Ge=this.json.scenes[Le],Je=this,st=new p.Group;Ge.name&&(st.name=Je.createUniqueName(Ge.name)),Gt(st,Ge),Ge.extensions&&Nt(Fe,st,Ge);const lt=Ge.nodes||[],Tt=[];for(let Mt=0,ci=lt.length;Mt<ci;Mt++)Tt.push(Yn(lt[Mt],st,Ie,Je));return Promise.all(Tt).then(function(){return st})}}function Yn(Ot,Le,Ie,Fe){const Ge=Ie.nodes[Ot];return Fe.getDependency("node",Ot).then(function(Je){if(Ge.skin===void 0)return Je;let st;return Fe.getDependency("skin",Ge.skin).then(function(lt){st=lt;const Tt=[];for(let Mt=0,ci=st.joints.length;Mt<ci;Mt++)Tt.push(Fe.getDependency("node",st.joints[Mt]));return Promise.all(Tt)}).then(function(lt){return Je.traverse(function(Tt){if(!Tt.isMesh)return;const Mt=[],ci=[];for(let xi=0,an=lt.length;xi<an;xi++){const cn=lt[xi];if(cn){Mt.push(cn);const _n=new p.Matrix4;st.inverseBindMatrices!==void 0&&_n.fromArray(st.inverseBindMatrices.array,xi*16),ci.push(_n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',st.joints[xi])}Tt.bind(new p.Skeleton(Mt,ci),Tt.matrixWorld)}),Je})}).then(function(Je){Le.add(Je);const st=[];if(Ge.children){const lt=Ge.children;for(let Tt=0,Mt=lt.length;Tt<Mt;Tt++){const ci=lt[Tt];st.push(Yn(ci,Je,Ie,Fe))}}return Promise.all(st)})}function pr(Ot,Le,Ie){const Fe=Le.attributes,Ge=new p.Box3;if(Fe.POSITION!==void 0){const lt=Ie.json.accessors[Fe.POSITION],Tt=lt.min,Mt=lt.max;if(Tt!==void 0&&Mt!==void 0){if(Ge.set(new p.Vector3(Tt[0],Tt[1],Tt[2]),new p.Vector3(Mt[0],Mt[1],Mt[2])),lt.normalized){const ci=mn(_t[lt.componentType]);Ge.min.multiplyScalar(ci),Ge.max.multiplyScalar(ci)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const Je=Le.targets;if(Je!==void 0){const lt=new p.Vector3,Tt=new p.Vector3;for(let Mt=0,ci=Je.length;Mt<ci;Mt++){const xi=Je[Mt];if(xi.POSITION!==void 0){const an=Ie.json.accessors[xi.POSITION],cn=an.min,_n=an.max;if(cn!==void 0&&_n!==void 0){if(Tt.setX(Math.max(Math.abs(cn[0]),Math.abs(_n[0]))),Tt.setY(Math.max(Math.abs(cn[1]),Math.abs(_n[1]))),Tt.setZ(Math.max(Math.abs(cn[2]),Math.abs(_n[2]))),an.normalized){const Fn=mn(_t[an.componentType]);Tt.multiplyScalar(Fn)}lt.max(Tt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Ge.expandByVector(lt)}Ot.boundingBox=Ge;const st=new p.Sphere;Ge.getCenter(st.center),st.radius=Ge.min.distanceTo(Ge.max)/2,Ot.boundingSphere=st}function bt(Ot,Le,Ie){const Fe=Le.attributes,Ge=[];function Je(st,lt){return Ie.getDependency("accessor",st).then(function(Tt){Ot.setAttribute(lt,Tt)})}for(const st in Fe){const lt=ve[st]||st.toLowerCase();lt in Ot.attributes||Ge.push(Je(Fe[st],lt))}if(Le.indices!==void 0&&!Ot.index){const st=Ie.getDependency("accessor",Le.indices).then(function(lt){Ot.setIndex(lt)});Ge.push(st)}return Gt(Ot,Le),pr(Ot,Le,Ie),Promise.all(Ge).then(function(){return Le.targets!==void 0?ii(Ot,Le.targets,Ie):Ot})}function je(Ot,Le){let Ie=Ot.getIndex();if(Ie===null){const st=[],lt=Ot.getAttribute("position");if(lt!==void 0){for(let Tt=0;Tt<lt.count;Tt++)st.push(Tt);Ot.setIndex(st),Ie=Ot.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),Ot}const Fe=Ie.count-2,Ge=[];if(Le===p.TriangleFanDrawMode)for(let st=1;st<=Fe;st++)Ge.push(Ie.getX(0)),Ge.push(Ie.getX(st)),Ge.push(Ie.getX(st+1));else for(let st=0;st<Fe;st++)st%2===0?(Ge.push(Ie.getX(st)),Ge.push(Ie.getX(st+1)),Ge.push(Ie.getX(st+2))):(Ge.push(Ie.getX(st+2)),Ge.push(Ie.getX(st+1)),Ge.push(Ie.getX(st)));Ge.length/3!==Fe&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const Je=Ot.clone();return Je.setIndex(Ge),Je}p.GLTFLoader=z})(),v.exports=p.GLTFLoader}(zx)),zx.exports}var kx={exports:{}},bM;function II(){return bM||(bM=1,function(v,y){const p=za();(function(){class z extends p.Loader{constructor(q){super(q)}load(q,V,n,J){const re=this,ce=re.path===""?p.LoaderUtils.extractUrlBase(q):re.path,Se=new p.FileLoader(re.manager);Se.setPath(re.path),Se.setRequestHeader(re.requestHeader),Se.setWithCredentials(re.withCredentials),Se.load(q,function(Xe){try{V(re.parse(Xe,ce))}catch(ht){J?J(ht):console.error(ht),re.manager.itemError(q)}},n,J)}parse(q,V){function n(fe,me){const Ee=[],We=fe.childNodes;for(let Pe=0,li=We.length;Pe<li;Pe++){const Mi=We[Pe];Mi.nodeName===me&&Ee.push(Mi)}return Ee}function J(fe){if(fe.length===0)return[];const me=fe.trim().split(/\s+/),Ee=new Array(me.length);for(let We=0,Pe=me.length;We<Pe;We++)Ee[We]=me[We];return Ee}function re(fe){if(fe.length===0)return[];const me=fe.trim().split(/\s+/),Ee=new Array(me.length);for(let We=0,Pe=me.length;We<Pe;We++)Ee[We]=parseFloat(me[We]);return Ee}function ce(fe){if(fe.length===0)return[];const me=fe.trim().split(/\s+/),Ee=new Array(me.length);for(let We=0,Pe=me.length;We<Pe;We++)Ee[We]=parseInt(me[We]);return Ee}function Se(fe){return fe.substring(1)}function Xe(){return"three_default_"+Ui++}function ht(fe){return Object.keys(fe).length===0}function Ut(fe){return{unit:ct(n(fe,"unit")[0]),upAxis:Dt(n(fe,"up_axis")[0])}}function ct(fe){return fe!==void 0&&fe.hasAttribute("meter")===!0?parseFloat(fe.getAttribute("meter")):1}function Dt(fe){return fe!==void 0?fe.textContent:"Y_UP"}function rt(fe,me,Ee,We){const Pe=n(fe,me)[0];if(Pe!==void 0){const li=n(Pe,Ee);for(let Mi=0;Mi<li.length;Mi++)We(li[Mi])}}function pt(fe,me){for(const Ee in fe){const We=fe[Ee];We.build=me(fe[Ee])}}function gi(fe,me){return fe.build!==void 0||(fe.build=me(fe)),fe.build}function Zt(fe){const me={sources:{},samplers:{},channels:{}};let Ee=!1;for(let We=0,Pe=fe.childNodes.length;We<Pe;We++){const li=fe.childNodes[We];if(li.nodeType!==1)continue;let Mi;switch(li.nodeName){case"source":Mi=li.getAttribute("id"),me.sources[Mi]=Dr(li);break;case"sampler":Mi=li.getAttribute("id"),me.samplers[Mi]=At(li);break;case"channel":Mi=li.getAttribute("target"),me.channels[Mi]=It(li);break;case"animation":Zt(li),Ee=!0;break;default:console.log(li)}}Ee===!1&&(bi.animations[fe.getAttribute("id")||p.MathUtils.generateUUID()]=me)}function At(fe){const me={inputs:{}};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"input":const li=Se(Pe.getAttribute("source")),Mi=Pe.getAttribute("semantic");me.inputs[Mi]=li;break}}return me}function It(fe){const me={};let We=fe.getAttribute("target").split("/");const Pe=We.shift();let li=We.shift();const Mi=li.indexOf("(")!==-1,Wi=li.indexOf(".")!==-1;if(Wi)We=li.split("."),li=We.shift(),me.member=We.shift();else if(Mi){const hn=li.split("(");li=hn.shift();for(let Dn=0;Dn<hn.length;Dn++)hn[Dn]=parseInt(hn[Dn].replace(/\)/,""));me.indices=hn}return me.id=Pe,me.sid=li,me.arraySyntax=Mi,me.memberSyntax=Wi,me.sampler=Se(fe.getAttribute("source")),me}function Ye(fe){const me=[],Ee=fe.channels,We=fe.samplers,Pe=fe.sources;for(const li in Ee)if(Ee.hasOwnProperty(li)){const Mi=Ee[li],Wi=We[Mi.sampler],hn=Wi.inputs.INPUT,Dn=Wi.inputs.OUTPUT,Zi=Pe[hn],Kt=Pe[Dn],nn=tt(Mi,Zi,Kt);Qt(nn,me)}return me}function ot(fe){return gi(bi.animations[fe],Ye)}function tt(fe,me,Ee){const We=bi.nodes[fe.id],Pe=Bo(We.id),li=We.transforms[fe.sid],Mi=We.matrix.clone().transpose();let Wi,hn,Dn,Zi,Kt,nn;const Ei={};switch(li){case"matrix":for(Dn=0,Zi=me.array.length;Dn<Zi;Dn++)if(Wi=me.array[Dn],hn=Dn*Ee.stride,Ei[Wi]===void 0&&(Ei[Wi]={}),fe.arraySyntax===!0){const fn=Ee.array[hn],cr=fe.indices[0]+4*fe.indices[1];Ei[Wi][cr]=fn}else for(Kt=0,nn=Ee.stride;Kt<nn;Kt++)Ei[Wi][Kt]=Ee.array[hn+Kt];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',li);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',li);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',li);break}const Ln=et(Ei,Mi);return{name:Pe.uuid,keyframes:Ln}}function et(fe,me){const Ee=[];for(const Pe in fe)Ee.push({time:parseFloat(Pe),value:fe[Pe]});Ee.sort(We);for(let Pe=0;Pe<16;Pe++)ae(Ee,Pe,me.elements[Pe]);return Ee;function We(Pe,li){return Pe.time-li.time}}const Rt=new p.Vector3,at=new p.Vector3,_t=new p.Quaternion;function Qt(fe,me){const Ee=fe.keyframes,We=fe.name,Pe=[],li=[],Mi=[],Wi=[];for(let hn=0,Dn=Ee.length;hn<Dn;hn++){const Zi=Ee[hn],Kt=Zi.time,nn=Zi.value;es.fromArray(nn).transpose(),es.decompose(Rt,_t,at),Pe.push(Kt),li.push(Rt.x,Rt.y,Rt.z),Mi.push(_t.x,_t.y,_t.z,_t.w),Wi.push(at.x,at.y,at.z)}return li.length>0&&me.push(new p.VectorKeyframeTrack(We+".position",Pe,li)),Mi.length>0&&me.push(new p.QuaternionKeyframeTrack(We+".quaternion",Pe,Mi)),Wi.length>0&&me.push(new p.VectorKeyframeTrack(We+".scale",Pe,Wi)),me}function ae(fe,me,Ee){let We,Pe=!0,li,Mi;for(li=0,Mi=fe.length;li<Mi;li++)We=fe[li],We.value[me]===void 0?We.value[me]=null:Pe=!1;if(Pe===!0)for(li=0,Mi=fe.length;li<Mi;li++)We=fe[li],We.value[me]=Ee;else be(fe,me)}function be(fe,me){let Ee,We;for(let Pe=0,li=fe.length;Pe<li;Pe++){const Mi=fe[Pe];if(Mi.value[me]===null){if(Ee=ve(fe,Pe,me),We=De(fe,Pe,me),Ee===null){Mi.value[me]=We.value[me];continue}if(We===null){Mi.value[me]=Ee.value[me];continue}Ce(Mi,Ee,We,me)}}}function ve(fe,me,Ee){for(;me>=0;){const We=fe[me];if(We.value[Ee]!==null)return We;me--}return null}function De(fe,me,Ee){for(;me<fe.length;){const We=fe[me];if(We.value[Ee]!==null)return We;me++}return null}function Ce(fe,me,Ee,We){if(Ee.time-me.time===0){fe.value[We]=me.value[We];return}fe.value[We]=(fe.time-me.time)*(Ee.value[We]-me.value[We])/(Ee.time-me.time)+me.value[We]}function Vt(fe){const me={name:fe.getAttribute("id")||"default",start:parseFloat(fe.getAttribute("start")||0),end:parseFloat(fe.getAttribute("end")||0),animations:[]};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"instance_animation":me.animations.push(Se(Pe.getAttribute("url")));break}}bi.clips[fe.getAttribute("id")]=me}function zt(fe){const me=[],Ee=fe.name,We=fe.end-fe.start||-1,Pe=fe.animations;for(let li=0,Mi=Pe.length;li<Mi;li++){const Wi=ot(Pe[li]);for(let hn=0,Dn=Wi.length;hn<Dn;hn++)me.push(Wi[hn])}return new p.AnimationClip(Ee,We,me)}function mt(fe){return gi(bi.clips[fe],zt)}function Nt(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"skin":me.id=Se(Pe.getAttribute("source")),me.skin=Gt(Pe);break;case"morph":me.id=Se(Pe.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}bi.controllers[fe.getAttribute("id")]=me}function Gt(fe){const me={sources:{}};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"bind_shape_matrix":me.bindShapeMatrix=re(Pe.textContent);break;case"source":const li=Pe.getAttribute("id");me.sources[li]=Dr(Pe);break;case"joints":me.joints=ii(Pe);break;case"vertex_weights":me.vertexWeights=zi(Pe);break}}return me}function ii(fe){const me={inputs:{}};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"input":const li=Pe.getAttribute("semantic"),Mi=Se(Pe.getAttribute("source"));me.inputs[li]=Mi;break}}return me}function zi(fe){const me={inputs:{}};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"input":const li=Pe.getAttribute("semantic"),Mi=Se(Pe.getAttribute("source")),Wi=parseInt(Pe.getAttribute("offset"));me.inputs[li]={id:Mi,offset:Wi};break;case"vcount":me.vcount=ce(Pe.textContent);break;case"v":me.v=ce(Pe.textContent);break}}return me}function Hi(fe){const me={id:fe.id},Ee=bi.geometries[me.id];return fe.skin!==void 0&&(me.skin=on(fe.skin),Ee.sources.skinIndices=me.skin.indices,Ee.sources.skinWeights=me.skin.weights),me}function on(fe){const Ee={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},We=fe.sources,Pe=fe.vertexWeights,li=Pe.vcount,Mi=Pe.v,Wi=Pe.inputs.JOINT.offset,hn=Pe.inputs.WEIGHT.offset,Dn=fe.sources[fe.joints.inputs.JOINT],Zi=fe.sources[fe.joints.inputs.INV_BIND_MATRIX],Kt=We[Pe.inputs.WEIGHT.id].array;let nn=0,Ei,Ln,Vi;for(Ei=0,Vi=li.length;Ei<Vi;Ei++){const cr=li[Ei],gr=[];for(Ln=0;Ln<cr;Ln++){const _r=Mi[nn+Wi],Rr=Mi[nn+hn],ur=Kt[Rr];gr.push({index:_r,weight:ur}),nn+=2}for(gr.sort(fn),Ln=0;Ln<4;Ln++){const _r=gr[Ln];_r!==void 0?(Ee.indices.array.push(_r.index),Ee.weights.array.push(_r.weight)):(Ee.indices.array.push(0),Ee.weights.array.push(0))}}for(fe.bindShapeMatrix?Ee.bindMatrix=new p.Matrix4().fromArray(fe.bindShapeMatrix).transpose():Ee.bindMatrix=new p.Matrix4().identity(),Ei=0,Vi=Dn.array.length;Ei<Vi;Ei++){const cr=Dn.array[Ei],gr=new p.Matrix4().fromArray(Zi.array,Ei*Zi.stride).transpose();Ee.joints.push({name:cr,boneInverse:gr})}return Ee;function fn(cr,gr){return gr.weight-cr.weight}}function mn(fe){return gi(bi.controllers[fe],Hi)}function Qe(fe){const me={init_from:n(fe,"init_from")[0].textContent};bi.images[fe.getAttribute("id")]=me}function Yn(fe){return fe.build!==void 0?fe.build:fe.init_from}function pr(fe){const me=bi.images[fe];return me!==void 0?gi(me,Yn):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",fe),null)}function bt(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"profile_COMMON":me.profile=je(Pe);break}}bi.effects[fe.getAttribute("id")]=me}function je(fe){const me={surfaces:{},samplers:{}};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"newparam":Ot(Pe,me);break;case"technique":me.technique=Fe(Pe);break;case"extra":me.extra=Mt(Pe);break}}return me}function Ot(fe,me){const Ee=fe.getAttribute("sid");for(let We=0,Pe=fe.childNodes.length;We<Pe;We++){const li=fe.childNodes[We];if(li.nodeType===1)switch(li.nodeName){case"surface":me.surfaces[Ee]=Le(li);break;case"sampler2D":me.samplers[Ee]=Ie(li);break}}}function Le(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"init_from":me.init_from=Pe.textContent;break}}return me}function Ie(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"source":me.source=Pe.textContent;break}}return me}function Fe(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"constant":case"lambert":case"blinn":case"phong":me.type=Pe.nodeName,me.parameters=Ge(Pe);break}}return me}function Ge(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":me[Pe.nodeName]=Je(Pe);break;case"transparent":me[Pe.nodeName]={opaque:Pe.getAttribute("opaque"),data:Je(Pe)};break}}return me}function Je(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"color":me[Pe.nodeName]=re(Pe.textContent);break;case"float":me[Pe.nodeName]=parseFloat(Pe.textContent);break;case"texture":me[Pe.nodeName]={id:Pe.getAttribute("texture"),extra:st(Pe)};break}}return me}function st(fe){const me={technique:{}};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"extra":lt(Pe,me);break}}return me}function lt(fe,me){for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"technique":Tt(Pe,me);break}}}function Tt(fe,me){for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":me.technique[Pe.nodeName]=parseFloat(Pe.textContent);break;case"wrapU":case"wrapV":Pe.textContent.toUpperCase()==="TRUE"?me.technique[Pe.nodeName]=1:Pe.textContent.toUpperCase()==="FALSE"?me.technique[Pe.nodeName]=0:me.technique[Pe.nodeName]=parseInt(Pe.textContent);break}}}function Mt(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"technique":me.technique=ci(Pe);break}}return me}function ci(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"double_sided":me[Pe.nodeName]=parseInt(Pe.textContent);break}}return me}function xi(fe){return fe}function an(fe){return gi(bi.effects[fe],xi)}function cn(fe){const me={name:fe.getAttribute("name")};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"instance_effect":me.url=Se(Pe.getAttribute("url"));break}}bi.materials[fe.getAttribute("id")]=me}function _n(fe){let me,Ee=fe.slice((fe.lastIndexOf(".")-1>>>0)+2);switch(Ee=Ee.toLowerCase(),Ee){case"tga":me=Ve;break;default:me=Te}return me}function Fn(fe){const me=an(fe.url),Ee=me.profile.technique,We=me.profile.extra;let Pe;switch(Ee.type){case"phong":case"blinn":Pe=new p.MeshPhongMaterial;break;case"lambert":Pe=new p.MeshLambertMaterial;break;default:Pe=new p.MeshBasicMaterial;break}Pe.name=fe.name||"";function li(Dn){const Zi=me.profile.samplers[Dn.id];let Kt=null;if(Zi!==void 0){const nn=me.profile.surfaces[Zi.source];Kt=pr(nn.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),Kt=pr(Dn.id);if(Kt!==null){const nn=_n(Kt);if(nn!==void 0){const Ei=nn.load(Kt),Ln=Dn.extra;if(Ln!==void 0&&Ln.technique!==void 0&&ht(Ln.technique)===!1){const Vi=Ln.technique;Ei.wrapS=Vi.wrapU?p.RepeatWrapping:p.ClampToEdgeWrapping,Ei.wrapT=Vi.wrapV?p.RepeatWrapping:p.ClampToEdgeWrapping,Ei.offset.set(Vi.offsetU||0,Vi.offsetV||0),Ei.repeat.set(Vi.repeatU||1,Vi.repeatV||1)}else Ei.wrapS=p.RepeatWrapping,Ei.wrapT=p.RepeatWrapping;return Ei}else return console.warn("THREE.ColladaLoader: THREE.Loader for texture %s not found.",Kt),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",Dn.id),null}const Mi=Ee.parameters;for(const Dn in Mi){const Zi=Mi[Dn];switch(Dn){case"diffuse":Zi.color&&Pe.color.fromArray(Zi.color),Zi.texture&&(Pe.map=li(Zi.texture));break;case"specular":Zi.color&&Pe.specular&&Pe.specular.fromArray(Zi.color),Zi.texture&&(Pe.specularMap=li(Zi.texture));break;case"bump":Zi.texture&&(Pe.normalMap=li(Zi.texture));break;case"ambient":Zi.texture&&(Pe.lightMap=li(Zi.texture));break;case"shininess":Zi.float&&Pe.shininess&&(Pe.shininess=Zi.float);break;case"emission":Zi.color&&Pe.emissive&&Pe.emissive.fromArray(Zi.color),Zi.texture&&(Pe.emissiveMap=li(Zi.texture));break}}let Wi=Mi.transparent,hn=Mi.transparency;if(hn===void 0&&Wi&&(hn={float:1}),Wi===void 0&&hn&&(Wi={opaque:"A_ONE",data:{color:[1,1,1,1]}}),Wi&&hn)if(Wi.data.texture)Pe.transparent=!0;else{const Dn=Wi.data.color;switch(Wi.opaque){case"A_ONE":Pe.opacity=Dn[3]*hn.float;break;case"RGB_ZERO":Pe.opacity=1-Dn[0]*hn.float;break;case"A_ZERO":Pe.opacity=1-Dn[3]*hn.float;break;case"RGB_ONE":Pe.opacity=Dn[0]*hn.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',Wi.opaque)}Pe.opacity<1&&(Pe.transparent=!0)}return We!==void 0&&We.technique!==void 0&&We.technique.double_sided===1&&(Pe.side=p.DoubleSide),Pe}function Mn(fe){return gi(bi.materials[fe],Fn)}function jn(fe){const me={name:fe.getAttribute("name")};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"optics":me.optics=Lr(Pe);break}}bi.cameras[fe.getAttribute("id")]=me}function Lr(fe){for(let me=0;me<fe.childNodes.length;me++){const Ee=fe.childNodes[me];switch(Ee.nodeName){case"technique_common":return Tr(Ee)}}return{}}function Tr(fe){const me={};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];switch(We.nodeName){case"perspective":case"orthographic":me.technique=We.nodeName,me.parameters=eo(We);break}}return me}function eo(fe){const me={};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];switch(We.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":me[We.nodeName]=parseFloat(We.textContent);break}}return me}function $r(fe){let me;switch(fe.optics.technique){case"perspective":me=new p.PerspectiveCamera(fe.optics.parameters.yfov,fe.optics.parameters.aspect_ratio,fe.optics.parameters.znear,fe.optics.parameters.zfar);break;case"orthographic":let Ee=fe.optics.parameters.ymag,We=fe.optics.parameters.xmag;const Pe=fe.optics.parameters.aspect_ratio;We=We===void 0?Ee*Pe:We,Ee=Ee===void 0?We/Pe:Ee,We*=.5,Ee*=.5,me=new p.OrthographicCamera(-We,We,Ee,-Ee,fe.optics.parameters.znear,fe.optics.parameters.zfar);break;default:me=new p.PerspectiveCamera;break}return me.name=fe.name||"",me}function en(fe){const me=bi.cameras[fe];return me!==void 0?gi(me,$r):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",fe),null)}function Wn(fe){let me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"technique_common":me=Ls(Pe);break}}bi.lights[fe.getAttribute("id")]=me}function Ls(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"directional":case"point":case"spot":case"ambient":me.technique=Pe.nodeName,me.parameters=bo(Pe)}}return me}function bo(fe){const me={};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"color":const li=re(Pe.textContent);me.color=new p.Color().fromArray(li);break;case"falloff_angle":me.falloffAngle=parseFloat(Pe.textContent);break;case"quadratic_attenuation":const Mi=parseFloat(Pe.textContent);me.distance=Mi?Math.sqrt(1/Mi):0;break}}return me}function Lo(fe){let me;switch(fe.technique){case"directional":me=new p.DirectionalLight;break;case"point":me=new p.PointLight;break;case"spot":me=new p.SpotLight;break;case"ambient":me=new p.AmbientLight;break}return fe.parameters.color&&me.color.copy(fe.parameters.color),fe.parameters.distance&&(me.distance=fe.parameters.distance),me}function _s(fe){const me=bi.lights[fe];return me!==void 0?gi(me,Lo):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",fe),null)}function js(fe){const me={name:fe.getAttribute("name"),sources:{},vertices:{},primitives:[]},Ee=n(fe,"mesh")[0];if(Ee!==void 0){for(let We=0;We<Ee.childNodes.length;We++){const Pe=Ee.childNodes[We];if(Pe.nodeType!==1)continue;const li=Pe.getAttribute("id");switch(Pe.nodeName){case"source":me.sources[li]=Dr(Pe);break;case"vertices":me.vertices=no(Pe);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",Pe.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":me.primitives.push(uo(Pe));break;default:console.log(Pe)}}bi.geometries[fe.getAttribute("id")]=me}}function Dr(fe){const me={array:[],stride:3};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"float_array":me.array=re(We.textContent);break;case"Name_array":me.array=J(We.textContent);break;case"technique_common":const Pe=n(We,"accessor")[0];Pe!==void 0&&(me.stride=parseInt(Pe.getAttribute("stride")));break}}return me}function no(fe){const me={};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];We.nodeType===1&&(me[We.getAttribute("semantic")]=Se(We.getAttribute("source")))}return me}function uo(fe){const me={type:fe.nodeName,material:fe.getAttribute("material"),count:parseInt(fe.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let Ee=0,We=fe.childNodes.length;Ee<We;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"input":const li=Se(Pe.getAttribute("source")),Mi=Pe.getAttribute("semantic"),Wi=parseInt(Pe.getAttribute("offset")),hn=parseInt(Pe.getAttribute("set")),Dn=hn>0?Mi+hn:Mi;me.inputs[Dn]={id:li,offset:Wi},me.stride=Math.max(me.stride,Wi+1),Mi==="TEXCOORD"&&(me.hasUV=!0);break;case"vcount":me.vcount=ce(Pe.textContent);break;case"p":me.p=ce(Pe.textContent);break}}return me}function oi(fe){const me={};for(let Ee=0;Ee<fe.length;Ee++){const We=fe[Ee];me[We.type]===void 0&&(me[We.type]=[]),me[We.type].push(We)}return me}function ye(fe){let me=0;for(let Ee=0,We=fe.length;Ee<We;Ee++)fe[Ee].hasUV===!0&&me++;me>0&&me<fe.length&&(fe.uvsNeedsFix=!0)}function ie(fe){const me={},Ee=fe.sources,We=fe.vertices,Pe=fe.primitives;if(Pe.length===0)return{};const li=oi(Pe);for(const Mi in li){const Wi=li[Mi];ye(Wi),me[Mi]=qe(Wi,Ee,We)}return me}function qe(fe,me,Ee){const We={},Pe={array:[],stride:0},li={array:[],stride:0},Mi={array:[],stride:0},Wi={array:[],stride:0},hn={array:[],stride:0},Dn={array:[],stride:4},Zi={array:[],stride:4},Kt=new p.BufferGeometry,nn=[];let Ei=0;for(let Ln=0;Ln<fe.length;Ln++){const Vi=fe[Ln],fn=Vi.inputs;let cr=0;switch(Vi.type){case"lines":case"linestrips":cr=Vi.count*2;break;case"triangles":cr=Vi.count*3;break;case"polylist":for(let gr=0;gr<Vi.count;gr++){const _r=Vi.vcount[gr];switch(_r){case 3:cr+=3;break;case 4:cr+=6;break;default:cr+=(_r-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",Vi.type)}Kt.addGroup(Ei,cr,Ln),Ei+=cr,Vi.material&&nn.push(Vi.material);for(const gr in fn){const _r=fn[gr];switch(gr){case"VERTEX":for(const Rr in Ee){const ur=Ee[Rr];switch(Rr){case"POSITION":const wn=Pe.array.length;if(St(Vi,me[ur],_r.offset,Pe.array),Pe.stride=me[ur].stride,me.skinWeights&&me.skinIndices&&(St(Vi,me.skinIndices,_r.offset,Dn.array),St(Vi,me.skinWeights,_r.offset,Zi.array)),Vi.hasUV===!1&&fe.uvsNeedsFix===!0){const ws=(Pe.array.length-wn)/Pe.stride;for(let wr=0;wr<ws;wr++)Mi.array.push(0,0)}break;case"NORMAL":St(Vi,me[ur],_r.offset,li.array),li.stride=me[ur].stride;break;case"COLOR":St(Vi,me[ur],_r.offset,hn.array),hn.stride=me[ur].stride;break;case"TEXCOORD":St(Vi,me[ur],_r.offset,Mi.array),Mi.stride=me[ur].stride;break;case"TEXCOORD1":St(Vi,me[ur],_r.offset,Wi.array),Mi.stride=me[ur].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',Rr)}}break;case"NORMAL":St(Vi,me[_r.id],_r.offset,li.array),li.stride=me[_r.id].stride;break;case"COLOR":St(Vi,me[_r.id],_r.offset,hn.array),hn.stride=me[_r.id].stride;break;case"TEXCOORD":St(Vi,me[_r.id],_r.offset,Mi.array),Mi.stride=me[_r.id].stride;break;case"TEXCOORD1":St(Vi,me[_r.id],_r.offset,Wi.array),Wi.stride=me[_r.id].stride;break}}}return Pe.array.length>0&&Kt.setAttribute("position",new p.Float32BufferAttribute(Pe.array,Pe.stride)),li.array.length>0&&Kt.setAttribute("normal",new p.Float32BufferAttribute(li.array,li.stride)),hn.array.length>0&&Kt.setAttribute("color",new p.Float32BufferAttribute(hn.array,hn.stride)),Mi.array.length>0&&Kt.setAttribute("uv",new p.Float32BufferAttribute(Mi.array,Mi.stride)),Wi.array.length>0&&Kt.setAttribute("uv2",new p.Float32BufferAttribute(Wi.array,Wi.stride)),Dn.array.length>0&&Kt.setAttribute("skinIndex",new p.Float32BufferAttribute(Dn.array,Dn.stride)),Zi.array.length>0&&Kt.setAttribute("skinWeight",new p.Float32BufferAttribute(Zi.array,Zi.stride)),We.data=Kt,We.type=fe[0].type,We.materialKeys=nn,We}function St(fe,me,Ee,We){const Pe=fe.p,li=fe.stride,Mi=fe.vcount;function Wi(Zi){let Kt=Pe[Zi+Ee]*Dn;const nn=Kt+Dn;for(;Kt<nn;Kt++)We.push(hn[Kt])}const hn=me.array,Dn=me.stride;if(fe.vcount!==void 0){let Zi=0;for(let Kt=0,nn=Mi.length;Kt<nn;Kt++){const Ei=Mi[Kt];if(Ei===4){const Ln=Zi+li*0,Vi=Zi+li*1,fn=Zi+li*2,cr=Zi+li*3;Wi(Ln),Wi(Vi),Wi(cr),Wi(Vi),Wi(fn),Wi(cr)}else if(Ei===3){const Ln=Zi+li*0,Vi=Zi+li*1,fn=Zi+li*2;Wi(Ln),Wi(Vi),Wi(fn)}else if(Ei>4)for(let Ln=1,Vi=Ei-2;Ln<=Vi;Ln++){const fn=Zi+li*0,cr=Zi+li*Ln,gr=Zi+li*(Ln+1);Wi(fn),Wi(cr),Wi(gr)}Zi+=li*Ei}}else for(let Zi=0,Kt=Pe.length;Zi<Kt;Zi+=li)Wi(Zi)}function ut(fe){return gi(bi.geometries[fe],ie)}function Ft(fe){const me={name:fe.getAttribute("name")||"",joints:{},links:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"technique_common":ai(We,me);break}}bi.kinematicsModels[fe.getAttribute("id")]=me}function si(fe){return fe.build!==void 0?fe.build:fe}function $t(fe){return gi(bi.kinematicsModels[fe],si)}function ai(fe,me){for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"joint":me.joints[We.getAttribute("sid")]=fi(We);break;case"link":me.links.push(Pi(We));break}}}function fi(fe){let me;for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"prismatic":case"revolute":me=pi(We);break}}return me}function pi(fe){const me={sid:fe.getAttribute("sid"),name:fe.getAttribute("name")||"",axis:new p.Vector3,limits:{min:0,max:0},type:fe.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"axis":const Pe=re(We.textContent);me.axis.fromArray(Pe);break;case"limits":const li=We.getElementsByTagName("max")[0],Mi=We.getElementsByTagName("min")[0];me.limits.max=parseFloat(li.textContent),me.limits.min=parseFloat(Mi.textContent);break}}return me.limits.min>=me.limits.max&&(me.static=!0),me.middlePosition=(me.limits.min+me.limits.max)/2,me}function Pi(fe){const me={sid:fe.getAttribute("sid"),name:fe.getAttribute("name")||"",attachments:[],transforms:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"attachment_full":me.attachments.push(tn(We));break;case"matrix":case"translate":case"rotate":me.transforms.push(xn(We));break}}return me}function tn(fe){const me={joint:fe.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"link":me.links.push(Pi(We));break;case"matrix":case"translate":case"rotate":me.transforms.push(xn(We));break}}return me}function xn(fe){const me={type:fe.nodeName},Ee=re(fe.textContent);switch(me.type){case"matrix":me.obj=new p.Matrix4,me.obj.fromArray(Ee).transpose();break;case"translate":me.obj=new p.Vector3,me.obj.fromArray(Ee);break;case"rotate":me.obj=new p.Vector3,me.obj.fromArray(Ee),me.angle=p.MathUtils.degToRad(Ee[3]);break}return me}function Jn(fe){const me={name:fe.getAttribute("name")||"",rigidBodies:{}};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"rigid_body":me.rigidBodies[We.getAttribute("name")]={},sr(We,me.rigidBodies[We.getAttribute("name")]);break}}bi.physicsModels[fe.getAttribute("id")]=me}function sr(fe,me){for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"technique_common":ar(We,me);break}}}function ar(fe,me){for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"inertia":me.inertia=re(We.textContent);break;case"mass":me.mass=re(We.textContent)[0];break}}}function er(fe){const me={bindJointAxis:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"bind_joint_axis":me.bindJointAxis.push(Zr(We));break}}bi.kinematicsScenes[Se(fe.getAttribute("url"))]=me}function Zr(fe){const me={target:fe.getAttribute("target").split("/").pop()};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType===1)switch(We.nodeName){case"axis":const Pe=We.getElementsByTagName("param")[0];me.axis=Pe.textContent;const li=me.axis.split("inst_").pop().split("axis")[0];me.jointIndex=li.substr(0,li.length-1);break}}return me}function Gr(fe){return fe.build!==void 0?fe.build:fe}function yr(fe){return gi(bi.kinematicsScenes[fe],Gr)}function Jr(){const fe=Object.keys(bi.kinematicsModels)[0],me=Object.keys(bi.kinematicsScenes)[0],Ee=Object.keys(bi.visualScenes)[0];if(fe===void 0||me===void 0)return;const We=$t(fe),Pe=yr(me),li=Ws(Ee),Mi=Pe.bindJointAxis,Wi={};for(let Zi=0,Kt=Mi.length;Zi<Kt;Zi++){const nn=Mi[Zi],Ei=Us.querySelector('[sid="'+nn.target+'"]');if(Ei){const Ln=Ei.parentElement;hn(nn.jointIndex,Ln)}}function hn(Zi,Kt){const nn=Kt.getAttribute("name"),Ei=We.joints[Zi];li.traverse(function(Ln){Ln.name===nn&&(Wi[Zi]={object:Ln,transforms:us(Kt),joint:Ei,position:Ei.zeroPosition})})}const Dn=new p.Matrix4;Ai={joints:We&&We.joints,getJointValue:function(Zi){const Kt=Wi[Zi];if(Kt)return Kt.position;console.warn("THREE.ColladaLoader: Joint "+Zi+" doesn't exist.")},setJointValue:function(Zi,Kt){const nn=Wi[Zi];if(nn){const Ei=nn.joint;if(Kt>Ei.limits.max||Kt<Ei.limits.min)console.warn("THREE.ColladaLoader: Joint "+Zi+" value "+Kt+" outside of limits (min: "+Ei.limits.min+", max: "+Ei.limits.max+").");else if(Ei.static)console.warn("THREE.ColladaLoader: Joint "+Zi+" is static.");else{const Ln=nn.object,Vi=Ei.axis,fn=nn.transforms;es.identity();for(let cr=0;cr<fn.length;cr++){const gr=fn[cr];if(gr.sid&&gr.sid.indexOf(Zi)!==-1)switch(Ei.type){case"revolute":es.multiply(Dn.makeRotationAxis(Vi,p.MathUtils.degToRad(Kt)));break;case"prismatic":es.multiply(Dn.makeTranslation(Vi.x*Kt,Vi.y*Kt,Vi.z*Kt));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+Ei.type);break}else switch(gr.type){case"matrix":es.multiply(gr.obj);break;case"translate":es.multiply(Dn.makeTranslation(gr.obj.x,gr.obj.y,gr.obj.z));break;case"scale":es.scale(gr.obj);break;case"rotate":es.multiply(Dn.makeRotationAxis(gr.obj,gr.angle));break}}Ln.matrix.copy(es),Ln.matrix.decompose(Ln.position,Ln.quaternion,Ln.scale),Wi[Zi].position=Kt}}else console.log("THREE.ColladaLoader: "+Zi+" does not exist.")}}}function us(fe){const me=[],Ee=Us.querySelector('[id="'+fe.id+'"]');for(let We=0;We<Ee.childNodes.length;We++){const Pe=Ee.childNodes[We];if(Pe.nodeType!==1)continue;let li,Mi;switch(Pe.nodeName){case"matrix":li=re(Pe.textContent);const Wi=new p.Matrix4().fromArray(li).transpose();me.push({sid:Pe.getAttribute("sid"),type:Pe.nodeName,obj:Wi});break;case"translate":case"scale":li=re(Pe.textContent),Mi=new p.Vector3().fromArray(li),me.push({sid:Pe.getAttribute("sid"),type:Pe.nodeName,obj:Mi});break;case"rotate":li=re(Pe.textContent),Mi=new p.Vector3().fromArray(li);const hn=p.MathUtils.degToRad(li[3]);me.push({sid:Pe.getAttribute("sid"),type:Pe.nodeName,obj:Mi,angle:hn});break}}return me}function Ns(fe){const me=fe.getElementsByTagName("node");for(let Ee=0;Ee<me.length;Ee++){const We=me[Ee];We.hasAttribute("id")===!1&&We.setAttribute("id",Xe())}}const es=new p.Matrix4,Fs=new p.Vector3;function Ps(fe){const me={name:fe.getAttribute("name")||"",type:fe.getAttribute("type"),id:fe.getAttribute("id"),sid:fe.getAttribute("sid"),matrix:new p.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];if(We.nodeType!==1)continue;let Pe;switch(We.nodeName){case"node":me.nodes.push(We.getAttribute("id")),Ps(We);break;case"instance_camera":me.instanceCameras.push(Se(We.getAttribute("url")));break;case"instance_controller":me.instanceControllers.push(wo(We));break;case"instance_light":me.instanceLights.push(Se(We.getAttribute("url")));break;case"instance_geometry":me.instanceGeometries.push(wo(We));break;case"instance_node":me.instanceNodes.push(Se(We.getAttribute("url")));break;case"matrix":Pe=re(We.textContent),me.matrix.multiply(es.fromArray(Pe).transpose()),me.transforms[We.getAttribute("sid")]=We.nodeName;break;case"translate":Pe=re(We.textContent),Fs.fromArray(Pe),me.matrix.multiply(es.makeTranslation(Fs.x,Fs.y,Fs.z)),me.transforms[We.getAttribute("sid")]=We.nodeName;break;case"rotate":Pe=re(We.textContent);const li=p.MathUtils.degToRad(Pe[3]);me.matrix.multiply(es.makeRotationAxis(Fs.fromArray(Pe),li)),me.transforms[We.getAttribute("sid")]=We.nodeName;break;case"scale":Pe=re(We.textContent),me.matrix.scale(Fs.fromArray(Pe)),me.transforms[We.getAttribute("sid")]=We.nodeName;break;case"extra":break;default:console.log(We)}}return fo(me.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",me.id):bi.nodes[me.id]=me,me}function wo(fe){const me={id:Se(fe.getAttribute("url")),materials:{},skeletons:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const We=fe.childNodes[Ee];switch(We.nodeName){case"bind_material":const Pe=We.getElementsByTagName("instance_material");for(let li=0;li<Pe.length;li++){const Mi=Pe[li],Wi=Mi.getAttribute("symbol"),hn=Mi.getAttribute("target");me.materials[Wi]=Se(hn)}break;case"skeleton":me.skeletons.push(Se(We.textContent));break}}return me}function Xo(fe,me){const Ee=[],We=[];let Pe,li,Mi;for(Pe=0;Pe<fe.length;Pe++){const Dn=fe[Pe];let Zi;if(fo(Dn))Zi=Bo(Dn),ka(Zi,me,Ee);else if(Ho(Dn)){const nn=bi.visualScenes[Dn].children;for(let Ei=0;Ei<nn.length;Ei++){const Ln=nn[Ei];if(Ln.type==="JOINT"){const Vi=Bo(Ln.id);ka(Vi,me,Ee)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",Dn)}for(Pe=0;Pe<me.length;Pe++)for(li=0;li<Ee.length;li++)if(Mi=Ee[li],Mi.bone.name===me[Pe].name){We[Pe]=Mi,Mi.processed=!0;break}for(Pe=0;Pe<Ee.length;Pe++)Mi=Ee[Pe],Mi.processed===!1&&(We.push(Mi),Mi.processed=!0);const Wi=[],hn=[];for(Pe=0;Pe<We.length;Pe++)Mi=We[Pe],Wi.push(Mi.bone),hn.push(Mi.boneInverse);return new p.Skeleton(Wi,hn)}function ka(fe,me,Ee){fe.traverse(function(We){if(We.isBone===!0){let Pe;for(let li=0;li<me.length;li++){const Mi=me[li];if(Mi.name===We.name){Pe=Mi.boneInverse;break}}Pe===void 0&&(Pe=new p.Matrix4),Ee.push({bone:We,boneInverse:Pe,processed:!1})}})}function ll(fe){const me=[],Ee=fe.matrix,We=fe.nodes,Pe=fe.type,li=fe.instanceCameras,Mi=fe.instanceControllers,Wi=fe.instanceLights,hn=fe.instanceGeometries,Dn=fe.instanceNodes;for(let Kt=0,nn=We.length;Kt<nn;Kt++)me.push(Bo(We[Kt]));for(let Kt=0,nn=li.length;Kt<nn;Kt++){const Ei=en(li[Kt]);Ei!==null&&me.push(Ei.clone())}for(let Kt=0,nn=Mi.length;Kt<nn;Kt++){const Ei=Mi[Kt],Ln=mn(Ei.id),Vi=ut(Ln.id),fn=Go(Vi,Ei.materials),cr=Ei.skeletons,gr=Ln.skin.joints,_r=Xo(cr,gr);for(let Rr=0,ur=fn.length;Rr<ur;Rr++){const wn=fn[Rr];wn.isSkinnedMesh&&(wn.bind(_r,Ln.skin.bindMatrix),wn.normalizeSkinWeights()),me.push(wn)}}for(let Kt=0,nn=Wi.length;Kt<nn;Kt++){const Ei=_s(Wi[Kt]);Ei!==null&&me.push(Ei.clone())}for(let Kt=0,nn=hn.length;Kt<nn;Kt++){const Ei=hn[Kt],Ln=ut(Ei.id),Vi=Go(Ln,Ei.materials);for(let fn=0,cr=Vi.length;fn<cr;fn++)me.push(Vi[fn])}for(let Kt=0,nn=Dn.length;Kt<nn;Kt++)me.push(Bo(Dn[Kt]).clone());let Zi;if(We.length===0&&me.length===1)Zi=me[0];else{Zi=Pe==="JOINT"?new p.Bone:new p.Group;for(let Kt=0;Kt<me.length;Kt++)Zi.add(me[Kt])}return Zi.name=Pe==="JOINT"?fe.sid:fe.name,Zi.matrix.copy(Ee),Zi.matrix.decompose(Zi.position,Zi.quaternion,Zi.scale),Zi}const na=new p.MeshBasicMaterial({color:16711935});function nr(fe,me){const Ee=[];for(let We=0,Pe=fe.length;We<Pe;We++){const li=me[fe[We]];li===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",fe[We]),Ee.push(na)):Ee.push(Mn(li))}return Ee}function Go(fe,me){const Ee=[];for(const We in fe){const Pe=fe[We],li=nr(Pe.materialKeys,me);li.length===0&&(We==="lines"||We==="linestrips"?li.push(new p.LineBasicMaterial):li.push(new p.MeshPhongMaterial));const Mi=Pe.data.attributes.skinIndex!==void 0,Wi=li.length===1?li[0]:li;let hn;switch(We){case"lines":hn=new p.LineSegments(Pe.data,Wi);break;case"linestrips":hn=new p.Line(Pe.data,Wi);break;case"triangles":case"polylist":Mi?hn=new p.SkinnedMesh(Pe.data,Wi):hn=new p.Mesh(Pe.data,Wi);break}Ee.push(hn)}return Ee}function fo(fe){return bi.nodes[fe]!==void 0}function Bo(fe){return gi(bi.nodes[fe],ll)}function ra(fe){const me={name:fe.getAttribute("name"),children:[]};Ns(fe);const Ee=n(fe,"node");for(let We=0;We<Ee.length;We++)me.children.push(Ps(Ee[We]));bi.visualScenes[fe.getAttribute("id")]=me}function mo(fe){const me=new p.Group;me.name=fe.name;const Ee=fe.children;for(let We=0;We<Ee.length;We++){const Pe=Ee[We];me.add(Bo(Pe.id))}return me}function Ho(fe){return bi.visualScenes[fe]!==void 0}function Ws(fe){return gi(bi.visualScenes[fe],mo)}function pa(fe){const me=n(fe,"instance_visual_scene")[0];return Ws(Se(me.getAttribute("url")))}function cl(){const fe=bi.clips;if(ht(fe)===!0){if(ht(bi.animations)===!1){const me=[];for(const Ee in bi.animations){const We=ot(Ee);for(let Pe=0,li=We.length;Pe<li;Pe++)me.push(We[Pe])}Pt.push(new p.AnimationClip("default",-1,me))}}else for(const me in fe)Pt.push(mt(me))}function Fa(fe){let me="";const Ee=[fe];for(;Ee.length;){const We=Ee.shift();We.nodeType===Node.TEXT_NODE?me+=We.textContent:(me+=`
`,Ee.push.apply(Ee,We.childNodes))}return me.trim()}if(q.length===0)return{scene:new p.Scene};const zl=new DOMParser().parseFromString(q,"application/xml"),Us=n(zl,"COLLADA")[0],ul=zl.getElementsByTagName("parsererror")[0];if(ul!==void 0){const fe=n(ul,"div")[0];let me;return fe?me=fe.textContent:me=Fa(ul),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,me),null}const hl=Us.getAttribute("version");console.log("THREE.ColladaLoader: File version",hl);const Ae=Ut(n(Us,"asset")[0]),Te=new p.TextureLoader(this.manager);Te.setPath(this.resourcePath||V).setCrossOrigin(this.crossOrigin);let Ve;p.TGALoader&&(Ve=new p.TGALoader(this.manager),Ve.setPath(this.resourcePath||V));const Pt=[];let Ai={},Ui=0;const bi={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};rt(Us,"library_animations","animation",Zt),rt(Us,"library_animation_clips","animation_clip",Vt),rt(Us,"library_controllers","controller",Nt),rt(Us,"library_images","image",Qe),rt(Us,"library_effects","effect",bt),rt(Us,"library_materials","material",cn),rt(Us,"library_cameras","camera",jn),rt(Us,"library_lights","light",Wn),rt(Us,"library_geometries","geometry",js),rt(Us,"library_nodes","node",Ps),rt(Us,"library_visual_scenes","visual_scene",ra),rt(Us,"library_kinematics_models","kinematics_model",Ft),rt(Us,"library_physics_models","physics_model",Jn),rt(Us,"scene","instance_kinematics_scene",er),pt(bi.animations,Ye),pt(bi.clips,zt),pt(bi.controllers,Hi),pt(bi.images,Yn),pt(bi.effects,xi),pt(bi.materials,Fn),pt(bi.cameras,$r),pt(bi.lights,Lo),pt(bi.geometries,ie),pt(bi.visualScenes,mo),cl(),Jr();const Yi=pa(n(Us,"scene")[0]);return Yi.animations=Pt,Ae.upAxis==="Z_UP"&&Yi.quaternion.setFromEuler(new p.Euler(-Math.PI/2,0,0)),Yi.scale.multiplyScalar(Ae.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Pt},kinematics:Ai,library:bi,scene:Yi}}}p.ColladaLoader=z})(),v.exports=p.ColladaLoader}(kx)),kx.exports}var wM;function RI(){return wM||(wM=1,function(v,y){const p=_c(),z=Ad(),F=SI(),q=EI(),V=CI(),n=LI(),J=II(),re=new F,ce=new q,Se=new n,Xe=new V,ht=new J;function Ut(ct,Dt,rt){if(ct===void 0)return console.error("Invalid options provided to loadObj()");ct=p._validate(ct,z.prototype._defaults.loadObj);let pt;switch(ct.type||(ct.type="mtl"),ct.type){case"mtl":pt=re;break;case"gltf":case"glb":pt=Se;break;case"fbx":pt=Xe;break;case"dae":pt=ht;break}ce.load(ct.mtl,gi,()=>null,At=>{console.warn("No material file found "+At.stack)});function gi(At){At&&ct.type=="mtl"&&(At.preload(),pt.setMaterials(At)),pt.load(ct.obj,It=>{let Ye=[];switch(ct.type){case"mtl":It=It.children[0];break;case"gltf":case"glb":case"dae":Ye=It.animations,It=It.scene;break;case"fbx":Ye=It.animations;break}It.animations=Ye;const ot=p.types.rotation(ct.rotation,[0,0,0]),tt=p.types.scale(ct.scale,[1,1,1]);It.rotation.set(ot[0],ot[1],ot[2]),It.scale.set(tt[0],tt[1],tt[2]),ct.normalize&&Zt(It),It.name="model";let et=z.prototype._makeGroup(It,ct);z.prototype._addMethods(et),et.setAnchor(ct.anchor),et.setCenter(ct.adjustment),et.raycasted=ct.raycasted,rt(et),Dt(et),et.setFixedZoom(ct.mapScale),et.idle()},()=>null,It=>{console.error("Could not load model file: "+ct.obj+` 
 `+It.stack),rt("Error loading the model")})}function Zt(At){At.traverse(function(It){if(It.isMesh){let Ye;It.material.type=="MeshStandardMaterial"?(It.material.metalness&&(It.material.metalness*=.1),It.material.glossiness&&(It.material.glossiness*=.25),Ye=new THREE.Color(12,12,12)):It.material.type=="MeshPhongMaterial"&&(It.material.shininess=.1,Ye=new THREE.Color(20,20,20)),It.material.specular&&It.material.specular.isColor&&(It.material.specular=Ye)}})}}v.exports=Ut}(Rx)),Rx.exports}var Fx={exports:{}},TM;function PI(){return TM||(TM=1,function(v,y){const p=za(),z=_c(),F=Ad();function q(V){V=z._validate(V,F.prototype._defaults.line);var n=z.lnglatsToWorld(V.geometry),J=z.normalizeVertices(n),re=z.flattenVectors(J.vertices),ce=new p.LineGeometry;ce.setPositions(re);let Se=new p.LineMaterial({color:V.color,linewidth:V.width,dashed:!1,opacity:V.opacity});return Se.resolution.set(window.innerWidth,window.innerHeight),Se.isMaterial=!0,Se.transparent=!0,Se.depthWrite=!1,q=new p.Line2(ce,Se),q.position.copy(J.position),q.computeLineDistances(),q}v.exports=q,function(){const V=new p.Box3,n=new p.Vector3;class J extends p.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";const ce=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],Se=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],Xe=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(Xe),this.setAttribute("position",new p.Float32BufferAttribute(ce,3)),this.setAttribute("uv",new p.Float32BufferAttribute(Se,2))}applyMatrix4(ce){const Se=this.attributes.instanceStart,Xe=this.attributes.instanceEnd;return Se!==void 0&&(Se.applyMatrix4(ce),Xe.applyMatrix4(ce),Se.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(ce){let Se;ce instanceof Float32Array?Se=ce:Array.isArray(ce)&&(Se=new Float32Array(ce));const Xe=new p.InstancedInterleavedBuffer(Se,6,1);return this.setAttribute("instanceStart",new p.InterleavedBufferAttribute(Xe,3,0)),this.setAttribute("instanceEnd",new p.InterleavedBufferAttribute(Xe,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(ce){let Se;ce instanceof Float32Array?Se=ce:Array.isArray(ce)&&(Se=new Float32Array(ce));const Xe=new p.InstancedInterleavedBuffer(Se,6,1);return this.setAttribute("instanceColorStart",new p.InterleavedBufferAttribute(Xe,3,0)),this.setAttribute("instanceColorEnd",new p.InterleavedBufferAttribute(Xe,3,3)),this}fromWireframeGeometry(ce){return this.setPositions(ce.attributes.position.array),this}fromEdgesGeometry(ce){return this.setPositions(ce.attributes.position.array),this}fromMesh(ce){return this.fromWireframeGeometry(new p.WireframeGeometry(ce.geometry)),this}fromLineSegments(ce){const Se=ce.geometry;if(Se.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else Se.isBufferGeometry&&this.setPositions(Se.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new p.Box3);const ce=this.attributes.instanceStart,Se=this.attributes.instanceEnd;ce!==void 0&&Se!==void 0&&(this.boundingBox.setFromBufferAttribute(ce),V.setFromBufferAttribute(Se),this.boundingBox.union(V))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new p.Sphere),this.boundingBox===null&&this.computeBoundingBox();const ce=this.attributes.instanceStart,Se=this.attributes.instanceEnd;if(ce!==void 0&&Se!==void 0){const Xe=this.boundingSphere.center;this.boundingBox.getCenter(Xe);let ht=0;for(let Ut=0,ct=ce.count;Ut<ct;Ut++)n.fromBufferAttribute(ce,Ut),ht=Math.max(ht,Xe.distanceToSquared(n)),n.fromBufferAttribute(Se,Ut),ht=Math.max(ht,Xe.distanceToSquared(n));this.boundingSphere.radius=Math.sqrt(ht),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(ce){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(ce)}}J.prototype.isLineSegmentsGeometry=!0,p.LineSegmentsGeometry=J}(),function(){class V extends p.LineSegmentsGeometry{constructor(){super(),this.type="LineGeometry"}setPositions(J){for(var re=J.length-3,ce=new Float32Array(2*re),Se=0;Se<re;Se+=3)ce[2*Se]=J[Se],ce[2*Se+1]=J[Se+1],ce[2*Se+2]=J[Se+2],ce[2*Se+3]=J[Se+3],ce[2*Se+4]=J[Se+4],ce[2*Se+5]=J[Se+5];return super.setPositions(ce),this}setColors(J){for(var re=J.length-3,ce=new Float32Array(2*re),Se=0;Se<re;Se+=3)ce[2*Se]=J[Se],ce[2*Se+1]=J[Se+1],ce[2*Se+2]=J[Se+2],ce[2*Se+3]=J[Se+3],ce[2*Se+4]=J[Se+4],ce[2*Se+5]=J[Se+5];return super.setColors(ce),this}fromLine(J){var re=J.geometry;if(re.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else re.isBufferGeometry&&this.setPositions(re.attributes.position.array);return this}}V.prototype.isLineGeometry=!0,p.LineGeometry=V}(),function(){class V extends p.LineSegmentsGeometry{constructor(J){super(),this.type="WireframeGeometry2",this.fromWireframeGeometry(new p.WireframeGeometry(J))}}V.prototype.isWireframeGeometry2=!0,p.WireframeGeometry2=V}(),function(){p.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new p.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},p.ShaderLib.line={uniforms:p.UniformsUtils.merge([p.UniformsLib.common,p.UniformsLib.fog,p.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		varying vec2 vUv;
		varying vec4 worldPos;
		varying vec3 worldStart;
		varying vec3 worldEnd;

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;

			#endif

			float aspect = resolution.x / resolution.y;

			vUv = uv;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			worldStart = start.xyz;
			worldEnd = end.xyz;

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;
		varying vec4 worldPos;
		varying vec3 worldStart;
		varying vec3 worldEnd;

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		varying vec2 vUv;

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class V extends p.ShaderMaterial{constructor(J){super({type:"LineMaterial",uniforms:p.UniformsUtils.clone(p.ShaderLib.line.uniforms),vertexShader:p.ShaderLib.line.vertexShader,fragmentShader:p.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(re){this.uniforms.diffuse.value=re}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(re){re===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(re){this.uniforms.linewidth.value=re}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(re){!!re!="USE_DASH"in this.defines&&(this.needsUpdate=!0),re===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(re){this.uniforms.dashScale.value=re}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(re){this.uniforms.dashSize.value=re}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(re){this.uniforms.dashOffset.value=re}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(re){this.uniforms.gapSize.value=re}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(re){this.uniforms.opacity.value=re}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(re){this.uniforms.resolution.value.copy(re)}},alphaToCoverage:{enumerable:!0,get:function(){return"ALPHA_TO_COVERAGE"in this.defines},set:function(re){!!re!="ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),re===!0?(this.defines.ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(J)}}V.prototype.isLineMaterial=!0,p.LineMaterial=V}(),function(){const V=new p.Vector3,n=new p.Vector3,J=new p.Vector4,re=new p.Vector4,ce=new p.Vector4,Se=new p.Vector3,Xe=new p.Matrix4,ht=new p.Line3,Ut=new p.Vector3,ct=new p.Box3,Dt=new p.Sphere,rt=new p.Vector4;class pt extends p.Mesh{constructor(Zt=new p.LineSegmentsGeometry,At=new p.LineMaterial({color:Math.random()*16777215})){super(Zt,At),this.type="LineSegments2"}computeLineDistances(){const Zt=this.geometry,At=Zt.attributes.instanceStart,It=Zt.attributes.instanceEnd,Ye=new Float32Array(2*At.count);for(let tt=0,et=0,Rt=At.count;tt<Rt;tt++,et+=2)V.fromBufferAttribute(At,tt),n.fromBufferAttribute(It,tt),Ye[et]=et===0?0:Ye[et-1],Ye[et+1]=Ye[et]+V.distanceTo(n);const ot=new p.InstancedInterleavedBuffer(Ye,2,1);return Zt.setAttribute("instanceDistanceStart",new p.InterleavedBufferAttribute(ot,1,0)),Zt.setAttribute("instanceDistanceEnd",new p.InterleavedBufferAttribute(ot,1,1)),this}raycast(Zt,At){Zt.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');const It=Zt.params.Line2!==void 0&&Zt.params.Line2.threshold||0,Ye=Zt.ray,ot=Zt.camera,tt=ot.projectionMatrix,et=this.matrixWorld,Rt=this.geometry,at=this.material,_t=at.resolution,Qt=at.linewidth+It,ae=Rt.attributes.instanceStart,be=Rt.attributes.instanceEnd,ve=-ot.near,De=2*Math.max(Qt/_t.width,Qt/_t.height);Rt.boundingSphere===null&&Rt.computeBoundingSphere(),Dt.copy(Rt.boundingSphere).applyMatrix4(et);const Ce=Math.max(ot.near,Dt.distanceToPoint(Ye.origin));rt.set(0,0,-Ce,1).applyMatrix4(ot.projectionMatrix),rt.multiplyScalar(1/rt.w),rt.applyMatrix4(ot.projectionMatrixInverse);const Vt=Math.abs(De/rt.w)*.5;if(Dt.radius+=Vt,Zt.ray.intersectsSphere(Dt)===!1)return;Rt.boundingBox===null&&Rt.computeBoundingBox(),ct.copy(Rt.boundingBox).applyMatrix4(et);const zt=Math.max(ot.near,ct.distanceToPoint(Ye.origin));rt.set(0,0,-zt,1).applyMatrix4(ot.projectionMatrix),rt.multiplyScalar(1/rt.w),rt.applyMatrix4(ot.projectionMatrixInverse);const mt=Math.abs(De/rt.w)*.5;if(ct.max.x+=mt,ct.max.y+=mt,ct.max.z+=mt,ct.min.x-=mt,ct.min.y-=mt,ct.min.z-=mt,Zt.ray.intersectsBox(ct)!==!1){Ye.at(1,ce),ce.w=1,ce.applyMatrix4(ot.matrixWorldInverse),ce.applyMatrix4(tt),ce.multiplyScalar(1/ce.w),ce.x*=_t.x/2,ce.y*=_t.y/2,ce.z=0,Se.copy(ce),Xe.multiplyMatrices(ot.matrixWorldInverse,et);for(let Gt=0,ii=ae.count;Gt<ii;Gt++){J.fromBufferAttribute(ae,Gt),re.fromBufferAttribute(be,Gt),J.w=1,re.w=1,J.applyMatrix4(Xe),re.applyMatrix4(Xe);var Nt=J.z>ve&&re.z>ve;if(Nt)continue;if(J.z>ve){const Qe=J.z-re.z,Yn=(J.z-ve)/Qe;J.lerp(re,Yn)}else if(re.z>ve){const Qe=re.z-J.z,Yn=(re.z-ve)/Qe;re.lerp(J,Yn)}J.applyMatrix4(tt),re.applyMatrix4(tt),J.multiplyScalar(1/J.w),re.multiplyScalar(1/re.w),J.x*=_t.x/2,J.y*=_t.y/2,re.x*=_t.x/2,re.y*=_t.y/2,ht.start.copy(J),ht.start.z=0,ht.end.copy(re),ht.end.z=0;const zi=ht.closestPointToPointParameter(Se,!0);ht.at(zi,Ut);const Hi=p.MathUtils.lerp(J.z,re.z,zi),on=Hi>=-1&&Hi<=1,mn=Se.distanceTo(Ut)<Qt*.5;if(on&&mn){ht.start.fromBufferAttribute(ae,Gt),ht.end.fromBufferAttribute(be,Gt),ht.start.applyMatrix4(et),ht.end.applyMatrix4(et);const Qe=new p.Vector3,Yn=new p.Vector3;Ye.distanceSqToSegment(ht.start,ht.end,Yn,Qe),At.push({point:Yn,pointOnLine:Qe,distance:Ye.origin.distanceTo(Yn),object:this,face:null,faceIndex:Gt,uv:null,uv2:null})}}}}}pt.prototype.LineSegments2=!0,p.LineSegments2=pt}(),function(){class V extends p.LineSegments2{constructor(J=new p.LineGeometry,re=new p.LineMaterial({color:Math.random()*16777215})){super(J,re),this.type="Line2"}}V.prototype.isLine2=!0,p.Line2=V}(),function(){const V=new p.Vector3,n=new p.Vector3;class J extends p.Mesh{constructor(ce=new p.LineSegmentsGeometry,Se=new p.LineMaterial({color:Math.random()*16777215})){super(ce,Se),this.type="Wireframe"}computeLineDistances(){const ce=this.geometry,Se=ce.attributes.instanceStart,Xe=ce.attributes.instanceEnd,ht=new Float32Array(2*Se.count);for(let ct=0,Dt=0,rt=Se.count;ct<rt;ct++,Dt+=2)V.fromBufferAttribute(Se,ct),n.fromBufferAttribute(Xe,ct),ht[Dt]=Dt===0?0:ht[Dt-1],ht[Dt+1]=ht[Dt]+V.distanceTo(n);const Ut=new p.InstancedInterleavedBuffer(ht,2,1);return ce.setAttribute("instanceDistanceStart",new p.InterleavedBufferAttribute(Ut,1,0)),ce.setAttribute("instanceDistanceEnd",new p.InterleavedBufferAttribute(Ut,1,1)),this}}J.prototype.isWireframe=!0,p.Wireframe=J}()}(Fx)),Fx.exports}var Bx={exports:{}},MM;function DI(){return MM||(MM=1,function(v,y){const p=_c(),z=X0(),F=Ad(),q=za(),V=K0();function n(J,re){J=p._validate(J,F.prototype._defaults.tube);let ce=[];J.geometry.forEach(ct=>{ce.push(new q.Vector3(ct[0],ct[1],ct[2]))});const Se=new q.CatmullRomCurve3(ce);let Xe=new q.TubeGeometry(Se,ce.length,J.radius,J.sides,!1),ht=z(J),Ut=new q.Mesh(Xe,ht);return new V({obj:Ut,units:J.units,anchor:J.anchor,adjustment:J.adjustment,bbox:J.bbox,tooltip:J.tooltip,raycasted:J.raycasted})}v.exports=n}(Bx)),Bx.exports}var Nx={exports:{}},SM;function OI(){return SM||(SM=1,function(v,y){const p=Y0();function z(F){this.map=F,this.renderer=new p.CSS2DRenderer,this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.id="labelCanvas",this.renderer.domElement.style.top=0,this.renderer.domElement.style.zIndex="0",this.map.getCanvasContainer().appendChild(this.renderer.domElement),this.scene,this.camera,this.dispose=function(){this.map.getCanvasContainer().removeChild(this.renderer.domElement),this.renderer.domElement.remove(),this.renderer={}},this.setSize=function(q,V){this.renderer.setSize(q,V)},this.map.on("resize",(function(){this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight)}).bind(this)),this.state={reset:function(){}},this.render=async function(q,V){return this.scene=q,this.camera=V,new Promise(n=>{n(this.renderer.render(q,V))})},this.toggleLabels=async function(q,V){return new Promise(n=>{n(this.setVisibility(q,V,this.scene,this.camera,this.renderer))})},this.setVisibility=function(q,V,n,J,re){var ce=this.renderer.cacheList;ce.forEach(function(Se){Se.visible!=V&&Se.layer===q&&(V&&Se.alwaysVisible||!V)&&(Se.visible=V,re.renderObject(Se,n,J))})}}v.exports=z}(Nx)),Nx.exports}var Ux={exports:{}},EM;function zI(){return EM||(EM=1,function(v,y){R2();class p{constructor(F,q){this.id=F.layerId,this.type="custom",this.renderingMode="3d",this.opacity=.5,this.buildingsLayerId=F.buildingsLayerId,this.minAltitude=F.minAltitude||.1,this.tb=q}onAdd(F,q){this.map=F;const V=`
			uniform mat4 u_matrix;
			uniform float u_height_factor;
			uniform float u_altitude;
			uniform float u_azimuth;
			attribute vec2 a_pos;
			attribute vec4 a_normal_ed;
			attribute lowp vec2 a_base;
			attribute lowp vec2 a_height;
			void main() {
				float base = max(0.0, a_base.x);
				float height = max(0.0, a_height.x);
				float t = mod(a_normal_ed.x, 2.0);
				vec4 pos = vec4(a_pos, t > 0.0 ? height : base, 1);
				float len = pos.z * u_height_factor / tan(u_altitude);
				pos.x += cos(u_azimuth) * len;
				pos.y += sin(u_azimuth) * len;
				pos.z = 0.0;
				gl_Position = u_matrix * pos;
			}
			`,n=`
			void main() {
				gl_FragColor = vec4(0.0, 0.0, 0.0, 0.7);
			}
			`,J=q.createShader(q.VERTEX_SHADER);q.shaderSource(J,V),q.compileShader(J);const re=q.createShader(q.FRAGMENT_SHADER);q.shaderSource(re,n),q.compileShader(re),this.program=q.createProgram(),q.attachShader(this.program,J),q.attachShader(this.program,re),q.linkProgram(this.program),q.validateProgram(this.program),this.uMatrix=q.getUniformLocation(this.program,"u_matrix"),this.uHeightFactor=q.getUniformLocation(this.program,"u_height_factor"),this.uAltitude=q.getUniformLocation(this.program,"u_altitude"),this.uAzimuth=q.getUniformLocation(this.program,"u_azimuth"),this.aPos=q.getAttribLocation(this.program,"a_pos"),this.aNormal=q.getAttribLocation(this.program,"a_normal_ed"),this.aBase=q.getAttribLocation(this.program,"a_base"),this.aHeight=q.getAttribLocation(this.program,"a_height")}render(F,q){F.useProgram(this.program);const V=this.map.style.sourceCaches.composite,n=V.getVisibleCoordinates().reverse(),J=this.map.getLayer(this.buildingsLayerId),re=this.map.painter.context,{lng:ce,lat:Se}=this.map.getCenter(),Xe=this.tb.getSunPosition(this.tb.lightDateTime,[ce,Se]);F.uniform1f(this.uAltitude,Xe.altitude>this.minAltitude?Xe.altitude:0),F.uniform1f(this.uAzimuth,Xe.azimuth+3*Math.PI/2),F.enable(F.BLEND),F.blendFunc(F.SRC_ALPHA,F.ONE_MINUS_SRC_ALPHA),F.getExtension("EXT_blend_minmax"),F.disable(F.DEPTH_TEST);for(const ht of n){const Ut=V.getTile(ht),ct=Ut.getBucket(J);if(!ct)continue;const[Dt,rt]=ct.programConfigurations.programConfigurations[this.buildingsLayerId]._buffers;F.uniformMatrix4fv(this.uMatrix,!1,ht.posMatrix),F.uniform1f(this.uHeightFactor,Math.pow(2,ht.overscaledZ)/Ut.tileSize/8);for(const pt of ct.segments.get()){const gi=re.currentNumAttributes||0,Zt=2;for(let It=Zt;It<gi;It++)F.disableVertexAttribArray(It);const At=pt.vertexOffset||0;F.enableVertexAttribArray(this.aPos),F.enableVertexAttribArray(this.aNormal),F.enableVertexAttribArray(this.aHeight),F.enableVertexAttribArray(this.aBase),ct.layoutVertexBuffer.bind(),F.vertexAttribPointer(this.aPos,2,F.SHORT,!1,12,12*At),F.vertexAttribPointer(this.aNormal,4,F.SHORT,!1,12,4+12*At),Dt.bind(),F.vertexAttribPointer(this.aHeight,1,F.FLOAT,!1,4,4*At),rt.bind(),F.vertexAttribPointer(this.aBase,1,F.FLOAT,!1,4,4*At),ct.indexBuffer.bind(),re.currentNumAttributes=Zt,F.drawElements(F.TRIANGLES,pt.primitiveLength*3,F.UNSIGNED_SHORT,pt.primitiveOffset*3*2)}}}}v.exports=p}(Ux)),Ux.exports}var AM;function kI(){return AM||(AM=1,function(v,y){const p=za(),z=vI(),F=_c(),q=R2(),V=K1(),n=Ad(),J=X0(),re=bI(),ce=wI(),Se=TI(),Xe=MI(),ht=RI(),Ut=K0(),ct=PI(),Dt=DI(),rt=OI(),pt=zI();function gi(At,It,Ye){this.init(At,It,Ye)}gi.prototype={repaint:function(){this.map.repaint=!0},init:function(At,It,Ye){this.options=F._validate(Ye||{},Zt),this.map=At,this.map.tb=this,this.objects=new n,this.mapboxVersion=parseFloat(this.map.version),this.renderer=new p.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:Ye.preserveDrawingBuffer,canvas:At.getCanvas(),context:It}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.outputEncoding=p.sRGBEncoding,this.renderer.autoClear=!1,this.labelRenderer=new rt(this.map),this.scene=new p.Scene,this.world=new p.Group,this.world.name="world",this.scene.add(this.world),this.objectsCache=new Map,this.zoomLayers=[],this.fov=this.options.fov,this.orthographic=this.options.orthographic||!1,this.raycaster=new p.Raycaster,this.raycaster.layers.set(0),this.mapCenter=this.map.getCenter(),this.mapCenterUnits=F.projectToWorld([this.mapCenter.lng,this.mapCenter.lat]),this.lightDateTime=new Date,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition,this.rotationStep=5,this.gridStep=6,this.altitudeStep=.1,this.defaultCursor="default",this.lights=this.initLights,this.options.defaultLights&&this.defaultLights(),this.options.realSunlight&&this.realSunlight(this.options.realSunlightHelper),this.skyLayerName="sky-layer",this.terrainSourceName="mapbox-dem",this.terrainExaggeration=1,this.terrainLayerName="",this.enableSelectingFeatures=this.options.enableSelectingFeatures||!1,this.enableSelectingObjects=this.options.enableSelectingObjects||!1,this.enableDraggingObjects=this.options.enableDraggingObjects||!1,this.enableRotatingObjects=this.options.enableRotatingObjects||!1,this.enableTooltips=this.options.enableTooltips||!1,this.multiLayer=this.options.multiLayer||!1,this.enableHelpTooltips=this.options.enableHelpTooltips||!1,this.map.on("style.load",function(){this.tb.zoomLayers=[],this.tb.options.multiLayer&&this.addLayer({id:"threebox_layer",type:"custom",renderingMode:"3d",map:this,onAdd:function(tt,et){},render:function(tt,et){this.map.tb.update()}}),this.once("idle",()=>{this.tb.setObjectsScale()}),this.tb.options.sky&&(this.tb.sky=!0),this.tb.options.terrain&&(this.tb.terrain=!0),["satellite","mapbox-mapbox-satellite","satelliteLayer"].forEach(tt=>{this.getLayer(tt)&&(this.tb.terrainLayerName=tt)})}),this.map.on("load",function(){this.selectedObject,this.selectedFeature,this.draggedObject;let ot;this.overedObject,this.overedFeature;let tt=this.getCanvasContainer();this.getCanvasContainer().style.cursor=this.tb.defaultCursor;let et,Rt=[],at,_t,Qt,ae;function be(Gt){var ii=tt.getBoundingClientRect();return{x:Gt.originalEvent.clientX-ii.left-tt.clientLeft,y:Gt.originalEvent.clientY-ii.top-tt.clientTop}}this.unselectObject=function(){this.selectedObject.selected=!1,this.selectedObject=null},this.outObject=function(){this.overedObject.over=!1,this.overedObject=null},this.unselectFeature=function(Gt){typeof Gt.id>"u"||(this.setFeatureState({source:Gt.source,sourceLayer:Gt.sourceLayer,id:Gt.id},{select:!1}),this.removeTooltip(Gt),Gt=this.queryRenderedFeatures({layers:[Gt.layer.id],filter:["==",["id"],Gt.id]})[0],Gt&&this.fire("SelectedFeatureChange",{detail:Gt}),this.selectedFeature=null)},this.selectFeature=function(Gt){this.selectedFeature=Gt,this.setFeatureState({source:this.selectedFeature.source,sourceLayer:this.selectedFeature.sourceLayer,id:this.selectedFeature.id},{select:!0}),this.selectedFeature=this.queryRenderedFeatures({layers:[this.selectedFeature.layer.id],filter:["==",["id"],this.selectedFeature.id]})[0],this.addTooltip(this.selectedFeature),this.fire("SelectedFeatureChange",{detail:this.selectedFeature})},this.outFeature=function(Gt){this.overedFeature&&typeof this.overedFeature<"u"&&this.overedFeature.id!=Gt&&(At.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!1}),this.removeTooltip(this.overedFeature),this.overedFeature=null)},this.addTooltip=function(Gt){if(!this.tb.enableTooltips)return;let ii=this.tb.getFeatureCenter(Gt),zi=this.tb.tooltip({text:Gt.properties.name||Gt.id||Gt.type,mapboxStyle:!0,feature:Gt});zi.setCoords(ii),this.tb.add(zi,Gt.layer.id),Gt.tooltip=zi,Gt.tooltip.tooltip.visible=!0},this.removeTooltip=function(Gt){Gt.tooltip&&(Gt.tooltip.visibility=!1,this.tb.remove(Gt.tooltip),Gt.tooltip=null)},At.onContextMenu=function(Gt){alert("contextMenu")},this.onClick=function(Gt){let ii,zi=[];if(At.tb.enableSelectingObjects&&(zi=this.tb.queryRenderedFeatures(Gt.point)),ii=typeof zi[0]=="object",ii){let Hi=gi.prototype.findParent3DObject(zi[0]);if(Hi){if(this.selectedFeature&&this.unselectFeature(this.selectedFeature),!this.selectedObject)this.selectedObject=Hi,this.selectedObject.selected=!0;else if(this.selectedObject.uuid!=Hi.uuid)this.selectedObject.selected=!1,Hi.selected=!0,this.selectedObject=Hi;else if(this.selectedObject.uuid==Hi.uuid){this.unselectObject();return}this.selectedObject.dispatchEvent({type:"Wireframed",detail:this.selectedObject}),this.selectedObject.dispatchEvent({type:"IsPlayingChanged",detail:this.selectedObject}),this.repaint=!0,Gt.preventDefault()}}else{let Hi=[];if(At.tb.enableSelectingFeatures&&(Hi=this.queryRenderedFeatures(Gt.point)),Hi.length>0&&Hi[0].layer.type=="fill-extrusion"&&typeof Hi[0].id<"u"){if(this.selectedObject&&this.unselectObject(),!this.selectedFeature)this.selectFeature(Hi[0]);else if(this.selectedFeature.id!=Hi[0].id)this.unselectFeature(this.selectedFeature),this.selectFeature(Hi[0]);else if(this.selectedFeature.id==Hi[0].id){this.unselectFeature(this.selectedFeature);return}}}},this.onMouseMove=function(Gt){let ii=be(Gt);if(this.getCanvasContainer().style.cursor=this.tb.defaultCursor,Gt.originalEvent.altKey&&this.draggedObject){if(!At.tb.enableRotatingObjects)return;ot="rotate",this.getCanvasContainer().style.cursor="move",Math.min(et.x,ii.x),Math.max(et.x,ii.x),Math.min(et.y,ii.y),Math.max(et.y,ii.y);let on={x:0,y:0,z:Math.round(ae[2]+~~((ii.x-et.x)/this.tb.rotationStep)%360*this.tb.rotationStep%360)};this.draggedObject.setRotation(on),At.tb.enableHelpTooltips&&this.draggedObject.addHelp("rot: "+on.z+"&#176;");return}if(Gt.originalEvent.shiftKey&&this.draggedObject){if(!At.tb.enableDraggingObjects)return;ot="translate",this.getCanvasContainer().style.cursor="move";let on=Gt.lngLat,mn=[Number((on.lng+at).toFixed(this.tb.gridStep)),Number((on.lat+_t).toFixed(this.tb.gridStep)),this.draggedObject.modelHeight];this.draggedObject.setCoords(mn),At.tb.enableHelpTooltips&&this.draggedObject.addHelp("lng: "+mn[0]+"&#176;, lat: "+mn[1]+"&#176;");return}if(Gt.originalEvent.ctrlKey&&this.draggedObject){if(!At.tb.enableDraggingObjects)return;ot="altitude",this.getCanvasContainer().style.cursor="move";let on=Gt.point.y*this.tb.altitudeStep,mn=[this.draggedObject.coordinates[0],this.draggedObject.coordinates[1],Number((-on-Qt).toFixed(this.tb.gridStep))];this.draggedObject.setCoords(mn),At.tb.enableHelpTooltips&&this.draggedObject.addHelp("alt: "+mn[2]+"m");return}let zi,Hi=[];if(At.tb.enableSelectingObjects&&(Hi=this.tb.queryRenderedFeatures(Gt.point)),zi=typeof Hi[0]=="object",zi){let on=gi.prototype.findParent3DObject(Hi[0]);on&&(this.outFeature(this.overedFeature),this.getCanvasContainer().style.cursor="pointer",!this.selectedObject||on.uuid!=this.selectedObject.uuid?(this.overedObject&&this.overedObject.uuid!=on.uuid&&this.outObject(),on.over=!0,this.overedObject=on):this.selectedObject&&on.uuid==this.selectedObject.uuid&&(on.over=!0,this.overedObject=on),this.repaint=!0,Gt.preventDefault())}else{this.overedObject&&this.outObject();let on=[];At.tb.enableSelectingFeatures&&(on=this.queryRenderedFeatures(Gt.point)),on.length>0&&(this.outFeature(on[0]),on[0].layer.type=="fill-extrusion"&&typeof on[0].id<"u"&&(!this.selectedFeature||this.selectedFeature.id!=on[0].id)&&(this.getCanvasContainer().style.cursor="pointer",this.overedFeature=on[0],this.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!0}),this.overedFeature=At.queryRenderedFeatures({layers:[this.overedFeature.layer.id],filter:["==",["id"],this.overedFeature.id]})[0],this.addTooltip(this.overedFeature)))}},this.onMouseDown=function(Gt){(Gt.originalEvent.shiftKey||Gt.originalEvent.altKey||Gt.originalEvent.ctrlKey)&&Gt.originalEvent.button===0&&this.selectedObject&&(!At.tb.enableDraggingObjects&&!At.tb.enableRotatingObjects||(Gt.preventDefault(),At.getCanvasContainer().style.cursor="move",At.once("mouseup",this.onMouseUp),this.draggedObject=this.selectedObject,et=be(Gt),Rt=this.draggedObject.coordinates,ae=F.degreeify(this.draggedObject.rotation),at=Rt[0]-Gt.lngLat.lng,_t=Rt[1]-Gt.lngLat.lat,Qt=-this.draggedObject.modelHeight-Gt.point.y*this.tb.altitudeStep))},this.onMouseUp=function(Gt){this.getCanvasContainer().style.cursor=this.tb.defaultCursor,this.off("mouseup",this.onMouseUp),this.off("mouseout",this.onMouseUp),this.dragPan.enable(),this.draggedObject&&(this.draggedObject.dispatchEvent({type:"ObjectDragged",detail:{draggedObject:this.draggedObject,draggedAction:ot}}),this.draggedObject.removeHelp(),this.draggedObject=null,ot=null)},this.onMouseOut=function(Gt){if(this.overedFeature){let ii=this.queryRenderedFeatures(Gt.point);ii.length>0&&this.overedFeature.id!=ii[0].id&&(this.getCanvasContainer().style.cursor=this.tb.defaultCursor,this.outFeature(ii[0]))}},this.onZoom=function(Gt){this.tb.zoomLayers.forEach(ii=>{this.tb.toggleLayer(ii)}),this.tb.setObjectsScale()};let ve=!1,De=17,Ce=91,Vt=16,zt=83;function mt(Gt){Gt.which===De||Gt.which,Gt.which===Vt&&(ve=!0);let ii=this.selectedObject;if(ve&&Gt.which===zt&&ii){let zi=F.toDecimal;if(ii.help)ii.removeHelp();else{let Hi=ii.modelSize,on=1;ii.userData.units!=="meters"&&(on=F.projectedUnitsPerMeter(ii.coordinates[1]),on||(on=1),on=zi(on,7)),At.tb.enableHelpTooltips&&ii.addHelp("size(m): "+zi(Hi.x/on,3)+" W, "+zi(Hi.y/on,3)+" L, "+zi(Hi.z/on,3)+" H"),this.repaint=!0}return!1}}function Nt(Gt){Gt.which==De||Gt.which==Ce,Gt.which===Vt&&(ve=!1)}this.on("click",this.onClick),this.on("mousemove",this.onMouseMove),this.on("mouseout",this.onMouseOut),this.on("mousedown",this.onMouseDown),this.on("zoom",this.onZoom),this.on("zoomend",this.onZoom),document.addEventListener("keydown",mt.bind(this),!0),document.addEventListener("keyup",Nt.bind(this))})},get sky(){return this.options.sky},set sky(At){At?this.createSkyLayer():this.removeLayer(this.skyLayerName),this.options.sky=At},get terrain(){return this.options.terrain},set terrain(At){if(this.terrainLayerName="",At)this.createTerrainLayer();else{if(this.mapboxVersion<2){console.warn("Terrain layer are only supported by Mapbox-gl-js > v2.0");return}this.map.getTerrain()&&(this.map.setTerrain(null),this.map.removeSource(this.terrainSourceName))}this.options.terrain=At},get fov(){return this.options.fov},set fov(At){this.camera instanceof p.PerspectiveCamera&&this.options.fov!==At&&(this.map.transform.fov=At,this.camera.fov=this.map.transform.fov,this.cameraSync.setupCamera(),this.map.repaint=!0,this.options.fov=At)},get orthographic(){return this.options.orthographic},set orthographic(At){const It=this.map.getCanvas().clientHeight,Ye=this.map.getCanvas().clientWidth;At?(this.map.transform.fov=0,this.camera=new p.OrthographicCamera(Ye/-2,Ye/2,It/2,It/-2,.1,1e21)):(this.map.transform.fov=this.fov,this.camera=new p.PerspectiveCamera(this.map.transform.fov,Ye/It,.1,1e21)),this.camera.layers.enable(0),this.camera.layers.enable(1),this.cameraSync=new z(this.map,this.camera,this.world),this.map.repaint=!0,this.options.orthographic=At},createSkyLayer:function(){if(this.mapboxVersion<2){console.warn("Sky layer are only supported by Mapbox-gl-js > v2.0"),this.options.sky=!1;return}this.map.getLayer(this.skyLayerName)||(this.map.addLayer({id:this.skyLayerName,type:"sky",paint:{"sky-opacity":["interpolate",["linear"],["zoom"],0,0,5,.3,8,1],"sky-type":"atmosphere","sky-atmosphere-sun":this.getSunSky(this.lightDateTime),"sky-atmosphere-sun-intensity":10}}),this.map.once("idle",()=>{this.setSunlight(),this.repaint()}))},createTerrainLayer:function(){if(this.mapboxVersion<2){console.warn("Terrain layer are only supported by Mapbox-gl-js > v2.0"),this.options.terrain=!1;return}this.map.getTerrain()||(this.map.addSource(this.terrainSourceName,{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),this.map.setTerrain({source:this.terrainSourceName,exaggeration:this.terrainExaggeration}),this.map.once("idle",()=>{this.cameraSync.updateCamera(),this.repaint()}))},sphere:function(At){return this.setDefaultView(At,this.options),re(At,this.world)},line:ct,label:Se,tooltip:Xe,tube:function(At){return this.setDefaultView(At,this.options),Dt(At,this.world)},extrusion:function(At){return this.setDefaultView(At,this.options),ce(At)},Object3D:function(At){return this.setDefaultView(At,this.options),Ut(At)},loadObj:async function(It,Ye){if(this.setDefaultView(It,this.options),It.clone===!1)return new Promise(async ot=>{ht(It,Ye,async tt=>{ot(tt)})});{let ot=this.objectsCache.get(It.obj);ot?ot.promise.then(tt=>{Ye(tt.duplicate(It))}).catch(tt=>{this.objectsCache.delete(It.obj),console.error("Could not load model file: "+It.obj)}):this.objectsCache.set(It.obj,{promise:new Promise(async(tt,et)=>{ht(It,Ye,async Rt=>{Rt.duplicate?tt(Rt.duplicate()):et(Rt)})})})}},material:function(At){return J(At)},initLights:{ambientLight:null,dirLight:null,dirLightBack:null,dirLightHelper:null,hemiLight:null,pointLight:null},utils:F,SunCalc:q,Constants:V,projectToWorld:function(At){return this.utils.projectToWorld(At)},unprojectFromWorld:function(At){return this.utils.unprojectFromWorld(At)},projectedUnitsPerMeter:function(At){return this.utils.projectedUnitsPerMeter(At)},getFeatureCenter:function(It,Ye,ot){return F.getFeatureCenter(It,Ye,ot)},getObjectHeightOnFloor:function(At,It,Ye){return F.getObjectHeightOnFloor(At,It,Ye)},queryRenderedFeatures:function(At){let It=new p.Vector2;return It.x=At.x/this.map.transform.width*2-1,It.y=1-At.y/this.map.transform.height*2,this.raycaster.setFromCamera(It,this.camera),this.raycaster.intersectObjects(this.world.children,!0)},findParent3DObject:function(At){var It;return At.object.traverseAncestors(function(Ye){Ye.parent&&Ye.parent.type=="Group"&&Ye.userData.obj&&(It=Ye)}),It},setLayoutProperty:function(At,It,Ye){this.map.setLayoutProperty(At,It,Ye),Ye!=null&&It==="visibility"&&this.world.children.filter(ot=>ot.layer===At).forEach(ot=>{ot.visibility=Ye})},setLayerZoomRange:function(At,It,Ye){this.map.getLayer(At)&&(this.map.setLayerZoomRange(At,It,Ye),this.zoomLayers.includes(At)||this.zoomLayers.push(At),this.toggleLayer(At))},setLayerHeigthProperty:function(At,It){let Ye=this.map.getLayer(At);if(Ye)if(Ye.type=="fill-extrusion"){let ot=this.map.getStyle().sources[Ye.source].data;ot.features.forEach(function(et){et.properties.level=It}),this.map.getSource(Ye.source).setData(ot)}else Ye.type=="custom"&&this.world.children.forEach(function(ot){let tt=ot.userData.feature;if(tt&&tt.layer===At){let et=this.tb.getFeatureCenter(tt,ot,It);ot.setCoords(et)}})},setObjectsScale:function(){this.world.children.filter(At=>At.fixedZoom!=null).forEach(At=>{At.setObjectScale(this.map.transform.scale)})},setStyle:function(At,It){this.clear().then(()=>{this.map.setStyle(At,It)})},toggleLayer:function(At,It=!0){let Ye=this.map.getLayer(At);if(Ye){if(!It){this.toggle(Ye.id,!1);return}let ot=this.map.getZoom();if(Ye.minzoom&&ot<Ye.minzoom){this.toggle(Ye.id,!1);return}if(Ye.maxzoom&&ot>=Ye.maxzoom){this.toggle(Ye.id,!1);return}this.toggle(Ye.id,!0)}},toggle:function(At,It){this.setLayoutProperty(At,"visibility",It?"visible":"none"),this.labelRenderer.toggleLabels(At,It)},update:function(){this.map.repaint&&(this.map.repaint=!1);var At=Date.now();this.objects.animationManager.update(At),this.updateLightHelper(),this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.labelRenderer.render(this.scene,this.camera),this.options.passiveRendering===!1&&this.map.triggerRepaint()},add:function(At,It,Ye){if(!this.enableTooltips&&At.tooltip&&(At.tooltip.visibility=!1),this.world.add(At),It){At.layer=It,At.source=Ye;let ot=this.map.getLayer(It);if(ot){let tt=ot.visibility,et=typeof tt>"u";At.visibility=!!(et||tt==="visible")}}},removeByName:function(At){let It=this.world.getObjectByName(At);It&&this.remove(It)},remove:function(At){this.map.selectedObject&&At.uuid==this.map.selectedObject.uuid&&this.map.unselectObject(),this.map.draggedObject&&At.uuid==this.map.draggedObject.uuid&&(this.map.draggedObject=null),At.dispose&&At.dispose(),this.world.remove(At),At=null},clear:async function(At=null,It=!1){return new Promise((Ye,ot)=>{let tt=[];this.world.children.forEach(function(et){tt.push(et)});for(let et=0;et<tt.length;et++){let Rt=tt[et];(Rt.layer===At||!At)&&this.remove(Rt)}It&&this.objectsCache.forEach(et=>{et.promise.then(Rt=>{Rt.dispose(),Rt=null})}),Ye("clear")})},removeLayer:function(At){this.clear(At,!0).then(()=>{this.map.removeLayer(At)})},getSunPosition:function(At,It){return q.getPosition(At||Date.now(),It[1],It[0])},getSunTimes:function(At,It){return q.getTimes(At,It[1],It[0],It[2]?It[2]:0)},setBuildingShadows:function(At){if(this.map.getLayer(At.buildingsLayerId)){let It=new pt(At,this);this.map.addLayer(It,At.buildingsLayerId)}else console.warn("The layer '"+At.buildingsLayerId+"' does not exist in the map.")},setSunlight:function(At=new Date,It){if(!this.lights.dirLight||!this.options.realSunlight){console.warn("To use setSunlight it's required to set realSunlight : true in Threebox initial options.");return}var Ye=new Date(At.getTime());if(It?It.lng&&It.lat?this.mapCenter=It:this.mapCenter={lng:It[0],lat:It[1]}:this.mapCenter=this.map.getCenter(),this.lightDateTime&&this.lightDateTime.getTime()===Ye.getTime()&&this.lightLng===this.mapCenter.lng&&this.lightLat===this.mapCenter.lat)return;this.lightDateTime=Ye,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition=this.getSunPosition(Ye,[this.mapCenter.lng,this.mapCenter.lat]);let ot=this.sunPosition.altitude,tt=Math.PI+this.sunPosition.azimuth,et=V.WORLD_SIZE/2,Rt=Math.sin(ot),at=Math.cos(ot),_t=Math.cos(tt)*at,Qt=Math.sin(tt)*at;this.lights.dirLight.position.set(Qt,_t,Rt),this.lights.dirLight.position.multiplyScalar(et),this.lights.dirLight.intensity=Math.max(Rt,0),this.lights.hemiLight.intensity=Math.max(Rt*1,.1),this.lights.dirLight.updateMatrixWorld(),this.updateLightHelper(),this.map.loaded()&&(this.updateSunGround(this.sunPosition),this.map.setLight({anchor:"map",position:[3,180+this.sunPosition.azimuth*180/Math.PI,90-this.sunPosition.altitude*180/Math.PI],intensity:Math.cos(this.sunPosition.altitude),color:`hsl(40, ${50*Math.cos(this.sunPosition.altitude)}%, ${Math.max(20,20+96*Math.sin(this.sunPosition.altitude))}%)`},{duration:0}),this.sky&&this.updateSunSky(this.getSunSky(Ye,this.sunPosition)))},getSunSky:function(At,It){if(!It){var Ye=this.map.getCenter();It=this.getSunPosition(At||Date.now(),[Ye.lng,Ye.lat])}var ot=180+It.azimuth*180/Math.PI,tt=90-It.altitude*180/Math.PI;return[ot,tt]},updateSunSky:function(At){this.sky&&this.map.setPaintProperty(this.skyLayerName,"sky-atmosphere-sun",At)},updateSunGround:function(At){this.terrainLayerName!=""&&this.map.setPaintProperty(this.terrainLayerName,"raster-opacity",Math.max(Math.min(1,At.altitude*4),.25))},updateLightHelper:function(){this.lights.dirLightHelper&&(this.lights.dirLightHelper.position.setFromMatrixPosition(this.lights.dirLight.matrixWorld),this.lights.dirLightHelper.updateMatrix(),this.lights.dirLightHelper.update())},dispose:async function(){return console.log(this.memory()),new Promise(At=>{At(this.clear(null,!0).then(It=>(this.map.remove(),this.map={},this.scene.remove(this.world),this.world.children=[],this.world=null,this.objectsCache.clear(),this.labelRenderer.dispose(),console.log(this.memory()),this.renderer.dispose(),It)))})},defaultLights:function(){this.lights.ambientLight=new p.AmbientLight(new p.Color("hsl(0, 0%, 100%)"),.75),this.scene.add(this.lights.ambientLight),this.lights.dirLightBack=new p.DirectionalLight(new p.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLightBack.position.set(30,100,100),this.scene.add(this.lights.dirLightBack),this.lights.dirLight=new p.DirectionalLight(new p.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLight.position.set(-30,100,-100),this.scene.add(this.lights.dirLight)},realSunlight:function(At=!1){this.renderer.shadowMap.enabled=!0,this.lights.dirLight=new p.DirectionalLight(16777215,1),this.scene.add(this.lights.dirLight),At&&(this.lights.dirLightHelper=new p.DirectionalLightHelper(this.lights.dirLight,5),this.scene.add(this.lights.dirLightHelper));let It=1e3,Ye=2,ot=8192;this.lights.dirLight.castShadow=!0,this.lights.dirLight.shadow.radius=Ye,this.lights.dirLight.shadow.mapSize.width=ot,this.lights.dirLight.shadow.mapSize.height=ot,this.lights.dirLight.shadow.camera.top=this.lights.dirLight.shadow.camera.right=It,this.lights.dirLight.shadow.camera.bottom=this.lights.dirLight.shadow.camera.left=-It,this.lights.dirLight.shadow.camera.near=1,this.lights.dirLight.shadow.camera.visible=!0,this.lights.dirLight.shadow.camera.far=4e8,this.lights.hemiLight=new p.HemisphereLight(new p.Color(16777215),new p.Color(16777215),.6),this.lights.hemiLight.color.setHSL(.661,.96,.12),this.lights.hemiLight.groundColor.setHSL(.11,.96,.14),this.lights.hemiLight.position.set(0,0,50),this.scene.add(this.lights.hemiLight),this.setSunlight(),this.map.once("idle",()=>{this.setSunlight(),this.repaint()})},setDefaultView:function(At,It){At.bbox=(At.bbox||At.bbox==null)&&It.enableSelectingObjects,At.tooltip=(At.tooltip||At.tooltip==null)&&It.enableTooltips,At.mapScale=this.map.transform.scale},memory:function(){return this.renderer.info.memory},programs:function(){return this.renderer.info.programs.length},version:"2.2.7"};var Zt={defaultLights:!1,realSunlight:!1,realSunlightHelper:!1,passiveRendering:!0,preserveDrawingBuffer:!1,enableSelectingFeatures:!1,enableSelectingObjects:!1,enableDraggingObjects:!1,enableRotatingObjects:!1,enableTooltips:!1,enableHelpTooltips:!1,multiLayer:!1,orthographic:!1,fov:V.FOV_DEGREES,sky:!1,terrain:!1};v.exports=gi}(gx)),gx.exports}var CM;function FI(){return CM||(CM=1,function(v,y){v.exports={Threebox:kI(),THREE:za()}}(mx)),mx.exports}var BI=FI();const{min:NI,max:UI}=Math,Jf=(v,y=0,p=1)=>NI(UI(y,v),p),J1=v=>{v._clipped=!1,v._unclipped=v.slice(0);for(let y=0;y<=3;y++)y<3?((v[y]<0||v[y]>255)&&(v._clipped=!0),v[y]=Jf(v[y],0,255)):y===3&&(v[y]=Jf(v[y],0,1));return v},P2={};for(let v of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])P2[`[object ${v}]`]=v.toLowerCase();function ks(v){return P2[Object.prototype.toString.call(v)]||"object"}const bs=(v,y=null)=>v.length>=3?Array.prototype.slice.call(v):ks(v[0])=="object"&&y?y.split("").filter(p=>v[0][p]!==void 0).map(p=>v[0][p]):v[0].slice(0),Tg=v=>{if(v.length<2)return null;const y=v.length-1;return ks(v[y])=="string"?v[y].toLowerCase():null},{PI:J0,min:D2,max:O2}=Math,Xc=v=>Math.round(v*100)/100,T1=v=>Math.round(v*100)/100,yd=J0*2,Vx=J0/3,VI=J0/180,GI=180/J0;function z2(v){return[...v.slice(0,3).reverse(),...v.slice(3)]}const ms={format:{},autodetect:[]};class Vn{constructor(...y){const p=this;if(ks(y[0])==="object"&&y[0].constructor&&y[0].constructor===this.constructor)return y[0];let z=Tg(y),F=!1;if(!z){F=!0,ms.sorted||(ms.autodetect=ms.autodetect.sort((q,V)=>V.p-q.p),ms.sorted=!0);for(let q of ms.autodetect)if(z=q.test(...y),z)break}if(ms.format[z]){const q=ms.format[z].apply(null,F?y:y.slice(0,-1));p._rgb=J1(q)}else throw new Error("unknown format: "+y);p._rgb.length===3&&p._rgb.push(1)}toString(){return ks(this.hex)=="function"?this.hex():`[${this._rgb.join(",")}]`}}const HI="3.1.2",Hs=(...v)=>new Vn(...v);Hs.version=HI;const fg={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},jI=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,WI=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,k2=v=>{if(v.match(jI)){(v.length===4||v.length===7)&&(v=v.substr(1)),v.length===3&&(v=v.split(""),v=v[0]+v[0]+v[1]+v[1]+v[2]+v[2]);const y=parseInt(v,16),p=y>>16,z=y>>8&255,F=y&255;return[p,z,F,1]}if(v.match(WI)){(v.length===5||v.length===9)&&(v=v.substr(1)),v.length===4&&(v=v.split(""),v=v[0]+v[0]+v[1]+v[1]+v[2]+v[2]+v[3]+v[3]);const y=parseInt(v,16),p=y>>24&255,z=y>>16&255,F=y>>8&255,q=Math.round((y&255)/255*100)/100;return[p,z,F,q]}throw new Error(`unknown hex color: ${v}`)},{round:a0}=Math,F2=(...v)=>{let[y,p,z,F]=bs(v,"rgba"),q=Tg(v)||"auto";F===void 0&&(F=1),q==="auto"&&(q=F<1?"rgba":"rgb"),y=a0(y),p=a0(p),z=a0(z);let n="000000"+(y<<16|p<<8|z).toString(16);n=n.substr(n.length-6);let J="0"+a0(F*255).toString(16);switch(J=J.substr(J.length-2),q.toLowerCase()){case"rgba":return`#${n}${J}`;case"argb":return`#${J}${n}`;default:return`#${n}`}};Vn.prototype.name=function(){const v=F2(this._rgb,"rgb");for(let y of Object.keys(fg))if(fg[y]===v)return y.toLowerCase();return v};ms.format.named=v=>{if(v=v.toLowerCase(),fg[v])return k2(fg[v]);throw new Error("unknown color name: "+v)};ms.autodetect.push({p:5,test:(v,...y)=>{if(!y.length&&ks(v)==="string"&&fg[v.toLowerCase()])return"named"}});Vn.prototype.alpha=function(v,y=!1){return v!==void 0&&ks(v)==="number"?y?(this._rgb[3]=v,this):new Vn([this._rgb[0],this._rgb[1],this._rgb[2],v],"rgb"):this._rgb[3]};Vn.prototype.clipped=function(){return this._rgb._clipped||!1};const Rh={Kn:18,labWhitePoint:"d65",Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452,kE:216/24389,kKE:8,kK:24389/27,RefWhiteRGB:{X:.95047,Y:1,Z:1.08883},MtxRGB2XYZ:{m00:.4124564390896922,m01:.21267285140562253,m02:.0193338955823293,m10:.357576077643909,m11:.715152155287818,m12:.11919202588130297,m20:.18043748326639894,m21:.07217499330655958,m22:.9503040785363679},MtxXYZ2RGB:{m00:3.2404541621141045,m01:-.9692660305051868,m02:.055643430959114726,m10:-1.5371385127977166,m11:1.8760108454466942,m12:-.2040259135167538,m20:-.498531409556016,m21:.041556017530349834,m22:1.0572251882231791},As:.9414285350000001,Bs:1.040417467,Cs:1.089532651,MtxAdaptMa:{m00:.8951,m01:-.7502,m02:.0389,m10:.2664,m11:1.7135,m12:-.0685,m20:-.1614,m21:.0367,m22:1.0296},MtxAdaptMaI:{m00:.9869929054667123,m01:.43230526972339456,m02:-.008528664575177328,m10:-.14705425642099013,m11:.5183602715367776,m12:.04004282165408487,m20:.15996265166373125,m21:.0492912282128556,m22:.9684866957875502}},qI=new Map([["a",[1.0985,.35585]],["b",[1.0985,.35585]],["c",[.98074,1.18232]],["d50",[.96422,.82521]],["d55",[.95682,.92149]],["d65",[.95047,1.08883]],["e",[1,1,1]],["f2",[.99186,.67393]],["f7",[.95041,1.08747]],["f11",[1.00962,.6435]],["icc",[.96422,.82521]]]);function xd(v){const y=qI.get(String(v).toLowerCase());if(!y)throw new Error("unknown Lab illuminant "+v);Rh.labWhitePoint=v,Rh.Xn=y[0],Rh.Zn=y[1]}function J_(){return Rh.labWhitePoint}const Q1=(...v)=>{v=bs(v,"lab");const[y,p,z]=v,[F,q,V]=$I(y,p,z),[n,J,re]=B2(F,q,V);return[n,J,re,v.length>3?v[3]:1]},$I=(v,y,p)=>{const{kE:z,kK:F,kKE:q,Xn:V,Yn:n,Zn:J}=Rh,re=(v+16)/116,ce=.002*y+re,Se=re-.005*p,Xe=ce*ce*ce,ht=Se*Se*Se,Ut=Xe>z?Xe:(116*ce-16)/F,ct=v>q?Math.pow((v+16)/116,3):v/F,Dt=ht>z?ht:(116*Se-16)/F,rt=Ut*V,pt=ct*n,gi=Dt*J;return[rt,pt,gi]},Gx=v=>{const y=Math.sign(v);return v=Math.abs(v),(v<=.0031308?v*12.92:1.055*Math.pow(v,1/2.4)-.055)*y},B2=(v,y,p)=>{const{MtxAdaptMa:z,MtxAdaptMaI:F,MtxXYZ2RGB:q,RefWhiteRGB:V,Xn:n,Yn:J,Zn:re}=Rh,ce=n*z.m00+J*z.m10+re*z.m20,Se=n*z.m01+J*z.m11+re*z.m21,Xe=n*z.m02+J*z.m12+re*z.m22,ht=V.X*z.m00+V.Y*z.m10+V.Z*z.m20,Ut=V.X*z.m01+V.Y*z.m11+V.Z*z.m21,ct=V.X*z.m02+V.Y*z.m12+V.Z*z.m22,Dt=(v*z.m00+y*z.m10+p*z.m20)*(ht/ce),rt=(v*z.m01+y*z.m11+p*z.m21)*(Ut/Se),pt=(v*z.m02+y*z.m12+p*z.m22)*(ct/Xe),gi=Dt*F.m00+rt*F.m10+pt*F.m20,Zt=Dt*F.m01+rt*F.m11+pt*F.m21,At=Dt*F.m02+rt*F.m12+pt*F.m22,It=Gx(gi*q.m00+Zt*q.m10+At*q.m20),Ye=Gx(gi*q.m01+Zt*q.m11+At*q.m21),ot=Gx(gi*q.m02+Zt*q.m12+At*q.m22);return[It*255,Ye*255,ot*255]},eb=(...v)=>{const[y,p,z,...F]=bs(v,"rgb"),[q,V,n]=N2(y,p,z),[J,re,ce]=ZI(q,V,n);return[J,re,ce,...F.length>0&&F[0]<1?[F[0]]:[]]};function ZI(v,y,p){const{Xn:z,Yn:F,Zn:q,kE:V,kK:n}=Rh,J=v/z,re=y/F,ce=p/q,Se=J>V?Math.pow(J,1/3):(n*J+16)/116,Xe=re>V?Math.pow(re,1/3):(n*re+16)/116,ht=ce>V?Math.pow(ce,1/3):(n*ce+16)/116;return[116*Xe-16,500*(Se-Xe),200*(Xe-ht)]}function Hx(v){const y=Math.sign(v);return v=Math.abs(v),(v<=.04045?v/12.92:Math.pow((v+.055)/1.055,2.4))*y}const N2=(v,y,p)=>{v=Hx(v/255),y=Hx(y/255),p=Hx(p/255);const{MtxRGB2XYZ:z,MtxAdaptMa:F,MtxAdaptMaI:q,Xn:V,Yn:n,Zn:J,As:re,Bs:ce,Cs:Se}=Rh;let Xe=v*z.m00+y*z.m10+p*z.m20,ht=v*z.m01+y*z.m11+p*z.m21,Ut=v*z.m02+y*z.m12+p*z.m22;const ct=V*F.m00+n*F.m10+J*F.m20,Dt=V*F.m01+n*F.m11+J*F.m21,rt=V*F.m02+n*F.m12+J*F.m22;let pt=Xe*F.m00+ht*F.m10+Ut*F.m20,gi=Xe*F.m01+ht*F.m11+Ut*F.m21,Zt=Xe*F.m02+ht*F.m12+Ut*F.m22;return pt*=ct/re,gi*=Dt/ce,Zt*=rt/Se,Xe=pt*q.m00+gi*q.m10+Zt*q.m20,ht=pt*q.m01+gi*q.m11+Zt*q.m21,Ut=pt*q.m02+gi*q.m12+Zt*q.m22,[Xe,ht,Ut]};Vn.prototype.lab=function(){return eb(this._rgb)};const XI=(...v)=>new Vn(...v,"lab");Object.assign(Hs,{lab:XI,getLabWhitePoint:J_,setLabWhitePoint:xd});ms.format.lab=Q1;ms.autodetect.push({p:2,test:(...v)=>{if(v=bs(v,"lab"),ks(v)==="array"&&v.length===3)return"lab"}});Vn.prototype.darken=function(v=1){const y=this,p=y.lab();return p[0]-=Rh.Kn*v,new Vn(p,"lab").alpha(y.alpha(),!0)};Vn.prototype.brighten=function(v=1){return this.darken(-v)};Vn.prototype.darker=Vn.prototype.darken;Vn.prototype.brighter=Vn.prototype.brighten;Vn.prototype.get=function(v){const[y,p]=v.split("."),z=this[y]();if(p){const F=y.indexOf(p)-(y.substr(0,2)==="ok"?2:0);if(F>-1)return z[F];throw new Error(`unknown channel ${p} in mode ${y}`)}else return z};const{pow:YI}=Math,KI=1e-7,JI=20;Vn.prototype.luminance=function(v,y="rgb"){if(v!==void 0&&ks(v)==="number"){if(v===0)return new Vn([0,0,0,this._rgb[3]],"rgb");if(v===1)return new Vn([255,255,255,this._rgb[3]],"rgb");let p=this.luminance(),z=JI;const F=(V,n)=>{const J=V.interpolate(n,.5,y),re=J.luminance();return Math.abs(v-re)<KI||!z--?J:re>v?F(V,J):F(J,n)},q=(p>v?F(new Vn([0,0,0]),this):F(this,new Vn([255,255,255]))).rgb();return new Vn([...q,this._rgb[3]])}return QI(...this._rgb.slice(0,3))};const QI=(v,y,p)=>(v=jx(v),y=jx(y),p=jx(p),.2126*v+.7152*y+.0722*p),jx=v=>(v/=255,v<=.03928?v/12.92:YI((v+.055)/1.055,2.4)),al={},mg=(v,y,p=.5,...z)=>{let F=z[0]||"lrgb";if(!al[F]&&!z.length&&(F=Object.keys(al)[0]),!al[F])throw new Error(`interpolation mode ${F} is not defined`);return ks(v)!=="object"&&(v=new Vn(v)),ks(y)!=="object"&&(y=new Vn(y)),al[F](v,y,p).alpha(v.alpha()+p*(y.alpha()-v.alpha()))};Vn.prototype.mix=Vn.prototype.interpolate=function(v,y=.5,...p){return mg(this,v,y,...p)};Vn.prototype.premultiply=function(v=!1){const y=this._rgb,p=y[3];return v?(this._rgb=[y[0]*p,y[1]*p,y[2]*p,p],this):new Vn([y[0]*p,y[1]*p,y[2]*p,p],"rgb")};const{sin:eR,cos:tR}=Math,U2=(...v)=>{let[y,p,z]=bs(v,"lch");return isNaN(z)&&(z=0),z=z*VI,[y,tR(z)*p,eR(z)*p]},ib=(...v)=>{v=bs(v,"lch");const[y,p,z]=v,[F,q,V]=U2(y,p,z),[n,J,re]=Q1(F,q,V);return[n,J,re,v.length>3?v[3]:1]},iR=(...v)=>{const y=z2(bs(v,"hcl"));return ib(...y)},{sqrt:nR,atan2:rR,round:sR}=Math,V2=(...v)=>{const[y,p,z]=bs(v,"lab"),F=nR(p*p+z*z);let q=(rR(z,p)*GI+360)%360;return sR(F*1e4)===0&&(q=Number.NaN),[y,F,q]},nb=(...v)=>{const[y,p,z,...F]=bs(v,"rgb"),[q,V,n]=eb(y,p,z),[J,re,ce]=V2(q,V,n);return[J,re,ce,...F.length>0&&F[0]<1?[F[0]]:[]]};Vn.prototype.lch=function(){return nb(this._rgb)};Vn.prototype.hcl=function(){return z2(nb(this._rgb))};const oR=(...v)=>new Vn(...v,"lch"),aR=(...v)=>new Vn(...v,"hcl");Object.assign(Hs,{lch:oR,hcl:aR});ms.format.lch=ib;ms.format.hcl=iR;["lch","hcl"].forEach(v=>ms.autodetect.push({p:2,test:(...y)=>{if(y=bs(y,v),ks(y)==="array"&&y.length===3)return v}}));Vn.prototype.saturate=function(v=1){const y=this,p=y.lch();return p[1]+=Rh.Kn*v,p[1]<0&&(p[1]=0),new Vn(p,"lch").alpha(y.alpha(),!0)};Vn.prototype.desaturate=function(v=1){return this.saturate(-v)};Vn.prototype.set=function(v,y,p=!1){const[z,F]=v.split("."),q=this[z]();if(F){const V=z.indexOf(F)-(z.substr(0,2)==="ok"?2:0);if(V>-1){if(ks(y)=="string")switch(y.charAt(0)){case"+":q[V]+=+y;break;case"-":q[V]+=+y;break;case"*":q[V]*=+y.substr(1);break;case"/":q[V]/=+y.substr(1);break;default:q[V]=+y}else if(ks(y)==="number")q[V]=y;else throw new Error("unsupported value for Color.set");const n=new Vn(q,z);return p?(this._rgb=n._rgb,this):n}throw new Error(`unknown channel ${F} in mode ${z}`)}else return q};Vn.prototype.tint=function(v=.5,...y){return mg(this,"white",v,...y)};Vn.prototype.shade=function(v=.5,...y){return mg(this,"black",v,...y)};const lR=(v,y,p)=>{const z=v._rgb,F=y._rgb;return new Vn(z[0]+p*(F[0]-z[0]),z[1]+p*(F[1]-z[1]),z[2]+p*(F[2]-z[2]),"rgb")};al.rgb=lR;const{sqrt:Wx,pow:Km}=Math,cR=(v,y,p)=>{const[z,F,q]=v._rgb,[V,n,J]=y._rgb;return new Vn(Wx(Km(z,2)*(1-p)+Km(V,2)*p),Wx(Km(F,2)*(1-p)+Km(n,2)*p),Wx(Km(q,2)*(1-p)+Km(J,2)*p),"rgb")};al.lrgb=cR;const uR=(v,y,p)=>{const z=v.lab(),F=y.lab();return new Vn(z[0]+p*(F[0]-z[0]),z[1]+p*(F[1]-z[1]),z[2]+p*(F[2]-z[2]),"lab")};al.lab=uR;const Mg=(v,y,p,z)=>{let F,q;z==="hsl"?(F=v.hsl(),q=y.hsl()):z==="hsv"?(F=v.hsv(),q=y.hsv()):z==="hcg"?(F=v.hcg(),q=y.hcg()):z==="hsi"?(F=v.hsi(),q=y.hsi()):z==="lch"||z==="hcl"?(z="hcl",F=v.hcl(),q=y.hcl()):z==="oklch"&&(F=v.oklch().reverse(),q=y.oklch().reverse());let V,n,J,re,ce,Se;(z.substr(0,1)==="h"||z==="oklch")&&([V,J,ce]=F,[n,re,Se]=q);let Xe,ht,Ut,ct;return!isNaN(V)&&!isNaN(n)?(n>V&&n-V>180?ct=n-(V+360):n<V&&V-n>180?ct=n+360-V:ct=n-V,ht=V+p*ct):isNaN(V)?isNaN(n)?ht=Number.NaN:(ht=n,(ce==1||ce==0)&&z!="hsv"&&(Xe=re)):(ht=V,(Se==1||Se==0)&&z!="hsv"&&(Xe=J)),Xe===void 0&&(Xe=J+p*(re-J)),Ut=ce+p*(Se-ce),z==="oklch"?new Vn([Ut,Xe,ht],z):new Vn([ht,Xe,Ut],z)},G2=(v,y,p)=>Mg(v,y,p,"lch");al.lch=G2;al.hcl=G2;const hR=v=>{if(ks(v)=="number"&&v>=0&&v<=16777215){const y=v>>16,p=v>>8&255,z=v&255;return[y,p,z,1]}throw new Error("unknown num color: "+v)},dR=(...v)=>{const[y,p,z]=bs(v,"rgb");return(y<<16)+(p<<8)+z};Vn.prototype.num=function(){return dR(this._rgb)};const pR=(...v)=>new Vn(...v,"num");Object.assign(Hs,{num:pR});ms.format.num=hR;ms.autodetect.push({p:5,test:(...v)=>{if(v.length===1&&ks(v[0])==="number"&&v[0]>=0&&v[0]<=16777215)return"num"}});const fR=(v,y,p)=>{const z=v.num(),F=y.num();return new Vn(z+p*(F-z),"num")};al.num=fR;const{floor:mR}=Math,gR=(...v)=>{v=bs(v,"hcg");let[y,p,z]=v,F,q,V;z=z*255;const n=p*255;if(p===0)F=q=V=z;else{y===360&&(y=0),y>360&&(y-=360),y<0&&(y+=360),y/=60;const J=mR(y),re=y-J,ce=z*(1-p),Se=ce+n*(1-re),Xe=ce+n*re,ht=ce+n;switch(J){case 0:[F,q,V]=[ht,Xe,ce];break;case 1:[F,q,V]=[Se,ht,ce];break;case 2:[F,q,V]=[ce,ht,Xe];break;case 3:[F,q,V]=[ce,Se,ht];break;case 4:[F,q,V]=[Xe,ce,ht];break;case 5:[F,q,V]=[ht,ce,Se];break}}return[F,q,V,v.length>3?v[3]:1]},_R=(...v)=>{const[y,p,z]=bs(v,"rgb"),F=D2(y,p,z),q=O2(y,p,z),V=q-F,n=V*100/255,J=F/(255-V)*100;let re;return V===0?re=Number.NaN:(y===q&&(re=(p-z)/V),p===q&&(re=2+(z-y)/V),z===q&&(re=4+(y-p)/V),re*=60,re<0&&(re+=360)),[re,n,J]};Vn.prototype.hcg=function(){return _R(this._rgb)};const yR=(...v)=>new Vn(...v,"hcg");Hs.hcg=yR;ms.format.hcg=gR;ms.autodetect.push({p:1,test:(...v)=>{if(v=bs(v,"hcg"),ks(v)==="array"&&v.length===3)return"hcg"}});const vR=(v,y,p)=>Mg(v,y,p,"hcg");al.hcg=vR;const{cos:Jm}=Math,xR=(...v)=>{v=bs(v,"hsi");let[y,p,z]=v,F,q,V;return isNaN(y)&&(y=0),isNaN(p)&&(p=0),y>360&&(y-=360),y<0&&(y+=360),y/=360,y<1/3?(V=(1-p)/3,F=(1+p*Jm(yd*y)/Jm(Vx-yd*y))/3,q=1-(V+F)):y<2/3?(y-=1/3,F=(1-p)/3,q=(1+p*Jm(yd*y)/Jm(Vx-yd*y))/3,V=1-(F+q)):(y-=2/3,q=(1-p)/3,V=(1+p*Jm(yd*y)/Jm(Vx-yd*y))/3,F=1-(q+V)),F=Jf(z*F*3),q=Jf(z*q*3),V=Jf(z*V*3),[F*255,q*255,V*255,v.length>3?v[3]:1]},{min:bR,sqrt:wR,acos:TR}=Math,MR=(...v)=>{let[y,p,z]=bs(v,"rgb");y/=255,p/=255,z/=255;let F;const q=bR(y,p,z),V=(y+p+z)/3,n=V>0?1-q/V:0;return n===0?F=NaN:(F=(y-p+(y-z))/2,F/=wR((y-p)*(y-p)+(y-z)*(p-z)),F=TR(F),z>p&&(F=yd-F),F/=yd),[F*360,n,V]};Vn.prototype.hsi=function(){return MR(this._rgb)};const SR=(...v)=>new Vn(...v,"hsi");Hs.hsi=SR;ms.format.hsi=xR;ms.autodetect.push({p:2,test:(...v)=>{if(v=bs(v,"hsi"),ks(v)==="array"&&v.length===3)return"hsi"}});const ER=(v,y,p)=>Mg(v,y,p,"hsi");al.hsi=ER;const M1=(...v)=>{v=bs(v,"hsl");const[y,p,z]=v;let F,q,V;if(p===0)F=q=V=z*255;else{const n=[0,0,0],J=[0,0,0],re=z<.5?z*(1+p):z+p-z*p,ce=2*z-re,Se=y/360;n[0]=Se+1/3,n[1]=Se,n[2]=Se-1/3;for(let Xe=0;Xe<3;Xe++)n[Xe]<0&&(n[Xe]+=1),n[Xe]>1&&(n[Xe]-=1),6*n[Xe]<1?J[Xe]=ce+(re-ce)*6*n[Xe]:2*n[Xe]<1?J[Xe]=re:3*n[Xe]<2?J[Xe]=ce+(re-ce)*(2/3-n[Xe])*6:J[Xe]=ce;[F,q,V]=[J[0]*255,J[1]*255,J[2]*255]}return v.length>3?[F,q,V,v[3]]:[F,q,V,1]},H2=(...v)=>{v=bs(v,"rgba");let[y,p,z]=v;y/=255,p/=255,z/=255;const F=D2(y,p,z),q=O2(y,p,z),V=(q+F)/2;let n,J;return q===F?(n=0,J=Number.NaN):n=V<.5?(q-F)/(q+F):(q-F)/(2-q-F),y==q?J=(p-z)/(q-F):p==q?J=2+(z-y)/(q-F):z==q&&(J=4+(y-p)/(q-F)),J*=60,J<0&&(J+=360),v.length>3&&v[3]!==void 0?[J,n,V,v[3]]:[J,n,V]};Vn.prototype.hsl=function(){return H2(this._rgb)};const AR=(...v)=>new Vn(...v,"hsl");Hs.hsl=AR;ms.format.hsl=M1;ms.autodetect.push({p:2,test:(...v)=>{if(v=bs(v,"hsl"),ks(v)==="array"&&v.length===3)return"hsl"}});const CR=(v,y,p)=>Mg(v,y,p,"hsl");al.hsl=CR;const{floor:LR}=Math,IR=(...v)=>{v=bs(v,"hsv");let[y,p,z]=v,F,q,V;if(z*=255,p===0)F=q=V=z;else{y===360&&(y=0),y>360&&(y-=360),y<0&&(y+=360),y/=60;const n=LR(y),J=y-n,re=z*(1-p),ce=z*(1-p*J),Se=z*(1-p*(1-J));switch(n){case 0:[F,q,V]=[z,Se,re];break;case 1:[F,q,V]=[ce,z,re];break;case 2:[F,q,V]=[re,z,Se];break;case 3:[F,q,V]=[re,ce,z];break;case 4:[F,q,V]=[Se,re,z];break;case 5:[F,q,V]=[z,re,ce];break}}return[F,q,V,v.length>3?v[3]:1]},{min:RR,max:PR}=Math,DR=(...v)=>{v=bs(v,"rgb");let[y,p,z]=v;const F=RR(y,p,z),q=PR(y,p,z),V=q-F;let n,J,re;return re=q/255,q===0?(n=Number.NaN,J=0):(J=V/q,y===q&&(n=(p-z)/V),p===q&&(n=2+(z-y)/V),z===q&&(n=4+(y-p)/V),n*=60,n<0&&(n+=360)),[n,J,re]};Vn.prototype.hsv=function(){return DR(this._rgb)};const OR=(...v)=>new Vn(...v,"hsv");Hs.hsv=OR;ms.format.hsv=IR;ms.autodetect.push({p:2,test:(...v)=>{if(v=bs(v,"hsv"),ks(v)==="array"&&v.length===3)return"hsv"}});const zR=(v,y,p)=>Mg(v,y,p,"hsv");al.hsv=zR;function P0(v,y){let p=v.length;Array.isArray(v[0])||(v=[v]),Array.isArray(y[0])||(y=y.map(V=>[V]));let z=y[0].length,F=y[0].map((V,n)=>y.map(J=>J[n])),q=v.map(V=>F.map(n=>Array.isArray(V)?V.reduce((J,re,ce)=>J+re*(n[ce]||0),0):n.reduce((J,re)=>J+re*V,0)));return p===1&&(q=q[0]),z===1?q.map(V=>V[0]):q}const rb=(...v)=>{v=bs(v,"lab");const[y,p,z,...F]=v,[q,V,n]=kR([y,p,z]),[J,re,ce]=B2(q,V,n);return[J,re,ce,...F.length>0&&F[0]<1?[F[0]]:[]]};function kR(v){var y=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],p=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],z=P0(p,v);return P0(y,z.map(F=>F**3))}const sb=(...v)=>{const[y,p,z,...F]=bs(v,"rgb"),q=N2(y,p,z);return[...FR(q),...F.length>0&&F[0]<1?[F[0]]:[]]};function FR(v){const y=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],p=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],z=P0(y,v);return P0(p,z.map(F=>Math.cbrt(F)))}Vn.prototype.oklab=function(){return sb(this._rgb)};const BR=(...v)=>new Vn(...v,"oklab");Object.assign(Hs,{oklab:BR});ms.format.oklab=rb;ms.autodetect.push({p:2,test:(...v)=>{if(v=bs(v,"oklab"),ks(v)==="array"&&v.length===3)return"oklab"}});const NR=(v,y,p)=>{const z=v.oklab(),F=y.oklab();return new Vn(z[0]+p*(F[0]-z[0]),z[1]+p*(F[1]-z[1]),z[2]+p*(F[2]-z[2]),"oklab")};al.oklab=NR;const UR=(v,y,p)=>Mg(v,y,p,"oklch");al.oklch=UR;const{pow:qx,sqrt:$x,PI:Zx,cos:LM,sin:IM,atan2:VR}=Math,GR=(v,y="lrgb",p=null)=>{const z=v.length;p||(p=Array.from(new Array(z)).map(()=>1));const F=z/p.reduce(function(Se,Xe){return Se+Xe});if(p.forEach((Se,Xe)=>{p[Xe]*=F}),v=v.map(Se=>new Vn(Se)),y==="lrgb")return HR(v,p);const q=v.shift(),V=q.get(y),n=[];let J=0,re=0;for(let Se=0;Se<V.length;Se++)if(V[Se]=(V[Se]||0)*p[0],n.push(isNaN(V[Se])?0:p[0]),y.charAt(Se)==="h"&&!isNaN(V[Se])){const Xe=V[Se]/180*Zx;J+=LM(Xe)*p[0],re+=IM(Xe)*p[0]}let ce=q.alpha()*p[0];v.forEach((Se,Xe)=>{const ht=Se.get(y);ce+=Se.alpha()*p[Xe+1];for(let Ut=0;Ut<V.length;Ut++)if(!isNaN(ht[Ut]))if(n[Ut]+=p[Xe+1],y.charAt(Ut)==="h"){const ct=ht[Ut]/180*Zx;J+=LM(ct)*p[Xe+1],re+=IM(ct)*p[Xe+1]}else V[Ut]+=ht[Ut]*p[Xe+1]});for(let Se=0;Se<V.length;Se++)if(y.charAt(Se)==="h"){let Xe=VR(re/n[Se],J/n[Se])/Zx*180;for(;Xe<0;)Xe+=360;for(;Xe>=360;)Xe-=360;V[Se]=Xe}else V[Se]=V[Se]/n[Se];return ce/=z,new Vn(V,y).alpha(ce>.99999?1:ce,!0)},HR=(v,y)=>{const p=v.length,z=[0,0,0,0];for(let F=0;F<v.length;F++){const q=v[F],V=y[F]/p,n=q._rgb;z[0]+=qx(n[0],2)*V,z[1]+=qx(n[1],2)*V,z[2]+=qx(n[2],2)*V,z[3]+=n[3]*V}return z[0]=$x(z[0]),z[1]=$x(z[1]),z[2]=$x(z[2]),z[3]>.9999999&&(z[3]=1),new Vn(J1(z))},{pow:jR}=Math;function D0(v){let y="rgb",p=Hs("#ccc"),z=0,F=[0,1],q=[],V=[0,0],n=!1,J=[],re=!1,ce=0,Se=1,Xe=!1,ht={},Ut=!0,ct=1;const Dt=function(Ye){if(Ye=Ye||["#fff","#000"],Ye&&ks(Ye)==="string"&&Hs.brewer&&Hs.brewer[Ye.toLowerCase()]&&(Ye=Hs.brewer[Ye.toLowerCase()]),ks(Ye)==="array"){Ye.length===1&&(Ye=[Ye[0],Ye[0]]),Ye=Ye.slice(0);for(let ot=0;ot<Ye.length;ot++)Ye[ot]=Hs(Ye[ot]);q.length=0;for(let ot=0;ot<Ye.length;ot++)q.push(ot/(Ye.length-1))}return At(),J=Ye},rt=function(Ye){if(n!=null){const ot=n.length-1;let tt=0;for(;tt<ot&&Ye>=n[tt];)tt++;return tt-1}return 0};let pt=Ye=>Ye,gi=Ye=>Ye;const Zt=function(Ye,ot){let tt,et;if(ot==null&&(ot=!1),isNaN(Ye)||Ye===null)return p;ot?et=Ye:n&&n.length>2?et=rt(Ye)/(n.length-2):Se!==ce?et=(Ye-ce)/(Se-ce):et=1,et=gi(et),ot||(et=pt(et)),ct!==1&&(et=jR(et,ct)),et=V[0]+et*(1-V[0]-V[1]),et=Jf(et,0,1);const Rt=Math.floor(et*1e4);if(Ut&&ht[Rt])tt=ht[Rt];else{if(ks(J)==="array")for(let at=0;at<q.length;at++){const _t=q[at];if(et<=_t){tt=J[at];break}if(et>=_t&&at===q.length-1){tt=J[at];break}if(et>_t&&et<q[at+1]){et=(et-_t)/(q[at+1]-_t),tt=Hs.interpolate(J[at],J[at+1],et,y);break}}else ks(J)==="function"&&(tt=J(et));Ut&&(ht[Rt]=tt)}return tt};var At=()=>ht={};Dt(v);const It=function(Ye){const ot=Hs(Zt(Ye));return re&&ot[re]?ot[re]():ot};return It.classes=function(Ye){if(Ye!=null){if(ks(Ye)==="array")n=Ye,F=[Ye[0],Ye[Ye.length-1]];else{const ot=Hs.analyze(F);Ye===0?n=[ot.min,ot.max]:n=Hs.limits(ot,"e",Ye)}return It}return n},It.domain=function(Ye){if(!arguments.length)return F;ce=Ye[0],Se=Ye[Ye.length-1],q=[];const ot=J.length;if(Ye.length===ot&&ce!==Se)for(let tt of Array.from(Ye))q.push((tt-ce)/(Se-ce));else{for(let tt=0;tt<ot;tt++)q.push(tt/(ot-1));if(Ye.length>2){const tt=Ye.map((Rt,at)=>at/(Ye.length-1)),et=Ye.map(Rt=>(Rt-ce)/(Se-ce));et.every((Rt,at)=>tt[at]===Rt)||(gi=Rt=>{if(Rt<=0||Rt>=1)return Rt;let at=0;for(;Rt>=et[at+1];)at++;const _t=(Rt-et[at])/(et[at+1]-et[at]);return tt[at]+_t*(tt[at+1]-tt[at])})}}return F=[ce,Se],It},It.mode=function(Ye){return arguments.length?(y=Ye,At(),It):y},It.range=function(Ye,ot){return Dt(Ye),It},It.out=function(Ye){return re=Ye,It},It.spread=function(Ye){return arguments.length?(z=Ye,It):z},It.correctLightness=function(Ye){return Ye==null&&(Ye=!0),Xe=Ye,At(),Xe?pt=function(ot){const tt=Zt(0,!0).lab()[0],et=Zt(1,!0).lab()[0],Rt=tt>et;let at=Zt(ot,!0).lab()[0];const _t=tt+(et-tt)*ot;let Qt=at-_t,ae=0,be=1,ve=20;for(;Math.abs(Qt)>.01&&ve-- >0;)(function(){return Rt&&(Qt*=-1),Qt<0?(ae=ot,ot+=(be-ot)*.5):(be=ot,ot+=(ae-ot)*.5),at=Zt(ot,!0).lab()[0],Qt=at-_t})();return ot}:pt=ot=>ot,It},It.padding=function(Ye){return Ye!=null?(ks(Ye)==="number"&&(Ye=[Ye,Ye]),V=Ye,It):V},It.colors=function(Ye,ot){arguments.length<2&&(ot="hex");let tt=[];if(arguments.length===0)tt=J.slice(0);else if(Ye===1)tt=[It(.5)];else if(Ye>1){const et=F[0],Rt=F[1]-et;tt=WR(0,Ye).map(at=>It(et+at/(Ye-1)*Rt))}else{v=[];let et=[];if(n&&n.length>2)for(let Rt=1,at=n.length,_t=1<=at;_t?Rt<at:Rt>at;_t?Rt++:Rt--)et.push((n[Rt-1]+n[Rt])*.5);else et=F;tt=et.map(Rt=>It(Rt))}return Hs[ot]&&(tt=tt.map(et=>et[ot]())),tt},It.cache=function(Ye){return Ye!=null?(Ut=Ye,It):Ut},It.gamma=function(Ye){return Ye!=null?(ct=Ye,It):ct},It.nodata=function(Ye){return Ye!=null?(p=Hs(Ye),It):p},It}function WR(v,y,p){let z=[],F=v<y,q=y;for(let V=v;F?V<q:V>q;F?V++:V--)z.push(V);return z}const qR=function(v){let y=[1,1];for(let p=1;p<v;p++){let z=[1];for(let F=1;F<=y.length;F++)z[F]=(y[F]||0)+y[F-1];y=z}return y},$R=function(v){let y,p,z,F;if(v=v.map(q=>new Vn(q)),v.length===2)[p,z]=v.map(q=>q.lab()),y=function(q){const V=[0,1,2].map(n=>p[n]+q*(z[n]-p[n]));return new Vn(V,"lab")};else if(v.length===3)[p,z,F]=v.map(q=>q.lab()),y=function(q){const V=[0,1,2].map(n=>(1-q)*(1-q)*p[n]+2*(1-q)*q*z[n]+q*q*F[n]);return new Vn(V,"lab")};else if(v.length===4){let q;[p,z,F,q]=v.map(V=>V.lab()),y=function(V){const n=[0,1,2].map(J=>(1-V)*(1-V)*(1-V)*p[J]+3*(1-V)*(1-V)*V*z[J]+3*(1-V)*V*V*F[J]+V*V*V*q[J]);return new Vn(n,"lab")}}else if(v.length>=5){let q,V,n;q=v.map(J=>J.lab()),n=v.length-1,V=qR(n),y=function(J){const re=1-J,ce=[0,1,2].map(Se=>q.reduce((Xe,ht,Ut)=>Xe+V[Ut]*re**(n-Ut)*J**Ut*ht[Se],0));return new Vn(ce,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return y},ZR=v=>{const y=$R(v);return y.scale=()=>D0(y),y},{round:j2}=Math;Vn.prototype.rgb=function(v=!0){return v===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(j2)};Vn.prototype.rgba=function(v=!0){return this._rgb.slice(0,4).map((y,p)=>p<3?v===!1?y:j2(y):y)};const XR=(...v)=>new Vn(...v,"rgb");Object.assign(Hs,{rgb:XR});ms.format.rgb=(...v)=>{const y=bs(v,"rgba");return y[3]===void 0&&(y[3]=1),y};ms.autodetect.push({p:3,test:(...v)=>{if(v=bs(v,"rgba"),ks(v)==="array"&&(v.length===3||v.length===4&&ks(v[3])=="number"&&v[3]>=0&&v[3]<=1))return"rgb"}});const Fu=(v,y,p)=>{if(!Fu[p])throw new Error("unknown blend mode "+p);return Fu[p](v,y)},kp=v=>(y,p)=>{const z=Hs(p).rgb(),F=Hs(y).rgb();return Hs.rgb(v(z,F))},Fp=v=>(y,p)=>{const z=[];return z[0]=v(y[0],p[0]),z[1]=v(y[1],p[1]),z[2]=v(y[2],p[2]),z},YR=v=>v,KR=(v,y)=>v*y/255,JR=(v,y)=>v>y?y:v,QR=(v,y)=>v>y?v:y,eP=(v,y)=>255*(1-(1-v/255)*(1-y/255)),tP=(v,y)=>y<128?2*v*y/255:255*(1-2*(1-v/255)*(1-y/255)),iP=(v,y)=>255*(1-(1-y/255)/(v/255)),nP=(v,y)=>v===255?255:(v=255*(y/255)/(1-v/255),v>255?255:v);Fu.normal=kp(Fp(YR));Fu.multiply=kp(Fp(KR));Fu.screen=kp(Fp(eP));Fu.overlay=kp(Fp(tP));Fu.darken=kp(Fp(JR));Fu.lighten=kp(Fp(QR));Fu.dodge=kp(Fp(nP));Fu.burn=kp(Fp(iP));const{pow:rP,sin:sP,cos:oP}=Math;function aP(v=300,y=-1.5,p=1,z=1,F=[0,1]){let q=0,V;ks(F)==="array"?V=F[1]-F[0]:(V=0,F=[F,F]);const n=function(J){const re=yd*((v+120)/360+y*J),ce=rP(F[0]+V*J,z),Xe=(q!==0?p[0]+J*q:p)*ce*(1-ce)/2,ht=oP(re),Ut=sP(re),ct=ce+Xe*(-.14861*ht+1.78277*Ut),Dt=ce+Xe*(-.29227*ht-.90649*Ut),rt=ce+Xe*(1.97294*ht);return Hs(J1([ct*255,Dt*255,rt*255,1]))};return n.start=function(J){return J==null?v:(v=J,n)},n.rotations=function(J){return J==null?y:(y=J,n)},n.gamma=function(J){return J==null?z:(z=J,n)},n.hue=function(J){return J==null?p:(p=J,ks(p)==="array"?(q=p[1]-p[0],q===0&&(p=p[1])):q=0,n)},n.lightness=function(J){return J==null?F:(ks(J)==="array"?(F=J,V=J[1]-J[0]):(F=[J,J],V=0),n)},n.scale=()=>Hs.scale(n),n.hue(p),n}const lP="0123456789abcdef",{floor:cP,random:uP}=Math,hP=()=>{let v="#";for(let y=0;y<6;y++)v+=lP.charAt(cP(uP()*16));return new Vn(v,"hex")},{log:RM,pow:dP,floor:pP,abs:fP}=Math;function W2(v,y=null){const p={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return ks(v)==="object"&&(v=Object.values(v)),v.forEach(z=>{y&&ks(z)==="object"&&(z=z[y]),z!=null&&!isNaN(z)&&(p.values.push(z),p.sum+=z,z<p.min&&(p.min=z),z>p.max&&(p.max=z),p.count+=1)}),p.domain=[p.min,p.max],p.limits=(z,F)=>q2(p,z,F),p}function q2(v,y="equal",p=7){ks(v)=="array"&&(v=W2(v));const{min:z,max:F}=v,q=v.values.sort((n,J)=>n-J);if(p===1)return[z,F];const V=[];if(y.substr(0,1)==="c"&&(V.push(z),V.push(F)),y.substr(0,1)==="e"){V.push(z);for(let n=1;n<p;n++)V.push(z+n/p*(F-z));V.push(F)}else if(y.substr(0,1)==="l"){if(z<=0)throw new Error("Logarithmic scales are only possible for values > 0");const n=Math.LOG10E*RM(z),J=Math.LOG10E*RM(F);V.push(z);for(let re=1;re<p;re++)V.push(dP(10,n+re/p*(J-n)));V.push(F)}else if(y.substr(0,1)==="q"){V.push(z);for(let n=1;n<p;n++){const J=(q.length-1)*n/p,re=pP(J);if(re===J)V.push(q[re]);else{const ce=J-re;V.push(q[re]*(1-ce)+q[re+1]*ce)}}V.push(F)}else if(y.substr(0,1)==="k"){let n;const J=q.length,re=new Array(J),ce=new Array(p);let Se=!0,Xe=0,ht=null;ht=[],ht.push(z);for(let Dt=1;Dt<p;Dt++)ht.push(z+Dt/p*(F-z));for(ht.push(F);Se;){for(let rt=0;rt<p;rt++)ce[rt]=0;for(let rt=0;rt<J;rt++){const pt=q[rt];let gi=Number.MAX_VALUE,Zt;for(let At=0;At<p;At++){const It=fP(ht[At]-pt);It<gi&&(gi=It,Zt=At),ce[Zt]++,re[rt]=Zt}}const Dt=new Array(p);for(let rt=0;rt<p;rt++)Dt[rt]=null;for(let rt=0;rt<J;rt++)n=re[rt],Dt[n]===null?Dt[n]=q[rt]:Dt[n]+=q[rt];for(let rt=0;rt<p;rt++)Dt[rt]*=1/ce[rt];Se=!1;for(let rt=0;rt<p;rt++)if(Dt[rt]!==ht[rt]){Se=!0;break}ht=Dt,Xe++,Xe>200&&(Se=!1)}const Ut={};for(let Dt=0;Dt<p;Dt++)Ut[Dt]=[];for(let Dt=0;Dt<J;Dt++)n=re[Dt],Ut[n].push(q[Dt]);let ct=[];for(let Dt=0;Dt<p;Dt++)ct.push(Ut[Dt][0]),ct.push(Ut[Dt][Ut[Dt].length-1]);ct=ct.sort((Dt,rt)=>Dt-rt),V.push(ct[0]);for(let Dt=1;Dt<ct.length;Dt+=2){const rt=ct[Dt];!isNaN(rt)&&V.indexOf(rt)===-1&&V.push(rt)}}return V}const mP=(v,y)=>{v=new Vn(v),y=new Vn(y);const p=v.luminance(),z=y.luminance();return p>z?(p+.05)/(z+.05):(z+.05)/(p+.05)};/**
 * @license
 *
 * The APCA contrast prediction algorithm is based of the formulas published
 * in the APCA-1.0.98G specification by Myndex. The specification is available at:
 * https://raw.githubusercontent.com/Myndex/apca-w3/master/images/APCAw3_0.1.17_APCA0.0.98G.svg
 *
 * Note that the APCA implementation is still beta, so please update to
 * future versions of chroma.js when they become available.
 *
 * You can read more about the APCA Readability Criterion at
 * https://readtech.org/ARC/
 */const PM=.027,gP=5e-4,_P=.1,DM=1.14,l0=.022,OM=1.414,yP=(v,y)=>{v=new Vn(v),y=new Vn(y),v.alpha()<1&&(v=mg(y,v,v.alpha(),"rgb"));const p=zM(...v.rgb()),z=zM(...y.rgb()),F=p>=l0?p:p+Math.pow(l0-p,OM),q=z>=l0?z:z+Math.pow(l0-z,OM),V=Math.pow(q,.56)-Math.pow(F,.57),n=Math.pow(q,.65)-Math.pow(F,.62),J=Math.abs(q-F)<gP?0:F<q?V*DM:n*DM;return(Math.abs(J)<_P?0:J>0?J-PM:J+PM)*100};function zM(v,y,p){return .2126729*Math.pow(v/255,2.4)+.7151522*Math.pow(y/255,2.4)+.072175*Math.pow(p/255,2.4)}const{sqrt:md,pow:ua,min:vP,max:xP,atan2:kM,abs:FM,cos:c0,sin:BM,exp:bP,PI:NM}=Math;function wP(v,y,p=1,z=1,F=1){var q=function(Nt){return 360*Nt/(2*NM)},V=function(Nt){return 2*NM*Nt/360};v=new Vn(v),y=new Vn(y);const[n,J,re]=Array.from(v.lab()),[ce,Se,Xe]=Array.from(y.lab()),ht=(n+ce)/2,Ut=md(ua(J,2)+ua(re,2)),ct=md(ua(Se,2)+ua(Xe,2)),Dt=(Ut+ct)/2,rt=.5*(1-md(ua(Dt,7)/(ua(Dt,7)+ua(25,7)))),pt=J*(1+rt),gi=Se*(1+rt),Zt=md(ua(pt,2)+ua(re,2)),At=md(ua(gi,2)+ua(Xe,2)),It=(Zt+At)/2,Ye=q(kM(re,pt)),ot=q(kM(Xe,gi)),tt=Ye>=0?Ye:Ye+360,et=ot>=0?ot:ot+360,Rt=FM(tt-et)>180?(tt+et+360)/2:(tt+et)/2,at=1-.17*c0(V(Rt-30))+.24*c0(V(2*Rt))+.32*c0(V(3*Rt+6))-.2*c0(V(4*Rt-63));let _t=et-tt;_t=FM(_t)<=180?_t:et<=tt?_t+360:_t-360,_t=2*md(Zt*At)*BM(V(_t)/2);const Qt=ce-n,ae=At-Zt,be=1+.015*ua(ht-50,2)/md(20+ua(ht-50,2)),ve=1+.045*It,De=1+.015*It*at,Ce=30*bP(-ua((Rt-275)/25,2)),zt=-(2*md(ua(It,7)/(ua(It,7)+ua(25,7))))*BM(2*V(Ce)),mt=md(ua(Qt/(p*be),2)+ua(ae/(z*ve),2)+ua(_t/(F*De),2)+zt*(ae/(z*ve))*(_t/(F*De)));return xP(0,vP(100,mt))}function TP(v,y,p="lab"){v=new Vn(v),y=new Vn(y);const z=v.get(p),F=y.get(p);let q=0;for(let V in z){const n=(z[V]||0)-(F[V]||0);q+=n*n}return Math.sqrt(q)}const MP=(...v)=>{try{return new Vn(...v),!0}catch{return!1}},SP={cool(){return D0([Hs.hsl(180,1,.9),Hs.hsl(250,.7,.4)])},hot(){return D0(["#000","#f00","#ff0","#fff"]).mode("rgb")}},S1={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},$2=Object.keys(S1),UM=new Map($2.map(v=>[v.toLowerCase(),v])),EP=typeof Proxy=="function"?new Proxy(S1,{get(v,y){const p=y.toLowerCase();if(UM.has(p))return v[UM.get(p)]},getOwnPropertyNames(){return Object.getOwnPropertyNames($2)}}):S1,AP=(...v)=>{v=bs(v,"cmyk");const[y,p,z,F]=v,q=v.length>4?v[4]:1;return F===1?[0,0,0,q]:[y>=1?0:255*(1-y)*(1-F),p>=1?0:255*(1-p)*(1-F),z>=1?0:255*(1-z)*(1-F),q]},{max:VM}=Math,CP=(...v)=>{let[y,p,z]=bs(v,"rgb");y=y/255,p=p/255,z=z/255;const F=1-VM(y,VM(p,z)),q=F<1?1/(1-F):0,V=(1-y-F)*q,n=(1-p-F)*q,J=(1-z-F)*q;return[V,n,J,F]};Vn.prototype.cmyk=function(){return CP(this._rgb)};const LP=(...v)=>new Vn(...v,"cmyk");Object.assign(Hs,{cmyk:LP});ms.format.cmyk=AP;ms.autodetect.push({p:2,test:(...v)=>{if(v=bs(v,"cmyk"),ks(v)==="array"&&v.length===4)return"cmyk"}});const IP=(...v)=>{const y=bs(v,"hsla");let p=Tg(v)||"lsa";return y[0]=Xc(y[0]||0)+"deg",y[1]=Xc(y[1]*100)+"%",y[2]=Xc(y[2]*100)+"%",p==="hsla"||y.length>3&&y[3]<1?(y[3]="/ "+(y.length>3?y[3]:1),p="hsla"):y.length=3,`${p.substr(0,3)}(${y.join(" ")})`},RP=(...v)=>{const y=bs(v,"lab");let p=Tg(v)||"lab";return y[0]=Xc(y[0])+"%",y[1]=Xc(y[1]),y[2]=Xc(y[2]),p==="laba"||y.length>3&&y[3]<1?y[3]="/ "+(y.length>3?y[3]:1):y.length=3,`lab(${y.join(" ")})`},PP=(...v)=>{const y=bs(v,"lch");let p=Tg(v)||"lab";return y[0]=Xc(y[0])+"%",y[1]=Xc(y[1]),y[2]=isNaN(y[2])?"none":Xc(y[2])+"deg",p==="lcha"||y.length>3&&y[3]<1?y[3]="/ "+(y.length>3?y[3]:1):y.length=3,`lch(${y.join(" ")})`},DP=(...v)=>{const y=bs(v,"lab");return y[0]=Xc(y[0]*100)+"%",y[1]=T1(y[1]),y[2]=T1(y[2]),y.length>3&&y[3]<1?y[3]="/ "+(y.length>3?y[3]:1):y.length=3,`oklab(${y.join(" ")})`},Z2=(...v)=>{const[y,p,z,...F]=bs(v,"rgb"),[q,V,n]=sb(y,p,z),[J,re,ce]=V2(q,V,n);return[J,re,ce,...F.length>0&&F[0]<1?[F[0]]:[]]},OP=(...v)=>{const y=bs(v,"lch");return y[0]=Xc(y[0]*100)+"%",y[1]=T1(y[1]),y[2]=isNaN(y[2])?"none":Xc(y[2])+"deg",y.length>3&&y[3]<1?y[3]="/ "+(y.length>3?y[3]:1):y.length=3,`oklch(${y.join(" ")})`},{round:Xx}=Math,zP=(...v)=>{const y=bs(v,"rgba");let p=Tg(v)||"rgb";if(p.substr(0,3)==="hsl")return IP(H2(y),p);if(p.substr(0,3)==="lab"){const z=J_();xd("d50");const F=RP(eb(y),p);return xd(z),F}if(p.substr(0,3)==="lch"){const z=J_();xd("d50");const F=PP(nb(y),p);return xd(z),F}return p.substr(0,5)==="oklab"?DP(sb(y)):p.substr(0,5)==="oklch"?OP(Z2(y)):(y[0]=Xx(y[0]),y[1]=Xx(y[1]),y[2]=Xx(y[2]),(p==="rgba"||y.length>3&&y[3]<1)&&(y[3]="/ "+(y.length>3?y[3]:1),p="rgba"),`${p.substr(0,3)}(${y.slice(0,p==="rgb"?3:4).join(" ")})`)},X2=(...v)=>{v=bs(v,"lch");const[y,p,z,...F]=v,[q,V,n]=U2(y,p,z),[J,re,ce]=rb(q,V,n);return[J,re,ce,...F.length>0&&F[0]<1?[F[0]]:[]]},wd=/((?:-?\d+)|(?:-?\d+(?:\.\d+)?)%|none)/.source,ku=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%?)|none)/.source,O0=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%)|none)/.source,Kc=/\s*/.source,Sg=/\s+/.source,ob=/\s*,\s*/.source,Q0=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)(?:deg)?)|none)/.source,Eg=/\s*(?:\/\s*((?:[01]|[01]?\.\d+)|\d+(?:\.\d+)?%))?/.source,Y2=new RegExp("^rgba?\\("+Kc+[wd,wd,wd].join(Sg)+Eg+"\\)$"),K2=new RegExp("^rgb\\("+Kc+[wd,wd,wd].join(ob)+Kc+"\\)$"),J2=new RegExp("^rgba\\("+Kc+[wd,wd,wd,ku].join(ob)+Kc+"\\)$"),Q2=new RegExp("^hsla?\\("+Kc+[Q0,O0,O0].join(Sg)+Eg+"\\)$"),eE=new RegExp("^hsl?\\("+Kc+[Q0,O0,O0].join(ob)+Kc+"\\)$"),tE=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,iE=new RegExp("^lab\\("+Kc+[ku,ku,ku].join(Sg)+Eg+"\\)$"),nE=new RegExp("^lch\\("+Kc+[ku,ku,Q0].join(Sg)+Eg+"\\)$"),rE=new RegExp("^oklab\\("+Kc+[ku,ku,ku].join(Sg)+Eg+"\\)$"),sE=new RegExp("^oklch\\("+Kc+[ku,ku,Q0].join(Sg)+Eg+"\\)$"),{round:oE}=Math,Qm=v=>v.map((y,p)=>p<=2?Jf(oE(y),0,255):y),ha=(v,y=0,p=100,z=!1)=>(typeof v=="string"&&v.endsWith("%")&&(v=parseFloat(v.substring(0,v.length-1))/100,z?v=y+(v+1)*.5*(p-y):v=y+v*(p-y)),+v),Cl=(v,y)=>v==="none"?y:v,ab=v=>{if(v=v.toLowerCase().trim(),v==="transparent")return[0,0,0,0];let y;if(ms.format.named)try{return ms.format.named(v)}catch{}if((y=v.match(Y2))||(y=v.match(K2))){let p=y.slice(1,4);for(let F=0;F<3;F++)p[F]=+ha(Cl(p[F],0),0,255);p=Qm(p);const z=y[4]!==void 0?+ha(y[4],0,1):1;return p[3]=z,p}if(y=v.match(J2)){const p=y.slice(1,5);for(let z=0;z<4;z++)p[z]=+ha(p[z],0,255);return p}if((y=v.match(Q2))||(y=v.match(eE))){const p=y.slice(1,4);p[0]=+Cl(p[0].replace("deg",""),0),p[1]=+ha(Cl(p[1],0),0,100)*.01,p[2]=+ha(Cl(p[2],0),0,100)*.01;const z=Qm(M1(p)),F=y[4]!==void 0?+ha(y[4],0,1):1;return z[3]=F,z}if(y=v.match(tE)){const p=y.slice(1,4);p[1]*=.01,p[2]*=.01;const z=M1(p);for(let F=0;F<3;F++)z[F]=oE(z[F]);return z[3]=+y[4],z}if(y=v.match(iE)){const p=y.slice(1,4);p[0]=ha(Cl(p[0],0),0,100),p[1]=ha(Cl(p[1],0),-125,125,!0),p[2]=ha(Cl(p[2],0),-125,125,!0);const z=J_();xd("d50");const F=Qm(Q1(p));xd(z);const q=y[4]!==void 0?+ha(y[4],0,1):1;return F[3]=q,F}if(y=v.match(nE)){const p=y.slice(1,4);p[0]=ha(p[0],0,100),p[1]=ha(Cl(p[1],0),0,150,!1),p[2]=+Cl(p[2].replace("deg",""),0);const z=J_();xd("d50");const F=Qm(ib(p));xd(z);const q=y[4]!==void 0?+ha(y[4],0,1):1;return F[3]=q,F}if(y=v.match(rE)){const p=y.slice(1,4);p[0]=ha(Cl(p[0],0),0,1),p[1]=ha(Cl(p[1],0),-.4,.4,!0),p[2]=ha(Cl(p[2],0),-.4,.4,!0);const z=Qm(rb(p)),F=y[4]!==void 0?+ha(y[4],0,1):1;return z[3]=F,z}if(y=v.match(sE)){const p=y.slice(1,4);p[0]=ha(Cl(p[0],0),0,1),p[1]=ha(Cl(p[1],0),0,.4,!1),p[2]=+Cl(p[2].replace("deg",""),0);const z=Qm(X2(p)),F=y[4]!==void 0?+ha(y[4],0,1):1;return z[3]=F,z}};ab.test=v=>Y2.test(v)||Q2.test(v)||iE.test(v)||nE.test(v)||rE.test(v)||sE.test(v)||K2.test(v)||J2.test(v)||eE.test(v)||tE.test(v)||v==="transparent";Vn.prototype.css=function(v){return zP(this._rgb,v)};const kP=(...v)=>new Vn(...v,"css");Hs.css=kP;ms.format.css=ab;ms.autodetect.push({p:5,test:(v,...y)=>{if(!y.length&&ks(v)==="string"&&ab.test(v))return"css"}});ms.format.gl=(...v)=>{const y=bs(v,"rgba");return y[0]*=255,y[1]*=255,y[2]*=255,y};const FP=(...v)=>new Vn(...v,"gl");Hs.gl=FP;Vn.prototype.gl=function(){const v=this._rgb;return[v[0]/255,v[1]/255,v[2]/255,v[3]]};Vn.prototype.hex=function(v){return F2(this._rgb,v)};const BP=(...v)=>new Vn(...v,"hex");Hs.hex=BP;ms.format.hex=k2;ms.autodetect.push({p:4,test:(v,...y)=>{if(!y.length&&ks(v)==="string"&&[3,4,5,6,7,8,9].indexOf(v.length)>=0)return"hex"}});const{log:u0}=Math,aE=v=>{const y=v/100;let p,z,F;return y<66?(p=255,z=y<6?0:-155.25485562709179-.44596950469579133*(z=y-2)+104.49216199393888*u0(z),F=y<20?0:-254.76935184120902+.8274096064007395*(F=y-10)+115.67994401066147*u0(F)):(p=351.97690566805693+.114206453784165*(p=y-55)-40.25366309332127*u0(p),z=325.4494125711974+.07943456536662342*(z=y-50)-28.0852963507957*u0(z),F=255),[p,z,F,1]},{round:NP}=Math,UP=(...v)=>{const y=bs(v,"rgb"),p=y[0],z=y[2];let F=1e3,q=4e4;const V=.4;let n;for(;q-F>V;){n=(q+F)*.5;const J=aE(n);J[2]/J[0]>=z/p?q=n:F=n}return NP(n)};Vn.prototype.temp=Vn.prototype.kelvin=Vn.prototype.temperature=function(){return UP(this._rgb)};const Yx=(...v)=>new Vn(...v,"temp");Object.assign(Hs,{temp:Yx,kelvin:Yx,temperature:Yx});ms.format.temp=ms.format.kelvin=ms.format.temperature=aE;Vn.prototype.oklch=function(){return Z2(this._rgb)};const VP=(...v)=>new Vn(...v,"oklch");Object.assign(Hs,{oklch:VP});ms.format.oklch=X2;ms.autodetect.push({p:2,test:(...v)=>{if(v=bs(v,"oklch"),ks(v)==="array"&&v.length===3)return"oklch"}});Object.assign(Hs,{analyze:W2,average:GR,bezier:ZR,blend:Fu,brewer:EP,Color:Vn,colors:fg,contrast:mP,contrastAPCA:yP,cubehelix:aP,deltaE:wP,distance:TP,input:ms,interpolate:mg,limits:q2,mix:mg,random:hP,scale:D0,scales:SP,valid:MP});const GP=(v,y)=>{const p=v.__vccOpts||v;for(const[z,F]of y)p[z]=F;return p},HP={data(){return{records:[],map:null,exaggeration:10,loading_records:!0}},mounted(){this.fetchRecords(),JT.accessToken="pk.eyJ1IjoicmFmbnVzcyIsImEiOiIzMVE1dnc0In0.3FNMKIlQ_afYktqki-6m0g",this.map=new JT.Map({container:"map",style:"mapbox://styles/mapbox/satellite-v9",center:[0,0],zoom:1,pitch:0,bearing:0}),this.map.on("load",()=>{this.map.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.terrain-rgb",tileSize:512,maxzoom:14}),this.map.setTerrain({source:"mapbox-dem",exaggeration:this.exaggeration})})},methods:{async loadCsvData(){try{const y=await(await fetch(this.csvUrl)).text();return new Promise((p,z)=>{eM.parse(y,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:F=>{const V=F.data.reduce((n,J)=>{const{lon:re,lat:ce,altitude:Se,tag_id:Xe}=J;if(!isNaN(re)&&!isNaN(ce)&&!isNaN(Se)&&Xe){const ht=[re,ce,Se*this.exaggeration];n[Xe]||(n[Xe]=[]),n[Xe].push(ht)}return n},{});p(V)},error:F=>{console.error("Error parsing CSV:",F),z([])}})})}catch(v){return console.error("Error loading CSV data:",v),[]}},async fetchRecords(){const v="https://zenodo.org/api/records?communities=geolocator-dp";try{const y=await fetch(v);if(!y.ok)throw new Error(`Error fetching records: ${y.statusText}`);const p=await y.json();this.records=p.hits.hits.map(z=>({title:z.metadata.title,files:z.files.reduce((F,q)=>{const{key:V,links:{self:n}}=q;return F[V]=n,F},{}),doi:z.doi,creators:z.metadata.creators,description:z.metadata.description,tags:null,staps:null,paths:null,pressurepaths:null,loading:0}))}catch(y){console.log(y)}finally{this.loading_records=!1}},loadDataRecord(v){this.records[v].loading=1;const y=["pressurepaths.csv"],p=(F,q)=>new Promise((V,n)=>{fetch(F).then(J=>{if(!J.ok)throw new Error(`Network response was not ok for ${F}`);return J.text()}).then(J=>{eM.parse(J,{complete:re=>{this.records[v][q]=re.data,V()},header:!0})}).catch(J=>{console.error(`Error fetching or parsing ${q} CSV:`,J),n(J)})}),z=y.map(F=>{const q=F.split(".")[0],V=this.records[v].files[F];return this.records[v].loading==2?(console.error(`Record ${q} already loaded.`),Promise.resolve()):V?p(V,q):(console.error(`File ${F} not found in the record.`),Promise.reject(new Error(`File ${F} not found in the record.`)))});Promise.all(z).then(()=>{this.records[v].loading=2,this.plotPathsOnMap()}).catch(F=>{console.error("Error loading CSV files:",F),this.records[v].loading=3})},plotPathsOnMap(){const y=this.records.map(q=>q.pressurepaths).flat().reduce((q,V)=>{if(V){const{lon:n,lat:J,altitude:re,tag_id:ce}=V;if(!isNaN(n)&&!isNaN(J)&&!isNaN(re)&&ce){const Se=[Number(n),Number(J),Number(re)*this.exaggeration];q[ce]||(q[ce]=[]),q[ce].push(Se)}}return q},{}),p=new BI.Threebox(this.map,this.map.getCanvas().getContext("webgl"),{defaultLights:!0}),z=Object.keys(y),F=Hs.scale("spectral").domain([0,z.length-1]);z.forEach((q,V)=>{const n=y[q],J=F(V).hex();p.add(p.line({geometry:n,color:J,width:6,opacity:1}))}),this.map.getLayer("pressurepaths")&&this.map.removeLayer("pressurepaths"),this.map.addLayer({id:"pressurepaths",type:"custom",renderingMode:"3d",render:(q,V)=>{p.update()}})}}},jP={class:"d-flex vh-100"},WP={class:"bg-dark text-white p-4",style:{width:"32rem"}},qP={key:0},$P={key:1},ZP={class:"list-group"},XP={class:"d-flex w-100 justify-content-between"},YP={class:"mb-1"},KP=["onClick"],JP={key:1,class:"d-flex align-items-center",role:"status","aria-live":"polite"},QP={key:2,class:"d-flex align-items-center"},eD=["href"],tD=["src"];function iD(v,y,p,z,F,q){return gd(),Mp("div",jP,[Oa("div",WP,[y[5]||(y[5]=Oa("h2",{class:"h4 fw-bold mb-4"},"GeoLocator DP",-1)),F.loading_records?(gd(),Mp("div",qP,"Loading datapackages...")):(gd(),Mp("div",$P,[Oa("div",ZP,[(gd(!0),Mp(Ah,null,$C(F.records,(V,n)=>(gd(),Mp("div",{key:V.id,class:H0(["list-group-item list-group-item-action rounded mb-2",V.loading?"disabled bg-secondary text-light":"hover"])},[Oa("div",XP,[Oa("h5",YP,PS(V.title),1),V.loading===0?(gd(),Mp("button",{key:0,class:"btn btn-link p-0",onClick:J=>q.loadDataRecord(n),"aria-label":"Load data"},y[0]||(y[0]=[Oa("i",{class:"bi bi-cloud-download"},null,-1)]),8,KP)):V.loading===1?(gd(),Mp("div",JP,y[1]||(y[1]=[Oa("div",{class:"spinner-border text-primary",style:{width:"1.5rem",height:"1.5rem"},"aria-hidden":"true"},null,-1),Oa("span",{class:"visually-hidden"},"Loading...",-1)]))):V.loading===2?(gd(),Mp("div",QP,y[2]||(y[2]=[Oa("i",{class:"bi bi-check-circle text-success"},null,-1)]))):CL("",!0)]),y[3]||(y[3]=Oa("p",{class:"mb-1"},"Some placeholder content in a paragraph.",-1)),y[4]||(y[4]=Oa("small",null,"And some small print.",-1)),Oa("p",null,[Oa("a",{href:"https://doi.org/"+V.doi},[Oa("img",{src:"https://zenodo.org/badge/DOI/"+V.doi+".svg",alt:"DOI"},null,8,tD)],8,eD)])],2))),128))])]))]),y[6]||(y[6]=Oa("div",{class:"flex-grow-1 bg-light"},[Oa("div",{id:"map",class:"h-100 w-100"})],-1))])}const nD=GP(HP,[["render",iD]]);var Dl="top",fc="bottom",mc="right",Ol="left",ev="auto",Ag=[Dl,fc,mc,Ol],tm="start",gg="end",lE="clippingParents",lb="viewport",ng="popper",cE="reference",E1=Ag.reduce(function(v,y){return v.concat([y+"-"+tm,y+"-"+gg])},[]),cb=[].concat(Ag,[ev]).reduce(function(v,y){return v.concat([y,y+"-"+tm,y+"-"+gg])},[]),uE="beforeRead",hE="read",dE="afterRead",pE="beforeMain",fE="main",mE="afterMain",gE="beforeWrite",_E="write",yE="afterWrite",vE=[uE,hE,dE,pE,fE,mE,gE,_E,yE];function zh(v){return v?(v.nodeName||"").toLowerCase():null}function gc(v){if(v==null)return window;if(v.toString()!=="[object Window]"){var y=v.ownerDocument;return y&&y.defaultView||window}return v}function im(v){var y=gc(v).Element;return v instanceof y||v instanceof Element}function Yc(v){var y=gc(v).HTMLElement;return v instanceof y||v instanceof HTMLElement}function ub(v){if(typeof ShadowRoot>"u")return!1;var y=gc(v).ShadowRoot;return v instanceof y||v instanceof ShadowRoot}function rD(v){var y=v.state;Object.keys(y.elements).forEach(function(p){var z=y.styles[p]||{},F=y.attributes[p]||{},q=y.elements[p];!Yc(q)||!zh(q)||(Object.assign(q.style,z),Object.keys(F).forEach(function(V){var n=F[V];n===!1?q.removeAttribute(V):q.setAttribute(V,n===!0?"":n)}))})}function sD(v){var y=v.state,p={popper:{position:y.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(y.elements.popper.style,p.popper),y.styles=p,y.elements.arrow&&Object.assign(y.elements.arrow.style,p.arrow),function(){Object.keys(y.elements).forEach(function(z){var F=y.elements[z],q=y.attributes[z]||{},V=Object.keys(y.styles.hasOwnProperty(z)?y.styles[z]:p[z]),n=V.reduce(function(J,re){return J[re]="",J},{});!Yc(F)||!zh(F)||(Object.assign(F.style,n),Object.keys(q).forEach(function(J){F.removeAttribute(J)}))})}}const hb={name:"applyStyles",enabled:!0,phase:"write",fn:rD,effect:sD,requires:["computeStyles"]};function Ph(v){return v.split("-")[0]}var Qf=Math.max,z0=Math.min,_g=Math.round;function A1(){var v=navigator.userAgentData;return v!=null&&v.brands&&Array.isArray(v.brands)?v.brands.map(function(y){return y.brand+"/"+y.version}).join(" "):navigator.userAgent}function xE(){return!/^((?!chrome|android).)*safari/i.test(A1())}function yg(v,y,p){y===void 0&&(y=!1),p===void 0&&(p=!1);var z=v.getBoundingClientRect(),F=1,q=1;y&&Yc(v)&&(F=v.offsetWidth>0&&_g(z.width)/v.offsetWidth||1,q=v.offsetHeight>0&&_g(z.height)/v.offsetHeight||1);var V=im(v)?gc(v):window,n=V.visualViewport,J=!xE()&&p,re=(z.left+(J&&n?n.offsetLeft:0))/F,ce=(z.top+(J&&n?n.offsetTop:0))/q,Se=z.width/F,Xe=z.height/q;return{width:Se,height:Xe,top:ce,right:re+Se,bottom:ce+Xe,left:re,x:re,y:ce}}function db(v){var y=yg(v),p=v.offsetWidth,z=v.offsetHeight;return Math.abs(y.width-p)<=1&&(p=y.width),Math.abs(y.height-z)<=1&&(z=y.height),{x:v.offsetLeft,y:v.offsetTop,width:p,height:z}}function bE(v,y){var p=y.getRootNode&&y.getRootNode();if(v.contains(y))return!0;if(p&&ub(p)){var z=y;do{if(z&&v.isSameNode(z))return!0;z=z.parentNode||z.host}while(z)}return!1}function Sd(v){return gc(v).getComputedStyle(v)}function oD(v){return["table","td","th"].indexOf(zh(v))>=0}function Bp(v){return((im(v)?v.ownerDocument:v.document)||window.document).documentElement}function tv(v){return zh(v)==="html"?v:v.assignedSlot||v.parentNode||(ub(v)?v.host:null)||Bp(v)}function GM(v){return!Yc(v)||Sd(v).position==="fixed"?null:v.offsetParent}function aD(v){var y=/firefox/i.test(A1()),p=/Trident/i.test(A1());if(p&&Yc(v)){var z=Sd(v);if(z.position==="fixed")return null}var F=tv(v);for(ub(F)&&(F=F.host);Yc(F)&&["html","body"].indexOf(zh(F))<0;){var q=Sd(F);if(q.transform!=="none"||q.perspective!=="none"||q.contain==="paint"||["transform","perspective"].indexOf(q.willChange)!==-1||y&&q.willChange==="filter"||y&&q.filter&&q.filter!=="none")return F;F=F.parentNode}return null}function iy(v){for(var y=gc(v),p=GM(v);p&&oD(p)&&Sd(p).position==="static";)p=GM(p);return p&&(zh(p)==="html"||zh(p)==="body"&&Sd(p).position==="static")?y:p||aD(v)||y}function pb(v){return["top","bottom"].indexOf(v)>=0?"x":"y"}function W_(v,y,p){return Qf(v,z0(y,p))}function lD(v,y,p){var z=W_(v,y,p);return z>p?p:z}function wE(){return{top:0,right:0,bottom:0,left:0}}function TE(v){return Object.assign({},wE(),v)}function ME(v,y){return y.reduce(function(p,z){return p[z]=v,p},{})}var cD=function(y,p){return y=typeof y=="function"?y(Object.assign({},p.rects,{placement:p.placement})):y,TE(typeof y!="number"?y:ME(y,Ag))};function uD(v){var y,p=v.state,z=v.name,F=v.options,q=p.elements.arrow,V=p.modifiersData.popperOffsets,n=Ph(p.placement),J=pb(n),re=[Ol,mc].indexOf(n)>=0,ce=re?"height":"width";if(!(!q||!V)){var Se=cD(F.padding,p),Xe=db(q),ht=J==="y"?Dl:Ol,Ut=J==="y"?fc:mc,ct=p.rects.reference[ce]+p.rects.reference[J]-V[J]-p.rects.popper[ce],Dt=V[J]-p.rects.reference[J],rt=iy(q),pt=rt?J==="y"?rt.clientHeight||0:rt.clientWidth||0:0,gi=ct/2-Dt/2,Zt=Se[ht],At=pt-Xe[ce]-Se[Ut],It=pt/2-Xe[ce]/2+gi,Ye=W_(Zt,It,At),ot=J;p.modifiersData[z]=(y={},y[ot]=Ye,y.centerOffset=Ye-It,y)}}function hD(v){var y=v.state,p=v.options,z=p.element,F=z===void 0?"[data-popper-arrow]":z;F!=null&&(typeof F=="string"&&(F=y.elements.popper.querySelector(F),!F)||bE(y.elements.popper,F)&&(y.elements.arrow=F))}const SE={name:"arrow",enabled:!0,phase:"main",fn:uD,effect:hD,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function vg(v){return v.split("-")[1]}var dD={top:"auto",right:"auto",bottom:"auto",left:"auto"};function pD(v,y){var p=v.x,z=v.y,F=y.devicePixelRatio||1;return{x:_g(p*F)/F||0,y:_g(z*F)/F||0}}function HM(v){var y,p=v.popper,z=v.popperRect,F=v.placement,q=v.variation,V=v.offsets,n=v.position,J=v.gpuAcceleration,re=v.adaptive,ce=v.roundOffsets,Se=v.isFixed,Xe=V.x,ht=Xe===void 0?0:Xe,Ut=V.y,ct=Ut===void 0?0:Ut,Dt=typeof ce=="function"?ce({x:ht,y:ct}):{x:ht,y:ct};ht=Dt.x,ct=Dt.y;var rt=V.hasOwnProperty("x"),pt=V.hasOwnProperty("y"),gi=Ol,Zt=Dl,At=window;if(re){var It=iy(p),Ye="clientHeight",ot="clientWidth";if(It===gc(p)&&(It=Bp(p),Sd(It).position!=="static"&&n==="absolute"&&(Ye="scrollHeight",ot="scrollWidth")),It=It,F===Dl||(F===Ol||F===mc)&&q===gg){Zt=fc;var tt=Se&&It===At&&At.visualViewport?At.visualViewport.height:It[Ye];ct-=tt-z.height,ct*=J?1:-1}if(F===Ol||(F===Dl||F===fc)&&q===gg){gi=mc;var et=Se&&It===At&&At.visualViewport?At.visualViewport.width:It[ot];ht-=et-z.width,ht*=J?1:-1}}var Rt=Object.assign({position:n},re&&dD),at=ce===!0?pD({x:ht,y:ct},gc(p)):{x:ht,y:ct};if(ht=at.x,ct=at.y,J){var _t;return Object.assign({},Rt,(_t={},_t[Zt]=pt?"0":"",_t[gi]=rt?"0":"",_t.transform=(At.devicePixelRatio||1)<=1?"translate("+ht+"px, "+ct+"px)":"translate3d("+ht+"px, "+ct+"px, 0)",_t))}return Object.assign({},Rt,(y={},y[Zt]=pt?ct+"px":"",y[gi]=rt?ht+"px":"",y.transform="",y))}function fD(v){var y=v.state,p=v.options,z=p.gpuAcceleration,F=z===void 0?!0:z,q=p.adaptive,V=q===void 0?!0:q,n=p.roundOffsets,J=n===void 0?!0:n,re={placement:Ph(y.placement),variation:vg(y.placement),popper:y.elements.popper,popperRect:y.rects.popper,gpuAcceleration:F,isFixed:y.options.strategy==="fixed"};y.modifiersData.popperOffsets!=null&&(y.styles.popper=Object.assign({},y.styles.popper,HM(Object.assign({},re,{offsets:y.modifiersData.popperOffsets,position:y.options.strategy,adaptive:V,roundOffsets:J})))),y.modifiersData.arrow!=null&&(y.styles.arrow=Object.assign({},y.styles.arrow,HM(Object.assign({},re,{offsets:y.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:J})))),y.attributes.popper=Object.assign({},y.attributes.popper,{"data-popper-placement":y.placement})}const fb={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:fD,data:{}};var h0={passive:!0};function mD(v){var y=v.state,p=v.instance,z=v.options,F=z.scroll,q=F===void 0?!0:F,V=z.resize,n=V===void 0?!0:V,J=gc(y.elements.popper),re=[].concat(y.scrollParents.reference,y.scrollParents.popper);return q&&re.forEach(function(ce){ce.addEventListener("scroll",p.update,h0)}),n&&J.addEventListener("resize",p.update,h0),function(){q&&re.forEach(function(ce){ce.removeEventListener("scroll",p.update,h0)}),n&&J.removeEventListener("resize",p.update,h0)}}const mb={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:mD,data:{}};var gD={left:"right",right:"left",bottom:"top",top:"bottom"};function T0(v){return v.replace(/left|right|bottom|top/g,function(y){return gD[y]})}var _D={start:"end",end:"start"};function jM(v){return v.replace(/start|end/g,function(y){return _D[y]})}function gb(v){var y=gc(v),p=y.pageXOffset,z=y.pageYOffset;return{scrollLeft:p,scrollTop:z}}function _b(v){return yg(Bp(v)).left+gb(v).scrollLeft}function yD(v,y){var p=gc(v),z=Bp(v),F=p.visualViewport,q=z.clientWidth,V=z.clientHeight,n=0,J=0;if(F){q=F.width,V=F.height;var re=xE();(re||!re&&y==="fixed")&&(n=F.offsetLeft,J=F.offsetTop)}return{width:q,height:V,x:n+_b(v),y:J}}function vD(v){var y,p=Bp(v),z=gb(v),F=(y=v.ownerDocument)==null?void 0:y.body,q=Qf(p.scrollWidth,p.clientWidth,F?F.scrollWidth:0,F?F.clientWidth:0),V=Qf(p.scrollHeight,p.clientHeight,F?F.scrollHeight:0,F?F.clientHeight:0),n=-z.scrollLeft+_b(v),J=-z.scrollTop;return Sd(F||p).direction==="rtl"&&(n+=Qf(p.clientWidth,F?F.clientWidth:0)-q),{width:q,height:V,x:n,y:J}}function yb(v){var y=Sd(v),p=y.overflow,z=y.overflowX,F=y.overflowY;return/auto|scroll|overlay|hidden/.test(p+F+z)}function EE(v){return["html","body","#document"].indexOf(zh(v))>=0?v.ownerDocument.body:Yc(v)&&yb(v)?v:EE(tv(v))}function q_(v,y){var p;y===void 0&&(y=[]);var z=EE(v),F=z===((p=v.ownerDocument)==null?void 0:p.body),q=gc(z),V=F?[q].concat(q.visualViewport||[],yb(z)?z:[]):z,n=y.concat(V);return F?n:n.concat(q_(tv(V)))}function C1(v){return Object.assign({},v,{left:v.x,top:v.y,right:v.x+v.width,bottom:v.y+v.height})}function xD(v,y){var p=yg(v,!1,y==="fixed");return p.top=p.top+v.clientTop,p.left=p.left+v.clientLeft,p.bottom=p.top+v.clientHeight,p.right=p.left+v.clientWidth,p.width=v.clientWidth,p.height=v.clientHeight,p.x=p.left,p.y=p.top,p}function WM(v,y,p){return y===lb?C1(yD(v,p)):im(y)?xD(y,p):C1(vD(Bp(v)))}function bD(v){var y=q_(tv(v)),p=["absolute","fixed"].indexOf(Sd(v).position)>=0,z=p&&Yc(v)?iy(v):v;return im(z)?y.filter(function(F){return im(F)&&bE(F,z)&&zh(F)!=="body"}):[]}function wD(v,y,p,z){var F=y==="clippingParents"?bD(v):[].concat(y),q=[].concat(F,[p]),V=q[0],n=q.reduce(function(J,re){var ce=WM(v,re,z);return J.top=Qf(ce.top,J.top),J.right=z0(ce.right,J.right),J.bottom=z0(ce.bottom,J.bottom),J.left=Qf(ce.left,J.left),J},WM(v,V,z));return n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}function AE(v){var y=v.reference,p=v.element,z=v.placement,F=z?Ph(z):null,q=z?vg(z):null,V=y.x+y.width/2-p.width/2,n=y.y+y.height/2-p.height/2,J;switch(F){case Dl:J={x:V,y:y.y-p.height};break;case fc:J={x:V,y:y.y+y.height};break;case mc:J={x:y.x+y.width,y:n};break;case Ol:J={x:y.x-p.width,y:n};break;default:J={x:y.x,y:y.y}}var re=F?pb(F):null;if(re!=null){var ce=re==="y"?"height":"width";switch(q){case tm:J[re]=J[re]-(y[ce]/2-p[ce]/2);break;case gg:J[re]=J[re]+(y[ce]/2-p[ce]/2);break}}return J}function xg(v,y){y===void 0&&(y={});var p=y,z=p.placement,F=z===void 0?v.placement:z,q=p.strategy,V=q===void 0?v.strategy:q,n=p.boundary,J=n===void 0?lE:n,re=p.rootBoundary,ce=re===void 0?lb:re,Se=p.elementContext,Xe=Se===void 0?ng:Se,ht=p.altBoundary,Ut=ht===void 0?!1:ht,ct=p.padding,Dt=ct===void 0?0:ct,rt=TE(typeof Dt!="number"?Dt:ME(Dt,Ag)),pt=Xe===ng?cE:ng,gi=v.rects.popper,Zt=v.elements[Ut?pt:Xe],At=wD(im(Zt)?Zt:Zt.contextElement||Bp(v.elements.popper),J,ce,V),It=yg(v.elements.reference),Ye=AE({reference:It,element:gi,strategy:"absolute",placement:F}),ot=C1(Object.assign({},gi,Ye)),tt=Xe===ng?ot:It,et={top:At.top-tt.top+rt.top,bottom:tt.bottom-At.bottom+rt.bottom,left:At.left-tt.left+rt.left,right:tt.right-At.right+rt.right},Rt=v.modifiersData.offset;if(Xe===ng&&Rt){var at=Rt[F];Object.keys(et).forEach(function(_t){var Qt=[mc,fc].indexOf(_t)>=0?1:-1,ae=[Dl,fc].indexOf(_t)>=0?"y":"x";et[_t]+=at[ae]*Qt})}return et}function TD(v,y){y===void 0&&(y={});var p=y,z=p.placement,F=p.boundary,q=p.rootBoundary,V=p.padding,n=p.flipVariations,J=p.allowedAutoPlacements,re=J===void 0?cb:J,ce=vg(z),Se=ce?n?E1:E1.filter(function(Ut){return vg(Ut)===ce}):Ag,Xe=Se.filter(function(Ut){return re.indexOf(Ut)>=0});Xe.length===0&&(Xe=Se);var ht=Xe.reduce(function(Ut,ct){return Ut[ct]=xg(v,{placement:ct,boundary:F,rootBoundary:q,padding:V})[Ph(ct)],Ut},{});return Object.keys(ht).sort(function(Ut,ct){return ht[Ut]-ht[ct]})}function MD(v){if(Ph(v)===ev)return[];var y=T0(v);return[jM(v),y,jM(y)]}function SD(v){var y=v.state,p=v.options,z=v.name;if(!y.modifiersData[z]._skip){for(var F=p.mainAxis,q=F===void 0?!0:F,V=p.altAxis,n=V===void 0?!0:V,J=p.fallbackPlacements,re=p.padding,ce=p.boundary,Se=p.rootBoundary,Xe=p.altBoundary,ht=p.flipVariations,Ut=ht===void 0?!0:ht,ct=p.allowedAutoPlacements,Dt=y.options.placement,rt=Ph(Dt),pt=rt===Dt,gi=J||(pt||!Ut?[T0(Dt)]:MD(Dt)),Zt=[Dt].concat(gi).reduce(function(Gt,ii){return Gt.concat(Ph(ii)===ev?TD(y,{placement:ii,boundary:ce,rootBoundary:Se,padding:re,flipVariations:Ut,allowedAutoPlacements:ct}):ii)},[]),At=y.rects.reference,It=y.rects.popper,Ye=new Map,ot=!0,tt=Zt[0],et=0;et<Zt.length;et++){var Rt=Zt[et],at=Ph(Rt),_t=vg(Rt)===tm,Qt=[Dl,fc].indexOf(at)>=0,ae=Qt?"width":"height",be=xg(y,{placement:Rt,boundary:ce,rootBoundary:Se,altBoundary:Xe,padding:re}),ve=Qt?_t?mc:Ol:_t?fc:Dl;At[ae]>It[ae]&&(ve=T0(ve));var De=T0(ve),Ce=[];if(q&&Ce.push(be[at]<=0),n&&Ce.push(be[ve]<=0,be[De]<=0),Ce.every(function(Gt){return Gt})){tt=Rt,ot=!1;break}Ye.set(Rt,Ce)}if(ot)for(var Vt=Ut?3:1,zt=function(ii){var zi=Zt.find(function(Hi){var on=Ye.get(Hi);if(on)return on.slice(0,ii).every(function(mn){return mn})});if(zi)return tt=zi,"break"},mt=Vt;mt>0;mt--){var Nt=zt(mt);if(Nt==="break")break}y.placement!==tt&&(y.modifiersData[z]._skip=!0,y.placement=tt,y.reset=!0)}}const CE={name:"flip",enabled:!0,phase:"main",fn:SD,requiresIfExists:["offset"],data:{_skip:!1}};function qM(v,y,p){return p===void 0&&(p={x:0,y:0}),{top:v.top-y.height-p.y,right:v.right-y.width+p.x,bottom:v.bottom-y.height+p.y,left:v.left-y.width-p.x}}function $M(v){return[Dl,mc,fc,Ol].some(function(y){return v[y]>=0})}function ED(v){var y=v.state,p=v.name,z=y.rects.reference,F=y.rects.popper,q=y.modifiersData.preventOverflow,V=xg(y,{elementContext:"reference"}),n=xg(y,{altBoundary:!0}),J=qM(V,z),re=qM(n,F,q),ce=$M(J),Se=$M(re);y.modifiersData[p]={referenceClippingOffsets:J,popperEscapeOffsets:re,isReferenceHidden:ce,hasPopperEscaped:Se},y.attributes.popper=Object.assign({},y.attributes.popper,{"data-popper-reference-hidden":ce,"data-popper-escaped":Se})}const LE={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ED};function AD(v,y,p){var z=Ph(v),F=[Ol,Dl].indexOf(z)>=0?-1:1,q=typeof p=="function"?p(Object.assign({},y,{placement:v})):p,V=q[0],n=q[1];return V=V||0,n=(n||0)*F,[Ol,mc].indexOf(z)>=0?{x:n,y:V}:{x:V,y:n}}function CD(v){var y=v.state,p=v.options,z=v.name,F=p.offset,q=F===void 0?[0,0]:F,V=cb.reduce(function(ce,Se){return ce[Se]=AD(Se,y.rects,q),ce},{}),n=V[y.placement],J=n.x,re=n.y;y.modifiersData.popperOffsets!=null&&(y.modifiersData.popperOffsets.x+=J,y.modifiersData.popperOffsets.y+=re),y.modifiersData[z]=V}const IE={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:CD};function LD(v){var y=v.state,p=v.name;y.modifiersData[p]=AE({reference:y.rects.reference,element:y.rects.popper,strategy:"absolute",placement:y.placement})}const vb={name:"popperOffsets",enabled:!0,phase:"read",fn:LD,data:{}};function ID(v){return v==="x"?"y":"x"}function RD(v){var y=v.state,p=v.options,z=v.name,F=p.mainAxis,q=F===void 0?!0:F,V=p.altAxis,n=V===void 0?!1:V,J=p.boundary,re=p.rootBoundary,ce=p.altBoundary,Se=p.padding,Xe=p.tether,ht=Xe===void 0?!0:Xe,Ut=p.tetherOffset,ct=Ut===void 0?0:Ut,Dt=xg(y,{boundary:J,rootBoundary:re,padding:Se,altBoundary:ce}),rt=Ph(y.placement),pt=vg(y.placement),gi=!pt,Zt=pb(rt),At=ID(Zt),It=y.modifiersData.popperOffsets,Ye=y.rects.reference,ot=y.rects.popper,tt=typeof ct=="function"?ct(Object.assign({},y.rects,{placement:y.placement})):ct,et=typeof tt=="number"?{mainAxis:tt,altAxis:tt}:Object.assign({mainAxis:0,altAxis:0},tt),Rt=y.modifiersData.offset?y.modifiersData.offset[y.placement]:null,at={x:0,y:0};if(It){if(q){var _t,Qt=Zt==="y"?Dl:Ol,ae=Zt==="y"?fc:mc,be=Zt==="y"?"height":"width",ve=It[Zt],De=ve+Dt[Qt],Ce=ve-Dt[ae],Vt=ht?-ot[be]/2:0,zt=pt===tm?Ye[be]:ot[be],mt=pt===tm?-ot[be]:-Ye[be],Nt=y.elements.arrow,Gt=ht&&Nt?db(Nt):{width:0,height:0},ii=y.modifiersData["arrow#persistent"]?y.modifiersData["arrow#persistent"].padding:wE(),zi=ii[Qt],Hi=ii[ae],on=W_(0,Ye[be],Gt[be]),mn=gi?Ye[be]/2-Vt-on-zi-et.mainAxis:zt-on-zi-et.mainAxis,Qe=gi?-Ye[be]/2+Vt+on+Hi+et.mainAxis:mt+on+Hi+et.mainAxis,Yn=y.elements.arrow&&iy(y.elements.arrow),pr=Yn?Zt==="y"?Yn.clientTop||0:Yn.clientLeft||0:0,bt=(_t=Rt==null?void 0:Rt[Zt])!=null?_t:0,je=ve+mn-bt-pr,Ot=ve+Qe-bt,Le=W_(ht?z0(De,je):De,ve,ht?Qf(Ce,Ot):Ce);It[Zt]=Le,at[Zt]=Le-ve}if(n){var Ie,Fe=Zt==="x"?Dl:Ol,Ge=Zt==="x"?fc:mc,Je=It[At],st=At==="y"?"height":"width",lt=Je+Dt[Fe],Tt=Je-Dt[Ge],Mt=[Dl,Ol].indexOf(rt)!==-1,ci=(Ie=Rt==null?void 0:Rt[At])!=null?Ie:0,xi=Mt?lt:Je-Ye[st]-ot[st]-ci+et.altAxis,an=Mt?Je+Ye[st]+ot[st]-ci-et.altAxis:Tt,cn=ht&&Mt?lD(xi,Je,an):W_(ht?xi:lt,Je,ht?an:Tt);It[At]=cn,at[At]=cn-Je}y.modifiersData[z]=at}}const RE={name:"preventOverflow",enabled:!0,phase:"main",fn:RD,requiresIfExists:["offset"]};function PD(v){return{scrollLeft:v.scrollLeft,scrollTop:v.scrollTop}}function DD(v){return v===gc(v)||!Yc(v)?gb(v):PD(v)}function OD(v){var y=v.getBoundingClientRect(),p=_g(y.width)/v.offsetWidth||1,z=_g(y.height)/v.offsetHeight||1;return p!==1||z!==1}function zD(v,y,p){p===void 0&&(p=!1);var z=Yc(y),F=Yc(y)&&OD(y),q=Bp(y),V=yg(v,F,p),n={scrollLeft:0,scrollTop:0},J={x:0,y:0};return(z||!z&&!p)&&((zh(y)!=="body"||yb(q))&&(n=DD(y)),Yc(y)?(J=yg(y,!0),J.x+=y.clientLeft,J.y+=y.clientTop):q&&(J.x=_b(q))),{x:V.left+n.scrollLeft-J.x,y:V.top+n.scrollTop-J.y,width:V.width,height:V.height}}function kD(v){var y=new Map,p=new Set,z=[];v.forEach(function(q){y.set(q.name,q)});function F(q){p.add(q.name);var V=[].concat(q.requires||[],q.requiresIfExists||[]);V.forEach(function(n){if(!p.has(n)){var J=y.get(n);J&&F(J)}}),z.push(q)}return v.forEach(function(q){p.has(q.name)||F(q)}),z}function FD(v){var y=kD(v);return vE.reduce(function(p,z){return p.concat(y.filter(function(F){return F.phase===z}))},[])}function BD(v){var y;return function(){return y||(y=new Promise(function(p){Promise.resolve().then(function(){y=void 0,p(v())})})),y}}function ND(v){var y=v.reduce(function(p,z){var F=p[z.name];return p[z.name]=F?Object.assign({},F,z,{options:Object.assign({},F.options,z.options),data:Object.assign({},F.data,z.data)}):z,p},{});return Object.keys(y).map(function(p){return y[p]})}var ZM={placement:"bottom",modifiers:[],strategy:"absolute"};function XM(){for(var v=arguments.length,y=new Array(v),p=0;p<v;p++)y[p]=arguments[p];return!y.some(function(z){return!(z&&typeof z.getBoundingClientRect=="function")})}function iv(v){v===void 0&&(v={});var y=v,p=y.defaultModifiers,z=p===void 0?[]:p,F=y.defaultOptions,q=F===void 0?ZM:F;return function(n,J,re){re===void 0&&(re=q);var ce={placement:"bottom",orderedModifiers:[],options:Object.assign({},ZM,q),modifiersData:{},elements:{reference:n,popper:J},attributes:{},styles:{}},Se=[],Xe=!1,ht={state:ce,setOptions:function(rt){var pt=typeof rt=="function"?rt(ce.options):rt;ct(),ce.options=Object.assign({},q,ce.options,pt),ce.scrollParents={reference:im(n)?q_(n):n.contextElement?q_(n.contextElement):[],popper:q_(J)};var gi=FD(ND([].concat(z,ce.options.modifiers)));return ce.orderedModifiers=gi.filter(function(Zt){return Zt.enabled}),Ut(),ht.update()},forceUpdate:function(){if(!Xe){var rt=ce.elements,pt=rt.reference,gi=rt.popper;if(XM(pt,gi)){ce.rects={reference:zD(pt,iy(gi),ce.options.strategy==="fixed"),popper:db(gi)},ce.reset=!1,ce.placement=ce.options.placement,ce.orderedModifiers.forEach(function(et){return ce.modifiersData[et.name]=Object.assign({},et.data)});for(var Zt=0;Zt<ce.orderedModifiers.length;Zt++){if(ce.reset===!0){ce.reset=!1,Zt=-1;continue}var At=ce.orderedModifiers[Zt],It=At.fn,Ye=At.options,ot=Ye===void 0?{}:Ye,tt=At.name;typeof It=="function"&&(ce=It({state:ce,options:ot,name:tt,instance:ht})||ce)}}}},update:BD(function(){return new Promise(function(Dt){ht.forceUpdate(),Dt(ce)})}),destroy:function(){ct(),Xe=!0}};if(!XM(n,J))return ht;ht.setOptions(re).then(function(Dt){!Xe&&re.onFirstUpdate&&re.onFirstUpdate(Dt)});function Ut(){ce.orderedModifiers.forEach(function(Dt){var rt=Dt.name,pt=Dt.options,gi=pt===void 0?{}:pt,Zt=Dt.effect;if(typeof Zt=="function"){var At=Zt({state:ce,name:rt,instance:ht,options:gi}),It=function(){};Se.push(At||It)}})}function ct(){Se.forEach(function(Dt){return Dt()}),Se=[]}return ht}}var UD=iv(),VD=[mb,vb,fb,hb],GD=iv({defaultModifiers:VD}),HD=[mb,vb,fb,hb,IE,CE,RE,SE,LE],xb=iv({defaultModifiers:HD});const PE=Object.freeze(Object.defineProperty({__proto__:null,afterMain:mE,afterRead:dE,afterWrite:yE,applyStyles:hb,arrow:SE,auto:ev,basePlacements:Ag,beforeMain:pE,beforeRead:uE,beforeWrite:gE,bottom:fc,clippingParents:lE,computeStyles:fb,createPopper:xb,createPopperBase:UD,createPopperLite:GD,detectOverflow:xg,end:gg,eventListeners:mb,flip:CE,hide:LE,left:Ol,main:fE,modifierPhases:vE,offset:IE,placements:cb,popper:ng,popperGenerator:iv,popperOffsets:vb,preventOverflow:RE,read:hE,reference:cE,right:mc,start:tm,top:Dl,variationPlacements:E1,viewport:lb,write:_E},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const Sp=new Map,Kx={set(v,y,p){Sp.has(v)||Sp.set(v,new Map);const z=Sp.get(v);if(!z.has(y)&&z.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(z.keys())[0]}.`);return}z.set(y,p)},get(v,y){return Sp.has(v)&&Sp.get(v).get(y)||null},remove(v,y){if(!Sp.has(v))return;const p=Sp.get(v);p.delete(y),p.size===0&&Sp.delete(v)}},jD=1e6,WD=1e3,L1="transitionend",DE=v=>(v&&window.CSS&&window.CSS.escape&&(v=v.replace(/#([^\s"#']+)/g,(y,p)=>`#${CSS.escape(p)}`)),v),qD=v=>v==null?`${v}`:Object.prototype.toString.call(v).match(/\s([a-z]+)/i)[1].toLowerCase(),$D=v=>{do v+=Math.floor(Math.random()*jD);while(document.getElementById(v));return v},ZD=v=>{if(!v)return 0;let{transitionDuration:y,transitionDelay:p}=window.getComputedStyle(v);const z=Number.parseFloat(y),F=Number.parseFloat(p);return!z&&!F?0:(y=y.split(",")[0],p=p.split(",")[0],(Number.parseFloat(y)+Number.parseFloat(p))*WD)},OE=v=>{v.dispatchEvent(new Event(L1))},Td=v=>!v||typeof v!="object"?!1:(typeof v.jquery<"u"&&(v=v[0]),typeof v.nodeType<"u"),Ip=v=>Td(v)?v.jquery?v[0]:v:typeof v=="string"&&v.length>0?document.querySelector(DE(v)):null,Cg=v=>{if(!Td(v)||v.getClientRects().length===0)return!1;const y=getComputedStyle(v).getPropertyValue("visibility")==="visible",p=v.closest("details:not([open])");if(!p)return y;if(p!==v){const z=v.closest("summary");if(z&&z.parentNode!==p||z===null)return!1}return y},Rp=v=>!v||v.nodeType!==Node.ELEMENT_NODE||v.classList.contains("disabled")?!0:typeof v.disabled<"u"?v.disabled:v.hasAttribute("disabled")&&v.getAttribute("disabled")!=="false",zE=v=>{if(!document.documentElement.attachShadow)return null;if(typeof v.getRootNode=="function"){const y=v.getRootNode();return y instanceof ShadowRoot?y:null}return v instanceof ShadowRoot?v:v.parentNode?zE(v.parentNode):null},k0=()=>{},ny=v=>{v.offsetHeight},kE=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Jx=[],XD=v=>{document.readyState==="loading"?(Jx.length||document.addEventListener("DOMContentLoaded",()=>{for(const y of Jx)y()}),Jx.push(v)):v()},Jc=()=>document.documentElement.dir==="rtl",eu=v=>{XD(()=>{const y=kE();if(y){const p=v.NAME,z=y.fn[p];y.fn[p]=v.jQueryInterface,y.fn[p].Constructor=v,y.fn[p].noConflict=()=>(y.fn[p]=z,v.jQueryInterface)}})},$l=(v,y=[],p=v)=>typeof v=="function"?v(...y):p,FE=(v,y,p=!0)=>{if(!p){$l(v);return}const F=ZD(y)+5;let q=!1;const V=({target:n})=>{n===y&&(q=!0,y.removeEventListener(L1,V),$l(v))};y.addEventListener(L1,V),setTimeout(()=>{q||OE(y)},F)},bb=(v,y,p,z)=>{const F=v.length;let q=v.indexOf(y);return q===-1?!p&&z?v[F-1]:v[0]:(q+=p?1:-1,z&&(q=(q+F)%F),v[Math.max(0,Math.min(q,F-1))])},YD=/[^.]*(?=\..*)\.|.*/,KD=/\..*/,JD=/::\d+$/,Qx={};let YM=1;const BE={mouseenter:"mouseover",mouseleave:"mouseout"},QD=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function NE(v,y){return y&&`${y}::${YM++}`||v.uidEvent||YM++}function UE(v){const y=NE(v);return v.uidEvent=y,Qx[y]=Qx[y]||{},Qx[y]}function eO(v,y){return function p(z){return wb(z,{delegateTarget:v}),p.oneOff&&Pn.off(v,z.type,y),y.apply(v,[z])}}function tO(v,y,p){return function z(F){const q=v.querySelectorAll(y);for(let{target:V}=F;V&&V!==this;V=V.parentNode)for(const n of q)if(n===V)return wb(F,{delegateTarget:V}),z.oneOff&&Pn.off(v,F.type,y,p),p.apply(V,[F])}}function VE(v,y,p=null){return Object.values(v).find(z=>z.callable===y&&z.delegationSelector===p)}function GE(v,y,p){const z=typeof y=="string",F=z?p:y||p;let q=HE(v);return QD.has(q)||(q=v),[z,F,q]}function KM(v,y,p,z,F){if(typeof y!="string"||!v)return;let[q,V,n]=GE(y,p,z);y in BE&&(V=(Ut=>function(ct){if(!ct.relatedTarget||ct.relatedTarget!==ct.delegateTarget&&!ct.delegateTarget.contains(ct.relatedTarget))return Ut.call(this,ct)})(V));const J=UE(v),re=J[n]||(J[n]={}),ce=VE(re,V,q?p:null);if(ce){ce.oneOff=ce.oneOff&&F;return}const Se=NE(V,y.replace(YD,"")),Xe=q?tO(v,p,V):eO(v,V);Xe.delegationSelector=q?p:null,Xe.callable=V,Xe.oneOff=F,Xe.uidEvent=Se,re[Se]=Xe,v.addEventListener(n,Xe,q)}function I1(v,y,p,z,F){const q=VE(y[p],z,F);q&&(v.removeEventListener(p,q,!!F),delete y[p][q.uidEvent])}function iO(v,y,p,z){const F=y[p]||{};for(const[q,V]of Object.entries(F))q.includes(z)&&I1(v,y,p,V.callable,V.delegationSelector)}function HE(v){return v=v.replace(KD,""),BE[v]||v}const Pn={on(v,y,p,z){KM(v,y,p,z,!1)},one(v,y,p,z){KM(v,y,p,z,!0)},off(v,y,p,z){if(typeof y!="string"||!v)return;const[F,q,V]=GE(y,p,z),n=V!==y,J=UE(v),re=J[V]||{},ce=y.startsWith(".");if(typeof q<"u"){if(!Object.keys(re).length)return;I1(v,J,V,q,F?p:null);return}if(ce)for(const Se of Object.keys(J))iO(v,J,Se,y.slice(1));for(const[Se,Xe]of Object.entries(re)){const ht=Se.replace(JD,"");(!n||y.includes(ht))&&I1(v,J,V,Xe.callable,Xe.delegationSelector)}},trigger(v,y,p){if(typeof y!="string"||!v)return null;const z=kE(),F=HE(y),q=y!==F;let V=null,n=!0,J=!0,re=!1;q&&z&&(V=z.Event(y,p),z(v).trigger(V),n=!V.isPropagationStopped(),J=!V.isImmediatePropagationStopped(),re=V.isDefaultPrevented());const ce=wb(new Event(y,{bubbles:n,cancelable:!0}),p);return re&&ce.preventDefault(),J&&v.dispatchEvent(ce),ce.defaultPrevented&&V&&V.preventDefault(),ce}};function wb(v,y={}){for(const[p,z]of Object.entries(y))try{v[p]=z}catch{Object.defineProperty(v,p,{configurable:!0,get(){return z}})}return v}function JM(v){if(v==="true")return!0;if(v==="false")return!1;if(v===Number(v).toString())return Number(v);if(v===""||v==="null")return null;if(typeof v!="string")return v;try{return JSON.parse(decodeURIComponent(v))}catch{return v}}function e1(v){return v.replace(/[A-Z]/g,y=>`-${y.toLowerCase()}`)}const Md={setDataAttribute(v,y,p){v.setAttribute(`data-bs-${e1(y)}`,p)},removeDataAttribute(v,y){v.removeAttribute(`data-bs-${e1(y)}`)},getDataAttributes(v){if(!v)return{};const y={},p=Object.keys(v.dataset).filter(z=>z.startsWith("bs")&&!z.startsWith("bsConfig"));for(const z of p){let F=z.replace(/^bs/,"");F=F.charAt(0).toLowerCase()+F.slice(1,F.length),y[F]=JM(v.dataset[z])}return y},getDataAttribute(v,y){return JM(v.getAttribute(`data-bs-${e1(y)}`))}};class ry{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(y){return y=this._mergeConfigObj(y),y=this._configAfterMerge(y),this._typeCheckConfig(y),y}_configAfterMerge(y){return y}_mergeConfigObj(y,p){const z=Td(p)?Md.getDataAttribute(p,"config"):{};return{...this.constructor.Default,...typeof z=="object"?z:{},...Td(p)?Md.getDataAttributes(p):{},...typeof y=="object"?y:{}}}_typeCheckConfig(y,p=this.constructor.DefaultType){for(const[z,F]of Object.entries(p)){const q=y[z],V=Td(q)?"element":qD(q);if(!new RegExp(F).test(V))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${z}" provided type "${V}" but expected type "${F}".`)}}}const nO="5.3.3";class Bu extends ry{constructor(y,p){super(),y=Ip(y),y&&(this._element=y,this._config=this._getConfig(p),Kx.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Kx.remove(this._element,this.constructor.DATA_KEY),Pn.off(this._element,this.constructor.EVENT_KEY);for(const y of Object.getOwnPropertyNames(this))this[y]=null}_queueCallback(y,p,z=!0){FE(y,p,z)}_getConfig(y){return y=this._mergeConfigObj(y,this._element),y=this._configAfterMerge(y),this._typeCheckConfig(y),y}static getInstance(y){return Kx.get(Ip(y),this.DATA_KEY)}static getOrCreateInstance(y,p={}){return this.getInstance(y)||new this(y,typeof p=="object"?p:null)}static get VERSION(){return nO}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(y){return`${y}${this.EVENT_KEY}`}}const t1=v=>{let y=v.getAttribute("data-bs-target");if(!y||y==="#"){let p=v.getAttribute("href");if(!p||!p.includes("#")&&!p.startsWith("."))return null;p.includes("#")&&!p.startsWith("#")&&(p=`#${p.split("#")[1]}`),y=p&&p!=="#"?p.trim():null}return y?y.split(",").map(p=>DE(p)).join(","):null},jr={find(v,y=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(y,v))},findOne(v,y=document.documentElement){return Element.prototype.querySelector.call(y,v)},children(v,y){return[].concat(...v.children).filter(p=>p.matches(y))},parents(v,y){const p=[];let z=v.parentNode.closest(y);for(;z;)p.push(z),z=z.parentNode.closest(y);return p},prev(v,y){let p=v.previousElementSibling;for(;p;){if(p.matches(y))return[p];p=p.previousElementSibling}return[]},next(v,y){let p=v.nextElementSibling;for(;p;){if(p.matches(y))return[p];p=p.nextElementSibling}return[]},focusableChildren(v){const y=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(p=>`${p}:not([tabindex^="-"])`).join(",");return this.find(y,v).filter(p=>!Rp(p)&&Cg(p))},getSelectorFromElement(v){const y=t1(v);return y&&jr.findOne(y)?y:null},getElementFromSelector(v){const y=t1(v);return y?jr.findOne(y):null},getMultipleElementsFromSelector(v){const y=t1(v);return y?jr.find(y):[]}},nv=(v,y="hide")=>{const p=`click.dismiss${v.EVENT_KEY}`,z=v.NAME;Pn.on(document,p,`[data-bs-dismiss="${z}"]`,function(F){if(["A","AREA"].includes(this.tagName)&&F.preventDefault(),Rp(this))return;const q=jr.getElementFromSelector(this)||this.closest(`.${z}`);v.getOrCreateInstance(q)[y]()})},rO="alert",sO="bs.alert",jE=`.${sO}`,oO=`close${jE}`,aO=`closed${jE}`,lO="fade",cO="show";class rv extends Bu{static get NAME(){return rO}close(){if(Pn.trigger(this._element,oO).defaultPrevented)return;this._element.classList.remove(cO);const p=this._element.classList.contains(lO);this._queueCallback(()=>this._destroyElement(),this._element,p)}_destroyElement(){this._element.remove(),Pn.trigger(this._element,aO),this.dispose()}static jQueryInterface(y){return this.each(function(){const p=rv.getOrCreateInstance(this);if(typeof y=="string"){if(p[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);p[y](this)}})}}nv(rv,"close");eu(rv);const uO="button",hO="bs.button",dO=`.${hO}`,pO=".data-api",fO="active",QM='[data-bs-toggle="button"]',mO=`click${dO}${pO}`;class sv extends Bu{static get NAME(){return uO}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(fO))}static jQueryInterface(y){return this.each(function(){const p=sv.getOrCreateInstance(this);y==="toggle"&&p[y]()})}}Pn.on(document,mO,QM,v=>{v.preventDefault();const y=v.target.closest(QM);sv.getOrCreateInstance(y).toggle()});eu(sv);const gO="swipe",Lg=".bs.swipe",_O=`touchstart${Lg}`,yO=`touchmove${Lg}`,vO=`touchend${Lg}`,xO=`pointerdown${Lg}`,bO=`pointerup${Lg}`,wO="touch",TO="pen",MO="pointer-event",SO=40,EO={endCallback:null,leftCallback:null,rightCallback:null},AO={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class F0 extends ry{constructor(y,p){super(),this._element=y,!(!y||!F0.isSupported())&&(this._config=this._getConfig(p),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return EO}static get DefaultType(){return AO}static get NAME(){return gO}dispose(){Pn.off(this._element,Lg)}_start(y){if(!this._supportPointerEvents){this._deltaX=y.touches[0].clientX;return}this._eventIsPointerPenTouch(y)&&(this._deltaX=y.clientX)}_end(y){this._eventIsPointerPenTouch(y)&&(this._deltaX=y.clientX-this._deltaX),this._handleSwipe(),$l(this._config.endCallback)}_move(y){this._deltaX=y.touches&&y.touches.length>1?0:y.touches[0].clientX-this._deltaX}_handleSwipe(){const y=Math.abs(this._deltaX);if(y<=SO)return;const p=y/this._deltaX;this._deltaX=0,p&&$l(p>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Pn.on(this._element,xO,y=>this._start(y)),Pn.on(this._element,bO,y=>this._end(y)),this._element.classList.add(MO)):(Pn.on(this._element,_O,y=>this._start(y)),Pn.on(this._element,yO,y=>this._move(y)),Pn.on(this._element,vO,y=>this._end(y)))}_eventIsPointerPenTouch(y){return this._supportPointerEvents&&(y.pointerType===TO||y.pointerType===wO)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const CO="carousel",LO="bs.carousel",Np=`.${LO}`,WE=".data-api",IO="ArrowLeft",RO="ArrowRight",PO=500,z_="next",eg="prev",rg="left",M0="right",DO=`slide${Np}`,i1=`slid${Np}`,OO=`keydown${Np}`,zO=`mouseenter${Np}`,kO=`mouseleave${Np}`,FO=`dragstart${Np}`,BO=`load${Np}${WE}`,NO=`click${Np}${WE}`,qE="carousel",d0="active",UO="slide",VO="carousel-item-end",GO="carousel-item-start",HO="carousel-item-next",jO="carousel-item-prev",$E=".active",ZE=".carousel-item",WO=$E+ZE,qO=".carousel-item img",$O=".carousel-indicators",ZO="[data-bs-slide], [data-bs-slide-to]",XO='[data-bs-ride="carousel"]',YO={[IO]:M0,[RO]:rg},KO={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},JO={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class sy extends Bu{constructor(y,p){super(y,p),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=jr.findOne($O,this._element),this._addEventListeners(),this._config.ride===qE&&this.cycle()}static get Default(){return KO}static get DefaultType(){return JO}static get NAME(){return CO}next(){this._slide(z_)}nextWhenVisible(){!document.hidden&&Cg(this._element)&&this.next()}prev(){this._slide(eg)}pause(){this._isSliding&&OE(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){Pn.one(this._element,i1,()=>this.cycle());return}this.cycle()}}to(y){const p=this._getItems();if(y>p.length-1||y<0)return;if(this._isSliding){Pn.one(this._element,i1,()=>this.to(y));return}const z=this._getItemIndex(this._getActive());if(z===y)return;const F=y>z?z_:eg;this._slide(F,p[y])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(y){return y.defaultInterval=y.interval,y}_addEventListeners(){this._config.keyboard&&Pn.on(this._element,OO,y=>this._keydown(y)),this._config.pause==="hover"&&(Pn.on(this._element,zO,()=>this.pause()),Pn.on(this._element,kO,()=>this._maybeEnableCycle())),this._config.touch&&F0.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const z of jr.find(qO,this._element))Pn.on(z,FO,F=>F.preventDefault());const p={leftCallback:()=>this._slide(this._directionToOrder(rg)),rightCallback:()=>this._slide(this._directionToOrder(M0)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),PO+this._config.interval))}};this._swipeHelper=new F0(this._element,p)}_keydown(y){if(/input|textarea/i.test(y.target.tagName))return;const p=YO[y.key];p&&(y.preventDefault(),this._slide(this._directionToOrder(p)))}_getItemIndex(y){return this._getItems().indexOf(y)}_setActiveIndicatorElement(y){if(!this._indicatorsElement)return;const p=jr.findOne($E,this._indicatorsElement);p.classList.remove(d0),p.removeAttribute("aria-current");const z=jr.findOne(`[data-bs-slide-to="${y}"]`,this._indicatorsElement);z&&(z.classList.add(d0),z.setAttribute("aria-current","true"))}_updateInterval(){const y=this._activeElement||this._getActive();if(!y)return;const p=Number.parseInt(y.getAttribute("data-bs-interval"),10);this._config.interval=p||this._config.defaultInterval}_slide(y,p=null){if(this._isSliding)return;const z=this._getActive(),F=y===z_,q=p||bb(this._getItems(),z,F,this._config.wrap);if(q===z)return;const V=this._getItemIndex(q),n=ht=>Pn.trigger(this._element,ht,{relatedTarget:q,direction:this._orderToDirection(y),from:this._getItemIndex(z),to:V});if(n(DO).defaultPrevented||!z||!q)return;const re=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(V),this._activeElement=q;const ce=F?GO:VO,Se=F?HO:jO;q.classList.add(Se),ny(q),z.classList.add(ce),q.classList.add(ce);const Xe=()=>{q.classList.remove(ce,Se),q.classList.add(d0),z.classList.remove(d0,Se,ce),this._isSliding=!1,n(i1)};this._queueCallback(Xe,z,this._isAnimated()),re&&this.cycle()}_isAnimated(){return this._element.classList.contains(UO)}_getActive(){return jr.findOne(WO,this._element)}_getItems(){return jr.find(ZE,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(y){return Jc()?y===rg?eg:z_:y===rg?z_:eg}_orderToDirection(y){return Jc()?y===eg?rg:M0:y===eg?M0:rg}static jQueryInterface(y){return this.each(function(){const p=sy.getOrCreateInstance(this,y);if(typeof y=="number"){p.to(y);return}if(typeof y=="string"){if(p[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);p[y]()}})}}Pn.on(document,NO,ZO,function(v){const y=jr.getElementFromSelector(this);if(!y||!y.classList.contains(qE))return;v.preventDefault();const p=sy.getOrCreateInstance(y),z=this.getAttribute("data-bs-slide-to");if(z){p.to(z),p._maybeEnableCycle();return}if(Md.getDataAttribute(this,"slide")==="next"){p.next(),p._maybeEnableCycle();return}p.prev(),p._maybeEnableCycle()});Pn.on(window,BO,()=>{const v=jr.find(XO);for(const y of v)sy.getOrCreateInstance(y)});eu(sy);const QO="collapse",ez="bs.collapse",oy=`.${ez}`,tz=".data-api",iz=`show${oy}`,nz=`shown${oy}`,rz=`hide${oy}`,sz=`hidden${oy}`,oz=`click${oy}${tz}`,n1="show",og="collapse",p0="collapsing",az="collapsed",lz=`:scope .${og} .${og}`,cz="collapse-horizontal",uz="width",hz="height",dz=".collapse.show, .collapse.collapsing",R1='[data-bs-toggle="collapse"]',pz={parent:null,toggle:!0},fz={parent:"(null|element)",toggle:"boolean"};class Q_ extends Bu{constructor(y,p){super(y,p),this._isTransitioning=!1,this._triggerArray=[];const z=jr.find(R1);for(const F of z){const q=jr.getSelectorFromElement(F),V=jr.find(q).filter(n=>n===this._element);q!==null&&V.length&&this._triggerArray.push(F)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return pz}static get DefaultType(){return fz}static get NAME(){return QO}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let y=[];if(this._config.parent&&(y=this._getFirstLevelChildren(dz).filter(n=>n!==this._element).map(n=>Q_.getOrCreateInstance(n,{toggle:!1}))),y.length&&y[0]._isTransitioning||Pn.trigger(this._element,iz).defaultPrevented)return;for(const n of y)n.hide();const z=this._getDimension();this._element.classList.remove(og),this._element.classList.add(p0),this._element.style[z]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const F=()=>{this._isTransitioning=!1,this._element.classList.remove(p0),this._element.classList.add(og,n1),this._element.style[z]="",Pn.trigger(this._element,nz)},V=`scroll${z[0].toUpperCase()+z.slice(1)}`;this._queueCallback(F,this._element,!0),this._element.style[z]=`${this._element[V]}px`}hide(){if(this._isTransitioning||!this._isShown()||Pn.trigger(this._element,rz).defaultPrevented)return;const p=this._getDimension();this._element.style[p]=`${this._element.getBoundingClientRect()[p]}px`,ny(this._element),this._element.classList.add(p0),this._element.classList.remove(og,n1);for(const F of this._triggerArray){const q=jr.getElementFromSelector(F);q&&!this._isShown(q)&&this._addAriaAndCollapsedClass([F],!1)}this._isTransitioning=!0;const z=()=>{this._isTransitioning=!1,this._element.classList.remove(p0),this._element.classList.add(og),Pn.trigger(this._element,sz)};this._element.style[p]="",this._queueCallback(z,this._element,!0)}_isShown(y=this._element){return y.classList.contains(n1)}_configAfterMerge(y){return y.toggle=!!y.toggle,y.parent=Ip(y.parent),y}_getDimension(){return this._element.classList.contains(cz)?uz:hz}_initializeChildren(){if(!this._config.parent)return;const y=this._getFirstLevelChildren(R1);for(const p of y){const z=jr.getElementFromSelector(p);z&&this._addAriaAndCollapsedClass([p],this._isShown(z))}}_getFirstLevelChildren(y){const p=jr.find(lz,this._config.parent);return jr.find(y,this._config.parent).filter(z=>!p.includes(z))}_addAriaAndCollapsedClass(y,p){if(y.length)for(const z of y)z.classList.toggle(az,!p),z.setAttribute("aria-expanded",p)}static jQueryInterface(y){const p={};return typeof y=="string"&&/show|hide/.test(y)&&(p.toggle=!1),this.each(function(){const z=Q_.getOrCreateInstance(this,p);if(typeof y=="string"){if(typeof z[y]>"u")throw new TypeError(`No method named "${y}"`);z[y]()}})}}Pn.on(document,oz,R1,function(v){(v.target.tagName==="A"||v.delegateTarget&&v.delegateTarget.tagName==="A")&&v.preventDefault();for(const y of jr.getMultipleElementsFromSelector(this))Q_.getOrCreateInstance(y,{toggle:!1}).toggle()});eu(Q_);const eS="dropdown",mz="bs.dropdown",rm=`.${mz}`,Tb=".data-api",gz="Escape",tS="Tab",_z="ArrowUp",iS="ArrowDown",yz=2,vz=`hide${rm}`,xz=`hidden${rm}`,bz=`show${rm}`,wz=`shown${rm}`,XE=`click${rm}${Tb}`,YE=`keydown${rm}${Tb}`,Tz=`keyup${rm}${Tb}`,sg="show",Mz="dropup",Sz="dropend",Ez="dropstart",Az="dropup-center",Cz="dropdown-center",Zf='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Lz=`${Zf}.${sg}`,S0=".dropdown-menu",Iz=".navbar",Rz=".navbar-nav",Pz=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",Dz=Jc()?"top-end":"top-start",Oz=Jc()?"top-start":"top-end",zz=Jc()?"bottom-end":"bottom-start",kz=Jc()?"bottom-start":"bottom-end",Fz=Jc()?"left-start":"right-start",Bz=Jc()?"right-start":"left-start",Nz="top",Uz="bottom",Vz={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Gz={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Dh extends Bu{constructor(y,p){super(y,p),this._popper=null,this._parent=this._element.parentNode,this._menu=jr.next(this._element,S0)[0]||jr.prev(this._element,S0)[0]||jr.findOne(S0,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Vz}static get DefaultType(){return Gz}static get NAME(){return eS}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Rp(this._element)||this._isShown())return;const y={relatedTarget:this._element};if(!Pn.trigger(this._element,bz,y).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(Rz))for(const z of[].concat(...document.body.children))Pn.on(z,"mouseover",k0);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(sg),this._element.classList.add(sg),Pn.trigger(this._element,wz,y)}}hide(){if(Rp(this._element)||!this._isShown())return;const y={relatedTarget:this._element};this._completeHide(y)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(y){if(!Pn.trigger(this._element,vz,y).defaultPrevented){if("ontouchstart"in document.documentElement)for(const z of[].concat(...document.body.children))Pn.off(z,"mouseover",k0);this._popper&&this._popper.destroy(),this._menu.classList.remove(sg),this._element.classList.remove(sg),this._element.setAttribute("aria-expanded","false"),Md.removeDataAttribute(this._menu,"popper"),Pn.trigger(this._element,xz,y)}}_getConfig(y){if(y=super._getConfig(y),typeof y.reference=="object"&&!Td(y.reference)&&typeof y.reference.getBoundingClientRect!="function")throw new TypeError(`${eS.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return y}_createPopper(){if(typeof PE>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let y=this._element;this._config.reference==="parent"?y=this._parent:Td(this._config.reference)?y=Ip(this._config.reference):typeof this._config.reference=="object"&&(y=this._config.reference);const p=this._getPopperConfig();this._popper=xb(y,this._menu,p)}_isShown(){return this._menu.classList.contains(sg)}_getPlacement(){const y=this._parent;if(y.classList.contains(Sz))return Fz;if(y.classList.contains(Ez))return Bz;if(y.classList.contains(Az))return Nz;if(y.classList.contains(Cz))return Uz;const p=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return y.classList.contains(Mz)?p?Oz:Dz:p?kz:zz}_detectNavbar(){return this._element.closest(Iz)!==null}_getOffset(){const{offset:y}=this._config;return typeof y=="string"?y.split(",").map(p=>Number.parseInt(p,10)):typeof y=="function"?p=>y(p,this._element):y}_getPopperConfig(){const y={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Md.setDataAttribute(this._menu,"popper","static"),y.modifiers=[{name:"applyStyles",enabled:!1}]),{...y,...$l(this._config.popperConfig,[y])}}_selectMenuItem({key:y,target:p}){const z=jr.find(Pz,this._menu).filter(F=>Cg(F));z.length&&bb(z,p,y===iS,!z.includes(p)).focus()}static jQueryInterface(y){return this.each(function(){const p=Dh.getOrCreateInstance(this,y);if(typeof y=="string"){if(typeof p[y]>"u")throw new TypeError(`No method named "${y}"`);p[y]()}})}static clearMenus(y){if(y.button===yz||y.type==="keyup"&&y.key!==tS)return;const p=jr.find(Lz);for(const z of p){const F=Dh.getInstance(z);if(!F||F._config.autoClose===!1)continue;const q=y.composedPath(),V=q.includes(F._menu);if(q.includes(F._element)||F._config.autoClose==="inside"&&!V||F._config.autoClose==="outside"&&V||F._menu.contains(y.target)&&(y.type==="keyup"&&y.key===tS||/input|select|option|textarea|form/i.test(y.target.tagName)))continue;const n={relatedTarget:F._element};y.type==="click"&&(n.clickEvent=y),F._completeHide(n)}}static dataApiKeydownHandler(y){const p=/input|textarea/i.test(y.target.tagName),z=y.key===gz,F=[_z,iS].includes(y.key);if(!F&&!z||p&&!z)return;y.preventDefault();const q=this.matches(Zf)?this:jr.prev(this,Zf)[0]||jr.next(this,Zf)[0]||jr.findOne(Zf,y.delegateTarget.parentNode),V=Dh.getOrCreateInstance(q);if(F){y.stopPropagation(),V.show(),V._selectMenuItem(y);return}V._isShown()&&(y.stopPropagation(),V.hide(),q.focus())}}Pn.on(document,YE,Zf,Dh.dataApiKeydownHandler);Pn.on(document,YE,S0,Dh.dataApiKeydownHandler);Pn.on(document,XE,Dh.clearMenus);Pn.on(document,Tz,Dh.clearMenus);Pn.on(document,XE,Zf,function(v){v.preventDefault(),Dh.getOrCreateInstance(this).toggle()});eu(Dh);const KE="backdrop",Hz="fade",nS="show",rS=`mousedown.bs.${KE}`,jz={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Wz={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class JE extends ry{constructor(y){super(),this._config=this._getConfig(y),this._isAppended=!1,this._element=null}static get Default(){return jz}static get DefaultType(){return Wz}static get NAME(){return KE}show(y){if(!this._config.isVisible){$l(y);return}this._append();const p=this._getElement();this._config.isAnimated&&ny(p),p.classList.add(nS),this._emulateAnimation(()=>{$l(y)})}hide(y){if(!this._config.isVisible){$l(y);return}this._getElement().classList.remove(nS),this._emulateAnimation(()=>{this.dispose(),$l(y)})}dispose(){this._isAppended&&(Pn.off(this._element,rS),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const y=document.createElement("div");y.className=this._config.className,this._config.isAnimated&&y.classList.add(Hz),this._element=y}return this._element}_configAfterMerge(y){return y.rootElement=Ip(y.rootElement),y}_append(){if(this._isAppended)return;const y=this._getElement();this._config.rootElement.append(y),Pn.on(y,rS,()=>{$l(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(y){FE(y,this._getElement(),this._config.isAnimated)}}const qz="focustrap",$z="bs.focustrap",B0=`.${$z}`,Zz=`focusin${B0}`,Xz=`keydown.tab${B0}`,Yz="Tab",Kz="forward",sS="backward",Jz={autofocus:!0,trapElement:null},Qz={autofocus:"boolean",trapElement:"element"};class QE extends ry{constructor(y){super(),this._config=this._getConfig(y),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Jz}static get DefaultType(){return Qz}static get NAME(){return qz}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Pn.off(document,B0),Pn.on(document,Zz,y=>this._handleFocusin(y)),Pn.on(document,Xz,y=>this._handleKeydown(y)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Pn.off(document,B0))}_handleFocusin(y){const{trapElement:p}=this._config;if(y.target===document||y.target===p||p.contains(y.target))return;const z=jr.focusableChildren(p);z.length===0?p.focus():this._lastTabNavDirection===sS?z[z.length-1].focus():z[0].focus()}_handleKeydown(y){y.key===Yz&&(this._lastTabNavDirection=y.shiftKey?sS:Kz)}}const oS=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",aS=".sticky-top",f0="padding-right",lS="margin-right";class P1{constructor(){this._element=document.body}getWidth(){const y=document.documentElement.clientWidth;return Math.abs(window.innerWidth-y)}hide(){const y=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,f0,p=>p+y),this._setElementAttributes(oS,f0,p=>p+y),this._setElementAttributes(aS,lS,p=>p-y)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,f0),this._resetElementAttributes(oS,f0),this._resetElementAttributes(aS,lS)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(y,p,z){const F=this.getWidth(),q=V=>{if(V!==this._element&&window.innerWidth>V.clientWidth+F)return;this._saveInitialAttribute(V,p);const n=window.getComputedStyle(V).getPropertyValue(p);V.style.setProperty(p,`${z(Number.parseFloat(n))}px`)};this._applyManipulationCallback(y,q)}_saveInitialAttribute(y,p){const z=y.style.getPropertyValue(p);z&&Md.setDataAttribute(y,p,z)}_resetElementAttributes(y,p){const z=F=>{const q=Md.getDataAttribute(F,p);if(q===null){F.style.removeProperty(p);return}Md.removeDataAttribute(F,p),F.style.setProperty(p,q)};this._applyManipulationCallback(y,z)}_applyManipulationCallback(y,p){if(Td(y)){p(y);return}for(const z of jr.find(y,this._element))p(z)}}const ek="modal",tk="bs.modal",Qc=`.${tk}`,ik=".data-api",nk="Escape",rk=`hide${Qc}`,sk=`hidePrevented${Qc}`,eA=`hidden${Qc}`,tA=`show${Qc}`,ok=`shown${Qc}`,ak=`resize${Qc}`,lk=`click.dismiss${Qc}`,ck=`mousedown.dismiss${Qc}`,uk=`keydown.dismiss${Qc}`,hk=`click${Qc}${ik}`,cS="modal-open",dk="fade",uS="show",r1="modal-static",pk=".modal.show",fk=".modal-dialog",mk=".modal-body",gk='[data-bs-toggle="modal"]',_k={backdrop:!0,focus:!0,keyboard:!0},yk={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class bg extends Bu{constructor(y,p){super(y,p),this._dialog=jr.findOne(fk,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new P1,this._addEventListeners()}static get Default(){return _k}static get DefaultType(){return yk}static get NAME(){return ek}toggle(y){return this._isShown?this.hide():this.show(y)}show(y){this._isShown||this._isTransitioning||Pn.trigger(this._element,tA,{relatedTarget:y}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(cS),this._adjustDialog(),this._backdrop.show(()=>this._showElement(y)))}hide(){!this._isShown||this._isTransitioning||Pn.trigger(this._element,rk).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(uS),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){Pn.off(window,Qc),Pn.off(this._dialog,Qc),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new JE({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new QE({trapElement:this._element})}_showElement(y){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const p=jr.findOne(mk,this._dialog);p&&(p.scrollTop=0),ny(this._element),this._element.classList.add(uS);const z=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Pn.trigger(this._element,ok,{relatedTarget:y})};this._queueCallback(z,this._dialog,this._isAnimated())}_addEventListeners(){Pn.on(this._element,uk,y=>{if(y.key===nk){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),Pn.on(window,ak,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Pn.on(this._element,ck,y=>{Pn.one(this._element,lk,p=>{if(!(this._element!==y.target||this._element!==p.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(cS),this._resetAdjustments(),this._scrollBar.reset(),Pn.trigger(this._element,eA)})}_isAnimated(){return this._element.classList.contains(dk)}_triggerBackdropTransition(){if(Pn.trigger(this._element,sk).defaultPrevented)return;const p=this._element.scrollHeight>document.documentElement.clientHeight,z=this._element.style.overflowY;z==="hidden"||this._element.classList.contains(r1)||(p||(this._element.style.overflowY="hidden"),this._element.classList.add(r1),this._queueCallback(()=>{this._element.classList.remove(r1),this._queueCallback(()=>{this._element.style.overflowY=z},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const y=this._element.scrollHeight>document.documentElement.clientHeight,p=this._scrollBar.getWidth(),z=p>0;if(z&&!y){const F=Jc()?"paddingLeft":"paddingRight";this._element.style[F]=`${p}px`}if(!z&&y){const F=Jc()?"paddingRight":"paddingLeft";this._element.style[F]=`${p}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(y,p){return this.each(function(){const z=bg.getOrCreateInstance(this,y);if(typeof y=="string"){if(typeof z[y]>"u")throw new TypeError(`No method named "${y}"`);z[y](p)}})}}Pn.on(document,hk,gk,function(v){const y=jr.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&v.preventDefault(),Pn.one(y,tA,F=>{F.defaultPrevented||Pn.one(y,eA,()=>{Cg(this)&&this.focus()})});const p=jr.findOne(pk);p&&bg.getInstance(p).hide(),bg.getOrCreateInstance(y).toggle(this)});nv(bg);eu(bg);const vk="offcanvas",xk="bs.offcanvas",Cd=`.${xk}`,iA=".data-api",bk=`load${Cd}${iA}`,wk="Escape",hS="show",dS="showing",pS="hiding",Tk="offcanvas-backdrop",nA=".offcanvas.show",Mk=`show${Cd}`,Sk=`shown${Cd}`,Ek=`hide${Cd}`,fS=`hidePrevented${Cd}`,rA=`hidden${Cd}`,Ak=`resize${Cd}`,Ck=`click${Cd}${iA}`,Lk=`keydown.dismiss${Cd}`,Ik='[data-bs-toggle="offcanvas"]',Rk={backdrop:!0,keyboard:!0,scroll:!1},Pk={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Pp extends Bu{constructor(y,p){super(y,p),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Rk}static get DefaultType(){return Pk}static get NAME(){return vk}toggle(y){return this._isShown?this.hide():this.show(y)}show(y){if(this._isShown||Pn.trigger(this._element,Mk,{relatedTarget:y}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new P1().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(dS);const z=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(hS),this._element.classList.remove(dS),Pn.trigger(this._element,Sk,{relatedTarget:y})};this._queueCallback(z,this._element,!0)}hide(){if(!this._isShown||Pn.trigger(this._element,Ek).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(pS),this._backdrop.hide();const p=()=>{this._element.classList.remove(hS,pS),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new P1().reset(),Pn.trigger(this._element,rA)};this._queueCallback(p,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const y=()=>{if(this._config.backdrop==="static"){Pn.trigger(this._element,fS);return}this.hide()},p=!!this._config.backdrop;return new JE({className:Tk,isVisible:p,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:p?y:null})}_initializeFocusTrap(){return new QE({trapElement:this._element})}_addEventListeners(){Pn.on(this._element,Lk,y=>{if(y.key===wk){if(this._config.keyboard){this.hide();return}Pn.trigger(this._element,fS)}})}static jQueryInterface(y){return this.each(function(){const p=Pp.getOrCreateInstance(this,y);if(typeof y=="string"){if(p[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);p[y](this)}})}}Pn.on(document,Ck,Ik,function(v){const y=jr.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&v.preventDefault(),Rp(this))return;Pn.one(y,rA,()=>{Cg(this)&&this.focus()});const p=jr.findOne(nA);p&&p!==y&&Pp.getInstance(p).hide(),Pp.getOrCreateInstance(y).toggle(this)});Pn.on(window,bk,()=>{for(const v of jr.find(nA))Pp.getOrCreateInstance(v).show()});Pn.on(window,Ak,()=>{for(const v of jr.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(v).position!=="fixed"&&Pp.getOrCreateInstance(v).hide()});nv(Pp);eu(Pp);const Dk=/^aria-[\w-]*$/i,sA={"*":["class","dir","id","lang","role",Dk],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Ok=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),zk=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,kk=(v,y)=>{const p=v.nodeName.toLowerCase();return y.includes(p)?Ok.has(p)?!!zk.test(v.nodeValue):!0:y.filter(z=>z instanceof RegExp).some(z=>z.test(p))};function Fk(v,y,p){if(!v.length)return v;if(p&&typeof p=="function")return p(v);const F=new window.DOMParser().parseFromString(v,"text/html"),q=[].concat(...F.body.querySelectorAll("*"));for(const V of q){const n=V.nodeName.toLowerCase();if(!Object.keys(y).includes(n)){V.remove();continue}const J=[].concat(...V.attributes),re=[].concat(y["*"]||[],y[n]||[]);for(const ce of J)kk(ce,re)||V.removeAttribute(ce.nodeName)}return F.body.innerHTML}const Bk="TemplateFactory",Nk={allowList:sA,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Uk={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Vk={entry:"(string|element|function|null)",selector:"(string|element)"};class Gk extends ry{constructor(y){super(),this._config=this._getConfig(y)}static get Default(){return Nk}static get DefaultType(){return Uk}static get NAME(){return Bk}getContent(){return Object.values(this._config.content).map(y=>this._resolvePossibleFunction(y)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(y){return this._checkContent(y),this._config.content={...this._config.content,...y},this}toHtml(){const y=document.createElement("div");y.innerHTML=this._maybeSanitize(this._config.template);for(const[F,q]of Object.entries(this._config.content))this._setContent(y,q,F);const p=y.children[0],z=this._resolvePossibleFunction(this._config.extraClass);return z&&p.classList.add(...z.split(" ")),p}_typeCheckConfig(y){super._typeCheckConfig(y),this._checkContent(y.content)}_checkContent(y){for(const[p,z]of Object.entries(y))super._typeCheckConfig({selector:p,entry:z},Vk)}_setContent(y,p,z){const F=jr.findOne(z,y);if(F){if(p=this._resolvePossibleFunction(p),!p){F.remove();return}if(Td(p)){this._putElementInTemplate(Ip(p),F);return}if(this._config.html){F.innerHTML=this._maybeSanitize(p);return}F.textContent=p}}_maybeSanitize(y){return this._config.sanitize?Fk(y,this._config.allowList,this._config.sanitizeFn):y}_resolvePossibleFunction(y){return $l(y,[this])}_putElementInTemplate(y,p){if(this._config.html){p.innerHTML="",p.append(y);return}p.textContent=y.textContent}}const Hk="tooltip",jk=new Set(["sanitize","allowList","sanitizeFn"]),s1="fade",Wk="modal",m0="show",qk=".tooltip-inner",mS=`.${Wk}`,gS="hide.bs.modal",k_="hover",o1="focus",$k="click",Zk="manual",Xk="hide",Yk="hidden",Kk="show",Jk="shown",Qk="inserted",eF="click",tF="focusin",iF="focusout",nF="mouseenter",rF="mouseleave",sF={AUTO:"auto",TOP:"top",RIGHT:Jc()?"left":"right",BOTTOM:"bottom",LEFT:Jc()?"right":"left"},oF={allowList:sA,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},aF={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Ig extends Bu{constructor(y,p){if(typeof PE>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(y,p),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return oF}static get DefaultType(){return aF}static get NAME(){return Hk}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),Pn.off(this._element.closest(mS),gS,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const y=Pn.trigger(this._element,this.constructor.eventName(Kk)),z=(zE(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(y.defaultPrevented||!z)return;this._disposePopper();const F=this._getTipElement();this._element.setAttribute("aria-describedby",F.getAttribute("id"));const{container:q}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(q.append(F),Pn.trigger(this._element,this.constructor.eventName(Qk))),this._popper=this._createPopper(F),F.classList.add(m0),"ontouchstart"in document.documentElement)for(const n of[].concat(...document.body.children))Pn.on(n,"mouseover",k0);const V=()=>{Pn.trigger(this._element,this.constructor.eventName(Jk)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(V,this.tip,this._isAnimated())}hide(){if(!this._isShown()||Pn.trigger(this._element,this.constructor.eventName(Xk)).defaultPrevented)return;if(this._getTipElement().classList.remove(m0),"ontouchstart"in document.documentElement)for(const F of[].concat(...document.body.children))Pn.off(F,"mouseover",k0);this._activeTrigger[$k]=!1,this._activeTrigger[o1]=!1,this._activeTrigger[k_]=!1,this._isHovered=null;const z=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Pn.trigger(this._element,this.constructor.eventName(Yk)))};this._queueCallback(z,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(y){const p=this._getTemplateFactory(y).toHtml();if(!p)return null;p.classList.remove(s1,m0),p.classList.add(`bs-${this.constructor.NAME}-auto`);const z=$D(this.constructor.NAME).toString();return p.setAttribute("id",z),this._isAnimated()&&p.classList.add(s1),p}setContent(y){this._newContent=y,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(y){return this._templateFactory?this._templateFactory.changeContent(y):this._templateFactory=new Gk({...this._config,content:y,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[qk]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(y){return this.constructor.getOrCreateInstance(y.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(s1)}_isShown(){return this.tip&&this.tip.classList.contains(m0)}_createPopper(y){const p=$l(this._config.placement,[this,y,this._element]),z=sF[p.toUpperCase()];return xb(this._element,y,this._getPopperConfig(z))}_getOffset(){const{offset:y}=this._config;return typeof y=="string"?y.split(",").map(p=>Number.parseInt(p,10)):typeof y=="function"?p=>y(p,this._element):y}_resolvePossibleFunction(y){return $l(y,[this._element])}_getPopperConfig(y){const p={placement:y,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:z=>{this._getTipElement().setAttribute("data-popper-placement",z.state.placement)}}]};return{...p,...$l(this._config.popperConfig,[p])}}_setListeners(){const y=this._config.trigger.split(" ");for(const p of y)if(p==="click")Pn.on(this._element,this.constructor.eventName(eF),this._config.selector,z=>{this._initializeOnDelegatedTarget(z).toggle()});else if(p!==Zk){const z=p===k_?this.constructor.eventName(nF):this.constructor.eventName(tF),F=p===k_?this.constructor.eventName(rF):this.constructor.eventName(iF);Pn.on(this._element,z,this._config.selector,q=>{const V=this._initializeOnDelegatedTarget(q);V._activeTrigger[q.type==="focusin"?o1:k_]=!0,V._enter()}),Pn.on(this._element,F,this._config.selector,q=>{const V=this._initializeOnDelegatedTarget(q);V._activeTrigger[q.type==="focusout"?o1:k_]=V._element.contains(q.relatedTarget),V._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Pn.on(this._element.closest(mS),gS,this._hideModalHandler)}_fixTitle(){const y=this._element.getAttribute("title");y&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",y),this._element.setAttribute("data-bs-original-title",y),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(y,p){clearTimeout(this._timeout),this._timeout=setTimeout(y,p)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(y){const p=Md.getDataAttributes(this._element);for(const z of Object.keys(p))jk.has(z)&&delete p[z];return y={...p,...typeof y=="object"&&y?y:{}},y=this._mergeConfigObj(y),y=this._configAfterMerge(y),this._typeCheckConfig(y),y}_configAfterMerge(y){return y.container=y.container===!1?document.body:Ip(y.container),typeof y.delay=="number"&&(y.delay={show:y.delay,hide:y.delay}),typeof y.title=="number"&&(y.title=y.title.toString()),typeof y.content=="number"&&(y.content=y.content.toString()),y}_getDelegateConfig(){const y={};for(const[p,z]of Object.entries(this._config))this.constructor.Default[p]!==z&&(y[p]=z);return y.selector=!1,y.trigger="manual",y}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(y){return this.each(function(){const p=Ig.getOrCreateInstance(this,y);if(typeof y=="string"){if(typeof p[y]>"u")throw new TypeError(`No method named "${y}"`);p[y]()}})}}eu(Ig);const lF="popover",cF=".popover-header",uF=".popover-body",hF={...Ig.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},dF={...Ig.DefaultType,content:"(null|string|element|function)"};class Mb extends Ig{static get Default(){return hF}static get DefaultType(){return dF}static get NAME(){return lF}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[cF]:this._getTitle(),[uF]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(y){return this.each(function(){const p=Mb.getOrCreateInstance(this,y);if(typeof y=="string"){if(typeof p[y]>"u")throw new TypeError(`No method named "${y}"`);p[y]()}})}}eu(Mb);const pF="scrollspy",fF="bs.scrollspy",Sb=`.${fF}`,mF=".data-api",gF=`activate${Sb}`,_S=`click${Sb}`,_F=`load${Sb}${mF}`,yF="dropdown-item",tg="active",vF='[data-bs-spy="scroll"]',a1="[href]",xF=".nav, .list-group",yS=".nav-link",bF=".nav-item",wF=".list-group-item",TF=`${yS}, ${bF} > ${yS}, ${wF}`,MF=".dropdown",SF=".dropdown-toggle",EF={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},AF={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class ov extends Bu{constructor(y,p){super(y,p),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return EF}static get DefaultType(){return AF}static get NAME(){return pF}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const y of this._observableSections.values())this._observer.observe(y)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(y){return y.target=Ip(y.target)||document.body,y.rootMargin=y.offset?`${y.offset}px 0px -30%`:y.rootMargin,typeof y.threshold=="string"&&(y.threshold=y.threshold.split(",").map(p=>Number.parseFloat(p))),y}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Pn.off(this._config.target,_S),Pn.on(this._config.target,_S,a1,y=>{const p=this._observableSections.get(y.target.hash);if(p){y.preventDefault();const z=this._rootElement||window,F=p.offsetTop-this._element.offsetTop;if(z.scrollTo){z.scrollTo({top:F,behavior:"smooth"});return}z.scrollTop=F}}))}_getNewObserver(){const y={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(p=>this._observerCallback(p),y)}_observerCallback(y){const p=V=>this._targetLinks.get(`#${V.target.id}`),z=V=>{this._previousScrollData.visibleEntryTop=V.target.offsetTop,this._process(p(V))},F=(this._rootElement||document.documentElement).scrollTop,q=F>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=F;for(const V of y){if(!V.isIntersecting){this._activeTarget=null,this._clearActiveClass(p(V));continue}const n=V.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(q&&n){if(z(V),!F)return;continue}!q&&!n&&z(V)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const y=jr.find(a1,this._config.target);for(const p of y){if(!p.hash||Rp(p))continue;const z=jr.findOne(decodeURI(p.hash),this._element);Cg(z)&&(this._targetLinks.set(decodeURI(p.hash),p),this._observableSections.set(p.hash,z))}}_process(y){this._activeTarget!==y&&(this._clearActiveClass(this._config.target),this._activeTarget=y,y.classList.add(tg),this._activateParents(y),Pn.trigger(this._element,gF,{relatedTarget:y}))}_activateParents(y){if(y.classList.contains(yF)){jr.findOne(SF,y.closest(MF)).classList.add(tg);return}for(const p of jr.parents(y,xF))for(const z of jr.prev(p,TF))z.classList.add(tg)}_clearActiveClass(y){y.classList.remove(tg);const p=jr.find(`${a1}.${tg}`,y);for(const z of p)z.classList.remove(tg)}static jQueryInterface(y){return this.each(function(){const p=ov.getOrCreateInstance(this,y);if(typeof y=="string"){if(p[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);p[y]()}})}}Pn.on(window,_F,()=>{for(const v of jr.find(vF))ov.getOrCreateInstance(v)});eu(ov);const CF="tab",LF="bs.tab",sm=`.${LF}`,IF=`hide${sm}`,RF=`hidden${sm}`,PF=`show${sm}`,DF=`shown${sm}`,OF=`click${sm}`,zF=`keydown${sm}`,kF=`load${sm}`,FF="ArrowLeft",vS="ArrowRight",BF="ArrowUp",xS="ArrowDown",l1="Home",bS="End",Xf="active",wS="fade",c1="show",NF="dropdown",oA=".dropdown-toggle",UF=".dropdown-menu",u1=`:not(${oA})`,VF='.list-group, .nav, [role="tablist"]',GF=".nav-item, .list-group-item",HF=`.nav-link${u1}, .list-group-item${u1}, [role="tab"]${u1}`,aA='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',h1=`${HF}, ${aA}`,jF=`.${Xf}[data-bs-toggle="tab"], .${Xf}[data-bs-toggle="pill"], .${Xf}[data-bs-toggle="list"]`;class wg extends Bu{constructor(y){super(y),this._parent=this._element.closest(VF),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Pn.on(this._element,zF,p=>this._keydown(p)))}static get NAME(){return CF}show(){const y=this._element;if(this._elemIsActive(y))return;const p=this._getActiveElem(),z=p?Pn.trigger(p,IF,{relatedTarget:y}):null;Pn.trigger(y,PF,{relatedTarget:p}).defaultPrevented||z&&z.defaultPrevented||(this._deactivate(p,y),this._activate(y,p))}_activate(y,p){if(!y)return;y.classList.add(Xf),this._activate(jr.getElementFromSelector(y));const z=()=>{if(y.getAttribute("role")!=="tab"){y.classList.add(c1);return}y.removeAttribute("tabindex"),y.setAttribute("aria-selected",!0),this._toggleDropDown(y,!0),Pn.trigger(y,DF,{relatedTarget:p})};this._queueCallback(z,y,y.classList.contains(wS))}_deactivate(y,p){if(!y)return;y.classList.remove(Xf),y.blur(),this._deactivate(jr.getElementFromSelector(y));const z=()=>{if(y.getAttribute("role")!=="tab"){y.classList.remove(c1);return}y.setAttribute("aria-selected",!1),y.setAttribute("tabindex","-1"),this._toggleDropDown(y,!1),Pn.trigger(y,RF,{relatedTarget:p})};this._queueCallback(z,y,y.classList.contains(wS))}_keydown(y){if(![FF,vS,BF,xS,l1,bS].includes(y.key))return;y.stopPropagation(),y.preventDefault();const p=this._getChildren().filter(F=>!Rp(F));let z;if([l1,bS].includes(y.key))z=p[y.key===l1?0:p.length-1];else{const F=[vS,xS].includes(y.key);z=bb(p,y.target,F,!0)}z&&(z.focus({preventScroll:!0}),wg.getOrCreateInstance(z).show())}_getChildren(){return jr.find(h1,this._parent)}_getActiveElem(){return this._getChildren().find(y=>this._elemIsActive(y))||null}_setInitialAttributes(y,p){this._setAttributeIfNotExists(y,"role","tablist");for(const z of p)this._setInitialAttributesOnChild(z)}_setInitialAttributesOnChild(y){y=this._getInnerElement(y);const p=this._elemIsActive(y),z=this._getOuterElement(y);y.setAttribute("aria-selected",p),z!==y&&this._setAttributeIfNotExists(z,"role","presentation"),p||y.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(y,"role","tab"),this._setInitialAttributesOnTargetPanel(y)}_setInitialAttributesOnTargetPanel(y){const p=jr.getElementFromSelector(y);p&&(this._setAttributeIfNotExists(p,"role","tabpanel"),y.id&&this._setAttributeIfNotExists(p,"aria-labelledby",`${y.id}`))}_toggleDropDown(y,p){const z=this._getOuterElement(y);if(!z.classList.contains(NF))return;const F=(q,V)=>{const n=jr.findOne(q,z);n&&n.classList.toggle(V,p)};F(oA,Xf),F(UF,c1),z.setAttribute("aria-expanded",p)}_setAttributeIfNotExists(y,p,z){y.hasAttribute(p)||y.setAttribute(p,z)}_elemIsActive(y){return y.classList.contains(Xf)}_getInnerElement(y){return y.matches(h1)?y:jr.findOne(h1,y)}_getOuterElement(y){return y.closest(GF)||y}static jQueryInterface(y){return this.each(function(){const p=wg.getOrCreateInstance(this);if(typeof y=="string"){if(p[y]===void 0||y.startsWith("_")||y==="constructor")throw new TypeError(`No method named "${y}"`);p[y]()}})}}Pn.on(document,OF,aA,function(v){["A","AREA"].includes(this.tagName)&&v.preventDefault(),!Rp(this)&&wg.getOrCreateInstance(this).show()});Pn.on(window,kF,()=>{for(const v of jr.find(jF))wg.getOrCreateInstance(v)});eu(wg);const WF="toast",qF="bs.toast",Up=`.${qF}`,$F=`mouseover${Up}`,ZF=`mouseout${Up}`,XF=`focusin${Up}`,YF=`focusout${Up}`,KF=`hide${Up}`,JF=`hidden${Up}`,QF=`show${Up}`,e4=`shown${Up}`,t4="fade",TS="hide",g0="show",_0="showing",i4={animation:"boolean",autohide:"boolean",delay:"number"},n4={animation:!0,autohide:!0,delay:5e3};class av extends Bu{constructor(y,p){super(y,p),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return n4}static get DefaultType(){return i4}static get NAME(){return WF}show(){if(Pn.trigger(this._element,QF).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(t4);const p=()=>{this._element.classList.remove(_0),Pn.trigger(this._element,e4),this._maybeScheduleHide()};this._element.classList.remove(TS),ny(this._element),this._element.classList.add(g0,_0),this._queueCallback(p,this._element,this._config.animation)}hide(){if(!this.isShown()||Pn.trigger(this._element,KF).defaultPrevented)return;const p=()=>{this._element.classList.add(TS),this._element.classList.remove(_0,g0),Pn.trigger(this._element,JF)};this._element.classList.add(_0),this._queueCallback(p,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(g0),super.dispose()}isShown(){return this._element.classList.contains(g0)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(y,p){switch(y.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=p;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=p;break}}if(p){this._clearTimeout();return}const z=y.relatedTarget;this._element===z||this._element.contains(z)||this._maybeScheduleHide()}_setListeners(){Pn.on(this._element,$F,y=>this._onInteraction(y,!0)),Pn.on(this._element,ZF,y=>this._onInteraction(y,!1)),Pn.on(this._element,XF,y=>this._onInteraction(y,!0)),Pn.on(this._element,YF,y=>this._onInteraction(y,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(y){return this.each(function(){const p=av.getOrCreateInstance(this,y);if(typeof y=="string"){if(typeof p[y]>"u")throw new TypeError(`No method named "${y}"`);p[y](this)}})}}nv(av);eu(av);lI(nD).mount("#app");
