(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))E(D);new MutationObserver(D=>{for(const N of D)if(N.type==="childList")for(const B of N.addedNodes)B.tagName==="LINK"&&B.rel==="modulepreload"&&E(B)}).observe(document,{childList:!0,subtree:!0});function l(D){const N={};return D.integrity&&(N.integrity=D.integrity),D.referrerPolicy&&(N.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?N.credentials="include":D.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function E(D){if(D.ep)return;D.ep=!0;const N=l(D);fetch(D.href,N)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function xw(c){const p=Object.create(null);for(const l of c.split(","))p[l]=1;return l=>l in p}const Io={},Vg=[],Wh=()=>{},iR=()=>!1,ex=c=>c.charCodeAt(0)===111&&c.charCodeAt(1)===110&&(c.charCodeAt(2)>122||c.charCodeAt(2)<97),bw=c=>c.startsWith("onUpdate:"),il=Object.assign,ww=(c,p)=>{const l=c.indexOf(p);l>-1&&c.splice(l,1)},nR=Object.prototype.hasOwnProperty,lo=(c,p)=>nR.call(c,p),gs=Array.isArray,Gg=c=>tx(c)==="[object Map]",rA=c=>tx(c)==="[object Set]",Cs=c=>typeof c=="function",ga=c=>typeof c=="string",nf=c=>typeof c=="symbol",Wo=c=>c!==null&&typeof c=="object",sA=c=>(Wo(c)||Cs(c))&&Cs(c.then)&&Cs(c.catch),oA=Object.prototype.toString,tx=c=>oA.call(c),rR=c=>tx(c).slice(8,-1),aA=c=>tx(c)==="[object Object]",Tw=c=>ga(c)&&c!=="NaN"&&c[0]!=="-"&&""+parseInt(c,10)===c,C0=xw(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ix=c=>{const p=Object.create(null);return l=>p[l]||(p[l]=c(l))},sR=/-(\w)/g,Jp=ix(c=>c.replace(sR,(p,l)=>l?l.toUpperCase():"")),oR=/\B([A-Z])/g,Pm=ix(c=>c.replace(oR,"-$1").toLowerCase()),lA=ix(c=>c.charAt(0).toUpperCase()+c.slice(1)),v1=ix(c=>c?`on${lA(c)}`:""),wm=(c,p)=>!Object.is(c,p),x1=(c,...p)=>{for(let l=0;l<c.length;l++)c[l](...p)},cA=(c,p,l,E=!1)=>{Object.defineProperty(c,p,{configurable:!0,enumerable:!1,writable:E,value:l})},aR=c=>{const p=parseFloat(c);return isNaN(p)?c:p};let yM;const nx=()=>yM||(yM=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Mw(c){if(gs(c)){const p={};for(let l=0;l<c.length;l++){const E=c[l],D=ga(E)?hR(E):Mw(E);if(D)for(const N in D)p[N]=D[N]}return p}else if(ga(c)||Wo(c))return c}const lR=/;(?![^(]*\))/g,cR=/:([^]+)/,uR=/\/\*[^]*?\*\//g;function hR(c){const p={};return c.replace(uR,"").split(lR).forEach(l=>{if(l){const E=l.split(cR);E.length>1&&(p[E[0].trim()]=E[1].trim())}}),p}function Sw(c){let p="";if(ga(c))p=c;else if(gs(c))for(let l=0;l<c.length;l++){const E=Sw(c[l]);E&&(p+=E+" ")}else if(Wo(c))for(const l in c)c[l]&&(p+=l+" ");return p.trim()}const dR="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",pR=xw(dR);function uA(c){return!!c||c===""}const hA=c=>!!(c&&c.__v_isRef===!0),zg=c=>ga(c)?c:c==null?"":gs(c)||Wo(c)&&(c.toString===oA||!Cs(c.toString))?hA(c)?zg(c.value):JSON.stringify(c,dA,2):String(c),dA=(c,p)=>hA(p)?dA(c,p.value):Gg(p)?{[`Map(${p.size})`]:[...p.entries()].reduce((l,[E,D],N)=>(l[b1(E,N)+" =>"]=D,l),{})}:rA(p)?{[`Set(${p.size})`]:[...p.values()].map(l=>b1(l))}:nf(p)?b1(p):Wo(p)&&!gs(p)&&!aA(p)?String(p):p,b1=(c,p="")=>{var l;return nf(c)?`Symbol(${(l=c.description)!=null?l:p})`:c};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let wc;class fR{constructor(p=!1){this.detached=p,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=wc,!p&&wc&&(this.index=(wc.scopes||(wc.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let p,l;if(this.scopes)for(p=0,l=this.scopes.length;p<l;p++)this.scopes[p].pause();for(p=0,l=this.effects.length;p<l;p++)this.effects[p].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let p,l;if(this.scopes)for(p=0,l=this.scopes.length;p<l;p++)this.scopes[p].resume();for(p=0,l=this.effects.length;p<l;p++)this.effects[p].resume()}}run(p){if(this._active){const l=wc;try{return wc=this,p()}finally{wc=l}}}on(){wc=this}off(){wc=this.parent}stop(p){if(this._active){this._active=!1;let l,E;for(l=0,E=this.effects.length;l<E;l++)this.effects[l].stop();for(this.effects.length=0,l=0,E=this.cleanups.length;l<E;l++)this.cleanups[l]();if(this.cleanups.length=0,this.scopes){for(l=0,E=this.scopes.length;l<E;l++)this.scopes[l].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!p){const D=this.parent.scopes.pop();D&&D!==this&&(this.parent.scopes[this.index]=D,D.index=this.index)}this.parent=void 0}}}function mR(){return wc}let Lo;const w1=new WeakSet;class pA{constructor(p){this.fn=p,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,wc&&wc.active&&wc.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,w1.has(this)&&(w1.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||mA(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,vM(this),gA(this);const p=Lo,l=Zu;Lo=this,Zu=!0;try{return this.fn()}finally{_A(this),Lo=p,Zu=l,this.flags&=-3}}stop(){if(this.flags&1){for(let p=this.deps;p;p=p.nextDep)Cw(p);this.deps=this.depsTail=void 0,vM(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?w1.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){jb(this)&&this.run()}get dirty(){return jb(this)}}let fA=0,L0,I0;function mA(c,p=!1){if(c.flags|=8,p){c.next=I0,I0=c;return}c.next=L0,L0=c}function Ew(){fA++}function Aw(){if(--fA>0)return;if(I0){let p=I0;for(I0=void 0;p;){const l=p.next;p.next=void 0,p.flags&=-9,p=l}}let c;for(;L0;){let p=L0;for(L0=void 0;p;){const l=p.next;if(p.next=void 0,p.flags&=-9,p.flags&1)try{p.trigger()}catch(E){c||(c=E)}p=l}}if(c)throw c}function gA(c){for(let p=c.deps;p;p=p.nextDep)p.version=-1,p.prevActiveLink=p.dep.activeLink,p.dep.activeLink=p}function _A(c){let p,l=c.depsTail,E=l;for(;E;){const D=E.prevDep;E.version===-1?(E===l&&(l=D),Cw(E),gR(E)):p=E,E.dep.activeLink=E.prevActiveLink,E.prevActiveLink=void 0,E=D}c.deps=p,c.depsTail=l}function jb(c){for(let p=c.deps;p;p=p.nextDep)if(p.dep.version!==p.version||p.dep.computed&&(yA(p.dep.computed)||p.dep.version!==p.version))return!0;return!!c._dirty}function yA(c){if(c.flags&4&&!(c.flags&16)||(c.flags&=-17,c.globalVersion===N0))return;c.globalVersion=N0;const p=c.dep;if(c.flags|=2,p.version>0&&!c.isSSR&&c.deps&&!jb(c)){c.flags&=-3;return}const l=Lo,E=Zu;Lo=c,Zu=!0;try{gA(c);const D=c.fn(c._value);(p.version===0||wm(D,c._value))&&(c._value=D,p.version++)}catch(D){throw p.version++,D}finally{Lo=l,Zu=E,_A(c),c.flags&=-3}}function Cw(c,p=!1){const{dep:l,prevSub:E,nextSub:D}=c;if(E&&(E.nextSub=D,c.prevSub=void 0),D&&(D.prevSub=E,c.nextSub=void 0),l.subs===c&&(l.subs=E,!E&&l.computed)){l.computed.flags&=-5;for(let N=l.computed.deps;N;N=N.nextDep)Cw(N,!0)}!p&&!--l.sc&&l.map&&l.map.delete(l.key)}function gR(c){const{prevDep:p,nextDep:l}=c;p&&(p.nextDep=l,c.prevDep=void 0),l&&(l.prevDep=p,c.nextDep=void 0)}let Zu=!0;const vA=[];function rf(){vA.push(Zu),Zu=!1}function sf(){const c=vA.pop();Zu=c===void 0?!0:c}function vM(c){const{cleanup:p}=c;if(c.cleanup=void 0,p){const l=Lo;Lo=void 0;try{p()}finally{Lo=l}}}let N0=0;class _R{constructor(p,l){this.sub=p,this.dep=l,this.version=l.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class xA{constructor(p){this.computed=p,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(p){if(!Lo||!Zu||Lo===this.computed)return;let l=this.activeLink;if(l===void 0||l.sub!==Lo)l=this.activeLink=new _R(Lo,this),Lo.deps?(l.prevDep=Lo.depsTail,Lo.depsTail.nextDep=l,Lo.depsTail=l):Lo.deps=Lo.depsTail=l,bA(l);else if(l.version===-1&&(l.version=this.version,l.nextDep)){const E=l.nextDep;E.prevDep=l.prevDep,l.prevDep&&(l.prevDep.nextDep=E),l.prevDep=Lo.depsTail,l.nextDep=void 0,Lo.depsTail.nextDep=l,Lo.depsTail=l,Lo.deps===l&&(Lo.deps=E)}return l}trigger(p){this.version++,N0++,this.notify(p)}notify(p){Ew();try{for(let l=this.subs;l;l=l.prevSub)l.sub.notify()&&l.sub.dep.notify()}finally{Aw()}}}function bA(c){if(c.dep.sc++,c.sub.flags&4){const p=c.dep.computed;if(p&&!c.dep.subs){p.flags|=20;for(let E=p.deps;E;E=E.nextDep)bA(E)}const l=c.dep.subs;l!==c&&(c.prevSub=l,l&&(l.nextSub=c)),c.dep.subs=c}}const Wb=new WeakMap,Tm=Symbol(""),qb=Symbol(""),U0=Symbol("");function pl(c,p,l){if(Zu&&Lo){let E=Wb.get(c);E||Wb.set(c,E=new Map);let D=E.get(l);D||(E.set(l,D=new xA),D.map=E,D.key=l),D.track()}}function Nd(c,p,l,E,D,N){const B=Wb.get(c);if(!B){N0++;return}const n=X=>{X&&X.trigger()};if(Ew(),p==="clear")B.forEach(n);else{const X=gs(c),$=X&&Tw(l);if(X&&l==="length"){const ne=Number(E);B.forEach((ve,ze)=>{(ze==="length"||ze===U0||!nf(ze)&&ze>=ne)&&n(ve)})}else switch((l!==void 0||B.has(void 0))&&n(B.get(l)),$&&n(B.get(U0)),p){case"add":X?$&&n(B.get("length")):(n(B.get(Tm)),Gg(c)&&n(B.get(qb)));break;case"delete":X||(n(B.get(Tm)),Gg(c)&&n(B.get(qb)));break;case"set":Gg(c)&&n(B.get(Tm));break}}Aw()}function Ag(c){const p=mo(c);return p===c?p:(pl(p,"iterate",U0),Xu(c)?p:p.map(ec))}function rx(c){return pl(c=mo(c),"iterate",U0),c}const yR={__proto__:null,[Symbol.iterator](){return T1(this,Symbol.iterator,ec)},concat(...c){return Ag(this).concat(...c.map(p=>gs(p)?Ag(p):p))},entries(){return T1(this,"entries",c=>(c[1]=ec(c[1]),c))},every(c,p){return Pd(this,"every",c,p,void 0,arguments)},filter(c,p){return Pd(this,"filter",c,p,l=>l.map(ec),arguments)},find(c,p){return Pd(this,"find",c,p,ec,arguments)},findIndex(c,p){return Pd(this,"findIndex",c,p,void 0,arguments)},findLast(c,p){return Pd(this,"findLast",c,p,ec,arguments)},findLastIndex(c,p){return Pd(this,"findLastIndex",c,p,void 0,arguments)},forEach(c,p){return Pd(this,"forEach",c,p,void 0,arguments)},includes(...c){return M1(this,"includes",c)},indexOf(...c){return M1(this,"indexOf",c)},join(c){return Ag(this).join(c)},lastIndexOf(...c){return M1(this,"lastIndexOf",c)},map(c,p){return Pd(this,"map",c,p,void 0,arguments)},pop(){return v0(this,"pop")},push(...c){return v0(this,"push",c)},reduce(c,...p){return xM(this,"reduce",c,p)},reduceRight(c,...p){return xM(this,"reduceRight",c,p)},shift(){return v0(this,"shift")},some(c,p){return Pd(this,"some",c,p,void 0,arguments)},splice(...c){return v0(this,"splice",c)},toReversed(){return Ag(this).toReversed()},toSorted(c){return Ag(this).toSorted(c)},toSpliced(...c){return Ag(this).toSpliced(...c)},unshift(...c){return v0(this,"unshift",c)},values(){return T1(this,"values",ec)}};function T1(c,p,l){const E=rx(c),D=E[p]();return E!==c&&!Xu(c)&&(D._next=D.next,D.next=()=>{const N=D._next();return N.value&&(N.value=l(N.value)),N}),D}const vR=Array.prototype;function Pd(c,p,l,E,D,N){const B=rx(c),n=B!==c&&!Xu(c),X=B[p];if(X!==vR[p]){const ve=X.apply(c,N);return n?ec(ve):ve}let $=l;B!==c&&(n?$=function(ve,ze){return l.call(this,ec(ve),ze,c)}:l.length>2&&($=function(ve,ze){return l.call(this,ve,ze,c)}));const ne=X.call(B,$,E);return n&&D?D(ne):ne}function xM(c,p,l,E){const D=rx(c);let N=l;return D!==c&&(Xu(c)?l.length>3&&(N=function(B,n,X){return l.call(this,B,n,X,c)}):N=function(B,n,X){return l.call(this,B,ec(n),X,c)}),D[p](N,...E)}function M1(c,p,l){const E=mo(c);pl(E,"iterate",U0);const D=E[p](...l);return(D===-1||D===!1)&&Pw(l[0])?(l[0]=mo(l[0]),E[p](...l)):D}function v0(c,p,l=[]){rf(),Ew();const E=mo(c)[p].apply(c,l);return Aw(),sf(),E}const xR=xw("__proto__,__v_isRef,__isVue"),wA=new Set(Object.getOwnPropertyNames(Symbol).filter(c=>c!=="arguments"&&c!=="caller").map(c=>Symbol[c]).filter(nf));function bR(c){nf(c)||(c=String(c));const p=mo(this);return pl(p,"has",c),p.hasOwnProperty(c)}class TA{constructor(p=!1,l=!1){this._isReadonly=p,this._isShallow=l}get(p,l,E){if(l==="__v_skip")return p.__v_skip;const D=this._isReadonly,N=this._isShallow;if(l==="__v_isReactive")return!D;if(l==="__v_isReadonly")return D;if(l==="__v_isShallow")return N;if(l==="__v_raw")return E===(D?N?RR:AA:N?EA:SA).get(p)||Object.getPrototypeOf(p)===Object.getPrototypeOf(E)?p:void 0;const B=gs(p);if(!D){let X;if(B&&(X=yR[l]))return X;if(l==="hasOwnProperty")return bR}const n=Reflect.get(p,l,Ul(p)?p:E);return(nf(l)?wA.has(l):xR(l))||(D||pl(p,"get",l),N)?n:Ul(n)?B&&Tw(l)?n:n.value:Wo(n)?D?CA(n):Iw(n):n}}class MA extends TA{constructor(p=!1){super(!1,p)}set(p,l,E,D){let N=p[l];if(!this._isShallow){const X=$g(N);if(!Xu(E)&&!$g(E)&&(N=mo(N),E=mo(E)),!gs(p)&&Ul(N)&&!Ul(E))return X?!1:(N.value=E,!0)}const B=gs(p)&&Tw(l)?Number(l)<p.length:lo(p,l),n=Reflect.set(p,l,E,Ul(p)?p:D);return p===mo(D)&&(B?wm(E,N)&&Nd(p,"set",l,E):Nd(p,"add",l,E)),n}deleteProperty(p,l){const E=lo(p,l);p[l];const D=Reflect.deleteProperty(p,l);return D&&E&&Nd(p,"delete",l,void 0),D}has(p,l){const E=Reflect.has(p,l);return(!nf(l)||!wA.has(l))&&pl(p,"has",l),E}ownKeys(p){return pl(p,"iterate",gs(p)?"length":Tm),Reflect.ownKeys(p)}}class wR extends TA{constructor(p=!1){super(!0,p)}set(p,l){return!0}deleteProperty(p,l){return!0}}const TR=new MA,MR=new wR,SR=new MA(!0);const $b=c=>c,av=c=>Reflect.getPrototypeOf(c);function ER(c,p,l){return function(...E){const D=this.__v_raw,N=mo(D),B=Gg(N),n=c==="entries"||c===Symbol.iterator&&B,X=c==="keys"&&B,$=D[c](...E),ne=l?$b:p?Zb:ec;return!p&&pl(N,"iterate",X?qb:Tm),{next(){const{value:ve,done:ze}=$.next();return ze?{value:ve,done:ze}:{value:n?[ne(ve[0]),ne(ve[1])]:ne(ve),done:ze}},[Symbol.iterator](){return this}}}}function lv(c){return function(...p){return c==="delete"?!1:c==="clear"?void 0:this}}function AR(c,p){const l={get(D){const N=this.__v_raw,B=mo(N),n=mo(D);c||(wm(D,n)&&pl(B,"get",D),pl(B,"get",n));const{has:X}=av(B),$=p?$b:c?Zb:ec;if(X.call(B,D))return $(N.get(D));if(X.call(B,n))return $(N.get(n));N!==B&&N.get(D)},get size(){const D=this.__v_raw;return!c&&pl(mo(D),"iterate",Tm),Reflect.get(D,"size",D)},has(D){const N=this.__v_raw,B=mo(N),n=mo(D);return c||(wm(D,n)&&pl(B,"has",D),pl(B,"has",n)),D===n?N.has(D):N.has(D)||N.has(n)},forEach(D,N){const B=this,n=B.__v_raw,X=mo(n),$=p?$b:c?Zb:ec;return!c&&pl(X,"iterate",Tm),n.forEach((ne,ve)=>D.call(N,$(ne),$(ve),B))}};return il(l,c?{add:lv("add"),set:lv("set"),delete:lv("delete"),clear:lv("clear")}:{add(D){!p&&!Xu(D)&&!$g(D)&&(D=mo(D));const N=mo(this);return av(N).has.call(N,D)||(N.add(D),Nd(N,"add",D,D)),this},set(D,N){!p&&!Xu(N)&&!$g(N)&&(N=mo(N));const B=mo(this),{has:n,get:X}=av(B);let $=n.call(B,D);$||(D=mo(D),$=n.call(B,D));const ne=X.call(B,D);return B.set(D,N),$?wm(N,ne)&&Nd(B,"set",D,N):Nd(B,"add",D,N),this},delete(D){const N=mo(this),{has:B,get:n}=av(N);let X=B.call(N,D);X||(D=mo(D),X=B.call(N,D)),n&&n.call(N,D);const $=N.delete(D);return X&&Nd(N,"delete",D,void 0),$},clear(){const D=mo(this),N=D.size!==0,B=D.clear();return N&&Nd(D,"clear",void 0,void 0),B}}),["keys","values","entries",Symbol.iterator].forEach(D=>{l[D]=ER(D,c,p)}),l}function Lw(c,p){const l=AR(c,p);return(E,D,N)=>D==="__v_isReactive"?!c:D==="__v_isReadonly"?c:D==="__v_raw"?E:Reflect.get(lo(l,D)&&D in E?l:E,D,N)}const CR={get:Lw(!1,!1)},LR={get:Lw(!1,!0)},IR={get:Lw(!0,!1)};const SA=new WeakMap,EA=new WeakMap,AA=new WeakMap,RR=new WeakMap;function PR(c){switch(c){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function DR(c){return c.__v_skip||!Object.isExtensible(c)?0:PR(rR(c))}function Iw(c){return $g(c)?c:Rw(c,!1,TR,CR,SA)}function OR(c){return Rw(c,!1,SR,LR,EA)}function CA(c){return Rw(c,!0,MR,IR,AA)}function Rw(c,p,l,E,D){if(!Wo(c)||c.__v_raw&&!(p&&c.__v_isReactive))return c;const N=D.get(c);if(N)return N;const B=DR(c);if(B===0)return c;const n=new Proxy(c,B===2?E:l);return D.set(c,n),n}function Hg(c){return $g(c)?Hg(c.__v_raw):!!(c&&c.__v_isReactive)}function $g(c){return!!(c&&c.__v_isReadonly)}function Xu(c){return!!(c&&c.__v_isShallow)}function Pw(c){return c?!!c.__v_raw:!1}function mo(c){const p=c&&c.__v_raw;return p?mo(p):c}function zR(c){return!lo(c,"__v_skip")&&Object.isExtensible(c)&&cA(c,"__v_skip",!0),c}const ec=c=>Wo(c)?Iw(c):c,Zb=c=>Wo(c)?CA(c):c;function Ul(c){return c?c.__v_isRef===!0:!1}function kR(c){return Ul(c)?c.value:c}const FR={get:(c,p,l)=>p==="__v_raw"?c:kR(Reflect.get(c,p,l)),set:(c,p,l,E)=>{const D=c[p];return Ul(D)&&!Ul(l)?(D.value=l,!0):Reflect.set(c,p,l,E)}};function LA(c){return Hg(c)?c:new Proxy(c,FR)}class BR{constructor(p,l,E){this.fn=p,this.setter=l,this._value=void 0,this.dep=new xA(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=N0-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!l,this.isSSR=E}notify(){if(this.flags|=16,!(this.flags&8)&&Lo!==this)return mA(this,!0),!0}get value(){const p=this.dep.track();return yA(this),p&&(p.version=this.dep.version),this._value}set value(p){this.setter&&this.setter(p)}}function NR(c,p,l=!1){let E,D;return Cs(c)?E=c:(E=c.get,D=c.set),new BR(E,D,l)}const cv={},Bv=new WeakMap;let gm;function UR(c,p=!1,l=gm){if(l){let E=Bv.get(l);E||Bv.set(l,E=[]),E.push(c)}}function VR(c,p,l=Io){const{immediate:E,deep:D,once:N,scheduler:B,augmentJob:n,call:X}=l,$=mt=>D?mt:Xu(mt)||D===!1||D===0?qp(mt,1):qp(mt);let ne,ve,ze,ke,yt=!1,it=!1;if(Ul(c)?(ve=()=>c.value,yt=Xu(c)):Hg(c)?(ve=()=>$(c),yt=!0):gs(c)?(it=!0,yt=c.some(mt=>Hg(mt)||Xu(mt)),ve=()=>c.map(mt=>{if(Ul(mt))return mt.value;if(Hg(mt))return $(mt);if(Cs(mt))return X?X(mt,2):mt()})):Cs(c)?p?ve=X?()=>X(c,2):c:ve=()=>{if(ze){rf();try{ze()}finally{sf()}}const mt=gm;gm=ne;try{return X?X(c,3,[ke]):c(ke)}finally{gm=mt}}:ve=Wh,p&&D){const mt=ve,pt=D===!0?1/0:D;ve=()=>qp(mt(),pt)}const xt=mR(),Ze=()=>{ne.stop(),xt&&xt.active&&ww(xt.effects,ne)};if(N&&p){const mt=p;p=(...pt)=>{mt(...pt),Ze()}}let st=it?new Array(c.length).fill(cv):cv;const ti=mt=>{if(!(!(ne.flags&1)||!ne.dirty&&!mt))if(p){const pt=ne.run();if(D||yt||(it?pt.some((Tt,Fe)=>wm(Tt,st[Fe])):wm(pt,st))){ze&&ze();const Tt=gm;gm=ne;try{const Fe=[pt,st===cv?void 0:it&&st[0]===cv?[]:st,ke];X?X(p,3,Fe):p(...Fe),st=pt}finally{gm=Tt}}}else ne.run()};return n&&n(ti),ne=new pA(ve),ne.scheduler=B?()=>B(ti,!1):ti,ke=mt=>UR(mt,!1,ne),ze=ne.onStop=()=>{const mt=Bv.get(ne);if(mt){if(X)X(mt,4);else for(const pt of mt)pt();Bv.delete(ne)}},p?E?ti(!0):st=ne.run():B?B(ti.bind(null,!0),!0):ne.run(),Ze.pause=ne.pause.bind(ne),Ze.resume=ne.resume.bind(ne),Ze.stop=Ze,Ze}function qp(c,p=1/0,l){if(p<=0||!Wo(c)||c.__v_skip||(l=l||new Set,l.has(c)))return c;if(l.add(c),p--,Ul(c))qp(c.value,p,l);else if(gs(c))for(let E=0;E<c.length;E++)qp(c[E],p,l);else if(rA(c)||Gg(c))c.forEach(E=>{qp(E,p,l)});else if(aA(c)){for(const E in c)qp(c[E],p,l);for(const E of Object.getOwnPropertySymbols(c))Object.prototype.propertyIsEnumerable.call(c,E)&&qp(c[E],p,l)}return c}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ey(c,p,l,E){try{return E?c(...E):c()}catch(D){sx(D,p,l)}}function Jh(c,p,l,E){if(Cs(c)){const D=ey(c,p,l,E);return D&&sA(D)&&D.catch(N=>{sx(N,p,l)}),D}if(gs(c)){const D=[];for(let N=0;N<c.length;N++)D.push(Jh(c[N],p,l,E));return D}}function sx(c,p,l,E=!0){const D=p?p.vnode:null,{errorHandler:N,throwUnhandledErrorInProduction:B}=p&&p.appContext.config||Io;if(p){let n=p.parent;const X=p.proxy,$=`https://vuejs.org/error-reference/#runtime-${l}`;for(;n;){const ne=n.ec;if(ne){for(let ve=0;ve<ne.length;ve++)if(ne[ve](c,X,$)===!1)return}n=n.parent}if(N){rf(),ey(N,null,10,[c,X,$]),sf();return}}GR(c,l,D,E,B)}function GR(c,p,l,E=!0,D=!1){if(D)throw c;console.error(c)}const Fl=[];let Vh=-1;const jg=[];let jp=null,kg=0;const IA=Promise.resolve();let Nv=null;function HR(c){const p=Nv||IA;return c?p.then(this?c.bind(this):c):p}function jR(c){let p=Vh+1,l=Fl.length;for(;p<l;){const E=p+l>>>1,D=Fl[E],N=V0(D);N<c||N===c&&D.flags&2?p=E+1:l=E}return p}function Dw(c){if(!(c.flags&1)){const p=V0(c),l=Fl[Fl.length-1];!l||!(c.flags&2)&&p>=V0(l)?Fl.push(c):Fl.splice(jR(p),0,c),c.flags|=1,RA()}}function RA(){Nv||(Nv=IA.then(DA))}function WR(c){gs(c)?jg.push(...c):jp&&c.id===-1?jp.splice(kg+1,0,c):c.flags&1||(jg.push(c),c.flags|=1),RA()}function bM(c,p,l=Vh+1){for(;l<Fl.length;l++){const E=Fl[l];if(E&&E.flags&2){if(c&&E.id!==c.uid)continue;Fl.splice(l,1),l--,E.flags&4&&(E.flags&=-2),E(),E.flags&4||(E.flags&=-2)}}}function PA(c){if(jg.length){const p=[...new Set(jg)].sort((l,E)=>V0(l)-V0(E));if(jg.length=0,jp){jp.push(...p);return}for(jp=p,kg=0;kg<jp.length;kg++){const l=jp[kg];l.flags&4&&(l.flags&=-2),l.flags&8||l(),l.flags&=-2}jp=null,kg=0}}const V0=c=>c.id==null?c.flags&2?-1:1/0:c.id;function DA(c){try{for(Vh=0;Vh<Fl.length;Vh++){const p=Fl[Vh];p&&!(p.flags&8)&&(p.flags&4&&(p.flags&=-2),ey(p,p.i,p.i?15:14),p.flags&4||(p.flags&=-2))}}finally{for(;Vh<Fl.length;Vh++){const p=Fl[Vh];p&&(p.flags&=-2)}Vh=-1,Fl.length=0,PA(),Nv=null,(Fl.length||jg.length)&&DA()}}let jh=null,OA=null;function Uv(c){const p=jh;return jh=c,OA=c&&c.type.__scopeId||null,p}function qR(c,p=jh,l){if(!p||c._n)return c;const E=(...D)=>{E._d&&LM(-1);const N=Uv(p);let B;try{B=c(...D)}finally{Uv(N),E._d&&LM(1)}return B};return E._n=!0,E._c=!0,E._d=!0,E}function fm(c,p,l,E){const D=c.dirs,N=p&&p.dirs;for(let B=0;B<D.length;B++){const n=D[B];N&&(n.oldValue=N[B].value);let X=n.dir[E];X&&(rf(),Jh(X,l,8,[c.el,n,c,p]),sf())}}const $R=Symbol("_vte"),ZR=c=>c.__isTeleport;function Ow(c,p){c.shapeFlag&6&&c.component?(c.transition=p,Ow(c.component.subTree,p)):c.shapeFlag&128?(c.ssContent.transition=p.clone(c.ssContent),c.ssFallback.transition=p.clone(c.ssFallback)):c.transition=p}function zA(c){c.ids=[c.ids[0]+c.ids[2]+++"-",0,0]}function Vv(c,p,l,E,D=!1){if(gs(c)){c.forEach((yt,it)=>Vv(yt,p&&(gs(p)?p[it]:p),l,E,D));return}if(R0(E)&&!D){E.shapeFlag&512&&E.type.__asyncResolved&&E.component.subTree.component&&Vv(c,p,l,E.component.subTree);return}const N=E.shapeFlag&4?Bw(E.component):E.el,B=D?null:N,{i:n,r:X}=c,$=p&&p.r,ne=n.refs===Io?n.refs={}:n.refs,ve=n.setupState,ze=mo(ve),ke=ve===Io?()=>!1:yt=>lo(ze,yt);if($!=null&&$!==X&&(ga($)?(ne[$]=null,ke($)&&(ve[$]=null)):Ul($)&&($.value=null)),Cs(X))ey(X,n,12,[B,ne]);else{const yt=ga(X),it=Ul(X);if(yt||it){const xt=()=>{if(c.f){const Ze=yt?ke(X)?ve[X]:ne[X]:X.value;D?gs(Ze)&&ww(Ze,N):gs(Ze)?Ze.includes(N)||Ze.push(N):yt?(ne[X]=[N],ke(X)&&(ve[X]=ne[X])):(X.value=[N],c.k&&(ne[c.k]=X.value))}else yt?(ne[X]=B,ke(X)&&(ve[X]=B)):it&&(X.value=B,c.k&&(ne[c.k]=B))};B?(xt.id=-1,xc(xt,l)):xt()}}}nx().requestIdleCallback;nx().cancelIdleCallback;const R0=c=>!!c.type.__asyncLoader,kA=c=>c.type.__isKeepAlive;function XR(c,p){FA(c,"a",p)}function YR(c,p){FA(c,"da",p)}function FA(c,p,l=Bl){const E=c.__wdc||(c.__wdc=()=>{let D=l;for(;D;){if(D.isDeactivated)return;D=D.parent}return c()});if(ox(p,E,l),l){let D=l.parent;for(;D&&D.parent;)kA(D.parent.vnode)&&KR(E,p,l,D),D=D.parent}}function KR(c,p,l,E){const D=ox(p,c,E,!0);BA(()=>{ww(E[p],D)},l)}function ox(c,p,l=Bl,E=!1){if(l){const D=l[c]||(l[c]=[]),N=p.__weh||(p.__weh=(...B)=>{rf();const n=ty(l),X=Jh(p,l,c,B);return n(),sf(),X});return E?D.unshift(N):D.push(N),N}}const Wd=c=>(p,l=Bl)=>{(!H0||c==="sp")&&ox(c,(...E)=>p(...E),l)},JR=Wd("bm"),QR=Wd("m"),eP=Wd("bu"),tP=Wd("u"),iP=Wd("bum"),BA=Wd("um"),nP=Wd("sp"),rP=Wd("rtg"),sP=Wd("rtc");function oP(c,p=Bl){ox("ec",c,p)}const aP=Symbol.for("v-ndc");function uv(c,p,l,E){let D;const N=l,B=gs(c);if(B||ga(c)){const n=B&&Hg(c);let X=!1;n&&(X=!Xu(c),c=rx(c)),D=new Array(c.length);for(let $=0,ne=c.length;$<ne;$++)D[$]=p(X?ec(c[$]):c[$],$,void 0,N)}else if(typeof c=="number"){D=new Array(c);for(let n=0;n<c;n++)D[n]=p(n+1,n,void 0,N)}else if(Wo(c))if(c[Symbol.iterator])D=Array.from(c,(n,X)=>p(n,X,void 0,N));else{const n=Object.keys(c);D=new Array(n.length);for(let X=0,$=n.length;X<$;X++){const ne=n[X];D[X]=p(c[ne],ne,X,N)}}else D=[];return D}const Xb=c=>c?o3(c)?Bw(c):Xb(c.parent):null,P0=il(Object.create(null),{$:c=>c,$el:c=>c.vnode.el,$data:c=>c.data,$props:c=>c.props,$attrs:c=>c.attrs,$slots:c=>c.slots,$refs:c=>c.refs,$parent:c=>Xb(c.parent),$root:c=>Xb(c.root),$host:c=>c.ce,$emit:c=>c.emit,$options:c=>zw(c),$forceUpdate:c=>c.f||(c.f=()=>{Dw(c.update)}),$nextTick:c=>c.n||(c.n=HR.bind(c.proxy)),$watch:c=>LP.bind(c)}),S1=(c,p)=>c!==Io&&!c.__isScriptSetup&&lo(c,p),lP={get({_:c},p){if(p==="__v_skip")return!0;const{ctx:l,setupState:E,data:D,props:N,accessCache:B,type:n,appContext:X}=c;let $;if(p[0]!=="$"){const ke=B[p];if(ke!==void 0)switch(ke){case 1:return E[p];case 2:return D[p];case 4:return l[p];case 3:return N[p]}else{if(S1(E,p))return B[p]=1,E[p];if(D!==Io&&lo(D,p))return B[p]=2,D[p];if(($=c.propsOptions[0])&&lo($,p))return B[p]=3,N[p];if(l!==Io&&lo(l,p))return B[p]=4,l[p];Yb&&(B[p]=0)}}const ne=P0[p];let ve,ze;if(ne)return p==="$attrs"&&pl(c.attrs,"get",""),ne(c);if((ve=n.__cssModules)&&(ve=ve[p]))return ve;if(l!==Io&&lo(l,p))return B[p]=4,l[p];if(ze=X.config.globalProperties,lo(ze,p))return ze[p]},set({_:c},p,l){const{data:E,setupState:D,ctx:N}=c;return S1(D,p)?(D[p]=l,!0):E!==Io&&lo(E,p)?(E[p]=l,!0):lo(c.props,p)||p[0]==="$"&&p.slice(1)in c?!1:(N[p]=l,!0)},has({_:{data:c,setupState:p,accessCache:l,ctx:E,appContext:D,propsOptions:N}},B){let n;return!!l[B]||c!==Io&&lo(c,B)||S1(p,B)||(n=N[0])&&lo(n,B)||lo(E,B)||lo(P0,B)||lo(D.config.globalProperties,B)},defineProperty(c,p,l){return l.get!=null?c._.accessCache[p]=0:lo(l,"value")&&this.set(c,p,l.value,null),Reflect.defineProperty(c,p,l)}};function wM(c){return gs(c)?c.reduce((p,l)=>(p[l]=null,p),{}):c}let Yb=!0;function cP(c){const p=zw(c),l=c.proxy,E=c.ctx;Yb=!1,p.beforeCreate&&TM(p.beforeCreate,c,"bc");const{data:D,computed:N,methods:B,watch:n,provide:X,inject:$,created:ne,beforeMount:ve,mounted:ze,beforeUpdate:ke,updated:yt,activated:it,deactivated:xt,beforeDestroy:Ze,beforeUnmount:st,destroyed:ti,unmounted:mt,render:pt,renderTracked:Tt,renderTriggered:Fe,errorCaptured:et,serverPrefetch:Xe,expose:qe,inheritAttrs:gt,components:lt,directives:vt,filters:Jt}=p;if($&&uP($,E,null),B)for(const xe in B){const De=B[xe];Cs(De)&&(E[xe]=De.bind(l))}if(D){const xe=D.call(l,l);Wo(xe)&&(c.data=Iw(xe))}if(Yb=!0,N)for(const xe in N){const De=N[xe],Ce=Cs(De)?De.bind(l,l):Cs(De.get)?De.get.bind(l,l):Wh,Gt=!Cs(De)&&Cs(De.set)?De.set.bind(l):Wh,Ft=KP({get:Ce,set:Gt});Object.defineProperty(E,xe,{enumerable:!0,configurable:!0,get:()=>Ft.value,set:bt=>Ft.value=bt})}if(n)for(const xe in n)NA(n[xe],E,l,xe);if(X){const xe=Cs(X)?X.call(l):X;Reflect.ownKeys(xe).forEach(De=>{gP(De,xe[De])})}ne&&TM(ne,c,"c");function we(xe,De){gs(De)?De.forEach(Ce=>xe(Ce.bind(l))):De&&xe(De.bind(l))}if(we(JR,ve),we(QR,ze),we(eP,ke),we(tP,yt),we(XR,it),we(YR,xt),we(oP,et),we(sP,Tt),we(rP,Fe),we(iP,st),we(BA,mt),we(nP,Xe),gs(qe))if(qe.length){const xe=c.exposed||(c.exposed={});qe.forEach(De=>{Object.defineProperty(xe,De,{get:()=>l[De],set:Ce=>l[De]=Ce})})}else c.exposed||(c.exposed={});pt&&c.render===Wh&&(c.render=pt),gt!=null&&(c.inheritAttrs=gt),lt&&(c.components=lt),vt&&(c.directives=vt),Xe&&zA(c)}function uP(c,p,l=Wh){gs(c)&&(c=Kb(c));for(const E in c){const D=c[E];let N;Wo(D)?"default"in D?N=Cv(D.from||E,D.default,!0):N=Cv(D.from||E):N=Cv(D),Ul(N)?Object.defineProperty(p,E,{enumerable:!0,configurable:!0,get:()=>N.value,set:B=>N.value=B}):p[E]=N}}function TM(c,p,l){Jh(gs(c)?c.map(E=>E.bind(p.proxy)):c.bind(p.proxy),p,l)}function NA(c,p,l,E){let D=E.includes(".")?QA(l,E):()=>l[E];if(ga(c)){const N=p[c];Cs(N)&&A1(D,N)}else if(Cs(c))A1(D,c.bind(l));else if(Wo(c))if(gs(c))c.forEach(N=>NA(N,p,l,E));else{const N=Cs(c.handler)?c.handler.bind(l):p[c.handler];Cs(N)&&A1(D,N,c)}}function zw(c){const p=c.type,{mixins:l,extends:E}=p,{mixins:D,optionsCache:N,config:{optionMergeStrategies:B}}=c.appContext,n=N.get(p);let X;return n?X=n:!D.length&&!l&&!E?X=p:(X={},D.length&&D.forEach($=>Gv(X,$,B,!0)),Gv(X,p,B)),Wo(p)&&N.set(p,X),X}function Gv(c,p,l,E=!1){const{mixins:D,extends:N}=p;N&&Gv(c,N,l,!0),D&&D.forEach(B=>Gv(c,B,l,!0));for(const B in p)if(!(E&&B==="expose")){const n=hP[B]||l&&l[B];c[B]=n?n(c[B],p[B]):p[B]}return c}const hP={data:MM,props:SM,emits:SM,methods:M0,computed:M0,beforeCreate:kl,created:kl,beforeMount:kl,mounted:kl,beforeUpdate:kl,updated:kl,beforeDestroy:kl,beforeUnmount:kl,destroyed:kl,unmounted:kl,activated:kl,deactivated:kl,errorCaptured:kl,serverPrefetch:kl,components:M0,directives:M0,watch:pP,provide:MM,inject:dP};function MM(c,p){return p?c?function(){return il(Cs(c)?c.call(this,this):c,Cs(p)?p.call(this,this):p)}:p:c}function dP(c,p){return M0(Kb(c),Kb(p))}function Kb(c){if(gs(c)){const p={};for(let l=0;l<c.length;l++)p[c[l]]=c[l];return p}return c}function kl(c,p){return c?[...new Set([].concat(c,p))]:p}function M0(c,p){return c?il(Object.create(null),c,p):p}function SM(c,p){return c?gs(c)&&gs(p)?[...new Set([...c,...p])]:il(Object.create(null),wM(c),wM(p??{})):p}function pP(c,p){if(!c)return p;if(!p)return c;const l=il(Object.create(null),c);for(const E in p)l[E]=kl(c[E],p[E]);return l}function UA(){return{app:null,config:{isNativeTag:iR,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let fP=0;function mP(c,p){return function(E,D=null){Cs(E)||(E=il({},E)),D!=null&&!Wo(D)&&(D=null);const N=UA(),B=new WeakSet,n=[];let X=!1;const $=N.app={_uid:fP++,_component:E,_props:D,_container:null,_context:N,_instance:null,version:JP,get config(){return N.config},set config(ne){},use(ne,...ve){return B.has(ne)||(ne&&Cs(ne.install)?(B.add(ne),ne.install($,...ve)):Cs(ne)&&(B.add(ne),ne($,...ve))),$},mixin(ne){return N.mixins.includes(ne)||N.mixins.push(ne),$},component(ne,ve){return ve?(N.components[ne]=ve,$):N.components[ne]},directive(ne,ve){return ve?(N.directives[ne]=ve,$):N.directives[ne]},mount(ne,ve,ze){if(!X){const ke=$._ceVNode||qh(E,D);return ke.appContext=N,ze===!0?ze="svg":ze===!1&&(ze=void 0),ve&&p?p(ke,ne):c(ke,ne,ze),X=!0,$._container=ne,ne.__vue_app__=$,Bw(ke.component)}},onUnmount(ne){n.push(ne)},unmount(){X&&(Jh(n,$._instance,16),c(null,$._container),delete $._container.__vue_app__)},provide(ne,ve){return N.provides[ne]=ve,$},runWithContext(ne){const ve=Wg;Wg=$;try{return ne()}finally{Wg=ve}}};return $}}let Wg=null;function gP(c,p){if(Bl){let l=Bl.provides;const E=Bl.parent&&Bl.parent.provides;E===l&&(l=Bl.provides=Object.create(E)),l[c]=p}}function Cv(c,p,l=!1){const E=Bl||jh;if(E||Wg){const D=Wg?Wg._context.provides:E?E.parent==null?E.vnode.appContext&&E.vnode.appContext.provides:E.parent.provides:void 0;if(D&&c in D)return D[c];if(arguments.length>1)return l&&Cs(p)?p.call(E&&E.proxy):p}}const VA={},GA=()=>Object.create(VA),HA=c=>Object.getPrototypeOf(c)===VA;function _P(c,p,l,E=!1){const D={},N=GA();c.propsDefaults=Object.create(null),jA(c,p,D,N);for(const B in c.propsOptions[0])B in D||(D[B]=void 0);l?c.props=E?D:OR(D):c.type.props?c.props=D:c.props=N,c.attrs=N}function yP(c,p,l,E){const{props:D,attrs:N,vnode:{patchFlag:B}}=c,n=mo(D),[X]=c.propsOptions;let $=!1;if((E||B>0)&&!(B&16)){if(B&8){const ne=c.vnode.dynamicProps;for(let ve=0;ve<ne.length;ve++){let ze=ne[ve];if(ax(c.emitsOptions,ze))continue;const ke=p[ze];if(X)if(lo(N,ze))ke!==N[ze]&&(N[ze]=ke,$=!0);else{const yt=Jp(ze);D[yt]=Jb(X,n,yt,ke,c,!1)}else ke!==N[ze]&&(N[ze]=ke,$=!0)}}}else{jA(c,p,D,N)&&($=!0);let ne;for(const ve in n)(!p||!lo(p,ve)&&((ne=Pm(ve))===ve||!lo(p,ne)))&&(X?l&&(l[ve]!==void 0||l[ne]!==void 0)&&(D[ve]=Jb(X,n,ve,void 0,c,!0)):delete D[ve]);if(N!==n)for(const ve in N)(!p||!lo(p,ve))&&(delete N[ve],$=!0)}$&&Nd(c.attrs,"set","")}function jA(c,p,l,E){const[D,N]=c.propsOptions;let B=!1,n;if(p)for(let X in p){if(C0(X))continue;const $=p[X];let ne;D&&lo(D,ne=Jp(X))?!N||!N.includes(ne)?l[ne]=$:(n||(n={}))[ne]=$:ax(c.emitsOptions,X)||(!(X in E)||$!==E[X])&&(E[X]=$,B=!0)}if(N){const X=mo(l),$=n||Io;for(let ne=0;ne<N.length;ne++){const ve=N[ne];l[ve]=Jb(D,X,ve,$[ve],c,!lo($,ve))}}return B}function Jb(c,p,l,E,D,N){const B=c[l];if(B!=null){const n=lo(B,"default");if(n&&E===void 0){const X=B.default;if(B.type!==Function&&!B.skipFactory&&Cs(X)){const{propsDefaults:$}=D;if(l in $)E=$[l];else{const ne=ty(D);E=$[l]=X.call(null,p),ne()}}else E=X;D.ce&&D.ce._setProp(l,E)}B[0]&&(N&&!n?E=!1:B[1]&&(E===""||E===Pm(l))&&(E=!0))}return E}const vP=new WeakMap;function WA(c,p,l=!1){const E=l?vP:p.propsCache,D=E.get(c);if(D)return D;const N=c.props,B={},n=[];let X=!1;if(!Cs(c)){const ne=ve=>{X=!0;const[ze,ke]=WA(ve,p,!0);il(B,ze),ke&&n.push(...ke)};!l&&p.mixins.length&&p.mixins.forEach(ne),c.extends&&ne(c.extends),c.mixins&&c.mixins.forEach(ne)}if(!N&&!X)return Wo(c)&&E.set(c,Vg),Vg;if(gs(N))for(let ne=0;ne<N.length;ne++){const ve=Jp(N[ne]);EM(ve)&&(B[ve]=Io)}else if(N)for(const ne in N){const ve=Jp(ne);if(EM(ve)){const ze=N[ne],ke=B[ve]=gs(ze)||Cs(ze)?{type:ze}:il({},ze),yt=ke.type;let it=!1,xt=!0;if(gs(yt))for(let Ze=0;Ze<yt.length;++Ze){const st=yt[Ze],ti=Cs(st)&&st.name;if(ti==="Boolean"){it=!0;break}else ti==="String"&&(xt=!1)}else it=Cs(yt)&&yt.name==="Boolean";ke[0]=it,ke[1]=xt,(it||lo(ke,"default"))&&n.push(ve)}}const $=[B,n];return Wo(c)&&E.set(c,$),$}function EM(c){return c[0]!=="$"&&!C0(c)}const qA=c=>c[0]==="_"||c==="$stable",kw=c=>gs(c)?c.map(Gh):[Gh(c)],xP=(c,p,l)=>{if(p._n)return p;const E=qR((...D)=>kw(p(...D)),l);return E._c=!1,E},$A=(c,p,l)=>{const E=c._ctx;for(const D in c){if(qA(D))continue;const N=c[D];if(Cs(N))p[D]=xP(D,N,E);else if(N!=null){const B=kw(N);p[D]=()=>B}}},ZA=(c,p)=>{const l=kw(p);c.slots.default=()=>l},XA=(c,p,l)=>{for(const E in p)(l||E!=="_")&&(c[E]=p[E])},bP=(c,p,l)=>{const E=c.slots=GA();if(c.vnode.shapeFlag&32){const D=p._;D?(XA(E,p,l),l&&cA(E,"_",D,!0)):$A(p,E)}else p&&ZA(c,p)},wP=(c,p,l)=>{const{vnode:E,slots:D}=c;let N=!0,B=Io;if(E.shapeFlag&32){const n=p._;n?l&&n===1?N=!1:XA(D,p,l):(N=!p.$stable,$A(p,D)),B=p}else p&&(ZA(c,p),B={default:1});if(N)for(const n in D)!qA(n)&&B[n]==null&&delete D[n]},xc=kP;function TP(c){return MP(c)}function MP(c,p){const l=nx();l.__VUE__=!0;const{insert:E,remove:D,patchProp:N,createElement:B,createText:n,createComment:X,setText:$,setElementText:ne,parentNode:ve,nextSibling:ze,setScopeId:ke=Wh,insertStaticContent:yt}=c,it=(At,Ye,kt,Le=null,Ie=null,Ue=null,We=void 0,rt=null,ut=!!Ye.dynamicChildren)=>{if(At===Ye)return;At&&!x0(At,Ye)&&(Le=Hi(At),bt(At,Ie,Ue,!0),At=null),Ye.patchFlag===-2&&(ut=!1,Ye.dynamicChildren=null);const{type:ht,ref:Lt,shapeFlag:It}=Ye;switch(ht){case lx:xt(At,Ye,kt,Le);break;case Em:Ze(At,Ye,kt,Le);break;case Lv:At==null&&st(Ye,kt,Le,We);break;case Tc:lt(At,Ye,kt,Le,Ie,Ue,We,rt,ut);break;default:It&1?pt(At,Ye,kt,Le,Ie,Ue,We,rt,ut):It&6?vt(At,Ye,kt,Le,Ie,Ue,We,rt,ut):(It&64||It&128)&&ht.process(At,Ye,kt,Le,Ie,Ue,We,rt,ut,ot)}Lt!=null&&Ie&&Vv(Lt,At&&At.ref,Ue,Ye||At,!Ye)},xt=(At,Ye,kt,Le)=>{if(At==null)E(Ye.el=n(Ye.children),kt,Le);else{const Ie=Ye.el=At.el;Ye.children!==At.children&&$(Ie,Ye.children)}},Ze=(At,Ye,kt,Le)=>{At==null?E(Ye.el=X(Ye.children||""),kt,Le):Ye.el=At.el},st=(At,Ye,kt,Le)=>{[At.el,At.anchor]=yt(At.children,Ye,kt,Le,At.el,At.anchor)},ti=({el:At,anchor:Ye},kt,Le)=>{let Ie;for(;At&&At!==Ye;)Ie=ze(At),E(At,kt,Le),At=Ie;E(Ye,kt,Le)},mt=({el:At,anchor:Ye})=>{let kt;for(;At&&At!==Ye;)kt=ze(At),D(At),At=kt;D(Ye)},pt=(At,Ye,kt,Le,Ie,Ue,We,rt,ut)=>{Ye.type==="svg"?We="svg":Ye.type==="math"&&(We="mathml"),At==null?Tt(Ye,kt,Le,Ie,Ue,We,rt,ut):Xe(At,Ye,Ie,Ue,We,rt,ut)},Tt=(At,Ye,kt,Le,Ie,Ue,We,rt)=>{let ut,ht;const{props:Lt,shapeFlag:It,transition:ui,dirs:xi}=At;if(ut=At.el=B(At.type,Ue,Lt&&Lt.is,Lt),It&8?ne(ut,At.children):It&16&&et(At.children,ut,null,Le,Ie,E1(At,Ue),We,rt),xi&&fm(At,null,Le,"created"),Fe(ut,At,At.scopeId,We,Le),Lt){for(const cn in Lt)cn!=="value"&&!C0(cn)&&N(ut,cn,null,Lt[cn],Ue,Le);"value"in Lt&&N(ut,"value",null,Lt.value,Ue),(ht=Lt.onVnodeBeforeMount)&&Nh(ht,Le,At)}xi&&fm(At,null,Le,"beforeMount");const an=SP(Ie,ui);an&&ui.beforeEnter(ut),E(ut,Ye,kt),((ht=Lt&&Lt.onVnodeMounted)||an||xi)&&xc(()=>{ht&&Nh(ht,Le,At),an&&ui.enter(ut),xi&&fm(At,null,Le,"mounted")},Ie)},Fe=(At,Ye,kt,Le,Ie)=>{if(kt&&ke(At,kt),Le)for(let Ue=0;Ue<Le.length;Ue++)ke(At,Le[Ue]);if(Ie){let Ue=Ie.subTree;if(Ye===Ue||t3(Ue.type)&&(Ue.ssContent===Ye||Ue.ssFallback===Ye)){const We=Ie.vnode;Fe(At,We,We.scopeId,We.slotScopeIds,Ie.parent)}}},et=(At,Ye,kt,Le,Ie,Ue,We,rt,ut=0)=>{for(let ht=ut;ht<At.length;ht++){const Lt=At[ht]=rt?Wp(At[ht]):Gh(At[ht]);it(null,Lt,Ye,kt,Le,Ie,Ue,We,rt)}},Xe=(At,Ye,kt,Le,Ie,Ue,We)=>{const rt=Ye.el=At.el;let{patchFlag:ut,dynamicChildren:ht,dirs:Lt}=Ye;ut|=At.patchFlag&16;const It=At.props||Io,ui=Ye.props||Io;let xi;if(kt&&mm(kt,!1),(xi=ui.onVnodeBeforeUpdate)&&Nh(xi,kt,Ye,At),Lt&&fm(Ye,At,kt,"beforeUpdate"),kt&&mm(kt,!0),(It.innerHTML&&ui.innerHTML==null||It.textContent&&ui.textContent==null)&&ne(rt,""),ht?qe(At.dynamicChildren,ht,rt,kt,Le,E1(Ye,Ie),Ue):We||De(At,Ye,rt,null,kt,Le,E1(Ye,Ie),Ue,!1),ut>0){if(ut&16)gt(rt,It,ui,kt,Ie);else if(ut&2&&It.class!==ui.class&&N(rt,"class",null,ui.class,Ie),ut&4&&N(rt,"style",It.style,ui.style,Ie),ut&8){const an=Ye.dynamicProps;for(let cn=0;cn<an.length;cn++){const _n=an[cn],Fn=It[_n],Mn=ui[_n];(Mn!==Fn||_n==="value")&&N(rt,_n,Fn,Mn,Ie,kt)}}ut&1&&At.children!==Ye.children&&ne(rt,Ye.children)}else!We&&ht==null&&gt(rt,It,ui,kt,Ie);((xi=ui.onVnodeUpdated)||Lt)&&xc(()=>{xi&&Nh(xi,kt,Ye,At),Lt&&fm(Ye,At,kt,"updated")},Le)},qe=(At,Ye,kt,Le,Ie,Ue,We)=>{for(let rt=0;rt<Ye.length;rt++){const ut=At[rt],ht=Ye[rt],Lt=ut.el&&(ut.type===Tc||!x0(ut,ht)||ut.shapeFlag&70)?ve(ut.el):kt;it(ut,ht,Lt,null,Le,Ie,Ue,We,!0)}},gt=(At,Ye,kt,Le,Ie)=>{if(Ye!==kt){if(Ye!==Io)for(const Ue in Ye)!C0(Ue)&&!(Ue in kt)&&N(At,Ue,Ye[Ue],null,Ie,Le);for(const Ue in kt){if(C0(Ue))continue;const We=kt[Ue],rt=Ye[Ue];We!==rt&&Ue!=="value"&&N(At,Ue,rt,We,Ie,Le)}"value"in kt&&N(At,"value",Ye.value,kt.value,Ie)}},lt=(At,Ye,kt,Le,Ie,Ue,We,rt,ut)=>{const ht=Ye.el=At?At.el:n(""),Lt=Ye.anchor=At?At.anchor:n("");let{patchFlag:It,dynamicChildren:ui,slotScopeIds:xi}=Ye;xi&&(rt=rt?rt.concat(xi):xi),At==null?(E(ht,kt,Le),E(Lt,kt,Le),et(Ye.children||[],kt,Lt,Ie,Ue,We,rt,ut)):It>0&&It&64&&ui&&At.dynamicChildren?(qe(At.dynamicChildren,ui,kt,Ie,Ue,We,rt),(Ye.key!=null||Ie&&Ye===Ie.subTree)&&YA(At,Ye,!0)):De(At,Ye,kt,Lt,Ie,Ue,We,rt,ut)},vt=(At,Ye,kt,Le,Ie,Ue,We,rt,ut)=>{Ye.slotScopeIds=rt,At==null?Ye.shapeFlag&512?Ie.ctx.activate(Ye,kt,Le,We,ut):Jt(Ye,kt,Le,Ie,Ue,We,ut):le(At,Ye,ut)},Jt=(At,Ye,kt,Le,Ie,Ue,We)=>{const rt=At.component=WP(At,Le,Ie);if(kA(At)&&(rt.ctx.renderer=ot),qP(rt,!1,We),rt.asyncDep){if(Ie&&Ie.registerDep(rt,we,We),!At.el){const ut=rt.subTree=qh(Em);Ze(null,ut,Ye,kt)}}else we(rt,At,Ye,kt,Ie,Ue,We)},le=(At,Ye,kt)=>{const Le=Ye.component=At.component;if(OP(At,Ye,kt))if(Le.asyncDep&&!Le.asyncResolved){xe(Le,Ye,kt);return}else Le.next=Ye,Le.update();else Ye.el=At.el,Le.vnode=Ye},we=(At,Ye,kt,Le,Ie,Ue,We)=>{const rt=()=>{if(At.isMounted){let{next:It,bu:ui,u:xi,parent:an,vnode:cn}=At;{const Lr=KA(At);if(Lr){It&&(It.el=cn.el,xe(At,It,We)),Lr.asyncDep.then(()=>{At.isUnmounted||rt()});return}}let _n=It,Fn;mm(At,!1),It?(It.el=cn.el,xe(At,It,We)):It=cn,ui&&x1(ui),(Fn=It.props&&It.props.onVnodeBeforeUpdate)&&Nh(Fn,an,It,cn),mm(At,!0);const Mn=C1(At),jn=At.subTree;At.subTree=Mn,it(jn,Mn,ve(jn.el),Hi(jn),At,Ie,Ue),It.el=Mn.el,_n===null&&zP(At,Mn.el),xi&&xc(xi,Ie),(Fn=It.props&&It.props.onVnodeUpdated)&&xc(()=>Nh(Fn,an,It,cn),Ie)}else{let It;const{el:ui,props:xi}=Ye,{bm:an,m:cn,parent:_n,root:Fn,type:Mn}=At,jn=R0(Ye);if(mm(At,!1),an&&x1(an),!jn&&(It=xi&&xi.onVnodeBeforeMount)&&Nh(It,_n,Ye),mm(At,!0),ui&&pr){const Lr=()=>{At.subTree=C1(At),pr(ui,At.subTree,At,Ie,null)};jn&&Mn.__asyncHydrate?Mn.__asyncHydrate(ui,At,Lr):Lr()}else{Fn.ce&&Fn.ce._injectChildStyle(Mn);const Lr=At.subTree=C1(At);it(null,Lr,kt,Le,At,Ie,Ue),Ye.el=Lr.el}if(cn&&xc(cn,Ie),!jn&&(It=xi&&xi.onVnodeMounted)){const Lr=Ye;xc(()=>Nh(It,_n,Lr),Ie)}(Ye.shapeFlag&256||_n&&R0(_n.vnode)&&_n.vnode.shapeFlag&256)&&At.a&&xc(At.a,Ie),At.isMounted=!0,Ye=kt=Le=null}};At.scope.on();const ut=At.effect=new pA(rt);At.scope.off();const ht=At.update=ut.run.bind(ut),Lt=At.job=ut.runIfDirty.bind(ut);Lt.i=At,Lt.id=At.uid,ut.scheduler=()=>Dw(Lt),mm(At,!0),ht()},xe=(At,Ye,kt)=>{Ye.component=At;const Le=At.vnode.props;At.vnode=Ye,At.next=null,yP(At,Ye.props,Le,kt),wP(At,Ye.children,kt),rf(),bM(At),sf()},De=(At,Ye,kt,Le,Ie,Ue,We,rt,ut=!1)=>{const ht=At&&At.children,Lt=At?At.shapeFlag:0,It=Ye.children,{patchFlag:ui,shapeFlag:xi}=Ye;if(ui>0){if(ui&128){Gt(ht,It,kt,Le,Ie,Ue,We,rt,ut);return}else if(ui&256){Ce(ht,It,kt,Le,Ie,Ue,We,rt,ut);return}}xi&8?(Lt&16&&zi(ht,Ie,Ue),It!==ht&&ne(kt,It)):Lt&16?xi&16?Gt(ht,It,kt,Le,Ie,Ue,We,rt,ut):zi(ht,Ie,Ue,!0):(Lt&8&&ne(kt,""),xi&16&&et(It,kt,Le,Ie,Ue,We,rt,ut))},Ce=(At,Ye,kt,Le,Ie,Ue,We,rt,ut)=>{At=At||Vg,Ye=Ye||Vg;const ht=At.length,Lt=Ye.length,It=Math.min(ht,Lt);let ui;for(ui=0;ui<It;ui++){const xi=Ye[ui]=ut?Wp(Ye[ui]):Gh(Ye[ui]);it(At[ui],xi,kt,null,Ie,Ue,We,rt,ut)}ht>Lt?zi(At,Ie,Ue,!0,!1,It):et(Ye,kt,Le,Ie,Ue,We,rt,ut,It)},Gt=(At,Ye,kt,Le,Ie,Ue,We,rt,ut)=>{let ht=0;const Lt=Ye.length;let It=At.length-1,ui=Lt-1;for(;ht<=It&&ht<=ui;){const xi=At[ht],an=Ye[ht]=ut?Wp(Ye[ht]):Gh(Ye[ht]);if(x0(xi,an))it(xi,an,kt,null,Ie,Ue,We,rt,ut);else break;ht++}for(;ht<=It&&ht<=ui;){const xi=At[It],an=Ye[ui]=ut?Wp(Ye[ui]):Gh(Ye[ui]);if(x0(xi,an))it(xi,an,kt,null,Ie,Ue,We,rt,ut);else break;It--,ui--}if(ht>It){if(ht<=ui){const xi=ui+1,an=xi<Lt?Ye[xi].el:Le;for(;ht<=ui;)it(null,Ye[ht]=ut?Wp(Ye[ht]):Gh(Ye[ht]),kt,an,Ie,Ue,We,rt,ut),ht++}}else if(ht>ui)for(;ht<=It;)bt(At[ht],Ie,Ue,!0),ht++;else{const xi=ht,an=ht,cn=new Map;for(ht=an;ht<=ui;ht++){const $r=Ye[ht]=ut?Wp(Ye[ht]):Gh(Ye[ht]);$r.key!=null&&cn.set($r.key,ht)}let _n,Fn=0;const Mn=ui-an+1;let jn=!1,Lr=0;const Tr=new Array(Mn);for(ht=0;ht<Mn;ht++)Tr[ht]=0;for(ht=xi;ht<=It;ht++){const $r=At[ht];if(Fn>=Mn){bt($r,Ie,Ue,!0);continue}let en;if($r.key!=null)en=cn.get($r.key);else for(_n=an;_n<=ui;_n++)if(Tr[_n-an]===0&&x0($r,Ye[_n])){en=_n;break}en===void 0?bt($r,Ie,Ue,!0):(Tr[en-an]=ht+1,en>=Lr?Lr=en:jn=!0,it($r,Ye[en],kt,null,Ie,Ue,We,rt,ut),Fn++)}const to=jn?EP(Tr):Vg;for(_n=to.length-1,ht=Mn-1;ht>=0;ht--){const $r=an+ht,en=Ye[$r],Wn=$r+1<Lt?Ye[$r+1].el:Le;Tr[ht]===0?it(null,en,kt,Wn,Ie,Ue,We,rt,ut):jn&&(_n<0||ht!==to[_n]?Ft(en,kt,Wn,2):_n--)}}},Ft=(At,Ye,kt,Le,Ie=null)=>{const{el:Ue,type:We,transition:rt,children:ut,shapeFlag:ht}=At;if(ht&6){Ft(At.component.subTree,Ye,kt,Le);return}if(ht&128){At.suspense.move(Ye,kt,Le);return}if(ht&64){We.move(At,Ye,kt,ot);return}if(We===Tc){E(Ue,Ye,kt);for(let It=0;It<ut.length;It++)Ft(ut[It],Ye,kt,Le);E(At.anchor,Ye,kt);return}if(We===Lv){ti(At,Ye,kt);return}if(Le!==2&&ht&1&&rt)if(Le===0)rt.beforeEnter(Ue),E(Ue,Ye,kt),xc(()=>rt.enter(Ue),Ie);else{const{leave:It,delayLeave:ui,afterLeave:xi}=rt,an=()=>E(Ue,Ye,kt),cn=()=>{It(Ue,()=>{an(),xi&&xi()})};ui?ui(Ue,an,cn):cn()}else E(Ue,Ye,kt)},bt=(At,Ye,kt,Le=!1,Ie=!1)=>{const{type:Ue,props:We,ref:rt,children:ut,dynamicChildren:ht,shapeFlag:Lt,patchFlag:It,dirs:ui,cacheIndex:xi}=At;if(It===-2&&(Ie=!1),rt!=null&&Vv(rt,null,kt,At,!0),xi!=null&&(Ye.renderCache[xi]=void 0),Lt&256){Ye.ctx.deactivate(At);return}const an=Lt&1&&ui,cn=!R0(At);let _n;if(cn&&(_n=We&&We.onVnodeBeforeUnmount)&&Nh(_n,Ye,At),Lt&6)ni(At.component,kt,Le);else{if(Lt&128){At.suspense.unmount(kt,Le);return}an&&fm(At,null,Ye,"beforeUnmount"),Lt&64?At.type.remove(At,Ye,kt,ot,Le):ht&&!ht.hasOnce&&(Ue!==Tc||It>0&&It&64)?zi(ht,Ye,kt,!1,!0):(Ue===Tc&&It&384||!Ie&&Lt&16)&&zi(ut,Ye,kt),Le&&Vt(At)}(cn&&(_n=We&&We.onVnodeUnmounted)||an)&&xc(()=>{_n&&Nh(_n,Ye,At),an&&fm(At,null,Ye,"unmounted")},kt)},Vt=At=>{const{type:Ye,el:kt,anchor:Le,transition:Ie}=At;if(Ye===Tc){Ht(kt,Le);return}if(Ye===Lv){mt(At);return}const Ue=()=>{D(kt),Ie&&!Ie.persisted&&Ie.afterLeave&&Ie.afterLeave()};if(At.shapeFlag&1&&Ie&&!Ie.persisted){const{leave:We,delayLeave:rt}=Ie,ut=()=>We(kt,Ue);rt?rt(At.el,Ue,ut):ut()}else Ue()},Ht=(At,Ye)=>{let kt;for(;At!==Ye;)kt=ze(At),D(At),At=kt;D(Ye)},ni=(At,Ye,kt)=>{const{bum:Le,scope:Ie,job:Ue,subTree:We,um:rt,m:ut,a:ht}=At;AM(ut),AM(ht),Le&&x1(Le),Ie.stop(),Ue&&(Ue.flags|=8,bt(We,At,Ye,kt)),rt&&xc(rt,Ye),xc(()=>{At.isUnmounted=!0},Ye),Ye&&Ye.pendingBranch&&!Ye.isUnmounted&&At.asyncDep&&!At.asyncResolved&&At.suspenseId===Ye.pendingId&&(Ye.deps--,Ye.deps===0&&Ye.resolve())},zi=(At,Ye,kt,Le=!1,Ie=!1,Ue=0)=>{for(let We=Ue;We<At.length;We++)bt(At[We],Ye,kt,Le,Ie)},Hi=At=>{if(At.shapeFlag&6)return Hi(At.component.subTree);if(At.shapeFlag&128)return At.suspense.next();const Ye=ze(At.anchor||At.el),kt=Ye&&Ye[$R];return kt?ze(kt):Ye};let on=!1;const mn=(At,Ye,kt)=>{At==null?Ye._vnode&&bt(Ye._vnode,null,null,!0):it(Ye._vnode||null,At,Ye,null,null,null,kt),Ye._vnode=At,on||(on=!0,bM(),PA(),on=!1)},ot={p:it,um:bt,m:Ft,r:Vt,mt:Jt,mc:et,pc:De,pbc:qe,n:Hi,o:c};let Yn,pr;return{render:mn,hydrate:Yn,createApp:mP(mn,Yn)}}function E1({type:c,props:p},l){return l==="svg"&&c==="foreignObject"||l==="mathml"&&c==="annotation-xml"&&p&&p.encoding&&p.encoding.includes("html")?void 0:l}function mm({effect:c,job:p},l){l?(c.flags|=32,p.flags|=4):(c.flags&=-33,p.flags&=-5)}function SP(c,p){return(!c||c&&!c.pendingBranch)&&p&&!p.persisted}function YA(c,p,l=!1){const E=c.children,D=p.children;if(gs(E)&&gs(D))for(let N=0;N<E.length;N++){const B=E[N];let n=D[N];n.shapeFlag&1&&!n.dynamicChildren&&((n.patchFlag<=0||n.patchFlag===32)&&(n=D[N]=Wp(D[N]),n.el=B.el),!l&&n.patchFlag!==-2&&YA(B,n)),n.type===lx&&(n.el=B.el)}}function EP(c){const p=c.slice(),l=[0];let E,D,N,B,n;const X=c.length;for(E=0;E<X;E++){const $=c[E];if($!==0){if(D=l[l.length-1],c[D]<$){p[E]=D,l.push(E);continue}for(N=0,B=l.length-1;N<B;)n=N+B>>1,c[l[n]]<$?N=n+1:B=n;$<c[l[N]]&&(N>0&&(p[E]=l[N-1]),l[N]=E)}}for(N=l.length,B=l[N-1];N-- >0;)l[N]=B,B=p[B];return l}function KA(c){const p=c.subTree.component;if(p)return p.asyncDep&&!p.asyncResolved?p:KA(p)}function AM(c){if(c)for(let p=0;p<c.length;p++)c[p].flags|=8}const AP=Symbol.for("v-scx"),CP=()=>Cv(AP);function A1(c,p,l){return JA(c,p,l)}function JA(c,p,l=Io){const{immediate:E,deep:D,flush:N,once:B}=l,n=il({},l),X=p&&E||!p&&N!=="post";let $;if(H0){if(N==="sync"){const ke=CP();$=ke.__watcherHandles||(ke.__watcherHandles=[])}else if(!X){const ke=()=>{};return ke.stop=Wh,ke.resume=Wh,ke.pause=Wh,ke}}const ne=Bl;n.call=(ke,yt,it)=>Jh(ke,ne,yt,it);let ve=!1;N==="post"?n.scheduler=ke=>{xc(ke,ne&&ne.suspense)}:N!=="sync"&&(ve=!0,n.scheduler=(ke,yt)=>{yt?ke():Dw(ke)}),n.augmentJob=ke=>{p&&(ke.flags|=4),ve&&(ke.flags|=2,ne&&(ke.id=ne.uid,ke.i=ne))};const ze=VR(c,p,n);return H0&&($?$.push(ze):X&&ze()),ze}function LP(c,p,l){const E=this.proxy,D=ga(c)?c.includes(".")?QA(E,c):()=>E[c]:c.bind(E,E);let N;Cs(p)?N=p:(N=p.handler,l=p);const B=ty(this),n=JA(D,N.bind(E),l);return B(),n}function QA(c,p){const l=p.split(".");return()=>{let E=c;for(let D=0;D<l.length&&E;D++)E=E[l[D]];return E}}const IP=(c,p)=>p==="modelValue"||p==="model-value"?c.modelModifiers:c[`${p}Modifiers`]||c[`${Jp(p)}Modifiers`]||c[`${Pm(p)}Modifiers`];function RP(c,p,...l){if(c.isUnmounted)return;const E=c.vnode.props||Io;let D=l;const N=p.startsWith("update:"),B=N&&IP(E,p.slice(7));B&&(B.trim&&(D=l.map(ne=>ga(ne)?ne.trim():ne)),B.number&&(D=l.map(aR)));let n,X=E[n=v1(p)]||E[n=v1(Jp(p))];!X&&N&&(X=E[n=v1(Pm(p))]),X&&Jh(X,c,6,D);const $=E[n+"Once"];if($){if(!c.emitted)c.emitted={};else if(c.emitted[n])return;c.emitted[n]=!0,Jh($,c,6,D)}}function e3(c,p,l=!1){const E=p.emitsCache,D=E.get(c);if(D!==void 0)return D;const N=c.emits;let B={},n=!1;if(!Cs(c)){const X=$=>{const ne=e3($,p,!0);ne&&(n=!0,il(B,ne))};!l&&p.mixins.length&&p.mixins.forEach(X),c.extends&&X(c.extends),c.mixins&&c.mixins.forEach(X)}return!N&&!n?(Wo(c)&&E.set(c,null),null):(gs(N)?N.forEach(X=>B[X]=null):il(B,N),Wo(c)&&E.set(c,B),B)}function ax(c,p){return!c||!ex(p)?!1:(p=p.slice(2).replace(/Once$/,""),lo(c,p[0].toLowerCase()+p.slice(1))||lo(c,Pm(p))||lo(c,p))}function C1(c){const{type:p,vnode:l,proxy:E,withProxy:D,propsOptions:[N],slots:B,attrs:n,emit:X,render:$,renderCache:ne,props:ve,data:ze,setupState:ke,ctx:yt,inheritAttrs:it}=c,xt=Uv(c);let Ze,st;try{if(l.shapeFlag&4){const mt=D||E,pt=mt;Ze=Gh($.call(pt,mt,ne,ve,ke,ze,yt)),st=n}else{const mt=p;Ze=Gh(mt.length>1?mt(ve,{attrs:n,slots:B,emit:X}):mt(ve,null)),st=p.props?n:PP(n)}}catch(mt){D0.length=0,sx(mt,c,1),Ze=qh(Em)}let ti=Ze;if(st&&it!==!1){const mt=Object.keys(st),{shapeFlag:pt}=ti;mt.length&&pt&7&&(N&&mt.some(bw)&&(st=DP(st,N)),ti=Zg(ti,st,!1,!0))}return l.dirs&&(ti=Zg(ti,null,!1,!0),ti.dirs=ti.dirs?ti.dirs.concat(l.dirs):l.dirs),l.transition&&Ow(ti,l.transition),Ze=ti,Uv(xt),Ze}const PP=c=>{let p;for(const l in c)(l==="class"||l==="style"||ex(l))&&((p||(p={}))[l]=c[l]);return p},DP=(c,p)=>{const l={};for(const E in c)(!bw(E)||!(E.slice(9)in p))&&(l[E]=c[E]);return l};function OP(c,p,l){const{props:E,children:D,component:N}=c,{props:B,children:n,patchFlag:X}=p,$=N.emitsOptions;if(p.dirs||p.transition)return!0;if(l&&X>=0){if(X&1024)return!0;if(X&16)return E?CM(E,B,$):!!B;if(X&8){const ne=p.dynamicProps;for(let ve=0;ve<ne.length;ve++){const ze=ne[ve];if(B[ze]!==E[ze]&&!ax($,ze))return!0}}}else return(D||n)&&(!n||!n.$stable)?!0:E===B?!1:E?B?CM(E,B,$):!0:!!B;return!1}function CM(c,p,l){const E=Object.keys(p);if(E.length!==Object.keys(c).length)return!0;for(let D=0;D<E.length;D++){const N=E[D];if(p[N]!==c[N]&&!ax(l,N))return!0}return!1}function zP({vnode:c,parent:p},l){for(;p;){const E=p.subTree;if(E.suspense&&E.suspense.activeBranch===c&&(E.el=c.el),E===c)(c=p.vnode).el=l,p=p.parent;else break}}const t3=c=>c.__isSuspense;function kP(c,p){p&&p.pendingBranch?gs(c)?p.effects.push(...c):p.effects.push(c):WR(c)}const Tc=Symbol.for("v-fgt"),lx=Symbol.for("v-txt"),Em=Symbol.for("v-cmt"),Lv=Symbol.for("v-stc"),D0=[];let Mc=null;function el(c=!1){D0.push(Mc=c?null:[])}function FP(){D0.pop(),Mc=D0[D0.length-1]||null}let G0=1;function LM(c,p=!1){G0+=c,c<0&&Mc&&p&&(Mc.hasOnce=!0)}function i3(c){return c.dynamicChildren=G0>0?Mc||Vg:null,FP(),G0>0&&Mc&&Mc.push(c),c}function dl(c,p,l,E,D,N){return i3(jo(c,p,l,E,D,N,!0))}function BP(c,p,l,E,D){return i3(qh(c,p,l,E,D,!0))}function n3(c){return c?c.__v_isVNode===!0:!1}function x0(c,p){return c.type===p.type&&c.key===p.key}const r3=({key:c})=>c??null,Iv=({ref:c,ref_key:p,ref_for:l})=>(typeof c=="number"&&(c=""+c),c!=null?ga(c)||Ul(c)||Cs(c)?{i:jh,r:c,k:p,f:!!l}:c:null);function jo(c,p=null,l=null,E=0,D=null,N=c===Tc?0:1,B=!1,n=!1){const X={__v_isVNode:!0,__v_skip:!0,type:c,props:p,key:p&&r3(p),ref:p&&Iv(p),scopeId:OA,slotScopeIds:null,children:l,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:N,patchFlag:E,dynamicProps:D,dynamicChildren:null,appContext:null,ctx:jh};return n?(Fw(X,l),N&128&&c.normalize(X)):l&&(X.shapeFlag|=ga(l)?8:16),G0>0&&!B&&Mc&&(X.patchFlag>0||N&6)&&X.patchFlag!==32&&Mc.push(X),X}const qh=NP;function NP(c,p=null,l=null,E=0,D=null,N=!1){if((!c||c===aP)&&(c=Em),n3(c)){const n=Zg(c,p,!0);return l&&Fw(n,l),G0>0&&!N&&Mc&&(n.shapeFlag&6?Mc[Mc.indexOf(c)]=n:Mc.push(n)),n.patchFlag=-2,n}if(YP(c)&&(c=c.__vccOpts),p){p=UP(p);let{class:n,style:X}=p;n&&!ga(n)&&(p.class=Sw(n)),Wo(X)&&(Pw(X)&&!gs(X)&&(X=il({},X)),p.style=Mw(X))}const B=ga(c)?1:t3(c)?128:ZR(c)?64:Wo(c)?4:Cs(c)?2:0;return jo(c,p,l,E,D,B,N,!0)}function UP(c){return c?Pw(c)||HA(c)?il({},c):c:null}function Zg(c,p,l=!1,E=!1){const{props:D,ref:N,patchFlag:B,children:n,transition:X}=c,$=p?GP(D||{},p):D,ne={__v_isVNode:!0,__v_skip:!0,type:c.type,props:$,key:$&&r3($),ref:p&&p.ref?l&&N?gs(N)?N.concat(Iv(p)):[N,Iv(p)]:Iv(p):N,scopeId:c.scopeId,slotScopeIds:c.slotScopeIds,children:n,target:c.target,targetStart:c.targetStart,targetAnchor:c.targetAnchor,staticCount:c.staticCount,shapeFlag:c.shapeFlag,patchFlag:p&&c.type!==Tc?B===-1?16:B|16:B,dynamicProps:c.dynamicProps,dynamicChildren:c.dynamicChildren,appContext:c.appContext,dirs:c.dirs,transition:X,component:c.component,suspense:c.suspense,ssContent:c.ssContent&&Zg(c.ssContent),ssFallback:c.ssFallback&&Zg(c.ssFallback),el:c.el,anchor:c.anchor,ctx:c.ctx,ce:c.ce};return X&&E&&Ow(ne,X.clone(ne)),ne}function s3(c=" ",p=0){return qh(lx,null,c,p)}function VP(c,p){const l=qh(Lv,null,c);return l.staticCount=p,l}function L1(c="",p=!1){return p?(el(),BP(Em,null,c)):qh(Em,null,c)}function Gh(c){return c==null||typeof c=="boolean"?qh(Em):gs(c)?qh(Tc,null,c.slice()):n3(c)?Wp(c):qh(lx,null,String(c))}function Wp(c){return c.el===null&&c.patchFlag!==-1||c.memo?c:Zg(c)}function Fw(c,p){let l=0;const{shapeFlag:E}=c;if(p==null)p=null;else if(gs(p))l=16;else if(typeof p=="object")if(E&65){const D=p.default;D&&(D._c&&(D._d=!1),Fw(c,D()),D._c&&(D._d=!0));return}else{l=32;const D=p._;!D&&!HA(p)?p._ctx=jh:D===3&&jh&&(jh.slots._===1?p._=1:(p._=2,c.patchFlag|=1024))}else Cs(p)?(p={default:p,_ctx:jh},l=32):(p=String(p),E&64?(l=16,p=[s3(p)]):l=8);c.children=p,c.shapeFlag|=l}function GP(...c){const p={};for(let l=0;l<c.length;l++){const E=c[l];for(const D in E)if(D==="class")p.class!==E.class&&(p.class=Sw([p.class,E.class]));else if(D==="style")p.style=Mw([p.style,E.style]);else if(ex(D)){const N=p[D],B=E[D];B&&N!==B&&!(gs(N)&&N.includes(B))&&(p[D]=N?[].concat(N,B):B)}else D!==""&&(p[D]=E[D])}return p}function Nh(c,p,l,E=null){Jh(c,p,7,[l,E])}const HP=UA();let jP=0;function WP(c,p,l){const E=c.type,D=(p?p.appContext:c.appContext)||HP,N={uid:jP++,vnode:c,type:E,parent:p,appContext:D,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new fR(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:p?p.provides:Object.create(D.provides),ids:p?p.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:WA(E,D),emitsOptions:e3(E,D),emit:null,emitted:null,propsDefaults:Io,inheritAttrs:E.inheritAttrs,ctx:Io,data:Io,props:Io,attrs:Io,slots:Io,refs:Io,setupState:Io,setupContext:null,suspense:l,suspenseId:l?l.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return N.ctx={_:N},N.root=p?p.root:N,N.emit=RP.bind(null,N),c.ce&&c.ce(N),N}let Bl=null,Hv,Qb;{const c=nx(),p=(l,E)=>{let D;return(D=c[l])||(D=c[l]=[]),D.push(E),N=>{D.length>1?D.forEach(B=>B(N)):D[0](N)}};Hv=p("__VUE_INSTANCE_SETTERS__",l=>Bl=l),Qb=p("__VUE_SSR_SETTERS__",l=>H0=l)}const ty=c=>{const p=Bl;return Hv(c),c.scope.on(),()=>{c.scope.off(),Hv(p)}},IM=()=>{Bl&&Bl.scope.off(),Hv(null)};function o3(c){return c.vnode.shapeFlag&4}let H0=!1;function qP(c,p=!1,l=!1){p&&Qb(p);const{props:E,children:D}=c.vnode,N=o3(c);_P(c,E,N,p),bP(c,D,l);const B=N?$P(c,p):void 0;return p&&Qb(!1),B}function $P(c,p){const l=c.type;c.accessCache=Object.create(null),c.proxy=new Proxy(c.ctx,lP);const{setup:E}=l;if(E){rf();const D=c.setupContext=E.length>1?XP(c):null,N=ty(c),B=ey(E,c,0,[c.props,D]),n=sA(B);if(sf(),N(),(n||c.sp)&&!R0(c)&&zA(c),n){if(B.then(IM,IM),p)return B.then(X=>{RM(c,X,p)}).catch(X=>{sx(X,c,0)});c.asyncDep=B}else RM(c,B,p)}else a3(c,p)}function RM(c,p,l){Cs(p)?c.type.__ssrInlineRender?c.ssrRender=p:c.render=p:Wo(p)&&(c.setupState=LA(p)),a3(c,l)}let PM;function a3(c,p,l){const E=c.type;if(!c.render){if(!p&&PM&&!E.render){const D=E.template||zw(c).template;if(D){const{isCustomElement:N,compilerOptions:B}=c.appContext.config,{delimiters:n,compilerOptions:X}=E,$=il(il({isCustomElement:N,delimiters:n},B),X);E.render=PM(D,$)}}c.render=E.render||Wh}{const D=ty(c);rf();try{cP(c)}finally{sf(),D()}}}const ZP={get(c,p){return pl(c,"get",""),c[p]}};function XP(c){const p=l=>{c.exposed=l||{}};return{attrs:new Proxy(c.attrs,ZP),slots:c.slots,emit:c.emit,expose:p}}function Bw(c){return c.exposed?c.exposeProxy||(c.exposeProxy=new Proxy(LA(zR(c.exposed)),{get(p,l){if(l in p)return p[l];if(l in P0)return P0[l](c)},has(p,l){return l in p||l in P0}})):c.proxy}function YP(c){return Cs(c)&&"__vccOpts"in c}const KP=(c,p)=>NR(c,p,H0),JP="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ew;const DM=typeof window<"u"&&window.trustedTypes;if(DM)try{ew=DM.createPolicy("vue",{createHTML:c=>c})}catch{}const l3=ew?c=>ew.createHTML(c):c=>c,QP="http://www.w3.org/2000/svg",eD="http://www.w3.org/1998/Math/MathML",zd=typeof document<"u"?document:null,OM=zd&&zd.createElement("template"),tD={insert:(c,p,l)=>{p.insertBefore(c,l||null)},remove:c=>{const p=c.parentNode;p&&p.removeChild(c)},createElement:(c,p,l,E)=>{const D=p==="svg"?zd.createElementNS(QP,c):p==="mathml"?zd.createElementNS(eD,c):l?zd.createElement(c,{is:l}):zd.createElement(c);return c==="select"&&E&&E.multiple!=null&&D.setAttribute("multiple",E.multiple),D},createText:c=>zd.createTextNode(c),createComment:c=>zd.createComment(c),setText:(c,p)=>{c.nodeValue=p},setElementText:(c,p)=>{c.textContent=p},parentNode:c=>c.parentNode,nextSibling:c=>c.nextSibling,querySelector:c=>zd.querySelector(c),setScopeId(c,p){c.setAttribute(p,"")},insertStaticContent(c,p,l,E,D,N){const B=l?l.previousSibling:p.lastChild;if(D&&(D===N||D.nextSibling))for(;p.insertBefore(D.cloneNode(!0),l),!(D===N||!(D=D.nextSibling)););else{OM.innerHTML=l3(E==="svg"?`<svg>${c}</svg>`:E==="mathml"?`<math>${c}</math>`:c);const n=OM.content;if(E==="svg"||E==="mathml"){const X=n.firstChild;for(;X.firstChild;)n.appendChild(X.firstChild);n.removeChild(X)}p.insertBefore(n,l)}return[B?B.nextSibling:p.firstChild,l?l.previousSibling:p.lastChild]}},iD=Symbol("_vtc");function nD(c,p,l){const E=c[iD];E&&(p=(p?[p,...E]:[...E]).join(" ")),p==null?c.removeAttribute("class"):l?c.setAttribute("class",p):c.className=p}const zM=Symbol("_vod"),rD=Symbol("_vsh"),sD=Symbol(""),oD=/(^|;)\s*display\s*:/;function aD(c,p,l){const E=c.style,D=ga(l);let N=!1;if(l&&!D){if(p)if(ga(p))for(const B of p.split(";")){const n=B.slice(0,B.indexOf(":")).trim();l[n]==null&&Rv(E,n,"")}else for(const B in p)l[B]==null&&Rv(E,B,"");for(const B in l)B==="display"&&(N=!0),Rv(E,B,l[B])}else if(D){if(p!==l){const B=E[sD];B&&(l+=";"+B),E.cssText=l,N=oD.test(l)}}else p&&c.removeAttribute("style");zM in c&&(c[zM]=N?E.display:"",c[rD]&&(E.display="none"))}const kM=/\s*!important$/;function Rv(c,p,l){if(gs(l))l.forEach(E=>Rv(c,p,E));else if(l==null&&(l=""),p.startsWith("--"))c.setProperty(p,l);else{const E=lD(c,p);kM.test(l)?c.setProperty(Pm(E),l.replace(kM,""),"important"):c[E]=l}}const FM=["Webkit","Moz","ms"],I1={};function lD(c,p){const l=I1[p];if(l)return l;let E=Jp(p);if(E!=="filter"&&E in c)return I1[p]=E;E=lA(E);for(let D=0;D<FM.length;D++){const N=FM[D]+E;if(N in c)return I1[p]=N}return p}const BM="http://www.w3.org/1999/xlink";function NM(c,p,l,E,D,N=pR(p)){E&&p.startsWith("xlink:")?l==null?c.removeAttributeNS(BM,p.slice(6,p.length)):c.setAttributeNS(BM,p,l):l==null||N&&!uA(l)?c.removeAttribute(p):c.setAttribute(p,N?"":nf(l)?String(l):l)}function UM(c,p,l,E,D){if(p==="innerHTML"||p==="textContent"){l!=null&&(c[p]=p==="innerHTML"?l3(l):l);return}const N=c.tagName;if(p==="value"&&N!=="PROGRESS"&&!N.includes("-")){const n=N==="OPTION"?c.getAttribute("value")||"":c.value,X=l==null?c.type==="checkbox"?"on":"":String(l);(n!==X||!("_value"in c))&&(c.value=X),l==null&&c.removeAttribute(p),c._value=l;return}let B=!1;if(l===""||l==null){const n=typeof c[p];n==="boolean"?l=uA(l):l==null&&n==="string"?(l="",B=!0):n==="number"&&(l=0,B=!0)}try{c[p]=l}catch{}B&&c.removeAttribute(D||p)}function cD(c,p,l,E){c.addEventListener(p,l,E)}function uD(c,p,l,E){c.removeEventListener(p,l,E)}const VM=Symbol("_vei");function hD(c,p,l,E,D=null){const N=c[VM]||(c[VM]={}),B=N[p];if(E&&B)B.value=E;else{const[n,X]=dD(p);if(E){const $=N[p]=mD(E,D);cD(c,n,$,X)}else B&&(uD(c,n,B,X),N[p]=void 0)}}const GM=/(?:Once|Passive|Capture)$/;function dD(c){let p;if(GM.test(c)){p={};let E;for(;E=c.match(GM);)c=c.slice(0,c.length-E[0].length),p[E[0].toLowerCase()]=!0}return[c[2]===":"?c.slice(3):Pm(c.slice(2)),p]}let R1=0;const pD=Promise.resolve(),fD=()=>R1||(pD.then(()=>R1=0),R1=Date.now());function mD(c,p){const l=E=>{if(!E._vts)E._vts=Date.now();else if(E._vts<=l.attached)return;Jh(gD(E,l.value),p,5,[E])};return l.value=c,l.attached=fD(),l}function gD(c,p){if(gs(p)){const l=c.stopImmediatePropagation;return c.stopImmediatePropagation=()=>{l.call(c),c._stopped=!0},p.map(E=>D=>!D._stopped&&E&&E(D))}else return p}const HM=c=>c.charCodeAt(0)===111&&c.charCodeAt(1)===110&&c.charCodeAt(2)>96&&c.charCodeAt(2)<123,_D=(c,p,l,E,D,N)=>{const B=D==="svg";p==="class"?nD(c,E,B):p==="style"?aD(c,l,E):ex(p)?bw(p)||hD(c,p,l,E,N):(p[0]==="."?(p=p.slice(1),!0):p[0]==="^"?(p=p.slice(1),!1):yD(c,p,E,B))?(UM(c,p,E),!c.tagName.includes("-")&&(p==="value"||p==="checked"||p==="selected")&&NM(c,p,E,B,N,p!=="value")):c._isVueCE&&(/[A-Z]/.test(p)||!ga(E))?UM(c,Jp(p),E,N,p):(p==="true-value"?c._trueValue=E:p==="false-value"&&(c._falseValue=E),NM(c,p,E,B))};function yD(c,p,l,E){if(E)return!!(p==="innerHTML"||p==="textContent"||p in c&&HM(p)&&Cs(l));if(p==="spellcheck"||p==="draggable"||p==="translate"||p==="form"||p==="list"&&c.tagName==="INPUT"||p==="type"&&c.tagName==="TEXTAREA")return!1;if(p==="width"||p==="height"){const D=c.tagName;if(D==="IMG"||D==="VIDEO"||D==="CANVAS"||D==="SOURCE")return!1}return HM(p)&&ga(l)?!1:p in c}const vD=il({patchProp:_D},tD);let jM;function xD(){return jM||(jM=TP(vD))}const bD=(...c)=>{const p=xD().createApp(...c),{mount:l}=p;return p.mount=E=>{const D=TD(E);if(!D)return;const N=p._component;!Cs(N)&&!N.render&&!N.template&&(N.template=D.innerHTML),D.nodeType===1&&(D.textContent="");const B=l(D,!1,wD(D));return D instanceof Element&&(D.removeAttribute("v-cloak"),D.setAttribute("data-v-app","")),B},p};function wD(c){if(c instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&c instanceof MathMLElement)return"mathml"}function TD(c){return ga(c)?document.querySelector(c):c}function c3(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Pv={exports:{}},MD=Pv.exports,WM;function SD(){return WM||(WM=1,function(c,p){(function(l,E){c.exports=E()})(MD,function(){var l,E,D;function N(n,X){if(!l)l=X;else if(!E)E=X;else{var $="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+E+")(sharedChunk); self.onerror = null;",ne={};l(ne),D=X(ne),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(D.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}N(["exports"],function(n){function X(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var $,ne={},ve={};function ze(){if($)return ve;$=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.setMatrixArrayType=function(g){ve.ARRAY_TYPE=t=g},ve.toRadian=function(g){return g*h},ve.equals=function(g,d){return Math.abs(g-d)<=a*Math.max(1,Math.abs(g),Math.abs(d))},ve.RANDOM=ve.ARRAY_TYPE=ve.EPSILON=void 0;var a=1e-6;ve.EPSILON=a;var t=typeof Float32Array<"u"?Float32Array:Array;ve.ARRAY_TYPE=t;var r=Math.random;ve.RANDOM=r;var h=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var g=0,d=arguments.length;d--;)g+=arguments[d]*arguments[d];return Math.sqrt(g)}),ve}var ke,yt={};function it(){if(ke)return yt;function a(d){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},a(d)}ke=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.create=function(){var d=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},yt.clone=function(d){var _=new t.ARRAY_TYPE(4);return _[0]=d[0],_[1]=d[1],_[2]=d[2],_[3]=d[3],_},yt.copy=function(d,_){return d[0]=_[0],d[1]=_[1],d[2]=_[2],d[3]=_[3],d},yt.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d},yt.fromValues=function(d,_,T,I){var z=new t.ARRAY_TYPE(4);return z[0]=d,z[1]=_,z[2]=T,z[3]=I,z},yt.set=function(d,_,T,I,z){return d[0]=_,d[1]=T,d[2]=I,d[3]=z,d},yt.transpose=function(d,_){if(d===_){var T=_[1];d[1]=_[2],d[2]=T}else d[0]=_[0],d[1]=_[2],d[2]=_[1],d[3]=_[3];return d},yt.invert=function(d,_){var T=_[0],I=_[1],z=_[2],b=_[3],L=T*b-z*I;return L?(d[0]=b*(L=1/L),d[1]=-I*L,d[2]=-z*L,d[3]=T*L,d):null},yt.adjoint=function(d,_){var T=_[0];return d[0]=_[3],d[1]=-_[1],d[2]=-_[2],d[3]=T,d},yt.determinant=function(d){return d[0]*d[3]-d[2]*d[1]},yt.multiply=h,yt.rotate=function(d,_,T){var I=_[0],z=_[1],b=_[2],L=_[3],P=Math.sin(T),C=Math.cos(T);return d[0]=I*C+b*P,d[1]=z*C+L*P,d[2]=I*-P+b*C,d[3]=z*-P+L*C,d},yt.scale=function(d,_,T){var I=_[1],z=_[2],b=_[3],L=T[0],P=T[1];return d[0]=_[0]*L,d[1]=I*L,d[2]=z*P,d[3]=b*P,d},yt.fromRotation=function(d,_){var T=Math.sin(_),I=Math.cos(_);return d[0]=I,d[1]=T,d[2]=-T,d[3]=I,d},yt.fromScaling=function(d,_){return d[0]=_[0],d[1]=0,d[2]=0,d[3]=_[1],d},yt.str=function(d){return"mat2("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"},yt.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3])},yt.LDU=function(d,_,T,I){return d[2]=I[2]/I[0],T[0]=I[0],T[1]=I[1],T[3]=I[3]-d[2]*T[1],[d,_,T]},yt.add=function(d,_,T){return d[0]=_[0]+T[0],d[1]=_[1]+T[1],d[2]=_[2]+T[2],d[3]=_[3]+T[3],d},yt.subtract=g,yt.exactEquals=function(d,_){return d[0]===_[0]&&d[1]===_[1]&&d[2]===_[2]&&d[3]===_[3]},yt.equals=function(d,_){var T=d[0],I=d[1],z=d[2],b=d[3],L=_[0],P=_[1],C=_[2],R=_[3];return Math.abs(T-L)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(L))&&Math.abs(I-P)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(P))&&Math.abs(z-C)<=t.EPSILON*Math.max(1,Math.abs(z),Math.abs(C))&&Math.abs(b-R)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(R))},yt.multiplyScalar=function(d,_,T){return d[0]=_[0]*T,d[1]=_[1]*T,d[2]=_[2]*T,d[3]=_[3]*T,d},yt.multiplyScalarAndAdd=function(d,_,T,I){return d[0]=_[0]+T[0]*I,d[1]=_[1]+T[1]*I,d[2]=_[2]+T[2]*I,d[3]=_[3]+T[3]*I,d},yt.sub=yt.mul=void 0;var t=function(d,_){if(d&&d.__esModule)return d;if(d===null||a(d)!=="object"&&typeof d!="function")return{default:d};var T=r(void 0);if(T&&T.has(d))return T.get(d);var I={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in d)if(b!=="default"&&Object.prototype.hasOwnProperty.call(d,b)){var L=z?Object.getOwnPropertyDescriptor(d,b):null;L&&(L.get||L.set)?Object.defineProperty(I,b,L):I[b]=d[b]}return I.default=d,T&&T.set(d,I),I}(ze());function r(d){if(typeof WeakMap!="function")return null;var _=new WeakMap,T=new WeakMap;return(r=function(I){return I?T:_})(d)}function h(d,_,T){var I=_[0],z=_[1],b=_[2],L=_[3],P=T[0],C=T[1],R=T[2],F=T[3];return d[0]=I*P+b*C,d[1]=z*P+L*C,d[2]=I*R+b*F,d[3]=z*R+L*F,d}function g(d,_,T){return d[0]=_[0]-T[0],d[1]=_[1]-T[1],d[2]=_[2]-T[2],d[3]=_[3]-T[3],d}return yt.mul=h,yt.sub=g,yt}var xt,Ze={};function st(){if(xt)return Ze;function a(d){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},a(d)}xt=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.create=function(){var d=new t.ARRAY_TYPE(6);return t.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[4]=0,d[5]=0),d[0]=1,d[3]=1,d},Ze.clone=function(d){var _=new t.ARRAY_TYPE(6);return _[0]=d[0],_[1]=d[1],_[2]=d[2],_[3]=d[3],_[4]=d[4],_[5]=d[5],_},Ze.copy=function(d,_){return d[0]=_[0],d[1]=_[1],d[2]=_[2],d[3]=_[3],d[4]=_[4],d[5]=_[5],d},Ze.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=0,d[5]=0,d},Ze.fromValues=function(d,_,T,I,z,b){var L=new t.ARRAY_TYPE(6);return L[0]=d,L[1]=_,L[2]=T,L[3]=I,L[4]=z,L[5]=b,L},Ze.set=function(d,_,T,I,z,b,L){return d[0]=_,d[1]=T,d[2]=I,d[3]=z,d[4]=b,d[5]=L,d},Ze.invert=function(d,_){var T=_[0],I=_[1],z=_[2],b=_[3],L=_[4],P=_[5],C=T*b-I*z;return C?(d[0]=b*(C=1/C),d[1]=-I*C,d[2]=-z*C,d[3]=T*C,d[4]=(z*P-b*L)*C,d[5]=(I*L-T*P)*C,d):null},Ze.determinant=function(d){return d[0]*d[3]-d[1]*d[2]},Ze.multiply=h,Ze.rotate=function(d,_,T){var I=_[0],z=_[1],b=_[2],L=_[3],P=_[4],C=_[5],R=Math.sin(T),F=Math.cos(T);return d[0]=I*F+b*R,d[1]=z*F+L*R,d[2]=I*-R+b*F,d[3]=z*-R+L*F,d[4]=P,d[5]=C,d},Ze.scale=function(d,_,T){var I=_[1],z=_[2],b=_[3],L=_[4],P=_[5],C=T[0],R=T[1];return d[0]=_[0]*C,d[1]=I*C,d[2]=z*R,d[3]=b*R,d[4]=L,d[5]=P,d},Ze.translate=function(d,_,T){var I=_[0],z=_[1],b=_[2],L=_[3],P=_[4],C=_[5],R=T[0],F=T[1];return d[0]=I,d[1]=z,d[2]=b,d[3]=L,d[4]=I*R+b*F+P,d[5]=z*R+L*F+C,d},Ze.fromRotation=function(d,_){var T=Math.sin(_),I=Math.cos(_);return d[0]=I,d[1]=T,d[2]=-T,d[3]=I,d[4]=0,d[5]=0,d},Ze.fromScaling=function(d,_){return d[0]=_[0],d[1]=0,d[2]=0,d[3]=_[1],d[4]=0,d[5]=0,d},Ze.fromTranslation=function(d,_){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=_[0],d[5]=_[1],d},Ze.str=function(d){return"mat2d("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+")"},Ze.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],1)},Ze.add=function(d,_,T){return d[0]=_[0]+T[0],d[1]=_[1]+T[1],d[2]=_[2]+T[2],d[3]=_[3]+T[3],d[4]=_[4]+T[4],d[5]=_[5]+T[5],d},Ze.subtract=g,Ze.multiplyScalar=function(d,_,T){return d[0]=_[0]*T,d[1]=_[1]*T,d[2]=_[2]*T,d[3]=_[3]*T,d[4]=_[4]*T,d[5]=_[5]*T,d},Ze.multiplyScalarAndAdd=function(d,_,T,I){return d[0]=_[0]+T[0]*I,d[1]=_[1]+T[1]*I,d[2]=_[2]+T[2]*I,d[3]=_[3]+T[3]*I,d[4]=_[4]+T[4]*I,d[5]=_[5]+T[5]*I,d},Ze.exactEquals=function(d,_){return d[0]===_[0]&&d[1]===_[1]&&d[2]===_[2]&&d[3]===_[3]&&d[4]===_[4]&&d[5]===_[5]},Ze.equals=function(d,_){var T=d[0],I=d[1],z=d[2],b=d[3],L=d[4],P=d[5],C=_[0],R=_[1],F=_[2],q=_[3],Z=_[4],te=_[5];return Math.abs(T-C)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(C))&&Math.abs(I-R)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(R))&&Math.abs(z-F)<=t.EPSILON*Math.max(1,Math.abs(z),Math.abs(F))&&Math.abs(b-q)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(L-Z)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(Z))&&Math.abs(P-te)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(te))},Ze.sub=Ze.mul=void 0;var t=function(d,_){if(d&&d.__esModule)return d;if(d===null||a(d)!=="object"&&typeof d!="function")return{default:d};var T=r(void 0);if(T&&T.has(d))return T.get(d);var I={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in d)if(b!=="default"&&Object.prototype.hasOwnProperty.call(d,b)){var L=z?Object.getOwnPropertyDescriptor(d,b):null;L&&(L.get||L.set)?Object.defineProperty(I,b,L):I[b]=d[b]}return I.default=d,T&&T.set(d,I),I}(ze());function r(d){if(typeof WeakMap!="function")return null;var _=new WeakMap,T=new WeakMap;return(r=function(I){return I?T:_})(d)}function h(d,_,T){var I=_[0],z=_[1],b=_[2],L=_[3],P=_[4],C=_[5],R=T[0],F=T[1],q=T[2],Z=T[3],te=T[4],ie=T[5];return d[0]=I*R+b*F,d[1]=z*R+L*F,d[2]=I*q+b*Z,d[3]=z*q+L*Z,d[4]=I*te+b*ie+P,d[5]=z*te+L*ie+C,d}function g(d,_,T){return d[0]=_[0]-T[0],d[1]=_[1]-T[1],d[2]=_[2]-T[2],d[3]=_[3]-T[3],d[4]=_[4]-T[4],d[5]=_[5]-T[5],d}return Ze.mul=h,Ze.sub=g,Ze}var ti,mt={};function pt(){if(ti)return mt;function a(d){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},a(d)}ti=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var d=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d},mt.fromMat4=function(d,_){return d[0]=_[0],d[1]=_[1],d[2]=_[2],d[3]=_[4],d[4]=_[5],d[5]=_[6],d[6]=_[8],d[7]=_[9],d[8]=_[10],d},mt.clone=function(d){var _=new t.ARRAY_TYPE(9);return _[0]=d[0],_[1]=d[1],_[2]=d[2],_[3]=d[3],_[4]=d[4],_[5]=d[5],_[6]=d[6],_[7]=d[7],_[8]=d[8],_},mt.copy=function(d,_){return d[0]=_[0],d[1]=_[1],d[2]=_[2],d[3]=_[3],d[4]=_[4],d[5]=_[5],d[6]=_[6],d[7]=_[7],d[8]=_[8],d},mt.fromValues=function(d,_,T,I,z,b,L,P,C){var R=new t.ARRAY_TYPE(9);return R[0]=d,R[1]=_,R[2]=T,R[3]=I,R[4]=z,R[5]=b,R[6]=L,R[7]=P,R[8]=C,R},mt.set=function(d,_,T,I,z,b,L,P,C,R){return d[0]=_,d[1]=T,d[2]=I,d[3]=z,d[4]=b,d[5]=L,d[6]=P,d[7]=C,d[8]=R,d},mt.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},mt.transpose=function(d,_){if(d===_){var T=_[1],I=_[2],z=_[5];d[1]=_[3],d[2]=_[6],d[3]=T,d[5]=_[7],d[6]=I,d[7]=z}else d[0]=_[0],d[1]=_[3],d[2]=_[6],d[3]=_[1],d[4]=_[4],d[5]=_[7],d[6]=_[2],d[7]=_[5],d[8]=_[8];return d},mt.invert=function(d,_){var T=_[0],I=_[1],z=_[2],b=_[3],L=_[4],P=_[5],C=_[6],R=_[7],F=_[8],q=F*L-P*R,Z=-F*b+P*C,te=R*b-L*C,ie=T*q+I*Z+z*te;return ie?(d[0]=q*(ie=1/ie),d[1]=(-F*I+z*R)*ie,d[2]=(P*I-z*L)*ie,d[3]=Z*ie,d[4]=(F*T-z*C)*ie,d[5]=(-P*T+z*b)*ie,d[6]=te*ie,d[7]=(-R*T+I*C)*ie,d[8]=(L*T-I*b)*ie,d):null},mt.adjoint=function(d,_){var T=_[0],I=_[1],z=_[2],b=_[3],L=_[4],P=_[5],C=_[6],R=_[7],F=_[8];return d[0]=L*F-P*R,d[1]=z*R-I*F,d[2]=I*P-z*L,d[3]=P*C-b*F,d[4]=T*F-z*C,d[5]=z*b-T*P,d[6]=b*R-L*C,d[7]=I*C-T*R,d[8]=T*L-I*b,d},mt.determinant=function(d){var _=d[3],T=d[4],I=d[5],z=d[6],b=d[7],L=d[8];return d[0]*(L*T-I*b)+d[1]*(-L*_+I*z)+d[2]*(b*_-T*z)},mt.multiply=h,mt.translate=function(d,_,T){var I=_[0],z=_[1],b=_[2],L=_[3],P=_[4],C=_[5],R=_[6],F=_[7],q=_[8],Z=T[0],te=T[1];return d[0]=I,d[1]=z,d[2]=b,d[3]=L,d[4]=P,d[5]=C,d[6]=Z*I+te*L+R,d[7]=Z*z+te*P+F,d[8]=Z*b+te*C+q,d},mt.rotate=function(d,_,T){var I=_[0],z=_[1],b=_[2],L=_[3],P=_[4],C=_[5],R=_[6],F=_[7],q=_[8],Z=Math.sin(T),te=Math.cos(T);return d[0]=te*I+Z*L,d[1]=te*z+Z*P,d[2]=te*b+Z*C,d[3]=te*L-Z*I,d[4]=te*P-Z*z,d[5]=te*C-Z*b,d[6]=R,d[7]=F,d[8]=q,d},mt.scale=function(d,_,T){var I=T[0],z=T[1];return d[0]=I*_[0],d[1]=I*_[1],d[2]=I*_[2],d[3]=z*_[3],d[4]=z*_[4],d[5]=z*_[5],d[6]=_[6],d[7]=_[7],d[8]=_[8],d},mt.fromTranslation=function(d,_){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=_[0],d[7]=_[1],d[8]=1,d},mt.fromRotation=function(d,_){var T=Math.sin(_),I=Math.cos(_);return d[0]=I,d[1]=T,d[2]=0,d[3]=-T,d[4]=I,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},mt.fromScaling=function(d,_){return d[0]=_[0],d[1]=0,d[2]=0,d[3]=0,d[4]=_[1],d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},mt.fromMat2d=function(d,_){return d[0]=_[0],d[1]=_[1],d[2]=0,d[3]=_[2],d[4]=_[3],d[5]=0,d[6]=_[4],d[7]=_[5],d[8]=1,d},mt.fromQuat=function(d,_){var T=_[0],I=_[1],z=_[2],b=_[3],L=T+T,P=I+I,C=z+z,R=T*L,F=I*L,q=I*P,Z=z*L,te=z*P,ie=z*C,K=b*L,ce=b*P,he=b*C;return d[0]=1-q-ie,d[3]=F-he,d[6]=Z+ce,d[1]=F+he,d[4]=1-R-ie,d[7]=te-K,d[2]=Z-ce,d[5]=te+K,d[8]=1-R-q,d},mt.normalFromMat4=function(d,_){var T=_[0],I=_[1],z=_[2],b=_[3],L=_[4],P=_[5],C=_[6],R=_[7],F=_[8],q=_[9],Z=_[10],te=_[11],ie=_[12],K=_[13],ce=_[14],he=_[15],Se=T*P-I*L,$e=T*C-z*L,Be=T*R-b*L,Ve=I*C-z*P,Mt=I*R-b*P,Ne=z*R-b*C,ft=F*K-q*ie,Pt=F*ce-Z*ie,Dt=F*he-te*ie,Ut=q*ce-Z*K,ei=q*he-te*K,ri=Z*he-te*ce,Yt=Se*ri-$e*ei+Be*Ut+Ve*Dt-Mt*Pt+Ne*ft;return Yt?(d[0]=(P*ri-C*ei+R*Ut)*(Yt=1/Yt),d[1]=(C*Dt-L*ri-R*Pt)*Yt,d[2]=(L*ei-P*Dt+R*ft)*Yt,d[3]=(z*ei-I*ri-b*Ut)*Yt,d[4]=(T*ri-z*Dt+b*Pt)*Yt,d[5]=(I*Dt-T*ei-b*ft)*Yt,d[6]=(K*Ne-ce*Mt+he*Ve)*Yt,d[7]=(ce*Be-ie*Ne-he*$e)*Yt,d[8]=(ie*Mt-K*Be+he*Se)*Yt,d):null},mt.projection=function(d,_,T){return d[0]=2/_,d[1]=0,d[2]=0,d[3]=0,d[4]=-2/T,d[5]=0,d[6]=-1,d[7]=1,d[8]=1,d},mt.str=function(d){return"mat3("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+")"},mt.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8])},mt.add=function(d,_,T){return d[0]=_[0]+T[0],d[1]=_[1]+T[1],d[2]=_[2]+T[2],d[3]=_[3]+T[3],d[4]=_[4]+T[4],d[5]=_[5]+T[5],d[6]=_[6]+T[6],d[7]=_[7]+T[7],d[8]=_[8]+T[8],d},mt.subtract=g,mt.multiplyScalar=function(d,_,T){return d[0]=_[0]*T,d[1]=_[1]*T,d[2]=_[2]*T,d[3]=_[3]*T,d[4]=_[4]*T,d[5]=_[5]*T,d[6]=_[6]*T,d[7]=_[7]*T,d[8]=_[8]*T,d},mt.multiplyScalarAndAdd=function(d,_,T,I){return d[0]=_[0]+T[0]*I,d[1]=_[1]+T[1]*I,d[2]=_[2]+T[2]*I,d[3]=_[3]+T[3]*I,d[4]=_[4]+T[4]*I,d[5]=_[5]+T[5]*I,d[6]=_[6]+T[6]*I,d[7]=_[7]+T[7]*I,d[8]=_[8]+T[8]*I,d},mt.exactEquals=function(d,_){return d[0]===_[0]&&d[1]===_[1]&&d[2]===_[2]&&d[3]===_[3]&&d[4]===_[4]&&d[5]===_[5]&&d[6]===_[6]&&d[7]===_[7]&&d[8]===_[8]},mt.equals=function(d,_){var T=d[0],I=d[1],z=d[2],b=d[3],L=d[4],P=d[5],C=d[6],R=d[7],F=d[8],q=_[0],Z=_[1],te=_[2],ie=_[3],K=_[4],ce=_[5],he=_[6],Se=_[7],$e=_[8];return Math.abs(T-q)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(q))&&Math.abs(I-Z)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(Z))&&Math.abs(z-te)<=t.EPSILON*Math.max(1,Math.abs(z),Math.abs(te))&&Math.abs(b-ie)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(ie))&&Math.abs(L-K)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(K))&&Math.abs(P-ce)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(ce))&&Math.abs(C-he)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(he))&&Math.abs(R-Se)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(Se))&&Math.abs(F-$e)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs($e))},mt.sub=mt.mul=void 0;var t=function(d,_){if(d&&d.__esModule)return d;if(d===null||a(d)!=="object"&&typeof d!="function")return{default:d};var T=r(void 0);if(T&&T.has(d))return T.get(d);var I={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in d)if(b!=="default"&&Object.prototype.hasOwnProperty.call(d,b)){var L=z?Object.getOwnPropertyDescriptor(d,b):null;L&&(L.get||L.set)?Object.defineProperty(I,b,L):I[b]=d[b]}return I.default=d,T&&T.set(d,I),I}(ze());function r(d){if(typeof WeakMap!="function")return null;var _=new WeakMap,T=new WeakMap;return(r=function(I){return I?T:_})(d)}function h(d,_,T){var I=_[0],z=_[1],b=_[2],L=_[3],P=_[4],C=_[5],R=_[6],F=_[7],q=_[8],Z=T[0],te=T[1],ie=T[2],K=T[3],ce=T[4],he=T[5],Se=T[6],$e=T[7],Be=T[8];return d[0]=Z*I+te*L+ie*R,d[1]=Z*z+te*P+ie*F,d[2]=Z*b+te*C+ie*q,d[3]=K*I+ce*L+he*R,d[4]=K*z+ce*P+he*F,d[5]=K*b+ce*C+he*q,d[6]=Se*I+$e*L+Be*R,d[7]=Se*z+$e*P+Be*F,d[8]=Se*b+$e*C+Be*q,d}function g(d,_,T){return d[0]=_[0]-T[0],d[1]=_[1]-T[1],d[2]=_[2]-T[2],d[3]=_[3]-T[3],d[4]=_[4]-T[4],d[5]=_[5]-T[5],d[6]=_[6]-T[6],d[7]=_[7]-T[7],d[8]=_[8]-T[8],d}return mt.mul=h,mt.sub=g,mt}var Tt,Fe={};function et(){if(Tt)return Fe;function a(b){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(L){return typeof L}:function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},a(b)}Tt=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.create=function(){var b=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0),b[0]=1,b[5]=1,b[10]=1,b[15]=1,b},Fe.clone=function(b){var L=new t.ARRAY_TYPE(16);return L[0]=b[0],L[1]=b[1],L[2]=b[2],L[3]=b[3],L[4]=b[4],L[5]=b[5],L[6]=b[6],L[7]=b[7],L[8]=b[8],L[9]=b[9],L[10]=b[10],L[11]=b[11],L[12]=b[12],L[13]=b[13],L[14]=b[14],L[15]=b[15],L},Fe.copy=function(b,L){return b[0]=L[0],b[1]=L[1],b[2]=L[2],b[3]=L[3],b[4]=L[4],b[5]=L[5],b[6]=L[6],b[7]=L[7],b[8]=L[8],b[9]=L[9],b[10]=L[10],b[11]=L[11],b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15],b},Fe.fromValues=function(b,L,P,C,R,F,q,Z,te,ie,K,ce,he,Se,$e,Be){var Ve=new t.ARRAY_TYPE(16);return Ve[0]=b,Ve[1]=L,Ve[2]=P,Ve[3]=C,Ve[4]=R,Ve[5]=F,Ve[6]=q,Ve[7]=Z,Ve[8]=te,Ve[9]=ie,Ve[10]=K,Ve[11]=ce,Ve[12]=he,Ve[13]=Se,Ve[14]=$e,Ve[15]=Be,Ve},Fe.set=function(b,L,P,C,R,F,q,Z,te,ie,K,ce,he,Se,$e,Be,Ve){return b[0]=L,b[1]=P,b[2]=C,b[3]=R,b[4]=F,b[5]=q,b[6]=Z,b[7]=te,b[8]=ie,b[9]=K,b[10]=ce,b[11]=he,b[12]=Se,b[13]=$e,b[14]=Be,b[15]=Ve,b},Fe.identity=h,Fe.transpose=function(b,L){if(b===L){var P=L[1],C=L[2],R=L[3],F=L[6],q=L[7],Z=L[11];b[1]=L[4],b[2]=L[8],b[3]=L[12],b[4]=P,b[6]=L[9],b[7]=L[13],b[8]=C,b[9]=F,b[11]=L[14],b[12]=R,b[13]=q,b[14]=Z}else b[0]=L[0],b[1]=L[4],b[2]=L[8],b[3]=L[12],b[4]=L[1],b[5]=L[5],b[6]=L[9],b[7]=L[13],b[8]=L[2],b[9]=L[6],b[10]=L[10],b[11]=L[14],b[12]=L[3],b[13]=L[7],b[14]=L[11],b[15]=L[15];return b},Fe.invert=function(b,L){var P=L[0],C=L[1],R=L[2],F=L[3],q=L[4],Z=L[5],te=L[6],ie=L[7],K=L[8],ce=L[9],he=L[10],Se=L[11],$e=L[12],Be=L[13],Ve=L[14],Mt=L[15],Ne=P*Z-C*q,ft=P*te-R*q,Pt=P*ie-F*q,Dt=C*te-R*Z,Ut=C*ie-F*Z,ei=R*ie-F*te,ri=K*Be-ce*$e,Yt=K*Ve-he*$e,yi=K*Mt-Se*$e,Fi=ce*Ve-he*Be,pi=ce*Mt-Se*Be,Tn=he*Mt-Se*Ve,ln=Ne*Tn-ft*pi+Pt*Fi+Dt*yi-Ut*Yt+ei*ri;return ln?(b[0]=(Z*Tn-te*pi+ie*Fi)*(ln=1/ln),b[1]=(R*pi-C*Tn-F*Fi)*ln,b[2]=(Be*ei-Ve*Ut+Mt*Dt)*ln,b[3]=(he*Ut-ce*ei-Se*Dt)*ln,b[4]=(te*yi-q*Tn-ie*Yt)*ln,b[5]=(P*Tn-R*yi+F*Yt)*ln,b[6]=(Ve*Pt-$e*ei-Mt*ft)*ln,b[7]=(K*ei-he*Pt+Se*ft)*ln,b[8]=(q*pi-Z*yi+ie*ri)*ln,b[9]=(C*yi-P*pi-F*ri)*ln,b[10]=($e*Ut-Be*Pt+Mt*Ne)*ln,b[11]=(ce*Pt-K*Ut-Se*Ne)*ln,b[12]=(Z*Yt-q*Fi-te*ri)*ln,b[13]=(P*Fi-C*Yt+R*ri)*ln,b[14]=(Be*ft-$e*Dt-Ve*Ne)*ln,b[15]=(K*Dt-ce*ft+he*Ne)*ln,b):null},Fe.adjoint=function(b,L){var P=L[0],C=L[1],R=L[2],F=L[3],q=L[4],Z=L[5],te=L[6],ie=L[7],K=L[8],ce=L[9],he=L[10],Se=L[11],$e=L[12],Be=L[13],Ve=L[14],Mt=L[15];return b[0]=Z*(he*Mt-Se*Ve)-ce*(te*Mt-ie*Ve)+Be*(te*Se-ie*he),b[1]=-(C*(he*Mt-Se*Ve)-ce*(R*Mt-F*Ve)+Be*(R*Se-F*he)),b[2]=C*(te*Mt-ie*Ve)-Z*(R*Mt-F*Ve)+Be*(R*ie-F*te),b[3]=-(C*(te*Se-ie*he)-Z*(R*Se-F*he)+ce*(R*ie-F*te)),b[4]=-(q*(he*Mt-Se*Ve)-K*(te*Mt-ie*Ve)+$e*(te*Se-ie*he)),b[5]=P*(he*Mt-Se*Ve)-K*(R*Mt-F*Ve)+$e*(R*Se-F*he),b[6]=-(P*(te*Mt-ie*Ve)-q*(R*Mt-F*Ve)+$e*(R*ie-F*te)),b[7]=P*(te*Se-ie*he)-q*(R*Se-F*he)+K*(R*ie-F*te),b[8]=q*(ce*Mt-Se*Be)-K*(Z*Mt-ie*Be)+$e*(Z*Se-ie*ce),b[9]=-(P*(ce*Mt-Se*Be)-K*(C*Mt-F*Be)+$e*(C*Se-F*ce)),b[10]=P*(Z*Mt-ie*Be)-q*(C*Mt-F*Be)+$e*(C*ie-F*Z),b[11]=-(P*(Z*Se-ie*ce)-q*(C*Se-F*ce)+K*(C*ie-F*Z)),b[12]=-(q*(ce*Ve-he*Be)-K*(Z*Ve-te*Be)+$e*(Z*he-te*ce)),b[13]=P*(ce*Ve-he*Be)-K*(C*Ve-R*Be)+$e*(C*he-R*ce),b[14]=-(P*(Z*Ve-te*Be)-q*(C*Ve-R*Be)+$e*(C*te-R*Z)),b[15]=P*(Z*he-te*ce)-q*(C*he-R*ce)+K*(C*te-R*Z),b},Fe.determinant=function(b){var L=b[0],P=b[1],C=b[2],R=b[3],F=b[4],q=b[5],Z=b[6],te=b[7],ie=b[8],K=b[9],ce=b[10],he=b[11],Se=b[12],$e=b[13],Be=b[14],Ve=b[15];return(L*q-P*F)*(ce*Ve-he*Be)-(L*Z-C*F)*(K*Ve-he*$e)+(L*te-R*F)*(K*Be-ce*$e)+(P*Z-C*q)*(ie*Ve-he*Se)-(P*te-R*q)*(ie*Be-ce*Se)+(C*te-R*Z)*(ie*$e-K*Se)},Fe.multiply=g,Fe.translate=function(b,L,P){var C,R,F,q,Z,te,ie,K,ce,he,Se,$e,Be=P[0],Ve=P[1],Mt=P[2];return L===b?(b[12]=L[0]*Be+L[4]*Ve+L[8]*Mt+L[12],b[13]=L[1]*Be+L[5]*Ve+L[9]*Mt+L[13],b[14]=L[2]*Be+L[6]*Ve+L[10]*Mt+L[14],b[15]=L[3]*Be+L[7]*Ve+L[11]*Mt+L[15]):(R=L[1],F=L[2],q=L[3],Z=L[4],te=L[5],ie=L[6],K=L[7],ce=L[8],he=L[9],Se=L[10],$e=L[11],b[0]=C=L[0],b[1]=R,b[2]=F,b[3]=q,b[4]=Z,b[5]=te,b[6]=ie,b[7]=K,b[8]=ce,b[9]=he,b[10]=Se,b[11]=$e,b[12]=C*Be+Z*Ve+ce*Mt+L[12],b[13]=R*Be+te*Ve+he*Mt+L[13],b[14]=F*Be+ie*Ve+Se*Mt+L[14],b[15]=q*Be+K*Ve+$e*Mt+L[15]),b},Fe.scale=function(b,L,P){var C=P[0],R=P[1],F=P[2];return b[0]=L[0]*C,b[1]=L[1]*C,b[2]=L[2]*C,b[3]=L[3]*C,b[4]=L[4]*R,b[5]=L[5]*R,b[6]=L[6]*R,b[7]=L[7]*R,b[8]=L[8]*F,b[9]=L[9]*F,b[10]=L[10]*F,b[11]=L[11]*F,b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15],b},Fe.rotate=function(b,L,P,C){var R,F,q,Z,te,ie,K,ce,he,Se,$e,Be,Ve,Mt,Ne,ft,Pt,Dt,Ut,ei,ri,Yt,yi,Fi,pi=C[0],Tn=C[1],ln=C[2],$i=Math.hypot(pi,Tn,ln);return $i<t.EPSILON?null:(pi*=$i=1/$i,Tn*=$i,ln*=$i,R=Math.sin(P),F=Math.cos(P),te=L[1],ie=L[2],K=L[3],he=L[5],Se=L[6],$e=L[7],Ve=L[9],Mt=L[10],Ne=L[11],ft=pi*pi*(q=1-F)+F,Ut=pi*Tn*q-ln*R,ei=Tn*Tn*q+F,ri=ln*Tn*q+pi*R,Yt=pi*ln*q+Tn*R,yi=Tn*ln*q-pi*R,Fi=ln*ln*q+F,b[0]=(Z=L[0])*ft+(ce=L[4])*(Pt=Tn*pi*q+ln*R)+(Be=L[8])*(Dt=ln*pi*q-Tn*R),b[1]=te*ft+he*Pt+Ve*Dt,b[2]=ie*ft+Se*Pt+Mt*Dt,b[3]=K*ft+$e*Pt+Ne*Dt,b[4]=Z*Ut+ce*ei+Be*ri,b[5]=te*Ut+he*ei+Ve*ri,b[6]=ie*Ut+Se*ei+Mt*ri,b[7]=K*Ut+$e*ei+Ne*ri,b[8]=Z*Yt+ce*yi+Be*Fi,b[9]=te*Yt+he*yi+Ve*Fi,b[10]=ie*Yt+Se*yi+Mt*Fi,b[11]=K*Yt+$e*yi+Ne*Fi,L!==b&&(b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15]),b)},Fe.rotateX=function(b,L,P){var C=Math.sin(P),R=Math.cos(P),F=L[4],q=L[5],Z=L[6],te=L[7],ie=L[8],K=L[9],ce=L[10],he=L[11];return L!==b&&(b[0]=L[0],b[1]=L[1],b[2]=L[2],b[3]=L[3],b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15]),b[4]=F*R+ie*C,b[5]=q*R+K*C,b[6]=Z*R+ce*C,b[7]=te*R+he*C,b[8]=ie*R-F*C,b[9]=K*R-q*C,b[10]=ce*R-Z*C,b[11]=he*R-te*C,b},Fe.rotateY=function(b,L,P){var C=Math.sin(P),R=Math.cos(P),F=L[0],q=L[1],Z=L[2],te=L[3],ie=L[8],K=L[9],ce=L[10],he=L[11];return L!==b&&(b[4]=L[4],b[5]=L[5],b[6]=L[6],b[7]=L[7],b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15]),b[0]=F*R-ie*C,b[1]=q*R-K*C,b[2]=Z*R-ce*C,b[3]=te*R-he*C,b[8]=F*C+ie*R,b[9]=q*C+K*R,b[10]=Z*C+ce*R,b[11]=te*C+he*R,b},Fe.rotateZ=function(b,L,P){var C=Math.sin(P),R=Math.cos(P),F=L[0],q=L[1],Z=L[2],te=L[3],ie=L[4],K=L[5],ce=L[6],he=L[7];return L!==b&&(b[8]=L[8],b[9]=L[9],b[10]=L[10],b[11]=L[11],b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15]),b[0]=F*R+ie*C,b[1]=q*R+K*C,b[2]=Z*R+ce*C,b[3]=te*R+he*C,b[4]=ie*R-F*C,b[5]=K*R-q*C,b[6]=ce*R-Z*C,b[7]=he*R-te*C,b},Fe.fromTranslation=function(b,L){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=L[0],b[13]=L[1],b[14]=L[2],b[15]=1,b},Fe.fromScaling=function(b,L){return b[0]=L[0],b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=L[1],b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=L[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Fe.fromRotation=function(b,L,P){var C,R,F,q=P[0],Z=P[1],te=P[2],ie=Math.hypot(q,Z,te);return ie<t.EPSILON?null:(q*=ie=1/ie,Z*=ie,te*=ie,C=Math.sin(L),R=Math.cos(L),b[0]=q*q*(F=1-R)+R,b[1]=Z*q*F+te*C,b[2]=te*q*F-Z*C,b[3]=0,b[4]=q*Z*F-te*C,b[5]=Z*Z*F+R,b[6]=te*Z*F+q*C,b[7]=0,b[8]=q*te*F+Z*C,b[9]=Z*te*F-q*C,b[10]=te*te*F+R,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b)},Fe.fromXRotation=function(b,L){var P=Math.sin(L),C=Math.cos(L);return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=C,b[6]=P,b[7]=0,b[8]=0,b[9]=-P,b[10]=C,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Fe.fromYRotation=function(b,L){var P=Math.sin(L),C=Math.cos(L);return b[0]=C,b[1]=0,b[2]=-P,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=P,b[9]=0,b[10]=C,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Fe.fromZRotation=function(b,L){var P=Math.sin(L),C=Math.cos(L);return b[0]=C,b[1]=P,b[2]=0,b[3]=0,b[4]=-P,b[5]=C,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Fe.fromRotationTranslation=d,Fe.fromQuat2=function(b,L){var P=new t.ARRAY_TYPE(3),C=-L[0],R=-L[1],F=-L[2],q=L[3],Z=L[4],te=L[5],ie=L[6],K=L[7],ce=C*C+R*R+F*F+q*q;return ce>0?(P[0]=2*(Z*q+K*C+te*F-ie*R)/ce,P[1]=2*(te*q+K*R+ie*C-Z*F)/ce,P[2]=2*(ie*q+K*F+Z*R-te*C)/ce):(P[0]=2*(Z*q+K*C+te*F-ie*R),P[1]=2*(te*q+K*R+ie*C-Z*F),P[2]=2*(ie*q+K*F+Z*R-te*C)),d(b,L,P),b},Fe.getTranslation=function(b,L){return b[0]=L[12],b[1]=L[13],b[2]=L[14],b},Fe.getScaling=_,Fe.getRotation=function(b,L){var P=new t.ARRAY_TYPE(3);_(P,L);var C=1/P[0],R=1/P[1],F=1/P[2],q=L[0]*C,Z=L[1]*R,te=L[2]*F,ie=L[4]*C,K=L[5]*R,ce=L[6]*F,he=L[8]*C,Se=L[9]*R,$e=L[10]*F,Be=q+K+$e,Ve=0;return Be>0?(Ve=2*Math.sqrt(Be+1),b[3]=.25*Ve,b[0]=(ce-Se)/Ve,b[1]=(he-te)/Ve,b[2]=(Z-ie)/Ve):q>K&&q>$e?(Ve=2*Math.sqrt(1+q-K-$e),b[3]=(ce-Se)/Ve,b[0]=.25*Ve,b[1]=(Z+ie)/Ve,b[2]=(he+te)/Ve):K>$e?(Ve=2*Math.sqrt(1+K-q-$e),b[3]=(he-te)/Ve,b[0]=(Z+ie)/Ve,b[1]=.25*Ve,b[2]=(ce+Se)/Ve):(Ve=2*Math.sqrt(1+$e-q-K),b[3]=(Z-ie)/Ve,b[0]=(he+te)/Ve,b[1]=(ce+Se)/Ve,b[2]=.25*Ve),b},Fe.fromRotationTranslationScale=function(b,L,P,C){var R=L[0],F=L[1],q=L[2],Z=L[3],te=R+R,ie=F+F,K=q+q,ce=R*te,he=R*ie,Se=R*K,$e=F*ie,Be=F*K,Ve=q*K,Mt=Z*te,Ne=Z*ie,ft=Z*K,Pt=C[0],Dt=C[1],Ut=C[2];return b[0]=(1-($e+Ve))*Pt,b[1]=(he+ft)*Pt,b[2]=(Se-Ne)*Pt,b[3]=0,b[4]=(he-ft)*Dt,b[5]=(1-(ce+Ve))*Dt,b[6]=(Be+Mt)*Dt,b[7]=0,b[8]=(Se+Ne)*Ut,b[9]=(Be-Mt)*Ut,b[10]=(1-(ce+$e))*Ut,b[11]=0,b[12]=P[0],b[13]=P[1],b[14]=P[2],b[15]=1,b},Fe.fromRotationTranslationScaleOrigin=function(b,L,P,C,R){var F=L[0],q=L[1],Z=L[2],te=L[3],ie=F+F,K=q+q,ce=Z+Z,he=F*ie,Se=F*K,$e=F*ce,Be=q*K,Ve=q*ce,Mt=Z*ce,Ne=te*ie,ft=te*K,Pt=te*ce,Dt=C[0],Ut=C[1],ei=C[2],ri=R[0],Yt=R[1],yi=R[2],Fi=(1-(Be+Mt))*Dt,pi=(Se+Pt)*Dt,Tn=($e-ft)*Dt,ln=(Se-Pt)*Ut,$i=(1-(he+Mt))*Ut,Di=(Ve+Ne)*Ut,Kn=($e+ft)*ei,bn=(Ve-Ne)*ei,Cn=(1-(he+Be))*ei;return b[0]=Fi,b[1]=pi,b[2]=Tn,b[3]=0,b[4]=ln,b[5]=$i,b[6]=Di,b[7]=0,b[8]=Kn,b[9]=bn,b[10]=Cn,b[11]=0,b[12]=P[0]+ri-(Fi*ri+ln*Yt+Kn*yi),b[13]=P[1]+Yt-(pi*ri+$i*Yt+bn*yi),b[14]=P[2]+yi-(Tn*ri+Di*Yt+Cn*yi),b[15]=1,b},Fe.fromQuat=function(b,L){var P=L[0],C=L[1],R=L[2],F=L[3],q=P+P,Z=C+C,te=R+R,ie=P*q,K=C*q,ce=C*Z,he=R*q,Se=R*Z,$e=R*te,Be=F*q,Ve=F*Z,Mt=F*te;return b[0]=1-ce-$e,b[1]=K+Mt,b[2]=he-Ve,b[3]=0,b[4]=K-Mt,b[5]=1-ie-$e,b[6]=Se+Be,b[7]=0,b[8]=he+Ve,b[9]=Se-Be,b[10]=1-ie-ce,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},Fe.frustum=function(b,L,P,C,R,F,q){var Z=1/(P-L),te=1/(R-C),ie=1/(F-q);return b[0]=2*F*Z,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=2*F*te,b[6]=0,b[7]=0,b[8]=(P+L)*Z,b[9]=(R+C)*te,b[10]=(q+F)*ie,b[11]=-1,b[12]=0,b[13]=0,b[14]=q*F*2*ie,b[15]=0,b},Fe.perspectiveNO=T,Fe.perspectiveZO=function(b,L,P,C,R){var F,q=1/Math.tan(L/2);return b[0]=q/P,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=q,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,R!=null&&R!==1/0?(b[10]=R*(F=1/(C-R)),b[14]=R*C*F):(b[10]=-1,b[14]=-C),b},Fe.perspectiveFromFieldOfView=function(b,L,P,C){var R=Math.tan(L.upDegrees*Math.PI/180),F=Math.tan(L.downDegrees*Math.PI/180),q=Math.tan(L.leftDegrees*Math.PI/180),Z=Math.tan(L.rightDegrees*Math.PI/180),te=2/(q+Z),ie=2/(R+F);return b[0]=te,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=ie,b[6]=0,b[7]=0,b[8]=-(q-Z)*te*.5,b[9]=(R-F)*ie*.5,b[10]=C/(P-C),b[11]=-1,b[12]=0,b[13]=0,b[14]=C*P/(P-C),b[15]=0,b},Fe.orthoNO=I,Fe.orthoZO=function(b,L,P,C,R,F,q){var Z=1/(L-P),te=1/(C-R),ie=1/(F-q);return b[0]=-2*Z,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*te,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=ie,b[11]=0,b[12]=(L+P)*Z,b[13]=(R+C)*te,b[14]=F*ie,b[15]=1,b},Fe.lookAt=function(b,L,P,C){var R,F,q,Z,te,ie,K,ce,he,Se,$e=L[0],Be=L[1],Ve=L[2],Mt=C[0],Ne=C[1],ft=C[2],Pt=P[0],Dt=P[1],Ut=P[2];return Math.abs($e-Pt)<t.EPSILON&&Math.abs(Be-Dt)<t.EPSILON&&Math.abs(Ve-Ut)<t.EPSILON?h(b):(K=$e-Pt,ce=Be-Dt,he=Ve-Ut,R=Ne*(he*=Se=1/Math.hypot(K,ce,he))-ft*(ce*=Se),F=ft*(K*=Se)-Mt*he,q=Mt*ce-Ne*K,(Se=Math.hypot(R,F,q))?(R*=Se=1/Se,F*=Se,q*=Se):(R=0,F=0,q=0),Z=ce*q-he*F,te=he*R-K*q,ie=K*F-ce*R,(Se=Math.hypot(Z,te,ie))?(Z*=Se=1/Se,te*=Se,ie*=Se):(Z=0,te=0,ie=0),b[0]=R,b[1]=Z,b[2]=K,b[3]=0,b[4]=F,b[5]=te,b[6]=ce,b[7]=0,b[8]=q,b[9]=ie,b[10]=he,b[11]=0,b[12]=-(R*$e+F*Be+q*Ve),b[13]=-(Z*$e+te*Be+ie*Ve),b[14]=-(K*$e+ce*Be+he*Ve),b[15]=1,b)},Fe.targetTo=function(b,L,P,C){var R=L[0],F=L[1],q=L[2],Z=C[0],te=C[1],ie=C[2],K=R-P[0],ce=F-P[1],he=q-P[2],Se=K*K+ce*ce+he*he;Se>0&&(K*=Se=1/Math.sqrt(Se),ce*=Se,he*=Se);var $e=te*he-ie*ce,Be=ie*K-Z*he,Ve=Z*ce-te*K;return(Se=$e*$e+Be*Be+Ve*Ve)>0&&($e*=Se=1/Math.sqrt(Se),Be*=Se,Ve*=Se),b[0]=$e,b[1]=Be,b[2]=Ve,b[3]=0,b[4]=ce*Ve-he*Be,b[5]=he*$e-K*Ve,b[6]=K*Be-ce*$e,b[7]=0,b[8]=K,b[9]=ce,b[10]=he,b[11]=0,b[12]=R,b[13]=F,b[14]=q,b[15]=1,b},Fe.str=function(b){return"mat4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+")"},Fe.frob=function(b){return Math.hypot(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15])},Fe.add=function(b,L,P){return b[0]=L[0]+P[0],b[1]=L[1]+P[1],b[2]=L[2]+P[2],b[3]=L[3]+P[3],b[4]=L[4]+P[4],b[5]=L[5]+P[5],b[6]=L[6]+P[6],b[7]=L[7]+P[7],b[8]=L[8]+P[8],b[9]=L[9]+P[9],b[10]=L[10]+P[10],b[11]=L[11]+P[11],b[12]=L[12]+P[12],b[13]=L[13]+P[13],b[14]=L[14]+P[14],b[15]=L[15]+P[15],b},Fe.subtract=z,Fe.multiplyScalar=function(b,L,P){return b[0]=L[0]*P,b[1]=L[1]*P,b[2]=L[2]*P,b[3]=L[3]*P,b[4]=L[4]*P,b[5]=L[5]*P,b[6]=L[6]*P,b[7]=L[7]*P,b[8]=L[8]*P,b[9]=L[9]*P,b[10]=L[10]*P,b[11]=L[11]*P,b[12]=L[12]*P,b[13]=L[13]*P,b[14]=L[14]*P,b[15]=L[15]*P,b},Fe.multiplyScalarAndAdd=function(b,L,P,C){return b[0]=L[0]+P[0]*C,b[1]=L[1]+P[1]*C,b[2]=L[2]+P[2]*C,b[3]=L[3]+P[3]*C,b[4]=L[4]+P[4]*C,b[5]=L[5]+P[5]*C,b[6]=L[6]+P[6]*C,b[7]=L[7]+P[7]*C,b[8]=L[8]+P[8]*C,b[9]=L[9]+P[9]*C,b[10]=L[10]+P[10]*C,b[11]=L[11]+P[11]*C,b[12]=L[12]+P[12]*C,b[13]=L[13]+P[13]*C,b[14]=L[14]+P[14]*C,b[15]=L[15]+P[15]*C,b},Fe.exactEquals=function(b,L){return b[0]===L[0]&&b[1]===L[1]&&b[2]===L[2]&&b[3]===L[3]&&b[4]===L[4]&&b[5]===L[5]&&b[6]===L[6]&&b[7]===L[7]&&b[8]===L[8]&&b[9]===L[9]&&b[10]===L[10]&&b[11]===L[11]&&b[12]===L[12]&&b[13]===L[13]&&b[14]===L[14]&&b[15]===L[15]},Fe.equals=function(b,L){var P=b[0],C=b[1],R=b[2],F=b[3],q=b[4],Z=b[5],te=b[6],ie=b[7],K=b[8],ce=b[9],he=b[10],Se=b[11],$e=b[12],Be=b[13],Ve=b[14],Mt=b[15],Ne=L[0],ft=L[1],Pt=L[2],Dt=L[3],Ut=L[4],ei=L[5],ri=L[6],Yt=L[7],yi=L[8],Fi=L[9],pi=L[10],Tn=L[11],ln=L[12],$i=L[13],Di=L[14],Kn=L[15];return Math.abs(P-Ne)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ne))&&Math.abs(C-ft)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(ft))&&Math.abs(R-Pt)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(Pt))&&Math.abs(F-Dt)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(Dt))&&Math.abs(q-Ut)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(Ut))&&Math.abs(Z-ei)<=t.EPSILON*Math.max(1,Math.abs(Z),Math.abs(ei))&&Math.abs(te-ri)<=t.EPSILON*Math.max(1,Math.abs(te),Math.abs(ri))&&Math.abs(ie-Yt)<=t.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Yt))&&Math.abs(K-yi)<=t.EPSILON*Math.max(1,Math.abs(K),Math.abs(yi))&&Math.abs(ce-Fi)<=t.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Fi))&&Math.abs(he-pi)<=t.EPSILON*Math.max(1,Math.abs(he),Math.abs(pi))&&Math.abs(Se-Tn)<=t.EPSILON*Math.max(1,Math.abs(Se),Math.abs(Tn))&&Math.abs($e-ln)<=t.EPSILON*Math.max(1,Math.abs($e),Math.abs(ln))&&Math.abs(Be-$i)<=t.EPSILON*Math.max(1,Math.abs(Be),Math.abs($i))&&Math.abs(Ve-Di)<=t.EPSILON*Math.max(1,Math.abs(Ve),Math.abs(Di))&&Math.abs(Mt-Kn)<=t.EPSILON*Math.max(1,Math.abs(Mt),Math.abs(Kn))},Fe.sub=Fe.mul=Fe.ortho=Fe.perspective=void 0;var t=function(b,L){if(b&&b.__esModule)return b;if(b===null||a(b)!=="object"&&typeof b!="function")return{default:b};var P=r(void 0);if(P&&P.has(b))return P.get(b);var C={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in b)if(F!=="default"&&Object.prototype.hasOwnProperty.call(b,F)){var q=R?Object.getOwnPropertyDescriptor(b,F):null;q&&(q.get||q.set)?Object.defineProperty(C,F,q):C[F]=b[F]}return C.default=b,P&&P.set(b,C),C}(ze());function r(b){if(typeof WeakMap!="function")return null;var L=new WeakMap,P=new WeakMap;return(r=function(C){return C?P:L})(b)}function h(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function g(b,L,P){var C=L[0],R=L[1],F=L[2],q=L[3],Z=L[4],te=L[5],ie=L[6],K=L[7],ce=L[8],he=L[9],Se=L[10],$e=L[11],Be=L[12],Ve=L[13],Mt=L[14],Ne=L[15],ft=P[0],Pt=P[1],Dt=P[2],Ut=P[3];return b[0]=ft*C+Pt*Z+Dt*ce+Ut*Be,b[1]=ft*R+Pt*te+Dt*he+Ut*Ve,b[2]=ft*F+Pt*ie+Dt*Se+Ut*Mt,b[3]=ft*q+Pt*K+Dt*$e+Ut*Ne,b[4]=(ft=P[4])*C+(Pt=P[5])*Z+(Dt=P[6])*ce+(Ut=P[7])*Be,b[5]=ft*R+Pt*te+Dt*he+Ut*Ve,b[6]=ft*F+Pt*ie+Dt*Se+Ut*Mt,b[7]=ft*q+Pt*K+Dt*$e+Ut*Ne,b[8]=(ft=P[8])*C+(Pt=P[9])*Z+(Dt=P[10])*ce+(Ut=P[11])*Be,b[9]=ft*R+Pt*te+Dt*he+Ut*Ve,b[10]=ft*F+Pt*ie+Dt*Se+Ut*Mt,b[11]=ft*q+Pt*K+Dt*$e+Ut*Ne,b[12]=(ft=P[12])*C+(Pt=P[13])*Z+(Dt=P[14])*ce+(Ut=P[15])*Be,b[13]=ft*R+Pt*te+Dt*he+Ut*Ve,b[14]=ft*F+Pt*ie+Dt*Se+Ut*Mt,b[15]=ft*q+Pt*K+Dt*$e+Ut*Ne,b}function d(b,L,P){var C=L[0],R=L[1],F=L[2],q=L[3],Z=C+C,te=R+R,ie=F+F,K=C*Z,ce=C*te,he=C*ie,Se=R*te,$e=R*ie,Be=F*ie,Ve=q*Z,Mt=q*te,Ne=q*ie;return b[0]=1-(Se+Be),b[1]=ce+Ne,b[2]=he-Mt,b[3]=0,b[4]=ce-Ne,b[5]=1-(K+Be),b[6]=$e+Ve,b[7]=0,b[8]=he+Mt,b[9]=$e-Ve,b[10]=1-(K+Se),b[11]=0,b[12]=P[0],b[13]=P[1],b[14]=P[2],b[15]=1,b}function _(b,L){var P=L[4],C=L[5],R=L[6],F=L[8],q=L[9],Z=L[10];return b[0]=Math.hypot(L[0],L[1],L[2]),b[1]=Math.hypot(P,C,R),b[2]=Math.hypot(F,q,Z),b}function T(b,L,P,C,R){var F,q=1/Math.tan(L/2);return b[0]=q/P,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=q,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,R!=null&&R!==1/0?(b[10]=(R+C)*(F=1/(C-R)),b[14]=2*R*C*F):(b[10]=-1,b[14]=-2*C),b}function I(b,L,P,C,R,F,q){var Z=1/(L-P),te=1/(C-R),ie=1/(F-q);return b[0]=-2*Z,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*te,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=2*ie,b[11]=0,b[12]=(L+P)*Z,b[13]=(R+C)*te,b[14]=(q+F)*ie,b[15]=1,b}function z(b,L,P){return b[0]=L[0]-P[0],b[1]=L[1]-P[1],b[2]=L[2]-P[2],b[3]=L[3]-P[3],b[4]=L[4]-P[4],b[5]=L[5]-P[5],b[6]=L[6]-P[6],b[7]=L[7]-P[7],b[8]=L[8]-P[8],b[9]=L[9]-P[9],b[10]=L[10]-P[10],b[11]=L[11]-P[11],b[12]=L[12]-P[12],b[13]=L[13]-P[13],b[14]=L[14]-P[14],b[15]=L[15]-P[15],b}return Fe.perspective=T,Fe.ortho=I,Fe.mul=g,Fe.sub=z,Fe}var Xe,qe={},gt={};function lt(){if(Xe)return gt;function a(R){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},a(R)}Xe=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=h,gt.clone=function(R){var F=new t.ARRAY_TYPE(3);return F[0]=R[0],F[1]=R[1],F[2]=R[2],F},gt.length=g,gt.fromValues=function(R,F,q){var Z=new t.ARRAY_TYPE(3);return Z[0]=R,Z[1]=F,Z[2]=q,Z},gt.copy=function(R,F){return R[0]=F[0],R[1]=F[1],R[2]=F[2],R},gt.set=function(R,F,q,Z){return R[0]=F,R[1]=q,R[2]=Z,R},gt.add=function(R,F,q){return R[0]=F[0]+q[0],R[1]=F[1]+q[1],R[2]=F[2]+q[2],R},gt.subtract=d,gt.multiply=_,gt.divide=T,gt.ceil=function(R,F){return R[0]=Math.ceil(F[0]),R[1]=Math.ceil(F[1]),R[2]=Math.ceil(F[2]),R},gt.floor=function(R,F){return R[0]=Math.floor(F[0]),R[1]=Math.floor(F[1]),R[2]=Math.floor(F[2]),R},gt.min=function(R,F,q){return R[0]=Math.min(F[0],q[0]),R[1]=Math.min(F[1],q[1]),R[2]=Math.min(F[2],q[2]),R},gt.max=function(R,F,q){return R[0]=Math.max(F[0],q[0]),R[1]=Math.max(F[1],q[1]),R[2]=Math.max(F[2],q[2]),R},gt.round=function(R,F){return R[0]=Math.round(F[0]),R[1]=Math.round(F[1]),R[2]=Math.round(F[2]),R},gt.scale=function(R,F,q){return R[0]=F[0]*q,R[1]=F[1]*q,R[2]=F[2]*q,R},gt.scaleAndAdd=function(R,F,q,Z){return R[0]=F[0]+q[0]*Z,R[1]=F[1]+q[1]*Z,R[2]=F[2]+q[2]*Z,R},gt.distance=I,gt.squaredDistance=z,gt.squaredLength=b,gt.negate=function(R,F){return R[0]=-F[0],R[1]=-F[1],R[2]=-F[2],R},gt.inverse=function(R,F){return R[0]=1/F[0],R[1]=1/F[1],R[2]=1/F[2],R},gt.normalize=function(R,F){var q=F[0],Z=F[1],te=F[2],ie=q*q+Z*Z+te*te;return ie>0&&(ie=1/Math.sqrt(ie)),R[0]=F[0]*ie,R[1]=F[1]*ie,R[2]=F[2]*ie,R},gt.dot=L,gt.cross=function(R,F,q){var Z=F[0],te=F[1],ie=F[2],K=q[0],ce=q[1],he=q[2];return R[0]=te*he-ie*ce,R[1]=ie*K-Z*he,R[2]=Z*ce-te*K,R},gt.lerp=function(R,F,q,Z){var te=F[0],ie=F[1],K=F[2];return R[0]=te+Z*(q[0]-te),R[1]=ie+Z*(q[1]-ie),R[2]=K+Z*(q[2]-K),R},gt.hermite=function(R,F,q,Z,te,ie){var K=ie*ie,ce=K*(2*ie-3)+1,he=K*(ie-2)+ie,Se=K*(ie-1),$e=K*(3-2*ie);return R[0]=F[0]*ce+q[0]*he+Z[0]*Se+te[0]*$e,R[1]=F[1]*ce+q[1]*he+Z[1]*Se+te[1]*$e,R[2]=F[2]*ce+q[2]*he+Z[2]*Se+te[2]*$e,R},gt.bezier=function(R,F,q,Z,te,ie){var K=1-ie,ce=K*K,he=ie*ie,Se=ce*K,$e=3*ie*ce,Be=3*he*K,Ve=he*ie;return R[0]=F[0]*Se+q[0]*$e+Z[0]*Be+te[0]*Ve,R[1]=F[1]*Se+q[1]*$e+Z[1]*Be+te[1]*Ve,R[2]=F[2]*Se+q[2]*$e+Z[2]*Be+te[2]*Ve,R},gt.random=function(R,F){F=F||1;var q=2*t.RANDOM()*Math.PI,Z=2*t.RANDOM()-1,te=Math.sqrt(1-Z*Z)*F;return R[0]=Math.cos(q)*te,R[1]=Math.sin(q)*te,R[2]=Z*F,R},gt.transformMat4=function(R,F,q){var Z=F[0],te=F[1],ie=F[2],K=q[3]*Z+q[7]*te+q[11]*ie+q[15];return R[0]=(q[0]*Z+q[4]*te+q[8]*ie+q[12])/(K=K||1),R[1]=(q[1]*Z+q[5]*te+q[9]*ie+q[13])/K,R[2]=(q[2]*Z+q[6]*te+q[10]*ie+q[14])/K,R},gt.transformMat3=function(R,F,q){var Z=F[0],te=F[1],ie=F[2];return R[0]=Z*q[0]+te*q[3]+ie*q[6],R[1]=Z*q[1]+te*q[4]+ie*q[7],R[2]=Z*q[2]+te*q[5]+ie*q[8],R},gt.transformQuat=function(R,F,q){var Z=q[0],te=q[1],ie=q[2],K=F[0],ce=F[1],he=F[2],Se=te*he-ie*ce,$e=ie*K-Z*he,Be=Z*ce-te*K,Ve=te*Be-ie*$e,Mt=ie*Se-Z*Be,Ne=Z*$e-te*Se,ft=2*q[3];return $e*=ft,Be*=ft,Mt*=2,Ne*=2,R[0]=K+(Se*=ft)+(Ve*=2),R[1]=ce+$e+Mt,R[2]=he+Be+Ne,R},gt.rotateX=function(R,F,q,Z){var te=[],ie=[];return te[0]=F[0]-q[0],te[1]=F[1]-q[1],te[2]=F[2]-q[2],ie[0]=te[0],ie[1]=te[1]*Math.cos(Z)-te[2]*Math.sin(Z),ie[2]=te[1]*Math.sin(Z)+te[2]*Math.cos(Z),R[0]=ie[0]+q[0],R[1]=ie[1]+q[1],R[2]=ie[2]+q[2],R},gt.rotateY=function(R,F,q,Z){var te=[],ie=[];return te[0]=F[0]-q[0],te[1]=F[1]-q[1],te[2]=F[2]-q[2],ie[0]=te[2]*Math.sin(Z)+te[0]*Math.cos(Z),ie[1]=te[1],ie[2]=te[2]*Math.cos(Z)-te[0]*Math.sin(Z),R[0]=ie[0]+q[0],R[1]=ie[1]+q[1],R[2]=ie[2]+q[2],R},gt.rotateZ=function(R,F,q,Z){var te=[],ie=[];return te[0]=F[0]-q[0],te[1]=F[1]-q[1],te[2]=F[2]-q[2],ie[0]=te[0]*Math.cos(Z)-te[1]*Math.sin(Z),ie[1]=te[0]*Math.sin(Z)+te[1]*Math.cos(Z),ie[2]=te[2],R[0]=ie[0]+q[0],R[1]=ie[1]+q[1],R[2]=ie[2]+q[2],R},gt.angle=function(R,F){var q=R[0],Z=R[1],te=R[2],ie=F[0],K=F[1],ce=F[2],he=Math.sqrt(q*q+Z*Z+te*te)*Math.sqrt(ie*ie+K*K+ce*ce),Se=he&&L(R,F)/he;return Math.acos(Math.min(Math.max(Se,-1),1))},gt.zero=function(R){return R[0]=0,R[1]=0,R[2]=0,R},gt.str=function(R){return"vec3("+R[0]+", "+R[1]+", "+R[2]+")"},gt.exactEquals=function(R,F){return R[0]===F[0]&&R[1]===F[1]&&R[2]===F[2]},gt.equals=function(R,F){var q=R[0],Z=R[1],te=R[2],ie=F[0],K=F[1],ce=F[2];return Math.abs(q-ie)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(ie))&&Math.abs(Z-K)<=t.EPSILON*Math.max(1,Math.abs(Z),Math.abs(K))&&Math.abs(te-ce)<=t.EPSILON*Math.max(1,Math.abs(te),Math.abs(ce))},gt.forEach=gt.sqrLen=gt.len=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=void 0;var t=function(R,F){if(R&&R.__esModule)return R;if(R===null||a(R)!=="object"&&typeof R!="function")return{default:R};var q=r(void 0);if(q&&q.has(R))return q.get(R);var Z={},te=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ie in R)if(ie!=="default"&&Object.prototype.hasOwnProperty.call(R,ie)){var K=te?Object.getOwnPropertyDescriptor(R,ie):null;K&&(K.get||K.set)?Object.defineProperty(Z,ie,K):Z[ie]=R[ie]}return Z.default=R,q&&q.set(R,Z),Z}(ze());function r(R){if(typeof WeakMap!="function")return null;var F=new WeakMap,q=new WeakMap;return(r=function(Z){return Z?q:F})(R)}function h(){var R=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(R[0]=0,R[1]=0,R[2]=0),R}function g(R){return Math.hypot(R[0],R[1],R[2])}function d(R,F,q){return R[0]=F[0]-q[0],R[1]=F[1]-q[1],R[2]=F[2]-q[2],R}function _(R,F,q){return R[0]=F[0]*q[0],R[1]=F[1]*q[1],R[2]=F[2]*q[2],R}function T(R,F,q){return R[0]=F[0]/q[0],R[1]=F[1]/q[1],R[2]=F[2]/q[2],R}function I(R,F){return Math.hypot(F[0]-R[0],F[1]-R[1],F[2]-R[2])}function z(R,F){var q=F[0]-R[0],Z=F[1]-R[1],te=F[2]-R[2];return q*q+Z*Z+te*te}function b(R){var F=R[0],q=R[1],Z=R[2];return F*F+q*q+Z*Z}function L(R,F){return R[0]*F[0]+R[1]*F[1]+R[2]*F[2]}gt.sub=d,gt.mul=_,gt.div=T,gt.dist=I,gt.sqrDist=z,gt.len=g,gt.sqrLen=b;var P,C=(P=h(),function(R,F,q,Z,te,ie){var K,ce;for(F||(F=3),q||(q=0),ce=Z?Math.min(Z*F+q,R.length):R.length,K=q;K<ce;K+=F)P[0]=R[K],P[1]=R[K+1],P[2]=R[K+2],te(P,P,ie),R[K]=P[0],R[K+1]=P[1],R[K+2]=P[2];return R});return gt.forEach=C,gt}var vt,Jt,le={};function we(){if(vt)return le;function a(C){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},a(C)}vt=1,Object.defineProperty(le,"__esModule",{value:!0}),le.create=h,le.clone=function(C){var R=new t.ARRAY_TYPE(4);return R[0]=C[0],R[1]=C[1],R[2]=C[2],R[3]=C[3],R},le.fromValues=function(C,R,F,q){var Z=new t.ARRAY_TYPE(4);return Z[0]=C,Z[1]=R,Z[2]=F,Z[3]=q,Z},le.copy=function(C,R){return C[0]=R[0],C[1]=R[1],C[2]=R[2],C[3]=R[3],C},le.set=function(C,R,F,q,Z){return C[0]=R,C[1]=F,C[2]=q,C[3]=Z,C},le.add=function(C,R,F){return C[0]=R[0]+F[0],C[1]=R[1]+F[1],C[2]=R[2]+F[2],C[3]=R[3]+F[3],C},le.subtract=g,le.multiply=d,le.divide=_,le.ceil=function(C,R){return C[0]=Math.ceil(R[0]),C[1]=Math.ceil(R[1]),C[2]=Math.ceil(R[2]),C[3]=Math.ceil(R[3]),C},le.floor=function(C,R){return C[0]=Math.floor(R[0]),C[1]=Math.floor(R[1]),C[2]=Math.floor(R[2]),C[3]=Math.floor(R[3]),C},le.min=function(C,R,F){return C[0]=Math.min(R[0],F[0]),C[1]=Math.min(R[1],F[1]),C[2]=Math.min(R[2],F[2]),C[3]=Math.min(R[3],F[3]),C},le.max=function(C,R,F){return C[0]=Math.max(R[0],F[0]),C[1]=Math.max(R[1],F[1]),C[2]=Math.max(R[2],F[2]),C[3]=Math.max(R[3],F[3]),C},le.round=function(C,R){return C[0]=Math.round(R[0]),C[1]=Math.round(R[1]),C[2]=Math.round(R[2]),C[3]=Math.round(R[3]),C},le.scale=function(C,R,F){return C[0]=R[0]*F,C[1]=R[1]*F,C[2]=R[2]*F,C[3]=R[3]*F,C},le.scaleAndAdd=function(C,R,F,q){return C[0]=R[0]+F[0]*q,C[1]=R[1]+F[1]*q,C[2]=R[2]+F[2]*q,C[3]=R[3]+F[3]*q,C},le.distance=T,le.squaredDistance=I,le.length=z,le.squaredLength=b,le.negate=function(C,R){return C[0]=-R[0],C[1]=-R[1],C[2]=-R[2],C[3]=-R[3],C},le.inverse=function(C,R){return C[0]=1/R[0],C[1]=1/R[1],C[2]=1/R[2],C[3]=1/R[3],C},le.normalize=function(C,R){var F=R[0],q=R[1],Z=R[2],te=R[3],ie=F*F+q*q+Z*Z+te*te;return ie>0&&(ie=1/Math.sqrt(ie)),C[0]=F*ie,C[1]=q*ie,C[2]=Z*ie,C[3]=te*ie,C},le.dot=function(C,R){return C[0]*R[0]+C[1]*R[1]+C[2]*R[2]+C[3]*R[3]},le.cross=function(C,R,F,q){var Z=F[0]*q[1]-F[1]*q[0],te=F[0]*q[2]-F[2]*q[0],ie=F[0]*q[3]-F[3]*q[0],K=F[1]*q[2]-F[2]*q[1],ce=F[1]*q[3]-F[3]*q[1],he=F[2]*q[3]-F[3]*q[2],Se=R[0],$e=R[1],Be=R[2],Ve=R[3];return C[0]=$e*he-Be*ce+Ve*K,C[1]=-Se*he+Be*ie-Ve*te,C[2]=Se*ce-$e*ie+Ve*Z,C[3]=-Se*K+$e*te-Be*Z,C},le.lerp=function(C,R,F,q){var Z=R[0],te=R[1],ie=R[2],K=R[3];return C[0]=Z+q*(F[0]-Z),C[1]=te+q*(F[1]-te),C[2]=ie+q*(F[2]-ie),C[3]=K+q*(F[3]-K),C},le.random=function(C,R){var F,q,Z,te,ie,K;R=R||1;do ie=(F=2*t.RANDOM()-1)*F+(q=2*t.RANDOM()-1)*q;while(ie>=1);do K=(Z=2*t.RANDOM()-1)*Z+(te=2*t.RANDOM()-1)*te;while(K>=1);var ce=Math.sqrt((1-ie)/K);return C[0]=R*F,C[1]=R*q,C[2]=R*Z*ce,C[3]=R*te*ce,C},le.transformMat4=function(C,R,F){var q=R[0],Z=R[1],te=R[2],ie=R[3];return C[0]=F[0]*q+F[4]*Z+F[8]*te+F[12]*ie,C[1]=F[1]*q+F[5]*Z+F[9]*te+F[13]*ie,C[2]=F[2]*q+F[6]*Z+F[10]*te+F[14]*ie,C[3]=F[3]*q+F[7]*Z+F[11]*te+F[15]*ie,C},le.transformQuat=function(C,R,F){var q=R[0],Z=R[1],te=R[2],ie=F[0],K=F[1],ce=F[2],he=F[3],Se=he*q+K*te-ce*Z,$e=he*Z+ce*q-ie*te,Be=he*te+ie*Z-K*q,Ve=-ie*q-K*Z-ce*te;return C[0]=Se*he+Ve*-ie+$e*-ce-Be*-K,C[1]=$e*he+Ve*-K+Be*-ie-Se*-ce,C[2]=Be*he+Ve*-ce+Se*-K-$e*-ie,C[3]=R[3],C},le.zero=function(C){return C[0]=0,C[1]=0,C[2]=0,C[3]=0,C},le.str=function(C){return"vec4("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+")"},le.exactEquals=function(C,R){return C[0]===R[0]&&C[1]===R[1]&&C[2]===R[2]&&C[3]===R[3]},le.equals=function(C,R){var F=C[0],q=C[1],Z=C[2],te=C[3],ie=R[0],K=R[1],ce=R[2],he=R[3];return Math.abs(F-ie)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(ie))&&Math.abs(q-K)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(K))&&Math.abs(Z-ce)<=t.EPSILON*Math.max(1,Math.abs(Z),Math.abs(ce))&&Math.abs(te-he)<=t.EPSILON*Math.max(1,Math.abs(te),Math.abs(he))},le.forEach=le.sqrLen=le.len=le.sqrDist=le.dist=le.div=le.mul=le.sub=void 0;var t=function(C,R){if(C&&C.__esModule)return C;if(C===null||a(C)!=="object"&&typeof C!="function")return{default:C};var F=r(void 0);if(F&&F.has(C))return F.get(C);var q={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var te in C)if(te!=="default"&&Object.prototype.hasOwnProperty.call(C,te)){var ie=Z?Object.getOwnPropertyDescriptor(C,te):null;ie&&(ie.get||ie.set)?Object.defineProperty(q,te,ie):q[te]=C[te]}return q.default=C,F&&F.set(C,q),q}(ze());function r(C){if(typeof WeakMap!="function")return null;var R=new WeakMap,F=new WeakMap;return(r=function(q){return q?F:R})(C)}function h(){var C=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[3]=0),C}function g(C,R,F){return C[0]=R[0]-F[0],C[1]=R[1]-F[1],C[2]=R[2]-F[2],C[3]=R[3]-F[3],C}function d(C,R,F){return C[0]=R[0]*F[0],C[1]=R[1]*F[1],C[2]=R[2]*F[2],C[3]=R[3]*F[3],C}function _(C,R,F){return C[0]=R[0]/F[0],C[1]=R[1]/F[1],C[2]=R[2]/F[2],C[3]=R[3]/F[3],C}function T(C,R){return Math.hypot(R[0]-C[0],R[1]-C[1],R[2]-C[2],R[3]-C[3])}function I(C,R){var F=R[0]-C[0],q=R[1]-C[1],Z=R[2]-C[2],te=R[3]-C[3];return F*F+q*q+Z*Z+te*te}function z(C){return Math.hypot(C[0],C[1],C[2],C[3])}function b(C){var R=C[0],F=C[1],q=C[2],Z=C[3];return R*R+F*F+q*q+Z*Z}le.sub=g,le.mul=d,le.div=_,le.dist=T,le.sqrDist=I,le.len=z,le.sqrLen=b;var L,P=(L=h(),function(C,R,F,q,Z,te){var ie,K;for(R||(R=4),F||(F=0),K=q?Math.min(q*R+F,C.length):C.length,ie=F;ie<K;ie+=R)L[0]=C[ie],L[1]=C[ie+1],L[2]=C[ie+2],L[3]=C[ie+3],Z(L,L,te),C[ie]=L[0],C[ie+1]=L[1],C[ie+2]=L[2],C[ie+3]=L[3];return C});return le.forEach=P,le}function xe(){if(Jt)return qe;function a(Ne){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ft){return typeof ft}:function(ft){return ft&&typeof Symbol=="function"&&ft.constructor===Symbol&&ft!==Symbol.prototype?"symbol":typeof ft},a(Ne)}Jt=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=T,qe.identity=function(Ne){return Ne[0]=0,Ne[1]=0,Ne[2]=0,Ne[3]=1,Ne},qe.setAxisAngle=I,qe.getAxisAngle=function(Ne,ft){var Pt=2*Math.acos(ft[3]),Dt=Math.sin(Pt/2);return Dt>t.EPSILON?(Ne[0]=ft[0]/Dt,Ne[1]=ft[1]/Dt,Ne[2]=ft[2]/Dt):(Ne[0]=1,Ne[1]=0,Ne[2]=0),Pt},qe.getAngle=function(Ne,ft){var Pt=F(Ne,ft);return Math.acos(2*Pt*Pt-1)},qe.multiply=z,qe.rotateX=function(Ne,ft,Pt){Pt*=.5;var Dt=ft[0],Ut=ft[1],ei=ft[2],ri=ft[3],Yt=Math.sin(Pt),yi=Math.cos(Pt);return Ne[0]=Dt*yi+ri*Yt,Ne[1]=Ut*yi+ei*Yt,Ne[2]=ei*yi-Ut*Yt,Ne[3]=ri*yi-Dt*Yt,Ne},qe.rotateY=function(Ne,ft,Pt){Pt*=.5;var Dt=ft[0],Ut=ft[1],ei=ft[2],ri=ft[3],Yt=Math.sin(Pt),yi=Math.cos(Pt);return Ne[0]=Dt*yi-ei*Yt,Ne[1]=Ut*yi+ri*Yt,Ne[2]=ei*yi+Dt*Yt,Ne[3]=ri*yi-Ut*Yt,Ne},qe.rotateZ=function(Ne,ft,Pt){Pt*=.5;var Dt=ft[0],Ut=ft[1],ei=ft[2],ri=ft[3],Yt=Math.sin(Pt),yi=Math.cos(Pt);return Ne[0]=Dt*yi+Ut*Yt,Ne[1]=Ut*yi-Dt*Yt,Ne[2]=ei*yi+ri*Yt,Ne[3]=ri*yi-ei*Yt,Ne},qe.calculateW=function(Ne,ft){var Pt=ft[0],Dt=ft[1],Ut=ft[2];return Ne[0]=Pt,Ne[1]=Dt,Ne[2]=Ut,Ne[3]=Math.sqrt(Math.abs(1-Pt*Pt-Dt*Dt-Ut*Ut)),Ne},qe.exp=b,qe.ln=L,qe.pow=function(Ne,ft,Pt){return L(Ne,ft),R(Ne,Ne,Pt),b(Ne,Ne),Ne},qe.slerp=P,qe.random=function(Ne){var ft=t.RANDOM(),Pt=t.RANDOM(),Dt=t.RANDOM(),Ut=Math.sqrt(1-ft),ei=Math.sqrt(ft);return Ne[0]=Ut*Math.sin(2*Math.PI*Pt),Ne[1]=Ut*Math.cos(2*Math.PI*Pt),Ne[2]=ei*Math.sin(2*Math.PI*Dt),Ne[3]=ei*Math.cos(2*Math.PI*Dt),Ne},qe.invert=function(Ne,ft){var Pt=ft[0],Dt=ft[1],Ut=ft[2],ei=ft[3],ri=Pt*Pt+Dt*Dt+Ut*Ut+ei*ei,Yt=ri?1/ri:0;return Ne[0]=-Pt*Yt,Ne[1]=-Dt*Yt,Ne[2]=-Ut*Yt,Ne[3]=ei*Yt,Ne},qe.conjugate=function(Ne,ft){return Ne[0]=-ft[0],Ne[1]=-ft[1],Ne[2]=-ft[2],Ne[3]=ft[3],Ne},qe.fromMat3=C,qe.fromEuler=function(Ne,ft,Pt,Dt){var Ut=.5*Math.PI/180;ft*=Ut,Pt*=Ut,Dt*=Ut;var ei=Math.sin(ft),ri=Math.cos(ft),Yt=Math.sin(Pt),yi=Math.cos(Pt),Fi=Math.sin(Dt),pi=Math.cos(Dt);return Ne[0]=ei*yi*pi-ri*Yt*Fi,Ne[1]=ri*Yt*pi+ei*yi*Fi,Ne[2]=ri*yi*Fi-ei*Yt*pi,Ne[3]=ri*yi*pi+ei*Yt*Fi,Ne},qe.str=function(Ne){return"quat("+Ne[0]+", "+Ne[1]+", "+Ne[2]+", "+Ne[3]+")"},qe.setAxes=qe.sqlerp=qe.rotationTo=qe.equals=qe.exactEquals=qe.normalize=qe.sqrLen=qe.squaredLength=qe.len=qe.length=qe.lerp=qe.dot=qe.scale=qe.mul=qe.add=qe.set=qe.copy=qe.fromValues=qe.clone=void 0;var t=_(ze()),r=_(pt()),h=_(lt()),g=_(we());function d(Ne){if(typeof WeakMap!="function")return null;var ft=new WeakMap,Pt=new WeakMap;return(d=function(Dt){return Dt?Pt:ft})(Ne)}function _(Ne,ft){if(Ne&&Ne.__esModule)return Ne;if(Ne===null||a(Ne)!=="object"&&typeof Ne!="function")return{default:Ne};var Pt=d(ft);if(Pt&&Pt.has(Ne))return Pt.get(Ne);var Dt={},Ut=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ei in Ne)if(ei!=="default"&&Object.prototype.hasOwnProperty.call(Ne,ei)){var ri=Ut?Object.getOwnPropertyDescriptor(Ne,ei):null;ri&&(ri.get||ri.set)?Object.defineProperty(Dt,ei,ri):Dt[ei]=Ne[ei]}return Dt.default=Ne,Pt&&Pt.set(Ne,Dt),Dt}function T(){var Ne=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(Ne[0]=0,Ne[1]=0,Ne[2]=0),Ne[3]=1,Ne}function I(Ne,ft,Pt){Pt*=.5;var Dt=Math.sin(Pt);return Ne[0]=Dt*ft[0],Ne[1]=Dt*ft[1],Ne[2]=Dt*ft[2],Ne[3]=Math.cos(Pt),Ne}function z(Ne,ft,Pt){var Dt=ft[0],Ut=ft[1],ei=ft[2],ri=ft[3],Yt=Pt[0],yi=Pt[1],Fi=Pt[2],pi=Pt[3];return Ne[0]=Dt*pi+ri*Yt+Ut*Fi-ei*yi,Ne[1]=Ut*pi+ri*yi+ei*Yt-Dt*Fi,Ne[2]=ei*pi+ri*Fi+Dt*yi-Ut*Yt,Ne[3]=ri*pi-Dt*Yt-Ut*yi-ei*Fi,Ne}function b(Ne,ft){var Pt=ft[0],Dt=ft[1],Ut=ft[2],ei=ft[3],ri=Math.sqrt(Pt*Pt+Dt*Dt+Ut*Ut),Yt=Math.exp(ei),yi=ri>0?Yt*Math.sin(ri)/ri:0;return Ne[0]=Pt*yi,Ne[1]=Dt*yi,Ne[2]=Ut*yi,Ne[3]=Yt*Math.cos(ri),Ne}function L(Ne,ft){var Pt=ft[0],Dt=ft[1],Ut=ft[2],ei=ft[3],ri=Math.sqrt(Pt*Pt+Dt*Dt+Ut*Ut),Yt=ri>0?Math.atan2(ri,ei)/ri:0;return Ne[0]=Pt*Yt,Ne[1]=Dt*Yt,Ne[2]=Ut*Yt,Ne[3]=.5*Math.log(Pt*Pt+Dt*Dt+Ut*Ut+ei*ei),Ne}function P(Ne,ft,Pt,Dt){var Ut,ei,ri,Yt,yi,Fi=ft[0],pi=ft[1],Tn=ft[2],ln=ft[3],$i=Pt[0],Di=Pt[1],Kn=Pt[2],bn=Pt[3];return(ei=Fi*$i+pi*Di+Tn*Kn+ln*bn)<0&&(ei=-ei,$i=-$i,Di=-Di,Kn=-Kn,bn=-bn),1-ei>t.EPSILON?(Ut=Math.acos(ei),ri=Math.sin(Ut),Yt=Math.sin((1-Dt)*Ut)/ri,yi=Math.sin(Dt*Ut)/ri):(Yt=1-Dt,yi=Dt),Ne[0]=Yt*Fi+yi*$i,Ne[1]=Yt*pi+yi*Di,Ne[2]=Yt*Tn+yi*Kn,Ne[3]=Yt*ln+yi*bn,Ne}function C(Ne,ft){var Pt,Dt=ft[0]+ft[4]+ft[8];if(Dt>0)Pt=Math.sqrt(Dt+1),Ne[3]=.5*Pt,Ne[0]=(ft[5]-ft[7])*(Pt=.5/Pt),Ne[1]=(ft[6]-ft[2])*Pt,Ne[2]=(ft[1]-ft[3])*Pt;else{var Ut=0;ft[4]>ft[0]&&(Ut=1),ft[8]>ft[3*Ut+Ut]&&(Ut=2);var ei=(Ut+1)%3,ri=(Ut+2)%3;Pt=Math.sqrt(ft[3*Ut+Ut]-ft[3*ei+ei]-ft[3*ri+ri]+1),Ne[Ut]=.5*Pt,Ne[3]=(ft[3*ei+ri]-ft[3*ri+ei])*(Pt=.5/Pt),Ne[ei]=(ft[3*ei+Ut]+ft[3*Ut+ei])*Pt,Ne[ri]=(ft[3*ri+Ut]+ft[3*Ut+ri])*Pt}return Ne}qe.clone=g.clone,qe.fromValues=g.fromValues,qe.copy=g.copy,qe.set=g.set,qe.add=g.add,qe.mul=z;var R=g.scale;qe.scale=R;var F=g.dot;qe.dot=F,qe.lerp=g.lerp;var q=g.length;qe.length=q,qe.len=q;var Z=g.squaredLength;qe.squaredLength=Z,qe.sqrLen=Z;var te=g.normalize;qe.normalize=te,qe.exactEquals=g.exactEquals,qe.equals=g.equals;var ie,K,ce,he=(ie=h.create(),K=h.fromValues(1,0,0),ce=h.fromValues(0,1,0),function(Ne,ft,Pt){var Dt=h.dot(ft,Pt);return Dt<-.999999?(h.cross(ie,K,ft),h.len(ie)<1e-6&&h.cross(ie,ce,ft),h.normalize(ie,ie),I(Ne,ie,Math.PI),Ne):Dt>.999999?(Ne[0]=0,Ne[1]=0,Ne[2]=0,Ne[3]=1,Ne):(h.cross(ie,ft,Pt),Ne[0]=ie[0],Ne[1]=ie[1],Ne[2]=ie[2],Ne[3]=1+Dt,te(Ne,Ne))});qe.rotationTo=he;var Se,$e,Be=(Se=T(),$e=T(),function(Ne,ft,Pt,Dt,Ut,ei){return P(Se,ft,Ut,ei),P($e,Pt,Dt,ei),P(Ne,Se,$e,2*ei*(1-ei)),Ne});qe.sqlerp=Be;var Ve,Mt=(Ve=r.create(),function(Ne,ft,Pt,Dt){return Ve[0]=Pt[0],Ve[3]=Pt[1],Ve[6]=Pt[2],Ve[1]=Dt[0],Ve[4]=Dt[1],Ve[7]=Dt[2],Ve[2]=-ft[0],Ve[5]=-ft[1],Ve[8]=-ft[2],te(Ne,C(Ne,Ve))});return qe.setAxes=Mt,qe}var De,Ce={};function Gt(){if(De)return Ce;function a(P){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},a(P)}De=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.create=function(){var P=new t.ARRAY_TYPE(8);return t.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0,P[4]=0,P[5]=0,P[6]=0,P[7]=0),P[3]=1,P},Ce.clone=function(P){var C=new t.ARRAY_TYPE(8);return C[0]=P[0],C[1]=P[1],C[2]=P[2],C[3]=P[3],C[4]=P[4],C[5]=P[5],C[6]=P[6],C[7]=P[7],C},Ce.fromValues=function(P,C,R,F,q,Z,te,ie){var K=new t.ARRAY_TYPE(8);return K[0]=P,K[1]=C,K[2]=R,K[3]=F,K[4]=q,K[5]=Z,K[6]=te,K[7]=ie,K},Ce.fromRotationTranslationValues=function(P,C,R,F,q,Z,te){var ie=new t.ARRAY_TYPE(8);ie[0]=P,ie[1]=C,ie[2]=R,ie[3]=F;var K=.5*q,ce=.5*Z,he=.5*te;return ie[4]=K*F+ce*R-he*C,ie[5]=ce*F+he*P-K*R,ie[6]=he*F+K*C-ce*P,ie[7]=-K*P-ce*C-he*R,ie},Ce.fromRotationTranslation=_,Ce.fromTranslation=function(P,C){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=.5*C[0],P[5]=.5*C[1],P[6]=.5*C[2],P[7]=0,P},Ce.fromRotation=function(P,C){return P[0]=C[0],P[1]=C[1],P[2]=C[2],P[3]=C[3],P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},Ce.fromMat4=function(P,C){var R=r.create();h.getRotation(R,C);var F=new t.ARRAY_TYPE(3);return h.getTranslation(F,C),_(P,R,F),P},Ce.copy=T,Ce.identity=function(P){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},Ce.set=function(P,C,R,F,q,Z,te,ie,K){return P[0]=C,P[1]=R,P[2]=F,P[3]=q,P[4]=Z,P[5]=te,P[6]=ie,P[7]=K,P},Ce.getDual=function(P,C){return P[0]=C[4],P[1]=C[5],P[2]=C[6],P[3]=C[7],P},Ce.setDual=function(P,C){return P[4]=C[0],P[5]=C[1],P[6]=C[2],P[7]=C[3],P},Ce.getTranslation=function(P,C){var R=C[4],F=C[5],q=C[6],Z=C[7],te=-C[0],ie=-C[1],K=-C[2],ce=C[3];return P[0]=2*(R*ce+Z*te+F*K-q*ie),P[1]=2*(F*ce+Z*ie+q*te-R*K),P[2]=2*(q*ce+Z*K+R*ie-F*te),P},Ce.translate=function(P,C,R){var F=C[0],q=C[1],Z=C[2],te=C[3],ie=.5*R[0],K=.5*R[1],ce=.5*R[2],he=C[4],Se=C[5],$e=C[6],Be=C[7];return P[0]=F,P[1]=q,P[2]=Z,P[3]=te,P[4]=te*ie+q*ce-Z*K+he,P[5]=te*K+Z*ie-F*ce+Se,P[6]=te*ce+F*K-q*ie+$e,P[7]=-F*ie-q*K-Z*ce+Be,P},Ce.rotateX=function(P,C,R){var F=-C[0],q=-C[1],Z=-C[2],te=C[3],ie=C[4],K=C[5],ce=C[6],he=C[7],Se=ie*te+he*F+K*Z-ce*q,$e=K*te+he*q+ce*F-ie*Z,Be=ce*te+he*Z+ie*q-K*F,Ve=he*te-ie*F-K*q-ce*Z;return r.rotateX(P,C,R),P[4]=Se*(te=P[3])+Ve*(F=P[0])+$e*(Z=P[2])-Be*(q=P[1]),P[5]=$e*te+Ve*q+Be*F-Se*Z,P[6]=Be*te+Ve*Z+Se*q-$e*F,P[7]=Ve*te-Se*F-$e*q-Be*Z,P},Ce.rotateY=function(P,C,R){var F=-C[0],q=-C[1],Z=-C[2],te=C[3],ie=C[4],K=C[5],ce=C[6],he=C[7],Se=ie*te+he*F+K*Z-ce*q,$e=K*te+he*q+ce*F-ie*Z,Be=ce*te+he*Z+ie*q-K*F,Ve=he*te-ie*F-K*q-ce*Z;return r.rotateY(P,C,R),P[4]=Se*(te=P[3])+Ve*(F=P[0])+$e*(Z=P[2])-Be*(q=P[1]),P[5]=$e*te+Ve*q+Be*F-Se*Z,P[6]=Be*te+Ve*Z+Se*q-$e*F,P[7]=Ve*te-Se*F-$e*q-Be*Z,P},Ce.rotateZ=function(P,C,R){var F=-C[0],q=-C[1],Z=-C[2],te=C[3],ie=C[4],K=C[5],ce=C[6],he=C[7],Se=ie*te+he*F+K*Z-ce*q,$e=K*te+he*q+ce*F-ie*Z,Be=ce*te+he*Z+ie*q-K*F,Ve=he*te-ie*F-K*q-ce*Z;return r.rotateZ(P,C,R),P[4]=Se*(te=P[3])+Ve*(F=P[0])+$e*(Z=P[2])-Be*(q=P[1]),P[5]=$e*te+Ve*q+Be*F-Se*Z,P[6]=Be*te+Ve*Z+Se*q-$e*F,P[7]=Ve*te-Se*F-$e*q-Be*Z,P},Ce.rotateByQuatAppend=function(P,C,R){var F=R[0],q=R[1],Z=R[2],te=R[3],ie=C[0],K=C[1],ce=C[2],he=C[3];return P[0]=ie*te+he*F+K*Z-ce*q,P[1]=K*te+he*q+ce*F-ie*Z,P[2]=ce*te+he*Z+ie*q-K*F,P[3]=he*te-ie*F-K*q-ce*Z,P[4]=(ie=C[4])*te+(he=C[7])*F+(K=C[5])*Z-(ce=C[6])*q,P[5]=K*te+he*q+ce*F-ie*Z,P[6]=ce*te+he*Z+ie*q-K*F,P[7]=he*te-ie*F-K*q-ce*Z,P},Ce.rotateByQuatPrepend=function(P,C,R){var F=C[0],q=C[1],Z=C[2],te=C[3],ie=R[0],K=R[1],ce=R[2],he=R[3];return P[0]=F*he+te*ie+q*ce-Z*K,P[1]=q*he+te*K+Z*ie-F*ce,P[2]=Z*he+te*ce+F*K-q*ie,P[3]=te*he-F*ie-q*K-Z*ce,P[4]=F*(he=R[7])+te*(ie=R[4])+q*(ce=R[6])-Z*(K=R[5]),P[5]=q*he+te*K+Z*ie-F*ce,P[6]=Z*he+te*ce+F*K-q*ie,P[7]=te*he-F*ie-q*K-Z*ce,P},Ce.rotateAroundAxis=function(P,C,R,F){if(Math.abs(F)<t.EPSILON)return T(P,C);var q=Math.hypot(R[0],R[1],R[2]);F*=.5;var Z=Math.sin(F),te=Z*R[0]/q,ie=Z*R[1]/q,K=Z*R[2]/q,ce=Math.cos(F),he=C[0],Se=C[1],$e=C[2],Be=C[3];P[0]=he*ce+Be*te+Se*K-$e*ie,P[1]=Se*ce+Be*ie+$e*te-he*K,P[2]=$e*ce+Be*K+he*ie-Se*te,P[3]=Be*ce-he*te-Se*ie-$e*K;var Ve=C[4],Mt=C[5],Ne=C[6],ft=C[7];return P[4]=Ve*ce+ft*te+Mt*K-Ne*ie,P[5]=Mt*ce+ft*ie+Ne*te-Ve*K,P[6]=Ne*ce+ft*K+Ve*ie-Mt*te,P[7]=ft*ce-Ve*te-Mt*ie-Ne*K,P},Ce.add=function(P,C,R){return P[0]=C[0]+R[0],P[1]=C[1]+R[1],P[2]=C[2]+R[2],P[3]=C[3]+R[3],P[4]=C[4]+R[4],P[5]=C[5]+R[5],P[6]=C[6]+R[6],P[7]=C[7]+R[7],P},Ce.multiply=I,Ce.scale=function(P,C,R){return P[0]=C[0]*R,P[1]=C[1]*R,P[2]=C[2]*R,P[3]=C[3]*R,P[4]=C[4]*R,P[5]=C[5]*R,P[6]=C[6]*R,P[7]=C[7]*R,P},Ce.lerp=function(P,C,R,F){var q=1-F;return z(C,R)<0&&(F=-F),P[0]=C[0]*q+R[0]*F,P[1]=C[1]*q+R[1]*F,P[2]=C[2]*q+R[2]*F,P[3]=C[3]*q+R[3]*F,P[4]=C[4]*q+R[4]*F,P[5]=C[5]*q+R[5]*F,P[6]=C[6]*q+R[6]*F,P[7]=C[7]*q+R[7]*F,P},Ce.invert=function(P,C){var R=L(C);return P[0]=-C[0]/R,P[1]=-C[1]/R,P[2]=-C[2]/R,P[3]=C[3]/R,P[4]=-C[4]/R,P[5]=-C[5]/R,P[6]=-C[6]/R,P[7]=C[7]/R,P},Ce.conjugate=function(P,C){return P[0]=-C[0],P[1]=-C[1],P[2]=-C[2],P[3]=C[3],P[4]=-C[4],P[5]=-C[5],P[6]=-C[6],P[7]=C[7],P},Ce.normalize=function(P,C){var R=L(C);if(R>0){R=Math.sqrt(R);var F=C[0]/R,q=C[1]/R,Z=C[2]/R,te=C[3]/R,ie=C[4],K=C[5],ce=C[6],he=C[7],Se=F*ie+q*K+Z*ce+te*he;P[0]=F,P[1]=q,P[2]=Z,P[3]=te,P[4]=(ie-F*Se)/R,P[5]=(K-q*Se)/R,P[6]=(ce-Z*Se)/R,P[7]=(he-te*Se)/R}return P},Ce.str=function(P){return"quat2("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+", "+P[4]+", "+P[5]+", "+P[6]+", "+P[7]+")"},Ce.exactEquals=function(P,C){return P[0]===C[0]&&P[1]===C[1]&&P[2]===C[2]&&P[3]===C[3]&&P[4]===C[4]&&P[5]===C[5]&&P[6]===C[6]&&P[7]===C[7]},Ce.equals=function(P,C){var R=P[0],F=P[1],q=P[2],Z=P[3],te=P[4],ie=P[5],K=P[6],ce=P[7],he=C[0],Se=C[1],$e=C[2],Be=C[3],Ve=C[4],Mt=C[5],Ne=C[6],ft=C[7];return Math.abs(R-he)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(he))&&Math.abs(F-Se)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(Se))&&Math.abs(q-$e)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs($e))&&Math.abs(Z-Be)<=t.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Be))&&Math.abs(te-Ve)<=t.EPSILON*Math.max(1,Math.abs(te),Math.abs(Ve))&&Math.abs(ie-Mt)<=t.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Mt))&&Math.abs(K-Ne)<=t.EPSILON*Math.max(1,Math.abs(K),Math.abs(Ne))&&Math.abs(ce-ft)<=t.EPSILON*Math.max(1,Math.abs(ce),Math.abs(ft))},Ce.sqrLen=Ce.squaredLength=Ce.len=Ce.length=Ce.dot=Ce.mul=Ce.setReal=Ce.getReal=void 0;var t=d(ze()),r=d(xe()),h=d(et());function g(P){if(typeof WeakMap!="function")return null;var C=new WeakMap,R=new WeakMap;return(g=function(F){return F?R:C})(P)}function d(P,C){if(P&&P.__esModule)return P;if(P===null||a(P)!=="object"&&typeof P!="function")return{default:P};var R=g(C);if(R&&R.has(P))return R.get(P);var F={},q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in P)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(P,Z)){var te=q?Object.getOwnPropertyDescriptor(P,Z):null;te&&(te.get||te.set)?Object.defineProperty(F,Z,te):F[Z]=P[Z]}return F.default=P,R&&R.set(P,F),F}function _(P,C,R){var F=.5*R[0],q=.5*R[1],Z=.5*R[2],te=C[0],ie=C[1],K=C[2],ce=C[3];return P[0]=te,P[1]=ie,P[2]=K,P[3]=ce,P[4]=F*ce+q*K-Z*ie,P[5]=q*ce+Z*te-F*K,P[6]=Z*ce+F*ie-q*te,P[7]=-F*te-q*ie-Z*K,P}function T(P,C){return P[0]=C[0],P[1]=C[1],P[2]=C[2],P[3]=C[3],P[4]=C[4],P[5]=C[5],P[6]=C[6],P[7]=C[7],P}function I(P,C,R){var F=C[0],q=C[1],Z=C[2],te=C[3],ie=R[4],K=R[5],ce=R[6],he=R[7],Se=C[4],$e=C[5],Be=C[6],Ve=C[7],Mt=R[0],Ne=R[1],ft=R[2],Pt=R[3];return P[0]=F*Pt+te*Mt+q*ft-Z*Ne,P[1]=q*Pt+te*Ne+Z*Mt-F*ft,P[2]=Z*Pt+te*ft+F*Ne-q*Mt,P[3]=te*Pt-F*Mt-q*Ne-Z*ft,P[4]=F*he+te*ie+q*ce-Z*K+Se*Pt+Ve*Mt+$e*ft-Be*Ne,P[5]=q*he+te*K+Z*ie-F*ce+$e*Pt+Ve*Ne+Be*Mt-Se*ft,P[6]=Z*he+te*ce+F*K-q*ie+Be*Pt+Ve*ft+Se*Ne-$e*Mt,P[7]=te*he-F*ie-q*K-Z*ce+Ve*Pt-Se*Mt-$e*Ne-Be*ft,P}Ce.getReal=r.copy,Ce.setReal=r.copy,Ce.mul=I;var z=r.dot;Ce.dot=z;var b=r.length;Ce.length=b,Ce.len=b;var L=r.squaredLength;return Ce.squaredLength=L,Ce.sqrLen=L,Ce}var Ft,bt,Vt={};function Ht(){if(Ft)return Vt;function a(C){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},a(C)}Ft=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.create=h,Vt.clone=function(C){var R=new t.ARRAY_TYPE(2);return R[0]=C[0],R[1]=C[1],R},Vt.fromValues=function(C,R){var F=new t.ARRAY_TYPE(2);return F[0]=C,F[1]=R,F},Vt.copy=function(C,R){return C[0]=R[0],C[1]=R[1],C},Vt.set=function(C,R,F){return C[0]=R,C[1]=F,C},Vt.add=function(C,R,F){return C[0]=R[0]+F[0],C[1]=R[1]+F[1],C},Vt.subtract=g,Vt.multiply=d,Vt.divide=_,Vt.ceil=function(C,R){return C[0]=Math.ceil(R[0]),C[1]=Math.ceil(R[1]),C},Vt.floor=function(C,R){return C[0]=Math.floor(R[0]),C[1]=Math.floor(R[1]),C},Vt.min=function(C,R,F){return C[0]=Math.min(R[0],F[0]),C[1]=Math.min(R[1],F[1]),C},Vt.max=function(C,R,F){return C[0]=Math.max(R[0],F[0]),C[1]=Math.max(R[1],F[1]),C},Vt.round=function(C,R){return C[0]=Math.round(R[0]),C[1]=Math.round(R[1]),C},Vt.scale=function(C,R,F){return C[0]=R[0]*F,C[1]=R[1]*F,C},Vt.scaleAndAdd=function(C,R,F,q){return C[0]=R[0]+F[0]*q,C[1]=R[1]+F[1]*q,C},Vt.distance=T,Vt.squaredDistance=I,Vt.length=z,Vt.squaredLength=b,Vt.negate=function(C,R){return C[0]=-R[0],C[1]=-R[1],C},Vt.inverse=function(C,R){return C[0]=1/R[0],C[1]=1/R[1],C},Vt.normalize=function(C,R){var F=R[0],q=R[1],Z=F*F+q*q;return Z>0&&(Z=1/Math.sqrt(Z)),C[0]=R[0]*Z,C[1]=R[1]*Z,C},Vt.dot=function(C,R){return C[0]*R[0]+C[1]*R[1]},Vt.cross=function(C,R,F){var q=R[0]*F[1]-R[1]*F[0];return C[0]=C[1]=0,C[2]=q,C},Vt.lerp=function(C,R,F,q){var Z=R[0],te=R[1];return C[0]=Z+q*(F[0]-Z),C[1]=te+q*(F[1]-te),C},Vt.random=function(C,R){R=R||1;var F=2*t.RANDOM()*Math.PI;return C[0]=Math.cos(F)*R,C[1]=Math.sin(F)*R,C},Vt.transformMat2=function(C,R,F){var q=R[0],Z=R[1];return C[0]=F[0]*q+F[2]*Z,C[1]=F[1]*q+F[3]*Z,C},Vt.transformMat2d=function(C,R,F){var q=R[0],Z=R[1];return C[0]=F[0]*q+F[2]*Z+F[4],C[1]=F[1]*q+F[3]*Z+F[5],C},Vt.transformMat3=function(C,R,F){var q=R[0],Z=R[1];return C[0]=F[0]*q+F[3]*Z+F[6],C[1]=F[1]*q+F[4]*Z+F[7],C},Vt.transformMat4=function(C,R,F){var q=R[0],Z=R[1];return C[0]=F[0]*q+F[4]*Z+F[12],C[1]=F[1]*q+F[5]*Z+F[13],C},Vt.rotate=function(C,R,F,q){var Z=R[0]-F[0],te=R[1]-F[1],ie=Math.sin(q),K=Math.cos(q);return C[0]=Z*K-te*ie+F[0],C[1]=Z*ie+te*K+F[1],C},Vt.angle=function(C,R){var F=C[0],q=C[1],Z=R[0],te=R[1],ie=Math.sqrt(F*F+q*q)*Math.sqrt(Z*Z+te*te);return Math.acos(Math.min(Math.max(ie&&(F*Z+q*te)/ie,-1),1))},Vt.zero=function(C){return C[0]=0,C[1]=0,C},Vt.str=function(C){return"vec2("+C[0]+", "+C[1]+")"},Vt.exactEquals=function(C,R){return C[0]===R[0]&&C[1]===R[1]},Vt.equals=function(C,R){var F=C[0],q=C[1],Z=R[0],te=R[1];return Math.abs(F-Z)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(Z))&&Math.abs(q-te)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(te))},Vt.forEach=Vt.sqrLen=Vt.sqrDist=Vt.dist=Vt.div=Vt.mul=Vt.sub=Vt.len=void 0;var t=function(C,R){if(C&&C.__esModule)return C;if(C===null||a(C)!=="object"&&typeof C!="function")return{default:C};var F=r(void 0);if(F&&F.has(C))return F.get(C);var q={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var te in C)if(te!=="default"&&Object.prototype.hasOwnProperty.call(C,te)){var ie=Z?Object.getOwnPropertyDescriptor(C,te):null;ie&&(ie.get||ie.set)?Object.defineProperty(q,te,ie):q[te]=C[te]}return q.default=C,F&&F.set(C,q),q}(ze());function r(C){if(typeof WeakMap!="function")return null;var R=new WeakMap,F=new WeakMap;return(r=function(q){return q?F:R})(C)}function h(){var C=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0),C}function g(C,R,F){return C[0]=R[0]-F[0],C[1]=R[1]-F[1],C}function d(C,R,F){return C[0]=R[0]*F[0],C[1]=R[1]*F[1],C}function _(C,R,F){return C[0]=R[0]/F[0],C[1]=R[1]/F[1],C}function T(C,R){return Math.hypot(R[0]-C[0],R[1]-C[1])}function I(C,R){var F=R[0]-C[0],q=R[1]-C[1];return F*F+q*q}function z(C){return Math.hypot(C[0],C[1])}function b(C){var R=C[0],F=C[1];return R*R+F*F}Vt.len=z,Vt.sub=g,Vt.mul=d,Vt.div=_,Vt.dist=T,Vt.sqrDist=I,Vt.sqrLen=b;var L,P=(L=h(),function(C,R,F,q,Z,te){var ie,K;for(R||(R=2),F||(F=0),K=q?Math.min(q*R+F,C.length):C.length,ie=F;ie<K;ie+=R)L[0]=C[ie],L[1]=C[ie+1],Z(L,L,te),C[ie]=L[0],C[ie+1]=L[1];return C});return Vt.forEach=P,Vt}function ni(){if(bt)return ne;function a(C){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},a(C)}bt=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.vec4=ne.vec3=ne.vec2=ne.quat2=ne.quat=ne.mat4=ne.mat3=ne.mat2d=ne.mat2=ne.glMatrix=void 0;var t=P(ze());ne.glMatrix=t;var r=P(it());ne.mat2=r;var h=P(st());ne.mat2d=h;var g=P(pt());ne.mat3=g;var d=P(et());ne.mat4=d;var _=P(xe());ne.quat=_;var T=P(Gt());ne.quat2=T;var I=P(Ht());ne.vec2=I;var z=P(lt());ne.vec3=z;var b=P(we());function L(C){if(typeof WeakMap!="function")return null;var R=new WeakMap,F=new WeakMap;return(L=function(q){return q?F:R})(C)}function P(C,R){if(C&&C.__esModule)return C;if(C===null||a(C)!=="object"&&typeof C!="function")return{default:C};var F=L(R);if(F&&F.has(C))return F.get(C);var q={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var te in C)if(te!=="default"&&Object.prototype.hasOwnProperty.call(C,te)){var ie=Z?Object.getOwnPropertyDescriptor(C,te):null;ie&&(ie.get||ie.set)?Object.defineProperty(q,te,ie):q[te]=C[te]}return q.default=C,F&&F.set(C,q),q}return ne.vec4=b,ne}var zi,Hi,on,mn,ot=ni(),Yn=function(){if(Hi)return zi;function a(t,r,h,g){this.cx=3*t,this.bx=3*(h-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(g-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=h,this.p2y=g}return Hi=1,zi=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var h=t,g=0;g<8;g++){var d=this.sampleCurveX(h)-t;if(Math.abs(d)<r)return h;var _=this.sampleCurveDerivativeX(h);if(Math.abs(_)<1e-6)break;h-=d/_}var T=0,I=1;for(h=t,g=0;g<20&&(d=this.sampleCurveX(h),!(Math.abs(d-t)<r));g++)t>d?T=h:I=h,h=.5*(I-T)+T;return h},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},zi}(),pr=X(Yn);function At(){if(mn)return on;function a(t,r){this.x=t,this.y=r}return mn=1,on=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,h=t.y-this.y;return r*r+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),h=Math.sin(t),g=h*this.x+r*this.y;return this.x=r*this.x-h*this.y,this.y=g,this},_rotateAround:function(t,r){var h=Math.cos(t),g=Math.sin(t),d=r.y+g*(this.x-r.x)+h*(this.y-r.y);return this.x=r.x+h*(this.x-r.x)-g*(this.y-r.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t},on}var Ye=X(At());function kt(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(!kt(a[r],t[r]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const r in a)if(!kt(a[r],t[r]))return!1;return!0}return a===t}const Le=Math.PI/180,Ie=180/Math.PI;function Ue(a){return a*Le}function We(a){return a*Ie}const rt=[[0,0],[1,0],[1,1],[0,1]];function ut(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,r=t*a;return 4*(a<.5?r:3*(a-t)+r-.75)}function ht(a,t,r,h){const g=new pr(a,t,r,h);return function(d){return g.solve(d)}}const Lt=ht(.25,.1,.25,1);function It(a,t,r){return Math.min(r,Math.max(t,a))}function ui(a,t,r){return(r=It((r-a)/(t-a),0,1))*r*(3-2*r)}function xi(a,t,r){const h=r-t,g=((a-t)%h+h)%h+t;return g===t?r:g}function an(a,t,r){if(!a.length)return r(null,[]);let h=a.length;const g=new Array(a.length);let d=null;a.forEach((_,T)=>{t(_,(I,z)=>{I&&(d=I),g[T]=z,--h==0&&r(d,g)})})}function cn(a,...t){for(const r of t)for(const h in r)a[h]=r[h];return a}let _n=1;function Fn(){return _n++}function Mn(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function jn(a,t){a.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function Lr(a,t){return a.indexOf(t,a.length-t.length)!==-1}function Tr(a,t,r){const h={};for(const g in a)h[g]=t.call(this,a[g],g,a);return h}function to(a,t,r){const h={};for(const g in a)t.call(this,a[g],g,a)&&(h[g]=a[g]);return h}function $r(a){return Array.isArray(a)?a.map($r):typeof a=="object"&&a?Tr(a,$r):a}const en={};function Wn(a){en[a]||(typeof console<"u"&&console.warn(a),en[a]=!0)}function Ls(a,t,r){return(r.y-a.y)*(t.x-a.x)>(t.y-a.y)*(r.x-a.x)}function To(a){let t=0;for(let r,h,g=0,d=a.length,_=d-1;g<d;_=g++)r=a[g],h=a[_],t+=(h.x-r.x)*(r.y+h.y);return t}function Ro([a,t,r]){const h=Ue(t+90),g=Ue(r);return{x:a*Math.cos(h)*Math.sin(g),y:a*Math.sin(h)*Math.sin(g),z:a*Math.cos(g),azimuthal:t,polar:r}}function _s(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function js(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,h,g,d)=>{const _=g||d;return t[h]=!_||_.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let Dr=null;function ro(a,t){return[a[4*t],a[4*t+1],a[4*t+2],a[4*t+3]]}function po(a,t,r,h){for(;t<r;){const g=t+r>>1;a[g]<h?t=g+1:r=g}return t}function ai(a,t,r,h){for(;t<r;){const g=t+r>>1;a[g]<=h?t=g+1:r=g}return t}function ye(a){return a>0?1/(1.001-a):1+a}function re(a){return a>0?1-1/(1.001-a):-a}const Je={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Je.API_URL)return null;try{const a=new URL(Je.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Rt(a){return Je.API_URL_REGEX.test(a)}function dt(a){return Je.API_SPRITE_REGEX.test(a)}let Nt,oi,Zt,li,mi,fi;function Pi(){return Nt==null&&(Nt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Nt}const tn={now:()=>li!==void 0?li:performance.now(),setNow(a){li=a},restoreNow(){li=void 0},frame(a){const t=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(a,t=0){const{width:r,height:h}=a;mi||(mi=document.createElement("canvas"));const g=mi.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(r>mi.width||h>mi.height)&&(mi.width=r,mi.height=h),g.clearRect(-t,-t,r+2*t,h+2*t),g.drawImage(a,0,0,r,h),g.getImageData(-t,-t,r+2*t,h+2*t)},resolveURL:a=>(oi||(oi=document.createElement("a")),oi.href=a,oi.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Zt==null&&(Zt=window.matchMedia("(prefers-reduced-motion: reduce)")),Zt.matches)},hasCanvasFingerprintNoise(){if(fi!==void 0)return fi;if(!Pi())return fi=!1,!1;const a=new OffscreenCanvas(85,1),t=a.getContext("2d",{willReadFrequently:!0});let r=0;for(let g=0;g<a.width;++g)t.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,t.fillRect(g,0,1,1);const h=t.getImageData(0,0,a.width,a.height);r=0;for(let g=0;g<h.data.length;++g)if(g%4!=3&&r++!==h.data[g])return fi=!0,!0;return fi=!1,!1}};function xn(a,t){const r=a.indexOf("?");if(r<0)return`${a}?${new URLSearchParams(t).toString()}`;const h=new URLSearchParams(a.slice(r));for(const g in t)h.set(g,t[g]);return`${a.slice(0,r)}?${h.toString()}`}function Jn(a,t={persistentParams:[]}){const r=a.indexOf("?");if(r<0)return a;const h=new URLSearchParams,g=new URLSearchParams(a.slice(r));for(const _ of t.persistentParams){const T=g.get(_);T&&h.set(_,T)}const d=h.toString();return`${a.slice(0,r)}${d.length>0?`?${d}`:""}`}const sr="mapbox-tiles";let ar=500,er=50;const Zr=["language","worldview","jobid"];let Gr,yr;function Jr(){try{return caches}catch{}}function us(){const a=Jr();a&&Gr==null&&(Gr=a.open(sr))}let Ns=1/0;const es={supported:!1,testSupport:function(a){!Mo&&Ps&&(Qo?ml(a):Fs=a)}};let Fs,Ps,Mo=!1,Qo=!1;const Ua=typeof self<"u"?self:{};function ml(a){const t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ps),a.isContextLost())return;es.supported=!0}catch{}a.deleteTexture(t),Mo=!0}Ua.document&&(Ps=Ua.document.createElement("img"),Ps.onload=function(){Fs&&ml(Fs),Fs=null,Qo=!0},Ps.onerror=function(){Mo=!0,Fs=null},Ps.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const aa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(aa);class nr extends Error{constructor(t,r,h){r===401&&Rt(h)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const qo=_s()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,go=function(a,t){if(!(/^file:/.test(r=a.url)||/^file:/.test(qo())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,g){const d=new AbortController,_=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:qo(),referrerPolicy:h.referrerPolicy,signal:d.signal});let T=!1,I=!1;const z=(b=_.url).indexOf("sku=")>0&&Rt(b);var b;h.type==="json"&&_.headers.set("Accept","application/json");const L=(C,R,F)=>{if(I)return;if(C&&C.message!=="SecurityError"&&Wn(C.toString()),R&&F)return P(R);const q=Date.now();fetch(_).then(Z=>{if(Z.ok){const te=z?Z.clone():null;return P(Z,te,q)}return g(new nr(Z.statusText,Z.status,h.url))}).catch(Z=>{Z.name!=="AbortError"&&g(new Error(`${Z.message} ${h.url}`))})},P=(C,R,F)=>{(h.type==="arrayBuffer"?C.arrayBuffer():h.type==="json"?C.json():C.text()).then(q=>{I||(R&&F&&function(Z,te,ie){if(us(),Gr==null)return;const K=js(te.headers.get("Cache-Control")||"");if(K["no-store"])return;const ce={status:te.status,statusText:te.statusText,headers:new Headers};te.headers.forEach(($e,Be)=>ce.headers.set(Be,$e)),K["max-age"]&&ce.headers.set("Expires",new Date(ie+1e3*K["max-age"]).toUTCString());const he=ce.headers.get("Expires");if(!he||new Date(he).getTime()-ie<42e4)return;let Se=Jn(Z.url,{persistentParams:Zr});if(te.status===206){const $e=Z.headers.get("Range");if(!$e)return;ce.status=200,Se=xn(Se,{range:$e})}(function($e,Be){if(yr===void 0)try{new Response(new ReadableStream),yr=!0}catch{yr=!1}yr?Be($e.body):$e.blob().then(Be)})(te,$e=>{const Be=new Response((Ve=te.status)!==200&&Ve!==404&&[101,103,204,205,304].includes(Ve)?null:$e,ce);var Ve;us(),Gr!=null&&Gr.then(Mt=>Mt.put(Se,Be)).catch(Mt=>Wn(Mt.message))})}(_,R,F),T=!0,g(null,q,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(q=>{I||g(new Error(q.message))})};return z?function(C,R){if(us(),Gr==null)return R(null);Gr.then(F=>{let q=Jn(C.url,{persistentParams:Zr});const Z=C.headers.get("Range");Z&&(q=xn(q,{range:Z})),F.match(q).then(te=>{const ie=function(K){if(!K)return!1;const ce=new Date(K.headers.get("Expires")||0),he=js(K.headers.get("Cache-Control")||"");return ce>Date.now()&&!he["no-cache"]}(te);F.delete(q),ie&&F.put(q,te.clone()),R(null,te,ie)}).catch(R)}).catch(R)}(_,L):L(null,null),{cancel:()=>{I=!0,T||d.abort()}}}(a,t);if(_s()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var r;return function(h,g){const d=new XMLHttpRequest;d.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const _ in h.headers)d.setRequestHeader(_,h.headers[_]);return h.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=h.credentials==="include",d.onerror=()=>{g(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let _=d.response;if(h.type==="json")try{_=JSON.parse(d.response)}catch(T){return g(T)}g(null,_,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else g(new nr(d.statusText,d.status,h.url))},d.send(h.body),{cancel:()=>d.abort()}}(a,t)},Vo=function(a,t){return go(cn(a,{type:"arrayBuffer"}),t)};function la(a){const t=document.createElement("a");return t.href=a,t.protocol===location.protocol&&t.host===location.host}const _o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let $o,Ws;$o=[],Ws=0;const _a=function(a,t){if(es.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Ws>=Je.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:a,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return $o.push(d),d}Ws++;let r=!1;const h=()=>{if(!r)for(r=!0,Ws--;$o.length&&Ws<Je.MAX_PARALLEL_IMAGE_REQUESTS;){const d=$o.shift(),{requestParameters:_,callback:T,cancelled:I}=d;I||(d.cancel=_a(_,T).cancel)}},g=Vo(a,(d,_,T,I)=>{h(),d?t(d):_&&(self.createImageBitmap?function(z,b){const L=new Blob([new Uint8Array(z)],{type:"image/png"});createImageBitmap(L).then(P=>{b(null,P)}).catch(P=>{b(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(z,b)=>t(z,b,T,I)):function(z,b){const L=new Image;L.onload=()=>{b(null,L),URL.revokeObjectURL(L.src),L.onload=null,requestAnimationFrame(()=>{L.src=_o})},L.onerror=()=>b(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(z)],{type:"image/png"});L.src=z.byteLength?URL.createObjectURL(P):_o}(_,(z,b)=>t(z,b,T,I)))});return{cancel:()=>{g.cancel(),h()}}};var gl,Va,Hl,Us={exports:{}},_l={exports:{}},yl={exports:{}},Ae=function(){if(Hl)return Us.exports;Hl=1;var a=(gl||(gl=1,_l.exports=function(r,h){var g,d,_,T,I,z,b,L;for(d=r.length-(g=3&r.length),_=h,I=3432918353,z=461845907,L=0;L<d;)b=255&r.charCodeAt(L)|(255&r.charCodeAt(++L))<<8|(255&r.charCodeAt(++L))<<16|(255&r.charCodeAt(++L))<<24,++L,_=27492+(65535&(T=5*(65535&(_=(_^=b=(65535&(b=(b=(65535&b)*I+(((b>>>16)*I&65535)<<16)&4294967295)<<15|b>>>17))*z+(((b>>>16)*z&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(b=0,g){case 3:b^=(255&r.charCodeAt(L+2))<<16;case 2:b^=(255&r.charCodeAt(L+1))<<8;case 1:_^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(L)))*I+(((b>>>16)*I&65535)<<16)&4294967295)<<15|b>>>17))*z+(((b>>>16)*z&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),_l.exports),t=(Va||(Va=1,yl.exports=function(r,h){for(var g,d=r.length,_=h^d,T=0;d>=4;)g=1540483477*(65535&(g=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24))+((1540483477*(g>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),d-=4,++T;switch(d){case 3:_^=(255&r.charCodeAt(T+2))<<16;case 2:_^=(255&r.charCodeAt(T+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(T)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),yl.exports);return Us.exports=a,Us.exports.murmur3=a,Us.exports.murmur2=t,Us.exports}(),Me=X(Ae);class je{constructor(t,...r){cn(this,r[0]||{}),this.type=t}}class zt extends je{constructor(t,r={}){super("error",cn({error:t},r))}}function Ai(a,t,r){r[a]&&r[a].indexOf(t)!==-1||(r[a]=r[a]||[],r[a].push(t))}function Ui(a,t,r){if(r&&r[a]){const h=r[a].indexOf(t);h!==-1&&r[a].splice(h,1)}}class bi{on(t,r){return this._listeners=this._listeners||{},Ai(t,r,this._listeners),this}off(t,r){return Ui(t,r,this._listeners),Ui(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ai(t,r,this._oneTimeListeners),this):new Promise(h=>this.once(t,h))}fire(t,r){const h=typeof t=="string"?new je(t,r):t,g=h.type;if(this.listens(g)){h.target=this;const d=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const I of d)I.call(this,h);const _=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const I of _)Ui(g,I,this._oneTimeListeners),I.call(this,h);const T=this._eventedParent;T&&(cn(h,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(h))}else h instanceof zt&&console.error(h.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Yi,fe={},me=function(){if(Yi)return fe;Yi=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(d){return(d=Math.round(d))<0?0:d>255?255:d}function r(d){return t(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function h(d){return(_=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:_>1?1:_;var _}function g(d,_,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?d+(_-d)*T*6:2*T<1?_:3*T<2?d+(_-d)*(2/3-T)*6:d}try{fe.parseCSSColor=function(d){var _,T=d.replace(/ /g,"").toLowerCase();if(T in a)return a[T].slice();if(T[0]==="#")return T.length===4?(_=parseInt(T.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:T.length===7&&(_=parseInt(T.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var I=T.indexOf("("),z=T.indexOf(")");if(I!==-1&&z+1===T.length){var b=T.substr(0,I),L=T.substr(I+1,z-(I+1)).split(","),P=1;switch(b){case"rgba":if(L.length!==4)return null;P=h(L.pop());case"rgb":return L.length!==3?null:[r(L[0]),r(L[1]),r(L[2]),P];case"hsla":if(L.length!==4)return null;P=h(L.pop());case"hsl":if(L.length!==3)return null;var C=(parseFloat(L[0])%360+360)%360/360,R=h(L[1]),F=h(L[2]),q=F<=.5?F*(R+1):F+R-F*R,Z=2*F-q;return[t(255*g(Z,q,C+1/3)),t(255*g(Z,q,C)),t(255*g(Z,q,C-1/3)),P];default:return null}}return null}}catch{}return fe}();class Ee{constructor(t,r,h,g=1){this.r=t,this.g=r,this.b=h,this.a=g}static parse(t){if(!t)return;if(t instanceof Ee)return t;if(typeof t!="string")return;const r=me.parseCSSColor(t);return r?new Ee(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[t,r,h,g]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(r)},${Math.round(h)},${g})`}toRenderColor(t){const{r,g:h,b:g,a:d}=this;return new Ke(t,r,h,g,d)}}class Ke{constructor(t,r,h,g,d){if(t){const _=t.image.height,T=_*_;r=d===0?0:r/d*(_-1),h=d===0?0:h/d*(_-1),g=d===0?0:g/d*(_-1);const I=Math.floor(r),z=Math.floor(h),b=Math.floor(g),L=Math.ceil(r),P=Math.ceil(h),C=Math.ceil(g),R=r-I,F=h-z,q=g-b,Z=t.image.data,te=4*(I+z*T+b*_),ie=4*(I+z*T+C*_),K=4*(I+P*T+b*_),ce=4*(I+P*T+C*_),he=4*(L+z*T+b*_),Se=4*(L+z*T+C*_),$e=4*(L+P*T+b*_),Be=4*(L+P*T+C*_);if(te<0||Be>=Z.length)throw new Error("out of range");this.r=Pe(Pe(Pe(Z[te],Z[ie],q),Pe(Z[K],Z[ce],q),F),Pe(Pe(Z[he],Z[Se],q),Pe(Z[$e],Z[Be],q),F),R)/255*d,this.g=Pe(Pe(Pe(Z[te+1],Z[ie+1],q),Pe(Z[K+1],Z[ce+1],q),F),Pe(Pe(Z[he+1],Z[Se+1],q),Pe(Z[$e+1],Z[Be+1],q),F),R)/255*d,this.b=Pe(Pe(Pe(Z[te+2],Z[ie+2],q),Pe(Z[K+2],Z[ce+2],q),F),Pe(Pe(Z[he+2],Z[Se+2],q),Pe(Z[$e+2],Z[Be+2],q),F),R)/255*d,this.a=d}else this.r=r,this.g=h,this.b=g,this.a=d}toArray(){const{r:t,g:r,b:h,a:g}=this;return g===0?[0,0,0,0]:[255*t/g,255*r/g,255*h/g,g]}toArray01(){const{r:t,g:r,b:h,a:g}=this;return g===0?[0,0,0,0]:[t/g,r/g,h/g,g]}toArray01Scaled(t){const{r,g:h,b:g,a:d}=this;return d===0?[0,0,0]:[r/d*t,h/d*t,g/d*t]}toArray01PremultipliedAlpha(){const{r:t,g:r,b:h,a:g}=this;return[t,r,h,g]}toArray01Linear(){const{r:t,g:r,b:h,a:g}=this;return g===0?[0,0,0,0]:[Math.pow(t/g,2.2),Math.pow(r/g,2.2),Math.pow(h/g,2.2),g]}}function Pe(a,t,r){return a*(1-r)+t*r}function ci(a,t,r){return a.map((h,g)=>Pe(h,t[g],r))}Ee.black=new Ee(0,0,0,1),Ee.white=new Ee(1,1,1,1),Ee.transparent=new Ee(0,0,0,0),Ee.red=new Ee(1,0,0,1),Ee.blue=new Ee(0,0,1,1);var Mi=Object.freeze({__proto__:null,array:ci,color:function(a,t,r){return new Ee(Pe(a.r,t.r,r),Pe(a.g,t.g,r),Pe(a.b,t.b,r),Pe(a.a,t.a,r))},number:Pe});function Wi(a,...t){for(const r of t)for(const h in r)a[h]=r[h];return a}class hn extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Dn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[h,g]of r)this.bindings[h]=g}concat(t){return new Dn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Zi={kind:"null"},Kt={kind:"number"},nn={kind:"string"},Ei={kind:"boolean"},Ln={kind:"color"},Vi={kind:"object"},fn={kind:"value"},cr={kind:"collator"},gr={kind:"formatted"},_r={kind:"resolvedImage"};function Rr(a,t){return{kind:"array",itemType:a,N:t}}function ur(a){if(a.kind==="array"){const t=ur(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const wn=[Zi,Kt,nn,Ei,Ln,gr,Vi,Rr(fn),_r];function ws(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ws(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const r of wn)if(!ws(r,t))return null}}return`Expected ${ur(a)} but found ${ur(t)} instead.`}function wr(a,t){return t.some(r=>r.kind===a.kind)}function Vs(a,t){return t.some(r=>r==="null"?a===null:r==="array"?Array.isArray(a):r==="object"?a&&!Array.isArray(a)&&typeof a=="object":r===typeof a)}class Or{constructor(t,r,h){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class so{constructor(t,r,h,g,d){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=h,this.fontStack=g,this.textColor=d}}class io{constructor(t){this.sections=t}static fromString(t){return new io([new so(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof io?t:io.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){t.push(["image",r.image.namePrimary]);continue}t.push(r.text);const h={};r.fontStack&&(h["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(h["font-scale"]=r.scale),r.textColor&&(h["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),t.push(h)}return t}}class Ys{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,r){return t?new Ys({namePrimary:t,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ga(a,t,r,h){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[a,t,r,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[a,t,r,h]:[a,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function So(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Ee||a instanceof Or||a instanceof io||a instanceof Ys)return!0;if(Array.isArray(a)){for(const t of a)if(!So(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!So(a[t]))return!1;return!0}return!1}function hs(a){if(a===null)return Zi;if(typeof a=="string")return nn;if(typeof a=="boolean")return Ei;if(typeof a=="number")return Kt;if(a instanceof Ee)return Ln;if(a instanceof Or)return cr;if(a instanceof io)return gr;if(a instanceof Ys)return _r;if(Array.isArray(a)){const t=a.length;let r;for(const h of a){const g=hs(h);if(r){if(r===g)continue;r=fn;break}r=g}return Rr(r||fn,t)}return Vi}function Is(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Ee||a instanceof io||a instanceof Ys?a.toString():JSON.stringify(a)}class ea{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!So(t[1]))return r.error("invalid value");const h=t[1];let g=hs(h);const d=r.expectedType;return g.kind!=="array"||g.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(g=d),new ea(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ee?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof io?this.value.serialize():this.value}}class Un{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const vl={string:nn,number:Kt,boolean:Ei,object:Vi};class ya{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let h,g=1;const d=t[0];if(d==="array"){let T,I;if(t.length>2){const z=t[1];if(typeof z!="string"||!(z in vl)||z==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);T=vl[z],g++}else T=fn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);I=t[2],g++}h=Rr(T,I)}else h=vl[d];const _=[];for(;g<t.length;g++){const T=r.parse(t[g],g,fn);if(!T)return null;_.push(T)}return new ya(h,_)}evaluate(t){for(let r=0;r<this.args.length;r++){const h=this.args[r].evaluate(t);if(!ws(this.type,hs(h)))return h;if(r===this.args.length-1)throw new Un(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${ur(hs(h))} but was expected to be of type ${ur(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if(t.kind==="array"){const h=t.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){r.push(h.kind);const g=t.N;(typeof g=="number"||this.args.length>1)&&r.push(g)}}return r.concat(this.args.map(h=>h.serialize()))}}class nc{constructor(t){this.type=gr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const h=t[1];if(!Array.isArray(h)&&typeof h=="object")return r.error("First argument must be an image or text section.");const g=[];let d=!1;for(let _=1;_<=t.length-1;++_){const T=t[_];if(d&&typeof T=="object"&&!Array.isArray(T)){d=!1;let I=null;if(T["font-scale"]&&(I=r.parseObjectValue(T["font-scale"],_,"font-scale",Kt),!I))return null;let z=null;if(T["text-font"]&&(z=r.parseObjectValue(T["text-font"],_,"text-font",Rr(nn)),!z))return null;let b=null;if(T["text-color"]&&(b=r.parseObjectValue(T["text-color"],_,"text-color",Ln),!b))return null;const L=g[g.length-1];L.scale=I,L.font=z,L.textColor=b}else{const I=r.parse(t[_],_,fn);if(!I)return null;const z=I.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new nc(g)}evaluate(t){return new io(this.sections.map(r=>{const h=r.content.evaluate(t);return hs(h)===_r?new so("",h,null,null,null):new so(Is(h),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const h={};r.scale&&(h["font-scale"]=r.scale.serialize()),r.font&&(h["text-font"]=r.font.serialize()),r.textColor&&(h["text-color"]=r.textColor.serialize()),t.push(h)}return t}}class va{constructor(t,r){this.type=_r,this.inputPrimary=t,this.inputSecondary=r}static parse(t,r){if(t.length<2)return r.error("Expected two or more arguments.");const h=r.parse(t[1],1,nn);if(!h)return r.error("No image name provided.");if(t.length===2)return new va(h);const g=r.parse(t[2],1,nn);return g?new va(h,g):r.error("Secondary image variant is not a string.")}evaluate(t){const r=Ys.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&t.availableImages&&(r.available=t.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function xl(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const xa={"to-boolean":Ei,"to-color":Ln,"to-number":Kt,"to-string":nn};class bl{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const h=t[0],g=[];let d=Zi;if(h==="to-array"){if(!Array.isArray(t[1]))return null;const _=t[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);d=Rr(r.expectedType.itemType,_)}else{if(!(_>0&&So(t[1][0])))return null;d=Rr(hs(t[1][0]),_)}for(let T=0;T<_;T++){const I=t[1][T];let z;if(xl(I)==="array")z=r.parse(I,void 0,d.itemType);else{const b=xl(I);if(b!==d.itemType.kind)return r.error(`Expected ${d.itemType.kind} but found ${b}.`);z=r.registry.literal.parse(["literal",I===void 0?null:I],r)}if(!z)return null;g.push(z)}}else{if((h==="to-boolean"||h==="to-string")&&t.length!==2)return r.error("Expected one argument.");d=xa[h];for(let _=1;_<t.length;_++){const T=r.parse(t[_],_,fn);if(!T)return null;g.push(T)}}return new bl(d,g)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let r,h;for(const g of this.args){if(r=g.evaluate(t),h=null,r instanceof Ee)return r;if(typeof r=="string"){const d=t.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(h=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ga(r[0],r[1],r[2],r[3]),!h))return new Ee(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Un(h||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const h of this.args){if(r=h.evaluate(t),r===null)return 0;const g=Number(r);if(!isNaN(g))return g}throw new Un(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?io.fromString(Is(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ys.fromString(Is(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(r=>r.evaluate(t)):Is(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new nc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new va(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}const Qu=["Unknown","Point","LineString","Polygon"];class Ca{constructor(t,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:h,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*r-t[0])+this.featureDistanceData.bearing[1]*(g*r-t[1])}return 0}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=Ee.parse(t)),r}getConfig(t){return this.options?this.options.get(t):null}}class Zo{constructor(t,r,h,g,d){this.name=t,this.type=r,this._evaluate=h,this.args=g,this._overloadIndex=d}evaluate(t){if(!this._evaluate){const r=Zo.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const h=t[0],g=Zo.definitions[h];if(!g)return r.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(g)?g[0]:g.type,_=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=[];let I=null,z=-1;for(const[b,L]of _){if(Array.isArray(b)&&b.length!==t.length-1)continue;T.push(b),z++,I=new _f(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const P=[];let C=!1;for(let R=1;R<t.length;R++){const F=t[R],q=Array.isArray(b)?b[R-1]:b.type,Z=I.parse(F,1+P.length,q);if(!Z){C=!0;break}P.push(Z)}if(!C)if(Array.isArray(b)&&b.length!==P.length)I.error(`Expected ${b.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const F=Array.isArray(b)?b[R]:b.type,q=P[R];I.concat(R+1).checkSubtype(F,q.type)}if(I.errors.length===0)return new Zo(h,d,L,P,z)}}if(T.length===1)r.errors.push(...I.errors);else{const b=(T.length?T:_.map(([P])=>P)).map(Xo).join(" | "),L=[];for(let P=1;P<t.length;P++){const C=r.parse(t[P],1+L.length);if(!C)return null;L.push(ur(C.type))}r.error(`Expected arguments of type ${b}, but found (${L.join(", ")}) instead.`)}return null}static register(t,r){Zo.definitions=r;for(const h in r)t[h]=Zo}}function Xo(a){return Array.isArray(a)?`(${a.map(ur).join(", ")})`:`(${ur(a.type)}...)`}class Pr{constructor(t,r,h){this.type=cr,this.locale=h,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const h=t[1];if(typeof h!="object"||Array.isArray(h))return r.error("Collator options argument must be an object.");const g=h["case-sensitive"]===void 0?r.parse(!1,1,Ei):r.parseObjectValue(h["case-sensitive"],1,"case-sensitive",Ei);if(!g)return null;const d=h["diacritic-sensitive"]===void 0?r.parse(!1,1,Ei):r.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",Ei);if(!d)return null;let _=null;return h.locale&&(_=r.parseObjectValue(h.locale,1,"locale",nn),!_)?null:new Pr(g,d,_)}evaluate(t){return new Or(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function hf(a,t,r=0,h=a.length-1,g=Ic){for(;h>r;){if(h-r>600){const I=h-r+1,z=t-r+1,b=Math.log(I),L=.5*Math.exp(2*b/3),P=.5*Math.sqrt(b*L*(I-L)/I)*(z-I/2<0?-1:1);hf(a,t,Math.max(r,Math.floor(t-z*L/I+P)),Math.min(h,Math.floor(t+(I-z)*L/I+P)),g)}const d=a[t];let _=r,T=h;for(wl(a,r,t),g(a[h],d)>0&&wl(a,r,h);_<T;){for(wl(a,_,T),_++,T--;g(a[_],d)<0;)_++;for(;g(a[T],d)>0;)T--}g(a[r],d)===0?wl(a,r,T):(T++,wl(a,T,h)),T<=t&&(r=T+1),t<=T&&(h=T-1)}}function wl(a,t,r){const h=a[t];a[t]=a[r],a[r]=h}function Ic(a,t){return a<t?-1:a>t?1:0}function Rc(a){let t=0;for(let r,h,g=0,d=a.length,_=d-1;g<d;_=g++)r=a[g],h=a[_],t+=(h.x-r.x)*(r.y+h.y);return t}function nl(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function La(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function df(a,t,r){const h=a[0]-t[0],g=a[1]-t[1],d=a[0]-r[0],_=a[1]-r[1];return h*_-d*g==0&&h*d<=0&&g*_<=0}function Pc(a,t,r=!1){let h=!1;for(let T=0,I=t.length;T<I;T++){const z=t[T];for(let b=0,L=z.length,P=L-1;b<L;P=b++){const C=z[P],R=z[b];if(df(a,C,R))return r;(d=C)[1]>(g=a)[1]!=(_=R)[1]>g[1]&&g[0]<(_[0]-d[0])*(g[1]-d[1])/(_[1]-d[1])+d[0]&&(h=!h)}}var g,d,_;return h}function Zd(a,t,r,h){const g=h[0]-r[0],d=h[1]-r[1],_=(a[0]-r[0])*d-g*(a[1]-r[1]),T=(t[0]-r[0])*d-g*(t[1]-r[1]);return _>0&&T<0||_<0&&T>0}function mu(a,t,r,h){return(g=[h[0]-r[0],h[1]-r[1]])[0]*(d=[t[0]-a[0],t[1]-a[1]])[1]-g[1]*d[0]!=0&&!(!Zd(a,t,r,h)||!Zd(r,h,a,t));var g,d}const ca=8192;function Ir(a,t){const r=(180+a[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,t.z);return[Math.round(r*g*ca),Math.round(h*g*ca)]}function Xn(a,t){for(let r=0;r<t.length;r++)if(Pc(a,t[r]))return!0;return!1}function eh(a,t,r){for(const h of r)for(let g=0,d=h.length,_=d-1;g<d;_=g++)if(mu(a,t,h[_],h[g]))return!0;return!1}function hr(a,t){for(let r=0;r<a.length;++r)if(!Pc(a[r],t))return!1;for(let r=0;r<a.length-1;++r)if(eh(a[r],a[r+1],t))return!1;return!0}function ed(a,t){for(let r=0;r<t.length;r++)if(hr(a,t[r]))return!0;return!1}function Dc(a,t,r){const h=[];for(let g=0;g<a.length;g++){const d=[];for(let _=0;_<a[g].length;_++){const T=Ir(a[g][_],r);nl(t,T),d.push(T)}h.push(d)}return h}function qn(a,t,r){const h=[];for(let g=0;g<a.length;g++){const d=Dc(a[g],t,r);h.push(d)}return h}function th(a,t,r,h){if(a[0]<r[0]||a[0]>r[2]){const g=.5*h;let d=a[0]-r[0]>g?-h:r[0]-a[0]>g?h:0;d===0&&(d=a[0]-r[2]>g?-h:r[2]-a[0]>g?h:0),a[0]+=d}nl(t,a)}function rl(a,t,r,h){const g=Math.pow(2,h.z)*ca,d=[h.x*ca,h.y*ca],_=[];if(!a)return _;for(const T of a)for(const I of T){const z=[I.x+d[0],I.y+d[1]];th(z,t,r,g),_.push(z)}return _}function Oc(a,t,r,h){const g=Math.pow(2,h.z)*ca,d=[h.x*ca,h.y*ca],_=[];if(!a)return _;for(const I of a){const z=[];for(const b of I){const L=[b.x+d[0],b.y+d[1]];nl(t,L),z.push(L)}_.push(z)}if(t[2]-t[0]<=g/2){(T=t)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of _)for(const z of I)th(z,t,r,g)}var T;return _}class yo{constructor(t,r){this.type=Ei,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(So(t[1])){const h=t[1];if(h.type==="FeatureCollection")for(let g=0;g<h.features.length;++g){const d=h.features[g].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new yo(h,h.features[g].geometry)}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new yo(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new yo(h,h)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,h){const g=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(h.type==="Polygon"){const T=Dc(h.coordinates,d,_),I=rl(r.geometry(),g,d,_);if(!La(g,d))return!1;for(const z of I)if(!Pc(z,T))return!1}if(h.type==="MultiPolygon"){const T=qn(h.coordinates,d,_),I=rl(r.geometry(),g,d,_);if(!La(g,d))return!1;for(const z of I)if(!Xn(z,T))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,h){const g=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if(h.type==="Polygon"){const T=Dc(h.coordinates,d,_),I=Oc(r.geometry(),g,d,_);if(!La(g,d))return!1;for(const z of I)if(!hr(z,T))return!1}if(h.type==="MultiPolygon"){const T=qn(h.coordinates,d,_),I=Oc(r.geometry(),g,d,_);if(!La(g,d))return!1;for(const z of I)if(!ed(z,T))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const zc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},co=1/298.257223563,kc=co*(2-co),vo=Math.PI/180;class Tl{static fromTile(t,r,h){const g=Math.PI*(1-2*(t+.5)/Math.pow(2,r)),d=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/vo;return new Tl(d,h)}static get units(){return zc}constructor(t,r){if(t===void 0)throw new Error("No latitude given.");if(r&&!zc[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(zc).join(", ")}`);const h=6378.137*vo*(r?zc[r]:1),g=Math.cos(t*vo),d=1/(1-kc*(1-g*g)),_=Math.sqrt(d);this.kx=h*_*g,this.ky=h*_*d*(1-kc)}distance(t,r){const h=Ks(t[0]-r[0])*this.kx,g=(t[1]-r[1])*this.ky;return Math.sqrt(h*h+g*g)}bearing(t,r){const h=Ks(r[0]-t[0])*this.kx;return Math.atan2(h,(r[1]-t[1])*this.ky)/vo}destination(t,r,h){const g=h*vo;return this.offset(t,Math.sin(g)*r,Math.cos(g)*r)}offset(t,r,h){return[t[0]+r/this.kx,t[1]+h/this.ky]}lineDistance(t){let r=0;for(let h=0;h<t.length-1;h++)r+=this.distance(t[h],t[h+1]);return r}area(t){let r=0;for(let h=0;h<t.length;h++){const g=t[h];for(let d=0,_=g.length,T=_-1;d<_;T=d++)r+=Ks(g[d][0]-g[T][0])*(g[d][1]+g[T][1])*(h?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(t,r){let h=0;if(r<=0)return t[0];for(let g=0;g<t.length-1;g++){const d=t[g],_=t[g+1],T=this.distance(d,_);if(h+=T,h>r)return Ia(d,_,(r-(h-T))/T)}return t[t.length-1]}pointToSegmentDistance(t,r,h){let[g,d]=r,_=Ks(h[0]-g)*this.kx,T=(h[1]-d)*this.ky;if(_!==0||T!==0){const I=(Ks(t[0]-g)*this.kx*_+(t[1]-d)*this.ky*T)/(_*_+T*T);I>1?(g=h[0],d=h[1]):I>0&&(g+=_/this.kx*I,d+=T/this.ky*I)}return _=Ks(t[0]-g)*this.kx,T=(t[1]-d)*this.ky,Math.sqrt(_*_+T*T)}pointOnLine(t,r){let h=1/0,g=t[0][0],d=t[0][1],_=0,T=0;for(let I=0;I<t.length-1;I++){let z=t[I][0],b=t[I][1],L=Ks(t[I+1][0]-z)*this.kx,P=(t[I+1][1]-b)*this.ky,C=0;L===0&&P===0||(C=(Ks(r[0]-z)*this.kx*L+(r[1]-b)*this.ky*P)/(L*L+P*P),C>1?(z=t[I+1][0],b=t[I+1][1]):C>0&&(z+=L/this.kx*C,b+=P/this.ky*C)),L=Ks(r[0]-z)*this.kx,P=(r[1]-b)*this.ky;const R=L*L+P*P;R<h&&(h=R,g=z,d=b,_=I,T=C)}return{point:[g,d],index:_,t:Math.max(0,Math.min(1,T))}}lineSlice(t,r,h){let g=this.pointOnLine(h,t),d=this.pointOnLine(h,r);if(g.index>d.index||g.index===d.index&&g.t>d.t){const z=g;g=d,d=z}const _=[g.point],T=g.index+1,I=d.index;!gu(h[T],_[0])&&T<=I&&_.push(h[T]);for(let z=T+1;z<=I;z++)_.push(h[z]);return gu(h[I],d.point)||_.push(d.point),_}lineSliceAlong(t,r,h){let g=0;const d=[];for(let _=0;_<h.length-1;_++){const T=h[_],I=h[_+1],z=this.distance(T,I);if(g+=z,g>t&&d.length===0&&d.push(Ia(T,I,(t-(g-z))/z)),g>=r)return d.push(Ia(T,I,(r-(g-z))/z)),d;g>t&&d.push(I)}return d}bufferPoint(t,r){const h=r/this.ky,g=r/this.kx;return[t[0]-g,t[1]-h,t[0]+g,t[1]+h]}bufferBBox(t,r){const h=r/this.ky,g=r/this.kx;return[t[0]-g,t[1]-h,t[2]+g,t[3]+h]}insideBBox(t,r){return Ks(t[0]-r[0])>=0&&Ks(t[0]-r[2])<=0&&t[1]>=r[1]&&t[1]<=r[3]}}function gu(a,t){return a[0]===t[0]&&a[1]===t[1]}function Ia(a,t,r){const h=Ks(t[0]-a[0]);return[a[0]+h*r,a[1]+(t[1]-a[1])*r]}function Ks(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class td{constructor(t=[],r=(h,g)=>h<g?-1:h>g?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:h}=this,g=r[t];for(;t>0;){const d=t-1>>1,_=r[d];if(h(g,_)>=0)break;r[t]=_,t=d}r[t]=g}_down(t){const{data:r,compare:h}=this,g=this.length>>1,d=r[t];for(;t<g;){let _=1+(t<<1);const T=_+1;if(T<this.length&&h(r[T],r[_])<0&&(_=T),h(r[_],d)>=0)break;r[t]=r[_],t=_}r[t]=d}}var un=8192;function Fm(a,t){return t.dist-a.dist}const ba=100,rc=50;function _u(a){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==a.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==a[r])return!1;return!0}function Fc(a){return a[1]-a[0]+1}function jl(a,t){const r=a[1]>=a[0]&&a[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function pf(a,t){if(a[0]>a[1])return[null,null];const r=Fc(a);if(t){if(r===2)return[a,null];const h=Math.floor(r/2);return[[a[0],a[0]+h],[a[0]+h,a[1]]]}{if(r===1)return[a,null];const h=Math.floor(r/2)-1;return[[a[0],a[0]+h],[a[0]+h+1,a[1]]]}}function Go(a,t){const r=[1/0,1/0,-1/0,-1/0];if(!jl(t,a.length))return r;for(let h=t[0];h<=t[1];++h)nl(r,a[h]);return r}function os(a){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<a.length;++r)for(let h=0;h<a[r].length;++h)nl(t,a[r][h]);return t}function Qn(a,t,r){if(_u(a)||_u(t))return NaN;let h=0,g=0;return a[2]<t[0]&&(h=t[0]-a[2]),a[0]>t[2]&&(h=a[0]-t[2]),a[1]>t[3]&&(g=a[1]-t[3]),a[3]<t[1]&&(g=t[1]-a[3]),r.distance([0,0],[h,g])}function sl(a){return 360*a-180}function Bm(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ha(a,t){const r=Math.pow(2,t.z),h=(a.y/un+t.y)/r;return[sl((a.x/un+t.x)/r),Bm(h)]}function Nm(a,t){const r=[];for(let h=0;h<a.length;++h)r.push(Ha(a[h],t));return r}function ff(a,t,r){const h=r.pointOnLine(t,a).point;return r.distance(a,h)}function mf(a,t,r,h,g){const d=r.slice(h[0],h[1]+1);let _=1/0;for(let T=t[0];T<=t[1];++T)if((_=Math.min(_,ff(a[T],d,g)))===0)return 0;return _}function Xd(a,t,r,h,g){const d=Math.min(g.pointToSegmentDistance(a,r,h),g.pointToSegmentDistance(t,r,h)),_=Math.min(g.pointToSegmentDistance(r,a,t),g.pointToSegmentDistance(h,a,t));return Math.min(d,_)}function ih(a,t,r,h,g){if(!jl(t,a.length)||!jl(h,r.length))return NaN;let d=1/0;for(let _=t[0];_<t[1];++_)for(let T=h[0];T<h[1];++T){if(mu(a[_],a[_+1],r[T],r[T+1]))return 0;d=Math.min(d,Xd(a[_],a[_+1],r[T],r[T+1],g))}return d}function yu(a,t,r,h,g){if(!jl(t,a.length)||!jl(h,r.length))return NaN;let d=1/0;for(let _=t[0];_<=t[1];++_)for(let T=h[0];T<=h[1];++T)if((d=Math.min(d,g.distance(a[_],r[T])))===0)return d;return d}function Ml(a,t,r){if(Pc(a,t,!0))return 0;let h=1/0;for(const g of t){const d=g.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[d-1]&&(h=Math.min(h,r.pointToSegmentDistance(a,g[d-1],g[0])))===0||(h=Math.min(h,ff(a,g,r)))===0)return h}return h}function gf(a,t,r,h){if(!jl(t,a.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Pc(a[d],r,!0))return 0;let g=1/0;for(let d=t[0];d<t[1];++d)for(const _ of r)for(let T=0,I=_.length,z=I-1;T<I;z=T++){if(mu(a[d],a[d+1],_[z],_[T]))return 0;g=Math.min(g,Xd(a[d],a[d+1],_[z],_[T],h))}return g}function Yd(a,t){for(const r of a)for(let h=0;h<=r.length-1;++h)if(Pc(r[h],t,!0))return!0;return!1}function id(a,t,r,h=1/0){const g=os(a),d=os(t);if(h!==1/0&&Qn(g,d,r)>=h)return h;if(La(g,d)){if(Yd(a,t))return 0}else if(Yd(t,a))return 0;let _=h;for(const T of a)for(let I=0,z=T.length,b=z-1;I<z;b=I++)for(const L of t)for(let P=0,C=L.length,R=C-1;P<C;R=P++){if(mu(T[b],T[I],L[R],L[P]))return 0;_=Math.min(_,Xd(T[b],T[I],L[R],L[P],r))}return _}function Ra(a,t,r,h,g,d,_){if(d===null||_===null)return;const T=Qn(Go(h,d),Go(g,_),r);T<t&&a.push({dist:T,range1:d,range2:_})}function nh(a,t,r,h,g=1/0){let d=Math.min(h.distance(a[0],r[0][0]),g);if(d===0)return d;const _=new td([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Fm),T=t?rc:ba,I=os(r);for(;_.length;){const z=_.pop();if(z.dist>=d)continue;const b=z.range1;if(Fc(b)<=T){if(!jl(b,a.length))return NaN;if(t){const L=gf(a,b,r,h);if((d=Math.min(d,L))===0)return d}else for(let L=b[0];L<=b[1];++L){const P=Ml(a[L],r,h);if((d=Math.min(d,P))===0)return d}}else{const L=pf(b,t);if(L[0]!==null){const P=Qn(Go(a,L[0]),I,h);P<d&&_.push({dist:P,range1:L[0],range2:[0,0]})}if(L[1]!==null){const P=Qn(Go(a,L[1]),I,h);P<d&&_.push({dist:P,range1:L[1],range2:[0,0]})}}}return d}function sc(a,t,r,h,g,d=1/0){let _=Math.min(d,g.distance(a[0],r[0]));if(_===0)return _;const T=new td([{dist:0,range1:[0,a.length-1],range2:[0,r.length-1]}],Fm),I=t?rc:ba,z=h?rc:ba;for(;T.length;){const b=T.pop();if(b.dist>=_)continue;const L=b.range1,P=b.range2;if(Fc(L)<=I&&Fc(P)<=z){if(!jl(L,a.length)||!jl(P,r.length))return NaN;if(t&&h?_=Math.min(_,ih(a,L,r,P,g)):t||h?t&&!h?_=Math.min(_,mf(r,P,a,L,g)):!t&&h&&(_=Math.min(_,mf(a,L,r,P,g))):_=Math.min(_,yu(a,L,r,P,g)),_===0)return _}else{const C=pf(L,t),R=pf(P,h);Ra(T,_,g,a,r,C[0],R[0]),Ra(T,_,g,a,r,C[0],R[1]),Ra(T,_,g,a,r,C[1],R[0]),Ra(T,_,g,a,r,C[1],R[1])}}return _}function vu(a,t,r,h,g=1/0){let d=g;const _=Go(a,[0,a.length-1]);for(const T of r)if(!(d!==1/0&&Qn(_,Go(T,[0,T.length-1]),h)>=d)&&(d=Math.min(d,sc(a,t,T,!0,h,d)),d===0))return d;return d}function Bc(a,t,r,h,g=1/0){let d=g;const _=Go(a,[0,a.length-1]);for(const T of r){if(d!==1/0&&Qn(_,os(T),h)>=d)continue;const I=nh(a,t,T,h,d);if(isNaN(I))return I;if((d=Math.min(d,I))===0)return d}return d}function nd(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class Wl{constructor(t,r){this.type=Kt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(So(t[1])){const h=t[1];if(h.type==="FeatureCollection"){for(let g=0;g<h.features.length;++g)if(nd(h.features[g].geometry.type))return new Wl(h,h.features[g].geometry)}else if(h.type==="Feature"){if(nd(h.geometry.type))return new Wl(h,h.geometry)}else if(nd(h.type))return new Wl(h,h)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const r=t.geometry(),h=t.canonicalID();if(r!=null&&h!=null){if(t.geometryType()==="Point")return function(g,d,_){const T=[];for(const z of g)for(const b of z)T.push(Ha(b,d));const I=new Tl(T[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?sc(T,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",I):_.type==="MultiLineString"?vu(T,!1,_.coordinates,I):_.type==="Polygon"||_.type==="MultiPolygon"?Bc(T,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,I):null}(r,h,this.geometries);if(t.geometryType()==="LineString")return function(g,d,_){const T=[];for(const z of g){const b=[];for(const L of z)b.push(Ha(L,d));T.push(b)}const I=new Tl(T[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return vu(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",T,I);if(_.type==="MultiLineString"){let z=1/0;for(let b=0;b<_.coordinates.length;b++){const L=vu(_.coordinates[b],!0,T,I,z);if(isNaN(L))return L;if((z=Math.min(z,L))===0)return z}return z}if(_.type==="Polygon"||_.type==="MultiPolygon"){let z=1/0;for(let b=0;b<T.length;b++){const L=Bc(T[b],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,I,z);if(isNaN(L))return L;if((z=Math.min(z,L))===0)return z}return z}return null}(r,h,this.geometries);if(t.geometryType()==="Polygon")return function(g,d,_){const T=[];for(const z of function(b,L){const P=b.length;if(P<=1)return[b];const C=[];let R,F;for(let q=0;q<P;q++){const Z=Rc(b[q]);Z!==0&&(b[q].area=Math.abs(Z),F===void 0&&(F=Z<0),F===Z<0?(R&&C.push(R),R=[b[q]]):R.push(b[q]))}return R&&C.push(R),C}(g)){const b=[];for(let L=0;L<z.length;++L)b.push(Nm(z[L],d));T.push(b)}const I=new Tl(T[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Bc(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",T,I);if(_.type==="MultiLineString"){let z=1/0;for(let b=0;b<_.coordinates.length;b++){const L=Bc(_.coordinates[b],!0,T,I,z);if(isNaN(L))return L;if((z=Math.min(z,L))===0)return z}return z}return _.type==="Polygon"||_.type==="MultiPolygon"?function(z,b,L){let P=1/0;for(const C of z)for(const R of b){const F=id(C,R,L,P);if(isNaN(F))return F;if((P=Math.min(P,F))===0)return P}return P}(_.type==="Polygon"?[_.coordinates]:_.coordinates,T,I):null}(r,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Pa(a,t){switch(a){case"string":return Is(t);case"number":return+t;case"boolean":return!!t;case"color":return Ee.parse(t);case"formatted":return io.fromString(Is(t));case"resolvedImage":return Ys.fromString(Is(t))}return t}function zr(a,t,r,h){return h!==void 0&&(a=h*Math.round(a/h)),t!==void 0&&a<t&&(a=t),r!==void 0&&a>r&&(a=r),a}class xu{constructor(t,r,h){this.type=t,this.key=r,this.scope=h}static parse(t,r){let h=r.expectedType;if(h==null&&(h=fn),t.length<2||t.length>3)return r.error("Invalid number of arguments for 'config' expression.");const g=r.parse(t[1],1);if(!(g instanceof ea))return r.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const d=r.parse(t[2],2);return d instanceof ea?new xu(h,Is(g.value),Is(d.value)):r.error("Scope of 'config' expression must be a string literal.")}return new xu(h,Is(g.value))}evaluate(t){const r=[this.key,this.scope,t.scope].filter(Boolean).join(""),h=t.getConfig(r);if(!h)return null;const{type:g,value:d,values:_,minValue:T,maxValue:I,stepValue:z}=h,b=h.default.evaluate(t);let L=b;if(d){const P=t.scope;t.scope=(P||"").split("").slice(1).join(""),L=d.evaluate(t),t.scope=P}return g&&(L=Pa(g,L)),L===void 0||T===void 0&&I===void 0&&z===void 0||(typeof L=="number"?L=zr(L,T,I,z):Array.isArray(L)&&(L=L.map(P=>typeof P=="number"?zr(P,T,I,z):P))),d!==void 0&&L!==void 0&&_&&!_.includes(L)&&(L=b,g&&(L=Pa(g,L))),(g&&g!==this.type||L!==void 0&&hs(L)!==this.type)&&(L=Pa(this.type.kind,L)),L}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function rh(a){if(a instanceof Zo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof yo||a instanceof Wl)return!1;let t=!0;return a.eachChild(r=>{t&&!rh(r)&&(t=!1)}),t}function Kd(a){if(a instanceof Zo&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(r=>{t&&!Kd(r)&&(t=!1)}),t}function rd(a){if(a instanceof xu)return new Set([a.key]);let t=new Set;return a.eachChild(r=>{t=new Set([...t,...rd(r)])}),t}function bu(a,t){if(a instanceof Zo&&t.indexOf(a.name)>=0)return!1;let r=!0;return a.eachChild(h=>{r&&!bu(h,t)&&(r=!1)}),r}class ys{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const h=t[1];return r.scope.has(h)?new ys(h,r.scope.get(h)):r.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Jd{constructor(t,r=[],h,g=new Dn,d=[],_,T){this.registry=t,this.path=r,this.key=r.map(I=>typeof I=="string"?`['${I}']`:`[${I}]`).join(""),this.scope=g,this.errors=d,this.expectedType=h,this._scope=_,this.options=T}parse(t,r,h,g,d={}){return r||h?this.concat(r,null,h,g)._parse(t,d):this._parse(t,d)}parseObjectValue(t,r,h,g,d,_={}){return this.concat(r,h,g,d)._parse(t,_)}_parse(t,r){function h(g,d,_){return _==="assert"?new ya(d,[g]):_==="coerce"?new bl(d,[g]):g}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(g){let d=g.parse(t,this);if(!d)return null;if(this.expectedType){const _=this.expectedType,T=d.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||T.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(_,T))return null}else d=h(d,_,r.typeAnnotation||"coerce");else d=h(d,_,r.typeAnnotation||"assert")}if(!(d instanceof ea)&&d.type.kind!=="resolvedImage"&&sd(d)){const _=new Ca(this._scope,this.options);try{d=new ea(d.type,d.evaluate(_))}catch(T){return this.error(T.message),null}}return d}return bl.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,h,g){let d=typeof t=="number"?this.path.concat(t):this.path;d=typeof r=="string"?d.concat(r):d;const _=g?this.scope.concat(g):this.scope;return new Jd(this.registry,d,h||null,_,this.errors,this._scope,this.options)}error(t,...r){const h=`${this.key}${r.map(g=>`[${g}]`).join("")}`;this.errors.push(new hn(h,t))}checkSubtype(t,r){const h=ws(t,r);return h&&this.error(h),h}}var _f=Jd;function sd(a){if(a instanceof ys)return sd(a.boundExpression);if(a instanceof Zo&&a.name==="error"||a instanceof Pr||a instanceof yo||a instanceof Wl||a instanceof xu)return!1;const t=a instanceof bl||a instanceof ya;let r=!0;return a.eachChild(h=>{r=t?r&&sd(h):r&&h instanceof ea}),!!r&&rh(a)&&bu(a,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function sh(a,t){const r=a.length-1;let h,g,d=0,_=r,T=0;for(;d<=_;)if(T=Math.floor((d+_)/2),h=a[T],g=a[T+1],h<=t){if(T===r||t<g)return T;d=T+1}else{if(!(h>t))throw new Un("Input is not a number.");_=T-1}return 0}class od{constructor(t,r,h){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[g,d]of h)this.labels.push(g),this.outputs.push(d)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const h=r.parse(t[1],1,Kt);if(!h)return null;const g=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let _=1;_<t.length;_+=2){const T=_===1?-1/0:t[_],I=t[_+1],z=_,b=_+1;if(typeof T!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=T)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const L=r.parse(I,b,d);if(!L)return null;d=d||L.type,g.push([T,L])}return new od(d,h,g)}evaluate(t){const r=this.labels,h=this.outputs;if(r.length===1)return h[0].evaluate(t);const g=this.input.evaluate(t);if(g<=r[0])return h[0].evaluate(t);const d=r.length;return g>=r[d-1]?h[d-1].evaluate(t):h[sh(r,g)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}const Um=.95047,Vm=1.08883,Gm=4/29,oh=6/29,Hm=3*oh*oh,__=oh*oh*oh,y_=Math.PI/180,v_=180/Math.PI;function ad(a){return a>__?Math.pow(a,1/3):a/Hm+Gm}function ld(a){return a>oh?a*a*a:Hm*(a-Gm)}function Qd(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function yf(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function jm(a){const t=yf(a.r),r=yf(a.g),h=yf(a.b),g=ad((.4124564*t+.3575761*r+.1804375*h)/Um),d=ad((.2126729*t+.7151522*r+.072175*h)/1);return{l:116*d-16,a:500*(g-d),b:200*(d-ad((.0193339*t+.119192*r+.9503041*h)/Vm)),alpha:a.a}}function vf(a){let t=(a.l+16)/116,r=isNaN(a.a)?t:t+a.a/500,h=isNaN(a.b)?t:t-a.b/200;return t=1*ld(t),r=Um*ld(r),h=Vm*ld(h),new Ee(Qd(3.2404542*r-1.5371385*t-.4985314*h),Qd(-.969266*r+1.8760108*t+.041556*h),Qd(.0556434*r-.2040259*t+1.0572252*h),a.alpha)}function Wm(a,t,r){const h=t-a;return a+r*(h>180||h<-180?h-360*Math.round(h/360):h)}const ah={forward:jm,reverse:vf,interpolate:function(a,t,r){return{l:Pe(a.l,t.l,r),a:Pe(a.a,t.a,r),b:Pe(a.b,t.b,r),alpha:Pe(a.alpha,t.alpha,r)}}},lh={forward:function(a){const{l:t,a:r,b:h}=jm(a),g=Math.atan2(h,r)*v_;return{h:g<0?g+360:g,c:Math.sqrt(r*r+h*h),l:t,alpha:a.a}},reverse:function(a){const t=a.h*y_,r=a.c;return vf({l:a.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:a.alpha})},interpolate:function(a,t,r){return{h:Wm(a.h,t.h,r),c:Pe(a.c,t.c,r),l:Pe(a.l,t.l,r),alpha:Pe(a.alpha,t.alpha,r)}}};var xf=Object.freeze({__proto__:null,hcl:lh,lab:ah});class Da{constructor(t,r,h,g,d){this.type=t,this.operator=r,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[_,T]of d)this.labels.push(_),this.outputs.push(T)}static interpolationFactor(t,r,h,g){let d=0;if(t.name==="exponential")d=Nc(r,t.base,h,g);else if(t.name==="linear")d=Nc(r,1,h,g);else if(t.name==="cubic-bezier"){const _=t.controlPoints;d=new pr(_[0],_[1],_[2],_[3]).solve(Nc(r,1,h,g))}return d}static parse(t,r){let[h,g,d,..._]=t;if(!Array.isArray(g)||g.length===0)return r.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const z=g[1];if(typeof z!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:z}}else{if(g[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const z=g.slice(1);if(z.length!==4||z.some(b=>typeof b!="number"||b<0||b>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:z}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,Kt),!d)return null;const T=[];let I=null;h==="interpolate-hcl"||h==="interpolate-lab"?I=Ln:r.expectedType&&r.expectedType.kind!=="value"&&(I=r.expectedType);for(let z=0;z<_.length;z+=2){const b=_[z],L=_[z+1],P=z+3,C=z+4;if(typeof b!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(T.length&&T[T.length-1][0]>=b)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const R=r.parse(L,C,I);if(!R)return null;I=I||R.type,T.push([b,R])}return I.kind==="number"||I.kind==="color"||I.kind==="array"&&I.itemType.kind==="number"&&typeof I.N=="number"?new Da(I,h,g,d,T):r.error(`Type ${ur(I)} is not interpolatable.`)}evaluate(t){const r=this.labels,h=this.outputs;if(r.length===1)return h[0].evaluate(t);const g=this.input.evaluate(t);if(g<=r[0])return h[0].evaluate(t);const d=r.length;if(g>=r[d-1])return h[d-1].evaluate(t);const _=sh(r,g),T=Da.interpolationFactor(this.interpolation,g,r[_],r[_+1]),I=h[_].evaluate(t),z=h[_+1].evaluate(t);return this.operator==="interpolate"?Mi[this.type.kind.toLowerCase()](I,z,T):this.operator==="interpolate-hcl"?lh.reverse(lh.interpolate(lh.forward(I),lh.forward(z),T)):ah.reverse(ah.interpolate(ah.forward(I),ah.forward(z),T))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,t,this.input.serialize()];for(let h=0;h<this.labels.length;h++)r.push(this.labels[h],this.outputs[h].serialize());return r}}function Nc(a,t,r,h){const g=h-r,d=a-r;return g===0?0:t===1?d/g:(Math.pow(t,d)-1)/(Math.pow(t,g)-1)}class Yo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let h=null;const g=r.expectedType;g&&g.kind!=="value"&&(h=g);const d=[];for(const T of t.slice(1)){const I=r.parse(T,1+d.length,h,void 0,{typeAnnotation:"omit"});if(!I)return null;h=h||I.type,d.push(I)}const _=g&&d.some(T=>ws(g,T.type));return new Yo(_?fn:h,d)}evaluate(t){let r,h=null,g=0;for(const d of this.args){if(g++,h=d.evaluate(t),h&&h instanceof Ys&&!h.available&&(r||(r=h),h=null,g===this.args.length))return r;if(h!==null)break}return h}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class Ho{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const h=[];for(let d=1;d<t.length-1;d+=2){const _=t[d];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,d);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const T=r.parse(t[d+1],d+1);if(!T)return null;h.push([_,T])}const g=r.parse(t[t.length-1],t.length-1,r.expectedType,h);return g?new Ho(h,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,h]of this.bindings)t.push(r,h.serialize());return t.push(this.result.serialize()),t}}class ep{constructor(t,r,h){this.type=t,this.index=r,this.input=h}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=r.parse(t[1],1,Kt),g=r.parse(t[2],2,Rr(r.expectedType||fn));return h&&g?new ep(g.type.itemType,h,g):null}evaluate(t){const r=this.index.evaluate(t),h=this.input.evaluate(t);if(r<0)throw new Un(`Array index out of bounds: ${r} < 0.`);if(r>h.length-1)throw new Un(`Array index out of bounds: ${r} > ${h.length-1}.`);if(r===Math.floor(r))return h[r];const g=Math.floor(r),d=Math.ceil(r),_=h[g],T=h[d];if(typeof _!="number"||typeof T!="number")throw new Un(`Cannot interpolate between non-number values at index ${r}.`);const I=r-g;return _*(1-I)+T*I}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bf{constructor(t,r){this.type=Ei,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=r.parse(t[1],1,fn),g=r.parse(t[2],2,fn);return h&&g?wr(h.type,[Ei,nn,Kt,Zi,fn])?new bf(h,g):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(h.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(h==null)return!1;if(!Vs(r,["boolean","string","number","null"]))throw new Un(`Expected first argument to be of type boolean, string, number or null, but found ${ur(hs(r))} instead.`);if(!Vs(h,["string","array"]))throw new Un(`Expected second argument to be of type array or string, but found ${ur(hs(h))} instead.`);return h.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class tp{constructor(t,r,h){this.type=Kt,this.needle=t,this.haystack=r,this.fromIndex=h}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=r.parse(t[1],1,fn),g=r.parse(t[2],2,fn);if(!h||!g)return null;if(!wr(h.type,[Ei,nn,Kt,Zi,fn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(h.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,Kt);return d?new tp(h,g,d):null}return new tp(h,g)}evaluate(t){const r=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!Vs(r,["boolean","string","number","null"]))throw new Un(`Expected first argument to be of type boolean, string, number or null, but found ${ur(hs(r))} instead.`);if(!Vs(h,["string","array"]))throw new Un(`Expected second argument to be of type array or string, but found ${ur(hs(h))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(t);return h.indexOf(r,g)}return h.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class wf{constructor(t,r,h,g,d,_){this.inputType=t,this.type=r,this.input=h,this.cases=g,this.outputs=d,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let h,g;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);const d={},_=[];for(let z=2;z<t.length-1;z+=2){let b=t[z];const L=t[z+1];Array.isArray(b)||(b=[b]);const P=r.concat(z);if(b.length===0)return P.error("Expected at least one branch label.");for(const R of b){if(typeof R!="number"&&typeof R!="string")return P.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return P.error("Numeric branch labels must be integer values.");if(h){if(P.checkSubtype(h,hs(R)))return null}else h=hs(R);if(d[String(R)]!==void 0)return P.error("Branch labels must be unique.");d[String(R)]=_.length}const C=r.parse(L,z,g);if(!C)return null;g=g||C.type,_.push(C)}const T=r.parse(t[1],1,fn);if(!T)return null;const I=r.parse(t[t.length-1],t.length-1,g);return I?T.type.kind!=="value"&&r.concat(1).checkSubtype(h,T.type)?null:new wf(h,g,T,d,_,I):null}evaluate(t){const r=this.input.evaluate(t);return(hs(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),h=[],g={};for(const _ of r){const T=g[this.cases[_]];T===void 0?(g[this.cases[_]]=h.length,h.push([this.cases[_],[_]])):h[T][1].push(_)}const d=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,T]of h)t.push(T.length===1?d(T[0]):T.map(d)),t.push(this.outputs[_].serialize());return t.push(this.otherwise.serialize()),t}}class cd{constructor(t,r,h){this.type=t,this.branches=r,this.otherwise=h}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const g=[];for(let _=1;_<t.length-1;_+=2){const T=r.parse(t[_],_,Ei);if(!T)return null;const I=r.parse(t[_+1],_+1,h);if(!I)return null;g.push([T,I]),h=h||I.type}const d=r.parse(t[t.length-1],t.length-1,h);return d?new cd(h,g,d):null}evaluate(t){for(const[r,h]of this.branches)if(r.evaluate(t))return h.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,h]of this.branches)t(r),t(h);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}class ip{constructor(t,r,h,g){this.type=t,this.input=r,this.beginIndex=h,this.endIndex=g}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=r.parse(t[1],1,fn),g=r.parse(t[2],2,Kt);if(!h||!g)return null;if(!wr(h.type,[Rr(fn),nn,fn]))return r.error(`Expected first argument to be of type array or string, but found ${ur(h.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,Kt);return d?new ip(h.type,h,g,d):null}return new ip(h.type,h,g)}evaluate(t){const r=this.input.evaluate(t),h=this.beginIndex.evaluate(t);if(!Vs(r,["string","array"]))throw new Un(`Expected first argument to be of type array or string, but found ${ur(hs(r))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(t);return r.slice(h,g)}return r.slice(h)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Tf(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function qm(a,t,r,h){return h.compare(t,r)===0}function ch(a,t,r){const h=a!=="=="&&a!=="!=";return class u3{constructor(d,_,T){this.type=Ei,this.lhs=d,this.rhs=_,this.collator=T,this.hasUntypedArgument=d.type.kind==="value"||_.type.kind==="value"}static parse(d,_){if(d.length!==3&&d.length!==4)return _.error("Expected two or three arguments.");const T=d[0];let I=_.parse(d[1],1,fn);if(!I)return null;if(!Tf(T,I.type))return _.concat(1).error(`"${T}" comparisons are not supported for type '${ur(I.type)}'.`);let z=_.parse(d[2],2,fn);if(!z)return null;if(!Tf(T,z.type))return _.concat(2).error(`"${T}" comparisons are not supported for type '${ur(z.type)}'.`);if(I.type.kind!==z.type.kind&&I.type.kind!=="value"&&z.type.kind!=="value")return _.error(`Cannot compare types '${ur(I.type)}' and '${ur(z.type)}'.`);h&&(I.type.kind==="value"&&z.type.kind!=="value"?I=new ya(z.type,[I]):I.type.kind!=="value"&&z.type.kind==="value"&&(z=new ya(I.type,[z])));let b=null;if(d.length===4){if(I.type.kind!=="string"&&z.type.kind!=="string"&&I.type.kind!=="value"&&z.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(b=_.parse(d[3],3,cr),!b)return null}return new u3(I,z,b)}evaluate(d){const _=this.lhs.evaluate(d),T=this.rhs.evaluate(d);if(h&&this.hasUntypedArgument){const I=hs(_),z=hs(T);if(I.kind!==z.kind||I.kind!=="string"&&I.kind!=="number")throw new Un(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${I.kind}, ${z.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const I=hs(_),z=hs(T);if(I.kind!=="string"||z.kind!=="string")return t(d,_,T)}return this.collator?r(d,_,T,this.collator.evaluate(d)):t(d,_,T)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[a];return this.eachChild(_=>{d.push(_.serialize())}),d}}}const x_=ch("==",function(a,t,r){return t===r},qm),$m=ch("!=",function(a,t,r){return t!==r},function(a,t,r,h){return!qm(0,t,r,h)}),Zm=ch("<",function(a,t,r){return t<r},function(a,t,r,h){return h.compare(t,r)<0}),uh=ch(">",function(a,t,r){return t>r},function(a,t,r,h){return h.compare(t,r)>0}),Xm=ch("<=",function(a,t,r){return t<=r},function(a,t,r,h){return h.compare(t,r)<=0}),Ym=ch(">=",function(a,t,r){return t>=r},function(a,t,r,h){return h.compare(t,r)>=0});class Mf{constructor(t,r,h,g,d,_){this.type=nn,this.number=t,this.locale=r,this.currency=h,this.unit=g,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const h=r.parse(t[1],1,Kt);if(!h)return null;const g=t[2];if(typeof g!="object"||Array.isArray(g))return r.error("NumberFormat options argument must be an object.");let d=null;if(g.locale&&(d=r.parseObjectValue(g.locale,2,"locale",nn),!d))return null;let _=null;if(g.currency&&(_=r.parseObjectValue(g.currency,2,"currency",nn),!_))return null;let T=null;if(g.unit&&(T=r.parseObjectValue(g.unit,2,"unit",nn),!T))return null;let I=null;if(g["min-fraction-digits"]&&(I=r.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",Kt),!I))return null;let z=null;return g["max-fraction-digits"]&&(z=r.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",Kt),!z)?null:new Mf(h,d,_,T,I,z)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class ud{constructor(t){this.type=Kt,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const h=r.parse(t[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ur(h.type)} instead.`):new ud(h):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Un(`Expected value to be of type string or array, but found ${ur(hs(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}function np(a){return function(){a=1831565813+(a|=0)|0;let t=Math.imul(a^a>>>15,1|a);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const hh={"==":x_,"!=":$m,">":uh,"<":Zm,">=":Ym,"<=":Xm,array:ya,at:ep,boolean:ya,case:cd,coalesce:Yo,collator:Pr,format:nc,image:va,in:bf,"index-of":tp,interpolate:Da,"interpolate-hcl":Da,"interpolate-lab":Da,length:ud,let:Ho,literal:ea,match:wf,number:ya,"number-format":Mf,object:ya,slice:ip,step:od,string:ya,"to-boolean":bl,"to-color":bl,"to-number":bl,"to-string":bl,var:ys,within:yo,distance:Wl,config:xu};function Km(a,[t,r,h,g]){t=t.evaluate(a),r=r.evaluate(a),h=h.evaluate(a);const d=g?g.evaluate(a):1,_=Ga(t,r,h,d);if(_)throw new Un(_);return new Ee(t/255*d,r/255*d,h/255*d,d)}function Sf(a,[t,r,h,g]){t=t.evaluate(a),r=r.evaluate(a),h=h.evaluate(a);const d=g?g.evaluate(a):1,_=function(z,b,L,P){return typeof z=="number"&&z>=0&&z<=360?typeof b=="number"&&b>=0&&b<=100&&typeof L=="number"&&L>=0&&L<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[z,b,L,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[z,b,L,P]:[z,b,L]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[z,b,L,P]:[z,b,L]).join(", ")}]: 'h' must be between 0 and 360.`}(t,r,h,d);if(_)throw new Un(_);const T=`hsla(${t}, ${r}%, ${h}%, ${d})`,I=Ee.parse(T);if(!I)throw new Un(`Failed to parse HSLA color: ${T}`);return I}function Ef(a,t){return a in t}function Af(a,t){const r=t[a];return r===void 0?null:r}function wu(a){return{type:a}}function Jm(a){return{result:"success",value:a}}function oc(a){return{result:"error",value:a}}function rp(a,t){return!!a&&!!a.parameters&&a.parameters.indexOf(t)>-1}function Tu(a){return a["property-type"]==="data-driven"}function Qm(a){return rp(a.expression,"measure-light")}function Cf(a){return rp(a.expression,"zoom")}function Lf(a){return!!a.expression&&a.expression.interpolated}function If(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function eg(a){return a}function Rf(a,t){const r=t.type==="color",h=a.stops&&typeof a.stops[0][0]=="object",g=h||!(h||a.property!==void 0),d=a.type||(Lf(t)?"exponential":"interval");if(r&&((a=Wi({},a)).stops&&(a.stops=a.stops.map(z=>[z[0],Ee.parse(z[1])])),a.default=Ee.parse(a.default?a.default:t.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!xf[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let _,T,I;if(d==="exponential")_=Pf;else if(d==="interval")_=w_;else if(d==="categorical"){_=b_,T=Object.create(null);for(const z of a.stops)T[z[0]]=z[1];I=typeof a.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);_=tg}if(h){const z={},b=[];for(let C=0;C<a.stops.length;C++){const R=a.stops[C],F=R[0].zoom;z[F]===void 0&&(z[F]={zoom:F,type:a.type,property:a.property,default:a.default,stops:[]},b.push(F)),z[F].stops.push([R[0].value,R[1]])}const L=[];for(const C of b)L.push([z[C].zoom,Rf(z[C],t)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Da.interpolationFactor.bind(void 0,P),zoomStops:L.map(C=>C[0]),evaluate:({zoom:C},R)=>Pf({stops:L,base:a.base},t,C).evaluate(C,R)}}if(g){const z=d==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:Da.interpolationFactor.bind(void 0,z),zoomStops:a.stops.map(b=>b[0]),evaluate:({zoom:b})=>_(a,t,b,T,I)}}return{kind:"source",evaluate(z,b){const L=b&&b.properties?b.properties[a.property]:void 0;return L===void 0?hd(a.default,t.default):_(a,t,L,T,I)}}}function hd(a,t,r){return a!==void 0?a:t!==void 0?t:r!==void 0?r:void 0}function b_(a,t,r,h,g){return hd(typeof r===g?h[r]:void 0,a.default,t.default)}function w_(a,t,r){if(xl(r)!=="number")return hd(a.default,t.default);const h=a.stops.length;if(h===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[h-1][0])return a.stops[h-1][1];const g=sh(a.stops.map(d=>d[0]),r);return a.stops[g][1]}function Pf(a,t,r){const h=a.base!==void 0?a.base:1;if(xl(r)!=="number")return hd(a.default,t.default);const g=a.stops.length;if(g===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[g-1][0])return a.stops[g-1][1];const d=sh(a.stops.map(b=>b[0]),r),_=function(b,L,P,C){const R=C-P,F=b-P;return R===0?0:L===1?F/R:(Math.pow(L,F)-1)/(Math.pow(L,R)-1)}(r,h,a.stops[d][0],a.stops[d+1][0]),T=a.stops[d][1],I=a.stops[d+1][1];let z=Mi[t.type]||eg;if(a.colorSpace&&a.colorSpace!=="rgb"){const b=xf[a.colorSpace];z=(L,P)=>b.reverse(b.interpolate(b.forward(L),b.forward(P),_))}return typeof T.evaluate=="function"?{evaluate(...b){const L=T.evaluate.apply(void 0,b),P=I.evaluate.apply(void 0,b);if(L!==void 0&&P!==void 0)return z(L,P,_)}}:z(T,I,_)}function tg(a,t,r){return t.type==="color"?r=Ee.parse(r):t.type==="formatted"?r=io.fromString(r.toString()):t.type==="resolvedImage"?r=Ys.fromString(r.toString()):xl(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),hd(r,a.default,t.default)}Zo.register(hh,{error:[{kind:"error"},[nn],(a,[t])=>{throw new Un(t.evaluate(a))}],typeof:[nn,[fn],(a,[t])=>ur(hs(t.evaluate(a)))],"to-rgba":[Rr(Kt,4),[Ln],(a,[t])=>t.evaluate(a).toRenderColor(null).toArray()],rgb:[Ln,[Kt,Kt,Kt],Km],rgba:[Ln,[Kt,Kt,Kt,Kt],Km],hsl:[Ln,[Kt,Kt,Kt],Sf],hsla:[Ln,[Kt,Kt,Kt,Kt],Sf],has:{type:Ei,overloads:[[[nn],(a,[t])=>Ef(t.evaluate(a),a.properties())],[[nn,Vi],(a,[t,r])=>Ef(t.evaluate(a),r.evaluate(a))]]},get:{type:fn,overloads:[[[nn],(a,[t])=>Af(t.evaluate(a),a.properties())],[[nn,Vi],(a,[t,r])=>Af(t.evaluate(a),r.evaluate(a))]]},"feature-state":[fn,[nn],(a,[t])=>Af(t.evaluate(a),a.featureState||{})],properties:[Vi,[],a=>a.properties()],"geometry-type":[nn,[],a=>a.geometryType()],id:[fn,[],a=>a.id()],zoom:[Kt,[],a=>a.globals.zoom],pitch:[Kt,[],a=>a.globals.pitch||0],"distance-from-center":[Kt,[],a=>a.distanceFromCenter()],"measure-light":[Kt,[nn],(a,[t])=>a.measureLight(t.evaluate(a))],"heatmap-density":[Kt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Kt,[],a=>a.globals.lineProgress||0],"raster-value":[Kt,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[Kt,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[Kt,[],a=>a.globals.skyRadialProgress||0],accumulated:[fn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Kt,wu(Kt),(a,t)=>{let r=0;for(const h of t)r+=h.evaluate(a);return r}],"*":[Kt,wu(Kt),(a,t)=>{let r=1;for(const h of t)r*=h.evaluate(a);return r}],"-":{type:Kt,overloads:[[[Kt,Kt],(a,[t,r])=>t.evaluate(a)-r.evaluate(a)],[[Kt],(a,[t])=>-t.evaluate(a)]]},"/":[Kt,[Kt,Kt],(a,[t,r])=>t.evaluate(a)/r.evaluate(a)],"%":[Kt,[Kt,Kt],(a,[t,r])=>t.evaluate(a)%r.evaluate(a)],ln2:[Kt,[],()=>Math.LN2],pi:[Kt,[],()=>Math.PI],e:[Kt,[],()=>Math.E],"^":[Kt,[Kt,Kt],(a,[t,r])=>Math.pow(t.evaluate(a),r.evaluate(a))],sqrt:[Kt,[Kt],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[Kt,[Kt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[Kt,[Kt],(a,[t])=>Math.log(t.evaluate(a))],log2:[Kt,[Kt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[Kt,[Kt],(a,[t])=>Math.sin(t.evaluate(a))],cos:[Kt,[Kt],(a,[t])=>Math.cos(t.evaluate(a))],tan:[Kt,[Kt],(a,[t])=>Math.tan(t.evaluate(a))],asin:[Kt,[Kt],(a,[t])=>Math.asin(t.evaluate(a))],acos:[Kt,[Kt],(a,[t])=>Math.acos(t.evaluate(a))],atan:[Kt,[Kt],(a,[t])=>Math.atan(t.evaluate(a))],min:[Kt,wu(Kt),(a,t)=>Math.min(...t.map(r=>r.evaluate(a)))],max:[Kt,wu(Kt),(a,t)=>Math.max(...t.map(r=>r.evaluate(a)))],abs:[Kt,[Kt],(a,[t])=>Math.abs(t.evaluate(a))],round:[Kt,[Kt],(a,[t])=>{const r=t.evaluate(a);return r<0?-Math.round(-r):Math.round(r)}],floor:[Kt,[Kt],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[Kt,[Kt],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Ei,[nn,fn],(a,[t,r])=>a.properties()[t.value]===r.value],"filter-id-==":[Ei,[fn],(a,[t])=>a.id()===t.value],"filter-type-==":[Ei,[nn],(a,[t])=>a.geometryType()===t.value],"filter-<":[Ei,[nn,fn],(a,[t,r])=>{const h=a.properties()[t.value],g=r.value;return typeof h==typeof g&&h<g}],"filter-id-<":[Ei,[fn],(a,[t])=>{const r=a.id(),h=t.value;return typeof r==typeof h&&r<h}],"filter->":[Ei,[nn,fn],(a,[t,r])=>{const h=a.properties()[t.value],g=r.value;return typeof h==typeof g&&h>g}],"filter-id->":[Ei,[fn],(a,[t])=>{const r=a.id(),h=t.value;return typeof r==typeof h&&r>h}],"filter-<=":[Ei,[nn,fn],(a,[t,r])=>{const h=a.properties()[t.value],g=r.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[Ei,[fn],(a,[t])=>{const r=a.id(),h=t.value;return typeof r==typeof h&&r<=h}],"filter->=":[Ei,[nn,fn],(a,[t,r])=>{const h=a.properties()[t.value],g=r.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[Ei,[fn],(a,[t])=>{const r=a.id(),h=t.value;return typeof r==typeof h&&r>=h}],"filter-has":[Ei,[fn],(a,[t])=>t.value in a.properties()],"filter-has-id":[Ei,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Ei,[Rr(nn)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Ei,[Rr(fn)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Ei,[nn,Rr(fn)],(a,[t,r])=>r.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Ei,[nn,Rr(fn)],(a,[t,r])=>function(h,g,d,_){for(;d<=_;){const T=d+_>>1;if(g[T]===h)return!0;g[T]>h?_=T-1:d=T+1}return!1}(a.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ei,overloads:[[[Ei,Ei],(a,[t,r])=>t.evaluate(a)&&r.evaluate(a)],[wu(Ei),(a,t)=>{for(const r of t)if(!r.evaluate(a))return!1;return!0}]]},any:{type:Ei,overloads:[[[Ei,Ei],(a,[t,r])=>t.evaluate(a)||r.evaluate(a)],[wu(Ei),(a,t)=>{for(const r of t)if(r.evaluate(a))return!0;return!1}]]},"!":[Ei,[Ei],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Ei,[nn],(a,[t])=>{const r=a.globals&&a.globals.isSupportedScript;return!r||r(t.evaluate(a))}],upcase:[nn,[nn],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[nn,[nn],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[nn,wu(fn),(a,t)=>t.map(r=>Is(r.evaluate(a))).join("")],"resolved-locale":[nn,[cr],(a,[t])=>t.evaluate(a).resolvedLocale()],random:[Kt,[Kt,Kt,fn],(a,t)=>{const[r,h,g]=t.map(_=>_.evaluate(a));if(r>h||r===h)return r;let d;if(typeof g=="string")d=function(_){let T=0;if(_.length===0)return T;for(let I=0;I<_.length;I++)T=(T<<5)-T+_.charCodeAt(I),T|=0;return T}(g);else{if(typeof g!="number")throw new Un(`Invalid seed input: ${g}`);d=g}return r+np(d)()*(h-r)}]});class sp{constructor(t,r,h,g){this.expression=t,this._warningHistory={},this._evaluator=new Ca(h,g),this._defaultValue=r?function(d){return d.type==="color"&&(If(d.default)||Array.isArray(d.default))?new Ee(0,0,0,0):d.type==="color"?Ee.parse(d.default)||null:d.default===void 0?null:d.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=rd(t)}evaluateWithoutErrorHandling(t,r,h,g,d,_,T,I){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=h,this._evaluator.canonical=g||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,h,g,d,_,T,I){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null;try{const z=this.expression.evaluate(this._evaluator);if(z==null||typeof z=="number"&&z!=z)return this._defaultValue;if(this._enumValues&&!(z in this._enumValues))throw new Un(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(z)} instead.`);return z}catch(z){return this._warningHistory[z.message]||(this._warningHistory[z.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${z.message}`)),this._defaultValue}}}function dh(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in hh}function Mu(a,t,r,h){const g=new _f(hh,[],t?function(_){const T={color:Ln,string:nn,number:Kt,enum:nn,boolean:Ei,formatted:gr,resolvedImage:_r};return _.type==="array"?Rr(T[_.value]||fn,_.length):T[_.type]}(t):void 0,void 0,void 0,r,h),d=g.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Jm(new sp(d,t,r,h)):oc(g.errors)}class op{constructor(t,r,h){this.kind=t,this._styleExpression=r,this.isLightConstant=h,this.isStateDependent=t!=="constant"&&!Kd(r.expression),this.configDependencies=rd(r.expression)}evaluateWithoutErrorHandling(t,r,h,g,d,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,h,g,d,_)}evaluate(t,r,h,g,d,_){return this._styleExpression.evaluate(t,r,h,g,d,_)}}class ol{constructor(t,r,h,g,d){this.kind=t,this.zoomStops=h,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Kd(r.expression),this.isLightConstant=d,this.configDependencies=rd(r.expression),this.interpolationType=g}evaluateWithoutErrorHandling(t,r,h,g,d,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,h,g,d,_)}evaluate(t,r,h,g,d,_){return this._styleExpression.evaluate(t,r,h,g,d,_)}interpolationFactor(t,r,h){return this.interpolationType?Da.interpolationFactor(this.interpolationType,t,r,h):0}}function Uc(a,t,r,h){if((a=Mu(a,t,r,h)).result==="error")return a;const g=a.value.expression,d=rh(g);if(!d&&!Tu(t))return oc([new hn("","data expressions not supported")]);const _=bu(g,["zoom","pitch","distance-from-center"]);if(!_&&!Cf(t))return oc([new hn("","zoom expressions not supported")]);const T=bu(g,["measure-light"]);if(!T&&!Qm(t))return oc([new hn("","measure-light expression not supported")]);const I=bu(g,["line-progress"]);if(!I&&!function(L){return rp(L.expression,"line-progress")}(t))return oc([new hn("","line-progress expression not supported")]);const z=t.expression&&t.expression.relaxZoomRestriction,b=dd(g);return b||_||z?b instanceof hn?oc([b]):b instanceof Da&&!Lf(t)?oc([new hn("",'"interpolate" expressions cannot be used with this property')]):Jm(b?new ol(d&&I?"camera":"composite",a.value,b.labels,b instanceof Da?b.interpolation:void 0,T):new op(d&&I?"constant":"source",a.value,T)):oc([new hn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ap{constructor(t,r){this._parameters=t,this._specification=r,Wi(this,Rf(this._parameters,this._specification))}static deserialize(t){return new ap(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function dd(a){let t=null;if(a instanceof Ho)t=dd(a.result);else if(a instanceof Yo){for(const r of a.args)if(t=dd(r),t)break}else(a instanceof od||a instanceof Da)&&a.input instanceof Zo&&a.input.name==="zoom"&&(t=a);return t instanceof hn||a.eachChild(r=>{const h=dd(r);h instanceof hn?t=h:t&&h&&t!==h&&(t=new hn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var lp,Vc,ig=function(){if(Vc)return lp;Vc=1,lp=t;var a=3;function t(r,h,g){var d=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var _=new Int32Array(this.arrayBuffer);r=_[0],this.d=(h=_[1])+2*(g=_[2]);for(var T=0;T<this.d*this.d;T++){var I=_[a+T],z=_[a+T+1];d.push(I===z?null:_.subarray(I,z))}var b=_[a+d.length+1];this.keys=_.subarray(_[a+d.length],b),this.bboxes=_.subarray(b),this.insert=this._insertReadonly}else{this.d=h+2*g;for(var L=0;L<this.d*this.d;L++)d.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=r,this.padding=g,this.scale=h/r,this.uid=0;var P=g/h*r;this.min=-P,this.max=r+P}return t.prototype.insert=function(r,h,g,d,_){this._forEachCell(h,g,d,_,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(d),this.bboxes.push(_)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(r,h,g,d,_,T){this.cells[_].push(T)},t.prototype.query=function(r,h,g,d,_){var T=this.min,I=this.max;if(r<=T&&h<=T&&I<=g&&I<=d&&!_)return Array.prototype.slice.call(this.keys);var z=[];return this._forEachCell(r,h,g,d,this._queryCell,z,{},_),z},t.prototype._queryCell=function(r,h,g,d,_,T,I,z){var b=this.cells[_];if(b!==null)for(var L=this.keys,P=this.bboxes,C=0;C<b.length;C++){var R=b[C];if(I[R]===void 0){var F=4*R;(z?z(P[F+0],P[F+1],P[F+2],P[F+3]):r<=P[F+2]&&h<=P[F+3]&&g>=P[F+0]&&d>=P[F+1])?(I[R]=!0,T.push(L[R])):I[R]=!1}}},t.prototype._forEachCell=function(r,h,g,d,_,T,I,z){for(var b=this._convertToCellCoord(r),L=this._convertToCellCoord(h),P=this._convertToCellCoord(g),C=this._convertToCellCoord(d),R=b;R<=P;R++)for(var F=L;F<=C;F++){var q=this.d*F+R;if((!z||z(this._convertFromCellCoord(R),this._convertFromCellCoord(F),this._convertFromCellCoord(R+1),this._convertFromCellCoord(F+1)))&&_.call(this,r,h,g,d,q,T,I,z))return}},t.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},t.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,h=a+this.cells.length+1+1,g=0,d=0;d<this.cells.length;d++)g+=this.cells[d].length;var _=new Int32Array(h+g+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var T=h,I=0;I<r.length;I++){var z=r[I];_[a+I]=T,_.set(z,T),T+=z.length}return _[a+r.length]=T,_.set(this.keys,T),_[a+r.length+1]=T+=this.keys.length,_.set(this.bboxes,T),T+=this.bboxes.length,_.buffer},lp}(),Su=X(ig);const ac={};function Sn(a,t,r={}){Object.defineProperty(a,"_classRegistryKey",{value:t,writable:!1}),ac[t]={klass:a,omit:r.omit||[]}}Sn(Object,"Object"),Su.serialize=function(a,t){const r=a.toArrayBuffer();return t&&t.add(r),{buffer:r}},Su.deserialize=function(a){return new Su(a.buffer)},Object.defineProperty(Su,"name",{value:"Grid"}),Sn(Su,"Grid"),Sn(Ee,"Color"),Sn(Error,"Error"),Sn(io,"Formatted"),Sn(so,"FormattedSection"),Sn(nr,"AJAXError"),Sn(Ys,"ResolvedImage"),Sn(ap,"StylePropertyFunction"),Sn(sp,"StyleExpression",{omit:["_evaluator"]}),Sn(ol,"ZoomDependentExpression"),Sn(op,"ZoomConstantExpression"),Sn(Zo,"CompoundExpression",{omit:["_evaluate"]});for(const a in hh)ac[hh[a]._classRegistryKey]||Sn(hh[a],`Expression${a}`);function pd(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Df(a){return self.ImageBitmap&&a instanceof ImageBitmap}function lc(a,t){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(pd(a)||Df(a))return t&&t.add(a),a;if(ArrayBuffer.isView(a)){const r=a;return t&&t.add(r.buffer),r}if(a instanceof ImageData)return t&&t.add(a.data.buffer),a;if(Array.isArray(a)){const r=[];for(const h of a)r.push(lc(h,t));return r}if(a instanceof Map){const r={$name:"Map"};for(const[h,g]of a.entries())r[h]=lc(g);return r}if(a instanceof Set){const r={$name:"Set"};let h=0;for(const g of a.values())r[++h]=lc(g);return r}if(typeof a=="object"){const r=a.constructor,h=r._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const g=r.serialize?r.serialize(a,t):{};if(!r.serialize){for(const d in a)a.hasOwnProperty(d)&&(ac[h].omit.indexOf(d)>=0||(g[d]=lc(a[d],t)));a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(g.$name=h),g}throw new Error("can't serialize object of type "+typeof a)}function Oa(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||pd(a)||Df(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Oa);if(typeof a=="object"){const t=a.$name||"Object";if(t==="Map"){const g=new Map;for(const d of Object.keys(a))d!=="$name"&&g.set(d,Oa(a[d]));return g}if(t==="Set"){const g=new Set;for(const d of Object.keys(a))d!=="$name"&&g.add(Oa(a[d]));return g}const{klass:r}=ac[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(a);const h=Object.create(r.prototype);for(const g of Object.keys(a))g!=="$name"&&(h[g]=Oa(a[g]));return h}throw new Error("can't deserialize object of type "+typeof a)}const Gn={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Of(a){for(const t of a)if(Eu(t.charCodeAt(0)))return!0;return!1}function zf(a){for(const t of a)if(!T_(t.charCodeAt(0)))return!1;return!0}function T_(a){return!(Gn.Arabic(a)||Gn["Arabic Supplement"](a)||Gn["Arabic Extended-A"](a)||Gn["Arabic Presentation Forms-A"](a)||Gn["Arabic Presentation Forms-B"](a))}function Eu(a){return!(a!==746&&a!==747&&(a<4352||!(Gn["Bopomofo Extended"](a)||Gn.Bopomofo(a)||Gn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Gn["CJK Compatibility Ideographs"](a)||Gn["CJK Compatibility"](a)||Gn["CJK Radicals Supplement"](a)||Gn["CJK Strokes"](a)||!(!Gn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Gn["CJK Unified Ideographs Extension A"](a)||Gn["CJK Unified Ideographs"](a)||Gn["Enclosed CJK Letters and Months"](a)||Gn["Hangul Compatibility Jamo"](a)||Gn["Hangul Jamo Extended-A"](a)||Gn["Hangul Jamo Extended-B"](a)||Gn["Hangul Jamo"](a)||Gn["Hangul Syllables"](a)||Gn.Hiragana(a)||Gn["Ideographic Description Characters"](a)||Gn.Kanbun(a)||Gn["Kangxi Radicals"](a)||Gn["Katakana Phonetic Extensions"](a)||Gn.Katakana(a)&&a!==12540||!(!Gn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Gn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Gn["Unified Canadian Aboriginal Syllabics"](a)||Gn["Unified Canadian Aboriginal Syllabics Extended"](a)||Gn["Vertical Forms"](a)||Gn["Yijing Hexagram Symbols"](a)||Gn["Yi Syllables"](a)||Gn["Yi Radicals"](a))))}function cp(a){return!(Eu(a)||function(t){return!!(Gn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Gn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Gn["Letterlike Symbols"](t)||Gn["Number Forms"](t)||Gn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Gn["Control Pictures"](t)&&t!==9251||Gn["Optical Character Recognition"](t)||Gn["Enclosed Alphanumerics"](t)||Gn["Geometric Shapes"](t)||Gn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Gn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gn["CJK Symbols and Punctuation"](t)||Gn.Katakana(t)||Gn["Private Use Area"](t)||Gn["CJK Compatibility Forms"](t)||Gn["Small Form Variants"](t)||Gn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}function fd(a){return a>=1424&&a<=2303||Gn["Arabic Presentation Forms-A"](a)||Gn["Arabic Presentation Forms-B"](a)}function ng(a,t){return!(!t&&fd(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Gn.Khmer(a))}function M_(a){for(const t of a)if(fd(t.charCodeAt(0)))return!0;return!1}const kf="deferred",ph="loading",fh="loaded";let up=null,ta="unavailable",ja=null;const rg=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(ta="error"),up&&up(a)};function Ff(){hp.fire(new je("pluginStateChange",{pluginStatus:ta,pluginURL:ja}))}const hp=new bi,Bf=function(){return ta},md=function(){if(ta!==kf||!ja)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ta=ph,Ff(),ja&&Vo({url:ja},a=>{a?rg(a):(ta=fh,Ff())})},ua={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ta===fh||ua.applyArabicShaping!=null,isLoading:()=>ta===ph,setState(a){ta=a.pluginStatus,ja=a.pluginURL},isParsed:()=>ua.applyArabicShaping!=null&&ua.processBidirectionalText!=null&&ua.processStyledBidirectionalText!=null,getPluginURL:()=>ja};class eo{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(r,h){for(const g of r)if(!ng(g.charCodeAt(0),h))return!1;return!0}(t,ua.isLoaded())}}class dp{constructor(t,r,h,g){this.property=t,this.value=r,this.expression=function(d,_,T,I){if(If(d))return new ap(d,_);if(dh(d)||Array.isArray(d)&&d.length>0){const z=Uc(d,_,T,I);if(z.result==="error")throw new Error(z.value.map(b=>`${b.key}: ${b.message}`).join(", "));return z.value}{let z=d;return typeof d=="string"&&_.type==="color"&&(z=Ee.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>z}}}(r===void 0?t.specification.default:r,t.specification,h,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,h){return this.property.possiblyEvaluate(this,t,r,h)}}class Nf{constructor(t,r,h){this.property=t,this.value=new dp(t,void 0,r,h)}transitioned(t,r){return new pp(this.property,this.value,r,cn({},t.transition,this.transition),t.now)}untransitioned(){return new pp(this.property,this.value,null,{},0)}}class Uf{constructor(t,r,h){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=r,this._options=h,this.configDependencies=new Set}getValue(t){return $r(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Nf(this._values[t].property,this._scope,this._options)),this._values[t].value=new dp(this._values[t].property,r===null?void 0:$r(r),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,r){r&&(this._options=r);const h=this._properties.properties;if(t)for(const g in t){const d=t[g];if(Lr(g,"-transition")){const _=g.slice(0,-11);h[_]&&this.setTransition(_,d)}else h.hasOwnProperty(g)&&this.setValue(g,d)}}getTransition(t){return $r(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Nf(this._values[t].property)),this._values[t].transition=$r(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const h=this.getValue(r);h!==void 0&&(t[r]=h);const g=this.getTransition(r);g!==void 0&&(t[`${r}-transition`]=g)}return t}transitioned(t,r){const h=new Gc(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(t,r._values[g]);return h}untransitioned(){const t=new Gc(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class pp{constructor(t,r,h,g,d){const _=g.delay||0,T=g.duration||0;d=d||0,this.property=t,this.value=r,this.begin=d+_,this.end=this.begin+T,t.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(t,r,h){const g=t.now||0,d=this.value.possiblyEvaluate(t,r,h),_=this.prior;if(_){if(g>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(g<this.begin)return _.possiblyEvaluate(t,r,h);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,h),d,ut(T))}}return d}}class Gc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,h){const g=new mh(this._properties);for(const d of Object.keys(this._values))g._values[d]=this._values[d].possiblyEvaluate(t,r,h);return g}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class S_{constructor(t,r,h){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=r,this._options=h,this.configDependencies=new Set}getValue(t){return $r(this._values[t].value)}setValue(t,r){this._values[t]=new dp(this._values[t].property,r===null?void 0:$r(r),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const r of Object.keys(this._values)){const h=this.getValue(r);h!==void 0&&(t[r]=h)}return t}possiblyEvaluate(t,r,h){const g=new mh(this._properties);for(const d of Object.keys(this._values))g._values[d]=this._values[d].possiblyEvaluate(t,r,h);return g}}class Hc{constructor(t,r,h){this.property=t,this.value=r,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,h,g){return this.property.evaluate(this.value,this.parameters,t,r,h,g)}}class mh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class qi{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,h){const g=Mi[this.specification.type];return g?g(t,r,h):t}}class yn{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,h,g){return new Hc(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},h,g)}:t.expression,r)}interpolate(t,r,h){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Hc(this,{kind:"constant",value:void 0},t.parameters);const g=Mi[this.specification.type];return g?new Hc(this,{kind:"constant",value:g(t.value.value,r.value.value,h)},t.parameters):t}evaluate(t,r,h,g,d,_){return t.kind==="constant"?t.value:t.evaluate(r,h,g,d,_)}}class Au{constructor(t){this.specification=t}possiblyEvaluate(t,r,h,g){return!!t.expression.evaluate(r,null,{},h,g)}interpolate(){return!1}}class Ts{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new eo(0,{});for(const h in t){const g=t[h];g.specification.overridable&&this.overridableProperties.push(h);const d=this.defaultPropertyValues[h]=new dp(g,void 0),_=this.defaultTransitionablePropertyValues[h]=new Nf(g);this.defaultTransitioningPropertyValues[h]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=d.possiblyEvaluate(r)}}}Sn(yn,"DataDrivenProperty"),Sn(qi,"DataConstantProperty"),Sn(Au,"ColorRampProperty");var Qt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function gh(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Wa(a){if(Array.isArray(a))return a.map(Wa);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const r in a)t[r]=Wa(a[r]);return t}return gh(a)}function xo(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!xo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Sl(a,t="",r=null,h="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xo(a)||(a=Wc(a));const g=a;let d=!0;try{d=function(b){if(!wa(b))return b;let L=Wa(b);return jc(L),L=al(L),L}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}let _=null,T=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){T=Qt[`filter_${h}`];const b=Mu(d,T,t,r);if(b.result==="error")throw new Error(b.value.map(L=>`${L.key}: ${L.message}`).join(", "));_=(L,P,C)=>b.value.evaluate(L,P,{},C)}let I=null,z=null;if(d!==g){const b=Mu(g,T,t,r);if(b.result==="error")throw new Error(b.value.map(L=>`${L.key}: ${L.message}`).join(", "));I=(L,P,C,R,F)=>b.value.evaluate(L,P,{},C,void 0,void 0,R,F),z=!rh(b.value.expression)}return{filter:_,dynamicFilter:I||void 0,needGeometry:Cu(d),needFeature:!!z}}function al(a){if(!Array.isArray(a))return a;const t=function(r){if(_h.has(r[0])){for(let h=1;h<r.length;h++)if(wa(r[h]))return!0}return r}(a);return t===!0?t:t.map(r=>al(r))}function jc(a){let t=!1;const r=[];if(a[0]==="case"){for(let h=1;h<a.length-1;h+=2)t=t||wa(a[h]),r.push(a[h+1]);r.push(a[a.length-1])}else if(a[0]==="match"){t=t||wa(a[1]);for(let h=2;h<a.length-1;h+=2)r.push(a[h+1]);r.push(a[a.length-1])}else if(a[0]==="step"){t=t||wa(a[1]);for(let h=1;h<a.length-1;h+=2)r.push(a[h+1])}t&&(a.length=0,a.push("any",...r));for(let h=1;h<a.length;h++)jc(a[h])}function wa(a){if(!Array.isArray(a))return!1;if((t=a[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let r=1;r<a.length;r++)if(wa(a[r]))return!0;return!1}const _h=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function yh(a,t){return a<t?-1:a>t?1:0}function Cu(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(Cu(a[t]))return!0;return!1}function Wc(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?fp(a[1],a[2],"=="):t==="!="?ql(fp(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?fp(a[1],a[2],t):t==="any"?(r=a.slice(1),["any"].concat(r.map(Wc))):t==="all"?["all"].concat(a.slice(1).map(Wc)):t==="none"?["all"].concat(a.slice(1).map(Wc).map(ql)):t==="in"?vh(a[1],a.slice(2)):t==="!in"?ql(vh(a[1],a.slice(2))):t==="has"?qc(a[1]):t!=="!has"||ql(qc(a[1]));var r}function fp(a,t,r){switch(a){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,a,t]}}function vh(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",a,["literal",t.sort(yh)]]:["filter-in-small",a,["literal",t]]}}function qc(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ql(a){return["!",a]}const xh="";function bh(a,t){return t?`${a}${xh}${t}`:a}const Vf="-transition",qa=new Set(["fill","line","background","hillshade","raster"]);class Ko extends bi{constructor(t,r,h,g,d){if(super(),this.id=t.id,this.fqid=bh(this.id,h),this.type=t.type,this.scope=h,this.lut=g,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const _=Mu(this.filter,Qt[`filter_${t.type}`]);_.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,..._.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),r.layout&&(this._unevaluatedLayout=new S_(r.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new Uf(r.paint,this.scope,d);for(const _ in t.paint)this.setPaintProperty(_,t.paint[_]);for(const _ in t.layout)this.setLayoutProperty(_,t.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mh(r.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D()&&qa.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r){if(this.type==="custom"&&t==="visibility")return void(this.visibility=r);const h=this._unevaluatedLayout;h._properties.properties[t]&&(h.setValue(t,r),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return Lr(t,Vf)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r){const h=this._transitionablePaint,g=h._properties.properties;if(Lr(t,Vf)){const L=t.slice(0,-11);return g[L]&&h.setTransition(L,r||void 0),!1}if(!g[t])return!1;const d=h._values[t],_=d.value.isDataDriven(),T=d.value;h.setValue(t,r),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const I=h._values[t].value,z=I.isDataDriven(),b=Lr(t,"pattern")||t==="line-dasharray";return z||_||b||this._handleOverridablePaintPropertyUpdate(t,T,I)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,r,h){return null}_handleOverridablePaintPropertyUpdate(t,r,h){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){return to({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,r)=>!(t===void 0||r==="layout"&&!Object.keys(t).length||r==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Hc&&Tu(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=Sl(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,r,h,g,d,_,T,I,z){}queryIntersectsMatchingFeature(t,r,h,g){}}const gd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wh{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ds{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qr(a,t=1){let r=0,h=0;return{members:a.map(g=>{const d=gd[g.type].BYTES_PER_ELEMENT,_=r=Gf(r,Math.max(t,d)),T=g.components||1;return h=Math.max(h,d),r+=d*T,{name:g.name,type:g.type,components:T,offset:_}}),size:Gf(r,Math.max(h,t)),alignment:t}}function Gf(a,t){return Math.ceil(a/t)*t}class cc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const h=this.length;return this.resize(h+1),this.emplace(h,t,r)}emplace(t,r,h){const g=2*t;return this.int16[g+0]=r,this.int16[g+1]=h,t}}cc.prototype.bytesPerElement=4,Sn(cc,"StructArrayLayout2i4");class mp extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,h)}emplace(t,r,h,g){const d=3*t;return this.int16[d+0]=r,this.int16[d+1]=h,this.int16[d+2]=g,t}}mp.prototype.bytesPerElement=6,Sn(mp,"StructArrayLayout3i6");class Lu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,h,g){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,h,g)}emplace(t,r,h,g,d){const _=4*t;return this.int16[_+0]=r,this.int16[_+1]=h,this.int16[_+2]=g,this.int16[_+3]=d,t}}Lu.prototype.bytesPerElement=8,Sn(Lu,"StructArrayLayout4i8");class Th extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,h,g,d)}emplace(t,r,h,g,d,_){const T=5*t;return this.int16[T+0]=r,this.int16[T+1]=h,this.int16[T+2]=g,this.int16[T+3]=d,this.int16[T+4]=_,t}}Th.prototype.bytesPerElement=10,Sn(Th,"StructArrayLayout5i10");class $c extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,h,g,d,_,T)}emplace(t,r,h,g,d,_,T,I){const z=6*t,b=12*t,L=3*t;return this.int16[z+0]=r,this.int16[z+1]=h,this.uint8[b+4]=g,this.uint8[b+5]=d,this.uint8[b+6]=_,this.uint8[b+7]=T,this.float32[L+2]=I,t}}$c.prototype.bytesPerElement=12,Sn($c,"StructArrayLayout2i4ub1f12");class Ta extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,h,g)}emplace(t,r,h,g,d){const _=4*t;return this.float32[_+0]=r,this.float32[_+1]=h,this.float32[_+2]=g,this.float32[_+3]=d,t}}Ta.prototype.bytesPerElement=16,Sn(Ta,"StructArrayLayout4f16");class uc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,h)}emplace(t,r,h,g){const d=3*t;return this.float32[d+0]=r,this.float32[d+1]=h,this.float32[d+2]=g,t}}uc.prototype.bytesPerElement=12,Sn(uc,"StructArrayLayout3f12");class hc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,h,g,d)}emplace(t,r,h,g,d,_){const T=6*t,I=3*t;return this.uint16[T+0]=r,this.uint16[T+1]=h,this.uint16[T+2]=g,this.uint16[T+3]=d,this.float32[I+2]=_,t}}hc.prototype.bytesPerElement=12,Sn(hc,"StructArrayLayout4ui1f12");class Iu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,h,g){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,h,g)}emplace(t,r,h,g,d){const _=4*t;return this.uint16[_+0]=r,this.uint16[_+1]=h,this.uint16[_+2]=g,this.uint16[_+3]=d,t}}Iu.prototype.bytesPerElement=8,Sn(Iu,"StructArrayLayout4ui8");class El extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,h,g,d,_)}emplace(t,r,h,g,d,_,T){const I=6*t;return this.int16[I+0]=r,this.int16[I+1]=h,this.int16[I+2]=g,this.int16[I+3]=d,this.int16[I+4]=_,this.int16[I+5]=T,t}}El.prototype.bytesPerElement=12,Sn(El,"StructArrayLayout6i12");class Ru extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T,I,z,b,L,P){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,h,g,d,_,T,I,z,b,L,P)}emplace(t,r,h,g,d,_,T,I,z,b,L,P,C){const R=12*t;return this.int16[R+0]=r,this.int16[R+1]=h,this.int16[R+2]=g,this.int16[R+3]=d,this.uint16[R+4]=_,this.uint16[R+5]=T,this.uint16[R+6]=I,this.uint16[R+7]=z,this.int16[R+8]=b,this.int16[R+9]=L,this.int16[R+10]=P,this.int16[R+11]=C,t}}Ru.prototype.bytesPerElement=24,Sn(Ru,"StructArrayLayout4i4ui4i24");class gp extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,h,g,d,_)}emplace(t,r,h,g,d,_,T){const I=10*t,z=5*t;return this.int16[I+0]=r,this.int16[I+1]=h,this.int16[I+2]=g,this.float32[z+2]=d,this.float32[z+3]=_,this.float32[z+4]=T,t}}gp.prototype.bytesPerElement=20,Sn(gp,"StructArrayLayout3i3f20");class Mh extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Mh.prototype.bytesPerElement=4,Sn(Mh,"StructArrayLayout1ul4");class ll extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const h=this.length;return this.resize(h+1),this.emplace(h,t,r)}emplace(t,r,h){const g=2*t;return this.uint16[g+0]=r,this.uint16[g+1]=h,t}}ll.prototype.bytesPerElement=4,Sn(ll,"StructArrayLayout2ui4");class _d extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T,I,z,b,L,P,C){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,h,g,d,_,T,I,z,b,L,P,C)}emplace(t,r,h,g,d,_,T,I,z,b,L,P,C,R){const F=20*t,q=10*t;return this.int16[F+0]=r,this.int16[F+1]=h,this.int16[F+2]=g,this.int16[F+3]=d,this.int16[F+4]=_,this.float32[q+3]=T,this.float32[q+4]=I,this.float32[q+5]=z,this.float32[q+6]=b,this.int16[F+14]=L,this.uint32[q+8]=P,this.uint16[F+18]=C,this.uint16[F+19]=R,t}}_d.prototype.bytesPerElement=40,Sn(_d,"StructArrayLayout5i4f1i1ul2ui40");class Po extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,h,g,d,_,T)}emplace(t,r,h,g,d,_,T,I){const z=8*t;return this.int16[z+0]=r,this.int16[z+1]=h,this.int16[z+2]=g,this.int16[z+4]=d,this.int16[z+5]=_,this.int16[z+6]=T,this.int16[z+7]=I,t}}Po.prototype.bytesPerElement=16,Sn(Po,"StructArrayLayout3i2i2i16");class Pu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,h,g,d)}emplace(t,r,h,g,d,_){const T=4*t,I=8*t;return this.float32[T+0]=r,this.float32[T+1]=h,this.float32[T+2]=g,this.int16[I+6]=d,this.int16[I+7]=_,t}}Pu.prototype.bytesPerElement=16,Sn(Pu,"StructArrayLayout2f1f2i16");class Du extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,h,g,d,_)}emplace(t,r,h,g,d,_,T){const I=20*t,z=5*t;return this.uint8[I+0]=r,this.uint8[I+1]=h,this.float32[z+1]=g,this.float32[z+2]=d,this.float32[z+3]=_,this.float32[z+4]=T,t}}Du.prototype.bytesPerElement=20,Sn(Du,"StructArrayLayout2ub4f20");class qs extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,h)}emplace(t,r,h,g){const d=3*t;return this.uint16[d+0]=r,this.uint16[d+1]=h,this.uint16[d+2]=g,t}}qs.prototype.bytesPerElement=6,Sn(qs,"StructArrayLayout3ui6");class Zc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q,Z,te,ie,K,ce){const he=this.length;return this.resize(he+1),this.emplace(he,t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q,Z,te,ie,K,ce)}emplace(t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q,Z,te,ie,K,ce,he){const Se=30*t,$e=15*t,Be=60*t;return this.int16[Se+0]=r,this.int16[Se+1]=h,this.int16[Se+2]=g,this.float32[$e+2]=d,this.float32[$e+3]=_,this.uint16[Se+8]=T,this.uint16[Se+9]=I,this.uint32[$e+5]=z,this.uint32[$e+6]=b,this.uint32[$e+7]=L,this.uint16[Se+16]=P,this.uint16[Se+17]=C,this.uint16[Se+18]=R,this.float32[$e+10]=F,this.float32[$e+11]=q,this.uint8[Be+48]=Z,this.uint8[Be+49]=te,this.uint8[Be+50]=ie,this.uint32[$e+13]=K,this.int16[Se+28]=ce,this.uint8[Be+58]=he,t}}Zc.prototype.bytesPerElement=60,Sn(Zc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sh extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q,Z,te,ie,K,ce,he,Se,$e,Be,Ve,Mt,Ne,ft,Pt,Dt,Ut){const ei=this.length;return this.resize(ei+1),this.emplace(ei,t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q,Z,te,ie,K,ce,he,Se,$e,Be,Ve,Mt,Ne,ft,Pt,Dt,Ut)}emplace(t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q,Z,te,ie,K,ce,he,Se,$e,Be,Ve,Mt,Ne,ft,Pt,Dt,Ut,ei){const ri=20*t,Yt=40*t,yi=80*t;return this.float32[ri+0]=r,this.float32[ri+1]=h,this.int16[Yt+4]=g,this.int16[Yt+5]=d,this.int16[Yt+6]=_,this.int16[Yt+7]=T,this.int16[Yt+8]=I,this.int16[Yt+9]=z,this.int16[Yt+10]=b,this.int16[Yt+11]=L,this.int16[Yt+12]=P,this.uint16[Yt+13]=C,this.uint16[Yt+14]=R,this.uint16[Yt+15]=F,this.uint16[Yt+16]=q,this.uint16[Yt+17]=Z,this.uint16[Yt+18]=te,this.uint16[Yt+19]=ie,this.uint16[Yt+20]=K,this.uint16[Yt+21]=ce,this.uint16[Yt+22]=he,this.uint16[Yt+23]=Se,this.uint16[Yt+24]=$e,this.uint16[Yt+25]=Be,this.uint16[Yt+26]=Ve,this.uint16[Yt+27]=Mt,this.uint32[ri+14]=Ne,this.float32[ri+15]=ft,this.float32[ri+16]=Pt,this.float32[ri+17]=Dt,this.float32[ri+18]=Ut,this.uint8[yi+76]=ei,t}}Sh.prototype.bytesPerElement=80,Sn(Sh,"StructArrayLayout2f9i15ui1ul4f1ub80");class za extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}za.prototype.bytesPerElement=4,Sn(za,"StructArrayLayout1f4");class Xc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,h,g,d)}emplace(t,r,h,g,d,_){const T=5*t;return this.float32[T+0]=r,this.float32[T+1]=h,this.float32[T+2]=g,this.float32[T+3]=d,this.float32[T+4]=_,t}}Xc.prototype.bytesPerElement=20,Sn(Xc,"StructArrayLayout5f20");class _p extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,h,g,d,_,T)}emplace(t,r,h,g,d,_,T,I){const z=7*t;return this.float32[z+0]=r,this.float32[z+1]=h,this.float32[z+2]=g,this.float32[z+3]=d,this.float32[z+4]=_,this.float32[z+5]=T,this.float32[z+6]=I,t}}_p.prototype.bytesPerElement=28,Sn(_p,"StructArrayLayout7f28");class ia extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T,I,z,b,L){const P=this.length;return this.resize(P+1),this.emplace(P,t,r,h,g,d,_,T,I,z,b,L)}emplace(t,r,h,g,d,_,T,I,z,b,L,P){const C=11*t;return this.float32[C+0]=r,this.float32[C+1]=h,this.float32[C+2]=g,this.float32[C+3]=d,this.float32[C+4]=_,this.float32[C+5]=T,this.float32[C+6]=I,this.float32[C+7]=z,this.float32[C+8]=b,this.float32[C+9]=L,this.float32[C+10]=P,t}}ia.prototype.bytesPerElement=44,Sn(ia,"StructArrayLayout11f44");class yp extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T,I,z){const b=this.length;return this.resize(b+1),this.emplace(b,t,r,h,g,d,_,T,I,z)}emplace(t,r,h,g,d,_,T,I,z,b){const L=9*t;return this.float32[L+0]=r,this.float32[L+1]=h,this.float32[L+2]=g,this.float32[L+3]=d,this.float32[L+4]=_,this.float32[L+5]=T,this.float32[L+6]=I,this.float32[L+7]=z,this.float32[L+8]=b,t}}yp.prototype.bytesPerElement=36,Sn(yp,"StructArrayLayout9f36");class Al extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,h,g){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,h,g)}emplace(t,r,h,g,d){const _=6*t;return this.uint32[3*t+0]=r,this.uint16[_+2]=h,this.uint16[_+3]=g,this.uint16[_+4]=d,t}}Al.prototype.bytesPerElement=12,Sn(Al,"StructArrayLayout1ul3ui12");class vp extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}vp.prototype.bytesPerElement=2,Sn(vp,"StructArrayLayout1ui2");class Ou extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const h=this.length;return this.resize(h+1),this.emplace(h,t,r)}emplace(t,r,h){const g=2*t;return this.float32[g+0]=r,this.float32[g+1]=h,t}}Ou.prototype.bytesPerElement=8,Sn(Ou,"StructArrayLayout2f8");class Yc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q){const Z=this.length;return this.resize(Z+1),this.emplace(Z,t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q)}emplace(t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q,Z){const te=16*t;return this.float32[te+0]=r,this.float32[te+1]=h,this.float32[te+2]=g,this.float32[te+3]=d,this.float32[te+4]=_,this.float32[te+5]=T,this.float32[te+6]=I,this.float32[te+7]=z,this.float32[te+8]=b,this.float32[te+9]=L,this.float32[te+10]=P,this.float32[te+11]=C,this.float32[te+12]=R,this.float32[te+13]=F,this.float32[te+14]=q,this.float32[te+15]=Z,t}}Yc.prototype.bytesPerElement=64,Sn(Yc,"StructArrayLayout16f64");class zu extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,h,g,d,_,T){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,h,g,d,_,T)}emplace(t,r,h,g,d,_,T,I){const z=10*t,b=5*t;return this.uint16[z+0]=r,this.uint16[z+1]=h,this.uint16[z+2]=g,this.uint16[z+3]=d,this.float32[b+2]=_,this.float32[b+3]=T,this.float32[b+4]=I,t}}zu.prototype.bytesPerElement=20,Sn(zu,"StructArrayLayout4ui3f20");class Kc extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.int16[1*t+0]=r,t}}Kc.prototype.bytesPerElement=2,Sn(Kc,"StructArrayLayout1i2");class yd extends Ds{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint8[1*t+0]=r,t}}yd.prototype.bytesPerElement=1,Sn(yd,"StructArrayLayout1ub1");class Hf extends wh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hf.prototype.size=40;class Eh extends _d{get(t){return new Hf(this,t)}}Sn(Eh,"CollisionBoxArray");class Ah extends wh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Ah.prototype.size=60;class xp extends Zc{get(t){return new Ah(this,t)}}Sn(xp,"PlacedSymbolArray");class ku extends wh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}ku.prototype.size=80;class $l extends Sh{get(t){return new ku(this,t)}}Sn($l,"SymbolInstanceArray");class Fu extends za{getoffsetX(t){return this.float32[1*t+0]}}Sn(Fu,"GlyphOffsetArray");class $a extends cc{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Sn($a,"SymbolLineVertexArray");class Bu extends wh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Bu.prototype.size=12;class vd extends Al{get(t){return new Bu(this,t)}}Sn(vd,"FeatureIndexArray");class xd extends ll{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Sn(xd,"FillExtrusionCentroidArray");class bp extends wh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}bp.prototype.size=6;class Ch extends mp{get(t){return new bp(this,t)}}Sn(Ch,"FillExtrusionWallArray");const jf=Qr([{name:"a_pos",components:2,type:"Int16"}],4),Za=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Js{constructor(t=[]){this.segments=t}_prepareSegment(t,r,h,g){let d=this.segments[this.segments.length-1];return t>Js.MAX_VERTEX_ARRAY_LENGTH&&Wn(`Max vertices per segment is ${Js.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>Js.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==g)&&(d={vertexOffset:r,primitiveOffset:h,vertexLength:0,primitiveLength:0},g!==void 0&&(d.sortKey=g),this.segments.push(d)),d}prepareSegment(t,r,h,g){return this._prepareSegment(t,r.length,h.length,g)}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,h,g){return new Js([{vertexOffset:t,primitiveOffset:r,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}function wp(a,t){return 256*(a=It(Math.floor(a),0,255))+It(Math.floor(t),0,255)}Js.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Sn(Js,"SegmentVector");const Wf=Qr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Tp=Qr([{name:"a_dash",components:4,type:"Uint16"}]);class Nu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,r,h,g){this.ids.push(Mp(t)),this.positions.push(r,h,g)}eachPosition(t,r){const h=Mp(t);let g=0,d=this.ids.length-1;for(;g<d;){const _=g+d>>1;this.ids[_]>=h?d=_:g=_+1}for(;this.ids[g]===h;)r(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(t,r){const h=new Float64Array(t.ids),g=new Uint32Array(t.positions);return Jc(h,g,0,h.length-1),r&&(r.add(h.buffer),r.add(g.buffer)),{ids:h,positions:g}}static deserialize(t){const r=new Nu;let h;r.ids=t.ids,r.positions=t.positions;for(const g of r.ids)g!==h&&r.uniqueIds.push(g),h=g;return r.indexed=!0,r}}function Mp(a){const t=+a;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Me(String(a))}function Jc(a,t,r,h){for(;r<h;){const g=a[r+h>>1];let d=r-1,_=h+1;for(;;){do d++;while(a[d]<g);do _--;while(a[_]>g);if(d>=_)break;Lh(a,d,_),Lh(t,3*d,3*_),Lh(t,3*d+1,3*_+1),Lh(t,3*d+2,3*_+2)}_-r<h-_?(Jc(a,t,r,_),r=_+1):(Jc(a,t,_+1,h),h=_)}}function Lh(a,t,r){const h=a[t];a[t]=a[r],a[r]=h}Sn(Nu,"FeaturePositionMap");class Zl{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}set(t,r,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Cl extends Zl{constructor(t){super(t),this.current=0}set(t,r,h){this.fetchUniformLocation(t,r)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class uo extends Zl{constructor(t){super(t),this.current=0}set(t,r,h){this.fetchUniformLocation(t,r)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Xa extends Zl{constructor(t){super(t),this.current=[0,0]}set(t,r,h){this.fetchUniformLocation(t,r)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class bd extends Zl{constructor(t){super(t),this.current=[0,0,0]}set(t,r,h){this.fetchUniformLocation(t,r)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class Qc extends Zl{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,h){this.fetchUniformLocation(t,r)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class Sp extends Zl{constructor(t){super(t),this.current=Ee.transparent.toRenderColor(null)}set(t,r,h){this.fetchUniformLocation(t,r)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const wd=new Float32Array(16);class Uu extends Zl{constructor(t){super(t),this.current=wd}set(t,r,h){if(this.fetchUniformLocation(t,r)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let g=1;g<16;g++)if(h[g]!==this.current[g]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const Ep=new Float32Array(9),Ap=new Float32Array(4);class Cp extends Zl{constructor(t){super(t),this.current=Ap}set(t,r,h){if(this.fetchUniformLocation(t,r)){for(let g=0;g<4;g++)if(h[g]!==this.current[g]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Lp(a){return[wp(255*a.r,255*a.g),wp(255*a.b,255*a.a)]}class cl{constructor(t,r,h,g){this.value=t,this.uniformNames=r.map(d=>`u_${d}`),this.type=h,this.context=g}setUniform(t,r,h,g,d){const _=g.constantOr(this.value);r.set(t,d,_ instanceof Ee?_.toRenderColor(this.context.lut):_)}getBinding(t,r){return this.type==="color"?new Sp(t):new uo(t)}}class Xl{constructor(t,r){this.uniformNames=r.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,r,h,g,d){const _=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;_&&r.set(t,d,_)}getBinding(t,r){return r==="u_pattern"||r==="u_dash"?new Qc(t):new uo(t)}}class dc{constructor(t,r,h,g){this.expression=t,this.type=h,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,r,h,g,d,_,T){const I=this.paintVertexArray.length,z=this.expression.evaluate(new eo(0,{brightness:_}),r,{},d,g,T);this.paintVertexArray.resize(t),this._setPaintValue(I,t,z,this.context)}updatePaintArray(t,r,h,g,d,_,T){const I=this.expression.evaluate({zoom:0,brightness:T},h,g,void 0,d);this._setPaintValue(t,r,I,this.context)}_setPaintValue(t,r,h,g){if(this.type==="color"){const d=Lp(h.toRenderColor(g.lut));for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ll{constructor(t,r,h,g,d,_){this.expression=t,this.uniformNames=r.map(T=>`u_${T}_t`),this.type=h,this.useIntegerZoom=g,this.context=d,this.maxValue=0,this.paintVertexAttributes=r.map(T=>({name:`a_${T}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,r,h,g,d,_,T){const I=this.expression.evaluate(new eo(this.context.zoom,{brightness:_}),r,{},d,g,T),z=this.expression.evaluate(new eo(this.context.zoom+1,{brightness:_}),r,{},d,g,T),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,I,z,this.context)}updatePaintArray(t,r,h,g,d,_,T){const I=this.expression.evaluate({zoom:this.context.zoom,brightness:T},h,g,void 0,d),z=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T},h,g,void 0,d);this._setPaintValue(t,r,I,z,this.context)}_setPaintValue(t,r,h,g,d){if(this.type==="color"){const _=Lp(h.toRenderColor(d.lut)),T=Lp(h.toRenderColor(d.lut));for(let I=t;I<r;I++)this.paintVertexArray.emplace(I,_[0],_[1],T[0],T[1])}else{for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,h,g,d){const _=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,T=It(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);r.set(t,d,T)}getBinding(t,r){return new uo(t)}}class pc{constructor(t,r,h,g,d){this.expression=t,this.layerId=d,this.paintVertexAttributes=(h==="array"?Tp:Wf).members;for(let _=0;_<r.length;++_);this.paintVertexArray=new g}populatePaintArray(t,r,h,g){const d=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(d,t,r.patterns&&r.patterns[this.layerId],h)}updatePaintArray(t,r,h,g,d,_,T){this._setPaintValues(t,r,h.patterns&&h.patterns[this.layerId],_)}_setPaintValues(t,r,h,g){if(!g||!h)return;const d=g[h];if(!d)return;const{tl:_,br:T,pixelRatio:I}=d;for(let z=t;z<r;z++)this.paintVertexArray.emplace(z,_[0],_[1],T[0],T[1],I)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fc{constructor(t,r,h=()=>!0){this.binders={},this._buffers=[],this.context=r;const g=[];for(const d in t.paint._values){const _=t.paint.get(d);if(!h(d)||!(_ instanceof Hc&&Tu(_.property.specification)))continue;const T=A_(d,t.type),I=_.value,z=_.property.specification.type,b=!!_.property.useIntegerZoom,L=d==="line-dasharray"||d.endsWith("pattern"),P=d==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(I.kind!=="constant"||P)if(I.kind==="source"||P||L){const C=Vu(d,z,"source");this.binders[d]=L?new pc(I,T,z,C,t.id):new dc(I,T,z,C),g.push(`/a_${d}`)}else{const C=Vu(d,z,"composite");this.binders[d]=new Ll(I,T,z,b,r,C),g.push(`/z_${d}`)}else this.binders[d]=L?new Xl(I.value,T):new cl(I.value,T,z,r),g.push(`/u_${d}`)}this.cacheKey=g.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof dc||r instanceof Ll?r.maxValue:0}populatePaintArrays(t,r,h,g,d,_,T){for(const I in this.binders){const z=this.binders[I];z.context=this.context,(z instanceof dc||z instanceof Ll||z instanceof pc)&&z.populatePaintArray(t,r,h,g,d,_,T)}}setConstantPatternPositions(t){for(const r in this.binders){const h=this.binders[r];h instanceof Xl&&h.setConstantPatternPositions(t)}}updatePaintArrays(t,r,h,g,d,_,T,I){let z=!1;const b=Object.keys(t),L=b.length!==0,P=L?b:r.uniqueIds;this.context.lut=d.lut;for(const C in this.binders){const R=this.binders[C];if(R.context=this.context,(R instanceof dc||R instanceof Ll||R instanceof pc)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const F=d.paint.get(C);R.expression=F.value;for(const q of P){const Z=t[q.toString()];r.eachPosition(q,(te,ie,K)=>{const ce=g.feature(te);R.updatePaintArray(ie,K,ce,Z,_,T,I)})}if(!L)for(const q of h.uniqueIds){const Z=t[q.toString()];h.eachPosition(q,(te,ie,K)=>{const ce=g.feature(te);R.updatePaintArray(ie,K,ce,Z,_,T,I)})}z=!0}}return z}defines(){const t=[];for(const r in this.binders){const h=this.binders[r];(h instanceof cl||h instanceof Xl)&&t.push(...h.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const h=this.binders[r];if(h instanceof dc||h instanceof Ll||h instanceof pc)for(let g=0;g<h.paintVertexAttributes.length;g++)t.push(h.paintVertexAttributes[g].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const h=this.binders[r];if(h instanceof cl||h instanceof Xl||h instanceof Ll)for(const g of h.uniformNames)t.push(g)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof cl||g instanceof Xl||g instanceof Ll)for(const d of g.uniformNames)r.push({name:d,property:h,binding:g.getBinding(t,d)})}return r}setUniforms(t,r,h,g,d){for(const{name:_,property:T,binding:I}of h)this.binders[T].setUniform(t,I,d,g.get(T),_)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof dc||r instanceof Ll||r instanceof pc)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(t){for(const r in this.binders){const h=this.binders[r];(h instanceof dc||h instanceof Ll||h instanceof pc)&&h.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof dc||r instanceof Ll||r instanceof pc)&&r.destroy()}}}class Yl{constructor(t,r,h=()=>!0){this.programConfigurations={};for(const g of t)this.programConfigurations[g.id]=new fc(g,r,h);this.needsUpload=!1,this._featureMap=new Nu,this._featureMapWithoutIds=new Nu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,r,h,g,d,_,T,I){for(const z in this.programConfigurations)this.programConfigurations[z].populatePaintArrays(t,r,g,d,_,T,I);r.id!==void 0?this._featureMap.add(r.id,h,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,h,g,d,_){for(const T of h)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,r,T,g,d,_||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const E_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function A_(a,t){return E_[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}const qf={"line-pattern":{source:hc,composite:hc},"fill-pattern":{source:hc,composite:hc},"fill-extrusion-pattern":{source:hc,composite:hc},"line-dasharray":{source:Iu,composite:Iu}},C_={color:{source:Ou,composite:Ta},number:{source:za,composite:Ou}};function Vu(a,t,r){const h=qf[a];return h&&h[r]||C_[t][r]}Sn(cl,"ConstantBinder"),Sn(Xl,"PatternConstantBinder"),Sn(dc,"SourceExpressionBinder"),Sn(pc,"PatternCompositeBinder"),Sn(Ll,"CompositeExpressionBinder"),Sn(fc,"ProgramConfiguration",{omit:["_buffers"]}),Sn(Yl,"ProgramConfigurationSet");const na=un/Math.PI/2,fo=5,f=6,i=16383,s=64,m=[s,32,16],x=-na,w=na;function A(a,t,r,h=na){return r=Ue(r),[a*Math.sin(r)*h,-t*h,a*Math.cos(r)*h]}function k(a,t,r){return A(Math.cos(Ue(a)),Math.sin(Ue(a)),t,r)}const U=63710088e-1,W=2*Math.PI*U;class j{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new j(xi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,h=this.lat*r,g=t.lat*r,d=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((t.lng-this.lng)*r);return U*Math.acos(Math.min(d,1))}toBounds(t=0){const r=360*t/40075017,h=r/Math.cos(Math.PI/180*this.lat);return new Y({lng:this.lng-h,lat:this.lat-r},{lng:this.lng+h,lat:this.lat+r})}toEcef(t){return k(this.lat,this.lng,na+t*na/U)}static convert(t){if(t instanceof j)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new j(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new j(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Y{constructor(t,r){if(t)if(r)this.setSouthWest(t).setNorthEast(r);else if(t.length===4){const h=t;this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]])}else{const h=t;this.setSouthWest(h[0]).setNorthEast(h[1])}}setNorthEast(t){return this._ne=t instanceof j?new j(t.lng,t.lat):j.convert(t),this}setSouthWest(t){return this._sw=t instanceof j?new j(t.lng,t.lat):j.convert(t),this}extend(t){const r=this._sw,h=this._ne;let g,d;if(t instanceof j)g=t,d=t;else{if(!(t instanceof Y))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Y.convert(t)):this.extend(j.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(j.convert(t)):this;if(g=t._sw,d=t._ne,!g||!d)return this}return r||h?(r.lng=Math.min(g.lng,r.lng),r.lat=Math.min(g.lat,r.lat),h.lng=Math.max(d.lng,h.lng),h.lat=Math.max(d.lat,h.lat)):(this._sw=new j(g.lng,g.lat),this._ne=new j(d.lng,d.lat)),this}getCenter(){return new j((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new j(this.getWest(),this.getNorth())}getSouthEast(){return new j(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:h}=j.convert(t);let g=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g}static convert(t){if(t)return t instanceof Y?t:new Y(t)}}const J=0,oe=25.5;function pe(a){return W*Math.cos(a*Math.PI/180)}function ue(a){return(180+a)/360}function _e(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ge(a,t){return a/pe(t)}function Oe(a){return 360*a-180}function Ge(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function He(a,t){return a*pe(Ge(t))}const Qe=85.051129;function nt(a){return Math.cos(Ue(It(a,-Qe,Qe)))}function tt(a,t){const r=It(t,J,oe),h=Math.pow(2,r);return nt(a)*W/(512*h)}function at(a){return 1/Math.cos(a*Math.PI/180)}function wt(a,t=0){const r=Math.exp(Math.PI*(1-(a.y+t/un)/(1<<a.z)*2));return 80150034*r/(r*r+1)/un/(1<<a.z)}class Ot{constructor(t,r,h=0){this.x=+t,this.y=+r,this.z=+h}static fromLngLat(t,r=0){const h=j.convert(t);return new Ot(ue(h.lng),_e(h.lat),ge(r,h.lat))}toLngLat(){return new j(Oe(this.x),Ge(this.y))}toAltitude(){return He(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/W*at(Ge(this.y))}}function Ct(a,t,r,h,g,d,_,T,I){const z=(t+h)/2,b=(r+g)/2,L=new Ye(z,b);T(L),function(P,C,R,F,q,Z){const te=R-q,ie=F-Z;return Math.abs((F-C)*te-(R-P)*ie)/Math.hypot(te,ie)}(L.x,L.y,d.x,d.y,_.x,_.y)>=I?(Ct(a,t,r,z,b,d,L,T,I),Ct(a,z,b,h,g,L,_,T,I)):a.push(_)}function St(a,t,r){let h=a[0],g=h.x,d=h.y;t(h);const _=[h];for(let T=1;T<a.length;T++){const I=a[T],{x:z,y:b}=I;t(I),Ct(_,g,d,z,b,h,I,t,r),g=z,d=b,h=I}return _}function si(a,t,r,h){if(h(t,r)){const g=t.add(r)._mult(.5);si(a,t,g,h),si(a,g,r,h)}else a.push(r)}function di(a,t){let r=a[0];const h=[r];for(let g=1;g<a.length;g++){const d=a[g];si(h,r,d,t),r=d}return h}const Si=Math.pow(2,14)-1,Gi=-Si-1;function Ki(a,t){const r=Math.round(a.x*t),h=Math.round(a.y*t);return a.x=It(r,Gi,Si),a.y=It(h,Gi,Si),(r<a.x||r>a.x+1||h<a.y||h>a.y+1)&&Wn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function qt(a,t,r){const h=a.loadGeometry(),g=a.extent,d=un/g;if(t&&r&&r.projection.isReprojectedInTileSpace){const _=1<<t.z,{scale:T,x:I,y:z,projection:b}=r,L=P=>{const C=Oe((t.x+P.x/g)/_),R=Ge((t.y+P.y/g)/_),F=b.project(C,R);P.x=(F.x*T-I)*g,P.y=(F.y*T-z)*g};for(let P=0;P<h.length;P++)if(a.type!==1)h[P]=St(h[P],L,1);else{const C=[];for(const R of h[P])R.x<0||R.x>=g||R.y<0||R.y>=g||(L(R),C.push(R));h[P]=C}}for(const _ of h)for(const T of _)Ki(T,d);return h}function wi(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?qt(a):[]}}function hi(a,t,r,h,g){a.emplaceBack(2*t+(h+1)/2,2*r+(g+1)/2)}function Ti(a,t,r){a.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ci{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new cc,this.indexArray=new qs,this.segments=new Js,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(t,r){}populate(t,r,h,g){const d=this.layers[0],_=[];let T=null;d.type==="circle"&&(T=d.layout.get("circle-sort-key"));for(const{feature:z,id:b,index:L,sourceLayerIndex:P}of t){const C=this.layers[0]._featureFilter.needGeometry,R=wi(z,C);if(!this.layers[0]._featureFilter.filter(new eo(this.zoom),R,h))continue;const F=T?T.evaluate(R,{},h):void 0,q={id:b,properties:z.properties,type:z.type,sourceLayerIndex:P,index:L,geometry:C?R.geometry:qt(z,h,g),patterns:{},sortKey:F};_.push(q)}T&&_.sort((z,b)=>z.sortKey-b.sortKey);let I=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new El,I=g.projection);for(const z of _){const{geometry:b,index:L,sourceLayerIndex:P}=z,C=t[L].feature;this.addFeature(z,b,L,r.availableImages,h,I,r.brightness),r.featureIndex.insert(C,b,L,P,this.index)}}update(t,r,h,g,d){const _=Object.keys(t).length!==0;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,_?this.stateDependentLayers:this.layers,h,g,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jf.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Za.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,r,h,g,d,_,T){for(const I of r)for(const z of I){const b=z.x,L=z.y;if(b<0||b>=un||L<0||L>=un)continue;if(_){const R=_.projectTilePoint(b,L,d),F=_.upVector(d,b,L),q=this.globeExtVertexArray;Ti(q,R,F),Ti(q,R,F),Ti(q,R,F),Ti(q,R,F)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),C=P.vertexLength;hi(this.layoutVertexArray,b,L,-1,-1),hi(this.layoutVertexArray,b,L,1,-1),hi(this.layoutVertexArray,b,L,1,1),hi(this.layoutVertexArray,b,L,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,{},g,d,T)}}function gi(a,t){for(let r=0;r<a.length;r++)if(Nr(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(Nr(a,t[r]))return!0;return!!An(a,t)}function Xi(a,t,r){return!!Nr(a,t)||!!dn(t,a,r)}function zn(a,t){if(a.length===1)return dr(t,a[0]);for(let r=0;r<t.length;r++){const h=t[r];for(let g=0;g<h.length;g++)if(Nr(a,h[g]))return!0}for(let r=0;r<a.length;r++)if(dr(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(An(a,t[r]))return!0;return!1}function $n(a,t,r){if(a.length>1){if(An(a,t))return!0;for(let h=0;h<t.length;h++)if(dn(t[h],a,r))return!0}for(let h=0;h<a.length;h++)if(dn(a[h],t,r))return!0;return!1}function An(a,t){if(a.length===0||t.length===0)return!1;for(let r=0;r<a.length-1;r++){const h=a[r],g=a[r+1];for(let d=0;d<t.length-1;d++)if(kn(h,g,t[d],t[d+1]))return!0}return!1}function kn(a,t,r,h){return Ls(a,r,h)!==Ls(t,r,h)&&Ls(a,t,r)!==Ls(a,t,h)}function dn(a,t,r){const h=r*r;if(t.length===1)return a.distSqr(t[0])<h;for(let g=1;g<t.length;g++)if(tr(a,t[g-1],t[g])<h)return!0;return!1}function tr(a,t,r){const h=t.distSqr(r);if(h===0)return a.distSqr(t);const g=((a.x-t.x)*(r.x-t.x)+(a.y-t.y)*(r.y-t.y))/h;return a.distSqr(g<0?t:g>1?r:r.sub(t)._mult(g)._add(t))}function dr(a,t){let r,h,g,d=!1;for(let _=0;_<a.length;_++){r=a[_];for(let T=0,I=r.length-1;T<r.length;I=T++)h=r[T],g=r[I],h.y>t.y!=g.y>t.y&&t.x<(g.x-h.x)*(t.y-h.y)/(g.y-h.y)+h.x&&(d=!d)}return d}function Nr(a,t){let r=!1;for(let h=0,g=a.length-1;h<a.length;g=h++){const d=a[h],_=a[g];d.y>t.y!=_.y>t.y&&t.x<(_.x-d.x)*(t.y-d.y)/(_.y-d.y)+d.x&&(r=!r)}return r}function as(a,t,r,h,g){for(const _ of a)if(t<=_.x&&r<=_.y&&h>=_.x&&g>=_.y)return!0;const d=[new Ye(t,r),new Ye(t,g),new Ye(h,g),new Ye(h,r)];if(a.length>2){for(const _ of d)if(Nr(a,_))return!0}for(let _=0;_<a.length-1;_++)if(Ur(a[_],a[_+1],d))return!0;return!1}function Ur(a,t,r){const h=r[0],g=r[2];if(a.x<h.x&&t.x<h.x||a.x>g.x&&t.x>g.x||a.y<h.y&&t.y<h.y||a.y>g.y&&t.y>g.y)return!1;const d=Ls(a,t,r[0]);return d!==Ls(a,t,r[1])||d!==Ls(a,t,r[2])||d!==Ls(a,t,r[3])}function vs(a,t,r,h,g,d){let _=t.y-a.y,T=a.x-t.x;if(d=d||0){const I=_*_+T*T;if(I===0)return!0;const z=Math.sqrt(I);_/=z,T/=z}return!((r.x-a.x)*_+(r.y-a.y)*T-d<0||(h.x-a.x)*_+(h.y-a.y)*T-d<0||(g.x-a.x)*_+(g.y-a.y)*T-d<0)}function Xr(a,t,r,h,g,d,_){return!(vs(a,t,h,g,d,_)||vs(t,r,h,g,d,_)||vs(r,a,h,g,d,_)||vs(h,g,a,t,r,_)||vs(g,d,a,t,r,_)||vs(d,h,a,t,r,_))}function Ss(a,t,r){const h=t.paint.get(a).value;return h.kind==="constant"?h.value:r.programConfigurations.get(t.id).getMaxValue(a)}function br(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ds(a,t,r,h,g){if(!t[0]&&!t[1])return a;const d=Ye.convert(t)._mult(g);r==="viewport"&&d._rotate(-h);const _=[];for(let T=0;T<a.length;T++)_.push(a[T].sub(d));return _}function ps(a,t,r,h){const g=Ye.convert(a)._mult(h);return t==="viewport"&&g._rotate(-r),g}let Er,ts;Sn(Ci,"CircleBucket",{omit:["layers"]});var Gs,ra={exports:{}},Ya=(Gs||(Gs=1,function(a,t){(function(r){function h(d,_,T){var I=g(256*d,256*(_=Math.pow(2,T)-_-1),T),z=g(256*(d+1),256*(_+1),T);return I[0]+","+I[1]+","+z[0]+","+z[1]}function g(d,_,T){var I=2*Math.PI*6378137/256/Math.pow(2,T);return[d*I-2*Math.PI*6378137/2,_*I-2*Math.PI*6378137/2]}r.getURL=function(d,_,T,I,z,b){return b=b||{},d+"?"+["bbox="+h(T,I,z),"format="+(b.format||"image/png"),"service="+(b.service||"WMS"),"version="+(b.version||"1.1.1"),"request="+(b.request||"GetMap"),"srs="+(b.srs||"EPSG:3857"),"width="+(b.width||256),"height="+(b.height||256),"layers="+_].join("&")},r.getTileBBox=h,r.getMercCoords=g,Object.defineProperty(r,"__esModule",{value:!0})})(t)}(0,ra.exports)),ra.exports);class Eo{constructor(t,r,h){this.z=t,this.x=r,this.y=h,this.key=Yr(0,t,t,r,h)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r){const h=Ya.getTileBBox(this.x,this.y,this.z),g=function(d,_,T){let I,z="";for(let b=d;b>0;b--)I=1<<b-1,z+=(_&I?1:0)+(T&I?2:0);return z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wr{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Yr(t,r.z,r.z,r.x,r.y)}}class Hr{constructor(t,r,h,g,d){this.overscaledZ=t,this.wrap=r,this.canonical=new Eo(h,+g,+d),this.key=r===0&&t===h?this.canonical.key:Yr(r,t,h,g,d)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new Hr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return Yr(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-t;return Yr(this.wrap*+r,t,t,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new Hr(r,this.wrap,r,h,g),new Hr(r,this.wrap,r,h+1,g),new Hr(r,this.wrap,r,h,g+1),new Hr(r,this.wrap,r,h+1,g+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Hr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Yr(a,t,r,h,g){const d=1<<Math.min(r,22);let _=d*(g%d)+h%d;return a&&r<22&&(_+=d*d*((a<0?-2*a-1:2*a)%(1<<2*(22-r)))),16*(32*_+r)+(t-r)}const is=[a=>{let t=a.canonical.x-1,r=a.wrap;return t<0&&(t=(1<<a.canonical.z)-1,r--),new Hr(a.overscaledZ,r,a.canonical.z,t,a.canonical.y)},a=>{let t=a.canonical.x+1,r=a.wrap;return t===1<<a.canonical.z&&(t=0,r++),new Hr(a.overscaledZ,r,a.canonical.z,t,a.canonical.y)},a=>new Hr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Hr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Sn(Eo,"CanonicalTileID"),Sn(Hr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Es=Qr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Os}=Es,Do=Qr([{name:"a_pos_3",components:3,type:"Int16"}]);var Il=Qr([{name:"a_pos",type:"Int16",components:2}]);class Ma{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,h){const g=ot.vec3.dot(r,this.dir);if(Math.abs(g)<1e-6)return!1;const d=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/g;return h[0]=this.pos[0]+this.dir[0]*d,h[1]=this.pos[1]+this.dir[1]*d,h[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(t,r,h){if(ot.vec3.equals(this.pos,t)||r===0)return h[0]=h[1]=h[2]=0,!1;const[g,d,_]=this.dir,T=this.pos[0]-t[0],I=this.pos[1]-t[1],z=this.pos[2]-t[2],b=g*g+d*d+_*_,L=2*(T*g+I*d+z*_),P=L*L-4*b*(T*T+I*I+z*z-r*r);if(P<0){const C=Math.max(-L/2,0),R=T+g*C,F=I+d*C,q=z+_*C,Z=Math.hypot(R,F,q);return h[0]=R*r/Z,h[1]=F*r/Z,h[2]=q*r/Z,!1}{const C=(-L-Math.sqrt(P))/(2*b);if(C<0){const R=Math.hypot(T,I,z);return h[0]=T*r/R,h[1]=I*r/R,h[2]=z*r/R,!1}return h[0]=T+g*C,h[1]=I+d*C,h[2]=z+_*C,!0}}}class ha{constructor(t,r,h,g,d){this.TL=t,this.TR=r,this.BR=h,this.BL=g,this.horizon=d}static fromInvProjectionMatrix(t,r,h){const g=[-1,1,1],d=[1,1,1],_=[1,-1,1],T=[-1,-1,1],I=ot.vec3.transformMat4(g,g,t),z=ot.vec3.transformMat4(d,d,t),b=ot.vec3.transformMat4(_,_,t),L=ot.vec3.transformMat4(T,T,t);return new ha(I,z,b,L,r/h)}}function Ka(a,t,r){let h=1/0,g=-1/0;const d=[];for(const _ of a){ot.vec3.sub(d,_,t);const T=ot.vec3.dot(d,r);h=Math.min(h,T),g=Math.max(g,T)}return[h,g]}function Ja(a,t){let r=!0;for(let h=0;h<a.planes.length;h++){const g=a.planes[h];let d=0;for(let _=0;_<t.length;_++)d+=ot.vec3.dot(g,t[_])+g[3]>=0;if(d===0)return 0;d!==t.length&&(r=!1)}return r?2:1}function Sa(a,t){for(const r of a.projections){const h=Ka(t,a.points[0],r.axis);if(r.projection[1]<h[0]||r.projection[0]>h[1])return 0}return 1}function Qa(a,t){let r=0;const h=[0,0,0,0];for(let g=0;g<a.length;g++)h[0]=a[g][0],h[1]=a[g][1],h[2]=a[g][2],h[3]=1,ot.vec4.dot(h,t)>=0&&r++;return r}class ka{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=ls.fromPoints(this.points),this.projections=[],this.frustumEdges=[ot.vec3.sub([],this.points[2],this.points[3]),ot.vec3.sub([],this.points[0],this.points[3]),ot.vec3.sub([],this.points[4],this.points[0]),ot.vec3.sub([],this.points[5],this.points[1]),ot.vec3.sub([],this.points[6],this.points[2]),ot.vec3.sub([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const g=[0,-h[2],h[1]],d=[h[2],0,-h[0]];this.projections.push({axis:g,projection:Ka(this.points,this.points[0],g)}),this.projections.push({axis:d,projection:Ka(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(t,r,h,g){const d=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(z=>{const b=ot.vec4.transformMat4([],z,t),L=1/b[3]/r*d;return ot.vec4.mul(b,b,[L,L,g?1/b[3]:L,L])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(z=>{const b=ot.vec3.sub([],_[z[0]],_[z[1]]),L=ot.vec3.sub([],_[z[2]],_[z[1]]),P=ot.vec3.normalize([],ot.vec3.cross([],b,L)),C=-ot.vec3.dot(P,_[z[1]]);return P.concat(C)}),I=[];for(let z=0;z<_.length;z++)I.push([_[z][0],_[z][1],_[z][2]]);return new ka(I,T)}intersectsPrecise(t,r,h){for(let g=0;g<r.length;g++)if(!Qa(t,r[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!Qa(t,this.planes[g]))return 0;for(const g of h)for(const d of this.frustumEdges){const _=ot.vec3.cross([],g,d),T=ot.vec3.length(_);if(T===0)continue;ot.vec3.scale(_,_,1/T);const I=Ka(this.points,this.points[0],_),z=Ka(t,this.points[0],_);if(I[0]>z[1]||z[0]>I[1])return 0}return 1}containsPoint(t){for(const r of this.planes){const h=r[3];if(ot.vec3.dot([r[0],r[1],r[2]],t)+h<0)return!1}return!0}}class ls{static fromPoints(t){const r=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const g of t)ot.vec3.min(r,r,g),ot.vec3.max(h,h,g);return new ls(r,h)}static fromTileIdAndHeight(t,r,h){const g=1<<t.canonical.z,d=t.canonical.x,_=t.canonical.y;return new ls([d/g,_/g,r],[(d+1)/g,(_+1)/g,h])}static applyTransform(t,r){const h=t.getCorners();for(let g=0;g<h.length;++g)ot.vec3.transformMat4(h[g],h[g],r);return ls.fromPoints(h)}static applyTransformFast(t,r){const h=[r[12],r[13],r[14]],g=[...h];for(let d=0;d<3;d++)for(let _=0;_<3;_++){const T=r[4*_+d],I=T*t.min[_],z=T*t.max[_];h[d]+=Math.min(I,z),g[d]+=Math.max(I,z)}return new ls(h,g)}static projectAabbCorners(t,r){const h=t.getCorners();for(let g=0;g<h.length;++g)ot.vec3.transformMat4(h[g],h[g],r);return h}constructor(t,r){this.min=t,this.max=r,this.center=ot.vec3.scale([],ot.vec3.add([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],h=ot.vec3.clone(this.min),g=ot.vec3.clone(this.max);for(let d=0;d<r.length;d++)h[d]=r[d]?this.min[d]:this.center[d],g[d]=r[d]?this.center[d]:this.max[d];return g[2]=this.max[2],new ls(h,g)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Ja(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Ja(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,r){return r||this.intersects(t)?Sa(t,this.getCorners()):0}intersectsPreciseFlat(t,r){return r||this.intersectsFlat(t)?Sa(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let r=0;r<3;++r)if(this.min[r]>t.max[r]||t.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t.min[r]),this.max[r]=Math.max(this.max[r],t.max[r])}encapsulatePoint(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t[r]),this.max[r]=Math.max(this.max[r],t[r])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function eu(a){return a*na/U}Sn(ls,"Aabb");const Ip=[new ls([x,x,x],[w,w,w]),new ls([x,x,x],[0,0,w]),new ls([0,x,x],[w,0,w]),new ls([x,0,x],[0,w,w]),new ls([0,0,x],[w,w,w])];function tu(a,t,r,h=!0){const g=ot.vec3.scale([],a._camera.position,a.worldSize),d=[t,r,1,1];ot.vec4.transformMat4(d,d,a.pixelMatrixInverse),ot.vec4.scale(d,d,1/d[3]);const _=ot.vec3.sub([],d,g),T=ot.vec3.normalize([],_),I=a.globeMatrix,z=[I[12],I[13],I[14]],b=ot.vec3.sub([],z,g),L=ot.vec3.length(b),P=ot.vec3.normalize([],b),C=a.worldSize/(2*Math.PI),R=ot.vec3.dot(P,T),F=Math.asin(C/L);if(F<Math.acos(R)){if(!h)return null;const Mt=[],Ne=[];ot.vec3.scale(Mt,T,L/R),ot.vec3.normalize(Ne,ot.vec3.sub(Ne,Mt,b)),ot.vec3.normalize(T,ot.vec3.add(T,b,ot.vec3.scale(T,Ne,Math.tan(F)*L)))}const q=[];new Ma(g,T).closestPointOnSphere(z,C,q);const Z=ot.vec3.normalize([],ro(I,0)),te=ot.vec3.normalize([],ro(I,1)),ie=ot.vec3.normalize([],ro(I,2)),K=ot.vec3.dot(Z,q),ce=ot.vec3.dot(te,q),he=ot.vec3.dot(ie,q),Se=We(Math.asin(-ce/C));let $e=We(Math.atan2(K,he));$e=a.center.lng+function(Mt,Ne){const ft=(Ne-Mt+180)%360-180;return ft<-180?ft+360:ft}(a.center.lng,$e);const Be=ue($e),Ve=It(_e(Se),0,1);return new Ot(Be,Ve)}class Td{constructor(t,r,h){this.a=ot.vec3.sub([],t,h),this.b=ot.vec3.sub([],r,h),this.center=h;const g=ot.vec3.normalize([],this.a),d=ot.vec3.normalize([],this.b);this.angle=Math.acos(ot.vec3.dot(g,d))}}function Gu(a,t){if(a.angle===0)return null;let r;return r=a.a[t]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[t]/a.a[t]/Math.sin(a.angle)-1/Math.tan(a.angle)),r<0||r>1?null:function(h,g,d,_){const T=Math.sin(d);return h*(Math.sin((1-_)*d)/T)+g*(Math.sin(_*d)/T)}(a.a[t],a.b[t],a.angle,It(r,0,1))+a.center[t]}function Kl(a){if(a.z<=1)return Ip[a.z+2*a.y+a.x];const t=sg(Rp(a));return ls.fromPoints(t)}function Rl(a,t,r){return ot.vec3.scale(a,a,1-r),ot.vec3.scaleAndAdd(a,a,t,r)}function L_(a,t,r){for(const h of a)ot.vec3.transformMat4(h,h,t),ot.vec3.scale(h,h,r)}function $f(a,t,r,h){const g=t/a.worldSize,d=a.globeMatrix;if(r.z<=1){const Be=Kl(r).getCorners();return L_(Be,d,g),ls.fromPoints(Be)}const _=Rp(r,h),T=sg(_,na+eu(a._tileCoverLift));L_(T,d,g);const I=Number.MAX_VALUE,z=[-I,-I,-I],b=[I,I,I];if(_.contains(a.center)){for(const Mt of T)ot.vec3.min(b,b,Mt),ot.vec3.max(z,z,Mt);z[2]=0;const Be=a.point,Ve=[Be.x*g,Be.y*g,0];return ot.vec3.min(b,b,Ve),ot.vec3.max(z,z,Ve),new ls(b,z)}if(a._tileCoverLift>0){for(const Be of T)ot.vec3.min(b,b,Be),ot.vec3.max(z,z,Be);return new ls(b,z)}const L=[d[12]*g,d[13]*g,d[14]*g],P=_.getCenter(),C=It(a.center.lat,-Qe,Qe),R=It(P.lat,-Qe,Qe),F=ue(a.center.lng),q=_e(C);let Z=F-ue(P.lng);const te=q-_e(R);Z>.5?Z-=1:Z<-.5&&(Z+=1);let ie=0;if(Math.abs(Z)>Math.abs(te))ie=Z>=0?1:3;else{ie=te>=0?0:2;const Be=[d[4]*g,d[5]*g,d[6]*g],Ve=-Math.sin(Ue(te>=0?_.getSouth():_.getNorth()))*na;ot.vec3.scaleAndAdd(L,L,Be,Ve)}const K=T[ie],ce=T[(ie+1)%4],he=new Td(K,ce,L),Se=[Gu(he,0)||K[0],Gu(he,1)||K[1],Gu(he,2)||K[2]],$e=iu(a.zoom);if($e>0){const Be=function({x:Mt,y:Ne,z:ft},Pt,Dt,Ut,ei){const ri=1/(1<<ft);let Yt=Mt*ri,yi=Yt+ri,Fi=Ne*ri,pi=Fi+ri,Tn=0;const ln=(Yt+yi)/2-Ut;return ln>.5?Tn=-1:ln<-.5&&(Tn=1),Yt=((Yt+Tn)*Pt-(Ut*=Pt))*Dt+Ut,yi=((yi+Tn)*Pt-Ut)*Dt+Ut,Fi=(Fi*Pt-(ei*=Pt))*Dt+ei,pi=(pi*Pt-ei)*Dt+ei,[[Yt,pi,0],[yi,pi,0],[yi,Fi,0],[Yt,Fi,0]]}(r,t,a._pixelsPerMercatorPixel,F,q);for(let Mt=0;Mt<T.length;Mt++)Rl(T[Mt],Be[Mt],$e);const Ve=ot.vec3.add([],Be[ie],Be[(ie+1)%4]);ot.vec3.scale(Ve,Ve,.5),Rl(Se,Ve,$e)}for(const Be of T)ot.vec3.min(b,b,Be),ot.vec3.max(z,z,Be);return b[2]=Math.min(K[2],ce[2]),ot.vec3.min(b,b,Se),ot.vec3.max(z,z,Se),new ls(b,z)}function Rp({x:a,y:t,z:r},h=!1){const g=1/(1<<r),d=new j(Oe(a*g),t===(1<<r)-1&&h?-90:Ge((t+1)*g)),_=new j(Oe((a+1)*g),t===0&&h?90:Ge(t*g));return new Y(d,_)}function sg(a,t=na){const r=Ue(a.getNorth()),h=Ue(a.getSouth()),g=Math.cos(r),d=Math.cos(h),_=Math.sin(r),T=Math.sin(h),I=a.getWest(),z=a.getEast();return[A(d,T,I,t),A(d,T,z,t),A(g,_,z,t),A(g,_,I,t)]}function Zf(a,t,r,h){const g=1<<r.z,d=(a/un+r.x)/g;return k(Ge((t/un+r.y)/g),Oe(d),h)}function Xf({min:a,max:t}){return i/Math.max(t[0]-a[0],t[1]-a[1],t[2]-a[2])}const I_=new Float64Array(16);function Yf(a){const t=Xf(a),r=ot.mat4.fromScaling(I_,[t,t,t]);return ot.mat4.translate(r,r,ot.vec3.negate([],a.min))}function og(a){const t=ot.mat4.fromTranslation(I_,a.min),r=1/Xf(a);return ot.mat4.scale(t,t,[r,r,r])}function Kf(a){const t=un/(2*Math.PI);return a/(2*Math.PI)/t}function hy(a,t){return un/(512*Math.pow(2,a))*Xf(Kl(t))}function Jf(a,t,r,h,g){const d=Kf(r),_=[a,t,-r/(2*Math.PI)],T=ot.mat4.identity(new Float64Array(16));return ot.mat4.translate(T,T,_),ot.mat4.scale(T,T,[d,d,d]),ot.mat4.rotateX(T,T,Ue(-g)),ot.mat4.rotateY(T,T,Ue(-h)),T}function iu(a){return ui(fo,f,a)}function R_(a,t){const r=k(t.lat,t.lng),h=function(d){const _=k(d._center.lat,d._center.lng),T=ot.vec3.fromValues(0,1,0);let I=ot.vec3.cross([],T,_);const z=ot.mat4.fromRotation([],-d.angle,_);I=ot.vec3.transformMat4(I,I,z),ot.mat4.fromRotation(z,-d._pitch,I);const b=ot.vec3.normalize([],_);return ot.vec3.scale(b,b,eu(d.cameraToCenterDistance/d.pixelsPerMeter)),ot.vec3.transformMat4(b,b,z),ot.vec3.add([],_,b)}(a),g=ot.vec3.subtract([],h,r);return ot.vec3.angle(g,r)}function ag(a,t){return R_(a,t)>Math.PI/2*1.01}const P_=Ue(85),dy=Math.cos(P_),py=Math.sin(P_),fy=ot.mat4.create(),D_=a=>{const t=[];return a.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function Ih(a,t,r,h,g,d,_,T,I){if(d&&a.queryGeometry.isAboveHorizon)return!1;d&&(I*=a.pixelToTileUnitsFactor);const z=a.tileID.canonical,b=r.projection.upVectorScale(z,r.center.lat,r.worldSize).metersToTile;for(const L of t)for(const P of L){const C=P.add(T),R=g&&r.elevation?r.elevation.exaggeration()*g.getElevationAt(C.x,C.y,!0):0,F=r.projection.projectTilePoint(C.x,C.y,z);if(R>0){const ie=r.projection.upVector(z,C.x,C.y);F.x+=ie[0]*b*R,F.y+=ie[1]*b*R,F.z+=ie[2]*b*R}const q=d?C:my(F.x,F.y,F.z,h),Z=d?a.tilespaceRays.map(ie=>O_(ie,R)):a.queryGeometry.screenGeometry,te=ot.vec4.transformMat4([],[F.x,F.y,F.z,1],h);if(!_&&d?I*=te[3]/r.cameraToCenterDistance:_&&!d&&(I*=r.cameraToCenterDistance/te[3]),d){const ie=Ge((P.y/un+z.y)/(1<<z.z));I/=r.projection.pixelsPerMeter(ie,1)/ge(1,ie)}if(Xi(Z,q,I))return!0}return!1}function my(a,t,r,h){const g=ot.vec4.transformMat4([],[a,t,r,1],h);return new Ye(g[0]/g[3],g[1]/g[3])}const gy=ot.vec3.fromValues(0,0,0),Md=ot.vec3.fromValues(0,0,1);function O_(a,t){const r=ot.vec3.create();return gy[2]=t,a.intersectsPlane(gy,Md,r),new Ye(r[0],r[1])}class Rh extends Ci{}let z_,_y,Ph,k_;function F_(a,{width:t,height:r},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==t*r*h)throw new RangeError("mismatched image size")}else g=new Uint8Array(t*r*h);return a.width=t,a.height=r,a.data=g,a}function yy(a,t,r){const{width:h,height:g}=t;h===a.width&&g===a.height||(B_(a,t,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,h),height:Math.min(a.height,g)},r,null),a.width=h,a.height=g,a.data=t.data)}function B_(a,t,r,h,g,d,_,T){if(g.width===0||g.height===0)return t;if(g.width>a.width||g.height>a.height||r.x>a.width-g.width||r.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>t.width||g.height>t.height||h.x>t.width-g.width||h.y>t.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const I=a.data,z=t.data,b=d===4&&T;for(let L=0;L<g.height;L++){const P=((r.y+L)*a.width+r.x)*d,C=((h.y+L)*t.width+h.x)*d;if(b)for(let R=0;R<g.width;R++){const F=P+R*d+3,q=C+R*d;z[q+0]=255,z[q+1]=255,z[q+2]=255,z[q+3]=I[F]}else if(_)for(let R=0;R<g.width;R++){const F=P+R*d,q=C+R*d,Z=I[F+3],te=new Ee(I[F+0]/255*Z,I[F+1]/255*Z,I[F+2]/255*Z,Z).toRenderColor(_).toArray();z[q+0]=te[0],z[q+1]=te[1],z[q+2]=te[2],z[q+3]=te[3]}else for(let R=0;R<g.width*d;R++)z[C+R]=I[P+R]}return t}Sn(Rh,"HeatmapBucket",{omit:["layers"]});class nu{constructor(t,r){F_(this,t,1,r)}resize(t){yy(this,new nu(t),1)}clone(){return new nu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,h,g,d){B_(t,r,h,g,d,1,null)}}class Ea{constructor(t,r){F_(this,t,4,r)}resize(t){yy(this,new Ea(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ea({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,h,g,d,_,T){B_(t,r,h,g,d,4,_,T)}}class vy{constructor(t,r){this.width=t.width,this.height=t.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function Qf(a){const t={},r=a.resolution||256,h=a.clips?a.clips.length:1,g=a.image||new Ea({width:r,height:h}),d=(_,T,I)=>{t[a.evaluationKey]=I;const z=a.expression.evaluate(t);z&&(g.data[_+T+0]=Math.floor(255*z.r/z.a),g.data[_+T+1]=Math.floor(255*z.g/z.a),g.data[_+T+2]=Math.floor(255*z.b/z.a),g.data[_+T+3]=Math.floor(255*z.a))};if(a.clips)for(let _=0,T=0;_<h;++_,T+=4*r)for(let I=0,z=0;I<r;I++,z+=4){const b=I/(r-1),{start:L,end:P}=a.clips[_];d(T,z,L*(1-b)+P*b)}else for(let _=0,T=0;_<r;_++,T+=4)d(0,T,_/(r-1));return g}Sn(nu,"AlphaImage"),Sn(Ea,"RGBAImage");const Sx=Qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ex}=Sx;function em(a,t,r=2){const h=t&&t.length,g=h?t[0]*r:a.length;let d=xy(a,0,g,r,!0);const _=[];if(!d||d.next===d.prev)return _;let T,I,z;if(h&&(d=function(b,L,P,C){const R=[];for(let F=0,q=L.length;F<q;F++){const Z=xy(b,L[F]*C,F<q-1?L[F+1]*C:b.length,C,!1);Z===Z.next&&(Z.steiner=!0),R.push(Dp(Z))}R.sort(Ty);for(let F=0;F<R.length;F++)P=My(R[F],P);return P}(a,t,d,r)),a.length>80*r){T=1/0,I=1/0;let b=-1/0,L=-1/0;for(let P=r;P<g;P+=r){const C=a[P],R=a[P+1];C<T&&(T=C),R<I&&(I=R),C>b&&(b=C),R>L&&(L=R)}z=Math.max(b-T,L-I),z=z!==0?32767/z:0}return Pp(d,_,r,T,I,z,0),_}function xy(a,t,r,h,g){let d;if(g===function(_,T,I,z){let b=0;for(let L=T,P=I-z;L<I;L+=z)b+=(_[P]-_[L])*(_[L+1]+_[P+1]),P=L;return b}(a,t,r,h)>0)for(let _=t;_<r;_+=h)d=G_(_/h|0,a[_],a[_+1],d);else for(let _=r-h;_>=t;_-=h)d=G_(_/h|0,a[_],a[_+1],d);return d&&tm(d,d.next)&&(im(d),d=d.next),d}function Ms(a,t){if(!a)return a;t||(t=a);let r,h=a;do if(r=!1,h.steiner||!tm(h,h.next)&&Ao(h.prev,h,h.next)!==0)h=h.next;else{if(im(h),h=t=h.prev,h===h.next)break;r=!0}while(r||h!==t);return t}function Pp(a,t,r,h,g,d,_){if(!a)return;!_&&d&&function(I,z,b,L){let P=I;do P.z===0&&(P.z=cg(P.x,P.y,z,b,L)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==I);P.prevZ.nextZ=null,P.prevZ=null,function(C){let R,F=1;do{let q,Z=C;C=null;let te=null;for(R=0;Z;){R++;let ie=Z,K=0;for(let he=0;he<F&&(K++,ie=ie.nextZ,ie);he++);let ce=F;for(;K>0||ce>0&&ie;)K!==0&&(ce===0||!ie||Z.z<=ie.z)?(q=Z,Z=Z.nextZ,K--):(q=ie,ie=ie.nextZ,ce--),te?te.nextZ=q:C=q,q.prevZ=te,te=q;Z=ie}te.nextZ=null,F*=2}while(R>1)}(P)}(a,h,g,d);let T=a;for(;a.prev!==a.next;){const I=a.prev,z=a.next;if(d?by(a,h,g,d):Ax(a))t.push(I.i,a.i,z.i),im(a),a=z.next,T=z.next;else if((a=z)===T){_?_===1?Pp(a=lg(Ms(a),t),t,r,h,g,d,2):_===2&&wy(a,t,r,h,g,d):Pp(Ms(a),t,r,h,g,d,1);break}}}function Ax(a){const t=a.prev,r=a,h=a.next;if(Ao(t,r,h)>=0)return!1;const g=t.x,d=r.x,_=h.x,T=t.y,I=r.y,z=h.y,b=g<d?g<_?g:_:d<_?d:_,L=T<I?T<z?T:z:I<z?I:z,P=g>d?g>_?g:_:d>_?d:_,C=T>I?T>z?T:z:I>z?I:z;let R=h.next;for(;R!==t;){if(R.x>=b&&R.x<=P&&R.y>=L&&R.y<=C&&Sd(g,T,d,I,_,z,R.x,R.y)&&Ao(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function by(a,t,r,h){const g=a.prev,d=a,_=a.next;if(Ao(g,d,_)>=0)return!1;const T=g.x,I=d.x,z=_.x,b=g.y,L=d.y,P=_.y,C=T<I?T<z?T:z:I<z?I:z,R=b<L?b<P?b:P:L<P?L:P,F=T>I?T>z?T:z:I>z?I:z,q=b>L?b>P?b:P:L>P?L:P,Z=cg(C,R,t,r,h),te=cg(F,q,t,r,h);let ie=a.prevZ,K=a.nextZ;for(;ie&&ie.z>=Z&&K&&K.z<=te;){if(ie.x>=C&&ie.x<=F&&ie.y>=R&&ie.y<=q&&ie!==g&&ie!==_&&Sd(T,b,I,L,z,P,ie.x,ie.y)&&Ao(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,K.x>=C&&K.x<=F&&K.y>=R&&K.y<=q&&K!==g&&K!==_&&Sd(T,b,I,L,z,P,K.x,K.y)&&Ao(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;ie&&ie.z>=Z;){if(ie.x>=C&&ie.x<=F&&ie.y>=R&&ie.y<=q&&ie!==g&&ie!==_&&Sd(T,b,I,L,z,P,ie.x,ie.y)&&Ao(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;K&&K.z<=te;){if(K.x>=C&&K.x<=F&&K.y>=R&&K.y<=q&&K!==g&&K!==_&&Sd(T,b,I,L,z,P,K.x,K.y)&&Ao(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function lg(a,t){let r=a;do{const h=r.prev,g=r.next.next;!tm(h,g)&&U_(h,r,r.next,g)&&Ad(h,g)&&Ad(g,h)&&(t.push(h.i,r.i,g.i),im(r),im(r.next),r=a=g),r=r.next}while(r!==a);return Ms(r)}function wy(a,t,r,h,g,d){let _=a;do{let T=_.next.next;for(;T!==_.prev;){if(_.i!==T.i&&ug(_,T)){let I=V_(_,T);return _=Ms(_,_.next),I=Ms(I,I.next),Pp(_,t,r,h,g,d,0),void Pp(I,t,r,h,g,d,0)}T=T.next}_=_.next}while(_!==a)}function Ty(a,t){return a.x-t.x}function My(a,t){const r=function(g,d){let _=d;const T=g.x,I=g.y;let z,b=-1/0;do{if(I<=_.y&&I>=_.next.y&&_.next.y!==_.y){const F=_.x+(I-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(F<=T&&F>b&&(b=F,z=_.x<_.next.x?_:_.next,F===T))return z}_=_.next}while(_!==d);if(!z)return null;const L=z,P=z.x,C=z.y;let R=1/0;_=z;do{if(T>=_.x&&_.x>=P&&T!==_.x&&Sd(I<C?T:b,I,P,C,I<C?b:T,I,_.x,_.y)){const F=Math.abs(I-_.y)/(T-_.x);Ad(_,g)&&(F<R||F===R&&(_.x>z.x||_.x===z.x&&N_(z,_)))&&(z=_,R=F)}_=_.next}while(_!==L);return z}(a,t);if(!r)return t;const h=V_(r,a);return Ms(h,h.next),Ms(r,r.next)}function N_(a,t){return Ao(a.prev,a,t.prev)<0&&Ao(t.next,a,a.next)<0}function cg(a,t,r,h,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-r)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-h)*g|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Dp(a){let t=a,r=a;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==a);return r}function Sd(a,t,r,h,g,d,_,T){return(g-_)*(t-T)>=(a-_)*(d-T)&&(a-_)*(h-T)>=(r-_)*(t-T)&&(r-_)*(d-T)>=(g-_)*(h-T)}function ug(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(r,h){let g=r;do{if(g.i!==r.i&&g.next.i!==r.i&&g.i!==h.i&&g.next.i!==h.i&&U_(g,g.next,r,h))return!0;g=g.next}while(g!==r);return!1}(a,t)&&(Ad(a,t)&&Ad(t,a)&&function(r,h){let g=r,d=!1;const _=(r.x+h.x)/2,T=(r.y+h.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&_<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(d=!d),g=g.next;while(g!==r);return d}(a,t)&&(Ao(a.prev,a,t.prev)||Ao(a,t.prev,t))||tm(a,t)&&Ao(a.prev,a,a.next)>0&&Ao(t.prev,t,t.next)>0)}function Ao(a,t,r){return(t.y-a.y)*(r.x-t.x)-(t.x-a.x)*(r.y-t.y)}function tm(a,t){return a.x===t.x&&a.y===t.y}function U_(a,t,r,h){const g=Ed(Ao(a,t,r)),d=Ed(Ao(a,t,h)),_=Ed(Ao(r,h,a)),T=Ed(Ao(r,h,t));return g!==d&&_!==T||!(g!==0||!mc(a,r,t))||!(d!==0||!mc(a,h,t))||!(_!==0||!mc(r,a,h))||!(T!==0||!mc(r,t,h))}function mc(a,t,r){return t.x<=Math.max(a.x,r.x)&&t.x>=Math.min(a.x,r.x)&&t.y<=Math.max(a.y,r.y)&&t.y>=Math.min(a.y,r.y)}function Ed(a){return a>0?1:a<0?-1:0}function Ad(a,t){return Ao(a.prev,a,a.next)<0?Ao(a,t,a.next)>=0&&Ao(a,a.prev,t)>=0:Ao(a,t,a.prev)<0||Ao(a,a.next,t)<0}function V_(a,t){const r=hg(a.i,a.x,a.y),h=hg(t.i,t.x,t.y),g=a.next,d=t.prev;return a.next=t,t.prev=a,r.next=g,g.prev=r,h.next=r,r.prev=h,d.next=h,h.prev=d,h}function G_(a,t,r,h){const g=hg(a,t,r);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function im(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function hg(a,t,r){return{i:a,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function nm(a,t){const r=a.length;if(r<=1)return[a];const h=[];let g,d;for(let _=0;_<r;_++){const T=To(a[_]);T!==0&&(a[_].area=Math.abs(T),d===void 0&&(d=T<0),d===T<0?(g&&h.push(g),g=[a[_]]):g.push(a[_]))}if(g&&h.push(g),t>1)for(let _=0;_<h.length;_++)h[_].length<=t||(hf(h[_],t,1,h[_].length-1,Sy),h[_]=h[_].slice(0,t));return h}function Sy(a,t){return t.area-a.area}function dg(a,t,r){const h=r.patternDependencies;let g=!1;for(const d of t){const _=d.paint.get(`${a}-pattern`);_.isConstant()||(g=!0);const T=_.constantOr(null);T&&(g=!0,h[T]=!0)}return g}function Op(a,t,r,h,g){const d=g.patternDependencies;for(const _ of t){const T=_.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:h},r,{},g.availableImages);I=I&&I.name?I.name:I,d[I]=!0,r.patterns[_.id]=I}}return r}class pg{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cc,this.indexArray=new qs,this.indexArray2=new ll,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Js,this.segments2=new Js,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection}updateFootprints(t,r){}populate(t,r,h,g){this.hasPattern=dg("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:T,id:I,index:z,sourceLayerIndex:b}of t){const L=this.layers[0]._featureFilter.needGeometry,P=wi(T,L);if(!this.layers[0]._featureFilter.filter(new eo(this.zoom),P,h))continue;const C=d?d.evaluate(P,{},h,r.availableImages):void 0,R={id:I,properties:T.properties,type:T.type,sourceLayerIndex:b,index:z,geometry:L?P.geometry:qt(T,h,g),patterns:{},sortKey:C};_.push(R)}d&&_.sort((T,I)=>T.sortKey-I.sortKey);for(const T of _){const{geometry:I,index:z,sourceLayerIndex:b}=T;if(this.hasPattern){const L=Op("fill",this.layers,T,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(T,I,z,h,{},r.availableImages,r.brightness);r.featureIndex.insert(t[z].feature,I,z,b,this.index)}}update(t,r,h,g,d){const _=Object.keys(t).length!==0;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,_?this.stateDependentLayers:this.layers,h,g,d)}addFeatures(t,r,h,g,d,_){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,r,h,g,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ex),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,h,g,d,_=[],T){for(const I of nm(r,500)){let z=0;for(const F of I)z+=F.length;const b=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),L=b.vertexLength,P=[],C=[];for(const F of I){if(F.length===0)continue;F!==I[0]&&C.push(P.length/2);const q=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Z=q.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Z+F.length-1,Z),P.push(F[0].x),P.push(F[0].y);for(let te=1;te<F.length;te++)this.layoutVertexArray.emplaceBack(F[te].x,F[te].y),this.indexArray2.emplaceBack(Z+te-1,Z+te),P.push(F[te].x),P.push(F[te].y);q.vertexLength+=F.length,q.primitiveLength+=F.length}const R=em(P,C);for(let F=0;F<R.length;F+=3)this.indexArray.emplaceBack(L+R[F],L+R[F+1],L+R[F+2]);b.vertexLength+=z,b.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,d,_,g,T)}}let rm,Oo,Fo,sm;Sn(pg,"FillBucket",{omit:["layers","patternFeatures"]});class fg{constructor(t,r,h,g){if(this.triangleCount=r.length/3,this.min=new Ye(0,0),this.max=new Ye(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[d,_]=[t[0].clone(),t[0].clone()];for(let L=1;L<t.length;++L){const P=t[L];d.x=Math.min(d.x,P.x),d.y=Math.min(d.y,P.y),_.x=Math.max(_.x,P.x),_.y=Math.max(_.y,P.y)}if(g){const L=Math.ceil(Math.max(_.x-d.x,_.y-d.y)/g);h=Math.max(h,L)}if(h===0)return;this.min=d,this.max=_;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const I=Math.max(T.x,T.y)/h;this.cellsX=Math.max(1,Math.ceil(T.x/I)),this.cellsY=Math.max(1,Math.ceil(T.y/I)),this.xScale=1/I,this.yScale=1/I;const z=[];for(let L=0;L<this.triangleCount;L++){const P=t[r[3*L+0]].sub(this.min),C=t[r[3*L+1]].sub(this.min),R=t[r[3*L+2]].sub(this.min),F=gc(Math.floor(Math.min(P.x,C.x,R.x)),this.xScale,this.cellsX),q=gc(Math.floor(Math.max(P.x,C.x,R.x)),this.xScale,this.cellsX),Z=gc(Math.floor(Math.min(P.y,C.y,R.y)),this.yScale,this.cellsY),te=gc(Math.floor(Math.max(P.y,C.y,R.y)),this.yScale,this.cellsY),ie=new Ye(0,0),K=new Ye(0,0),ce=new Ye(0,0),he=new Ye(0,0);for(let Se=Z;Se<=te;++Se){ie.y=K.y=Se*I,ce.y=he.y=(Se+1)*I;for(let $e=F;$e<=q;++$e)ie.x=ce.x=$e*I,K.x=he.x=($e+1)*I,(Xr(P,C,R,ie,K,he)||Xr(P,C,R,ie,he,ce))&&z.push({cellIdx:Se*this.cellsX+$e,triIdx:L})}}if(z.length===0)return;z.sort((L,P)=>L.cellIdx-P.cellIdx||L.triIdx-P.triIdx);let b=0;for(;b<z.length;){const L=z[b].cellIdx,P={start:this.payload.length,len:0};for(;b<z.length&&z[b].cellIdx===L;)++P.len,this.payload.push(z[b++].triIdx);this.cells[L]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,r){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const h=gc(t.x-this.min.x,this.xScale,this.cellsX),g=gc(t.y-this.min.y,this.yScale,this.cellsY),d=this.cells[g*this.cellsX+h];if(d){this._lazyInitLookup();for(let _=0;_<d.len;_++){const T=this.payload[d.start+_],I=Math.floor(T/8),z=1<<T%8;if(!(this.lookup[I]&z)&&(this.lookup[I]|=z,r.push(T),r.length===this.triangleCount))return}}}query(t,r,h){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>r.x||t.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const g=gc(t.x-this.min.x,this.xScale,this.cellsX),d=gc(r.x-this.min.x,this.xScale,this.cellsX),_=gc(t.y-this.min.y,this.yScale,this.cellsY),T=gc(r.y-this.min.y,this.yScale,this.cellsY);for(let I=_;I<=T;I++)for(let z=g;z<=d;z++){const b=this.cells[I*this.cellsX+z];if(b)for(let L=0;L<b.len;L++){const P=this.payload[b.start+L],C=Math.floor(P/8),R=1<<P%8;if(!(this.lookup[C]&R)&&(this.lookup[C]|=R,h.push(P),h.length===this.triangleCount))return}}}}function gc(a,t,r){return Math.max(0,Math.min(r-1,Math.floor(a*t)))}Sn(fg,"TriangleGridIndex");class om{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(t,r){for(const h of this.footprints)r.push({footprint:h,id:t})}populate(t,r,h,g){const d=[];for(const{feature:_,id:T,index:I,sourceLayerIndex:z}of t){const b=this.layers[0]._featureFilter.needGeometry,L=wi(_,b);if(!this.layers[0]._featureFilter.filter(new eo(this.zoom),L,h))continue;const P={id:T,properties:_.properties,type:_.type,sourceLayerIndex:z,index:I,geometry:b?L.geometry:qt(_,h,g),patterns:{}};d.push(P)}for(const _ of d){const{geometry:T,index:I,sourceLayerIndex:z}=_;this.addFeature(_,T,I,h,{},r.availableImages,r.brightness),r.featureIndex.insert(t[I].feature,T,I,z,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,r,h,g,d){}destroy(){}addFeature(t,r,h,g,d,_=[],T){for(const I of nm(r,2)){const z=[],b=[],L=[],P=new Ye(1/0,1/0),C=new Ye(-1/0,-1/0);for(const q of I)if(q.length!==0){q!==I[0]&&L.push(b.length/2);for(let Z=0;Z<q.length;Z++)b.push(q[Z].x),b.push(q[Z].y),z.push(q[Z]),P.x=Math.min(P.x,q[Z].x),P.y=Math.min(P.y,q[Z].y),C.x=Math.max(C.x,q[Z].x),C.y=Math.max(C.y,q[Z].y)}const R=em(b,L),F=new fg(z,R,8,256);this.footprints.push({vertices:z,indices:R,grid:F,min:P,max:C})}}}Sn(om,"ClipBucket",{omit:["layers"]});const H_=Qr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ey=Qr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ay=Qr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Cx=Qr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Lx=Qr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),S=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:e}=H_;var u,y,v,M,O,V,G,H={};function Q(){if(y)return u;y=1;var a=At();function t(g,d,_,T,I){this.properties={},this.extent=_,this.type=0,this._pbf=g,this._geometry=-1,this._keys=T,this._values=I,g.readFields(r,this,d)}function r(g,d,_){g==1?d.id=_.readVarint():g==2?function(T,I){for(var z=T.readVarint()+T.pos;T.pos<z;){var b=I._keys[T.readVarint()],L=I._values[T.readVarint()];I.properties[b]=L}}(_,d):g==3?d.type=_.readVarint():g==4&&(d._geometry=_.pos)}function h(g){for(var d,_,T=0,I=0,z=g.length,b=z-1;I<z;b=I++)T+=((_=g[b]).x-(d=g[I]).x)*(d.y+_.y);return T}return u=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var d,_=g.readVarint()+g.pos,T=1,I=0,z=0,b=0,L=[];g.pos<_;){if(I<=0){var P=g.readVarint();T=7&P,I=P>>3}if(I--,T===1||T===2)z+=g.readSVarint(),b+=g.readSVarint(),T===1&&(d&&L.push(d),d=[]),d.push(new a(z,b));else{if(T!==7)throw new Error("unknown command "+T);d&&d.push(d[0].clone())}}return d&&L.push(d),L},t.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var d=g.readVarint()+g.pos,_=1,T=0,I=0,z=0,b=1/0,L=-1/0,P=1/0,C=-1/0;g.pos<d;){if(T<=0){var R=g.readVarint();_=7&R,T=R>>3}if(T--,_===1||_===2)(I+=g.readSVarint())<b&&(b=I),I>L&&(L=I),(z+=g.readSVarint())<P&&(P=z),z>C&&(C=z);else if(_!==7)throw new Error("unknown command "+_)}return[b,P,L,C]},t.prototype.toGeoJSON=function(g,d,_){var T,I,z=this.extent*Math.pow(2,_),b=this.extent*g,L=this.extent*d,P=this.loadGeometry(),C=t.types[this.type];function R(Z){for(var te=0;te<Z.length;te++){var ie=Z[te];Z[te]=[360*(ie.x+b)/z-180,360/Math.PI*Math.atan(Math.exp((180-360*(ie.y+L)/z)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(T=0;T<P.length;T++)F[T]=P[T][0];R(P=F);break;case 2:for(T=0;T<P.length;T++)R(P[T]);break;case 3:for(P=function(Z){var te=Z.length;if(te<=1)return[Z];for(var ie,K,ce=[],he=0;he<te;he++){var Se=h(Z[he]);Se!==0&&(K===void 0&&(K=Se<0),K===Se<0?(ie&&ce.push(ie),ie=[Z[he]]):ie.push(Z[he]))}return ie&&ce.push(ie),ce}(P),T=0;T<P.length;T++)for(I=0;I<P[T].length;I++)R(P[T][I])}P.length===1?P=P[0]:C="Multi"+C;var q={type:"Feature",geometry:{type:C,coordinates:P},properties:this.properties};return"id"in this&&(q.id=this.id),q},u}function ee(){if(M)return v;M=1;var a=Q();function t(h,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(r,this,g),this.length=this._features.length}function r(h,g,d){h===15?g.version=d.readVarint():h===1?g.name=d.readString():h===5?g.extent=d.readVarint():h===2?g._features.push(d.pos):h===3?g._keys.push(d.readString()):h===4&&g._values.push(function(_){for(var T=null,I=_.readVarint()+_.pos;_.pos<I;){var z=_.readVarint()>>3;T=z===1?_.readString():z===2?_.readFloat():z===3?_.readDouble():z===4?_.readVarint64():z===5?_.readVarint():z===6?_.readSVarint():z===7?_.readBoolean():null}return T}(d))}return v=t,t.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var g=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,g,this.extent,this._keys,this._values)},v}function se(){return G||(G=1,H.VectorTile=function(){if(V)return O;V=1;var a=ee();function t(r,h,g){if(r===3){var d=new a(g,g.readVarint()+g.pos);d.length&&(h[d.name]=d)}}return O=function(r,h){this.layers=r.readFields(t,{},h)},O}(),H.VectorTileFeature=Q(),H.VectorTileLayer=ee()),H}var ae=se();class de extends Ye{constructor(t,r,h){super(t,r),this.z=h}}class be extends de{constructor(t,r,h,g){super(t,r,h),this.w=g}}function Re(a,t,r,h){const g=[],d=h===0?(_,T,I,z,b,L)=>{_.push(new Ye(L,I+(L-T)/(z-T)*(b-I)))}:(_,T,I,z,b,L)=>{_.push(new Ye(T+(L-I)/(b-I)*(z-T),L))};for(const _ of a){const T=[];for(const I of _){if(I.length<=2)continue;const z=[];for(let P=0;P<I.length-1;P++){const C=I[P].x,R=I[P].y,F=I[P+1].x,q=I[P+1].y,Z=h===0?C:R,te=h===0?F:q;Z<t?te>t&&d(z,C,R,F,q,t):Z>r?te<r&&d(z,C,R,F,q,r):z.push(I[P]),te<t&&Z>=t&&d(z,C,R,F,q,t),te>r&&Z<=r&&d(z,C,R,F,q,r)}let b=I[I.length-1];const L=h===0?b.x:b.y;L>=t&&L<=r&&z.push(b),z.length&&(b=z[z.length-1],z[0].x===b.x&&z[0].y===b.y||z.push(z[0]),T.push(z))}T.length&&g.push(T)}return g}function Te(a,t,r,h){const g=r==="x"?"y":"x",d=(h-a[r])/(t[r]-a[r]);a[g]=a[g]+(t[g]-a[g])*d,a[r]=h,a.hasOwnProperty("z")&&(a.z=Pe(a.z,t.z,d)),a.hasOwnProperty("w")&&(a.w=Pe(a.w,t.w,d))}function ct(a,t,r,h){const g=r,d=h;for(const _ of["x","y"]){let T=a,I=t;T[_]>=I[_]&&(T=t,I=a),T[_]<g&&I[_]>g&&Te(T,I,_,g),T[_]<d&&I[_]>d&&Te(I,T,_,d)}}const Et=Number.MAX_SAFE_INTEGER;function _t(a,t,r,h){return a.order<t||a.order===Et||!(a.clipMask&r)||function(g,d){return d.length!==0&&d.find(_=>_===g)===void 0}(h,a.clipScope)}function jt(a,t){return a.x-t.x||a.y-t.y}function Xt(a,t){return jt(a.min,t.min)===0&&jt(a.max,t.max)===0}function _i(a,t){return!(a.min.x>t.max.x||a.max.x<t.min.x||a.min.y>t.max.y||a.max.y<t.min.y)}function vi(a,t){if(a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(a[r].sourceId!==t[r].sourceId||!Xt(a[r],t[r])||a[r].order!==t[r].order||a[r].clipMask!==t[r].clipMask||!kt(a[r].clipScope,t[r].clipScope))return!1;return!0}function Bi(a,t,r){const h=1/un,g=1/(1<<r.canonical.z),d=(t.x*h+r.canonical.x)*g+r.wrap,_=(t.y*h+r.canonical.y)*g;return{min:new Ye((a.x*h+r.canonical.x)*g+r.wrap,(a.y*h+r.canonical.y)*g),max:new Ye(d,_)}}function Li(a,t,r){const h=1<<r.canonical.z,g=((t.x-r.wrap)*h-r.canonical.x)*un,d=(t.y*h-r.canonical.y)*un;return{min:new Ye(((a.x-r.wrap)*h-r.canonical.x)*un,(a.y*h-r.canonical.y)*un),max:new Ye(g,d)}}function ki(a,t,r,h,g,d,_){const T=a.indices,I=a.vertices,z=[];for(let b=h;b<h+g;b+=3){const L=t[r[b+0]+d],P=t[r[b+1]+d],C=t[r[b+2]+d],R=Math.min(L.x,P.x,C.x),F=Math.max(L.x,P.x,C.x),q=Math.min(L.y,P.y,C.y),Z=Math.max(L.y,P.y,C.y);z.length=0,a.grid.query(new Ye(R,q),new Ye(F,Z),z);for(let te=0;te<z.length;te++){const ie=z[te];if(Xr(I[T[3*ie+0]],I[T[3*ie+1]],I[T[3*ie+2]],L,P,C,_))return!0}}return!1}function Zn(a,t,r,h){if(!a||!r)return!1;let g=a.vertices;if(!t.canonical.equals(h.canonical)||t.wrap!==h.wrap){if(r.vertices.length<a.vertices.length)return Zn(r,h,a,t);const d=t.canonical,_=h.canonical,T=Math.pow(2,_.z-d.z);g=a.vertices.map(I=>new Ye((I.x+d.x*un)*T-_.x*un,(I.y+d.y*un)*T-_.y*un))}return ki(r,g,a.indices,0,a.indices.length,0,0)}function En(a,t,r,h){const g=Math.pow(2,h.z-r.z);return new Ye((a+r.x*un)*g-h.x*un,(t+r.y*un)*g-h.y*un)}function Ji(a,t){const r=[];t.grid.queryPoint(a,r);const h=t.indices,g=t.vertices;for(let d=0;d<r.length;d++){const _=r[d];if(Nr([g[h[3*_+0]],g[h[3*_+1]],g[h[3*_+2]]],a))return!0}return!1}const In=[new Ye(0,0),new Ye(un,0),new Ye(un,un),new Ye(0,un)];function ir(a,t){const r=[];let h=[];if(!t||a.length<2)return[a];if(a.length===2)return Ur(a[0],a[1],In)?[a]:[];for(let g=0;g<a.length+2;g++){const d=a[g%a.length],_=a[(g+1)%a.length],T=Ur(g===0?a[a.length-1]:a[(g-1)%a.length],d,In),I=Ur(d,_,In),z=T||I;z&&h.push(d),z&&I||h.length>0&&(h.length>1&&r.push(h),h=[])}return h.length>1&&r.push(h),r}const rr=ae.VectorTileFeature.types,vr=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],kr=["fill-extrusion-flood-light-ground-radius"],Fr=Math.pow(2,13),Rn=Math.pow(2,15)-1,$t=new Ye(0,1),ii=2147483648;function Qi(a,t,r,h,g,d,_,T){a.emplaceBack((t<<1)+_,(r<<1)+d,(Math.floor(h*Fr)<<1)+g,Math.round(T))}function ji(a,t,r){a.emplaceBack(t.x*un,t.y*un,r?1:0)}function Oi(a,t,r,h,g,d){a.emplaceBack(t.x,t.y,(r.x<<1)+h,(r.y<<1)+g,d)}function Nn(a,t,r){a.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Hn{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Ni{constructor(){this.centroidXY=new Ye(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ye(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ye(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ye(this.max.x-this.min.x,this.max.y-this.min.y)}}class Bt{constructor(){this.acc=new Ye(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,r){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=r.x,t.min.y=t.max.y=r.y)}appendEdge(t,r,h){this.accCount++,this.acc._add(r);let g=!!this.borders;r.x<t.min.x?(t.min.x=r.x,g=!0):r.x>t.max.x&&(t.max.x=r.x,g=!0),r.y<t.min.y?(t.min.y=r.y,g=!0):r.y>t.max.y&&(t.max.y=r.y,g=!0),((r.x===0||r.x===un)&&r.x===h.x)!=((r.y===0||r.y===un)&&r.y===h.y)&&this.processBorderOverlap(r,h),g&&this.checkBorderIntersection(r,h)}checkBorderIntersection(t,r){r.x<0!=t.x<0&&this.addBorderIntersection(0,Pe(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>un!=t.x>un&&this.addBorderIntersection(1,Pe(r.y,t.y,(un-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,Pe(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>un!=t.y>un&&this.addBorderIntersection(3,Pe(r.x,t.x,(un-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[t];r<h[0]&&(h[0]=r),r>h[1]&&(h[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const h=t.x===0?0:1;this.addBorderIntersection(h,r.y),this.addBorderIntersection(h,t.y)}else{const h=t.y===0?2:3;this.addBorderIntersection(h,r.x),this.addBorderIntersection(h,t.x)}}centroid(){return this.accCount===0?new Ye(0,0):new Ye(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0):0}}function Ii(a,t){const r=a.add(t)._unit(),h=It(a.x*r.x+a.y*r.y,-1,1);var g,d,_;return _=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(_)))/4*Rn*((g=a).x*(d=t).y-g.y*d.x<0?-1:1)}const gn=[a=>a.x<0,a=>a.x>un,a=>a.y<0,a=>a.y>un];function vn(a,t,r,h){const g=[4];if(h===0)return g;r._mult(h);const d=a.sub(r),_=t.sub(r),T=[a,t,d,_];for(let I=0;I<4;I++)for(const z of T)if(gn[I](z)){g.push(I);break}return g}class pn{constructor(t){this.vertexArray=new Th,this.indexArray=new qs,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut},r=>kr.includes(r)),this._segments=new Js,this.hiddenByLandmarkVertexArray=new yd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Js}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,r,h,g=!1){const d=t.length;if(d>2){let _=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let I;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const z=t[0],b=t[1];I=Ii(z.sub(t[d-1])._perp()._unit(),b.sub(z)._perp()._unit())}for(let z=0;z<d;z++){const b=z===d-1?0:z+1,L=t[z],P=t[b],C=t[b===d-1?0:b+1],R=P.sub(L)._perp()._unit(),F=Ii(R,C.sub(P)._perp()._unit()),q=I,Z=F;if(Kr(L,P,r)||g&&sa(L,r)&&sa(P,r)){I=F;continue}const te=T.vertexLength;Oi(this.vertexArray,L,P,1,1,q),Oi(this.vertexArray,L,P,1,0,q),Oi(this.vertexArray,L,P,0,1,Z),Oi(this.vertexArray,L,P,0,0,Z),T.vertexLength+=4;const ie=vn(L,P,R,h);for(const K of ie)this._segmentToGroundQuads[_].push({id:te,region:K}),this._segmentToRegionTriCounts[_][K]+=2,T.primitiveLength+=2;I=F}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),r=t.length;for(let h=0;h<r;h++)this._segmentToGroundQuads[h].sort((g,d)=>g.region-d.region);for(let h=0;h<r;h++){const g=this._segmentToGroundQuads[h],d=t[h],_=this._segmentToRegionTriCounts[h];_.reduce((I,z)=>I+z,0);let T=0;for(let I=0;I<=4;I++){const z=_[I];if(z!==0){let b=this.regionSegments[I];b||(b=this.regionSegments[I]=new Js);const L={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+T,vertexLength:d.vertexLength,primitiveLength:z};b.get().push(L)}T+=z}for(let I=0;I<g.length;I++){const z=g[I].id;this.indexArray.emplaceBack(z,z+1,z+3),this.indexArray.emplaceBack(z,z+3,z+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,r,h,g,d,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,r,h,g,d,_)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Ey.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,r,h,g,d,_){this.hasData()&&this.programConfigurations.updatePaintArrays(t,r,h,g,d,_)}updateHiddenByLandmark(t){if(!this.hasData())return;const r=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const h=t.flags&ii?1:0;for(let g=t.groundVertexArrayOffset;g<r;++g)this.hiddenByLandmarkVertexArray.emplace(g,h);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,Lx.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const r=this.regionSegments[t];r&&r.destroy()}}}}class or{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qs,this.footprintVertices=new cc,this.footprintSegments=[],this.layoutVertexArray=new Lu,this.centroidVertexArray=new xd,this.wallVertexArray=new Ch,this.indexArray=new qs,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut},r=>vr.includes(r)),this.segments=new Js,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new pn(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,r){}populate(t,r,h,g){this.features=[],this.hasPattern=dg("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=wt(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:_,index:T,sourceLayerIndex:I}of t){const z=this.layers[0]._featureFilter.needGeometry,b=wi(d,z);if(!this.layers[0]._featureFilter.filter(new eo(this.zoom),b,h))continue;const L={id:_,sourceLayerIndex:I,index:T,geometry:z?b.geometry:qt(d,h,g),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length,C=rr[L.type]==="Polygon";if(this.hasPattern)this.features.push(Op("fill-extrusion",this.layers,L,this.zoom,r));else if(this.wallMode)for(const R of L.geometry)for(const F of ir(R,C))this.addFeature(L,[F],T,h,{},r.availableImages,g,r.brightness);else this.addFeature(L,L.geometry,T,h,{},r.availableImages,g,r.brightness);r.featureIndex.insert(d,L.geometry,T,I,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,r,h,g,d,_){for(const T of this.features){const I=rr[T.type]==="Polygon",{geometry:z}=T;if(this.wallMode)for(const b of z)for(const L of ir(b,I))this.addFeature(T,[L],T.index,r,h,g,d,_);else this.addFeature(T,z,T.index,r,h,g,d,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,r,h,g,d){const _=Object.keys(t).length!==0;if(_&&!this.stateDependentLayers.length)return;const T=_?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,r,T,h,g,d),this.groundEffect.update(t,r,T,h,g,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,e),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,Cx.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,S.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ay.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,h,g,d,_,T,I){const z=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,b=[new Ye(0,0),new Ye(un,un)],L=T.projection,P=L.name==="globe",C=this.wallMode||rr[t.type]==="Polygon",R=new Bt;R.centroidDataIndex=this.centroidData.length;const F=new Ni,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},g)<=0,Z=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},g);let te;if(F.height=Z,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new El),this.wallMode){if(P)return void Wn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;te=function(Ve){const Mt=Ve[0].x===Ve[Ve.length-1].x&&Ve[0].y===Ve[Ve.length-1].y;(function($i){let Di=0;const Kn=$i.length;for(let bn=0;bn<Kn;bn++)Di+=($i[(bn+1)%Kn].x-$i[bn].x)*($i[(bn+1)%Kn].y+$i[bn].y);return Di>=0})(Ve)||(Ve=Ve.reverse());const ft={geometry:[],joinNormals:[],indices:[]},Pt=[],Dt=[],Ut=[];let ei=Ve.length;if(ei<(Mt?3:2))return ft;for(;ei>=2&&Ve[ei-1].equals(Ve[ei-2]);)ei--;let ri,Yt,yi,Fi,pi,Tn=0;for(;Tn<ei-1&&Ve[Tn].equals(Ve[Tn+1]);)Tn++;Mt&&(ri=Ve[ei-2],pi=Ve[Tn].sub(ri)._unit()._perp());for(let $i=Tn;$i<ei;$i++){if(yi=$i===ei-1?Mt?Ve[Tn+1]:void 0:Ve[$i+1],yi&&Ve[$i].equals(yi))continue;pi&&(Fi=pi),ri&&(Yt=ri),ri=Ve[$i],pi=yi?yi.sub(ri)._unit()._perp():Fi,Fi=Fi||pi;let Di=Fi.add(pi);Di.x===0&&Di.y===0||Di._unit();const Kn=Di.x*pi.x+Di.y*pi.y,bn=Kn!==0?1/Kn:1/0,Cn=Fi.x*pi.y-Fi.y*pi.x>0;let fr="miter";const Sr=2;fr==="miter"&&bn>Sr&&(fr="bevel"),fr==="bevel"&&(bn>100&&(fr="flipbevel"),bn<Sr&&(fr="miter"));const Cr=(xr,Vr,Br,Bs)=>{const Rs=new Ye(xr.x,xr.y),lr=new Ye(xr.x,xr.y);Rs.x+=Vr.x*Bs,Rs.y+=Vr.y*Bs,lr.x-=Vr.x*Math.max(Br,1),lr.y-=Vr.y*Math.max(Br,1),Ut.push(Vr),Pt.push(Rs),Dt.push(lr)};if(fr==="miter")Di._mult(bn),Cr(ri,Di,0,0);else if(fr==="flipbevel")Di=pi.mult(-1),Cr(ri,Di,0,0),Cr(ri,Di.mult(-1),0,0);else{const xr=-Math.sqrt(bn*bn-1),Vr=Cn?xr:0,Br=Cn?0:xr;Yt&&Cr(ri,Fi,Vr,Br),yi&&Cr(ri,pi,Vr,Br)}}ft.geometry=[...Pt,...Dt.reverse(),Pt[0]],ft.joinNormals=[...Ut,...Ut.reverse(),Ut[Ut.length-1]];const ln=ft.geometry.length-1;for(let $i=0;$i<ln/2;$i++)if($i+1<ln/2){let Di=$i,Kn=$i+1,bn=ln-1-$i,Cn=ln-2-$i;Di=Di===0?ln-1:Di-1,Kn=Kn===0?ln-1:Kn-1,bn=bn===0?ln-1:bn-1,Cn=Cn===0?ln-1:Cn-1,ft.indices.push(bn),ft.indices.push(Kn),ft.indices.push(Di),ft.indices.push(bn),ft.indices.push(Cn),ft.indices.push(Kn)}return ft}(r[0]),r=[te.geometry]}const ie=(Ve,Mt)=>Ve<(Mt.length-1)/2||Ve===Mt.length-1,K=this.wallMode?[r]:nm(r,500);for(let Ve=K.length-1;Ve>=0;Ve--){const Mt=K[Ve];(Mt.length===0||(ce=Mt[0]).every(Ne=>Ne.x<=0)||ce.every(Ne=>Ne.x>=un)||ce.every(Ne=>Ne.y<=0)||ce.every(Ne=>Ne.y>=un))&&K.splice(Ve,1)}var ce;let he;if(P)he=Dh(K,b,g);else{he=[];for(const Ve of K)he.push({polygon:Ve,bounds:b})}const Se=C?this.edgeRadius:0,$e=Se>0&&this.zoom<17,Be=(Ve,Mt)=>{if(Ve.length===0)return!1;const Ne=Ve[Ve.length-1];return Mt.x===Ne.x&&Mt.y===Ne.y};for(const{polygon:Ve,bounds:Mt}of he){let Ne=0,ft=0;for(const ei of Ve)C&&!ei[0].equals(ei[ei.length-1])&&ei.push(ei[0]),ft+=C?ei.length-1:ei.length;const Pt=this.segments.prepareSegment((C?5:4)*ft,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);const Dt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ut=new Hn;if(Ut.vertexOffset=this.footprintVertices.length,Ut.indexOffset=3*this.footprintIndices.length,Ut.ringIndices=[],C){const ei=[],ri=[];Ne=Pt.vertexLength;for(let yi=0;yi<Ve.length;yi++){const Fi=Ve[yi];Fi.length&&yi!==0&&ri.push(ei.length/2);const pi=[];let Tn,ln;Tn=Fi[1].sub(Fi[0])._perp()._unit(),Ut.ringIndices.push(Fi.length-1);for(let $i=1;$i<Fi.length;$i++){const Di=Fi[$i],Kn=Fi[$i===Fi.length-1?1:$i+1],bn=Di.clone();if(Se){ln=Kn.sub(Di)._perp()._unit();const Cn=Tn.add(ln)._unit(),fr=Se*Math.min(4,1/(Tn.x*Cn.x+Tn.y*Cn.y));bn.x+=fr*Cn.x,bn.y+=fr*Cn.y,bn.x=Math.round(bn.x),bn.y=Math.round(bn.y),Tn=ln}if(!q||Se!==0&&!$e||Be(pi,bn)||pi.push(bn),Qi(this.layoutVertexArray,bn.x,bn.y,0,0,1,1,0),this.wallMode){const Cn=ie($i,Fi);ji(this.wallVertexArray,te.joinNormals[$i],!Cn)}Pt.vertexLength++,this.footprintVertices.emplaceBack(Di.x,Di.y),ei.push(Di.x,Di.y),P&&Nn(this.layoutVertexExtArray,L.projectTilePoint(bn.x,bn.y,g),L.upVector(g,bn.x,bn.y))}q&&(Se===0||$e)&&(pi.length!==0&&Be(pi,pi[0])&&pi.pop(),this.groundEffect.addData(pi,Mt,z))}const Yt=this.wallMode?te.indices:em(ei,ri);for(let yi=0;yi<Yt.length;yi+=3)this.footprintIndices.emplaceBack(Ut.vertexOffset+Yt[yi+0],Ut.vertexOffset+Yt[yi+1],Ut.vertexOffset+Yt[yi+2]),this.indexArray.emplaceBack(Ne+Yt[yi],Ne+Yt[yi+2],Ne+Yt[yi+1]),Pt.primitiveLength++;Ut.indexCount+=Yt.length,Ut.vertexCount+=this.footprintVertices.length-Ut.vertexOffset}for(let ei=0;ei<Ve.length;ei++){const ri=Ve[ei];R.startRing(F,ri[0]);let Yt=ri.length>4&&no(ri[ri.length-2],ri[0],ri[1]),yi=Se?mr(ri[ri.length-2],ri[0],ri[1],Se):0;const Fi=[];let pi,Tn,ln;Tn=ri[1].sub(ri[0])._perp()._unit();let $i=!0;for(let Di=1,Kn=0;Di<ri.length;Di++){let bn=ri[Di-1],Cn=ri[Di];const fr=ri[Di===ri.length-1?1:Di+1];if(R.appendEdge(F,Cn,bn),Kr(Cn,bn,Mt)){Se&&(Tn=fr.sub(Cn)._perp()._unit(),$i=!$i);continue}const Sr=Cn.sub(bn)._perp(),Cr=Sr.x/(Math.abs(Sr.x)+Math.abs(Sr.y)),xr=Sr.y>0?1:0,Vr=bn.dist(Cn);if(Kn+Vr>32768&&(Kn=0),Se){ln=fr.sub(Cn)._perp()._unit();let lr=ns(bn,Cn,fr,Ar(Tn,ln),Se);isNaN(lr)&&(lr=0);const fs=Cn.sub(bn)._unit();bn=bn.add(fs.mult(yi))._round(),Cn=Cn.add(fs.mult(-lr))._round(),yi=lr,Tn=ln,q&&this.zoom>=17&&(Be(Fi,bn)||Fi.push(bn),Be(Fi,Cn)||Fi.push(Cn))}const Br=Pt.vertexLength,Bs=ri.length>4&&no(bn,Cn,fr);let Rs=oa(Kn,Yt,$i);if(Qi(this.layoutVertexArray,bn.x,bn.y,Cr,xr,0,0,Rs),Qi(this.layoutVertexArray,bn.x,bn.y,Cr,xr,0,1,Rs),this.wallMode){const lr=ie(Di-1,ri),fs=te.joinNormals[Di-1];ji(this.wallVertexArray,fs,lr),ji(this.wallVertexArray,fs,lr)}if(Kn+=Vr,Rs=oa(Kn,Bs,!$i),Yt=Bs,Qi(this.layoutVertexArray,Cn.x,Cn.y,Cr,xr,0,0,Rs),Qi(this.layoutVertexArray,Cn.x,Cn.y,Cr,xr,0,1,Rs),this.wallMode){const lr=ie(Di,ri),fs=te.joinNormals[Di];ji(this.wallVertexArray,fs,lr),ji(this.wallVertexArray,fs,lr)}if(Pt.vertexLength+=4,this.indexArray.emplaceBack(Br+0,Br+1,Br+2),this.indexArray.emplaceBack(Br+1,Br+3,Br+2),Pt.primitiveLength+=2,Se){const lr=Ne+(Di===1?ri.length-2:Di-2),fs=Di===1?Ne:lr+1;if(this.indexArray.emplaceBack(Br+1,lr,Br+3),this.indexArray.emplaceBack(lr,fs,Br+3),Pt.primitiveLength+=2,pi===void 0&&(pi=Br),!Kr(fr,ri[Di],Mt)){const xs=Di===ri.length-1?pi:Pt.vertexLength;this.indexArray.emplaceBack(Br+2,Br+3,xs),this.indexArray.emplaceBack(Br+3,xs+1,xs),this.indexArray.emplaceBack(Br+3,fs,xs+1),Pt.primitiveLength+=3}$i=!$i}if(P){const lr=this.layoutVertexExtArray,fs=L.projectTilePoint(bn.x,bn.y,g),xs=L.projectTilePoint(Cn.x,Cn.y,g),Qs=L.upVector(g,bn.x,bn.y),bo=L.upVector(g,Cn.x,Cn.y);Nn(lr,fs,Qs),Nn(lr,fs,Qs),Nn(lr,xs,bo),Nn(lr,xs,bo)}}C&&(Ne+=ri.length-1),q&&Se&&this.zoom>=17&&(Fi.length!==0&&Be(Fi,Fi[0])&&Fi.pop(),this.groundEffect.addData(Fi,Mt,z,Se>0))}this.footprintSegments.push(Ut),Dt.triangleCount=this.indexArray.length-Dt.triangleArrayOffset,this.polygonSegments.push(Dt),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=R.borders?$t:this.encodeCentroid(R,F),this.centroidData.push(F),R.borders){this.featuresOnBorder.push(R);const Ve=this.featuresOnBorder.length-1;for(let Mt=0;Mt<R.borders.length;Mt++)R.borders[Mt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Mt].push(Ve)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,d,_,g,I),this.groundEffect.addPaintPropertiesData(t,h,d,_,g,I),this.maxHeight=Math.max(this.maxHeight,Z)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((r,h)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[h].borders[t][0])}splitToSubtiles(){const t=[];for(let T=0;T<this.centroidData.length;T++){const I=this.centroidData[T],z=+(I.min.y+I.max.y>un),b=2*z+(+(I.min.x+I.max.x>un)^z);for(let L=0;L<I.polygonSegLen;L++){const P=I.polygonSegIdx+L;t.push({centroidIdx:T,subtile:b,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const r=new qs;t.sort((T,I)=>T.triangleSegmentIdx===I.triangleSegmentIdx?T.subtile-I.subtile:T.triangleSegmentIdx-I.triangleSegmentIdx);let h=0,g=0,d=0;for(const T of t){if(T.triangleSegmentIdx!==h)break;d++}const _=t.length;for(;g!==t.length;){h=t[g].triangleSegmentIdx;let T=0,I=g,z=g;for(let b=I;b<d&&t[b].subtile===T;b++)z++;for(;I!==d;){const b=t[I];T=b.subtile;const L=this.centroidData[b.centroidIdx].min.clone(),P=this.centroidData[b.centroidIdx].max.clone(),C={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=I;R<z;R++){const F=t[R],q=this.polygonSegments[F.polygonSegmentIdx],Z=this.centroidData[F.centroidIdx].min,te=this.centroidData[F.centroidIdx].max,ie=this.indexArray.uint16;for(let K=q.triangleArrayOffset;K<q.triangleArrayOffset+q.triangleCount;K++)r.emplaceBack(ie[3*K],ie[3*K+1],ie[3*K+2]);C.primitiveLength+=q.triangleCount,L.x=Math.min(L.x,Z.x),L.y=Math.min(L.y,Z.y),P.x=Math.max(P.x,te.x),P.y=Math.max(P.y,te.y)}C.primitiveLength>0&&this.triangleSubSegments.push({segment:C,min:L,max:P}),I=z;for(let R=I;R<d&&t[R].subtile===t[I].subtile;R++)z++}g=d;for(let b=g;b<_&&t[b].triangleSegmentIdx===t[g].triangleSegmentIdx;b++)d++}r._trim(),this.indexArray=r}getVisibleSegments(t,r,h){const g=new Js;if(this.wallMode){for(const F of this.triangleSubSegments)g.segments.push(F.segment);return g}let d=0,_=0;const T=1<<t.canonical.z;if(r){const F=r.getMinMaxForTile(t);F&&(d=F.min,_=F.max)}_+=this.maxHeight;const I=t.toUnwrapped();let z;const b=[I.canonical.x/T+I.wrap,I.canonical.y/T],L=[(I.canonical.x+1)/T+I.wrap,(I.canonical.y+1)/T],P=(F,q,Z)=>[F[0]*(1-Z[0])+q[0]*Z[0],F[1]*(1-Z[1])+q[1]*Z[1]],C=[],R=[];for(const F of this.triangleSubSegments){C[0]=F.min.x/un,C[1]=F.min.y/un,R[0]=F.max.x/un,R[1]=F.max.y/un;const q=P(b,L,C),Z=P(b,L,R);if(new ls([q[0],q[1],d],[Z[0],Z[1],_]).intersectsPrecise(h)===0){z&&(g.segments.push(z),z=void 0);continue}const te=F.segment;z&&z.vertexOffset!==te.vertexOffset&&(g.segments.push(z),z=void 0),z?(z.vertexLength+=te.vertexLength,z.primitiveLength+=te.primitiveLength):z={vertexOffset:te.vertexOffset,primitiveLength:te.primitiveLength,vertexLength:te.vertexLength,primitiveOffset:te.primitiveOffset,sortKey:void 0,vaos:{}}}return z&&g.segments.push(z),g}encodeCentroid(t,r){const h=t.centroid(),g=r.span(),d=Math.min(7,Math.round(g.x*this.tileToMeter/10)),_=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new Ye(It(h.x,1,un-1)<<3|d,It(h.y,1,un-1)<<3|_)}encodeBorderCentroid(t){if(!t.borders)return new Ye(0,0);const r=t.borders,h=Number.MAX_VALUE;if(r[0][0]!==h||r[1][0]!==h){const g=r[0][0]!==h?0:1;return new Ye(6|(r[0][0]!==h?0:65528),(r[g][0]+r[g][1])/2<<3|6)}{const g=r[2][0]!==h?2:3;return new Ye((r[g][0]+r[g][1])/2<<3|6,6|(r[2][0]!==h?0:65528))}}showCentroid(t){const r=this.centroidData[t.centroidDataIndex];r.flags&=ii,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const r=t.vertexArrayOffset,h=t.vertexCount+t.vertexArrayOffset,g=t.flags&ii?$t:t.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==g.y||d!==g.x){for(let _=r;_<h;++_)this.centroidVertexArray.emplace(_,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,r,h){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const g=r.getReplacementRegionsForTile(t.toUnwrapped());if(vi(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const d=[];for(const _ of this.activeReplacements){if(_.order<h)continue;const T=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-t.canonical.z));for(const I of this.centroidData)if(!(I.flags&ii||_.min.x>I.max.x||I.min.x>_.max.x||_.min.y>I.max.y||I.min.y>_.max.y))for(let z=0;z<I.footprintSegLen;z++){const b=this.footprintSegments[I.footprintSegIdx+z];if(d.length=0,Cd(this.footprintVertices,b.vertexOffset,b.vertexCount,_.footprintTileId.canonical,t.canonical,d),ki(_.footprint,d,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-T)){I.flags|=ii;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,r,h){let g=!1;for(let d=0;d<h.footprintSegLen;d++){const _=this.footprintSegments[h.footprintSegIdx+d];let T=0;for(const I of _.ringIndices){for(let z=T,b=I+T-1;z<I+T;b=z++){const L=this.footprintVertices.int16[2*(z+_.vertexOffset)+0],P=this.footprintVertices.int16[2*(z+_.vertexOffset)+1],C=this.footprintVertices.int16[2*(b+_.vertexOffset)+1];P>r!=C>r&&t<(this.footprintVertices.int16[2*(b+_.vertexOffset)+0]-L)*(r-P)/(C-P)+L&&(g=!g)}T=I}}return g}getHeightAtTileCoord(t,r){let h=Number.NEGATIVE_INFINITY,g=!0;const d=4*(t+un)*un+(r+un);if(this.partLookup.hasOwnProperty(d)){const _=this.partLookup[d];return _?{height:_.height,hidden:!!(_.flags&ii)}:void 0}for(const _ of this.centroidData)t>_.max.x||_.min.x>t||r>_.max.y||_.min.y>r||this.footprintContainsPoint(t,r,_)&&_&&_.height>h&&(h=_.height,this.partLookup[d]=_,g=!!(_.flags&ii));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:g};this.partLookup[d]=void 0}}function Ar(a,t){const r=a.add(t)._unit();return a.x*r.x+a.y*r.y}function mr(a,t,r,h){const g=t.sub(a)._perp()._unit(),d=r.sub(t)._perp()._unit();return ns(a,t,r,Ar(g,d),h)}function ns(a,t,r,h,g){const d=Math.sqrt(1-h*h);return Math.min(a.dist(t)/3,t.dist(r)/3,g*d/h)}function Kr(a,t,r){return a.x<r[0].x&&t.x<r[0].x||a.x>r[1].x&&t.x>r[1].x||a.y<r[0].y&&t.y<r[0].y||a.y>r[1].y&&t.y>r[1].y}function sa(a,t){return a.x<t[0].x||a.x>t[1].x||a.y<t[0].y||a.y>t[1].y}function no(a,t,r){if(a.x<0||a.x>=un||t.x<0||t.x>=un||r.x<0||r.x>=un)return!1;const h=r.sub(t),g=h.perp(),d=a.sub(t);return(h.x*d.x+h.y*d.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(d.x*d.x+d.y*d.y))>-.866&&g.x*d.x+g.y*d.y<0}function oa(a,t,r){const h=t?2|a:-3&a;return r?1|h:-2&h}function ul(){const a=Math.PI/32,t=Math.tan(a),r=U;return r*Math.sqrt(1+2*t*t)-r}function Dh(a,t,r){const h=1<<r.z,g=Oe(r.x/h),d=Oe((r.x+1)/h),_=Ge(r.y/h),T=Ge((r.y+1)/h);return function(I,z,b,L,P=0,C){const R=[];if(!I.length||!b||!L)return R;const F=(he,Se)=>{for(const $e of he)R.push({polygon:$e,bounds:Se})},q=Math.ceil(Math.log2(b)),Z=Math.ceil(Math.log2(L)),te=q-Z,ie=[];for(let he=0;he<Math.abs(te);he++)ie.push(te>0?0:1);for(let he=0;he<Math.min(q,Z);he++)ie.push(0),ie.push(1);let K=I;if(K=Re(K,z[0].y-P,z[1].y+P,1),K=Re(K,z[0].x-P,z[1].x+P,0),!K.length)return R;const ce=[];for(ie.length?ce.push({polygons:K,bounds:z,depth:0}):F(K,z);ce.length;){const he=ce.pop(),Se=he.depth,$e=ie[Se],Be=he.bounds[0],Ve=he.bounds[1],Mt=$e===0?Be.x:Be.y,Ne=$e===0?Ve.x:Ve.y,ft=C?C($e,Mt,Ne):.5*(Mt+Ne),Pt=Re(he.polygons,Mt-P,ft+P,$e),Dt=Re(he.polygons,ft-P,Ne+P,$e);if(Pt.length){const Ut=[Be,new Ye($e===0?ft:Ve.x,$e===1?ft:Ve.y)];ie.length>Se+1?ce.push({polygons:Pt,bounds:Ut,depth:Se+1}):F(Pt,Ut)}if(Dt.length){const Ut=[new Ye($e===0?ft:Be.x,$e===1?ft:Be.y),Ve];ie.length>Se+1?ce.push({polygons:Dt,bounds:Ut,depth:Se+1}):F(Dt,Ut)}}return R}(a,t,Math.ceil((d-g)/11.25),Math.ceil((_-T)/11.25),1,(I,z,b)=>{if(I===0)return .5*(z+b);{const L=Ge((r.y+z/un)/h);return(_e(.5*(Ge((r.y+b/un)/h)+L))*h-r.y)*un}})}function Cd(a,t,r,h,g,d){const _=Math.pow(2,h.z-g.z);for(let T=0;T<r;T++){let I=a.int16[2*(T+t)+0],z=a.int16[2*(T+t)+1];I=(I+g.x*un)*_-h.x*un,z=(z+g.y*un)*_-h.y*un,d.push(new Ye(I,z))}}let Oh,Pl;function da(a,t){return a.x*t.x+a.y*t.y}function Bn(a,t){if(a.length===1){let r=0;const h=t[r++];let g;for(;!g||h.equals(g);)if(g=t[r++],!g)return 1/0;for(;r<t.length;r++){const d=t[r],_=a[0],T=g.sub(h),I=d.sub(h),z=_.sub(h),b=da(T,T),L=da(T,I),P=da(I,I),C=da(z,T),R=da(z,I),F=b*P-L*L,q=(P*C-L*R)/F,Z=(b*R-L*C)/F,te=h.z*(1-q-Z)+g.z*q+d.z*Z;if(isFinite(te))return te}return 1/0}{let r=1/0;for(const h of t)r=Math.min(r,h.z);return r}}function j_(a,t,r,h,g,d,_,T){const I=_*g.getElevationAt(a,t,!0,!0),z=d[0]!==0,b=z?d[1]===0?_*(d[0]/7-450):_*function(L,P,C){const R=Math.floor(P[0]/8),F=Math.floor(P[1]/8),q=10*(P[0]-8*R),Z=10*(P[1]-8*F),te=L.getElevationAt(R,F,!0,!0),ie=L.getMeterToDEM(C),K=Math.floor(.5*(q*ie-1)),ce=Math.floor(.5*(Z*ie-1)),he=L.tileCoordToPixel(R,F),Se=2*K+1,$e=2*ce+1,Be=function(Dt,Ut,ei,ri,Yt){return[Dt.getElevationAtPixel(Ut,ei,!0),Dt.getElevationAtPixel(Ut+Yt,ei,!0),Dt.getElevationAtPixel(Ut,ei+Yt,!0),Dt.getElevationAtPixel(Ut+ri,ei+Yt,!0)]}(L,he.x-K,he.y-ce,Se,$e),Ve=Math.abs(Be[0]-Be[1]),Mt=Math.abs(Be[2]-Be[3]),Ne=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),ft=Math.min(.25,.5*ie*(Ve+Mt)/Se),Pt=Math.min(.25,.5*ie*Ne/$e);return te+Math.max(ft*q,Pt*Z)}(g,d,T):I;return{base:I+(r===0?-1:r),top:z?Math.max(b+h,I+r+2):I+h}}Sn(or,"FillExtrusionBucket",{omit:["layers","features"]}),Sn(Ni,"PartData"),Sn(Hn,"FootprintSegment"),Sn(Bt,"BorderCentroidData"),Sn(pn,"GroundEffect");const Cy=Qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Dl=Qr([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:Ly}=Cy,Iy=Qr([{name:"a_packed",components:4,type:"Float32"}]),{members:Ry}=Iy,W_=Qr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Py}=W_;class q_{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new nu({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const h=this.getKey(t,r);return this.positions[h]}trim(){const t=this.width,r=this.height=Mn(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,h){const g=[];let d=t.length%2==1?-t[t.length-1]*h:0,_=t[0]*h,T=!0;g.push({left:d,right:_,isDash:T,zeroLength:t[0]===0});let I=t[0];for(let z=1;z<t.length;z++){T=!T;const b=t[z];d=I*h,I+=b,_=I*h,g.push({left:d,right:_,isDash:T,zeroLength:b===0})}return g}addRoundDash(t,r,h){const g=r/2;for(let d=-h;d<=h;d++){const _=this.width*(this.nextRow+h+d);let T=0,I=t[T];for(let z=0;z<this.width;z++){z/I.right>1&&(I=t[++T]);const b=Math.abs(z-I.left),L=Math.abs(z-I.right),P=Math.min(b,L);let C;const R=d/h*(g+1);if(I.isDash){const F=g-Math.abs(R);C=Math.sqrt(P*P+F*F)}else C=g-Math.sqrt(P*P+R*R);this.image.data[_+z]=Math.max(0,Math.min(255,C+128))}}}addRegularDash(t,r){for(let I=t.length-1;I>=0;--I){const z=t[I],b=t[I+1];z.zeroLength?t.splice(I,1):b&&b.isDash===z.isDash&&(b.left=z.left,t.splice(I,1))}const h=t[0],g=t[t.length-1];h.isDash===g.isDash&&(h.left=g.left-this.width,g.right=h.right+this.width);const d=this.width*this.nextRow;let _=0,T=t[_];for(let I=0;I<this.width;I++){I/T.right>1&&(T=t[++_]);const z=Math.abs(I-T.left),b=Math.abs(I-T.right),L=Math.min(z,b);this.image.data[d+I]=Math.max(0,Math.min(255,(T.isDash?L:-L)+r+128))}}addDash(t,r){const h=this.getKey(t,r);if(this.positions[h])return this.positions[h];const g=r==="round",d=g?7:0,_=2*d+1;if(this.nextRow+_>this.height)return Wn("LineAtlas out of space"),null;t.length===0&&t.push(1);let T=0;for(let b=0;b<t.length;b++)t[b]<0&&(Wn("Negative value is found in line dasharray, replacing values with 0"),t[b]=0),T+=t[b];if(T!==0){const b=this.width/T,L=this.getDashRanges(t,this.width,b);g?this.addRoundDash(L,b,d):this.addRegularDash(L,r==="square"?.5*b:0)}const I=this.nextRow+d;this.nextRow+=_;const z={tl:[I,d],br:[T,0]};return this.positions[h]=z,z}}Sn(q_,"LineAtlas");const Ld=ae.VectorTileFeature.types,Dy=Math.cos(Math.PI/180*37.5),Oy=Math.cos(Math.PI/180*5);class zp{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new $c,this.layoutVertexArray2=new Ta,this.patternVertexArray=new uc,this.indexArray=new qs,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Js,this.maxLineLength=0,this.zOffsetVertexArray=new za,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:un/64}updateFootprints(t,r){}populate(t,r,h,g){this.hasPattern=dg("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();const _=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&_==="none"&&Wn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&T!==void 0;const I=[];for(const{feature:P,id:C,index:R,sourceLayerIndex:F}of t){const q=this.layers[0]._featureFilter.needGeometry,Z=wi(P,q);if(!this.layers[0]._featureFilter.filter(new eo(this.zoom),Z,h))continue;const te=d?d.evaluate(Z,{},h):void 0,ie={id:C,properties:P.properties,type:P.type,sourceLayerIndex:F,index:R,geometry:q?Z.geometry:qt(P,h,g),patterns:{},sortKey:te};I.push(ie)}d&&I.sort((P,C)=>P.sortKey-C.sortKey);const{lineAtlas:z,featureIndex:b}=r,L=this.addConstantDashes(z);for(const P of I){const{geometry:C,index:R,sourceLayerIndex:F}=P;if(L&&this.addFeatureDashes(P,z),this.hasPattern){const q=Op("line",this.layers,P,this.zoom,r);this.patternFeatures.push(q)}else this.addFeature(P,C,R,h,z.positions,r.availableImages,r.brightness);b.insert(t[R].feature,C,R,F,this.index)}}addConstantDashes(t){let r=!1;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,d=h.layout.get("line-cap").value;if(g.kind!=="constant"||d.kind!=="constant")r=!0;else{const _=d.value,T=g.value;if(!T)continue;t.addDash(T,_)}}return r}addFeatureDashes(t,r){const h=this.zoom;for(const g of this.layers){const d=g.paint.get("line-dasharray").value,_=g.layout.get("line-cap").value;if(d.kind==="constant"&&_.kind==="constant")continue;let T,I;if(d.kind==="constant"){if(T=d.value,!T)continue}else T=d.evaluate({zoom:h},t);I=_.kind==="constant"?_.value:_.evaluate({zoom:h},t),r.addDash(T,I),t.patterns[g.id]=r.getKey(T,I)}}update(t,r,h,g,d){const _=Object.keys(t).length!==0;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,_?this.stateDependentLayers:this.layers,h,g,d)}addFeatures(t,r,h,g,d,_){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,r,h,g,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ry)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,Py)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Dl.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ly),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,h,g,d,_,T){const I=this.layers[0].layout,z=I.get("line-join").evaluate(t,{}),b=I.get("line-cap").evaluate(t,{}),L=I.get("line-miter-limit"),P=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=I.get("line-z-offset").value;for(const C of r)this.addLine(C,t,g,z,b,L,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,d,_,g,T)}addLine(t,r,h,g,d,_,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const I=g==="none";if(this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<t.length-1;ie++)this.totalDistance+=t[ie].dist(t[ie+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=Ld[r.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let L=0;for(;L<b-1&&t[L].equals(t[L+1]);)L++;if(b<(z?3:2))return;g==="bevel"&&(_=1.05);const P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let C,R,F,q,Z,te;this.e1=this.e2=-1,z&&(C=t[b-2],Z=t[L].sub(C)._unit()._perp());for(let ie=L;ie<b;ie++){if(F=ie===b-1?z?t[L+1]:void 0:t[ie+1],F&&t[ie].equals(F))continue;Z&&(q=Z),C&&(R=C),C=t[ie],te=this.hasZOffset?this.evaluateElevationValue(R?R.dist(C):0):null,Z=F?F.sub(C)._unit()._perp():q,q=q||Z;const K=R&&F;let ce=K?g:z||I?"butt":d;const he=q.x*Z.x+q.y*Z.y;if(I){const Pt=function(Dt){if(Dt.patternJoinNone){const Ut=Dt.segmentPoints.length/2,ei=Dt.lineSoFar-Dt.segmentStart;for(let ri=0;ri<Ut;++ri){const Yt=Dt.segmentPoints[2*ri+1],yi=Math.round(Dt.segmentPoints[2*ri])+.5+.25*Yt;Dt.patternVertexArray.emplaceBack(yi,ei,Dt.segmentStart),Dt.patternVertexArray.emplaceBack(yi,ei,Dt.segmentStart)}Dt.segmentPoints.length=0}Dt.e1=Dt.e2=-1};if(K&&he<Oy){this.updateDistance(R,C),this.addCurrentVertex(C,q,1,1,P,te),Pt(this),this.addCurrentVertex(C,Z,-1,-1,P,te);continue}if(R){if(!F){this.updateDistance(R,C),this.addCurrentVertex(C,q,1,1,P,te),Pt(this);continue}ce="miter"}}let Se=q.add(Z);Se.x===0&&Se.y===0||Se._unit();const $e=Se.x*Z.x+Se.y*Z.y,Be=$e!==0?1/$e:1/0,Ve=2*Math.sqrt(2-2*$e),Mt=$e<Dy&&R&&F,Ne=q.x*Z.y-q.y*Z.x>0,ft=this.overscaling<=16?15*un/(512*this.overscaling):0;if(K&&ce==="round"){if(Be<T)ce="miter";else if(Be<=2){const Pt=$_(C,-10,un+10);ce=this.hasZOffset&&(Pt||this.hasCrossSlope)?"miter":"fakeround"}}if(ce==="miter"&&Be>_&&(ce="bevel"),ce==="bevel"&&(Be>2&&(ce="flipbevel"),Be<_&&(ce="miter")),R&&!(ce==="miter"&&Mt)&&this.updateDistance(R,C),ce==="miter")if(Mt){const Pt=C.dist(R);if(Pt>2*ft){const Ut=C.sub(C.sub(R)._mult(ft/Pt)._round());this.updateDistance(R,Ut),this.addCurrentVertex(Ut,q,0,0,P,te),R=Ut}this.updateDistance(R,C),Se._mult(Be),this.addCurrentVertex(C,Se,0,0,P,te);const Dt=C.dist(F);if(Dt>2*ft){const Ut=C.add(F.sub(C)._mult(ft/Dt)._round());this.updateDistance(C,Ut),this.addCurrentVertex(Ut,Z,0,0,P,te),C=Ut}}else Se._mult(Be),this.addCurrentVertex(C,Se,0,0,P,te);else if(ce==="flipbevel"){if(Be>100)Se=Z.mult(-1);else{const Pt=Be*q.add(Z).mag()/q.sub(Z).mag();Se._perp()._mult(Pt*(Ne?-1:1))}this.addCurrentVertex(C,Se,0,0,P,te),this.addCurrentVertex(C,Se.mult(-1),0,0,P,te)}else if(ce==="bevel"||ce==="fakeround"){te!=null&&R&&this.addCurrentVertex(C,q,-1,-1,P,te);const Pt=C.dist(R)<=2*ft&&ce!=="bevel",Dt=Se.mult(Ne?1:-1);Dt._mult(Be);const Ut=Z.mult(Ne?-1:1),ei=q.mult(Ne?-1:1),ri=this.evaluateElevationValue(this.distance);if(te==null&&(this.addHalfVertex(C,Dt.x,Dt.y,!1,!Ne,0,P,ri),Pt||this.addHalfVertex(C,Dt.x+2*ei.x,Dt.y+2*ei.y,!1,Ne,0,P,ri)),ce==="fakeround"){const Yt=Math.round(180*Ve/Math.PI/20);this.addHalfVertex(C,ei.x,ei.y,!1,Ne,0,P,ri);for(let yi=0;yi<Yt;yi++){let Fi=yi/Yt;if(Fi!==.5){const Tn=Fi-.5;Fi+=Fi*Tn*(Fi-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*Tn*Tn+(.848013+he*(.215638*he-1.06021)))}const pi=Ut.sub(ei)._mult(Fi)._add(ei)._unit();this.addHalfVertex(C,pi.x,pi.y,!1,Ne,0,P,ri)}this.addHalfVertex(C,Ut.x,Ut.y,!1,Ne,0,P,ri)}Pt||te!=null||this.addHalfVertex(C,Dt.x+2*Ut.x,Dt.y+2*Ut.y,!1,Ne,0,P,ri),te!=null&&F&&this.addCurrentVertex(C,Z,1,1,P,te)}else ce==="butt"?this.addCurrentVertex(C,Se,0,0,P,te):ce==="square"?(R||this.addCurrentVertex(C,Se,-1,-1,P,te),this.addCurrentVertex(C,Se,0,0,P,te),R&&this.addCurrentVertex(C,Se,1,1,P,te)):ce==="round"&&(R&&(this.addCurrentVertex(C,q,0,0,P,te),this.addCurrentVertex(C,q,1,1,P,te,!0)),F&&(this.addCurrentVertex(C,Z,-1,-1,P,te,!0),this.addCurrentVertex(C,Z,0,0,P,te)))}}addVerticesTo(t,r,h,g,d,_,T,I,z,b){const L=(r.w-t.w)/this.tessellationStep|0;let P=0;const C=this.scaledDistance;if(L>1){this.lineSoFar=t.w;const F=(r.x-t.x)/L,q=(r.y-t.y)/L,Z=(r.z-t.z)/L,te=(r.w-t.w)/L;for(let ie=1;ie<L;++ie){t.x+=F,t.y+=q,t.z+=Z,this.lineSoFar+=te,P+=te;const K=this.evaluateElevationValue(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(t,h,g,b,!1,T,z,K),this.addHalfVertex(t,d,_,b,!0,-I,z,K)}}this.lineSoFar=r.w,this.scaledDistance=C;const R=this.evaluateElevationValue(this.distance);this.addHalfVertex(r,h,g,b,!1,T,z,R),this.addHalfVertex(r,d,_,b,!0,-I,z,R)}evaluateElevationValue(t){return this.hasZOffset?this.zOffsetValue.kind==="constant"?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):Wn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(t,r,h,g,d,_,T=!1){const I=r.x+r.y*h,z=r.y-r.x*h,b=r.y*g-r.x,L=-r.y-r.x*g;if(_!=null){const C=un+10,R=_,F=new be(t.x,t.y,R,this.lineSoFar),q=$_(t,-10,C),Z=this.lineSoFar,te=this.distance;if(this.currentVertex)if(q){const ie=this.currentVertexIsOutside,K=this.currentVertex,ce=new be(t.x,t.y,R,this.lineSoFar);if(ct(K,ce,-10,C),!$_(ce,-10,C)){if(ie){this.e1=this.e2=-1,this.distance-=K.dist(F),this.lineSoFar=K.w;const he=this.evaluateElevationValue(K.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(K,I,z,T,!1,h,d,he),this.addHalfVertex(K,b,L,T,!0,-g,d,he),this.prevDistance=this.distance}this.distance=this.prevDistance+K.dist(ce),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(K,ce,I,z,b,L,h,g,d,T),this.distance=te,this.scaledDistance=this.distance/this.totalDistance}}else{const ie=this.currentVertex;if(this.currentVertexIsOutside){ct(ie,F,-10,C),this.e1=this.e2=-1,this.distance-=ie.dist(F),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ie.w;const K=this.evaluateElevationValue(ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ie,I,z,T,!1,h,d,K),this.addHalfVertex(ie,b,L,T,!0,-g,d,K),this.prevDistance=this.distance,this.distance=te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ie,F,I,z,b,L,h,g,d,T)}else q||(this.addHalfVertex(t,I,z,T,!1,h,d,_),this.addHalfVertex(t,b,L,T,!0,-g,d,_));this.currentVertex=F,this.currentVertexIsOutside=q,this.lineSoFar=Z}else this.addHalfVertex(t,I,z,T,!1,h,d,_),this.addHalfVertex(t,b,L,T,!0,-g,d,_)}addHalfVertex({x:t,y:r},h,g,d,_,T,I,z){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(r<<1)+(_?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),I.primitiveLength++),_?this.e2=b:this.e1=b,z!=null&&this.zOffsetVertexArray.emplaceBack(z)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,r){this.prevDistance=this.distance,this.distance+=t.dist(r),this.updateScaledDistance()}}function $_(a,t,r){return a.x<t||a.x>r||a.y<t||a.y>r}let mg,Z_;function X_(a,t,r){return t*(un/(a.tileSize*Math.pow(2,r-a.tileID.overscaledZ)))}Sn(zp,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Wt=(a,t,r)=>(1-r)*a+r*t;function rn(a,t){return 1/X_(a,1,t.tileZoom)}function Ri(a,t,r,h){return a.translatePosMatrix(h||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const sn=a=>{const t=[];On(a)&&t.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=a.paint.get("line-trim-offset");r[0]===0&&r[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const h=a.layout.get("line-join").constantOr("miter")==="none",g=!!a.paint.get("line-pattern").constantOr(1);return h&&g&&t.push("LINE_JOIN_NONE"),t};function On(a){const t=a.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let qr;const Mr=()=>qr||(qr={layout:mg||(mg=new Ts({"line-cap":new yn(Qt.layout_line["line-cap"]),"line-join":new yn(Qt.layout_line["line-join"]),"line-miter-limit":new qi(Qt.layout_line["line-miter-limit"]),"line-round-limit":new qi(Qt.layout_line["line-round-limit"]),"line-sort-key":new yn(Qt.layout_line["line-sort-key"]),"line-z-offset":new yn(Qt.layout_line["line-z-offset"]),"line-elevation-reference":new qi(Qt.layout_line["line-elevation-reference"]),"line-cross-slope":new qi(Qt.layout_line["line-cross-slope"]),visibility:new qi(Qt.layout_line.visibility)})),paint:Z_||(Z_=new Ts({"line-opacity":new yn(Qt.paint_line["line-opacity"]),"line-color":new yn(Qt.paint_line["line-color"]),"line-translate":new qi(Qt.paint_line["line-translate"]),"line-translate-anchor":new qi(Qt.paint_line["line-translate-anchor"]),"line-width":new yn(Qt.paint_line["line-width"]),"line-gap-width":new yn(Qt.paint_line["line-gap-width"]),"line-offset":new yn(Qt.paint_line["line-offset"]),"line-blur":new yn(Qt.paint_line["line-blur"]),"line-dasharray":new yn(Qt.paint_line["line-dasharray"]),"line-pattern":new yn(Qt.paint_line["line-pattern"]),"line-gradient":new Au(Qt.paint_line["line-gradient"]),"line-trim-offset":new qi(Qt.paint_line["line-trim-offset"]),"line-trim-fade-range":new qi(Qt.paint_line["line-trim-fade-range"]),"line-trim-color":new qi(Qt.paint_line["line-trim-color"]),"line-emissive-strength":new qi(Qt.paint_line["line-emissive-strength"]),"line-border-width":new yn(Qt.paint_line["line-border-width"]),"line-border-color":new yn(Qt.paint_line["line-border-color"]),"line-occlusion-opacity":new qi(Qt.paint_line["line-occlusion-opacity"])}))},qr);class rs extends yn{possiblyEvaluate(t,r){return r=new eo(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,h,g){return r=cn({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,h,g)}}let cs;function oo(a,t){return t>0?t+2*a:a}const $s=Qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),As=Qr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ss=Qr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Id=Qr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Bo=Qr([{name:"a_texb",components:2,type:"Uint16"}]),zh=Qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),_c=Qr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const kh=Qr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Fh=Qr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qr([{name:"triangle",components:3,type:"Uint16"}]),Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Qr([{type:"Float32",name:"offsetX"}]),Qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var zs=24;const Jo=128;function pa(a,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new eo(a+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=r;let d=0;for(;d<h.length&&h[d]<=a;)d++;d=Math.max(0,d-1);let _=d;for(;_<h.length&&h[_]<a+1;)_++;_=Math.min(h.length-1,_);const T=h[d],I=h[_];return r.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:I,minSize:r.evaluate(new eo(T)),maxSize:r.evaluate(new eo(I)),interpolationType:g}}}function hl(a,{uSize:t,uSizeT:r},{lowerSize:h,upperSize:g}){return a.kind==="source"?h/Jo:a.kind==="composite"?Pe(h/Jo,g/Jo,r):t}function Fa(a,t,r=1){let h=0,g=0;if(a.kind==="constant")g=a.layoutSize*r;else if(a.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:T}=a,I=d?It(Da.interpolationFactor(d,t,_,T),0,1):0;a.kind==="camera"?g=Pe(a.minSize,a.maxSize,I)*r:h=I*r}return{uSizeT:h,uSize:g}}var TL=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Jo,evaluateSizeForFeature:hl,evaluateSizeForZoom:Fa,getSizeData:pa});function ML(a,t,r){return a.sections.forEach(h=>{h.text=function(g,d,_){const T=d.layout.get("text-transform").evaluate(_,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),ua.applyArabicShaping&&(g=ua.applyArabicShaping(g)),g}(h.text,t,r)}),a}const Y_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function SL(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function EL(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}var xT,Ix,bT,Rx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function AL(){return xT||(xT=1,Rx.read=function(a,t,r,h,g){var d,_,T=8*g-h-1,I=(1<<T)-1,z=I>>1,b=-7,L=r?g-1:0,P=r?-1:1,C=a[t+L];for(L+=P,d=C&(1<<-b)-1,C>>=-b,b+=T;b>0;d=256*d+a[t+L],L+=P,b-=8);for(_=d&(1<<-b)-1,d>>=-b,b+=h;b>0;_=256*_+a[t+L],L+=P,b-=8);if(d===0)d=1-z;else{if(d===I)return _?NaN:1/0*(C?-1:1);_+=Math.pow(2,h),d-=z}return(C?-1:1)*_*Math.pow(2,d-h)},Rx.write=function(a,t,r,h,g,d){var _,T,I,z=8*d-g-1,b=(1<<z)-1,L=b>>1,P=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=h?0:d-1,R=h?1:-1,F=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(T=isNaN(t)?1:0,_=b):(_=Math.floor(Math.log(t)/Math.LN2),t*(I=Math.pow(2,-_))<1&&(_--,I*=2),(t+=_+L>=1?P/I:P*Math.pow(2,1-L))*I>=2&&(_++,I/=2),_+L>=b?(T=0,_=b):_+L>=1?(T=(t*I-1)*Math.pow(2,g),_+=L):(T=t*Math.pow(2,L-1)*Math.pow(2,g),_=0));g>=8;a[r+C]=255&T,C+=R,T/=256,g-=8);for(_=_<<g|T,z+=g;z>0;a[r+C]=255&_,C+=R,_/=256,z-=8);a[r+C-R]|=128*F}),Rx}function wT(){if(bT)return Ix;bT=1,Ix=t;var a=AL();function t(K){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(K)?K:new Uint8Array(K||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,h=1/r,g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d(K){return K.type===t.Bytes?K.readVarint()+K.pos:K.pos+1}function _(K,ce,he){return he?4294967296*ce+(K>>>0):4294967296*(ce>>>0)+(K>>>0)}function T(K,ce,he){var Se=ce<=16383?1:ce<=2097151?2:ce<=268435455?3:Math.floor(Math.log(ce)/(7*Math.LN2));he.realloc(Se);for(var $e=he.pos-1;$e>=K;$e--)he.buf[$e+Se]=he.buf[$e]}function I(K,ce){for(var he=0;he<K.length;he++)ce.writeVarint(K[he])}function z(K,ce){for(var he=0;he<K.length;he++)ce.writeSVarint(K[he])}function b(K,ce){for(var he=0;he<K.length;he++)ce.writeFloat(K[he])}function L(K,ce){for(var he=0;he<K.length;he++)ce.writeDouble(K[he])}function P(K,ce){for(var he=0;he<K.length;he++)ce.writeBoolean(K[he])}function C(K,ce){for(var he=0;he<K.length;he++)ce.writeFixed32(K[he])}function R(K,ce){for(var he=0;he<K.length;he++)ce.writeSFixed32(K[he])}function F(K,ce){for(var he=0;he<K.length;he++)ce.writeFixed64(K[he])}function q(K,ce){for(var he=0;he<K.length;he++)ce.writeSFixed64(K[he])}function Z(K,ce){return(K[ce]|K[ce+1]<<8|K[ce+2]<<16)+16777216*K[ce+3]}function te(K,ce,he){K[he]=ce,K[he+1]=ce>>>8,K[he+2]=ce>>>16,K[he+3]=ce>>>24}function ie(K,ce){return(K[ce]|K[ce+1]<<8|K[ce+2]<<16)+(K[ce+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(K,ce,he){for(he=he||this.length;this.pos<he;){var Se=this.readVarint(),$e=Se>>3,Be=this.pos;this.type=7&Se,K($e,ce,this),this.pos===Be&&this.skip(Se)}return ce},readMessage:function(K,ce){return this.readFields(K,ce,this.readVarint()+this.pos)},readFixed32:function(){var K=Z(this.buf,this.pos);return this.pos+=4,K},readSFixed32:function(){var K=ie(this.buf,this.pos);return this.pos+=4,K},readFixed64:function(){var K=Z(this.buf,this.pos)+Z(this.buf,this.pos+4)*r;return this.pos+=8,K},readSFixed64:function(){var K=Z(this.buf,this.pos)+ie(this.buf,this.pos+4)*r;return this.pos+=8,K},readFloat:function(){var K=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,K},readDouble:function(){var K=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,K},readVarint:function(K){var ce,he,Se=this.buf;return ce=127&(he=Se[this.pos++]),he<128?ce:(ce|=(127&(he=Se[this.pos++]))<<7,he<128?ce:(ce|=(127&(he=Se[this.pos++]))<<14,he<128?ce:(ce|=(127&(he=Se[this.pos++]))<<21,he<128?ce:function($e,Be,Ve){var Mt,Ne,ft=Ve.buf;if(Mt=(112&(Ne=ft[Ve.pos++]))>>4,Ne<128||(Mt|=(127&(Ne=ft[Ve.pos++]))<<3,Ne<128)||(Mt|=(127&(Ne=ft[Ve.pos++]))<<10,Ne<128)||(Mt|=(127&(Ne=ft[Ve.pos++]))<<17,Ne<128)||(Mt|=(127&(Ne=ft[Ve.pos++]))<<24,Ne<128)||(Mt|=(1&(Ne=ft[Ve.pos++]))<<31,Ne<128))return _($e,Mt,Be);throw new Error("Expected varint not more than 10 bytes")}(ce|=(15&(he=Se[this.pos]))<<28,K,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var K=this.readVarint();return K%2==1?(K+1)/-2:K/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var K=this.readVarint()+this.pos,ce=this.pos;return this.pos=K,K-ce>=12&&g?function(he,Se,$e){return g.decode(he.subarray(Se,$e))}(this.buf,ce,K):function(he,Se,$e){for(var Be="",Ve=Se;Ve<$e;){var Mt,Ne,ft,Pt=he[Ve],Dt=null,Ut=Pt>239?4:Pt>223?3:Pt>191?2:1;if(Ve+Ut>$e)break;Ut===1?Pt<128&&(Dt=Pt):Ut===2?(192&(Mt=he[Ve+1]))==128&&(Dt=(31&Pt)<<6|63&Mt)<=127&&(Dt=null):Ut===3?(Ne=he[Ve+2],(192&(Mt=he[Ve+1]))==128&&(192&Ne)==128&&((Dt=(15&Pt)<<12|(63&Mt)<<6|63&Ne)<=2047||Dt>=55296&&Dt<=57343)&&(Dt=null)):Ut===4&&(Ne=he[Ve+2],ft=he[Ve+3],(192&(Mt=he[Ve+1]))==128&&(192&Ne)==128&&(192&ft)==128&&((Dt=(15&Pt)<<18|(63&Mt)<<12|(63&Ne)<<6|63&ft)<=65535||Dt>=1114112)&&(Dt=null)),Dt===null?(Dt=65533,Ut=1):Dt>65535&&(Dt-=65536,Be+=String.fromCharCode(Dt>>>10&1023|55296),Dt=56320|1023&Dt),Be+=String.fromCharCode(Dt),Ve+=Ut}return Be}(this.buf,ce,K)},readBytes:function(){var K=this.readVarint()+this.pos,ce=this.buf.subarray(this.pos,K);return this.pos=K,ce},readPackedVarint:function(K,ce){if(this.type!==t.Bytes)return K.push(this.readVarint(ce));var he=d(this);for(K=K||[];this.pos<he;)K.push(this.readVarint(ce));return K},readPackedSVarint:function(K){if(this.type!==t.Bytes)return K.push(this.readSVarint());var ce=d(this);for(K=K||[];this.pos<ce;)K.push(this.readSVarint());return K},readPackedBoolean:function(K){if(this.type!==t.Bytes)return K.push(this.readBoolean());var ce=d(this);for(K=K||[];this.pos<ce;)K.push(this.readBoolean());return K},readPackedFloat:function(K){if(this.type!==t.Bytes)return K.push(this.readFloat());var ce=d(this);for(K=K||[];this.pos<ce;)K.push(this.readFloat());return K},readPackedDouble:function(K){if(this.type!==t.Bytes)return K.push(this.readDouble());var ce=d(this);for(K=K||[];this.pos<ce;)K.push(this.readDouble());return K},readPackedFixed32:function(K){if(this.type!==t.Bytes)return K.push(this.readFixed32());var ce=d(this);for(K=K||[];this.pos<ce;)K.push(this.readFixed32());return K},readPackedSFixed32:function(K){if(this.type!==t.Bytes)return K.push(this.readSFixed32());var ce=d(this);for(K=K||[];this.pos<ce;)K.push(this.readSFixed32());return K},readPackedFixed64:function(K){if(this.type!==t.Bytes)return K.push(this.readFixed64());var ce=d(this);for(K=K||[];this.pos<ce;)K.push(this.readFixed64());return K},readPackedSFixed64:function(K){if(this.type!==t.Bytes)return K.push(this.readSFixed64());var ce=d(this);for(K=K||[];this.pos<ce;)K.push(this.readSFixed64());return K},skip:function(K){var ce=7&K;if(ce===t.Varint)for(;this.buf[this.pos++]>127;);else if(ce===t.Bytes)this.pos=this.readVarint()+this.pos;else if(ce===t.Fixed32)this.pos+=4;else{if(ce!==t.Fixed64)throw new Error("Unimplemented type: "+ce);this.pos+=8}},writeTag:function(K,ce){this.writeVarint(K<<3|ce)},realloc:function(K){for(var ce=this.length||16;ce<this.pos+K;)ce*=2;if(ce!==this.length){var he=new Uint8Array(ce);he.set(this.buf),this.buf=he,this.length=ce}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(K){this.realloc(4),te(this.buf,K,this.pos),this.pos+=4},writeSFixed32:function(K){this.realloc(4),te(this.buf,K,this.pos),this.pos+=4},writeFixed64:function(K){this.realloc(8),te(this.buf,-1&K,this.pos),te(this.buf,Math.floor(K*h),this.pos+4),this.pos+=8},writeSFixed64:function(K){this.realloc(8),te(this.buf,-1&K,this.pos),te(this.buf,Math.floor(K*h),this.pos+4),this.pos+=8},writeVarint:function(K){(K=+K||0)>268435455||K<0?function(ce,he){var Se,$e;if(ce>=0?(Se=ce%4294967296|0,$e=ce/4294967296|0):($e=~(-ce/4294967296),4294967295^(Se=~(-ce%4294967296))?Se=Se+1|0:(Se=0,$e=$e+1|0)),ce>=18446744073709552e3||ce<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");he.realloc(10),function(Be,Ve,Mt){Mt.buf[Mt.pos++]=127&Be|128,Be>>>=7,Mt.buf[Mt.pos++]=127&Be|128,Be>>>=7,Mt.buf[Mt.pos++]=127&Be|128,Be>>>=7,Mt.buf[Mt.pos++]=127&Be|128,Mt.buf[Mt.pos]=127&(Be>>>=7)}(Se,0,he),function(Be,Ve){var Mt=(7&Be)<<4;Ve.buf[Ve.pos++]|=Mt|((Be>>>=3)?128:0),Be&&(Ve.buf[Ve.pos++]=127&Be|((Be>>>=7)?128:0),Be&&(Ve.buf[Ve.pos++]=127&Be|((Be>>>=7)?128:0),Be&&(Ve.buf[Ve.pos++]=127&Be|((Be>>>=7)?128:0),Be&&(Ve.buf[Ve.pos++]=127&Be|((Be>>>=7)?128:0),Be&&(Ve.buf[Ve.pos++]=127&Be)))))}($e,he)}(K,this):(this.realloc(4),this.buf[this.pos++]=127&K|(K>127?128:0),K<=127||(this.buf[this.pos++]=127&(K>>>=7)|(K>127?128:0),K<=127||(this.buf[this.pos++]=127&(K>>>=7)|(K>127?128:0),K<=127||(this.buf[this.pos++]=K>>>7&127))))},writeSVarint:function(K){this.writeVarint(K<0?2*-K-1:2*K)},writeBoolean:function(K){this.writeVarint(!!K)},writeString:function(K){K=String(K),this.realloc(4*K.length),this.pos++;var ce=this.pos;this.pos=function(Se,$e,Be){for(var Ve,Mt,Ne=0;Ne<$e.length;Ne++){if((Ve=$e.charCodeAt(Ne))>55295&&Ve<57344){if(!Mt){Ve>56319||Ne+1===$e.length?(Se[Be++]=239,Se[Be++]=191,Se[Be++]=189):Mt=Ve;continue}if(Ve<56320){Se[Be++]=239,Se[Be++]=191,Se[Be++]=189,Mt=Ve;continue}Ve=Mt-55296<<10|Ve-56320|65536,Mt=null}else Mt&&(Se[Be++]=239,Se[Be++]=191,Se[Be++]=189,Mt=null);Ve<128?Se[Be++]=Ve:(Ve<2048?Se[Be++]=Ve>>6|192:(Ve<65536?Se[Be++]=Ve>>12|224:(Se[Be++]=Ve>>18|240,Se[Be++]=Ve>>12&63|128),Se[Be++]=Ve>>6&63|128),Se[Be++]=63&Ve|128)}return Be}(this.buf,K,this.pos);var he=this.pos-ce;he>=128&&T(ce,he,this),this.pos=ce-1,this.writeVarint(he),this.pos+=he},writeFloat:function(K){this.realloc(4),a.write(this.buf,K,this.pos,!0,23,4),this.pos+=4},writeDouble:function(K){this.realloc(8),a.write(this.buf,K,this.pos,!0,52,8),this.pos+=8},writeBytes:function(K){var ce=K.length;this.writeVarint(ce),this.realloc(ce);for(var he=0;he<ce;he++)this.buf[this.pos++]=K[he]},writeRawMessage:function(K,ce){this.pos++;var he=this.pos;K(ce,this);var Se=this.pos-he;Se>=128&&T(he,Se,this),this.pos=he-1,this.writeVarint(Se),this.pos+=Se},writeMessage:function(K,ce,he){this.writeTag(K,t.Bytes),this.writeRawMessage(ce,he)},writePackedVarint:function(K,ce){ce.length&&this.writeMessage(K,I,ce)},writePackedSVarint:function(K,ce){ce.length&&this.writeMessage(K,z,ce)},writePackedBoolean:function(K,ce){ce.length&&this.writeMessage(K,P,ce)},writePackedFloat:function(K,ce){ce.length&&this.writeMessage(K,b,ce)},writePackedDouble:function(K,ce){ce.length&&this.writeMessage(K,L,ce)},writePackedFixed32:function(K,ce){ce.length&&this.writeMessage(K,C,ce)},writePackedSFixed32:function(K,ce){ce.length&&this.writeMessage(K,R,ce)},writePackedFixed64:function(K,ce){ce.length&&this.writeMessage(K,F,ce)},writePackedSFixed64:function(K,ce){ce.length&&this.writeMessage(K,q,ce)},writeBytesField:function(K,ce){this.writeTag(K,t.Bytes),this.writeBytes(ce)},writeFixed32Field:function(K,ce){this.writeTag(K,t.Fixed32),this.writeFixed32(ce)},writeSFixed32Field:function(K,ce){this.writeTag(K,t.Fixed32),this.writeSFixed32(ce)},writeFixed64Field:function(K,ce){this.writeTag(K,t.Fixed64),this.writeFixed64(ce)},writeSFixed64Field:function(K,ce){this.writeTag(K,t.Fixed64),this.writeSFixed64(ce)},writeVarintField:function(K,ce){this.writeTag(K,t.Varint),this.writeVarint(ce)},writeSVarintField:function(K,ce){this.writeTag(K,t.Varint),this.writeSVarint(ce)},writeStringField:function(K,ce){this.writeTag(K,t.Bytes),this.writeString(ce)},writeFloatField:function(K,ce){this.writeTag(K,t.Fixed32),this.writeFloat(ce)},writeDoubleField:function(K,ce){this.writeTag(K,t.Fixed64),this.writeDouble(ce)},writeBooleanField:function(K,ce){this.writeVarintField(K,!!ce)}},Ix}var zy=X(wT());const Px=3;function CL(a,t,r){t.glyphs=[],a===1&&r.readMessage(LL,t)}function LL(a,t,r){if(a===3){const{id:h,bitmap:g,width:d,height:_,left:T,top:I,advance:z}=r.readMessage(IL,{});t.glyphs.push({id:h,bitmap:new nu({width:d+2*Px,height:_+2*Px},g),metrics:{width:d,height:_,left:T,top:I,advance:z}})}else a===4?t.ascender=r.readSVarint():a===5&&(t.descender=r.readSVarint())}function IL(a,t,r){a===1?t.id=r.readVarint():a===2?t.bitmap=r.readBytes():a===3?t.width=r.readVarint():a===4?t.height=r.readVarint():a===5?t.left=r.readSVarint():a===6?t.top=r.readSVarint():a===7&&(t.advance=r.readVarint())}const TT=Px,yc={horizontal:1,vertical:2,horizontalOnly:3};class K_{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const h=new K_;return h.scale=t||1,h.fontStack=r,h}static forImage(t){const r=new K_;return r.imageName=t,r}}class gg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const h=new gg;for(let g=0;g<t.sections.length;g++){const d=t.sections[g];d.image?h.addImageSection(d):h.addTextSection(d,r)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(r,h){let g="";for(let d=0;d<r.length;d++){const _=r.charCodeAt(d+1)||null,T=r.charCodeAt(d-1)||null;g+=!h&&(_&&cp(_)&&!Y_[r[d+1]]||T&&cp(T)&&!Y_[r[d-1]])||!Y_[r[d]]?r[d]:Y_[r[d]]}return g}(this.text,t)}trim(){let t=0;for(let h=0;h<this.text.length&&ky[this.text.charCodeAt(h)];h++)t++;let r=this.text.length;for(let h=this.text.length-1;h>=0&&h>=t&&ky[this.text.charCodeAt(h)];h--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const h=new gg;return h.text=this.text.substring(t,r),h.sectionIndex=this.sectionIndex.slice(t,r),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(K_.forText(t.scale,t.fontStack||r));const h=this.sections.length-1;for(let g=0;g<t.text.length;++g)this.sectionIndex.push(h)}addImageSection(t){const r=t.image?t.image.namePrimary:"";if(r.length===0)return void Wn("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(K_.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Wn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dx(a,t,r,h,g,d,_,T,I,z,b,L,P,C,R){const F=gg.fromFeature(a,g);L===yc.vertical&&F.verticalizePunctuation(P);let q=[];const Z=function(he,Se,$e,Be,Ve,Mt){if(!he)return[];const Ne=[],ft=function(ei,ri,Yt,yi,Fi,pi){let Tn=0;for(let ln=0;ln<ei.length();ln++){const $i=ei.getSection(ln);Tn+=MT(ei.getCodePoint(ln),$i,yi,Fi,ri,pi)}return Tn/Math.max(1,Math.ceil(Tn/Yt))}(he,Se,$e,Be,Ve,Mt),Pt=he.text.indexOf("")>=0;let Dt=0;for(let ei=0;ei<he.length();ei++){const ri=he.getSection(ei),Yt=he.getCodePoint(ei);if(ky[Yt]||(Dt+=MT(Yt,ri,Be,Ve,Se,Mt)),ei<he.length()-1){const yi=!((Ut=Yt)<11904||!(Gn["Bopomofo Extended"](Ut)||Gn.Bopomofo(Ut)||Gn["CJK Compatibility Forms"](Ut)||Gn["CJK Compatibility Ideographs"](Ut)||Gn["CJK Compatibility"](Ut)||Gn["CJK Radicals Supplement"](Ut)||Gn["CJK Strokes"](Ut)||Gn["CJK Symbols and Punctuation"](Ut)||Gn["CJK Unified Ideographs Extension A"](Ut)||Gn["CJK Unified Ideographs"](Ut)||Gn["Enclosed CJK Letters and Months"](Ut)||Gn["Halfwidth and Fullwidth Forms"](Ut)||Gn.Hiragana(Ut)||Gn["Ideographic Description Characters"](Ut)||Gn["Kangxi Radicals"](Ut)||Gn["Katakana Phonetic Extensions"](Ut)||Gn.Katakana(Ut)||Gn["Vertical Forms"](Ut)||Gn["Yi Radicals"](Ut)||Gn["Yi Syllables"](Ut)));(RL[Yt]||yi||ri.imageName)&&Ne.push(ET(ei+1,Dt,ft,Ne,PL(Yt,he.getCodePoint(ei+1),yi&&Pt),!1))}}var Ut;return AT(ET(he.length(),Dt,ft,Ne,0,!0))}(F,z,d,t,h,C),{processBidirectionalText:te,processStyledBidirectionalText:ie}=ua;if(te&&F.sections.length===1){const he=te(F.toString(),Z);for(const Se of he){const $e=new gg;$e.text=Se,$e.sections=F.sections;for(let Be=0;Be<Se.length;Be++)$e.sectionIndex.push(0);q.push($e)}}else if(ie){const he=ie(F.text,F.sectionIndex,Z);for(const Se of he){const $e=new gg;$e.text=Se[0],$e.sectionIndex=Se[1],$e.sections=F.sections,q.push($e)}}else q=function(he,Se){const $e=[],Be=he.text;let Ve=0;for(const Mt of Se)$e.push(he.substring(Ve,Mt)),Ve=Mt;return Ve<Be.length&&$e.push(he.substring(Ve,Be.length)),$e}(F,Z);const K=[],ce={positionedLines:K,text:F.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,Se,$e,Be,Ve,Mt,Ne,ft,Pt,Dt,Ut,ei){let ri=0,Yt=0,yi=0;const Fi=ft==="right"?1:ft==="left"?0:.5;let pi=!1;for(const bn of Ve){const Cn=bn.getSections();for(const fr of Cn){if(fr.imageName)continue;const Sr=Se[fr.fontStack];if(Sr&&(pi=Sr.ascender!==void 0&&Sr.descender!==void 0,!pi))break}if(!pi)break}let Tn=0;for(const bn of Ve){bn.trim();const Cn=bn.getMaxScale(),fr=(Cn-1)*zs,Sr={positionedGlyphs:[],lineOffset:0};he.positionedLines[Tn]=Sr;const Cr=Sr.positionedGlyphs;let xr=0;if(!bn.length()){Yt+=Mt,++Tn;continue}let Vr=0,Br=0;for(let Rs=0;Rs<bn.length();Rs++){const lr=bn.getSection(Rs),fs=bn.getSectionIndex(Rs),xs=bn.getCodePoint(Rs);let Qs=lr.scale,bo=null,ko=null,wo=null,ho=zs,Co=0;const No=!(Pt===yc.horizontal||!Ut&&!Eu(xs)||Ut&&(ky[xs]||(ln=xs,Gn.Arabic(ln)||Gn["Arabic Supplement"](ln)||Gn["Arabic Extended-A"](ln)||Gn["Arabic Presentation Forms-A"](ln)||Gn["Arabic Presentation Forms-B"](ln))));if(lr.imageName){const Aa=Be[lr.imageName];if(!Aa)continue;wo=lr.imageName,he.iconsInText=he.iconsInText||!0,ko=Aa.paddedRect;const Zs=Aa.displaySize;Qs=Qs*zs/ei,bo={width:Zs[0],height:Zs[1],left:0,top:-TT,advance:No?Zs[1]:Zs[0],localGlyph:!1},Co=pi?-bo.height*Qs:Cn*zs-17-Zs[1]*Qs,ho=bo.advance;const Ol=(No?Zs[0]:Zs[1])*Qs-zs*Cn;Ol>0&&Ol>xr&&(xr=Ol)}else{const Aa=$e[lr.fontStack];if(!Aa)continue;Aa[xs]&&(ko=Aa[xs]);const Zs=Se[lr.fontStack];if(!Zs)continue;const Ol=Zs.glyphs[xs];if(!Ol)continue;if(bo=Ol.metrics,ho=xs!==8203?zs:0,pi){const $u=Zs.ascender!==void 0?Math.abs(Zs.ascender):0,su=Zs.descender!==void 0?Math.abs(Zs.descender):0,ou=($u+su)*Qs;Vr<ou&&(Vr=ou,Br=($u-su)/2*Qs),Co=-$u*Qs}else Co=(Cn-Qs)*zs-17}No?(he.verticalizable=!0,Cr.push({glyph:xs,imageName:wo,x:ri,y:Yt+Co,vertical:No,scale:Qs,localGlyph:bo.localGlyph,fontStack:lr.fontStack,sectionIndex:fs,metrics:bo,rect:ko}),ri+=ho*Qs+Dt):(Cr.push({glyph:xs,imageName:wo,x:ri,y:Yt+Co,vertical:No,scale:Qs,localGlyph:bo.localGlyph,fontStack:lr.fontStack,sectionIndex:fs,metrics:bo,rect:ko}),ri+=bo.advance*Qs+Dt)}Cr.length!==0&&(yi=Math.max(ri-Dt,yi),pi?CT(Cr,Fi,xr,Br,Mt*Cn/2):CT(Cr,Fi,xr,0,Mt/2)),ri=0;const Bs=Mt*Cn+xr;Sr.lineOffset=Math.max(xr,fr),Yt+=Bs,++Tn}var ln;const $i=Yt,{horizontalAlign:Di,verticalAlign:Kn}=Ox(Ne);(function(bn,Cn,fr,Sr,Cr,xr){const Vr=(Cn-fr)*Cr,Br=-xr*Sr;for(const Bs of bn)for(const Rs of Bs.positionedGlyphs)Rs.x+=Vr,Rs.y+=Br})(he.positionedLines,Fi,Di,Kn,yi,$i),he.top+=-Kn*$i,he.bottom=he.top+$i,he.left+=-Di*yi,he.right=he.left+yi,he.hasBaseline=pi}(ce,t,r,h,q,_,T,I,L,z,P,R),!function(he){for(const Se of he)if(Se.positionedGlyphs.length!==0)return!1;return!0}(K)&&ce}const ky={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},RL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function MT(a,t,r,h,g,d){if(t.imageName){const _=h[t.imageName];return _?_.displaySize[0]*t.scale*zs/d+g:0}{const _=r[t.fontStack],T=_&&_.glyphs[a];return T?T.metrics.advance*t.scale+g:0}}function ST(a,t,r,h){const g=Math.pow(a-t,2);return h?a<t?g/2:2*g:g+Math.abs(r)*r}function PL(a,t,r){let h=0;return a===10&&(h-=1e4),r&&(h+=150),a!==40&&a!==65288||(h+=50),t!==41&&t!==65289||(h+=50),h}function ET(a,t,r,h,g,d){let _=null,T=ST(t,r,g,d);for(const I of h){const z=ST(t-I.x,r,g,d)+I.badness;z<=T&&(_=I,T=z)}return{index:a,x:t,priorBreak:_,badness:T}}function AT(a){return a?AT(a.priorBreak).concat(a.index):[]}function Ox(a){let t=.5,r=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function CT(a,t,r,h,g){if(!(t||r||h||g))return;const d=a.length-1,_=a[d],T=(_.x+_.metrics.advance*_.scale)*t;for(let I=0;I<=d;I++)a[I].x-=T,a[I].y+=r+h+g}function DL(a,t,r,h){const{horizontalAlign:g,verticalAlign:d}=Ox(h),_=r[0]-a.displaySize[0]*g,T=r[1]-a.displaySize[1]*d;return{imagePrimary:a,imageSecondary:t,top:T,bottom:T+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function LT(a,t,r,h,g,d){const _=a.imagePrimary;let T;if(_.content){const q=_.content,Z=_.pixelRatio||1;T=[q[0]/Z,q[1]/Z,_.displaySize[0]-q[2]/Z,_.displaySize[1]-q[3]/Z]}const I=t.left*d,z=t.right*d;let b,L,P,C;r==="width"||r==="both"?(C=g[0]+I-h[3],L=g[0]+z+h[1]):(C=g[0]+(I+z-_.displaySize[0])/2,L=C+_.displaySize[0]);const R=t.top*d,F=t.bottom*d;return r==="height"||r==="both"?(b=g[1]+R-h[0],P=g[1]+F+h[2]):(b=g[1]+(R+F-_.displaySize[1])/2,P=b+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:b,right:L,bottom:P,left:C,collisionPadding:T}}class Rd extends Ye{constructor(t,r,h,g,d){super(t,r),this.angle=g,this.z=h,d!==void 0&&(this.segment=d)}clone(){return new Rd(this.x,this.y,this.z,this.angle,this.segment)}}function IT(a,t,r,h,g){if(t.segment===void 0)return!0;let d=t,_=t.segment+1,T=0;for(;T>-r/2;){if(_--,_<0)return!1;T-=a[_].dist(d),d=a[_]}T+=a[_].dist(a[_+1]),_++;const I=[];let z=0;for(;T<r/2;){const b=a[_],L=a[_+1];if(!L)return!1;let P=a[_-1].angleTo(b)-b.angleTo(L);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:P}),z+=P;T-I[0].distance>h;)z-=I.shift().angleDelta;if(z>g)return!1;_++,T+=b.dist(L)}return!0}function RT(a){let t=0;for(let r=0;r<a.length-1;r++)t+=a[r].dist(a[r+1]);return t}function PT(a,t,r){return a?.6*t*r:0}function DT(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function OL(a,t,r,h,g,d){const _=PT(r,g,d),T=DT(r,h)*d;let I=0;const z=RT(a)/2;for(let b=0;b<a.length-1;b++){const L=a[b],P=a[b+1],C=L.dist(P);if(I+C>z){const R=(z-I)/C,F=Pe(L.x,P.x,R),q=Pe(L.y,P.y,R),Z=new Rd(F,q,0,P.angleTo(L),b);return!_||IT(a,Z,T,_,t)?Z:void 0}I+=C}}function zL(a,t,r,h,g,d,_,T,I){const z=PT(h,d,_),b=DT(h,g),L=b*_,P=a[0].x===0||a[0].x===I||a[0].y===0||a[0].y===I;return t-L<t/4&&(t=L+t/4),OT(a,P?t/2*T%t:(b/2+2*d)*_*T%t,t,z,r,L,P,!1,I)}function OT(a,t,r,h,g,d,_,T,I){const z=d/2,b=RT(a);let L=0,P=t-r,C=[];for(let R=0;R<a.length-1;R++){const F=a[R],q=a[R+1],Z=F.dist(q),te=q.angleTo(F);for(;P+r<L+Z;){P+=r;const ie=(P-L)/Z,K=Pe(F.x,q.x,ie),ce=Pe(F.y,q.y,ie);if(K>=0&&K<I&&ce>=0&&ce<I&&P-z>=0&&P+z<=b){const he=new Rd(K,ce,0,te,R);h&&!IT(a,he,d,h,g)||C.push(he)}}L+=Z}return T||C.length||_||(C=OT(a,L/2,r,h,g,d,_,!0,I)),C}function zT(a,t,r,h,g){const d=[];for(let _=0;_<a.length;_++){const T=a[_];let I;for(let z=0;z<T.length-1;z++){let b=T[z],L=T[z+1];b.x<t&&L.x<t||(b.x<t?b=new Ye(t,b.y+(t-b.x)/(L.x-b.x)*(L.y-b.y))._round():L.x<t&&(L=new Ye(t,b.y+(t-b.x)/(L.x-b.x)*(L.y-b.y))._round()),b.y<r&&L.y<r||(b.y<r?b=new Ye(b.x+(r-b.y)/(L.y-b.y)*(L.x-b.x),r)._round():L.y<r&&(L=new Ye(b.x+(r-b.y)/(L.y-b.y)*(L.x-b.x),r)._round()),b.x>=h&&L.x>=h||(b.x>=h?b=new Ye(h,b.y+(h-b.x)/(L.x-b.x)*(L.y-b.y))._round():L.x>=h&&(L=new Ye(h,b.y+(h-b.x)/(L.x-b.x)*(L.y-b.y))._round()),b.y>=g&&L.y>=g||(b.y>=g?b=new Ye(b.x+(g-b.y)/(L.y-b.y)*(L.x-b.x),g)._round():L.y>=g&&(L=new Ye(b.x+(g-b.y)/(L.y-b.y)*(L.x-b.x),g)._round()),I&&b.equals(I[I.length-1])||(I=[b],d.push(I)),I.push(L)))))}}return d}function kT(a){let t=0,r=0;for(const _ of a)t+=_.w*_.h,r=Math.max(r,_.w);a.sort((_,T)=>T.h-_.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let g=0,d=0;for(const _ of a)for(let T=h.length-1;T>=0;T--){const I=h[T];if(!(_.w>I.w||_.h>I.h)){if(_.x=I.x,_.y=I.y,d=Math.max(d,_.y+_.h),g=Math.max(g,_.x+_.w),_.w===I.w&&_.h===I.h){const z=h.pop();T<h.length&&(h[T]=z)}else _.h===I.h?(I.x+=_.w,I.w-=_.w):_.w===I.w?(I.y+=_.h,I.h-=_.h):(h.push({x:I.x+_.w,y:I.y,w:I.w-_.w,h:_.h}),I.y+=_.h,I.h-=_.h);break}}return{w:g,h:d,fill:t/(g*d)||0}}Sn(Rd,"Anchor");const J_=1;class zx{constructor(t,{pixelRatio:r,version:h,stretchX:g,stretchY:d,content:_},T){this.paddedRect=t,this.pixelRatio=r,this.stretchX=g,this.stretchY=d,this.content=_,this.version=h,this.padding=T}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class FT{constructor(t,r,h){const g={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,g,J_,_),this.addImages(r,d,2,_);const{w:T,h:I}=kT(_),z=new Ea({width:T||1,height:I||1});for(const b in t){const L=t[b],P=g[b].paddedRect;Ea.copy(L.data,z,{x:0,y:0},{x:P.x+J_,y:P.y+J_},L.data,h,L.sdf)}for(const b in r){const L=r[b],P=d[b].paddedRect;let C=d[b].padding;const R=P.x+C,F=P.y+C,q=L.data.width,Z=L.data.height;C=C>1?C-1:C,Ea.copy(L.data,z,{x:0,y:0},{x:R,y:F},L.data,h),Ea.copy(L.data,z,{x:0,y:Z-C},{x:R,y:F-C},{width:q,height:C},h),Ea.copy(L.data,z,{x:0,y:0},{x:R,y:F+Z},{width:q,height:C},h),Ea.copy(L.data,z,{x:q-C,y:0},{x:R-C,y:F},{width:C,height:Z},h),Ea.copy(L.data,z,{x:0,y:0},{x:R+q,y:F},{width:C,height:Z},h),Ea.copy(L.data,z,{x:q-C,y:Z-C},{x:R-C,y:F-C},{width:C,height:C},h),Ea.copy(L.data,z,{x:0,y:Z-C},{x:R+q,y:F-C},{width:C,height:C},h),Ea.copy(L.data,z,{x:0,y:0},{x:R+q,y:F+Z},{width:C,height:C},h),Ea.copy(L.data,z,{x:q-C,y:0},{x:R-C,y:F+Z},{width:C,height:C},h)}this.image=z,this.iconPositions=g,this.patternPositions=d}addImages(t,r,h,g){for(const d in t){const _=t[d],T={x:0,y:0,w:_.data.width+2*h,h:_.data.height+2*h};g.push(T),r[d]=new zx(T,_,h),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,r,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>t.hasImage(g,h)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const g in t.getUpdatedImages(h))this.patchUpdatedImage(this.iconPositions[g],t.getImage(g,h),r),this.patchUpdatedImage(this.patternPositions[g],t.getImage(g,h),r)}patchUpdatedImage(t,r,h){if(!t||!r||t.version===r.version)return;t.version=r.version;const[g,d]=t.tl;h.update(r.data,{position:{x:g,y:d}})}}Sn(zx,"ImagePosition"),Sn(FT,"ImageAtlas");const Q_=1e20;function BT(a,t,r,h,g,d,_,T,I){for(let z=t;z<t+h;z++)NT(a,r*d+z,d,g,_,T,I);for(let z=r;z<r+g;z++)NT(a,z*d+t,1,h,_,T,I)}function NT(a,t,r,h,g,d,_){d[0]=0,_[0]=-Q_,_[1]=Q_,g[0]=a[t];for(let T=1,I=0,z=0;T<h;T++){g[T]=a[t+T*r];const b=T*T;do{const L=d[I];z=(g[T]-g[L]+b-L*L)/(T-L)/2}while(z<=_[I]&&--I>-1);I++,d[I]=T,_[I]=z,_[I+1]=Q_}for(let T=0,I=0;T<h;T++){for(;_[I+1]<T;)I++;const z=d[I],b=T-z;a[t+T*r]=g[z]+b*b}}const Hu=2,kx={none:0,ideographs:1,all:2};class _g{constructor(t,r,h){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=h,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,r){this.urls[r]=t}getGlyphs(t,r,h){const g=[],d=this.urls[r]||Je.GLYPHS_URL;for(const _ in t)for(const T of t[_])g.push({stack:_,id:T});an(g,({stack:_,id:T},I)=>{let z=this.entries[_];z||(z=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=z.glyphs[T];if(b!==void 0)return void I(null,{stack:_,id:T,glyph:b});if(b=this._tinySDF(z,_,T),b)return z.glyphs[T]=b,void I(null,{stack:_,id:T,glyph:b});const L=Math.floor(T/256);if(256*L>65535)return Wn("glyphs > 65535 not supported"),void I(null,{stack:_,id:T,glyph:b});if(z.ranges[L])return void I(null,{stack:_,id:T,glyph:b});let P=z.requests[L];P||(P=z.requests[L]=[],_g.loadGlyphRange(_,L,d,this.requestManager,(C,R)=>{if(R){z.ascender=R.ascender,z.descender=R.descender;for(const F in R.glyphs)this._doesCharSupportLocalGlyph(+F)||(z.glyphs[+F]=R.glyphs[+F]);z.ranges[L]=!0}for(const F of P)F(C,R);delete z.requests[L]})),P.push((C,R)=>{C?I(C):R&&I(null,{stack:_,id:T,glyph:R.glyphs[T]||null})})},(_,T)=>{if(_)h(_);else if(T){const I={};for(const{stack:z,id:b,glyph:L}of T)I[z]===void 0&&(I[z]={}),I[z].glyphs===void 0&&(I[z].glyphs={}),I[z].glyphs[b]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics},I[z].ascender=this.entries[z].ascender,I[z].descender=this.entries[z].descender;h(null,I)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==kx.none&&(this.localGlyphMode===kx.all?!!this.localFontFamily:!!this.localFontFamily&&(Gn["CJK Unified Ideographs"](t)||Gn["Hangul Syllables"](t)||Gn.Hiragana(t)||Gn.Katakana(t)||Gn["CJK Symbols and Punctuation"](t)||Gn["CJK Unified Ideographs Extension A"](t)||Gn["CJK Unified Ideographs Extension B"](t)||Gn.Osage(t)))}_tinySDF(t,r,h){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(h))return;let d=t.tinySDF;if(!d){let F="400";/bold/i.test(r)?F="900":/medium/i.test(r)?F="500":/light/i.test(r)&&(F="200"),d=t.tinySDF=new _g.TinySDF({fontFamily:g,fontWeight:F,fontSize:24*Hu,buffer:3*Hu,radius:8*Hu}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][h])return this.localGlyphs[d.fontWeight][h];const _=String.fromCodePoint(h),{data:T,width:I,height:z,glyphWidth:b,glyphHeight:L,glyphLeft:P,glyphTop:C,glyphAdvance:R}=d.draw(_);return this.localGlyphs[d.fontWeight][h]={id:h,bitmap:new nu({width:I,height:z},T),metrics:{width:b/Hu,height:L/Hu,left:P/Hu,top:C/Hu-27,advance:R/Hu,localGlyph:!0}}}}_g.loadGlyphRange=function(a,t,r,h,g){const d=256*t,_=d+255,T=h.transformRequest(h.normalizeGlyphsURL(r).replace("{fontstack}",a).replace("{range}",`${d}-${_}`),aa.Glyphs);Vo(T,(I,z)=>{if(I)g(I);else if(z){const b={},L=function(P){return new zy(P).readFields(CL,{})}(z);for(const P of L.glyphs)b[P.id]=P;g(null,{glyphs:b,ascender:L.ascender,descender:L.descender})}})},_g.TinySDF=class{constructor({fontSize:a=24,buffer:t=3,radius:r=8,cutoff:h=.25,fontFamily:g="sans-serif",fontWeight:d="normal",fontStyle:_="normal"}={}){this.buffer=t,this.cutoff=h,this.radius=r;const T=this.size=a+4*t,I=this._createCanvas(T),z=this.ctx=I.getContext("2d",{willReadFrequently:!0});z.font=`${_} ${d} ${a}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(a){const t=document.createElement("canvas");return t.width=t.height=a,t}draw(a){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:h,actualBoundingBoxLeft:g,actualBoundingBoxRight:d}=this.ctx.measureText(a),_=Math.ceil(r),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-g))),I=Math.min(this.size-this.buffer,_+Math.ceil(h)),z=T+2*this.buffer,b=I+2*this.buffer,L=Math.max(z*b,0),P=new Uint8ClampedArray(L),C={data:P,width:z,height:b,glyphWidth:T,glyphHeight:I,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(T===0||I===0)return C;const{ctx:R,buffer:F,gridInner:q,gridOuter:Z}=this;R.clearRect(F,F,T,I),R.fillText(a,F,F+_);const te=R.getImageData(F,F,T,I);Z.fill(Q_,0,L),q.fill(0,0,L);for(let ie=0;ie<I;ie++)for(let K=0;K<T;K++){const ce=te.data[4*(ie*T+K)+3]/255;if(ce===0)continue;const he=(ie+F)*z+K+F;if(ce===1)Z[he]=0,q[he]=Q_;else{const Se=.5-ce;Z[he]=Se>0?Se*Se:0,q[he]=Se<0?Se*Se:0}}BT(Z,0,0,z,b,z,this.f,this.v,this.z),BT(q,F,F,T,I,z,this.f,this.v,this.z);for(let ie=0;ie<L;ie++){const K=Math.sqrt(Z[ie])-Math.sqrt(q[ie]);P[ie]=Math.round(255-255*(K/this.radius+this.cutoff))}return C}};const kp=J_;function UT(a,t,r,h,g=1){const d=[],_=a.imagePrimary,T=_.pixelRatio,I=_.paddedRect.w-2*kp,z=_.paddedRect.h-2*kp,b=(a.right-a.left)*g,L=(a.bottom-a.top)*g,P=_.stretchX||[[0,I]],C=_.stretchY||[[0,z]],R=(Ne,ft)=>Ne+ft[1]-ft[0],F=P.reduce(R,0),q=C.reduce(R,0),Z=I-F,te=z-q;let ie=0,K=F,ce=0,he=q,Se=0,$e=Z,Be=0,Ve=te;if(_.content&&h){const Ne=_.content;ie=Fy(P,0,Ne[0]),ce=Fy(C,0,Ne[1]),K=Fy(P,Ne[0],Ne[2]),he=Fy(C,Ne[1],Ne[3]),Se=Ne[0]-ie,Be=Ne[1]-ce,$e=Ne[2]-Ne[0]-K,Ve=Ne[3]-Ne[1]-he}const Mt=(Ne,ft,Pt,Dt)=>{const Ut=By(Ne.stretch-ie,K,b,a.left*g),ei=Ny(Ne.fixed-Se,$e,Ne.stretch,F),ri=By(ft.stretch-ce,he,L,a.top*g),Yt=Ny(ft.fixed-Be,Ve,ft.stretch,q),yi=By(Pt.stretch-ie,K,b,a.left*g),Fi=Ny(Pt.fixed-Se,$e,Pt.stretch,F),pi=By(Dt.stretch-ce,he,L,a.top*g),Tn=Ny(Dt.fixed-Be,Ve,Dt.stretch,q),ln=new Ye(Ut,ri),$i=new Ye(yi,ri),Di=new Ye(yi,pi),Kn=new Ye(Ut,pi),bn=new Ye(ei/T,Yt/T),Cn=new Ye(Fi/T,Tn/T),fr=t*Math.PI/180;if(fr){const Bs=Math.sin(fr),Rs=Math.cos(fr),lr=[Rs,-Bs,Bs,Rs];ln._matMult(lr),$i._matMult(lr),Kn._matMult(lr),Di._matMult(lr)}const Sr=Ne.stretch+Ne.fixed,Cr=Pt.stretch+Pt.fixed,xr=ft.stretch+ft.fixed,Vr=Dt.stretch+Dt.fixed,Br=a.imageSecondary;return{tl:ln,tr:$i,bl:Kn,br:Di,texPrimary:{x:_.paddedRect.x+kp+Sr,y:_.paddedRect.y+kp+xr,w:Cr-Sr,h:Vr-xr},texSecondary:Br?{x:Br.paddedRect.x+kp+Sr,y:Br.paddedRect.y+kp+xr,w:Cr-Sr,h:Vr-xr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:bn,pixelOffsetBR:Cn,minFontScaleX:$e/T/b,minFontScaleY:Ve/T/L,isSDF:r}};if(h&&(_.stretchX||_.stretchY)){const Ne=VT(P,Z,F),ft=VT(C,te,q);for(let Pt=0;Pt<Ne.length-1;Pt++){const Dt=Ne[Pt],Ut=Ne[Pt+1];for(let ei=0;ei<ft.length-1;ei++)d.push(Mt(Dt,ft[ei],Ut,ft[ei+1]))}}else d.push(Mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:z+1}));return d}function Fy(a,t,r){let h=0;for(const g of a)h+=Math.max(t,Math.min(r,g[1]))-Math.max(t,Math.min(r,g[0]));return h}function VT(a,t,r){const h=[{fixed:-kp,stretch:0}];for(const[g,d]of a){const _=h[h.length-1];h.push({fixed:g-_.stretch,stretch:_.stretch}),h.push({fixed:g-_.stretch,stretch:_.stretch+(d-g)})}return h.push({fixed:t+kp,stretch:r}),h}function By(a,t,r,h){return a/t*r+h}function Ny(a,t,r,h){return a-t*r/h}function kL(a,t,r,h){const g=t+a.positionedLines[h].lineOffset;return h===0?r+g/2:r+(g+(t+a.positionedLines[h-1].lineOffset))/2}function FL(a,t=1,r=!1){let h=1/0,g=1/0,d=-1/0,_=-1/0;const T=a[0];for(let C=0;C<T.length;C++){const R=T[C];(!C||R.x<h)&&(h=R.x),(!C||R.y<g)&&(g=R.y),(!C||R.x>d)&&(d=R.x),(!C||R.y>_)&&(_=R.y)}const I=Math.min(d-h,_-g);let z=I/2;const b=new td([],BL);if(I===0)return new Ye(h,g);for(let C=h;C<d;C+=I)for(let R=g;R<_;R+=I)b.push(new yg(C+z,R+z,z,a));let L=function(C){let R=0,F=0,q=0;const Z=C[0];for(let te=0,ie=Z.length,K=ie-1;te<ie;K=te++){const ce=Z[te],he=Z[K],Se=ce.x*he.y-he.x*ce.y;F+=(ce.x+he.x)*Se,q+=(ce.y+he.y)*Se,R+=3*Se}return new yg(F/R,q/R,0,C)}(a),P=b.length;for(;b.length;){const C=b.pop();(C.d>L.d||!L.d)&&(L=C,r&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,P)),C.max-L.d<=t||(z=C.h/2,b.push(new yg(C.p.x-z,C.p.y-z,z,a)),b.push(new yg(C.p.x+z,C.p.y-z,z,a)),b.push(new yg(C.p.x-z,C.p.y+z,z,a)),b.push(new yg(C.p.x+z,C.p.y+z,z,a)),P+=4)}return r&&(console.log(`num probes: ${P}`),console.log(`best distance: ${L.d}`)),L.p}function BL(a,t){return t.max-a.max}class yg{constructor(t,r,h,g){this.p=new Ye(t,r),this.h=h,this.d=function(d,_){let T=!1,I=1/0;for(let z=0;z<_.length;z++){const b=_[z];for(let L=0,P=b.length,C=P-1;L<P;C=L++){const R=b[L],F=b[C];R.y>d.y!=F.y>d.y&&d.x<(F.x-R.x)*(d.y-R.y)/(F.y-R.y)+R.x&&(T=!T),I=Math.min(I,tr(d,R,F))}}return(T?1:-1)*Math.sqrt(I)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const Fx=Number.POSITIVE_INFINITY,NL=Math.sqrt(2);function GT(a,[t,r]){let h=0,g=0;if(r===Fx){t<0&&(t=0);const d=t/NL;switch(a){case"top-right":case"top-left":g=d-7;break;case"bottom-right":case"bottom-left":g=7-d;break;case"bottom":g=7-t;break;case"top":g=t-7}switch(a){case"top-right":case"bottom-right":h=-d;break;case"top-left":case"bottom-left":h=d;break;case"left":h=t;break;case"right":h=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),a){case"top-right":case"top-left":case"top":g=r-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-r}switch(a){case"top-right":case"bottom-right":case"right":h=-t;break;case"top-left":case"bottom-left":case"left":h=t}}return[h,g]}function Bx(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function UL(a,t,r,h,g,d,_,T,I,z,b,L,P,C,R){let F=d.textMaxSize.evaluate(t,{},L);F===void 0?F=_*d.textScaleFactor:F*=d.textScaleFactor;const q=a.layers[0].layout,Z=q.get("icon-offset").evaluate(t,{},L),te=jT(r.horizontal)||r.vertical,ie=P.name==="globe",K=zs,ce=_*d.textScaleFactor/K,he=a.tilePixelRatio*F/K,Se=(Dt=a.overscaling,a.zoom>18&&Dt>2&&(Dt>>=1),Math.max(un/(512*Dt),1)*q.get("symbol-spacing")),$e=q.get("text-padding")*a.tilePixelRatio,Be=q.get("icon-padding")*a.tilePixelRatio,Ve=Ue(q.get("text-max-angle")),Mt=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",Ne=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",ft=q.get("symbol-placement"),Pt=Se/2;var Dt;const Ut=q.get("icon-text-fit").evaluate(t,{},L),ei=q.get("icon-text-fit-padding").evaluate(t,{},L),ri=Ut!=="none";let Yt;a.hasAnyIconTextFit===!1&&ri&&(a.hasAnyIconTextFit=!0),h&&ri&&(a.allowVerticalPlacement&&r.vertical&&(Yt=LT(h,r.vertical,Ut,ei,Z,ce)),te&&(h=LT(h,te,Ut,ei,Z,ce)));const yi=(Fi,pi,Tn)=>{if(pi.x<0||pi.x>=un||pi.y<0||pi.y>=un)return;let ln=null;if(ie){const{x:$i,y:Di,z:Kn}=P.projectTilePoint(pi.x,pi.y,Tn);ln={anchor:new Rd($i,Di,Kn,0,void 0),up:P.upVector(Tn,pi.x,pi.y)}}(function($i,Di,Kn,bn,Cn,fr,Sr,Cr,xr,Vr,Br,Bs,Rs,lr,fs,xs,Qs,bo,ko,wo,ho,Co,No,Aa,Zs,Ol,$u){const su=$i.addToLineVertexArray(Di,bn);let ou,um,Vp,hm,y0,uM,hM,dM=0,pM=0,fM=0,mM=0,p1=-1,f1=-1;const Bh={};let gM=Me("");const dm=Kn?Kn.anchor:Di,m1=xr.layout.get("icon-text-fit").evaluate(ho,{},Zs)!=="none";let g1=0,_1=0;if(xr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[g1,_1]=xr.layout.get("text-offset").evaluate(ho,{},Zs).map(Jl=>Jl*zs):(g1=xr.layout.get("text-radial-offset").evaluate(ho,{},Zs)*zs,_1=Fx),$i.allowVerticalPlacement&&Cn.vertical){const Jl=Cn.vertical;if(fs)uM=Nx(Jl),Cr&&(hM=Nx(Cr));else{const Ql=xr.layout.get("text-rotate").evaluate(ho,{},Zs)+90;Vp=Uy(Vr,dm,Di,Br,Bs,Rs,Jl,lr,Ql,xs),Cr&&(hm=Uy(Vr,dm,Di,Br,Bs,Rs,Cr,bo,Ql))}}if(fr){const Jl=xr.layout.get("icon-rotate").evaluate(ho,{},Zs),Ql=UT(fr,Jl,No,m1,Co.iconScaleFactor),Eg=Cr?UT(Cr,Jl,No,m1,Co.iconScaleFactor):void 0;um=Uy(Vr,dm,Di,Br,Bs,Rs,fr,bo,Jl),dM=4*Ql.length;const _M=$i.iconSizeData;let pm=null;_M.kind==="source"?(pm=[Jo*xr.layout.get("icon-size").evaluate(ho,{},Zs)*Co.iconScaleFactor],pm[0]>Fp&&Wn(`${$i.layerIds[0]}: Value for "icon-size" is >= ${e0}. Reduce your "icon-size".`)):_M.kind==="composite"&&(pm=[Jo*Co.compositeIconSizes[0].evaluate(ho,{},Zs)*Co.iconScaleFactor,Jo*Co.compositeIconSizes[1].evaluate(ho,{},Zs)*Co.iconScaleFactor],(pm[0]>Fp||pm[1]>Fp)&&Wn(`${$i.layerIds[0]}: Value for "icon-size" is >= ${e0}. Reduce your "icon-size".`)),$i.addSymbols($i.icon,Ql,pm,wo,ko,ho,!1,Kn,Di,su.lineStartIndex,su.lineLength,-1,Aa,Zs,Ol,$u),p1=$i.icon.placedSymbolArray.length-1,Eg&&(pM=4*Eg.length,$i.addSymbols($i.icon,Eg,pm,wo,ko,ho,yc.vertical,Kn,Di,su.lineStartIndex,su.lineLength,-1,Aa,Zs,Ol,$u),f1=$i.icon.placedSymbolArray.length-1)}for(const Jl in Cn.horizontal){const Ql=Cn.horizontal[Jl];ou||(gM=Me(Ql.text),fs?y0=Nx(Ql):ou=Uy(Vr,dm,Di,Br,Bs,Rs,Ql,lr,xr.layout.get("text-rotate").evaluate(ho,{},Zs),xs));const Eg=Ql.positionedLines.length===1;if(fM+=HT($i,Kn,Di,Ql,Sr,xr,fs,ho,xs,su,Cn.vertical?yc.horizontal:yc.horizontalOnly,Eg?Object.keys(Cn.horizontal):[Jl],Bh,p1,Co,Aa,Zs,Ol),Eg)break}Cn.vertical&&(mM+=HT($i,Kn,Di,Cn.vertical,Sr,xr,fs,ho,xs,su,yc.vertical,["vertical"],Bh,f1,Co,Aa,Zs,Ol));let Gp=-1;const y1=(Jl,Ql)=>Jl?Math.max(Jl,Ql):Ql;Gp=y1(y0,Gp),Gp=y1(uM,Gp),Gp=y1(hM,Gp);const tR=Gp>-1?1:0;$i.glyphOffsetArray.length>=65535&&Wn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ho.sortKey!==void 0&&$i.addToSortKeyRanges($i.symbolInstances.length,ho.sortKey),$i.symbolInstances.emplaceBack(Di.x,Di.y,dm.x,dm.y,dm.z,Bh.right>=0?Bh.right:-1,Bh.center>=0?Bh.center:-1,Bh.left>=0?Bh.left:-1,Bh.vertical>=0?Bh.vertical:-1,p1,f1,gM,ou!==void 0?ou:$i.collisionBoxArray.length,ou!==void 0?ou+1:$i.collisionBoxArray.length,Vp!==void 0?Vp:$i.collisionBoxArray.length,Vp!==void 0?Vp+1:$i.collisionBoxArray.length,um!==void 0?um:$i.collisionBoxArray.length,um!==void 0?um+1:$i.collisionBoxArray.length,hm||$i.collisionBoxArray.length,hm?hm+1:$i.collisionBoxArray.length,Br,fM,mM,dM,pM,tR,0,g1,_1,Gp,0,m1?1:0)})(a,pi,ln,Fi,r,h,g,Yt,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,$e,Mt,I,0,Be,Ne,Z,t,d,z,b,L,C,R)};if(ft==="line")for(const Fi of zT(t.geometry,0,0,un,un)){const pi=zL(Fi,Se,Ve,r.vertical||te,h,K,he,a.overscaling,un);for(const Tn of pi)te&&VL(a,te.text,Pt,Tn)||yi(Fi,Tn,L)}else if(ft==="line-center"){for(const Fi of t.geometry)if(Fi.length>1){const pi=OL(Fi,Ve,r.vertical||te,h,K,he);pi&&yi(Fi,pi,L)}}else if(t.type==="Polygon")for(const Fi of nm(t.geometry,0)){const pi=FL(Fi,16);yi(Fi[0],new Rd(pi.x,pi.y,0,0,void 0),L)}else if(t.type==="LineString")for(const Fi of t.geometry)yi(Fi,new Rd(Fi[0].x,Fi[0].y,0,0,void 0),L);else if(t.type==="Point")for(const Fi of t.geometry)for(const pi of Fi)yi([pi],new Rd(pi.x,pi.y,0,0,void 0),L)}const e0=255,Fp=e0*Jo;function HT(a,t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q,Z){const te=function(ce,he,Se,$e,Be,Ve,Mt,Ne){const ft=[];if(he.positionedLines.length===0)return ft;const Pt=$e.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,Dt=function(yi){const Fi=yi[0],pi=yi[1],Tn=Fi*pi;return Tn>0?[Fi,-pi]:Tn<0?[-Fi,pi]:Fi===0?[pi,Fi]:[pi,-Fi]}(Se);let Ut=Math.abs(he.top-he.bottom);for(const yi of he.positionedLines)Ut-=yi.lineOffset;const ei=he.positionedLines.length,ri=Ut/ei;let Yt=he.top-Se[1];for(let yi=0;yi<ei;++yi){const Fi=he.positionedLines[yi];Yt=kL(he,ri,Yt,yi);for(const pi of Fi.positionedGlyphs){if(!pi.rect)continue;const Tn=pi.rect||{};let ln=TT+1,$i=!0,Di=1,Kn=0;if(pi.imageName){const wo=Mt[pi.imageName];if(!wo)continue;if(wo.sdf){Wn("SDF images are not supported in formatted text and will be ignored.");continue}$i=!1,Di=wo.pixelRatio,ln=J_/Di}const bn=(Be||Ne)&&pi.vertical,Cn=pi.metrics.advance*pi.scale/2,fr=pi.metrics,Sr=pi.rect;if(Sr===null)continue;Ne&&he.verticalizable&&(Kn=pi.imageName?Cn-pi.metrics.width*pi.scale/2:0);const Cr=Be?[pi.x+Cn,pi.y]:[0,0];let xr=[0,0],Vr=[0,0],Br=!1;Be||(bn?(Vr=[pi.x+Cn+Dt[0],pi.y+Dt[1]-Kn],Br=!0):xr=[pi.x+Cn+Se[0],pi.y+Se[1]-Kn]);const Bs=Sr.w*pi.scale/(Di*(pi.localGlyph?Hu:1)),Rs=Sr.h*pi.scale/(Di*(pi.localGlyph?Hu:1));let lr,fs,xs,Qs;if(bn){const wo=pi.y-Yt,ho=new Ye(-Cn,Cn-wo),Co=-Math.PI/2,No=new Ye(...Vr);lr=new Ye(-Cn+xr[0],xr[1]),lr._rotateAround(Co,ho)._add(No),lr.x+=-wo+Cn,lr.y-=(fr.left-ln)*pi.scale;const Aa=pi.imageName?fr.advance*pi.scale:zs*pi.scale,Zs=String.fromCodePoint(pi.glyph);SL(Zs)?lr.x+=(1-ln)*pi.scale:EL(Zs)?lr.x+=Aa-fr.height*pi.scale+(-ln-1)*pi.scale:lr.x+=pi.imageName||fr.width+2*ln===Sr.w&&fr.height+2*ln===Sr.h?(Aa-Rs)/2:(Aa-(fr.height+2*ln)*pi.scale)/2,fs=new Ye(lr.x,lr.y-Bs),xs=new Ye(lr.x+Rs,lr.y),Qs=new Ye(lr.x+Rs,lr.y-Bs)}else{const wo=(fr.left-ln)*pi.scale-Cn+xr[0],ho=(-fr.top-ln)*pi.scale+xr[1],Co=wo+Bs,No=ho+Rs;lr=new Ye(wo,ho),fs=new Ye(Co,ho),xs=new Ye(wo,No),Qs=new Ye(Co,No)}if(Pt){let wo;wo=Be?new Ye(0,0):Br?new Ye(Dt[0],Dt[1]):new Ye(Se[0],Se[1]),lr._rotateAround(Pt,wo),fs._rotateAround(Pt,wo),xs._rotateAround(Pt,wo),Qs._rotateAround(Pt,wo)}const bo=new Ye(0,0),ko=new Ye(0,0);ft.push({tl:lr,tr:fs,bl:xs,br:Qs,texPrimary:Tn,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:Cr,sectionIndex:pi.sectionIndex,isSDF:$i,pixelOffsetTL:bo,pixelOffsetBR:ko,minFontScaleX:0,minFontScaleY:0})}}return ft}(0,h,I,d,_,T,g,a.allowVerticalPlacement),ie=a.textSizeData;let K=null;ie.kind==="source"?(K=[Jo*d.layout.get("text-size").evaluate(T,{},q)*R.textScaleFactor],K[0]>Fp&&Wn(`${a.layerIds[0]}: Value for "text-size" is >= ${e0}. Reduce your "text-size".`)):ie.kind==="composite"&&(K=[Jo*R.compositeTextSizes[0].evaluate(T,{},q)*R.textScaleFactor,Jo*R.compositeTextSizes[1].evaluate(T,{},q)*R.textScaleFactor],(K[0]>Fp||K[1]>Fp)&&Wn(`${a.layerIds[0]}: Value for "text-size" is >= ${e0}. Reduce your "text-size".`)),a.addSymbols(a.text,te,K,I,_,T,b,t,r,z.lineStartIndex,z.lineLength,C,F,q,Z,!1);for(const ce of L)P[ce]=a.text.placedSymbolArray.length-1;return 4*te.length}function jT(a){for(const t in a)return a[t];return null}function Uy(a,t,r,h,g,d,_,T,I,z){let b=_.top,L=_.bottom,P=_.left,C=_.right;const R=_.collisionPadding;if(R&&(P-=R[0],b-=R[1],C+=R[2],L+=R[3]),I){const F=new Ye(P,b),q=new Ye(C,b),Z=new Ye(P,L),te=new Ye(C,L),ie=Ue(I);let K=new Ye(0,0);z&&(K=new Ye(z[0],z[1])),F._rotateAround(ie,K),q._rotateAround(ie,K),Z._rotateAround(ie,K),te._rotateAround(ie,K),P=Math.min(F.x,q.x,Z.x,te.x),C=Math.max(F.x,q.x,Z.x,te.x),b=Math.min(F.y,q.y,Z.y,te.y),L=Math.max(F.y,q.y,Z.y,te.y)}return a.emplaceBack(t.x,t.y,t.z,r.x,r.y,P,b,C,L,T,h,g,d),a.length-1}function Nx(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const t=a.bottom-a.top;return t>0?Math.max(10,t):null}function VL(a,t,r,h){const g=a.compareText;if(t in g){const d=g[t];for(let _=d.length-1;_>=0;_--)if(h.dist(d[_])<r)return!0}else g[t]=[];return g[t].push(h),!1}function WT(a,t){const r=a.fovAboveCenter,h=a.elevation?a.elevation.getMinElevationBelowMSL()*t:0,g=(a._camera.position[2]*a.worldSize-h)/Math.cos(a._pitch),d=Math.sin(r)*g/Math.sin(Math.max(Math.PI/2-a._pitch-r,.01));let _=Math.sin(a._pitch)*d+g;const T=g*(1/a._horizonShift);return a.elevation&&a.elevation.exaggeration()!==0||(_*=1+Math.max(a.zoom-17,0)),Math.min(1.01*_,T)}function t0(a,t){if(!t.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:t};const r=Math.pow(2,-a.z),h=a.x*r,g=(a.x+1)*r,d=a.y*r,_=(a.y+1)*r,T=Oe(h),I=Oe(g),z=Ge(d),b=Ge(_),L=t.project(T,z),P=t.project(I,z),C=t.project(I,b),R=t.project(T,b);let F=Math.min(L.x,P.x,C.x,R.x),q=Math.min(L.y,P.y,C.y,R.y),Z=Math.max(L.x,P.x,C.x,R.x),te=Math.max(L.y,P.y,C.y,R.y);const ie=r/16;function K(he,Se,$e,Be,Ve,Mt){const Ne=($e+Ve)/2,ft=(Be+Mt)/2,Pt=t.project(Oe(Ne),Ge(ft)),Dt=Math.max(0,F-Pt.x,q-Pt.y,Pt.x-Z,Pt.y-te);F=Math.min(F,Pt.x),Z=Math.max(Z,Pt.x),q=Math.min(q,Pt.y),te=Math.max(te,Pt.y),Dt>ie&&(K(he,Pt,$e,Be,Ne,ft),K(Pt,Se,Ne,ft,Ve,Mt))}K(L,P,h,d,g,d),K(P,C,g,d,g,_),K(C,R,g,_,h,_),K(R,L,h,_,h,d),F-=ie,q-=ie,Z+=ie,te+=ie;const ce=1/Math.max(Z-F,te-q);return{scale:ce,x:F*ce,y:q*ce,x2:Z*ce,y2:te*ce,projection:t}}function qT(a,{x:t,y:r},h=0){return new Ye(((t-h)*a.scale-a.x)*un,(r*a.scale-a.y)*un)}const GL=ot.mat4.identity(new Float32Array(16));class Bp{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new j(0,0)}projectTilePoint(t,r,h){return{x:t,y:r,z:0}}locationPoint(t,r,h=!0){return t._coordinatePoint(t.locationCoordinate(r),h)}pixelsPerMeter(t,r){return ge(1,t)*r}pixelSpaceConversion(t,r,h){return 1}farthestPixelDistance(t){return WT(t,t.pixelsPerMeter)}pointCoordinate(t,r,h,g){const d=t.horizonLineFromTop(!1),_=new Ye(r,Math.max(d,h));return t.rayIntersectionCoordinate(t.pointRayIntersection(_,g))}pointCoordinate3D(t,r,h){const g=new Ye(r,h);if(t.elevation)return t.elevation.pointCoordinate(g);{const d=this.pointCoordinate(t,g.x,g.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(t,r){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,r.x,r.y);const h=t.horizonLineFromTop();return r.y<h}createInversionMatrix(t,r){return GL}createTileMatrix(t,r,h){let g,d,_;const T=h.canonical,I=ot.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const z=t0(T,this);g=1,d=z.x+h.wrap*z.scale,_=z.y,ot.mat4.scale(I,I,[g/z.scale,g/z.scale,t.pixelsPerMeter/r])}else g=r/t.zoomScale(T.z),d=(T.x+Math.pow(2,T.z)*h.wrap)*g,_=T.y*g;return ot.mat4.translate(I,I,[d,_,0]),ot.mat4.scale(I,I,[g/un,g/un,1]),I}upVector(t,r,h){return[0,0,1]}upVectorScale(t,r,h){return{metersToTile:1}}}class HL extends Bp{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,h]=this.parallels=t.parallels||[29.5,45.5],g=Math.sin(Ue(r));this.n=(g+Math.sin(Ue(h)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:h,c:g,r0:d}=this,_=Ue(t-this.center[0]),T=Ue(r),I=Math.sqrt(g-2*h*Math.sin(T))/h;return{x:I*Math.sin(_*h),y:I*Math.cos(_*h)-d,z:0}}unproject(t,r){const{n:h,c:g,r0:d}=this,_=d+r;let T=Math.atan2(t,Math.abs(_))*Math.sign(_);_*h<0&&(T-=Math.PI*Math.sign(t)*Math.sign(_));const I=Ue(this.center[0])*h;T=xi(T,-Math.PI-I,Math.PI-I);const z=It(We(T/h)+this.center[0],-180,180),b=Math.asin(It((g-(t*t+_*_)*h*h)/(2*h),-1,1)),L=It(We(b),-Qe,Qe);return new j(z,L)}}const i0=1.340264,n0=-.081106,r0=893e-6,s0=.003796,Vy=Math.sqrt(3)/2;class jL extends Bp{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const h=Math.asin(Vy*Math.sin(r)),g=h*h,d=g*g*g;return{x:.5*(t*Math.cos(h)/(Vy*(i0+3*n0*g+d*(7*r0+9*s0*g)))/Math.PI+.5),y:1-.5*(h*(i0+n0*g+d*(r0+s0*g))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let h=r=(2*(1-r)-1)*Math.PI,g=h*h,d=g*g*g;for(let b,L,P,C=0;C<12&&(L=h*(i0+n0*g+d*(r0+s0*g))-r,P=i0+3*n0*g+d*(7*r0+9*s0*g),b=L/P,h=It(h-b,-Math.PI/3,Math.PI/3),g=h*h,d=g*g*g,!(Math.abs(b)<1e-12));++C);const _=Vy*t*(i0+3*n0*g+d*(7*r0+9*s0*g))/Math.cos(h),T=Math.asin(Math.sin(h)/Vy),I=It(180*_/Math.PI,-180,180),z=It(180*T/Math.PI,-Qe,Qe);return new j(I,z)}}class WL extends Bp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const h=360*(t-.5),g=It(360*(.5-r),-Qe,Qe);return new j(h,g)}}const vg=Math.PI/2;function Gy(a){return Math.tan((vg+a)/2)}class qL extends Bp{constructor(t){super(t),this.center=t.center||[0,30];const[r,h]=this.parallels=t.parallels||[30,30];let g=Ue(r),d=Ue(h);this.southernCenter=g+d<0,this.southernCenter&&(g=-g,d=-d);const _=Math.cos(g),T=Gy(g);this.n=g===d?Math.sin(g):Math.log(_/Math.cos(d))/Math.log(Gy(d)/T),this.f=_*Math.pow(Gy(g),this.n)/this.n}project(t,r){r=Ue(r),this.southernCenter&&(r=-r),t=Ue(t-this.center[0]);const h=1e-6,{n:g,f:d}=this;d>0?r<-vg+h&&(r=-vg+h):r>vg-h&&(r=vg-h);const _=d/Math.pow(Gy(r),g);let T=_*Math.sin(g*t),I=d-_*Math.cos(g*t);return T=.5*(T/Math.PI+.5),I=.5*(I/Math.PI+.5),{x:T,y:this.southernCenter?I:1-I,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:h,f:g}=this,d=g-r,_=Math.sign(d),T=Math.sign(h)*Math.sqrt(t*t+d*d);let I=Math.atan2(t,Math.abs(d))*_;d*h<0&&(I-=Math.PI*Math.sign(t)*_);const z=It(We(I/h)+this.center[0],-180,180),b=It(We(2*Math.atan(Math.pow(g/T,1/h))-vg),-Qe,Qe);return new j(z,this.southernCenter?-b:b)}}class $T extends Bp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:ue(t),y:_e(r),z:0}}unproject(t,r){const h=Oe(t),g=Ge(r);return new j(h,g)}}const ZT=Ue(Qe);class $L extends Bp{project(t,r){const h=(r=Ue(r))*r,g=h*h;return{x:.5*((t=Ue(t))*(.8707-.131979*h+g*(g*(.003971*h-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+h*(.015085+g*(.028874*h-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let h=r=(2*(1-r)-1)*Math.PI,g=25,d=0,_=h*h;do{_=h*h;const z=_*_;d=(h*(1.007226+_*(.015085+z*(.028874*_-.044475-.005916*z)))-r)/(1.007226+_*(.045255+z*(.259866*_-.311325-.005916*11*z))),h=It(h-d,-ZT,ZT)}while(Math.abs(d)>1e-6&&--g>0);_=h*h;const T=It(We(t/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),I=We(h);return new j(T,I)}}const XT=Ue(Qe);class ZL extends Bp{project(t,r){r=Ue(r),t=Ue(t);const h=Math.cos(r),g=2/Math.PI,d=Math.acos(h*Math.cos(t/2)),_=Math.sin(d)/d,T=.5*(t*g+2*h*Math.sin(t/2)/_)||0,I=.5*(r+Math.sin(r)/_)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(t,r){let h=t=(2*t-.5)*Math.PI,g=r=(2*(1-r)-1)*Math.PI,d=25;const _=1e-6;let T=0,I=0;do{const z=Math.cos(g),b=Math.sin(g),L=2*b*z,P=b*b,C=z*z,R=Math.cos(h/2),F=Math.sin(h/2),q=2*R*F,Z=F*F,te=1-C*R*R,ie=te?1/te:0,K=te?Math.acos(z*R)*Math.sqrt(1/te):0,ce=.5*(2*K*z*F+2*h/Math.PI)-t,he=.5*(K*b+g)-r,Se=.5*ie*(C*Z+K*z*R*P)+1/Math.PI,$e=ie*(q*L/4-K*b*F),Be=.125*ie*(L*F-K*b*C*q),Ve=.5*ie*(P*R+K*Z*z)+.5,Mt=$e*Be-Ve*Se;T=(he*$e-ce*Ve)/Mt,I=(ce*Be-he*Se)/Mt,h=It(h-T,-Math.PI,Math.PI),g=It(g-I,-XT,XT)}while((Math.abs(T)>_||Math.abs(I)>_)&&--d>0);return new j(We(h),We(g))}}class YT extends Bp{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ue(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:h,cosPhi:g}=this;return{x:Ue(t)*g*h+.5,y:-Math.sin(Ue(r))/g*h+.5,z:0}}unproject(t,r){const{scale:h,cosPhi:g}=this,d=-(r-.5)/h,_=It(We((t-.5)/h)/g,-180,180),T=Math.asin(It(d*g,-1,1)),I=It(We(T),-Qe,Qe);return new j(_,I)}}class XL extends $T{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,h){const g=Zf(t,r,h),d=Yf(Kl(h));return ot.vec3.transformMat4(g,g,d),{x:g[0],y:g[1],z:g[2]}}locationPoint(t,r){const h=k(r.lat,r.lng),g=ot.vec3.normalize([],h),d=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude,_=ge(1,0)*un*d;ot.vec3.scaleAndAdd(h,h,g,_);const T=ot.mat4.identity(new Float64Array(16));return ot.mat4.multiply(T,t.pixelMatrix,t.globeMatrix),ot.vec3.transformMat4(h,h,T),new Ye(h[0],h[1])}pixelsPerMeter(t,r){return ge(1,0)*r}pixelSpaceConversion(t,r,h){const g=ge(1,t)*r,d=Pe(ge(1,45)*r,g,h);return this.pixelsPerMeter(t,r)/d}createTileMatrix(t,r,h){const g=og(Kl(h.canonical));return ot.mat4.multiply(new Float64Array(16),t.globeMatrix,g)}createInversionMatrix(t,r){const{center:h}=t,g=Yf(Kl(r));return ot.mat4.rotateY(g,g,Ue(h.lng)),ot.mat4.rotateX(g,g,Ue(h.lat)),ot.mat4.scale(g,g,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(t,r,h,g){return tu(t,r,h,!0)||new Ot(0,0)}pointCoordinate3D(t,r,h){const g=this.pointCoordinate(t,r,h,0);return[g.x,g.y,g.z]}isPointAboveHorizon(t,r){return!tu(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=function(g,d){const _=g.cameraToCenterDistance,T=g._centerAltitude*d,I=g._camera,z=g._camera.forward(),b=ot.vec3.add([],ot.vec3.scale([],z,-_),[0,0,T]),L=g.worldSize/(2*Math.PI),P=[0,0,-L],C=g.width/g.height,R=Math.tan(g.fovAboveCenter),F=ot.vec3.scale([],I.up(),R),q=ot.vec3.scale([],I.right(),R*C),Z=ot.vec3.normalize([],ot.vec3.add([],ot.vec3.add([],z,F),q)),te=[];let ie;if(new Ma(b,Z).closestPointOnSphere(P,L,te)){const K=ot.vec3.add([],te,P),ce=ot.vec3.sub([],K,b);ie=Math.cos(g.fovAboveCenter)*ot.vec3.length(ce)}else{const K=ot.vec3.sub([],b,P),ce=ot.vec3.sub([],P,b);ot.vec3.normalize(ce,ce);const he=ot.vec3.length(K)-L;ie=Math.sqrt(he*(he+2*L));const Se=Math.acos(ie/(L+he))-Math.acos(ot.vec3.dot(z,ce));ie*=Math.cos(Se)}return 1.01*ie}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),h=iu(t.zoom);if(h>0){const g=WT(t,ge(1,t.center.lat)*t.worldSize),d=t.worldSize/(2*Math.PI),_=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Pe(r,g+d*(1-Math.cos(_)),Math.pow(h,10))}return r}upVector(t,r,h){return Zf(r,h,t,1)}upVectorScale(t){return{metersToTile:eu(Xf(Kl(t)))}}}function KT(a){const t=a.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(a.name){case"mercator":return new $T(a);case"equirectangular":return new WL(a);case"naturalEarth":return new $L(a);case"equalEarth":return new jL(a);case"winkelTripel":return new ZL(a);case"albers":return r?new YT(a):new HL(a);case"lambertConformalConic":return r?new YT(a):new qL(a);case"globe":return new XL(a)}throw new Error(`Invalid projection name: ${a.name}`)}const YL=ae.VectorTileFeature.types,KL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hy(a,t,r,h,g,d,_,T,I,z,b,L,P){const C=T?Math.min(Fp,Math.round(T[0])):0,R=T?Math.min(Fp,Math.round(T[1])):0;a.emplaceBack(t,r,Math.round(32*h),Math.round(32*g),d,_,(C<<1)+(I?1:0),R,16*z,16*b,256*L,256*P)}function jy(a,t,r){a.emplaceBack(t,r)}function Wy(a,t,r,h,g,d,_){a.emplaceBack(t,r,h,g,d,_)}function qy(a,t,r,h,g){a.emplaceBack(t,r,h,g),a.emplaceBack(t,r,h,g),a.emplaceBack(t,r,h,g),a.emplaceBack(t,r,h,g)}function JL(a){for(const t of a.sections)if(M_(t.text))return!0;return!1}class Ux{constructor(t){this.layoutVertexArray=new Ru,this.indexArray=new qs,this.programConfigurations=t,this.segments=new Js,this.dynamicLayoutVertexArray=new Ta,this.opacityVertexArray=new Mh,this.placedSymbolArray=new xp,this.iconTransitioningVertexArray=new ll,this.globeExtVertexArray=new gp,this.zOffsetVertexArray=new za}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,r,h,g,d){this.isEmpty()||(h&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$s.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ss.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,KL,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,Bo.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,As.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Id.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Sn(Ux,"SymbolBuffers");class Vx{constructor(t,r,h){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new h,this.segments=new Js,this.collisionVertexArray=new Du,this.collisionVertexArrayExt=new Ta}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,zh.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,_c.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Sn(Vx,"CollisionBuffers");class $y{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ot.mat4.identity([]),this.placementViewportMatrix=ot.mat4.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=pa(this.zoom,r["text-size"]),this.iconSizeData=pa(this.zoom,r["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),d=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(_=>yc[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=h.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Ux(new Yl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new Ux(new Yl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new Fu,this.lineVertexArray=new $a,this.symbolInstances=new $l}calculateGlyphDependencies(t,r,h,g,d){for(const _ of t){const T=_.codePointAt(0);if(T===void 0)break;if(r[T]=!0,g&&d&&T<=65535){const I=Y_[_];I&&(r[I.charCodeAt(0)]=!0)}}}updateFootprints(t,r){}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const h=r.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!vi(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}populate(t,r,h,g){const d=this.layers[0],_=d.layout,T=this.projection.name==="globe",I=_.get("text-font"),z=_.get("text-field"),b=_.get("icon-image"),L=(z.value.kind!=="constant"||z.value.value instanceof io&&!z.value.value.isEmpty()||z.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),P=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,C=_.get("symbol-sort-key");if(this.features=[],!L&&!P)return;const R=r.iconDependencies,F=r.glyphDependencies,q=r.availableImages,Z=new eo(this.zoom);for(const{feature:te,id:ie,index:K,sourceLayerIndex:ce}of t){const he=d._featureFilter.needGeometry,Se=wi(te,he);if(!d._featureFilter.filter(Z,Se,h))continue;if(he||(Se.geometry=qt(te,h,g)),T&&te.type!==1&&h.z<=5){const Mt=Se.geometry,Ne=.98078528056,ft=(Pt,Dt)=>{const Ut=Zf(Pt.x,Pt.y,h,1),ei=Zf(Dt.x,Dt.y,h,1);return ot.vec3.dot(Ut,ei)<Ne};for(let Pt=0;Pt<Mt.length;Pt++)Mt[Pt]=di(Mt[Pt],ft)}let $e,Be;if(L){const Mt=d.getValueAndResolveTokens("text-field",Se,h,q),Ne=io.factory(Mt);JL(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||Bf()==="unavailable"||this.hasRTLText&&ua.isParsed())&&($e=ML(Ne,d,Se))}if(P){const Mt=d.getValueAndResolveTokens("icon-image",Se,h,q);Be=Mt instanceof Ys?Mt:Ys.fromString(Mt)}if(!$e&&!Be)continue;const Ve=this.sortFeaturesByKey?C.evaluate(Se,{},h):void 0;if(this.features.push({id:ie,text:$e,icon:Be,index:K,sourceLayerIndex:ce,geometry:Se.geometry,properties:te.properties,type:YL[te.type],sortKey:Ve}),Be&&(R[Be.namePrimary]=!0,Be.nameSecondary&&(R[Be.nameSecondary]=!0)),$e){const Mt=I.evaluate(Se,{},h).join(","),Ne=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(yc.vertical)>=0;for(const ft of $e.sections)if(ft.image)R[ft.image.namePrimary]=!0;else{const Pt=Of($e.toString()),Dt=ft.fontStack||Mt,Ut=F[Dt]=F[Dt]||{};this.calculateGlyphDependencies(ft.text,Ut,Ne,this.allowVerticalPlacement,Pt)}}}_.get("symbol-placement")==="line"&&(this.features=function(te){const ie={},K={},ce=[];let he=0;function Se(Mt){ce.push(te[Mt]),he++}function $e(Mt,Ne,ft){const Pt=K[Mt];return delete K[Mt],K[Ne]=Pt,ce[Pt].geometry[0].pop(),ce[Pt].geometry[0]=ce[Pt].geometry[0].concat(ft[0]),Pt}function Be(Mt,Ne,ft){const Pt=ie[Ne];return delete ie[Ne],ie[Mt]=Pt,ce[Pt].geometry[0].shift(),ce[Pt].geometry[0]=ft[0].concat(ce[Pt].geometry[0]),Pt}function Ve(Mt,Ne,ft){const Pt=ft?Ne[0][Ne[0].length-1]:Ne[0][0];return`${Mt}:${Pt.x}:${Pt.y}`}for(let Mt=0;Mt<te.length;Mt++){const Ne=te[Mt],ft=Ne.geometry,Pt=Ne.text?Ne.text.toString():null;if(!Pt){Se(Mt);continue}const Dt=Ve(Pt,ft),Ut=Ve(Pt,ft,!0);if(Dt in K&&Ut in ie&&K[Dt]!==ie[Ut]){const ei=Be(Dt,Ut,ft),ri=$e(Dt,Ut,ce[ei].geometry);delete ie[Dt],delete K[Ut],K[Ve(Pt,ce[ri].geometry,!0)]=ri,ce[ei].geometry=null}else Dt in K?$e(Dt,Ut,ft):Ut in ie?Be(Dt,Ut,ft):(Se(Mt),ie[Dt]=he-1,K[Ut]=he-1)}return ce.filter(Mt=>Mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((te,ie)=>te.sortKey-ie.sortKey)}update(t,r,h,g,d){const _=Object.keys(t).length!==0;if(_&&!this.stateDependentLayers.length)return;const T=_?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,r,T,h,g,d),this.icon.programConfigurations.updatePaintArrays(t,r,T,h,g,d)}updateZOffset(){const t=(d,_,T)=>{h+=_,h>d.length&&d.resize(h);for(let I=-_;I<0;I++)d.emplace(I+h,T)},r=(d,_,T)=>{g+=_,g>d.length&&d.resize(g);for(let I=-_;I<0;I++)d.emplace(I+g,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,g=0;for(let d=0;d<this.symbolInstances.length;d++){const _=this.symbolInstances.get(d),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:I,numIconVertices:z}=_,b=_.zOffset,L=z>0;if((T>0||I>0)&&(t(this.text.zOffsetVertexArray,T,b),t(this.text.zOffsetVertexArray,I,b)),L){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:C}=_;P>=0&&r(this.icon.zOffsetVertexArray,z,b),C>=0&&r(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,b)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=KT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const h=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:g,y:d}of r)this.lineVertexArray.emplaceBack(g,d);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(t,r,h,g,d,_,T,I,z,b,L,P,C,R,F,q){const Z=t.indexArray,te=t.layoutVertexArray,ie=t.globeExtVertexArray,K=t.segments.prepareSegment(4*r.length,te,Z,this.canOverlap?_.sortKey:void 0),ce=this.glyphOffsetArray.length,he=K.vertexLength,Se=this.allowVerticalPlacement&&T===yc.vertical?Math.PI/2:0,$e=_.text&&_.text.sections;for(let Ve=0;Ve<r.length;Ve++){const{tl:Mt,tr:Ne,bl:ft,br:Pt,texPrimary:Dt,texSecondary:Ut,pixelOffsetTL:ei,pixelOffsetBR:ri,minFontScaleX:Yt,minFontScaleY:yi,glyphOffset:Fi,isSDF:pi,sectionIndex:Tn}=r[Ve],ln=K.vertexLength,$i=Fi[1];if(Hy(te,z.x,z.y,Mt.x,$i+Mt.y,Dt.x,Dt.y,h,pi,ei.x,ei.y,Yt,yi),Hy(te,z.x,z.y,Ne.x,$i+Ne.y,Dt.x+Dt.w,Dt.y,h,pi,ri.x,ei.y,Yt,yi),Hy(te,z.x,z.y,ft.x,$i+ft.y,Dt.x,Dt.y+Dt.h,h,pi,ei.x,ri.y,Yt,yi),Hy(te,z.x,z.y,Pt.x,$i+Pt.y,Dt.x+Dt.w,Dt.y+Dt.h,h,pi,ri.x,ri.y,Yt,yi),I){const{x:Di,y:Kn,z:bn}=I.anchor,[Cn,fr,Sr]=I.up;Wy(ie,Di,Kn,bn,Cn,fr,Sr),Wy(ie,Di,Kn,bn,Cn,fr,Sr),Wy(ie,Di,Kn,bn,Cn,fr,Sr),Wy(ie,Di,Kn,bn,Cn,fr,Sr),qy(t.dynamicLayoutVertexArray,Di,Kn,bn,Se)}else qy(t.dynamicLayoutVertexArray,z.x,z.y,z.z,Se);if(q){const Di=Ut||Dt;jy(t.iconTransitioningVertexArray,Di.x,Di.y),jy(t.iconTransitioningVertexArray,Di.x+Di.w,Di.y),jy(t.iconTransitioningVertexArray,Di.x,Di.y+Di.h),jy(t.iconTransitioningVertexArray,Di.x+Di.w,Di.y+Di.h)}Z.emplaceBack(ln,ln+1,ln+2),Z.emplaceBack(ln+1,ln+2,ln+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Fi[0]),Ve!==r.length-1&&Tn===r[Ve+1].sectionIndex||t.programConfigurations.populatePaintArrays(te.length,_,_.index,{},C,R,F,$e&&$e[Tn])}const Be=I?I.anchor:z;t.placedSymbolArray.emplaceBack(Be.x,Be.y,Be.z,z.x,z.y,ce,this.glyphOffsetArray.length-ce,he,b,L,z.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],T,0,!1,0,P,0)}_commitLayoutVertex(t,r,h,g,d,_,T){t.emplaceBack(r,h,g,d,_,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(t,r,h,g,d,_,T){const I=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),z=I.vertexLength,b=T.tileAnchorX,L=T.tileAnchorY;for(let C=0;C<4;C++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,r,t.padding,T.zOffset),this._commitLayoutVertex(h.layoutVertexArray,g,d,_,b,L,new Ye(t.x1,t.y1)),this._commitLayoutVertex(h.layoutVertexArray,g,d,_,b,L,new Ye(t.x2,t.y1)),this._commitLayoutVertex(h.layoutVertexArray,g,d,_,b,L,new Ye(t.x2,t.y2)),this._commitLayoutVertex(h.layoutVertexArray,g,d,_,b,L,new Ye(t.x1,t.y2)),I.vertexLength+=4;const P=h.indexArray;P.emplaceBack(z,z+1),P.emplaceBack(z+1,z+2),P.emplaceBack(z+2,z+3),P.emplaceBack(z+3,z),I.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,h,g,d,_){for(let T=g;T<d;T++){const I=h.get(T),z=this.getSymbolInstanceTextSize(t,_,r,T);this._addCollisionDebugVertices(I,z,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(t,r,h,g,d,_){for(let T=g;T<d;T++){const I=h.get(T),z=this.getSymbolInstanceIconSize(t,r,_.placedIconSymbolIndex);this._addCollisionDebugVertices(I,z,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,_)}}generateCollisionDebugBuffers(t,r,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vx(Po,kh.members,ll),this.iconCollisionBox=new Vx(Po,kh.members,ll);const g=Fa(this.iconSizeData,t),d=Fa(this.textSizeData,t,h);for(let _=0;_<this.symbolInstances.length;_++){const T=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(d,t,r,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(d,t,r,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(g,t,r,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(g,t,r,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(t,r,h,g){const d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:g),_=hl(this.textSizeData,t,d)/zs;return this.tilePixelRatio*_}getSymbolInstanceIconSize(t,r,h){const g=this.icon.placedSymbolArray.get(h),d=hl(this.iconSizeData,t,g);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(t,r,h,g){t.emplaceBack(r,-h,-h,g),t.emplaceBack(r,h,-h,g),t.emplaceBack(r,h,h,g),t.emplaceBack(r,-h,h,g)}_updateTextDebugCollisionBoxes(t,r,h,g,d,_,T){for(let I=g;I<d;I++){const z=h.get(I),b=this.getSymbolInstanceTextSize(t,_,r,I);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,z.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(t,r,h,g,d,_,T){for(let I=g;I<d;I++){const z=h.get(I),b=this.getSymbolInstanceIconSize(t,r,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,z.padding,_.zOffset)}}updateCollisionDebugBuffers(t,r,h,g){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Fa(this.iconSizeData,t,g),_=Fa(this.textSizeData,t,h);for(let T=0;T<this.symbolInstances.length;T++){const I=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(_,t,r,I.textBoxStartIndex,I.textBoxEndIndex,I,h),this._updateTextDebugCollisionBoxes(_,t,r,I.verticalTextBoxStartIndex,I.verticalTextBoxEndIndex,I,h),this._updateIconDebugCollisionBoxes(d,t,r,I.iconBoxStartIndex,I.iconBoxEndIndex,I,g),this._updateIconDebugCollisionBoxes(d,t,r,I.verticalIconBoxStartIndex,I.verticalIconBoxEndIndex,I,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,h,g,d,_,T,I,z){const b={};if(r<h){const{x1:L,y1:P,x2:C,y2:R,padding:F,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:ie,tileAnchorY:K,featureIndex:ce}=t.get(r);b.textBox={x1:L,y1:P,x2:C,y2:R,padding:F,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:ie,tileAnchorY:K},b.textFeatureIndex=ce}if(g<d){const{x1:L,y1:P,x2:C,y2:R,padding:F,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:ie,tileAnchorY:K,featureIndex:ce}=t.get(g);b.verticalTextBox={x1:L,y1:P,x2:C,y2:R,padding:F,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:ie,tileAnchorY:K},b.verticalTextFeatureIndex=ce}if(_<T){const{x1:L,y1:P,x2:C,y2:R,padding:F,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:ie,tileAnchorY:K,featureIndex:ce}=t.get(_);b.iconBox={x1:L,y1:P,x2:C,y2:R,padding:F,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:ie,tileAnchorY:K},b.iconFeatureIndex=ce}if(I<z){const{x1:L,y1:P,x2:C,y2:R,padding:F,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:ie,tileAnchorY:K,featureIndex:ce}=t.get(I);b.verticalIconBox={x1:L,y1:P,x2:C,y2:R,padding:F,projectedAnchorX:q,projectedAnchorY:Z,projectedAnchorZ:te,tileAnchorX:ie,tileAnchorY:K},b.verticalIconFeatureIndex=ce}return b}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const h=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,r){const h=t.placedSymbolArray.get(r),g=h.vertexStartIndex+4*h.numGlyphs;for(let d=h.vertexStartIndex;d<g;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),h=Math.cos(t),g=[],d=[],_=[];for(let T=0;T<this.symbolInstances.length;++T){_.push(T);const I=this.symbolInstances.get(T);g.push(0|Math.round(r*I.tileAnchorX+h*I.tileAnchorY)),d.push(I.featureIndex)}return _.sort((T,I)=>g[T]-g[I]||d[I]-d[T]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,r){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===r?h.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const h=this.symbolInstances.get(r);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:z}=h;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),d>=0&&d!==g&&this.addIndicesForPlacedSymbol(this.text,d),_>=0&&_!==d&&_!==g&&this.addIndicesForPlacedSymbol(this.text,_),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),z>=0&&this.addIndicesForPlacedSymbol(this.icon,z)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let JT,QT,Gx;Sn($y,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),$y.addDynamicAttributes=qy;class e2{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Zi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Sn(e2,"FormatSectionOverride",{omit:["defaultValue"]});const Hx=()=>Gx||(Gx={layout:JT||(JT=new Ts({"symbol-placement":new qi(Qt.layout_symbol["symbol-placement"]),"symbol-spacing":new qi(Qt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qi(Qt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(Qt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qi(Qt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new qi(Qt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new qi(Qt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new qi(Qt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new qi(Qt.layout_symbol["icon-ignore-placement"]),"icon-optional":new qi(Qt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qi(Qt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(Qt.layout_symbol["icon-size"]),"icon-size-scale-range":new qi(Qt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new yn(Qt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yn(Qt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(Qt.layout_symbol["icon-image"]),"icon-rotate":new yn(Qt.layout_symbol["icon-rotate"]),"icon-padding":new qi(Qt.layout_symbol["icon-padding"]),"icon-keep-upright":new qi(Qt.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(Qt.layout_symbol["icon-offset"]),"icon-anchor":new yn(Qt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qi(Qt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qi(Qt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qi(Qt.layout_symbol["text-rotation-alignment"]),"text-field":new yn(Qt.layout_symbol["text-field"]),"text-font":new yn(Qt.layout_symbol["text-font"]),"text-size":new yn(Qt.layout_symbol["text-size"]),"text-size-scale-range":new qi(Qt.layout_symbol["text-size-scale-range"]),"text-max-width":new yn(Qt.layout_symbol["text-max-width"]),"text-line-height":new yn(Qt.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(Qt.layout_symbol["text-letter-spacing"]),"text-justify":new yn(Qt.layout_symbol["text-justify"]),"text-radial-offset":new yn(Qt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qi(Qt.layout_symbol["text-variable-anchor"]),"text-anchor":new yn(Qt.layout_symbol["text-anchor"]),"text-max-angle":new qi(Qt.layout_symbol["text-max-angle"]),"text-writing-mode":new qi(Qt.layout_symbol["text-writing-mode"]),"text-rotate":new yn(Qt.layout_symbol["text-rotate"]),"text-padding":new qi(Qt.layout_symbol["text-padding"]),"text-keep-upright":new qi(Qt.layout_symbol["text-keep-upright"]),"text-transform":new yn(Qt.layout_symbol["text-transform"]),"text-offset":new yn(Qt.layout_symbol["text-offset"]),"text-allow-overlap":new qi(Qt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new qi(Qt.layout_symbol["text-ignore-placement"]),"text-optional":new qi(Qt.layout_symbol["text-optional"]),visibility:new qi(Qt.layout_symbol.visibility)})),paint:QT||(QT=new Ts({"icon-opacity":new yn(Qt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new yn(Qt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new yn(Qt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new yn(Qt.paint_symbol["text-emissive-strength"]),"icon-color":new yn(Qt.paint_symbol["icon-color"]),"icon-halo-color":new yn(Qt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(Qt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(Qt.paint_symbol["icon-halo-blur"]),"icon-translate":new qi(Qt.paint_symbol["icon-translate"]),"icon-translate-anchor":new qi(Qt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new yn(Qt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new yn(Qt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new yn(Qt.paint_symbol["text-occlusion-opacity"]),"text-color":new yn(Qt.paint_symbol["text-color"],{runtimeType:Ln,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new yn(Qt.paint_symbol["text-halo-color"]),"text-halo-width":new yn(Qt.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(Qt.paint_symbol["text-halo-blur"]),"text-translate":new qi(Qt.paint_symbol["text-translate"]),"text-translate-anchor":new qi(Qt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new qi(Qt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new qi(Qt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new qi(Qt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new qi(Qt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new yn(Qt.paint_symbol["symbol-z-offset"])}))},Gx);class Zy extends Ko{constructor(t,r,h,g){super(t,Hx(),r,h,g),this._colorAdjustmentMatrix=ot.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,r){super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const d of h)g.indexOf(d)<0&&g.push(d);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,r,h,g){return this._saturation===t&&this._contrast===r&&this._brightnessMin===h&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(d,_,T,I){d=re(d),_=ye(_);const z=ot.mat4.create(),b=d/3,L=1-2*b,P=[L,b,b,0,b,L,b,0,b,b,L,0,0,0,0,1],C=.5-.5*_,R=I-T;return ot.mat4.multiply(z,[R,0,0,0,0,R,0,0,0,0,R,0,T,T,T,1],[_,0,0,0,0,_,0,0,0,0,_,0,C,C,C,1]),ot.mat4.multiply(z,z,P),z}(t,r,h,g),this._saturation=t,this._contrast=r,this._brightnessMin=h,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,r,h,g){const d=this.layout.get(t).evaluate(r,{},h,g),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||dh(_.value)||!d?d:function(T,I){return I.replace(/{([^{}]+)}/g,(z,b)=>b in T?String(T[b]):"")}(r.properties,d)}createBucket(t){return new $y(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Hx().paint.overridableProperties){if(!Zy.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),h=new e2(r),g=new sp(h,r.property.specification,this.scope,this.options);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new op("source",g):new ol("composite",g,r.value.zoomStops,r.value._interpolationType),this.paint._values[t]=new Hc(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,h){return!(!this.layout||r.isDataDriven()||h.isDataDriven())&&Zy.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const h=t.get("text-field"),g=Hx().paint.properties[r];let d=!1;const _=T=>{for(const I of T)if(g.overrides&&g.overrides.hasOverride(I))return void(d=!0)};if(h.value.kind==="constant"&&h.value.value instanceof io)_(h.value.value.sections);else if(h.value.kind==="source"){const T=z=>{d||(z instanceof ea&&hs(z.value)===gr?_(z.value.sections):z instanceof nc?_(z.sections):z.eachChild(T))},I=h.value;I._styleExpression&&T(I._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,r,h){return{config:new fc(this,{zoom:r,lut:h}),overrideFog:!1}}}let t2,i2,n2,r2;var jx=Qr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Wx(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function qx(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class $x{constructor(t,r,h,g){this.context=t,this.format=h,this.useMipmap=g&&g.useMipmap,this.texture=t.gl.createTexture(),this.update(r,{premultiply:g&&g.premultiply})}update(t,r){const h=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,g=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:d}=this,{gl:_}=d,{x:T,y:I}=r&&r.position?r.position:{x:0,y:0},z=Math.max(T+h,this.size?this.size[0]:0),b=Math.max(I+g,this.size?this.size[1]:0);!this.size||this.size[0]===z&&this.size[1]===b||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!r||r.premultiply!==!1));const L=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&z>0&&b>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(z,b)))+1:1;_.texStorage2D(_.TEXTURE_2D,P,this.format,z,b),this.size=[z,b]}if(this.size)if(L)_.texSubImage2D(_.TEXTURE_2D,0,T,I,Wx(this.format),qx(this.format),t);else{const P=t.data;P&&_.texSubImage2D(_.TEXTURE_2D,0,T,I,h,g,Wx(this.format),qx(this.format),P)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(t,r,h=!1){const{context:g}=this,{gl:d}=g;d.bindTexture(d.TEXTURE_2D,this.texture),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!h?t===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),r!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(t,r,h,g){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),r!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,r),this.magFilter=r),t!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?t===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),h!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,h),this.wrapS=h),g!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,g),this.wrapT=g)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Xy{constructor(t,r){this.context=t,this.texture=r}bind(t,r){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),t!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,t),this.minFilter=t),r!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,r),this.wrapS=r)}}function Yy(a,t,r,h,g,d,_,T){const I=[a,t,1,r,h,1,g,d,1],z=[_,T,1],b=ot.mat3.adjoint([],I),[L,P,C]=ot.vec3.transformMat3(z,z,b);return ot.mat3.multiply(I,I,[L,0,0,0,P,0,0,0,C])}function s2(a,t,r,h,g,d,_,T){const I=function(z,b,L,P,C,R,F,q){const Z=Yy(0,0,1,0,1,1,0,1),te=Yy(z,b,L,P,C,R,F,q),ie=ot.mat3.adjoint([],Z);return ot.mat3.multiply(te,te,ie)}(a,t,r,h,g,d,_,T);return[I[2]/I[8]/un,I[5]/I[8]/un]}function Ky(a){return[a[0],Math.min(Math.max(a[1],-Qe),Qe)]}class o2 extends bi{constructor(t,r,h,g){super(),this.id=t,this.dispatcher=h,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=r,this._dirty=!1}load(t,r){if(this._loaded=r||!1,this.fire(new je("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=_a(this.map._requestManager.transformRequest(this.url,aa.Image),(h,g)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new zt(h)):g&&(this.image=g instanceof HTMLImageElement?tn.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Xy(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new je("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Xy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=t[0][1],h=t[0][1];for(const d of t)d[1]>h&&(h=d[1]),d[1]<r&&(r=d[1]);const g=(h+r)/2;if(g>Qe?this.onNorthPole=!0:g<-Qe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=t.map(Ot.fromLngLat);this.tileID=function(_){let T=1/0,I=1/0,z=-1/0,b=-1/0;for(const F of _)T=Math.min(T,F.x),I=Math.min(I,F.y),z=Math.max(z,F.x),b=Math.max(b,F.y);const L=Math.max(z-T,b-I),P=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),C=Math.pow(2,P);let R=Math.floor((T+z)/2*C);return R>1&&(R-=1),new Eo(P,R,Math.floor((I+b)/2*C))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new je("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const Z in this.tiles){const te=this.tiles[Z];te.state!=="loaded"&&(te.state="loaded",te.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=t0(new Eo(0,0,0),this.map.transform.projection),h=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Z){const te=Z[1].x-Z[0].x,ie=Z[1].y-Z[0].y,K=Z[2].x-Z[1].x,ce=Z[2].y-Z[1].y,he=Z[3].x-Z[2].x,Se=Z[3].y-Z[2].y,$e=Z[0].x-Z[3].x,Be=Z[0].y-Z[3].y,Ve=te*ce-K*ie,Mt=K*Se-he*ce,Ne=he*Be-$e*Se,ft=$e*ie-te*Be;return Ve>0&&Mt>0&&Ne>0&&ft>0||Ve<0&&Mt<0&&Ne<0&&ft<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=t0(this.tileID,this.map.transform.projection),[d,_,T,I]=this.coordinates.map(Z=>{const te=g.projection.project(Z[0],Z[1]);return qT(g,te)._round()});this.perspectiveTransform=s2(d.x,d.y,_.x,_.y,T.x,T.y,I.x,I.y);const z=this._boundsArray=new Lu;z.emplaceBack(d.x,d.y,0,0),z.emplaceBack(_.x,_.y,un,0),z.emplaceBack(I.x,I.y,0,un),z.emplaceBack(T.x,T.y,un,un),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(z,jx.members),this.boundsSegments=Js.simpleSegment(0,0,4,2);const b=[],L=[Ky((P=this.coordinates)[0]),Ky(P[1]),Ky(P[2]),Ky(P[3])];var P;const[C,R,F,q]=function(Z){let te=Z[0][0],ie=te,K=Z[0][1],ce=K;for(let he=1;he<Z.length;he++)Z[he][0]<te?te=Z[he][0]:Z[he][0]>ie&&(ie=Z[he][0]),Z[he][1]<K?K=Z[he][1]:Z[he][1]>ce&&(ce=Z[he][1]);return[te,K,ie-te,ce-K]}(L);{const Z=new Lu,[te,ie,K,ce]=function(ei){let ri=ei[0].x,Yt=ri,yi=ei[0].y,Fi=yi;for(let pi=1;pi<ei.length;pi++)ei[pi].x<ri?ri=ei[pi].x:ei[pi].x>Yt&&(Yt=ei[pi].x),ei[pi].y<yi?yi=ei[pi].y:ei[pi].y>Fi&&(Fi=ei[pi].y);return[ri,yi,Yt-ri,Fi-yi]}(h),he=ei=>[(ei.x-te)/K,(ei.y-ie)/ce],[Se,$e,Be,Ve]=h.map(he),Mt=function(ei,ri,Yt,yi,Fi,pi,Tn,ln){const $i=Yy(0,0,1,0,1,1,0,1),Di=Yy(ei,ri,Yt,yi,Fi,pi,Tn,ln),Kn=ot.mat3.adjoint([],Di);return ot.mat3.multiply($i,$i,Kn)}(Se[0],Se[1],$e[0],$e[1],Be[0],Be[1],Ve[0],Ve[1]);this.elevatedGlobePerspectiveTransform=s2(Se[0],Se[1],$e[0],$e[1],Be[0],Be[1],Ve[0],Ve[1]);const Ne=(ei,ri)=>{b.push(ei.lng);const Yt=Math.round((ei.lng-C)/F*un),yi=Math.round((ei.lat-R)/q*un),Fi=he(ri),pi=ot.vec3.transformMat3([],[Fi[0],Fi[1],1],Mt),Tn=Math.round(pi[0]/pi[2]*un),ln=Math.round(pi[1]/pi[2]*un);Z.emplaceBack(Yt,yi,Tn,ln)},ft=h[3].x-h[0].x,Pt=h[3].y-h[0].y,Dt=h[2].x-h[1].x,Ut=h[2].y-h[1].y;for(let ei=0;ei<65;ei++){const ri=ei/64,Yt=[h[0].x+ri*ft,h[0].y+ri*Pt],yi=[h[1].x+ri*Dt,h[1].y+ri*Ut],Fi=yi[0]-Yt[0],pi=yi[1]-Yt[1];for(let Tn=0;Tn<65;Tn++){const ln=Tn/64,$i={x:Yt[0]+Fi*ln,y:Yt[1]+pi*ln,z:0};Ne(r.projection.unproject($i.x,$i.y),$i)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(Z,jx.members)}{this.maxLongitudeTriangleSize=0;let Z=[],te=new qs;const ie=(K,ce,he)=>{te.emplaceBack(K,ce,he);const Se=b[K],$e=b[ce],Be=b[he],Ve=Math.min(Math.min(Se,$e),Be),Mt=Math.max(Math.max(Se,$e),Be)-Ve;Mt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Mt),Z.push(Ve+Mt/2)};for(let K=0;K<64;K++)for(let ce=0;ce<64;ce++){const he=65*K+ce,Se=he+1,$e=he+65,Be=$e+1;ie(he,$e,Se),ie(Se,$e,Be)}[Z,te]=function(K,ce){const he=Array.from({length:K.length},(Be,Ve)=>Ve);he.sort((Be,Ve)=>K[Be]-K[Ve]);const Se=[],$e=new qs;for(let Be=0;Be<he.length;Be++){const Ve=he[Be];Se.push(K[Ve]);const Mt=3*Ve,Ne=Mt+1;$e.emplaceBack(ce.uint16[Mt],ce.uint16[Ne],ce.uint16[Ne+1])}return[Se,$e]}(Z,te),this.elevatedGlobeTrianglesCenterLongitudes=Z,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(te)}this.elevatedGlobeSegments=Js.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/un,0,q/un,0,0,R,C,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const r=this.map.painter.context,h=r.gl;!this._dirty||this.texture instanceof Xy||(this.texture?this.texture.update(this.image):(this.texture=new $x(r,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(r)}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let g=(d=t+180)+360*Math.round((h[0]-d)/360);var d;const _=new Js,T=(L,P)=>{_.segments.push({vertexOffset:0,primitiveOffset:L,vertexLength:r.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},I=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-g)<=I){const L=ai(h,0,h.length,g+I);return L===h.length||T(L,po(h,L+1,h.length,g+360-I)-L),_}g<h[0]&&(g+=360);const z=po(h,0,h.length,g-I);if(z===h.length)return T(0,h.length),_;T(0,z-0);const b=ai(h,z+1,h.length,g+I);return b!==h.length&&T(b,h.length-b),_}}const QL=(Math.pow(256,2)-1)/16907520;class a2 extends Ko{constructor(t,r,h,g){super(t,{layout:n2||(n2=new Ts({visibility:new qi(Qt.layout_raster.visibility)})),paint:r2||(r2=new Ts({"raster-opacity":new qi(Qt.paint_raster["raster-opacity"]),"raster-color":new Au(Qt.paint_raster["raster-color"]),"raster-color-mix":new qi(Qt.paint_raster["raster-color-mix"]),"raster-color-range":new qi(Qt.paint_raster["raster-color-range"]),"raster-hue-rotate":new qi(Qt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qi(Qt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qi(Qt.paint_raster["raster-brightness-max"]),"raster-saturation":new qi(Qt.paint_raster["raster-saturation"]),"raster-contrast":new qi(Qt.paint_raster["raster-contrast"]),"raster-resampling":new qi(Qt.paint_raster["raster-resampling"]),"raster-fade-duration":new qi(Qt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new qi(Qt.paint_raster["raster-emissive-strength"]),"raster-array-band":new qi(Qt.paint_raster["raster-array-band"]),"raster-elevation":new qi(Qt.paint_raster["raster-elevation"])}))},r,h,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof o2&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[h,g]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(g)||h===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=Qf({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,g])}}let l2,c2,u2,h2,d2;class p2 extends Ko{constructor(t,r,h,g){super(t,{layout:l2||(l2=new Ts({visibility:new qi(Qt["layout_raster-particle"].visibility)})),paint:c2||(c2=new Ts({"raster-particle-array-band":new qi(Qt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new qi(Qt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Au(Qt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new qi(Qt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new qi(Qt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new qi(Qt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new qi(Qt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new qi(Qt["paint_raster-particle"]["raster-particle-elevation"])}))},r,h,g),this._updateColorRamp(),this.lastInvalidatedAt=tn.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Qf({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=tn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class eI extends Ko{constructor(t,r){super(t,{},r,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function Zx(a,t,r){const h=[0,0,1],g=ot.quat.identity([]);return ot.quat.rotateY(g,g,r?-Ue(a)+Math.PI:Ue(a)),ot.quat.rotateX(g,g,-Ue(t)),ot.vec3.transformQuat(h,h,g),ot.vec3.normalize(h,h)}function f2(a,t){const r=Jy(a.projection,a.zoom,a.width,a.height),h=function(d,_,T,I,z){const b=new j(T.lng-180*Np,T.lat),L=new j(T.lng+180*Np,T.lat),P=d.project(b.lng,b.lat),C=d.project(L.lng,L.lat),R=-Math.atan2(C.y-P.y,C.x-P.x),F=Ot.fromLngLat(T);F.y=It(F.y,-1+Np,1-Np);const q=F.toLngLat(),Z=d.project(q.lng,q.lat),te=Ot.fromLngLat(q);te.x+=Np;const ie=te.toLngLat(),K=d.project(ie.lng,ie.lat),ce=g2(K.x-Z.x,K.y-Z.y,R),he=Ot.fromLngLat(q);he.y+=Np;const Se=he.toLngLat(),$e=d.project(Se.lng,Se.lat),Be=g2($e.x-Z.x,$e.y-Z.y,R),Ve=Math.abs(ce.x)/Math.abs(Be.y),Mt=ot.mat4.identity([]);ot.mat4.rotateZ(Mt,Mt,-R*(1-(z?0:I)));const Ne=ot.mat4.identity([]);return ot.mat4.scale(Ne,Ne,[1,1-(1-Ve)*I,1]),Ne[4]=-Be.x/Be.y*I,ot.mat4.rotateZ(Ne,Ne,R),ot.mat4.multiply(Ne,Mt,Ne),Ne}(a.projection,0,a.center,r,t),g=m2(a);return ot.mat4.scale(h,h,[g,g,1]),h}function m2(a){const t=a.projection,r=Jy(a.projection,a.zoom,a.width,a.height),h=Xx(t,a.center),g=Xx(t,j.convert(t.center));return Math.pow(2,h*r+(1-r)*g)}function Jy(a,t,r,h,g=1/0){const d=a.range;if(!d)return 0;const _=Math.min(g,Math.max(r,h)),T=Math.log(_/1024)/Math.LN2;return ui(d[0]+T,d[1]+T,t)}const Np=1/4e4;function Xx(a,t){const r=It(t.lat,-Qe,Qe),h=new j(t.lng-180*Np,r),g=new j(t.lng+180*Np,r),d=a.project(h.lng,r),_=a.project(g.lng,r),T=Ot.fromLngLat(h),I=Ot.fromLngLat(g),z=_.x-d.x,b=_.y-d.y,L=I.x-T.x,P=I.y-T.y,C=Math.sqrt((L*L+P*P)/(z*z+b*b));return Math.log(C)/Math.LN2}function g2(a,t,r){const h=Math.cos(r),g=Math.sin(r);return{x:a*h-t*g,y:a*g+t*h}}function _2(a,t,r){ot.mat4.identity(a),ot.mat4.rotateZ(a,a,Ue(t[2])),ot.mat4.rotateX(a,a,Ue(t[0])),ot.mat4.rotateY(a,a,Ue(t[1])),ot.mat4.scale(a,a,r),ot.mat4.multiply(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Qy(a,t,r,h,g,d,_,T){const I=[r[0]-t[0],r[1]-t[1],0],z=[h[0]-t[0],h[1]-t[1],0];if(ot.vec3.length(I)<1e-12||ot.vec3.length(z)<1e-12)return ot.quat.identity(a);const b=ot.vec3.cross([],I,z);ot.vec3.normalize(b,b),ot.vec3.subtract(z,h,t),I[2]=(d-g)*T,z[2]=(_-g)*T;const L=I;return ot.vec3.cross(L,I,z),ot.vec3.normalize(L,L),ot.quat.rotationTo(a,b,L)}function Yx(a,t,r=!1){const h=iu(t.zoom),g=function(d,_,T){const I=_.worldSize,z=[d[12],d[13],d[14]],b=Ge(z[1]/I),L=Oe(z[0]/I),P=ot.mat4.identity([]),C=ge(1,b)*I,R=ge(1,0)*I*tt(b,_.zoom),F=1/Kf(I);let q=R*F;if(T){const K=Jy(_.projection,_.zoom,_.width,_.height,1024);q=F*_.projection.pixelSpaceConversion(_.center.lat,I,K)}const Z=k(b,L);ot.vec3.add(Z,Z,ot.vec3.scale([],ot.vec3.normalize([],Z),C*q*z[2]));const te=function(K){const ce=[K[0],K[1],K[2]];let he=[0,1,0];const Se=ot.vec3.cross([],he,ce);return ot.vec3.cross(he,ce,Se),ot.vec3.squaredLength(he)===0&&(he=[0,1,0],ot.vec3.cross(Se,ce,he)),ot.vec3.normalize(Se,Se),ot.vec3.normalize(he,he),ot.vec3.normalize(ce,ce),[Se[0],Se[1],Se[2],0,he[0],he[1],he[2],0,ce[0],ce[1],ce[2],0,K[0],K[1],K[2],1]}(Z);ot.mat4.scale(P,P,[q,q,q*C]),ot.mat4.translate(P,P,[-z[0],-z[1],-z[2]]);const ie=ot.mat4.multiply([],_.globeMatrix,te);return ot.mat4.multiply(ie,ie,P),ot.mat4.multiply(ie,ie,d),ie}(a,t,r);if(h>0){const d=function(_,T){const I=T.worldSize,z=ge(1,0)*I*tt(T.center.lat,T.zoom)/Kf(I),b=ge(1,T.center.lat)*I,L=ot.mat4.identity([]);return ot.mat4.rotateY(L,L,Ue(T.center.lng)),ot.mat4.rotateX(L,L,Ue(T.center.lat)),ot.mat4.translate(L,L,[0,0,na]),ot.mat4.scale(L,L,[z,z,z*b]),ot.mat4.translate(L,L,[T.point.x-.5*I,T.point.y-.5*I,0]),ot.mat4.multiply(L,L,_),ot.mat4.multiply(L,T.globeMatrix,L)}(a,t);return function(_,T,I){const z=(R,F,q)=>{const Z=ot.vec3.length(R),te=ot.vec3.length(F),ie=Rl(R,F,q);return ot.vec3.scale(ie,ie,1/ot.vec3.length(ie)*Pe(Z,te,q))},b=z([_[0],_[1],_[2]],[T[0],T[1],T[2]],I),L=z([_[4],_[5],_[6]],[T[4],T[5],T[6]],I),P=z([_[8],_[9],_[10]],[T[8],T[9],T[10]],I),C=Rl([_[12],_[13],_[14]],[T[12],T[13],T[14]],I);return[b[0],b[1],b[2],0,L[0],L[1],L[2],0,P[0],P[1],P[2],0,C[0],C[1],C[2],1]}(g,d,h)}return g}function y2(a,t,r,h){const g=ls.projectAabbCorners(h,r);let d=Number.MAX_VALUE,_=-1;for(let z=0;z<g.length;++z){const b=g[z];b[0]=(.5*b[0]+.5)*t.width,b[1]=(.5-.5*b[1])*t.height,b[2]<d&&(_=z,d=b[2])}const T=z=>new Ye(g[z][0],g[z][1]);let I;switch(_){case 0:case 6:I=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:I=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:I=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:I=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(gi(a,I))return d}const tI=Qr([{name:"a_pos_3f",components:3,type:"Float32"}]),iI=Qr([{name:"a_color_3f",components:3,type:"Float32"}]),nI=Qr([{name:"a_color_4f",components:4,type:"Float32"}]),rI=Qr([{name:"a_uv_2f",components:2,type:"Float32"}]),sI=Qr([{name:"a_normal_3f",components:3,type:"Float32"}]),oI=Qr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),aI=Qr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),v2={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class ev{constructor(t,r,h,g){this.message=(t?`${t}: `:"")+h,g&&(this.identifier=g),r!=null&&r.__line__&&(this.line=r.__line__)}}function x2(a,t){const r=a.indexOf("://")===-1;try{return new URL(a,r&&t?"http://example.com":void 0),!0}catch{return!1}}class b2{constructor(t,r){this.feature=t,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class w2{constructor(){this.instancedDataArray=new Yc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Kx{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,r){}populate(t,r,h,g){this.tileToMeter=wt(h);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:T,index:I,sourceLayerIndex:z}of t){const b=T??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),L=wi(_,d);if(!this.layers[0]._featureFilter.filter(new eo(this.zoom),L,h))continue;const P={id:b,sourceLayerIndex:z,index:I,geometry:d?L.geometry:qt(_,h,g),properties:_.properties,type:_.type,patterns:{}},C=this.addFeature(P,P.geometry,L);C&&r.featureIndex.insert(_,P.geometry,I,z,this.index,this.instancesPerModel[C].instancedDataArray.length,un/32)}this.lookup=null}update(t,r,h,g){for(const d in this.instancesPerModel){const _=this.instancesPerModel[d];for(const T in t)_.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(_.features[_.idToFeaturesIndex[T]],t[T],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const h=this.instancesPerModel[r];for(const g of h.features){const d=this.layers[0],_=g.feature,T=this.canonical,I=d.paint.get("model-rotation").evaluate(_,{},T),z=d.paint.get("model-scale").evaluate(_,{},T),b=d.paint.get("model-translation").evaluate(_,{},T);ot.vec3.exactEquals(g.rotation,I)&&ot.vec3.exactEquals(g.scale,z)&&ot.vec3.exactEquals(g.translation,b)||(this.evaluate(g,g.featureStates,h,!0),t=!0)}}return t}updateReplacement(t,r,h,g){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const d=r.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(vi(this.activeReplacements,d))return!1;this.activeReplacements=d;let _=!1;for(const T in this.instancesPerModel){const I=this.instancesPerModel[T],z=I.instancedDataArray;for(const b of I.features){const L=b.instancedDataOffset,P=b.instancedDataCount;for(let C=0;C<P;C++){const R=16*(C+L);let F=z.float32[R+0];const q=F>un;F=q?F-un:F;const Z=Math.floor(F),te=z.float32[R+1];let ie=!1;for(const K of this.activeReplacements)if(!_t(K,h,v2.Model,g)&&!(K.min.x>Z||Z>K.max.x||K.min.y>te||te>K.max.y)&&(ie=Ji(En(Z,te,t.canonical,K.footprintTileId.canonical),K.footprint),ie))break;z.float32[R]=ie?F+un:F,_=_||ie!==q}}}return _}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const r in this.instancesPerModel){const h=this.instancesPerModel[r];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=t.createVertexBuffer(h.instancedDataArray,oI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const h=this.instancesPerModel[r];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const r of this.modelUris)t.removeModel(r,"")}addFeature(t,r,h){const g=this.layers[0],d=g.layout.get("model-id").evaluate(h,{},this.canonical);if(!d)return Wn(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),d;x2(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new w2);const _=this.instancesPerModel[d],T=_.instancedDataArray,I=new b2(h,T.length);for(const z of r)for(const b of z){if(b.x<0||b.x>=un||b.y<0||b.y>=un)continue;const L=(this.lookupDim-1)/un,P=this.lookupDim*(b.y*L|0)+b.x*L|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const C=T.length;T.resize(C+1),_.instancesEvaluatedElevation.push(0),T.float32[16*C]=b.x,T.float32[16*C+1]=b.y}return I.instancedDataCount=_.instancedDataArray.length-I.instancedDataOffset,I.instancedDataCount>0&&(t.id&&(_.idToFeaturesIndex[t.id]=_.features.length),_.features.push(I),this.evaluate(I,{},_,!1)),d}getModelUris(){return this.modelUris}evaluate(t,r,h,g){const d=this.layers[0],_=t.feature,T=this.canonical,I=t.rotation=d.paint.get("model-rotation").evaluate(_,r,T),z=t.scale=d.paint.get("model-scale").evaluate(_,r,T),b=t.translation=d.paint.get("model-translation").evaluate(_,r,T),L=d.paint.get("model-color").evaluate(_,r,T);L.a=d.paint.get("model-color-mix-intensity").evaluate(_,r,T);const P=[];this.maxVerticalOffset<b[2]&&(this.maxVerticalOffset=b[2]),this.maxScale=Math.max(Math.max(this.maxScale,z[0]),Math.max(z[1],z[2])),_2(P,I,z);const C=Math.round(100*L.a)+L.b/1.05;for(let R=0;R<t.instancedDataCount;++R){const F=t.instancedDataOffset+R,q=16*F,Z=h.instancedDataArray.float32;let te=0;g&&(te=Z[q+6]-h.instancesEvaluatedElevation[F]);const ie=0|Z[q+1];Z[q]=(0|Z[q])+L.r/1.05,Z[q+1]=ie+L.g/1.05,Z[q+2]=C,Z[q+3]=1/(T.z>10?this.tileToMeter:wt(T,ie)),Z[q+4]=b[0],Z[q+5]=b[1],Z[q+6]=b[2]+te,Z[q+7]=P[0],Z[q+8]=P[1],Z[q+9]=P[2],Z[q+10]=P[4],Z[q+11]=P[5],Z[q+12]=P[6],Z[q+13]=P[8],Z[q+14]=P[9],Z[q+15]=P[10],h.instancesEvaluatedElevation[F]=b[2]}}}let T2,M2;Sn(Kx,"ModelBucket",{omit:["layers"]}),Sn(w2,"PerModelAttributes"),Sn(b2,"ModelFeature");const am=64,xg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function S2(a,t,r,h,g,d,_,T,I,z=!1){const b=r.zoom,L=r.project(h),P=tt(h.lat,b),C=1/P;ot.mat4.identity(a),ot.mat4.translate(a,a,[L.x+_[0]*C,L.y+_[1]*C,_[2]]);let R=1,F=1;const q=r.worldSize;if(z){if(r.projection.name==="mercator"){let K=0;r.elevation&&(K=r.elevation.getAtPointOrZero(new Ot(L.x/q,L.y/q),0));const ce=ot.vec4.transformMat4([],[L.x,L.y,K,1],r.projMatrix)[3]/r.cameraToCenterDistance;R=ce,F=ce*tt(r.center.lat,b)}else if(r.projection.name==="globe"){const K=Yx(a,r),ce=ot.mat4.multiply([],r.projMatrix,K),he=[0,0,0,1];ot.vec4.transformMat4(he,he,ce);const Se=he[3]/r.cameraToCenterDistance,$e=iu(b),Be=r.projection.pixelsPerMeter(h.lat,q)*tt(h.lat,b),Ve=r.projection.pixelsPerMeter(r.center.lat,q)*tt(r.center.lat,b);R=Se/Pe(Be,nt(r.center.lat),$e),F=Se*P/Be,R*=Ve,F*=Ve}}else R=C;ot.mat4.scale(a,a,[R,R,F]);const Z=[...a],te=t.orientation,ie=[];if(_2(ie,[te[0]+g[0],te[1]+g[1],te[2]+g[2]],d),ot.mat4.multiply(a,Z,ie),T&&r.elevation){let K=0;const ce=[];if(I&&r.elevation){K=function($e,Be,Ve,Mt,Ne){const ft=Be.elevation;if(!ft)return 0;const Pt=ls.projectAabbCorners(Ve,Mt),Dt=ge(1,Ne.lat)*Be.worldSize,Ut=function(Kn,bn){const Cn=[0,0,1],fr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Sr of fr){const Cr=Kn[Sr.corners[0]],xr=Kn[Sr.corners[1]],Vr=Kn[Sr.corners[2]],Br=[xr[0]-Cr[0],xr[1]-Cr[1],bn*(xr[2]-Cr[2])],Bs=ot.vec3.cross(Br,Br,[Vr[0]-Cr[0],Vr[1]-Cr[1],bn*(Vr[2]-Cr[2])]);ot.vec3.normalize(Bs,Bs),Sr.dotProductWithUp=ot.vec3.dot(Bs,Cn)}return fr.sort((Sr,Cr)=>Sr.dotProductWithUp-Cr.dotProductWithUp),fr[0].corners}(Pt,Dt),ei=Pt[Ut[0]],ri=Pt[Ut[1]],Yt=Pt[Ut[2]],yi=Pt[Ut[3]],Fi=ft.getAtPointOrZero(new Ot(ei[0]/Be.worldSize,ei[1]/Be.worldSize),0),pi=ft.getAtPointOrZero(new Ot(ri[0]/Be.worldSize,ri[1]/Be.worldSize),0),Tn=ft.getAtPointOrZero(new Ot(Yt[0]/Be.worldSize,Yt[1]/Be.worldSize),0),ln=ft.getAtPointOrZero(new Ot(yi[0]/Be.worldSize,yi[1]/Be.worldSize),0),$i=(Fi+ln)/2,Di=(pi+Tn)/2;return $i>Di?pi<Tn?Qy($e,ri,yi,ei,pi,ln,Fi,Dt):Qy($e,Yt,ei,yi,Tn,Fi,ln,Dt):Fi<ln?Qy($e,ei,ri,Yt,Fi,pi,Tn,Dt):Qy($e,yi,Yt,ri,ln,Tn,pi,Dt),Math.max($i,Di)}(ce,r,t.aabb,a,h);const he=ot.mat4.fromQuat([],ce),Se=ot.mat4.multiply([],he,ie);ot.mat4.multiply(a,Z,Se)}else K=r.elevation.getAtPointOrZero(new Ot(L.x/q,L.y/q),0);K!==0&&(a[14]+=K)}}function o0(a,t,r=!1){a.uploaded||(a.gfxTexture=new $x(t,a.image,r?t.gl.R8:t.gl.RGBA8,{useMipmap:a.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function lI(a,t,r){a.indexBuffer=t.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=t.createVertexBuffer(a.vertexArray,tI.members,!1,!0),a.normalArray&&(a.normalBuffer=t.createVertexBuffer(a.normalArray,sI.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=t.createVertexBuffer(a.texcoordArray,rI.members,!1,!0)),a.colorArray&&(a.colorBuffer=t.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?iI:nI).members,!1,!0)),a.featureArray&&(a.pbrBuffer=t.createVertexBuffer(a.featureArray,aI.members,!0)),a.segments=Js.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const h=a.material;h.pbrMetallicRoughness.baseColorTexture&&o0(h.pbrMetallicRoughness.baseColorTexture,t),h.pbrMetallicRoughness.metallicRoughnessTexture&&o0(h.pbrMetallicRoughness.metallicRoughnessTexture,t),h.normalTexture&&o0(h.normalTexture,t),h.occlusionTexture&&o0(h.occlusionTexture,t,r),h.emissionTexture&&o0(h.emissionTexture,t)}function Jx(a,t,r){if(a.meshes)for(const h of a.meshes)lI(h,t,r);if(a.children)for(const h of a.children)Jx(h,t,r)}function tv(a){if(a.meshes)for(const t of a.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(a.children)for(const t of a.children)tv(t)}function Qx(a){if(a.meshes)for(const r of a.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(a.children)for(const r of a.children)Qx(r)}class bg{constructor(t,r,h){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=h}static create(t,r,h){const g=h||t.findDEMTileFor(r);if(!g||!g.dem)return;const d=g.dem,_=g.tileID,T=1<<r.canonical.z-_.canonical.z;return new bg(g,d.dim/un/T,[(r.canonical.x/T-_.canonical.x)*d.dim,(r.canonical.y/T-_.canonical.y)*d.dim])}tileCoordToPixel(t,r){const h=r*this._scale+this._offset[1],g=Math.floor(t*this._scale+this._offset[0]),d=Math.floor(h);return new Ye(g,d)}getElevationAt(t,r,h,g){const d=t*this._scale+this._offset[0],_=r*this._scale+this._offset[1],T=Math.floor(d),I=Math.floor(_),z=this._dem;return g=!!g,h?Pe(Pe(z.get(T,I,g),z.get(T,I+1,g),_-I),Pe(z.get(T+1,I,g),z.get(T+1,I+1,g),_-I),d-T):z.get(T,I,g)}getElevationAtPixel(t,r,h){return this._dem.get(t,r,!!h)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ge(1,t)*this._dem.stride}}const e1=new Float32Array(262144),lm=new Uint8Array(262144);function E2(a){let t=0;if(a.meshes)for(const r of a.meshes)t=Math.max(t,r.aabb.max[2]);if(a.children)for(const r of a.children)t=Math.max(t,E2(r));return t}function A2(a,t,r){if(a.meshes)for(const h of a.meshes){if(h.aabb.min[0]===1/0)continue;const g=ls.applyTransform(h.aabb,a.matrix);r.insert(t,g.min[0],g.min[1],g.max[0],g.max[1])}if(a.children)for(const h of a.children)A2(h,t,r)}const C2=["","wall","door","roof","window","lamp","logo"];class L2{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:E2(t)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ls([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const r=new ls([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==t&&(h.transformedAabb=ls.applyTransformFast(h.aabb,this.node.matrix),r.encapsulate(h.transformedAabb)),t++;this.aabb=r}return this.aabb}}class iv{constructor(t,r,h,g,d,_,T){this.id=h,this.layers=t,this.layerIds=this.layers.map(I=>I.fqid),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.modelTraits|=xg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,g&&(this.modelTraits|=xg.HasMapboxMeshFeatures),d&&(this.modelTraits|=xg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const I of r)this.nodesInfo.push(new L2(I)),A2(I,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0)}updateFootprints(t,r){for(const h of this.getNodesInfo()){const g=h.node;g.footprint&&r.push({footprint:g.footprint,id:t})}}update(t){const r=Object.keys(t).length!==0;if(r&&!this.stateDependentLayers.length)return;const h=r?this.stateDependentLayers:this.layers;for(const g of h)this.evaluate(g,t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const h of r){const g=h.node;this.uploaded?this.updatePbrBuffer(g):Jx(g,t,!0)}for(const h of r)tv(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let r=!1;if(!t.meshes)return r;for(const h of t.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),r=!0);return r}needsReEvaluation(t,r,h){const g=t.transform.projectionOptions,d=t.style.getBrightness(),_=this.brightness!==d;return!!(!this.uploaded||this.dirty||g.name!==this.projection.name||a0(h.paint.get("model-color").value,_)||a0(h.paint.get("model-color-mix-intensity").value,_)||a0(h.paint.get("model-roughness").value,_)||a0(h.paint.get("model-emissive-strength").value,_)||a0(h.paint.get("model-height-based-emissive-strength-multiplier").value,_))&&(this.projection=g,this.brightness=d,!0)}evaluateScale(t,r){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const h=this.getNodesInfo(),g=this.id.canonical;for(const d of h){const _=d.feature;d.evaluatedScale=r.paint.get("model-scale").evaluate(_,{},g)}}evaluate(t,r){const h=this.getNodesInfo();for(const g of h){if(!g.node.meshes)continue;const d=g.feature,_=r&&r[d.id],T=g.node.meshes&&g.node.meshes[0].featureData,I=g.evaluatedColor[2],z=g.evaluatedRMEA[2],b=this.id.canonical;if(g.hasTranslucentParts=!1,T){for(let L=0;L<C2.length;L++){const P=C2[L];P.length&&(d.properties.part=P);const C=t.paint.get("model-color").evaluate(d,_,b).toRenderColor(null),R=t.paint.get("model-color-mix-intensity").evaluate(d,_,b);g.evaluatedColor[L]=[C.r,C.g,C.b,R],g.evaluatedRMEA[L][0]=t.paint.get("model-roughness").evaluate(d,_,b),g.evaluatedRMEA[L][2]=t.paint.get("model-emissive-strength").evaluate(d,_,b),g.evaluatedRMEA[L][3]=C.a,g.emissionHeightBasedParams[L]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,_,b),!g.hasTranslucentParts&&C.a<1&&(g.hasTranslucentParts=!0)}delete d.properties.part,uI(g,I!==g.evaluatedColor[2]||z!==g.evaluatedRMEA[2],this.modelTraits)}else g.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(d,_,b);g.evaluatedScale=t.paint.get("model-scale").evaluate(d,_,b),this.updatePbrBuffer(g.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,r,h,g){const d=t.findDEMTileFor(h);if(d&&(d.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const _=bg.create(t,h,d);if(!_)return;this.modelTraits&xg.HasMapboxMeshFeatures&&this.updateDEM(t,_,h,g);for(const T of this.getNodesInfo()){const I=T.node;if(!I.footprint||!I.footprint.vertices||!I.footprint.vertices.length)continue;const z=I.footprint.vertices;let b=_.getElevationAt(z[0].x,z[0].y,!0,!0);for(let L=1;L<z.length;L++)b=Math.min(b,_.getElevationAt(z[L].x,z[L].y,!0,!0));I.elevation=b}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=r}}updateDEM(t,r,h,g){let d=r._dem._modifiedForSources[g];if(d===void 0&&(r._dem._modifiedForSources[g]=[],d=r._dem._modifiedForSources[g]),d.includes(h.canonical))return;const _=r._dem.dim;d.push(h.canonical);let T=!1;for(const I of this.getNodesInfo()){const z=I.node;if(!z.footprint||!z.footprint.grid)continue;const b=z.footprint.grid,L=r.tileCoordToPixel(b.min.x,b.min.y),P=r.tileCoordToPixel(b.max.x,b.max.y),C=Math.min(Math.min(_-P.y,L.x),Math.min(L.y,_-P.x));if(C<0)continue;const R=It(C,2,5);let F=Math.max(0,L.x-R),q=Math.max(0,L.y-R),Z=Math.min(P.x+R,_-1),te=Math.min(P.y+R,_-1);for(let he=q;he<=te;++he)for(let Se=F;Se<=Z;++Se)lm[he*_+Se]=255;let ie=0,K=0;for(let he=0;he<b.cellsY;++he)for(let Se=0;Se<b.cellsX;++Se){if(!b.cells[he*b.cellsX+Se])continue;const $e=r.tileCoordToPixel(b.min.x+Se/b.xScale,b.min.y+he/b.yScale),Be=r.tileCoordToPixel(b.min.x+(Se+1)/b.xScale,b.min.y+(he+1)/b.yScale);for(let Ve=$e.y;Ve<=Math.min(Be.y+1,_-1);++Ve)for(let Mt=$e.x;Mt<=Math.min(Be.x+1,_-1);++Mt)lm[Ve*_+Mt]===255&&(lm[Ve*_+Mt]=0,ie+=r.getElevationAtPixel(Mt,Ve),K++)}const ce=ie/K;F=Math.max(1,L.x-R),q=Math.max(1,L.y-R),Z=Math.min(P.x+R,_-2),te=Math.min(P.y+R,_-2),T=!0;for(let he=q;he<=te;++he)for(let Se=F;Se<=Z;++Se)lm[he*_+Se]===0&&(e1[he*_+Se]=r._dem.set(Se,he,ce));for(let he=1;he<R;++he){F=Math.max(1,L.x-he),q=Math.max(1,L.y-he),Z=Math.min(P.x+he,_-2),te=Math.min(P.y+he,_-2);for(let Se=q;Se<=te;++Se)for(let $e=F;$e<=Z;++$e){const Be=Se*_+$e;if(lm[Be]===255){let Ve=0,Mt=0,Ne=-1,ft=-1;for(let Pt=-1;Pt<=1;++Pt)for(let Dt=-1;Dt<=1;++Dt){const Ut=(Se+Pt)*_+$e+Dt;if(lm[Ut]>=he)continue;const ei=e1[Ut],ri=Math.abs(ei);ri>Mt&&(Ve=ei,Mt=ri,Ne=Dt,ft=Pt)}if(Mt>.1){const Pt=1-(he+.5*Math.abs(Ne*ft))/R;let Dt=r._dem.get($e,Se)+Ve*Pt;const Ut=r._dem.get($e+Ne,Se+ft),ei=r._dem.get($e-Ne,Se-ft,!0);(Dt-Ut)*(Dt-ei)>0&&(Dt=(Ut+ei)/2),e1[Be]=r._dem.set($e,Se,Dt),lm[Be]=he}}}}}T&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=tn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const r of t)tv(r.node),Qx(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const h=r.getReplacementRegionsForTile(t.toUnwrapped()),g=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const _=g[d].node;g[d].hiddenByReplacement=!!_.footprint&&!h.find(T=>T.footprint===_.footprint)}}getHeightAtTileCoord(t,r){const h=this.getNodesInfo(),g=[],d=[0,0,0],_=ot.mat4.identity([]);for(let T=0;T<this.nodesInfo.length;T++){const I=h[T],z=I.node.meshes[0],b=z.transformedAabb;if(t<b.min[0]||r<b.min[1]||t>b.max[0]||r>b.max[1])continue;if(I.node.hidden===!0)return{height:1/0,maxHeight:I.feature.properties.height,hidden:!1,verticalScale:I.evaluatedScale[2]};ot.mat4.invert(_,I.node.matrix),d[0]=t,d[1]=r,ot.vec3.transformMat4(d,d,_);const L=(d[0]-z.aabb.min[0])/(z.aabb.max[0]-z.aabb.min[0])*am|0,P=Math.min(63,(d[1]-z.aabb.min[1])/(z.aabb.max[1]-z.aabb.min[1])*am|0)*am+Math.min(63,L),C=z.heightmap[P];if(!(C<0&&I.node.footprint))return I.hiddenByReplacement?void 0:{height:C,maxHeight:I.feature.properties.height,hidden:!1,verticalScale:I.evaluatedScale[2]};if(I.node.footprint.grid.query(new Ye(t,r),new Ye(t,r),g),g.length>0)return{height:void 0,maxHeight:I.feature.properties.height,hidden:I.hiddenByReplacement,verticalScale:I.evaluatedScale[2]}}}}function a0(a,t){return!a.isLightConstant&&t}function cI(a,t,r,h,g,d,_,T){let I=(61440&t|(61440&t)>>4)>>8,z=(3840&t|(3840&t)>>4)>>4,b=240&t|(240&t)>>4;r[3]>0&&(I=Pe(I,255*r[0],r[3]),z=Pe(z,255*r[1],r[3]),b=Pe(b,255*r[2],r[3]));const L=I<<8|z,P=b<<8|Math.floor(255*h[3]),C=function(he){const Se=It(he,0,2);return Math.min(Math.round(.5*Se*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],R=It(g[0],0,1),F=It(g[1],0,1),q=It(g[2],0,1),Z=It(g[3],0,1);let te,ie,K,ce;if(R!==F&&_!==d&&F!==R){const he=_-d;ie=1/(he*(F-R)),K=-(d+he*R)/(he*(F-R));const Se=It(g[4],-1,1);ce=Math.pow(10,Se),te=255*q<<8|255*Z}else te=65535,ie=0,K=1,ce=1;if(a.emplaceBack(L,P,C,te,ie,K,ce),T){const he=T.length;T.clear();for(let Se=0;Se<he;Se++)T.emplaceBack(L,P,C,te,ie,K,ce)}}function uI(a,t,r){const h=a.node;let g=0;const d=r&xg.HasMeshoptCompression;for(const _ of h.meshes){if(h.lights&&h.lightMeshIndex===g||!_.featureData)continue;_.featureArray=new zu,_.featureArray.reserve(_.featureData.length);let T=t;for(const I of _.featureData){const z=d?65535&I:I>>16&65535,b=d?I>>16&65535:65535&I,L=(15&b)<8?15&b:0,P=a.evaluatedRMEA[L],C=a.evaluatedColor[L],R=a.emissionHeightBasedParams[L];let F;if(T&&L===2&&h.lights&&(F=new zu,F.resize(10*h.lights.length)),cI(_.featureArray,z,C,P,R,_.aabb.min[2],_.aabb.max[2],F),F&&T){T=!1;const q=h.meshes[h.lightMeshIndex];q.featureArray=F,q.featureArray._trim()}}_.featureArray._trim(),g++}}Sn(iv,"Tiled3dModelBucket",{omit:["layers"]}),Sn(L2,"Tiled3dModelFeature");const hI=["id","tile","layer","source","sourceLayer","state"];class l0{constructor(t,r,h,g,d){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=h,this._y=g,this.properties=t.properties,this.id=d}clone(){const t=new l0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state={...this.state}),this.layer&&(t.layer={...this.layer}),this.namespace&&(t.namespace=this.namespace),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of hI)this[r]!==void 0&&(t[r]=this[r]);return t}}function I2(a,t,r,h){const g=1<<a.z;t.lat=Ge((h/un+a.y)/g),t.lng=Oe((r/un+a.x)/g)}const dI={circle:class extends Ko{constructor(a,t,r,h){super(a,{layout:Er||(Er=new Ts({"circle-sort-key":new yn(Qt.layout_circle["circle-sort-key"]),visibility:new qi(Qt.layout_circle.visibility)})),paint:ts||(ts=new Ts({"circle-radius":new yn(Qt.paint_circle["circle-radius"]),"circle-color":new yn(Qt.paint_circle["circle-color"]),"circle-blur":new yn(Qt.paint_circle["circle-blur"]),"circle-opacity":new yn(Qt.paint_circle["circle-opacity"]),"circle-translate":new qi(Qt.paint_circle["circle-translate"]),"circle-translate-anchor":new qi(Qt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qi(Qt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qi(Qt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(Qt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(Qt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(Qt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new qi(Qt.paint_circle["circle-emissive-strength"])}))},t,r,h)}createBucket(a){return new Ci(a)}queryRadius(a){const t=a;return Ss("circle-radius",this,t)+Ss("circle-stroke-width",this,t)+br(this.paint.get("circle-translate"))}queryIntersectsFeature(a,t,r,h,g,d,_,T){const I=ps(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,a.pixelToTileUnitsFactor),z=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Ih(a,h,d,_,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",I,z)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,t,r){const h=D_(this);return{config:new fc(this,{zoom:t,lut:r}),defines:h,overrideFog:!1}}},heatmap:class extends Ko{createBucket(a){return new Rh(a)}constructor(a,t,r,h){super(a,{layout:z_||(z_=new Ts({visibility:new qi(Qt.layout_heatmap.visibility)})),paint:_y||(_y=new Ts({"heatmap-radius":new yn(Qt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(Qt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qi(Qt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Au(Qt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qi(Qt.paint_heatmap["heatmap-opacity"])}))},t,r,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Ss("heatmap-radius",this,a)}queryIntersectsFeature(a,t,r,h,g,d,_,T){const I=this.paint.get("heatmap-radius").evaluate(t,r);return Ih(a,h,d,_,T,!0,!0,new Ye(0,0),I)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,t,r){return a==="heatmap"?{config:new fc(this,{zoom:t,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Ko{constructor(a,t,r,h){super(a,{layout:Ph||(Ph=new Ts({visibility:new qi(Qt.layout_hillshade.visibility)})),paint:k_||(k_=new Ts({"hillshade-illumination-direction":new qi(Qt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qi(Qt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qi(Qt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qi(Qt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qi(Qt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qi(Qt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new qi(Qt.paint_hillshade["hillshade-emissive-strength"])}))},t,r,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,t,r){return{overrideFog:!1}}},fill:class extends Ko{constructor(a,t,r,h){super(a,{layout:rm||(rm=new Ts({"fill-sort-key":new yn(Qt.layout_fill["fill-sort-key"]),visibility:new qi(Qt.layout_fill.visibility),"fill-elevation-reference":new qi(Qt.layout_fill["fill-elevation-reference"])})),paint:Oo||(Oo=new Ts({"fill-antialias":new qi(Qt.paint_fill["fill-antialias"]),"fill-opacity":new yn(Qt.paint_fill["fill-opacity"]),"fill-color":new yn(Qt.paint_fill["fill-color"]),"fill-outline-color":new yn(Qt.paint_fill["fill-outline-color"]),"fill-translate":new qi(Qt.paint_fill["fill-translate"]),"fill-translate-anchor":new qi(Qt.paint_fill["fill-translate-anchor"]),"fill-pattern":new yn(Qt.paint_fill["fill-pattern"]),"fill-emissive-strength":new qi(Qt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new yn(Qt.paint_fill["fill-z-offset"])}))},t,r,h)}getProgramIds(){const a=this.paint.get("fill-pattern"),t=a&&a.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(a,t,r){return{config:new fc(this,{zoom:t,lut:r}),overrideFog:!1}}recalculate(a,t){super.recalculate(a,t);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new pg(a)}queryRadius(){return br(this.paint.get("fill-translate"))}queryIntersectsFeature(a,t,r,h,g,d){return!a.queryGeometry.isAboveHorizon&&zn(ds(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,a.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Ko{constructor(a,t,r,h){super(a,{layout:Oh||(Oh=new Ts({visibility:new qi(Qt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new qi(Qt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Pl||(Pl=new Ts({"fill-extrusion-opacity":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yn(Qt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yn(Qt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yn(Qt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yn(Qt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new yn(Qt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new yn(Qt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new yn(Qt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new yn(Qt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new qi(Qt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},t,r,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new or(a)}queryRadius(){return br(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,t,r,h,g,d,_,T,I){const z=ps(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,a.pixelToTileUnitsFactor),b=this.paint.get("fill-extrusion-height").evaluate(t,r),L=this.paint.get("fill-extrusion-base").evaluate(t,r),P=[0,0],C=T&&d.elevation,R=d.elevation?d.elevation.exaggeration():1,F=a.tile.getBucket(this);if(C&&F instanceof or){const K=F.centroidVertexArray,ce=I+1;ce<K.length&&(P[0]=K.geta_centroid_pos0(ce),P[1]=K.geta_centroid_pos1(ce))}if(P[0]===0&&P[1]===1)return!1;d.projection.name==="globe"&&(h=Dh([h],[new Ye(0,0),new Ye(un,un)],a.tileID.canonical).map(K=>K.polygon).flat());const q=C?T:null,[Z,te]=function(K,ce,he,Se,$e,Be,Ve,Mt,Ne,ft,Pt){return K.projection.name==="globe"?function(Dt,Ut,ei,ri,Yt,yi,Fi,pi,Tn,ln,$i){const Di=[],Kn=[],bn=Dt.projection.upVectorScale($i,Dt.center.lat,Dt.worldSize).metersToTile,Cn=[0,0,0,1],fr=[0,0,0,1],Sr=(xr,Vr,Br,Bs)=>{xr[0]=Vr,xr[1]=Br,xr[2]=Bs,xr[3]=1},Cr=ul();ei>0&&(ei+=Cr),ri+=Cr;for(const xr of Ut){const Vr=[],Br=[];for(const Bs of xr){const Rs=Bs.x+Yt.x,lr=Bs.y+Yt.y,fs=Dt.projection.projectTilePoint(Rs,lr,$i),xs=Dt.projection.upVector($i,Bs.x,Bs.y);let Qs=ei,bo=ri;if(Fi){const ko=j_(Rs,lr,ei,ri,Fi,pi,Tn,ln);Qs+=ko.base,bo+=ko.top}ei!==0?Sr(Cn,fs.x+xs[0]*bn*Qs,fs.y+xs[1]*bn*Qs,fs.z+xs[2]*bn*Qs):Sr(Cn,fs.x,fs.y,fs.z),Sr(fr,fs.x+xs[0]*bn*bo,fs.y+xs[1]*bn*bo,fs.z+xs[2]*bn*bo),ot.vec3.transformMat4(Cn,Cn,yi),ot.vec3.transformMat4(fr,fr,yi),Vr.push(new de(Cn[0],Cn[1],Cn[2])),Br.push(new de(fr[0],fr[1],fr[2]))}Di.push(Vr),Kn.push(Br)}return[Di,Kn]}(K,ce,he,Se,$e,Be,Ve,Mt,Ne,ft,Pt):Ve?function(Dt,Ut,ei,ri,Yt,yi,Fi,pi,Tn){const ln=[],$i=[],Di=[0,0,0,1];for(const Kn of Dt){const bn=[],Cn=[];for(const fr of Kn){const Sr=fr.x+ri.x,Cr=fr.y+ri.y,xr=j_(Sr,Cr,Ut,ei,yi,Fi,pi,Tn);Di[0]=Sr,Di[1]=Cr,Di[2]=xr.base,Di[3]=1,ot.vec4.transformMat4(Di,Di,Yt),Di[3]=Math.max(Di[3],1e-5);const Vr=new de(Di[0]/Di[3],Di[1]/Di[3],Di[2]/Di[3]);Di[0]=Sr,Di[1]=Cr,Di[2]=xr.top,Di[3]=1,ot.vec4.transformMat4(Di,Di,Yt),Di[3]=Math.max(Di[3],1e-5);const Br=new de(Di[0]/Di[3],Di[1]/Di[3],Di[2]/Di[3]);bn.push(Vr),Cn.push(Br)}ln.push(bn),$i.push(Cn)}return[ln,$i]}(ce,he,Se,$e,Be,Ve,Mt,Ne,ft):function(Dt,Ut,ei,ri,Yt){const yi=[],Fi=[],pi=Yt[8]*Ut,Tn=Yt[9]*Ut,ln=Yt[10]*Ut,$i=Yt[11]*Ut,Di=Yt[8]*ei,Kn=Yt[9]*ei,bn=Yt[10]*ei,Cn=Yt[11]*ei;for(const fr of Dt){const Sr=[],Cr=[];for(const xr of fr){const Vr=xr.x+ri.x,Br=xr.y+ri.y,Bs=Yt[0]*Vr+Yt[4]*Br+Yt[12],Rs=Yt[1]*Vr+Yt[5]*Br+Yt[13],lr=Yt[2]*Vr+Yt[6]*Br+Yt[14],fs=Yt[3]*Vr+Yt[7]*Br+Yt[15],xs=Bs+pi,Qs=Rs+Tn,bo=lr+ln,ko=Math.max(fs+$i,1e-5),wo=Bs+Di,ho=Rs+Kn,Co=lr+bn,No=Math.max(fs+Cn,1e-5);Sr.push(new de(xs/ko,Qs/ko,bo/ko)),Cr.push(new de(wo/No,ho/No,Co/No))}yi.push(Sr),Fi.push(Cr)}return[yi,Fi]}(ce,he,Se,$e,Be)}(d,h,L,b,z,_,q,P,R,d.center.lat,a.tileID.canonical),ie=a.queryGeometry;return function(K,ce,he){let Se=1/0;zn(he,ce)&&(Se=Bn(he,ce[0]));for(let $e=0;$e<ce.length;$e++){const Be=ce[$e],Ve=K[$e];for(let Mt=0;Mt<Be.length-1;Mt++){const Ne=Be[Mt],ft=[Ne,Be[Mt+1],Ve[Mt+1],Ve[Mt],Ne];gi(he,ft)&&(Se=Math.min(Se,Bn(he,ft)))}}return Se!==1/0&&Se}(Z,te,ie.isPointQuery()?ie.screenBounds:ie.screenGeometry)}},line:class extends Ko{constructor(a,t,r,h){const g=Mr();super(a,g,t,r,h),g.layout&&(this.layout=new mh(g.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof od,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,t){super.recalculate(a,t),this.paint._values["line-floorwidth"]=(()=>{if(cs)return cs;const r=Mr();return cs=new rs(r.paint.properties["line-width"].specification),cs.useIntegerZoom=!0,cs})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new zp(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,t,r){const h=sn(this);return{config:new fc(this,{zoom:t,lut:r}),defines:h,overrideFog:!1}}queryRadius(a){const t=a,r=oo(Ss("line-width",this,t),Ss("line-gap-width",this,t)),h=Ss("line-offset",this,t);return r/2+Math.abs(h)+br(this.paint.get("line-translate"))}queryIntersectsFeature(a,t,r,h,g,d){if(a.queryGeometry.isAboveHorizon)return!1;const _=ds(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,a.pixelToTileUnitsFactor),T=a.pixelToTileUnitsFactor/2*oo(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),I=this.paint.get("line-offset").evaluate(t,r);return I&&(h=function(z,b){const L=[],P=new Ye(0,0);for(let C=0;C<z.length;C++){const R=z[C],F=[];for(let q=0;q<R.length;q++){const Z=R[q],te=R[q+1],ie=q===0?P:Z.sub(R[q-1])._unit()._perp(),K=q===R.length-1?P:te.sub(Z)._unit()._perp(),ce=ie._add(K)._unit();ce._mult(1/(ce.x*K.x+ce.y*K.y)),F.push(ce._mult(b)._add(Z))}L.push(F)}return L}(h,I*a.pixelToTileUnitsFactor)),function(z,b,L){for(let P=0;P<b.length;P++){const C=b[P];if(z.length>=3){for(let R=0;R<C.length;R++)if(Nr(z,C[R]))return!0}if($n(z,C,L))return!0}return!1}(_,h,T)}isTileClipped(){return!0}isDraped(a){const t=this.layout.get("line-z-offset"),r=t.isConstant()&&!t.constantOr(0),h=this.layout.get("line-elevation-reference");return!(h==="sea"||h==="ground")&&(r||h!=="none")}},symbol:Zy,background:class extends Ko{constructor(a,t,r,h){super(a,{layout:t2||(t2=new Ts({visibility:new qi(Qt.layout_background.visibility)})),paint:i2||(i2=new Ts({"background-pitch-alignment":new qi(Qt.paint_background["background-pitch-alignment"]),"background-color":new qi(Qt.paint_background["background-color"]),"background-pattern":new qi(Qt.paint_background["background-pattern"]),"background-opacity":new qi(Qt.paint_background["background-opacity"]),"background-emissive-strength":new qi(Qt.paint_background["background-emissive-strength"])}))},t,r,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,t,r){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:a2,"raster-particle":p2,sky:class extends Ko{constructor(a,t,r,h){super(a,{layout:u2||(u2=new Ts({visibility:new qi(Qt.layout_sky.visibility)})),paint:h2||(h2=new Ts({"sky-type":new qi(Qt.paint_sky["sky-type"]),"sky-atmosphere-sun":new qi(Qt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new qi(Qt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new qi(Qt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new qi(Qt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Au(Qt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new qi(Qt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new qi(Qt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new qi(Qt.paint_sky["sky-opacity"])}))},t,r,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(a,t){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),g=!h,d=a.style.light,_=d.properties.get("position");return g&&d.properties.get("anchor")==="viewport"&&Wn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?Zx(_.azimuthal,90-_.polar,t):Zx(h[0],90-h[1],t)}const r=this.paint.get("sky-gradient-center");return Zx(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Ko{constructor(a,t,r,h){super(a,{paint:d2||(d2=new Ts({}))},t,null)}},model:class extends Ko{constructor(a,t,r,h){super(a,{layout:T2||(T2=new Ts({visibility:new qi(Qt.layout_model.visibility),"model-id":new yn(Qt.layout_model["model-id"])})),paint:M2||(M2=new Ts({"model-opacity":new qi(Qt.paint_model["model-opacity"]),"model-rotation":new yn(Qt.paint_model["model-rotation"]),"model-scale":new yn(Qt.paint_model["model-scale"]),"model-translation":new yn(Qt.paint_model["model-translation"]),"model-color":new yn(Qt.paint_model["model-color"]),"model-color-mix-intensity":new yn(Qt.paint_model["model-color-mix-intensity"]),"model-type":new qi(Qt.paint_model["model-type"]),"model-cast-shadows":new qi(Qt.paint_model["model-cast-shadows"]),"model-receive-shadows":new qi(Qt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new qi(Qt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new yn(Qt.paint_model["model-emissive-strength"]),"model-roughness":new yn(Qt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new yn(Qt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new qi(Qt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new qi(Qt.paint_model["model-front-cutoff"])}))},t,r,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Kx(a)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof iv?un-1:0}queryIntersectsFeature(a,t,r,h,g,d){if(!this.modelManager)return!1;const _=this.modelManager,T=a.tile.getBucket(this);if(!(T&&T instanceof Kx))return!1;const I=T;for(const z in I.instancesPerModel){const b=I.instancesPerModel[z],L=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(b.idToFeaturesIndex.hasOwnProperty(L)){const P=b.features[b.idToFeaturesIndex[L]],C=_.getModel(z,this.scope);if(!C)return!1;let R=ot.mat4.create();const F=new j(0,0),q=I.canonical;let Z=Number.MAX_VALUE;for(let te=0;te<P.instancedDataCount;++te){const ie=16*(P.instancedDataOffset+te),K=b.instancedDataArray.float32,ce=[K[ie+4],K[ie+5],K[ie+6]];I2(q,F,K[ie],0|K[ie+1]),S2(R,C,d,F,P.rotation,P.scale,ce,!1,!1,!1),d.projection.name==="globe"&&(R=Yx(R,d));const he=ot.mat4.multiply([],d.projMatrix,R),Se=a.queryGeometry,$e=y2(Se.isPointQuery()?Se.screenBounds:Se.screenGeometry,d,he,C.aabb);$e!=null&&(Z=Math.min($e,Z))}return Z!==Number.MAX_VALUE&&Z}}return!1}_handleOverridablePaintPropertyUpdate(a,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const t=this._transitionablePaint._values[a];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof ol}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(a,t,r,h){const g=a.tile,d=g.getBucket(this);let _=null,T=Number.MAX_VALUE;if(!(d&&d instanceof iv))return{queryFeature:_,intersectionZ:T};const I=d.getNodesInfo()[t];if(I.hiddenByReplacement||!I.node.meshes||!r.filter(new eo(g.tileID.overscaledZ),I.feature,g.tileID.canonical))return{queryFeature:_,intersectionZ:T};const z=I.node,b=h.calculatePosMatrix(g.tileID.toUnwrapped(),h.worldSize),L=I.evaluatedScale;let P=0;h.elevation&&z.elevation&&(P=z.elevation*h.elevation.exaggeration()),ot.mat4.translate(b,b,[(z.anchor?z.anchor[0]:0)*(L[0]-1),(z.anchor?z.anchor[1]:0)*(L[1]-1),P]),ot.mat4.scale(b,b,L);const C=a.queryGeometry,R=C.isPointQuery()?C.screenBounds:C.screenGeometry,F=function(K){const ce=ot.mat4.multiply([],b,K.matrix);ot.mat4.multiply(ce,h.expandedFarZProjMatrix,ce);for(let he=0;he<K.meshes.length;++he){const Se=K.meshes[he];if(he===K.lightMeshIndex)continue;const $e=y2(R,h,ce,Se.aabb);$e!=null&&(T=Math.min($e,T))}if(K.children)for(const he of K.children)F(he)};if(F(z),T===Number.MAX_VALUE)return{queryFeature:_,intersectionZ:T};const q=new j(0,0);I2(g.tileID.canonical,q,I.node.anchor[0],I.node.anchor[1]);const{z:Z,x:te,y:ie}=g.tileID.canonical;return _=new l0({},Z,te,ie,I.feature.id),_.properties=I.feature.properties,_.geometry={type:"Point",coordinates:[q.lng,q.lat]},_.layer={...this.serialize(),id:this.fqid},_.state={},_.tile=g.tileID.canonical,{queryFeature:_,intersectionZ:T}}},clip:class extends Ko{constructor(a,t,r,h){super(a,{layout:Fo||(Fo=new Ts({"clip-layer-types":new qi(Qt.layout_clip["clip-layer-types"]),"clip-layer-scope":new qi(Qt.layout_clip["clip-layer-scope"])})),paint:sm||(sm=new Ts({}))},t,r,h)}recalculate(a,t){super.recalculate(a,t)}createBucket(a){return new om(a)}isTileClipped(){return!0}is3D(){return!0}}};class pI{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fI{constructor(){this.tasks={},this.taskQueue=[],jn(["process"],this),this.invoker=new pI(this.process),this.nextId=0}add(t,r){const h=this.nextId++,g=function({type:d,isSymbolTile:_,zoom:T}){return T=T||0,d==="message"?0:d!=="maybePrepare"||_?d!=="parseTile"||_?d==="parseTile"&&_?300-T:d==="maybePrepare"&&_?400-T:500:200-T:100-T}(r);if(g===0){try{t()}finally{}return null}return this.tasks[h]={fn:t,metadata:r,priority:g,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let g=0;g<this.taskQueue.length;g++){const d=this.tasks[this.taskQueue[g]];d.priority<r&&(r=d.priority,t=g)}if(t===null)return null;const h=this.taskQueue[t];return this.taskQueue.splice(t,1),h}remove(){this.invoker.remove()}}class R2{constructor(t,r,h){this.target=t,this.parent=r,this.mapId=h,this.callbacks={},this.cancelCallbacks={},jn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new fI}send(t,r,h,g,d=!1,_){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=_,this.callbacks[T]=h);const I=new Set;return this.target.postMessage({id:T,type:t,hasCallback:!!h,targetMapId:g,mustQueue:d,sourceMapId:this.mapId,data:lc(r,I)},I),{cancel:()=>{h&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(t){const r=t.data,h=r.id;if(h&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const g=this.cancelCallbacks[h];delete this.cancelCallbacks[h],g&&g.cancel()}else if(r.mustQueue||_s()){const g=this.callbacks[h],d=this.scheduler.add(()=>this.processTask(h,r),g&&g.metadata||{type:"message"});d&&(this.cancelCallbacks[h]=d)}else this.processTask(h,r)}processTask(t,r){if(delete this.cancelCallbacks[t],r.type==="<response>"){const h=this.callbacks[t];delete this.callbacks[t],h&&(r.error?h(Oa(r.error)):h(null,Oa(r.data)))}else{const h=new Set,g=r.hasCallback?(_,T)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:_?lc(_):null,data:lc(T,h)},h)}:()=>{},d=Oa(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,d,g);else if(this.parent.getWorkerSource){const _=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,_[0],d.source,d.scope)[_[1]](d,g)}else g(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class wg{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Fn();const h=this.workerPool.acquire(this.id);for(let g=0;g<h.length;g++){const d=new wg.Actor(h[g],r,this.id);d.name=`Worker ${g}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,r,h){an(this.actors,(g,d)=>{g.send(t,r,d)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}wg.Actor=R2;class P2{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const h=this.toIdx(t,r);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function D2(a,t,r,h){let g=0,d=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(h[_])<1e-15){if(r[_]<a[_]||r[_]>t[_])return null}else{const T=1/h[_];let I=(a[_]-r[_])*T,z=(t[_]-r[_])*T;if(I>z){const b=I;I=z,z=b}if(I>g&&(g=I),z<d&&(d=z),g>d)return null}return g}function O2(a,t,r,h,g,d,_,T,I,z,b){const L=h-a,P=g-t,C=d-r,R=_-a,F=T-t,q=I-r,Z=b[1]*q-b[2]*F,te=b[2]*R-b[0]*q,ie=b[0]*F-b[1]*R,K=L*Z+P*te+C*ie;if(Math.abs(K)<1e-15)return null;const ce=1/K,he=z[0]-a,Se=z[1]-t,$e=z[2]-r,Be=(he*Z+Se*te+$e*ie)*ce;if(Be<0||Be>1)return null;const Ve=Se*C-$e*P,Mt=$e*L-he*C,Ne=he*P-Se*L,ft=(b[0]*Ve+b[1]*Mt+b[2]*Ne)*ce;return ft<0||Be+ft>1?null:(R*Ve+F*Mt+q*Ne)*ce}function z2(a,t,r){return(a-t)/(r-t)}function k2(a,t,r,h,g,d,_,T,I){const z=1<<r,b=d-h,L=_-g,P=(a+1)/z*b+h,C=(t+0)/z*L+g,R=(t+1)/z*L+g;T[0]=(a+0)/z*b+h,T[1]=C,I[0]=P,I[1]=R}class F2{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(d){const _=Math.ceil(Math.log2(d.dim/8)),T=[];let I=Math.ceil(Math.pow(2,_));const z=1/I,b=(C,R,F,q,Z)=>{const te=q?1:0,ie=(C+1)*F-te,K=R*F,ce=(R+1)*F-te;Z[0]=C*F,Z[1]=K,Z[2]=ie,Z[3]=ce};let L=new P2(I);const P=[];for(let C=0;C<I*I;C++){b(C%I,Math.floor(C/I),z,!1,P);const R=Up(P[0],P[1],d),F=Up(P[2],P[1],d),q=Up(P[2],P[3],d),Z=Up(P[0],P[3],d);L.minimums.push(Math.min(R,F,q,Z)),L.maximums.push(Math.max(R,F,q,Z)),L.leaves.push(1)}for(T.push(L),I/=2;I>=1;I/=2){const C=T[T.length-1];L=new P2(I);for(let R=0;R<I*I;R++){b(R%I,Math.floor(R/I),2,!0,P);const F=C.getElevation(P[0],P[1]),q=C.getElevation(P[2],P[1]),Z=C.getElevation(P[2],P[3]),te=C.getElevation(P[0],P[3]),ie=C.isLeaf(P[0],P[1]),K=C.isLeaf(P[2],P[1]),ce=C.isLeaf(P[2],P[3]),he=C.isLeaf(P[0],P[3]),Se=Math.min(F.min,q.min,Z.min,te.min),$e=Math.max(F.max,q.max,Z.max,te.max),Be=ie&&K&&ce&&he;L.maximums.push($e),L.minimums.push(Se),L.leaves.push($e-Se<=5&&Be?1:0)}T.push(L)}return T}(this.dem),h=r.length-1,g=r[h];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(r,0,0,h,0)}raycastRoot(t,r,h,g,d,_,T=1){return D2([t,r,-100],[h,g,this.maximums[0]*T],d,_)}raycast(t,r,h,g,d,_,T=1){if(!this.nodeCount)return null;const I=this.raycastRoot(t,r,h,g,d,_,T);if(I==null)return null;const z=[],b=[],L=[],P=[],C=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;C.length>0;){const{idx:R,t:F,nodex:q,nodey:Z,depth:te}=C.pop();if(this.leaves[R]){k2(q,Z,te,t,r,h,g,L,P);const K=1<<te,ce=(q+0)/K,he=(q+1)/K,Se=(Z+0)/K,$e=(Z+1)/K,Be=Up(ce,Se,this.dem)*T,Ve=Up(he,Se,this.dem)*T,Mt=Up(he,$e,this.dem)*T,Ne=Up(ce,$e,this.dem)*T,ft=O2(L[0],L[1],Be,P[0],L[1],Ve,P[0],P[1],Mt,d,_),Pt=O2(P[0],P[1],Mt,L[0],P[1],Ne,L[0],L[1],Be,d,_),Dt=Math.min(ft!==null?ft:Number.MAX_VALUE,Pt!==null?Pt:Number.MAX_VALUE);if(Dt!==Number.MAX_VALUE)return Dt;{const Ut=ot.vec3.scaleAndAdd([],d,_,F);if(B2(Be,Ve,Ne,Mt,z2(Ut[0],L[0],P[0]),z2(Ut[1],L[1],P[1]))>=Ut[2])return F}continue}let ie=0;for(let K=0;K<this._siblingOffset.length;K++){k2((q<<1)+this._siblingOffset[K][0],(Z<<1)+this._siblingOffset[K][1],te+1,t,r,h,g,L,P),L[2]=-100,P[2]=this.maximums[this.childOffsets[R]+K]*T;const ce=D2(L,P,d,_);if(ce!=null){const he=ce;z[K]=he;let Se=!1;for(let $e=0;$e<ie&&!Se;$e++)he>=z[b[$e]]&&(b.splice($e,0,K),Se=!0);Se||(b[ie]=K),ie++}}for(let K=0;K<ie;K++){const ce=b[K];C.push({idx:this.childOffsets[R]+ce,t:z[ce],nodex:(q<<1)+this._siblingOffset[ce][0],nodey:(Z<<1)+this._siblingOffset[ce][1],depth:te+1})}}return null}_addNode(t,r,h){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,h,g,d){if(t[g].isLeaf(r,h)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const _=g-1,T=t[_];let I=0,z=0;for(let b=0;b<this._siblingOffset.length;b++){const L=2*r+this._siblingOffset[b][0],P=2*h+this._siblingOffset[b][1],C=T.getElevation(L,P),R=T.isLeaf(L,P),F=this._addNode(C.min,C.max,R);R&&(I|=1<<b),z||(z=F)}for(let b=0;b<this._siblingOffset.length;b++)I&1<<b||this._construct(t,2*r+this._siblingOffset[b][0],2*h+this._siblingOffset[b][1],_,z+b)}}function B2(a,t,r,h,g,d){return Pe(Pe(a,r,d),Pe(t,h,d),g)}function Up(a,t,r){const h=r.dim,g=It(a*h-.5,0,h-1),d=It(t*h-.5,0,h-1),_=Math.floor(g),T=Math.floor(d),I=Math.min(_+1,h-1),z=Math.min(T+1,h-1);return B2(r.get(_,T),r.get(I,T),r.get(_,z),r.get(I,z),g-_,d-T)}const mI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function gI(a,t,r){return(256*a*256+256*t+r)/10-1e4}function _I(a,t,r){return 256*a+t+r/256-32768}class nv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,h,g=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void Wn(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const d=this.dim=r.height-2,_=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let I=0;I<d;I++)_[this._idx(-1,I)]=_[this._idx(0,I)],_[this._idx(d,I)]=_[this._idx(d-1,I)],_[this._idx(I,-1)]=_[this._idx(I,0)],_[this._idx(I,d)]=_[this._idx(I,d-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(d,-1)]=_[this._idx(d-1,0)],_[this._idx(-1,d)]=_[this._idx(0,d-1)],_[this._idx(d,d)]=_[this._idx(d-1,d-1)]}const T=h==="terrarium"?_I:gI;for(let I=0;I<_.length;++I){const z=4*I;this.floatView[I]=T(this.pixels[z],this.pixels[z+1],this.pixels[z+2])}this._timestamp=tn.now()}_buildQuadTree(){this._tree=new F2(this)}get(t,r,h=!1){h&&(t=It(t,-1,this.dim),r=It(r,-1,this.dim));const g=this._idx(t,r);return this.floatView[g]}set(t,r,h){const g=this._idx(t,r),d=this.floatView[g];return this.floatView[g]=h,h-d}static getUnpackVector(t){return mI[t]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}static pack(t,r){const h=[0,0,0,0],g=nv.getUnpackVector(r);let d=Math.floor((t+g[3])/g[2]);return h[2]=d%256,d=Math.floor(d/256),h[1]=d%256,d=Math.floor(d/256),h[0]=d,h}getPixels(){return new vy({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,h){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let g=r*this.dim,d=r*this.dim+this.dim,_=h*this.dim,T=h*this.dim+this.dim;switch(r){case-1:g=d-1;break;case 1:d=g+1}switch(h){case-1:_=T-1;break;case 1:T=_+1}const I=-r*this.dim,z=-h*this.dim;for(let b=_;b<T;b++)for(let L=g;L<d;L++){const P=4*this._idx(L,b),C=4*this._idx(L+I,b+z);this.pixels[P+0]=t.pixels[C+0],this.pixels[P+1]=t.pixels[C+1],this.pixels[P+2]=t.pixels[C+2],this.pixels[P+3]=t.pixels[C+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function yI(a,t,r){a===1?t.headerLength=r.readFixed32():a===2?t.x=r.readVarint():a===3?t.y=r.readVarint():a===4?t.z=r.readVarint():a===5&&t.layers.push(function(h,g){return h.readFields(TI,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},g)}(r,r.readVarint()+r.pos))}function vI(a,t,r){a===1?(t.delta_filter=function(h,g){return h.readFields(xI,{blockSize:0},g)}(r,r.readVarint()+r.pos),t.filter="delta_filter"):a===2?(r.readVarint(),t.filter="zigzag_filter"):a===3?(r.readVarint(),t.filter="bitshuffle_filter"):a===4&&(r.readVarint(),t.filter="byteshuffle_filter")}function xI(a,t,r){a===1&&(t.blockSize=r.readVarint())}function bI(a,t,r){a===1?(r.readVarint(),t.codec="gzip_data"):a===2?(r.readVarint(),t.codec="jpeg_image"):a===3?(r.readVarint(),t.codec="webp_image"):a===4&&(r.readVarint(),t.codec="png_image")}function wI(a,t,r){let h=0,g=0;a===1?t.firstByte=r.readFixed64():a===2?t.lastByte=r.readFixed64():a===3?t.filters.push(function(d,_){return d.readFields(vI,{},_)}(r,r.readVarint()+r.pos)):a===4?t.codec=function(d,_){return d.readFields(bI,{},_)}(r,r.readVarint()+r.pos):a===5?g=r.readFloat():a===6?h=r.readFloat():a===7?t.bands.push(r.readString()):a===8?t.offset=r.readDouble():a===9&&(t.scale=r.readDouble()),t.offset===0&&(t.offset=g),t.scale===0&&(t.scale=h)}function TI(a,t,r){a===1?t.version=r.readVarint():a===2?t.name=r.readString():a===3?t.units=r.readString():a===4?t.tileSize=r.readVarint():a===5?t.buffer=r.readVarint():a===6?t.pixelFormat=r.readVarint():a===7&&t.dataIndex.push(function(h,g){return h.readFields(wI,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},g)}(r,r.readVarint()+r.pos))}function MI(a,t,r){if(a===2)(function(h,g,d){h.readFields(SI,d,g)})(r,r.readVarint()+r.pos,t);else if(a===3)throw new Error("Not implemented")}function SI(a,t,r){if(a===1){let h=0;const g=r.readVarint()+r.pos;for(;r.pos<g;)t[h++]=r.readVarint()}}Sn(nv,"DEMData"),Sn(F2,"DemMinMaxQuadTree",{omit:["dem"]});class EI{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const r=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,r),r}put(t,r){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,r)}}function AI(a,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let r=t[3];for(let h=2;h>=1;h--){const g=h===1?1:0,d=h===2?1:0;for(let _=0;_<t[0];_++){const T=t[1]*_;for(let I=g;I<t[1];I++){const z=t[2]*(I+T);for(let b=d;b<t[2];b++){const L=t[3]*(b+z);for(let P=0;P<t[3];P++){const C=L+P;a[C]+=a[C-r]}}}}r*=t[h]}return a}function CI(a){for(let t=0,r=a.length;t<r;t++)a[t]=a[t]>>>1^-(1&a[t]);return a}function LI(a,t){switch(t){case"uint32":return a;case"uint16":for(let r=0;r<a.length;r+=2){const h=a[r],g=a[r+1];a[r]=(240&h)>>4|(61440&h)>>8|(240&g)<<4|61440&g,a[r+1]=15&h|(3840&h)>>4|(15&g)<<8|(3840&g)<<4}return a;case"uint8":for(let r=0;r<a.length;r+=4){const h=a[r],g=a[r+1],d=a[r+2],_=a[r+3];a[r+0]=(192&h)>>6|(192&g)>>4|(192&d)>>2|192&_,a[r+1]=(48&h)>>4|(48&g)>>2|48&d|(48&_)<<2,a[r+2]=(12&h)>>2|12&g|(12&d)<<2|(12&_)<<4,a[r+3]=3&h|(3&g)<<2|(3&d)<<4|(3&_)<<6}return a;default:throw new Error(`Invalid pixel format, "${t}"`)}}var vc=Uint8Array,c0=Uint16Array,II=Int32Array,N2=new vc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),U2=new vc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),RI=new vc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V2=function(a,t){for(var r=new c0(31),h=0;h<31;++h)r[h]=t+=1<<a[h-1];var g=new II(r[30]);for(h=1;h<30;++h)for(var d=r[h];d<r[h+1];++d)g[d]=d-r[h]<<5|h;return{b:r,r:g}},G2=V2(N2,2),H2=G2.b,PI=G2.r;H2[28]=258,PI[258]=28;for(var DI=V2(U2,0).b,j2=new c0(32768),zo=0;zo<32768;++zo){var Tg=(43690&zo)>>1|(21845&zo)<<1;j2[zo]=((65280&(Tg=(61680&(Tg=(52428&Tg)>>2|(13107&Tg)<<2))>>4|(3855&Tg)<<4))>>8|(255&Tg)<<8)>>1}var u0=function(a,t,r){for(var h=a.length,g=0,d=new c0(t);g<h;++g)a[g]&&++d[a[g]-1];var _,T=new c0(t);for(g=1;g<t;++g)T[g]=T[g-1]+d[g-1]<<1;_=new c0(1<<t);var I=15-t;for(g=0;g<h;++g)if(a[g])for(var z=g<<4|a[g],b=t-a[g],L=T[a[g]-1]++<<b,P=L|(1<<b)-1;L<=P;++L)_[j2[L]>>I]=z;return _},h0=new vc(288);for(zo=0;zo<144;++zo)h0[zo]=8;for(zo=144;zo<256;++zo)h0[zo]=9;for(zo=256;zo<280;++zo)h0[zo]=7;for(zo=280;zo<288;++zo)h0[zo]=8;var W2=new vc(32);for(zo=0;zo<32;++zo)W2[zo]=5;var OI=u0(h0,9),zI=u0(W2,5),t1=function(a){for(var t=a[0],r=1;r<a.length;++r)a[r]>t&&(t=a[r]);return t},ju=function(a,t,r){var h=t/8|0;return(a[h]|a[h+1]<<8)>>(7&t)&r},i1=function(a,t){var r=t/8|0;return(a[r]|a[r+1]<<8|a[r+2]<<16)>>(7&t)},kI=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Wu=function(a,t,r){var h=new Error(t||kI[a]);if(h.code=a,Error.captureStackTrace&&Error.captureStackTrace(h,Wu),!r)throw h;return h},FI=new vc(0),BI=typeof TextDecoder<"u"&&new TextDecoder;try{BI.decode(FI,{stream:!0})}catch{}const NI={gzip_data:"gzip"};class ru extends Error{constructor(t){super(t),this.name="MRTError"}}const UI={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},q2={uint32:1,uint16:2,uint8:4},VI={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let n1;class r1{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const r=this.layers[t];if(!r)throw new ru(`Layer '${t}' not found`);return r}getHeaderLength(t){const r=new Uint8Array(t),h=new DataView(t);if(r[0]!==13)throw new ru("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(t){const r=new Uint8Array(t),h=this.getHeaderLength(t);if(r.length<h)throw new ru(`Expected header with length >= ${h} but got buffer of length ${r.length}`);const g=function(d,_){return d.readFields(yI,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new n1(r.subarray(0,h)));if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new ru(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const d of g.layers)this.layers[d.name]=new GI(d,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const r=[],h=this.getLayer(t.layerName);for(let g of t.blockIndices){const d=h.dataIndex[g],_=d.firstByte-t.firstByte,T=d.lastByte-t.firstByte;if(h._blocksInProgress.has(g))continue;const I={layerName:h.name,firstByte:_,lastByte:T,pixelFormat:h.pixelFormat,blockIndex:g,blockShape:[d.bands.length].concat(h.bandShape),buffer:h.buffer,codec:d.codec.codec,filters:d.filters.map(z=>z.filter)};h._blocksInProgress.add(g),r.push(I)}return new $2(r,()=>{r.forEach(g=>h._blocksInProgress.delete(g.blockIndex))},(g,d)=>{if(r.forEach(_=>h._blocksInProgress.delete(_.blockIndex)),g)throw g;d.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class GI{constructor({version:t,name:r,units:h,tileSize:g,pixelFormat:d,buffer:_,dataIndex:T},I){if(this.version=t,this.version!==1)throw new ru(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=r,this.units=h,this.tileSize=g,this.buffer=_,this.pixelFormat=UI[d],this.dataIndex=T,this.bandShape=[g+2*_,g+2*_,q2[this.pixelFormat]],this._decodedBlocks=new EI(I?I.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return q2[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const r=t.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,t.data)}getBlockForBand(t){let r=0;switch(typeof t){case"string":for(const[h,g]of this.dataIndex.entries()){for(const[d,_]of g.bands.entries())if(_===t)return{bandIndex:r+d,blockIndex:h,blockBandIndex:d};r+=g.bands.length}break;case"number":for(const[h,g]of this.dataIndex.entries()){if(t>=r&&t<r+g.bands.length)return{bandIndex:t,blockIndex:h,blockBandIndex:t-r};r+=g.bands.length}break;default:throw new ru(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new ru(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let r=1/0,h=-1/0;const g=[],d=new Set;for(const _ of t){const{blockIndex:T}=this.getBlockForBand(_);if(T<0)throw new ru(`Invalid band: ${JSON.stringify(_)}`);const I=this.dataIndex[T];g.includes(T)||g.push(T),d.add(T),r=Math.min(r,I.firstByte),h=Math.max(h,I.lastByte)}if(d.size>this.cacheSize)throw new ru(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:h,blockIndices:g}}hasBand(t){const{blockIndex:r}=this.getBlockForBand(t);return r>=0}hasDataForBand(t){const{blockIndex:r}=this.getBlockForBand(t);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(t){const{blockIndex:r,blockBandIndex:h}=this.getBlockForBand(t),g=this._decodedBlocks.get(r.toString());if(!g)throw new ru(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[r],_=this.bandShape.reduce((z,b)=>z*b,1),T=h*_,I=g.subarray(T,T+_);return{data:I,bytes:new Uint8Array(I.buffer).subarray(I.byteOffset,I.byteOffset+I.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}r1.setPbf=function(a){n1=a};class $2{constructor(t,r,h){this.tasks=t,this._onCancel=r,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,r){this._finalized||(this._onComplete(t,r),this._finalized=!0)}}r1.performDecoding=function(a,t){const r=new Uint8Array(a);return Promise.all(t.tasks.map(h=>{const{layerName:g,firstByte:d,lastByte:_,pixelFormat:T,blockShape:I,blockIndex:z,filters:b,codec:L}=h,P=r.subarray(d,_+1),C=new Uint32Array(I[0]*I[1]*I[2]);let R;if(L!=="gzip_data")throw new ru(`Unhandled codec: ${L}`);return R=function(F,q){if(!globalThis.DecompressionStream&&q==="gzip_data")return Promise.resolve(((K=function(Se){Se[0]==31&&Se[1]==139&&Se[2]==8||Wu(6,"invalid gzip data");var $e=Se[3],Be=10;4&$e&&(Be+=2+(Se[10]|Se[11]<<8));for(var Ve=($e>>3&1)+($e>>4&1);Ve>0;Ve-=!Se[Be++]);return Be+(2&$e)}(ie=F))+8>ie.length&&Wu(6,"invalid gzip data"),function(Se,$e,Be,Ve){var Mt=Se.length;if(!Mt||$e.f&&!$e.l)return Be||new vc(0);var Ne=!Be,ft=Ne||$e.i!=2,Pt=$e.i;Ne&&(Be=new vc(3*Mt));var Dt,Ut,ei=function(Vp){var hm=Be.length;if(Vp>hm){var y0=new vc(Math.max(2*hm,Vp));y0.set(Be),Be=y0}},ri=$e.f||0,Yt=$e.p||0,yi=$e.b||0,Fi=$e.l,pi=$e.d,Tn=$e.m,ln=$e.n,$i=8*Mt;do{if(!Fi){ri=ju(Se,Yt,1);var Di=ju(Se,Yt+1,3);if(Yt+=3,!Di){var Kn=Se[(lr=4+((Yt+7)/8|0))-4]|Se[lr-3]<<8,bn=lr+Kn;if(bn>Mt){Pt&&Wu(0);break}ft&&ei(yi+Kn),Be.set(Se.subarray(lr,bn),yi),$e.b=yi+=Kn,$e.p=Yt=8*bn,$e.f=ri;continue}if(Di==1)Fi=OI,pi=zI,Tn=9,ln=5;else if(Di==2){var Cn=ju(Se,Yt,31)+257,fr=ju(Se,Yt+10,15)+4,Sr=Cn+ju(Se,Yt+5,31)+1;Yt+=14;for(var Cr=new vc(Sr),xr=new vc(19),Vr=0;Vr<fr;++Vr)xr[RI[Vr]]=ju(Se,Yt+3*Vr,7);Yt+=3*fr;var Br=t1(xr),Bs=(1<<Br)-1,Rs=u0(xr,Br);for(Vr=0;Vr<Sr;){var lr,fs=Rs[ju(Se,Yt,Bs)];if(Yt+=15&fs,(lr=fs>>4)<16)Cr[Vr++]=lr;else{var xs=0,Qs=0;for(lr==16?(Qs=3+ju(Se,Yt,3),Yt+=2,xs=Cr[Vr-1]):lr==17?(Qs=3+ju(Se,Yt,7),Yt+=3):lr==18&&(Qs=11+ju(Se,Yt,127),Yt+=7);Qs--;)Cr[Vr++]=xs}}var bo=Cr.subarray(0,Cn),ko=Cr.subarray(Cn);Tn=t1(bo),ln=t1(ko),Fi=u0(bo,Tn),pi=u0(ko,ln)}else Wu(1);if(Yt>$i){Pt&&Wu(0);break}}ft&&ei(yi+131072);for(var wo=(1<<Tn)-1,ho=(1<<ln)-1,Co=Yt;;Co=Yt){var No=(xs=Fi[i1(Se,Yt)&wo])>>4;if((Yt+=15&xs)>$i){Pt&&Wu(0);break}if(xs||Wu(2),No<256)Be[yi++]=No;else{if(No==256){Co=Yt,Fi=null;break}var Aa=No-254;No>264&&(Aa=ju(Se,Yt,(1<<($u=N2[Vr=No-257]))-1)+H2[Vr],Yt+=$u);var Zs=pi[i1(Se,Yt)&ho],Ol=Zs>>4;if(Zs||Wu(3),Yt+=15&Zs,ko=DI[Ol],Ol>3){var $u=U2[Ol];ko+=i1(Se,Yt)&(1<<$u)-1,Yt+=$u}if(Yt>$i){Pt&&Wu(0);break}ft&&ei(yi+131072);var su=yi+Aa;if(yi<ko){var ou=0-ko,um=Math.min(ko,su);for(ou+yi<0&&Wu(3);yi<um;++yi)Be[yi]=(void 0)[ou+yi]}for(;yi<su;++yi)Be[yi]=Be[yi-ko]}}$e.l=Fi,$e.p=Co,$e.b=yi,$e.f=ri,Fi&&(ri=1,$e.m=Tn,$e.d=pi,$e.n=ln)}while(!ri);return yi!=Be.length&&Ne?(Dt=Be,((Ut=yi)==null||Ut>Dt.length)&&(Ut=Dt.length),new vc(Dt.subarray(0,Ut))):Be.subarray(0,yi)}(ie.subarray(K,-8),{i:2},new vc(((Z=ie)[(te=Z.length)-4]|Z[te-3]<<8|Z[te-2]<<16|Z[te-1]<<24)>>>0))));var Z,te,ie,K;const ce=NI[q];if(!ce)throw new Error(`Unhandled codec: ${q}`);const he=new globalThis.DecompressionStream(ce);return new Response(new Blob([F]).stream().pipeThrough(he)).arrayBuffer().then(Se=>new Uint8Array(Se))}(P,L).then(F=>(function(q,Z){q.readFields(MI,Z)}(new n1(F),C),new VI[T](C.buffer))),R.then(F=>{for(let q=b.length-1;q>=0;q--)switch(b[q]){case"delta_filter":AI(F,I);break;case"zigzag_filter":CI(F);break;case"bitshuffle_filter":LI(F,T);break;default:throw new ru(`Unhandled filter "${b[q]}"`)}return{layerName:g,blockIndex:z,data:F}}).catch(F=>{throw F})}))},Sn($2,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var d0={workerUrl:"",workerClass:null,workerParams:void 0};const s1="mapboxgl_preloaded_worker_pool";class p0{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<p0.workerCount;)this.workers.push(d0.workerClass!=null?new d0.workerClass:new self.Worker(d0.workerUrl,d0.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[s1]}numActive(){return Object.keys(this.active).length}}let f0;function rv(){return f0||(f0=new p0),f0}p0.workerCount=2;let m0,o1,qu,Mg,a1,Sg=null;function Z2(){return _s()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:o1||Je.DRACO_URL}function X2(){if(_s()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Mg)return Mg;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Mg=WebAssembly.validate(a)?Je.MESHOPT_SIMD_URL:Je.MESHOPT_URL,Mg}const sv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},HI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},g0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Y2(a,t,r){const h=r.json.bufferViews.length,g=r.buffers.length;t.bufferView=h,r.json.bufferViews[h]={buffer:g,byteLength:a.byteLength},r.buffers[g]=a}const l1="KHR_draco_mesh_compression";function jI(a,t){const r=a.extensions&&a.extensions[l1];if(!r)return;const h=new qu.Decoder,g=eM(t,r.bufferView),d=new qu.Mesh;if(!h.DecodeArrayToMesh(g,g.byteLength,d))throw new Error("Failed to decode Draco mesh");const _=t.json.accessors[a.indices],T=sv[_.componentType],I=_.count*T.BYTES_PER_ELEMENT,z=qu._malloc(I);T===Uint16Array?h.GetTrianglesUInt16Array(d,I,z):h.GetTrianglesUInt32Array(d,I,z),Y2(qu.memory.buffer.slice(z,z+I),_,t),qu._free(z);for(const b of Object.keys(r.attributes)){const L=h.GetAttributeByUniqueId(d,r.attributes[b]),P=t.json.accessors[a.attributes[b]],C=HI[P.componentType],R=P.count*g0[P.type]*sv[P.componentType].BYTES_PER_ELEMENT,F=qu._malloc(R);h.GetAttributeDataArrayForAllPoints(d,L,qu[C],R,F),Y2(qu.memory.buffer.slice(F,F+R),P,t),qu._free(F)}h.destroy(),d.destroy(),delete a.extensions[l1]}const ov="EXT_meshopt_compression";function WI(a,t){if(!a.extensions||!a.extensions[ov])return;const r=a.extensions[ov],h=new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),g=new Uint8Array(r.count*r.byteStride);a1.decodeGltfBuffer(g,r.count,r.byteStride,h,r.mode,r.filter),a.buffer=t.buffers.length,a.byteOffset=0,t.buffers[a.buffer]=g.buffer,delete a.extensions[ov]}const K2=1179937895,J2=new TextDecoder("utf8");function Q2(a,t){return new URL(a,t).href}function qI(a,t,r,h){return fetch(Q2(a.uri,h)).then(g=>g.arrayBuffer()).then(g=>{t.buffers[r]=g})}function eM(a,t){const r=a.json.bufferViews[t];return new Uint8Array(a.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function $I(a,t,r,h){if(a.uri){const g=Q2(a.uri,h);return fetch(g).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{t.images[r]=d})}if(a.bufferView!==void 0){const g=eM(t,a.bufferView),d=new Blob([g],{type:a.mimeType});return createImageBitmap(d).then(_=>{t.images[r]=_})}}function tM(a,t=0,r){const h={json:null,images:[],buffers:[]};if(new Uint32Array(a,t,1)[0]===K2){const b=new Uint32Array(a,t);let L=2;const P=(b[L++]>>2)-3,C=b[L++]>>2;if(L++,h.json=JSON.parse(J2.decode(b.subarray(L,L+C))),L+=C,L<P){const R=b[L++];L++;const F=t+(L<<2);h.buffers[0]=a.slice(F,F+R)}}else h.json=JSON.parse(J2.decode(new Uint8Array(a,t)));const{buffers:g,images:d,meshes:_,extensionsUsed:T,bufferViews:I}=h.json;let z=Promise.resolve();if(g){const b=[];for(let L=0;L<g.length;L++){const P=g[L];P.uri?b.push(qI(P,h,L,r)):h.buffers[L]||(h.buffers[L]=null)}z=Promise.all(b)}return z.then(()=>{const b=[],L=T&&T.includes(l1),P=T&&T.includes(ov);if(L&&b.push(function(){if(!qu)return m0??(m0=function(C){let R,F=null;function q(){R=new Uint8Array(F.buffer)}function Z(){throw new Error("Unexpected Draco error.")}const te={a:{a:Z,d:function(ie,K,ce){return R.copyWithin(ie,K,K+ce)},c:function(ie){const K=R.length,ce=Math.max(ie>>>0,Math.ceil(1.2*K)),he=Math.ceil((ce-K)/65536);try{return F.grow(he),q(),!0}catch{return!1}},b:Z}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(C,te):C.then(ie=>ie.arrayBuffer()).then(ie=>WebAssembly.instantiate(ie,te))).then(ie=>{const{Rb:K,Qb:ce,P:he,T:Se,X:$e,Ja:Be,La:Ve,Qa:Mt,Va:Ne,Wa:ft,eb:Pt,jb:Dt,f:Ut,e:ei,yb:ri,zb:Yt,Ab:yi,Bb:Fi,Db:pi,Gb:Tn}=ie.instance.exports;F=ei;const ln=(()=>{let $i=0,Di=0,Kn=0,bn=0;return Cn=>{Kn&&(K(bn),K($i),Di+=Kn,Kn=$i=0),$i||(Di+=128,$i=ce(Di));const fr=Cn.length+7&-8;let Sr=$i;fr>=Di&&(Kn=fr,Sr=bn=ce(fr));for(let Cr=0;Cr<Cn.length;Cr++)R[Sr+Cr]=Cn[Cr];return Sr}})();return q(),Ut(),{memory:ei,_free:K,_malloc:ce,Mesh:class{constructor(){this.ptr=he()}destroy(){Se(this.ptr)}},Decoder:class{constructor(){this.ptr=Be()}destroy(){Dt(this.ptr)}DecodeArrayToMesh($i,Di,Kn){const bn=ln($i),Cn=Ve(this.ptr,bn,Di,Kn.ptr);return!!$e(Cn)}GetAttributeByUniqueId($i,Di){return{ptr:Mt(this.ptr,$i.ptr,Di)}}GetTrianglesUInt16Array($i,Di,Kn){Ne(this.ptr,$i.ptr,Di,Kn)}GetTrianglesUInt32Array($i,Di,Kn){ft(this.ptr,$i.ptr,Di,Kn)}GetAttributeDataArrayForAllPoints($i,Di,Kn,bn,Cn){Pt(this.ptr,$i.ptr,Di.ptr,Kn,bn,Cn)}},DT_INT8:ri(),DT_UINT8:Yt(),DT_INT16:yi(),DT_UINT16:Fi(),DT_UINT32:pi(),DT_FLOAT32:Tn()}})}(fetch(Z2())),m0.then(C=>{qu=C,m0=void 0}))}()),P&&b.push(function(){if(a1)return;const C=function(R){let F;const q=WebAssembly.instantiateStreaming(R,{}).then(ie=>{F=ie.instance,F.exports.__wasm_call_ctors()}),Z={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},te={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:q,supported:!0,decodeGltfBuffer(ie,K,ce,he,Se,$e){(function(Be,Ve,Mt,Ne,ft,Pt,Dt){const Ut=Be.exports.sbrk,ei=Ne+3&-4,ri=Ut(ei*ft),Yt=Ut(Pt.length),yi=new Uint8Array(Be.exports.memory.buffer);yi.set(Pt,Yt);const Fi=Ve(ri,Ne,ft,Yt,Pt.length);if(Fi===0&&Dt&&Dt(ri,ei,ft),Mt.set(yi.subarray(ri,ri+Ne*ft)),Ut(ri-Ut(0)),Fi!==0)throw new Error(`Malformed buffer data: ${Fi}`)})(F,F.exports[te[Se]],ie,K,ce,he,F.exports[Z[$e]])}}}(fetch(X2()));return C.ready.then(()=>{a1=C})}()),d)for(let C=0;C<d.length;C++)b.push($I(d[C],h,C,r));return(b.length?Promise.all(b):Promise.resolve()).then(()=>{if(L&&_)for(const{primitives:C}of _)for(const R of C)jI(R,h);if(P&&_&&I)for(const C of I)WI(C,h);return h})})}function cm(a,t){const r=a.json.bufferViews[t.bufferView],h=sv[t.componentType];return new h(a.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*(r.byteStride&&r.byteStride!==g0[t.type]*h.BYTES_PER_ELEMENT?r.byteStride/h.BYTES_PER_ELEMENT:g0[t.type]))}function c1(a,t,r,h){const g=sv[t.componentType],d=function(b){switch(b){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),_=a.json.bufferViews[t.bufferView],T=_.byteStride?_.byteStride/g.BYTES_PER_ELEMENT:g0[t.type],I=r.float32,z=I.length/r.capacity;for(let b=0,L=0;b<t.count*T;b+=T,L+=z)for(let P=0;P<z;P++)I[L+P]=h[b+P]*d;r._trim()}function ZI(a,t,r){const h=a.indices,g=a.attributes,d={};d.indexArray=new qs;const _=t.json.accessors[h],T=_.count/3;d.indexArray.reserve(T);const I=cm(t,_);for(let P=0;P<T;P++)d.indexArray.emplaceBack(I[3*P],I[3*P+1],I[3*P+2]);d.indexArray._trim(),d.vertexArray=new uc;const z=t.json.accessors[g.POSITION];d.vertexArray.reserve(z.count);const b=cm(t,z);for(let P=0;P<z.count;P++)d.vertexArray.emplaceBack(b[3*P],b[3*P+1],b[3*P+2]);if(d.vertexArray._trim(),d.aabb=new ls(z.min,z.max),d.centroid=function(P,C){const R=[0,0,0],F=P.length;if(F>0){for(let q=0;q<F;q++){const Z=3*P[q];R[0]+=C[Z],R[1]+=C[Z+1],R[2]+=C[Z+2]}R[0]/=F,R[1]/=F,R[2]/=F}return R}(I,b),g.COLOR_0!==void 0){const P=t.json.accessors[g.COLOR_0],C=g0[P.type],R=cm(t,P);d.colorArray=C===3?new uc:new Ta,d.colorArray.resize(P.count),c1(t,P,d.colorArray,R)}if(g.NORMAL!==void 0){d.normalArray=new uc;const P=t.json.accessors[g.NORMAL];d.normalArray.resize(P.count);const C=cm(t,P);c1(t,P,d.normalArray,C)}if(g.TEXCOORD_0!==void 0&&r.length>0){d.texcoordArray=new Ou;const P=t.json.accessors[g.TEXCOORD_0];d.texcoordArray.resize(P.count);const C=cm(t,P);c1(t,P,d.texcoordArray,C)}if(g._FEATURE_ID_RGBA4444!==void 0){const P=t.json.accessors[g._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=cm(t,P))}g._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(cm(t,t.json.accessors[g._FEATURE_RGBA4444]).buffer));const L=a.material;return d.material=function(P,C){const{emissiveFactor:R=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:q=.5,normalTexture:Z,occlusionTexture:te,emissiveTexture:ie,doubleSided:K}=P,{baseColorFactor:ce=[1,1,1,1],metallicFactor:he=1,roughnessFactor:Se=1,baseColorTexture:$e,metallicRoughnessTexture:Be}=P.pbrMetallicRoughness||{},Ve=te?C[te.index]:void 0;if(te&&te.extensions&&te.extensions.KHR_texture_transform&&Ve){const Mt=te.extensions.KHR_texture_transform;Ve.offsetScale=[Mt.offset[0],Mt.offset[1],Mt.scale[0],Mt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ee(...ce),metallicFactor:he,roughnessFactor:Se,baseColorTexture:$e?C[$e.index]:void 0,metallicRoughnessTexture:Be?C[Be.index]:void 0},doubleSided:K,emissiveFactor:R,alphaMode:F,alphaCutoff:q,normalTexture:Z?C[Z.index]:void 0,occlusionTexture:Ve,emissionTexture:ie?C[ie.index]:void 0,defined:P.defined===void 0}}(L!==void 0?t.json.materials[L]:{defined:!1},r),d}function iM(a,t,r){const{matrix:h,rotation:g,translation:d,scale:_,mesh:T,extras:I,children:z}=a,b={};if(b.matrix=h||ot.mat4.fromRotationTranslationScale([],g||[0,0,0,1],d||[0,0,0],_||[1,1,1]),T!==void 0){b.meshes=r[T];const L=b.anchor=[0,0];for(const P of b.meshes){const{min:C,max:R}=P.aabb;L[0]+=C[0]+R[0],L[1]+=C[1]+R[1]}L[0]=Math.floor(L[0]/b.meshes.length/2),L[1]=Math.floor(L[1]/b.meshes.length/2)}if(I&&(I.id&&(b.id=I.id),I.lights&&(b.lights=function(L){if(!L.length)return[];const P=function(Z){const te=atob(Z),ie=new Uint8Array(te.length);for(let K=0;K<te.length;K++)ie[K]=te.codePointAt(K);return ie}(L),C=[],R=P.length/24,F=new Uint16Array(P.buffer),q=new Float32Array(P.buffer);for(let Z=0;Z<R;Z++){const te=F[2*Z*6]/30,ie=F[2*Z*6+1]/30,K=F[2*Z*6+10]/100,ce=q[6*Z+1],he=q[6*Z+2],Se=q[6*Z+3],$e=q[6*Z+4],Be=Se-ce,Ve=$e-he,Mt=Math.hypot(Be,Ve);C.push({pos:[ce+.5*Be,he+.5*Ve,ie],normal:[Ve/Mt,-Be/Mt,0],width:Mt,height:te,depth:K,points:[ce,he,Se,$e]})}return C}(I.lights))),z){const L=[];for(const P of z)L.push(iM(t.json.nodes[P],t,r));b.children=L}return b}function XI(a){if(a.vertices.length===0||a.indices.length===0)return null;const t=new fg(a.vertices,a.indices,8,256),[r,h]=[t.min.clone(),t.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:t,min:r,max:h}}function YI(a){if(!a.extras||!a.extras.ground)return null;const t=a.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const r=t[0];if(!r||!Array.isArray(r)||r.length===0)return null;const h=[];for(const _ of r){if(!Array.isArray(_)||_.length!==2)continue;const T=_[0],I=_[1];typeof T=="number"&&typeof I=="number"&&h.push(new Ye(T,I))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let g=0;for(let _=0;_<h.length;_++){const T=h[_],I=h[(_+1)%h.length],z=h[(_+2)%h.length];g+=(T.x-I.x)*(z.y-I.y)-(z.x-I.x)*(T.y-I.y)}g>0&&h.reverse();const d=em(h.flatMap(_=>[_.x,_.y]),[]);return d.length===0?null:{vertices:h,indices:d}}function KI(a,t){const r=[],h=[];let g=0;const d=[];for(const _ of a){g=r.length;const T=_.vertexArray.float32,I=_.indexArray.uint16;for(let z=0;z<_.vertexArray.length;z++)d[0]=T[3*z+0],d[1]=T[3*z+1],d[2]=T[3*z+2],ot.vec3.transformMat4(d,d,t),r.push(new Ye(d[0],d[1]));for(let z=0;z<3*_.indexArray.length;z++)h.push(I[z]+g)}if(h.length%3!=0)return null;for(let _=0;_<h.length;_+=3){const T=r[h[_+0]],I=r[h[_+1]],z=r[h[_+2]];(T.x-I.x)*(z.y-I.y)-(z.x-I.x)*(T.y-I.y)>0&&([h[_+1],h[_+2]]=[h[_+2],h[_+1]])}return{vertices:r,indices:h}}function nM(a){const t=function(I,z){const b=[],L=WebGL2RenderingContext;if(I.json.textures)for(const P of I.json.textures){const C={magFilter:L.LINEAR,minFilter:L.NEAREST,wrapS:L.REPEAT,wrapT:L.REPEAT};P.sampler!==void 0&&Object.assign(C,I.json.samplers[P.sampler]),b.push({image:z[P.source],sampler:C,uploaded:!1})}return b}(a,a.images),r=function(I,z){const b=[];for(const L of I.json.meshes){const P=[];for(const C of L.primitives)P.push(ZI(C,I,z));b.push(P)}return b}(a,t),{scenes:h,scene:g,nodes:d}=a.json,_=h?h[g||0].nodes:d,T=[];for(const I of _)T.push(iM(d[I],a,r));return function(I,z,b){const L={},P=new Set;for(let C=0;C<I.length;C++){const R=b[z[C]];if(!R.extras)continue;const F=R.extras["mapbox:footprint:version"],q=R.extras["mapbox:footprint:id"];(F||q)&&P.add(C),F==="1.0.0"&&q&&(L[q]=C)}for(let C=0;C<I.length;C++){if(P.has(C))continue;const R=I[C],F=b[z[C]];if(!F.extras)continue;let q=null;R.id in L&&(q=KI(I[L[R.id]].meshes,R.matrix)),q||(q=YI(F)),q&&(R.footprint=XI(q))}if(P.size>0){const C=Array.from(P.values()).sort((R,F)=>R-F);for(let R=C.length-1;R>=0;R--)I.splice(C[R],1)}}(T,_,a.json.nodes),T}function JI(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const t=a.vertexArray.float32,r=a.aabb.min[0]-1,h=a.aabb.min[1]-1,g=am/(a.aabb.max[0]-r+2),d=am/(a.aabb.max[1]-h+2);for(let _=0;_<t.length;_+=3){const T=t[_+2],I=(t[_+0]-r)*g|0,z=(t[_+1]-h)*d|0;T>a.heightmap[z*am+I]&&(a.heightmap[z*am+I]=T)}}function QI(a,t){const r={};r.indexArray=new qs,r.indexArray.reserve(4*a.length),r.vertexArray=new uc,r.vertexArray.reserve(10*a.length),r.colorArray=new Ta,r.vertexArray.reserve(10*a.length);let h=0;for(const _ of a){const T=Math.min(10,Math.max(4,1.3*_.height))*t,I=[-_.normal[1],_.normal[0],0],z=Math.min(.29,.1*_.width/_.depth),b=_.width-2*_.depth*t*(z+.01),L=ot.vec3.scaleAndAdd([],_.pos,I,b/2),P=ot.vec3.scaleAndAdd([],_.pos,I,-b/2),C=[L[0],L[1],L[2]+_.height],R=[P[0],P[1],P[2]+_.height],F=ot.vec3.scaleAndAdd([],_.normal,I,z);ot.vec3.scale(F,F,T);const q=ot.vec3.scaleAndAdd([],_.normal,I,-z);ot.vec3.scale(q,q,T),ot.vec3.add(F,L,F),ot.vec3.add(q,P,q),L[2]+=.1,P[2]+=.1,r.vertexArray.emplaceBack(F[0],F[1],F[2]),r.vertexArray.emplaceBack(q[0],q[1],q[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]),r.vertexArray.emplaceBack(P[0],P[1],P[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]),r.vertexArray.emplaceBack(P[0],P[1],P[2]),r.vertexArray.emplaceBack(F[0],F[1],F[2]),r.vertexArray.emplaceBack(q[0],q[1],q[2]);const Z=b/T/2;r.colorArray.emplaceBack(-Z-z,-1,Z,.8),r.colorArray.emplaceBack(Z+z,-1,Z,.8),r.colorArray.emplaceBack(-Z,0,Z,1.3),r.colorArray.emplaceBack(Z,0,Z,1.3),r.colorArray.emplaceBack(Z+z,-.8,Z,.7),r.colorArray.emplaceBack(Z+z,-.8,Z,.7),r.colorArray.emplaceBack(0,0,Z,1.3),r.colorArray.emplaceBack(0,0,Z,1.3),r.colorArray.emplaceBack(Z+z,-1.2,Z,.8),r.colorArray.emplaceBack(Z+z,-1.2,Z,.8),r.indexArray.emplaceBack(6+h,4+h,8+h),r.indexArray.emplaceBack(7+h,9+h,5+h),r.indexArray.emplaceBack(0+h,1+h,2+h),r.indexArray.emplaceBack(1+h,3+h,2+h),h+=10}const g={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=Ee.white,g.pbrMetallicRoughness=d,r.material=g,r.aabb=new ls([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class rM{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const h=t[r];this._stringToNumber[h]=r,this._numberToString[r]=h}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class sM{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Su(un,16,0),this.featureIndexArray=new vd,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,r,h,g,d,_=0,T=0){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,d,_);const z=this.grid;for(let b=0;b<r.length;b++){const L=r[b],P=[1/0,1/0,-1/0,-1/0];for(let C=0;C<L.length;C++){const R=L[C];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}T!==0&&(P[0]-=T,P[1]-=T,P[2]+=T,P[3]+=T),P[0]<un&&P[1]<un&&P[2]>=0&&P[3]>=0&&z.insert(I,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ae.VectorTile(new zy(this.rawTileData)).layers,this.sourceLayerCoder=new rM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r,h){this.loadVTLayers(),this.serializedLayersCache.clear();const g=Sl(t.filter),d=t.tileResult,_=t.transform,T=d.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(P,C,R,F)=>as(d.bufferedTilespaceGeometry,P,C,R,F));I.sort(eR);let z=null;_.elevation&&I.length>0&&(z=bg.create(_.elevation,this.tileID));const b={};let L;for(let P=0;P<I.length;P++){const C=I[P];if(C===L)continue;L=C;const R=this.featureIndexArray.get(C);let F=null;if(this.is3DTile){const q=this.bucketLayerIDs[0][0],Z=r[q];if(Z.type!=="model")continue;const{queryFeature:te,intersectionZ:ie}=Z.queryIntersectsMatchingFeature(d,R.featureIndex,g,_);te&&this.appendToResult(b,q,R.featureIndex,te,ie)}else this.loadMatchingFeature(b,R,g,t.layers,t.availableImages,r,h,(q,Z,te,ie=0)=>(F||(F=qt(q,this.tileID.canonical,t.tileTransform)),Z.queryIntersectsFeature(d,q,te,F,this.z,t.transform,t.pixelPosMatrix,z,ie)))}return b}loadMatchingFeature(t,r,h,g,d,_,T,I){const{featureIndex:z,bucketIndex:b,sourceLayerIndex:L,layoutVertexArrayOffset:P}=r,C=this.bucketLayerIDs[b];if(g.length&&!function(Z,te){for(let ie=0;ie<Z.length;ie++)if(te.indexOf(Z[ie])>=0)return!0;return!1}(g,C))return;const R=this.sourceLayerCoder.decode(L),F=this.vtLayers[R].feature(z);if(h.needGeometry){const Z=wi(F,!0);if(!h.filter(new eo(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!h.filter(new eo(this.tileID.overscaledZ),F))return;const q=this.getId(F,R);for(let Z=0;Z<C.length;Z++){const te=C[Z];if(g.length&&g.indexOf(te)<0)continue;const ie=_[te];if(!ie)continue;let K={};q!==void 0&&T&&(K=T.getState(ie.sourceLayer||"_geojsonTileLayer",q));const ce=!I||I(F,ie,K,P);if(!ce)continue;const he=new l0(F,this.z,this.x,this.y,q);let Se=this.serializedLayersCache.get(te);Se||(Se=ie.serialize(),Se.id=te,this.serializedLayersCache.set(te,Se)),he.layer=cn({},Se),he.tile=this.tileID.canonical,he.layer.paint=oM(Se.paint,ie.paint,F,K,d),he.layer.layout=oM(Se.layout,ie.layout,F,K,d),this.appendToResult(t,te,z,he,ce)}}appendToResult(t,r,h,g,d){let _=t[r];_===void 0&&(_=t[r]=[]),_.push({featureIndex:h,feature:g,intersectionZ:d})}lookupSymbolFeatures(t,r,h,g,d,_,T){const I={};this.loadVTLayers();const z=Sl(g);for(const b of t)this.loadMatchingFeature(I,{bucketIndex:r,sourceLayerIndex:h,featureIndex:b,layoutVertexArrayOffset:0},z,d,_,T);return I}loadFeature(t){const{featureIndex:r,sourceLayerIndex:h}=t;this.loadVTLayers();const g=this.sourceLayerCoder.decode(h),d=this.vtFeatures[g];if(d[r])return d[r];const _=this.vtLayers[g].feature(r);return d[r]=_,_}hasLayer(t){for(const r of this.bucketLayerIDs)for(const h of r)if(t===h)return!0;return!1}getId(t,r){let h=t.id;if(this.promoteId){const g=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];g!=null&&(h=t.properties[g]),typeof h=="boolean"&&(h=Number(h))}return h}}function oM(a,t,r,h,g){return Tr(a,(d,_)=>{const T=t instanceof mh?t.get(_):null;return T&&T.evaluate?T.evaluate(r,h,g):T})}function eR(a,t){return t-a}Sn(sM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const aM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class u1{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,h]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=h>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const d=aM[15&h];if(!d)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[T]=new Uint32Array(t,4,1);return new u1(T,_,d,t)}constructor(t,r=64,h=Float64Array,g){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=h,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=aM.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,T=t*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${h}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+I,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+T+I),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+I,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=t,this.coords[this._pos++]=r,h}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return h1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,h,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:T}=this,I=[0,d.length-1,0],z=[];for(;I.length;){const b=I.pop()||0,L=I.pop()||0,P=I.pop()||0;if(L-P<=T){for(let q=P;q<=L;q++){const Z=_[2*q],te=_[2*q+1];Z>=t&&Z<=h&&te>=r&&te<=g&&z.push(d[q])}continue}const C=P+L>>1,R=_[2*C],F=_[2*C+1];R>=t&&R<=h&&F>=r&&F<=g&&z.push(d[C]),(b===0?t<=R:r<=F)&&(I.push(P),I.push(C-1),I.push(1-b)),(b===0?h>=R:g>=F)&&(I.push(C+1),I.push(L),I.push(1-b))}return z}within(t,r,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:d,nodeSize:_}=this,T=[0,g.length-1,0],I=[],z=h*h;for(;T.length;){const b=T.pop()||0,L=T.pop()||0,P=T.pop()||0;if(L-P<=_){for(let q=P;q<=L;q++)cM(d[2*q],d[2*q+1],t,r)<=z&&I.push(g[q]);continue}const C=P+L>>1,R=d[2*C],F=d[2*C+1];cM(R,F,t,r)<=z&&I.push(g[C]),(b===0?t-h<=R:r-h<=F)&&(T.push(P),T.push(C-1),T.push(1-b)),(b===0?t+h>=R:r+h>=F)&&(T.push(C+1),T.push(L),T.push(1-b))}return I}}function h1(a,t,r,h,g,d){if(g-h<=r)return;const _=h+g>>1;lM(a,t,_,h,g,d),h1(a,t,r,h,_-1,1-d),h1(a,t,r,_+1,g,1-d)}function lM(a,t,r,h,g,d){for(;g>h;){if(g-h>600){const z=g-h+1,b=r-h+1,L=Math.log(z),P=.5*Math.exp(2*L/3),C=.5*Math.sqrt(L*P*(z-P)/z)*(b-z/2<0?-1:1);lM(a,t,r,Math.max(h,Math.floor(r-b*P/z+C)),Math.min(g,Math.floor(r+(z-b)*P/z+C)),d)}const _=t[2*r+d];let T=h,I=g;for(_0(a,t,h,r),t[2*g+d]>_&&_0(a,t,h,g);T<I;){for(_0(a,t,T,I),T++,I--;t[2*T+d]<_;)T++;for(;t[2*I+d]>_;)I--}t[2*h+d]===_?_0(a,t,h,I):(I++,_0(a,t,I,g)),I<=r&&(h=I+1),r<=I&&(g=I-1)}}function _0(a,t,r,h){d1(a,r,h),d1(t,2*r,2*h),d1(t,2*r+1,2*h+1)}function d1(a,t,r){const h=a[t];a[t]=a[r],a[r]=h}function cM(a,t,r,h){const g=a-r,d=t-h;return g*g+d*d}n.$=Uf,n.A=class extends ev{},n.B=xl,n.C=Wi,n.D=gh,n.E=bi,n.F=Lf,n.G=Tu,n.H=Cf,n.I=zx,n.J=dh,n.K=Wa,n.L=Uc,n.M=Mu,n.N=Kd,n.O=bu,n.P=Ye,n.Q=rh,n.R=aa,n.S=Zo,n.T=$x,n.U=me,n.V=ev,n.W=xo,n.X=If,n.Y=Qm,n.Z=function(a){const t=a.value;let r=[];if(!t)return r;const h=xl(t);return h!=="string"?(r=r.concat([new ev(a.key,t,`string expected, "${h}" found`)]),r):(x2(t,!0)||(r=r.concat([new ev(a.key,t,`invalid url "${t}"`)])),r)},n._=Qt,n.a=function(a){return Je.API_CDN_URL_REGEX.test(a)},n.a$=cc,n.a0=Ts,n.a1=qi,n.a2=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return Ro(a.expression.evaluate(t))}interpolate(a,t,r){return{x:Pe(a.x,t.x,r),y:Pe(a.y,t.y,r),z:Pe(a.z,t.z,r),azimuthal:Pe(a.azimuthal,t.azimuthal,r),polar:Pe(a.polar,t.polar,r)}}},n.a3=eo,n.a4=ol,n.a5=Ot,n.a6=ot,n.a7=ui,n.a8=mh,n.a9=iu,n.aA=Hr,n.aB=a2,n.aC=p2,n.aD=o2,n.aE=function(a,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let h=0;h<a.length;h++){const g=document.createElement("source");la(a[h])||(r.crossOrigin="Anonymous"),g.src=a[h],r.appendChild(g)}return{cancel:()=>{}}},n.aF=Xy,n.aG=function(a){return fetch(a).then(t=>t.arrayBuffer()).then(t=>tM(t,0,a))},n.aH=nM,n.aI=class{constructor(a,t,r,h){this.id=a,this.position=t!=null?new j(t[0],t[1]):new j(0,0),this.orientation=r??[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new ls([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,t){if(ot.mat4.multiply(a.matrix,t,a.matrix),a.meshes)for(const r of a.meshes){const h=ls.applyTransformFast(r.aabb,a.matrix);this.aabb.encapsulate(h)}if(a.children)for(const r of a.children)this._applyTransformations(r,a.matrix)}computeBoundsAndApplyParent(){const a=ot.mat4.identity([]);for(const t of this.nodes)this._applyTransformations(t,a)}computeModelMatrix(a,t,r,h,g,d,_=!1){S2(this.matrix,this,a.transform,this.position,t,r,h,g,d,_)}upload(a){if(!this.uploaded){for(const t of this.nodes)Jx(t,a);for(const t of this.nodes)tv(t);this.uploaded=!0}}destroy(){for(const a of this.nodes)Qx(a)}},n.aJ=jn,n.aK=function(a){return a.indexOf(xh)>=0},n.aL=t0,n.aM=Oe,n.aN=Ge,n.aO=Lu,n.aP=qs,n.aQ=Fn,n.aR=Eh,n.aS=$y,n.aT=function(){ua.isLoading()||ua.isLoaded()||Bf()!=="deferred"||md()},n.aU=Sl,n.aV=wi,n.aW=l0,n.aX=js,n.aY=zp,n.aZ=pg,n.a_=qt,n.aa=Pe,n.ab=un,n.ac=ci,n.ad=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return function([r,h]){const g=Ro([1,r,h]);return{x:g.x,y:g.y,z:g.z}}(a.expression.evaluate(t))}interpolate(a,t,r){return{x:Pe(a.x,t.x,r),y:Pe(a.y,t.y,r),z:Pe(a.z,t.z,r)}}},n.ae=function(a,t,r=0,h=!0){const g=new Ye(r,r),d=a.sub(g),_=t.add(g),T=[d,new Ye(_.x,d.y),_,new Ye(d.x,_.y)];return h&&T.push(d.clone()),T},n.af=function(a,t){const r=[];for(let h=0;h<a.length;h++){const g=xi(h-1,-1,a.length-1),d=xi(h+1,-1,a.length-1),_=a[h],T=a[d],I=a[g].sub(_).unit(),z=T.sub(_).unit(),b=z.angleWithSep(I.x,I.y),L=I.add(z).unit().mult(-1*t/Math.sin(b/2));r.push(_.add(L))}return r},n.ag=qT,n.ah=as,n.ai=function(a,t,r=0){return ot.vec3.fromValues(((t.x-r)*a.scale-a.x)*un,(t.y*a.scale-a.y)*un,He(t.z,t.y))},n.aj=Ma,n.ak=X_,n.al=function(a){let t=1/0,r=1/0,h=-1/0,g=-1/0;for(const d of a)t=Math.min(t,d.x),r=Math.min(r,d.y),h=Math.max(h,d.x),g=Math.max(g,d.y);return{min:new Ye(t,r),max:new Ye(h,g)}},n.am=ue,n.an=Nr,n.ao=St,n.ap=It,n.aq=na,n.ar=function(a,t){const r={};for(let h=0;h<t.length;h++){const g=t[h];g in a&&(r[g]=a[g])}return r},n.as=Y,n.at=_e,n.au=class{constructor(a){this.entries={},this.scheduler=a}request(a,t,r,h){const g=this.entries[a]=this.entries[a]||{callbacks:[]};if(g.result){const[d,_]=g.result;return this.scheduler?this.scheduler.add(()=>{h(d,_)},t):h(d,_),()=>{}}return g.callbacks.push(h),g.cancel||(g.cancel=r((d,_)=>{g.result=[d,_];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(d,_)},t):T(d,_);setTimeout(()=>delete this.entries[a],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(d=>d!==h),g.callbacks.length||(g.cancel(),delete this.entries[a]))}}},n.av=bh,n.aw=function(a,t,r){const h=JSON.stringify(a.request);return a.data&&(this.deduped.entries[h]={result:[null,a.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},g=>{const d=Vo(a.request,(_,T,I,z)=>{_?g(_):T&&g(null,{vectorTile:r?void 0:new ae.VectorTile(new zy(T)),rawData:T,cacheControl:I,expires:z})});return()=>{d.cancel(),g()}},t)},n.ax=function(a){Ns++,Ns>er&&(a.getActor().send("enforceCacheSizeLimit",ar),Ns=0)},n.ay=Pi,n.az=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},n.b=function(a){return Je.API_FONTS_REGEX.test(a)},n.b$=ha,n.b0=vp,n.b1=Il,n.b2=Js,n.b3=em,n.b4=jx,n.b5=function(a,t){const r=iu(t.zoom);if(r===0)return Kl(a);const h=Rp(a),g=sg(h),d=ue(h.getWest())*t.worldSize,_=ue(h.getEast())*t.worldSize,T=_e(h.getNorth())*t.worldSize,I=_e(h.getSouth())*t.worldSize,z=[d,T,0],b=[_,T,0],L=[d,I,0],P=[_,I,0],C=ot.mat4.invert([],t.globeMatrix);return ot.vec3.transformMat4(z,z,C),ot.vec3.transformMat4(b,b,C),ot.vec3.transformMat4(L,L,C),ot.vec3.transformMat4(P,P,C),g[0]=Rl(g[0],L,r),g[1]=Rl(g[1],P,r),g[2]=Rl(g[2],b,r),g[3]=Rl(g[3],z,r),ls.fromPoints(g)},n.b6=Yf,n.b7=Zf,n.b8=Rl,n.b9=mp,n.bA=Ee,n.bB=xi,n.bC=Ue,n.bD=ro,n.bE=ge,n.bF=function(a,t,r){a[4*t+0]=r[0],a[4*t+1]=r[1],a[4*t+2]=r[2],a[4*t+3]=r[3]},n.bG=Uu,n.bH=Xa,n.bI=bd,n.bJ=uo,n.bK=Cl,n.bL=j,n.bM=KT,n.bN=Wr,n.bO=ka,n.bP=m2,n.bQ=Eo,n.bR=$f,n.bS=function(a,t,r,h,g,d,_,T,I){if(I.name==="globe")return $f(a,t,new Eo(r,h,g),!1);const z=t0({z:r,x:h,y:g},I);return new ls([(d+z.x/z.scale)*t,t*(z.y/z.scale),_],[(d+z.x2/z.scale)*t,t*(z.y2/z.scale),T])},n.bT=function(a,t,r){let h=0;for(let g=0;g<2;++g)a[g]>0&&(h+=(a[g]-0)*(a[g]-0)),t[g]<0&&(h+=(0-t[g])*(0-t[g]));return h},n.bU=Qe,n.bV=f,n.bW=function(a){const t=ot.mat4.identity(new Float64Array(16));ot.mat4.multiply(t,a.pixelMatrix,a.globeMatrix);const r=[0,x,0],h=[0,w,0];return ot.vec3.transformMat4(r,r,t),ot.vec3.transformMat4(h,h,t),[r[0]>0&&r[0]<=a.width&&r[1]>0&&r[1]<=a.height&&!ag(a,new j(a.center.lat,90)),h[0]>0&&h[0]<=a.width&&h[1]>0&&h[1]<=a.height&&!ag(a,new j(a.center.lat,-90))]},n.bX=function(a,t){const{scale:r}=a.tileTransform,h=r*un/(a.tileSize*Math.pow(2,t.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return ot.mat2.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[h,h])},n.bY=Jy,n.bZ=f2,n.b_=function(a){const t=f2(a,!0);return ot.mat2.invert([],[t[0],t[1],t[4],t[5]])},n.ba=Do,n.bb=r1,n.bc=zy,n.bd=Vo,n.be=function(a){const t=[];for(const r in a)t.push(a[r]);return t},n.bf=function(a,t){const r=[];for(const h in a)h in t||r.push(h);return r},n.bg=an,n.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bi=kt,n.bj=function(a,t){const{x:r,y:h}=a.point,g=Jf(r,h,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ot.mat4.multiply(g,g,og(Kl(t)))},n.bk=Fa,n.bl=yc,n.bm=hl,n.bn=function(a,t,r,h,g){const d=5*t+2;a.float32[d+0]=r,a.float32[d+1]=h,a.float32[d+2]=g},n.bo=qy,n.bp=zT,n.bq=gi,n.br=zs,n.bs=_t,n.bt=v2,n.bu=En,n.bv=Ji,n.bw=Bx,n.bx=GT,n.by=Ox,n.bz=u1,n.c=dt,n.c$=is,n.c0=function(a){const{x:t,y:r}=a.point,{lng:h,lat:g}=a._center;return Jf(t,r,a.worldSize,h,g)},n.c1=We,n.c2=Yr,n.c3=fo,n.c4=function(a){const t=Math.round((a+45+360)%360/90)%4;return rt[t]},n.c5=45,n.c6=pe,n.c7=Qc,n.c8=function(a,t,r){const h=Math.sqrt(a*a+t*t+r*r),g=h>0?Math.acos(r/h)*Ie:0;let d=a!==0||t!==0?Math.atan2(-t,-a)*Ie+90:0;return d<0&&(d+=360),[h,d,g]},n.c9=wt,n.cA=function(a){const t=Qe-5;a=It(a,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(Ue(a))),3);return Math.round(r*(m.length-1))},n.cB=function(a,t,r,h){const g=t.getNorth(),d=t.getSouth(),_=t.getWest(),T=t.getEast(),I=1<<a.z,z=T-_,b=g-d,L=z/s,P=-b/m[r],C=[0,L,0,P,0,0,g,_,0];if(a.z>0){const R=180/h;ot.mat3.multiply(C,C,[R/z+1,0,0,0,R/b+1,0,-.5*R/L,.5*R/P,1])}return C[2]=I,C[5]=a.x,C[8]=a.y,C},n.cC=Kl,n.cD=function(a,t,r){const h=ot.mat4.identity(new Float64Array(16)),g=(t/(1<<a)-.5)*Math.PI*2;return ot.mat4.rotateY(h,r.globeMatrix,g),Float32Array.from(h)},n.cE=class{isDataAvailableAtPoint(a){const t=this._source();if(this.isUsingMockSource()||!t||a.y<0||a.y>1)return!1;const r=t.getSource().maxzoom,h=1<<r,g=Math.floor(a.x),d=Math.floor((a.x-g)*h),_=Math.floor(a.y*h),T=this.findDEMTileFor(new Hr(r,g,r,d,_));return!(!T||!T.dem)}getAtPointOrZero(a,t=0){return this.getAtPoint(a,t)||0}getAtPoint(a,t,r=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const h=this._source();if(!h||a.y<0||a.y>1)return t;const g=h.getSource().maxzoom,d=1<<g,_=Math.floor(a.x),T=a.x-_,I=new Hr(g,_,g,Math.floor(T*d),Math.floor(a.y*d)),z=this.findDEMTileFor(I);if(!z||!z.dem)return t;const b=z.dem,L=1<<z.tileID.canonical.z,P=(T*L-z.tileID.canonical.x)*b.dim,C=(a.y*L-z.tileID.canonical.y)*b.dim,R=Math.floor(P),F=Math.floor(C);return(r?this.exaggeration():1)*Pe(Pe(b.get(R,F),b.get(R,F+1),C-F),Pe(b.get(R+1,F),b.get(R+1,F+1),C-F),P-R)}getAtTileOffset(a,t,r){const h=1<<a.canonical.z;return this.getAtPointOrZero(new Ot(a.wrap+(a.canonical.x+t/un)/h,(a.canonical.y+r/un)/h))}getAtTileOffsetFunc(a,t,r,h){return g=>{const d=this.getAtTileOffset(a,g.x,g.y),_=h.upVector(a.canonical,g.x,g.y),T=h.upVectorScale(a.canonical,t,r).metersToTile;return ot.vec3.scale(_,_,d*T),_}}getForTilePoints(a,t,r,h){if(this.isUsingMockSource())return!1;const g=bg.create(this,a,h);return!!g&&(t.forEach(d=>{d[2]=this.exaggeration()*g.getElevationAt(d[0],d[1],r)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(a);if(!t||!t.dem)return null;const r=t.dem.tree,h=t.tileID,g=1<<a.canonical.z-h.canonical.z;let d=a.canonical.x/g-h.canonical.x,_=a.canonical.y/g-h.canonical.y,T=0;for(let I=0;I<a.canonical.z-h.canonical.z&&!r.leaves[T];I++){d*=2,_*=2;const z=2*Math.floor(_)+Math.floor(d);T=r.childOffsets[T]+z,d%=1,_%=1}return{min:this.exaggeration()*r.minimums[T],max:this.exaggeration()*r.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let t=!1,r=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const g of a){const d=this.getMinMaxForTile(g.tileID);d&&(r=Math.min(r,d.min),h=Math.max(h,d.max),t=!0)}return t?{min:r,max:h}:null}},n.cF=vy,n.cG=eu,n.cH=function(a,t){return[Math.pow(a[0],2.2)*t,Math.pow(a[1],2.2)*t,Math.pow(a[2],2.2)*t]},n.cI=hy,n.cJ=re,n.cK=ye,n.cL=256,n.cM=function(a,t){const r=[0,0,0],h=Yf(Kl(t.canonical));return ot.vec3.transformMat4(r,r,h),ot.vec3.transformMat4(r,r,a),r},n.cN=a=>({u_camera_to_center_distance:new uo(a),u_extrude_scale:new Cp(a),u_device_pixel_ratio:new uo(a),u_matrix:new Uu(a),u_inv_rot_matrix:new Uu(a),u_merc_center:new Xa(a),u_tile_id:new bd(a),u_zoom_transition:new uo(a),u_up_dir:new bd(a),u_emissive_strength:new uo(a)}),n.cO=a=>({u_matrix:new Uu(a),u_pixels_to_tile_units:new Cp(a),u_device_pixel_ratio:new uo(a),u_units_to_pixels:new Xa(a),u_dash_image:new Cl(a),u_gradient_image:new Cl(a),u_image_height:new uo(a),u_texsize:new Xa(a),u_tile_units_to_pixels:new uo(a),u_alpha_discard_threshold:new uo(a),u_trim_offset:new Xa(a),u_trim_fade_range:new Xa(a),u_trim_color:new Qc(a),u_emissive_strength:new uo(a),u_zbias_factor:new uo(a),u_tile_to_meter:new uo(a)}),n.cP=a=>({u_matrix:new Uu(a),u_texsize:new Xa(a),u_pixels_to_tile_units:new Cp(a),u_device_pixel_ratio:new uo(a),u_image:new Cl(a),u_units_to_pixels:new Xa(a),u_tile_units_to_pixels:new uo(a),u_alpha_discard_threshold:new uo(a),u_trim_offset:new Xa(a),u_emissive_strength:new uo(a),u_zbias_factor:new uo(a),u_tile_to_meter:new uo(a)}),n.cQ=Pu,n.cR=Fh,n.cS=TL,n.cT=D_,n.cU=(a,t,r,h,g,d)=>{const _=a.transform,T=_.projection.name==="globe";let I;if(d.paint.get("circle-pitch-alignment")==="map")if(T){const b=hy(_.zoom,t.canonical)*_._pixelsPerMercatorPixel;I=Float32Array.from([b,0,0,b])}else I=_.calculatePixelsToTileUnitsMatrix(r);else I=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(_.projection),u_matrix:a.translatePosMatrix(t.projMatrix,r,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:tn.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:fy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(T){z.u_inv_rot_matrix=h,z.u_merc_center=g,z.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],z.u_zoom_transition=iu(_.zoom);const b=g[0]*un,L=g[1]*un;z.u_up_dir=_.projection.upVector(new Eo(0,0,0),b,L)}return z},n.cV=sn,n.cW=(a,t,r,h,g,d)=>{const _=a.transform,T=_.pitch<15?Wt(.07,.7,It((14-_.zoom)/5,0,1)):.07;return{u_matrix:Ri(a,t,r,h),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:g,u_image:0,u_tile_units_to_pixels:rn(t,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d,u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:T,u_tile_to_meter:wt(t.tileID.canonical,0)}},n.cX=(a,t,r,h,g,d,_)=>{const T=a.transform,I=T.calculatePixelsToTileUnitsMatrix(t),z=T.pitch<15?Wt(.07,.7,It((14-T.zoom)/5,0,1)):.07;return{u_matrix:Ri(a,t,r,h),u_pixels_to_tile_units:I,u_device_pixel_ratio:d,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:On(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:rn(t,a.transform),u_alpha_discard_threshold:0,u_trim_offset:_,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:z,u_tile_to_meter:wt(t.tileID.canonical,0)}},n.cY=Mn,n.cZ=Qf,n.c_=ul,n.ca=ls,n.cb=Ro,n.cc=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},n.cd=function(a){return a({pluginStatus:ta,pluginURL:ja}),hp.on("pluginStateChange",a),a},n.ce=wg,n.cf=rv,n.cg=_g,n.ch=kx,n.ci=qo,n.cj=rg,n.ck=Jn,n.cl=Me,n.cm=$r,n.cn=function(a){const t=a.indexOf(xh);return t>=0?a.slice(0,t):a},n.co=function(a){const t=a.indexOf(xh);return t>=0?a.slice(t+1):""},n.cp=function(a){const t=[],r=a.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},n.cq=function(a,t,r,h){return a.type==="custom"?new eI(a,t):new dI[a.type](a,t,r,h)},n.cr=to,n.cs=hp,n.ct=go,n.cu=Sp,n.cv=class extends Zl{constructor(a){super(a),this.current=Ep}set(a,t,r){if(this.fetchUniformLocation(a,t)){for(let h=0;h<9;h++)if(r[h]!==this.current[h]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.cw=ut,n.cx=function(a,t,r){const h=iu(r.zoom),g=a.style.map._antialias,d=t.options.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return h===0&&!g&&!d},n.cy=function(a){const t=a.pixelsPerMeter,r=t/ge(1,a.center.lat),h=ot.mat4.identity(new Float64Array(16));return ot.mat4.translate(h,h,[a.point.x,a.point.y,0]),ot.mat4.scale(h,h,[r,r,t]),Float32Array.from(h)},n.cz=Rp,n.d=function(a){return Je.API_TILEJSON_REGEX.test(a)},n.d$=X,n.d0=or,n.d1=ii,n.d2=450,n.d3=7,n.d4=QL,n.d5=Qr,n.d6=Kc,n.d7=256,n.d8=og,n.d9=uc,n.dA=R_,n.dB=function(a){const t=[0,0,0],r=ot.mat4.identity(new Float64Array(16));return ot.mat4.multiply(r,a.pixelMatrix,a.globeMatrix),ot.vec3.transformMat4(t,t,r),new Ye(t[0],t[1])},n.dC=function(a,t,r=!1){if(ta===kf||ta===ph||ta===fh)throw new Error("setRTLTextPlugin cannot be called multiple times.");ja=tn.resolveURL(a),ta=kf,up=t,Ff(),r||md()},n.dD=Bf,n.dE=function(){rv().acquire(s1)},n.dF=function(){const a=f0;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(s1),f0=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dG=p0,n.dH=function(a){const t=Jr();if(!t)return;const r=t.delete(sr);a&&r.catch(a).then(()=>a())},n.dI=d0,n.dJ=Z2,n.dK=function(a){o1=tn.resolveURL(a),Sg||(Sg=new wg(rv(),new bi)),Sg.broadcast("setDracoUrl",o1)},n.dL=X2,n.dM=function(a){Mg=tn.resolveURL(a),Sg||(Sg=new wg(rv(),new bi)),Sg.broadcast("setMeshoptUrl",Mg)},n.dN=Sn,n.dO=nu,n.dP=Hu,n.dQ=rM,n.dR=sM,n.dS=q_,n.dT=Tr,n.dU=FT,n.dV=function(a,t,r,h,g,d,_,T,I,z,b=1,L){a.createArrays(),a.tilePixelRatio=un/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const P=a.layers[0].layout,C=a.layers[0]._unevaluatedLayout._values,R={};if(R.scaleFactor=b,R.textSizeScaleRange=P.get("text-size-scale-range"),R.iconSizeScaleRange=P.get("icon-size-scale-range"),R.textScaleFactor=It(R.scaleFactor,R.textSizeScaleRange[0],R.textSizeScaleRange[1]),R.iconScaleFactor=It(R.scaleFactor,R.iconSizeScaleRange[0],R.iconSizeScaleRange[1]),a.textSizeData.kind==="composite"){const{minZoom:te,maxZoom:ie}=a.textSizeData;R.compositeTextSizes=[C["text-size"].possiblyEvaluate(new eo(te),T),C["text-size"].possiblyEvaluate(new eo(ie),T)]}if(a.iconSizeData.kind==="composite"){const{minZoom:te,maxZoom:ie}=a.iconSizeData;R.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new eo(te),T),C["icon-size"].possiblyEvaluate(new eo(ie),T)]}R.layoutTextSize=C["text-size"].possiblyEvaluate(new eo(I+1),T),R.layoutIconSize=C["icon-size"].possiblyEvaluate(new eo(I+1),T),R.textMaxSize=C["text-size"].possiblyEvaluate(new eo(18),T);const F=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",q=P.get("text-size");let Z=!1;for(const te of a.features)if(te.icon&&te.icon.nameSecondary){Z=!0;break}for(const te of a.features){const ie=P.get("text-font").evaluate(te,{},T).join(","),K=q.evaluate(te,{},T)*R.textScaleFactor,ce=R.layoutTextSize.evaluate(te,{},T)*R.textScaleFactor,he=(R.layoutIconSize.evaluate(te,{},T),{horizontal:{},vertical:void 0}),Se=te.text;let $e,Be=[0,0];if(Se){const Ne=Se.toString(),ft=P.get("text-letter-spacing").evaluate(te,{},T)*zs,Pt=P.get("text-line-height").evaluate(te,{},T)*zs,Dt=zf(Ne)?ft:0,Ut=P.get("text-anchor").evaluate(te,{},T),ei=P.get("text-variable-anchor");if(!ei){const pi=P.get("text-radial-offset").evaluate(te,{},T);Be=pi?GT(Ut,[pi*zs,Fx]):P.get("text-offset").evaluate(te,{},T).map(Tn=>Tn*zs)}let ri=F?"center":P.get("text-justify").evaluate(te,{},T);const Yt=P.get("symbol-placement")==="point",yi=Yt?P.get("text-max-width").evaluate(te,{},T)*zs:1/0,Fi=pi=>{a.allowVerticalPlacement&&Of(Ne)&&(he.vertical=Dx(Se,t,r,g,ie,yi,Pt,Ut,pi,Dt,Be,yc.vertical,!0,ce,K))};if(!F&&ei){const pi=ri==="auto"?ei.map(ln=>Bx(ln)):[ri];let Tn=!1;for(let ln=0;ln<pi.length;ln++){const $i=pi[ln];if(!he.horizontal[$i])if(Tn)he.horizontal[$i]=he.horizontal[0];else{const Di=Dx(Se,t,r,g,ie,yi,Pt,"center",$i,Dt,Be,yc.horizontal,!1,ce,K);Di&&(he.horizontal[$i]=Di,Tn=Di.positionedLines.length===1)}}Fi("left")}else{if(ri==="auto"&&(ri=Bx(Ut)),Yt||P.get("text-writing-mode").indexOf("horizontal")>=0||!Of(Ne)){const pi=Dx(Se,t,r,g,ie,yi,Pt,Ut,ri,Dt,Be,yc.horizontal,!1,ce,K);pi&&(he.horizontal[ri]=pi)}Fi(Yt?"left":ri)}}let Ve=!1;if(te.icon&&te.icon.namePrimary){const Ne=h[te.icon.namePrimary];Ne&&($e=DL(g[te.icon.namePrimary],te.icon.nameSecondary?g[te.icon.nameSecondary]:void 0,P.get("icon-offset").evaluate(te,{},T),P.get("icon-anchor").evaluate(te,{},T)),Ve=Ne.sdf,a.sdfIcons===void 0?a.sdfIcons=Ne.sdf:a.sdfIcons!==Ne.sdf&&Wn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==a.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}const Mt=jT(he.horizontal)||he.vertical;a.iconsInText||(a.iconsInText=!!Mt&&Mt.iconsInText),(Mt||$e)&&UL(a,te,he,$e,h,R,ce,0,Be,Ve,_,T,z,L,Z)}d&&a.generateCollisionDebugBuffers(I,a.collisionBoxArray,R.textScaleFactor)},n.dW=ae,n.dX=nv,n.dY=At,n.dZ=se,n.d_=wT,n.da=Xc,n.db=_p,n.dc=function(a,t,r,h,g){return It((a-t)/(r-t)*(g-h)+h,h,g)},n.dd=np,n.de=tt,n.df=class{constructor(a,t,r,h){this.context=a,this.format=h,this.size=r,this.texture=a.gl.createTexture();const[g,d,_]=this.size,{gl:T}=a;T.bindTexture(T.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,g,d,_,0,Wx(this.format),qx(this.format),t.data)}bind(a,t){const{context:r}=this,{gl:h}=r;h.bindTexture(h.TEXTURE_3D,this.texture),a!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,a),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,a),this.minFilter=a),t!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,t),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},n.dg=Yx,n.dh=[1,1,1],n.di=bg,n.dj=xg,n.dk=ll,n.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ye(1/0,1/0),max:new Ye(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,t=!1){const r=Bi(new Ye(0,0),new Ye(un,un),a),h=[];if(t&&!_i(r,this._globalClipBounds))return h;for(const g of this._activeRegions){if(g.hiddenByOverlap||!_i(r,g))continue;const d=Li(g.min,g.max,a);h.push({min:d.min,max:d.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return h}setSources(a){this._setSources(a.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const r=[];for(const h of t.cache.getVisibleCoordinates()){const g=t.cache.getTile(h).buckets[t.layer];g&&g.updateFootprints(h.toUnwrapped(),r)}return r},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(a){const t=a.getFootprints();if(t.length===0)return;const r=a.getOrder(),h=a.getClipMask(),g=a.getClipScope();for(const d of t){if(!d.footprint)continue;const _=Bi(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:r,clipMask:h,clipScope:g})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,r)=>t.priority-r.priority||jt(t.min,r.min)||jt(t.max,r.max)||t.order-r.order||t.clipMask-r.clipMask||function(h,g){const d=(_,T)=>_+T;return h.length-g.length||h.reduce(d,"").localeCompare(g.reduce(d,""))}(t.clipScope,r.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let t=0;for(;!a&&t!==this._activeRegions.length;){const r=this._activeRegions[t],h=this._prevRegions[t];a=r.priority!==h.priority||!Xt(r,h)||r.order!==h.order||r.clipMask!==h.clipMask||!kt(r.clipScope,h.clipScope),++t}}if(a){++this._updateTime;for(const r of this._activeRegions)r.order!==Et&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const t=r=>{const h=this._activeRegions;if(r>=h.length)return r;const g=h[r].priority;for(;r<h.length&&h[r].priority===g;)++r;return r};if(this._sourceIds.length>1){let r=0,h=t(r);for(;r!==h;){let g=r;const d=r;for(;g!==h;){const _=this._activeRegions[g];_.hiddenByOverlap=!1;for(let T=0;T<d;T++){const I=this._activeRegions[T];if(!I.hiddenByOverlap&&_.order===Et&&_i(_,I)&&(_.hiddenByOverlap=Zn(_.footprint,_.tileId,I.footprint,I.tileId),_.hiddenByOverlap))break}++g}r=h,h=t(r)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=a.length-1;t>=0;t--)this._addSource(a[t]);this._computeReplacement()}},n.dm=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,t){const r=new cc,h=new qs,g=[],d=a+1+2,_=t[0]+1,T=t[0]+1+(1+t.length),I=(z,b,L)=>{let P=z===d-1?z-2:z===0?z:z-1;return P+=L?24575:0,[P,b]};for(let z=0;z<d;++z)r.emplaceBack(...I(z,0,!0));for(let z=0;z<_;++z)for(let b=0;b<d;++b)r.emplaceBack(...I(b,z,(b===0||b===d-1)&&!0));for(let z=0;z<t.length;++z){const b=t[z];for(let L=0;L<d;++L)r.emplaceBack(...I(L,b,!0))}for(let z=0;z<t.length;++z){const b=h.length,L=t[z]+1+2,P=new qs;for(let F=0;F<L-1;F++){const q=F===L-2,Z=q?d*(T-t.length+z-F):d;for(let te=0;te<d-1;te++){const ie=F*d+te;F===0||q||te===0||te===d-2?(P.emplaceBack(ie+1,ie,ie+Z),P.emplaceBack(ie+Z,ie+Z+1,ie+1)):(h.emplaceBack(ie+1,ie,ie+Z),h.emplaceBack(ie+Z,ie+Z+1,ie+1))}}const C=Js.simpleSegment(0,b,r.length,h.length-b);for(let F=0;F<P.uint16.length;F+=3)h.emplaceBack(P.uint16[F],P.uint16[F+1],P.uint16[F+2]);const R=Js.simpleSegment(0,b,r.length,h.length-b);g.push({withoutSkirts:C,withSkirts:R})}return{vertices:r,indices:h,segments:g}}_createGrid(a){const t=this._fillGridMeshWithLods(s,m);this._gridSegments=t.segments,this._gridBuffer=a.createVertexBuffer(t.vertices,Il.members),this._gridIndexBuffer=a.createIndexBuffer(t.indices,!0)}_createPoles(a){const t=new qs;for(let _=0;_<=s;_++)t.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=a.createIndexBuffer(t,!0);const r=new Xc,h=new Xc,g=new Xc,d=new Xc;this._poleSegments=[];for(let _=0,T=0;_<fo;_++){const I=360/(1<<_);r.emplaceBack(0,-na,0,.5,0),h.emplaceBack(0,-na,0,.5,1),g.emplaceBack(0,-na,0,.5,.5),d.emplaceBack(0,-na,0,.5,.5);for(let z=0;z<=s;z++){let b=z/s,L=0;const P=Pe(0,I,b),[C,R,F]=A(dy,py,P,na);r.emplaceBack(C,R,F,b,L),h.emplaceBack(C,R,F,b,1-L);const q=Ue(P);b=.5+.5*Math.sin(q),L=.5+.5*Math.cos(q),g.emplaceBack(C,R,F,b,L),d.emplaceBack(C,R,F,b,1-L)}this._poleSegments.push(Js.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(r,Os,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(h,Os,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(g,Os,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(d,Os,!1)}getGridBuffers(a,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},n.dn=Et,n.dp=ht,n.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.dr=Lt,n.ds=at,n.dt=k,n.du=function([a,t,r]){const h=Math.hypot(a,t,r),g=Math.atan2(a,r),d=.5*Math.PI-Math.acos(-t/h);return new j(We(g),We(d))},n.dv=Xx,n.dw=U,n.dx=function(a){const t=a.navigator?a.navigator.userAgent:null;return!!function(r){if(Dr==null){const h=r.navigator?r.navigator.userAgent:null;Dr=!!r.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return Dr}(a)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dy=function(a,t){ar=a,er=t},n.dz=ag,n.e=Je,n.e0=function(a){let t=0;if(new Uint32Array(a,0,1)[0]!==K2){const r=new Uint32Array(a,0,7),[,,h,g,d,_]=r;t=r.byteLength+g+d+_+d,(h!==a.byteLength||t>=a.byteLength)&&Wn("Invalid b3dm header information.")}return tM(a,t)},n.e1=function(a,t){const r=nM(a);for(const h of r){for(const g of h.meshes)JI(g);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(QI(h.lights,t)))}return r},n.e2=iv,n.e3=R2,n.e4=ua,n.e5=function(a){us(),Gr!=null&&Gr.then(t=>{t.keys().then(r=>{for(let h=0;h<r.length-a;h++)t.delete(r[h])})})},n.f=function(a){return a.indexOf("mapbox:")===0},n.g=function(a,t){return go(cn(a,{method:"GET"}),t)},n.h=Rt,n.i=function(a){return Je.API_STYLE_REGEX.test(a)&&!dt(a)},n.j=function(a){return decodeURIComponent(atob(a).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(t,r)=>String.fromCharCode(+("0x"+r))))},n.l=cn,n.m=es,n.n=function(a,t){return go(cn(a,{type:"json"}),t)},n.o=_a,n.p=function(a,t){return go(cn(a,{method:"POST"}),t)},n.q=tn,n.r=Ea,n.s=function(a){try{const t=self[a];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=zt,n.u=function(){return function a(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},n.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},n.w=Wn,n.x=je,n.y=2,n.z=kT}),N(["./shared"],function(n){function X(ai){const ye=ai?ai.url.toString():void 0;return ye?performance.getEntriesByName(ye):[]}function $(ai){if(typeof ai=="number"||typeof ai=="boolean"||typeof ai=="string"||ai==null)return JSON.stringify(ai);if(Array.isArray(ai)){let re="[";for(const Je of ai)re+=`${$(Je)},`;return`${re}]`}let ye="{";for(const re of Object.keys(ai).sort())ye+=`${re}:${$(ai[re])},`;return`${ye}}`}function ne(ai){let ye="";for(const re of n.bh)ye+=`/${$(ai[re])}`;return ye}class ve{constructor(ye){this.keyCache={},this._layers={},this._layerConfigs={},ye&&this.replace(ye)}replace(ye,re){this._layerConfigs={},this._layers={},this.update(ye,[],re)}update(ye,re,Je){this._options=Je;for(const dt of ye)this._layerConfigs[dt.id]=dt,(this._layers[dt.id]=n.cq(dt,this.scope,null,this._options)).compileFilter(Je),this.keyCache[dt.id]&&delete this.keyCache[dt.id];for(const dt of re)delete this.keyCache[dt],delete this._layerConfigs[dt],delete this._layers[dt];this.familiesBySource={};const Rt=function(dt,Nt){const oi={};for(let li=0;li<dt.length;li++){const mi=Nt&&Nt[dt[li].id]||ne(dt[li]);Nt&&(Nt[dt[li].id]=mi);let fi=oi[mi];fi||(fi=oi[mi]=[]),fi.push(dt[li])}const Zt=[];for(const li in oi)Zt.push(oi[li]);return Zt}(n.be(this._layerConfigs),this.keyCache);for(const dt of Rt){const Nt=dt.map(Pi=>this._layers[Pi.id]),oi=Nt[0];if(oi.visibility==="none")continue;const Zt=oi.source||"";let li=this.familiesBySource[Zt];li||(li=this.familiesBySource[Zt]={});const mi=oi.sourceLayer||"_geojsonTileLayer";let fi=li[mi];fi||(fi=li[mi]=[]),fi.push(Nt)}}}const ze=1*n.dP;class ke{constructor(ye){const re={},Je=[];for(const oi in ye){const Zt=ye[oi],li=re[oi]={};for(const mi in Zt.glyphs){const fi=Zt.glyphs[+mi];if(!fi||fi.bitmap.width===0||fi.bitmap.height===0)continue;const Pi=fi.metrics.localGlyph?ze:1,tn={x:0,y:0,w:fi.bitmap.width+2*Pi,h:fi.bitmap.height+2*Pi};Je.push(tn),li[mi]=tn}}const{w:Rt,h:dt}=n.z(Je),Nt=new n.dO({width:Rt||1,height:dt||1});for(const oi in ye){const Zt=ye[oi];for(const li in Zt.glyphs){const mi=Zt.glyphs[+li];if(!mi||mi.bitmap.width===0||mi.bitmap.height===0)continue;const fi=re[oi][li],Pi=mi.metrics.localGlyph?ze:1;n.dO.copy(mi.bitmap,Nt,{x:0,y:0},{x:fi.x+Pi,y:fi.y+Pi},mi.bitmap)}}this.image=Nt,this.positions=re}}n.dN(ke,"GlyphAtlas");class yt{constructor(ye){this.tileID=new n.aA(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),this.tileZoom=ye.tileZoom,this.uid=ye.uid,this.zoom=ye.zoom,this.lut=ye.lut,this.canonical=ye.tileID.canonical,this.pixelRatio=ye.pixelRatio,this.tileSize=ye.tileSize,this.source=ye.source,this.scope=ye.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ye.showCollisionBoxes,this.collectResourceTiming=!!ye.request&&ye.request.collectResourceTiming,this.promoteId=ye.promoteId,this.isSymbolTile=ye.isSymbolTile,this.tileTransform=n.aL(ye.tileID.canonical,ye.projection),this.projection=ye.projection,this.worldview=ye.worldview,this.localizableLayerIds=ye.localizableLayerIds,this.brightness=ye.brightness,this.extraShadowCaster=!!ye.extraShadowCaster,this.tessellationStep=ye.tessellationStep,this.scaleFactor=ye.scaleFactor}parse(ye,re,Je,Rt,dt){this.status="parsing",this.data=ye,this.collisionBoxArray=new n.aR;const Nt=new n.dQ(Object.keys(ye.layers).sort()),oi=new n.dR(this.tileID,this.promoteId);oi.bucketLayerIDs=[];const Zt={},li=new n.dS(256,256),mi={featureIndex:oi,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:li,availableImages:Je,brightness:this.brightness},fi=re.familiesBySource[this.source];for(const er in fi){const Zr=ye.layers[er];if(!Zr)continue;let Gr=!1,yr=!1,Jr=!1;for(const es of fi[er])es[0].type==="symbol"?Gr=!0:yr=!0,es[0].is3D()&&es[0].type!=="model"&&(Jr=!0);if(this.extraShadowCaster&&!Jr||this.isSymbolTile===!0&&!Gr||this.isSymbolTile===!1&&!yr)continue;Zr.version===1&&n.w(`Vector tile source "${this.source}" layer "${er}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const us=Nt.encode(er),Ns=[];for(let es=0,Fs=0;es<Zr.length;es++){const Ps=Zr.feature(es),Mo=oi.getId(Ps,er);if(this.localizableLayerIds&&this.localizableLayerIds.has(er)){const Qo=Ps.properties?Ps.properties.worldview:null;if(this.worldview&&typeof Qo=="string")if(Qo==="all")Ps.properties.$localized=!0;else{if(!Qo.split(",").includes(this.worldview))continue;Ps.properties.$localized=!0,Ps.properties.worldview=this.worldview}}Ns.push({feature:Ps,id:Mo,index:Fs,sourceLayerIndex:us}),Fs++}for(const es of fi[er]){const Fs=es[0];(!this.extraShadowCaster||Fs.is3D()&&Fs.type!=="model")&&(this.isSymbolTile!==void 0&&Fs.type==="symbol"!==this.isSymbolTile||Fs.minzoom&&this.zoom<Math.floor(Fs.minzoom)||Fs.maxzoom&&this.zoom>=Fs.maxzoom||Fs.visibility!=="none"&&(it(es,this.zoom,mi.brightness,Je),(Zt[Fs.id]=Fs.createBucket({index:oi.bucketLayerIDs.length,layers:es,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:us,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ns,mi,this.tileID.canonical,this.tileTransform),oi.bucketLayerIDs.push(es.map(Ps=>n.av(Ps.id,Ps.scope)))))}}let Pi,tn,xn,Jn;li.trim();const sr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ar=()=>{if(Pi)return this.status="done",dt(Pi);if(this.extraShadowCaster)this.status="done",dt(null,{buckets:n.be(Zt).filter(er=>!er.isEmpty()),featureIndex:oi,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:mi.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(tn&&xn&&Jn){const er=new ke(tn),Zr=new n.dU(xn,Jn,this.lut);for(const Gr in Zt){const yr=Zt[Gr];yr instanceof n.aS?(it(yr.layers,this.zoom,mi.brightness,Je),n.dV(yr,tn,er.positions,xn,Zr.iconPositions,this.showCollisionBoxes,Je,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):yr.hasPattern&&(yr instanceof n.aY||yr instanceof n.aZ||yr instanceof n.d0)&&(it(yr.layers,this.zoom,mi.brightness,Je),yr.addFeatures(mi,this.tileID.canonical,Zr.patternPositions,Je,this.tileTransform,this.brightness))}this.status="done",dt(null,{buckets:n.be(Zt).filter(Gr=>!Gr.isEmpty()),featureIndex:oi,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:er.image,lineAtlas:li,imageAtlas:Zr,brightness:mi.brightness})}};if(!this.extraShadowCaster){const er=n.dT(mi.glyphDependencies,yr=>Object.keys(yr).map(Number));Object.keys(er).length?Rt.send("getGlyphs",{uid:this.uid,stacks:er,scope:this.scope},(yr,Jr)=>{Pi||(Pi=yr,tn=Jr,ar())},void 0,!1,sr):tn={};const Zr=Object.keys(mi.iconDependencies);Zr.length?Rt.send("getImages",{icons:Zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(yr,Jr)=>{Pi||(Pi=yr,xn=Jr,ar())},void 0,!1,sr):xn={};const Gr=Object.keys(mi.patternDependencies);Gr.length?Rt.send("getImages",{icons:Gr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(yr,Jr)=>{Pi||(Pi=yr,Jn=Jr,ar())},void 0,!1,sr):Jn={}}ar()}}function it(ai,ye,re,Je){const Rt=new n.a3(ye,{brightness:re});for(const dt of ai)dt.recalculate(Rt,Je)}class xt extends n.E{constructor(ye,re,Je,Rt,dt,Nt){super(),this.actor=ye,this.layerIndex=re,this.availableImages=Je,this.loadVectorData=dt||n.aw,this.loading={},this.loaded={},this.deduped=new n.au(ye.scheduler),this.isSpriteLoaded=Rt,this.scheduler=ye.scheduler,this.brightness=Nt}loadTile(ye,re){const Je=ye.uid,Rt=ye&&ye.request,dt=Rt&&Rt.collectResourceTiming,Nt=this.loading[Je]=new yt(ye);Nt.abort=this.loadVectorData(ye,(oi,Zt)=>{const li=!this.loading[Je];if(delete this.loading[Je],li||oi||!Zt)return Nt.status="done",li||(this.loaded[Je]=Nt),re(oi);const mi=Zt.rawData,fi={};Zt.expires&&(fi.expires=Zt.expires),Zt.cacheControl&&(fi.cacheControl=Zt.cacheControl),Nt.vectorTile=Zt.vectorTile||new n.dW.VectorTile(new n.bc(mi));const Pi=()=>{Nt.parse(Nt.vectorTile,this.layerIndex,this.availableImages,this.actor,(tn,xn)=>{if(tn||!xn)return re(tn);const Jn={};if(dt){const sr=X(Rt);sr.length>0&&(Jn.resourceTiming=JSON.parse(JSON.stringify(sr)))}re(null,n.l({rawTileData:mi.slice(0)},xn,fi,Jn))})};this.isSpriteLoaded?Pi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Pi,{type:"parseTile",isSymbolTile:ye.isSymbolTile,zoom:ye.tileZoom}):Pi()}),this.loaded=this.loaded||{},this.loaded[Je]=Nt})}reloadTile(ye,re){const Je=this.loaded,Rt=ye.uid;if(Je&&Je[Rt]){const dt=Je[Rt];dt.scaleFactor=ye.scaleFactor,dt.showCollisionBoxes=ye.showCollisionBoxes,dt.projection=ye.projection,dt.brightness=ye.brightness,dt.tileTransform=n.aL(ye.tileID.canonical,ye.projection),dt.extraShadowCaster=ye.extraShadowCaster,dt.lut=ye.lut;const Nt=(oi,Zt)=>{const li=dt.reloadCallback;li&&(delete dt.reloadCallback,dt.parse(dt.vectorTile,this.layerIndex,this.availableImages,this.actor,li)),re(oi,Zt)};dt.status==="parsing"?dt.reloadCallback=Nt:dt.status==="done"&&(dt.vectorTile?dt.parse(dt.vectorTile,this.layerIndex,this.availableImages,this.actor,Nt):Nt())}else re(null,void 0)}abortTile(ye,re){const Je=ye.uid,Rt=this.loading[Je];Rt&&(Rt.abort&&Rt.abort(),delete this.loading[Je]),re()}removeTile(ye,re){const Je=this.loaded,Rt=ye.uid;Je&&Je[Rt]&&delete Je[Rt],re()}}class Ze{loadTile(ye,re){const{uid:Je,encoding:Rt,rawImageData:dt,padding:Nt}=ye,oi=ImageBitmap&&dt instanceof ImageBitmap?this.getImageData(dt,Nt):dt;re(null,new n.dX(Je,oi,Rt,Nt<1))}getImageData(ye,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ye.width,ye.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ye.width,this.offscreenCanvas.height=ye.height,this.offscreenCanvasContext.drawImage(ye,0,0,ye.width,ye.height);const Je=this.offscreenCanvasContext.getImageData(-re,-re,ye.width+2*re,ye.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Je}}n.bb.setPbf(n.bc);class st{decodeRasterArray({task:ye,buffer:re},Je){n.bb.performDecoding(re,ye).then(Rt=>{Je(null,Rt)},Rt=>{Je(Rt)})}}const ti=n.dW.VectorTileFeature.prototype.toGeoJSON;class mt{constructor(ye){this._feature=ye,this.extent=n.ab,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){const ye=[];for(const re of this._feature.geometry)ye.push([new n.P(re[0],re[1])]);return ye}{const ye=[];for(const re of this._feature.geometry){const Je=[];for(const Rt of re)Je.push(new n.P(Rt[0],Rt[1]));ye.push(Je)}return ye}}toGeoJSON(ye,re,Je){return ti.call(this,ye,re,Je)}}class pt{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ab,this.length=ye.length,this._features=ye}feature(ye){return new mt(this._features[ye])}}const Tt=64/4096,Fe=128;class et{constructor(){this.features=new Map}clear(){this.features.clear()}load(ye=[],re){for(const Je of ye){const Rt=Je.id;if(Rt==null)continue;let dt=this.features.get(Rt);dt&&this.updateCache(dt,re),Je.geometry?(dt=qe(Je),this.updateCache(dt,re),this.features.set(Rt,dt)):this.features.delete(Rt),this.updateCache(dt,re)}}updateCache(ye,re){for(const{canonical:Je,uid:Rt}of Object.values(re)){const{z:dt,x:Nt,y:oi}=Je;Xe(ye,Math.pow(2,dt),Nt,oi)&&delete re[Rt]}}getTile(ye,re,Je){const Rt=Math.pow(2,ye),dt=[];for(const Nt of this.features.values())Xe(Nt,Rt,re,Je)&&dt.push(Jt(Nt,Rt,re,Je));return{features:dt}}getFeatures(){return[...this.features.values()]}}function Xe({minX:ai,minY:ye,maxX:re,maxY:Je},Rt,dt,Nt){return ai<(dt+1+Tt)/Rt&&ye<(Nt+1+Tt)/Rt&&re>(dt-Tt)/Rt&&Je>(Nt-Tt)/Rt}function qe(ai){const{id:ye,geometry:re,properties:Je}=ai;if(!re)return;if(re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Rt,coordinates:dt}=re,Nt={id:ye,type:1,geometry:[],tags:Je,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},oi=Nt.geometry;if(Rt==="Point")gt(dt,oi,Nt);else if(Rt==="MultiPoint")for(const Zt of dt)gt(Zt,oi,Nt);else if(Rt==="LineString")Nt.type=2,lt(dt,oi,Nt);else if(Rt==="MultiLineString")Nt.type=2,vt(dt,oi,Nt);else if(Rt==="Polygon")Nt.type=3,vt(dt,oi,Nt,!0);else{if(Rt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Nt.type=3;for(const Zt of dt)vt(Zt,oi,Nt,!0)}return Nt}function gt([ai,ye],re,Je){const Rt=n.am(ai);let dt=n.at(ye);dt=dt<0?0:dt>1?1:dt,re.push(Rt,dt),Je.minX=Math.min(Je.minX,Rt),Je.minY=Math.min(Je.minY,dt),Je.maxX=Math.max(Je.maxX,Rt),Je.maxY=Math.max(Je.maxY,dt)}function lt(ai,ye,re,Je=!1,Rt=!1){const dt=[];for(const Nt of ai)gt(Nt,dt,re);ye.push(dt),Je&&function(Nt,oi){let Zt=0;for(let li=0,mi=Nt.length,fi=mi-2;li<mi;fi=li,li+=2)Zt+=(Nt[li]-Nt[fi])*(Nt[li+1]+Nt[fi+1]);if(Zt>0===oi)for(let li=0,mi=Nt.length;li<mi/2;li+=2){const fi=Nt[li],Pi=Nt[li+1];Nt[li]=Nt[mi-2-li],Nt[li+1]=Nt[mi-1-li],Nt[mi-2-li]=fi,Nt[mi-1-li]=Pi}}(dt,Rt)}function vt(ai,ye,re,Je=!1){for(let Rt=0;Rt<ai.length;Rt++)lt(ai[Rt],ye,re,Je,Rt===0)}function Jt(ai,ye,re,Je){const{id:Rt,type:dt,geometry:Nt,tags:oi}=ai,Zt=[];if(dt===1)(function(li,mi,fi,Pi,tn){for(let xn=0;xn<li.length;xn+=2){const Jn=Math.round(n.ab*(li[xn+0]*mi-fi)),sr=Math.round(n.ab*(li[xn+1]*mi-Pi));tn.push([Jn,sr])}})(Nt,ye,re,Je,Zt);else for(const li of Nt)le(li,ye,re,Je,Zt);return{id:Rt,type:dt,geometry:Zt,tags:oi}}function le(ai,ye,re,Je,Rt){const dt=-Fe,Nt=n.ab+Fe;let oi;for(let Zt=0;Zt<ai.length-2;Zt+=2){let li=Math.round(n.ab*(ai[Zt+0]*ye-re)),mi=Math.round(n.ab*(ai[Zt+1]*ye-Je)),fi=Math.round(n.ab*(ai[Zt+2]*ye-re)),Pi=Math.round(n.ab*(ai[Zt+3]*ye-Je));const tn=fi-li,xn=Pi-mi;li<dt&&fi<dt||(li<dt?(mi+=Math.round(xn*((dt-li)/tn)),li=dt):fi<dt&&(Pi=mi+Math.round(xn*((dt-li)/tn)),fi=dt),mi<dt&&Pi<dt||(mi<dt?(li+=Math.round(tn*((dt-mi)/xn)),mi=dt):Pi<dt&&(fi=li+Math.round(tn*((dt-mi)/xn)),Pi=dt),li>=Nt&&fi>=Nt||(li>=Nt?(mi+=Math.round(xn*((Nt-li)/tn)),li=Nt):fi>=Nt&&(Pi=mi+Math.round(xn*((Nt-li)/tn)),fi=Nt),mi>=Nt&&Pi>=Nt||(mi>=Nt?(li+=Math.round(tn*((Nt-mi)/xn)),mi=Nt):Pi>=Nt&&(fi=li+Math.round(tn*((Nt-mi)/xn)),Pi=Nt),oi&&li===oi[oi.length-1][0]&&mi===oi[oi.length-1][1]||(oi=[[li,mi]],Rt.push(oi)),oi.push([fi,Pi])))))}}var we,xe,De,Ce={exports:{}},Gt=function(){if(De)return Ce.exports;De=1;var ai=n.d_(),ye=function(){if(xe)return we;xe=1;var mi=n.dY(),fi=n.dZ().VectorTileFeature;function Pi(xn,Jn){this.options=Jn||{},this.features=xn,this.length=xn.length}function tn(xn,Jn){this.id=typeof xn.id=="number"?xn.id:void 0,this.type=xn.type,this.rawGeometry=xn.type===1?[xn.geometry]:xn.geometry,this.properties=xn.tags,this.extent=Jn||4096}return we=Pi,Pi.prototype.feature=function(xn){return new tn(this.features[xn],this.options.extent)},tn.prototype.loadGeometry=function(){var xn=this.rawGeometry;this.geometry=[];for(var Jn=0;Jn<xn.length;Jn++){for(var sr=xn[Jn],ar=[],er=0;er<sr.length;er++)ar.push(new mi(sr[er][0],sr[er][1]));this.geometry.push(ar)}return this.geometry},tn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var xn=this.geometry,Jn=1/0,sr=-1/0,ar=1/0,er=-1/0,Zr=0;Zr<xn.length;Zr++)for(var Gr=xn[Zr],yr=0;yr<Gr.length;yr++){var Jr=Gr[yr];Jn=Math.min(Jn,Jr.x),sr=Math.max(sr,Jr.x),ar=Math.min(ar,Jr.y),er=Math.max(er,Jr.y)}return[Jn,ar,sr,er]},tn.prototype.toGeoJSON=fi.prototype.toGeoJSON,we}();function re(mi){var fi=new ai;return function(Pi,tn){for(var xn in Pi.layers)tn.writeMessage(3,Je,Pi.layers[xn])}(mi,fi),fi.finish()}function Je(mi,fi){var Pi;fi.writeVarintField(15,mi.version||1),fi.writeStringField(1,mi.name||""),fi.writeVarintField(5,mi.extent||4096);var tn={keys:[],values:[],keycache:{},valuecache:{}};for(Pi=0;Pi<mi.length;Pi++)tn.feature=mi.feature(Pi),fi.writeMessage(2,Rt,tn);var xn=tn.keys;for(Pi=0;Pi<xn.length;Pi++)fi.writeStringField(3,xn[Pi]);var Jn=tn.values;for(Pi=0;Pi<Jn.length;Pi++)fi.writeMessage(4,li,Jn[Pi])}function Rt(mi,fi){var Pi=mi.feature;Pi.id!==void 0&&fi.writeVarintField(1,Pi.id),fi.writeMessage(2,dt,mi),fi.writeVarintField(3,Pi.type),fi.writeMessage(4,Zt,Pi)}function dt(mi,fi){var Pi=mi.feature,tn=mi.keys,xn=mi.values,Jn=mi.keycache,sr=mi.valuecache;for(var ar in Pi.properties){var er=Pi.properties[ar],Zr=Jn[ar];if(er!==null){Zr===void 0&&(tn.push(ar),Jn[ar]=Zr=tn.length-1),fi.writeVarint(Zr);var Gr=typeof er;Gr!=="string"&&Gr!=="boolean"&&Gr!=="number"&&(er=JSON.stringify(er));var yr=Gr+":"+er,Jr=sr[yr];Jr===void 0&&(xn.push(er),sr[yr]=Jr=xn.length-1),fi.writeVarint(Jr)}}}function Nt(mi,fi){return(fi<<3)+(7&mi)}function oi(mi){return mi<<1^mi>>31}function Zt(mi,fi){for(var Pi=mi.loadGeometry(),tn=mi.type,xn=0,Jn=0,sr=Pi.length,ar=0;ar<sr;ar++){var er=Pi[ar],Zr=1;tn===1&&(Zr=er.length),fi.writeVarint(Nt(1,Zr));for(var Gr=tn===3?er.length-1:er.length,yr=0;yr<Gr;yr++){yr===1&&tn!==1&&fi.writeVarint(Nt(2,Gr-1));var Jr=er[yr].x-xn,us=er[yr].y-Jn;fi.writeVarint(oi(Jr)),fi.writeVarint(oi(us)),xn+=Jr,Jn+=us}tn===3&&fi.writeVarint(Nt(7,1))}}function li(mi,fi){var Pi=typeof mi;Pi==="string"?fi.writeStringField(1,mi):Pi==="boolean"?fi.writeBooleanField(7,mi):Pi==="number"&&(mi%1!=0?fi.writeDoubleField(3,mi):mi<0?fi.writeSVarintField(6,mi):fi.writeVarintField(5,mi))}return Ce.exports=re,Ce.exports.fromVectorTileJs=re,Ce.exports.fromGeojsonVt=function(mi,fi){fi=fi||{};var Pi={};for(var tn in mi)Pi[tn]=new ye(mi[tn].features,fi),Pi[tn].name=tn,Pi[tn].version=fi.version,Pi[tn].extent=fi.extent;return re({layers:Pi})},Ce.exports.GeoJSONWrapper=ye,Ce.exports}(),Ft=n.d$(Gt);const bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ai=>ai},Vt=Math.fround||(Ht=new Float32Array(1),ai=>(Ht[0]=+ai,Ht[0]));var Ht;const ni=3,zi=5,Hi=6;class on{constructor(ye){this.options=Object.assign(Object.create(bt),ye),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ye){const{log:re,minZoom:Je,maxZoom:Rt}=this.options;re&&console.time("total time");const dt=`prepare ${ye.length} points`;re&&console.time(dt),this.points=ye;const Nt=[];for(let Zt=0;Zt<ye.length;Zt++){const li=ye[Zt];if(!li.geometry)continue;const[mi,fi]=li.geometry.coordinates,Pi=Vt(Yn(mi)),tn=Vt(pr(fi));Nt.push(Pi,tn,1/0,Zt,-1,1),this.options.reduce&&Nt.push(0)}let oi=this.trees[Rt+1]=this._createTree(Nt);re&&console.timeEnd(dt);for(let Zt=Rt;Zt>=Je;Zt--){const li=+Date.now();oi=this.trees[Zt]=this._createTree(this._cluster(oi,Zt)),re&&console.log("z%d: %d clusters in %dms",Zt,oi.numItems,+Date.now()-li)}return re&&console.timeEnd("total time"),this}getClusters(ye,re){let Je=((ye[0]+180)%360+360)%360-180;const Rt=Math.max(-90,Math.min(90,ye[1]));let dt=ye[2]===180?180:((ye[2]+180)%360+360)%360-180;const Nt=Math.max(-90,Math.min(90,ye[3]));if(ye[2]-ye[0]>=360)Je=-180,dt=180;else if(Je>dt){const fi=this.getClusters([Je,Rt,180,Nt],re),Pi=this.getClusters([-180,Rt,dt,Nt],re);return fi.concat(Pi)}const oi=this.trees[this._limitZoom(re)],Zt=oi.range(Yn(Je),pr(Nt),Yn(dt),pr(Rt)),li=oi.data,mi=[];for(const fi of Zt){const Pi=this.stride*fi;mi.push(li[Pi+zi]>1?mn(li,Pi,this.clusterProps):this.points[li[Pi+ni]])}return mi}getChildren(ye){const re=this._getOriginId(ye),Je=this._getOriginZoom(ye),Rt="No cluster with the specified id.",dt=this.trees[Je];if(!dt)throw new Error(Rt);const Nt=dt.data;if(re*this.stride>=Nt.length)throw new Error(Rt);const oi=this.options.radius/(this.options.extent*Math.pow(2,Je-1)),Zt=dt.within(Nt[re*this.stride],Nt[re*this.stride+1],oi),li=[];for(const mi of Zt){const fi=mi*this.stride;Nt[fi+4]===ye&&li.push(Nt[fi+zi]>1?mn(Nt,fi,this.clusterProps):this.points[Nt[fi+ni]])}if(li.length===0)throw new Error(Rt);return li}getLeaves(ye,re,Je){const Rt=[];return this._appendLeaves(Rt,ye,re=re||10,Je=Je||0,0),Rt}getTile(ye,re,Je){const Rt=this.trees[this._limitZoom(ye)],dt=Math.pow(2,ye),{extent:Nt,radius:oi}=this.options,Zt=oi/Nt,li=(Je-Zt)/dt,mi=(Je+1+Zt)/dt,fi={features:[]};return this._addTileFeatures(Rt.range((re-Zt)/dt,li,(re+1+Zt)/dt,mi),Rt.data,re,Je,dt,fi),re===0&&this._addTileFeatures(Rt.range(1-Zt/dt,li,1,mi),Rt.data,dt,Je,dt,fi),re===dt-1&&this._addTileFeatures(Rt.range(0,li,Zt/dt,mi),Rt.data,-1,Je,dt,fi),fi.features.length?fi:null}getClusterExpansionZoom(ye){let re=this._getOriginZoom(ye)-1;for(;re<=this.options.maxZoom;){const Je=this.getChildren(ye);if(re++,Je.length!==1)break;ye=Je[0].properties.cluster_id}return re}_appendLeaves(ye,re,Je,Rt,dt){const Nt=this.getChildren(re);for(const oi of Nt){const Zt=oi.properties;if(Zt&&Zt.cluster?dt+Zt.point_count<=Rt?dt+=Zt.point_count:dt=this._appendLeaves(ye,Zt.cluster_id,Je,Rt,dt):dt<Rt?dt++:ye.push(oi),ye.length===Je)break}return dt}_createTree(ye){const re=new n.bz(ye.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Je=0;Je<ye.length;Je+=this.stride)re.add(ye[Je],ye[Je+1]);return re.finish(),re.data=ye,re}_addTileFeatures(ye,re,Je,Rt,dt,Nt){for(const oi of ye){const Zt=oi*this.stride,li=re[Zt+zi]>1;let mi,fi,Pi;if(li)mi=ot(re,Zt,this.clusterProps),fi=re[Zt],Pi=re[Zt+1];else{const Jn=this.points[re[Zt+ni]];mi=Jn.properties;const[sr,ar]=Jn.geometry.coordinates;fi=Yn(sr),Pi=pr(ar)}const tn={type:1,geometry:[[Math.round(this.options.extent*(fi*dt-Je)),Math.round(this.options.extent*(Pi*dt-Rt))]],tags:mi};let xn;xn=li||this.options.generateId?re[Zt+ni]:this.points[re[Zt+ni]].id,xn!==void 0&&(tn.id=xn),Nt.features.push(tn)}}_limitZoom(ye){return Math.max(this.options.minZoom,Math.min(Math.floor(+ye),this.options.maxZoom+1))}_cluster(ye,re){const{radius:Je,extent:Rt,reduce:dt,minPoints:Nt}=this.options,oi=Je/(Rt*Math.pow(2,re)),Zt=ye.data,li=[],mi=this.stride;for(let fi=0;fi<Zt.length;fi+=mi){if(Zt[fi+2]<=re)continue;Zt[fi+2]=re;const Pi=Zt[fi],tn=Zt[fi+1],xn=ye.within(Zt[fi],Zt[fi+1],oi),Jn=Zt[fi+zi];let sr=Jn;for(const ar of xn){const er=ar*mi;Zt[er+2]>re&&(sr+=Zt[er+zi])}if(sr>Jn&&sr>=Nt){let ar,er=Pi*Jn,Zr=tn*Jn,Gr=-1;const yr=(fi/mi<<5)+(re+1)+this.points.length;for(const Jr of xn){const us=Jr*mi;if(Zt[us+2]<=re)continue;Zt[us+2]=re;const Ns=Zt[us+zi];er+=Zt[us]*Ns,Zr+=Zt[us+1]*Ns,Zt[us+4]=yr,dt&&(ar||(ar=this._map(Zt,fi,!0),Gr=this.clusterProps.length,this.clusterProps.push(ar)),dt(ar,this._map(Zt,us)))}Zt[fi+4]=yr,li.push(er/sr,Zr/sr,1/0,yr,-1,sr),dt&&li.push(Gr)}else{for(let ar=0;ar<mi;ar++)li.push(Zt[fi+ar]);if(sr>1)for(const ar of xn){const er=ar*mi;if(!(Zt[er+2]<=re)){Zt[er+2]=re;for(let Zr=0;Zr<mi;Zr++)li.push(Zt[er+Zr])}}}}return li}_getOriginId(ye){return ye-this.points.length>>5}_getOriginZoom(ye){return(ye-this.points.length)%32}_map(ye,re,Je){if(ye[re+zi]>1){const Nt=this.clusterProps[ye[re+Hi]];return Je?Object.assign({},Nt):Nt}const Rt=this.points[ye[re+ni]].properties,dt=this.options.map(Rt);return Je&&dt===Rt?Object.assign({},dt):dt}}function mn(ai,ye,re){return{type:"Feature",id:ai[ye+ni],properties:ot(ai,ye,re),geometry:{type:"Point",coordinates:[(Je=ai[ye],360*(Je-.5)),At(ai[ye+1])]}};var Je}function ot(ai,ye,re){const Je=ai[ye+zi],Rt=Je>=1e4?`${Math.round(Je/1e3)}k`:Je>=1e3?Math.round(Je/100)/10+"k":Je,dt=ai[ye+Hi],Nt=dt===-1?{}:Object.assign({},re[dt]);return Object.assign(Nt,{cluster:!0,cluster_id:ai[ye+ni],point_count:Je,point_count_abbreviated:Rt})}function Yn(ai){return ai/360+.5}function pr(ai){const ye=Math.sin(ai*Math.PI/180),re=.5-.25*Math.log((1+ye)/(1-ye))/Math.PI;return re<0?0:re>1?1:re}function At(ai){const ye=(180-360*ai)*Math.PI/180;return 360*Math.atan(Math.exp(ye))/Math.PI-90}function Ye(ai,ye,re,Je){let Rt=Je;const dt=ye+(re-ye>>1);let Nt,oi=re-ye;const Zt=ai[ye],li=ai[ye+1],mi=ai[re],fi=ai[re+1];for(let Pi=ye+3;Pi<re;Pi+=3){const tn=kt(ai[Pi],ai[Pi+1],Zt,li,mi,fi);if(tn>Rt)Nt=Pi,Rt=tn;else if(tn===Rt){const xn=Math.abs(Pi-dt);xn<oi&&(Nt=Pi,oi=xn)}}Rt>Je&&(Nt-ye>3&&Ye(ai,ye,Nt,Je),ai[Nt+2]=Rt,re-Nt>3&&Ye(ai,Nt,re,Je))}function kt(ai,ye,re,Je,Rt,dt){let Nt=Rt-re,oi=dt-Je;if(Nt!==0||oi!==0){const Zt=((ai-re)*Nt+(ye-Je)*oi)/(Nt*Nt+oi*oi);Zt>1?(re=Rt,Je=dt):Zt>0&&(re+=Nt*Zt,Je+=oi*Zt)}return Nt=ai-re,oi=ye-Je,Nt*Nt+oi*oi}function Le(ai,ye,re,Je){const Rt={id:ai??null,type:ye,geometry:re,tags:Je,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ie(Rt,re);else if(ye==="Polygon")Ie(Rt,re[0]);else if(ye==="MultiLineString")for(const dt of re)Ie(Rt,dt);else if(ye==="MultiPolygon")for(const dt of re)Ie(Rt,dt[0]);return Rt}function Ie(ai,ye){for(let re=0;re<ye.length;re+=3)ai.minX=Math.min(ai.minX,ye[re]),ai.minY=Math.min(ai.minY,ye[re+1]),ai.maxX=Math.max(ai.maxX,ye[re]),ai.maxY=Math.max(ai.maxY,ye[re+1])}function Ue(ai,ye,re,Je){if(!ye.geometry)return;const Rt=ye.geometry.coordinates;if(Rt&&Rt.length===0)return;const dt=ye.geometry.type,Nt=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let oi=[],Zt=ye.id;if(re.promoteId?Zt=ye.properties[re.promoteId]:re.generateId&&(Zt=Je||0),dt==="Point")We(Rt,oi);else if(dt==="MultiPoint")for(const li of Rt)We(li,oi);else if(dt==="LineString")rt(Rt,oi,Nt,!1);else if(dt==="MultiLineString"){if(re.lineMetrics){for(const li of Rt)oi=[],rt(li,oi,Nt,!1),ai.push(Le(Zt,"LineString",oi,ye.properties));return}ut(Rt,oi,Nt,!1)}else if(dt==="Polygon")ut(Rt,oi,Nt,!0);else{if(dt!=="MultiPolygon"){if(dt==="GeometryCollection"){for(const li of ye.geometry.geometries)Ue(ai,{id:Zt,geometry:li,properties:ye.properties},re,Je);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const li of Rt){const mi=[];ut(li,mi,Nt,!0),oi.push(mi)}}ai.push(Le(Zt,dt,oi,ye.properties))}function We(ai,ye){ye.push(ht(ai[0]),Lt(ai[1]),0)}function rt(ai,ye,re,Je){let Rt,dt,Nt=0;for(let Zt=0;Zt<ai.length;Zt++){const li=ht(ai[Zt][0]),mi=Lt(ai[Zt][1]);ye.push(li,mi,0),Zt>0&&(Nt+=Je?(Rt*mi-li*dt)/2:Math.sqrt(Math.pow(li-Rt,2)+Math.pow(mi-dt,2))),Rt=li,dt=mi}const oi=ye.length-3;ye[2]=1,Ye(ye,0,oi,re),ye[oi+2]=1,ye.size=Math.abs(Nt),ye.start=0,ye.end=ye.size}function ut(ai,ye,re,Je){for(let Rt=0;Rt<ai.length;Rt++){const dt=[];rt(ai[Rt],dt,re,Je),ye.push(dt)}}function ht(ai){return ai/360+.5}function Lt(ai){const ye=Math.sin(ai*Math.PI/180),re=.5-.25*Math.log((1+ye)/(1-ye))/Math.PI;return re<0?0:re>1?1:re}function It(ai,ye,re,Je,Rt,dt,Nt,oi){if(Je/=ye,dt>=(re/=ye)&&Nt<Je)return ai;if(Nt<re||dt>=Je)return null;const Zt=[];for(const li of ai){const mi=li.geometry;let fi=li.type;const Pi=Rt===0?li.minX:li.minY,tn=Rt===0?li.maxX:li.maxY;if(Pi>=re&&tn<Je){Zt.push(li);continue}if(tn<re||Pi>=Je)continue;let xn=[];if(fi==="Point"||fi==="MultiPoint")ui(mi,xn,re,Je,Rt);else if(fi==="LineString")xi(mi,xn,re,Je,Rt,!1,oi.lineMetrics);else if(fi==="MultiLineString")cn(mi,xn,re,Je,Rt,!1);else if(fi==="Polygon")cn(mi,xn,re,Je,Rt,!0);else if(fi==="MultiPolygon")for(const Jn of mi){const sr=[];cn(Jn,sr,re,Je,Rt,!0),sr.length&&xn.push(sr)}if(xn.length){if(oi.lineMetrics&&fi==="LineString"){for(const Jn of xn)Zt.push(Le(li.id,fi,Jn,li.tags));continue}fi!=="LineString"&&fi!=="MultiLineString"||(xn.length===1?(fi="LineString",xn=xn[0]):fi="MultiLineString"),fi!=="Point"&&fi!=="MultiPoint"||(fi=xn.length===3?"Point":"MultiPoint"),Zt.push(Le(li.id,fi,xn,li.tags))}}return Zt.length?Zt:null}function ui(ai,ye,re,Je,Rt){for(let dt=0;dt<ai.length;dt+=3){const Nt=ai[dt+Rt];Nt>=re&&Nt<=Je&&_n(ye,ai[dt],ai[dt+1],ai[dt+2])}}function xi(ai,ye,re,Je,Rt,dt,Nt){let oi=an(ai);const Zt=Rt===0?Fn:Mn;let li,mi,fi=ai.start;for(let sr=0;sr<ai.length-3;sr+=3){const ar=ai[sr],er=ai[sr+1],Zr=ai[sr+2],Gr=ai[sr+3],yr=ai[sr+4],Jr=Rt===0?ar:er,us=Rt===0?Gr:yr;let Ns=!1;Nt&&(li=Math.sqrt(Math.pow(ar-Gr,2)+Math.pow(er-yr,2))),Jr<re?us>re&&(mi=Zt(oi,ar,er,Gr,yr,re),Nt&&(oi.start=fi+li*mi)):Jr>Je?us<Je&&(mi=Zt(oi,ar,er,Gr,yr,Je),Nt&&(oi.start=fi+li*mi)):_n(oi,ar,er,Zr),us<re&&Jr>=re&&(mi=Zt(oi,ar,er,Gr,yr,re),Ns=!0),us>Je&&Jr<=Je&&(mi=Zt(oi,ar,er,Gr,yr,Je),Ns=!0),!dt&&Ns&&(Nt&&(oi.end=fi+li*mi),ye.push(oi),oi=an(ai)),Nt&&(fi+=li)}let Pi=ai.length-3;const tn=ai[Pi],xn=ai[Pi+1],Jn=Rt===0?tn:xn;Jn>=re&&Jn<=Je&&_n(oi,tn,xn,ai[Pi+2]),Pi=oi.length-3,dt&&Pi>=3&&(oi[Pi]!==oi[0]||oi[Pi+1]!==oi[1])&&_n(oi,oi[0],oi[1],oi[2]),oi.length&&ye.push(oi)}function an(ai){const ye=[];return ye.size=ai.size,ye.start=ai.start,ye.end=ai.end,ye}function cn(ai,ye,re,Je,Rt,dt){for(const Nt of ai)xi(Nt,ye,re,Je,Rt,dt,!1)}function _n(ai,ye,re,Je){ai.push(ye,re,Je)}function Fn(ai,ye,re,Je,Rt,dt){const Nt=(dt-ye)/(Je-ye);return _n(ai,dt,re+(Rt-re)*Nt,1),Nt}function Mn(ai,ye,re,Je,Rt,dt){const Nt=(dt-re)/(Rt-re);return _n(ai,ye+(Je-ye)*Nt,dt,1),Nt}function jn(ai,ye){const re=[];for(let Je=0;Je<ai.length;Je++){const Rt=ai[Je],dt=Rt.type;let Nt;if(dt==="Point"||dt==="MultiPoint"||dt==="LineString")Nt=Lr(Rt.geometry,ye);else if(dt==="MultiLineString"||dt==="Polygon"){Nt=[];for(const oi of Rt.geometry)Nt.push(Lr(oi,ye))}else if(dt==="MultiPolygon"){Nt=[];for(const oi of Rt.geometry){const Zt=[];for(const li of oi)Zt.push(Lr(li,ye));Nt.push(Zt)}}re.push(Le(Rt.id,dt,Nt,Rt.tags))}return re}function Lr(ai,ye){const re=[];re.size=ai.size,ai.start!==void 0&&(re.start=ai.start,re.end=ai.end);for(let Je=0;Je<ai.length;Je+=3)re.push(ai[Je]+ye,ai[Je+1],ai[Je+2]);return re}function Tr(ai,ye){if(ai.transformed)return ai;const re=1<<ai.z,Je=ai.x,Rt=ai.y;for(const dt of ai.features){const Nt=dt.geometry,oi=dt.type;if(dt.geometry=[],oi===1)for(let Zt=0;Zt<Nt.length;Zt+=2)dt.geometry.push(to(Nt[Zt],Nt[Zt+1],ye,re,Je,Rt));else for(let Zt=0;Zt<Nt.length;Zt++){const li=[];for(let mi=0;mi<Nt[Zt].length;mi+=2)li.push(to(Nt[Zt][mi],Nt[Zt][mi+1],ye,re,Je,Rt));dt.geometry.push(li)}}return ai.transformed=!0,ai}function to(ai,ye,re,Je,Rt,dt){return[Math.round(re*(ai*Je-Rt)),Math.round(re*(ye*Je-dt))]}function $r(ai,ye,re,Je,Rt){const dt=ye===Rt.maxZoom?0:Rt.tolerance/((1<<ye)*Rt.extent),Nt={features:[],numPoints:0,numSimplified:0,numFeatures:ai.length,source:null,x:re,y:Je,z:ye,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const oi of ai)en(Nt,oi,dt,Rt);return Nt}function en(ai,ye,re,Je){const Rt=ye.geometry,dt=ye.type,Nt=[];if(ai.minX=Math.min(ai.minX,ye.minX),ai.minY=Math.min(ai.minY,ye.minY),ai.maxX=Math.max(ai.maxX,ye.maxX),ai.maxY=Math.max(ai.maxY,ye.maxY),dt==="Point"||dt==="MultiPoint")for(let oi=0;oi<Rt.length;oi+=3)Nt.push(Rt[oi],Rt[oi+1]),ai.numPoints++,ai.numSimplified++;else if(dt==="LineString")Wn(Nt,Rt,ai,re,!1,!1);else if(dt==="MultiLineString"||dt==="Polygon")for(let oi=0;oi<Rt.length;oi++)Wn(Nt,Rt[oi],ai,re,dt==="Polygon",oi===0);else if(dt==="MultiPolygon")for(let oi=0;oi<Rt.length;oi++){const Zt=Rt[oi];for(let li=0;li<Zt.length;li++)Wn(Nt,Zt[li],ai,re,!0,li===0)}if(Nt.length){let oi=ye.tags||null;if(dt==="LineString"&&Je.lineMetrics){oi={};for(const li in ye.tags)oi[li]=ye.tags[li];oi.mapbox_clip_start=Rt.start/Rt.size,oi.mapbox_clip_end=Rt.end/Rt.size}const Zt={geometry:Nt,type:dt==="Polygon"||dt==="MultiPolygon"?3:dt==="LineString"||dt==="MultiLineString"?2:1,tags:oi};ye.id!==null&&(Zt.id=ye.id),ai.features.push(Zt)}}function Wn(ai,ye,re,Je,Rt,dt){const Nt=Je*Je;if(Je>0&&ye.size<(Rt?Nt:Je))return void(re.numPoints+=ye.length/3);const oi=[];for(let Zt=0;Zt<ye.length;Zt+=3)(Je===0||ye[Zt+2]>Nt)&&(re.numSimplified++,oi.push(ye[Zt],ye[Zt+1])),re.numPoints++;Rt&&function(Zt,li){let mi=0;for(let fi=0,Pi=Zt.length,tn=Pi-2;fi<Pi;tn=fi,fi+=2)mi+=(Zt[fi]-Zt[tn])*(Zt[fi+1]+Zt[tn+1]);if(mi>0===li)for(let fi=0,Pi=Zt.length;fi<Pi/2;fi+=2){const tn=Zt[fi],xn=Zt[fi+1];Zt[fi]=Zt[Pi-2-fi],Zt[fi+1]=Zt[Pi-1-fi],Zt[Pi-2-fi]=tn,Zt[Pi-1-fi]=xn}}(oi,dt),ai.push(oi)}const Ls={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class To{constructor(ye,re){const Je=(re=this.options=function(dt,Nt){for(const oi in Nt)dt[oi]=Nt[oi];return dt}(Object.create(Ls),re)).debug;if(Je&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let Rt=function(dt,Nt){const oi=[];if(dt.type==="FeatureCollection")for(let Zt=0;Zt<dt.features.length;Zt++)Ue(oi,dt.features[Zt],Nt,Zt);else Ue(oi,dt.type==="Feature"?dt:{geometry:dt},Nt);return oi}(ye,re);this.tiles={},this.tileCoords=[],Je&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Rt=function(dt,Nt){const oi=Nt.buffer/Nt.extent;let Zt=dt;const li=It(dt,1,-1-oi,oi,0,-1,2,Nt),mi=It(dt,1,1-oi,2+oi,0,-1,2,Nt);return(li||mi)&&(Zt=It(dt,1,-oi,1+oi,0,-1,2,Nt)||[],li&&(Zt=jn(li,1).concat(Zt)),mi&&(Zt=Zt.concat(jn(mi,-1)))),Zt}(Rt,re),Rt.length&&this.splitTile(Rt,0,0,0),Je&&(Rt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ye,re,Je,Rt,dt,Nt,oi){const Zt=[ye,re,Je,Rt],li=this.options,mi=li.debug;for(;Zt.length;){Rt=Zt.pop(),Je=Zt.pop(),re=Zt.pop(),ye=Zt.pop();const fi=1<<re,Pi=Ro(re,Je,Rt);let tn=this.tiles[Pi];if(!tn&&(mi>1&&console.time("creation"),tn=this.tiles[Pi]=$r(ye,re,Je,Rt,li),this.tileCoords.push({z:re,x:Je,y:Rt}),mi)){mi>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,Je,Rt,tn.numFeatures,tn.numPoints,tn.numSimplified),console.timeEnd("creation"));const Ns=`z${re}`;this.stats[Ns]=(this.stats[Ns]||0)+1,this.total++}if(tn.source=ye,dt==null){if(re===li.indexMaxZoom||tn.numPoints<=li.indexMaxPoints)continue}else{if(re===li.maxZoom||re===dt)continue;if(dt!=null){const Ns=dt-re;if(Je!==Nt>>Ns||Rt!==oi>>Ns)continue}}if(tn.source=null,ye.length===0)continue;mi>1&&console.time("clipping");const xn=.5*li.buffer/li.extent,Jn=.5-xn,sr=.5+xn,ar=1+xn;let er=null,Zr=null,Gr=null,yr=null,Jr=It(ye,fi,Je-xn,Je+sr,0,tn.minX,tn.maxX,li),us=It(ye,fi,Je+Jn,Je+ar,0,tn.minX,tn.maxX,li);ye=null,Jr&&(er=It(Jr,fi,Rt-xn,Rt+sr,1,tn.minY,tn.maxY,li),Zr=It(Jr,fi,Rt+Jn,Rt+ar,1,tn.minY,tn.maxY,li),Jr=null),us&&(Gr=It(us,fi,Rt-xn,Rt+sr,1,tn.minY,tn.maxY,li),yr=It(us,fi,Rt+Jn,Rt+ar,1,tn.minY,tn.maxY,li),us=null),mi>1&&console.timeEnd("clipping"),Zt.push(er||[],re+1,2*Je,2*Rt),Zt.push(Zr||[],re+1,2*Je,2*Rt+1),Zt.push(Gr||[],re+1,2*Je+1,2*Rt),Zt.push(yr||[],re+1,2*Je+1,2*Rt+1)}}getTile(ye,re,Je){ye=+ye,re=+re,Je=+Je;const Rt=this.options,{extent:dt,debug:Nt}=Rt;if(ye<0||ye>24)return null;const oi=1<<ye,Zt=Ro(ye,re=re+oi&oi-1,Je);if(this.tiles[Zt])return Tr(this.tiles[Zt],dt);Nt>1&&console.log("drilling down to z%d-%d-%d",ye,re,Je);let li,mi=ye,fi=re,Pi=Je;for(;!li&&mi>0;)mi--,fi>>=1,Pi>>=1,li=this.tiles[Ro(mi,fi,Pi)];return li&&li.source?(Nt>1&&(console.log("found parent tile z%d-%d-%d",mi,fi,Pi),console.time("drilling down")),this.splitTile(li.source,mi,fi,Pi,ye,re,Je),Nt>1&&console.timeEnd("drilling down"),this.tiles[Zt]?Tr(this.tiles[Zt],dt):null):null}}function Ro(ai,ye,re){return 32*((1<<ai)*re+ye)+ai}function _s(ai,ye){const re=ai.tileID.canonical;if(!this._geoJSONIndex)return void ye(null,null);const Je=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!Je)return void ye(null,null);const Rt=new pt(Je.features);let dt=Ft(Rt);dt.byteOffset===0&&dt.byteLength===dt.buffer.byteLength||(dt=new Uint8Array(dt)),ye(null,{vectorTile:Rt,rawData:dt.buffer})}class js extends xt{constructor(ye,re,Je,Rt,dt,Nt){super(ye,re,Je,Rt,_s,Nt),dt&&(this.loadGeoJSON=dt),this._dynamicIndex=new et}loadData(ye,re){const Je=ye&&ye.request,Rt=Je&&Je.collectResourceTiming;this.loadGeoJSON(ye,(dt,Nt)=>{if(dt||!Nt)return re(dt);if(typeof Nt!="object")return re(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`));{try{if(ye.filter){const Zt=n.M(ye.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Zt.result==="error")throw new Error(Zt.value.map(li=>`${li.key}: ${li.message}`).join(", "));Nt.features=Nt.features.filter(li=>Zt.value.evaluate({zoom:0},li))}ye.dynamic?(Nt.type==="Feature"&&(Nt={type:"FeatureCollection",features:[Nt]}),ye.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Nt.features,this.loaded),ye.cluster&&(Nt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ye.cluster?new on(function({superclusterOptions:Zt,clusterProperties:li}){if(!li||!Zt)return Zt;const mi={},fi={},Pi={accumulated:null,zoom:0},tn={properties:null},xn=Object.keys(li);for(const Jn of xn){const[sr,ar]=li[Jn],er=n.M(ar),Zr=n.M(typeof sr=="string"?[sr,["accumulated"],["get",Jn]]:sr);mi[Jn]=er.value,fi[Jn]=Zr.value}return Zt.map=Jn=>{tn.properties=Jn;const sr={};for(const ar of xn)sr[ar]=mi[ar].evaluate(Pi,tn);return sr},Zt.reduce=(Jn,sr)=>{tn.properties=sr;for(const ar of xn)Pi.accumulated=Jn[ar],Jn[ar]=fi[ar].evaluate(Pi,tn)},Zt}(ye)).load(Nt.features):ye.dynamic?this._dynamicIndex:function(Zt,li){return new To(Zt,li)}(Nt,ye.geojsonVtOptions)}catch(Zt){return re(Zt)}const oi={};if(Rt){const Zt=X(Je);Zt&&(oi.resourceTiming={},oi.resourceTiming[ye.source]=JSON.parse(JSON.stringify(Zt)))}re(null,oi)}})}reloadTile(ye,re){const Je=this.loaded;return Je&&Je[ye.uid]?ye.partial?re(null,void 0):super.reloadTile(ye,re):this.loadTile(ye,re)}loadGeoJSON(ye,re){if(ye.request)n.n(ye.request,re);else{if(typeof ye.data!="string")return re(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(ye.data))}catch{return re(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ye,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(ye.clusterId))}catch(Je){re(Je)}}getClusterChildren(ye,re){try{re(null,this._geoJSONIndex.getChildren(ye.clusterId))}catch(Je){re(Je)}}getClusterLeaves(ye,re){try{re(null,this._geoJSONIndex.getLeaves(ye.clusterId,ye.limit,ye.offset))}catch(Je){re(Je)}}}class Dr{constructor(ye,re){this.tileID=new n.aA(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),this.tileZoom=ye.tileZoom,this.uid=ye.uid,this.zoom=ye.zoom,this.canonical=ye.tileID.canonical,this.pixelRatio=ye.pixelRatio,this.tileSize=ye.tileSize,this.source=ye.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ye.projection,this.brightness=re}parse(ye,re,Je,Rt){this.status="parsing";const dt=new n.aA(Je.tileID.overscaledZ,Je.tileID.wrap,Je.tileID.canonical.z,Je.tileID.canonical.x,Je.tileID.canonical.y),Nt=[],oi=re.familiesBySource[Je.source],Zt=new n.dR(dt,Je.promoteId);return Zt.bucketLayerIDs=[],Zt.is3DTile=!0,n.e0(ye).then(li=>{if(!li)return Rt(new Error("Could not parse tile"));const mi=n.e1(li,1/n.c9(Je.tileID.canonical)),fi=li.json.extensionsUsed&&li.json.extensionsUsed.includes("MAPBOX_mesh_features")||li.json.asset.extras&&li.json.asset.extras.MAPBOX_mesh_features,Pi=li.json.extensionsUsed&&li.json.extensionsUsed.includes("EXT_meshopt_compression"),tn=new n.a3(this.zoom,{brightness:this.brightness});for(const xn in oi)for(const Jn of oi[xn]){const sr=Jn[0];Zt.bucketLayerIDs.push(Jn.map(er=>n.av(er.id,er.scope))),sr.recalculate(tn,[]);const ar=new n.e2(Jn,mi,dt,fi,Pi,this.brightness,Zt);fi||(ar.needsUpload=!0),Nt.push(ar),ar.evaluate(sr)}this.status="done",Rt(null,{buckets:Nt,featureIndex:Zt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(li=>Rt(new Error(li.message)))}}class ro{constructor(ye,re,Je,Rt,dt,Nt){this.actor=ye,this.layerIndex=re,this.availableImages=Je,this.brightness=Nt,this.loading={},this.loaded={}}loadTile(ye,re){const Je=ye.uid,Rt=this.loading[Je]=new Dr(ye,this.brightness);n.bd(ye.request,(dt,Nt)=>{const oi=!this.loading[Je];return delete this.loading[Je],oi||dt?(Rt.status="done",oi||(this.loaded[Je]=Rt),re(dt)):Nt&&Nt.byteLength!==0?void Rt.parse(Nt,this.layerIndex,ye,(Zt,li)=>{Rt.status="done",this.loaded=this.loaded||{},this.loaded[Je]=Rt,Zt||!li?re(Zt):re(null,li)}):(Rt.status="done",this.loaded[Je]=Rt,re())})}reloadTile(ye,re){const Je=this.loaded,Rt=ye.uid;if(Je&&Je[Rt]){const dt=Je[Rt];dt.projection=ye.projection,dt.brightness=ye.brightness;const Nt=(oi,Zt)=>{dt.reloadCallback&&(delete dt.reloadCallback,this.loadTile(ye,re)),re(oi,Zt)};dt.status==="parsing"?dt.reloadCallback=Nt:dt.status==="done"&&this.loadTile(ye,re)}}abortTile(ye,re){const Je=ye.uid;this.loading[Je]&&delete this.loading[Je],re()}removeTile(ye,re){const Je=this.loaded,Rt=ye.uid;Je&&Je[Rt]&&delete Je[Rt],re()}}class po{constructor(ye){this.self=ye,this.actor=new n.e3(ye,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.bM({name:"mercator"}),this.workerSourceTypes={vector:xt,geojson:js,"batched-model":ro},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,Je)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=Je},this.self.registerRTLTextPlugin=re=>{if(n.e4.isParsed())throw new Error("RTL text plugin already registered.");n.e4.applyArabicShaping=re.applyArabicShaping,n.e4.processBidirectionalText=re.processBidirectionalText,n.e4.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(ye,re,Je){delete this.layerIndexes[ye],delete this.availableImages[ye],delete this.workerSources[ye],delete this.demWorkerSources[ye],delete this.rasterArrayWorkerSource,Je()}checkIfReady(ye,re,Je){Je()}setReferrer(ye,re){this.referrer=re}spriteLoaded(ye,{scope:re,isLoaded:Je}){if(this.isSpriteLoaded[ye]||(this.isSpriteLoaded[ye]={}),this.isSpriteLoaded[ye][re]=Je,this.workerSources[ye]&&this.workerSources[ye][re])for(const Rt in this.workerSources[ye][re]){const dt=this.workerSources[ye][re][Rt];for(const Nt in dt){const oi=dt[Nt];oi instanceof xt&&(oi.isSpriteLoaded=Je,oi.fire(new n.x("isSpriteLoaded")))}}}setImages(ye,{scope:re,images:Je},Rt){if(this.availableImages[ye]||(this.availableImages[ye]={}),this.availableImages[ye][re]=Je,this.workerSources[ye]&&this.workerSources[ye][re]){for(const dt in this.workerSources[ye][re]){const Nt=this.workerSources[ye][re][dt];for(const oi in Nt)Nt[oi].availableImages=Je}Rt()}else Rt()}setProjection(ye,re){this.projections[ye]=n.bM(re)}setBrightness(ye,re,Je){this.brightness=re,Je()}setLayers(ye,re,Je){this.getLayerIndex(ye,re.scope).replace(re.layers,re.options),Je()}updateLayers(ye,re,Je){this.getLayerIndex(ye,re.scope).update(re.layers,re.removedIds,re.options),Je()}loadTile(ye,re,Je){re.projection=this.projections[ye]||this.defaultProjection,this.getWorkerSource(ye,re.type,re.source,re.scope).loadTile(re,Je)}loadDEMTile(ye,re,Je){this.getDEMWorkerSource(ye,re.source,re.scope).loadTile(re,Je)}decodeRasterArray(ye,re,Je){this.getRasterArrayWorkerSource().decodeRasterArray(re,Je)}reloadTile(ye,re,Je){re.projection=this.projections[ye]||this.defaultProjection,this.getWorkerSource(ye,re.type,re.source,re.scope).reloadTile(re,Je)}abortTile(ye,re,Je){this.getWorkerSource(ye,re.type,re.source,re.scope).abortTile(re,Je)}removeTile(ye,re,Je){this.getWorkerSource(ye,re.type,re.source,re.scope).removeTile(re,Je)}removeSource(ye,re,Je){if(!(this.workerSources[ye]&&this.workerSources[ye][re.scope]&&this.workerSources[ye][re.scope][re.type]&&this.workerSources[ye][re.scope][re.type][re.source]))return;const Rt=this.workerSources[ye][re.scope][re.type][re.source];delete this.workerSources[ye][re.scope][re.type][re.source],Rt.removeSource!==void 0?Rt.removeSource(re,Je):Je()}loadWorkerSource(ye,re,Je){try{this.self.importScripts(re.url),Je()}catch(Rt){Je(Rt.toString())}}syncRTLPluginState(ye,re,Je){try{n.e4.setState(re);const Rt=n.e4.getPluginURL();if(n.e4.isLoaded()&&!n.e4.isParsed()&&Rt!=null){this.self.importScripts(Rt);const dt=n.e4.isParsed();Je(dt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Rt}`),dt)}}catch(Rt){Je(Rt.toString())}}setDracoUrl(ye,re){this.dracoUrl=re}getAvailableImages(ye,re){this.availableImages[ye]||(this.availableImages[ye]={});let Je=this.availableImages[ye][re];return Je||(Je=[]),Je}getLayerIndex(ye,re){this.layerIndexes[ye]||(this.layerIndexes[ye]={});let Je=this.layerIndexes[ye][re];return Je||(Je=this.layerIndexes[ye][re]=new ve,Je.scope=re),Je}getWorkerSource(ye,re,Je,Rt){return this.workerSources[ye]||(this.workerSources[ye]={}),this.workerSources[ye][Rt]||(this.workerSources[ye][Rt]={}),this.workerSources[ye][Rt][re]||(this.workerSources[ye][Rt][re]={}),this.isSpriteLoaded[ye]||(this.isSpriteLoaded[ye]={}),this.workerSources[ye][Rt][re][Je]||(this.workerSources[ye][Rt][re][Je]=new this.workerSourceTypes[re]({send:(dt,Nt,oi,Zt,li,mi)=>{this.actor.send(dt,Nt,oi,ye,li,mi)},scheduler:this.actor.scheduler},this.getLayerIndex(ye,Rt),this.getAvailableImages(ye,Rt),this.isSpriteLoaded[ye][Rt],void 0,this.brightness)),this.workerSources[ye][Rt][re][Je]}getDEMWorkerSource(ye,re,Je){return this.demWorkerSources[ye]||(this.demWorkerSources[ye]={}),this.demWorkerSources[ye][Je]||(this.demWorkerSources[ye][Je]={}),this.demWorkerSources[ye][Je][re]||(this.demWorkerSources[ye][Je][re]=new Ze),this.demWorkerSources[ye][Je][re]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new st),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ye,re){n.e5(re)}getWorkerPerformanceMetrics(ye,re,Je){Je(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new po(self)),po}),N(["./shared"],function(n){var X="3.8.0";const $={create:"create",load:"load",fullLoad:"fullLoad"},ne={mark(f){performance.mark(f)},measure(f,i,s){performance.measure(f,i,s)}};function ve(f){const i=f.name.split("?")[0];return n.a(i)&&i.includes("mapbox-gl.js")?"javascript":n.a(i)&&i.includes("mapbox-gl.css")?"css":n.b(i)?"fontRange":n.c(i)?"sprite":n.i(i)?"style":n.d(i)?"tilejson":"other"}var ze,ke={},yt=function(){if(ze)return ke;function f(m){return!i(m)}function i(m){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,A,k=new Blob([""],{type:"text/javascript"}),U=URL.createObjectURL(k);try{A=new Worker(U),w=!0}catch{w=!1}return A&&A.terminate(),URL.revokeObjectURL(U),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var A=w.getContext("2d");if(!A)return!1;var k=A.getImageData(0,0,1,1);return k&&k.width===w.width}()?(s[x=m&&m.failIfMajorPerformanceCaveat]===void 0&&(s[x]=function(w){var A,k=function(U){var W=document.createElement("canvas"),j=Object.create(f.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=U,W.getContext("webgl2",j)}(w);if(!k)return!1;try{A=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!A||k.isContextLost())&&(k.shaderSource(A,"void main() {}"),k.compileShader(A),k.getShaderParameter(A,k.COMPILE_STATUS)===!0)}(x)),s[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}ze=1,ke.supported=f,ke.notSupportedReason=i;var s={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ke}();function it(f,i,s){const m=document.createElement(f);return i!=null&&(m.className=i),s&&s.appendChild(m),m}function xt(f,i,s){const m=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(i))m.setAttributeNS(null,x,String(i[x]));return s&&s.appendChild(m),m}const Ze=typeof document<"u"?document.documentElement&&document.documentElement.style:null,st=Ze&&Ze.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ti;function mt(){Ze&&st&&(ti=Ze[st],Ze[st]="none")}function pt(){Ze&&st&&(Ze[st]=ti)}function Tt(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Tt,!0)}function Fe(){window.addEventListener("click",Tt,!0),window.setTimeout(()=>{window.removeEventListener("click",Tt,!0)},0)}function et(f,i){const s=f.getBoundingClientRect();return gt(f,s,i)}function Xe(f,i){const s=f.getBoundingClientRect(),m=[];for(let x=0;x<i.length;x++)m.push(gt(f,s,i[x]));return m}function qe(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function gt(f,i,s){const m=f.offsetWidth===i.width?1:f.offsetWidth/i.width;return new n.P((s.clientX-i.left)*m,(s.clientY-i.top)*m)}const lt="01",vt="NO_ACCESS_TOKEN";class Jt{constructor(i,s,m){this._transformRequestFn=i,this._customAccessToken=s,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const i=function(){let s="";for(let m=0;m<10;m++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",lt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,s){return this._transformRequestFn&&this._transformRequestFn(i,s)||{url:i}}normalizeStyleURL(i,s){if(!n.f(i))return i;const m=we(i);return m.params.push(`sdk=js-${X}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeGlyphsURL(i,s){if(!n.f(i))return i;const m=we(i);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeModelURL(i,s){if(!n.f(i))return i;const m=we(i);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||s)}normalizeSourceURL(i,s,m,x){if(!n.f(i))return i;const w=we(i);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),m&&w.params.push(`language=${m}`),x&&w.params.push(`worldview=${x}`),this._makeAPIURL(w,this._customAccessToken||s)}normalizeSpriteURL(i,s,m,x){const w=we(i);return n.f(i)?(w.path=`/styles/v1${w.path}/sprite${s}${m}`,this._makeAPIURL(w,this._customAccessToken||x)):(w.path+=`${s}${m}`,xe(w))}normalizeTileURL(i,s,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!n.f(i))return i;const x=we(i);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||m&&x.authority!=="raster"&&m===512?"@2x":""}${n.m.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${n.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${n.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${n.e.TILE_URL_VERSION}${x.path}`);const w=this._customAccessToken||function(A){for(const k of A){const U=k.match(/^access_token=(.*)$/);if(U)return U[1]}return null}(x.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,w)}canonicalizeTileURL(i,s){const m=we(i);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return i;let x="mapbox://";m.path.match(/^\/raster\/v1\//)?x+=`raster/${m.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${m.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${m.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let w=m.params;return s&&(w=w.filter(A=>!A.match(/^access_token=/))),w.length&&(x+=`?${w.join("&")}`),x}canonicalizeTileset(i,s){const m=!!s&&n.f(s),x=[];for(const w of i.tiles||[])n.h(w)?x.push(this.canonicalizeTileURL(w,m)):x.push(w);return x}_makeAPIURL(i,s){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=we(n.e.API_URL);if(i.protocol=x.protocol,i.authority=x.authority,i.protocol==="http"){const w=i.params.indexOf("secure");w>=0&&i.params.splice(w,1)}if(x.path!=="/"&&(i.path=`${x.path}${i.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return xe(i);if(s=s||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return i.params=i.params.filter(w=>w.indexOf("access_token")===-1),i.params.push(`access_token=${s||""}`),xe(i)}}const le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function we(f){const i=f.match(le);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function xe(f){const i=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${i}`}const De="mapbox.eventData";function Ce(f){if(!f)return null;const i=f.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(n.j(i[1]))}catch{return null}}class Gt{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const s=Ce(n.e.ACCESS_TOKEN);let m="";return m=s&&s.u?n.k(s.u):n.e.ACCESS_TOKEN||"",i?`${De}.${i}:${m}`:`${De}:${m}`}fetchEventData(){const i=n.s("localStorage"),s=this.getStorageKey(),m=this.getStorageKey("uuid");if(i)try{const x=localStorage.getItem(s);x&&(this.eventData=JSON.parse(x));const w=localStorage.getItem(m);w&&(this.anonId=w)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const i=n.s("localStorage"),s=this.getStorageKey(),m=this.getStorageKey("uuid"),x=this.anonId;if(i&&x)try{localStorage.setItem(m,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,s,m,x){if(!n.e.EVENTS_URL)return;const w=we(n.e.EVENTS_URL);w.params.push(`access_token=${x||n.e.ACCESS_TOKEN||""}`);const A={event:this.type,created:new Date(i).toISOString()},k=s?n.l(A,s):A,U={url:xe(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=n.p(U,W=>{this.pendingRequest=null,m(W),this.saveEventData(),this.processRequests(x)})}queueRequest(i,s){this.queue.push(i),this.processRequests(s)}}const Ft=new class extends Gt{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,i){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(s=>n.f(s)||n.h(s))&&this.queueRequest(Date.now(),i)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ce(n.e.ACCESS_TOKEN),s=i?i.u:n.e.ACCESS_TOKEN;let m=s!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),m=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),A=new Date(x),k=(x-this.eventData.lastSuccess)/864e5;m=m||k>=1||k<-1||w.getDate()!==A.getDate()}else m=!0;m?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:X,skuId:lt,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=x,this.eventData.tokenU=s)},f):this.processRequests()}},bt=Ft.postTurnstileEvent.bind(Ft),Vt=new class extends Gt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,i,s,m){this.skuToken=i,this.errorCb=m,n.e.EVENTS_URL&&(s||n.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(vt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:X,skuId:lt,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):i&&(this.success[i]=!0)},f))}remove(){this.errorCb=null}},Ht=Vt.postMapLoadEvent.bind(Vt),ni=new class extends Gt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let i=this.mapInstanceIdMap.get(f);return i||(i=n.u(),this.mapInstanceIdMap.set(f,i)),i}getEventId(f){const i=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,i+1),i}postStyleLoadEvent(f,i){const{map:s,style:m,importedStyles:x}=i;if(!n.e.EVENTS_URL||!f&&!n.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(s),A={mapInstanceId:w,eventId:this.getEventId(w),style:m};x.length&&(A.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:A},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:s}=this.queue.shift();this.postEvent(i,s,()=>{},f)}},zi=ni.postStyleLoadEvent.bind(ni),Hi=new class extends Gt{constructor(){super("gljs.performance")}postPerformanceEvent(f,i){n.e.EVENTS_URL&&(f||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:s}=this.queue.shift(),m=function(x){const w=performance.getEntriesByType("resource"),A=performance.getEntriesByType("mark"),k=function(oe){const pe={};if(oe){for(const ue in oe)if(ue!=="other")for(const _e of oe[ue]){const ge=`${ue}ResolveRangeMin`,Oe=`${ue}ResolveRangeMax`,Ge=`${ue}RequestCount`,He=`${ue}RequestCachedCount`;pe[ge]=Math.min(pe[ge]||1/0,_e.startTime),pe[Oe]=Math.max(pe[Oe]||-1/0,_e.responseEnd);const Qe=nt=>{pe[nt]===void 0&&(pe[nt]=0),++pe[nt]};_e.transferSize!==void 0&&_e.transferSize===0&&Qe(He),Qe(Ge)}}return pe}(function(oe,pe){const ue={};if(oe)for(const _e of oe){const ge=pe(_e);ue[ge]===void 0&&(ue[ge]=[]),ue[ge].push(_e)}return ue}(w,ve)),U=window.devicePixelRatio,W=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=W?W.effectiveType:void 0,Y={counters:[],metadata:[],attributes:[]},J=(oe,pe,ue)=>{ue!=null&&oe.push({name:pe,value:ue.toString()})};for(const oe in k)J(Y.counters,oe,k[oe]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(J(Y.counters,"interactionRangeMin",x.interactionRange[0]),J(Y.counters,"interactionRangeMax",x.interactionRange[1])),A)for(const oe of Object.keys($)){const pe=$[oe],ue=A.find(_e=>_e.name===pe);ue&&J(Y.counters,pe,ue.startTime)}return J(Y.counters,"visibilityHidden",x.visibilityHidden),J(Y.attributes,"style",function(oe){if(oe)for(const pe of oe){const ue=pe.name.split("?")[0];if(n.i(ue)){const _e=ue.split("/").slice(-2);if(_e.length===2)return`mapbox://styles/${_e[0]}/${_e[1]}`}}}(w)),J(Y.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),J(Y.attributes,"fogEnabled",x.fogEnabled?"true":"false"),J(Y.attributes,"projection",x.projection),J(Y.attributes,"zoom",x.zoom),J(Y.metadata,"devicePixelRatio",U),J(Y.metadata,"connectionEffectiveType",j),J(Y.metadata,"navigatorUserAgent",navigator.userAgent),J(Y.metadata,"screenWidth",window.screen.width),J(Y.metadata,"screenHeight",window.screen.height),J(Y.metadata,"windowWidth",window.innerWidth),J(Y.metadata,"windowHeight",window.innerHeight),J(Y.metadata,"mapWidth",x.width/U),J(Y.metadata,"mapHeight",x.height/U),J(Y.metadata,"webglRenderer",x.renderer),J(Y.metadata,"webglVendor",x.vendor),J(Y.metadata,"sdkVersion",X),J(Y.metadata,"sdkIdentifier","mapbox-gl-js"),Y}(s);for(const x of m.metadata);for(const x of m.counters);for(const x of m.attributes);this.postEvent(i,m,()=>{},f)}},on=Hi.postPerformanceEvent.bind(Hi),mn=new class extends Gt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,i,s,m){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const x=we(n.e.API_URL+n.e.SESSION_PATH);x.params.push(`sku=${i||""}`),x.params.push(`access_token=${m||n.e.ACCESS_TOKEN||""}`);const w={url:xe(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(w,A=>{this.pendingRequest=null,s(A),this.saveEventData(),this.processRequests(m)})}getSessionAPI(f,i,s,m){this.skuToken=i,this.errorCb=m,n.e.SESSION_PATH&&n.e.API_URL&&(s||n.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(vt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||this.getSession(s,this.skuToken,m=>{m?this.errorCb(m):i&&(this.success[i]=!0)},f)}remove(){this.errorCb=null}},ot=mn.getSessionAPI.bind(mn),Yn=new Set;function pr(f,i){i?Yn.add(f):Yn.delete(f)}class At{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,s){this._updatedSourceCaches[i]=s,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const s=i.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(i.id),this.setDirty()}removeLayer(i){const s=i.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][i.id]=i,this._updatedLayers[s].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const s in this._updatedLayers)i[s]=i[s]||{},i[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)i[s]=i[s]||{},i[s].removedIds=Object.keys(this._removedLayers[s]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ye(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}class kt extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new n.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,s){if(this.loaded[s]!==i&&(this.loaded[s]=i,i)){for(const{ids:m,callback:x}of this.requestors)this._notify(m,s,x);this.requestors=[]}}hasImage(i,s){return!!this.getImage(i,s)}getImage(i,s){return this.images[s][i]}addImage(i,s,m){this._validate(i,m)&&(this.images[s][i]=m)}_validate(i,s){let m=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new n.t(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new n.t(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(s.content,s)||(this.fire(new n.t(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,s){if(!i)return!0;let m=0;for(const x of i){if(x[0]<m||x[1]<x[0]||s<x[1])return!1;m=x[1]}return!0}_validateContent(i,s){return!(i&&(i.length!==4||i[0]<0||s.data.width<i[0]||i[1]<0||s.data.height<i[1]||i[2]<0||s.data.width<i[2]||i[3]<0||s.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,s,m){m.version=this.images[s][i].version+1,this.images[s][i]=m,this.updatedImages[s][i]=!0}removeImage(i,s){const m=this.images[s][i];delete this.images[s][i],delete this.patterns[s][i],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,s,m){let x=!0;const w=!!this.loaded[s];if(!w)for(const A of i)this.images[s][A]||(x=!1);w||x?this._notify(i,s,m):this.requestors.push({ids:i,scope:s,callback:m})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,s,m){const x={};for(const w of i){this.images[s][w]||this.fire(new n.x("styleimagemissing",{id:w}));const A=this.images[s][w];A?x[w]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:n.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,x)}getPixelSize(i){const{width:s,height:m}=this.atlasImage[i];return{width:s,height:m}}getPattern(i,s,m){const x=this.patterns[s][i],w=this.getImage(i,s);if(!w)return null;if(x&&x.position.version===w.version)return x.position;if(x)x.position.version=w.version;else{const A={w:w.data.width+2*n.y,h:w.data.height+2*n.y,x:0,y:0},k=new n.I(A,w,n.y);this.patterns[s][i]={bin:A,position:k}}return this._updatePatternAtlas(s,m),this.patterns[s][i].position}bind(i,s){const m=i.gl;let x=this.atlasTexture[s];x?this.dirty&&(x.update(this.atlasImage[s]),this.dirty=!1):(x=new n.T(i,this.atlasImage[s],m.RGBA8),this.atlasTexture[s]=x),x.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(i,s){const m=[];for(const k in this.patterns[i])m.push(this.patterns[i][k].bin);const{w:x,h:w}=n.z(m),A=this.atlasImage[i];A.resize({width:x||1,height:w||1});for(const k in this.patterns[i]){const{bin:U,position:W}=this.patterns[i][k];let j=W.padding;const Y=U.x+j,J=U.y+j,oe=this.images[i][k].data,pe=oe.width,ue=oe.height;j=j>1?j-1:j,n.r.copy(oe,A,{x:0,y:0},{x:Y,y:J},{width:pe,height:ue},s),n.r.copy(oe,A,{x:0,y:ue-j},{x:Y,y:J-j},{width:pe,height:j},s),n.r.copy(oe,A,{x:0,y:0},{x:Y,y:J+ue},{width:pe,height:j},s),n.r.copy(oe,A,{x:pe-j,y:0},{x:Y-j,y:J},{width:j,height:ue},s),n.r.copy(oe,A,{x:0,y:0},{x:Y+pe,y:J},{width:j,height:ue},s),n.r.copy(oe,A,{x:pe-j,y:ue-j},{x:Y-j,y:J-j},{width:j,height:j},s),n.r.copy(oe,A,{x:0,y:ue-j},{x:Y+pe,y:J-j},{width:j,height:j},s),n.r.copy(oe,A,{x:0,y:0},{x:Y+pe,y:J+ue},{width:j,height:j},s),n.r.copy(oe,A,{x:pe-j,y:0},{x:Y-j,y:J+ue},{width:j,height:j},s)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,s){for(const m of i){if(this.callbackDispatchedThisFrame[s][m])continue;this.callbackDispatchedThisFrame[s][m]=!0;const x=this.images[s][m];Ye(x)&&this.updateImage(m,s,x)}}}function Le(f){const i=f.key,s=f.value,m=f.valueSpec||{},x=f.objectElementValidators||{},w=f.style,A=f.styleSpec;let k=[];const U=n.B(s);if(U!=="object")return[new n.V(i,s,`object expected, ${U} found`)];for(const W in s){const j=W.split(".")[0];let Y;x[j]?Y=x[j]:m[j]?Y=Wn:x["*"]?Y=x["*"]:m["*"]&&(Y=Wn),Y?k=k.concat(Y({key:(i&&`${i}.`)+W,value:s[W],valueSpec:m[j]||m["*"],style:w,styleSpec:A,object:s,objectKey:W},s)):k.push(new n.A(i,s[W],`unknown property "${W}"`))}for(const W in m)x[W]||m[W].required&&m[W].default===void 0&&s[W]===void 0&&k.push(new n.V(i,s,`missing required property "${W}"`));return k}function Ie(f){const i=f.value,s=f.valueSpec,m=f.style,x=f.styleSpec,w=f.key,A=f.arrayElementValidator||Wn;if(n.B(i)!=="array")return[new n.V(w,i,`array expected, ${n.B(i)} found`)];if(s.length&&i.length!==s.length)return[new n.V(w,i,`array length ${s.length} expected, length ${i.length} found`)];if(s["min-length"]&&i.length<s["min-length"])return[new n.V(w,i,`array length at least ${s["min-length"]} expected, length ${i.length} found`)];let k={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};x.$version<7&&(k.function=s.function),n.B(s.value)==="object"&&(k=s.value);let U=[];for(let W=0;W<i.length;W++)U=U.concat(A({array:i,arrayIndex:W,value:i[W],valueSpec:k,style:m,styleSpec:x,key:`${w}[${W}]`},!0));return U}function Ue(f){const i=f.key,s=f.value,m=f.valueSpec;let x=n.B(s);if(x==="number"&&s!=s&&(x="NaN"),x!=="number")return[new n.V(i,s,`number expected, ${x} found`)];if("minimum"in m){let w=m.minimum;if(n.B(m.minimum)==="array"&&(w=m.minimum[f.arrayIndex]),s<w)return[new n.V(i,s,`${s} is less than the minimum value ${w}`)]}if("maximum"in m){let w=m.maximum;if(n.B(m.maximum)==="array"&&(w=m.maximum[f.arrayIndex]),s>w)return[new n.V(i,s,`${s} is greater than the maximum value ${w}`)]}return[]}function We(f){const i=f.valueSpec,s=n.D(f.value.type);let m,x,w,A={};const k=s!=="categorical"&&f.value.property===void 0,U=!k,W=n.B(f.value.stops)==="array"&&n.B(f.value.stops[0])==="array"&&n.B(f.value.stops[0][0])==="object",j=Le({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(oe){if(s==="identity")return[new n.V(oe.key,oe.value,'identity function may not have a "stops" property')];let pe=[];const ue=oe.value;return pe=pe.concat(Ie({key:oe.key,value:ue,valueSpec:oe.valueSpec,style:oe.style,styleSpec:oe.styleSpec,arrayElementValidator:Y})),n.B(ue)==="array"&&ue.length===0&&pe.push(new n.V(oe.key,ue,"array must have at least one stop")),pe},default:function(oe){return Wn({key:oe.key,value:oe.value,valueSpec:i,style:oe.style,styleSpec:oe.styleSpec})}}});return s==="identity"&&k&&j.push(new n.V(f.key,f.value,'missing required property "property"')),s==="identity"||f.value.stops||j.push(new n.V(f.key,f.value,'missing required property "stops"')),s==="exponential"&&f.valueSpec.expression&&!n.F(f.valueSpec)&&j.push(new n.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(U&&!n.G(f.valueSpec)?j.push(new n.V(f.key,f.value,"property functions not supported")):k&&!n.H(f.valueSpec)&&j.push(new n.V(f.key,f.value,"zoom functions not supported"))),s!=="categorical"&&!W||f.value.property!==void 0||j.push(new n.V(f.key,f.value,'"property" property is required')),j;function Y(oe){let pe=[];const ue=oe.value,_e=oe.key;if(n.B(ue)!=="array")return[new n.V(_e,ue,`array expected, ${n.B(ue)} found`)];if(ue.length!==2)return[new n.V(_e,ue,`array length 2 expected, length ${ue.length} found`)];if(W){if(n.B(ue[0])!=="object")return[new n.V(_e,ue,`object expected, ${n.B(ue[0])} found`)];if(ue[0].zoom===void 0)return[new n.V(_e,ue,"object stop key must have zoom")];if(ue[0].value===void 0)return[new n.V(_e,ue,"object stop key must have value")];const ge=n.D(ue[0].zoom);if(typeof ge!="number")return[new n.V(_e,ue[0].zoom,"stop zoom values must be numbers")];if(w&&w>ge)return[new n.V(_e,ue[0].zoom,"stop zoom values must appear in ascending order")];ge!==w&&(w=ge,x=void 0,A={}),pe=pe.concat(Le({key:`${_e}[0]`,value:ue[0],valueSpec:{zoom:{}},style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{zoom:Ue,value:J}}))}else pe=pe.concat(J({key:`${_e}[0]`,value:ue[0],valueSpec:{},style:oe.style,styleSpec:oe.styleSpec},ue));return n.J(n.K(ue[1]))?pe.concat([new n.V(`${_e}[1]`,ue[1],"expressions are not allowed in function stops.")]):pe.concat(Wn({key:`${_e}[1]`,value:ue[1],valueSpec:i,style:oe.style,styleSpec:oe.styleSpec}))}function J(oe,pe){const ue=n.B(oe.value),_e=n.D(oe.value),ge=oe.value!==null?oe.value:pe;if(m){if(ue!==m)return[new n.V(oe.key,ge,`${ue} stop domain type must match previous stop domain type ${m}`)]}else m=ue;if(ue!=="number"&&ue!=="string"&&ue!=="boolean"&&typeof _e!="number"&&typeof _e!="string"&&typeof _e!="boolean")return[new n.V(oe.key,ge,"stop domain value must be a number, string, or boolean")];if(ue!=="number"&&s!=="categorical"){let Oe=`number expected, ${ue} found`;return n.G(i)&&s===void 0&&(Oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(oe.key,ge,Oe)]}return s!=="categorical"||ue!=="number"||typeof _e=="number"&&isFinite(_e)&&Math.floor(_e)===_e?s!=="categorical"&&ue==="number"&&typeof _e=="number"&&typeof x=="number"&&x!==void 0&&_e<x?[new n.V(oe.key,ge,"stop domain values must appear in ascending order")]:(x=_e,s==="categorical"&&_e in A?[new n.V(oe.key,ge,"stop domain values must be unique")]:(A[_e]=!0,[])):[new n.V(oe.key,ge,`integer expected, found ${String(_e)}`)]}}function rt(f){const i=(f.expressionContext==="property"?n.L:n.M)(n.K(f.value),f.valueSpec);if(i.result==="error")return i.value.map(m=>new n.V(`${f.key}${m.key}`,f.value,m.message));const s=i.value.expression||i.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!s.outputDefined())return[new n.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!n.N(s))return[new n.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return ut(s,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!n.O(s,["zoom","feature-state"]))return[new n.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!n.Q(s))return[new n.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ut(f,i){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const x of i.valueSpec.expression.parameters)s.delete(x);if(s.size===0)return[];const m=[];return f instanceof n.S&&s.has(f.name)?[new n.V(i.key,i.value,`["${f.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(f.eachChild(x=>{m.push(...ut(x,i))}),m)}function ht(f){const i=f.key,s=f.value,m=f.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(n.D(s))===-1&&x.push(new n.V(i,s,`expected one of [${m.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(m.values).indexOf(n.D(s))===-1&&x.push(new n.V(i,s,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(s)} found`)),x}function Lt(f){return n.W(n.K(f.value))?rt(n.C({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):It(f)}function It(f){const i=f.value,s=f.key;if(n.B(i)!=="array")return[new n.V(s,i,`array expected, ${n.B(i)} found`)];const m=f.styleSpec;let x,w=[];if(i.length<1)return[new n.V(s,i,"filter array must have at least 1 element")];switch(w=w.concat(ht({key:`${s}[0]`,value:i[0],valueSpec:m.filter_operator,style:f.style,styleSpec:f.styleSpec})),n.D(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&n.D(i[1])==="$type"&&w.push(new n.V(s,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new n.V(s,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(x=n.B(i[1]),x!=="string"&&w.push(new n.V(`${s}[1]`,i[1],`string expected, ${x} found`)));for(let A=2;A<i.length;A++)x=n.B(i[A]),n.D(i[1])==="$type"?w=w.concat(ht({key:`${s}[${A}]`,value:i[A],valueSpec:m.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&w.push(new n.V(`${s}[${A}]`,i[A],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let A=1;A<i.length;A++)w=w.concat(It({key:`${s}[${A}]`,value:i[A],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=n.B(i[1]),i.length!==2?w.push(new n.V(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):x!=="string"&&w.push(new n.V(`${s}[1]`,i[1],`string expected, ${x} found`))}return w}function ui(f,i){const s=f.key,m=f.style,x=f.layer,w=f.styleSpec,A=f.value,k=f.objectKey,U=w[`${i}_${f.layerType}`];if(!U)return[];const W=k.match(/^(.*)-transition$/);if(i==="paint"&&W&&U[W[1]]&&U[W[1]].transition)return Wn({key:s,value:A,valueSpec:w.transition,style:m,styleSpec:w});const j=f.valueSpec||U[k];if(!j)return[new n.A(s,A,`unknown property "${k}"`)];let Y;if(n.B(A)==="string"&&n.G(j)&&!j.tokens&&(Y=/^{([^}]+)}$/.exec(A))){const oe=`\`{ "type": "identity", "property": ${Y?JSON.stringify(Y[1]):'"_"'} }\``;return[new n.V(s,A,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${oe}.`)]}const J=[];if(f.layerType==="symbol")k!=="text-field"||!m||m.glyphs||m.imports||J.push(new n.V(s,A,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&n.X(n.K(A))&&n.D(A.type)==="identity"&&J.push(new n.V(s,A,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&i==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&n.G(j)&&(n.Y(j)||n.H(j))){const oe=n.L(n.K(A),j),pe=oe.value.expression||oe.value._styleExpression.expression;pe&&!n.O(pe,["measure-light"])&&(k==="model-emissive-strength"&&n.Q(pe)&&n.N(pe)||J.push(new n.V(s,A,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return J.concat(Wn({key:f.key,value:A,valueSpec:j,style:m,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:k}))}function xi(f){return ui(f,"paint")}function an(f){return ui(f,"layout")}function cn(f){let i=[];const s=f.value,m=f.key,x=f.style,w=f.styleSpec;s.type||s.ref||i.push(new n.V(m,s,'either "type" or "ref" is required'));let A=n.D(s.type);const k=n.D(s.ref);if(s.id){const U=n.D(s.id);for(let W=0;W<f.arrayIndex;W++){const j=x.layers[W];n.D(j.id)===U&&i.push(new n.V(m,s.id,`duplicate layer id "${s.id}", previously used at line ${j.id.__line__}`))}}if("ref"in s){let U;["type","source","source-layer","filter","layout"].forEach(W=>{W in s&&i.push(new n.V(m,s[W],`"${W}" is prohibited for ref layers`))}),x.layers.forEach(W=>{n.D(W.id)===k&&(U=W)}),U?U.ref?i.push(new n.V(m,s.ref,"ref cannot reference another ref layer")):A=n.D(U.type):typeof k=="string"&&i.push(new n.V(m,s.ref,`ref layer "${k}" not found`))}else if(A!=="background"&&A!=="sky"&&A!=="slot")if(s.source){const U=x.sources&&x.sources[s.source],W=U&&n.D(U.type);U?W==="vector"&&A==="raster"?i.push(new n.V(m,s.source,`layer "${s.id}" requires a raster source`)):W==="raster"&&A!=="raster"?i.push(new n.V(m,s.source,`layer "${s.id}" requires a vector source`)):W!=="vector"||s["source-layer"]?W==="raster-dem"&&A!=="hillshade"?i.push(new n.V(m,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):W!=="raster-array"||["raster","raster-particle"].includes(A)?A!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||W==="geojson"&&U.lineMetrics?A==="raster-particle"&&W!=="raster-array"&&i.push(new n.V(m,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):i.push(new n.V(m,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new n.V(m,s.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new n.V(m,s,`layer "${s.id}" must specify a "source-layer"`)):i.push(new n.V(m,s.source,`source "${s.source}" not found`))}else i.push(new n.V(m,s,'missing required property "source"'));return i=i.concat(Le({key:m,value:s,valueSpec:w.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wn({key:`${m}.type`,value:s.type,valueSpec:w.layer.type,style:f.style,styleSpec:f.styleSpec,object:s,objectKey:"type"}),filter:U=>Lt(n.C({layerType:A},U)),layout:U=>Le({layer:s,key:U.key,value:U.value,valueSpec:{},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{"*":W=>an(n.C({layerType:A},W))}}),paint:U=>Le({layer:s,key:U.key,value:U.value,valueSpec:{},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{"*":W=>xi(n.C({layerType:A,layer:s},W))}})}})),i}function _n(f){const i=f.value,s=f.key,m=n.B(i);return m!=="string"?[new n.V(s,i,`string expected, ${m} found`)]:[]}const Fn={promoteId:function({key:f,value:i}){if(n.B(i)==="string")return _n({key:f,value:i});{const s=[];for(const m in i)s.push(..._n({key:`${f}.${m}`,value:i[m]}));return s}}};function Mn(f){const i=f.value,s=f.key,m=f.styleSpec,x=f.style;if(!i.type)return[new n.V(s,i,'"type" is required')];const w=n.D(i.type);let A=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(i.url||i.tiles||A.push(new n.A(s,i,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return A=A.concat(Le({key:s,value:i,valueSpec:m[`source_${w.replace("-","_")}`],style:f.style,styleSpec:m,objectElementValidators:Fn})),A;case"geojson":if(A=Le({key:s,value:i,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:Fn}),i.cluster)for(const k in i.clusterProperties){const[U,W]=i.clusterProperties[k],j=typeof U=="string"?[U,["accumulated"],["get",k]]:U;A.push(...rt({key:`${s}.${k}.map`,value:W,expressionContext:"cluster-map"})),A.push(...rt({key:`${s}.${k}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return A;case"video":return Le({key:s,value:i,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return Le({key:s,value:i,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new n.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ht({key:`${s}.type`,value:i.type,valueSpec:{values:jn(m)},style:x,styleSpec:m})}}function jn(f){return f.source.reduce((i,s)=>{const m=f[s];return m.type.type==="enum"&&(i=i.concat(Object.keys(m.type.values))),i},[])}function Lr(f){const i=f.value,s=f.styleSpec,m=s.light,x=f.style;let w=[];const A=n.B(i);if(i===void 0)return w;if(A!=="object")return w=w.concat([new n.V("light",i,`object expected, ${A} found`)]),w;for(const k in i){const U=k.match(/^(.*)-transition$/);w=w.concat(U&&m[U[1]]&&m[U[1]].transition?Wn({key:k,value:i[k],valueSpec:s.transition,style:x,styleSpec:s}):m[k]?Wn({key:k,value:i[k],valueSpec:m[k],style:x,styleSpec:s}):[new n.V(k,i[k],`unknown property "${k}"`)])}return w}function Tr(f){const i=f.value;let s=[];if(!i)return s;const m=n.B(i);if(m!=="object")return s=s.concat([new n.V("light-3d",i,`object expected, ${m} found`)]),s;const x=f.styleSpec,w=x["light-3d"],A=f.key,k=f.style,U=f.style.lights;for(const Y of["type","id"])if(!(Y in i))return s=s.concat([new n.V("light-3d",i,`missing property ${Y} on light`)]),s;if(i.type&&U)for(let Y=0;Y<f.arrayIndex;Y++){const J=n.D(i.type),oe=U[Y];n.D(oe.type)===J&&s.push(new n.V(A,i.id,`duplicate light type "${i.type}", previously defined at line ${oe.id.__line__}`))}const W=`properties_light_${i.type}`;if(!(W in x))return s=s.concat([new n.V("light-3d",i,`Invalid light type ${i.type}`)]),s;const j=x[W];for(const Y in i)if(Y==="properties"){const J=i[Y],oe=n.B(J);if(oe!=="object")return s=s.concat([new n.V("properties",J,`object expected, ${oe} found`)]),s;for(const pe in J)s=s.concat(j[pe]?Wn({key:pe,value:J[pe],valueSpec:j[pe],style:k,styleSpec:x}):[new n.A(f.key,J[pe],`unknown property "${pe}"`)])}else{const J=Y.match(/^(.*)-transition$/);s=s.concat(J&&w[J[1]]&&w[J[1]].transition?Wn({key:Y,value:i[Y],valueSpec:x.transition,style:k,styleSpec:x}):w[Y]?Wn({key:Y,value:i[Y],valueSpec:w[Y],style:k,styleSpec:x}):[new n.A(Y,i[Y],`unknown property "${Y}"`)])}return s}function to(f){const i=f.value,s=f.key,m=f.style,x=f.styleSpec,w=x.terrain;let A=[];const k=n.B(i);if(i===void 0||k==="null")return A;if(k!=="object")return A=A.concat([new n.V("terrain",i,`object expected, ${k} found`)]),A;for(const U in i){const W=U.match(/^(.*)-transition$/);A=A.concat(W&&w[W[1]]&&w[W[1]].transition?Wn({key:U,value:i[U],valueSpec:x.transition,style:m,styleSpec:x}):w[U]?Wn({key:U,value:i[U],valueSpec:w[U],style:m,styleSpec:x}):[new n.A(U,i[U],`unknown property "${U}"`)])}if(i.source){const U=m.sources&&m.sources[i.source],W=U&&n.D(U.type);U?W!=="raster-dem"&&A.push(new n.V(s,i.source,`terrain cannot be used with a source of type ${String(W)}, it only be used with a "raster-dem" source type`)):A.push(new n.V(s,i.source,`source "${i.source}" not found`))}else A.push(new n.V(s,i,'terrain is missing required property "source"'));return A}function $r(f){const i=f.value,s=f.style,m=f.styleSpec,x=m.fog;let w=[];const A=n.B(i);if(i===void 0)return w;if(A!=="object")return w=w.concat([new n.V("fog",i,`object expected, ${A} found`)]),w;for(const k in i){const U=k.match(/^(.*)-transition$/);w=w.concat(U&&x[U[1]]&&x[U[1]].transition?Wn({key:k,value:i[k],valueSpec:m.transition,style:s,styleSpec:m}):x[k]?Wn({key:k,value:i[k],valueSpec:x[k],style:s,styleSpec:m}):[new n.A(k,i[k],`unknown property "${k}"`)])}return w}const en={"*":()=>[],array:Ie,boolean:function(f){const i=f.value,s=f.key,m=n.B(i);return m!=="boolean"?[new n.V(s,i,`boolean expected, ${m} found`)]:[]},number:Ue,color:function(f){const i=f.key,s=f.value,m=n.B(s);return m!=="string"?[new n.V(i,s,`color expected, ${m} found`)]:n.U.parseCSSColor(s)===null?[new n.V(i,s,`color expected, "${s}" found`)]:[]},enum:ht,filter:Lt,function:We,layer:cn,object:Le,source:Mn,model:n.Z,light:Lr,"light-3d":Tr,terrain:to,fog:$r,string:_n,formatted:function(f){return _n(f).length===0?[]:rt(f)},resolvedImage:function(f){return _n(f).length===0?[]:rt(f)},projection:function(f){const i=f.value,s=f.styleSpec,m=s.projection,x=f.style;let w=[];const A=n.B(i);if(A==="object")for(const k in i)w=w.concat(Wn({key:k,value:i[k],valueSpec:m[k],style:x,styleSpec:s}));else A!=="string"&&(w=w.concat([new n.V("projection",i,`object or string expected, ${A} found`)]));return w},import:function(f){const{value:i,styleSpec:s}=f,{data:m,...x}=i;Object.defineProperty(x,"__line__",{value:i.__line__,enumerable:!1});let w=Le(n.C({},f,{value:x,valueSpec:s.import}));return n.D(x.id)===""&&w.push(new n.V(`${f.key}.id`,x,"import id can't be an empty string")),m&&(w=w.concat(To(m,s,{key:`${f.key}.data`}))),w}};function Wn(f,i=!1){const s=f.value,m=f.valueSpec,x=f.styleSpec;if(m.expression&&n.X(n.D(s)))return We(f);if(m.expression&&n.J(n.K(s)))return rt(f);if(m.type&&en[m.type]){const w=en[m.type](f);return i===!0&&w.length>0&&n.B(f.value)==="array"?rt(f):w}return Le(n.C({},f,{valueSpec:m.type?x[m.type]:m}))}function Ls(f){const i=f.value,s=f.key,m=_n(f);return m.length||(i.indexOf("{fontstack}")===-1&&m.push(new n.V(s,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&m.push(new n.V(s,i,'"glyphs" url must include a "{range}" token'))),m}function To(f,i=n._,s={}){return Wn({key:s.key||"",value:f,valueSpec:i.$root,styleSpec:i,style:f,objectElementValidators:{glyphs:Ls,"*":()=>[]}})}function Ro(f,i=n._){return dt(To(f,i))}const _s=f=>dt(Mn(f)),js=f=>dt(Lr(f)),Dr=f=>dt(Tr(f)),ro=f=>dt(to(f)),po=f=>dt($r(f)),ai=f=>dt(cn(f)),ye=f=>dt(Lt(f)),re=f=>dt(xi(f)),Je=f=>dt(an(f)),Rt=f=>dt(n.Z(f));function dt(f){return f.slice().sort((i,s)=>i.line&&s.line?i.line-s.line:0)}function Nt(f,i){let s=!1;if(i&&i.length)for(const m of i)m instanceof n.A?n.w(m.message):(f.fire(new n.t(new Error(m.message))),s=!0);return s}let oi;class Zt extends n.E{constructor(i,s="flat"){super(),this._transitionable=new n.$(oi||(oi=new n.a0({anchor:new n.a1(n._.light.anchor),position:new n.a2(n._.light.position),color:new n.a1(n._.light.color),intensity:new n.a1(n._.light.intensity)}))),this.setLight(i,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,s,m={}){this._validate(js,i,m)||(this._transitionable.setTransitionOrValue(i),this.id=s)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,s,m){return(!m||m.validate!==!1)&&Nt(this,i.call(Ro,n.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}let li=class extends n.E{constructor(f,i,s,m){super(),this.scope=s,this._transitionable=new n.$(new n.a0({source:new n.a1(n._.terrain.source),exaggeration:new n.a1(n._.terrain.exaggeration)}),s,m),this._transitionable.setTransitionOrValue(f,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(f,i){this._transitionable.setTransitionOrValue(f,i)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new n.a3(f)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const i=f.value.expression;if(!i)return null;let s=-1,m=-1,x=1;for(const w of i.zoomStops)x=i.evaluate(new n.a3(w)),x>.01?(s=w,m=-1):m=w;return x<.01&&s>0&&m>s?[s,m]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof n.a4}};const mi=45,fi=65,Pi=.05;function tn(f,i,s,m){const x=n.a7(mi,fi,s),[w,A]=xn(f,m);let k=1-Math.min(1,Math.exp((i-w)/(A-w)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*x*f.alpha}function xn(f,i){const s=.5/Math.tan(.5*i);return[f.range[0]+s,f.range[1]+s]}function Jn(f,i,s,m,x){const w=n.a6.vec3.transformMat4([],[i,s,m],x.mercatorFogMatrix);return tn(f,n.a6.vec3.length(w),x.pitch,x._fov)}function sr(f,i,s,m,x,w,A){const k=[[s,m,0],[x,m,0],[x,w,0],[s,w,0]];let U=Number.MAX_VALUE,W=-Number.MAX_VALUE;for(const j of k){const Y=n.a6.vec3.transformMat4([],j,i),J=n.a6.vec3.length(Y);U=Math.min(U,J),W=Math.max(W,J)}return[tn(f,U,A.pitch,A._fov),tn(f,W,A.pitch,A._fov)]}class ar extends n.E{constructor(i,s,m,x){super();const w=new n.a0({range:new n.a1(n._.fog.range),color:new n.a1(n._.fog.color),"high-color":new n.a1(n._.fog["high-color"]),"space-color":new n.a1(n._.fog["space-color"]),"horizon-blend":new n.a1(n._.fog["horizon-blend"]),"star-intensity":new n.a1(n._.fog["star-intensity"]),"vertical-range":new n.a1(n._.fog["vertical-range"])});this._transitionable=new n.$(w,m,new Map(x)),this.set(i,x),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new n.a8(w),this.scope=m}get state(){const i=this._transform,s=i.projection.name==="globe",m=n.a9(i.zoom),x=this.properties.get("range"),w=[.5,3];return{range:s?[n.aa(w[0],x[0],m),n.aa(w[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,s,m={}){if(this._validate(po,i,m))return;const x=n.l({},i);for(const w of Object.keys(n._.fog))x[w]===void 0&&(x[w]=n._.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.a7(mi,fi,i))*s.a}getOpacityAtLatLng(i,s){return this._transform.projection.supportsFog?function(m,x,w){const A=n.a5.fromLngLat(x),k=w.elevation?w.elevation.getAtPointOrZero(A):0;return Jn(m,A.x,A.y,k,w)}(this.state,i,s):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(i.toUnwrapped());return sr(this.state,s,0,0,n.ab,n.ab,this._transform)}getOpacityForBounds(i,s,m,x,w){return this._transform.projection.supportsFog?sr(this.state,i,s,m,x,w,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?xn(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const m of s){const x=i.points[m];let w;if(x[2]>=0)w=x;else{const A=i.points[m-4];w=n.ac(A,x,A[2]/(A[2]-x[2]))}if(Jn(this.state,w[0],w[1],0,this._transform)>=Pi)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,s,m){return(!m||m.validate!==!1)&&Nt(this,i.call(Ro,n.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}class er extends n.E{constructor(i,s,m,x){super(),this.scope=m,this._options=i,this.properties=new n.a8(s),this._transitionable=new n.$(s,m,new Map(x)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,s){this._options=i,this._transitionable.setTransitionOrValue(i.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Zr,Gr;class yr{constructor(i,s,m,x){this.screenBounds=i,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,s){let m,x;if(i instanceof n.P||typeof i[0]=="number"){const w=n.P.convert(i);m=[w],x=s.isPointAboveHorizon(w)}else{const w=n.P.convert(i[0]),A=n.P.convert(i[1]);m=[w,A],x=n.ae(w,A).every(k=>s.isPointAboveHorizon(k))}return new yr(m,s.getCameraPoint(),x,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return n.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const s=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],x=n.ae(s,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(x[3]=this.cameraPoint)),n.af(x,i)}bufferedCameraGeometryGlobe(i){const s=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],x=n.ae(s,m,i),w=this.cameraPoint.clone();switch(3*((w.y>s.y)+(w.y>m.y))+((w.x>s.x)+(w.x>m.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(i,s,m,x=0){const w=i.queryPadding/s._pixelsPerMercatorPixel+1,A=m?this._bufferedCameraMercator(w,s):this._bufferedScreenMercator(w,s);let k=i.tileID.wrap+(A.unwrapped?x:0);const U=A.polygon.map(_e=>n.ag(i.tileTransform,_e,k));if(!n.ah(U,0,0,n.ab,n.ab))return;k=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const W=this.screenGeometryMercator.polygon.map(_e=>n.ai(i.tileTransform,_e,k)),j=W.map(_e=>new n.P(_e[0],_e[1])),Y=s.getFreeCameraOptions().position||new n.a5(0,0,0),J=n.ai(i.tileTransform,Y,k),oe=W.map(_e=>{const ge=n.a6.vec3.sub(_e,_e,J);return n.a6.vec3.normalize(ge,ge),new n.aj(J,ge)}),pe=n.ak(i,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:oe,bufferedTilespaceGeometry:U,bufferedTilespaceBounds:(ue=n.al(U),ue.min.x=n.ap(ue.min.x,0,n.ab),ue.min.y=n.ap(ue.min.y,0,n.ab),ue.max.x=n.ap(ue.max.x,0,n.ab),ue.max.y=n.ap(ue.max.y,0,n.ab),ue),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:pe};var ue}_bufferedScreenMercator(i,s){const m=Ns(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),s):{polygon:this.bufferedScreenGeometry(i).map(w=>s.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(i,s){const m=Ns(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),s):{polygon:this.bufferedCameraGeometry(i).map(w=>s.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(i,s){const m=function(w,A){const k=n.a6.mat4.multiply([],A.pixelMatrix,A.globeMatrix),U=[0,-n.aq,0,1],W=[0,n.aq,0,1],j=[0,0,0,1];n.a6.vec4.transformMat4(U,U,k),n.a6.vec4.transformMat4(W,W,k),n.a6.vec4.transformMat4(j,j,k);const Y=new n.P(U[0]/U[3],U[1]/U[3]),J=new n.P(W[0]/W[3],W[1]/W[3]),oe=n.an(w,Y)&&U[3]<j[3],pe=n.an(w,J)&&W[3]<j[3];if(!oe&&!pe)return null;const ue=function(tt,at,wt){for(let Ot=1;Ot<tt.length;Ot++){const Ct=us(at.pointCoordinate3D(tt[Ot-1]).x),St=us(at.pointCoordinate3D(tt[Ot]).x);if(wt<0){if(Ct<St)return{idx:Ot,t:-Ct/(St-1-Ct)}}else if(St<Ct)return{idx:Ot,t:(1-Ct)/(St+1-Ct)}}return null}(w,A,oe?-1:1);if(!ue)return null;const{idx:_e,t:ge}=ue;let Oe=_e>1?Jr(w.slice(0,_e),A):[],Ge=_e<w.length?Jr(w.slice(_e),A):[];Oe=Oe.map(tt=>new n.P(us(tt.x),tt.y)),Ge=Ge.map(tt=>new n.P(us(tt.x),tt.y));const He=[...Oe];He.length===0&&He.push(Ge[Ge.length-1]);const Qe=n.aa(He[He.length-1].y,(Ge.length===0?Oe[0]:Ge[0]).y,ge);let nt;return nt=oe?[new n.P(0,Qe),new n.P(0,0),new n.P(1,0),new n.P(1,Qe)]:[new n.P(1,Qe),new n.P(1,1),new n.P(0,1),new n.P(0,Qe)],He.push(...nt),Ge.length===0?He.push(Oe[0]):He.push(...Ge),{polygon:He.map(tt=>new n.a5(tt.x,tt.y)),unwrapped:!1}}(i,s);if(m)return m;const x=function(w,A){let k=!1,U=-1/0,W=0;for(let Y=0;Y<w.length-1;Y++)w[Y].x>U&&(U=w[Y].x,W=Y);for(let Y=0;Y<w.length-1;Y++){const J=(W+Y)%(w.length-1),oe=w[J],pe=w[J+1];Math.abs(oe.x-pe.x)>.5&&(oe.x<pe.x?(oe.x+=1,J===0&&(w[w.length-1].x+=1)):(pe.x+=1,J+1===w.length-1&&(w[0].x+=1)),k=!0)}const j=n.am(A.center.lng);return k&&j<Math.abs(j-1)&&w.forEach(Y=>{Y.x-=1}),{polygon:w,unwrapped:k}}(Jr(i,s).map(w=>new n.P(us(w.x),w.y)),s);return{polygon:x.polygon.map(w=>new n.a5(w.x,w.y)),unwrapped:x.unwrapped}}}function Jr(f,i){return n.ao(f,s=>{const m=i.pointCoordinate3D(s);s.x=m.x,s.y=m.y},1/256)}function us(f){return f<0?1+f%1:f%1}function Ns(f){return 100*f|0}function es(f,i,s,m,x){const w=function(k,U){if(k)return x(k);if(U){if(f.url&&U.tiles&&f.tiles&&delete f.tiles,U.variants){if(!Array.isArray(U.variants))return x(new Error("variants must be an array"));for(const j of U.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return x(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){U=n.l(U,j);break}}}const W=n.ar(n.l({},U,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);W.tiles=i.canonicalizeTileset(W,f.url),x(null,W)}},A=function(k,U,W){if(!k)return null;if(!U&&!W)return k;W=W||k.worldview_default;const j=Object.values(k.language||{});if(j.length===0)return null;const Y=Object.values(k.worldview||{});if(Y.length===0)return null;const J=j.every(pe=>pe===U),oe=Y.every(pe=>pe===W);return J&&oe?k:U in(k.language_options||{})||W in(k.worldview_options||{})?null:k.language_options&&k.worldview_options?k:null}(f.data,s,m);return A?n.q.frame(()=>w(null,A)):f.url?n.n(i.transformRequest(i.normalizeSourceURL(f.url,null,s,m),n.R.Source),w):n.q.frame(()=>{const{data:k,...U}=f;w(null,U)})}class Fs{constructor(i,s,m){this.bounds=n.as.convert(this.validateBounds(i)),this.minzoom=s||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const s=Math.pow(2,i.z),m=Math.floor(n.am(this.bounds.getWest())*s),x=Math.floor(n.at(this.bounds.getNorth())*s),w=Math.ceil(n.am(this.bounds.getEast())*s),A=Math.ceil(n.at(this.bounds.getSouth())*s);return i.x>=m&&i.x<w&&i.y>=x&&i.y<A}}class Ps extends n.E{constructor(i,s,m,x){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ar(s,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new n.au}load(i){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=es(this._options,this.map._requestManager,s,m,(x,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new n.t(x));else if(w){if(n.l(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const A of w.vector_layers)this.vectorLayerIds.push(A.id),w.worldview&&w.worldview[A.source]&&this.localizableLayerIds.add(A.id)}w.bounds&&(this.tileBounds=new Fs(w.bounds,this.minzoom,this.maxzoom)),bt(w.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}i&&i(x)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(i,s){const m=i.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(m),w=this.map._requestManager.transformRequest(x,n.R.Tile),A=this.map.style?this.map.style.getLut(this.scope):null,k=A?{image:A.image.clone()}:null,U={request:w,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:k,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(m)&&(U.worldview=this.map.getWorldview()||this.worldviewDefault,U.localizableLayerIds=this.localizableLayerIds),U.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=s:i.request=i.actor.send("reloadTile",U,W.bind(this));else if(i.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",U,W.bind(this),void 0,!0);else{const j=n.aw.call({deduped:this._deduped},U,(Y,J)=>{Y||!J?W.call(this,Y):(U.data={cacheControl:J.cacheControl,expires:J.expires,rawData:J.rawData.slice(0)},i.actor&&i.actor.send("loadTile",U,W.bind(this),void 0,!0))},!0);i.request={cancel:j}}function W(j,Y){return delete i.request,i.aborted?s(null):j&&j.status!==404?s(j):(Y&&Y.resourceTiming&&(i.resourceTiming=Y.resourceTiming),this.map._refreshExpiredTiles&&Y&&i.setExpiryData(Y),i.loadVectorData(Y,this.map.painter),n.ax(this.dispatcher),s(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,s){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Mo extends n.E{constructor(i,s,m,x){super(),this.id=i,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},s),n.l(this,n.ar(s,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._tileJSONRequest=es(this._options,this.map._requestManager,null,null,(s,m)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new n.t(s)):m&&(n.l(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),m.bounds&&(this.tileBounds=new Fs(m.bounds,this.minzoom,this.maxzoom)),bt(m.tiles),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),i&&i(s)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,s){const m=n.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=n.o(this.map._requestManager.transformRequest(x,n.R.Tile),(w,A,k,U)=>(delete i.request,i.aborted?(i.state="unloaded",s(null)):w?(i.state="errored",s(w)):A?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:k,expires:U}),i.setTexture(A,this.map.painter),i.state="loaded",n.ax(this.dispatcher),void s(null)):s(null)))}abortTile(i,s){i.request&&(i.request.cancel(),delete i.request),s&&s()}unloadTile(i,s){i.texture&&i.texture instanceof n.T?(i.destroy(!0),i.texture&&i.texture instanceof n.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Qo extends Mo{constructor(i,s,m,x){super(i,s,m,x),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},s)}triggerRepaint(i){const s=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);s&&s.enabled&&m&&s._clearRenderCacheForTile(m.id,i.tileID),this.map.triggerRepaint()}loadTile(i,s){const m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(m,n.R.Tile);i.requestParams=x,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(w,A,k,U)=>{if(delete i.request,i.aborted)return i.state="unloaded",s(null);if(w)return w.code===20?void 0:(i.state="errored",s(w));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:k,expires:U}),i.state="empty",s(null)})}unloadTile(i,s){const m=i.texture;m&&m instanceof n.T?(i.destroy(!0),this.map.painter.saveTileTexture(m)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,s,m){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(s,m,(x,w)=>{if(x)return i.state="errored",this.fire(new n.t(x)),void this.triggerRepaint(i);w&&(i.setTexture(w,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:w})=>w===i),m=s&&s.fields,x=m&&m.bands&&m.bands;return x?x[0]:0}getTextureDescriptor(i,s,m){if(!i)return;const x=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;s instanceof n.aB?w=s.paint.get("raster-array-band"):s instanceof n.aC&&(w=s.paint.get("raster-particle-array-band"));const A=w||this.getInitialBand(x);if(A!=null)if(i.textureDescriptor){if(!i.updateNeeded(x,A)||m)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,x,A)}}const Ua={vector:Ps,raster:Mo,"raster-dem":class extends Mo{constructor(f,i,s,m){super(f,i,s,m),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(f,i){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,w){x&&(f.state="errored",i(x)),w&&(f.dem=w,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",i(null))}f.request=n.o(this.map._requestManager.transformRequest(s,n.R.Tile),(function(x,w,A,k){if(delete f.request,f.aborted)f.state="unloaded",i(null);else if(x)f.state="errored",i(x);else if(w){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:A,expires:k});const U=ImageBitmap&&w instanceof ImageBitmap&&n.ay(),W=1-(w.width-n.az(w.width))/2;W<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const j=U?w:n.q.getImageData(w,W),Y={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:W};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",Y,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const i=f.canonical,s=Math.pow(2,i.z),m=(i.x-1+s)%s,x=i.x===0?f.wrap-1:f.wrap,w=(i.x+1+s)%s,A=i.x+1===s?f.wrap+1:f.wrap,k={};return k[new n.aA(f.overscaledZ,x,i.z,m,i.y).key]={backfilled:!1},k[new n.aA(f.overscaledZ,A,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(k[new n.aA(f.overscaledZ,x,i.z,m,i.y-1).key]={backfilled:!1},k[new n.aA(f.overscaledZ,f.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},k[new n.aA(f.overscaledZ,A,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<s&&(k[new n.aA(f.overscaledZ,x,i.z,m,i.y+1).key]={backfilled:!1},k[new n.aA(f.overscaledZ,f.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},k[new n.aA(f.overscaledZ,A,i.z,w,i.y+1).key]={backfilled:!1}),k}},"raster-array":Qo,geojson:class extends n.E{constructor(f,i,s,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(m),this._data=i.data,this._options=n.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=n.ab/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:n.ab,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:n.ab,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new n.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new n.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const s of this._data.features)i.set(s.id,s);for(const s of f.features)i.set(s.id,s);this._data.features=[...i.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterChildren(f,i){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterLeaves(f,i,s,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:i,offset:s},m),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.x("dataloading",{dataType:"source"})),this._loaded=!1;const i=n.l({append:f},this.workerOptions);i.scope=this.scope;const s=this._data;typeof s=="string"?(i.request=this.map._requestManager.transformRequest(n.q.resolveURL(s),n.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(m,x)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new n.t(m));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new n.x("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,i){const s=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,x=m?{image:m.image.clone()}:null,w=this._partialReload,A={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:w};f.request=this.actor.send(s,A,(k,U)=>w&&!U?(f.state="loaded",i(null)):(delete f.request,f.destroy(),f.aborted?i(null):k?i(k):(f.loadVectorData(U,this.map.painter,s==="reloadTile"),i(null))),void 0,s==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,i){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aD{constructor(f,i,s,m){super(f,i,s,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const i of f.urls)this.urls.push(this.map._requestManager.transformRequest(i,n.R.Source).url);n.aE(this.urls,(i,s)=>{this._loaded=!0,i?this.fire(new n.t(i)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const i=this.video.seekable;f<i.start(0)||f>i.end(0)?this.fire(new n.t(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,i=f.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(f,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aD,model:class extends n.E{constructor(f,i,s,m){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const f=[];for(const i in this._options.models){const s=this._options.models[i],m=n.aG(this.map._requestManager.transformRequest(s.uri,n.R.Model).url).then(x=>{if(!x)return;const w=n.aH(x),A=new n.aI(i,s.position,s.orientation,w);A.computeBoundsAndApplyParent(),this.models.push(A)}).catch(x=>{this.fire(new n.t(new Error(`Could not load model ${i} from ${s.uri}: ${x.message}`)))});f.push(m)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new n.t(new Error(`Could not load models: ${i.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,i){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(f,i,s,m){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=es(this._options,this.map._requestManager,i,s,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,m?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new n.t(m))):x&&(n.l(this,x),x.bounds&&(this.tileBounds=new Fs(x.bounds,this.minzoom,this.maxzoom)),bt(x.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),f&&f(m)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,i){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(s,n.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=i;else{if(f.buckets){const w=Object.values(f.buckets);for(const A of w)A.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",m,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",m,x.bind(this),void 0,!0);function x(w,A){return f.aborted?i(null):w&&w.status!==404?i(w):(this.map._refreshExpiredTiles&&A&&f.setExpiryData(A),f.loadModelData(A,this.map.painter),f.state="loaded",void i(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aD{constructor(f,i,s,m){super(f,i,s,m),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new n.t(new n.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.t(new n.V(`sources.${f}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new n.t(new n.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new n.t(new n.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.t(new n.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof n.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends n.E{constructor(f,i,s,m){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Fs(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ar(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:i,y:s,z:m}=f.canonical;return this._implementation.hasTile({x:i,y:s,z:m})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,i){const{x:s,y:m,z:x}=f.tileID.canonical,w=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:s,y:m,z:x},{signal:w.signal})).then((function(A){return delete f.request,f.aborted?(f.state="unloaded",i(null)):A===void 0?(f.state="errored",i(null)):A===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",i(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(A)?(this.loadTileData(f,A),f.state="loaded",void i(null)):(f.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(f.state="errored",i(A))}),f.request.cancel=()=>w.abort()}loadTileData(f,i){f.setTexture(i,this.map.painter)}unloadTile(f,i){if(f.texture&&f.texture instanceof n.T?(f.destroy(!0),f.texture&&f.texture instanceof n.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:s,y:m,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:s,y:m,z:x})}i&&i()}abortTile(f,i){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=n.av(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}}},ml=function(f,i,s,m){const x=new Ua[i.type](f,i,s,m);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return n.aJ(["load","abort","unload","serialize","prepare"],x),x};function aa(f,i){const s=n.a6.mat4.identity([]);return n.a6.mat4.scale(s,s,[.5*f.width,.5*-f.height,1]),n.a6.mat4.translate(s,s,[1,-1,0]),n.a6.mat4.multiply(s,s,f.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(s)}function nr(f,i,s,m,x,w,A,k,U=!1){const W=f.tilesIn(s,k,U);W.sort(go);const j=[];for(const J of W)j.push({wrappedTileID:J.tile.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(i,f._state,J,m,x,w,A,aa(f.transform,J.tile.tileID),U)});const Y=function(J){const oe={},pe={};for(const ue of J){const _e=ue.queryResults,ge=ue.wrappedTileID,Oe=pe[ge]=pe[ge]||{};for(const Ge in _e){const He=_e[Ge],Qe=Oe[Ge]=Oe[Ge]||{},nt=oe[Ge]=oe[Ge]||[];for(const tt of He)Qe[tt.featureIndex]||(Qe[tt.featureIndex]=!0,nt.push(tt))}}return oe}(j);for(const J in Y)Y[J].forEach(oe=>{const pe=oe.feature,ue=pe.layer;ue&&ue.type!=="background"&&ue.type!=="sky"&&ue.type!=="slot"&&(n.aK(J)||(pe.source=ue.source,ue["source-layer"]&&(pe.sourceLayer=ue["source-layer"])),pe.state=pe.id!==void 0?f.getFeatureState(ue["source-layer"],pe.id):{})});return Y}function qo(f,i){const s=f.getRenderableIds().map(w=>f.getTileByID(w)),m=[],x={};for(let w=0;w<s.length;w++){const A=s[w],k=A.tileID.canonical.key;x[k]||(x[k]=!0,A.querySourceFeatures(m,i))}return m}function go(f,i){const s=f.tileID,m=i.tileID;return s.overscaledZ-m.overscaledZ||s.canonical.y-m.canonical.y||s.wrap-m.wrap||s.canonical.x-m.canonical.x}function Vo(f,i){const s={};if(!i)return s;for(const m of f){const x=m.layerIds.map(w=>i.getLayer(w)).filter(Boolean);if(x.length!==0){m.layers=x,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(w=>x.filter(A=>A.id===w)[0]));for(const w of x)s[w.fqid]=m}}return s}const la=32,_o=33,$o=new Uint16Array(8184);for(let f=0;f<2046;f++){let i=f+2,s=0,m=0,x=0,w=0,A=0,k=0;for(1&i?x=w=A=la:s=m=k=la;(i>>=1)>1;){const W=s+x>>1,j=m+w>>1;1&i?(x=s,w=m,s=A,m=k):(s=x,m=w,x=A,w=k),A=W,k=j}const U=4*f;$o[U+0]=s,$o[U+1]=m,$o[U+2]=x,$o[U+3]=w}const Ws=new Uint16Array(2178),_a=new Uint8Array(1089),gl=new Uint16Array(1089);function Va(f){return f===0?-.03125:f===32?.03125:0}const Hl={type:2,extent:n.ab,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ab+1,0),new n.P(n.ab+1,n.ab+1),new n.P(0,n.ab+1),new n.P(0,0)]]};class Us{constructor(i,s,m,x,w){this.tileID=i,this.uid=n.aQ(),this.uses=0,this.tileSize=s,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection)}registerFadeDuration(i){const s=i+this.timeAdded;s<n.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,s,m){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=Vo(i.buckets,s.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const w=this.buckets[x];if(w instanceof n.aS){if(this.hasSymbolBuckets=!0,!m)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const w=this.buckets[x];if(w instanceof n.aS&&w.hasRTLText){this.hasRTLText=!0,n.aT();break}}this.queryPadding=0;for(const x in this.buckets){const w=this.buckets[x],A=s.style.getOwnLayer(x);if(!A)continue;const k=A.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,k)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new n.aR}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,s,m){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets={...this.buckets,...Vo(i.buckets,s.style)},i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const x in this.buckets){const w=this.buckets[x];w.uploadPending()&&w.upload(i)}const s=i.gl,m=this.imageAtlas;if(m&&!m.uploaded){const x=!!Object.keys(m.patternPositions).length;this.imageAtlasTexture=new n.T(i,m.image,s.RGBA8,{useMipmap:x}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(i,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(i,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(i,s,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,m),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=s.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this._lastUpdatedBrightness=x,this.updateBuckets(s)))}queryRenderedFeatures(i,s,m,x,w,A,k,U,W){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:U,transform:k,filter:x,layers:w,availableImages:A,tileTransform:this.tileTransform},i,s):{}}querySourceFeatures(i,s){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const x=m.loadVTLayers(),w=s?s.sourceLayer:"",A=x._geojsonTileLayer||x[w];if(!A)return;const k=n.aU(s&&s.filter),{z:U,x:W,y:j}=this.tileID.canonical,Y={z:U,x:W,y:j};for(let J=0;J<A.length;J++){const oe=A.feature(J);if(k.needGeometry){const _e=n.aV(oe,!0);if(!k.filter(new n.a3(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!k.filter(new n.a3(this.tileID.overscaledZ),oe))continue;const pe=m.getId(oe,w),ue=new n.aW(oe,U,W,j,pe);ue.tile=Y,i.push(ue)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const s=this.expirationTime;if(i.cacheControl){const m=n.aX(i.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const m=Date.now();let x=!1;if(this.expirationTime>m)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{const w=this.expirationTime-s;w?this.expirationTime=m+Math.max(w,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),m=i.style.listImages(),x=i.style.getBrightness();for(const w in this.buckets){if(!i.style.hasLayer(w))continue;const A=this.buckets[w],k=A.layers[0],U=k.sourceLayer||"_geojsonTileLayer",W=s[U],j=i.style.getSourceCache(k.source,k.scope);let Y={};j&&(Y=j._state.getState(U,void 0)),A.update(Y,W,m,this.imageAtlas&&this.imageAtlas.patternPositions||{},x),(A instanceof n.aY||A instanceof n.aZ)&&i._terrain&&i._terrain.enabled&&j&&A.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(j.id,this.tileID);const J=i&&i.style&&i.style.getOwnLayer(w);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=n.q.now()+i}setTexture(i,s){const m=s.context,x=m.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture&&this.texture instanceof n.T?this.texture.update(i):(this.texture=new n.T(m,i,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(i,s){const m={};for(const x of s)m[x]=!0;this.dependencies[i]=m}hasDependency(i,s){for(const m of i){const x=this.dependencies[m];if(x){for(const w of s)if(x[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const m=n.a_(Hl,this.tileID.canonical,this.tileTransform)[0],x=new n.a$,w=new n.b0;for(let A=0;A<m.length;A++){const{x:k,y:U}=m[A];x.emplaceBack(k,U),w.emplaceBack(A)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(x,n.b1.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,x.length,w.length)}_makeTileBoundsBuffers(i,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const m=n.a_(Hl,this.tileID.canonical,this.tileTransform)[0];let x,w;if(this.isRaster){const A=function(k,U){const W=n.aL(k,U),j=Math.pow(2,k.z);for(let _e=0;_e<_o;_e++)for(let ge=0;ge<_o;ge++){const Oe=n.aM((k.x+(ge+Va(ge))/la)/j),Ge=n.aN((k.y+(_e+Va(_e))/la)/j),He=U.project(Oe,Ge),Qe=_e*_o+ge;Ws[2*Qe+0]=Math.round((He.x*W.scale-W.x)*n.ab),Ws[2*Qe+1]=Math.round((He.y*W.scale-W.y)*n.ab)}_a.fill(0),gl.fill(0);for(let _e=2045;_e>=0;_e--){const ge=4*_e,Oe=$o[ge+0],Ge=$o[ge+1],He=$o[ge+2],Qe=$o[ge+3],nt=Oe+He>>1,tt=Ge+Qe>>1,at=nt+tt-Ge,wt=tt+Oe-nt,Ot=Ge*_o+Oe,Ct=Qe*_o+He,St=tt*_o+nt,si=Math.hypot((Ws[2*Ot+0]+Ws[2*Ct+0])/2-Ws[2*St+0],(Ws[2*Ot+1]+Ws[2*Ct+1])/2-Ws[2*St+1])>=16;_a[St]=_a[St]||(si?1:0),_e<1022&&(_a[St]=_a[St]||_a[(Ge+wt>>1)*_o+(Oe+at>>1)]||_a[(Qe+wt>>1)*_o+(He+at>>1)])}const Y=new n.aO,J=new n.aP;let oe=0;function pe(_e,ge){const Oe=ge*_o+_e;return gl[Oe]===0&&(Y.emplaceBack(Ws[2*Oe+0],Ws[2*Oe+1],_e*n.ab/la,ge*n.ab/la),gl[Oe]=++oe),gl[Oe]-1}function ue(_e,ge,Oe,Ge,He,Qe){const nt=_e+Oe>>1,tt=ge+Ge>>1;if(Math.abs(_e-He)+Math.abs(ge-Qe)>1&&_a[tt*_o+nt])ue(He,Qe,_e,ge,nt,tt),ue(Oe,Ge,He,Qe,nt,tt);else{const at=pe(_e,ge),wt=pe(Oe,Ge),Ot=pe(He,Qe);J.emplaceBack(at,wt,Ot)}}return ue(0,0,la,la,la,0),ue(la,la,0,0,0,la),{vertices:Y,indices:J}}(this.tileID.canonical,s);x=A.vertices,w=A.indices}else{x=new n.aO,w=new n.aP;for(const{x:k,y:U}of m)x.emplaceBack(k,U,0,0);const A=n.b3(x.int16,void 0,4);for(let k=0;k<A.length;k+=3)w.emplaceBack(A[k],A[k+1],A[k+2])}this._tileBoundsBuffer=i.createVertexBuffer(x,n.b4.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=n.b2.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugBuffers(i,s){const m=s.projection;if(!m||m.name!=="globe"||s.freezeTileCoverage)return;const x=this.tileID.canonical,w=n.b5(x,s),A=n.b6(w),k=n.a9(s.zoom);let U;k>0&&(U=n.a6.mat4.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,x,s,A,U,k),this._makeGlobeTileDebugTextBuffer(i,x,s,A,U,k)}_globePoint(i,s,m,x,w,A,k){let U=n.b7(i,s,m);if(A){const W=1<<m.z,j=n.am(x.center.lng),Y=n.at(x.center.lat),J=(m.x+.5)/W-j;let oe=0;J>.5?oe=-1:J<-.5&&(oe=1);let pe=(i/n.ab+m.x)/W+oe,ue=(s/n.ab+m.y)/W;pe=(pe-j)*x._pixelsPerMercatorPixel+j,ue=(ue-Y)*x._pixelsPerMercatorPixel+Y;const _e=[pe*x.worldSize,ue*x.worldSize,0];n.a6.vec3.transformMat4(_e,_e,A),U=n.b8(U,_e,k)}return n.a6.vec3.transformMat4(U,U,w)}_makeGlobeTileDebugBorderBuffer(i,s,m,x,w,A){const k=new n.a$,U=new n.b0,W=new n.b9,j=(J,oe,pe,ue,_e)=>{const ge=(pe-J)/(_e-1),Oe=(ue-oe)/(_e-1),Ge=k.length;for(let He=0;He<_e;He++){const Qe=J+He*ge,nt=oe+He*Oe;k.emplaceBack(Qe,nt);const tt=this._globePoint(Qe,nt,s,m,x,w,A);W.emplaceBack(tt[0],tt[1],tt[2]),U.emplaceBack(Ge+He)}},Y=n.ab;j(0,0,Y,0,16),j(Y,0,Y,Y,16),j(Y,Y,0,Y,16),j(0,Y,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(U),this._tileDebugBuffer=i.createVertexBuffer(k,n.b1.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(W,n.ba.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,k.length,U.length)}_makeGlobeTileDebugTextBuffer(i,s,m,x,w,A){const k=n.ab/4,U=new n.a$,W=new n.aP,j=new n.b9,Y=25;W.reserve(32),U.reserve(Y),j.reserve(Y);const J=(oe,pe)=>Y*oe+pe;for(let oe=0;oe<Y;oe++){const pe=oe*k;for(let ue=0;ue<Y;ue++){const _e=ue*k;U.emplaceBack(_e,pe);const ge=this._globePoint(_e,pe,s,m,x,w,A);j.emplaceBack(ge[0],ge[1],ge[2])}}for(let oe=0;oe<4;oe++)for(let pe=0;pe<4;pe++){const ue=J(oe,pe),_e=J(oe,pe+1),ge=J(oe+1,pe),Oe=J(oe+1,pe+1);W.emplaceBack(ue,_e,ge),W.emplaceBack(ge,_e,Oe)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(W),this._tileDebugTextBuffer=i.createVertexBuffer(U,n.b1.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(j,n.ba.members),this._tileDebugTextSegments=n.b2.simpleSegment(0,0,Y,32)}destroy(i=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bb.setPbf(n.bc);class _l extends Us{constructor(i,s,m,x,w){super(i,s,m,x,w),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,s){const m=s.context,x=m.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture&&this.texture instanceof n.T?this.texture.update(i,{premultiply:!1}):this.texture=new n.T(m,i,x.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,s){const m=this._mrt=new n.bb(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=n.bd(x,(w,A,k,U)=>{if(w)s(w);else try{const W=m.getHeaderLength(A);if(W>i)return void(this.request=this.fetchHeader(W,s));m.parseHeader(A),this._isHeaderLoaded=!0;let j=0;for(const Y of Object.values(m.layers))j=Math.max(j,Y.dataIndex[Y.dataIndex.length-1].last_byte);A.byteLength>=j&&(this.entireBuffer=A),s(null,this.entireBuffer||A,k,U)}catch(W){s(W)}}),this.request}fetchBand(i,s,m){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void m(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void m(new Error("Can't fetch tile band without an actor"));let A;const k=(Y,J)=>{A.complete(Y,J),Y?m(Y):(this.updateTextureDescriptor(i,s),m(null,this.textureDescriptor&&this.textureDescriptor.img))},U=(Y,J)=>{if(Y)return m(Y);const oe=w.send("decodeRasterArray",{buffer:J,task:A},k,void 0,!0);this._workQueue.push(()=>{oe&&oe.cancel(),A.cancel()})},W=x.getLayer(i);if(!W)return void m(new Error(`Unknown sourceLayer "${i}"`));if(W.hasDataForBand(s))return this.updateTextureDescriptor(i,s),void m(null,this.textureDescriptor?this.textureDescriptor.img:null);const j=W.getDataRange([s]);if(A=x.createDecodingTask(j),!A||A.tasks.length)if(this.flushQueues(),this.entireBuffer)U(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const Y=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),J=n.bd(Y,U);this._fetchQueue.push(()=>{J.cancel(),A.cancel()})}else m(null)}updateNeeded(i,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,s){if(!this._mrt)return;const m=this._mrt.getLayer(i);if(!m||!m.hasBand(s)||!m.hasDataForBand(s))return;const{bytes:x,tileSize:w,buffer:A,offset:k,scale:U}=m.getBandView(s),W=w+2*A,j={data:x,width:W,height:W},Y=this.texture;Y&&Y instanceof n.T&&Y.update(j,{premultiply:!1}),this.textureDescriptor={layer:i,band:s,img:j,buffer:A,offset:k,tileSize:w,format:m.pixelFormat,mix:[U,256*U,65536*U,16777216*U]}}}class yl{constructor(i,s){this.max=i,this.onRemove=s,this.reset()}reset(){for(const i in this.data)for(const s of this.data[i])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(i,s,m){const x=i.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const w={value:s,timeout:void 0};if(m!==void 0&&(w.timeout=setTimeout(()=>{this.remove(i,w)},m)),this.data[x].push(w),this.order.push(x),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const s=this.data[i].shift();return s.timeout&&clearTimeout(s.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),s.value}getByKey(i){const s=this.data[i];return s?s[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,s){if(!this.has(i))return this;const m=i.wrapped().key,x=s===void 0?0:this.data[m].indexOf(s),w=this.data[m][x];return this.data[m].splice(x,1),w.timeout&&clearTimeout(w.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(w.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(i){const s=[];for(const m in this.data)for(const x of this.data[m])i(x.value)||s.push(x);for(const m of s)this.remove(m.value.tileID,m)}}class Ae{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,s,m){const x=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][x]=this.stateChanges[i][x]||{},n.l(this.stateChanges[i][x],m),this.deletedStates[i]===null){this.deletedStates[i]={};for(const w in this.state[i])w!==x&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][x]===null){this.deletedStates[i][x]={};for(const w in this.state[i][x])m[w]||(this.deletedStates[i][x][w]=null)}else for(const w in m)this.deletedStates[i]&&this.deletedStates[i][x]&&this.deletedStates[i][x][w]===null&&delete this.deletedStates[i][x][w]}removeFeatureState(i,s,m){if(this.deletedStates[i]===null)return;const x=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},m&&s!==void 0)this.deletedStates[i][x]!==null&&(this.deletedStates[i][x]=this.deletedStates[i][x]||{},this.deletedStates[i][x][m]=null);else if(s!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][x])for(m in this.deletedStates[i][x]={},this.stateChanges[i][x])this.deletedStates[i][x][m]=null;else this.deletedStates[i][x]=null;else this.deletedStates[i]=null}getState(i,s){const m=this.state[i]||{},x=this.stateChanges[i]||{},w=this.deletedStates[i];if(w===null)return{};if(s!==void 0){const k=String(s),U=n.l({},m[k],x[k]);if(w){const W=w[s];if(W===null)return{};for(const j in W)delete U[j]}return U}const A=n.l({},m,x);if(w)for(const k in w)delete A[k];return A}initializeTileState(i,s){i.refreshFeatureState(s)}coalesceChanges(i,s){const m={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const w={};for(const A in this.stateChanges[x])this.state[x][A]||(this.state[x][A]={}),n.l(this.state[x][A],this.stateChanges[x][A]),w[A]=this.state[x][A];m[x]=w}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const w={};if(this.deletedStates[x]===null)for(const A in this.state[x])w[A]={},this.state[x][A]={};else for(const A in this.deletedStates[x]){if(this.deletedStates[x][A]===null)this.state[x][A]={};else if(this.state[x][A])for(const k of Object.keys(this.deletedStates[x][A]))delete this.state[x][A][k];w[A]=this.state[x][A]}m[x]=m[x]||{},n.l(m[x],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const x in i)i[x].refreshFeatureState(s)}}class Me extends n.E{constructor(i,s,m){super(),this.id=i,this._onlySymbols=m,s.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new yl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ae,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const s=this._tiles[i];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,s){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,s)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const m=this._tiles[s];m.upload(i),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.be(this._tiles).map(i=>i.tileID).sort(je).map(i=>i.key)}getRenderableIds(i,s){const m=[];for(const x in this._tiles)this._isIdRenderable(+x,i,s)&&m.push(this._tiles[x]);return i?m.sort((x,w)=>{const A=x.tileID,k=w.tileID,U=new n.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),W=new n.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-k.overscaledZ||W.y-U.y||W.x-U.x}).map(x=>x.tileID.key):m.map(x=>x.tileID).sort(je).map(x=>x.key)}hasRenderableParent(i){const s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(i,s,m){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())&&(m||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,s){const m=this._tiles[i];m&&(m.state!=="loading"&&(m.state=s),this._loadTile(m,this._tileLoaded.bind(this,m,i,s)))}_tileLoaded(i,s,m,x){if(x)if(i.state="errored",x.status!==404)this._source.fire(new n.t(x,{tile:i}));else{if(this._source.fire(new n.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=n.q.now(),m==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new n.x("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const s=this.getRenderableIds();for(let x=0;x<s.length;x++){const w=s[x];if(i.neighboringTiles&&i.neighboringTiles[w]){const A=this.getTileByID(w);m(i,A),m(A,i)}}function m(x,w){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let A=w.tileID.canonical.x-x.tileID.canonical.x;const k=w.tileID.canonical.y-x.tileID.canonical.y,U=Math.pow(2,x.tileID.canonical.z),W=w.tileID.key;A===0&&k===0||Math.abs(k)>1||(Math.abs(A)>1&&(Math.abs(A+U)===1?A+=U:Math.abs(A-U)===1&&(A-=U)),w.dem&&x.dem&&(x.dem.backfillBorder(w.dem,A,k),x.neighboringTiles&&x.neighboringTiles[W]&&(x.neighboringTiles[W].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,s,m,x){for(const w in this._tiles){let A=this._tiles[w];if(x[w]||!A.hasData()||A.tileID.overscaledZ<=s||A.tileID.overscaledZ>m)continue;let k=A.tileID;for(;A&&A.tileID.overscaledZ>s+1;){const W=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[W.key],A&&A.hasData()&&(k=W)}let U=k;for(;U.overscaledZ>s;)if(U=U.scaledTo(U.overscaledZ-1),i[U.key]){x[k.key]=k;break}}}findLoadedParent(i,s){if(i.key in this._loadedParentTiles){const m=this._loadedParentTiles[i.key];return m&&m.tileID.overscaledZ>=s?m:null}for(let m=i.overscaledZ-1;m>=s;m--){const x=i.scaledTo(m),w=this._getLoadedTile(x);if(w)return w}}_getLoadedTile(i){const s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,s){s=s||this._source.tileSize;const m=Math.ceil(i.width/s)+1,x=Math.ceil(i.height/s)+1,w=Math.floor(m*x*5),A=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(k)}handleWrapJump(i){const s=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,s){const m={};for(const x in this._tiles){const w=this._tiles[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),m[w.tileID.key]=w}this._tiles=m;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(i,s,m,x){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(i,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let A,k=this._source.maxzoom;const U=this.map&&this.map.painter?this.map.painter._terrain:null;if(U&&U.sourceCache===this&&U.attenuationRange()){const Y=U.attenuationRange()[0],J=Math.floor(Y)-Math.log2(U.getDemUpscale());k>J&&(k=J)}if(this.used||this.usedForTerrain){if(this._source.tileID)A=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(Y=>new n.aA(Y.canonical.z,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y));else if(this.tileCoverLift!==0){const Y=i.clone();Y.tileCoverLift=this.tileCoverLift,A=Y.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&i.projection.name==="globe"&&(A.push(new n.aA(1,0,1,0,0)),A.push(new n.aA(1,0,1,1,0)),A.push(new n.aA(1,0,1,0,1)),A.push(new n.aA(1,0,1,1,1)))}else if(A=i.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const Y=this._source.hasTile.bind(this._source);A=A.filter(J=>Y(J))}}else A=[];if(A.length>0&&this.castsShadows&&x&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!zt(this._source.type)){const Y=i.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),J=Math.min(Y,this._source.maxzoom);if(w){const oe=i.extendTileCover(A,J);for(const pe of oe)A.push(pe)}else{const oe=i.extendTileCover(A,J,x);for(const pe of oe)this._shadowCasterTiles[pe.key]=!0,A.push(pe)}}const W=this._updateRetainedTiles(A);if(zt(this._source.type)&&A.length!==0){const Y={},J={},oe=Object.keys(W);for(const ue of oe){const _e=W[ue],ge=this._tiles[ue];if(!ge||ge.fadeEndTime&&ge.fadeEndTime<=n.q.now())continue;const Oe=this.findLoadedParent(_e,Math.max(_e.overscaledZ-Me.maxOverzooming,this._source.minzoom));Oe&&(this._addTile(Oe.tileID),Y[Oe.tileID.key]=Oe.tileID),J[ue]=_e}const pe=A[A.length-1].overscaledZ;for(const ue in this._tiles){const _e=this._tiles[ue];if(W[ue]||!_e.hasData())continue;let ge=_e.tileID;for(;ge.overscaledZ>pe;){ge=ge.scaledTo(ge.overscaledZ-1);const Oe=this._tiles[ge.key];if(Oe&&Oe.hasData()&&J[ge.key]){W[ue]=_e.tileID;break}}}for(const ue in Y)W[ue]||(this._coveredTiles[ue]=!0,W[ue]=Y[ue])}for(const Y in W)this._tiles[Y].clearFadeHold();const j=n.bf(this._tiles,W);for(const Y of j){const J=this._tiles[Y];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(+Y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const s={};if(i.length===0)return s;const m={},x=i.reduce((W,j)=>Math.min(W,j.overscaledZ),1/0),w=i[0].overscaledZ,A=Math.max(w-Me.maxOverzooming,this._source.minzoom),k=Math.max(w+Me.maxUnderzooming,this._source.minzoom),U={};for(const W of i){const j=this._addTile(W);s[W.key]=W,j.hasData()||x<this._source.maxzoom&&(U[W.key]=W)}this._retainLoadedChildren(U,x,k,s);for(const W of i){let j=this._tiles[W.key];if(j.hasData())continue;if(W.canonical.z>=this._source.maxzoom){const J=W.children(this._source.maxzoom)[0],oe=this.getTile(J);if(oe&&oe.hasData()){s[J.key]=J;continue}}else{const J=W.children(this._source.maxzoom);if(s[J[0].key]&&s[J[1].key]&&s[J[2].key]&&s[J[3].key])continue}let Y=j.wasRequested();for(let J=W.overscaledZ-1;J>=A;--J){const oe=W.scaledTo(J);if(m[oe.key]||(m[oe.key]=!0,j=this.getTile(oe),!j&&Y&&(j=this._addTile(oe)),j&&(s[oe.key]=oe,Y=j.wasRequested(),j.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const s=[];let m,x=this._tiles[i].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){m=this._loadedParentTiles[x.key];break}s.push(x.key);const w=x.scaledTo(x.overscaledZ-1);if(m=this._getLoadedTile(w),m)break;x=w}for(const w of s)this._loadedParentTiles[w]=m}}_addTile(i){let s=this._tiles[i.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),s;s=this._cache.getAndRemove(i),s&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));const m=!!s;if(!m){const x=this.map?this.map.painter:null,w=this._source.tileSize*i.overscaleFactor();s=this._source.type==="raster-array"?new _l(i,w,this.transform.tileZoom,x,this._isRaster):new Us(i,w,this.transform.tileZoom,x,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))}return s?(s.uses++,this._tiles[i.key]=s,m||this._source.fire(new n.x("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(i,s){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const m=s.getExpiryTimeout();m&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},m))}_removeTile(i){const s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,s,m){const x=[],w=this.transform;if(!w)return x;const A=w.projection.name==="globe",k=n.am(w.center.lng);for(const U in this._tiles){const W=this._tiles[U];if(m&&W.clearQueryDebugViz(),W.holdingForFade())continue;let j;if(A){const Y=W.tileID.canonical;if(Y.z===0){const J=[Math.abs(n.ap(k,...Ai(Y,-1))-k),Math.abs(n.ap(k,...Ai(Y,1))-k)];j=[0,2*J.indexOf(Math.min(...J))-1]}else{const J=[Math.abs(n.ap(k,...Ai(Y,-1))-k),Math.abs(n.ap(k,...Ai(Y,0))-k),Math.abs(n.ap(k,...Ai(Y,1))-k)];j=[J.indexOf(Math.min(...J))-1]}}else j=[0];for(const Y of j){const J=i.containsTile(W,w,s,Y);J&&x.push(J)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,s){const m=this.getRenderableIds(i,s).map(w=>this._tiles[w].tileID),x=this.transform.projection.name==="globe";for(const w of m)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=x?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return m}sortCoordinatesByDistance(i){const s=i.slice(),m=this.transform._camera.position,x=this.transform._camera.forward(),w={};for(const A of s){const k=1/(1<<A.canonical.z);w[A.key]=((A.canonical.x+.5)*k+A.wrap-m[0])*x[0]+((A.canonical.y+.5)*k-m[1])*x[1]-m[2]*x[2]}return s.sort((A,k)=>w[A.key]-w[k.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(zt(this._source.type))for(const i in this._tiles){const s=this._tiles[i];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(i,s,m){this._state.updateState(i=i||"_geojsonTileLayer",s,m)}removeFeatureState(i,s,m){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,m)}getFeatureState(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)}setDependencies(i,s,m){const x=this._tiles[i];x&&x.setDependencies(s,m)}reloadTilesForDependencies(i,s){for(const m in this._tiles)this._tiles[m].hasDependency(i,s)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(i,s))}_preloadTiles(i,s){if(!this._sourceLoaded){const U=()=>{this._sourceLoaded&&(this._source.off("data",U),this._preloadTiles(i,s))};return void this._source.on("data",U)}const m=new Map,x=Array.isArray(i)?i:[i],w=this.map.painter.terrain,A=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const U of x){const W=U.coveringTiles({tileSize:A,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of W)m.set(j.key,j);this.usedForTerrain&&U.updateElevation(!1)}const k=Array.from(m.values());n.bg(k,(U,W)=>{const j=new Us(U,this._source.tileSize*U.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(j,Y=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),W(Y,j)})},s)}}function je(f,i){const s=Math.abs(2*f.wrap)-+(f.wrap<0),m=Math.abs(2*i.wrap)-+(i.wrap<0);return f.overscaledZ-i.overscaledZ||m-s||i.canonical.y-f.canonical.y||i.canonical.x-f.canonical.x}function zt(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Ai(f,i){const s=1<<f.z;return[f.x/s+i,(f.x+1)/s+i]}Me.maxOverzooming=10,Me.maxUnderzooming=3;class Ui{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,s=!1;for(const m in this.style._mergedLayers){const x=this.style._mergedLayers[m];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:i,visibilityChanged:s});else if(x.type==="model"){const w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:i,visibilityChanged:s})}}}onNewFrame(i){this.layersGotHidden=!1;for(const s of this.layers){const m=s.layer;let x=!1;m.type==="fill-extrusion"?x=!m.isHidden(i)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="model"&&(x=!m.isHidden(i)&&m.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&s.visible,s.visible=x}}updateZOffset(i,s){this.currentBuildingBuckets=[];for(const x of this.layers){const w=x.layer,A=this.style.getLayerSourceCache(w);let k=1;w.type==="fill-extrusion"&&(k=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let U=A?A.getTile(s):null;if(!U&&A&&s.canonical.z>A.getSource().minzoom){let W=s.scaledTo(Math.min(A.getSource().maxzoom,s.overscaledZ-1));for(;W.overscaledZ>=A.getSource().minzoom&&(U=A.getTile(W),!U&&W.overscaledZ!==0);)W=W.scaledTo(W.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:U?U.getBucket(w):null,tileID:U?U.tileID:s,verticalScale:k})}i.hasAnyZOffset=!1;let m=!1;for(let x=0;x<i.symbolInstances.length;x++){const w=i.symbolInstances.get(x),A=w.zOffset,k=this._getHeightAtTileOffset(s,w.tileAnchorX,w.tileAnchorY);w.zOffset=k!==Number.NEGATIVE_INFINITY?k:A,m||A===w.zOffset||(m=!0),i.hasAnyZOffset||w.zOffset===0||(i.hasAnyZOffset=!0)}m&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,s,m,x){let w=s,A=m;if(i.canonical.z!==x.canonical.z){const k=x.canonical,U=1/(1<<i.canonical.z-k.z);w=(s+i.canonical.x*n.ab)*U-k.x*n.ab|0,A=(m+i.canonical.y*n.ab)*U-k.y*n.ab|0}return{tileX:w,tileY:A}}_getHeightAtTileOffset(i,s,m){let x,w;for(let A=0;A<this.layers.length;++A){if(this.layers[A].layer.type!=="fill-extrusion")continue;const{bucket:k,tileID:U,verticalScale:W}=this.currentBuildingBuckets[A];if(!k)continue;const{tileX:j,tileY:Y}=this._mapCoordToOverlappingTile(i,s,m,U),J=k.getHeightAtTileCoord(j,Y);J&&J.height!==void 0&&(J.hidden?x=J.height:w=Math.max(J.height*W,w||0))}if(w!==void 0)return w;for(let A=0;A<this.layers.length;++A){const k=this.layers[A];if(k.layer.type!=="model"||!k.visible)continue;const{bucket:U,tileID:W}=this.currentBuildingBuckets[A];if(!U)continue;const{tileX:j,tileY:Y}=this._mapCoordToOverlappingTile(i,s,m,W),J=U.getHeightAtTileCoord(j,Y);if(J&&!J.hidden)return J.height===void 0&&x!==void 0?Math.min(J.maxHeight,x)*J.verticalScale:J.height?J.height*J.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function bi(f,i){const s={};for(const m in f)m!=="ref"&&(s[m]=f[m]);return n.bh.forEach(m=>{m in i&&(s[m]=i[m])}),s}function Yi(f){f=f.slice();const i=Object.create(null);for(let s=0;s<f.length;s++)i[f[s].id]=f[s];for(let s=0;s<f.length;s++)"ref"in f[s]&&(f[s]=bi(f[s],i[f[s].ref]));return f}const fe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function me(f,i,s){s.push({command:fe.addSource,args:[f,i[f]]})}function Ee(f,i,s){i.push({command:fe.removeSource,args:[f]}),s[f]=!0}function Ke(f,i,s,m){Ee(f,s,m),me(f,i,s)}function Pe(f,i,s){let m;for(m in f[s])if(f[s].hasOwnProperty(m)&&m!=="data"&&!n.bi(f[s][m],i[s][m]))return!1;for(m in i[s])if(i[s].hasOwnProperty(m)&&m!=="data"&&!n.bi(f[s][m],i[s][m]))return!1;return!0}function ci(f,i,s,m,x,w){let A;for(A in i=i||{},f=f||{})f.hasOwnProperty(A)&&(n.bi(f[A],i[A])||s.push({command:w,args:[m,A,i[A],x]}));for(A in i)i.hasOwnProperty(A)&&!f.hasOwnProperty(A)&&(n.bi(f[A],i[A])||s.push({command:w,args:[m,A,i[A],x]}))}function Mi(f){return f.id}function Wi(f,i){return f[i.id]=i,f}class hn{constructor(i,s){this.reset(i,s)}reset(i,s){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=n.ap(i,0,1);let s=1,m=this._distances[s];const x=i*this.paddedLength+this.padding;for(;m<x&&s<this._distances.length;)m=this._distances[++s];const w=s-1,A=this._distances[w],k=m-A,U=k>0?(x-A)/k:0;return this.points[w].mult(1-U).add(this.points[s].mult(U))}}class Dn{constructor(i,s,m){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(s/m);for(let A=0;A<this.xCellCount*this.yCellCount;A++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=s,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,s,m,x,w){this._forEachCell(s,m,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(s),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(i,s,m,x){this._forEachCell(s-x,m-x,s+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(s),this.circles.push(m),this.circles.push(x)}_insertBoxCell(i,s,m,x,w,A){this.boxCells[w].push(A)}_insertCircleCell(i,s,m,x,w,A){this.circleCells[w].push(A)}_query(i,s,m,x,w,A){if(m<0||i>this.width||x<0||s>this.height)return!w&&[];const k=[];if(i<=0&&s<=0&&this.width<=m&&this.height<=x){if(w)return!0;for(let U=0;U<this.boxKeys.length;U++)k.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const W=this.circles[3*U],j=this.circles[3*U+1],Y=this.circles[3*U+2];k.push({key:this.circleKeys[U],x1:W-Y,y1:j-Y,x2:W+Y,y2:j+Y})}return A?k.filter(A):k}return this._forEachCell(i,s,m,x,this._queryCell,k,{hitTest:w,seenUids:{box:{},circle:{}}},A),w?k.length>0:k}_queryCircle(i,s,m,x,w){const A=i-m,k=i+m,U=s-m,W=s+m;if(k<0||A>this.width||W<0||U>this.height)return!x&&[];const j=[];return this._forEachCell(A,U,k,W,this._queryCellCircle,j,{hitTest:x,circle:{x:i,y:s,radius:m},seenUids:{box:{},circle:{}}},w),x?j.length>0:j}query(i,s,m,x,w){return this._query(i,s,m,x,!1,w)}hitTest(i,s,m,x,w){return this._query(i,s,m,x,!0,w)}hitTestCircle(i,s,m,x){return this._queryCircle(i,s,m,!0,x)}_queryCell(i,s,m,x,w,A,k,U){const W=k.seenUids,j=this.boxCells[w];if(j!==null){const J=this.bboxes;for(const oe of j)if(!W.box[oe]){W.box[oe]=!0;const pe=4*oe;if(i<=J[pe+2]&&s<=J[pe+3]&&m>=J[pe+0]&&x>=J[pe+1]&&(!U||U(this.boxKeys[oe]))){if(k.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[oe],x1:J[pe],y1:J[pe+1],x2:J[pe+2],y2:J[pe+3]})}}}const Y=this.circleCells[w];if(Y!==null){const J=this.circles;for(const oe of Y)if(!W.circle[oe]){W.circle[oe]=!0;const pe=3*oe;if(this._circleAndRectCollide(J[pe],J[pe+1],J[pe+2],i,s,m,x)&&(!U||U(this.circleKeys[oe]))){if(k.hitTest)return A.push(!0),!0;{const ue=J[pe],_e=J[pe+1],ge=J[pe+2];A.push({key:this.circleKeys[oe],x1:ue-ge,y1:_e-ge,x2:ue+ge,y2:_e+ge})}}}}}_queryCellCircle(i,s,m,x,w,A,k,U){const W=k.circle,j=k.seenUids,Y=this.boxCells[w];if(Y!==null){const oe=this.bboxes;for(const pe of Y)if(!j.box[pe]){j.box[pe]=!0;const ue=4*pe;if(this._circleAndRectCollide(W.x,W.y,W.radius,oe[ue+0],oe[ue+1],oe[ue+2],oe[ue+3])&&(!U||U(this.boxKeys[pe])))return A.push(!0),!0}}const J=this.circleCells[w];if(J!==null){const oe=this.circles;for(const pe of J)if(!j.circle[pe]){j.circle[pe]=!0;const ue=3*pe;if(this._circlesCollide(oe[ue],oe[ue+1],oe[ue+2],W.x,W.y,W.radius)&&(!U||U(this.circleKeys[pe])))return A.push(!0),!0}}}_forEachCell(i,s,m,x,w,A,k,U){const W=this._convertToXCellCoord(i),j=this._convertToYCellCoord(s),Y=this._convertToXCellCoord(m),J=this._convertToYCellCoord(x);for(let oe=W;oe<=Y;oe++)for(let pe=j;pe<=J;pe++)if(w.call(this,i,s,m,x,this.xCellCount*pe+oe,A,k,U))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,s,m,x,w,A){const k=x-i,U=w-s,W=m+A;return W*W>k*k+U*U}_circleAndRectCollide(i,s,m,x,w,A,k){const U=(A-x)/2,W=Math.abs(i-(x+U));if(W>U+m)return!1;const j=(k-w)/2,Y=Math.abs(s-(w+j));if(Y>j+m)return!1;if(W<=U||Y<=j)return!0;const J=W-U,oe=Y-j;return J*J+oe*oe<=m*m}}const Zi={unknown:0,flipRequired:1,flipNotRequired:2},Kt=Math.tan(85*Math.PI/180);function nn(f,i,s,m,x,w,A){const k=n.a6.mat4.create();if(s)if(w.name==="globe"){const U=n.bj(x,i);n.a6.mat4.multiply(k,k,U)}else{const U=n.a6.mat2.invert([],A);k[0]=U[0],k[1]=U[1],k[4]=U[2],k[5]=U[3],m||n.a6.mat4.rotateZ(k,k,x.angle)}else n.a6.mat4.multiply(k,x.labelPlaneMatrix,f);return k}function Ei(f,i,s,m,x,w,A){const k=nn(f,i,s,m,x,w,A);return w.name==="globe"&&s||(k[2]=k[6]=k[10]=k[14]=0),k}function Ln(f,i,s,m,x,w,A){if(s){if(w.name==="globe"){const k=nn(f,i,s,m,x,w,A);return n.a6.mat4.invert(k,k),n.a6.mat4.multiply(k,f,k),k}{const k=n.a6.mat4.clone(f),U=n.a6.mat4.identity([]);return U[0]=A[0],U[1]=A[1],U[4]=A[2],U[5]=A[3],n.a6.mat4.multiply(k,k,U),m||n.a6.mat4.rotateZ(k,k,-x.angle),k}}return x.glCoordMatrix}function Vi(f,i,s,m){const x=[f,i,s,1];s?n.a6.vec4.transformMat4(x,x,m):Or(x,x,m);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function fn(f,i){return Math.min(.5+f/i*.5,1.5)}function cr(f,i){const s=f[0]/f[3],m=f[1]/f[3];return s>=-i[0]&&s<=i[0]&&m>=-i[1]&&m<=i[1]}function gr(f,i,s,m,x,w,A,k,U,W){const j=s.transform,Y=m?f.textSizeData:f.iconSizeData,J=n.bk(Y,s.transform.zoom),oe=j.projection.name==="globe",pe=[256/s.width*2+1,256/s.height*2+1],ue=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ue.clear();let _e=null;oe&&(_e=m?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const ge=f.lineVertexArray,Oe=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,Ge=s.transform.width/s.transform.height;let He,Qe=!1;for(let nt=0;nt<Oe.length;nt++){const tt=Oe.get(nt),{numGlyphs:at,writingMode:wt}=tt;if(wt!==n.bl.vertical||Qe||He===n.bl.horizontal||(Qe=!0),He=wt,(tt.hidden||wt===n.bl.vertical)&&!Qe){Vs(at,ue);continue}Qe=!1;const Ot=new n.P(tt.tileAnchorX,tt.tileAnchorY);let{x:Ct,y:St,z:si}=j.projection.projectTilePoint(Ot.x,Ot.y,W.canonical);if(U){const[gi,Xi,zn]=U(Ot);Ct+=gi,St+=Xi,si+=zn}const di=[Ct,St,si,1];if(n.a6.vec4.transformMat4(di,di,i),!cr(di,pe)){Vs(at,ue);continue}const Si=di[3],Gi=fn(s.transform.getCameraToCenterDistance(j.projection),Si),Ki=n.bm(Y,J,tt),qt=A?Ki/Gi:Ki*Gi,wi=Vi(Ct,St,si,x);if(wi[3]<=0){Vs(at,ue);continue}let hi={};const Ti=A?null:U,Ci=ur(tt,qt,!1,k,i,x,w,f.glyphOffsetArray,ge,ue,_e,wi,Ot,hi,Ge,Ti,j.projection,W,A);Qe=Ci.useVertical,Ti&&Ci.needsFlipping&&(hi={}),(Ci.notEnoughRoom||Qe||Ci.needsFlipping&&ur(tt,qt,!0,k,i,x,w,f.glyphOffsetArray,ge,ue,_e,wi,Ot,hi,Ge,Ti,j.projection,W,A).notEnoughRoom)&&Vs(at,ue)}m?(f.text.dynamicLayoutVertexBuffer.updateData(ue),_e&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(_e)):(f.icon.dynamicLayoutVertexBuffer.updateData(ue),_e&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(_e))}function _r(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue){const{lineStartIndex:_e,glyphStartIndex:ge,segment:Oe}=k,Ge=ge+k.numGlyphs,He=_e+k.lineLength,Qe=i.getoffsetX(ge),nt=i.getoffsetX(Ge-1),tt=wr(f*Qe,s,m,x,w,A,Oe,_e,He,U,W,j,Y,J,!0,oe,pe,ue);if(!tt)return null;const at=wr(f*nt,s,m,x,w,A,Oe,_e,He,U,W,j,Y,J,!0,oe,pe,ue);return at?{first:tt,last:at}:null}function Rr(f,i,s,m){return f===n.bl.horizontal&&Math.abs(m)>Math.abs(s)?{useVertical:!0}:f===n.bl.vertical?m>0?{needsFlipping:!0}:null:i!==Zi.unknown&&function(x,w){return x===0||Math.abs(w/x)>Kt}(s,m)?i===Zi.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function ur(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e,ge,Oe){const Ge=i/24,He=f.lineOffsetX*Ge,Qe=f.lineOffsetY*Ge,{lineStartIndex:nt,glyphStartIndex:tt,numGlyphs:at,segment:wt,writingMode:Ot,flipState:Ct}=f,St=nt+f.lineLength,si=di=>{if(j){const[qt,wi,hi]=di.up,Ti=W.length;n.bn(j,Ti+0,qt,wi,hi),n.bn(j,Ti+1,qt,wi,hi),n.bn(j,Ti+2,qt,wi,hi),n.bn(j,Ti+3,qt,wi,hi)}const[Si,Gi,Ki]=di.point;n.bo(W,Si,Gi,Ki,di.angle)};if(at>1){const di=_r(Ge,k,He,Qe,s,Y,J,f,U,w,oe,ue,!1,_e,ge,Oe);if(!di)return{notEnoughRoom:!0};if(m&&!s){let[Si,Gi,Ki]=di.first.point,[qt,wi,hi]=di.last.point;[Si,Gi]=Vi(Si,Gi,Ki,A),[qt,wi]=Vi(qt,wi,hi,A);const Ti=Rr(Ot,Ct,(qt-Si)*pe,wi-Gi);if(f.flipState=Ti&&Ti.needsFlipping?Zi.flipRequired:Zi.flipNotRequired,Ti)return Ti}si(di.first);for(let Si=tt+1;Si<tt+at-1;Si++){const Gi=wr(Ge*k.getoffsetX(Si),He,Qe,s,Y,J,wt,nt,St,U,w,oe,ue,!1,!1,_e,ge,Oe);if(!Gi)return W.length-=4*(Si-tt),{notEnoughRoom:!0};si(Gi)}si(di.last)}else{if(m&&!s){const Si=Vi(J.x,J.y,0,x),Gi=nt+wt+1,Ki=new n.P(U.getx(Gi),U.gety(Gi)),qt=Vi(Ki.x,Ki.y,0,x),wi=qt[3]>0?qt:ws(J,Ki,Si,1,x,void 0,_e,ge.canonical),hi=Rr(Ot,Ct,(wi[0]-Si[0])*pe,wi[1]-Si[1]);if(f.flipState=hi&&hi.needsFlipping?Zi.flipRequired:Zi.flipNotRequired,hi)return hi}const di=wr(Ge*k.getoffsetX(tt),He,Qe,s,Y,J,wt,nt,St,U,w,oe,ue,!1,!1,_e,ge,Oe);if(!di)return{notEnoughRoom:!0};si(di)}return{}}function wn(f,i,s,m,x){const{x:w,y:A,z:k}=m.projectTilePoint(f.x,f.y,i);if(!x)return Vi(w,A,k,s);const[U,W,j]=x(f);return Vi(w+U,A+W,k+j,s)}function ws(f,i,s,m,x,w,A,k){const U=wn(f.sub(i)._unit()._add(f),k,x,A,w);return n.a6.vec3.sub(U,s,U),n.a6.vec3.normalize(U,U),n.a6.vec3.scaleAndAdd(U,s,U,m)}function wr(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e,ge){const Oe=m?f-i:f+i;let Ge=Oe>0?1:-1,He=0;m&&(Ge*=-1,He=Math.PI),Ge<0&&(He+=Math.PI);let Qe=k+A+(Ge>0?0:1)|0,nt=x,tt=x,at=0,wt=0;const Ot=Math.abs(Oe),Ct=[],St=[];let si=w,di=si;const Si=()=>ws(di,si,tt,Ot-at+1,j,J,ue,_e.canonical);for(;at+wt<=Ot;){if(Qe+=Ge,Qe<k||Qe>=U)return null;if(tt=nt,di=si,Ct.push(tt),oe&&St.push(di),si=new n.P(W.getx(Qe),W.gety(Qe)),nt=Y[Qe],!nt){const Xi=wn(si,_e.canonical,j,ue,J);nt=Xi[3]>0?Y[Qe]=Xi:Si()}at+=wt,wt=n.a6.vec3.distance(tt,nt)}pe&&J&&(Y[Qe]&&(nt=Si(),wt=n.a6.vec3.distance(tt,nt)),Y[Qe]=nt);const Gi=(Ot-at)/wt,Ki=si.sub(di)._mult(Gi)._add(di),qt=n.a6.vec3.sub([],nt,tt),wi=n.a6.vec3.scaleAndAdd([],tt,qt,Gi);let hi=[0,0,1],Ti=qt[0],Ci=qt[1];if(ge&&(hi=ue.upVector(_e.canonical,Ki.x,Ki.y),hi[0]!==0||hi[1]!==0||hi[2]!==1)){const Xi=[hi[2],0,-hi[0]],zn=n.a6.vec3.cross([],hi,Xi);n.a6.vec3.normalize(Xi,Xi),n.a6.vec3.normalize(zn,zn),Ti=n.a6.vec3.dot(qt,Xi),Ci=n.a6.vec3.dot(qt,zn)}if(s){const Xi=n.a6.vec3.cross([],hi,qt);n.a6.vec3.normalize(Xi,Xi),n.a6.vec3.scaleAndAdd(wi,wi,Xi,s*Ge)}const gi=He+Math.atan2(Ci,Ti);return Ct.push(wi),oe&&St.push(Ki),{point:wi,angle:gi,path:Ct,tilePath:St,up:hi}}function Vs(f,i){const s=i.length,m=s+4*f;i.resize(m),i.float32.fill(-1/0,4*s,4*m)}function Or(f,i,s){const m=i[0],x=i[1];return f[0]=s[0]*m+s[4]*x+s[12],f[1]=s[1]*m+s[5]*x+s[13],f[3]=s[3]*m+s[7]*x+s[15],f}const so=100;class io{constructor(i,s,m=new Dn(i.width+200,i.height+200,25),x=new Dn(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+so,this.screenBottomBoundary=i.height+so,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=s}placeCollisionBox(i,s,m,x,w,A,k,U){let W=m.projectedAnchorX,j=m.projectedAnchorY,Y=m.projectedAnchorZ;const J=m.elevation,oe=m.tileID,pe=i.getProjection();if(J&&oe){const[nt,tt,at]=pe.upVector(oe.canonical,m.tileAnchorX,m.tileAnchorY),wt=pe.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;W+=nt*J*wt,j+=tt*J*wt,Y+=at*J*wt}const ue=this.projectAndGetPerspectiveRatio(k,W,j,Y,m.tileID,pe.name==="globe"||!!J||this.transform.pitch>0,pe),_e=A*ue.perspectiveRatio,ge=(m.x1*s+x.x-m.padding)*_e+ue.point.x,Oe=(m.y1*s+x.y-m.padding)*_e+ue.point.y,Ge=(m.x2*s+x.x+m.padding)*_e+ue.point.x,He=(m.y2*s+x.y+m.padding)*_e+ue.point.y,Qe=ue.perspectiveRatio<=.55||ue.occluded;return!this.isInsideGrid(ge,Oe,Ge,He)||!w&&this.grid.hitTest(ge,Oe,Ge,He,U)||Qe?{box:[],offscreen:!1,occluded:ue.occluded}:{box:[ge,Oe,Ge,He],offscreen:this.isOffscreen(ge,Oe,Ge,He),occluded:!1}}placeCollisionCircles(i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue){const _e=[],ge=this.transform.elevation,Oe=i.getProjection(),Ge=ge?ge.getAtTileOffsetFunc(ue,this.transform.center.lat,this.transform.worldSize,Oe):null,He=new n.P(m.tileAnchorX,m.tileAnchorY);let{x:Qe,y:nt,z:tt}=Oe.projectTilePoint(He.x,He.y,ue.canonical);if(Ge){const[Ki,qt,wi]=Ge(He);Qe+=Ki,nt+=qt,tt+=wi}const at=Oe.name==="globe",wt=this.projectAndGetPerspectiveRatio(k,Qe,nt,tt,ue,at||!!ge||this.transform.pitch>0,Oe),{perspectiveRatio:Ot}=wt,Ct=(Y?A/Ot:A*Ot)/n.br,St=Vi(Qe,nt,tt,U),si=wt.signedDistanceFromCamera>0?_r(Ct,w,m.lineOffsetX*Ct,m.lineOffsetY*Ct,!1,St,He,m,x,U,{},ge&&!Y?Ge:null,Y&&!!ge,Oe,ue,Y):null;let di=!1,Si=!1,Gi=!0;if(si&&!wt.occluded){const Ki=.5*oe*Ot+pe,qt=new n.P(-100,-100),wi=new n.P(this.screenRightBoundary,this.screenBottomBoundary),hi=new hn,{first:Ti,last:Ci}=si,gi=Ti.path.length;let Xi=[];for(let An=gi-1;An>=1;An--)Xi.push(Ti.path[An]);for(let An=1;An<Ci.path.length;An++)Xi.push(Ci.path[An]);const zn=2.5*Ki;W&&(Xi=Xi.map(([An,kn,dn],tr)=>(Ge&&!at&&(dn=Ge(tr<gi-1?Ti.tilePath[gi-1-tr]:Ci.tilePath[tr-gi+2])[2]),Vi(An,kn,dn,W))),Xi.some(An=>An[3]<=0)&&(Xi=[]));let $n=[];if(Xi.length>0){let An=1/0,kn=-1/0,dn=1/0,tr=-1/0;for(const dr of Xi)An=Math.min(An,dr[0]),dn=Math.min(dn,dr[1]),kn=Math.max(kn,dr[0]),tr=Math.max(tr,dr[1]);kn>=qt.x&&An<=wi.x&&tr>=qt.y&&dn<=wi.y&&($n=[Xi.map(dr=>new n.P(dr[0],dr[1]))],(An<qt.x||kn>wi.x||dn<qt.y||tr>wi.y)&&($n=n.bp($n,qt.x,qt.y,wi.x,wi.y)))}for(const An of $n){hi.reset(An,.25*Ki);let kn=0;kn=hi.length<=.5*Ki?1:Math.ceil(hi.paddedLength/zn)+1;for(let dn=0;dn<kn;dn++){const tr=dn/Math.max(kn-1,1),dr=hi.lerp(tr),Nr=dr.x+so,as=dr.y+so;_e.push(Nr,as,Ki,0);const Ur=Nr-Ki,vs=as-Ki,Xr=Nr+Ki,Ss=as+Ki;if(Gi=Gi&&this.isOffscreen(Ur,vs,Xr,Ss),Si=Si||this.isInsideGrid(Ur,vs,Xr,Ss),!s&&this.grid.hitTestCircle(Nr,as,Ki,J)&&(di=!0,!j))return{circles:[],offscreen:!1,collisionDetected:di,occluded:!1}}}}return{circles:!j&&di||!Si?[]:_e,offscreen:Gi,collisionDetected:di,occluded:wt.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let m=1/0,x=1/0,w=-1/0,A=-1/0;for(const j of i){const Y=new n.P(j.x+so,j.y+so);m=Math.min(m,Y.x),x=Math.min(x,Y.y),w=Math.max(w,Y.x),A=Math.max(A,Y.y),s.push(Y)}const k=this.grid.query(m,x,w,A).concat(this.ignoredGrid.query(m,x,w,A)),U={},W={};for(const j of k){const Y=j.key;if(U[Y.bucketInstanceId]===void 0&&(U[Y.bucketInstanceId]={}),U[Y.bucketInstanceId][Y.featureIndex])continue;const J=[new n.P(j.x1,j.y1),new n.P(j.x2,j.y1),new n.P(j.x2,j.y2),new n.P(j.x1,j.y2)];n.bq(s,J)&&(U[Y.bucketInstanceId][Y.featureIndex]=!0,W[Y.bucketInstanceId]===void 0&&(W[Y.bucketInstanceId]=[]),W[Y.bucketInstanceId].push(Y.featureIndex))}return W}insertCollisionBox(i,s,m,x,w){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,s,m,x,w){const A=s?this.ignoredGrid:this.grid,k={bucketInstanceId:m,featureIndex:x,collisionGroupID:w};for(let U=0;U<i.length;U+=4)A.insertCircle(k,i[U],i[U+1],i[U+2])}projectAndGetPerspectiveRatio(i,s,m,x,w,A,k){const U=[s,m,x,1];let W=!1;x||this.transform.pitch>0?(n.a6.vec4.transformMat4(U,U,i),this.fogState&&w&&k.name!=="globe"&&(W=function(J,oe,pe,ue,_e,ge){const Oe=ge.calculateFogTileMatrix(_e),Ge=[oe,pe,ue];return n.a6.vec3.transformMat4(Ge,Ge,Oe),tn(J,n.a6.vec3.length(Ge),ge.pitch,ge._fov)}(this.fogState,s,m,x,w.toUnwrapped(),this.transform)>.9)):Or(U,U,i);const j=U[3];return{point:new n.P((U[0]/j+1)/2*this.transform.width+so,(-U[1]/j+1)/2*this.transform.height+so),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/j*.5,1.5),signedDistanceFromCamera:j,occluded:A&&U[2]>j||W}}isOffscreen(i,s,m,x){return m<so||i>=this.screenRightBoundary||x<so||s>this.screenBottomBoundary}isInsideGrid(i,s,m,x){return m>=0&&i<this.gridRightBoundary&&x>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const i=n.a6.mat4.identity([]);return n.a6.mat4.translate(i,i,[-100,-100,0]),i}}function Ys(f,i,s){const m=i.createTileMatrix(f,f.worldSize,s.toUnwrapped());return n.a6.mat4.multiply(new Float32Array(16),f.projMatrix,m)}function Ga(f,i,s){if(i.projection.name===s.projection.name)return f.projMatrix;const m=s.clone();return m.setProjection(i.projection),Ys(m,i.getProjection(),f)}function So(f,i,s){return i.name===s.projection.name?f.projMatrix:Ys(s,i,f)}class hs{constructor(i,s,m,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?s:-s))):x&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Is{constructor(i,s,m,x,w,A=!1){this.text=new hs(i?i.text:null,s,m,w),this.icon=new hs(i?i.icon:null,s,x,w),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ea{constructor(i,s,m,x=!1){this.text=i,this.icon=s,this.skipFade=m,this.clipped=x}}class Un{constructor(){this.invProjMatrix=n.a6.mat4.create(),this.viewportMatrix=n.a6.mat4.create(),this.circles=[]}}class vl{constructor(i,s,m,x,w){this.bucketInstanceId=i,this.featureIndex=s,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=w}}class ya{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const s=++this.maxGroupID;this.collisionGroups[i]={ID:s,predicate:m=>m.collisionGroupID===s}}return this.collisionGroups[i]}}function nc(f,i,s,m,x){const{horizontalAlign:w,verticalAlign:A}=n.by(f),k=-(w-.5)*i,U=-(A-.5)*s,W=n.bx(f,m);return new n.P(k+W[0]*x,U+W[1]*x)}function va(f,i,s,m,x){const w=new n.P(f,i);return s&&w._rotate(m?x:-x),w}class xl{constructor(i,s,m,x,w,A){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new io(this.transform,w),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new ya(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,s,m,x,w=1){const A=m.getBucket(s),k=m.latestFeatureIndex;if(!A||!k||s.fqid!==A.layerIds[0])return;const U=A.layers[0].layout,W=A.layers[0].paint,j=m.collisionBoxArray,Y=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),J=m.tileSize/n.ab,oe=m.tileID.toUnwrapped();this.transform.setProjection(A.projection);const pe=(ue=m.tileID,_e=A.getProjection(),ge=this.transform,_e.name===this.projection?ge.calculateProjMatrix(ue.toUnwrapped()):Ys(ge,_e,ue));var ue,_e,ge;const Oe=U.get("text-pitch-alignment")==="map",Ge=U.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const He=s.dynamicFilter(),Qe=s.dynamicFilterNeedsFeature(),nt=this.transform.calculatePixelsToTileUnitsMatrix(m),tt=Ei(pe,m.tileID.canonical,Oe,Ge,this.transform,A.getProjection(),nt);let at=null;if(Oe){const Si=Ln(pe,m.tileID.canonical,Oe,Ge,this.transform,A.getProjection(),nt);at=n.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Si)}let wt=null;He&&m.latestFeatureIndex&&(wt={unwrappedTileID:oe,dynamicFilter:He,dynamicFilterNeedsFeature:Qe}),this.retainedQueryData[A.bucketInstanceId]=new vl(A.bucketInstanceId,k,A.sourceLayerIndex,A.index,m.tileID);const Ot=A.layers[0].layout.get("text-size-scale-range"),Ct=n.ap(w,Ot[0],Ot[1]),St=A.layers[0].layout.get("icon-size-scale-range"),si=n.ap(w,St[0],St[1]),di={bucket:A,layout:U,paint:W,posMatrix:pe,textLabelPlaneMatrix:tt,labelToScreenMatrix:at,clippingData:wt,scale:Y,textPixelRatio:J,holdingForFade:m.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:n.bk(A.textSizeData,this.transform.zoom,Ct),partiallyEvaluatedIconSize:n.bk(A.iconSizeData,this.transform.zoom,si),collisionGroup:this.collisionGroups.get(A.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(x)for(const Si of A.sortKeyRanges){const{sortKey:Gi,symbolInstanceStart:Ki,symbolInstanceEnd:qt}=Si;i.push({sortKey:Gi,symbolInstanceStart:Ki,symbolInstanceEnd:qt,parameters:di})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:di})}attemptAnchorPlacement(i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e,ge,Oe){const{textOffset0:Ge,textOffset1:He,crossTileID:Qe}=J,nt=[Ge,He],tt=nc(i,m,x,nt,w),at=this.collisionIndex.placeCollisionBox(pe,w,s,va(tt.x,tt.y,A,k,this.transform.angle),Y,U,W,j.predicate);if(_e){const wt=pe.getSymbolInstanceIconSize(Oe,this.transform.zoom,J.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(pe,wt,_e,va(tt.x,tt.y,A,k,this.transform.angle),Y,U,W,j.predicate).box.length===0)return}if(at.box.length>0){let wt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Qe]&&this.prevPlacement.placements[Qe]&&this.prevPlacement.placements[Qe].text&&(wt=this.prevPlacement.variableOffsets[Qe].anchor),this.variableOffsets[Qe]={textOffset:nt,width:m,height:x,anchor:i,textScale:w,prevAnchor:wt},this.markUsedJustification(pe,i,J,ue),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,ue,J),this.placedOrientations[Qe]=ue),{shift:tt,placedGlyphBoxes:at}}}placeLayerBucketPart(i,s,m,x,w=1){const{bucket:A,layout:k,paint:U,posMatrix:W,textLabelPlaneMatrix:j,labelToScreenMatrix:Y,clippingData:J,textPixelRatio:oe,holdingForFade:pe,collisionBoxArray:ue,partiallyEvaluatedTextSize:_e,partiallyEvaluatedIconSize:ge,collisionGroup:Oe,latestFeatureIndex:Ge}=i.parameters,He=k.get("text-optional"),Qe=k.get("icon-optional"),nt=k.get("text-allow-overlap"),tt=k.get("icon-allow-overlap"),at=k.get("text-rotation-alignment")==="map",wt=k.get("text-pitch-alignment")==="map",Ot=k.get("symbol-z-elevate"),Ct=U.get("symbol-z-offset"),St=k.get("symbol-elevation-reference")==="sea",si=k.get("text-size-scale-range"),di=k.get("icon-size-scale-range"),Si=n.ap(w,si[0],si[1]),Gi=n.ap(w,di[0],di[1]);this.transform.setProjection(A.projection);let Ki=nt&&(tt||!A.hasIconData()||Qe),qt=tt&&(nt||!A.hasTextData()||He);const wi=!Ct.isConstant();!A.collisionArrays&&ue&&A.deserializeCollisionBoxes(ue),m&&x&&A.updateCollisionDebugBuffers(this.transform.zoom,ue,Si,Gi);const hi=(Ti,Ci,gi)=>{const{crossTileID:Xi,numVerticalGlyphVertices:zn}=Ti;let $n=null;if(J&&J.dynamicFilterNeedsFeature||wi){const Wr=this.retainedQueryData[A.bucketInstanceId];$n=Ge.loadFeature({featureIndex:Ti.featureIndex,bucketIndex:Wr.bucketIndex,sourceLayerIndex:Wr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(J&&!(0,J.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},$n,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new n.P(Ti.tileAnchorX,Ti.tileAnchorY),this.transform.calculateDistanceTileData(J.unwrappedTileID)))return this.placements[Xi]=new ea(!1,!1,!1,!0),void s.add(Xi);const An=Ct.evaluate($n,{});if(s.has(Xi))return;if(pe)return void(this.placements[Xi]=new ea(!1,!1,!1));let kn=!1,dn=!1,tr=!0,dr=!1,Nr=!1,as=null,Ur={box:null,offscreen:null,occluded:null},vs={box:null,offscreen:null,occluded:null},Xr=null,Ss=null,br=null,ds=0,ps=0,Er=0;gi.textFeatureIndex?ds=gi.textFeatureIndex:Ti.useRuntimeCollisionCircles&&(ds=Ti.featureIndex),gi.verticalTextFeatureIndex&&(ps=gi.verticalTextFeatureIndex);const ts=Wr=>{Wr.tileID=this.retainedQueryData[A.bucketInstanceId].tileID;const Hr=this.transform.elevation;Wr.elevation=St?An:An+(Hr?Hr.getAtTileOffset(Wr.tileID,Wr.tileAnchorX,Wr.tileAnchorY):0),Wr.elevation+=Ti.zOffset},Gs=gi.textBox;if(Gs){ts(Gs);const Wr=Yr=>{let is=n.bl.horizontal;if(A.allowVerticalPlacement&&!Yr&&this.prevPlacement){const Es=this.prevPlacement.placedOrientations[Xi];Es&&(this.placedOrientations[Xi]=Es,is=Es,this.markUsedOrientation(A,is,Ti))}return is},Hr=(Yr,is)=>{if(A.allowVerticalPlacement&&zn>0&&gi.verticalTextBox){for(const Es of A.writingModes)if(Es===n.bl.vertical?(Ur=is(),vs=Ur):Ur=Yr(),Ur&&Ur.box&&Ur.box.length)break}else Ur=Yr()};if(k.get("text-variable-anchor")){let Yr=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Xi]){const Os=this.prevPlacement.variableOffsets[Xi];Yr.indexOf(Os.anchor)>0&&(Yr=Yr.filter(Do=>Do!==Os.anchor),Yr.unshift(Os.anchor))}const is=(Os,Do,Il)=>{const Ma=A.getSymbolInstanceTextSize(_e,Ti,this.transform.zoom,Ci),ha=(Os.x2-Os.x1)*Ma+2*Os.padding,Ka=(Os.y2-Os.y1)*Ma+2*Os.padding,Ja=Ti.hasIconTextFit&&!tt?Do:null;Ja&&ts(Ja);let Sa={box:[],offscreen:!1,occluded:!1};const Qa=nt?2*Yr.length:Yr.length;for(let ka=0;ka<Qa;++ka){const ls=this.attemptAnchorPlacement(Yr[ka%Yr.length],Os,ha,Ka,Ma,at,wt,oe,W,Oe,ka>=Yr.length,Ti,Ci,A,Il,Ja,_e,ge);if(ls&&(Sa=ls.placedGlyphBoxes,Sa&&Sa.box&&Sa.box.length)){kn=!0,as=ls.shift;break}}return Sa};Hr(()=>is(Gs,gi.iconBox,n.bl.horizontal),()=>{const Os=gi.verticalTextBox;return Os&&ts(Os),A.allowVerticalPlacement&&!(Ur&&Ur.box&&Ur.box.length)&&zn>0&&Os?is(Os,gi.verticalIconBox,n.bl.vertical):{box:null,offscreen:null,occluded:null}}),Ur&&(kn=Ur.box,tr=Ur.offscreen,dr=Ur.occluded);const Es=Wr(!(!Ur||!Ur.box));if(!kn&&this.prevPlacement){const Os=this.prevPlacement.variableOffsets[Xi];Os&&(this.variableOffsets[Xi]=Os,this.markUsedJustification(A,Os.anchor,Ti,Es))}}else{const Yr=(is,Es)=>{const Os=A.getSymbolInstanceTextSize(_e,Ti,this.transform.zoom,Ci,w),Do=this.collisionIndex.placeCollisionBox(A,Os,is,new n.P(0,0),nt,oe,W,Oe.predicate);return Do&&Do.box&&Do.box.length&&(this.markUsedOrientation(A,Es,Ti),this.placedOrientations[Xi]=Es),Do};Hr(()=>Yr(Gs,n.bl.horizontal),()=>{const is=gi.verticalTextBox;return A.allowVerticalPlacement&&zn>0&&is?(ts(is),Yr(is,n.bl.vertical)):{box:null,offscreen:null,occluded:null}}),Wr(!!(Ur&&Ur.box&&Ur.box.length))}}if(Xr=Ur,kn=Xr&&Xr.box&&Xr.box.length>0,tr=Xr&&Xr.offscreen,dr=Xr&&Xr.occluded,Ti.useRuntimeCollisionCircles){const Wr=A.text.placedSymbolArray.get(Ti.centerJustifiedTextSymbolIndex>=0?Ti.centerJustifiedTextSymbolIndex:Ti.verticalPlacedTextSymbolIndex),Hr=n.bm(A.textSizeData,_e,Wr),Yr=k.get("text-padding");Ss=this.collisionIndex.placeCollisionCircles(A,nt,Wr,A.lineVertexArray,A.glyphOffsetArray,Hr,W,j,Y,m,wt,Oe.predicate,Ti.collisionCircleDiameter*Hr/n.br,Yr,this.retainedQueryData[A.bucketInstanceId].tileID),kn=nt||Ss.circles.length>0&&!Ss.collisionDetected,tr=tr&&Ss.offscreen,dr=Ss.occluded}if(gi.iconFeatureIndex&&(Er=gi.iconFeatureIndex),gi.iconBox){const Wr=Hr=>{ts(Hr);const Yr=Ti.hasIconTextFit&&as?va(as.x,as.y,at,wt,this.transform.angle):new n.P(0,0),is=A.getSymbolInstanceIconSize(ge,this.transform.zoom,Ti.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,is,Hr,Yr,tt,oe,W,Oe.predicate)};vs&&vs.box&&vs.box.length&&gi.verticalIconBox?(br=Wr(gi.verticalIconBox),dn=br.box.length>0):(br=Wr(gi.iconBox),dn=br.box.length>0),tr=tr&&br.offscreen,Nr=br.occluded}const ra=He||Ti.numHorizontalGlyphVertices===0&&zn===0,Ya=Qe||Ti.numIconVertices===0;if(ra||Ya?Ya?ra||(dn=dn&&kn):kn=dn&&kn:dn=kn=dn&&kn,kn&&Xr&&Xr.box&&this.collisionIndex.insertCollisionBox(Xr.box,k.get("text-ignore-placement"),A.bucketInstanceId,vs&&vs.box&&ps?ps:ds,Oe.ID),dn&&br&&this.collisionIndex.insertCollisionBox(br.box,k.get("icon-ignore-placement"),A.bucketInstanceId,Er,Oe.ID),Ss&&(kn&&this.collisionIndex.insertCollisionCircles(Ss.circles,k.get("text-ignore-placement"),A.bucketInstanceId,ds,Oe.ID),m)){const Wr=A.bucketInstanceId;let Hr=this.collisionCircleArrays[Wr];Hr===void 0&&(Hr=this.collisionCircleArrays[Wr]=new Un);for(let Yr=0;Yr<Ss.circles.length;Yr+=4)Hr.circles.push(Ss.circles[Yr+0]),Hr.circles.push(Ss.circles[Yr+1]),Hr.circles.push(Ss.circles[Yr+2]),Hr.circles.push(Ss.collisionDetected?1:0)}const Eo=A.projection.name!=="globe";Ki=Ki&&(Eo||!dr),qt=qt&&(Eo||!Nr),this.placements[Xi]=new ea(kn||Ki,dn||qt,tr||A.justReloaded),s.add(Xi)};if(Ot&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,this.retainedQueryData[A.bucketInstanceId].tileID),A.updateZOffset()),A.sortFeaturesByY){const Ti=A.getSortedSymbolIndexes(this.transform.angle);for(let Ci=Ti.length-1;Ci>=0;--Ci){const gi=Ti[Ci];hi(A.symbolInstances.get(gi),gi,A.collisionArrays[gi])}A.hasAnyZOffset&&n.w(`${A.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(A.hasAnyZOffset){const Ti=A.getSortedIndexesByZOffset();for(let Ci=0;Ci<Ti.length;++Ci){const gi=Ti[Ci];hi(A.symbolInstances.get(gi),gi,A.collisionArrays[gi])}}else for(let Ti=i.symbolInstanceStart;Ti<i.symbolInstanceEnd;Ti++)hi(A.symbolInstances.get(Ti),Ti,A.collisionArrays[Ti]);if(m&&A.bucketInstanceId in this.collisionCircleArrays){const Ti=this.collisionCircleArrays[A.bucketInstanceId];n.a6.mat4.invert(Ti.invProjMatrix,W),Ti.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(i,s,m,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:U,crossTileID:W}=m,j=n.bw(s),Y=x===n.bl.vertical?U:j==="left"?w:j==="center"?A:j==="right"?k:-1;w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=Y>=0&&w!==Y?0:W),A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=Y>=0&&A!==Y?0:W),k>=0&&(i.text.placedSymbolArray.get(k).crossTileID=Y>=0&&k!==Y?0:W),U>=0&&(i.text.placedSymbolArray.get(U).crossTileID=Y>=0&&U!==Y?0:W)}markUsedOrientation(i,s,m){const x=s===n.bl.horizontal||s===n.bl.horizontalOnly?s:0,w=s===n.bl.vertical?s:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:U,verticalPlacedTextSymbolIndex:W}=m,j=i.text.placedSymbolArray;A>=0&&(j.get(A).placedOrientation=x),k>=0&&(j.get(k).placedOrientation=x),U>=0&&(j.get(U).placedOrientation=x),W>=0&&(j.get(W).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let m=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const x=s?s.symbolFadeChange(i):1,w=s?s.opacities:{},A=s?s.variableOffsets:{},k=s?s.placedOrientations:{};for(const U in this.placements){const W=this.placements[U],j=w[U];j?(this.opacities[U]=new Is(j,x,W.text,W.icon,null,W.clipped),m=m||W.text!==j.text.placed||W.icon!==j.icon.placed):(this.opacities[U]=new Is(null,x,W.text,W.icon,W.skipFade,W.clipped),m=m||W.text||W.icon)}for(const U in w){const W=w[U];if(!this.opacities[U]){const j=new Is(W,x,!1,!1);j.isHidden()||(this.opacities[U]=j,m=m||W.text.placed||W.icon.placed)}}for(const U in A)this.variableOffsets[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.variableOffsets[U]=A[U]);for(const U in k)this.placedOrientations[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.placedOrientations[U]=k[U]);m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:i)}updateLayerOpacities(i,s,m,x){const w=new Set;for(const A of s){const k=A.getBucket(i);k&&A.latestFeatureIndex&&i.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,w,A,A.collisionBoxArray,m,x,A.tileID,i.scope),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,A.tileID),k.updateZOffset()))}}updateBucketOpacities(i,s,m,x,w,A,k,U){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const W=i.layers[0].layout,j=i.layers[0].paint,Y=!!i.layers[0].dynamicFilter(),J=new Is(null,0,!1,!1,!0),oe=W.get("text-allow-overlap"),pe=W.get("icon-allow-overlap"),ue=W.get("text-variable-anchor"),_e=W.get("text-rotation-alignment")==="map",ge=W.get("text-pitch-alignment")==="map",Oe=j.get("symbol-z-offset"),Ge=W.get("symbol-elevation-reference")==="sea",He=!Oe.isConstant(),Qe=new Is(null,0,oe&&(pe||!i.hasIconData()||W.get("icon-optional")),pe&&(oe||!i.hasTextData()||W.get("text-optional")),!0);!i.collisionArrays&&x&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(x);const nt=(at,wt,Ot)=>{for(let Ct=0;Ct<wt/4;Ct++)at.opacityVertexArray.emplaceBack(Ot)};let tt=0;A&&i.updateReplacement(k,A);for(let at=0;at<i.symbolInstances.length;at++){const wt=i.symbolInstances.get(at),{numHorizontalGlyphVertices:Ot,numVerticalGlyphVertices:Ct,crossTileID:St,numIconVertices:si,tileAnchorX:di,tileAnchorY:Si}=wt;let Gi=null;const Ki=this.retainedQueryData[i.bucketInstanceId];He&&wt&&Ki&&(Gi=m.latestFeatureIndex.loadFeature({featureIndex:wt.featureIndex,bucketIndex:Ki.bucketIndex,sourceLayerIndex:Ki.sourceLayerIndex,layoutVertexArrayOffset:0}));const qt=Oe.evaluate(Gi,{}),wi=s.has(St);let hi=this.opacities[St];wi?hi=J:hi||(hi=Qe,this.opacities[St]=hi),s.add(St);const Ti=Ot>0||Ct>0,Ci=si>0,gi=this.placedOrientations[St],Xi=gi===n.bl.vertical,zn=gi===n.bl.horizontal||gi===n.bl.horizontalOnly;!Ti&&!Ci||hi.isHidden()||tt++;let $n=!1;if((Ti||Ci)&&A)for(const An of i.activeReplacements){if(n.bs(An,w,n.bt.Symbol,U)||An.min.x>di||di>An.max.x||An.min.y>Si||Si>An.max.y)continue;const kn=n.bu(di,Si,k.canonical,An.footprintTileId.canonical);if($n=n.bv(kn,An.footprint),$n)break}if(Ti){const An=$n?Ic:wl(hi.text);nt(i.text,Ot,Xi?Ic:An),nt(i.text,Ct,zn?Ic:An);const kn=hi.text.isHidden(),{leftJustifiedTextSymbolIndex:dn,centerJustifiedTextSymbolIndex:tr,rightJustifiedTextSymbolIndex:dr,verticalPlacedTextSymbolIndex:Nr}=wt,as=i.text.placedSymbolArray,Ur=kn||Xi?1:0;dn>=0&&(as.get(dn).hidden=Ur),tr>=0&&(as.get(tr).hidden=Ur),dr>=0&&(as.get(dr).hidden=Ur),Nr>=0&&(as.get(Nr).hidden=kn||zn?1:0);const vs=this.variableOffsets[St];vs&&this.markUsedJustification(i,vs.anchor,wt,gi);const Xr=this.placedOrientations[St];Xr&&(this.markUsedJustification(i,"left",wt,Xr),this.markUsedOrientation(i,Xr,wt))}if(Ci){const An=$n?Ic:wl(hi.icon),{placedIconSymbolIndex:kn,verticalPlacedIconSymbolIndex:dn}=wt,tr=i.icon.placedSymbolArray,dr=hi.icon.isHidden()?1:0;kn>=0&&(nt(i.icon,si,Xi?Ic:An),tr.get(kn).hidden=dr),dn>=0&&(nt(i.icon,wt.numVerticalIconVertices,zn?Ic:An),tr.get(dn).hidden=dr)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const An=i.collisionArrays[at];if(An){let kn=new n.P(0,0),dn=!0;if(An.textBox||An.verticalTextBox){if(ue){const dr=this.variableOffsets[St];dr?(kn=nc(dr.anchor,dr.width,dr.height,dr.textOffset,dr.textScale),_e&&kn._rotate(ge?this.transform.angle:-this.transform.angle)):dn=!1}Y&&(dn=!hi.clipped),An.textBox&&xa(i.textCollisionBox.collisionVertexArray,hi.text.placed,!dn||Xi,qt,Ge,kn.x,kn.y),An.verticalTextBox&&xa(i.textCollisionBox.collisionVertexArray,hi.text.placed,!dn||zn,qt,Ge,kn.x,kn.y)}const tr=dn&&!!(!zn&&An.verticalIconBox);An.iconBox&&xa(i.iconCollisionBox.collisionVertexArray,hi.icon.placed,tr,qt,Ge,wt.hasIconTextFit?kn.x:0,wt.hasIconTextFit?kn.y:0),An.verticalIconBox&&xa(i.iconCollisionBox.collisionVertexArray,hi.icon.placed,!tr,qt,Ge,wt.hasIconTextFit?kn.x:0,wt.hasIconTextFit?kn.y:0)}}}if(i.fullyClipped=tt===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const at=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=at.invProjMatrix,i.placementViewportMatrix=at.viewportMatrix,i.collisionCircleArray=at.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,s){const m=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function xa(f,i,s,m,x,w,A){f.emplaceBack(i?1:0,s?1:0,w||0,A||0,m,x?1:0),f.emplaceBack(i?1:0,s?1:0,w||0,A||0,m,x?1:0),f.emplaceBack(i?1:0,s?1:0,w||0,A||0,m,x?1:0),f.emplaceBack(i?1:0,s?1:0,w||0,A||0,m,x?1:0)}const bl=Math.pow(2,25),Qu=Math.pow(2,24),Ca=Math.pow(2,17),Zo=Math.pow(2,16),Xo=Math.pow(2,9),Pr=Math.pow(2,8),hf=Math.pow(2,1);function wl(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const i=f.placed?1:0,s=Math.floor(127*f.opacity);return s*bl+i*Qu+s*Ca+i*Zo+s*Xo+i*Pr+s*hf+i}const Ic=0;class Rc{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,s,m,x,w,A){const k=this._bucketParts;for(;this._currentTileIndex<i.length;)if(s.getBucketParts(k,x,i[this._currentTileIndex],this._sortAcrossTiles,A),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort((U,W)=>U.sortKey-W.sortKey));this._currentPartIndex<k.length;){const U=k[this._currentPartIndex];if(s.placeLayerBucketPart(U,this._seenCrossTileIDs,m,U.symbolInstanceStart===0,A),this._currentPartIndex++,w())return!0}return!1}}class nl{constructor(i,s,m,x,w,A,k,U,W){this.placement=new xl(i,w,A,k,U,W),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,s,m,x,w){const A=n.q.now(),k=()=>{const U=n.q.now()-A;return!this._forceFullPlacement&&U>2};for(;this._currentPlacementIndex>=0;){const U=s[i[this._currentPlacementIndex]],W=this.placement.collisionIndex.transform.zoom;if(U.type==="symbol"&&(!U.minzoom||U.minzoom<=W)&&(!U.maxzoom||U.maxzoom>W)){const j=U,Y=j.layout.get("symbol-z-elevate"),J=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,oe=j.layout.get("symbol-z-order"),pe=oe==="viewport-y"||oe==="auto"&&!(oe!=="viewport-y"&&J),ue=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),_e=pe&&ue,ge=this._inProgressLayer=this._inProgressLayer||new Rc(j),Oe=n.av(U.source,U.scope);if(ge.continuePlacement(Y||_e?x[Oe]:m[Oe],this.placement,this._showCollisionBoxes,U,k,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const La=512/n.ab/2;class df{constructor(i,s,m){this.tileID=i,this.bucketInstanceId=m,this.index=new n.bz(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*n.ab,w=i.canonical.y*n.ab;for(let A=0;A<s.length;A++){const{key:k,crossTileID:U,tileAnchorX:W,tileAnchorY:j}=s.get(A),Y=Math.floor((x+W)*La),J=Math.floor((w+j)*La);this.index.add(Y,J),this.keys.push(k),this.crossTileIDs.push(U)}this.index.finish()}findMatches(i,s,m){const x=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),w=La/Math.pow(2,s.canonical.z-this.tileID.canonical.z),A=s.canonical.x*n.ab,k=s.canonical.y*n.ab;for(let U=0;U<i.length;U++){const W=i.get(U);if(W.crossTileID)continue;const{key:j,tileAnchorX:Y,tileAnchorY:J}=W,oe=Math.floor((A+Y)*w),pe=Math.floor((k+J)*w),ue=this.index.range(oe-x,pe-x,oe+x,pe+x);for(const _e of ue){const ge=this.crossTileIDs[_e];if(this.keys[_e]===j&&!m.has(ge)){m.add(ge),W.crossTileID=ge;break}}}}}class Pc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const s=Math.round((i-this.lng)/360);if(s!==0)for(const m in this.indexes){const x=this.indexes[m],w={};for(const A in x){const k=x[A];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+s),w[k.tileID.key]=k}this.indexes[m]=w}this.lng=i}addBucket(i,s,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<s.symbolInstances.length;w++)s.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const A=this.indexes[w];if(Number(w)>i.overscaledZ)for(const k in A){const U=A[k];U.tileID.isChildOf(i)&&U.findMatches(s.symbolInstances,i,x)}else{const k=A[i.scaledTo(Number(w)).key];k&&k.findMatches(s.symbolInstances,i,x)}}for(let w=0;w<s.symbolInstances.length;w++){const A=s.symbolInstances.get(w);A.crossTileID||(A.crossTileID=m.generate(),x.add(A.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new df(i,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(i,s){for(const m of s.crossTileIDs)this.usedCrossTileIDs[i].delete(m)}removeStaleBuckets(i){let s=!1;for(const m in this.indexes){const x=this.indexes[m];for(const w in x)i[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[w]),delete x[w],s=!0)}return s}}class mu{constructor(){this.layerIndexes={},this.crossTileIDs=new Pc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,s,m,x){let w=this.layerIndexes[i.fqid];w===void 0&&(w=this.layerIndexes[i.fqid]=new Zd);let A=!1;const k={};x.name!=="globe"&&w.handleWrapJump(m);for(const U of s){const W=U.getBucket(i);W&&i.fqid===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(U.tileID,W,this.crossTileIDs)&&(A=!0),k[W.bucketInstanceId]=!0)}return w.removeStaleBuckets(k)&&(A=!0),A}pruneUnusedLayers(i){const s={};i.forEach(m=>{s[m]=!0});for(const m in this.layerIndexes)s[m]||delete this.layerIndexes[m]}}const ca=771;class Ir{constructor(i,s,m,x){this.blendFunction=i,this.blendColor=s,this.mask=m,this.blendEquation=x}}Ir.Replace=[1,0,1,0],Ir.disabled=new Ir(Ir.Replace,n.bA.transparent,[!1,!1,!1,!1]),Ir.unblended=new Ir(Ir.Replace,n.bA.transparent,[!0,!0,!0,!0]),Ir.alphaBlended=new Ir([1,ca,1,ca],n.bA.transparent,[!0,!0,!0,!0]),Ir.alphaBlendedNonPremultiplied=new Ir([770,ca,770,ca],n.bA.transparent,[!0,!0,!0,!0]),Ir.multiply=new Ir([774,0,774,0],n.bA.transparent,[!0,!0,!0,!0]);class Xn{constructor(i,s,m){this.func=i,this.mask=s,this.range=m}}Xn.ReadOnly=!1,Xn.ReadWrite=!0,Xn.disabled=new Xn(519,Xn.ReadOnly,[0,1]);const eh=7680;class hr{constructor(i,s,m,x,w,A){this.test=i,this.ref=s,this.mask=m,this.fail=x,this.depthFail=w,this.pass=A}}hr.disabled=new hr({func:519,mask:0},0,0,eh,eh,eh);const ed=1029,Dc=2305;class qn{constructor(i,s,m){this.enable=i,this.mode=s,this.frontFace=m}}function th(f,i){const s=n.bD(f,3);n.a6.mat4.fromQuat(f,i),n.bF(f,3,s)}function rl(f,i){const s=n.a6.quat.identity([]);return n.a6.quat.rotateZ(s,s,-i),n.a6.quat.rotateX(s,s,-f),s}function Oc(f,i){const s=[f[0],f[1],0],m=[i[0],i[1],0];if(n.a6.vec3.length(s)>=1e-15){const A=n.a6.vec3.normalize([],s);n.a6.vec3.scale(m,A,n.a6.vec3.dot(m,A)),i[0]=m[0],i[1]=m[1]}const x=n.a6.vec3.cross([],i,f);if(n.a6.vec3.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return rl(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),w)}qn.disabled=new qn(!1,ed,Dc),qn.backCCW=new qn(!0,ed,Dc),qn.backCW=new qn(!0,ed,2304),qn.frontCW=new qn(!0,1028,2304),qn.frontCCW=new qn(!0,1028,Dc);class yo{constructor(i,s){this.position=i,this.orientation=s}get position(){return this._position}set position(i){if(i){const s=i instanceof n.a5?i:new n.a5(i[0],i[1],i[2]);this._renderWorldCopies&&(s.x=n.bB(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(i,s){if(this.orientation=null,!this.position)return;const m=this.position,x=this._elevation?this._elevation.getAtPointOrZero(n.a5.fromLngLat(i)):0,w=n.a5.fromLngLat(i,x),A=[w.x-m.x,w.y-m.y,w.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Oc(A,s)}setPitchBearing(i,s){this.orientation=rl(n.bC(i),n.bC(-s))}}class zc{constructor(i,s){this._transform=n.a6.mat4.identity([]),this.orientation=s,this.position=i}get mercatorPosition(){const i=this.position;return new n.a5(i[0],i[1],i[2])}get position(){const i=n.bD(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var s;i&&n.bF(this._transform,3,[(s=i)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||n.a6.quat.identity([]),i&&th(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,s){this._orientation=rl(i,s),th(this._transform,this._orientation)}forward(){const i=n.bD(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=n.bD(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=n.bD(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,s){const m=new Float64Array(16);return n.a6.mat4.invert(m,this.getWorldToCamera(i,s)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,s,m){const x=this.position;n.a6.vec3.scale(x,x,-i);const w=new Float64Array(16);return n.a6.mat4.fromScaling(w,[m,m,m]),n.a6.mat4.translate(w,w,x),w[10]*=s,w}getWorldToCamera(i,s){const m=new Float64Array(16),x=new Float64Array(4),w=this.position;return n.a6.quat.conjugate(x,this._orientation),n.a6.vec3.scale(w,w,-i),n.a6.mat4.fromQuat(m,x),n.a6.mat4.translate(m,m,w),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=s,m[9]*=s,m[10]*=s,m[11]*=s,m}getCameraToClipPerspective(i,s,m,x){const w=new Float64Array(16);return n.a6.mat4.perspective(w,i,s,m,x),w}getCameraToClipOrthographic(i,s,m,x,w,A){const k=new Float64Array(16);return n.a6.mat4.ortho(k,i,s,m,x,w,A),k}getDistanceToElevation(i,s=!1){const m=i===0?0:n.bE(i,s?n.aN(this.position[1]):this.position[1]),x=this.forward();return(m-this.position[2])/x[2]}clone(){return new zc([...this.position],[...this.orientation])}}const co={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class kc{constructor(i=0,s=0,m=0,x=0){if(isNaN(i)||i<0||isNaN(s)||s<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=s,this.left=m,this.right=x}interpolate(i,s,m){return s.top!=null&&i.top!=null&&(this.top=n.aa(i.top,s.top,m)),s.bottom!=null&&i.bottom!=null&&(this.bottom=n.aa(i.bottom,s.bottom,m)),s.left!=null&&i.left!=null&&(this.left=n.aa(i.left,s.left,m)),s.right!=null&&i.right!=null&&(this.right=n.aa(i.right,s.right,m)),this}getCenter(i,s){const m=n.ap((this.left+i-this.right)/2,0,i),x=n.ap((this.top+s-this.bottom)/2,0,s);return new n.P(m,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new kc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const vo=(f,i,s)=>(1-s)*f+s*i,Tl=f=>f*f*f*f*f;class gu{constructor(i,s,m,x,w,A,k){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=i||0,this._maxZoom=s||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(A),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new n.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new kc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new zc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new gu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,s=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(i||m)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return n.ar(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=n.bM(this.projectionOptions);const m=this.getProjection(),x=!n.bi(s,m);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bM({name:"mercator"});const s=i!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bB(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const s=-i*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=n.a6.mat2.create(),n.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const s=n.ap(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=n.bC(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const s=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,w=0;for(let A=0;A<s.length;A++){const k=new n.P(s[A][0]*this.width,m+s[A][1]*(this.height-m)),U=i.pointCoordinate(k);if(!U)continue;const W=1/Math.hypot(U[0]-this._camera.position[0],U[1]-this._camera.position[1]);x+=U[3]*W,w+=W}return w===0?NaN:x/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*s,x=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),A=Math.max(x-m,w);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[s.x,s.y,s.z]:[i.x,i.y,i.z];const x=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,m));return n.ap(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let s=!1;if(i.orientation&&!n.a6.quat.exactEquals(i.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];n.a6.vec3.exactEquals(m,this._camera.position)||(this._setCameraPosition(m),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,s=new yo;return s.position=new n.a5(i[0],i[1],i[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(i){if(!n.a6.quat.length(i))return!1;n.a6.quat.normalize(i,i);const s=n.a6.vec3.transformQuat([],[0,0,-1],i),m=n.a6.vec3.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const x=Oc(s,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const s=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=n.ap(i[2],x/m,x/s),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,s,m){this._unmodified=!1,this._edgeInsets.interpolate(i,s,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const s=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(i){const s=[new n.bN(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new n.P(0,0)),x=this.pointCoordinate(new n.P(this.width,0)),w=this.pointCoordinate(new n.P(this.width,this.height)),A=this.pointCoordinate(new n.P(0,this.height)),k=Math.floor(Math.min(m.x,x.x,w.x,A.x)),U=Math.floor(Math.max(m.x,x.x,w.x,A.x)),W=1;for(let j=k-W;j<=U+W;j++)j!==0&&s.push(new n.bN(j,i))}return s}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,s,m){let x=[];const w=m!==void 0,A=!w;if(A&&this.zoom<s||w&&m[0]===0&&m[1]===0)return x;const k=new Set,U=(j,Y,J,oe,pe)=>{const ue=n.c2(Y,j,J,oe,pe);k.has(ue)||(x.push(new n.aA(j,Y,J,oe,pe)),k.add(ue))};for(let j=0;j<i.length;j++){const Y=i[j];if(A&&Y.canonical.z!==s)continue;const J=Y.canonical,oe=Y.overscaledZ,pe=Y.wrap,ue=1<<J.z,_e=J.x+1<ue,ge=J.x>0,Oe=J.y+1<ue,Ge=J.y>0,He=Y.wrap-(ge?0:1),Qe=Y.wrap+(_e?0:1),nt=ge?J.x-1:ue-1,tt=_e?J.x+1:0;if(w)m[0]<0?(U(oe,Qe,J.z,tt,J.y),m[1]<0&&Oe&&(U(oe,pe,J.z,J.x,J.y+1),U(oe,Qe,J.z,tt,J.y+1)),m[1]>0&&Ge&&(U(oe,pe,J.z,J.x,J.y-1),U(oe,Qe,J.z,tt,J.y-1))):m[0]>0?(U(oe,He,J.z,nt,J.y),m[1]<0&&Oe&&(U(oe,pe,J.z,J.x,J.y+1),U(oe,He,J.z,nt,J.y+1)),m[1]>0&&Ge&&(U(oe,pe,J.z,J.x,J.y-1),U(oe,He,J.z,nt,J.y-1))):m[1]<0&&Oe?U(oe,pe,J.z,J.x,J.y+1):Ge&&U(oe,pe,J.z,J.x,J.y-1);else{const at=Y.visibleQuadrants;1&at&&(U(oe,He,J.z,nt,J.y),Ge&&(U(oe,pe,J.z,J.x,J.y-1),U(oe,He,J.z,nt,J.y-1))),2&at&&(U(oe,Qe,J.z,tt,J.y),Ge&&(U(oe,pe,J.z,J.x,J.y-1),U(oe,Qe,J.z,tt,J.y-1))),4&at&&(U(oe,He,J.z,nt,J.y),Oe&&(U(oe,pe,J.z,J.x,J.y+1),U(oe,He,J.z,nt,J.y+1))),8&at&&(U(oe,Qe,J.z,tt,J.y),Oe&&(U(oe,pe,J.z,J.x,J.y+1),U(oe,Qe,J.z,tt,J.y+1)))}}const W=[];for(const j of x)x.some(Y=>j.isChildOf(Y))||W.push(j);if(x=W.filter(j=>!i.some(Y=>!!(j.overscaledZ<s&&Y.isChildOf(j))||j.equals(Y)||j.isChildOf(Y))),A){const j=1<<s,Y=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=[j*Y.x,j*Y.y],oe=4,pe=oe*oe;x=x.filter(ue=>{const _e=ue.canonical.x+.5-J[0],ge=ue.canonical.y+.5-J[1];return _e*_e+ge*ge<pe})}return x}coveringTiles(i){let s=this.coveringZoomLevel(i);const m=s,x=this.elevation&&this.elevation.exaggeration(),w=x&&!i.isTerrainDEM,A=this.projection.name==="mercator";if(i.minzoom!==void 0&&s<i.minzoom)return[];i.maxzoom!==void 0&&s>i.maxzoom&&(s=i.maxzoom);const k=this.locationCoordinate(this.center),U=this.center.lat,W=1<<s,j=[W*k.x,W*k.y,0],Y=this.projection.name==="globe",J=!Y,oe=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,J),pe=Y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ue=W*n.bE(1,this.center.lat),_e=this._camera.position[2]/n.bE(1,this.center.lat),ge=[W*pe.x,W*pe.y,_e*(J?1:ue)],Oe=Y||x,Ge=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),He=this.isLODDisabled(!0)?s:0;let Qe;if(this._elevation&&i.isTerrainDEM)Qe=1e4*this._elevation.exaggeration();else if(this._elevation){const qt=this._elevation.getMinMaxForVisibleTiles();Qe=qt?qt.max:this._centerAltitude}else Qe=this._centerAltitude;const nt=i.isTerrainDEM?-Qe:this._elevation?this._elevation.getMinElevationBelowMSL():0,tt=this.projection.isReprojectedInTileSpace?n.bP(this):1,at=qt=>{const hi=new n.a5(qt.x+25e-6,qt.y,qt.z),Ti=new n.a5(qt.x,qt.y+25e-6,qt.z),Ci=qt.toLngLat(),gi=hi.toLngLat(),Xi=Ti.toLngLat(),zn=this.locationCoordinate(Ci),$n=this.locationCoordinate(gi),An=this.locationCoordinate(Xi),kn=Math.hypot($n.x-zn.x,$n.y-zn.y),dn=Math.hypot(An.x-zn.x,An.y-zn.y);return Math.sqrt(kn*dn)*tt/25e-6},wt=qt=>{const wi=Qe,hi=nt;return{aabb:n.bS(this,W,0,0,0,qt,hi,wi,this.projection),zoom:0,x:0,y:0,minZ:hi,maxZ:wi,wrap:qt,fullyVisible:!1}},Ot=[];let Ct=[];const St=s,si=i.reparseOverscaled?m:s,di=(_e-this._centerAltitude)*ue,Si=qt=>{if(!this._elevation||!qt.tileID||!A)return;const wi=this._elevation.getMinMaxForTile(qt.tileID),hi=qt.aabb;wi?(hi.min[2]=wi.min,hi.max[2]=wi.max,hi.center[2]=(hi.min[2]+hi.max[2])/2):(qt.shouldSplit=Ki(qt),qt.shouldSplit||(hi.min[2]=hi.max[2]=hi.center[2]=this._centerAltitude))},Gi=(qt,wi)=>{if(.707*wi<qt)return 1;const hi=wi/qt;return hi/(1.4144271570014144+(Math.pow(1.1,hi-1.4144271570014144+1)-1)/(1.1-1)-1)},Ki=qt=>{if(qt.zoom<He)return!0;if(qt.zoom===St)return!1;if(qt.shouldSplit!=null)return qt.shouldSplit;const wi=qt.aabb.distanceX(ge),hi=qt.aabb.distanceY(ge);let Ti=di,Ci=1;if(Y){Ti=qt.aabb.distanceZ(ge);const dn=Math.pow(2,qt.zoom),tr=n.aN((qt.y+1)/dn),dr=n.aN(qt.y/dn),Nr=Math.min(Math.max(U,tr),dr),as=n.c6(Nr)/n.c6(U);if(Ci=Nr===U?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,as/this._mercatorScaleRatio),this.zoom<=n.c3&&qt.zoom===St-1&&as>=.9)return!0}else if(w&&(Ti=qt.aabb.distanceZ(ge)*ue),this.projection.isReprojectedInTileSpace&&m<=5){const dn=Math.pow(2,qt.zoom),tr=at(new n.a5((qt.x+.5)/dn,(qt.y+.5)/dn));Ci=tr>.85?1:tr}if(!A){const dn=Math.sqrt(wi*wi+hi*hi+Ti*Ti);let tr=(1<<St-qt.zoom)*Ge*Ci;return tr*=Gi(Math.max(Ti,di),dn),dn<tr}let gi=Number.MAX_VALUE,Xi=0;const zn=qt.aabb.getCorners(),$n=[];for(const dn of zn){n.a6.vec3.sub($n,dn,ge),Y||(w?$n[2]*=ue:$n[2]=di);const tr=n.a6.vec3.dot($n,this._camera.forward());tr<gi&&(gi=tr,Xi=Math.abs($n[2]))}let An=(1<<St-qt.zoom)*Ge*Ci;if(An*=Gi(Math.max(Xi,di),gi),gi<An)return!0;const kn=qt.aabb.closestPoint(j);return kn[0]===j[0]&&kn[1]===j[1]};if(this.renderWorldCopies)for(let qt=1;qt<=3;qt++)Ot.push(wt(-qt)),Ot.push(wt(qt));for(Ot.push(wt(0));Ot.length>0;){const qt=Ot.pop(),wi=qt.x,hi=qt.y;let Ti=qt.fullyVisible;const Ci=()=>this.projection.name==="globe"&&(qt.y===0||qt.y===(1<<qt.zoom)-1);if(!Ti){let gi=Oe?qt.aabb.intersects(oe):qt.aabb.intersectsFlat(oe);if(gi===0&&Ci()){const Xi=new n.bQ(qt.zoom,wi,hi);gi=n.bR(this,W,Xi,!0).intersects(oe)}if(gi===0)continue;Ti=gi===2}if(qt.zoom!==St&&Ki(qt))for(let gi=0;gi<4;gi++){const Xi=(wi<<1)+gi%2,zn=(hi<<1)+(gi>>1),$n={aabb:A?qt.aabb.quadrant(gi):n.bS(this,W,qt.zoom+1,Xi,zn,qt.wrap,qt.minZ,qt.maxZ,this.projection),zoom:qt.zoom+1,x:Xi,y:zn,wrap:qt.wrap,fullyVisible:Ti,tileID:void 0,shouldSplit:void 0,minZ:qt.minZ,maxZ:qt.maxZ};w&&!Y&&($n.tileID=new n.aA(qt.zoom+1===St?si:qt.zoom+1,qt.wrap,qt.zoom+1,Xi,zn),Si($n)),Ot.push($n)}else{const gi=qt.zoom===St?si:qt.zoom;if(i.minzoom&&i.minzoom>gi)continue;let Xi=0;if(!Ti){let kn=Oe?qt.aabb.intersectsPrecise(oe):qt.aabb.intersectsPreciseFlat(oe);if(kn===0&&Ci()){const dn=new n.bQ(qt.zoom,wi,hi);kn=n.bR(this,W,dn,!0).intersectsPrecise(oe)}if(kn===0)continue;if(i.calculateQuadrantVisibility)if(oe.containsPoint(qt.aabb.center))Xi=15;else for(let dn=0;dn<4;dn++)qt.aabb.quadrant(dn).intersects(oe)!==0&&(Xi|=1<<dn)}const zn=j[0]-(.5+wi+(qt.wrap<<qt.zoom))*(1<<s-qt.zoom),$n=j[1]-.5-hi,An=qt.tileID?qt.tileID:new n.aA(gi,qt.wrap,qt.zoom,wi,hi);i.calculateQuadrantVisibility&&(An.visibleQuadrants=Xi),Ct.push({tileID:An,distanceSq:zn*zn+$n*$n})}}if(this.fogCullDistSq){const qt=this.fogCullDistSq,wi=this.horizonLineFromTop();Ct=Ct.filter(hi=>{const Ti=[0,0,0,1],Ci=[n.ab,n.ab,0,1],gi=this.calculateFogTileMatrix(hi.tileID.toUnwrapped());n.a6.vec4.transformMat4(Ti,Ti,gi),n.a6.vec4.transformMat4(Ci,Ci,gi);const Xi=n.a6.vec4.min([],Ti,Ci),zn=n.a6.vec4.max([],Ti,Ci),$n=n.bT(Xi,zn);if($n===0)return!0;let An=!1;const kn=this._elevation;if(kn&&$n>qt&&wi!==0){const dn=this.calculateProjMatrix(hi.tileID.toUnwrapped());let tr;i.isTerrainDEM||(tr=kn.getMinMaxForTile(hi.tileID)),tr||(tr={min:nt,max:Qe});const dr=n.c4(this.rotation),Nr=[dr[0]*n.ab,dr[1]*n.ab,tr.max];n.a6.vec3.transformMat4(Nr,Nr,dn),An=(1-Nr[1])*this.height*.5<wi}return $n<qt||An})}return Ct.sort((qt,wi)=>qt.distanceSq-wi.distanceSq).map(qt=>qt.tileID)}resize(i,s){this.width=i,this.height=s,this.pixelsToGLUnits=[2/i,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const s=n.ap(i.lat,-n.bU,n.bU),m=this.projection.project(i.lng,s);return new n.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,s){let m,x;const w=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;m=(s.x-w.x)/k,x=(s.y-w.y)/k}else{const k=this.pointCoordinate(s),U=this.pointCoordinate(w);m=k.x-U.x,x=k.y-U.y}const A=this.locationCoordinate(i);this.setLocation(new n.a5(A.x-m,A.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,s){const m=s?n.bE(s,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new n.a5(x.x,x.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,s){const m=s??this._centerAltitude,x=[i.x,i.y,0,1],w=[i.x,i.y,1,1];n.a6.vec4.transformMat4(x,x,this.pixelMatrixInverse),n.a6.vec4.transformMat4(w,w,this.pixelMatrixInverse);const A=w[3];n.a6.vec4.scale(x,x,1/x[3]),n.a6.vec4.scale(w,w,1/A);const k=x[2],U=w[2];return{p0:x,p1:w,t:k===U?0:(m-k)/(U-k)}}screenPointToMercatorRay(i){const s=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return n.a6.vec4.transformMat4(s,s,this.pixelMatrixInverse),n.a6.vec4.transformMat4(m,m,this.pixelMatrixInverse),n.a6.vec4.scale(s,s,1/s[3]),n.a6.vec4.scale(m,m,1/m[3]),s[2]=n.bE(s[2],this._center.lat)*this.worldSize,m[2]=n.bE(m[2],this._center.lat)*this.worldSize,n.a6.vec4.scale(s,s,1/this.worldSize),n.a6.vec4.scale(m,m,1/this.worldSize),new n.aj([s[0],s[1],s[2]],n.a6.vec3.normalize([],n.a6.vec3.sub([],m,s)))}rayIntersectionCoordinate(i){const{p0:s,p1:m,t:x}=i,w=n.bE(s[2],this._center.lat),A=n.bE(m[2],this._center.lat);return new n.a5(n.aa(s[0],m[0],x)/this.worldSize,n.aa(s[1],m[1],x)/this.worldSize,n.aa(w,A,x))}pointCoordinate(i,s=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,s)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let s=this.projection.pointCoordinate3D(this,i.x,i.y);if(s)return new n.a5(s[0],s[1],s[2]);let m=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const w=.02*x,A=i.clone();for(let k=0;k<10&&x-m>w;k++){A.y=n.aa(m,x,.66);const U=this.projection.pointCoordinate3D(this,A.x,A.y);U?(x=A.y,s=U):m=A.y}return s?new n.a5(s[0],s[1],s[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=n.bV)return!this.isPointAboveHorizon(i);const s=this.pointCoordinate(i);return s.y>=0&&s.y<=1}_coordinatePoint(i,s){const m=s&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return n.a6.vec4.transformMat4(x,x,this.pixelMatrix),x[3]>0?new n.P(x[0]/x[3],x[1]/x[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:s}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new n.P(s,i)),A=this.pointLocation3D(new n.P(x,i)),k=this.pointLocation3D(new n.P(x,m)),U=this.pointLocation3D(new n.P(s,m));let W=Math.min(w.lng,A.lng,k.lng,U.lng),j=Math.max(w.lng,A.lng,k.lng,U.lng),Y=Math.min(w.lat,A.lat,k.lat,U.lat),J=Math.max(w.lat,A.lat,k.lat,U.lat);const oe=Math.pow(2,-this.zoom)/16*270,pe=this.projection.name==="globe"?1:4,ue=(_e,ge,Oe,Ge,He)=>{const Qe=(_e+Oe)/2,nt=(ge+Ge)/2,tt=new n.P(Qe,nt),{lng:at,lat:wt}=this.pointLocation3D(tt),Ot=Math.max(0,W-at,Y-wt,at-j,wt-J);W=Math.min(W,at),j=Math.max(j,at),Y=Math.min(Y,wt),J=Math.max(J,wt),(He<pe||Ot>oe)&&(ue(_e,ge,Qe,nt,He+1),ue(Qe,nt,Oe,Ge,He+1))};if(ue(s,i,x,i,1),ue(x,i,x,m,1),ue(x,m,s,m,1),ue(s,m,s,i,1),this.projection.name==="globe"){const[_e,ge]=n.bW(this);_e?(J=90,j=180,W=-180):ge&&(Y=-90,j=180,W=-180)}return new n.as(new n.bL(W,Y),new n.bL(j,J))}_getBoundsRectangular(i,s){const{top:m,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,k=new n.P(x,m),U=new n.P(A,m),W=new n.P(A,w),j=new n.P(x,w);let Y=this.pointCoordinate(k,i),J=this.pointCoordinate(U,i);const oe=this.pointCoordinate(W,s),pe=this.pointCoordinate(j,s),ue=(_e,ge)=>(ge.y-_e.y)/(ge.x-_e.x);return Y.y>1&&J.y>=0?Y=new n.a5((1-pe.y)/ue(pe,Y)+pe.x,1):Y.y<0&&J.y<=1&&(Y=new n.a5(-pe.y/ue(pe,Y)+pe.x,0)),J.y>1&&Y.y>=0?J=new n.a5((1-oe.y)/ue(oe,J)+oe.x,1):J.y<0&&Y.y<=1&&(J=new n.a5(-oe.y/ue(oe,J)+oe.x,0)),new n.as().extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(pe)).extend(this.coordinateLocation(oe))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=i.visibleDemTiles.reduce((m,x)=>{if(x.dem){const w=x.dem.tree;m.min=Math.min(m.min,w.minimums[0]),m.max=Math.max(m.max,w.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*i.exaggeration(),s.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-s*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-n.bU,this.maxLat=n.bU,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.am(this.minLng)*this.tileSize,this.worldMaxX=n.am(this.maxLng)*this.tileSize,this.worldMinY=n.at(this.maxLat)*this.tileSize,this.worldMaxY=n.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,s){return this.projection.createTileMatrix(this,s,i)}calculateDistanceTileData(i){const s=i.key,m=this._distanceTileDataCache;if(m[s])return m[s];const x=i.canonical,w=1/this.height,A=this.cameraWorldSize,k=A/this.zoomScale(x.z),U=(x.x+Math.pow(2,x.z)*i.wrap)*k,W=x.y*k,j=this.point;j.x*=A/this.worldSize,j.y*=A/this.worldSize;const Y=this.angle,J=Math.sin(-Y),oe=-Math.cos(-Y);return m[s]={bearing:[J,oe],center:[(j.x-U)*w,(j.y-W)*w],scale:k/n.ab*w},m[s]}calculateFogTileMatrix(i){const s=i.key,m=this._fogTileMatrixCache;if(m[s])return m[s];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return n.a6.mat4.multiply(x,this.worldToFogMatrix,x),m[s]=new Float32Array(x),m[s]}calculateProjMatrix(i,s=!1,m=!1){const x=i.key;let w;if(w=m?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const A=this.calculatePosMatrix(i,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,n.a6.mat4.multiply(A,k,A),w[x]=new Float32Array(A),w[x]}calculatePixelsToTileUnitsMatrix(i){const s=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[s])return m[s];const x=n.bX(i,this);return m[s]=x,m[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,s=n.a6.mat4.fromScaling([],[i,i,i]);return n.a6.mat4.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const s=n.bE(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(s),x=this._camera.forward(),w=n.bE(1,this._center.lat);m[2]/=w,x[2]/=w,n.a6.vec3.normalize(x,x);const A=i.raycast(m,x,i.exaggeration());if(A){const k=n.a6.vec3.scaleAndAdd([],m,x,A),U=new n.a5(k[0],k[1],n.bE(k[2],n.aN(k[1]))),W=(U.z+n.a6.vec3.length([U.x-m[0],U.y-m[1],U.z-m[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(W),this._centerAltitude=U.toAltitude(),this._center=this.coordinateLocation(U),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const s=this._elevation,m=n.bE(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(m),w=s.getAtPointOrZero(new n.a5(...x)),A=this.pixelsPerMeter/this.worldSize*w,k=this._minimumHeightOverTerrain(),U=x[2]-A;if(U<=k)if(U<0||i){const W=this.locationCoordinate(this._center,this._centerAltitude),j=[x[0],x[1],W.z-x[2]],Y=n.a6.vec3.length(j);j[2]-=(k-U)/this._pixelsPerMercatorPixel;const J=n.a6.vec3.length(j);if(J===0)return;n.a6.vec3.scale(j,j,Y/J*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],W.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const J=this.center;return J.lat=n.ap(J.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(J.lng=n.ap(J.lng,this.minLng,this.maxLng)),this.center=J,void(this._constraining=!1)}const s=this._unmodified,{x:m,y:x}=this.point;let w=0,A=m,k=x;const U=this.width/2,W=this.height/2,j=this.worldMinY*this.scale,Y=this.worldMaxY*this.scale;if(x-W<j&&(k=j+W),x+W>Y&&(k=Y-W),Y-j<this.height&&(w=Math.max(w,this.height/(Y-j)),k=(Y+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const J=this.worldMinX*this.scale,oe=this.worldMaxX*this.scale,pe=this.worldSize/2-(J+oe)/2;A=(m+pe+this.worldSize)%this.worldSize-pe,A-U<J&&(A=J+U),A+U>oe&&(A=oe-U),oe-J<this.width&&(w=Math.max(w,this.width/(oe-J)),A=(oe+J)/2)}A===m&&k===x||(this.center=this.unproject(new n.P(A,k))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,s=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bE(1,this.center.lat)/n.bE(1,n.c5));const x=n.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?m:1,A=this._camera.getWorldToCamera(this.worldSize,w);let k;const U=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(U[8]=2*-i.x/this.width,U[9]=2*i.y/this.height,this.isOrthographic){let wt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ot=wt*this.aspect,Ct=-Ot,St=-wt;Ot-=i.x,Ct-=i.x,wt+=i.y,St+=i.y,k=this._camera.getCameraToClipOrthographic(Ct,Ot,St,wt,this._nearZ,this._farZ),((si,di,Si,Gi)=>{for(let Ki=0;Ki<16;Ki++)si[Ki]=vo(di[Ki],Si[Ki],Gi)})(k,k,U,Tl(this.pitch>=15?1:this.pitch/15))}else k=U;const W=n.a6.mat4.mul([],U,A);let j=n.a6.mat4.mul([],k,A);if(this.projection.isReprojectedInTileSpace){const wt=this.locationCoordinate(this.center),Ot=n.a6.mat4.identity([]);n.a6.mat4.translate(Ot,Ot,[wt.x*this.worldSize,wt.y*this.worldSize,0]),n.a6.mat4.multiply(Ot,Ot,n.bZ(this)),n.a6.mat4.translate(Ot,Ot,[-wt.x*this.worldSize,-wt.y*this.worldSize,0]),n.a6.mat4.multiply(j,j,Ot),n.a6.mat4.multiply(W,W,Ot),this.inverseAdjustmentMatrix=n.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.a6.mat4.scale([],j,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=j,this.invProjMatrix=n.a6.mat4.invert(new Float64Array(16),this.projMatrix),s){const wt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);wt[8]=2*-i.x/this.width,wt[9]=2*i.y/this.height,this.expandedFarZProjMatrix=n.a6.mat4.mul([],wt,A)}else this.expandedFarZProjMatrix=this.projMatrix;const Y=n.a6.mat4.invert([],k);this.frustumCorners=n.b$.fromInvProjectionMatrix(Y,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const J=new Float32Array(16);n.a6.mat4.identity(J),n.a6.mat4.scale(J,J,[1,-1,1]),n.a6.mat4.rotateX(J,J,this._pitch),n.a6.mat4.rotateZ(J,J,this.angle);const oe=n.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.a6.mat4.clone(oe);const pe=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;oe[8]=2*-i.x/this.width,oe[9]=2*(i.y+pe)/this.height,this.skyboxMatrix=n.a6.mat4.multiply(J,oe,J);const ue=this.point,_e=ue.x,ge=ue.y,Oe=this.width%2/2,Ge=this.height%2/2,He=Math.cos(this.angle),Qe=Math.sin(this.angle),nt=_e-Math.round(_e)+He*Oe+Qe*Ge,tt=ge-Math.round(ge)+He*Ge+Qe*Oe,at=new Float64Array(j);if(n.a6.mat4.translate(at,at,[nt>.5?nt-1:nt,tt>.5?tt-1:tt,0]),this.alignedProjMatrix=at,j=n.a6.mat4.create(),n.a6.mat4.scale(j,j,[this.width/2,-this.height/2,1]),n.a6.mat4.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=n.a6.mat4.create(),n.a6.mat4.scale(j,j,[1,-1,1]),n.a6.mat4.translate(j,j,[-1,-1,0]),n.a6.mat4.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=n.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,W),this._calcFogMatrices(),this._distanceTileDataCache={},j=n.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.c0(this);const wt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.a6.vec3.transformMat4(wt,wt,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[i,i,s];n.a6.vec3.scale(w,w,x),n.a6.vec3.scale(m,m,-1),n.a6.vec3.multiply(m,m,w);const A=n.a6.mat4.create();n.a6.mat4.translate(A,A,m),n.a6.mat4.scale(A,A,w),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,s,x)}_computeCameraPosition(i){const s=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*w,x.y/this.worldSize-m[1]*w,i/this.worldSize*this._centerAltitude-m[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],x=i[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((s-m)/x,1)),this._camera.position=n.a6.vec3.scaleAndAdd([],this._camera.position,i,w),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,s=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),w=n.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.bC(this._maxPitch)),k=Math.max((i[2]-w)/Math.cos(m),A),U=this._zoomFromMercatorZ(k);n.a6.vec3.scaleAndAdd(i,i,s,k),this._pitch=n.ap(m,n.bC(this.minPitch),n.bC(this.maxPitch)),this.angle=n.bB(x,-Math.PI,Math.PI),this._setZoom(n.ap(U,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.a5(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let s=0,m=n.bV,x=0,w=1/0;for(;m-s>1e-6&&m>s;){const A=s+.5*(m-s),k=this.tileSize*Math.pow(2,A),U=this.getCameraToCenterDistance(this.projection,A,k),W=this.scaleZoom(U/(i*this.tileSize)),j=Math.abs(A-W);j<w&&(w=j,x=A),A<W?s=A:m=A}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,s){const m=Math.min(i.x,s.x),x=Math.max(i.x,s.x),w=Math.min(i.y,s.y),A=Math.max(i.y,s.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new n.P(m,w),new n.P(x,A),new n.P(m,A),new n.P(x,w)],U=this.renderWorldCopies?-3:0,W=this.renderWorldCopies?4:1;for(const j of k){const Y=this.pointRayIntersection(j);if(Y.t<0)return!0;const J=this.rayIntersectionCoordinate(Y);if(J.x<U||J.y<0||J.x>W||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(i,s){const m=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(m)+s;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([s,m,x],w){const A=[s,m,x,1];n.a6.vec4.transformMat4(A,A,w);const k=A[3]=Math.max(A[3],1e-6);return A[0]/=k,A[1]/=k,A[2]/=k,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,i))}}getCameraToCenterDistance(i,s=this.zoom,m=this.worldSize){const x=n.bY(i,s,this.width,this.height,1024),w=i.pixelSpaceConversion(this.center.lat,m,x);let A=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(A=vo(1,A,Tl(this.pitch>=15?1:this.pitch/15))),A}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.a6.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Ia=(f,i)=>{if(i>0&&f.terrain&&n.w("Cutoff is currently disabled on terrain"),i<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=f.transform,m=Math.max(Math.abs(s._zoom-(f.minCutoffZoom-1)),1),x=s.isLODDisabled(!1)?n.a7(60,45,s.pitch):n.a7(30,15,s.pitch),w=s._farZ-s._nearZ,A=i*s.height,k=((1-(U=x))*s.cameraToCenterDistance+U*(s._farZ+A))*m;var U;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(k-s._nearZ)/w,(k-A-s._nearZ)/w]}}},Ks={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class td{constructor(i,s){this.aabb=i,this.lastCascade=s}}class un{add(i,s){const m=this.receivers[i.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],s.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],s.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],s.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],s.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],s.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],s.max[2])):this.receivers[i.key]=new td(s,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,s,m){const x=n.ca.fromPoints(i.points);let w=0;for(const A in this.receivers){const k=this.receivers[A];if(!k||!x.intersectsAabb(k.aabb))continue;k.aabb.min=x.closestPoint(k.aabb.min),k.aabb.max=x.closestPoint(k.aabb.max);const U=k.aabb.getCorners();for(let W=0;W<m.length;W++){let j=!0;for(const Y of U){const J=[Y[0]*s,Y[1]*s,Y[2]];if(n.a6.vec3.transformMat4(J,J,m[W].matrix),J[0]<-1||J[0]>1||J[1]<-1||J[1]>1){j=!1;break}}if(k.lastCascade=W,w=Math.max(w,W),j)break}}return w+1}}class Fm{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new un,this._depthMode=new Xn(i.context.gl.LEQUAL,Xn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Ks,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Ks,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Ks,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,s){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const x=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||x<=0||(this._shadowLayerCount=m.style.order.reduce((pe,ue)=>{const _e=m.style._mergedLayers[ue];return pe+(_e.hasShadowPass()&&!_e.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=m.context,A=Ks.shadowMapResolution,k=Ks.shadowMapResolution;if(this._cascades.length===0||Ks.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let pe=0;pe<Ks.cascadeCount;++pe){const ue=m._shadowMapDebug,_e=w.gl,ge=w.createFramebuffer(A,k,ue,"texture"),Oe=new n.T(w,{width:A,height:k,data:null},_e.DEPTH_COMPONENT16);if(ge.depthAttachment.set(Oe.texture),ue){const Ge=new n.T(w,{width:A,height:k,data:null},_e.RGBA8);ge.colorAttachment.set(Ge.texture)}this._cascades.push({framebuffer:ge,texture:Oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bO,scale:0})}}this.shadowDirection=rc(s);let U=0;if(i.elevation){const pe=i.elevation,ue=[1e4,-1e4];pe.visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{const ge=_e.dem.tree;ue[0]=Math.min(ue[0],ge.minimums[0]),ue[1]=Math.max(ue[1],ge.maximums[0])}),ue[0]!==1e4&&(U=(ue[1]-ue[0])*pe.exaggeration())}const W=1.5*i.cameraToCenterDistance,j=3*W,Y=new Float64Array(16);for(let pe=0;pe<this._cascades.length;++pe){const ue=this._cascades[pe];let _e=i.height/50,ge=1;Ks.cascadeCount===1?ge=j:pe===0?ge=W:(_e=W,ge=j);const[Oe,Ge]=Fc(i,this.shadowDirection,_e,ge,Ks.shadowMapResolution,U);ue.scale=i.scale,ue.matrix=Oe,ue.boundingSphereRadius=Ge,n.a6.mat4.invert(Y,ue.matrix),ue.frustum=n.bO.fromInvProjectionMatrix(Y,1,0,!0),ue.far=ge}const J=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[J].far,this._cascades[J].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ks.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ks.shadowMapResolution,this._uniformValues.u_shadowmap_0=co.ShadowMap0,this._uniformValues.u_shadowmap_1=co.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const oe=m.transform.elevation;for(const pe of this._groundShadowTiles){let ue={min:0,max:0};if(oe){const _e=oe.getMinMaxForTile(pe);_e&&(ue=_e)}this.addShadowReceiver(pe.toUnwrapped(),ue.min,ue.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,s){if(!this.enabled)return;const m=this.painter,x=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),x.viewport.set([0,0,Ks.shadowMapResolution,Ks.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){m.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:n.bA.white,depth:1});for(const A of i.order){const k=i._mergedLayers[A];if(!k.hasShadowPass()||k.isHidden(m.transform.zoom))continue;const U=i.getLayerSourceCache(k),W=U?s[U.id]:void 0;(k.type==="model"||W&&W.length)&&m.renderLayer(m,U,k,W)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,s=i.style,m=i.context,x=s.directionalLight,w=s.ambientLight;if(!x||!w)return;const A=[],k=Ia(i,i.longestCutoffRange);k.shouldRenderCutoff&&A.push("RENDER_CUTOFF"),A.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&A.push("NORMAL_OFFSET");const U=_u(s,x,w),W=new Xn(m.gl.LEQUAL,Xn.ReadOnly,i.depthRangeFor3D);for(const j of this._groundShadowTiles){const Y=j.toUnwrapped(),J=i.isTileAffectedByFog(j),oe=i.getOrCreateProgram("groundShadow",{defines:A,overrideFog:J});this.setupShadows(Y,oe),i.uploadCommonUniforms(m,oe,Y,null,k);const pe={u_matrix:i.transform.calculateProjMatrix(Y),u_ground_shadow_factor:U};oe.draw(i,m.gl.TRIANGLES,W,hr.disabled,Ir.multiply,qn.disabled,pe,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ir.unblended:Ir.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const s=this.painter.transform,m=s.calculatePosMatrix(i,s.worldSize);return n.a6.mat4.multiply(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(i){return n.a6.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,s,m,x=0){if(!this.enabled)return;const w=this.painter.transform,A=this.painter.context,k=A.gl,U=this._uniformValues,W=new Float64Array(16),j=w.calculatePosMatrix(i,w.worldSize);for(let Y=0;Y<this._cascades.length;Y++)n.a6.mat4.multiply(W,this._cascades[Y].matrix,j),U[Y===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(W),A.activeTexture.set(k.TEXTURE0+co.ShadowMap0+Y),this._cascades[Y].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!m,this.useNormalOffset){const Y=n.c9(i.canonical),J=2/w.tileSize*n.ab/Ks.shadowMapResolution,oe=J*this._cascades[0].boundingSphereRadius,pe=J*this._cascades[this._cascades.length-1].boundingSphereRadius,ue=(m==="vector-tile"?1:3)/Math.pow(2,x-i.canonical.z-(1-w.zoom+Math.floor(w.zoom)));U.u_shadow_normal_offset=[Y,oe*ue,pe*ue],U.u_shadow_bias=[6e-5,.0012,.012]}else U.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(A,U)}setupShadowsFromMatrix(i,s,m=!1){if(!this.enabled)return;const x=this.painter.context,w=x.gl,A=this._uniformValues,k=new Float64Array(16);for(let U=0;U<Ks.cascadeCount;U++)n.a6.mat4.multiply(k,this._cascades[U].matrix,i),A[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),x.activeTexture.set(w.TEXTURE0+co.ShadowMap0+U),this._cascades[U].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=m,m){const U=Ks.normalOffset;A.u_shadow_normal_offset=[1,U,U],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(x,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,s,m,x){if(x[2]>=0)return{};const w=function(U,W,j){const Y=j/(1<<U.canonical.z);return new n.ca([U.canonical.x*Y+U.wrap*j,U.canonical.y*Y+U.wrap*j,0],[(U.canonical.x+1)*Y+U.wrap*j,(U.canonical.y+1)*Y+U.wrap*j,W])}(i,s,m).getCorners(),A=s/-x[2];x[0]<0?(n.a6.vec3.add(w[0],w[0],[x[0]*A,0,0]),n.a6.vec3.add(w[3],w[3],[x[0]*A,0,0])):x[0]>0&&(n.a6.vec3.add(w[1],w[1],[x[0]*A,0,0]),n.a6.vec3.add(w[2],w[2],[x[0]*A,0,0])),x[1]<0?(n.a6.vec3.add(w[0],w[0],[0,x[1]*A,0]),n.a6.vec3.add(w[1],w[1],[0,x[1]*A,0])):x[1]>0&&(n.a6.vec3.add(w[2],w[2],[0,x[1]*A,0]),n.a6.vec3.add(w[3],w[3],[0,x[1]*A,0]));const k={};return k.vertices=w,k.planes=[ba(w[1],w[0],w[4]),ba(w[2],w[1],w[5]),ba(w[3],w[2],w[6]),ba(w[0],w[3],w[7])],k}addShadowReceiver(i,s,m){this._receivers.add(i,n.ca.fromTileIdAndHeight(i,s,m))}getMaxCascadeForTile(i){const s=this._receivers.get(i);return s&&s.lastCascade?s.lastCascade:0}}function ba(f,i,s){const m=n.a6.vec3.sub([],s,i),x=n.a6.vec3.sub([],f,i),w=n.a6.vec3.cross([],m,x),A=n.a6.vec3.length(w);return A===0?[0,0,1,0]:(n.a6.vec3.scale(w,w,1/A),[w[0],w[1],w[2],-n.a6.vec3.dot(w,i)])}function rc(f){const i=f.properties.get("direction"),s=n.c8(i.x,i.y,i.z);s[2]=n.ap(s[2],0,75);const m=n.cb([s[0],s[1],s[2]]);return n.a6.vec3.fromValues(m.x,m.y,m.z)}function _u(f,i,s){const m=i.properties.get("color"),x=i.properties.get("intensity"),w=i.properties.get("direction"),A=[w.x,w.y,w.z],k=s.properties.get("color"),U=s.properties.get("intensity"),W=Math.max(n.a6.vec3.dot([0,0,1],A),0),j=[0,0,0];n.a6.vec3.scale(j,k.toRenderColor(f.getLut(i.scope)).toArray01Linear().slice(0,3),U);const Y=[0,0,0];return n.a6.vec3.scale(Y,m.toRenderColor(f.getLut(s.scope)).toArray01Linear().slice(0,3),W*x),n.cc([j[0]>0?j[0]/(j[0]+Y[0]):0,j[1]>0?j[1]/(j[1]+Y[1]):0,j[2]>0?j[2]/(j[2]+Y[2]):0])}function Fc(f,i,s,m,x,w){const A=f.zoom,k=f.scale,U=f.worldSize,W=1/U,j=f.aspect,Y=Math.sqrt(1+j*j)*Math.tan(.5*f.fovX),J=Y*Y,oe=m-s,pe=m+s;let ue,_e;J>oe/pe?(ue=m,_e=m*Y):(ue=.5*pe*(1+J),_e=.5*Math.sqrt(oe*oe+2*(m*m+s*s)*J+pe*pe*J*J));const ge=f.projection.pixelsPerMeter(f.center.lat,U),Oe=f._camera.getCameraToWorldMercator(),Ge=[0,0,-ue*W];n.a6.vec3.transformMat4(Ge,Ge,Oe);let He=_e*W;const Qe=f._edgeInsets;if(!(Qe.left===0&&Qe.top===0&&Qe.right===0&&Qe.bottom===0||Qe.left===Qe.right&&Qe.top===Qe.bottom)){const Ti=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?ge:1),Ci=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,s,m);Ci[8]=2*-f.centerOffset.x/f.width,Ci[9]=2*f.centerOffset.y/f.height;const gi=new Float64Array(16);n.a6.mat4.mul(gi,Ci,Ti);const Xi=new Float64Array(16);n.a6.mat4.invert(Xi,gi);const zn=n.bO.fromInvProjectionMatrix(Xi,U,A,!0);for(const $n of zn.points){const An=((nt=$n)[0]/=k,nt[1]/=k,nt[2]=n.bE(nt[2],f._center.lat),nt);He=Math.max(He,n.a6.vec3.len(n.a6.vec3.subtract([],Ge,An)))}}var nt;He*=x/(x-1);const tt=Math.acos(i[2]),at=Math.atan2(-i[0],-i[1]),wt=new zc;wt.position=Ge,wt.setPitchBearing(tt,at);const Ot=wt.getWorldToCamera(U,ge),Ct=He*U,St=Math.min(f._mercatorZfromZoom(17)*U*-2,-2*Ct),si=wt.getCameraToClipOrthographic(-Ct,Ct,-Ct,Ct,St,(Ct+w*ge)/i[2]),di=new Float64Array(16);n.a6.mat4.multiply(di,si,Ot);const Si=n.a6.vec3.fromValues(Math.floor(1e6*Ge[0])/1e6*U,Math.floor(1e6*Ge[1])/1e6*U,0),Gi=.5*x,Ki=[0,0,0];n.a6.vec3.transformMat4(Ki,Si,di),n.a6.vec3.scale(Ki,Ki,Gi);const qt=[Math.floor(Ki[0]),Math.floor(Ki[1]),Math.floor(Ki[2])],wi=[0,0,0];n.a6.vec3.sub(wi,Ki,qt),n.a6.vec3.scale(wi,wi,-1/Gi);const hi=new Float64Array(16);return n.a6.mat4.identity(hi),n.a6.mat4.translate(hi,hi,wi),n.a6.mat4.multiply(di,hi,di),[di,Ct]}class jl extends n.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,s){return n.aG(this.requestManager.transformRequest(s,n.R.Model).url).then(m=>{if(!m)return;const x=n.aH(m),w=new n.aI(i,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w}).catch(m=>{if(m&&m.status===404)return null;this.fire(new n.t(new Error(`Could not load model ${i} from ${s}: ${m.message}`)))})}load(i,s){this.models[s]||(this.models[s]={});const m=Object.keys(i);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+m.length;const x=[];for(const w of m)x.push(this.loadModel(w,i[w]));Promise.allSettled(x).then(w=>{for(let A=0;A<w.length;A++){const{status:k,value:U}=w[A];k==="fulfilled"&&U&&(this.models[s][m[A]]={model:U,numReferences:1})}this.numModelsLoading[s]-=m.length,this.fire(new n.x("data",{dataType:"style"}))}).catch(w=>{this.fire(new n.t(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,s){return!!this.getModel(i,s)}getModel(i,s){return this.models[s]||(this.models[s]={}),this.models[s][i]?this.models[s][i].model:void 0}addModel(i,s,m){this.models[m]||(this.models[m]={}),this.hasModel(i,m)&&this.models[m][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(s)},m)}addModels(i,s){this.models[s]||(this.models[s]={});const m={};for(const x in i)this.models[s][x]={},m[x]=this.requestManager.normalizeModelURL(i[x]);this.load(m,s)}addModelsFromBucket(i,s){this.models[s]||(this.models[s]={});const m={};for(const x of i)this.hasModel(x,s)?this.models[s][x].numReferences++:m[x]=this.requestManager.normalizeModelURL(x);this.load(m,s)}removeModel(i,s){if(this.models[s]&&this.models[s][i]&&(this.models[s][i].numReferences--,this.models[s][i].numReferences===0)){const m=this.models[s][i].model;delete this.models[s][i],m.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,s){this.models[s]||(this.models[s]={});for(const m in this.models[s])this.models[s][m].model&&this.models[s][m].model.upload(i.context)}}const pf=new n.a0({data:new n.a1(n._.colorTheme.data)}),Go=(f,i)=>Nt(f,i&&i.filter(s=>s.identifier!=="source.canvas")),os=n.ar(fe,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Qn=n.ar(fe,["setCenter","setZoom","setBearing","setPitch"]),sl={version:8,layers:[],sources:{}},Bm={duration:300,delay:0};class Ha extends n.E{constructor(i,s={}){super(),this.map=i,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=n.l({},Bm),this._buildingIndex=new Ui(this),this.crossTileSymbolIndex=new mu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new At,this.dispatcher=s.dispatcher?s.dispatcher:new n.ce(n.cf(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new kt,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new n.cg(i._requestManager,s.localFontFamily?n.ch.all:s.localIdeographFontFamily?n.ch.ideographs:n.ch.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new jl(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",n.ci());const m=this;this._rtlTextPluginCallback=Ha.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,A)=>{if(n.cj(w),A&&A.every(k=>k))for(const k in m._sourceCaches){const U=m._sourceCaches[k],W=U.getSource().type;W!=="vector"&&W!=="geojson"||U.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const A in this._layers){const k=this._layers[A];k.source===w.id&&this._validateLayer(k)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(n.f(i))return i;const s=n.ck(i);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${n.cl(JSON.stringify(i))}`}_diffStyle(i,s,m){this.globalId=this._getGlobalId(i);const x=(w,A)=>{try{A(null,this.setState(w,m))}catch(k){A(k,!1)}};if(typeof i=="string"){const w=this.map._requestManager.normalizeStyleURL(i),A=this.map._requestManager.transformRequest(w,n.R.Style);n.n(A,(k,U)=>{k?this.fire(new n.t(k)):U&&x(U,s)})}else typeof i=="object"&&x(i,s)}loadURL(i,s={}){this.fire(new n.x("dataloading",{dataType:"style"}));const m=typeof s.validate=="boolean"?s.validate:!n.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,s.accessToken),this.resolvedImports.add(i);const x=this.importsCache.get(i);if(x)return this._load(x,m);const w=this.map._requestManager.transformRequest(i,n.R.Style);this._request=n.n(w,(A,k)=>{if(this._request=null,A)this.fire(new n.t(A));else if(k)return this.importsCache.set(i,k),this._load(k,m)})}loadJSON(i,s={}){this.fire(new n.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=n.q.frame(()=>{this._request=null,this._load(i,s.validate!==!1)})}loadEmpty(){this.fire(new n.x("dataloading",{dataType:"style"})),this._load(sl,!1)}_loadImports(i,s,m){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of i){const A=this._createFragmentStyle(w),k=new Promise(j=>{A.once("style.import.load",j),A.once("error",j)}).then(()=>this.mergeAll());if(x.push(k),this.resolvedImports.has(w.url)){A.loadEmpty();continue}const U=w.data||this.importsCache.get(w.url);U?(A.loadJSON(U,{validate:s}),this._isInternalStyle(U)&&(A.globalId=null)):w.url?A.loadURL(w.url,{validate:s}):A.loadEmpty();const W={style:A,id:w.id,config:w.config};if(m){const j=this.fragments.findIndex(({id:Y})=>Y===m);this.fragments=this.fragments.slice(0,j).concat(W).concat(this.fragments.slice(j))}else this.fragments.push(W)}return Promise.allSettled(x)}getImportGlobalIds(i=this,s=new Set){for(const m of i.fragments)m.style.globalId&&s.add(m.style.globalId),this.getImportGlobalIds(m.style,s);return[...s.values()]}_createFragmentStyle(i){const s=this.scope?n.av(i.id,this.scope):i.id;let m;const x=this._initialConfig&&this._initialConfig[s];(i.config||x)&&(m=n.l({},i.config,x));const w=new Ha(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,s){const m=i.schema;if(this._isInternalStyle(i)){const A=n.l({},sl,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(A,s)}if(this.updateConfig(this._config,m),s&&Go(this,Ro(i)))return;this._loaded=!0,this.stylesheet=n.cm(i);const x=()=>{for(const W in i.sources)this.addSource(W,i.sources[W],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const A=Yi(this.stylesheet.layers);if(this._order=A.map(W=>W.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const W=this.stylesheet.lights[0];this.light=new Zt(W.properties,W.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Zt(this.stylesheet.light)),this._layers={};for(const W of A){const j=n.cq(W,this.scope,this._styleColorTheme.lut,this.options);j.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j;const Y=this.getOwnLayerSourceCache(j),J=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Y&&j.canCastShadows()&&J&&(Y.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.x("data",{dataType:"style"}));const U=this.isRootStyle();i.imports?this._loadImports(i.imports,s).then(()=>{this._reloadImports(),this.fire(new n.x(U?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.x(U?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const A=this._evaluateColorThemeData(w);this._loadColorTheme(A).then(()=>{x()}).catch(k=>{n.w(`Couldn't load color theme from the stylesheet: ${k}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,s,m,x,w,A,k,U;const W={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(j.light!=null&&(i=j.light),j.stylesheet.lights)for(const Y of j.stylesheet.lights)Y.type==="ambient"&&j.ambientLight!=null&&(s=j.ambientLight),Y.type==="directional"&&j.directionalLight!=null&&(m=j.directionalLight);x=this._prioritizeTerrain(x,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(w=j.fog),j.stylesheet.camera!=null&&(U=j.stylesheet.camera),j.stylesheet.projection!=null&&(A=j.stylesheet.projection),j.stylesheet.transition!=null&&(k=j.stylesheet.transition),W[j.scope]=j._styleColorTheme}}),this.light=i,this.ambientLight=s,this.directionalLight=m,this.fog=w,this._styleColorThemeForScope=W,x===null?delete this.terrain:this.terrain=x,this.camera=U||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=n.l({},Bm,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const s=m=>{for(const x of m.fragments)s(x.style);i(m)};s(this)}_prioritizeTerrain(i,s,m){const x=i&&i.drapeRenderMode===0;return m===null?s&&s.drapeRenderMode===0?s:x?i:null:s!=null&&(!i||x||s&&s.drapeRenderMode===1)?s:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{i=this._prioritizeTerrain(i,s.terrain,s.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(i=s.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},s={},m={};this.forEachFragmentStyle(x=>{for(const w in x._sourceCaches){const A=n.av(w,x.scope);i[A]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const A=n.av(w,x.scope);s[A]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const A=n.av(w,x.scope);m[A]=x._symbolSourceCaches[w]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=m}mergeLayers(){const i={},s=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(w=>{for(const k of w._order){const U=w._layers[k];if(U.type==="slot"){const W=n.cn(k);if(i[W])continue;i[W]=[]}U.slot&&i[U.slot]?i[U.slot].push(U):s.push(U)}const{featuresets:A}=w.stylesheet||{};if(A)for(const k in A){const{selectors:U}=A[k];for(const W of U){const j=w._layers[W.layer],Y=this._mergedLayerSelectors.get(j.fqid)||[];let J;if(W.properties)for(const oe in W.properties){const pe=n.M(W.properties[oe]);pe.result==="success"&&(J=J||{},J[oe]=pe.value)}Y.push({featuresetId:k,featureNamespace:W.featureNamespace,properties:J}),this._mergedLayerSelectors.set(j.fqid,Y)}}}),this._mergedOrder=[];const x=(w=[])=>{for(const A of w)if(A.type==="slot"){const k=n.cn(A.id);i[k]&&x(i[k]),this._mergedSlots.push(k)}else{const k=n.av(A.id,A.scope);this._mergedOrder.push(k),m[k]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0),A.type==="clip"&&(this._clipLayerPresent=!0)}};x(s),this._mergedOrder.sort((w,A)=>{const k=m[w],U=m[A];return k.hasInitialOcclusionOpacityProperties?U.is3D()?1:0:k.is3D()&&U.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=n.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(s,m,x){const w=n.l({},m);for(const k of Object.keys(n._.colorTheme))w[k]===void 0&&(w[k]=n._.colorTheme[k].default);const A=new n.$(pf,s,new Map(x));return A.setTransitionOrValue(w,x),A.untransitioned().possiblyEvaluate(new n.a3(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,x)=>{const w="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let A=i;A.startsWith(w)||(A=w+A);const k="mapbox-reserved-lut",U=new Image;U.src=A,U.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},U.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void m();this._styleColorTheme.lutLoading=!1;const{width:W,height:j,data:Y}=n.q.getImageData(U);if(j>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(W!==j*j)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(k)&&this.removeImage(k),this.addImage(k,{data:new n.r({width:W,height:j},Y),pixelRatio:1,sdf:!1,version:0});const J=this.imageManager.getImage(k,this.scope);J?(this._styleColorTheme.lut={image:J.data,data:i},m()):x(new Error("Missing LUT image."))}})}getLut(i){const s=this._styleColorThemeForScope[i];return s?s.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(s,m,x){let w,A,k;const U=n.q.devicePixelRatio>1?"@2x":"";let W=n.n(m.transformRequest(m.normalizeSpriteURL(s,U,".json"),n.R.SpriteJSON),(J,oe)=>{W=null,k||(k=J,w=oe,Y())}),j=n.o(m.transformRequest(m.normalizeSpriteURL(s,U,".png"),n.R.SpriteImage),(J,oe)=>{j=null,k||(k=J,A=oe,Y())});function Y(){if(k)x(k);else if(w&&A){const J=n.q.getImageData(A),oe={};for(const pe in w){const{width:ue,height:_e,x:ge,y:Oe,sdf:Ge,pixelRatio:He,stretchX:Qe,stretchY:nt,content:tt}=w[pe],at=new n.r({width:ue,height:_e});n.r.copy(J,at,{x:ge,y:Oe},{x:0,y:0},{width:ue,height:_e},null),oe[pe]={data:at,pixelRatio:He,sdf:Ge,stretchX:Qe,stretchY:nt,content:tt}}x(null,oe)}}return{cancel(){W&&(W.cancel(),W=null),j&&(j.cancel(),j=null)}}}(i,this.map._requestManager,(s,m)=>{if(this._spriteRequest=null,s)this.fire(new n.t(s));else if(m)for(const x in m)this.imageManager.addImage(x,this.scope,m[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.x("data",{dataType:"style"}))})}_validateLayer(i){const s=this.getOwnSource(i.source);if(!s)return;const m=i.sourceLayer;m&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(m)===-1)&&this.fire(new n.t(new Error(`Source layer "${m}" does not exist on source "${s.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,s)=>{const m=this.fragments[s];return m&&m.style&&(i.data=m.style.serialize()),i})}_serializeSources(){const i={};for(const s in this._sourceCaches){const m=this._sourceCaches[s].getSource();i[m.id]||(i[m.id]=m.serialize())}return i}_serializeLayers(i){const s=[];for(const m of i){const x=this._layers[m];x&&x.type!=="custom"&&s.push(x.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const s=this.getOwnLayer(i);if(s)return s;this.fire(new n.t(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const s=this.getOwnSource(i);if(s)return s;this.fire(new n.t(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,s){const m=this.map.painter;if(m)for(let x=i.minzoom||0;x<(i.maxzoom||25.5);x++){const w=i.getProgramIds();if(w)for(const A of w){const k=i.getDefaultProgramParams(A,s.zoom,this._styleColorTheme.lut);k&&(m.style=this,this.fog&&(m._fogVisible=!0,k.overrideFog=!0,m.getOrCreateProgram(A,k)),m._fogVisible=!1,k.overrideFog=!1,m.getOrCreateProgram(A,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,m.getOrCreateProgram(A,k)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const s=this.calculateLightsBrightness();i.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const m=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const A=this._changes.getLayerUpdatesByScope();for(const k in A){const{updatedIds:U,removedIds:W}=A[k];(U||W)&&(this._updateWorkerLayers(k,U,W),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const w={};for(const A in this._mergedSourceCaches){const k=this._mergedSourceCaches[A];w[A]=k.used,k.used=!1,k.tileCoverLift=0}for(const A of this._mergedOrder){const k=this._mergedLayers[A];if(k.recalculate(i,this._availableImages),!k.isHidden(i.zoom)){const U=this.getLayerSourceCache(k);U&&(U.used=!0,U.tileCoverLift=Math.max(U.tileCoverLift,k.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(k,i)}):this.precompilePrograms(k,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(const A in w){const k=this._mergedSourceCaches[A];w[A]!==k.used&&k.getSource().fire(new n.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new n.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,s,m){const x=this.getFragmentStyle(i);x&&this.dispatcher.broadcast("updateLayers",{layers:s?x._serializeLayers(s):[],scope:i,removedIds:m||[],options:x.options})}setState(i,s){if(this._checkLoaded(),Go(this,Ro(i)))return!1;(i=n.cm(i)).layers=Yi(i.layers);const m=function(A,k){if(!A)return[{command:fe.setStyle,args:[k]}];let U=[];try{if(!n.bi(A.version,k.version))return[{command:fe.setStyle,args:[k]}];if(n.bi(A.center,k.center)||U.push({command:fe.setCenter,args:[k.center]}),n.bi(A.zoom,k.zoom)||U.push({command:fe.setZoom,args:[k.zoom]}),n.bi(A.bearing,k.bearing)||U.push({command:fe.setBearing,args:[k.bearing]}),n.bi(A.pitch,k.pitch)||U.push({command:fe.setPitch,args:[k.pitch]}),n.bi(A.sprite,k.sprite)||U.push({command:fe.setSprite,args:[k.sprite]}),n.bi(A.glyphs,k.glyphs)||U.push({command:fe.setGlyphs,args:[k.glyphs]}),n.bi(A.imports,k.imports)||function(oe=[],pe=[],ue){pe=pe||[];const _e=(oe=oe||[]).map(Mi),ge=pe.map(Mi),Oe=oe.reduce(Wi,{}),Ge=pe.reduce(Wi,{}),He=_e.slice();let Qe,nt,tt,at;for(Qe=0,nt=0;Qe<_e.length;Qe++)tt=_e[Qe],Ge.hasOwnProperty(tt)?nt++:(ue.push({command:fe.removeImport,args:[tt]}),He.splice(He.indexOf(tt,nt),1));for(Qe=0,nt=0;Qe<ge.length;Qe++)tt=ge[ge.length-1-Qe],He[He.length-1-Qe]!==tt&&(Oe.hasOwnProperty(tt)?(ue.push({command:fe.removeImport,args:[tt]}),He.splice(He.lastIndexOf(tt,He.length-nt),1)):nt++,at=He[He.length-Qe],ue.push({command:fe.addImport,args:[Ge[tt],at]}),He.splice(He.length-Qe,0,tt));for(const wt of pe){const Ot=Oe[wt.id];Ot&&!n.bi(Ot,wt)&&ue.push({command:fe.updateImport,args:[wt.id,wt]})}}(A.imports,k.imports,U),n.bi(A.transition,k.transition)||U.push({command:fe.setTransition,args:[k.transition]}),n.bi(A.light,k.light)||U.push({command:fe.setLight,args:[k.light]}),n.bi(A.fog,k.fog)||U.push({command:fe.setFog,args:[k.fog]}),n.bi(A.projection,k.projection)||U.push({command:fe.setProjection,args:[k.projection]}),n.bi(A.lights,k.lights)||U.push({command:fe.setLights,args:[k.lights]}),n.bi(A.camera,k.camera)||U.push({command:fe.setCamera,args:[k.camera]}),!n.bi(A["color-theme"],k["color-theme"]))return[{command:fe.setStyle,args:[k]}];const W={},j=[];(function(oe,pe,ue,_e){let ge;for(ge in pe=pe||{},oe=oe||{})oe.hasOwnProperty(ge)&&(pe.hasOwnProperty(ge)||Ee(ge,ue,_e));for(ge in pe){if(!pe.hasOwnProperty(ge))continue;const Oe=pe[ge];oe.hasOwnProperty(ge)?n.bi(oe[ge],Oe)||(oe[ge].type==="geojson"&&Oe.type==="geojson"&&Pe(oe,pe,ge)?ue.push({command:fe.setGeoJSONSourceData,args:[ge,Oe.data]}):Ke(ge,pe,ue,_e)):me(ge,pe,ue)}})(A.sources,k.sources,j,W);const Y=[];A.layers&&A.layers.forEach(oe=>{oe.source&&W[oe.source]?U.push({command:fe.removeLayer,args:[oe.id]}):Y.push(oe)});let J=A.terrain;J&&W[J.source]&&(U.push({command:fe.setTerrain,args:[void 0]}),J=void 0),U=U.concat(j),n.bi(J,k.terrain)||U.push({command:fe.setTerrain,args:[k.terrain]}),function(oe,pe,ue){pe=pe||[];const _e=(oe=oe||[]).map(Mi),ge=pe.map(Mi),Oe=oe.reduce(Wi,{}),Ge=pe.reduce(Wi,{}),He=_e.slice(),Qe=Object.create(null);let nt,tt,at,wt,Ot,Ct,St;for(nt=0,tt=0;nt<_e.length;nt++)at=_e[nt],Ge.hasOwnProperty(at)?tt++:(ue.push({command:fe.removeLayer,args:[at]}),He.splice(He.indexOf(at,tt),1));for(nt=0,tt=0;nt<ge.length;nt++)at=ge[ge.length-1-nt],He[He.length-1-nt]!==at&&(Oe.hasOwnProperty(at)?(ue.push({command:fe.removeLayer,args:[at]}),He.splice(He.lastIndexOf(at,He.length-tt),1)):tt++,Ct=He[He.length-nt],ue.push({command:fe.addLayer,args:[Ge[at],Ct]}),He.splice(He.length-nt,0,at),Qe[at]=!0);for(nt=0;nt<ge.length;nt++)if(at=ge[nt],wt=Oe[at],Ot=Ge[at],!Qe[at]&&!n.bi(wt,Ot))if(n.bi(wt.source,Ot.source)&&n.bi(wt["source-layer"],Ot["source-layer"])&&n.bi(wt.type,Ot.type)){for(St in ci(wt.layout,Ot.layout,ue,at,null,fe.setLayoutProperty),ci(wt.paint,Ot.paint,ue,at,null,fe.setPaintProperty),n.bi(wt.slot,Ot.slot)||ue.push({command:fe.setSlot,args:[at,Ot.slot]}),n.bi(wt.filter,Ot.filter)||ue.push({command:fe.setFilter,args:[at,Ot.filter]}),n.bi(wt.minzoom,Ot.minzoom)&&n.bi(wt.maxzoom,Ot.maxzoom)||ue.push({command:fe.setLayerZoomRange,args:[at,Ot.minzoom,Ot.maxzoom]}),wt)wt.hasOwnProperty(St)&&St!=="layout"&&St!=="paint"&&St!=="filter"&&St!=="metadata"&&St!=="minzoom"&&St!=="maxzoom"&&St!=="slot"&&(St.indexOf("paint.")===0?ci(wt[St],Ot[St],ue,at,St.slice(6),fe.setPaintProperty):n.bi(wt[St],Ot[St])||ue.push({command:fe.setLayerProperty,args:[at,St,Ot[St]]}));for(St in Ot)Ot.hasOwnProperty(St)&&!wt.hasOwnProperty(St)&&St!=="layout"&&St!=="paint"&&St!=="filter"&&St!=="metadata"&&St!=="minzoom"&&St!=="maxzoom"&&St!=="slot"&&(St.indexOf("paint.")===0?ci(wt[St],Ot[St],ue,at,St.slice(6),fe.setPaintProperty):n.bi(wt[St],Ot[St])||ue.push({command:fe.setLayerProperty,args:[at,St,Ot[St]]}))}else ue.push({command:fe.removeLayer,args:[at]}),Ct=He[He.lastIndexOf(at)+1],ue.push({command:fe.addLayer,args:[Ot,Ct]})}(Y,k.layers,U)}catch(W){console.warn("Unable to compute style diff:",W),U=[{command:fe.setStyle,args:[k]}]}return U}(this.serialize(),i).filter(A=>!(A.command in Qn));if(m.length===0)return!1;const x=m.filter(A=>!(A.command in os));if(x.length>0)throw new Error(`Unimplemented: ${x.map(A=>A.command).join(", ")}.`);const w=[];return m.forEach(A=>{w.push(this[A.command].apply(this,A.args))}),s&&Promise.all(w).then(s),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,s){return this.getImage(i)?this.fire(new n.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,s),this._afterImageUpdated(i),this)}updateImage(i,s){this.imageManager.updateImage(i,this.scope,s)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new n.t(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,s,m={}){return this._checkLoaded(),this._validate(Rt,`models.${i}`,s,null,m)||(this.modelManager.addModel(i,s,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new n.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,s,m={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(_s,`sources.${i}`,s,null,m))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const x=ml(i,s,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const w=A=>{const k=(A?"symbol:":"other:")+x.id,U=n.av(k,this.scope),W=this._sourceCaches[k]=new Me(U,x,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=W,W.onAdd(this.map)};w(!1),s.type!=="vector"&&s.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const s=this.getOwnSource(i);if(!s)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new n.t(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new n.t(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this.getOwnSourceCaches(i);for(const x of m){const w=n.cn(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new n.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,s){this._checkLoaded(),this.getOwnSource(i).setData(s),this._changes.setDirty()}getOwnSource(i){const s=this.getOwnSourceCache(i);return s&&s.getSource()}getOwnSources(){const i=[];for(const s in this._otherSourceCaches){const m=this.getOwnSourceCache(s);m&&i.push(m.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const s in i){const m=i[s]._tiles;for(const x in m){const w=m[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const x of i){if(this._validate(Dr,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(s)}else this.ambientLight=new er(x,Zr||(Zr=new n.a0({color:new n.a1(n._.properties_light_ambient.color),intensity:new n.a1(n._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(s)}else this.directionalLight=new er(x,Gr||(Gr=new n.a0({direction:new n.ad(n._.properties_light_directional.direction),color:new n.a1(n._.properties_light_directional.color),intensity:new n.a1(n._.properties_light_directional.intensity),"cast-shadows":new n.a1(n._.properties_light_directional["cast-shadows"]),"shadow-intensity":new n.a1(n._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=new n.a3(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,s=this.ambientLight;if(!i||!s)return;const m=J=>.2126*(J[0]<=.03928?J[0]/12.92:Math.pow((J[0]+.055)/1.055,2.4))+.7152*(J[1]<=.03928?J[1]/12.92:Math.pow((J[1]+.055)/1.055,2.4))+.0722*(J[2]<=.03928?J[2]/12.92:Math.pow((J[2]+.055)/1.055,2.4)),x=i.properties.get("color").toRenderColor(null).toArray01(),w=i.properties.get("intensity"),A=i.properties.get("direction"),k=1-n.c8(A.x,A.y,A.z)[2]/90,U=m(x)*w*k,W=s.properties.get("color").toRenderColor(null).toArray01(),j=s.properties.get("intensity"),Y=m(W)*j;return Number(((U+Y)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(n.aK(i)){const s=n.co(i),m=this.fragments.find(({id:w})=>w===s);if(!m)throw new Error(`Style import '${i}' not found`);const x=n.cn(i);return m.style.getFragmentStyle(x)}{const s=this.fragments.find(({id:m})=>m===i);if(!s)throw new Error(`Style import '${i}' not found`);return s.style}}getFeaturesetDescriptors(i){const s=this.getFragmentStyle(i);if(!s||!s.stylesheet.featuresets)return[];const m=[];for(const x in s.stylesheet.featuresets)m.push({featuresetId:x,importId:s.scope?s.scope:void 0});return m}getFeaturesetLayers(i,s){const m=this.getFragmentStyle(s),x=m.stylesheet.featuresets;if(!x||!x[i])return this.fire(new n.t(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const A of x[i].selectors){const k=m.getOwnLayer(A.layer);k&&w.push(k)}return w}getConfigProperty(i,s){const m=this.getFragmentStyle(i);if(!m)return null;const x=n.av(s,m.scope),w=m.options.get(x),A=w?w.value||w.default:null;return A?A.serialize():null}setConfigProperty(i,s,m){const x=this.getFragmentStyle(i);if(!x)return;const w=x.stylesheet.schema;if(!w||!w[s])return;const A=n.M(m);if(A.result!=="success")return void Go(this,A.value);const k=A.value.expression,U=n.av(s,x.scope),W=x.options.get(U);if(!W)return;let j;const{minValue:Y,maxValue:J,stepValue:oe,type:pe,values:ue}=w[s],_e=n.M(w[s].default);_e.result==="success"&&(j=_e.value.expression),j?(this.options.set(U,{...W,value:k,default:j,minValue:Y,maxValue:J,stepValue:oe,type:pe,values:ue}),this.updateConfigDependencies(s)):this.fire(new n.t(new Error(`No schema defined for the config option "${s}" in the "${i}" fragment.`)))}getConfig(i){const s=this.getFragmentStyle(i);if(!s)return null;const m=s.stylesheet.schema;if(!m)return null;const x={};for(const w in m){const A=n.av(w,s.scope),k=s.options.get(A),U=k?k.value||k.default:null;x[w]=U?U.serialize():null}return x}setConfig(i,s){const m=this.getFragmentStyle(i);m&&(m.updateConfig(s,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const s=this.getFragmentStyle(i);return s?s.stylesheet.schema:null}setSchema(i,s){const m=this.getFragmentStyle(i);m&&(m.stylesheet.schema=s,m.updateConfig(m._config,s),this.updateConfigDependencies())}updateConfig(i,s){if(this._config=i,i||s)if(s)for(const m in s){let x,w;const A=n.M(s[m].default);if(A.result==="success"&&(x=A.value.expression),i&&i[m]!==void 0){const J=n.M(i[m]);J.result==="success"&&(w=J.value.expression)}const{minValue:k,maxValue:U,stepValue:W,type:j,values:Y}=s[m];if(x){const J=n.av(m,this.scope);this.options.set(J,{default:x,value:w,minValue:k,maxValue:U,stepValue:W,type:j,values:Y})}else this.fire(new n.t(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new n.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const s of this._configDependentLayers){const m=this.getLayer(s);if(m){if(i&&!m.configDependencies.has(i))continue;m.possiblyEvaluateVisibility(),this._updateLayer(m)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(s=>{if(s._styleColorTheme.colorTheme){const m=s._evaluateColorThemeData(s._styleColorTheme.colorTheme);(!s._styleColorTheme.lut&&m!==""||s._styleColorTheme.lut&&m!==s._styleColorTheme.lut.data)&&s.setColorTheme(s._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,s,m={}){this._checkLoaded();const x=i.id;if(this._layers[x])return void this.fire(new n.t(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(i.type==="custom"){if(Go(this,n.cp(i)))return;w=n.cq(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=n.cm(i),i=n.l(i,{source:x})),this._validate(ai,`layers.${x}`,i,{arrayIndex:-1},m))return;w=n.cq(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}})}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let A=this._order.length;if(s){const j=this._order.indexOf(s);if(j===-1)return void this.fire(new n.t(new Error(`Layer with id "${s}" does not exist on this map.`)));w.slot===this._layers[s].slot?A=j:n.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const k=this.getOwnLayerSourceCache(w),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&w.canCastShadows()&&U&&(k.castsShadows=!0);const W=this._changes.getRemovedLayer(w);if(W&&w.source&&k&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const j=n.av(w.source,w.scope);W.type!==w.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),k.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(i,s){this._checkLoaded();const m=this._checkLayer(i);if(!m||i===s)return;const x=this._order.indexOf(i);this._order.splice(x,1);let w=this._order.length;if(s){const A=this._order.indexOf(s);if(A===-1)return void this.fire(new n.t(new Error(`Layer with id "${s}" does not exist on this map.`)));m.slot===this._layers[s].slot?w=A:n.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const s=this._checkLayer(i);if(!s)return;s.setEventedParent(null);const m=this._order.indexOf(i);this._order.splice(m,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const x=this.getOwnLayerSourceCache(s);if(x&&x.castsShadows){let w=!1;for(const A in this._layers)if(this._layers[A].source===s.source&&this._layers[A].canCastShadows()){w=!0;break}x.castsShadows=w}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const s in this._layers)if(this._layers[s].type===i)return!0;return!1}setLayerZoomRange(i,s,m){this._checkLoaded();const x=this._checkLayer(i);x&&(x.minzoom===s&&x.maxzoom===m||(s!=null&&(x.minzoom=s),m!=null&&(x.maxzoom=m),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,s){this._checkLoaded();const m=this._checkLayer(i);m&&m.slot!==s&&(m.slot=s,this._updateLayer(m))}setFilter(i,s,m={}){this._checkLoaded();const x=this._checkLayer(i);if(x&&!n.bi(x.filter,s))return s==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(ye,`layers.${x.id}.filter`,s,{layerType:x.type},m)||(x.filter=n.cm(s),this._updateLayer(x)))}getFilter(i){const s=this._checkLayer(i);if(s)return n.cm(s.filter)}setLayoutProperty(i,s,m,x={}){this._checkLoaded();const w=this._checkLayer(i);if(w&&!n.bi(w.getLayoutProperty(s),m)){if(m!=null&&(!x||x.validate!==!1)&&Go(w,Je.call(Ro,{key:`layers.${i}.layout.${s}`,layerType:w.type,objectKey:s,value:m,styleSpec:n._,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(s,m),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(i,s){const m=this._checkLayer(i);if(m)return m.getLayoutProperty(s)}setPaintProperty(i,s,m,x={}){this._checkLoaded();const w=this._checkLayer(i);if(!w||n.bi(w.getPaintProperty(s),m)||m!=null&&(!x||x.validate!==!1)&&Go(w,re.call(Ro,{key:`layers.${i}.paint.${s}`,layerType:w.type,objectKey:s,value:m,styleSpec:n._})))return;const A=w.setPaintProperty(s,m);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),A&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(i,s){const m=this._checkLayer(i);if(m)return m.getPaintProperty(s)}setFeatureState(i,s){this._checkLoaded();const m=i.featureset;if(m){if("featuresetId"in m){const W=this.getFragmentStyle(m.importId),j=W.getFeaturesetLayers(m.featuresetId);for(const{source:Y,sourceLayer:J}of j)W.setFeatureState({id:i.id,source:Y,sourceLayer:J},s)}else if("layerId"in m){const W=this.getLayer(m.layerId);this.setFeatureState({id:i.id,source:W.source,sourceLayer:W.sourceLayer},s)}return}const x=i.source,w=i.sourceLayer,A=this._checkSource(x);if(!A)return;const k=A.type;if(k==="geojson"&&w)return void this.fire(new n.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(k==="vector"&&!w)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided.")));const U=this.getOwnSourceCaches(x);for(const W of U)W.setFeatureState(w,i.id,s)}removeFeatureState(i,s){this._checkLoaded();const m=i.featureset;if(m){if("featuresetId"in m){const W=this.getFragmentStyle(m.importId),j=W.getFeaturesetLayers(m.featuresetId);for(const{source:Y,sourceLayer:J}of j)W.removeFeatureState({id:i.id,source:Y,sourceLayer:J},s)}else if("layerId"in m){const W=this.getLayer(m.layerId);this.removeFeatureState({id:i.id,source:W.source,sourceLayer:W.sourceLayer},s)}return}const x=i.source,w=this._checkSource(x);if(!w)return;const A=w.type,k=A==="vector"?i.sourceLayer:void 0;if(A==="vector"&&!k)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new n.t(new Error("A feature id is required to remove its specific state property.")));const U=this.getOwnSourceCaches(x);for(const W of U)W.removeFeatureState(k,i.id,s)}getFeatureState(i){this._checkLoaded();const s=i.featureset;if(s){let A;if("featuresetId"in s){const k=this.getFragmentStyle(s.importId),U=k.getFeaturesetLayers(s.featuresetId);for(const{source:W,sourceLayer:j}of U){const Y=k.getFeatureState({id:i.id,source:W,sourceLayer:j});if(Y&&!A)A=Y;else if(!n.bi(A,Y))return void this.fire(new n.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i){const k=this.getLayer(s.layerId);A=this.getFeatureState({id:i.id,source:k.source,sourceLayer:k.sourceLayer})}return A}const m=i.source,x=i.sourceLayer,w=this._checkSource(m);if(w){if(w.type!=="vector"||x)return i.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(m)[0].getFeatureState(x,i.id);this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=n.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),s=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return n.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateFilteredLayers(i){for(const s of Object.values(this._mergedLayers))i(s)&&this._updateLayer(s)}_updateLayer(i){this._changes.updateLayer(i);const s=this.getLayerSourceCache(i),m=n.av(i.source,i.scope),x=this._changes.getUpdatedSourceCaches();i.source&&!x[m]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),s.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const s=k=>this._mergedLayers[k].is3D(),m=this.order,x={},w=[];for(let k=m.length-1;k>=0;k--){const U=m[k];if(s(U)){x[U]=k;for(const W of i){const j=W[U];if(j)for(const Y of j)w.push(Y)}}}w.sort((k,U)=>U.intersectionZ-k.intersectionZ);const A=[];for(let k=m.length-1;k>=0;k--){const U=m[k];if(s(U))for(let W=w.length-1;W>=0;W--){const j=w[W].feature;if(j.layer&&x[j.layer.id]<k)break;A.push(j),w.pop()}else for(const W of i){const j=W[U];if(j)for(const Y of j)A.push(Y.feature)}}return A}queryRenderedFeatures(i,s,m){s&&!Array.isArray(s)&&s.filter&&this._validate(ye,"queryRenderedFeatures.filter",s.filter,null,s);let x,w=!1;const A=new Set;if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new n.t(new Error("parameters.layers must be an Array."))),[];x=[];for(const j of s.layers){const Y=this._mergedLayers[j];if(!Y)return this.fire(new n.t(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];Y.is3D()&&(w=!0),A.add(Y.source),x.push(j)}}else w=this.has3DLayers();const k=this._queryRenderedFeatures(i,m,{layerIds:x,filter:s.filter,has3DLayers:w,includedSources:A}),U=this._flattenAndSortRenderedFeatures(k),W=[];for(const j of U)n.co(j.layer.id)===this.scope&&W.push(j);return W}queryRenderedFeaturesForInteractions(i,s,m){let x=[];for(const{featureset:U,filter:W,radius:j}of s){let Y=!1;const J=[],oe=new Set;if("featuresetId"in U){const ue=this.getFeaturesetLayers(U.featuresetId,U.importId);if(ue.length===0)continue;for(const _e of ue)_e.is3D()&&(Y=!0),oe.add(_e.source),J.push(_e.fqid)}else if("layerId"in U){const ue=this._mergedLayers[U.layerId];if(!ue)return this.fire(new n.t(new Error(`The layer '${U.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];ue.is3D()&&(Y=!0),oe.add(ue.source),J.push(U.layerId)}let pe=i;if(j)if(i instanceof n.P||typeof i[0]=="number"){const ue=n.P.convert(i);pe=[[ue.x-j,ue.y-j],[ue.x+j,ue.y+j]]}else{const ue=n.P.convert(i[0]),_e=n.P.convert(i[1]);pe=[[ue.x-j,ue.y-j],[_e.x+j,_e.y+j]]}x=x.concat(this._queryRenderedFeatures(pe,m,{layerIds:J,filter:W,has3DLayers:Y,includedSources:oe}))}const w=this._flattenAndSortRenderedFeatures(x),A=(U,W,j)=>{const Y=U.clone();if(delete Y.layer,Y.featureset=W,j&&j.featureNamespace&&(Y.namespace=j.featureNamespace),j&&j.properties){const J={},oe=this.map.transform.zoom;for(const pe of Object.keys(j.properties)){const ue=j.properties[pe].evaluate({zoom:oe},U._vectorTileFeature,U.state,U.tile,this._availableImages);ue!=null&&(J[pe]=ue)}Y.properties=J}return Y},k=[];for(const U of w){const W=U.layer.id,j=n.cn(W),Y=n.co(W);for(const{featureset:J}of s){if("layerId"in J&&J.layerId!==W)continue;if("layerId"in J&&J.layerId===W){const pe=A(U,J);k.push(pe);continue}if("featuresetId"in J&&(J.importId!==Y||!this.getFeaturesetLayers(J.featuresetId,J.importId).map(pe=>pe.id).includes(j)))continue;const oe=this._mergedLayerSelectors.get(W)||[];for(const pe of oe){const ue=A(U,J,pe);k.push(ue)}}}return k}_queryRenderedFeatures(i,s,m){const{layerIds:x,filter:w,has3DLayers:A,includedSources:k}=m,U=[],W=yr.createFromScreenPoints(i,s);for(const j in this._mergedSourceCaches){if(!this._mergedSourceCaches[j].getSource())continue;const Y=this._mergedSourceCaches[j].getSource().id;x&&!k.has(Y)||U.push(nr(this._mergedSourceCaches[j],this._mergedLayers,W,w,x||[],this._availableImages,s,A,!!this.map._showQueryGeometry))}return this.placement&&U.push(function(j,Y,J,oe,pe,ue,_e,ge){const Oe={},Ge=_e.queryRenderedSymbols(J),He=[];for(const Qe of Object.keys(Ge).map(Number))He.push(ge[Qe]);He.sort(go);for(const Qe of He){const nt=Qe.featureIndex.lookupSymbolFeatures(Ge[Qe.bucketInstanceId],Qe.bucketIndex,Qe.sourceLayerIndex,oe,pe,ue,j);for(const tt in nt){const at=Oe[tt]=Oe[tt]||[],wt=nt[tt];wt.sort((Ot,Ct)=>{const St=Qe.featureSortOrder;if(St){const si=St.indexOf(Ot.featureIndex);return St.indexOf(Ct.featureIndex)-si}return Ct.featureIndex-Ot.featureIndex});for(const Ot of wt)at.push(Ot)}}for(const Qe in Oe)Oe[Qe].forEach(nt=>{const tt=nt.feature,at=j[Qe],wt=Y(at);if(!wt)return;const Ot=wt.getFeatureState(tt.layer["source-layer"],tt.id);tt.state=Ot,n.aK(at.id)||(tt.source=tt.layer.source,tt.layer["source-layer"]&&(tt.sourceLayer=tt.layer["source-layer"]))});return Oe}(this._mergedLayers,this.getLayerSourceCache.bind(this),W.screenGeometry,w,x||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),U}querySourceFeatures(i,s){const m=s&&s.filter;m&&this._validate(ye,"querySourceFeatures.filter",m,null,s);let x=[];const w=this.getOwnSourceCaches(i);for(const A of w)x=x.concat(qo(A,s));return x}addSourceType(i,s,m){return Ha.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(Ha.setSourceType(i,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:s.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,s,m={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const k in i)if(!n.bi(i[k],x[k])){w=!0;break}if(!w)return;const A=this._getTransitionParameters();this.light.setLight(i,s,m),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,s=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=i;const x=i.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof m.source=="object"){const k="terrain-dem-src";this.addSource(k,m.source),m=n.cm(m),m=n.l(m,{source:k})}const w=n.l({},m),A={};if(this.terrain&&x){w.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(A.style=k.serialize())}if(this._validate(ro,"terrain",w,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&s!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,s),this.fire(new n.x("data",{dataType:"style"}))}else{const w=this.terrain,A=w.get();for(const k of Object.keys(n._.terrain))!m.hasOwnProperty(k)&&n._.terrain[k].default&&(m[k]=n._.terrain[k].default);for(const k in i)if(!n.bi(i[k],A[k])){w.set(i,this.options),this.stylesheet.terrain=i;const U=this._getTransitionParameters({duration:0});w.updateTransitions(U),this.fire(new n.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const s=this.fog=new ar(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!n.bi(s.get(),i)){s.set(i,this.options),this.stylesheet.fog=s.get();const m=this._getTransitionParameters({duration:0});s.updateTransitions(m)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();const s=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void s();const m=this._evaluateColorThemeData(i);this._loadColorTheme(m).then(()=>{this.fire(new n.x("colorthemeset")),s()}).catch(x=>{n.w(`Couldn't set color theme: ${x}`)})}_getTransitionParameters(i){return{now:n.q.now(),transition:n.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],s=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?i.push(m):s.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...s)}_createTerrain(i,s){const m=this.terrain=new li(i,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const s=this._layers[i];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const s=this._layers[i];s.type==="symbol"&&this._updateLayer(s)}}_validate(i,s,m,x,w={}){if(w&&w.validate===!1)return!1;const A=n.l({},this.serialize());return Go(this,i.call(Ro,n.l({key:s,style:A,value:m,styleSpec:n._},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const s=this.getSourceCaches(i);for(const m of s)m.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const s=this.getSourceCaches(i);for(const m of s)m.resume(),m.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let s;this.directionalLight&&(s=rc(this.directionalLight));for(const m in this._mergedSourceCaches)this._mergedSourceCaches[m].update(i,void 0,void 0,s)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const s=this._sourceCaches[i];s.resume(),s.reload()}}_updatePlacement(i,s,m,x,w,A,k=!1){let U=!1,W=!1;const j={},Y={};for(const J of this._mergedOrder){const oe=this._mergedLayers[J];if(oe.type!=="symbol")continue;const pe=n.av(oe.source,oe.scope);let ue=j[pe];if(!ue){const ge=this.getLayerSourceCache(oe);if(!ge)continue;const Oe=ge.getRenderableIds(!0).map(Ge=>ge.getTileByID(Ge));Y[pe]=Oe.slice(),ue=j[pe]=Oe.sort((Ge,He)=>He.tileID.overscaledZ-Ge.tileID.overscaledZ||(Ge.tileID.isLessThan(He.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(oe,ue,s.center.lng,s.projection);U=U||_e}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new n.x("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),s.zoom))&&(this.pauseablePlacement=new nl(s,this._mergedOrder,k,m,x,w,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,Y,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),W=!0),U&&this.pauseablePlacement.placement.setStale()),W||U){this._buildingIndex.onNewFrame(s.zoom);for(let J=0;J<this._mergedOrder.length;J++){const oe=this._mergedLayers[this._mergedOrder[J]];if(oe.type!=="symbol")continue;const pe=this.isLayerClipped(oe);this.placement.updateLayerOpacities(oe,j[n.av(oe.source,oe.scope)],J,pe?A:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,s){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:w})=>w===i.id)!==-1)return void this.fire(new n.t(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!s)return m.push(i),this._loadImports([i],!0);const x=m.findIndex(({id:w})=>w===s);return x===-1&&this.fire(new n.t(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,x).concat(i).concat(m.slice(x)),this._loadImports([i],!0,s)}updateImport(i,s){this._checkLoaded();const m=this.stylesheet.imports||[],x=this.getImportIndex(i);return x===-1?this:typeof s=="string"?(this.setImportUrl(i,s),this):(s.url&&s.url!==m[x].url&&this.setImportUrl(i,s.url),n.bi(s.config,m[x].config)||this.setImportConfig(i,s.config),n.bi(s.data,m[x].data)||this.setImportData(i,s.data),this)}moveImport(i,s){this._checkLoaded();let m=this.stylesheet.imports||[];const x=this.getImportIndex(i);if(x===-1)return this;const w=this.getImportIndex(s);if(w===-1)return this;const A=m[x],k=this.fragments[x];return m=m.filter(({id:U})=>U!==i),this.fragments=this.fragments.filter(({id:U})=>U!==i),this.stylesheet.imports=m.slice(0,w).concat(A).concat(m.slice(w)),this.fragments=this.fragments.slice(0,w).concat(k).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(i,s){this._checkLoaded();const m=this.stylesheet.imports||[],x=this.getImportIndex(i);if(x===-1)return this;m[x].url=s;const w=this.fragments[x];return w.style=this._createFragmentStyle(m[x]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(s),this}setImportData(i,s){this._checkLoaded();const m=this.getImportIndex(i),x=this.stylesheet.imports||[];return m===-1?this:s?(this.fragments[m].style.setState(s),this._reloadImports(),this):(delete x[m].data,this.setImportUrl(i,x[m].url))}setImportConfig(i,s){this._checkLoaded();const m=this.getImportIndex(i),x=this.stylesheet.imports||[];if(m===-1)return this;s?x[m].config=s:delete x[m].config;const w=this.fragments[m],A=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=s,w.style.updateConfig(s,A),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const s=this.stylesheet.imports||[],m=this.getImportIndex(i);m!==-1&&(s.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(i){const s=(this.stylesheet.imports||[]).findIndex(m=>m.id===i);return s===-1&&this.fire(new n.t(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),s}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const s in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[s];m&&i.push(m.getSource())}return i}getSource(i,s){const m=this.getSourceCache(i,s);return m&&m.getSource()}getLayerSource(i){const s=this.getLayerSourceCache(i);return s&&s.getSource()}getSourceCache(i,s){const m=n.av(i,s);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(i){const s=n.av(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[i]&&s.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&s.push(this._mergedSymbolSourceCaches[i]),s}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const s in i){const m=i[s];m==="reload"?this.reloadSource(s):m==="clear"&&this.clearSource(s)}}updateLayers(i){const s=this._changes.getUpdatedPaintProperties();for(const m of s){const x=this.getLayer(m);x&&x.updateTransitions(i)}}getImages(i,s,m){this.imageManager.getImages(s.icons,s.scope,m),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(s.tileID.key,s.type,s.icons)};x(this._otherSourceCaches[s.source]),x(this._symbolSourceCaches[s.source])}getGlyphs(i,s,m){this.glyphManager.getGlyphs(s.stacks,s.scope,m)}getResource(i,s,m){return n.ct(s,m)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const s=[];return this._otherSourceCaches[i]&&s.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&s.push(this._symbolSourceCaches[i]),s}_isSourceCacheLoaded(i){const s=this.getOwnSourceCaches(i);return s.length===0?(this.fire(new n.t(new Error(`There is no source with ID '${i}'`))),!1):s.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,s){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const m=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(m||s&&s.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ha.getSourceType=function(f){return Ua[f]},Ha.setSourceType=function(f,i){Ua[f]=i},Ha.registerForPluginStateChange=n.cd;var Nm=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ff=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,mf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Xd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ih=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,yu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ml=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,gf=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Yd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,id=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ra=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const nh=[];Pa(Nm,nh),Pa(mf,nh),Pa(ff,nh);const sc={"_prelude_fog.vertex.glsl":yu,"_prelude_terrain.vertex.glsl":ih,"_prelude_shadow.vertex.glsl":id,"_prelude_fog.fragment.glsl":Ml,"_prelude_shadow.fragment.glsl":Ra,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":gf,"_prelude_raster_particle.glsl":Yd},vu={};zr("",ih),zr(Ml,yu),zr(Ra,id),zr(gf,""),zr(Yd,"");const Bc=zr(ff,mf),nd=Nm;var Wl={background:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:zr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:zr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:zr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:zr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:zr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:zr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:zr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:zr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:zr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:zr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:zr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:zr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:zr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:zr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:zr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Xd),skyboxGradient:zr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Xd),skyboxCapture:zr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:zr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:zr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:zr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:zr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:zr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),occlusion:zr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Pa(f,i){const s=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of s)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const w of x)i.includes(w)||i.push(w)}}function zr(f,i){const s=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(W=>{const j=W.split(" ");return j[j.length-1]}),x=[...new Set(x)]);const w={},A=[],k=[];if(f=f.replace(s,(W,j)=>(k.push(j),"")),(i=i.replace(s,(W,j)=>(A.push(j),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let U=[...nh];Pa(f,U),Pa(i,U);for(const W of[...A,...k])sc[W]||console.error(`Undefined include: ${W}`),vu[W]||(vu[W]=[],Pa(sc[W],vu[W])),U=[...U,...vu[W]];return{fragmentSource:f=f.replace(m,(W,j,Y,J,oe)=>(w[oe]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
in ${Y} ${J} ${oe};
#else
uniform ${Y} ${J} u_${oe};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${oe}
    ${Y} ${J} ${oe} = u_${oe};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
    in ${Y} ${J} ${oe};
#endif
`:j==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(m,(W,j,Y,J,oe)=>{const pe=J==="float"?"vec2":J,ue=oe.match(/color/)?"color":pe;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
in ${Y} ${J} a_${oe};
#endif
`:w[oe]?j==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
in ${Y} ${pe} a_${oe};
out ${Y} ${J} ${oe};
#else
uniform ${Y} ${J} u_${oe};
#endif
`:j==="initialize"?ue==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = a_${oe};
#else
    ${Y} ${J} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = unpack_mix_${ue}(a_${oe}, u_${oe}_t);
#else
    ${Y} ${J} ${oe} = u_${oe};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
    in ${Y} ${J} a_${oe};
    out ${Y} ${J} ${oe};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
    ${oe} = a_${oe};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
in ${Y} ${pe} a_${oe};
#else
uniform ${Y} ${J} u_${oe};
#endif
`:j==="define-instanced"?ue==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${oe}0;
in vec4 a_${oe}1;
in vec4 a_${oe}2;
in vec4 a_${oe}3;
#else
uniform ${Y} ${J} u_${oe};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Y} ${pe} a_${oe};
#else
uniform ${Y} ${J} u_${oe};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${oe}
    ${Y} ${J} ${oe} = a_${oe};
#endif
`:ue==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${Y} ${J} ${oe} = a_${oe};
#else
    ${Y} ${J} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${Y} ${J} ${oe} = unpack_mix_${ue}(a_${oe}, u_${oe}_t);
#else
    ${Y} ${J} ${oe} = u_${oe};
#endif
`}),staticAttributes:x,usedDefines:U,vertexIncludes:A,fragmentIncludes:k}}class xu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,s,m,x,w,A,k,U){this.context=i;let W=this.boundPaintVertexBuffers.length!==x.length;for(let Y=0;!W&&Y<x.length;Y++)this.boundPaintVertexBuffers[Y]!==x[Y]&&(W=!0);let j=this.boundDynamicVertexBuffers.length!==k.length;for(let Y=0;!j&&Y<k.length;Y++)this.boundDynamicVertexBuffers[Y]!==k[Y]&&(j=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==m||W||j||this.boundIndexBuffer!==w||this.boundVertexOffset!==A)this.freshBind(s,m,x,w,A,k,U);else{i.bindVertexArrayOES.set(this.vao);for(const Y of k)Y&&(Y.bind(),U&&Y.instanceCount&&Y.setVertexAttribDivisor(i.gl,s,U));w&&w.dynamicDraw&&w.bind()}}freshBind(i,s,m,x,w,A,k){const U=i.numAttributes,W=this.context,j=W.gl;this.vao&&this.destroy(),this.vao=W.gl.createVertexArray(),W.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=A,s.enableAttributes(j,i),s.bind(),s.setVertexAttribPointers(j,i,w);for(const Y of m)Y.enableAttributes(j,i),Y.bind(),Y.setVertexAttribPointers(j,i,w);for(const Y of A)Y&&(Y.enableAttributes(j,i),Y.bind(),Y.setVertexAttribPointers(j,i,w),k&&Y.instanceCount&&Y.setVertexAttribDivisor(j,i,k));x&&x.bind(),W.currentNumAttributes=U}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function rh(f,i){const s=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new n.a5(0,m/s).toLngLat().lat,new n.a5(0,(m+1)/s).toLngLat().lat]}function Kd(f,i,s,m,x,w,A){const k=f.context,U=k.gl,W=s.hillshadeFBO;if(!W)return;f.prepareDrawTile();const j=f.isTileAffectedByFog(i),Y=f.getOrCreateProgram("hillshade",{overrideFog:j});k.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,W.colorAttachment.get());const J=((_e,ge,Oe,Ge)=>{const He=Oe.paint.get("hillshade-shadow-color"),Qe=Oe.paint.get("hillshade-highlight-color"),nt=Oe.paint.get("hillshade-accent-color"),tt=Oe.paint.get("hillshade-emissive-strength");let at=n.bC(Oe.paint.get("hillshade-illumination-direction"));if(Oe.paint.get("hillshade-illumination-anchor")==="viewport")at-=_e.transform.angle;else if(_e.style&&_e.style.enable3dLights()&&_e.style.directionalLight){const Ot=_e.style.directionalLight.properties.get("direction"),Ct=n.c8(Ot.x,Ot.y,Ot.z);at=n.bC(Ct[1])}const wt=!_e.options.moving;return{u_matrix:Ge||_e.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),wt),u_image:0,u_latrange:rh(0,ge.tileID),u_light:[Oe.paint.get("hillshade-exaggeration"),at],u_shadow:He.toRenderColor(Oe.lut),u_highlight:Qe.toRenderColor(Oe.lut),u_emissive_strength:tt,u_accent:nt.toRenderColor(Oe.lut)}})(f,s,m,f.terrain?i.projMatrix:null);f.uploadCommonUniforms(k,Y,i.toUnwrapped());const{tileBoundsBuffer:oe,tileBoundsIndexBuffer:pe,tileBoundsSegments:ue}=f.getTileBoundsBuffers(s);Y.draw(f,U.TRIANGLES,x,w,A,qn.disabled,J,m.id,oe,pe,ue)}function rd(f,i,s){if(!i.needsDEMTextureUpload)return;const m=f.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(s.stride);const w=s.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new n.T(m,w,x.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function bu(f,i,s){const m=f.context,x=m.gl;if(!i.dem)return;const w=i.dem;if(m.activeTexture.set(x.TEXTURE1),rd(f,i,w),!i.demTexture)return;i.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const A=w.dim;m.activeTexture.set(x.TEXTURE0);let k=i.hillshadeFBO;if(!k){const J=new n.T(m,{width:A,height:A,data:null},x.RGBA8);J.bind(x.LINEAR,x.CLAMP_TO_EDGE),k=i.hillshadeFBO=m.createFramebuffer(A,A,!0,"renderbuffer"),k.colorAttachment.set(J.texture)}m.bindFramebuffer.set(k.framebuffer),m.viewport.set([0,0,A,A]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:W,tileBoundsSegments:j}=f.getMercatorTileBoundsBuffers(),Y=[];f.linearFloatFilteringSupported()&&Y.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:Y}).draw(f,x.TRIANGLES,Xn.disabled,hr.disabled,Ir.unblended,qn.disabled,((J,oe)=>{const pe=oe.stride,ue=n.a6.mat4.create();return n.a6.mat4.ortho(ue,0,n.ab,-n.ab,0,0,1),n.a6.mat4.translate(ue,ue,[0,-n.ab,0]),{u_matrix:ue,u_image:1,u_dimension:[pe,pe],u_zoom:J.overscaledZ}})(i.tileID,w),s.id,U,W,j),i.needsHillshadePrepare=!1}class ys{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jd extends ys{getDefault(){return n.bA.transparent}set(i){const s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class _f extends ys{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class sd extends ys{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class sh extends ys{getDefault(){return[!0,!0,!0,!0]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class od extends ys{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Um extends ys{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Vm extends ys{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const s=this.current;(i.func!==s.func||i.ref!==s.ref||i.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Gm extends ys{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class oh extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=i,this.dirty=!1}}class Hm extends ys{getDefault(){return[0,1]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class __ extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=i,this.dirty=!1}}class y_ extends ys{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class v_ extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.BLEND):s.disable(s.BLEND),this.current=i,this.dirty=!1}}class ad extends ys{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class ld extends ys{getDefault(){return n.bA.transparent}set(i){const s=this.current;(i.r!==s.r||i.g!==s.g||i.b!==s.b||i.a!==s.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Qd extends ys{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class yf extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;i?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=i,this.dirty=!1}}class jm extends ys{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class vf extends ys{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Wm=class extends ys{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class ah extends ys{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class lh extends ys{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const s=this.current;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class xf extends ys{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Da extends ys{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Nc extends ys{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Yo extends ys{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ho extends ys{getDefault(){return null}set(i){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ep extends ys{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class bf extends ys{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class tp extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class wf extends ys{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class cd extends ys{constructor(i,s){super(i),this.context=i,this.parent=s}getDefault(){return null}}class ip extends cd{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Tf extends cd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class qm extends cd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class ch extends Tf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const x_=(f,i,s)=>({u_matrix:f,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:s}),$m=(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:s,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:A,u_frustum_tr:k,u_frustum_br:U,u_frustum_bl:W,u_globe_pos:j,u_globe_radius:Y,u_viewport:J,u_grid_matrix:ue?Float32Array.from(ue):new Float32Array(9),u_skirt_height:oe,u_far_z_cutoff:pe});function Zm(f,i){return f!=null&&i!=null&&!(!f.hasData()||!i.hasData())&&f.demTexture!=null&&i.demTexture!=null&&f.tileID.key!==i.tileID.key}const uh=new class{constructor(){this.operations={}}newMorphing(f,i,s,m,x){if(f in this.operations){const w=this.operations[f];w.to.tileID.key!==s.tileID.key&&(w.queued=s)}else this.operations[f]={startTime:m,phase:0,duration:x,from:i,to:s,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const i=this.operations[f];return{from:i.from,to:i.to,phase:i.phase}}update(f){for(const i in this.operations){const s=this.operations[i];for(s.phase=(f-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,f)){delete this.operations[i];break}}}_nextOp(f,i){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=i,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Xm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ym(f,i,s){if(i===0)return 0;const m=i<1&&s===514?.25/i:1;return 6*Math.pow(1.5,22-f)*Math.max(i,1)*m}function Mf(f,i){const s=1<<f.z;return!i&&(f.x===0||f.x===s-1)||f.y===0||f.y===s-1}const ud=f=>({u_matrix:f});function np(f,i,s,m,x){if(x>0){const w=n.q.now(),A=(w-f.timeAdded)/x,k=i?(w-i.timeAdded)/x:-1,U=s.getSource(),W=m.coveringZoomLevel({tileSize:U.tileSize,roundZoom:U.roundZoom}),j=!i||Math.abs(i.tileID.overscaledZ-W)>Math.abs(f.tileID.overscaledZ-W),Y=j&&f.refreshedUponExpiration?1:n.ap(j?A:1-k,0,1);return f.refreshedUponExpiration&&A>=1&&(f.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Y}:{opacity:Y,mix:0}}return{opacity:1,mix:0}}class hh extends Me{constructor(i){const s={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new n.ce(n.cf(),null),x=ml("mock-dem",s,m,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,s){i.state="loaded",s(null)}}class Km extends Me{constructor(i){const s=ml("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new n.ce(n.cf(),null),i.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,s,m){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,A)=>{if(w[A.key]="",!this._tiles[A.key]){const k=new Us(A,this._source.tileSize*A.overscaleFactor(),i.tileZoom);k.state="loaded",this._tiles[A.key]=k}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const s=this.proxyCachedFBO[i];if(s!==void 0){const m=Object.values(s);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sf extends n.aA{constructor(i,s,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=s,this.projMatrix=m}}class Ef extends n.cE{constructor(i,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,w]=function(U){const W=new n.a$,j=new n.aP,Y=131;W.reserve(17161),j.reserve(33800);const J=n.ab/128,oe=n.ab+J/2,pe=oe+J;for(let _e=-J;_e<pe;_e+=J)for(let ge=-J;ge<pe;ge+=J){const Oe=ge<0||ge>oe||_e<0||_e>oe?24575:0,Ge=n.ap(Math.round(ge),0,n.ab),He=n.ap(Math.round(_e),0,n.ab);W.emplaceBack(Ge+Oe,He)}const ue=(_e,ge)=>{const Oe=ge*Y+_e;j.emplaceBack(Oe+1,Oe,Oe+Y),j.emplaceBack(Oe+Y,Oe+Y+1,Oe+1)};for(let _e=1;_e<129;_e++)for(let ge=1;ge<129;ge++)ue(ge,_e);return[0,129].forEach(_e=>{for(let ge=0;ge<130;ge++)ue(ge,_e),ue(_e,ge)}),[W,j,32768]}(),A=i.context;this.gridBuffer=A.createVertexBuffer(m,n.b1.members),this.gridIndexBuffer=A.createIndexBuffer(x),this.gridSegments=n.b2.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=n.b2.simpleSegment(0,0,m.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Km(s.map),this.orthoMatrix=n.a6.mat4.create(),n.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ab,0,n.ab,0,1);const k=A.gl;this._overlapStencilMode=new hr({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new hh(s.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,s,m){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const x=i.terrain.properties,w=i.terrain.drapeRenderMode===0,A=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();const k=i.terrain&&i.terrain.scope,U=x.get("source"),W=w?this._mockSourceCache:i.getSourceCache(U,k);if(!W)return void n.w(`Couldn't find terrain source "${U}".`);if(this.sourceCache=W,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=A?this.calculateExaggeration(s):x.get("exaggeration"),!s.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Y=this.getScaledDemTileSize();this.sourceCache.update(s,Y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),s.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const s=this._previousCameraAltitude,m=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=m;const x=s!=null?m-s:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=i.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(w);let k=w-this._previousZoom;const U=this._previousUpdateTimestamp;let W=w;this._evaluationZoom!=null&&(W=this._evaluationZoom,Math.abs(w-W)>.5&&(k=.5*(w-W+k)),k*x<0&&(W+=k)),this._evaluationZoom=W;const j=A.getExaggeration(W),Y=j===A.getExaggeration(Math.max(0,W-.1));if(Y&&Math.abs(j-this._exaggeration)<.01)return j;let J=Math.min(.1,.00375*(this._updateTimestamp-U));return(Y||j<.1||Math.abs(k)<1e-4)&&(J=Math.min(.2,4*J)),n.aa(this._exaggeration,j,J)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(n.a5.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=s.getIds().map(U=>{const W=s.getTileByID(U).tileID;return W.projMatrix=m.calculateProjMatrix(W.toUnwrapped()),W});(function(U,W){const j=W.transform.pointCoordinate(W.transform.getCameraPoint()),Y=new n.P(j.x,j.y);U.sort((J,oe)=>{if(oe.overscaledZ-J.overscaledZ)return oe.overscaledZ-J.overscaledZ;const pe=new n.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),ue=new n.P(oe.canonical.x+(1<<oe.canonical.z)*oe.wrap,oe.canonical.y),_e=Y.mult(1<<J.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(pe)-_e.distSqr(ue)})})(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(U=>{this.proxyToSource[U.key]={}}),this.terrainTileForTile={};const A=this._style._mergedSourceCaches;for(const U in A){const W=A[U];if(!W.used||(W!==this.sourceCache&&this.resetTileLookupCache(W.id),this._setupProxiedCoordsForOrtho(W,i[U],w),W.usedForTerrain))continue;const j=i[U];W.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[s.id]=x.map(U=>new Sf(U,U.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const U of this.proxyCoords){const W=this.terrainTileForTile[U.key];if(!W)continue;const j=W.tileID.key;j in k||(this._visibleDemTiles.push(W),k[j]=j)}}_assignTerrainTiles(i){this._initializing||i.forEach(s=>{if(this.terrainTileForTile[s.key])return;const m=this._findTileCoveringTileID(s,this.sourceCache);m&&(this.terrainTileForTile[s.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,s=i.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(s.TEXTURE1),rd(this.painter,x,w))}}_prepareDemTileUniforms(i,s,m,x){if(!s||s.demTexture==null)return!1;const w=i.tileID.canonical,A=Math.pow(2,s.tileID.canonical.z-w.z),k=x||"";return m[`u_dem_tl${k}`]=[w.x*A%1,w.y*A%1],m[`u_dem_scale${k}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const s=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const w=x.dem.tree.minimums[0];return w>0&&i++,m+w},0);return i?s/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,s=i.gl;i.activeTexture.set(s.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new n.cF({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new n.T(i,x,s.R32F,{premultiply:!1}),w}setupElevationDraw(i,s,m){const x=this.painter.context,w=x.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};A.u_exaggeration=this.exaggeration();let k=null,U=null,W=1;if(m&&m.morphing&&this._useVertexMorphing){const oe=m.morphing.srcDemTile,pe=m.morphing.dstDemTile;W=m.morphing.phase,oe&&pe&&(this._prepareDemTileUniforms(i,oe,A,"_prev")&&(U=oe),this._prepareDemTileUniforms(i,pe,A)&&(k=pe))}const j=oe=>oe&&oe.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let Y=null;var J;if(this.enabled?U&&k?(Y=k.demTexture,x.activeTexture.set(w.TEXTURE4),U.demTexture.bind(j(U),w.CLAMP_TO_EDGE),A.u_dem_lerp=W):(k=this.terrainTileForTile[i.tileID.key],Y=this._prepareDemTileUniforms(i,k,A)?k.demTexture:this.emptyDEMTexture):Y=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),Y&&(A.u_dem_size=(J=Y).size[0]===1?1:J.size[0]-2,Y.bind(j(k),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,s,A),m&&m.useMeterToDem&&k){const oe=(1<<k.tileID.canonical.z)*n.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=oe}if(m&&m.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),s.setTerrainUniformValues(x,A),this.painter.transform.projection.name==="globe"){const oe=this.globeUniformValues(this.painter.transform,i.tileID.canonical,m&&m.useDenormalizedUpVectorScale);s.setGlobeUniformValues(x,oe)}}globeUniformValues(i,s,m){const x=i.projection;return{u_tile_tl_up:x.upVector(s,0,0),u_tile_tr_up:x.upVector(s,n.ab,0),u_tile_br_up:x.upVector(s,n.ab,n.ab),u_tile_bl_up:x.upVector(s,0,n.ab),u_tile_up_scale:m?n.cG(1):x.upVectorScale(s,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const s=this.painter,m=this.painter.context;i.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,A,k,U){if(x.transform.projection.name==="globe")(function(W,j,Y,J,oe){const pe=W.context,ue=pe.gl;let _e,ge;const Oe=W.transform,Ge=n.cx(W,pe,Oe),He=(si,di)=>{if(ge===di)return;const Si=[Xm[di],"PROJECTION_GLOBE_VIEW"];Ge&&Si.push("CUSTOM_ANTIALIASING");const Gi=W.isTileAffectedByFog(si);_e=W.getOrCreateProgram("globeRaster",{defines:Si,overrideFog:Gi}),ge=di},Qe=W.colorModeForRenderPass(),nt=new Xn(ue.LEQUAL,Xn.ReadWrite,W.depthRangeFor3D);uh.update(oe);const tt=n.cy(Oe),at=[n.am(Oe.center.lng),n.at(Oe.center.lat)],wt=W.globeSharedBuffers,Ot=[Oe.width*n.q.devicePixelRatio,Oe.height*n.q.devicePixelRatio],Ct=Float32Array.from(Oe.globeMatrix),St={useDenormalizedUpVectorScale:!0};{const si=W.transform,di=Ym(si.zoom,j.exaggeration(),j.sourceCache._source.tileSize);ge=-1;const Si=ue.TRIANGLES;for(const Gi of J){const Ki=Y.getTile(Gi),qt=hr.disabled,wi=j.prevTerrainTileForTile[Gi.key],hi=j.terrainTileForTile[Gi.key];Zm(wi,hi)&&uh.newMorphing(Gi.key,wi,hi,oe,250),pe.activeTexture.set(ue.TEXTURE0),Ki.texture&&Ki.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Ti=uh.getMorphValuesForProxy(Gi.key),Ci=Ti?1:0;Ti&&n.C(St,{morphing:{srcDemTile:Ti.from,dstDemTile:Ti.to,phase:n.cw(Ti.phase)}});const gi=n.cz(Gi.canonical),Xi=n.cA(gi.getCenter().lat),zn=n.cB(Gi.canonical,gi,Xi,si.worldSize/si._pixelsPerMercatorPixel),$n=n.b6(n.cC(Gi.canonical)),An=$m(si.expandedFarZProjMatrix,Ct,tt,$n,n.a9(si.zoom),at,si.frustumCorners.TL,si.frustumCorners.TR,si.frustumCorners.BR,si.frustumCorners.BL,si.globeCenterInViewSpace,si.globeRadius,Ot,di,si._farZ,zn);if(He(Gi,Ci),_e&&(j.setupElevationDraw(Ki,_e,St),W.uploadCommonUniforms(pe,_e,Gi.toUnwrapped()),wt)){const[kn,dn,tr]=wt.getGridBuffers(Xi,di!==0);_e.draw(W,Si,nt,qt,Qe,qn.backCCW,An,"globe_raster",kn,dn,tr)}}}if(wt&&(W.renderDefaultNorthPole||W.renderDefaultSouthPole)){const si=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ge&&si.push("CUSTOM_ANTIALIASING"),_e=W.getOrCreateProgram("globeRaster",{defines:si});for(const di of J){const{x:Si,y:Gi,z:Ki}=di.canonical,qt=Gi===0,wi=Gi===(1<<Ki)-1,[hi,Ti,Ci,gi]=wt.getPoleBuffers(Ki,!1);if(gi&&(qt||wi)){const Xi=Y.getTile(di);pe.activeTexture.set(ue.TEXTURE0),Xi.texture&&Xi.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let zn=n.cD(Ki,Si,Oe);const $n=n.b6(n.cC(di.canonical)),An=(kn,dn)=>kn.draw(W,ue.TRIANGLES,nt,hr.disabled,Qe,qn.disabled,$m(Oe.expandedFarZProjMatrix,zn,zn,$n,0,at,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,Ot,0,Oe._farZ),"globe_pole_raster",dn,Ci,gi);j.setupElevationDraw(Xi,_e,St),W.uploadCommonUniforms(pe,_e,di.toUnwrapped()),qt&&W.renderDefaultNorthPole&&An(_e,hi),wi&&W.renderDefaultSouthPole&&(zn=n.a6.mat4.scale(n.a6.mat4.create(),zn,[1,-1,1]),An(_e,Ti))}}}})(x,w,A,k,U);else{const W=x.context,j=W.gl;let Y,J;const oe=x.shadowRenderer,pe=Ia(x,x.longestCutoffRange),ue=Qe=>{if(J===Qe)return;const nt=[];nt.push(Xm[Qe]),pe.shouldRenderCutoff&&nt.push("RENDER_CUTOFF"),oe&&(nt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),oe.useNormalOffset&&nt.push("NORMAL_OFFSET")),Y=x.getOrCreateProgram("terrainRaster",{defines:nt}),J=Qe},_e=x.colorModeForRenderPass(),ge=new Xn(j.LEQUAL,Xn.ReadWrite,x.depthRangeFor3D);uh.update(U);const Oe=x.transform,Ge=Ym(Oe.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let He=[0,0,0];if(oe){const Qe=x.style.directionalLight,nt=x.style.ambientLight;Qe&&nt&&(He=_u(x.style,Qe,nt))}{J=-1;const Qe=j.TRIANGLES,[nt,tt]=[w.gridIndexBuffer,w.gridSegments];for(const at of k){const wt=A.getTile(at),Ot=hr.disabled,Ct=w.prevTerrainTileForTile[at.key],St=w.terrainTileForTile[at.key];Zm(Ct,St)&&uh.newMorphing(at.key,Ct,St,U,250),W.activeTexture.set(j.TEXTURE0),wt.texture&&wt.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const si=uh.getMorphValuesForProxy(at.key),di=si?1:0;let Si;si&&(Si={morphing:{srcDemTile:si.from,dstDemTile:si.to,phase:n.cw(si.phase)}});const Gi=x_(at.projMatrix,Mf(at.canonical,Oe.renderWorldCopies)?Ge/10:Ge,He);if(ue(di),!Y)continue;w.setupElevationDraw(wt,Y,Si);const Ki=at.toUnwrapped();oe&&oe.setupShadows(Ki,Y),x.uploadCommonUniforms(W,Y,Ki,null,pe),Y.draw(x,Qe,ge,Ot,_e,qn.backCCW,Gi,"terrain_raster",w.gridBuffer,nt,tt)}}}}(s,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const s=this.painter,m=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],A=this._drapedRenderBatches.shift(),k=s.style.order,U=[];let W=0;for(const j of w){const Y=x.getTileByID(j.proxyTileKey),J=x.proxyCachedFBO[j.key]?x.proxyCachedFBO[j.key][i]:void 0,oe=J!==void 0?x.renderCache[J]:this.pool[W++],pe=J!==void 0;if(Y.texture=oe.tex,pe&&!oe.dirty){U.push(Y.tileID);continue}let ue;m.bindFramebuffer.set(oe.fb.framebuffer),this.renderedToTile=!1,oe.dirty&&(m.clear({color:n.bA.transparent,stencil:0}),oe.dirty=!1);for(let _e=A.start;_e<=A.end;++_e){const ge=s.style._mergedLayers[k[_e]];if(ge.isHidden(s.transform.zoom))continue;const Oe=s.style.getLayerSourceCache(ge),Ge=Oe?this.proxyToSource[j.key][Oe.id]:[j];if(!Ge)continue;const He=Ge;m.viewport.set([0,0,oe.fb.width,oe.fb.height]),ue!==(Oe?Oe.id:null)&&(this._setupStencil(oe,Ge,ge,Oe),ue=Oe?Oe.id:null),s.renderLayer(s,Oe,ge,He)}if(this._drapedRenderBatches.length===0)for(const _e of this._pendingGroundEffectLayers){const ge=s.style._mergedLayers[k[_e]];if(ge.isHidden(s.transform.zoom))continue;const Oe=s.style.getLayerSourceCache(ge),Ge=Oe?this.proxyToSource[j.key][Oe.id]:[j];if(!Ge)continue;const He=Ge;m.viewport.set([0,0,oe.fb.width,oe.fb.height]),ue!==(Oe?Oe.id:null)&&(this._setupStencil(oe,Ge,ge,Oe),ue=Oe?Oe.id:null),s.renderLayer(s,Oe,ge,He)}this.renderedToTile?(oe.dirty=!0,U.push(Y.tileID)):pe||--W,W===5&&(W=0,this.renderToBackBuffer(U))}return this.renderToBackBuffer(U),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,s.width,s.height]),A.end+1}postRender(){}isLayerOrderingCorrect(i){const s=i.order.length;let m=-1,x=s;for(let w=0;w<s;++w)this._style.isLayerDraped(i._mergedLayers[i.order[w]])?m=Math.max(m,w):x=Math.min(x,w);return x>m}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{i=Math.min(i,s.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,s,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const A=w.tileID,k=1<<A.overscaledZ,{x:U,y:W}=A.canonical,j=U/k,Y=(U+1)/k,J=W/k,oe=(W+1)/k;return{minx:j,miny:J,maxx:Y,maxy:oe,t:w.dem.tree.raycastRoot(j,J,Y,oe,i,s,m),tile:w}});x.sort((w,A)=>(w.t!==null?w.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const A=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,s,m);if(A!=null)return A}return null}_createFBO(){const i=this.painter.context,s=i.gl,m=this.drapeBufferSize;i.activeTexture.set(s.TEXTURE0);const x=new n.T(i,{width:m[0],height:m[1],data:null},s.RGBA8);x.bind(s.LINEAR,s.CLAMP_TO_EDGE);const w=i.createFramebuffer(m[0],m[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new ch(i,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const s=this._style._mergedLayers[i],m=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!m&&s.shouldRedrape():!m&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const m of this._style.getSources())if(m instanceof Ps){i=!0;break}if(!i)return;const s={};for(let m=0;m<this._style.order.length;++m){const x=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(x);if(w&&!s[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof n.a4){s[w.id]=!0;for(const A of this.proxyCoords){const k=this.proxyToSource[A.key][w.id];if(k)for(const U of k)this._clearRenderCacheForTile(w.id,U)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof Mo){i=!0;break}if(!i)return;const s={};for(let m=0;m<this._style.order.length;++m){const x=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(x);if(!w||s[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const A=x.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const U=this.proxyToSource[k.key][w.id];if(U)for(const W of U){const j=np(w.getTile(W),w.findLoadedParent(W,0),w,this.painter.transform,A);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(w.id,W)}}}}_setupDrapedRenderBatches(){const i=this._style.order,s=i.length;if(s===0)return;const m=[];this._pendingGroundEffectLayers=[];let x,w=0,A=this._style._mergedLayers[i[w]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++w<s;)A=this._style._mergedLayers[i[w]];for(;w<s;++w){const k=this._style._mergedLayers[i[w]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?x===void 0&&(x=w):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(m.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&m.push({start:x,end:w-1}),m.length!==0){const k=m[m.length-1];this._pendingGroundEffectLayers.every(U=>U>k.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(i){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const A=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let k=0;k<A.length;++k){const U=Object.values(A[k]);s.renderCachePool.push(...U)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let A=m.length-1;A>=0;A--){const k=m[A];if(s.getTileByID(k.key),s.proxyCachedFBO[k.key]!==void 0){const U=i[k.key],W=this.proxyToSource[k.key];let j=0;for(const Y in W){const J=W[Y],oe=U[Y];if(!oe||oe.length!==J.length||J.some((pe,ue)=>pe!==oe[ue]||x[Y]&&x[Y].hasOwnProperty(pe.key))){j=-1;break}++j}for(const Y in s.proxyCachedFBO[k.key])s.renderCache[s.proxyCachedFBO[k.key][Y]].dirty=j<0||j!==Object.values(U).length}}const w=[...this._drapedRenderBatches];w.sort((A,k)=>k.end-k.start-(A.end-A.start));for(const A of w)for(const k of m){if(s.proxyCachedFBO[k.key])continue;let U=s.renderCachePool.pop();U===void 0&&s.renderCache.length<50&&(U=s.renderCache.length,s.renderCache.push(this._createFBO())),U!==void 0&&(s.proxyCachedFBO[k.key]={},s.proxyCachedFBO[k.key][A.start]=U,s.renderCache[U].dirty=!0)}this._tilesDirty={}}_setupStencil(i,s,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,A=w.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let k;if(m.isTileClipped())k=s.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):hr.disabled}_renderTileClippingMasks(i,s){const m=this.painter,x=this.painter.context,w=x.gl;m._tileClippingMaskIDs={},x.setColorMode(Ir.disabled),x.setDepthMode(Xn.disabled);const A=m.getOrCreateProgram("clippingMask");for(const k of i){const U=m._tileClippingMaskIDs[k.key]=--s;A.draw(m,w.TRIANGLES,Xn.disabled,new hr({func:w.ALWAYS,mask:0},U,255,w.KEEP,w.KEEP,w.REPLACE),Ir.disabled,qn.disabled,ud(k.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const s=this.painter.transform;if(i.x<0||i.x>s.width||i.y<0||i.y>s.height)return null;const m=[i.x,i.y,1,1];n.a6.vec4.transformMat4(m,m,s.pixelMatrixInverse),n.a6.vec4.scale(m,m,1/m[3]),m[0]/=s.worldSize,m[1]/=s.worldSize;const x=s._camera.position,w=n.bE(1,s.center.lat),A=[x[0],x[1],x[2]/w,0],k=n.a6.vec3.subtract([],m.slice(0,3),A);n.a6.vec3.normalize(k,k);const U=this.raycast(A,k,this._exaggeration);return U!==null&&U?(n.a6.vec3.scaleAndAdd(A,A,k,U),A[3]=A[2],A[2]*=w,A):null}_setupProxiedCoordsForOrtho(i,s,m){if(i.getSource()instanceof n.aD)return this._setupProxiedCoordsForImageSource(i,s,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let U=0;U<w.length;U++){const W=w[U],j=this._findTileCoveringTileID(W,i);if(j){const Y=this._createProxiedId(W,j,m[W.key]&&m[W.key][i.id]);x.push(Y),this.proxyToSource[W.key][i.id]=[Y]}}let A=!1;const k=new Set;for(let U=0;U<s.length;U++){const W=i.getTile(s[U]);if(!W||!W.hasData())continue;const j=this._findTileCoveringTileID(W.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==W.tileID.canonical.z){const Y=this.proxyToSource[j.tileID.key][i.id],J=this._createProxiedId(j.tileID,W,m[j.tileID.key]&&m[j.tileID.key][i.id]);Y?Y.splice(Y.length-1,0,J):this.proxyToSource[j.tileID.key][i.id]=[J];const oe=this.proxyToSource[j.tileID.key][i.id];k.has(oe)||k.add(oe),x.push(J),A=!0}}if(this._sourceTilesOverlap[i.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(const U of k)U.sort((W,j)=>j.overscaledZ-W.overscaledZ)}_setupProxiedCoordsForImageSource(i,s,m){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords,A=i.getSource(),k=A.tileID;if(!k)return;const U=new n.P(k.x,k.y)._div(1<<k.z),W=A.coordinates.map(n.a5.fromLngLat).reduce((Y,J)=>(Y.min.x=Math.min(Y.min.x,J.x-U.x),Y.min.y=Math.min(Y.min.y,J.y-U.y),Y.max.x=Math.max(Y.max.x,J.x-U.x),Y.max.y=Math.max(Y.max.y,J.y-U.y),Y),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(Y,J)=>{const oe=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),pe=Y.canonical.y/(1<<Y.canonical.z),ue=n.ab/(1<<Y.canonical.z),_e=J.wrap+J.canonical.x/(1<<J.canonical.z),ge=J.canonical.y/(1<<J.canonical.z);return oe+ue<_e+W.min.x||oe>_e+W.max.x||pe+ue<ge+W.min.y||pe>ge+W.max.y};for(let Y=0;Y<w.length;Y++){const J=w[Y];for(let oe=0;oe<s.length;oe++){const pe=i.getTile(s[oe]);if(!pe||!pe.hasData()||j(J,pe.tileID))continue;const ue=this._createProxiedId(J,pe,m[J.key]&&m[J.key][i.id]),_e=this.proxyToSource[J.key][i.id];_e?_e.push(ue):this.proxyToSource[J.key][i.id]=[ue],x.push(ue)}}}_createProxiedId(i,s,m){let x=this.orthoMatrix;if(m){const w=m.find(A=>A.key===s.tileID.key);if(w)return w}if(s.tileID.key!==i.key){const w=i.canonical.z-s.tileID.canonical.z;let A,k,U;x=n.a6.mat4.create();const W=s.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(A=n.ab>>w,k=A*((s.tileID.canonical.x<<w)-i.canonical.x+W),U=A*((s.tileID.canonical.y<<w)-i.canonical.y)):(A=n.ab<<-w,k=n.ab*(s.tileID.canonical.x-(i.canonical.x+W<<-w)),U=n.ab*(s.tileID.canonical.y-(i.canonical.y<<-w))),n.a6.mat4.ortho(x,0,A,0,A,0,1),n.a6.mat4.translate(x,x,[k,U,0])}return new Sf(s.tileID,i.key,x)}_findTileCoveringTileID(i,s){let m=s.getTile(i);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[s.id],w=x[i.key];if(m=w?s.getTileByID(w):null,m&&m.hasData()||w===null)return m;let A=m?m.tileID:i,k=A.overscaledZ;const U=s.getSource().minzoom,W=[];if(!w){const Y=s.getSource().maxzoom;if(i.canonical.z>=Y){const J=i.canonical.z-Y;s.getSource().reparseOverscaled?(k=Math.max(i.canonical.z+2,s.transform.tileZoom),A=new n.aA(k,i.wrap,Y,i.canonical.x>>J,i.canonical.y>>J)):J!==0&&(k=Y,A=new n.aA(k,i.wrap,Y,i.canonical.x>>J,i.canonical.y>>J))}A.key!==i.key&&(W.push(A.key),m=s.getTile(A))}const j=Y=>{W.forEach(J=>{x[J]=Y}),W.length=0};for(k-=1;k>=U&&(!m||!m.hasData());k--){m&&j(m.tileID.key);const Y=A.calculateScaledKey(k);if(m=s.getTileByID(Y),m&&m.hasData())break;const J=x[Y];if(J===null)break;J===void 0?W.push(Y):m=s.getTileByID(J)}return j(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,s){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[s.key]=!0}}function Af(f,i,s){const m=function(k,U,W){const j=n.a6.vec3.dot(U,k),Y=n.a6.vec3.dot(W,[.2126,.7152,.0722]),J=(pe,ue,_e)=>(1-_e)*pe+_e*ue,oe=J(1-.3*Math.min(Y,1),1,Math.min(j+1,1));return J(.92,1,Math.asin(n.ap(U[2],-1,1))/Math.PI+.5)*oe}(f,[0,0,1],i),x=[0,0,0];n.a6.vec3.scale(x,s.slice(0,3),m);const w=[0,0,0];n.a6.vec3.scale(w,i.slice(0,3),f[2]);const A=[0,0,0];return n.a6.vec3.add(A,x,w),n.cc(A)}const wu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Jm=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class oc{static cacheKey(i,s,m,x){let w=`${s}${x?x.cacheKey:""}`;for(const A of m)i.usedDefines.includes(A)&&(w+=`/${A}`);return w}constructor(i,s,m,x,w,A){const k=i.gl;this.program=k.createProgram(),this.configuration=x,this.name=s,this.fixedDefines=[...A];const U=x?x.getBinderAttributes():[],W=(m.staticAttributes||[]).concat(U);let j=x?x.defines():[];j=j.concat(A.map(_e=>`#define ${_e}`));const Y=`#version 300 es
`;let J=Y+j.concat("precision mediump float;",nd,Bc.fragmentSource).join(`
`);for(const _e of m.fragmentIncludes)J+=`
${sc[_e]}`;J+=`
${m.fragmentSource}`;let oe=Y+j.concat("precision highp float;",nd,Bc.vertexSource).join(`
`);for(const _e of m.vertexIncludes)oe+=`
${sc[_e]}`;oe+=`
${m.vertexSource}`;const pe=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(pe,J),k.compileShader(pe),k.attachShader(this.program,pe);const ue=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(ue,oe),k.compileShader(ue),k.attachShader(this.program,ue),this.attributes={},this.numAttributes=W.length;for(let _e=0;_e<this.numAttributes;_e++)if(W[_e]){const ge=W[_e].startsWith("a_")?W[_e]:`a_${W[_e]}`;k.bindAttribLocation(this.program,_e,ge),this.attributes[ge]=_e}k.linkProgram(this.program),k.deleteShader(ue),k.deleteShader(pe),this.fixedUniforms=w(i),this.binderUniforms=x?x.getUniforms(i):[],(A.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(_e=>({u_dem:new n.bK(_e),u_dem_prev:new n.bK(_e),u_dem_tl:new n.bH(_e),u_dem_scale:new n.bJ(_e),u_dem_tl_prev:new n.bH(_e),u_dem_scale_prev:new n.bJ(_e),u_dem_size:new n.bJ(_e),u_dem_lerp:new n.bJ(_e),u_exaggeration:new n.bJ(_e),u_depth:new n.bK(_e),u_depth_size_inv:new n.bH(_e),u_depth_range_unpack:new n.bH(_e),u_occluder_half_size:new n.bJ(_e),u_occlusion_depth_offset:new n.bJ(_e),u_meter_to_dem:new n.bJ(_e),u_label_plane_matrix_inv:new n.bG(_e)}))(i)),A.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new n.bI(_e),u_tile_tr_up:new n.bI(_e),u_tile_br_up:new n.bI(_e),u_tile_bl_up:new n.bI(_e),u_tile_up_scale:new n.bJ(_e)}))(i)),A.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new n.bG(_e),u_fog_range:new n.bH(_e),u_fog_color:new n.c7(_e),u_fog_horizon_blend:new n.bJ(_e),u_fog_vertical_limit:new n.bH(_e),u_fog_temporal_offset:new n.bJ(_e),u_frustum_tl:new n.bI(_e),u_frustum_tr:new n.bI(_e),u_frustum_br:new n.bI(_e),u_frustum_bl:new n.bI(_e),u_globe_pos:new n.bI(_e),u_globe_radius:new n.bJ(_e),u_globe_transition:new n.bJ(_e),u_is_globe:new n.bK(_e),u_viewport:new n.bH(_e)}))(i)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(_e=>({u_cutoff_params:new n.c7(_e)}))(i)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(_e=>({u_lighting_ambient_color:new n.bI(_e),u_lighting_directional_dir:new n.bI(_e),u_lighting_directional_color:new n.bI(_e),u_ground_radiance:new n.bI(_e)}))(i)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(_e=>({u_light_matrix_0:new n.bG(_e),u_light_matrix_1:new n.bG(_e),u_fade_range:new n.bH(_e),u_shadow_normal_offset:new n.bI(_e),u_shadow_intensity:new n.bJ(_e),u_shadow_texel_size:new n.bJ(_e),u_shadow_map_resolution:new n.bJ(_e),u_shadow_direction:new n.bI(_e),u_shadow_bias:new n.bI(_e),u_shadowmap_0:new n.bK(_e),u_shadowmap_1:new n.bK(_e)}))(i))}}setTerrainUniformValues(i,s){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x]&&m[x].set(this.program,x,s[x])}}setGlobeUniformValues(i,s){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x]&&m[x].set(this.program,x,s[x])}}setFogUniformValues(i,s){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x].set(this.program,x,s[x])}}setCutoffUniformValues(i,s){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x].set(this.program,x,s[x])}}setLightsUniformValues(i,s){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in s)m[x].set(this.program,x,s[x])}}setShadowUniformValues(i,s){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;i.program.set(this.program);for(const x in s)m[x].set(this.program,x,s[x])}_drawDebugWireframe(i,s,m,x,w,A,k,U,W,j){const Y=i.options.wireframe;if(Y.terrain===!1&&Y.layers2D===!1&&Y.layers3D===!1)return;const J=i.context;if(!(!(!Y.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Y.layers2D||i._terrain&&i._terrain.renderingToTexture||!wu.includes(this.name))||!(!Y.layers3D||!Jm.includes(this.name))))return;const oe=J.gl,pe=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,w,J);if(!pe)return;const ue=[...this.fixedDefines];ue.push("DEBUG_WIREFRAME");const _e=i.getOrCreateProgram(this.name,{config:this.configuration,defines:ue});J.program.set(_e.program);const ge=(He,Qe,nt)=>{if(Qe[He]&&nt[He])for(const tt in Qe[He])nt[He][tt]&&nt[He][tt].set(nt.program,tt,Qe[He][tt].current)};W&&W.setUniforms(_e.program,J,_e.binderUniforms,k,{zoom:U}),ge("fixedUniforms",this,_e),ge("terrainUniforms",this,_e),ge("globeUniforms",this,_e),ge("fogUniforms",this,_e),ge("lightsUniforms",this,_e),ge("shadowUniforms",this,_e),pe.bind(),J.setColorMode(new Ir([oe.ONE,oe.ONE_MINUS_SRC_ALPHA,oe.ZERO,oe.ONE],n.bA.transparent,[!0,!0,!0,!1])),J.setDepthMode(new Xn(s.func===oe.LESS?oe.LEQUAL:s.func,Xn.ReadOnly,s.range)),J.setStencilMode(hr.disabled);const Oe=3*A.primitiveLength*2,Ge=3*A.primitiveOffset*2*2;j&&j>1?oe.drawElementsInstanced(oe.LINES,Oe,oe.UNSIGNED_SHORT,Ge,j):oe.drawElements(oe.LINES,Oe,oe.UNSIGNED_SHORT,Ge),w.bind(),J.program.set(this.program),J.setDepthMode(s),J.setStencilMode(m),J.setColorMode(x)}checkUniforms(i,s,m){if(this.fixedDefines.includes(s)){for(const x of Object.keys(m))if(!m[x].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${x} not set but required by ${s} being defined`)}}draw(i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e){const ge=i.context,Oe=ge.gl;if(this.failedToCreate)return;ge.program.set(this.program),ge.setDepthMode(m),ge.setStencilMode(x),ge.setColorMode(w),ge.setCullFace(A);for(const Qe of Object.keys(this.fixedUniforms))this.fixedUniforms[Qe].set(this.program,Qe,k[Qe]);pe&&pe.setUniforms(this.program,ge,this.binderUniforms,J,{zoom:oe});const Ge={[Oe.POINTS]:1,[Oe.LINES]:2,[Oe.TRIANGLES]:3,[Oe.LINE_STRIP]:1}[s];this.checkUniforms(U,"RENDER_SHADOWS",this.shadowUniforms);const He=_e&&_e>0?1:void 0;for(const Qe of Y.get()){const nt=Qe.vaos||(Qe.vaos={});(nt[U]||(nt[U]=new xu)).bind(ge,this,W,pe?pe.getPaintVertexBuffers():[],j,Qe.vertexOffset,ue||[],He),_e&&_e>1?Oe.drawElementsInstanced(s,Qe.primitiveLength*Ge,Oe.UNSIGNED_SHORT,Qe.primitiveOffset*Ge*2,_e):j?Oe.drawElements(s,Qe.primitiveLength*Ge,Oe.UNSIGNED_SHORT,Qe.primitiveOffset*Ge*2):Oe.drawArrays(s,Qe.vertexOffset,Qe.vertexLength),s===Oe.TRIANGLES&&j&&this._drawDebugWireframe(i,m,x,w,j,Qe,J,oe,pe,_e)}}}function rp(f,i){const s=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,f.transform.tileZoom)/s,x=m*(i.tileID.canonical.x+i.tileID.wrap*s),w=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ak(i,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Tu={terrain:0,flat:1},Qm=n.a6.mat4.create(),Cf=(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e,ge)=>{const Oe=i.style.light,Ge=Oe.properties.get("position"),He=[Ge.x,Ge.y,Ge.z],Qe=n.a6.mat3.create();Oe.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(Qe,-i.transform.angle),n.a6.vec3.transformMat3(He,He,Qe));const nt=Oe.properties.get("color"),tt=i.transform,at={u_matrix:f,u_lightpos:He,u_lightintensity:Oe.properties.get("intensity"),u_lightcolor:[nt.r,nt.g,nt.b],u_vertical_gradient:+s,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Tu[W],u_base_type:Tu[j],u_ao:x,u_edge_radius:w,u_width_scale:A,u_flood_light_color:pe,u_vertical_scale:ue,u_flood_light_intensity:_e,u_ground_shadow_factor:ge};return tt.projection.name==="globe"&&(at.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],at.u_zoom_transition=Y,at.u_inv_rot_matrix=oe,at.u_merc_center=J,at.u_up_dir=tt.projection.upVector(new n.bQ(0,0,0),J[0]*n.ab,J[1]*n.ab),at.u_height_lift=U),at},Lf=(f,i,s,m,x,w)=>({u_matrix:f,u_edge_radius:i,u_width_scale:s,u_vertical_scale:m,u_height_type:Tu[x],u_base_type:Tu[w]}),If=(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e)=>{const ge=Cf(f,i,s,m,x,w,A,k,W,j,Y,J,oe,pe,ue,_e,1,[0,0,0]),Oe={u_height_factor:-Math.pow(2,k.overscaledZ)/U.tileSize/8};return n.l(ge,rp(i,U),Oe)},eg=(f,i)=>({u_matrix:f,u_emissive_strength:i}),Rf=(f,i,s,m)=>n.l(eg(f,i),rp(s,m)),hd=(f,i,s)=>({u_matrix:f,u_world:s,u_emissive_strength:i}),b_=(f,i,s,m,x)=>n.l(Rf(f,i,s,m),{u_world:x}),w_=(f,i,s,m)=>{const x=n.ab/s.tileSize;return{u_matrix:f,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},Pf=(f,i,s=1)=>({u_matrix:f,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),tg=n.a6.mat4.create(),sp=(f,i,s,m,x,w,A)=>{const k=f.transform,U=k.projection.name==="globe",W=U?n.cI(k.zoom,i.canonical)*k._pixelsPerMercatorPixel:n.ak(s,1,w),j={u_matrix:i.projMatrix,u_extrude_scale:W,u_intensity:A,u_inv_rot_matrix:tg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(U){j.u_inv_rot_matrix=m,j.u_merc_center=x,j.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],j.u_zoom_transition=n.a9(k.zoom);const Y=x[0]*n.ab,J=x[1]*n.ab;j.u_up_dir=k.projection.upVector(new n.bQ(0,0,0),Y,J)}return j};function dh(f,[i,s,m,x],[w,A]){if(w===A)return[0,0,0,0];const k=255*(f-1)/(f*(A-w));return[i*k,s*k,m*k,x*k]}function Mu(f,i,[s,m]){return s===m?0:.5/f+(i-s)*(f-1)/(f*(m-s))}const op=(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e,ge,Oe,Ge,He)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:s,u_merc_matrix:m,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:W,u_fade_t:j.mix,u_opacity:j.opacity*Y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Y.paint.get("raster-brightness-min"),u_brightness_high:Y.paint.get("raster-brightness-max"),u_saturation_factor:n.cJ(Y.paint.get("raster-saturation")),u_contrast_factor:n.cK(Y.paint.get("raster-contrast")),u_spin_weights:ol(Y.paint.get("raster-hue-rotate")),u_perspective_transform:J,u_raster_elevation:oe,u_zoom_transition:A,u_merc_center:k,u_cutoff_params:U,u_colorization_mix:dh(n.cL,ue,ge),u_colorization_offset:Mu(n.cL,_e,ge),u_color_ramp:pe,u_texture_offset:[Ge/(Oe+2*Ge),Oe/(Oe+2*Ge)],u_texture_res:[Oe+2*Ge,Oe+2*Ge],u_emissive_strength:He});function ol(f){f*=Math.PI/180;const i=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*i-s+1)/3,(Math.sqrt(3)*i-s+1)/3]}const Uc=.05,ap=(f,i,s,m,x,w,A,k,U,W,j,Y)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:s,u_merc_matrix:m,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:W,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:Y,u_zoom_transition:A,u_merc_center:k,u_cutoff_params:U}),dd=(f,i,s,m,x,w,A,k,U,W)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_tile_offset:s,u_velocity:m,u_color_ramp:w,u_velocity_res:x,u_max_speed:A,u_uv_offset:k,u_data_scale:[255*U[0],255*U[1]],u_data_offset:W,u_particle_pos_scale:1.1,u_particle_pos_offset:[Uc,Uc]}),lp=(f,i,s,m,x,w,A,k,U,W)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_velocity:s,u_velocity_res:m,u_max_speed:x,u_speed_factor:w,u_reset_rate:A,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:[255*U[0],255*U[1]],u_data_offset:W,u_particle_pos_scale:1.1,u_particle_pos_offset:[Uc,Uc]}),Vc=n.a6.mat4.create(),ig=(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e,ge,Oe,Ge,He,Qe)=>{const nt=x.transform,tt={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:nt.getCameraToCenterDistance(Oe),u_rotate_symbol:+s,u_aspect_ratio:nt.width/nt.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:A,u_coord_matrix:k,u_is_text:+W,u_elevation_from_sea:U?1:0,u_pitch_with_map:+m,u_texsize:j,u_texsize_icon:Y,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Vc,u_up_vector:[0,-1,0],u_color_adj_mat:Ge,u_icon_transition:He||0,u_gamma_scale:m?x.transform.getCameraToCenterDistance(Oe)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:+J,u_scale_factor:Qe||1};return Oe.name==="globe"&&(tt.u_tile_id=[oe.canonical.x,oe.canonical.y,1<<oe.canonical.z],tt.u_zoom_transition=pe,tt.u_inv_rot_matrix=_e,tt.u_merc_center=ue,tt.u_camera_forward=nt._camera.forward(),tt.u_ecef_origin=n.cM(nt.globeMatrix,oe.toUnwrapped()),tt.u_tile_matrix=Float32Array.from(nt.globeMatrix),tt.u_up_vector=ge),tt},Su=(f,i,s,m)=>({u_matrix:f,u_emissive_strength:i,u_opacity:s,u_color:m}),ac=(f,i,s,m,x,w,A,k,U)=>n.l(function(W,j,Y,J,oe,pe){const{width:ue,height:_e}=J.imageManager.getPixelSize(j),ge=Math.pow(2,pe.tileID.overscaledZ),Oe=pe.tileSize*Math.pow(2,J.transform.tileZoom)/ge,Ge=Oe*(pe.tileID.canonical.x+pe.tileID.wrap*ge),He=Oe*pe.tileID.canonical.y;return{u_image:0,u_pattern_tl:Y.tl,u_pattern_br:Y.br,u_texsize:[ue,_e],u_pattern_size:Y.displaySize,u_pattern_units_to_pixels:oe?[J.transform.width,-1*J.transform.height]:[1/n.ak(pe,1,J.transform.tileZoom),1/n.ak(pe,1,J.transform.tileZoom)],u_pixel_coord_upper:[Ge>>16,He>>16],u_pixel_coord_lower:[65535&Ge,65535&He]}}(0,w,A,m,k,U),{u_matrix:f,u_emissive_strength:i,u_opacity:s}),Sn=new Float32Array(n.a6.mat4.identity([])),pd=(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe=[0,0,0],pe)=>{const ue=x.style.light,_e=ue.properties.get("position"),ge=[-_e.x,-_e.y,_e.z],Oe=n.a6.mat3.create();ue.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(Oe,-x.transform.angle),n.a6.vec3.transformMat3(ge,ge,Oe));const Ge=j.alphaMode==="MASK",He=ue.properties.get("color").toRenderColor(null),Qe=J.paint.get("model-ambient-occlusion-intensity"),nt=J.paint.get("model-color").constantOr(n.bA.white).toRenderColor(null),tt=J.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:i,u_normal_matrix:s,u_node_matrix:m||Sn,u_lightpos:ge,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[He.r,He.g,He.b],u_camera_pos:oe,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Ge,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:[A.r,A.g,A.b,A.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:U,u_roughnessFactor:W,u_baseColorTexture:co.BaseColor,u_metallicRoughnessTexture:co.MetallicRoughness,u_normalTexture:co.Normal,u_occlusionTexture:co.Occlusion,u_emissionTexture:co.Emission,u_lutTexture:co.LUT,u_color_mix:[nt.r,nt.g,nt.b,tt],u_aoIntensity:Qe,u_emissive_strength:Y,u_occlusionTextureTransform:pe||[0,0,0,0]}},Df=(f,i=Sn,s=Sn)=>({u_matrix:f,u_instance:i,u_node_matrix:s}),lc={fillExtrusion:f=>({u_matrix:new n.bG(f),u_lightpos:new n.bI(f),u_lightintensity:new n.bJ(f),u_lightcolor:new n.bI(f),u_vertical_gradient:new n.bJ(f),u_opacity:new n.bJ(f),u_edge_radius:new n.bJ(f),u_width_scale:new n.bJ(f),u_ao:new n.bH(f),u_height_type:new n.bK(f),u_base_type:new n.bK(f),u_tile_id:new n.bI(f),u_zoom_transition:new n.bJ(f),u_inv_rot_matrix:new n.bG(f),u_merc_center:new n.bH(f),u_up_dir:new n.bI(f),u_height_lift:new n.bJ(f),u_flood_light_color:new n.bI(f),u_vertical_scale:new n.bJ(f),u_flood_light_intensity:new n.bJ(f),u_ground_shadow_factor:new n.bI(f)}),fillExtrusionDepth:f=>({u_matrix:new n.bG(f),u_edge_radius:new n.bJ(f),u_width_scale:new n.bJ(f),u_vertical_scale:new n.bJ(f),u_height_type:new n.bK(f),u_base_type:new n.bK(f)}),fillExtrusionPattern:f=>({u_matrix:new n.bG(f),u_lightpos:new n.bI(f),u_lightintensity:new n.bJ(f),u_lightcolor:new n.bI(f),u_vertical_gradient:new n.bJ(f),u_height_factor:new n.bJ(f),u_edge_radius:new n.bJ(f),u_width_scale:new n.bJ(f),u_ao:new n.bH(f),u_height_type:new n.bK(f),u_base_type:new n.bK(f),u_tile_id:new n.bI(f),u_zoom_transition:new n.bJ(f),u_inv_rot_matrix:new n.bG(f),u_merc_center:new n.bH(f),u_up_dir:new n.bI(f),u_height_lift:new n.bJ(f),u_image:new n.bK(f),u_texsize:new n.bH(f),u_pixel_coord_upper:new n.bH(f),u_pixel_coord_lower:new n.bH(f),u_tile_units_to_pixels:new n.bJ(f),u_opacity:new n.bJ(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new n.bG(f),u_opacity:new n.bJ(f),u_ao_pass:new n.bJ(f),u_meter_to_tile:new n.bJ(f),u_ao:new n.bH(f),u_flood_light_intensity:new n.bJ(f),u_flood_light_color:new n.bI(f),u_attenuation:new n.bJ(f),u_edge_radius:new n.bJ(f),u_fb:new n.bK(f),u_fb_size:new n.bJ(f),u_dynamic_offset:new n.bJ(f)}),fill:f=>({u_matrix:new n.bG(f),u_emissive_strength:new n.bJ(f)}),fillPattern:f=>({u_matrix:new n.bG(f),u_emissive_strength:new n.bJ(f),u_image:new n.bK(f),u_texsize:new n.bH(f),u_pixel_coord_upper:new n.bH(f),u_pixel_coord_lower:new n.bH(f),u_tile_units_to_pixels:new n.bJ(f)}),fillOutline:f=>({u_matrix:new n.bG(f),u_emissive_strength:new n.bJ(f),u_world:new n.bH(f)}),fillOutlinePattern:f=>({u_matrix:new n.bG(f),u_emissive_strength:new n.bJ(f),u_world:new n.bH(f),u_image:new n.bK(f),u_texsize:new n.bH(f),u_pixel_coord_upper:new n.bH(f),u_pixel_coord_lower:new n.bH(f),u_tile_units_to_pixels:new n.bJ(f)}),circle:n.cN,collisionBox:f=>({u_matrix:new n.bG(f),u_camera_to_center_distance:new n.bJ(f),u_extrude_scale:new n.bH(f)}),collisionCircle:f=>({u_matrix:new n.bG(f),u_inv_matrix:new n.bG(f),u_camera_to_center_distance:new n.bJ(f),u_viewport_size:new n.bH(f)}),debug:f=>({u_color:new n.cu(f),u_matrix:new n.bG(f),u_overlay:new n.bK(f),u_overlay_scale:new n.bJ(f)}),clippingMask:f=>({u_matrix:new n.bG(f)}),heatmap:f=>({u_extrude_scale:new n.bJ(f),u_intensity:new n.bJ(f),u_matrix:new n.bG(f),u_inv_rot_matrix:new n.bG(f),u_merc_center:new n.bH(f),u_tile_id:new n.bI(f),u_zoom_transition:new n.bJ(f),u_up_dir:new n.bI(f)}),heatmapTexture:f=>({u_image:new n.bK(f),u_color_ramp:new n.bK(f),u_opacity:new n.bJ(f)}),hillshade:f=>({u_matrix:new n.bG(f),u_image:new n.bK(f),u_latrange:new n.bH(f),u_light:new n.bH(f),u_shadow:new n.cu(f),u_highlight:new n.cu(f),u_emissive_strength:new n.bJ(f),u_accent:new n.cu(f)}),hillshadePrepare:f=>({u_matrix:new n.bG(f),u_image:new n.bK(f),u_dimension:new n.bH(f),u_zoom:new n.bJ(f)}),line:n.cO,linePattern:n.cP,raster:f=>({u_matrix:new n.bG(f),u_normalize_matrix:new n.bG(f),u_globe_matrix:new n.bG(f),u_merc_matrix:new n.bG(f),u_grid_matrix:new n.cv(f),u_tl_parent:new n.bH(f),u_scale_parent:new n.bJ(f),u_fade_t:new n.bJ(f),u_opacity:new n.bJ(f),u_image0:new n.bK(f),u_image1:new n.bK(f),u_brightness_low:new n.bJ(f),u_brightness_high:new n.bJ(f),u_saturation_factor:new n.bJ(f),u_contrast_factor:new n.bJ(f),u_spin_weights:new n.bI(f),u_perspective_transform:new n.bH(f),u_raster_elevation:new n.bJ(f),u_zoom_transition:new n.bJ(f),u_merc_center:new n.bH(f),u_cutoff_params:new n.c7(f),u_colorization_mix:new n.c7(f),u_colorization_offset:new n.bJ(f),u_color_ramp:new n.bK(f),u_texture_offset:new n.bH(f),u_texture_res:new n.bH(f),u_emissive_strength:new n.bJ(f)}),rasterParticle:f=>({u_matrix:new n.bG(f),u_normalize_matrix:new n.bG(f),u_globe_matrix:new n.bG(f),u_merc_matrix:new n.bG(f),u_grid_matrix:new n.cv(f),u_tl_parent:new n.bH(f),u_scale_parent:new n.bJ(f),u_fade_t:new n.bJ(f),u_opacity:new n.bJ(f),u_image0:new n.bK(f),u_image1:new n.bK(f),u_raster_elevation:new n.bJ(f),u_zoom_transition:new n.bJ(f),u_merc_center:new n.bH(f),u_cutoff_params:new n.c7(f)}),rasterParticleTexture:f=>({u_texture:new n.bK(f),u_opacity:new n.bJ(f)}),rasterParticleDraw:f=>({u_particle_texture:new n.bK(f),u_particle_texture_side_len:new n.bJ(f),u_tile_offset:new n.bH(f),u_velocity:new n.bK(f),u_color_ramp:new n.bK(f),u_velocity_res:new n.bH(f),u_max_speed:new n.bJ(f),u_uv_offset:new n.bH(f),u_data_scale:new n.bH(f),u_data_offset:new n.bJ(f),u_particle_pos_scale:new n.bJ(f),u_particle_pos_offset:new n.bH(f)}),rasterParticleUpdate:f=>({u_particle_texture:new n.bK(f),u_particle_texture_side_len:new n.bJ(f),u_velocity:new n.bK(f),u_velocity_res:new n.bH(f),u_max_speed:new n.bJ(f),u_speed_factor:new n.bJ(f),u_reset_rate:new n.bJ(f),u_rand_seed:new n.bJ(f),u_uv_offset:new n.bH(f),u_data_scale:new n.bH(f),u_data_offset:new n.bJ(f),u_particle_pos_scale:new n.bJ(f),u_particle_pos_offset:new n.bH(f)}),symbol:f=>({u_is_size_zoom_constant:new n.bK(f),u_is_size_feature_constant:new n.bK(f),u_size_t:new n.bJ(f),u_size:new n.bJ(f),u_camera_to_center_distance:new n.bJ(f),u_rotate_symbol:new n.bK(f),u_aspect_ratio:new n.bJ(f),u_fade_change:new n.bJ(f),u_matrix:new n.bG(f),u_label_plane_matrix:new n.bG(f),u_coord_matrix:new n.bG(f),u_is_text:new n.bK(f),u_elevation_from_sea:new n.bK(f),u_pitch_with_map:new n.bK(f),u_texsize:new n.bH(f),u_texsize_icon:new n.bH(f),u_texture:new n.bK(f),u_texture_icon:new n.bK(f),u_gamma_scale:new n.bJ(f),u_device_pixel_ratio:new n.bJ(f),u_tile_id:new n.bI(f),u_zoom_transition:new n.bJ(f),u_inv_rot_matrix:new n.bG(f),u_merc_center:new n.bH(f),u_camera_forward:new n.bI(f),u_tile_matrix:new n.bG(f),u_up_vector:new n.bI(f),u_ecef_origin:new n.bI(f),u_is_halo:new n.bK(f),u_icon_transition:new n.bJ(f),u_color_adj_mat:new n.bG(f),u_scale_factor:new n.bJ(f)}),background:f=>({u_matrix:new n.bG(f),u_emissive_strength:new n.bJ(f),u_opacity:new n.bJ(f),u_color:new n.cu(f)}),backgroundPattern:f=>({u_matrix:new n.bG(f),u_emissive_strength:new n.bJ(f),u_opacity:new n.bJ(f),u_image:new n.bK(f),u_pattern_tl:new n.bH(f),u_pattern_br:new n.bH(f),u_texsize:new n.bH(f),u_pattern_size:new n.bH(f),u_pixel_coord_upper:new n.bH(f),u_pixel_coord_lower:new n.bH(f),u_pattern_units_to_pixels:new n.bH(f)}),terrainRaster:f=>({u_matrix:new n.bG(f),u_image0:new n.bK(f),u_skirt_height:new n.bJ(f),u_ground_shadow_factor:new n.bI(f)}),skybox:f=>({u_matrix:new n.bG(f),u_sun_direction:new n.bI(f),u_cubemap:new n.bK(f),u_opacity:new n.bJ(f),u_temporal_offset:new n.bJ(f)}),skyboxGradient:f=>({u_matrix:new n.bG(f),u_color_ramp:new n.bK(f),u_center_direction:new n.bI(f),u_radius:new n.bJ(f),u_opacity:new n.bJ(f),u_temporal_offset:new n.bJ(f)}),skyboxCapture:f=>({u_matrix_3f:new n.cv(f),u_sun_direction:new n.bI(f),u_sun_intensity:new n.bJ(f),u_color_tint_r:new n.c7(f),u_color_tint_m:new n.c7(f),u_luminance:new n.bJ(f)}),globeRaster:f=>({u_proj_matrix:new n.bG(f),u_globe_matrix:new n.bG(f),u_normalize_matrix:new n.bG(f),u_merc_matrix:new n.bG(f),u_zoom_transition:new n.bJ(f),u_merc_center:new n.bH(f),u_image0:new n.bK(f),u_grid_matrix:new n.cv(f),u_skirt_height:new n.bJ(f),u_far_z_cutoff:new n.bJ(f),u_frustum_tl:new n.bI(f),u_frustum_tr:new n.bI(f),u_frustum_br:new n.bI(f),u_frustum_bl:new n.bI(f),u_globe_pos:new n.bI(f),u_globe_radius:new n.bJ(f),u_viewport:new n.bH(f)}),globeAtmosphere:f=>({u_frustum_tl:new n.bI(f),u_frustum_tr:new n.bI(f),u_frustum_br:new n.bI(f),u_frustum_bl:new n.bI(f),u_horizon:new n.bJ(f),u_transition:new n.bJ(f),u_fadeout_range:new n.bJ(f),u_color:new n.c7(f),u_high_color:new n.c7(f),u_space_color:new n.c7(f),u_temporal_offset:new n.bJ(f),u_horizon_angle:new n.bJ(f)}),model:f=>({u_matrix:new n.bG(f),u_lighting_matrix:new n.bG(f),u_normal_matrix:new n.bG(f),u_node_matrix:new n.bG(f),u_lightpos:new n.bI(f),u_lightintensity:new n.bJ(f),u_lightcolor:new n.bI(f),u_camera_pos:new n.bI(f),u_opacity:new n.bJ(f),u_baseColorFactor:new n.c7(f),u_emissiveFactor:new n.c7(f),u_metallicFactor:new n.bJ(f),u_roughnessFactor:new n.bJ(f),u_baseTextureIsAlpha:new n.bK(f),u_alphaMask:new n.bK(f),u_alphaCutoff:new n.bJ(f),u_baseColorTexture:new n.bK(f),u_metallicRoughnessTexture:new n.bK(f),u_normalTexture:new n.bK(f),u_occlusionTexture:new n.bK(f),u_emissionTexture:new n.bK(f),u_lutTexture:new n.bK(f),u_color_mix:new n.c7(f),u_aoIntensity:new n.bJ(f),u_emissive_strength:new n.bJ(f),u_occlusionTextureTransform:new n.c7(f)}),modelDepth:f=>({u_matrix:new n.bG(f),u_instance:new n.bG(f),u_node_matrix:new n.bG(f)}),groundShadow:f=>({u_matrix:new n.bG(f),u_ground_shadow_factor:new n.bI(f)}),stars:f=>({u_matrix:new n.bG(f),u_up:new n.bI(f),u_right:new n.bI(f),u_intensity_multiplier:new n.bJ(f)}),snowParticle:f=>({u_modelview:new n.bG(f),u_projection:new n.bG(f),u_time:new n.bJ(f),u_cam_pos:new n.bI(f),u_velocityConeAperture:new n.bJ(f),u_velocity:new n.bJ(f),u_horizontalOscillationRadius:new n.bJ(f),u_horizontalOscillationRate:new n.bJ(f),u_boxSize:new n.bJ(f),u_billboardSize:new n.bJ(f),u_simpleShapeParameters:new n.bH(f),u_screenSize:new n.bH(f),u_thinningCenterPos:new n.bH(f),u_thinningShape:new n.bI(f),u_thinningAffectedRatio:new n.bJ(f),u_thinningParticleOffset:new n.bJ(f),u_particleColor:new n.c7(f),u_direction:new n.bI(f)}),rainParticle:f=>({u_modelview:new n.bG(f),u_projection:new n.bG(f),u_time:new n.bJ(f),u_cam_pos:new n.bI(f),u_texScreen:new n.bK(f),u_velocityConeAperture:new n.bJ(f),u_velocity:new n.bJ(f),u_boxSize:new n.bJ(f),u_rainDropletSize:new n.bH(f),u_distortionStrength:new n.bJ(f),u_rainDirection:new n.bI(f),u_color:new n.c7(f),u_screenSize:new n.bH(f),u_thinningCenterPos:new n.bH(f),u_thinningShape:new n.bI(f),u_thinningAffectedRatio:new n.bJ(f),u_thinningParticleOffset:new n.bJ(f),u_shapeDirectionalPower:new n.bJ(f),u_mode:new n.bJ(f)}),occlusion:f=>({u_matrix:new n.bG(f),u_anchorPos:new n.bI(f),u_screenSizePx:new n.bH(f),u_occluderSizePx:new n.bH(f),u_color:new n.c7(f)})};class Oa{constructor(i,s,m,x){this.id=Oa.uniqueIdxCounter,Oa.uniqueIdxCounter++,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||x||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Oa.uniqueIdxCounter,Oa.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Oa.uniqueIdxCounter=0;const Gn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Of{constructor(i,s,m,x,w,A){this.length=s.length,this.attributes=m,this.itemSize=s.bytesPerElement,this.dynamicDraw=x,this.instanceCount=A,this.context=i;const k=i.gl;this.buffer=k.createBuffer(),i.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||w||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,s){for(let m=0;m<this.attributes.length;m++){const x=s.attributes[this.attributes[m].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,s,m){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],A=s.attributes[w.name];A!==void 0&&i.vertexAttribPointer(A,w.components,i[Gn[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(i,s,m){for(let x=0;x<this.attributes.length;x++){const w=s.attributes[this.attributes[x].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(w,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zf{constructor(i,s,m,x,w){this.context=i,this.width=s,this.height=m;const A=this.framebuffer=i.gl.createFramebuffer();x&&(this.colorAttachment=new ip(i,A)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new Tf(i,A):new qm(i,A))}destroy(){const i=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&i.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&i.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&i.deleteTexture(s)}i.deleteFramebuffer(this.framebuffer)}}class T_{constructor(i,s){this.gl=i,this.clearColor=new Jd(this),this.clearDepth=new _f(this),this.clearStencil=new sd(this),this.colorMask=new sh(this),this.depthMask=new od(this),this.stencilMask=new Um(this),this.stencilFunc=new Vm(this),this.stencilOp=new Gm(this),this.stencilTest=new oh(this),this.depthRange=new Hm(this),this.depthTest=new __(this),this.depthFunc=new y_(this),this.blend=new v_(this),this.blendFunc=new ad(this),this.blendColor=new ld(this),this.blendEquation=new Qd(this),this.cullFace=new yf(this),this.cullFaceSide=new jm(this),this.frontFace=new vf(this),this.program=new Wm(this),this.activeTexture=new ah(this),this.viewport=new lh(this),this.bindFramebuffer=new xf(this),this.bindRenderbuffer=new Da(this),this.bindTexture=new Nc(this),this.bindVertexBuffer=new Yo(this),this.bindElementBuffer=new Ho(this),this.bindVertexArrayOES=new ep(this),this.pixelStoreUnpack=new bf(this),this.pixelStoreUnpackPremultiplyAlpha=new tp(this),this.pixelStoreUnpackFlipY=new wf(this),this.options=s?{...s}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,s,m){return new Oa(this,i,s,m)}createVertexBuffer(i,s,m,x,w){return new Of(this,i,s,m,x,w)}createRenderbuffer(i,s,m){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,i,s,m),this.bindRenderbuffer.set(null),w}createFramebuffer(i,s,m,x){return new zf(this,i,s,m,x)}clear({color:i,depth:s,stencil:m,colorMask:x}){const w=this.gl;let A=0;i&&(A|=w.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(x||[!0,!0,!0,!0])),s!==void 0&&(A|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),m!==void 0&&(A|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),w.clear(A)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){n.bi(i.blendFunction,Ir.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Eu;function cp(f,i,s,m,x,w,A){const k=f.context,U=k.gl,W=f.transform,j=f.getOrCreateProgram("collisionBox"),Y=[];let J=0,oe=0;for(let He=0;He<m.length;He++){const Qe=m[He],nt=i.getTile(Qe),tt=nt.getBucket(s);if(!tt)continue;const at=Ga(Qe,tt,W);let wt=at;x[0]===0&&x[1]===0||(wt=f.translatePosMatrix(at,nt,x,w));const Ot=A?tt.textCollisionBox:tt.iconCollisionBox,Ct=tt.collisionCircleArray;if(Ct.length>0){const St=n.a6.mat4.create(),si=wt;n.a6.mat4.mul(St,tt.placementInvProjMatrix,W.glCoordMatrix),n.a6.mat4.mul(St,St,tt.placementViewportMatrix),Y.push({circleArray:Ct,circleOffset:oe,transform:si,invTransform:St,projection:tt.getProjection()}),J+=Ct.length/4,oe=J}Ot&&(f.terrain&&f.terrain.setupElevationDraw(nt,j),j.draw(f,U.LINES,Xn.disabled,hr.disabled,f.colorModeForRenderPass(),qn.disabled,w_(wt,W,nt,tt.getProjection()),s.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,null,W.zoom,null,[Ot.collisionVertexBuffer,Ot.collisionVertexBufferExt]))}if(!A||!Y.length)return;const pe=f.getOrCreateProgram("collisionCircle"),ue=new n.cQ;ue.resize(4*J),ue._trim();let _e=0;for(const He of Y)for(let Qe=0;Qe<He.circleArray.length/4;Qe++){const nt=4*Qe,tt=He.circleArray[nt+0],at=He.circleArray[nt+1],wt=He.circleArray[nt+2],Ot=He.circleArray[nt+3];ue.emplace(_e++,tt,at,wt,Ot,0),ue.emplace(_e++,tt,at,wt,Ot,1),ue.emplace(_e++,tt,at,wt,Ot,2),ue.emplace(_e++,tt,at,wt,Ot,3)}(!Eu||Eu.length<2*J)&&(Eu=function(He){const Qe=2*He,nt=new n.aP;nt.resize(Qe),nt._trim();for(let tt=0;tt<Qe;tt++){const at=6*tt;nt.uint16[at+0]=4*tt+0,nt.uint16[at+1]=4*tt+1,nt.uint16[at+2]=4*tt+2,nt.uint16[at+3]=4*tt+2,nt.uint16[at+4]=4*tt+3,nt.uint16[at+5]=4*tt+0}return nt}(J));const ge=k.createIndexBuffer(Eu,!0),Oe=k.createVertexBuffer(ue,n.cR.members,!0);for(const He of Y){const Qe={u_matrix:He.transform,u_inv_matrix:He.invTransform,u_camera_to_center_distance:(Ge=W).getCameraToCenterDistance(He.projection),u_viewport_size:[Ge.width,Ge.height]};pe.draw(f,U.TRIANGLES,Xn.disabled,hr.disabled,f.colorModeForRenderPass(),qn.disabled,Qe,s.id,Oe,ge,n.b2.simpleSegment(0,2*He.circleOffset,He.circleArray.length,He.circleArray.length/2),null,W.zoom)}var Ge;Oe.destroy(),ge.destroy()}const fd=n.a6.mat4.create();function ng(f){const i=f._camera.getWorldToCamera(f.worldSize,1),s=n.a6.mat4.multiply([],i,f.globeMatrix);n.a6.mat4.invert(s,s);const m=[0,0,0],x=[0,1,0,0];return n.a6.vec4.transformMat4(x,x,s),m[0]=x[0],m[1]=x[1],m[2]=x[2],n.a6.vec3.normalize(m,m),m}function M_({width:f,height:i,anchor:s,textOffset:m,textScale:x},w){const{horizontalAlign:A,verticalAlign:k}=n.by(s),U=-(A-.5)*f,W=-(k-.5)*i,j=n.bx(s,m);return new n.P((U/x+j[0])*w,(W/x+j[1])*w)}function kf(f,i,s,m,x,w,A,k,U,W,j){const Y=f.text.placedSymbolArray,J=f.text.dynamicLayoutVertexArray,oe=f.icon.dynamicLayoutVertexArray,pe={},ue=f.getProjection(),_e=So(k,ue,w),ge=w.elevation,Oe=ue.upVectorScale(k.canonical,w.center.lat,w.worldSize).metersToTile;J.clear();for(let Ge=0;Ge<Y.length;Ge++){const He=Y.get(Ge),{tileAnchorX:Qe,tileAnchorY:nt,numGlyphs:tt}=He,at=He.hidden||!He.crossTileID||f.allowVerticalPlacement&&!He.placedOrientation?null:m[He.crossTileID];if(at){let wt=0,Ot=0,Ct=0;if(ge){const hi=ge?ge.getAtTileOffset(k,Qe,nt):0,[Ti,Ci,gi]=ue.upVector(k.canonical,Qe,nt);wt=hi*Ti*Oe,Ot=hi*Ci*Oe,Ct=hi*gi*Oe}let[St,si,di,Si]=Vi(He.projectedAnchorX+wt,He.projectedAnchorY+Ot,He.projectedAnchorZ+Ct,s?_e:A);const Gi=fn(w.getCameraToCenterDistance(ue),Si);let Ki=x.evaluateSizeForFeature(f.textSizeData,W,He)*Gi/n.br;s&&(Ki*=f.tilePixelRatio/U);const qt=M_(at,Ki);s?({x:St,y:si,z:di}=ue.projectTilePoint(Qe+qt.x,nt+qt.y,k.canonical),[St,si,di]=Vi(St+wt,si+Ot,di+Ct,A)):(i&&qt._rotate(-w.angle),St+=qt.x,si+=qt.y,di=0);const wi=f.allowVerticalPlacement&&He.placedOrientation===n.bl.vertical?Math.PI/2:0;for(let hi=0;hi<tt;hi++)n.bo(J,St,si,di,wi);j&&He.associatedIconIndex>=0&&(pe[He.associatedIconIndex]={x:St,y:si,z:di,angle:wi})}else Vs(tt,J)}if(j){oe.clear();const Ge=f.icon.placedSymbolArray;for(let He=0;He<Ge.length;He++){const Qe=Ge.get(He),{numGlyphs:nt}=Qe,tt=pe[He];if(Qe.hidden||!tt)Vs(nt,oe);else{const{x:at,y:wt,z:Ot,angle:Ct}=tt;for(let St=0;St<nt;St++)n.bo(oe,at,wt,Ot,Ct)}}f.icon.dynamicLayoutVertexBuffer.updateData(oe)}f.text.dynamicLayoutVertexBuffer.updateData(J)}function ph(f,i,s,m,x,w,A={}){const k=s.paint.get("icon-translate"),U=s.paint.get("text-translate"),W=s.paint.get("icon-translate-anchor"),j=s.paint.get("text-translate-anchor"),Y=s.layout.get("icon-rotation-alignment"),J=s.layout.get("text-rotation-alignment"),oe=s.layout.get("icon-pitch-alignment"),pe=s.layout.get("text-pitch-alignment"),ue=s.layout.get("icon-keep-upright"),_e=s.layout.get("text-keep-upright"),ge=s.paint.get("icon-color-saturation"),Oe=s.paint.get("icon-color-contrast"),Ge=s.paint.get("icon-color-brightness-min"),He=s.paint.get("icon-color-brightness-max"),Qe=s.layout.get("symbol-elevation-reference")==="sea",nt=f.context,tt=nt.gl,at=f.transform,wt=Y==="map",Ot=J==="map",Ct=oe==="map",St=pe==="map",si=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let di=!1;const Si=f.depthModeForSublayer(0,Xn.ReadOnly),Gi=[n.am(at.center.lng),n.at(at.center.lat)],Ki=s.layout.get("text-variable-anchor"),qt=at.projection.name==="globe",wi=[],hi=[0,-1,0];for(const Ti of m){const Ci=i.getTile(Ti),gi=Ci.getBucket(s);if(!gi||gi.projection.name==="mercator"&&qt||gi.fullyClipped)continue;const Xi=gi.projection.name==="globe",zn=Xi?n.a9(at.zoom):0,$n=So(Ti,gi.getProjection(),at),An=at.calculatePixelsToTileUnitsMatrix(Ci),kn=Ki&&gi.hasTextData(),dn=gi.hasIconTextFit()&&kn&&gi.hasIconData(),tr=gi.getProjection().createInversionMatrix(at,Ti.canonical),dr=ps=>{at.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||f.terrain)&&(ps.push("DEPTH_D24"),ps.push("DEPTH_OCCLUSION"))},Nr=()=>{const ps=wt&&s.layout.get("symbol-placement")!=="point",Er=[];dr(Er);const ts=ps||dn,Gs=s.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&Ct&&Er.push("PITCH_WITH_MAP_TERRAIN"),Xi&&(Er.push("PROJECTION_GLOBE_VIEW"),ts&&Er.push("PROJECTED_POS_ON_VIEWPORT")),Gs>0&&Er.push("ICON_TRANSITION"),gi.icon.zOffsetVertexBuffer&&Er.push("Z_OFFSET"),ge===0&&Oe===0&&Ge===0&&He===1||Er.push("COLOR_ADJUSTMENT"),gi.sdfIcons&&Er.push("RENDER_SDF");const ra=gi.icon.programConfigurations.get(s.id),Ya=f.getOrCreateProgram("symbol",{config:ra,defines:Er}),Eo=Ci.imageAtlasTexture?Ci.imageAtlasTexture.size:[0,0],Wr=gi.iconSizeData,Hr=n.bk(Wr,at.zoom),Yr=Ct||at.pitch!==0,is=nn($n,Ci.tileID.canonical,Ct,wt,at,gi.getProjection(),An),Es=Ln($n,Ci.tileID.canonical,Ct,wt,at,gi.getProjection(),An),Os=f.translatePosMatrix(Es,Ci,k,W,!0),Do=f.translatePosMatrix($n,Ci,k,W),Il=ts?fd:is,Ma=wt&&!Ct&&!ps;let ha=hi;!qt&&!at.mercatorFromTransition||wt||(ha=ng(at));const Ka=Xi?ha:hi,Ja=s.getColorAdjustmentMatrix(ge,Oe,Ge,He),Sa=ig(Wr.kind,Hr,Ma,Ct,f,Do,Il,Os,Qe,!1,Eo,[0,0],!0,Ti,zn,Gi,tr,Ka,gi.getProjection(),Ja,Gs),Qa=Ci.imageAtlasTexture?Ci.imageAtlasTexture:null,ka=s.layout.get("icon-size").constantOr(0)!==1||gi.iconsNeedLinear,ls=gi.sdfIcons||f.options.rotating||f.options.zooming||ka||Yr?tt.LINEAR:tt.NEAREST,eu=gi.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Ip=f.terrain&&Ct&&ps?n.a6.mat4.invert(n.a6.mat4.create(),is):fd;if(ps&&gi.icon){const tu=at.elevation,Td=tu?tu.getAtTileOffsetFunc(Ti,at.center.lat,at.worldSize,gi.getProjection()):null,Gu=Ei($n,Ci.tileID.canonical,Ct,wt,at,gi.getProjection(),An);gr(gi,$n,f,!1,Gu,Es,Ct,ue,Td,Ti)}return{program:Ya,buffers:gi.icon,uniformValues:Sa,atlasTexture:Qa,atlasTextureIcon:null,atlasInterpolation:ls,atlasInterpolationIcon:null,isSDF:gi.sdfIcons,hasHalo:eu,tile:Ci,labelPlaneMatrixInv:Ip}},as=()=>{const ps=Ot&&s.layout.get("symbol-placement")!=="point",Er=[],ts=ps||Ki||dn;f.terrainRenderModeElevated()&&St&&Er.push("PITCH_WITH_MAP_TERRAIN"),Xi&&(Er.push("PROJECTION_GLOBE_VIEW"),ts&&Er.push("PROJECTED_POS_ON_VIEWPORT")),gi.text.zOffsetVertexBuffer&&Er.push("Z_OFFSET"),gi.iconsInText&&Er.push("RENDER_TEXT_AND_SYMBOL"),Er.push("RENDER_SDF"),dr(Er);const Gs=gi.text.programConfigurations.get(s.id),ra=f.getOrCreateProgram("symbol",{config:Gs,defines:Er});let Ya,Eo=[0,0],Wr=null;const Hr=gi.textSizeData;gi.iconsInText&&(Eo=Ci.imageAtlasTexture?Ci.imageAtlasTexture.size:[0,0],Wr=Ci.imageAtlasTexture?Ci.imageAtlasTexture:null,Ya=St||at.pitch!==0||f.options.rotating||f.options.zooming||Hr.kind==="composite"||Hr.kind==="camera"?tt.LINEAR:tt.NEAREST);const Yr=Ci.glyphAtlasTexture?Ci.glyphAtlasTexture.size:[0,0],is=s.layout.get("text-size-scale-range"),Es=n.ap(f.scaleFactor,is[0],is[1]),Os=n.bk(Hr,at.zoom,Es),Do=nn($n,Ci.tileID.canonical,St,Ot,at,gi.getProjection(),An),Il=Ln($n,Ci.tileID.canonical,St,Ot,at,gi.getProjection(),An),Ma=f.translatePosMatrix(Il,Ci,U,j,!0),ha=f.translatePosMatrix($n,Ci,U,j),Ka=ts?fd:Do,Ja=Ot&&!St&&!ps;let Sa=hi;!qt&&!at.mercatorFromTransition||Ot||(Sa=ng(at));const Qa=ig(Hr.kind,Os,Ja,St,f,ha,Ka,Ma,Qe,!0,Yr,Eo,!0,Ti,zn,Gi,tr,Xi?Sa:hi,gi.getProjection(),null,null,Es),ka=Ci.glyphAtlasTexture?Ci.glyphAtlasTexture:null,ls=tt.LINEAR,eu=s.paint.get("text-halo-width").constantOr(1)!==0,Ip=f.terrain&&St&&ps?n.a6.mat4.invert(n.a6.mat4.create(),Do):fd;if(ps&&gi.text){const tu=at.elevation,Td=tu?tu.getAtTileOffsetFunc(Ti,at.center.lat,at.worldSize,gi.getProjection()):null,Gu=Ei($n,Ci.tileID.canonical,St,Ot,at,gi.getProjection(),An);gr(gi,$n,f,!0,Gu,Il,St,_e,Td,Ti)}return{program:ra,buffers:gi.text,uniformValues:Qa,atlasTexture:ka,atlasTextureIcon:Wr,atlasInterpolation:ls,atlasInterpolationIcon:Ya,isSDF:!0,hasHalo:eu,tile:Ci,labelPlaneMatrixInv:Ip}},Ur=gi.icon.segments.get().length,vs=gi.text.segments.get().length,Xr=Ur&&!A.onlyText?Nr():null,Ss=vs&&!A.onlyIcons?as():null,br=s.paint.get("icon-opacity").constantOr(1),ds=s.paint.get("text-opacity").constantOr(1);if(si&&gi.canOverlap){di=!0;const ps=br&&!A.onlyText?gi.icon.segments.get():[],Er=ds&&!A.onlyIcons?gi.text.segments.get():[];for(const ts of ps)wi.push({segments:new n.b2([ts]),sortKey:ts.sortKey,state:Xr});for(const ts of Er)wi.push({segments:new n.b2([ts]),sortKey:ts.sortKey,state:Ss})}else A.onlyText||wi.push({segments:br?gi.icon.segments:new n.b2([]),sortKey:0,state:Xr}),A.onlyIcons||wi.push({segments:ds?gi.text.segments:new n.b2([]),sortKey:0,state:Ss})}di&&wi.sort((Ti,Ci)=>Ti.sortKey-Ci.sortKey);for(const Ti of wi){const Ci=Ti.state;if(Ci)if(f.terrain?f.terrain.setupElevationDraw(Ci.tile,Ci.program,{useDepthForOcclusion:at.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ci.labelPlaneMatrixInv}):f.setupDepthForOcclusion(at.depthOcclusionForSymbolsAndCircles,Ci.program),nt.activeTexture.set(tt.TEXTURE0),Ci.atlasTexture&&Ci.atlasTexture.bind(Ci.atlasInterpolation,tt.CLAMP_TO_EDGE,!0),Ci.atlasTextureIcon&&(nt.activeTexture.set(tt.TEXTURE1),Ci.atlasTextureIcon&&Ci.atlasTextureIcon.bind(Ci.atlasInterpolationIcon,tt.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,Ci.program),Ci.hasHalo){const gi=Ci.uniformValues;gi.u_is_halo=1,fh(Ci.buffers,Ti.segments,s,f,Ci.program,Si,x,w,gi,2),gi.u_is_halo=0}else{if(Ci.isSDF){const gi=Ci.uniformValues;Ci.hasHalo&&(gi.u_is_halo=1,fh(Ci.buffers,Ti.segments,s,f,Ci.program,Si,x,w,gi,1)),gi.u_is_halo=0}fh(Ci.buffers,Ti.segments,s,f,Ci.program,Si,x,w,Ci.uniformValues,1)}}}function fh(f,i,s,m,x,w,A,k,U,W){const j=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];x.draw(m,m.context.gl.TRIANGLES,w,A,k,qn.disabled,U,s.id,f.layoutVertexBuffer,f.indexBuffer,i,s.paint,m.transform.zoom,f.programConfigurations.get(s.id),j,W)}function up(f,i,s,m,x,w,A){const k=f.context.gl,U=s.paint.get("fill-pattern"),W=s.is3D(),j=W?f.stencilModeFor3D():hr.disabled,Y=U&&U.constantOr(1);let J,oe,pe,ue,_e;A?(oe=Y&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=k.LINES):(oe=Y?"fillPattern":"fill",J=k.TRIANGLES);for(const ge of m){const Oe=i.getTile(ge);if(Y&&!Oe.patternsLoaded())continue;const Ge=Oe.getBucket(s);if(!Ge)continue;f.prepareDrawTile();const He=Ge.programConfigurations.get(s.id),Qe=f.isTileAffectedByFog(ge),nt=f.getOrCreateProgram(oe,{config:He,overrideFog:Qe});Y&&(f.context.activeTexture.set(k.TEXTURE0),Oe.imageAtlasTexture&&Oe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),He.updatePaintBuffers());const tt=U.constantOr(null);if(tt&&Oe.imageAtlas){const Ot=Oe.imageAtlas.patternPositions[tt.toString()];Ot&&He.setConstantPatternPositions(Ot)}const at=f.translatePosMatrix(ge.projMatrix,Oe,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),wt=s.paint.get("fill-emissive-strength");if(A){ue=Ge.indexBuffer2,_e=Ge.segments2;const Ot=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];pe=oe==="fillOutlinePattern"&&Y?b_(at,wt,f,Oe,Ot):hd(at,wt,Ot)}else ue=Ge.indexBuffer,_e=Ge.segments,pe=Y?Rf(at,wt,f,Oe):eg(at,wt);f.uploadCommonUniforms(f.context,nt,ge.toUnwrapped()),nt.draw(f,J,x,W?j:f.stencilModeForClipping(ge),w,qn.disabled,pe,s.id,Ge.layoutVertexBuffer,ue,_e,s.paint,f.transform.zoom,He,void 0)}}function ta(f,i,s,m,x,w,A,k){s.resetLayerRenderingStats(f);const U=f.context,W=U.gl,j=f.transform,Y=s.paint.get("fill-extrusion-pattern"),J=Y.constantOr(1),oe=s.paint.get("fill-extrusion-opacity"),pe=f.style.enable3dLights(),ue=s.paint.get(pe&&!J?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_e=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue],ge=s.layout.get("fill-extrusion-edge-radius"),Oe=ge>0&&!s.paint.get("fill-extrusion-rounded-roof"),Ge=Oe?0:ge,He=j.projection.name==="globe"?n.c_():0,Qe=j.projection.name==="globe",nt=Qe?n.a9(j.zoom):0,tt=[n.am(j.center.lng),n.at(j.center.lat)],at=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(s.lut).toArray01().slice(0,3),wt=s.paint.get("fill-extrusion-flood-light-intensity"),Ot=s.paint.get("fill-extrusion-vertical-scale"),Ct=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,St=s.paint.get("fill-extrusion-height-alignment"),si=s.paint.get("fill-extrusion-base-alignment"),di=Ia(f,s.paint.get("fill-extrusion-cutoff-fade-range")),Si=[];let Gi;Qe&&Si.push("PROJECTION_GLOBE_VIEW"),_e[0]>0&&Si.push("FAUX_AO"),Oe&&Si.push("ZERO_ROOF_RADIUS"),k&&Si.push("HAS_CENTROID"),wt>0&&Si.push("FLOOD_LIGHT"),di.shouldRenderCutoff&&Si.push("RENDER_CUTOFF"),Ct&&Si.push("RENDER_WALL_MODE");const Ki=f.renderPass==="shadow",qt=f.shadowRenderer,wi=Ki&&!!qt;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let hi=[0,0,0];if(qt){const gi=f.style.directionalLight,Xi=f.style.ambientLight;gi&&Xi&&(hi=_u(f.style,gi,Xi)),Ki||(Si.push("RENDER_SHADOWS","DEPTH_TEXTURE"),qt.useNormalOffset&&Si.push("NORMAL_OFFSET")),Gi=Si.concat(["SHADOWS_SINGLE_CASCADE"])}const Ti=wi?"fillExtrusionDepth":J?"fillExtrusionPattern":"fillExtrusion",Ci=s.getLayerRenderingStats();for(const gi of m){const Xi=i.getTile(gi),zn=Xi.getBucket(s);if(!zn||zn.projection.name!==j.projection.name)continue;let $n=!1;qt&&($n=qt.getMaxCascadeForTile(gi.toUnwrapped())===0);const An=f.isTileAffectedByFog(gi),kn=zn.programConfigurations.get(s.id),dn=f.getOrCreateProgram(Ti,{config:kn,defines:$n?Gi:Si,overrideFog:An});if(f.terrain&&f.terrain.setupElevationDraw(Xi,dn,{useMeterToDem:!0}),!zn.centroidVertexBuffer){const Xr=dn.attributes.a_centroid_pos;Xr!==void 0&&W.vertexAttrib2f(Xr,0,0)}!Ki&&qt&&qt.setupShadows(Xi.tileID.toUnwrapped(),dn,"vector-tile",Xi.tileID.overscaledZ),J&&(f.context.activeTexture.set(W.TEXTURE0),Xi.imageAtlasTexture&&Xi.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),kn.updatePaintBuffers());const tr=Y.constantOr(null);if(tr&&Xi.imageAtlas){const Xr=Xi.imageAtlas.patternPositions[tr.toString()];Xr&&kn.setConstantPatternPositions(Xr)}const dr=s.paint.get("fill-extrusion-vertical-gradient"),Nr=1/zn.tileToMeter;let as;if(Ki&&qt){if(md(Xi.tileID,zn,f))continue;const Xr=qt.calculateShadowPassMatrixFromTile(Xi.tileID.toUnwrapped());as=Lf(Xr,Ge,Nr,Ot,St,si)}else{const Xr=f.translatePosMatrix(gi.expandedProjMatrix,Xi,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ss=j.projection.createInversionMatrix(j,gi.canonical);as=J?If(Xr,f,dr,oe,_e,Ge,Nr,gi,Xi,He,St,si,nt,tt,Ss,at,Ot):Cf(Xr,f,dr,oe,_e,Ge,Nr,gi,He,St,si,nt,tt,Ss,at,Ot,wt,hi)}f.uploadCommonUniforms(U,dn,gi.toUnwrapped(),null,di);let Ur=zn.segments;if(j.projection.name==="mercator"&&!Ki&&(Ur=zn.getVisibleSegments(Xi.tileID,f.terrain,f.transform.getFrustum(0)),!Ur.get().length))continue;if(Ci)if(Ki)for(const Xr of Ur.get())Ci.numRenderedVerticesInShadowPass+=Xr.primitiveLength;else for(const Xr of Ur.get())Ci.numRenderedVerticesInTransparentPass+=Xr.primitiveLength;const vs=[];(f.terrain||k)&&vs.push(zn.centroidVertexBuffer),Qe&&vs.push(zn.layoutVertexExtBuffer),Ct&&vs.push(zn.wallVertexBuffer),dn.draw(f,U.gl.TRIANGLES,x,w,A,qn.backCCW,as,s.id,zn.layoutVertexBuffer,zn.indexBuffer,Ur,s.paint,f.transform.zoom,kn,vs)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function ja(f,i,s,m,x,w,A,k,U,W,j,Y,J,oe,pe,ue,_e,ge,Oe){const Ge=f.context,He=Ge.gl,Qe=f.transform,nt=f.transform.zoom,tt=[],at=Ia(f,s.paint.get("fill-extrusion-cutoff-fade-range"));W==="clear"?(tt.push("CLEAR_SUBPASS"),Oe&&(tt.push("CLEAR_FROM_TEXTURE"),Ge.activeTexture.set(He.TEXTURE0),Oe.bind(He.LINEAR,He.CLAMP_TO_EDGE))):W==="sdf"&&tt.push("SDF_SUBPASS"),_e&&tt.push("HAS_CENTROID"),at.shouldRenderCutoff&&tt.push("RENDER_CUTOFF");const wt=s.layout.get("fill-extrusion-edge-radius"),Ot=(Ct,St,si,di,Si)=>{const Gi=St.programConfigurations.get(s.id),Ki=f.isTileAffectedByFog(Ct),qt=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Gi,defines:tt,overrideFog:Ki}),wi=((Ti,Ci,gi,Xi,zn,$n,An,kn,dn,tr,dr)=>({u_matrix:Ci,u_opacity:gi,u_ao_pass:Xi?1:0,u_meter_to_tile:zn,u_ao:$n,u_flood_light_intensity:An,u_flood_light_color:kn,u_attenuation:dn,u_edge_radius:tr,u_fb:0,u_fb_size:dr,u_dynamic_offset:1}))(0,di,j,U,Si,[Y,J*Si],oe,pe,ue,nt>=17?0:wt*Si,Oe?Oe.size[0]:0),hi=[];_e&&hi.push(St.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(Ge,qt,Ct.toUnwrapped(),null,at),qt.draw(f,Ge.gl.TRIANGLES,x,w,A,k,wi,s.id,St.vertexBuffer,St.indexBuffer,si,s.paint,nt,Gi,hi)};for(const Ct of m){const St=i.getTile(Ct),si=St.getBucket(s);if(!si||si.projection.name!==Qe.projection.name||!si.groundEffect||si.groundEffect&&!si.groundEffect.hasData())continue;const di=si.groundEffect,Si=1/si.tileToMeter;{const Gi=f.translatePosMatrix(Ct.projMatrix,St,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ki=di.getDefaultSegment();Ot(Ct,di,Ki,Gi,Si)}if(ge)for(let Gi=0;Gi<4;Gi++){const Ki=n.c$[Gi](Ct),qt=i.getTile(Ki);if(!qt)continue;const wi=qt.getBucket(s);if(!wi||wi.projection.name!==Qe.projection.name||!wi.groundEffect||wi.groundEffect&&!wi.groundEffect.hasData())continue;const hi=wi.groundEffect;let Ti,Ci;Gi===0?(Ti=[-n.ab,0,0],Ci=1):Gi===1?(Ti=[n.ab,0,0],Ci=0):Gi===2?(Ti=[0,-n.ab,0],Ci=3):(Ti=[0,n.ab,0],Ci=2);const gi=hi.regionSegments[Ci];if(!gi)continue;const Xi=new Float32Array(16);n.a6.mat4.translate(Xi,Ct.projMatrix,Ti),Ot(Ct,hi,gi,f.translatePosMatrix(Xi,St,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Si)}}}function rg(f,i,s,m,x,w,A){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const k=w?w.findDEMTileFor(s):null;if(!(k&&k.dem||A))return;const U=ge=>new n.P(Math.ceil((ge+n.d2)*n.d3),0),W=ge=>{const Oe=i.getSource().minzoom,Ge=Qe=>{const nt=i.getTileByID(Qe);if(nt&&nt.hasData())return nt.getBucket(x)},He=[0,-1,1];for(const Qe of He){if(ge.overscaledZ+Qe<Oe)continue;const nt=Ge(ge.calculateScaledKey(ge.overscaledZ+Qe));if(nt)return nt}},j=[0,0,0],Y=(ge,Oe)=>(j[0]=Math.min(ge.min.y,Oe.min.y),j[1]=Math.max(ge.max.y,Oe.max.y),j[2]=n.ab-Oe.min.x>ge.max.x?Oe.min.x-n.ab:ge.max.x,j),J=(ge,Oe)=>(j[0]=Math.min(ge.min.x,Oe.min.x),j[1]=Math.max(ge.max.x,Oe.max.x),j[2]=n.ab-Oe.min.y>ge.max.y?Oe.min.y-n.ab:ge.max.y,j),oe=[(ge,Oe)=>Y(ge,Oe),(ge,Oe)=>Y(Oe,ge),(ge,Oe)=>J(ge,Oe),(ge,Oe)=>J(Oe,ge)],pe=(ge,Oe,Ge,He,Qe,nt,tt)=>{if(!w)return 0;const at=[[nt?Ge:ge,nt?ge:Ge,0],[nt?Ge:Oe,nt?Oe:Ge,0]],wt=tt<0?n.ab+tt:tt,Ot=[nt?wt:(ge+Oe)/2,nt?(ge+Oe)/2:wt,0];return Ge===0&&tt<0||Ge!==0&&tt>0?w.getForTilePoints(Qe,[Ot],!0,He):at.push(Ot),w.getForTilePoints(s,at,!0,k),Math.max(at[0][2],at[1][2],Ot[2])/w.exaggeration()};for(let ge=0;ge<4;ge++){const Oe=m.borderFeatureIndices[ge];if(Oe.length===0)continue;const Ge=n.c$[ge](s),He=W(Ge);if(!(He&&He instanceof n.d0)||m.borderDoneWithNeighborZ[ge]===He.canonical.z)continue;He.centroidVertexArray.length===0&&He.createCentroidsBuffer();const Qe=w?w.findDEMTileFor(Ge):null;if(!(Qe&&Qe.dem||A))continue;const nt=(ge<2?1:5)-ge,tt=He.borderDoneWithNeighborZ[nt]!==m.canonical.z,at=He.borderFeatureIndices[nt];let wt=0;if(m.canonical.z!==He.canonical.z){for(const Ot of Oe)m.showCentroid(m.featuresOnBorder[Ot]);if(tt)for(const Ot of at)He.showCentroid(He.featuresOnBorder[Ot]);m.borderDoneWithNeighborZ[ge]=He.canonical.z,He.borderDoneWithNeighborZ[nt]=m.canonical.z}for(const Ot of Oe){const Ct=m.featuresOnBorder[Ot],St=m.centroidData[Ct.centroidDataIndex],si=Ct.borders[ge];let di;for(;wt<at.length;){di=He.featuresOnBorder[at[wt]];const Si=di.borders[nt];if(Si[1]>si[0]+3||Si[0]>si[0]-3)break;He.showCentroid(di),wt++}if(di&&wt<at.length){const Si=wt;let Gi=0;for(;!(di.borders[nt][0]>si[1]-3)&&(Gi++,++wt!==at.length);)di=He.featuresOnBorder[at[wt]];di=He.featuresOnBorder[at[Si]];let Ki=!1;if(Gi>=1){const hi=di.borders[nt];Math.abs(si[0]-hi[0])<3&&Math.abs(si[1]-hi[1])<3&&(Gi=1,Ki=!0,wt=Si+1)}else if(Gi===0){m.showCentroid(Ct);continue}const qt=He.centroidData[di.centroidDataIndex];A&&Ki&&(((ue=St).flags|(_e=qt).flags)&n.d1?(ue.flags|=n.d1,_e.flags|=n.d1):(ue.flags&=~n.d1,_e.flags&=~n.d1));const wi=Ct.intersectsCount()>1||di.intersectsCount()>1;if(Gi>1)wt=Si,St.centroidXY=qt.centroidXY=new n.P(0,0);else if(Qe&&Qe.dem&&!wi){const hi=oe[ge](St,qt),Ti=ge%2?n.ab-1:0,Ci=pe(hi[0],Math.min(n.ab-1,hi[1]),Ti,Qe,Ge,ge<2,hi[2]);St.centroidXY=qt.centroidXY=U(Ci)}else wi?St.centroidXY=qt.centroidXY=new n.P(0,0):(St.centroidXY=m.encodeBorderCentroid(Ct),qt.centroidXY=He.encodeBorderCentroid(di));m.writeCentroidToBuffer(St),He.writeCentroidToBuffer(qt)}else m.showCentroid(Ct)}m.borderDoneWithNeighborZ[ge]=He.canonical.z,He.borderDoneWithNeighborZ[nt]=m.canonical.z}var ue,_e;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(f)}const Ff=[1,0,0],hp=[0,1,0],Bf=[0,0,1];function md(f,i,s){const m=s.transform,x=s.shadowRenderer;if(!x)return!0;const w=f.toUnwrapped(),A=m.tileSize*x._cascades[s.currentShadowCascade].scale;let k=i.maxHeight;if(m.elevation){const ue=m.elevation.getMinMaxForTile(f);ue&&(k+=ue.max)}const U=[...x.shadowDirection];U[2]=-U[2];const W=x.computeSimplifiedTileShadowVolume(w,k,A,U);if(!W)return!1;const j=[Ff,hp,Bf,U,[U[0],0,U[2]],[0,U[1],U[2]]],Y=m.projection.name==="globe",J=m.scaleZoom(A),oe=n.bO.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,J,!Y),pe=x.getCurrentCascadeFrustum();return oe.intersectsPrecise(W.vertices,W.planes,j)===0||pe.intersectsPrecise(W.vertices,W.planes,j)===0}function ua(f){return[f[0]*n.d4,f[1]*n.d4,f[2]*n.d4,0]}function eo(f,i,s,m,x,w,A,k,U){const W=m.getSource(),j=s.globeSharedBuffers;if(!j)return;let Y,J,oe;if(i&&(Y=m.getTile(i)),W instanceof n.aD?(J=W.texture,oe=n.cD(0,0,s.transform)):Y&&i&&(J=Y.texture,oe=n.cD(i.canonical.z,i.canonical.x,s.transform)),!J||!oe)return;f||(oe=n.a6.mat4.scale(n.a6.mat4.create(),oe,[1,-1,1]));const pe=s.context,ue=pe.gl,_e=x.paint.get("raster-resampling")==="nearest"?ue.NEAREST:ue.LINEAR,ge=s.colorModeForDrapableLayerRenderPass(w),Oe=A.defines;Oe.push("GLOBE_POLES");const Ge=new Xn(ue.LEQUAL,Xn.ReadWrite,s.depthRangeFor3D),He=Float32Array.from(s.transform.expandedFarZProjMatrix),Qe=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),pe.activeTexture.set(ue.TEXTURE0),J.bind(_e,ue.CLAMP_TO_EDGE),pe.activeTexture.set(ue.TEXTURE1),J.bind(_e,ue.CLAMP_TO_EDGE),J.useMipmap&&pe.extTextureFilterAnisotropic&&s.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,pe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,pe.extTextureFilterAnisotropicMax);const[nt,tt,at,wt]=i?j.getPoleBuffers(i.canonical.z,!1):j.getPoleBuffers(0,!0),Ot=x.paint.get("raster-elevation");let Ct;f?(Ct=nt,s.renderDefaultNorthPole=Ot!==0):(Ct=tt,s.renderDefaultSouthPole=Ot!==0);const St=ua(A.mix),si=((Si,Gi,Ki,qt,wi,hi,Ti,Ci,gi,Xi,zn,$n,An)=>op(Si,Gi,Ki,new Float32Array(16),new Float32Array(9),[0,0],qt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},hi,[0,0],Ci,2,Xi,zn,$n,1,0,An))(He,Qe,oe,n.a9(s.transform.zoom),0,x,0,Ot,0,St,A.offset,A.range,w),di=s.getOrCreateProgram("raster",{defines:Oe});s.uploadCommonUniforms(pe,di,null),di.draw(s,ue.TRIANGLES,Ge,U,ge,k,si,x.id,Ct,at,wt)}function dp(f){const i=f._nearZ,s=f.projection.farthestPixelDistance(f),m=s-i,x=.2*f.height,w=i+x;return[i,s,(w-x-i)/m,(w-i)/m]}function Nf(f,i,s,m){if(f)return i instanceof Qo&&f instanceof _l?i.getTextureDescriptor(f,s,!0):{texture:f.texture,mix:ua(m.mix),offset:m.offset,buffer:0,tileSize:1}}var Uf=n.d5([{name:"a_index",type:"Int16",components:1}]);class pp{constructor(i,s,m,x){const w={width:m[0],height:m[1],data:null},A=i.gl;this.targetColorTexture=new n.T(i,w,A.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(i,w,A.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(s,x),this.lastInvalidatedAt=0}updateParticleTexture(i,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,x=s.width*s.height;this.particleTexture0=new n.T(this.context,s,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,s,m.RGBA8,{premultiply:!1,useMipmap:!1});const w=new n.d6;w.reserve(x);for(let A=0;A<x;A++)w.emplaceBack(A);this.particleIndexBuffer=this.context.createVertexBuffer(w,Uf.members,!0),this.particleSegment=n.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Gc(f,i,s){if(!f)return null;const m=i.getTextureDescriptor(f,s,!0);if(!m)return null;let{texture:x,mix:w,offset:A,tileSize:k,buffer:U,format:W}=m;if(!x||!W)return null;let j=!1;return W==="uint32"&&(j=!0,w[3]=0,w=dh(n.d7,w,[0,s.paint.get("raster-particle-max-speed")]),A=Mu(n.d7,A,[0,s.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[U/(k+2*U),k/(k+2*U)],tileSize:k,scalarData:j,scale:w,offset:A,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[W]]}}function S_(f){const i=f._nearZ,s=f.projection.farthestPixelDistance(f),m=s-i,x=.2*f.height,w=i+x;return[i,s,(w-x-i)/m,(w-i)/m]}const Hc=new n.bA(1,0,0,1),mh=new n.bA(0,1,0,1),qi=new n.bA(0,0,1,1),yn=new n.bA(1,0,1,1),Au=new n.bA(0,1,1,1);function Ts(f,i,s,m,x,w,A){const k=f.context,U=f.transform,W=k.gl,j=U.projection.name==="globe",Y=j?["PROJECTION_GLOBE_VIEW"]:[];let J=n.a6.mat4.clone(s.projMatrix);if(j&&n.a9(U.zoom)>0){const St=n.b5(s.canonical,U),si=n.d8(St);J=n.a6.mat4.multiply(new Float32Array(16),U.globeMatrix,si),n.a6.mat4.multiply(J,U.projMatrix,J)}const oe=n.a6.mat4.create();oe[12]+=2*x/(n.q.devicePixelRatio*U.width),oe[13]+=2*w/(n.q.devicePixelRatio*U.height),n.a6.mat4.multiply(J,oe,J);const pe=f.getOrCreateProgram("debug",{defines:Y}),ue=i.getTileByID(s.key);f.terrain&&f.terrain.setupElevationDraw(ue,pe);const _e=Xn.disabled,ge=hr.disabled,Oe=f.colorModeForRenderPass(),Ge="$debug";k.activeTexture.set(W.TEXTURE0),f.emptyTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),j?ue._makeGlobeTileDebugBuffers(f.context,U):ue._makeDebugTileBoundsBuffers(f.context,U.projection);const He=ue._tileDebugBuffer||f.debugBuffer,Qe=ue._tileDebugIndexBuffer||f.debugIndexBuffer,nt=ue._tileDebugSegments||f.debugSegments;if(pe.draw(f,W.LINE_STRIP,_e,ge,Oe,qn.disabled,Pf(J,m),Ge,He,Qe,nt,null,null,null,[ue._globeTileDebugBorderBuffer]),A){const St=ue.latestRawTileData,si=Math.floor((St&&St.byteLength||0)/1024);let di=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(di+=` => ${s.overscaledZ}`),di+=` ${ue.state}`,di+=` ${si}kb`,function(Si,Gi){Si.initDebugOverlayCanvas();const Ki=Si.debugOverlayCanvas,qt=Si.context.gl,wi=Si.debugOverlayCanvas.getContext("2d");wi.clearRect(0,0,Ki.width,Ki.height),wi.shadowColor="white",wi.shadowBlur=2,wi.lineWidth=1.5,wi.strokeStyle="white",wi.textBaseline="top",wi.font="bold 36px Open Sans, sans-serif",wi.fillText(Gi,5,5),wi.strokeText(Gi,5,5),Si.debugOverlayTexture.update(Ki),Si.debugOverlayTexture.bind(qt.LINEAR,qt.CLAMP_TO_EDGE)}(f,di)}const tt=i.getTile(s).tileSize,at=512/Math.min(tt,512)*(s.overscaledZ/U.zoom)*.5,wt=ue._tileDebugTextBuffer||f.debugBuffer,Ot=ue._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ct=ue._tileDebugTextSegments||f.debugSegments;pe.draw(f,W.TRIANGLES,_e,ge,Ir.alphaBlended,qn.disabled,Pf(J,n.bA.transparent,at),Ge,wt,Ot,Ct,null,null,null,[ue._globeTileDebugTextBuffer])}function Qt(f,i,s,m){Wa(f,0,i+s/2,f.transform.width,s,m)}function gh(f,i,s,m){Wa(f,i-s/2,0,s,f.transform.height,m)}function Wa(f,i,s,m,x,w){const A=f.context,k=A.gl;k.enable(k.SCISSOR_TEST),k.scissor(i*n.q.devicePixelRatio,s*n.q.devicePixelRatio,m*n.q.devicePixelRatio,x*n.q.devicePixelRatio),A.clear({color:w}),k.disable(k.SCISSOR_TEST)}const xo=n.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sl}=xo;function al(f,i,s,m){f.emplaceBack(i,s,m)}class jc{constructor(i){this.vertexArray=new n.d9,this.indices=new n.aP,al(this.vertexArray,-1,-1,1),al(this.vertexArray,1,-1,1),al(this.vertexArray,-1,1,1),al(this.vertexArray,1,1,1),al(this.vertexArray,-1,-1,-1),al(this.vertexArray,1,-1,-1),al(this.vertexArray,-1,1,-1),al(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Sl),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=n.b2.simpleSegment(0,0,36,12)}}function wa(f,i,s,m,x,w){const A=f.context.gl,k=i.paint.get("sky-atmosphere-color"),U=i.paint.get("sky-atmosphere-halo-color"),W=i.paint.get("sky-atmosphere-sun-intensity"),j=((Y,J,oe,pe,ue)=>({u_matrix_3f:Y,u_sun_direction:J,u_sun_intensity:oe,u_color_tint_r:[pe.r,pe.g,pe.b,pe.a],u_color_tint_m:[ue.r,ue.g,ue.b,ue.a],u_luminance:5e-5}))(n.a6.mat3.fromMat4(n.a6.mat3.create(),m),x,W,k,U);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),s.draw(f,A.TRIANGLES,Xn.disabled,hr.disabled,Ir.unblended,qn.frontCW,j,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const _h=n.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class yh{constructor(i){const s=new n.da;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const m=new n.aP;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(s,_h.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=n.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Cu=n.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Wc{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class fp{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Ir([1,ca,1,ca],n.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ir([1,0,1,0],n.bA.transparent,[!1,!1,!1,!0]),this.params=new Wc,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const s=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new yh(s);const m=this.params.sizeRange,x=this.params.intensityRange,w=function(j){const Y=n.dd(30),J=[];for(let oe=0;oe<j;++oe){const pe=2*Math.PI*Y(),ue=Math.acos(1-2*Y())-.5*Math.PI;J.push(n.a6.vec3.fromValues(Math.cos(ue)*Math.cos(pe),Math.cos(ue)*Math.sin(pe),Math.sin(ue)))}return J}(this.params.starsCount),A=n.dd(300),k=new n.db,U=new n.aP;let W=0;for(let j=0;j<w.length;++j){const Y=n.a6.vec3.scale([],w[j],200),J=Math.max(0,1+.01*m*(1*A()-.5)),oe=Math.max(0,1+.01*x*(1*A()-.5));k.emplaceBack(Y[0],Y[1],Y[2],-1,-1,J,oe),k.emplaceBack(Y[0],Y[1],Y[2],1,-1,J,oe),k.emplaceBack(Y[0],Y[1],Y[2],1,1,J,oe),k.emplaceBack(Y[0],Y[1],Y[2],-1,1,J,oe),U.emplaceBack(W+0,W+1,W+2),U.emplaceBack(W+0,W+2,W+3),W+=4}this.starsVx=s.createVertexBuffer(k,Cu.members),this.starsIdx=s.createIndexBuffer(U),this.starsSegments=n.b2.simpleSegment(0,0,k.length,U.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,s){const m=i.context,x=m.gl,w=i.transform,A=new Xn(x.LEQUAL,Xn.ReadOnly,[0,1]),k=n.a9(w.zoom),U=i.style.getLut(s.scope),W=s.properties.get("color").toRenderColor(U).toArray01(),j=s.properties.get("high-color").toRenderColor(U).toArray01(),Y=s.properties.get("space-color").toRenderColor(U).toArray01PremultipliedAlpha(),J=5e-4,oe=n.dc(s.properties.get("horizon-blend"),0,1,J,.25),pe=n.cx(i,m,w)&&oe===J?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,ue=i.frameCounter/1e3%1,_e=n.a6.vec3.length(w.globeCenterInViewSpace),ge=Math.sqrt(Math.pow(_e,2)-Math.pow(pe,2)),Oe=Math.acos(ge/_e),Ge=He=>{const Qe=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];He&&Qe.push("ALPHA_PASS");const nt=i.getOrCreateProgram("globeAtmosphere",{defines:Qe}),tt=((wt,Ot,Ct,St,si,di,Si,Gi,Ki,qt,wi,hi)=>({u_frustum_tl:wt,u_frustum_tr:Ot,u_frustum_br:Ct,u_frustum_bl:St,u_horizon:si,u_transition:di,u_fadeout_range:Si,u_color:Gi,u_high_color:Ki,u_space_color:qt,u_temporal_offset:wi,u_horizon_angle:hi}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,k,oe,W,j,Y,ue,Oe);i.uploadCommonUniforms(m,nt);const at=this.atmosphereBuffer;at&&nt.draw(i,x.TRIANGLES,A,hr.disabled,He?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,qn.backCW,tt,He?"atmosphere_glow_alpha":"atmosphere_glow",at.vertexBuffer,at.indexBuffer,at.segments)};Ge(!1),Ge(!0)}drawStars(i,s){const m=n.ap(s.properties.get("star-intensity"),0,1);if(m===0)return;const x=i.context,w=x.gl,A=i.transform,k=i.getOrCreateProgram("stars"),U=n.a6.quat.identity([]);n.a6.quat.rotateX(U,U,-A._pitch),n.a6.quat.rotateZ(U,U,-A.angle),n.a6.quat.rotateX(U,U,n.bC(A._center.lat)),n.a6.quat.rotateY(U,U,-n.bC(A._center.lng));const W=n.a6.mat4.fromQuat(new Float32Array(16),U),j=n.a6.mat4.multiply([],A.starsProjMatrix,W),Y=n.a6.mat3.fromMat4([],W),J=n.a6.mat3.invert([],Y),oe=[0,1,0];n.a6.vec3.transformMat3(oe,oe,J),n.a6.vec3.scale(oe,oe,this.params.sizeMultiplier);const pe=[1,0,0];n.a6.vec3.transformMat3(pe,pe,J),n.a6.vec3.scale(pe,pe,this.params.sizeMultiplier);const ue=(_e=oe,ge=pe,Oe=m,{u_matrix:Float32Array.from(j),u_up:_e,u_right:ge,u_intensity_multiplier:Oe});var _e,ge,Oe;i.uploadCommonUniforms(x,k),this.starsVx&&this.starsIdx&&k.draw(i,w.TRIANGLES,Xn.disabled,hr.disabled,this.colorModeAlphaBlendedWriteRGB,qn.disabled,ue,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function vh(f,i){const s=[...f],m=i.cameraWorldSizeForFog/i.worldSize,x=n.a6.mat4.identity([]);return n.a6.mat4.scale(x,x,[m,m,1]),n.a6.mat4.multiply(s,x,s),n.a6.mat4.multiply(s,i.worldToFogMatrix,s),s}function qc(f,i,s,m,x){const w=s.material,A=m.context,{baseColorTexture:k,metallicRoughnessTexture:U}=w.pbrMetallicRoughness,{normalTexture:W,occlusionTexture:j,emissionTexture:Y}=w;function J(pe,ue,_e){if(pe&&(f.push(ue),A.activeTexture.set(A.gl.TEXTURE0+_e),pe.gfxTexture)){const{minFilter:ge,magFilter:Oe,wrapS:Ge,wrapT:He}=pe.sampler;pe.gfxTexture.bindExtraParam(ge,Oe,Ge,He)}}J(k,"HAS_TEXTURE_u_baseColorTexture",co.BaseColor),J(U,"HAS_TEXTURE_u_metallicRoughnessTexture",co.MetallicRoughness),J(W,"HAS_TEXTURE_u_normalTexture",co.Normal),J(j,"HAS_TEXTURE_u_occlusionTexture",co.Occlusion),J(Y,"HAS_TEXTURE_u_emissionTexture",co.Emission),x&&(x.texture||(x.texture=new n.df(m.context,x.image,[x.image.height,x.image.height,x.image.height],A.gl.RGBA8)),A.activeTexture.set(A.gl.TEXTURE0+co.LUT),x.texture&&x.texture.bind(A.gl.LINEAR,A.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(s.texcoordBuffer)),s.colorBuffer&&(f.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(s.colorBuffer)),s.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(s.normalBuffer)),s.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(s.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES");const oe=m.shadowRenderer;oe&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),oe.useNormalOffset&&f.push("NORMAL_OFFSET"))}function ql(f,i,s,m,x,w){const A=s.paint.get("model-opacity"),k=i.context,U=new Xn(i.context.gl.LEQUAL,Xn.ReadWrite,i.depthRangeFor3D),W=i.transform,j=f.mesh,Y=j.material,J=Y.pbrMetallicRoughness,oe=i.style.fog;let pe;pe=i.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:n.a6.mat4.multiply([],m.zScaleMatrix,f.nodeModelMatrix),n.a6.mat4.multiply(pe,m.negCameraPosMatrix,pe);const ue=n.a6.mat4.invert([],pe);n.a6.mat4.transpose(ue,ue);const _e=s.paint.get("model-emissive-strength").constantOr(0),ge=pd(new Float32Array(f.worldViewProjection),new Float32Array(pe),new Float32Array(ue),null,i,A,J.baseColorFactor.toRenderColor(null),Y.emissiveFactor,J.metallicFactor,J.roughnessFactor,Y,_e,s),Oe={defines:[]},Ge=[],He=i.shadowRenderer;He&&(He.useNormalOffset=!1),qc(Oe.defines,Ge,j,i,s.lut);let Qe=null;if(oe){const at=vh(f.nodeModelMatrix,i.transform);if(Qe=new Float32Array(at),W.projection.name!=="globe"){const wt=j.aabb.min,Ot=j.aabb.max,[Ct,St]=oe.getOpacityForBounds(at,wt[0],wt[1],Ot[0],Ot[1]);Oe.overrideFog=Ct>=Pi||St>=Pi}}const nt=Ia(i,s.paint.get("model-cutoff-fade-range"));nt.shouldRenderCutoff&&Oe.defines.push("RENDER_CUTOFF");const tt=i.getOrCreateProgram("model",Oe);i.uploadCommonUniforms(k,tt,null,Qe,nt),i.renderPass!=="shadow"&&He&&He.setupShadowsFromMatrix(f.nodeModelMatrix,tt),tt.draw(i,k.gl.TRIANGLES,U,x,w,j.material.doubleSided?qn.disabled:qn.backCCW,ge,s.id,j.vertexBuffer,j.indexBuffer,j.segments,s.paint,i.transform.zoom,void 0,Ge)}function xh(f,i,s,m,x,w,A){let k;k=f.projection.name==="globe"?n.dg(s,f):[...s],n.a6.mat4.multiply(k,k,i.matrix);const U=n.a6.mat4.multiply([],m,k);if(i.meshes)for(const W of i.meshes){if(W.material.alphaMode!=="BLEND"){A.push({mesh:W,depth:0,modelIndex:x,worldViewProjection:U,nodeModelMatrix:k});continue}const j=n.a6.vec3.transformMat4([],W.centroid,U);j[2]>0&&w.push({mesh:W,depth:j[2],modelIndex:x,worldViewProjection:U,nodeModelMatrix:k})}if(i.children)for(const W of i.children)xh(f,W,s,m,x,w,A)}function bh(f,i,s,m){const x=s.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),A=x.getShadowPassColorMode(),k=x.calculateShadowPassMatrixFromMatrix(i),U=Df(k);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,w,hr.disabled,A,qn.backCCW,U,m.id,f.vertexBuffer,f.indexBuffer,f.segments,m.paint,s.transform.zoom,void 0,void 0)}function Vf(f,i,s){const m=i.updateZoomBasedPaintProperties(),x=function(w,A,k){let U,W,j,Y=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&Y>0){const J=w.terrain,oe=J.findDEMTileFor(k);oe&&oe.dem?U=n.di.create(J,k,oe):Y=0}if(Y===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),Y===A.validForExaggeration&&(Y===0||U&&U._demTile&&U._demTile.tileID===A.validForDEMTile.id&&U._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(const J in A.instancesPerModel){const oe=A.instancesPerModel[J];for(let pe=0;pe<oe.instancedDataArray.length;++pe){const ue=(U?Y*U.getElevationAt(0|oe.instancedDataArray.float32[16*pe],0|oe.instancedDataArray.float32[16*pe+1],!0,!0):0)+oe.instancesEvaluatedElevation[pe];oe.instancedDataArray.float32[16*pe+6]=ue,W=W?Math.min(A.terrainElevationMin,ue):ue,j=j?Math.max(A.terrainElevationMax,ue):ue}}return A.terrainElevationMin=W||0,A.terrainElevationMax=j||0,A.validForExaggeration=Y,A.validForDEMTile=U&&U._demTile?{id:U._demTile.tileID,timestamp:U._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,i,s);(m||x)&&(i.uploaded=!1,i.upload(f.context))}const qa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.ca([0,0,0],[n.ab,n.ab,0])};function Ko(f,i){const s=1<<f.canonical.z,m=i.getFreeCameraOptions().position,x=i.elevation,w=f.canonical.x/s,A=(f.canonical.x+1)/s,k=f.canonical.y/s,U=(f.canonical.y+1)/s;let W=i._centerAltitude;if(x){const oe=x.getMinMaxForTile(f);oe&&oe.max>W&&(W=oe.max)}const j=n.ap(m.x,w,A)-m.x,Y=n.ap(m.y,k,U)-m.y,J=n.bE(W,i.center.lat)-m.z;return i._zoomFromMercatorZ(Math.sqrt(j*j+Y*Y+J*J))}function gd(f,i,s,m,x,w,A){const k=f.context,U=f.renderPass==="shadow",W=f.shadowRenderer,j=U&&W?W.getShadowPassDepthMode():new Xn(k.gl.LEQUAL,Xn.ReadWrite,f.depthRangeFor3D),Y=f.isTileAffectedByFog(w);if(s.meshes)for(const J of s.meshes){const oe=["MODEL_POSITION_ON_GPU"],pe=[];let ue,_e,ge;m.instancedDataArray.length>20&&oe.push("INSTANCED_ARRAYS");const Oe=Ia(f,i.paint.get("model-cutoff-fade-range"));if(Oe.shouldRenderCutoff&&oe.push("RENDER_CUTOFF"),U&&W)ue=f.getOrCreateProgram("modelDepth",{defines:oe}),_e=Df(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(s.matrix)),ge=W.getShadowPassColorMode();else{qc(oe,pe,J,f,i.lut),ue=f.getOrCreateProgram("model",{defines:oe,overrideFog:Y});const He=J.material,Qe=He.pbrMetallicRoughness,nt=i.paint.get("model-opacity"),tt=i.paint.get("model-emissive-strength").constantOr(0);_e=pd(w.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,f,nt,Qe.baseColorFactor.toRenderColor(null),He.emissiveFactor,Qe.metallicFactor,Qe.roughnessFactor,He,tt,i,x),W&&(A.shadowUniformsInitialized?ue.setShadowUniformValues(k,W.getShadowUniformValues()):(W.setupShadows(w.toUnwrapped(),ue,"model-tile",w.overscaledZ),A.shadowUniformsInitialized=!0)),ge=Oe.shouldRenderCutoff||nt<1||He.alphaMode!=="OPAQUE"?Ir.alphaBlended:Ir.unblended}f.uploadCommonUniforms(k,ue,w.toUnwrapped(),null,Oe);const Ge=J.material.doubleSided?qn.disabled:qn.backCCW;if(m.instancedDataArray.length>20)pe.push(m.instancedDataBuffer),ue.draw(f,k.gl.TRIANGLES,j,hr.disabled,ge,Ge,_e,i.id,J.vertexBuffer,J.indexBuffer,J.segments,i.paint,f.transform.zoom,void 0,pe,m.instancedDataArray.length);else{const He=U?"u_instance":"u_normal_matrix";for(let Qe=0;Qe<m.instancedDataArray.length;++Qe)_e[He]=new Float32Array(m.instancedDataArray.arrayBuffer,64*Qe,16),ue.draw(f,k.gl.TRIANGLES,j,hr.disabled,ge,Ge,_e,i.id,J.vertexBuffer,J.indexBuffer,J.segments,i.paint,f.transform.zoom,void 0,pe)}}if(s.children)for(const J of s.children)gd(f,i,J,m,x,w,A)}const wh=[1,-1,1];function Ds(f,i,s,m){if(!s.modelManager)return!0;const x=s.modelManager;if(!s.shadowRenderer)return!0;const w=s.shadowRenderer,A=i.aabb;let k=!0,U=f.maxHeight;if(U===0){let j=0;for(const Y in f.instancesPerModel){const J=x.getModel(Y,m);J?j=Math.max(j,Math.max(Math.max(J.aabb.max[0],J.aabb.max[1]),J.aabb.max[2])):k=!1}U=f.maxScale*j*1.41+f.maxVerticalOffset,k&&(f.maxHeight=U)}A.max[2]=U,A.min[2]+=f.terrainElevationMin,A.max[2]+=f.terrainElevationMax,n.a6.vec3.transformMat4(A.min,A.min,i.tileMatrix),n.a6.vec3.transformMat4(A.max,A.max,i.tileMatrix);const W=A.intersects(w.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=W===2),W===0}function Qr(f,i){const s=f.uniformValues.u_cutoff_params[0],m=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],w=f.uniformValues.u_cutoff_params[3];return m===s||w===x?1:n.ap(((i-s)/(m-s)-x)/(w-x),0,1)}function Gf(f,i,s,m){if(i.pitch<20)return 1;const x=i.getWorldToCameraMatrix();n.a6.mat4.multiply(x,x,f);const w=n.a6.vec4.fromValues(s.min[0],s.min[1],s.min[2],1);let A=n.a6.vec4.transformMat4(n.a6.vec4.create(),w,x),k=A,U=A;w[1]=s.max[1],A=n.a6.vec4.transformMat4(n.a6.vec4.create(),w,x),k=A[1]<k[1]?A:k,U=A[1]>U[1]?A:U,w[0]=s.max[0],A=n.a6.vec4.transformMat4(n.a6.vec4.create(),w,x),k=A[1]<k[1]?A:k,U=A[1]>U[1]?A:U,w[1]=s.min[1],A=n.a6.vec4.transformMat4(n.a6.vec4.create(),w,x),k=A[1]<k[1]?A:k,U=A[1]>U[1]?A:U;const W=n.ap(m[0],0,1),j=100*i.pixelsPerMeter*n.ap(m[1],0,1),Y=n.ap(m[2],0,1),J=n.a6.vec4.lerp(n.a6.vec4.create(),k,U,W),oe=Math.tan(.5*i.fovX),pe=-J[2]*oe;if(j===0)return J[1]<-Math.abs(pe)?Y:1;const ue=(-Math.abs(pe)-J[1])/j,_e=(Oe,Ge,He)=>(1-He)*Oe+He*Ge,ge=n.ap(_e(1,Y,ue),Y,1);return _e(1,ge,n.ap((i.pitch-20)/20,0,1))}class cc{}class mp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,s,m){{const Y=this._storage.get(s.id);if(Y)return Y.lastUsedFrameIdx=i,Y.buf}const x=m.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),A=new ArrayBuffer(w),k=new Int16Array(A);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));const U=new n.dk;for(let Y=0;Y<w/2;Y+=3){const J=k[Y],oe=k[Y+1],pe=k[Y+2];U.emplaceBack(J,oe),U.emplaceBack(oe,pe),U.emplaceBack(pe,J)}const W=m.bindVertexArrayOES.current,j=new cc;return j.buf=new Oa(m,U),j.lastUsedFrameIdx=i,this._storage.set(s.id,j),m.bindVertexArrayOES.set(W),j.buf}update(i){for(const[s,m]of this._storage)i-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(s))}destroy(){for(const[i,s]of this._storage)s.buf.destroy(),this._storage.delete(i)}}class Lu{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class Th{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const $c={symbol:function(f,i,s,m,x){if(f.renderPass!=="translucent")return;const w=hr.disabled,A=f.colorModeForRenderPass(),k=s.layout.get("text-variable-anchor"),U=s.layout.get("text-size-scale-range"),W=n.ap(f.scaleFactor,U[0],U[1]);k&&function(J,oe,pe,ue,_e,ge,Oe,Ge){const He=oe.transform,Qe=_e==="map",nt=ge==="map";for(const tt of J){const at=ue.getTile(tt),wt=at.getBucket(pe);if(!wt||!wt.text||!wt.text.segments.get().length)continue;const Ot=n.bk(wt.textSizeData,He.zoom,Ge),Ct=So(tt,wt.getProjection(),He),St=He.calculatePixelsToTileUnitsMatrix(at),si=nn(Ct,at.tileID.canonical,nt,Qe,He,wt.getProjection(),St),di=wt.hasIconTextFit()&&wt.hasIconData();if(Ot){const Si=Math.pow(2,He.zoom-at.tileID.overscaledZ);kf(wt,Qe,nt,Oe,n.cS,He,si,tt,Si,Ot,di)}}}(m,f,s,i,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),x,W);const j=s.paint.get("icon-opacity").constantOr(1)!==0,Y=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||Y)?ph(f,i,s,m,w,A):(j&&ph(f,i,s,m,w,A,{onlyIcons:!0}),Y&&ph(f,i,s,m,w,A,{onlyText:!0})),i.map.showCollisionBoxes&&(cp(f,i,s,m,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),cp(f,i,s,m,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(f,i,s,m){if(f.renderPass!=="translucent")return;const x=s.paint.get("circle-opacity"),w=s.paint.get("circle-stroke-width"),A=s.paint.get("circle-stroke-opacity"),k=s.layout.get("circle-sort-key").constantOr(1)!==void 0,U=s.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||A.constantOr(1)===0))return;const W=f.context,j=W.gl,Y=f.transform,J=f.depthModeForSublayer(0,Xn.ReadOnly),oe=hr.disabled,pe=f.colorModeForDrapableLayerRenderPass(U),ue=Y.projection.name==="globe",_e=[n.am(Y.center.lng),n.at(Y.center.lat)],ge=[];for(let Ge=0;Ge<m.length;Ge++){const He=m[Ge],Qe=i.getTile(He),nt=Qe.getBucket(s);if(!nt||nt.projection.name!==Y.projection.name)continue;const tt=nt.programConfigurations.get(s.id),at=n.cT(s),wt=f.isTileAffectedByFog(He);ue&&at.push("PROJECTION_GLOBE_VIEW"),at.push("DEPTH_D24"),f.terrain&&Y.depthOcclusionForSymbolsAndCircles&&at.push("DEPTH_OCCLUSION");const Ot=f.getOrCreateProgram("circle",{config:tt,defines:at,overrideFog:wt}),Ct=nt.layoutVertexBuffer,St=nt.globeExtVertexBuffer,si=nt.indexBuffer,di=Y.projection.createInversionMatrix(Y,He.canonical),Si={programConfiguration:tt,program:Ot,layoutVertexBuffer:Ct,globeExtVertexBuffer:St,indexBuffer:si,uniformValues:n.cU(f,He,Qe,di,_e,s),tile:Qe};if(k){const Gi=nt.segments.get();for(const Ki of Gi)ge.push({segments:new n.b2([Ki]),sortKey:Ki.sortKey,state:Si})}else ge.push({segments:nt.segments,sortKey:0,state:Si})}k&&ge.sort((Ge,He)=>Ge.sortKey-He.sortKey);const Oe={useDepthForOcclusion:Y.depthOcclusionForSymbolsAndCircles};for(const Ge of ge){const{programConfiguration:He,program:Qe,layoutVertexBuffer:nt,globeExtVertexBuffer:tt,indexBuffer:at,uniformValues:wt,tile:Ot}=Ge.state,Ct=Ge.segments;f.terrain&&f.terrain.setupElevationDraw(Ot,Qe,Oe),f.uploadCommonUniforms(W,Qe,Ot.tileID.toUnwrapped()),Qe.draw(f,j.TRIANGLES,J,oe,pe,qn.disabled,wt,s.id,nt,at,Ct,s.paint,Y.zoom,He,[tt])}},heatmap:function(f,i,s,m){if(s.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,w=x.gl,A=hr.disabled,k=new Ir([w.ONE,w.ONE,w.ONE,w.ONE],n.bA.transparent,[!0,!0,!0,!0]);(function(oe,pe,ue,_e){const ge=oe.gl,Oe=pe.width*_e,Ge=pe.height*_e;oe.activeTexture.set(ge.TEXTURE1),oe.viewport.set([0,0,Oe,Ge]);let He=ue.heatmapFbo;if(!He||He&&(He.width!==Oe||He.height!==Ge)){He&&He.destroy();const Qe=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,Qe),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),He=ue.heatmapFbo=oe.createFramebuffer(Oe,Ge,!0,null),function(nt,tt,at,wt,Ot,Ct){const St=nt.gl;St.texImage2D(St.TEXTURE_2D,0,nt.extRenderToTextureHalfFloat?St.RGBA16F:St.RGBA,Ot,Ct,0,St.RGBA,nt.extRenderToTextureHalfFloat?St.HALF_FLOAT:St.UNSIGNED_BYTE,null),wt.colorAttachment.set(at)}(oe,0,Qe,He,Oe,Ge)}else ge.bindTexture(ge.TEXTURE_2D,He.colorAttachment.get()),oe.bindFramebuffer.set(He.framebuffer)})(x,f,s,f.transform.projection.name==="globe"?.5:.25),x.clear({color:n.bA.transparent});const U=f.transform,W=U.projection.name==="globe",j=W?["PROJECTION_GLOBE_VIEW"]:[],Y=W?qn.frontCCW:qn.disabled,J=[n.am(U.center.lng),n.at(U.center.lat)];for(let oe=0;oe<m.length;oe++){const pe=m[oe];if(i.hasRenderableParent(pe))continue;const ue=i.getTile(pe),_e=ue.getBucket(s);if(!_e||_e.projection.name!==U.projection.name)continue;const ge=f.isTileAffectedByFog(pe),Oe=_e.programConfigurations.get(s.id),Ge=f.getOrCreateProgram("heatmap",{config:Oe,defines:j,overrideFog:ge}),{zoom:He}=f.transform;f.terrain&&f.terrain.setupElevationDraw(ue,Ge),f.uploadCommonUniforms(x,Ge,pe.toUnwrapped());const Qe=U.projection.createInversionMatrix(U,pe.canonical);Ge.draw(f,w.TRIANGLES,Xn.disabled,A,k,Y,sp(f,pe,ue,Qe,J,He,s.paint.get("heatmap-intensity")),s.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,s.paint,f.transform.zoom,Oe,W?[_e.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,w){const A=x.context,k=A.gl,U=w.heatmapFbo;if(!U)return;A.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,U.colorAttachment.get()),A.activeTexture.set(k.TEXTURE1);let W=w.colorRampTexture;W||(W=w.colorRampTexture=new n.T(A,w.colorRamp,k.RGBA8)),W.bind(k.LINEAR,k.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,k.TRIANGLES,Xn.disabled,hr.disabled,x.colorModeForRenderPass(),qn.disabled,((j,Y,J,oe)=>({u_image:0,u_color_ramp:1,u_opacity:Y.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(f,s))},line:function(f,i,s,m){if(f.renderPass!=="translucent")return;const x=s.paint.get("line-opacity"),w=s.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const A=s.paint.get("line-emissive-strength"),k=s.paint.get("line-occlusion-opacity"),U=s.layout.get("line-elevation-reference")==="sea",W=f.context,j=W.gl,Y=!s.isDraped();if(Y&&f.transform.projection.name==="globe")return;const J=s.layout.get("line-cross-slope"),oe=J!==void 0,pe=J<1,ue=Y?new Xn(f.depthOcclusion?j.GREATER:j.LEQUAL,Xn.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,Xn.ReadOnly),_e=f.colorModeForDrapableLayerRenderPass(A),ge=f.terrain&&f.terrain.renderingToTexture,Oe=ge?1:n.q.devicePixelRatio,Ge=s.paint.get("line-dasharray"),He=Ge.constantOr(1),Qe=s.layout.get("line-cap"),nt=Ge.constantOr(null),tt=Qe.constantOr(null),at=s.paint.get("line-pattern"),wt=at.constantOr(1),Ot=at.constantOr(null),Ct=s.paint.get("line-opacity").constantOr(1);let St=!wt&&Ct!==1||f.depthOcclusion&&k>0&&k<1;const si=s.paint.get("line-gradient"),di=wt?"linePattern":"line",Si=n.cV(s);let Gi;if(ge&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(St=!1),k!==0&&f.depthOcclusion){const qt=s.paint._values["line-opacity"];qt&&qt.value&&qt.value.kind==="constant"?Gi=qt.value:n.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}if(Y&&(f.forceTerrainMode=!0),!Y&&k!==0&&f.terrain&&!ge)return void n.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`);const Ki=St&&Y?f.stencilModeFor3D():hr.disabled;Y&&(Si.push("ELEVATED"),oe&&Si.push(pe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),U&&Si.push("ELEVATION_REFERENCE_SEA"));for(const qt of m){const wi=i.getTile(qt);if(wt&&!wi.patternsLoaded())continue;const hi=wi.getBucket(s);if(!hi)continue;f.prepareDrawTile();const Ti=hi.programConfigurations.get(s.id),Ci=f.isTileAffectedByFog(qt),gi=f.getOrCreateProgram(di,{config:Ti,defines:Si,overrideFog:Ci,overrideRtt:!Y&&void 0});if(Ot&&wi.imageAtlas){const dn=wi.imageAtlas.patternPositions[Ot.toString()];dn&&Ti.setConstantPatternPositions(dn)}if(!wt&&nt&&tt&&wi.lineAtlas){const dn=wi.lineAtlas.getDash(nt,tt);dn&&Ti.setConstantPatternPositions(dn)}let[Xi,zn]=s.paint.get("line-trim-offset");(tt==="round"||tt==="square")&&Xi!==zn&&(Xi===0&&(Xi-=1),zn===1&&(zn+=1));const $n=ge?qt.projMatrix:null,An=wt?n.cW(f,wi,s,$n,Oe,[Xi,zn]):n.cX(f,wi,s,$n,hi.lineClipsArray.length,Oe,[Xi,zn]);if(si){const dn=hi.gradients[s.id];let tr=dn.texture;if(s.gradientVersion!==dn.version){let dr=256;if(s.stepInterpolant){const Nr=i.getSource().maxzoom,as=qt.canonical.z===Nr?Math.ceil(1<<f.transform.maxZoom-qt.canonical.z):1;dr=n.ap(n.cY(hi.maxLineLength/n.ab*1024*as),256,W.maxTextureSize)}dn.gradient=n.cZ({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:dr,image:dn.gradient||void 0,clips:hi.lineClipsArray}),dn.texture?dn.texture.update(dn.gradient):dn.texture=new n.T(W,dn.gradient,j.RGBA8),dn.version=s.gradientVersion,tr=dn.texture}W.activeTexture.set(j.TEXTURE1),tr.bind(s.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}He&&(W.activeTexture.set(j.TEXTURE0),wi.lineAtlasTexture&&wi.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),Ti.updatePaintBuffers()),wt&&(W.activeTexture.set(j.TEXTURE0),wi.imageAtlasTexture&&wi.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ti.updatePaintBuffers()),Y&&!U&&f.terrain.setupElevationDraw(wi,gi),f.uploadCommonUniforms(W,gi,qt.toUnwrapped());const kn=dn=>{Gi!=null&&(Gi.value=Ct*k),gi.draw(f,j.TRIANGLES,ue,dn,_e,qn.disabled,An,s.id,hi.layoutVertexBuffer,hi.indexBuffer,hi.segments,s.paint,f.transform.zoom,Ti,[hi.layoutVertexBuffer2,hi.patternVertexBuffer,hi.zOffsetVertexBuffer]),Gi!=null&&(Gi.value=Ct)};if(St&&!Y){const dn=f.stencilModeForClipping(qt).ref;dn===0&&ge&&W.clear({stencil:0});const tr={func:j.EQUAL,mask:255};An.u_alpha_discard_threshold=.8,kn(new hr(tr,dn,255,j.KEEP,j.KEEP,j.INVERT)),An.u_alpha_discard_threshold=0,kn(new hr(tr,dn,255,j.KEEP,j.KEEP,j.KEEP))}else St&&Y&&(An.u_alpha_discard_threshold=.001),kn(Y?Ki:f.stencilModeForClipping(qt))}Y&&(f.forceTerrainMode=!1),St&&(f.resetStencilClippingMasks(),ge&&W.clear({stencil:0})),k===0||f.depthOcclusion||ge||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,i,s,m){const x=s.paint.get("fill-color"),w=s.paint.get("fill-opacity"),A=s.is3D(),k=new Xn(f.context.gl.LEQUAL,Xn.ReadWrite,f.depthRangeFor3D);if(w.constantOr(1)===0)return;const U=s.paint.get("fill-emissive-strength"),W=f.colorModeForDrapableLayerRenderPass(U),j=s.paint.get("fill-pattern"),Y=f.opaquePassEnabledForLayer()&&!j.constantOr(1)&&x.constantOr(n.bA.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Y){const J=A?k:f.depthModeForSublayer(1,f.renderPass==="opaque"?Xn.ReadWrite:Xn.ReadOnly);up(f,i,s,m,J,W,!1)}if(!A&&f.renderPass==="translucent"&&s.paint.get("fill-antialias")){const J=A?k:f.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Xn.ReadOnly);up(f,i,s,m,J,W,!0)}},"fill-extrusion":function(f,i,s,m){const x=s.paint.get("fill-extrusion-opacity"),w=f.context,A=w.gl,k=f.terrain,U=k&&k.renderingToTexture;if(x===0)return;const W=f.conflationActive&&f.style.isLayerClipped(s,i.getSource()),j=f.style.order.indexOf(s.fqid);if(W&&function(Y,J,oe,pe,ue){for(const _e of pe){const ge=J.getTile(_e).getBucket(oe);ge&&(ge.updateReplacement(_e,Y.replacementSource,ue),ge.uploadCentroid(Y.context))}}(f,i,s,m,j),k||W)for(const Y of m){const J=i.getTile(Y).getBucket(s);J&&rg(f.context,i,Y,J,s,k,W)}if(f.renderPass==="shadow"&&f.shadowRenderer){const Y=f.shadowRenderer;if(k&&x<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a4)return;const J=Y.getShadowPassDepthMode(),oe=Y.getShadowPassColorMode();ta(f,i,s,m,J,hr.disabled,oe,W)}else if(f.renderPass==="translucent"){const Y=!s.paint.get("fill-extrusion-pattern").constantOr(1),J=s.paint.get("fill-extrusion-color").constantOr(n.bA.white);if(!U&&J.a!==0){const oe=new Xn(f.context.gl.LEQUAL,Xn.ReadWrite,f.depthRangeFor3D);x===1&&Y?ta(f,i,s,m,oe,hr.disabled,Ir.unblended,W):(ta(f,i,s,m,oe,hr.disabled,Ir.disabled,W),ta(f,i,s,m,oe,f.stencilModeFor3D(),f.colorModeForRenderPass(),W),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&Y&&(!k&&f.transform.projection.name!=="globe"||U)){const oe=s.paint.get("fill-extrusion-opacity"),pe=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),_e=s.paint.get("fill-extrusion-flood-light-intensity"),ge=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(s.lut).toArray01().slice(0,3),Oe=pe>0&&ue>0,Ge=_e>0,He=(nt,tt,at)=>(1-at)*nt+at*tt,Qe=nt=>{const tt=f.depthModeForSublayer(1,Xn.ReadOnly,A.LEQUAL,!0),at=s.paint.get(nt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),wt=He(.1,3,at),Ot=f._showOverdrawInspector;if(!Ot){const Ct=new hr({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),St=new Ir([A.ONE,A.ONE,A.ONE,A.ONE],n.bA.transparent,[!1,!1,!1,!0],A.MIN);ja(f,i,s,m,tt,Ct,St,qn.disabled,nt,"sdf",oe,pe,ue,_e,ge,wt,W,!1)}{const Ct=Ot?hr.disabled:new hr({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),St=Ot?f.colorModeForRenderPass():new Ir([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],n.bA.transparent,[!0,!0,!0,!0]);ja(f,i,s,m,tt,Ct,St,qn.disabled,nt,"color",oe,pe,ue,_e,ge,wt,W,!1)}};if(U){const nt=(tt,at,wt)=>{const Ot=f.depthModeForSublayer(1,Xn.ReadOnly,A.LEQUAL,!1),Ct=s.paint.get(tt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),St=He(.1,3,Ct);{const si=new Ir([A.ONE,A.ONE,A.ONE,A.ONE],n.bA.transparent,[!1,!1,!1,!0]);ja(f,i,s,m,Ot,hr.disabled,si,qn.disabled,tt,"clear",oe,pe,ue,_e,ge,St,W,at)}{const si=new hr({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),di=new Ir([A.ONE,A.ONE,A.ONE,A.ONE],n.bA.transparent,[!1,!1,!1,!0],A.MIN);ja(f,i,s,m,Ot,si,di,qn.disabled,tt,"sdf",oe,pe,ue,_e,ge,St,W,at)}{const si=tt?A.ZERO:A.ONE_MINUS_DST_ALPHA,di=new hr({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Si=new Ir([si,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],n.bA.transparent,[!0,!0,!0,!0]);ja(f,i,s,m,Ot,di,Si,qn.disabled,tt,"color",oe,pe,ue,_e,ge,St,W,at)}{const si=new Ir([A.ONE,A.ONE,A.ONE,tt?A.ZERO:A.ONE],n.bA.transparent,[!1,!1,!1,!0],tt?A.FUNC_ADD:A.MAX);ja(f,i,s,m,Ot,hr.disabled,si,qn.disabled,tt,"clear",oe,pe,ue,_e,ge,St,W,at,wt)}};if(Oe||Ge){let tt;if(f.prepareDrawTile(),k){const at=k.drapeBufferSize[0],wt=k.drapeBufferSize[1];tt=k.framebufferCopyTexture,tt&&(!tt||tt.size[0]===at&&tt.size[1]===wt)||(tt&&tt.destroy(),tt=k.framebufferCopyTexture=new n.T(w,new n.r({width:at,height:wt}),A.RGBA8)),tt.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,at,wt)}Oe&&nt(!0,!1,tt),Ge&&nt(!1,!0,tt)}}else Oe&&Qe(!0),Ge&&Qe(!1),(Oe||Ge)&&f.resetStencilClippingMasks()}}},hillshade:function(f,i,s,m){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,w=f.terrain&&f.terrain.renderingToTexture,[A,k]=f.renderPass!=="translucent"||w?[{},m]:f.stencilConfigForOverlap(m);for(const U of k){const W=i.getTile(U);if(W.needsHillshadePrepare&&f.renderPass==="offscreen")bu(f,W,s);else if(f.renderPass==="translucent"){const j=f.depthModeForSublayer(0,Xn.ReadOnly),Y=s.paint.get("hillshade-emissive-strength"),J=f.colorModeForDrapableLayerRenderPass(Y),oe=w&&f.terrain?f.terrain.stencilModeForRTTOverlap(U):A[U.overscaledZ];Kd(f,U,W,s,j,oe,J)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,i,s,m,x,w){if(f.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const A=f.transform.projection.name==="globe",k=s.paint.get("raster-elevation")!==0,U=k&&A;if(f.renderElevatedRasterBackface&&!U)return;const W=f.context,j=W.gl,Y=i.getSource(),J=function(nt,tt,at,wt){const Ot=tt.paint.get("raster-color"),Ct=nt.type==="raster-array",St=[],si=tt.paint.get("raster-resampling"),di=tt.paint.get("raster-color-mix");let Si=tt.paint.get("raster-color-range");const Gi=[di[0],di[1],di[2],0],Ki=di[3];let qt=si==="nearest"?wt.NEAREST:wt.LINEAR;if(Ct&&(St.push("RASTER_ARRAY"),Ot||St.push("RASTER_COLOR"),si==="linear"&&St.push("RASTER_ARRAY_LINEAR"),qt=wt.NEAREST,!Si&&nt.rasterLayers)){const wi=nt.rasterLayers.find(({id:hi})=>hi===tt.sourceLayer);wi&&wi.fields&&wi.fields.range&&(Si=wi.fields.range)}if(Si=Si||[0,1],Ot){St.push("RASTER_COLOR"),at.activeTexture.set(wt.TEXTURE2),tt.updateColorRamp(Si);let wi=tt.colorRampTexture;wi||(wi=tt.colorRampTexture=new n.T(at,tt.colorRamp,wt.RGBA8)),wi.bind(wt.LINEAR,wt.CLAMP_TO_EDGE)}return{mix:Gi,range:Si,offset:Ki,defines:St,resampling:qt}}(Y,s,W,j);if(Y instanceof n.aD&&!m.length&&!A)return;const oe=s.paint.get("raster-emissive-strength"),pe=f.colorModeForDrapableLayerRenderPass(oe),ue=f.terrain&&f.terrain.renderingToTexture,_e=!f.options.moving,ge=s.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(Y instanceof n.aD&&!m.length&&(Y.onNorthPole||Y.onSouthPole)){const nt=k?f.stencilModeFor3D():hr.disabled;return void eo(!!Y.onNorthPole,null,f,i,s,oe,J,qn.disabled,nt)}if(!m.length)return;const[Oe,Ge]=Y instanceof n.aD||ue?[{},m]:f.stencilConfigForOverlap(m),He=Ge[Ge.length-1].overscaledZ;U&&J.defines.push("PROJECTION_GLOBE_VIEW"),k&&J.defines.push("RENDER_CUTOFF");const Qe=(nt,tt,at)=>{for(const wt of nt){const Ot=wt.toUnwrapped(),Ct=i.getTile(wt);if(ue&&(!Ct||!Ct.hasData()))continue;W.activeTexture.set(j.TEXTURE0);const St=Nf(Ct,Y,s,J);if(!St||!St.texture)continue;const{texture:si,mix:di,offset:Si,tileSize:Gi,buffer:Ki}=St;let qt,wi;ue?(qt=Xn.disabled,wi=wt.projMatrix):k?(qt=new Xn(j.LEQUAL,Xn.ReadWrite,f.depthRangeFor3D),wi=A?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Ot,_e)):(qt=f.depthModeForSublayer(wt.overscaledZ-He,s.paint.get("raster-opacity")===1?Xn.ReadWrite:Xn.ReadOnly,j.LESS),wi=f.transform.calculateProjMatrix(Ot,_e));const hi=f.terrain&&ue?f.terrain.stencilModeForRTTOverlap(wt):Oe[wt.overscaledZ],Ti=w?0:s.paint.get("raster-fade-duration");Ct.registerFadeDuration(Ti);const Ci=i.findLoadedParent(wt,0),gi=np(Ct,Ci,i,f.transform,Ti);let Xi,zn;f.terrain&&f.terrain.prepareDrawTile(),W.activeTexture.set(j.TEXTURE0),si.bind(ge,j.CLAMP_TO_EDGE),W.activeTexture.set(j.TEXTURE1),Ci?(Ci.texture&&Ci.texture.bind(ge,j.CLAMP_TO_EDGE),Xi=Math.pow(2,Ci.tileID.overscaledZ-Ct.tileID.overscaledZ),zn=[Ct.tileID.canonical.x*Xi%1,Ct.tileID.canonical.y*Xi%1]):si.bind(ge,j.CLAMP_TO_EDGE),si.useMipmap&&W.extTextureFilterAnisotropic&&f.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const $n=f.transform;let An;const kn=k?dp($n):[0,0,0,0];let dn,tr,dr,Nr,as,Ur=0;if(U&&Y instanceof n.aD&&Y.coordinates.length>3)dn=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0)))),tr=Float32Array.from($n.globeMatrix),dr=Float32Array.from(n.cy($n)),Nr=[n.am($n.center.lng),n.at($n.center.lat)],An=Y.elevatedGlobePerspectiveTransform,as=Y.elevatedGlobeGridMatrix||new Float32Array(9);else if(U){const br=n.cz(wt.canonical);Ur=n.cA(br.getCenter().lat),dn=Float32Array.from(n.b6(n.cC(wt.canonical))),tr=Float32Array.from($n.globeMatrix),dr=Float32Array.from(n.cy($n)),Nr=[n.am($n.center.lng),n.at($n.center.lat)],An=[0,0],as=Float32Array.from(n.cB(wt.canonical,br,Ur,$n.worldSize/$n._pixelsPerMercatorPixel))}else An=Y instanceof n.aD?Y.perspectiveTransform:[0,0],dn=new Float32Array(16),tr=new Float32Array(9),dr=new Float32Array(16),Nr=[0,0],as=new Float32Array(9);const vs=op(wi,dn,tr,dr,as,zn||[0,0],n.a9(f.transform.zoom),Nr,kn,Xi||1,gi,s,An,k?s.paint.get("raster-elevation"):0,2,di,Si,J.range,Gi,Ki,oe),Xr=f.isTileAffectedByFog(wt),Ss=f.getOrCreateProgram("raster",{defines:J.defines,overrideFog:Xr});if(f.uploadCommonUniforms(W,Ss,Ot),Y instanceof n.aD){const br=Y.elevatedGlobeVertexBuffer,ds=Y.elevatedGlobeIndexBuffer;if(ue||!A)Y.boundsBuffer&&Y.boundsSegments&&Ss.draw(f,j.TRIANGLES,qt,hr.disabled,pe,qn.disabled,vs,s.id,Y.boundsBuffer,f.quadTriangleIndexBuffer,Y.boundsSegments);else if(br&&ds){const ps=$n.zoom<=n.c3?Y.elevatedGlobeSegments:Y.getSegmentsForLongitude($n.center.lng);ps&&Ss.draw(f,j.TRIANGLES,qt,hr.disabled,pe,tt,vs,s.id,br,ds,ps)}}else if(U){qt=new Xn(j.LEQUAL,Xn.ReadOnly,f.depthRangeFor3D);const br=f.globeSharedBuffers;if(br){const[ds,ps,Er]=br.getGridBuffers(Ur,!1);Ss.draw(f,j.TRIANGLES,qt,at||hi,f.colorModeForRenderPass(),tt,vs,s.id,ds,ps,Er)}}else{const{tileBoundsBuffer:br,tileBoundsIndexBuffer:ds,tileBoundsSegments:ps}=f.getTileBoundsBuffers(Ct);Ss.draw(f,j.TRIANGLES,qt,hi,pe,qn.disabled,vs,s.id,br,ds,ps)}}if(!(Y instanceof n.aD)&&U)for(const wt of nt){const Ot=wt.canonical.y===(1<<wt.canonical.z)-1;wt.canonical.y===0&&eo(!0,wt,f,i,s,oe,J,tt,at||hr.disabled),Ot&&eo(!1,wt,f,i,s,oe,J,tt===qn.frontCW?qn.backCW:qn.frontCW,at||hr.disabled)}};U?Qe(Ge,f.renderElevatedRasterBackface?qn.backCW:qn.frontCW,f.stencilModeFor3D()):Qe(Ge,qn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,i,s,m,x,w){f.renderPass==="offscreen"&&function(A,k,U,W){if(!W.length)return;const j=A.context,Y=j.gl,J=k.getSource();if(!(J instanceof Qo))return;const oe=Math.ceil(Math.sqrt(U.paint.get("raster-particle-count")));let pe=U.particlePositionRGBAImage;if(!pe||pe.width!==oe){const Ge=function(He){const Qe=He*He,nt=new Uint8Array(4*Qe),tt=function(wt){return wt|=0,wt=Math.imul(2747636419^wt,2654435769),wt=Math.imul(wt^wt>>>16,2654435769),((wt=Math.imul(wt^wt>>>16,2654435769))>>>0)/4294967296},at=1/1.1;for(let wt=0;wt<Qe;wt++){const Ot=at*(tt(2*wt+0)+Uc),Ct=at*(tt(2*wt+1)+Uc),St=255*Ot%1,si=255*Ct%1,di=St,Si=Ct-si/255,Gi=si;nt[4*wt+0]=255*(Ot-St/255),nt[4*wt+1]=255*di,nt[4*wt+2]=255*Si,nt[4*wt+3]=255*Gi}return nt}(oe);pe=U.particlePositionRGBAImage=new n.r({width:oe,height:oe},Ge)}let ue=U.particleFramebuffer;ue?ue.width!==oe&&(ue.destroy(),ue=U.particleFramebuffer=j.createFramebuffer(oe,oe,!0,null)):ue=U.particleFramebuffer=j.createFramebuffer(oe,oe,!0,null);const _e=[];for(const Ge of W){const He=k.getTile(Ge);if(!(He instanceof _l))continue;const Qe=Gc(He,J,U);if(!Qe)continue;const nt=[He.tileSize,He.tileSize];let tt=U.tileFramebuffer;tt||(tt=U.tileFramebuffer=j.createFramebuffer(nt[0],nt[1],!0,null));let at=He.rasterParticleState;at||(at=He.rasterParticleState=new pp(j,Ge,nt,pe));const wt=at.update(U.lastInvalidatedAt);at.particleTextureDimension!==oe&&at.updateParticleTexture(Ge,pe);const Ot=at.targetColorTexture;at.targetColorTexture=at.backgroundColorTexture,at.backgroundColorTexture=Ot;const Ct=at.particleTexture0;at.particleTexture0=at.particleTexture1,at.particleTexture1=Ct,_e.push([Ge,Qe,at,wt])}if(_e.length===0)return;const ge=n.q.now(),Oe=U.previousDrawTimestamp?.001*(ge-U.previousDrawTimestamp):.0167;if(U.previousDrawTimestamp=ge,U.hasColorMap()){j.activeTexture.set(Y.TEXTURE0+2);let Ge=U.colorRampTexture;Ge||(Ge=U.colorRampTexture=new n.T(j,U.colorRamp,Y.RGBA8)),Ge.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}j.bindFramebuffer.set(U.tileFramebuffer.framebuffer),function(Ge,He,Qe){const nt=Ge.context,tt=nt.gl,at=He.tileFramebuffer;nt.activeTexture.set(tt.TEXTURE0);const wt={u_texture:0,u_opacity:1.05*(Ct=He.paint.get("raster-particle-fade-opacity-factor"))/(Ct+.05)},Ot=Ge.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ct;for(const St of Qe){const[,,si,di]=St;at.colorAttachment.set(si.targetColorTexture.texture),nt.viewport.set([0,0,at.width,at.height]),nt.clear({color:n.bA.transparent}),di&&(si.backgroundColorTexture.bind(tt.NEAREST,tt.CLAMP_TO_EDGE),Ot.draw(Ge,tt.TRIANGLES,Xn.disabled,hr.disabled,Ir.alphaBlended,qn.disabled,wt,He.id,Ge.viewportBuffer,Ge.quadTriangleIndexBuffer,Ge.viewportSegments))}}(A,U,_e),function(Ge,He,Qe,nt){const tt=Ge.context,at=tt.gl,wt=Qe.tileFramebuffer,Ot=Ge.transform.projection.name==="globe",Ct=Qe.paint.get("raster-particle-max-speed");for(const St of nt){const[si,di,Si]=St;tt.activeTexture.set(at.TEXTURE0+0),di.texture.bind(at.LINEAR,at.CLAMP_TO_EDGE),wt.colorAttachment.set(Si.targetColorTexture.texture);const Gi=Ge.getOrCreateProgram("rasterParticleDraw",{defines:di.defines,overrideFog:!1});tt.activeTexture.set(at.TEXTURE0+1);const Ki=di.scalarData?[]:[0,1,2,3].map(hi=>n.c$[hi](si));Ki.push(si);const qt=si.canonical.x,wi=si.canonical.y;for(const hi of Ki){const Ti=He.getTile(Ot?hi.wrapped():hi);if(!Ti)continue;const Ci=Ti.rasterParticleState;if(!Ci)continue;const gi=hi.canonical.x+(1<<hi.canonical.z)*(hi.wrap-si.wrap),Xi=hi.canonical.y;Ci.particleTexture0.bind(at.NEAREST,at.CLAMP_TO_EDGE);const zn=dd(1,Ci.particleTexture0.size[0],[gi-qt,Xi-wi],0,di.texture.size,2,Ct,di.textureOffset,di.scale,di.offset);Gi.draw(Ge,at.POINTS,Xn.disabled,hr.disabled,Ir.alphaBlended,qn.disabled,zn,Qe.id,Ci.particleIndexBuffer,void 0,Ci.particleSegment)}}}(A,k,U,_e),j.bindFramebuffer.set(U.particleFramebuffer.framebuffer),function(Ge,He,Qe,nt){const tt=Ge.context,at=tt.gl,wt=He.paint.get("raster-particle-max-speed"),Ot=nt*He.paint.get("raster-particle-speed-factor")*.15,Ct=function(si){return Math.pow(si,6)}(.01+1*He.paint.get("raster-particle-reset-rate-factor")),St=He.particleFramebuffer;tt.viewport.set([0,0,St.width,St.height]);for(const si of Qe){const[,di,Si]=si;tt.activeTexture.set(at.TEXTURE0+0),di.texture.bind(at.LINEAR,at.CLAMP_TO_EDGE),tt.activeTexture.set(at.TEXTURE0+1);const Gi=Si.particleTexture0;Gi.bind(at.NEAREST,at.CLAMP_TO_EDGE);const Ki=lp(1,Gi.size[0],0,di.texture.size,wt,Ot,Ct,di.textureOffset,di.scale,di.offset);St.colorAttachment.set(Si.particleTexture1.texture),tt.clear({color:n.bA.transparent}),Ge.getOrCreateProgram("rasterParticleUpdate",{defines:di.defines}).draw(Ge,at.TRIANGLES,Xn.disabled,hr.disabled,Ir.unblended,qn.disabled,Ki,He.id,Ge.viewportBuffer,Ge.quadTriangleIndexBuffer,Ge.viewportSegments)}}(A,U,_e,Oe)}(f,i,s,m),f.renderPass==="translucent"&&(function(A,k,U,W,j){const Y=A.context,J=Y.gl,oe=k.getSource().tileSize,pe=5*(1-n.a7(n.bV,n.bV+1,A.transform.zoom))*oe+U.paint.get("raster-particle-elevation"),ue=!A.options.moving,_e=A.transform.projection.name==="globe";if(!W.length)return;const[ge,Oe]=A.stencilConfigForOverlap(W),Ge=[];_e&&Ge.push("PROJECTION_GLOBE_VIEW");const He=A.stencilModeFor3D();for(const Qe of Oe){const nt=Qe.toUnwrapped(),tt=k.getTile(Qe);if(!tt.rasterParticleState)continue;const at=tt.rasterParticleState,wt=100;tt.registerFadeDuration(wt);const Ot=k.findLoadedParent(Qe,0),Ct=np(tt,Ot,k,A.transform,wt);let St,si;A.terrain&&A.terrain.prepareDrawTile(),Y.activeTexture.set(J.TEXTURE0),at.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Y.activeTexture.set(J.TEXTURE1),Ot&&Ot.rasterParticleState?(Ot.rasterParticleState.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),St=Math.pow(2,Ot.tileID.overscaledZ-tt.tileID.overscaledZ),si=[tt.tileID.canonical.x*St%1,tt.tileID.canonical.y*St%1]):at.targetColorTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const di=_e?Float32Array.from(A.transform.expandedFarZProjMatrix):A.transform.calculateProjMatrix(nt,ue),Si=A.transform,Gi=S_(Si),Ki=n.cz(Qe.canonical),qt=n.cA(Ki.getCenter().lat);let wi,hi,Ti,Ci,gi;_e?(wi=Float32Array.from(n.b6(n.cC(Qe.canonical))),hi=Float32Array.from(Si.globeMatrix),Ti=Float32Array.from(n.cy(Si)),Ci=[n.am(Si.center.lng),n.at(Si.center.lat)],gi=Float32Array.from(n.cB(Qe.canonical,Ki,qt,Si.worldSize/Si._pixelsPerMercatorPixel))):(wi=new Float32Array(16),hi=new Float32Array(9),Ti=new Float32Array(16),Ci=[0,0],gi=new Float32Array(9));const Xi=ap(di,wi,hi,Ti,gi,si||[0,0],n.a9(A.transform.zoom),Ci,Gi,St||1,Ct,pe),zn=A.isTileAffectedByFog(Qe),$n=A.getOrCreateProgram("rasterParticle",{defines:Ge,overrideFog:zn});if(A.uploadCommonUniforms(Y,$n,nt),_e){const An=new Xn(J.LEQUAL,Xn.ReadOnly,A.depthRangeFor3D),kn=0,dn=A.globeSharedBuffers;if(dn){const[tr,dr,Nr]=dn.getGridBuffers(qt,kn!==0);$n.draw(A,J.TRIANGLES,An,He,Ir.alphaBlended,A.renderElevatedRasterBackface?qn.frontCCW:qn.backCCW,Xi,U.id,tr,dr,Nr)}}else{const An=A.depthModeForSublayer(0,Xn.ReadOnly),kn=ge[Qe.overscaledZ],{tileBoundsBuffer:dn,tileBoundsIndexBuffer:tr,tileBoundsSegments:dr}=A.getTileBoundsBuffers(tt);$n.draw(A,J.TRIANGLES,An,kn,Ir.alphaBlended,qn.disabled,Xi,U.id,dn,tr,dr)}}A.resetStencilClippingMasks()}(f,i,s,m),f.style.map.triggerRepaint())},background:function(f,i,s,m){const x=s.paint.get("background-color"),w=s.paint.get("background-opacity"),A=s.paint.get("background-emissive-strength"),k=s.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const U=f.context,W=U.gl,j=f.transform,Y=j.tileSize,J=s.paint.get("background-pattern");let oe;if(J!==void 0&&(J===null||(oe=f.imageManager.getPattern(J.toString(),s.scope,f.style.getLut(s.scope)),!oe)))return;const pe=!J&&x.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==pe)return;const ue=hr.disabled,_e=f.depthModeForSublayer(0,pe==="opaque"?Xn.ReadWrite:Xn.ReadOnly),ge=f.colorModeForDrapableLayerRenderPass(A),Oe=J?"backgroundPattern":"background";let Ge,He=m;if(He||(Ge=f.getBackgroundTiles(),He=Object.values(Ge).map(Qe=>Qe.tileID)),J&&(U.activeTexture.set(W.TEXTURE0),f.imageManager.bind(f.context,s.scope)),k){const Qe=f.getOrCreateProgram(Oe,{overrideFog:!1,overrideRtt:!0}),nt=new Float32Array(n.a6.mat4.identity([])),tt=new n.aA(0,0,0,0,0),at=J?ac(nt,A,w,f,0,s.scope,oe,k,{tileID:tt,tileSize:Y}):Su(nt,A,w,x.toRenderColor(s.lut));Qe.draw(f,W.TRIANGLES,_e,ue,ge,qn.disabled,at,s.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const Qe of He){const nt=f.isTileAffectedByFog(Qe),tt=f.getOrCreateProgram(Oe,{overrideFog:nt}),at=Qe.toUnwrapped(),wt=m?Qe.projMatrix:f.transform.calculateProjMatrix(at);f.prepareDrawTile();const Ot=i?i.getTile(Qe):Ge?Ge[Qe.key]:new Us(Qe,Y,j.zoom,f),Ct=J?ac(wt,A,w,f,0,s.scope,oe,k,{tileID:Qe,tileSize:Y}):Su(wt,A,w,x.toRenderColor(s.lut));f.uploadCommonUniforms(U,tt,at);const{tileBoundsBuffer:St,tileBoundsIndexBuffer:si,tileBoundsSegments:di}=f.getTileBoundsBuffers(Ot);tt.draw(f,W.TRIANGLES,_e,ue,ge,qn.disabled,Ct,s.id,St,si,di)}},sky:function(f,i,s){const m=f._atmosphere?n.a9(f.transform.zoom):1,x=s.paint.get("sky-opacity")*m;if(x===0)return;const w=f.context,A=s.paint.get("sky-type"),k=new Xn(w.gl.LEQUAL,Xn.ReadOnly,[0,1]),U=f.frameCounter/1e3%1;A==="atmosphere"?f.renderPass==="offscreen"?s.needsSkyboxCapture(f)&&(function(W,j,Y,J){const oe=W.context,pe=oe.gl;let ue=j.skyboxFbo;if(!ue){ue=j.skyboxFbo=oe.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new jc(oe),j.skyboxTexture=oe.gl.createTexture(),pe.bindTexture(pe.TEXTURE_CUBE_MAP,j.skyboxTexture),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MAG_FILTER,pe.LINEAR);for(let Ge=0;Ge<6;++Ge)pe.texImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,0,pe.RGBA,32,32,0,pe.RGBA,pe.UNSIGNED_BYTE,null)}oe.bindFramebuffer.set(ue.framebuffer),oe.viewport.set([0,0,32,32]);const _e=j.getCenter(W,!0),ge=W.getOrCreateProgram("skyboxCapture"),Oe=new Float64Array(16);n.a6.mat4.identity(Oe),n.a6.mat4.rotateY(Oe,Oe,.5*-Math.PI),wa(W,j,ge,Oe,_e,0),n.a6.mat4.identity(Oe),n.a6.mat4.rotateY(Oe,Oe,.5*Math.PI),wa(W,j,ge,Oe,_e,1),n.a6.mat4.identity(Oe),n.a6.mat4.rotateX(Oe,Oe,.5*-Math.PI),wa(W,j,ge,Oe,_e,2),n.a6.mat4.identity(Oe),n.a6.mat4.rotateX(Oe,Oe,.5*Math.PI),wa(W,j,ge,Oe,_e,3),n.a6.mat4.identity(Oe),wa(W,j,ge,Oe,_e,4),n.a6.mat4.identity(Oe),n.a6.mat4.rotateY(Oe,Oe,Math.PI),wa(W,j,ge,Oe,_e,5),oe.viewport.set([0,0,W.width,W.height])}(f,s),s.markSkyboxValid(f)):f.renderPass==="sky"&&function(W,j,Y,J,oe){const pe=W.context,ue=pe.gl,_e=W.transform,ge=W.getOrCreateProgram("skybox");pe.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_CUBE_MAP,j.skyboxTexture);const Oe=((Ge,He,Qe,nt,tt)=>({u_matrix:Ge,u_sun_direction:He,u_cubemap:0,u_opacity:nt,u_temporal_offset:tt}))(_e.skyboxMatrix,j.getCenter(W,!1),0,J,oe);W.uploadCommonUniforms(pe,ge),ge.draw(W,ue.TRIANGLES,Y,hr.disabled,W.colorModeForRenderPass(),qn.backCW,Oe,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,s,k,x,U):A==="gradient"&&f.renderPass==="sky"&&function(W,j,Y,J,oe){const pe=W.context,ue=pe.gl,_e=W.transform,ge=W.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new jc(pe)),pe.activeTexture.set(ue.TEXTURE0);let Oe=j.colorRampTexture;Oe||(Oe=j.colorRampTexture=new n.T(pe,j.colorRamp,ue.RGBA8)),Oe.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Ge=((He,Qe,nt,tt,at)=>({u_matrix:He,u_color_ramp:0,u_center_direction:Qe,u_radius:n.bC(nt),u_opacity:tt,u_temporal_offset:at}))(_e.skyboxMatrix,j.getCenter(W,!1),j.paint.get("sky-gradient-radius"),J,oe);W.uploadCommonUniforms(pe,ge),ge.draw(W,ue.TRIANGLES,Y,hr.disabled,W.colorModeForRenderPass(),qn.backCW,Ge,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,s,k,x,U)},debug:function(f,i,s,m,x,w){for(let A=0;A<s.length;A++)if(x){const W=new n.bA(m.r*.8,m.g*.8,m.b*.8,1);Ts(f,i,s[A],m,-1,-1,w),Ts(f,i,s[A],m,-1,1,w),Ts(f,i,s[A],m,1,1,w),Ts(f,i,s[A],m,1,-1,w),Ts(f,i,s[A],W,0,0,w)}else Ts(f,i,s[A],m,0,0,w)},custom:function(f,i,s,m){const x=f.context,w=s.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&s.isDraped(i)){if(f.renderPass==="offscreen"){const A=w.prerender;if(A){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const k=f.transform.pointMerc;A.call(w,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),n.a9(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else A.call(w,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const k=w.renderToTile;if(k){const U=m[0].canonical,W=new n.a5(U.x+m[0].wrap*(1<<U.z),U.y,U.z);x.setDepthMode(Xn.disabled),x.setStencilMode(hr.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),k.call(w,x.gl,W),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(hr.disabled);const A=w.renderingMode==="3d"?new Xn(f.context.gl.LEQUAL,Xn.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Xn.ReadOnly);if(x.setDepthMode(A),f.transform.projection.name==="globe"){const k=f.transform.pointMerc;w.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),n.a9(f.transform.zoom),[k.x,k.y],f.transform.pixelsPerMeterRatio)}else w.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,i,s,m){if(f.renderPass==="opaque")return;const x=s.paint.get("model-opacity");if(x===0)return;const w=s.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!w||f.terrain&&x<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof n.a4))return;const A=f.shadowRenderer,k=s.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,k||(A.enabled=!1));const U=()=>{A&&(A.useNormalOffset=!0,k||(A.enabled=!0))},W=i.getSource();if(f.renderPass==="light-beam"&&W.type!=="batched-model")return;if(W.type==="vector"||W.type==="geojson")return function(ge,Oe,Ge,He,Qe){const nt=ge.transform;if(nt.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${nt.projection.name} projection is not yet implemented`);const tt=nt.getFreeCameraOptions().position;if(!ge.modelManager)return;const at=ge.modelManager;Ge.modelManager=at;const wt=ge.shadowRenderer;if(!Ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ot=Ge._unevaluatedLayout._values["model-id"],Ct={...Ge.layout.get("model-id").parameters},St=ge.style.order.indexOf(Ge.fqid);for(const si of He){const di=Oe.getTile(si).getBucket(Ge);if(!di||di.projection.name!==nt.projection.name)continue;const Si=di.getModelUris();Si&&!di.modelsRequested&&(at.addModelsFromBucket(Si,Qe),di.modelsRequested=!0);const Gi=Ko(si,nt);Ct.zoom=Gi;const Ki=Ot.possiblyEvaluate(Ct);if(Vf(ge,di,si),qa.shadowUniformsInitialized=!1,qa.useSingleShadowCascade=!!wt&&wt.getMaxCascadeForTile(si.toUnwrapped())===0,ge.renderPass==="shadow"&&wt){if(ge.currentShadowCascade===1&&di.isInsideFirstShadowMapFrustum)continue;const hi=nt.calculatePosMatrix(si.toUnwrapped(),nt.worldSize);if(qa.tileMatrix.set(hi),qa.shadowTileMatrix=Float32Array.from(wt.calculateShadowPassMatrixFromMatrix(hi)),qa.aabb.min.fill(0),qa.aabb.max[0]=qa.aabb.max[1]=n.ab,qa.aabb.max[2]=0,Ds(di,qa,ge,Ge.scope))continue}const qt=1<<si.canonical.z,wi=[((tt.x-si.wrap)*qt-si.canonical.x)*n.ab,(tt.y*qt-si.canonical.y)*n.ab,tt.z*qt*n.ab];ge.conflationActive&&Object.keys(di.instancesPerModel).length>0&&ge.style.isLayerClipped(Ge,Oe.getSource())&&di.updateReplacement(si,ge.replacementSource,St,Qe)&&(di.uploaded=!1,di.upload(ge.context));for(let hi in di.instancesPerModel){const Ti=di.instancesPerModel[hi];Ti.features.length>0&&(hi=Ki.evaluate(Ti.features[0].feature,{}));const Ci=at.getModel(hi,Qe);if(Ci&&Ci.uploaded)for(const gi of Ci.nodes)gd(ge,Ge,gi,Ti,wi,si,qa)}}}(f,i,s,m,W.type==="vector"?s.scope:""),void U();if(!W.loaded())return;if(W.type==="batched-model")return function(ge,Oe,Ge,He){Ge.resetLayerRenderingStats(ge);const Qe=ge.context,nt=ge.transform,tt=ge.style.fog,at=ge.shadowRenderer;if(nt.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${nt.projection.name} projection is not yet implemented`);const wt=ge.transform.getFreeCameraOptions().position,Ot=n.a6.vec3.scale([],[wt.x,wt.y,wt.z],ge.transform.worldSize),Ct=n.a6.vec3.negate([],Ot),St=n.a6.mat4.identity([]),si=n.de(nt.center.lat,nt.zoom),di=n.a6.mat4.fromScaling([],[1,1,1/si]);n.a6.mat4.translate(St,St,Ct);const Si=Ge.paint.get("model-opacity"),Gi=new Xn(Qe.gl.LEQUAL,Xn.ReadWrite,ge.depthRangeFor3D),Ki=new Xn(Qe.gl.LEQUAL,Xn.ReadOnly,ge.depthRangeFor3D),qt=new n.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),wi=ge.renderPass==="shadow",hi=wi&&at?at.getCurrentCascadeFrustum():nt.getFrustum(nt.scaleZoom(nt.worldSize)),Ti=Ge.paint.get("model-front-cutoff"),Ci=Ti[2]<1,gi=Ia(ge,Ge.paint.get("model-cutoff-fade-range")),Xi=Ge.getLayerRenderingStats();(function(zn,$n,An,kn){const dn=zn.terrain?zn.terrain.exaggeration():0,tr=zn.transform.zoom;for(const dr of kn){const Nr=$n.getTile(dr).getBucket(An);Nr&&(zn.conflationActive&&Nr.updateReplacement(dr,zn.replacementSource),Nr.evaluateScale(zn,An),zn.terrain&&dn>0&&Nr.elevationUpdate(zn.terrain,dn,dr,An.source),Nr.needsReEvaluation(zn,tr,An)&&Nr.evaluate(An))}})(ge,Oe,Ge,He),function(){let zn,$n,An;Ci?(zn=He.length-1,$n=-1,An=-1):(zn=0,$n=He.length,An=1);const kn=new Float64Array(16),dn=n.a6.vec3.create(),tr=new n.P(0,0);for(let dr=zn;dr!==$n;dr+=An){const Nr=He[dr],as=Oe.getTile(Nr).getBucket(Ge);if(!as||!as.uploaded)continue;let Ur=!1;at&&(Ur=at.getMaxCascadeForTile(Nr.toUnwrapped())===0);const vs=nt.calculatePosMatrix(Nr.toUnwrapped(),nt.worldSize),Xr=as.modelTraits;!wi&&Ci&&(n.a6.mat4.invert(kn,vs),n.a6.vec3.transformMat4(dn,Ot,kn),tr.x=dn[0],tr.y=dn[1]);const Ss=[];for(const br of as.getNodesInfo()){if(br.hiddenByReplacement||!br.node.meshes)continue;const ds=br.node;let ps=0;ge.terrain&&ds.elevation&&(ps=ds.elevation*ge.terrain.exaggeration());const Er=(()=>{const Es=br.aabb;return qt.min=[...Es.min],qt.max=[...Es.max],qt.min[2]+=ps,qt.max[2]+=ps,n.a6.vec3.transformMat4(qt.min,qt.min,vs),n.a6.vec3.transformMat4(qt.max,qt.max,vs),qt})(),ts=br.evaluatedScale;if(ts[0]<=1&&ts[1]<=1&&ts[2]<=1&&Er.intersects(hi)===0)continue;if(!wi&&Ci){const Es=.16666666666666666;br.cameraCollisionOpacity=Ot[0]>Er.min[0]&&Ot[0]<Er.max[0]&&Ot[1]>Er.min[1]&&Ot[1]<Er.max[1]&&Ot[2]*si<Er.max[2]&&ds.footprint&&n.bv(tr,ds.footprint)?Math.max(br.cameraCollisionOpacity-Es,0):Math.min(1,br.cameraCollisionOpacity+Es)}const Gs=[...vs],ra=ds.anchor?ds.anchor[0]:0,Ya=ds.anchor?ds.anchor[1]:0;n.a6.mat4.translate(Gs,Gs,[ra*(ts[0]-1),Ya*(ts[1]-1),ps]),n.a6.vec3.exactEquals(ts,n.dh)||n.a6.mat4.scale(Gs,Gs,ts);const Eo=n.a6.mat4.multiply([],Gs,ds.matrix),Wr=n.a6.mat4.multiply([],nt.expandedFarZProjMatrix,Eo),Hr=n.a6.mat4.multiply([],nt.expandedFarZProjMatrix,Gs),Yr=n.a6.vec4.transformMat4([],[ra,Ya,ps,1],Wr)[2];ds.hidden=!1;let is=Si;wi||(Ci&&(is*=br.cameraCollisionOpacity,is*=Gf(Gs,nt,br.aabb,Ti)),is*=Qr(gi,Yr)),is!==0?Ss.push({nodeInfo:br,depth:Yr,opacity:is,wvpForNode:Wr,wvpForTile:Hr,nodeModelMatrix:Eo,tileModelMatrix:Gs}):ds.hidden=!0}wi||Ss.sort((br,ds)=>!Ci||br.opacity===1&&ds.opacity===1?br.depth<ds.depth?-1:1:br.opacity===1?-1:ds.opacity===1?1:br.depth>ds.depth?-1:1);for(const br of Ss){const ds=br.nodeInfo,ps=ds.node;let Er=n.a6.mat4.multiply([],di,br.tileModelMatrix);n.a6.mat4.multiply(Er,St,Er);const ts=n.a6.mat4.invert([],Er);n.a6.mat4.transpose(ts,ts),n.a6.mat4.scale(ts,ts,wh),Er=n.a6.mat4.multiply(Er,Er,ps.matrix);const Gs=ge.renderPass==="light-beam",ra=Xr&n.dj.HasMapboxMeshFeatures,Ya=ra?0:ds.evaluatedRMEA[0][2];for(let Eo=0;Eo<ps.meshes.length;++Eo){const Wr=ps.meshes[Eo],Hr=Eo===ps.lightMeshIndex;let Yr=br.wvpForNode;if(Hr){if(!Gs&&!ge.terrain&&ge.shadowRenderer){ge.currentLayer<ge.firstLightBeamLayer&&(ge.firstLightBeamLayer=ge.currentLayer);continue}Yr=br.wvpForTile}else if(Gs)continue;const is={defines:[]},Es=[];if(!wi&&at&&(at.useNormalOffset=!!Wr.normalBuffer),qc(is.defines,Es,Wr,ge,Ge.lut),ra||is.defines.push("DIFFUSE_SHADED"),Ur&&is.defines.push("SHADOWS_SINGLE_CASCADE"),Xi&&(wi?Xi.numRenderedVerticesInShadowPass+=Wr.vertexArray.length:Xi.numRenderedVerticesInTransparentPass+=Wr.vertexArray.length),wi){bh(Wr,br.nodeModelMatrix,ge,Ge);continue}let Os=null;if(tt){const Ja=vh(br.nodeModelMatrix,ge.transform);if(Os=new Float32Array(Ja),nt.projection.name!=="globe"){const Sa=Wr.aabb.min,Qa=Wr.aabb.max,[ka,ls]=tt.getOpacityForBounds(Ja,Sa[0],Sa[1],Qa[0],Qa[1]);is.overrideFog=ka>=Pi||ls>=Pi}}const Do=Wr.material;let Il;Do.occlusionTexture&&Do.occlusionTexture.offsetScale&&(Il=Do.occlusionTexture.offsetScale,is.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ma=ge.getOrCreateProgram("model",is);!wi&&at&&at.setupShadowsFromMatrix(br.tileModelMatrix,Ma,at.useNormalOffset),ge.uploadCommonUniforms(Qe,Ma,null,Os);const ha=Do.pbrMetallicRoughness;ha.metallicFactor=.9,ha.roughnessFactor=.5;const Ka=pd(new Float32Array(Yr),new Float32Array(Er),new Float32Array(ts),new Float32Array(ps.matrix),ge,br.opacity,ha.baseColorFactor.toRenderColor(null),Do.emissiveFactor,ha.metallicFactor,ha.roughnessFactor,Do,Ya,Ge,[0,0,0],Il);!Hr&&(ds.hasTranslucentParts||br.opacity<1)&&Ma.draw(ge,Qe.gl.TRIANGLES,Gi,hr.disabled,Ir.disabled,qn.backCCW,Ka,Ge.id,Wr.vertexBuffer,Wr.indexBuffer,Wr.segments,Ge.paint,ge.transform.zoom,void 0,Es),Ma.draw(ge,Qe.gl.TRIANGLES,Hr?Ki:Gi,hr.disabled,Hr||br.opacity<1||ds.hasTranslucentParts?Ir.alphaBlended:Ir.unblended,qn.backCCW,Ka,Ge.id,Wr.vertexBuffer,Wr.indexBuffer,Wr.segments,Ge.paint,ge.transform.zoom,void 0,Es)}}}}()}(f,i,s,m),void U();if(W.type!=="model")return;const j=W.getModels(),Y=[],J=f.transform.getFreeCameraOptions().position,oe=n.a6.vec3.scale([],[J.x,J.y,J.z],f.transform.worldSize);n.a6.vec3.negate(oe,oe);const pe=[],ue=[];let _e=0;for(const ge of j){const Oe=s.paint.get("model-rotation").constantOr(null),Ge=s.paint.get("model-scale").constantOr(null),He=s.paint.get("model-translation").constantOr(null);ge.computeModelMatrix(f,Oe,Ge,He,!0,!0,!1);const Qe=n.a6.mat4.identity([]),nt=n.de(ge.position.lat,f.transform.zoom),tt=n.a6.mat4.fromScaling([],[1,1,1/nt]);n.a6.mat4.translate(Qe,Qe,oe),Y.push({zScaleMatrix:tt,negCameraPosMatrix:Qe});for(const at of ge.nodes)xh(f.transform,at,ge.matrix,f.transform.expandedFarZProjMatrix,_e,pe,ue);_e++}if(pe.sort((ge,Oe)=>Oe.depth-ge.depth),f.renderPass!=="shadow"){if(x===1)for(const ge of ue)ql(ge,f,s,Y[ge.modelIndex],hr.disabled,f.colorModeForRenderPass());else{for(const ge of ue)ql(ge,f,s,Y[ge.modelIndex],hr.disabled,Ir.disabled);for(const ge of ue)ql(ge,f,s,Y[ge.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const ge of pe)ql(ge,f,s,Y[ge.modelIndex],hr.disabled,f.colorModeForRenderPass());U()}else{for(const ge of ue)bh(ge.mesh,ge.nodeModelMatrix,f,s);for(const ge of pe)bh(ge.mesh,ge.nodeModelMatrix,f,s);U()}}},Ta={model:function(f,i,s){const m=i.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,m.type==="vector"?f.scope:""));if(m.type==="batched-model"||m.type!=="model")return;const x=m.getModels();for(const w of x)w.upload(s.context)},raster:function(f,i,s){const m=i.getSource();if(!(m instanceof Qo&&m.loaded()))return;const x=f.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!x)return;const w=f.paint.get("raster-array-band")||m.getInitialBand(x);if(w==null)return;const A=i.getIds().map(k=>i.getTileByID(k));for(const k of A)k.updateNeeded(x,w)&&m.prepareTile(k,x,w)},"raster-particle":function(f,i,s){const m=i.getSource();if(!(m instanceof Qo&&m.loaded()))return;const x=f.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!x)return;const w=f.paint.get("raster-particle-array-band")||m.getInitialBand(x);if(w==null)return;const A=i.getIds().map(k=>i.getTileByID(k));for(const k of A)k.updateNeeded(x,w)&&m.prepareTile(k,x,w)}};class uc{constructor(i,s,m,x,w){this.context=new T_(i,s),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const A=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const U of A)this._debugParams.enabledLayers[U]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const U of A)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],U);this.occlusionParams=new Lu(w),this.setup(),this.numSublayers=Me.maxUnderzooming+Me.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Fm(this),this._wireframeDebugCache=new mp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const k=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,k,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x}updateTerrain(i,s){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ef(this,i));const x=this._terrain;this.transform.elevation=m?x:null,x.update(i,this.transform,s),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(i){const s=i.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=s.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const w=m+.78*(x-m);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new Ef(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,s){if(this.width=i*n.q.devicePixelRatio,this.height=s*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const i=this.context,s=new n.a$;s.emplaceBack(0,0),s.emplaceBack(n.ab,0),s.emplaceBack(0,n.ab),s.emplaceBack(n.ab,n.ab),this.tileExtentBuffer=i.createVertexBuffer(s,n.b1.members),this.tileExtentSegments=n.b2.simpleSegment(0,0,4,2);const m=new n.a$;m.emplaceBack(0,0),m.emplaceBack(n.ab,0),m.emplaceBack(0,n.ab),m.emplaceBack(n.ab,n.ab),this.debugBuffer=i.createVertexBuffer(m,n.b1.members),this.debugSegments=n.b2.simpleSegment(0,0,4,5);const x=new n.a$;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,n.b1.members),this.viewportSegments=n.b2.simpleSegment(0,0,4,2);const w=new n.aO;w.emplaceBack(0,0,0,0),w.emplaceBack(n.ab,0,n.ab,0),w.emplaceBack(0,n.ab,0,n.ab),w.emplaceBack(n.ab,n.ab,n.ab,n.ab),this.mercatorBoundsBuffer=i.createVertexBuffer(w,n.b4.members),this.mercatorBoundsSegments=n.b2.simpleSegment(0,0,4,2);const A=new n.aP;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(A);const k=new n.b0;for(const W of[0,1,3,2,0])k.emplaceBack(W);this.debugIndexBuffer=i.createIndexBuffer(k),this.emptyTexture=new n.T(i,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=n.a6.mat4.create();const U=this.context.gl;this.stencilClearMode=new hr({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Xn.disabled,this.stencilClearMode,Ir.disabled,qn.disabled,ud(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,s,m){if(!s||this.currentStencilSource===s.id||!i.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const U of m)if(this._tileClippingMaskIDs[U.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=s.id;const x=this.context,w=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(Ir.disabled),x.setDepthMode(Xn.disabled);const A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of m){const U=s.getTile(k),W=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:Y,tileBoundsSegments:J}=this.getTileBoundsBuffers(U);A.draw(this,w.TRIANGLES,Xn.disabled,new hr({func:w.ALWAYS,mask:0},W,255,w.KEEP,w.KEEP,w.REPLACE),Ir.disabled,qn.disabled,ud(k.projMatrix),"$clipping",j,Y,J)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,s=this.context.gl;return new hr({func:s.NOTEQUAL,mask:255},i,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const s=this.context.gl;return new hr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(i){const s=this.context.gl,m=i.sort((A,k)=>k.overscaledZ-A.overscaledZ),x=m[m.length-1].overscaledZ,w=m[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const A={};for(let k=0;k<w;k++)A[k+x]=new hr({func:s.GEQUAL,mask:255},k+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=w,[A,m]}return[{[x]:hr.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Ir([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new n.bA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ir.unblended:Ir.alphaBlended}colorModeForDrapableLayerRenderPass(i){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ir([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new n.bA(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,s,m,x=!1){if(this.depthOcclusion)return new Xn(this.context.gl.GREATER,Xn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Xn.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Xn(m||this.context.gl.LEQUAL,s,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,s=Math.ceil(this.width),m=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),w=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&m!==0&&(this.depthFBO=new zf(this.context,s,m,!1,"texture"),this.depthTexture=new n.T(this.context,{width:s,height:m,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),i.bindTexture(i.TEXTURE_2D,w),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,s,m,0,0,s,m,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,s)=>i+s/this._fpsHistory.length,0))}render(i,s){const m=n.q.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=s;const x=this.style._mergedLayers,w=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(Ct=>{const St=x[Ct];return!(St.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[St.type]});let A=!1,k=!1;for(const Ct of w){const St=x[Ct];St.type==="circle"&&(A=!0),St.type==="symbol"&&(St.hasInitialOcclusionOpacityProperties?k=!0:A=!0)}const U=w.map(Ct=>x[Ct]),W=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let j=0,Y=!1;for(const Ct in W){const St=W[Ct];St.used&&(St.prepare(this.context),St.getSource().usedInConflation&&++j)}let J=!1;for(const Ct of U)Ct.isHidden(this.transform.zoom)||(Ct.type==="clip"&&(J=!0),this.prepareLayer(Ct));const oe={},pe={},ue={},_e={},ge={};for(const Ct in W){const St=W[Ct];oe[Ct]=St.getVisibleCoordinates(),pe[Ct]=oe[Ct].slice().reverse(),ue[Ct]=St.getVisibleCoordinates(!0).reverse(),_e[Ct]=St.getShadowCasterCoordinates(),ge[Ct]=St.sortCoordinatesByDistance(oe[Ct])}const Oe=Ct=>{const St=this.style.getLayerSourceCache(Ct);return St&&St.used?St.getSource():null};if(j||J||this._clippingActiveLastFrame){const Ct=[],St=[];let si=0;for(const di of U)this.isSourceForClippingOrConflation(di,Oe(di))&&(Ct.push(di),St.push(si)),si++;if(Ct&&(J||Ct.length>1)||this._clippingActiveLastFrame){J=!1;const di=[];for(let Si=0;Si<Ct.length;Si++){const Gi=Ct[Si],Ki=St[Si],qt=this.style.getLayerSourceCache(Gi);if(!qt||!qt.used||!qt.getSource().usedInConflation&&Gi.type!=="clip")continue;let wi=n.dn,hi=n.bt.None;const Ti=[];let Ci=!0;if(Gi.type==="clip"){wi=Ki;for(const gi of Gi.layout.get("clip-layer-types"))hi|=gi==="model"?n.bt.Model:gi==="symbol"?n.bt.Symbol:n.bt.FillExtrusion;for(const gi of Gi.layout.get("clip-layer-scope"))Ti.push(gi);Gi.isHidden(this.transform.zoom)?Ci=!1:J=!0}Ci&&di.push({layer:Gi.fqid,cache:qt,order:wi,clipMask:hi,clipScope:Ti})}this.replacementSource.setSources(di),Y=!0}}this._clippingActiveLastFrame=J,Y||this.replacementSource.clear(),this.conflationActive=Y,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ct=0;Ct<U.length;Ct++){const St=U[Ct],si=St.cutoffRange();if(this.longestCutoffRange=Math.max(si,this.longestCutoffRange),si>0){const di=Oe(St);di&&(this.minCutoffZoom=Math.max(di.minzoom,this.minCutoffZoom)),St.minzoom&&(this.minCutoffZoom=Math.max(St.minzoom,this.minCutoffZoom))}St.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ct),this._lastOcclusionLayer=Ct)}const Ge=this.style&&this.style.fog;Ge?(this._fogVisible=Ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0);const He=this._shadowRenderer;if(He){He.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ct in W)for(const St of oe[Ct]){let si={min:0,max:0};this.terrain&&(si=this.terrain.getMinMaxForTile(St)||si),He.addShadowReceiver(St.toUnwrapped(),si.min,si.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new fp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Yn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ct of U){const St=i.getLayerSourceCache(Ct);if(!Ct.hasOffscreenPass()||Ct.isHidden(this.transform.zoom))continue;const si=St?pe[St.id]:void 0;(Ct.type==="custom"||Ct.type==="raster"||Ct.type==="raster-particle"||Ct.isSky()||si&&si.length)&&this.renderLayer(this,St,Ct,si)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_e)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Qe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),nt=(()=>{if(s.showOverdrawInspector)return n.bA.black;const Ct=this.style.fog;if(Ct&&this.transform.projection.supportsFog){const St=this.style.getLut(Ct.scope);if(!Qe){const si=Ct.properties.get("color").toRenderColor(St).toArray01();return new n.bA(...si)}if(Qe){const si=Ct.properties.get("space-color").toRenderColor(St).toArray01();return new n.bA(...si)}}return n.bA.transparent})();if(this.context.clear({color:nt,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Qe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const Ct=U[this.currentLayer],St=i.getLayerSourceCache(Ct);if(Ct.isSky())continue;const si=St?(Ct.is3D()?ge:pe)[St.id]:void 0;this._renderTileClippingMasks(Ct,St,si),this.renderLayer(this,St,Ct,si)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Qe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const Ct=U[this.currentLayer],St=i.getLayerSourceCache(Ct);Ct.isSky()&&this.renderLayer(this,St,Ct,St?pe[St.id]:void 0)}function tt(Ct,St){let si;return St&&(si=(Ct.type==="symbol"?ue:Ct.is3D()?ge:pe)[St.id]),si}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const Ct=U[this.currentLayer];if(Ct.type==="raster"||Ct.type==="raster-particle"){const St=i.getLayerSourceCache(Ct);this.renderLayer(this,St,Ct,tt(Ct,St))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let at=0;He&&(at=He.getShadowCastingLayerCount());let wt=!1,Ot=-1;for(let Ct=0;Ct<w.length;++Ct){const St=U[Ct];St.isHidden(this.transform.zoom)||St.is3D()&&(Ot=Ct)}for(k&&Ot===-1&&(A=!0);this.currentLayer<w.length;){const Ct=U[this.currentLayer],St=i.getLayerSourceCache(Ct);if(Ct.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ct)){if(Ct.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(A&&!wt&&this.terrain&&!this.transform.isOrthographic&&(wt=!0,this.blitDepth()),k&&Ot!==-1&&this.currentLayer===Ot+1&&!this.transform.isOrthographic&&this.blitDepth(),Ct.is3D()||this.terrain||this._renderTileClippingMasks(Ct,St,St?oe[St.id]:void 0),this.renderLayer(this,St,Ct,tt(Ct,St)),!this.terrain&&He&&at>0&&Ct.hasShadowPass()&&--at==0&&(He.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const si=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=si;this.currentLayer++){const di=U[this.currentLayer];if(!di.hasLightBeamPass())continue;const Si=i.getLayerSourceCache(di);this.renderLayer(this,Si,di,Si?pe[Si.id]:void 0)}this.currentLayer=si,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const si=this.currentLayer;this.depthOcclusion=!0;for(const di of this.layersWithOcclusionOpacity){this.currentLayer=di;const Si=U[this.currentLayer],Gi=i.getLayerSourceCache(Si),Ki=Gi?pe[Gi.id]:void 0;Si.is3D()||this.terrain||this._renderTileClippingMasks(Si,Gi,Gi?oe[Gi.id]:void 0),this.renderLayer(this,Gi,Si,Ki)}this.depthOcclusion=!1,this.currentLayer=si,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ct=null;U.forEach(St=>{const si=i.getLayerSourceCache(St);si&&!St.isHidden(this.transform.zoom)&&si.getVisibleCoordinates().length&&(!Ct||Ct.getSource().maxzoom<si.getSource().maxzoom)&&(Ct=si)}),Ct&&this.options.showTileBoundaries&&$c.debug(this,Ct,Ct.getVisibleCoordinates(),n.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&$c.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ct){const St=Ct.transform.padding;Qt(Ct,Ct.transform.height-(St.top||0),3,Hc),Qt(Ct,St.bottom||0,3,mh),gh(Ct,St.left||0,3,qi),gh(Ct,Ct.transform.width-(St.right||0),3,yn);const si=Ct.transform.centerPoint;(function(di,Si,Gi,Ki){Wa(di,Si-1,Gi-10,2,20,Ki),Wa(di,Si-10,Gi-1,20,2,Ki)})(Ct,si.x,Ct.transform.height-si.y,Au)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Y||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:s}=this.transform.projection,m=!s||!s.includes(i.type);if(Ta[i.type]&&(m||this.terrain&&i.type==="custom")){const x=this.style.getLayerSourceCache(i);Ta[i.type](i,x,this)}this.gpuTimingEnd()}renderLayer(i,s,m,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(m.type)&&(!i.terrain||m.type!=="custom")||m.type==="clip"||$c[m.type](i,s,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,m=this.context.gl;let x=this.gpuTimers[i.id];x||(x=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:m.createQuery()}),x.calls++,m.beginQuery(s.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,s=this.context.gl,m=s.createQuery();this.deferredRenderGpuTimeQueries.push(m),s.beginQuery(i.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const s={};for(const m in i){const x=i[m],w=this.context.extTimerQuery,A=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),s[m]=A}return s}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let m=0;for(const x of i)m+=s.getQueryParameter(x,s.QUERY_RESULT)/1e6,s.deleteQuery(x);return m}translatePosMatrix(i,s,m,x,w){if(!m[0]&&!m[1])return i;const A=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(A){const W=Math.sin(A),j=Math.cos(A);m=[m[0]*j-m[1]*W,m[0]*W+m[1]*j]}const k=[w?m[0]:n.ak(s,m[0],this.transform.zoom),w?m[1]:n.ak(s,m[1],this.transform.zoom),0],U=new Float32Array(16);return n.a6.mat4.translate(U,i,k),U}saveTileTexture(i){const s=i.size[0],m=this._tileTextures[s];m?m.push(i):this._tileTextures[s]=[i]}getTileTexture(i){const s=this._tileTextures[i];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,s,m){const x=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,w=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||s!==void 0&&!s||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(i,s){this.cache=this.cache||{};const m=s&&s.defines||[],x=s&&s.config,w=this.currentGlobalDefines(i,s&&s.overrideFog,s&&s.overrideRtt).concat(m),A=oc.cacheKey(Wl[i],i,w,x);return this.cache[A]||(this.cache[A]=new oc(this.context,i,Wl[i],x,lc[i],w)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,s){if(this.style.enable3dLights()){const m=this.style.directionalLight,x=this.style.ambientLight;if(m&&x){const w=((A,k,U)=>{const W=A.properties.get("direction"),j=A.properties.get("color").toRenderColor(U.getLut(A.scope)).toArray01(),Y=A.properties.get("intensity"),J=k.properties.get("color").toRenderColor(U.getLut(k.scope)).toArray01(),oe=k.properties.get("intensity"),pe=[W.x,W.y,W.z],ue=n.cH(J,oe),_e=n.cH(j,Y);return{u_lighting_ambient_color:ue,u_lighting_directional_dir:pe,u_lighting_directional_color:_e,u_ground_radiance:Af(pe,_e,ue)}})(m,x,this.style);s.setLightsUniformValues(i,w)}}}uploadCommonUniforms(i,s,m,x,w){if(this.uploadCommonLightUniforms(i,s),this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const k=A.getOpacity(this.transform.pitch),U=((W,j,Y,J,oe,pe,ue,_e,ge,Oe,Ge,He)=>{const Qe=W.transform,nt=j.properties.get("color").toRenderColor(W.style.getLut(j.scope)).toArray01();nt[3]=J;const tt=W.frameCounter/1e3%1,[at,wt]=j.properties.get("vertical-range");return{u_fog_matrix:Y?Qe.calculateFogTileMatrix(Y):He||W.identityMat,u_fog_range:j.getFovAdjustedRange(Qe._fov),u_fog_color:nt,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(at,wt),wt],u_fog_temporal_offset:tt,u_frustum_tl:oe,u_frustum_tr:pe,u_frustum_br:ue,u_frustum_bl:_e,u_globe_pos:ge,u_globe_radius:Oe,u_viewport:Ge,u_globe_transition:n.a9(Qe.zoom),u_is_globe:+(Qe.projection.name==="globe")}})(this,A,m,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],x);s.setFogUniformValues(i,U)}w&&s.setCutoffUniformValues(i,w.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,s=i.createTexture();return i.bindTexture(i.TEXTURE_2D,s),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,s=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)s[x.key]=i[x.key]||new Us(x,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,s){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[i.key];return s||(this._cachedTileFogOpacities[i.key]=s=this.style.fog.getOpacityForTile(i)),s[0]>=Pi||s[1]>=Pi}setupDepthForOcclusion(i,s,m){const x=this.context,w=x.gl,A=!!m;var k;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(w.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((k=this.depthRangeFor3D)[1]-k[0]),-1-2*k[0]/(k[1]-k[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE0),A||s.setTerrainUniformValues(x,m)}}function hc(f,i){let s=!1,m=null;const x=()=>{m=null,s&&(f(),m=setTimeout(x,i),s=!1)};return()=>(s=!0,m||x(),m)}class Iu{constructor(i){this._hashName=i&&encodeURIComponent(i),n.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=hc(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const s=El(i);if(this._hashName){const m=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map(A=>{const k=A.split("=")[0];return k===m?(x=!0,`${k}=${s}`):A}).filter(A=>A);return x||w.push(`${m}=${s}`),`#${w.join("&")}`}return`#${s}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let s;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(s=m)}),(s&&s[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(m=>isNaN(m))){const m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(s[3]||0):i.getBearing();return i.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:m,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function El(f,i){const s=f.getCenter(),m=Math.round(100*f.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),A=Math.round(s.lng*w)/w,k=Math.round(s.lat*w)/w,U=f.getBearing(),W=f.getPitch();let j=i?`/${A}/${k}/${m}`:`${m}/${k}/${A}`;return(U||W)&&(j+="/"+Math.round(10*U)/10),W&&(j+=`/${Math.round(W)}`),j}const Ru={linearity:.3,easing:n.dp(0,0,.3,1)},gp=n.l({deceleration:2500,maxSpeed:1400},Ru),Mh=n.l({deceleration:20,maxSpeed:1400},Ru),ll=n.l({deceleration:1e3,maxSpeed:360},Ru),_d=n.l({deceleration:1e3,maxSpeed:90},Ru);class Po{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,s=n.q.now();for(;i.length>0&&s-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)s.zoom+=w.zoomDelta||0,s.bearing+=w.bearingDelta||0,s.pitch+=w.pitchDelta||0,w.panDelta&&s.pan._add(w.panDelta),w.around&&(s.around=w.around),w.pinchAround&&(s.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(s.pan.mag()){const w=Du(s.pan.mag(),m,n.l({},gp,i||{}));x.offset=s.pan.mult(w.amount/s.pan.mag()),x.center=this._map.transform.center,Pu(x,w)}if(s.zoom){const w=Du(s.zoom,m,Mh);x.zoom=this._map.transform.zoom+w.amount,Pu(x,w)}if(s.bearing){const w=Du(s.bearing,m,ll);x.bearing=this._map.transform.bearing+n.ap(w.amount,-179,179),Pu(x,w)}if(s.pitch){const w=Du(s.pitch,m,_d);x.pitch=this._map.transform.pitch+w.amount,Pu(x,w)}if(x.zoom||x.bearing){const w=s.pinchAround===void 0?s.around:s.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Pu(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function Du(f,i,s){const{maxSpeed:m,linearity:x,deceleration:w}=s,A=n.ap(f*x/(i/1e3),-m,m),k=Math.abs(A)/(w*x);return{easing:s.easing,duration:1e3*k,amount:A*(k/2)}}class qs extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s,m,x={}){const w=et(s.getCanvasContainer(),m),A=s.unproject(w);super(i,n.l({point:w,lngLat:A,originalEvent:m},x)),this._defaultPrevented=!1,this.target=s}}class Zc extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s,m){const x=i==="touchend"?m.changedTouches:m.touches,w=Xe(s.getCanvasContainer(),x),A=w.map(U=>s.unproject(U)),k=w.reduce((U,W,j,Y)=>U.add(W.div(Y.length)),new n.P(0,0));super(i,{points:w,point:k,lngLats:A,lngLat:s.unproject(k),originalEvent:m}),this._defaultPrevented=!1}}class Sh extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class za{constructor(i,s){this._map=i,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Sh(this._map,i))}mousedown(i,s){return this._mousedownPos=s,this._firePreventable(new qs(i.type,this._map,i))}mouseup(i){this._map.fire(new qs(i.type,this._map,i))}preclick(i){const s=n.l({},i);s.type="preclick",this._map.fire(new qs(s.type,this._map,s))}click(i,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(i),this._map.fire(new qs(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new qs(i.type,this._map,i))}mouseover(i){this._map.fire(new qs(i.type,this._map,i))}mouseout(i){this._map.fire(new qs(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Zc(i.type,this._map,i))}touchmove(i){this._map.fire(new Zc(i.type,this._map,i))}touchend(i){this._map.fire(new Zc(i.type,this._map,i))}touchcancel(i){this._map.fire(new Zc(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xc{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new qs(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new qs(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _p{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,s){this.isEnabled()&&i.shiftKey&&i.button===0&&(mt(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(i,s){if(!this._active)return;const m=s,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(m)||!this._box&&m.dist(x)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=it("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const A=Math.min(x.x,m.x),k=Math.max(x.x,m.x),U=Math.min(x.y,m.y),W=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${U}px)`,this._box.style.width=k-A+"px",this._box.style.height=W-U+"px")})}mouseupWindow(i,s){if(!this._active)return;const m=this._startPos,x=s;if(m&&i.button===0){if(this.reset(),Fe(),m.x!==x.x||m.y!==x.y)return this._map.fire(new n.x("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),pt(),delete this._startPos,delete this._lastPos}_fireEvent(i,s){return this._map.fire(new n.x(i,{originalEvent:s}))}}function ia(f,i){const s={};for(let m=0;m<f.length;m++)s[f[m].identifier]=i[m];return s}class yp{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,s,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const w=new n.P(0,0);for(const A of x)w._add(A);return w.div(x.length)}(s),this.touches=ia(m,s)))}touchmove(i,s,m){if(this.aborted||!this.centroid)return;const x=ia(m,s);for(const w in this.touches){const A=x[w];(!A||A.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(i,s,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Al{constructor(i){this.singleTap=new yp(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,s,m){this.singleTap.touchstart(i,s,m)}touchmove(i,s,m){this.singleTap.touchmove(i,s,m)}touchend(i,s,m){const x=this.singleTap.touchend(i,s,m);if(x){const w=i.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(x)<30;if(w&&A||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class vp{constructor(){this._zoomIn=new Al({numTouches:1,numTaps:2}),this._zoomOut=new Al({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,s,m){this._zoomIn.touchstart(i,s,m),this._zoomOut.touchstart(i,s,m)}touchmove(i,s,m){this._zoomIn.touchmove(i,s,m),this._zoomOut.touchmove(i,s,m)}touchend(i,s,m){const x=this._zoomIn.touchend(i,s,m),w=this._zoomOut.touchend(i,s,m);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(x)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ou={0:1,2:2};class Yc{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,s){return!1}_move(i,s){return{}}mousedown(i,s){if(this._lastPoint)return;const m=qe(i);this._correctButton(i,m)&&(this._lastPoint=s,this._eventButton=m)}mousemoveWindow(i,s){const m=this._lastPoint;if(m){if(i.preventDefault(),this._eventButton!=null&&function(x,w){const A=Ou[w];return x.buttons===void 0||(x.buttons&A)!==A}(i,this._eventButton))this.reset();else if(this._moved||!(s.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(m,s)}}mouseupWindow(i){this._lastPoint&&qe(i)===this._eventButton&&(this._moved&&Fe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zu extends Yc{mousedown(i,s){super.mousedown(i,s),this._lastPoint&&(this._active=!0)}_correctButton(i,s){return s===0&&!i.ctrlKey}_move(i,s){return{around:s,panDelta:s.sub(i)}}}class Kc extends Yc{_correctButton(i,s){return s===0&&i.ctrlKey||s===2}_move(i,s){const m=.8*(s.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class yd extends Yc{_correctButton(i,s){return s===0&&i.ctrlKey||s===2}_move(i,s){const m=-.5*(s.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class Hf{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),n.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(i,s,m){return this._calculateTransform(i,s,m)}touchmove(i,s,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!n.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,s,m)}}touchend(i,s,m){this._calculateTransform(i,s,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,s,m){m.length>0&&(this._active=!0);const x=ia(m,s),w=new n.P(0,0),A=new n.P(0,0);let k=0;for(const W in x){const j=x[W],Y=this._touches[W];Y&&(w._add(j),A._add(j.sub(Y)),k++,x[W]=j)}if(this._touches=x,k<this._minTouches||!A.mag())return;const U=A.div(k);return this._sum._add(U),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(k),panDelta:U}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=it("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Eh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,s,m){return{}}touchstart(i,s,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([s[0],s[1]]))}touchmove(i,s,m){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[w,A]=x,k=Ah(m,s,w),U=Ah(m,s,A);if(!k||!U)return;const W=this._aroundCenter?null:k.add(U).div(2);return this._move([k,U],W,i)}touchend(i,s,m){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,A=Ah(m,s,x),k=Ah(m,s,w);A&&k||(this._active&&Fe(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ah(f,i,s){for(let m=0;m<f.length;m++)if(f[m].identifier===s)return i[m]}function xp(f,i){return Math.log(f/i)/Math.LN2}class ku extends Eh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,s){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(xp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xp(this._distance,m),pinchAround:s}}}function $l(f,i){return 180*f.angleWith(i)/Math.PI}class Fu extends Eh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,s){const m=this._vector;if(this._vector=i[0].sub(i[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$l(this._vector,m),pinchAround:s}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const s=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const x=$l(i,m);return Math.abs(x)<s}}function $a(f){return Math.abs(f.y)>Math.abs(f.x)}class Bu extends Eh{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,$a(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,s,m){const x=this._lastPoints;if(!x)return;const w=i[0].sub(x[0]),A=i[1].sub(x[1]);return this._map._cooperativeGestures&&!n.dq()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(w,A,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+A.y)/2*-.5})}gestureBeginsVertically(i,s,m){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,w=s.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const A=i.y>0==s.y>0;return $a(i)&&$a(s)&&A}}const vd={panStep:100,bearingStep:15,pitchStep:10};class xd{constructor(){const i=vd;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let s=0,m=0,x=0,w=0,A=0;switch(i.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),A=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:k=>{const U=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:bp,zoom:s?Math.round(U)+s*(i.shiftKey?2:1):U,bearing:k.getBearing()+m*this._bearingStep,pitch:k.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-A*this._panStep],center:k.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bp(f){return f*(2-f)}const Ch=4.000244140625,jf=1/450;class Za{constructor(i,s){this._map=i,this._el=i.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=jf,n.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||n.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=n.q.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,s!==0&&s%Ch==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),i.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=i,this._delta-=s,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=et(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const W=this._type==="wheel"&&Math.abs(this._delta)>Ch?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*W)));this._delta<0&&j!==0&&(j=1/j);const Y=s(),J=Math.pow(2,Y),oe=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):J;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(oe*j))),this._type==="wheel"&&(this._startZoom=Y,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:s(),x=this._startZoom,w=this._easing;let A,k=!1;if(this._type==="wheel"&&x&&w){const W=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),j=w(W);A=n.aa(x,m,j),W<1?this._frameId||(this._frameId=!0):k=!0}else A=m,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let U=A-s();return U*this._lastDelta<0&&(U=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:U,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let s=n.dr;if(this._prevEase){const m=this._prevEase,x=(n.q.now()-m.start)/m.duration,w=m.easing(x+.01)-m.easing(x),A=.27/Math.sqrt(w*w+1e-4)*.01,k=Math.sqrt(.0729-A*A);s=n.dp(A,k,.25,1)}return this._prevEase={start:n.q.now(),duration:i,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=it("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Js{constructor(i,s){this._clickZoom=i,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,s){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(s)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wf{constructor(){this._tap=new Al({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,s,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=s[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,s,m))}touchmove(i,s,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=s[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,s,m)}touchend(i,s,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(i,s,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tp{constructor(i,s,m){this._el=i,this._mousePan=s,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Nu{constructor(i,s,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=s,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mp{constructor(i,s,m,x){this._el=i,this._touchZoom=s,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Jc=f=>f.zoom||f.drag||f.pitch||f.rotate;class Lh extends n.x{}class Zl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,s){const m=n.a6.vec3.sub([],s,i);this.radius=n.a6.vec3.length(m[2]<0?n.a6.vec3.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){n.a6.vec3.div(i,i,this.constants),n.a6.vec3.normalize(i,i),n.a6.vec3.mul(i,i,this.constants);const s=n.a6.vec3.scale([],i,this.radius);if(s[2]>0){const m=n.a6.vec3.scale([],[0,0,1],n.a6.vec3.dot(s,[0,0,1])),x=n.a6.vec3.scale([],n.a6.vec3.normalize([],[s[0],s[1],0]),this.radius),w=n.a6.vec3.add([],s,n.a6.vec3.scale([],n.a6.vec3.sub([],n.a6.vec3.add([],x,m),s),2));s[0]=w[0],s[1]=w[1]}return s}}function Cl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class uo{constructor(i,s){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Po(i),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Zl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),n.aJ(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,A]of this._listeners){const k=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,k,A)}}destroy(){for(const[i,s,m]of this._listeners){const x=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(s,x,m)}}_addDefaultHandlers(i){const s=this._map,m=s.getCanvasContainer();this._add("mapEvent",new za(s,i));const x=s.boxZoom=new _p(s,i);this._add("boxZoom",x);const w=new vp,A=new wp;s.doubleClickZoom=new Js(A,w),this._add("tapZoom",w),this._add("clickZoom",A);const k=new Wf;this._add("tapDragZoom",k);const U=s.touchPitch=new Bu(s);this._add("touchPitch",U);const W=new Kc(i),j=new yd(i);s.dragRotate=new Nu(i,W,j),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const Y=new zu(i),J=new Hf(s,i);s.dragPan=new Tp(m,Y,J),this._add("mousePan",Y),this._add("touchPan",J,["touchZoom","touchRotate"]);const oe=new Fu,pe=new ku;s.touchZoomRotate=new Mp(m,pe,oe,k),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",pe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Xc(s));const ue=s.scrollZoom=new Za(s,this);this._add("scrollZoom",ue,["mousePan"]);const _e=s.keyboard=new xd;this._add("keyboard",_e);for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[ge]&&s[ge].enable(i[ge])}_add(i,s,m){this._handlers.push({handlerName:i,handler:s,allowed:m}),this._handlersById[i]=s}stop(i){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Jc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,s,m){for(const x in i)if(x!==m&&(!s||s.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const s=[];for(const m of i)this._el.contains(m.target)&&s.push(m);return s}handleEvent(i,s){this._updatingCamera=!0;const m=i.type==="renderFrame",x=m?void 0:i,w={needsRenderFrame:!1},A={},k={},U=i.touches?this._getMapTouches(i.touches):void 0,W=U?Xe(this._el,U):m?void 0:et(this._el,i);for(const{handlerName:J,handler:oe,allowed:pe}of this._handlers){if(!oe.isEnabled())continue;let ue;this._blockedByActive(k,pe,J)?oe.reset():oe[s||i.type]&&(ue=oe[s||i.type](i,W,U),this.mergeHandlerResult(w,A,ue,J,x),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||oe.isActive())&&(k[J]=oe)}const j={};for(const J in this._previousActiveHandlers)k[J]||(j[J]=x);this._previousActiveHandlers=k,(Object.keys(j).length||Cl(w))&&(this._changes.push([w,A,j]),this._triggerRenderFrame()),(Object.keys(k).length||Cl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Y}=w;Y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Y(this._map))}mergeHandlerResult(i,s,m,x,w){if(!m)return;n.l(i,m);const A={handlerName:x,originalEvent:m.originalEvent||w};m.zoomDelta!==void 0&&(s.zoom=A),m.panDelta!==void 0&&(s.drag=A),m.pitchDelta!==void 0&&(s.pitch=A),m.bearingDelta!==void 0&&(s.rotate=A)}_applyChanges(){const i={},s={},m={};for(const[x,w,A]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new n.P(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),n.l(s,w),n.l(m,A);this._updateMapTransform(i,s,m),this._changes=[]}_updateMapTransform(i,s,m){const x=this._map,w=x.transform,A=Oe=>[Oe.x,Oe.y,Oe.z];if((Oe=>{const Ge=this._eventsInProgress.drag;return Ge&&!this._handlersById[Ge.handlerName].isActive()})()&&!Cl(i)){const Oe=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),Oe!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!Cl(i))return void this._fireEvents(s,m,!0);let{panDelta:k,zoomDelta:U,bearingDelta:W,pitchDelta:j,around:Y,aroundCoord:J,pinchAround:oe}=i;w._isCameraConstrained&&(U>0&&(U=0),w._isCameraConstrained=!1),oe!==void 0&&(Y=oe),(U||(Oe=>s[Oe]&&!this._eventsInProgress[Oe])("drag"))&&Y&&(this._dragOrigin=A(w.pointCoordinate3D(Y)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),Y=Y||x.transform.centerPoint,W&&(w.bearing+=W),j&&(w.pitch+=j),w._updateCameraState();const pe=[0,0,0];if(k)if(w.projection.name==="mercator"){const Oe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(Y).dir),Ge=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(Y.sub(k)).dir);pe[0]=Ge[0]-Oe[0],pe[1]=Ge[1]-Oe[1]}else{const Oe=w.pointCoordinate(Y);if(w.projection.name==="globe"){k=k.rotate(-w.angle);const Ge=w._pixelsPerMercatorPixel/w.worldSize;pe[0]=-k.x*n.ds(n.aN(Oe.y))*Ge,pe[1]=-k.y*n.ds(w.center.lat)*Ge}else{const Ge=w.pointCoordinate(Y.sub(k));Oe&&Ge&&(pe[0]=Ge.x-Oe.x,pe[1]=Ge.y-Oe.y)}}const ue=w.zoom,_e=[0,0,0];if(U){const Oe=A(J||w.pointCoordinate3D(Y)),Ge={dir:n.a6.vec3.normalize([],n.a6.vec3.sub([],Oe,w._camera.position))};if(Ge.dir[2]<0){const He=w.zoomDeltaToMovement(Oe,U);n.a6.vec3.scale(_e,Ge.dir,He)}}const ge=n.a6.vec3.add(pe,pe,_e);w._translateCameraConstrained(ge),U&&Math.abs(w.zoom-ue)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(s,m,!0)}_fireEvents(i,s,m){const x=Jc(this._eventsInProgress),w=Jc(i),A={};for(const j in i){const{originalEvent:Y}=i[j];this._eventsInProgress[j]||(A[`${j}start`]=Y),this._eventsInProgress[j]=i[j]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const j in A)this._fireEvent(j,A[j]);w&&this._fireEvent("move",w.originalEvent);for(const j in i){const{originalEvent:Y}=i[j];this._fireEvent(j,Y)}const k={};let U;for(const j in this._eventsInProgress){const{handlerName:Y,originalEvent:J}=this._eventsInProgress[j];this._handlersById[Y].isActive()||(delete this._eventsInProgress[j],U=s[Y]||J,k[`${j}end`]=U)}for(const j in k)this._fireEvent(j,k[j]);const W=Jc(this._eventsInProgress);if(m&&(x||w)&&!W){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;j?(Y(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:U})):(this._map.fire(new n.x("moveend",{originalEvent:U})),Y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,s){this._map.fire(new n.x(i,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Lh("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Xa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class bd extends n.E{constructor(i,s){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,n.aJ(["_renderFrameCallback"],this)}getCenter(){return new n.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(i,s){return this.jumpTo({center:i},s)}panBy(i,s,m){return i=n.P.convert(i).mult(-1),this.panTo(this.transform.center,n.l({offset:i},s),m)}panTo(i,s,m){return this.easeTo(n.l({center:i},s),m)}getZoom(){return this.transform.zoom}setZoom(i,s){return this.jumpTo({zoom:i},s),this}zoomTo(i,s,m){return this.easeTo(n.l({zoom:i},s),m)}zoomIn(i,s){return this.zoomTo(this.getZoom()+1,i,s),this}zoomOut(i,s){return this.zoomTo(this.getZoom()-1,i,s),this}getBearing(){return this.transform.bearing}setBearing(i,s){return this.jumpTo({bearing:i},s),this}getPadding(){return this.transform.padding}setPadding(i,s){return this.jumpTo({padding:i},s),this}rotateTo(i,s,m){return this.easeTo(n.l({bearing:i},s),m)}resetNorth(i,s){return this.rotateTo(0,n.l({duration:1e3},i),s),this}resetNorthPitch(i,s){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},i),s),this}snapToNorth(i,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,s):this}getPitch(){return this.transform.pitch}setPitch(i,s){return this.jumpTo({pitch:i},s),this}cameraForBounds(i,s){i=n.as.convert(i);const m=s&&s.bearing||0,x=s&&s.pitch||0,w=i.getNorthWest(),A=i.getSouthEast();return this._cameraForBounds(this.transform,w,A,m,x,s)}_extendPadding(i){const s={top:0,right:0,bottom:0,left:0};return i==null?n.l({},s,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:n.l({},s,i)}_extendCameraOptions(i){return(i=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,s){const m=s.max[0]-s.min[0],x=s.max[1]-s.min[1];return m/x>i.aspect?m/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,s,m,x,w,A){const k=i.clone(),U=this._extendCameraOptions(A);k.bearing=x,k.pitch=w;const W=n.bL.convert(s),j=n.bL.convert(m),Y=.5*(W.lat+j.lat),J=.5*(W.lng+j.lng),oe=n.dt(Y,J),pe=n.a6.vec3.normalize([],oe),ue=n.a6.vec3.normalize([],n.a6.vec3.cross([],pe,[0,1,0])),_e=n.a6.vec3.cross([],ue,pe),ge=[ue[0],ue[1],ue[2],0,_e[0],_e[1],_e[2],0,pe[0],pe[1],pe[2],0,0,0,0,1],Oe=[oe,n.dt(W.lat,W.lng),n.dt(j.lat,W.lng),n.dt(j.lat,j.lng),n.dt(W.lat,j.lng),n.dt(Y,W.lng),n.dt(Y,j.lng),n.dt(W.lat,J),n.dt(j.lat,J)];let Ge=n.ca.fromPoints(Oe.map(hi=>[n.a6.vec3.dot(ue,hi),n.a6.vec3.dot(_e,hi),n.a6.vec3.dot(pe,hi)]));const He=n.a6.vec3.transformMat4([],Ge.center,ge);n.a6.vec3.squaredLength(He)===0&&n.a6.vec3.set(He,0,0,1),n.a6.vec3.normalize(He,He),n.a6.vec3.scale(He,He,n.aq),k.center=n.du(He);const Qe=k.getWorldToCameraMatrix(),nt=n.a6.mat4.invert(new Float64Array(16),Qe);Ge=n.ca.applyTransform(Ge,n.a6.mat4.multiply([],Qe,ge));const tt=this._extendAABB(Ge,k,U,x);if(!tt)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ge=tt,n.a6.vec3.transformMat4(He,He,Qe);const at=.5*(Ge.max[2]-Ge.min[2]),wt=this._minimumAABBFrustumDistance(k,Ge),Ot=n.a6.vec3.scale([],[0,0,1],at),Ct=n.a6.vec3.add(Ot,He,Ot),St=wt+(k.pitch===0?0:n.a6.vec3.distance(He,Ct)),si=k.globeCenterInViewSpace,di=n.a6.vec3.sub([],He,[si[0],si[1],si[2]]);n.a6.vec3.normalize(di,di),n.a6.vec3.scale(di,di,St);const Si=n.a6.vec3.add([],He,di);n.a6.vec3.transformMat4(Si,Si,nt);const Gi=n.dw/n.aq,Ki=n.a6.vec3.length(Si),qt=n.bE(Math.max(Ki*Gi-n.dw,Number.EPSILON),0),wi=Math.min(k.zoomFromMercatorZAdjusted(qt),U.maxZoom);return wi>.5*(n.c3+n.bV)?(k.setProjection({name:"mercator"}),k.zoom=wi,this._cameraForBounds(k,s,m,x,w,A)):{center:k.center,zoom:wi,bearing:x,pitch:w}}_extendAABB(i,s,m,x){const w=.5*((m.padding.left||0)+(m.padding.right||0)),A=.5*((m.padding.top||0)+(m.padding.bottom||0)),k=A,U=w,W=w,j=A,Y=s.width-(U+W),J=s.height-(k+j),oe=n.a6.vec3.sub([],i.max,i.min),pe=Math.min(Y/oe[0],J/oe[1]),ue=Math.min(s.scaleZoom(s.scale*pe),m.maxZoom);if(isNaN(ue))return null;const _e=s.scale/s.zoomScale(ue),ge=new n.ca([i.min[0]-U*_e,i.min[1]-j*_e,i.min[2]],[i.max[0]+W*_e,i.max[1]+k*_e,i.max[2]]),Oe=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new n.P(m.offset.x,m.offset.y):n.P.convert(m.offset)).rotate(-n.bC(x));return ge.center[0]-=Oe.x*_e,ge.center[1]+=Oe.y*_e,ge}queryTerrainElevation(i,s){const m=this.transform.elevation;return m?(s=n.l({},{exaggerated:!0},s),m.getAtPoint(n.a5.fromLngLat(i),null,s.exaggerated)):null}_cameraForBounds(i,s,m,x,w,A){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,s,m,x,w,A);const k=i.clone(),U=this._extendCameraOptions(A);k.bearing=x,k.pitch=w;const W=n.bL.convert(s),j=n.bL.convert(m),Y=new n.bL(W.lng,j.lat),J=new n.bL(j.lng,W.lat),oe=k.project(W),pe=k.project(j),ue=this.queryTerrainElevation(W),_e=this.queryTerrainElevation(j),ge=this.queryTerrainElevation(Y),Oe=this.queryTerrainElevation(J),Ge=[[oe.x,oe.y,Math.min(ue||0,_e||0,ge||0,Oe||0)],[pe.x,pe.y,Math.max(ue||0,_e||0,ge||0,Oe||0)]];let He=n.ca.fromPoints(Ge);const Qe=k.getWorldToCameraMatrix(),nt=n.a6.mat4.invert(new Float64Array(16),Qe);He=n.ca.applyTransform(He,Qe);const tt=this._extendAABB(He,k,U,x);if(!tt)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");He=tt;const at=.5*n.a6.vec3.sub([],He.max,He.min)[2],wt=this._minimumAABBFrustumDistance(k,He),Ot=[0,0,1,0];n.a6.vec4.transformMat4(Ot,Ot,Qe),n.a6.vec4.normalize(Ot,Ot);const Ct=n.a6.vec3.scale([],Ot,wt+at),St=n.a6.vec3.add([],He.center,Ct);n.a6.vec3.transformMat4(He.center,He.center,nt),n.a6.vec3.transformMat4(St,St,nt);const si=k.unproject(new n.P(He.center[0],He.center[1])),di=n.dv(k.projection,si),Si=Math.pow(2,di),Gi=Math.min(k._zoomFromMercatorZ(St[2]*k.pixelsPerMeter*Si/k.worldSize),U.maxZoom);return k.mercatorFromTransition&&Gi<.5*(n.c3+n.bV)?(k.setProjection({name:"globe"}),k.zoom=Gi,this._cameraForBounds(k,s,m,x,w,A)):{center:si,zoom:Gi,bearing:x,pitch:w}}fitBounds(i,s,m){const x=this.cameraForBounds(i,s);return this._fitInternal(x,s,m)}fitScreenCoordinates(i,s,m,x,w){const A=n.P.convert(i),k=n.P.convert(s),U=new n.P(Math.min(A.x,k.x),Math.min(A.y,k.y)),W=new n.P(Math.max(A.x,k.x),Math.max(A.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,k))return this;const j=this.transform.pointLocation3D(U),Y=this.transform.pointLocation3D(W),J=this.transform.pointLocation3D(new n.P(U.x,W.y)),oe=this.transform.pointLocation3D(new n.P(W.x,U.y)),pe=[Math.min(j.lng,Y.lng,J.lng,oe.lng),Math.min(j.lat,Y.lat,J.lat,oe.lat)],ue=[Math.max(j.lng,Y.lng,J.lng,oe.lng),Math.max(j.lat,Y.lat,J.lat,oe.lat)],_e=x&&x.pitch?x.pitch:this.getPitch(),ge=this._cameraForBounds(this.transform,pe,ue,m,_e,x);return this._fitInternal(ge,x,w)}_fitInternal(i,s,m){return i?(s=n.l(i,s)).linear?this.easeTo(s,m):this.flyTo(s,m):this}jumpTo(i,s){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,A=!1;"zoom"in i&&m.zoom!==+i.zoom&&(x=!0,m.zoom=+i.zoom),i.center!==void 0&&(m.center=n.bL.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(w=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(A=!0,m.pitch=+i.pitch);const k=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!m.isPaddingEqual(k))if(i.retainPadding===!1){const U=m.clone();U.padding=k,m.setLocationAtPoint(m.center,U.centerPoint)}else m.padding=k;return i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new n.x("movestart",s)).fire(new n.x("move",s)),x&&this.fire(new n.x("zoomstart",s)).fire(new n.x("zoom",s)).fire(new n.x("zoomend",s)),w&&this.fire(new n.x("rotatestart",s)).fire(new n.x("rotate",s)).fire(new n.x("rotateend",s)),A&&this.fire(new n.x("pitchstart",s)).fire(new n.x("pitch",s)).fire(new n.x("pitchend",s)),this.fire(new n.x("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Xa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,s){const m=this.transform;if(!m.projection.supportsFreeCamera)return n.w(Xa),this;this.stop();const x=m.zoom,w=m.pitch,A=m.bearing;m.setFreeCameraOptions(i);const k=x!==m.zoom,U=w!==m.pitch,W=A!==m.bearing;return this.fire(new n.x("movestart",s)).fire(new n.x("move",s)),k&&this.fire(new n.x("zoomstart",s)).fire(new n.x("zoom",s)).fire(new n.x("zoomend",s)),W&&this.fire(new n.x("rotatestart",s)).fire(new n.x("rotate",s)).fire(new n.x("rotateend",s)),U&&this.fire(new n.x("pitchstart",s)).fire(new n.x("pitch",s)).fire(new n.x("pitchend",s)),this.fire(new n.x("moveend",s)),this}easeTo(i,s){this._stop(!1,i.easeId),((i=n.l({offset:[0,0],duration:500,easing:n.dr},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const m=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),k=this.getPadding(),U="zoom"in i?+i.zoom:x,W="bearing"in i?this._normalizeBearing(i.bearing,w):w,j="pitch"in i?+i.pitch:A,Y=this._extendPadding(i.padding),J=n.P.convert(i.offset);let oe,pe,ue;if(m.projection.name==="globe"){const Ot=n.a5.fromLngLat(m.center),Ct=J.rotate(-m.angle);Ot.x+=Ct.x/m.worldSize,Ot.y+=Ct.y/m.worldSize;const St=Ot.toLngLat(),si=n.bL.convert(i.center||St);this._normalizeCenter(si),oe=m.centerPoint.add(Ct),pe=new n.P(Ot.x,Ot.y).mult(m.worldSize),ue=new n.P(n.am(si.lng),n.at(si.lat)).mult(m.worldSize).sub(pe)}else{oe=m.centerPoint.add(J);const Ot=m.pointLocation(oe),Ct=n.bL.convert(i.center||Ot);this._normalizeCenter(Ct),pe=m.project(Ot),ue=m.project(Ct).sub(pe)}const _e=m.zoomScale(U-x);let ge,Oe;i.around&&(ge=n.bL.convert(i.around),Oe=m.locationPoint(ge));const Ge=this._zooming||U!==x,He=this._rotating||w!==W,Qe=this._pitching||j!==A,nt=!m.isPaddingEqual(Y),tt=i.retainPadding===!1?m.clone():m,at=Ot=>Ct=>{if(Ge&&(Ot.zoom=n.aa(x,U,Ct)),He&&(Ot.bearing=n.aa(w,W,Ct)),Qe&&(Ot.pitch=n.aa(A,j,Ct)),nt&&(tt.interpolatePadding(k,Y,Ct),oe=tt.centerPoint.add(J)),ge)Ot.setLocationAtPoint(ge,Oe);else{const St=Ot.zoomScale(Ot.zoom-x),si=U>x?Math.min(2,_e):Math.max(.5,_e),di=Math.pow(si,1-Ct),Si=Ot.unproject(pe.add(ue.mult(Ct*di)).mult(St));Ot.setLocationAtPoint(Ot.renderWorldCopies?Si.wrap():Si,oe)}return i.preloadOnly||this._fireMoveEvents(s),Ot};if(i.preloadOnly){const Ot=this._emulate(at,i.duration,m);return this._preloadTiles(Ot),this}const wt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ge,this._rotating=He,this._pitching=Qe,this._padding=nt,this._easeId=i.easeId,this._prepareEase(s,i.noMoveStart,wt),this._ease(at(m),Ot=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(s,Ot)},i),this}_prepareEase(i,s,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||m.moving||this.fire(new n.x("movestart",i)),this._zooming&&!m.zooming&&this.fire(new n.x("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new n.x("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new n.x("pitchstart",i))}_fireMoveEvents(i){this.fire(new n.x("move",i)),this._zooming&&this.fire(new n.x("zoom",i)),this._rotating&&this.fire(new n.x("rotate",i)),this._pitching&&this.fire(new n.x("pitch",i))}_afterEase(i,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new n.x("zoomend",i)),x&&this.fire(new n.x("rotateend",i)),w&&this.fire(new n.x("pitchend",i)),this.fire(new n.x("moveend",i))}flyTo(i,s){if(this._prefersReducedMotion(i)){const hi=n.ar(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(hi,s)}this.stop(),i=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dr},i);const m=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),k=this.getPadding(),U="zoom"in i?n.ap(+i.zoom,m.minZoom,m.maxZoom):x,W="bearing"in i?this._normalizeBearing(i.bearing,w):w,j="pitch"in i?+i.pitch:A,Y=this._extendPadding(i.padding),J=m.zoomScale(U-x),oe=n.P.convert(i.offset);let pe=m.centerPoint.add(oe);const ue=m.pointLocation(pe),_e=n.bL.convert(i.center||ue);this._normalizeCenter(_e);const ge=m.project(ue),Oe=m.project(_e).sub(ge);let Ge=i.curve;const He=Math.max(m.width,m.height),Qe=He/J,nt=Oe.mag();if("minZoom"in i){const hi=n.ap(Math.min(i.minZoom,x,U),m.minZoom,m.maxZoom),Ti=He/m.zoomScale(hi-x);Ge=Math.sqrt(Ti/nt*2)}const tt=Ge*Ge;function at(hi){const Ti=(Qe*Qe-He*He+(hi?-1:1)*tt*tt*nt*nt)/(2*(hi?Qe:He)*tt*nt);return Math.log(Math.sqrt(Ti*Ti+1)-Ti)}function wt(hi){return(Math.exp(hi)-Math.exp(-hi))/2}function Ot(hi){return(Math.exp(hi)+Math.exp(-hi))/2}const Ct=at(0);let St=function(hi){return Ot(Ct)/Ot(Ct+Ge*hi)},si=function(hi){return He*((Ot(Ct)*(wt(Ti=Ct+Ge*hi)/Ot(Ti))-wt(Ct))/tt)/nt;var Ti},di=(at(1)-Ct)/Ge;if(Math.abs(nt)<1e-6||!isFinite(di)){if(Math.abs(He-Qe)<1e-6)return this.easeTo(i,s);const hi=Qe<He?-1:1;di=Math.abs(Math.log(Qe/He))/Ge,si=function(){return 0},St=function(Ti){return Math.exp(hi*Ge*Ti)}}i.duration="duration"in i?+i.duration:1e3*di/("screenSpeed"in i?+i.screenSpeed/Ge:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Si=w!==W,Gi=j!==A,Ki=!m.isPaddingEqual(Y),qt=i.retainPadding===!1?m.clone():m,wi=hi=>Ti=>{const Ci=Ti*di,gi=1/St(Ci);hi.zoom=Ti===1?U:x+hi.scaleZoom(gi),Si&&(hi.bearing=n.aa(w,W,Ti)),Gi&&(hi.pitch=n.aa(A,j,Ti)),Ki&&(qt.interpolatePadding(k,Y,Ti),pe=qt.centerPoint.add(oe));const Xi=Ti===1?_e:hi.unproject(ge.add(Oe.mult(si(Ci))).mult(gi));return hi.setLocationAtPoint(hi.renderWorldCopies?Xi.wrap():Xi,pe),hi._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(s),hi};if(i.preloadOnly){const hi=this._emulate(wi,i.duration,m);return this._preloadTiles(hi),this}return this._zooming=!0,this._rotating=Si,this._pitching=Gi,this._padding=Ki,this._prepareEase(s,!1),this._ease(wi(m),()=>this._afterEase(s),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,s)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,s,m){m.animate===!1||m.duration===0?(i(1),s()):(this._easeStart=n.q.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,s){i=n.bB(i,-180,180);const m=Math.abs(i-s);return Math.abs(i-360-s)<m&&(i-=360),Math.abs(i+360-s)<m&&(i+=360),i}_normalizeCenter(i){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const m=i.lng-s.center.lng;i.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,s,m){const x=Math.ceil(15*s/1e3),w=[],A=i(m.clone());for(let k=0;k<=x;k++){const U=A(k/x);w.push(U.clone())}return w}_preloadTiles(i,s){}}class Qc{constructor(i={}){this.options=i,n.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const s=this.options&&this.options.compact,m=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=it("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const x=it("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",m),this._innerContainer=it("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(i){const m=s.reduce((x,w,A)=>(w.value&&(x+=`${w.key}=${w.value}${A<s.length-1?"&":""}`),x),"?");i.href=`${n.e.FEEDBACK_URL}/${m}#${El(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const s=this._map.style._mergedSourceCaches;for(const x in s){const w=s[x];if(w.used){const A=w.getSource();A.attribution&&i.indexOf(A.attribution)<0&&i.push(A.attribution)}}i.sort((x,w)=>x.length-w.length),i=i.filter((x,w)=>{for(let A=w+1;A<i.length;A++)if(i[A].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Sp{constructor(){n.aJ(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=it("div","mapboxgl-ctrl");const s=it("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const s in i){const m=i[s].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const s=i[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class wd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const s=++this._id;return this._queue.push({callback:i,id:s,cancelled:!1}),s}remove(i){const s=this._currentlyRunning,m=s?this._queue.concat(s):this._queue;for(const x of m)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const m of s)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Uu{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const s=n.cw((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,s,m){this._start=this.getValue(s),this._end=i,this._startTime=s,this._endTime=s+m}}const Ep={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ap=["mouseenter","mouseover","mouseleave","mouseout"];class Cp extends n.x{constructor(i,s,m,x){const{point:w,lngLat:A,originalEvent:k,target:U}=i;super(i.type,{point:w,lngLat:A,originalEvent:k,target:U}),this.preventDefault=()=>{i.preventDefault()},this.id=s,this.interaction=m,this.feature=x}}class Lp{constructor(i){this.map=i,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(i,s){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const{type:m,filter:x}=s;if(x){const A=n.M(x,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(A.result==="error")throw new Error(A.value.map(k=>`${k.key}: ${k.message}`).join(", "));this.filters.set(i,A.value)}const w=this.interactionsByType.get(m)||new Map;w.size===0&&(Ap.includes(m)?this.map.on(m,s.featureset,this.handleType):this.map.on(m,this.handleType),this.interactionsByType.set(m,w)),w.set(i,s),this.typeById.set(i,m)}remove(i){const s=this.typeById.get(i);if(!s)return;this.typeById.delete(i),this.filters.delete(i);const m=this.interactionsByType.get(s);m&&(m.delete(i),m.size===0&&this.map.off(s,this.handleType))}handleType(i){const s=this.interactionsByType.get(i.type),m=Array.from(s).reverse(),x=[];for(const[,k]of m)k.featureset&&x.push({featureset:k.featureset,filter:k.filter,radius:k.radius});let w=this.map.style.queryRenderedFeaturesForInteractions(i.point,x,this.map.transform);!w.length&&Ap.includes(i.type)&&(w=[null]);let A=!1;for(const k of w){for(const[U,W]of m){const{handler:j,featureset:Y}=W;if(Y&&(k==null||n.bi(k.featureset,Y))&&j(new Cp(i,U,W,k))!==!1){A=!0;break}}if(A)break}if(!A)for(const[k,U]of m){const{handler:W,featureset:j}=U;if(!j&&W(new Cp(i,k,U,null))!==!1)break}}}function cl(f,i){if(Array.isArray(f)&&Array.isArray(i)){const s=new Set(f),m=new Set(i);return s.size===m.size&&f.every(x=>m.has(x))}return n.bi(f,i)}const Xl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},dc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ll{constructor(i,s,m=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Kc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new yd({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),n.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(i,s){this.mouseRotate.mousedown(i,s),this.mousePitch&&this.mousePitch.mousedown(i,s),mt()}move(i,s){const m=this.map,x=this.mouseRotate.mousemoveWindow(i,s),w=x&&x.bearingDelta;if(w&&m.setBearing(m.getBearing()+w),this.mousePitch){const A=this.mousePitch.mousemoveWindow(i,s),k=A&&A.pitchDelta;k&&m.setPitch(m.getPitch()+k)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){pt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(n.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),et(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,et(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xe(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Xe(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function pc(f,i,s){if(f=new n.bL(f.lng,f.lat),i){const m=new n.bL(f.lng-360,f.lat),x=new n.bL(f.lng+360,f.lat),w=360*Math.ceil(Math.abs(f.lng-s.center.lng)/360),A=s.locationPoint(f).distSqr(i),k=i.x<0||i.y<0||i.x>s.width||i.y>s.height;s.locationPoint(m).distSqr(i)<A&&(k||Math.abs(m.lng-s.center.lng)<w)?f=m:s.locationPoint(x).distSqr(i)<A&&(k||Math.abs(x.lng-s.center.lng)<w)&&(f=x)}for(;Math.abs(f.lng-s.center.lng)>180;){const m=s.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=s.width&&m.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f}const fc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yl extends n.E{constructor(i,s){if(super(),(i instanceof HTMLElement||s)&&(i=n.l({element:i},s)),n.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=n.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=it("div");const w=41,A=27,k=xt("svg",{display:"block",height:w*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${w}`},this._element),U=xt("radialGradient",{id:"shadowGradient"},xt("defs",{},k));xt("stop",{offset:"10%","stop-opacity":.4},U),xt("stop",{offset:"100%","stop-opacity":.05},U),xt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),xt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),xt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),xt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=n.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const m=this._element.classList;for(const w in fc)m.remove(`mapboxgl-marker-anchor-${w}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=i&&i.className?i.className.trim().split(/\s+/):[];m.add(...x),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=n.bL.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const s=i.code,m=i.charCode||i.keyCode;s!=="Space"&&s!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(i){const s=i.originalEvent.target,m=this._element;this._popup&&(s===m||m.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,s=this._pos;if(!i||!s)return!1;const m=i.unproject(s),x=i.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(m)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const s=this._pos;if(!s||s.x<0||s.x>i.transform.width||s.y<0||s.y>i.transform.height)return void this._clearFadeTimer();const m=i.unproject(s);let x;i._showingGlobe()&&n.dz(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${fc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const i=this._pos,s=this._map,m=this.getPitchAlignment();if(!s||!i||m!=="map")return"";if(!s._showingGlobe()){const U=s.getPitch();return U?`rotateX(${U}deg)`:""}const x=n.c1(n.dA(s.transform,this._lngLat)),w=i.sub(n.dB(s.transform)),A=Math.abs(w.x)+Math.abs(w.y);if(A===0)return"";const k=x/A;return`rotateX(${-w.y*k}deg) rotateY(${w.x*k}deg)`}_calculateZTransform(){const i=this._pos,s=this._map;if(!s||!i)return"";let m=0;const x=this.getRotationAlignment();if(x==="map")if(s._showingGlobe()){const w=s.project(new n.bL(this._lngLat.lng,this._lngLat.lat+.001)),A=s.project(new n.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);m=n.c1(Math.atan2(A.y,A.x))-90}else m=-s.getBearing();else if(x==="horizon"){const w=n.a7(4,6,s.getZoom()),A=n.dB(s.transform);A.y+=w*s.transform.height;const k=i.sub(A),U=n.c1(Math.atan2(k.y,k.x));m=(U>90?U-270:U+90)*(1-w)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=pc(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=n.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const s=this._map;if(!s)return;const m=this._pointerdownPos,x=this._positionDelta;if(m&&x){if(!this._isDragging){const w=this._clickTolerance||s._clickTolerance;if(i.point.dist(m)<w)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.x("dragstart"))),this.fire(new n.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.x("dragend")),this._state="inactive"}_addDragHandler(i){const s=this._map,m=this._pos;s&&m&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(m),this._pointerdownPos=i.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const s=this._map;return s&&(i?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const E_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},A_={maxWidth:100,unit:"metric"},qf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},C_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Vu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function na(f=new n.P(0,0),i="bottom"){if(typeof f=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(i){case"top":return new n.P(0,f);case"top-left":return new n.P(s,s);case"top-right":return new n.P(-s,s);case"bottom":return new n.P(0,-f);case"bottom-left":return new n.P(s,-s);case"bottom-right":return new n.P(-s,-s);case"left":return new n.P(f,0);case"right":return new n.P(-f,0)}return new n.P(0,0)}return f instanceof n.P||Array.isArray(f)?n.P.convert(f):n.P.convert(f[i]||[0,0])}return{version:X,supported:yt.supported,setRTLTextPlugin:n.dC,getRTLTextPluginStatus:n.dD,Map:class extends bd{constructor(f){ne.mark($.create);const i=f;if((f=n.l({},Xl,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&n.dx(window)&&(f.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new gu(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new wd,this._domRenderTaskQueue=new wd,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aQ(),this._locale=n.l({},Ep,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Uu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Jt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?{...f.contextCreateOptions}:{},typeof f.container=="string"){const s=document.getElementById(f.container);if(!s)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=s}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),n.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Th),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new uo(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||n.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new Iu(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const s=f.bounds;s&&(this.resize(),this.fitBounds(s,n.l({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Qc({customAttribution:f.customAttribution})),this._logoControl=new Sp,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new n.x(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new n.x(`${s.dataType}dataloading`,s))}),this._interactions=new Lp(this)}_getMapId(){return this._mapId}addControl(f,i){if(i===void 0&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new n.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(s,m.firstChild):m.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new n.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new n.x("movestart",f)).fire(new n.x("move",f)),this.fire(new n.x("resize",f)),i&&this.fire(new n.x("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(n.as.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(i=>i==="auto"?navigator.language:i):f}setLanguage(f){const i=this._parseLanguage(f);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,i=f.projection.name;let s;i==="globe"&&f.zoom>=n.bV?(f.setMercatorFromTransition(),s=!0):i==="mercator"&&f.zoom<n.bV&&(f.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,i){return this._updateProjection(f||i||{name:"mercator"})}_updateProjection(f){let i;return i=f.name==="globe"&&this.transform.zoom>=n.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(n.bL.convert(f))}unproject(f){return this.transform.pointLocation3D(n.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,i,s){const m=x=>{let w=[];if(Array.isArray(i)){const A=i.filter(k=>this.getLayer(k));w=A.length?this.queryRenderedFeatures(x,{layers:A}):[]}else w=this.queryRenderedFeatures(x,{featureset:i});return w};if(f==="mouseenter"||f==="mouseover"){let x=!1;return{listener:s,targets:i,delegates:{mousemove:A=>{const k=m(A.point);k.length?x||(x=!0,s.call(this,new qs(f,this,A.originalEvent,{features:k}))):x=!1},mouseout:()=>{x=!1}}}}if(f==="mouseleave"||f==="mouseout"){let x=!1;return{listener:s,targets:i,delegates:{mousemove:k=>{m(k.point).length?x=!0:x&&(x=!1,s.call(this,new qs(f,this,k.originalEvent)))},mouseout:k=>{x&&(x=!1,s.call(this,new qs(f,this,k.originalEvent)))}}}}{const x=w=>{const A=m(w.point);A.length&&(w.features=A,s.call(this,w),delete w.features)};return{listener:s,targets:i,delegates:{[f]:x}}}}on(f,i,s){if(typeof i=="function"||s===void 0)return super.on(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const m=this._createDelegatedListener(f,i,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(f,i,s){if(typeof i=="function"||s===void 0)return super.once(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const m=this._createDelegatedListener(f,i,s);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(f,i,s){if(typeof i=="function"||s===void 0)return super.off(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const m=this._delegatedListeners?this._delegatedListeners[f]:void 0;return m&&(x=>{for(let w=0;w<x.length;w++){const A=x[w];if(A.listener===s&&cl(A.targets,i)){for(const k in A.delegates)this.off(k,A.delegates[k]);return x.splice(w,1),this}}})(m),this}queryRenderedFeatures(f,i){if(!this.style)return[];if(i!==void 0||f===void 0||f instanceof n.P||Array.isArray(f)||(i=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(i=i||{}))return this._isFeaturesetDescriptorValid(i.featureset)?this.style.queryRenderedFeaturesForInteractions(f,[i],this.transform):[];if(i.layers&&Array.isArray(i.layers)){for(const s of i.layers)if(!this._isValidId(s))return[]}return this.style.queryRenderedFeatures(f,i,this.transform)}querySourceFeatures(f,i){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,i)}isPointOnSurface(f){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&n.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(f))}addInteraction(f,i){return this._interactions.add(f,i),this}removeInteraction(f){return this._interactions.remove(f),this}setStyle(f,i){return i=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&f&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(f,(s,m)=>{s?(n.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(f,i)):m&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(f,i))}_getUIString(f){const i=this._locale[f];if(i==null)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const s=n.l({},i);i&&i.config&&(s.initialConfig=i.config,delete s.config),this.style=new Ha(this,s).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ha(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new n.t(new Error("IDs can't be empty."))),!1):!n.aK(f)||(this.fire(new n.t(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isFeaturesetDescriptorValid(f){return"featuresetId"in f?this._isValidId(f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const i of f)if(!this._isValidId(i))return!1;return!0}return this._isFeaturesetDescriptorValid(f)}addSource(f,i){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,i,s){this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,s)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,i,{pixelRatio:s=1,sdf:m=!1,stretchX:x,stretchY:w,content:A}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:k,height:U,data:W}=n.q.getImageData(i);this.style.addImage(f,{data:new n.r({width:k,height:U},W),pixelRatio:s,stretchX:x,stretchY:w,content:A,sdf:m,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new n.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:U}=i,W=i;this.style.addImage(f,{data:new n.r({width:k,height:U},new Uint8Array(W.data)),pixelRatio:s,stretchX:x,stretchY:w,content:A,sdf:m,version:0,userImage:W}),W.onAdd&&W.onAdd(this,f)}}updateImage(f,i){this._lazyInitEmptyStyle();const s=this.style.getImage(f);if(!s)return void this.fire(new n.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?n.q.getImageData(i):i,{width:x,height:w,data:A}=m;if(x===void 0||w===void 0)return void this.fire(new n.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==s.data.width||w!==s.data.height)return void this.fire(new n.t(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`)));const k=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);s.data.replace(A,k),this.style.updateImage(f,s)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new n.t(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,i){n.o(this._requestManager.transformRequest(f,n.R.Image),(s,m)=>{i(s,m instanceof HTMLImageElement?n.q.getImageData(m):m)})}listImages(){return this.style.listImages()}addModel(f,i){this._lazyInitEmptyStyle(),this.style.addModel(f,i)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new n.t(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,i){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)):this}getSlot(f){const i=this.getLayer(f);return i&&i.slot||null}setSlot(f,i){return this.style.setSlot(f,i),this.style.mergeLayers(),this._update(!0)}addImport(f,i){return this.style.addImport(f,i),this}updateImport(f,i){return typeof i!="string"&&i.id!==f?(this.removeImport(f),this.addImport(i)):(this.style.updateImport(f,i),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,i){return this.style.moveImport(f,i),this._update(!0)}moveLayer(f,i){return this._isValidId(f)?(this.style.moveLayer(f,i),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const i=this.style.getOwnLayer(f);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,i,s){return this._isValidId(f)?(this.style.setLayerZoomRange(f,i,s),this._update(!0)):this}setFilter(f,i,s={}){return this._isValidId(f)?(this.style.setFilter(f,i,s),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,i,s,m={}){return this._isValidId(f)?(this.style.setPaintProperty(f,i,s,m),this._update(!0)):this}getPaintProperty(f,i){return this._isValidId(f)?this.style.getPaintProperty(f,i):null}setLayoutProperty(f,i,s,m={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,i,s,m),this._update(!0)):this}getLayoutProperty(f,i){return this._isValidId(f)?this.style.getLayoutProperty(f,i):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,i){return this.style.setSchema(f,i),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,i){return this.style.setConfig(f,i),this._update(!0)}getConfigProperty(f,i){return this.style.getConfigProperty(f,i)}setConfigProperty(f,i,s){return this.style.setConfigProperty(f,i,s),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const i=f[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bL.convert(f),this.transform):0}setFeatureState(f,i){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,i),this._update())}removeFeatureState(f,i){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,i),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let s,m,x,w=this._container;for(;w&&(!m||!x);){const A=window.getComputedStyle(w).transform;A&&A!=="none"&&(s=A.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(m=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(x=s[3])),w=w.parentElement}this._containerWidth=m?Math.abs(f/m):f,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=it("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=it("div","mapboxgl-canvas-container",f);this._canvas=it("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=it("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{m[x]=it("div",`mapboxgl-ctrl-${x}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,i){const s=n.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(f),this._canvas.height=s*Math.ceil(i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const i=this._markers.indexOf(f);i!==-1&&this._markers.splice(i,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const i=this._popups.indexOf(f);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const f=n.l({},yt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",f);i?(pr(i,!0),this.painter=new uc(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(i)):this.fire(new n.t(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.x("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new n.x("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let i;this.fire(new n.x("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,m=n.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=x.createQuery(),x.beginQuery(s.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,j=this.transform.pitch,Y=n.q.now(),J=new n.a3(W,{now:Y,fadeDuration:w,pitch:j,transition:this.style.transition});this.style.update(J)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(m),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(m);const k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),k&&(this._placementDirty=k.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ne.mark($.load),this.fire(new n.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const W=n.q.now()-m;x.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const j=x.getQueryParameter(i,x.QUERY_RESULT)/1e6;x.deleteQuery(i),this.fire(new n.x("gpu-timing-frame",{cpuTime:W,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const W=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(W);this.fire(new n.x("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const W=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(W);this.fire(new n.x("gpu-timing-deferred-render",{gpuTime:j}))},50)}const U=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(U||this._repaint)this.triggerRepaint();else{const W=this.idle();if(W&&(A=this._updateAverageElevation(m,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),W&&(this.fire(new n.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new n.x("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,ne.mark($.fullLoad),this._performanceMetricsCollection&&on(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const i of this._markers)f&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!f||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(f,i=!1){const s=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(i||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=f;const A=Math.abs(x-w);if(A>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(w),s(w);this._averageElevation.easeTo(w,f,300)}else if(A>1e-4)return this._averageElevation.jumpTo(w),s(w)}return!!this._averageElevation.isEasing(f)&&s(this._averageElevation.getValue(f))}_authenticate(){ot(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===vt||f.status===401)){const i=this.painter.context.gl;pr(i,!1),this._logoControl instanceof Sp&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ht(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&zi(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const s=this.painter.context.gl,m=s.createFramebuffer();function x(w){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,w,0);const A=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,A),A}return s.bindFramebuffer(s.FRAMEBUFFER,m),this._canvasPixelComparison(x(f),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(f,i,s){let m=s[1]-s[0];const x=f.length/4;for(let w=0;w<i.length;w++){const A=i[w];let k=0;for(let U=0;U<A.length;U+=4)A[U]===f[U]&&A[U+1]===f[U+1]&&A[U+2]===f[U+2]&&A[U+3]===f[U+3]&&(k+=1);m+=(s[w+2]-s[w+1])*(1-k/x)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Yn.delete(this.painter.context.gl),mn.remove(),Vt.remove(),this._removed=!0,this.fire(new n.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=n.q.frame(i=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(i)}))}_preloadTiles(f){const i=this.style?this.style.getSourceCaches():[];return n.bg(i,(s,m)=>s._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,i){n.dy(f,i)}get version(){return X}},NavigationControl:class{constructor(f={}){this.options=n.l({},dc,f),this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(n.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),it("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),it("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:i}):s.resetNorth({},{originalEvent:i}))}),this._compassIcon=it("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const i=f.getZoom(),s=i===f.getMaxZoom(),m=i===f.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ll(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,i){const s=it("button",f,this._container);return s.type="button",s.addEventListener("click",i),s}_setButtonTitle(f,i){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${i}`);f.setAttribute("aria-label",s),f.firstElementChild&&f.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends n.E{constructor(f={}){super();const i=navigator.geolocation;this.options=n.l({geolocation:i},E_,f),n.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=hc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const i=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,f(s)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>i(s.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),s=f.coords;return!!i&&(s.longitude<i.getWest()||s.longitude>i.getEast()||s.latitude<i.getSouth()||s.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new n.x("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("geolocate",f)),this._finish()}}_updateCamera(f){const i=new n.bL(f.coords.longitude,f.coords.latitude),s=f.coords.accuracy,m=this._map.getBearing(),x=n.l({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(s),x,{geolocateSource:!0})}_updateMarker(f){if(f){const i=new n.bL(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,i=n.bE(1,f._center.lat)*f.worldSize,s=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=it("button","mapboxgl-ctrl-geolocate",this._container),it("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=it("div","mapboxgl-user-location"),this._dotElement.appendChild(it("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(it("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=it("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.x("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qc,ScaleControl:class{constructor(f={}){this.options=n.l({},A_,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,i=this._map,s=i._containerHeight/2,m=i._containerWidth/2-f/2,x=i.unproject([m,s]),w=i.unproject([m+f,s]),A=x.distanceTo(w);if(this.options.unit==="imperial"){const k=3.2808*A;k>5280?this._setScale(f,k/5280,"mile"):this._setScale(f,k,"foot")}else this.options.unit==="nautical"?this._setScale(f,A/1852,"nautical-mile"):A>=1e3?this._setScale(f,A/1e3,"kilometer"):this._setScale(f,A,"meter")}_setScale(f,i,s){this._map._requestDomTask(()=>{const m=function(w){const A=Math.pow(10,`${Math.floor(w)}`.length-1);let k=w/A;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(U){const W=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*W)/W}(k),A*k}(i),x=m/i;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(m):`${m}&nbsp;${qf[s]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:n.w("Full screen control 'container' must be a DOM element.")),n.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=it("button","mapboxgl-ctrl-fullscreen",this._controlContainer);it("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(f){super(),this.options=n.l(Object.create(C_),f),n.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new n.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new n.x("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=n.bL.convert(f),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const i=document.createDocumentFragment(),s=document.createElement("body");let m;for(s.innerHTML=f;m=s.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=it("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(f),this.options.closeButton){const s=this._closeButton=it("button","mapboxgl-popup-close-button",i);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let i;return this._classList.delete(f)?i=!1:(this._classList.add(f),i=!0),this._updateClassList(),i}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const i=this._map,s=this._container,m=this._pos;if(!i||!s||!m)return"bottom";const x=s.offsetWidth,w=s.offsetHeight,A=m.x<x/2,k=m.x>i.transform.width-x/2;if(m.y+f<w)return A?"top-left":k?"top-right":"top";if(m.y>i.transform.height-w){if(A)return"bottom-left";if(k)return"bottom-right"}return A?"left":k?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),f.className=i.join(" ")}_update(f){const i=this._map,s=this._content;if(!i||!this._lngLat&&!this._trackPointer||!s)return;let m=this._container;if(m||(m=this._container=it("div","mapboxgl-popup",i.getContainer()),this._tip=it("div","mapboxgl-popup-tip",m),m.appendChild(s)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pc(this._lngLat,this._pos,i.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof n.P?f:i.project(this._lngLat),w=na(this.options.offset),A=this._anchor=this._getAnchor(w.y),k=na(this.options.offset,A),U=x.add(k).round();i._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${fc[A]} translate(${U.x}px,${U.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=n.dz(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Vu);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Yl,Style:Ha,LngLat:n.bL,LngLatBounds:n.as,Point:n.P,MercatorCoordinate:n.a5,FreeCameraOptions:yo,Evented:n.E,config:n.e,prewarm:n.dE,clearPrewarmedResources:n.dF,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(f){n.e.ACCESS_TOKEN=f},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(f){n.e.API_URL=f},get workerCount(){return n.dG.workerCount},set workerCount(f){n.dG.workerCount=f},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){n.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){n.dH(f)},get workerUrl(){return n.dI.workerUrl},set workerUrl(f){n.dI.workerUrl=f},get workerClass(){return n.dI.workerClass},set workerClass(f){n.dI.workerClass=f},get workerParams(){return n.dI.workerParams},set workerParams(f){n.dI.workerParams=f},get dracoUrl(){return n.dJ()},set dracoUrl(f){n.dK(f)},get meshoptUrl(){return n.dL()},set meshoptUrl(f){n.dM(f)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var B=D;return B})}(Pv)),Pv.exports}var ED=SD();const qM=c3(ED);var Dv={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/var AD=Dv.exports,$M;function CD(){return $M||($M=1,function(c,p){(function(l,E){c.exports=E()})(AD,function l(){var E=typeof self<"u"?self:typeof window<"u"?window:E!==void 0?E:{},D=!E.document&&!!E.postMessage,N=E.IS_PAPA_WORKER||!1,B={},n=0,X={parse:function(et,Xe){var qe=(Xe=Xe||{}).dynamicTyping||!1;if(Fe(qe)&&(Xe.dynamicTypingFunction=qe,qe={}),Xe.dynamicTyping=qe,Xe.transform=!!Fe(Xe.transform)&&Xe.transform,Xe.worker&&X.WORKERS_SUPPORTED){var gt=function(){if(!X.WORKERS_SUPPORTED)return!1;var vt=(le=E.URL||E.webkitURL||null,we=l.toString(),X.BLOB_URL||(X.BLOB_URL=le.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",we,")();"],{type:"text/javascript"})))),Jt=new E.Worker(vt),le,we;return Jt.onmessage=st,Jt.id=n++,B[Jt.id]=Jt}();return gt.userStep=Xe.step,gt.userChunk=Xe.chunk,gt.userComplete=Xe.complete,gt.userError=Xe.error,Xe.step=Fe(Xe.step),Xe.chunk=Fe(Xe.chunk),Xe.complete=Fe(Xe.complete),Xe.error=Fe(Xe.error),delete Xe.worker,void gt.postMessage({input:et,config:Xe,workerId:gt.id})}var lt=null;return X.NODE_STREAM_INPUT,typeof et=="string"?(et=function(vt){return vt.charCodeAt(0)===65279?vt.slice(1):vt}(et),lt=Xe.download?new ve(Xe):new ke(Xe)):et.readable===!0&&Fe(et.read)&&Fe(et.on)?lt=new yt(Xe):(E.File&&et instanceof File||et instanceof Object)&&(lt=new ze(Xe)),lt.stream(et)},unparse:function(et,Xe){var qe=!1,gt=!0,lt=",",vt=`\r
`,Jt='"',le=Jt+Jt,we=!1,xe=null,De=!1;(function(){if(typeof Xe=="object"){if(typeof Xe.delimiter!="string"||X.BAD_DELIMITERS.filter(function(bt){return Xe.delimiter.indexOf(bt)!==-1}).length||(lt=Xe.delimiter),(typeof Xe.quotes=="boolean"||typeof Xe.quotes=="function"||Array.isArray(Xe.quotes))&&(qe=Xe.quotes),typeof Xe.skipEmptyLines!="boolean"&&typeof Xe.skipEmptyLines!="string"||(we=Xe.skipEmptyLines),typeof Xe.newline=="string"&&(vt=Xe.newline),typeof Xe.quoteChar=="string"&&(Jt=Xe.quoteChar),typeof Xe.header=="boolean"&&(gt=Xe.header),Array.isArray(Xe.columns)){if(Xe.columns.length===0)throw new Error("Option columns is empty");xe=Xe.columns}Xe.escapeChar!==void 0&&(le=Xe.escapeChar+Jt),(typeof Xe.escapeFormulae=="boolean"||Xe.escapeFormulae instanceof RegExp)&&(De=Xe.escapeFormulae instanceof RegExp?Xe.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var Ce=new RegExp(xt(Jt),"g");if(typeof et=="string"&&(et=JSON.parse(et)),Array.isArray(et)){if(!et.length||Array.isArray(et[0]))return Gt(null,et,we);if(typeof et[0]=="object")return Gt(xe||Object.keys(et[0]),et,we)}else if(typeof et=="object")return typeof et.data=="string"&&(et.data=JSON.parse(et.data)),Array.isArray(et.data)&&(et.fields||(et.fields=et.meta&&et.meta.fields||xe),et.fields||(et.fields=Array.isArray(et.data[0])?et.fields:typeof et.data[0]=="object"?Object.keys(et.data[0]):[]),Array.isArray(et.data[0])||typeof et.data[0]=="object"||(et.data=[et.data])),Gt(et.fields||[],et.data||[],we);throw new Error("Unable to serialize unrecognized input");function Gt(bt,Vt,Ht){var ni="";typeof bt=="string"&&(bt=JSON.parse(bt)),typeof Vt=="string"&&(Vt=JSON.parse(Vt));var zi=Array.isArray(bt)&&0<bt.length,Hi=!Array.isArray(Vt[0]);if(zi&&gt){for(var on=0;on<bt.length;on++)0<on&&(ni+=lt),ni+=Ft(bt[on],on);0<Vt.length&&(ni+=vt)}for(var mn=0;mn<Vt.length;mn++){var ot=zi?bt.length:Vt[mn].length,Yn=!1,pr=zi?Object.keys(Vt[mn]).length===0:Vt[mn].length===0;if(Ht&&!zi&&(Yn=Ht==="greedy"?Vt[mn].join("").trim()==="":Vt[mn].length===1&&Vt[mn][0].length===0),Ht==="greedy"&&zi){for(var At=[],Ye=0;Ye<ot;Ye++){var kt=Hi?bt[Ye]:Ye;At.push(Vt[mn][kt])}Yn=At.join("").trim()===""}if(!Yn){for(var Le=0;Le<ot;Le++){0<Le&&!pr&&(ni+=lt);var Ie=zi&&Hi?bt[Le]:Le;ni+=Ft(Vt[mn][Ie],Le)}mn<Vt.length-1&&(!Ht||0<ot&&!pr)&&(ni+=vt)}}return ni}function Ft(bt,Vt){if(bt==null)return"";if(bt.constructor===Date)return JSON.stringify(bt).slice(1,25);var Ht=!1;De&&typeof bt=="string"&&De.test(bt)&&(bt="'"+bt,Ht=!0);var ni=bt.toString().replace(Ce,le);return(Ht=Ht||qe===!0||typeof qe=="function"&&qe(bt,Vt)||Array.isArray(qe)&&qe[Vt]||function(zi,Hi){for(var on=0;on<Hi.length;on++)if(-1<zi.indexOf(Hi[on]))return!0;return!1}(ni,X.BAD_DELIMITERS)||-1<ni.indexOf(lt)||ni.charAt(0)===" "||ni.charAt(ni.length-1)===" ")?Jt+ni+Jt:ni}}};if(X.RECORD_SEP="",X.UNIT_SEP="",X.BYTE_ORDER_MARK="\uFEFF",X.BAD_DELIMITERS=["\r",`
`,'"',X.BYTE_ORDER_MARK],X.WORKERS_SUPPORTED=!D&&!!E.Worker,X.NODE_STREAM_INPUT=1,X.LocalChunkSize=10485760,X.RemoteChunkSize=5242880,X.DefaultDelimiter=",",X.Parser=Ze,X.ParserHandle=it,X.NetworkStreamer=ve,X.FileStreamer=ze,X.StringStreamer=ke,X.ReadableStreamStreamer=yt,E.jQuery){var $=E.jQuery;$.fn.parse=function(et){var Xe=et.config||{},qe=[];return this.each(function(vt){if(!($(this).prop("tagName").toUpperCase()==="INPUT"&&$(this).attr("type").toLowerCase()==="file"&&E.FileReader)||!this.files||this.files.length===0)return!0;for(var Jt=0;Jt<this.files.length;Jt++)qe.push({file:this.files[Jt],inputElem:this,instanceConfig:$.extend({},Xe)})}),gt(),this;function gt(){if(qe.length!==0){var vt,Jt,le,we,xe=qe[0];if(Fe(et.before)){var De=et.before(xe.file,xe.inputElem);if(typeof De=="object"){if(De.action==="abort")return vt="AbortError",Jt=xe.file,le=xe.inputElem,we=De.reason,void(Fe(et.error)&&et.error({name:vt},Jt,le,we));if(De.action==="skip")return void lt();typeof De.config=="object"&&(xe.instanceConfig=$.extend(xe.instanceConfig,De.config))}else if(De==="skip")return void lt()}var Ce=xe.instanceConfig.complete;xe.instanceConfig.complete=function(Gt){Fe(Ce)&&Ce(Gt,xe.file,xe.inputElem),lt()},X.parse(xe.file,xe.instanceConfig)}else Fe(et.complete)&&et.complete()}function lt(){qe.splice(0,1),gt()}}}function ne(et){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(Xe){var qe=pt(Xe);qe.chunkSize=parseInt(qe.chunkSize),Xe.step||Xe.chunk||(qe.chunkSize=null),this._handle=new it(qe),(this._handle.streamer=this)._config=qe}).call(this,et),this.parseChunk=function(Xe,qe){if(this.isFirstChunk&&Fe(this._config.beforeFirstChunk)){var gt=this._config.beforeFirstChunk(Xe);gt!==void 0&&(Xe=gt)}this.isFirstChunk=!1,this._halted=!1;var lt=this._partialLine+Xe;this._partialLine="";var vt=this._handle.parse(lt,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var Jt=vt.meta.cursor;this._finished||(this._partialLine=lt.substring(Jt-this._baseIndex),this._baseIndex=Jt),vt&&vt.data&&(this._rowCount+=vt.data.length);var le=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(N)E.postMessage({results:vt,workerId:X.WORKER_ID,finished:le});else if(Fe(this._config.chunk)&&!qe){if(this._config.chunk(vt,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);vt=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(vt.data),this._completeResults.errors=this._completeResults.errors.concat(vt.errors),this._completeResults.meta=vt.meta),this._completed||!le||!Fe(this._config.complete)||vt&&vt.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),le||vt&&vt.meta.paused||this._nextChunk(),vt}this._halted=!0},this._sendError=function(Xe){Fe(this._config.error)?this._config.error(Xe):N&&this._config.error&&E.postMessage({workerId:X.WORKER_ID,error:Xe,finished:!1})}}function ve(et){var Xe;(et=et||{}).chunkSize||(et.chunkSize=X.RemoteChunkSize),ne.call(this,et),this._nextChunk=D?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(qe){this._input=qe,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(Xe=new XMLHttpRequest,this._config.withCredentials&&(Xe.withCredentials=this._config.withCredentials),D||(Xe.onload=Tt(this._chunkLoaded,this),Xe.onerror=Tt(this._chunkError,this)),Xe.open(this._config.downloadRequestBody?"POST":"GET",this._input,!D),this._config.downloadRequestHeaders){var qe=this._config.downloadRequestHeaders;for(var gt in qe)Xe.setRequestHeader(gt,qe[gt])}if(this._config.chunkSize){var lt=this._start+this._config.chunkSize-1;Xe.setRequestHeader("Range","bytes="+this._start+"-"+lt)}try{Xe.send(this._config.downloadRequestBody)}catch(vt){this._chunkError(vt.message)}D&&Xe.status===0&&this._chunkError()}},this._chunkLoaded=function(){Xe.readyState===4&&(Xe.status<200||400<=Xe.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:Xe.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(qe){var gt=qe.getResponseHeader("Content-Range");return gt===null?-1:parseInt(gt.substring(gt.lastIndexOf("/")+1))}(Xe),this.parseChunk(Xe.responseText)))},this._chunkError=function(qe){var gt=Xe.statusText||qe;this._sendError(new Error(gt))}}function ze(et){var Xe,qe;(et=et||{}).chunkSize||(et.chunkSize=X.LocalChunkSize),ne.call(this,et);var gt=typeof FileReader<"u";this.stream=function(lt){this._input=lt,qe=lt.slice||lt.webkitSlice||lt.mozSlice,gt?((Xe=new FileReader).onload=Tt(this._chunkLoaded,this),Xe.onerror=Tt(this._chunkError,this)):Xe=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var lt=this._input;if(this._config.chunkSize){var vt=Math.min(this._start+this._config.chunkSize,this._input.size);lt=qe.call(lt,this._start,vt)}var Jt=Xe.readAsText(lt,this._config.encoding);gt||this._chunkLoaded({target:{result:Jt}})},this._chunkLoaded=function(lt){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(lt.target.result)},this._chunkError=function(){this._sendError(Xe.error)}}function ke(et){var Xe;ne.call(this,et=et||{}),this.stream=function(qe){return Xe=qe,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var qe,gt=this._config.chunkSize;return gt?(qe=Xe.substring(0,gt),Xe=Xe.substring(gt)):(qe=Xe,Xe=""),this._finished=!Xe,this.parseChunk(qe)}}}function yt(et){ne.call(this,et=et||{});var Xe=[],qe=!0,gt=!1;this.pause=function(){ne.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){ne.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(lt){this._input=lt,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){gt&&Xe.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),Xe.length?this.parseChunk(Xe.shift()):qe=!0},this._streamData=Tt(function(lt){try{Xe.push(typeof lt=="string"?lt:lt.toString(this._config.encoding)),qe&&(qe=!1,this._checkIsFinished(),this.parseChunk(Xe.shift()))}catch(vt){this._streamError(vt)}},this),this._streamError=Tt(function(lt){this._streamCleanUp(),this._sendError(lt)},this),this._streamEnd=Tt(function(){this._streamCleanUp(),gt=!0,this._streamData("")},this),this._streamCleanUp=Tt(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function it(et){var Xe,qe,gt,lt=Math.pow(2,53),vt=-lt,Jt=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,le=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,we=this,xe=0,De=0,Ce=!1,Gt=!1,Ft=[],bt={data:[],errors:[],meta:{}};if(Fe(et.step)){var Vt=et.step;et.step=function(mn){if(bt=mn,zi())ni();else{if(ni(),bt.data.length===0)return;xe+=mn.data.length,et.preview&&xe>et.preview?qe.abort():(bt.data=bt.data[0],Vt(bt,we))}}}function Ht(mn){return et.skipEmptyLines==="greedy"?mn.join("").trim()==="":mn.length===1&&mn[0].length===0}function ni(){return bt&&gt&&(on("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+X.DefaultDelimiter+"'"),gt=!1),et.skipEmptyLines&&(bt.data=bt.data.filter(function(mn){return!Ht(mn)})),zi()&&function(){if(!bt)return;function mn(Yn,pr){Fe(et.transformHeader)&&(Yn=et.transformHeader(Yn,pr)),Ft.push(Yn)}if(Array.isArray(bt.data[0])){for(var ot=0;zi()&&ot<bt.data.length;ot++)bt.data[ot].forEach(mn);bt.data.splice(0,1)}else bt.data.forEach(mn)}(),function(){if(!bt||!et.header&&!et.dynamicTyping&&!et.transform)return bt;function mn(Yn,pr){var At,Ye=et.header?{}:[];for(At=0;At<Yn.length;At++){var kt=At,Le=Yn[At];et.header&&(kt=At>=Ft.length?"__parsed_extra":Ft[At]),et.transform&&(Le=et.transform(Le,kt)),Le=Hi(kt,Le),kt==="__parsed_extra"?(Ye[kt]=Ye[kt]||[],Ye[kt].push(Le)):Ye[kt]=Le}return et.header&&(At>Ft.length?on("FieldMismatch","TooManyFields","Too many fields: expected "+Ft.length+" fields but parsed "+At,De+pr):At<Ft.length&&on("FieldMismatch","TooFewFields","Too few fields: expected "+Ft.length+" fields but parsed "+At,De+pr)),Ye}var ot=1;return!bt.data.length||Array.isArray(bt.data[0])?(bt.data=bt.data.map(mn),ot=bt.data.length):bt.data=mn(bt.data,0),et.header&&bt.meta&&(bt.meta.fields=Ft),De+=ot,bt}()}function zi(){return et.header&&Ft.length===0}function Hi(mn,ot){return Yn=mn,et.dynamicTypingFunction&&et.dynamicTyping[Yn]===void 0&&(et.dynamicTyping[Yn]=et.dynamicTypingFunction(Yn)),(et.dynamicTyping[Yn]||et.dynamicTyping)===!0?ot==="true"||ot==="TRUE"||ot!=="false"&&ot!=="FALSE"&&(function(pr){if(Jt.test(pr)){var At=parseFloat(pr);if(vt<At&&At<lt)return!0}return!1}(ot)?parseFloat(ot):le.test(ot)?new Date(ot):ot===""?null:ot):ot;var Yn}function on(mn,ot,Yn,pr){var At={type:mn,code:ot,message:Yn};pr!==void 0&&(At.row=pr),bt.errors.push(At)}this.parse=function(mn,ot,Yn){var pr=et.quoteChar||'"';if(et.newline||(et.newline=function(kt,Le){kt=kt.substring(0,1048576);var Ie=new RegExp(xt(Le)+"([^]*?)"+xt(Le),"gm"),Ue=(kt=kt.replace(Ie,"")).split("\r"),We=kt.split(`
`),rt=1<We.length&&We[0].length<Ue[0].length;if(Ue.length===1||rt)return`
`;for(var ut=0,ht=0;ht<Ue.length;ht++)Ue[ht][0]===`
`&&ut++;return ut>=Ue.length/2?`\r
`:"\r"}(mn,pr)),gt=!1,et.delimiter)Fe(et.delimiter)&&(et.delimiter=et.delimiter(mn),bt.meta.delimiter=et.delimiter);else{var At=function(kt,Le,Ie,Ue,We){var rt,ut,ht,Lt;We=We||[",","	","|",";",X.RECORD_SEP,X.UNIT_SEP];for(var It=0;It<We.length;It++){var ui=We[It],xi=0,an=0,cn=0;ht=void 0;for(var _n=new Ze({comments:Ue,delimiter:ui,newline:Le,preview:10}).parse(kt),Fn=0;Fn<_n.data.length;Fn++)if(Ie&&Ht(_n.data[Fn]))cn++;else{var Mn=_n.data[Fn].length;an+=Mn,ht!==void 0?0<Mn&&(xi+=Math.abs(Mn-ht),ht=Mn):ht=Mn}0<_n.data.length&&(an/=_n.data.length-cn),(ut===void 0||xi<=ut)&&(Lt===void 0||Lt<an)&&1.99<an&&(ut=xi,rt=ui,Lt=an)}return{successful:!!(et.delimiter=rt),bestDelimiter:rt}}(mn,et.newline,et.skipEmptyLines,et.comments,et.delimitersToGuess);At.successful?et.delimiter=At.bestDelimiter:(gt=!0,et.delimiter=X.DefaultDelimiter),bt.meta.delimiter=et.delimiter}var Ye=pt(et);return et.preview&&et.header&&Ye.preview++,Xe=mn,qe=new Ze(Ye),bt=qe.parse(Xe,ot,Yn),ni(),Ce?{meta:{paused:!0}}:bt||{meta:{paused:!1}}},this.paused=function(){return Ce},this.pause=function(){Ce=!0,qe.abort(),Xe=Fe(et.chunk)?"":Xe.substring(qe.getCharIndex())},this.resume=function(){we.streamer._halted?(Ce=!1,we.streamer.parseChunk(Xe,!0)):setTimeout(we.resume,3)},this.aborted=function(){return Gt},this.abort=function(){Gt=!0,qe.abort(),bt.meta.aborted=!0,Fe(et.complete)&&et.complete(bt),Xe=""}}function xt(et){return et.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ze(et){var Xe,qe=(et=et||{}).delimiter,gt=et.newline,lt=et.comments,vt=et.step,Jt=et.preview,le=et.fastMode,we=Xe=et.quoteChar===void 0||et.quoteChar===null?'"':et.quoteChar;if(et.escapeChar!==void 0&&(we=et.escapeChar),(typeof qe!="string"||-1<X.BAD_DELIMITERS.indexOf(qe))&&(qe=","),lt===qe)throw new Error("Comment character same as delimiter");lt===!0?lt="#":(typeof lt!="string"||-1<X.BAD_DELIMITERS.indexOf(lt))&&(lt=!1),gt!==`
`&&gt!=="\r"&&gt!==`\r
`&&(gt=`
`);var xe=0,De=!1;this.parse=function(Ce,Gt,Ft){if(typeof Ce!="string")throw new Error("Input must be a string");var bt=Ce.length,Vt=qe.length,Ht=gt.length,ni=lt.length,zi=Fe(vt),Hi=[],on=[],mn=[],ot=xe=0;if(!Ce)return jn();if(et.header&&!Gt){var Yn=Ce.split(gt)[0].split(qe),pr=[],At={},Ye=!1;for(var kt in Yn){var Le=Yn[kt];Fe(et.transformHeader)&&(Le=et.transformHeader(Le,kt));var Ie=Le,Ue=At[Le]||0;for(0<Ue&&(Ye=!0,Ie=Le+"_"+Ue),At[Le]=Ue+1;pr.includes(Ie);)Ie=Ie+"_"+Ue;pr.push(Ie)}if(Ye){var We=Ce.split(gt);We[0]=pr.join(qe),Ce=We.join(gt)}}if(le||le!==!1&&Ce.indexOf(Xe)===-1){for(var rt=Ce.split(gt),ut=0;ut<rt.length;ut++){if(mn=rt[ut],xe+=mn.length,ut!==rt.length-1)xe+=gt.length;else if(Ft)return jn();if(!lt||mn.substring(0,ni)!==lt){if(zi){if(Hi=[],cn(mn.split(qe)),Lr(),De)return jn()}else cn(mn.split(qe));if(Jt&&Jt<=ut)return Hi=Hi.slice(0,Jt),jn(!0)}}return jn()}for(var ht=Ce.indexOf(qe,xe),Lt=Ce.indexOf(gt,xe),It=new RegExp(xt(we)+xt(Xe),"g"),ui=Ce.indexOf(Xe,xe);;)if(Ce[xe]!==Xe)if(lt&&mn.length===0&&Ce.substring(xe,xe+ni)===lt){if(Lt===-1)return jn();xe=Lt+Ht,Lt=Ce.indexOf(gt,xe),ht=Ce.indexOf(qe,xe)}else if(ht!==-1&&(ht<Lt||Lt===-1))mn.push(Ce.substring(xe,ht)),xe=ht+Vt,ht=Ce.indexOf(qe,xe);else{if(Lt===-1)break;if(mn.push(Ce.substring(xe,Lt)),Mn(Lt+Ht),zi&&(Lr(),De))return jn();if(Jt&&Hi.length>=Jt)return jn(!0)}else for(ui=xe,xe++;;){if((ui=Ce.indexOf(Xe,ui+1))===-1)return Ft||on.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Hi.length,index:xe}),Fn();if(ui===bt-1)return Fn(Ce.substring(xe,ui).replace(It,Xe));if(Xe!==we||Ce[ui+1]!==we){if(Xe===we||ui===0||Ce[ui-1]!==we){ht!==-1&&ht<ui+1&&(ht=Ce.indexOf(qe,ui+1)),Lt!==-1&&Lt<ui+1&&(Lt=Ce.indexOf(gt,ui+1));var xi=_n(Lt===-1?ht:Math.min(ht,Lt));if(Ce.substr(ui+1+xi,Vt)===qe){mn.push(Ce.substring(xe,ui).replace(It,Xe)),Ce[xe=ui+1+xi+Vt]!==Xe&&(ui=Ce.indexOf(Xe,xe)),ht=Ce.indexOf(qe,xe),Lt=Ce.indexOf(gt,xe);break}var an=_n(Lt);if(Ce.substring(ui+1+an,ui+1+an+Ht)===gt){if(mn.push(Ce.substring(xe,ui).replace(It,Xe)),Mn(ui+1+an+Ht),ht=Ce.indexOf(qe,xe),ui=Ce.indexOf(Xe,xe),zi&&(Lr(),De))return jn();if(Jt&&Hi.length>=Jt)return jn(!0);break}on.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Hi.length,index:xe}),ui++}}else ui++}return Fn();function cn(Tr){Hi.push(Tr),ot=xe}function _n(Tr){var to=0;if(Tr!==-1){var $r=Ce.substring(ui+1,Tr);$r&&$r.trim()===""&&(to=$r.length)}return to}function Fn(Tr){return Ft||(Tr===void 0&&(Tr=Ce.substring(xe)),mn.push(Tr),xe=bt,cn(mn),zi&&Lr()),jn()}function Mn(Tr){xe=Tr,cn(mn),mn=[],Lt=Ce.indexOf(gt,xe)}function jn(Tr){return{data:Hi,errors:on,meta:{delimiter:qe,linebreak:gt,aborted:De,truncated:!!Tr,cursor:ot+(Gt||0)}}}function Lr(){vt(jn()),Hi=[],on=[]}},this.abort=function(){De=!0},this.getCharIndex=function(){return xe}}function st(et){var Xe=et.data,qe=B[Xe.workerId],gt=!1;if(Xe.error)qe.userError(Xe.error,Xe.file);else if(Xe.results&&Xe.results.data){var lt={abort:function(){gt=!0,ti(Xe.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:mt,resume:mt};if(Fe(qe.userStep)){for(var vt=0;vt<Xe.results.data.length&&(qe.userStep({data:Xe.results.data[vt],errors:Xe.results.errors,meta:Xe.results.meta},lt),!gt);vt++);delete Xe.results}else Fe(qe.userChunk)&&(qe.userChunk(Xe.results,lt,Xe.file),delete Xe.results)}Xe.finished&&!gt&&ti(Xe.workerId,Xe.results)}function ti(et,Xe){var qe=B[et];Fe(qe.userComplete)&&qe.userComplete(Xe),qe.terminate(),delete B[et]}function mt(){throw new Error("Not implemented.")}function pt(et){if(typeof et!="object"||et===null)return et;var Xe=Array.isArray(et)?[]:{};for(var qe in et)Xe[qe]=pt(et[qe]);return Xe}function Tt(et,Xe){return function(){et.apply(Xe,arguments)}}function Fe(et){return typeof et=="function"}return N&&(E.onmessage=function(et){var Xe=et.data;if(X.WORKER_ID===void 0&&Xe&&(X.WORKER_ID=Xe.workerId),typeof Xe.input=="string")E.postMessage({workerId:X.WORKER_ID,results:X.parse(Xe.input,Xe.config),finished:!0});else if(E.File&&Xe.input instanceof File||Xe.input instanceof Object){var qe=X.parse(Xe.input,Xe.config);qe&&E.postMessage({workerId:X.WORKER_ID,results:qe,finished:!0})}}),(ve.prototype=Object.create(ne.prototype)).constructor=ve,(ze.prototype=Object.create(ne.prototype)).constructor=ze,(ke.prototype=Object.create(ke.prototype)).constructor=ke,(yt.prototype=Object.create(ne.prototype)).constructor=yt,X})}(Dv)),Dv.exports}var LD=CD();const ZM=c3(LD);/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const ID=4,XM=0,YM=1,RD=2;function o_(c){let p=c.length;for(;--p>=0;)c[p]=0}const PD=0,h3=1,DD=2,OD=3,zD=258,Nw=29,iy=256,j0=iy+1+Nw,qg=30,Uw=19,d3=2*j0+1,_m=15,P1=16,kD=7,Vw=256,p3=16,f3=17,m3=18,tw=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ov=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),FD=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),g3=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),BD=512,kd=new Array((j0+2)*2);o_(kd);const O0=new Array(qg*2);o_(O0);const W0=new Array(BD);o_(W0);const q0=new Array(zD-OD+1);o_(q0);const Gw=new Array(Nw);o_(Gw);const jv=new Array(qg);o_(jv);function D1(c,p,l,E,D){this.static_tree=c,this.extra_bits=p,this.extra_base=l,this.elems=E,this.max_length=D,this.has_stree=c&&c.length}let _3,y3,v3;function O1(c,p){this.dyn_tree=c,this.max_code=0,this.stat_desc=p}const x3=c=>c<256?W0[c]:W0[256+(c>>>7)],$0=(c,p)=>{c.pending_buf[c.pending++]=p&255,c.pending_buf[c.pending++]=p>>>8&255},ic=(c,p,l)=>{c.bi_valid>P1-l?(c.bi_buf|=p<<c.bi_valid&65535,$0(c,c.bi_buf),c.bi_buf=p>>P1-c.bi_valid,c.bi_valid+=l-P1):(c.bi_buf|=p<<c.bi_valid&65535,c.bi_valid+=l)},Hh=(c,p,l)=>{ic(c,l[p*2],l[p*2+1])},b3=(c,p)=>{let l=0;do l|=c&1,c>>>=1,l<<=1;while(--p>0);return l>>>1},ND=c=>{c.bi_valid===16?($0(c,c.bi_buf),c.bi_buf=0,c.bi_valid=0):c.bi_valid>=8&&(c.pending_buf[c.pending++]=c.bi_buf&255,c.bi_buf>>=8,c.bi_valid-=8)},UD=(c,p)=>{const l=p.dyn_tree,E=p.max_code,D=p.stat_desc.static_tree,N=p.stat_desc.has_stree,B=p.stat_desc.extra_bits,n=p.stat_desc.extra_base,X=p.stat_desc.max_length;let $,ne,ve,ze,ke,yt,it=0;for(ze=0;ze<=_m;ze++)c.bl_count[ze]=0;for(l[c.heap[c.heap_max]*2+1]=0,$=c.heap_max+1;$<d3;$++)ne=c.heap[$],ze=l[l[ne*2+1]*2+1]+1,ze>X&&(ze=X,it++),l[ne*2+1]=ze,!(ne>E)&&(c.bl_count[ze]++,ke=0,ne>=n&&(ke=B[ne-n]),yt=l[ne*2],c.opt_len+=yt*(ze+ke),N&&(c.static_len+=yt*(D[ne*2+1]+ke)));if(it!==0){do{for(ze=X-1;c.bl_count[ze]===0;)ze--;c.bl_count[ze]--,c.bl_count[ze+1]+=2,c.bl_count[X]--,it-=2}while(it>0);for(ze=X;ze!==0;ze--)for(ne=c.bl_count[ze];ne!==0;)ve=c.heap[--$],!(ve>E)&&(l[ve*2+1]!==ze&&(c.opt_len+=(ze-l[ve*2+1])*l[ve*2],l[ve*2+1]=ze),ne--)}},w3=(c,p,l)=>{const E=new Array(_m+1);let D=0,N,B;for(N=1;N<=_m;N++)D=D+l[N-1]<<1,E[N]=D;for(B=0;B<=p;B++){let n=c[B*2+1];n!==0&&(c[B*2]=b3(E[n]++,n))}},VD=()=>{let c,p,l,E,D;const N=new Array(_m+1);for(l=0,E=0;E<Nw-1;E++)for(Gw[E]=l,c=0;c<1<<tw[E];c++)q0[l++]=E;for(q0[l-1]=E,D=0,E=0;E<16;E++)for(jv[E]=D,c=0;c<1<<Ov[E];c++)W0[D++]=E;for(D>>=7;E<qg;E++)for(jv[E]=D<<7,c=0;c<1<<Ov[E]-7;c++)W0[256+D++]=E;for(p=0;p<=_m;p++)N[p]=0;for(c=0;c<=143;)kd[c*2+1]=8,c++,N[8]++;for(;c<=255;)kd[c*2+1]=9,c++,N[9]++;for(;c<=279;)kd[c*2+1]=7,c++,N[7]++;for(;c<=287;)kd[c*2+1]=8,c++,N[8]++;for(w3(kd,j0+1,N),c=0;c<qg;c++)O0[c*2+1]=5,O0[c*2]=b3(c,5);_3=new D1(kd,tw,iy+1,j0,_m),y3=new D1(O0,Ov,0,qg,_m),v3=new D1(new Array(0),FD,0,Uw,kD)},T3=c=>{let p;for(p=0;p<j0;p++)c.dyn_ltree[p*2]=0;for(p=0;p<qg;p++)c.dyn_dtree[p*2]=0;for(p=0;p<Uw;p++)c.bl_tree[p*2]=0;c.dyn_ltree[Vw*2]=1,c.opt_len=c.static_len=0,c.sym_next=c.matches=0},M3=c=>{c.bi_valid>8?$0(c,c.bi_buf):c.bi_valid>0&&(c.pending_buf[c.pending++]=c.bi_buf),c.bi_buf=0,c.bi_valid=0},KM=(c,p,l,E)=>{const D=p*2,N=l*2;return c[D]<c[N]||c[D]===c[N]&&E[p]<=E[l]},z1=(c,p,l)=>{const E=c.heap[l];let D=l<<1;for(;D<=c.heap_len&&(D<c.heap_len&&KM(p,c.heap[D+1],c.heap[D],c.depth)&&D++,!KM(p,E,c.heap[D],c.depth));)c.heap[l]=c.heap[D],l=D,D<<=1;c.heap[l]=E},JM=(c,p,l)=>{let E,D,N=0,B,n;if(c.sym_next!==0)do E=c.pending_buf[c.sym_buf+N++]&255,E+=(c.pending_buf[c.sym_buf+N++]&255)<<8,D=c.pending_buf[c.sym_buf+N++],E===0?Hh(c,D,p):(B=q0[D],Hh(c,B+iy+1,p),n=tw[B],n!==0&&(D-=Gw[B],ic(c,D,n)),E--,B=x3(E),Hh(c,B,l),n=Ov[B],n!==0&&(E-=jv[B],ic(c,E,n)));while(N<c.sym_next);Hh(c,Vw,p)},iw=(c,p)=>{const l=p.dyn_tree,E=p.stat_desc.static_tree,D=p.stat_desc.has_stree,N=p.stat_desc.elems;let B,n,X=-1,$;for(c.heap_len=0,c.heap_max=d3,B=0;B<N;B++)l[B*2]!==0?(c.heap[++c.heap_len]=X=B,c.depth[B]=0):l[B*2+1]=0;for(;c.heap_len<2;)$=c.heap[++c.heap_len]=X<2?++X:0,l[$*2]=1,c.depth[$]=0,c.opt_len--,D&&(c.static_len-=E[$*2+1]);for(p.max_code=X,B=c.heap_len>>1;B>=1;B--)z1(c,l,B);$=N;do B=c.heap[1],c.heap[1]=c.heap[c.heap_len--],z1(c,l,1),n=c.heap[1],c.heap[--c.heap_max]=B,c.heap[--c.heap_max]=n,l[$*2]=l[B*2]+l[n*2],c.depth[$]=(c.depth[B]>=c.depth[n]?c.depth[B]:c.depth[n])+1,l[B*2+1]=l[n*2+1]=$,c.heap[1]=$++,z1(c,l,1);while(c.heap_len>=2);c.heap[--c.heap_max]=c.heap[1],UD(c,p),w3(l,X,c.bl_count)},QM=(c,p,l)=>{let E,D=-1,N,B=p[0*2+1],n=0,X=7,$=4;for(B===0&&(X=138,$=3),p[(l+1)*2+1]=65535,E=0;E<=l;E++)N=B,B=p[(E+1)*2+1],!(++n<X&&N===B)&&(n<$?c.bl_tree[N*2]+=n:N!==0?(N!==D&&c.bl_tree[N*2]++,c.bl_tree[p3*2]++):n<=10?c.bl_tree[f3*2]++:c.bl_tree[m3*2]++,n=0,D=N,B===0?(X=138,$=3):N===B?(X=6,$=3):(X=7,$=4))},eS=(c,p,l)=>{let E,D=-1,N,B=p[0*2+1],n=0,X=7,$=4;for(B===0&&(X=138,$=3),E=0;E<=l;E++)if(N=B,B=p[(E+1)*2+1],!(++n<X&&N===B)){if(n<$)do Hh(c,N,c.bl_tree);while(--n!==0);else N!==0?(N!==D&&(Hh(c,N,c.bl_tree),n--),Hh(c,p3,c.bl_tree),ic(c,n-3,2)):n<=10?(Hh(c,f3,c.bl_tree),ic(c,n-3,3)):(Hh(c,m3,c.bl_tree),ic(c,n-11,7));n=0,D=N,B===0?(X=138,$=3):N===B?(X=6,$=3):(X=7,$=4)}},GD=c=>{let p;for(QM(c,c.dyn_ltree,c.l_desc.max_code),QM(c,c.dyn_dtree,c.d_desc.max_code),iw(c,c.bl_desc),p=Uw-1;p>=3&&c.bl_tree[g3[p]*2+1]===0;p--);return c.opt_len+=3*(p+1)+5+5+4,p},HD=(c,p,l,E)=>{let D;for(ic(c,p-257,5),ic(c,l-1,5),ic(c,E-4,4),D=0;D<E;D++)ic(c,c.bl_tree[g3[D]*2+1],3);eS(c,c.dyn_ltree,p-1),eS(c,c.dyn_dtree,l-1)},jD=c=>{let p=4093624447,l;for(l=0;l<=31;l++,p>>>=1)if(p&1&&c.dyn_ltree[l*2]!==0)return XM;if(c.dyn_ltree[9*2]!==0||c.dyn_ltree[10*2]!==0||c.dyn_ltree[13*2]!==0)return YM;for(l=32;l<iy;l++)if(c.dyn_ltree[l*2]!==0)return YM;return XM};let tS=!1;const WD=c=>{tS||(VD(),tS=!0),c.l_desc=new O1(c.dyn_ltree,_3),c.d_desc=new O1(c.dyn_dtree,y3),c.bl_desc=new O1(c.bl_tree,v3),c.bi_buf=0,c.bi_valid=0,T3(c)},S3=(c,p,l,E)=>{ic(c,(PD<<1)+(E?1:0),3),M3(c),$0(c,l),$0(c,~l),l&&c.pending_buf.set(c.window.subarray(p,p+l),c.pending),c.pending+=l},qD=c=>{ic(c,h3<<1,3),Hh(c,Vw,kd),ND(c)},$D=(c,p,l,E)=>{let D,N,B=0;c.level>0?(c.strm.data_type===RD&&(c.strm.data_type=jD(c)),iw(c,c.l_desc),iw(c,c.d_desc),B=GD(c),D=c.opt_len+3+7>>>3,N=c.static_len+3+7>>>3,N<=D&&(D=N)):D=N=l+5,l+4<=D&&p!==-1?S3(c,p,l,E):c.strategy===ID||N===D?(ic(c,(h3<<1)+(E?1:0),3),JM(c,kd,O0)):(ic(c,(DD<<1)+(E?1:0),3),HD(c,c.l_desc.max_code+1,c.d_desc.max_code+1,B+1),JM(c,c.dyn_ltree,c.dyn_dtree)),T3(c),E&&M3(c)},ZD=(c,p,l)=>(c.pending_buf[c.sym_buf+c.sym_next++]=p,c.pending_buf[c.sym_buf+c.sym_next++]=p>>8,c.pending_buf[c.sym_buf+c.sym_next++]=l,p===0?c.dyn_ltree[l*2]++:(c.matches++,p--,c.dyn_ltree[(q0[l]+iy+1)*2]++,c.dyn_dtree[x3(p)*2]++),c.sym_next===c.sym_end);var XD=WD,YD=S3,KD=$D,JD=ZD,QD=qD,eO={_tr_init:XD,_tr_stored_block:YD,_tr_flush_block:KD,_tr_tally:JD,_tr_align:QD};const tO=(c,p,l,E)=>{let D=c&65535|0,N=c>>>16&65535|0,B=0;for(;l!==0;){B=l>2e3?2e3:l,l-=B;do D=D+p[E++]|0,N=N+D|0;while(--B);D%=65521,N%=65521}return D|N<<16|0};var Z0=tO;const iO=()=>{let c,p=[];for(var l=0;l<256;l++){c=l;for(var E=0;E<8;E++)c=c&1?3988292384^c>>>1:c>>>1;p[l]=c}return p},nO=new Uint32Array(iO()),rO=(c,p,l,E)=>{const D=nO,N=E+l;c^=-1;for(let B=E;B<N;B++)c=c>>>8^D[(c^p[B])&255];return c^-1};var Ba=rO,Am={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Dm={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:sO,_tr_stored_block:nw,_tr_flush_block:oO,_tr_tally:Xp,_tr_align:aO}=eO,{Z_NO_FLUSH:Yp,Z_PARTIAL_FLUSH:lO,Z_FULL_FLUSH:cO,Z_FINISH:au,Z_BLOCK:iS,Z_OK:tl,Z_STREAM_END:nS,Z_STREAM_ERROR:$h,Z_DATA_ERROR:uO,Z_BUF_ERROR:k1,Z_DEFAULT_COMPRESSION:hO,Z_FILTERED:dO,Z_HUFFMAN_ONLY:hv,Z_RLE:pO,Z_FIXED:fO,Z_DEFAULT_STRATEGY:mO,Z_UNKNOWN:gO,Z_DEFLATED:cx}=Dm,_O=9,yO=15,vO=8,xO=29,bO=256,rw=bO+1+xO,wO=30,TO=19,MO=2*rw+1,SO=15,Xs=3,Zp=258,Zh=Zp+Xs+1,EO=32,Xg=42,Hw=57,sw=69,ow=73,aw=91,lw=103,ym=113,S0=666,Nl=1,a_=2,Cm=3,l_=4,AO=3,vm=(c,p)=>(c.msg=Am[p],p),rS=c=>c*2-(c>4?9:0),$p=c=>{let p=c.length;for(;--p>=0;)c[p]=0},CO=c=>{let p,l,E,D=c.w_size;p=c.hash_size,E=p;do l=c.head[--E],c.head[E]=l>=D?l-D:0;while(--p);p=D,E=p;do l=c.prev[--E],c.prev[E]=l>=D?l-D:0;while(--p)};let LO=(c,p,l)=>(p<<c.hash_shift^l)&c.hash_mask,Kp=LO;const bc=c=>{const p=c.state;let l=p.pending;l>c.avail_out&&(l=c.avail_out),l!==0&&(c.output.set(p.pending_buf.subarray(p.pending_out,p.pending_out+l),c.next_out),c.next_out+=l,p.pending_out+=l,c.total_out+=l,c.avail_out-=l,p.pending-=l,p.pending===0&&(p.pending_out=0))},Sc=(c,p)=>{oO(c,c.block_start>=0?c.block_start:-1,c.strstart-c.block_start,p),c.block_start=c.strstart,bc(c.strm)},ao=(c,p)=>{c.pending_buf[c.pending++]=p},b0=(c,p)=>{c.pending_buf[c.pending++]=p>>>8&255,c.pending_buf[c.pending++]=p&255},cw=(c,p,l,E)=>{let D=c.avail_in;return D>E&&(D=E),D===0?0:(c.avail_in-=D,p.set(c.input.subarray(c.next_in,c.next_in+D),l),c.state.wrap===1?c.adler=Z0(c.adler,p,D,l):c.state.wrap===2&&(c.adler=Ba(c.adler,p,D,l)),c.next_in+=D,c.total_in+=D,D)},E3=(c,p)=>{let l=c.max_chain_length,E=c.strstart,D,N,B=c.prev_length,n=c.nice_match;const X=c.strstart>c.w_size-Zh?c.strstart-(c.w_size-Zh):0,$=c.window,ne=c.w_mask,ve=c.prev,ze=c.strstart+Zp;let ke=$[E+B-1],yt=$[E+B];c.prev_length>=c.good_match&&(l>>=2),n>c.lookahead&&(n=c.lookahead);do if(D=p,!($[D+B]!==yt||$[D+B-1]!==ke||$[D]!==$[E]||$[++D]!==$[E+1])){E+=2,D++;do;while($[++E]===$[++D]&&$[++E]===$[++D]&&$[++E]===$[++D]&&$[++E]===$[++D]&&$[++E]===$[++D]&&$[++E]===$[++D]&&$[++E]===$[++D]&&$[++E]===$[++D]&&E<ze);if(N=Zp-(ze-E),E=ze-Zp,N>B){if(c.match_start=p,B=N,N>=n)break;ke=$[E+B-1],yt=$[E+B]}}while((p=ve[p&ne])>X&&--l!==0);return B<=c.lookahead?B:c.lookahead},Yg=c=>{const p=c.w_size;let l,E,D;do{if(E=c.window_size-c.lookahead-c.strstart,c.strstart>=p+(p-Zh)&&(c.window.set(c.window.subarray(p,p+p-E),0),c.match_start-=p,c.strstart-=p,c.block_start-=p,c.insert>c.strstart&&(c.insert=c.strstart),CO(c),E+=p),c.strm.avail_in===0)break;if(l=cw(c.strm,c.window,c.strstart+c.lookahead,E),c.lookahead+=l,c.lookahead+c.insert>=Xs)for(D=c.strstart-c.insert,c.ins_h=c.window[D],c.ins_h=Kp(c,c.ins_h,c.window[D+1]);c.insert&&(c.ins_h=Kp(c,c.ins_h,c.window[D+Xs-1]),c.prev[D&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=D,D++,c.insert--,!(c.lookahead+c.insert<Xs)););}while(c.lookahead<Zh&&c.strm.avail_in!==0)},A3=(c,p)=>{let l=c.pending_buf_size-5>c.w_size?c.w_size:c.pending_buf_size-5,E,D,N,B=0,n=c.strm.avail_in;do{if(E=65535,N=c.bi_valid+42>>3,c.strm.avail_out<N||(N=c.strm.avail_out-N,D=c.strstart-c.block_start,E>D+c.strm.avail_in&&(E=D+c.strm.avail_in),E>N&&(E=N),E<l&&(E===0&&p!==au||p===Yp||E!==D+c.strm.avail_in)))break;B=p===au&&E===D+c.strm.avail_in?1:0,nw(c,0,0,B),c.pending_buf[c.pending-4]=E,c.pending_buf[c.pending-3]=E>>8,c.pending_buf[c.pending-2]=~E,c.pending_buf[c.pending-1]=~E>>8,bc(c.strm),D&&(D>E&&(D=E),c.strm.output.set(c.window.subarray(c.block_start,c.block_start+D),c.strm.next_out),c.strm.next_out+=D,c.strm.avail_out-=D,c.strm.total_out+=D,c.block_start+=D,E-=D),E&&(cw(c.strm,c.strm.output,c.strm.next_out,E),c.strm.next_out+=E,c.strm.avail_out-=E,c.strm.total_out+=E)}while(B===0);return n-=c.strm.avail_in,n&&(n>=c.w_size?(c.matches=2,c.window.set(c.strm.input.subarray(c.strm.next_in-c.w_size,c.strm.next_in),0),c.strstart=c.w_size,c.insert=c.strstart):(c.window_size-c.strstart<=n&&(c.strstart-=c.w_size,c.window.set(c.window.subarray(c.w_size,c.w_size+c.strstart),0),c.matches<2&&c.matches++,c.insert>c.strstart&&(c.insert=c.strstart)),c.window.set(c.strm.input.subarray(c.strm.next_in-n,c.strm.next_in),c.strstart),c.strstart+=n,c.insert+=n>c.w_size-c.insert?c.w_size-c.insert:n),c.block_start=c.strstart),c.high_water<c.strstart&&(c.high_water=c.strstart),B?l_:p!==Yp&&p!==au&&c.strm.avail_in===0&&c.strstart===c.block_start?a_:(N=c.window_size-c.strstart,c.strm.avail_in>N&&c.block_start>=c.w_size&&(c.block_start-=c.w_size,c.strstart-=c.w_size,c.window.set(c.window.subarray(c.w_size,c.w_size+c.strstart),0),c.matches<2&&c.matches++,N+=c.w_size,c.insert>c.strstart&&(c.insert=c.strstart)),N>c.strm.avail_in&&(N=c.strm.avail_in),N&&(cw(c.strm,c.window,c.strstart,N),c.strstart+=N,c.insert+=N>c.w_size-c.insert?c.w_size-c.insert:N),c.high_water<c.strstart&&(c.high_water=c.strstart),N=c.bi_valid+42>>3,N=c.pending_buf_size-N>65535?65535:c.pending_buf_size-N,l=N>c.w_size?c.w_size:N,D=c.strstart-c.block_start,(D>=l||(D||p===au)&&p!==Yp&&c.strm.avail_in===0&&D<=N)&&(E=D>N?N:D,B=p===au&&c.strm.avail_in===0&&E===D?1:0,nw(c,c.block_start,E,B),c.block_start+=E,bc(c.strm)),B?Cm:Nl)},F1=(c,p)=>{let l,E;for(;;){if(c.lookahead<Zh){if(Yg(c),c.lookahead<Zh&&p===Yp)return Nl;if(c.lookahead===0)break}if(l=0,c.lookahead>=Xs&&(c.ins_h=Kp(c,c.ins_h,c.window[c.strstart+Xs-1]),l=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),l!==0&&c.strstart-l<=c.w_size-Zh&&(c.match_length=E3(c,l)),c.match_length>=Xs)if(E=Xp(c,c.strstart-c.match_start,c.match_length-Xs),c.lookahead-=c.match_length,c.match_length<=c.max_lazy_match&&c.lookahead>=Xs){c.match_length--;do c.strstart++,c.ins_h=Kp(c,c.ins_h,c.window[c.strstart+Xs-1]),l=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart;while(--c.match_length!==0);c.strstart++}else c.strstart+=c.match_length,c.match_length=0,c.ins_h=c.window[c.strstart],c.ins_h=Kp(c,c.ins_h,c.window[c.strstart+1]);else E=Xp(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++;if(E&&(Sc(c,!1),c.strm.avail_out===0))return Nl}return c.insert=c.strstart<Xs-1?c.strstart:Xs-1,p===au?(Sc(c,!0),c.strm.avail_out===0?Cm:l_):c.sym_next&&(Sc(c,!1),c.strm.avail_out===0)?Nl:a_},Cg=(c,p)=>{let l,E,D;for(;;){if(c.lookahead<Zh){if(Yg(c),c.lookahead<Zh&&p===Yp)return Nl;if(c.lookahead===0)break}if(l=0,c.lookahead>=Xs&&(c.ins_h=Kp(c,c.ins_h,c.window[c.strstart+Xs-1]),l=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),c.prev_length=c.match_length,c.prev_match=c.match_start,c.match_length=Xs-1,l!==0&&c.prev_length<c.max_lazy_match&&c.strstart-l<=c.w_size-Zh&&(c.match_length=E3(c,l),c.match_length<=5&&(c.strategy===dO||c.match_length===Xs&&c.strstart-c.match_start>4096)&&(c.match_length=Xs-1)),c.prev_length>=Xs&&c.match_length<=c.prev_length){D=c.strstart+c.lookahead-Xs,E=Xp(c,c.strstart-1-c.prev_match,c.prev_length-Xs),c.lookahead-=c.prev_length-1,c.prev_length-=2;do++c.strstart<=D&&(c.ins_h=Kp(c,c.ins_h,c.window[c.strstart+Xs-1]),l=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart);while(--c.prev_length!==0);if(c.match_available=0,c.match_length=Xs-1,c.strstart++,E&&(Sc(c,!1),c.strm.avail_out===0))return Nl}else if(c.match_available){if(E=Xp(c,0,c.window[c.strstart-1]),E&&Sc(c,!1),c.strstart++,c.lookahead--,c.strm.avail_out===0)return Nl}else c.match_available=1,c.strstart++,c.lookahead--}return c.match_available&&(E=Xp(c,0,c.window[c.strstart-1]),c.match_available=0),c.insert=c.strstart<Xs-1?c.strstart:Xs-1,p===au?(Sc(c,!0),c.strm.avail_out===0?Cm:l_):c.sym_next&&(Sc(c,!1),c.strm.avail_out===0)?Nl:a_},IO=(c,p)=>{let l,E,D,N;const B=c.window;for(;;){if(c.lookahead<=Zp){if(Yg(c),c.lookahead<=Zp&&p===Yp)return Nl;if(c.lookahead===0)break}if(c.match_length=0,c.lookahead>=Xs&&c.strstart>0&&(D=c.strstart-1,E=B[D],E===B[++D]&&E===B[++D]&&E===B[++D])){N=c.strstart+Zp;do;while(E===B[++D]&&E===B[++D]&&E===B[++D]&&E===B[++D]&&E===B[++D]&&E===B[++D]&&E===B[++D]&&E===B[++D]&&D<N);c.match_length=Zp-(N-D),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=Xs?(l=Xp(c,1,c.match_length-Xs),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(l=Xp(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),l&&(Sc(c,!1),c.strm.avail_out===0))return Nl}return c.insert=0,p===au?(Sc(c,!0),c.strm.avail_out===0?Cm:l_):c.sym_next&&(Sc(c,!1),c.strm.avail_out===0)?Nl:a_},RO=(c,p)=>{let l;for(;;){if(c.lookahead===0&&(Yg(c),c.lookahead===0)){if(p===Yp)return Nl;break}if(c.match_length=0,l=Xp(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,l&&(Sc(c,!1),c.strm.avail_out===0))return Nl}return c.insert=0,p===au?(Sc(c,!0),c.strm.avail_out===0?Cm:l_):c.sym_next&&(Sc(c,!1),c.strm.avail_out===0)?Nl:a_};function Uh(c,p,l,E,D){this.good_length=c,this.max_lazy=p,this.nice_length=l,this.max_chain=E,this.func=D}const E0=[new Uh(0,0,0,0,A3),new Uh(4,4,8,4,F1),new Uh(4,5,16,8,F1),new Uh(4,6,32,32,F1),new Uh(4,4,16,16,Cg),new Uh(8,16,32,32,Cg),new Uh(8,16,128,128,Cg),new Uh(8,32,128,256,Cg),new Uh(32,128,258,1024,Cg),new Uh(32,258,258,4096,Cg)],PO=c=>{c.window_size=2*c.w_size,$p(c.head),c.max_lazy_match=E0[c.level].max_lazy,c.good_match=E0[c.level].good_length,c.nice_match=E0[c.level].nice_length,c.max_chain_length=E0[c.level].max_chain,c.strstart=0,c.block_start=0,c.lookahead=0,c.insert=0,c.match_length=c.prev_length=Xs-1,c.match_available=0,c.ins_h=0};function DO(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=cx,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(MO*2),this.dyn_dtree=new Uint16Array((2*wO+1)*2),this.bl_tree=new Uint16Array((2*TO+1)*2),$p(this.dyn_ltree),$p(this.dyn_dtree),$p(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(SO+1),this.heap=new Uint16Array(2*rw+1),$p(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*rw+1),$p(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ny=c=>{if(!c)return 1;const p=c.state;return!p||p.strm!==c||p.status!==Xg&&p.status!==Hw&&p.status!==sw&&p.status!==ow&&p.status!==aw&&p.status!==lw&&p.status!==ym&&p.status!==S0?1:0},C3=c=>{if(ny(c))return vm(c,$h);c.total_in=c.total_out=0,c.data_type=gO;const p=c.state;return p.pending=0,p.pending_out=0,p.wrap<0&&(p.wrap=-p.wrap),p.status=p.wrap===2?Hw:p.wrap?Xg:ym,c.adler=p.wrap===2?0:1,p.last_flush=-2,sO(p),tl},L3=c=>{const p=C3(c);return p===tl&&PO(c.state),p},OO=(c,p)=>ny(c)||c.state.wrap!==2?$h:(c.state.gzhead=p,tl),I3=(c,p,l,E,D,N)=>{if(!c)return $h;let B=1;if(p===hO&&(p=6),E<0?(B=0,E=-E):E>15&&(B=2,E-=16),D<1||D>_O||l!==cx||E<8||E>15||p<0||p>9||N<0||N>fO||E===8&&B!==1)return vm(c,$h);E===8&&(E=9);const n=new DO;return c.state=n,n.strm=c,n.status=Xg,n.wrap=B,n.gzhead=null,n.w_bits=E,n.w_size=1<<n.w_bits,n.w_mask=n.w_size-1,n.hash_bits=D+7,n.hash_size=1<<n.hash_bits,n.hash_mask=n.hash_size-1,n.hash_shift=~~((n.hash_bits+Xs-1)/Xs),n.window=new Uint8Array(n.w_size*2),n.head=new Uint16Array(n.hash_size),n.prev=new Uint16Array(n.w_size),n.lit_bufsize=1<<D+6,n.pending_buf_size=n.lit_bufsize*4,n.pending_buf=new Uint8Array(n.pending_buf_size),n.sym_buf=n.lit_bufsize,n.sym_end=(n.lit_bufsize-1)*3,n.level=p,n.strategy=N,n.method=l,L3(c)},zO=(c,p)=>I3(c,p,cx,yO,vO,mO),kO=(c,p)=>{if(ny(c)||p>iS||p<0)return c?vm(c,$h):$h;const l=c.state;if(!c.output||c.avail_in!==0&&!c.input||l.status===S0&&p!==au)return vm(c,c.avail_out===0?k1:$h);const E=l.last_flush;if(l.last_flush=p,l.pending!==0){if(bc(c),c.avail_out===0)return l.last_flush=-1,tl}else if(c.avail_in===0&&rS(p)<=rS(E)&&p!==au)return vm(c,k1);if(l.status===S0&&c.avail_in!==0)return vm(c,k1);if(l.status===Xg&&l.wrap===0&&(l.status=ym),l.status===Xg){let D=cx+(l.w_bits-8<<4)<<8,N=-1;if(l.strategy>=hv||l.level<2?N=0:l.level<6?N=1:l.level===6?N=2:N=3,D|=N<<6,l.strstart!==0&&(D|=EO),D+=31-D%31,b0(l,D),l.strstart!==0&&(b0(l,c.adler>>>16),b0(l,c.adler&65535)),c.adler=1,l.status=ym,bc(c),l.pending!==0)return l.last_flush=-1,tl}if(l.status===Hw){if(c.adler=0,ao(l,31),ao(l,139),ao(l,8),l.gzhead)ao(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),ao(l,l.gzhead.time&255),ao(l,l.gzhead.time>>8&255),ao(l,l.gzhead.time>>16&255),ao(l,l.gzhead.time>>24&255),ao(l,l.level===9?2:l.strategy>=hv||l.level<2?4:0),ao(l,l.gzhead.os&255),l.gzhead.extra&&l.gzhead.extra.length&&(ao(l,l.gzhead.extra.length&255),ao(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(c.adler=Ba(c.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=sw;else if(ao(l,0),ao(l,0),ao(l,0),ao(l,0),ao(l,0),ao(l,l.level===9?2:l.strategy>=hv||l.level<2?4:0),ao(l,AO),l.status=ym,bc(c),l.pending!==0)return l.last_flush=-1,tl}if(l.status===sw){if(l.gzhead.extra){let D=l.pending,N=(l.gzhead.extra.length&65535)-l.gzindex;for(;l.pending+N>l.pending_buf_size;){let n=l.pending_buf_size-l.pending;if(l.pending_buf.set(l.gzhead.extra.subarray(l.gzindex,l.gzindex+n),l.pending),l.pending=l.pending_buf_size,l.gzhead.hcrc&&l.pending>D&&(c.adler=Ba(c.adler,l.pending_buf,l.pending-D,D)),l.gzindex+=n,bc(c),l.pending!==0)return l.last_flush=-1,tl;D=0,N-=n}let B=new Uint8Array(l.gzhead.extra);l.pending_buf.set(B.subarray(l.gzindex,l.gzindex+N),l.pending),l.pending+=N,l.gzhead.hcrc&&l.pending>D&&(c.adler=Ba(c.adler,l.pending_buf,l.pending-D,D)),l.gzindex=0}l.status=ow}if(l.status===ow){if(l.gzhead.name){let D=l.pending,N;do{if(l.pending===l.pending_buf_size){if(l.gzhead.hcrc&&l.pending>D&&(c.adler=Ba(c.adler,l.pending_buf,l.pending-D,D)),bc(c),l.pending!==0)return l.last_flush=-1,tl;D=0}l.gzindex<l.gzhead.name.length?N=l.gzhead.name.charCodeAt(l.gzindex++)&255:N=0,ao(l,N)}while(N!==0);l.gzhead.hcrc&&l.pending>D&&(c.adler=Ba(c.adler,l.pending_buf,l.pending-D,D)),l.gzindex=0}l.status=aw}if(l.status===aw){if(l.gzhead.comment){let D=l.pending,N;do{if(l.pending===l.pending_buf_size){if(l.gzhead.hcrc&&l.pending>D&&(c.adler=Ba(c.adler,l.pending_buf,l.pending-D,D)),bc(c),l.pending!==0)return l.last_flush=-1,tl;D=0}l.gzindex<l.gzhead.comment.length?N=l.gzhead.comment.charCodeAt(l.gzindex++)&255:N=0,ao(l,N)}while(N!==0);l.gzhead.hcrc&&l.pending>D&&(c.adler=Ba(c.adler,l.pending_buf,l.pending-D,D))}l.status=lw}if(l.status===lw){if(l.gzhead.hcrc){if(l.pending+2>l.pending_buf_size&&(bc(c),l.pending!==0))return l.last_flush=-1,tl;ao(l,c.adler&255),ao(l,c.adler>>8&255),c.adler=0}if(l.status=ym,bc(c),l.pending!==0)return l.last_flush=-1,tl}if(c.avail_in!==0||l.lookahead!==0||p!==Yp&&l.status!==S0){let D=l.level===0?A3(l,p):l.strategy===hv?RO(l,p):l.strategy===pO?IO(l,p):E0[l.level].func(l,p);if((D===Cm||D===l_)&&(l.status=S0),D===Nl||D===Cm)return c.avail_out===0&&(l.last_flush=-1),tl;if(D===a_&&(p===lO?aO(l):p!==iS&&(nw(l,0,0,!1),p===cO&&($p(l.head),l.lookahead===0&&(l.strstart=0,l.block_start=0,l.insert=0))),bc(c),c.avail_out===0))return l.last_flush=-1,tl}return p!==au?tl:l.wrap<=0?nS:(l.wrap===2?(ao(l,c.adler&255),ao(l,c.adler>>8&255),ao(l,c.adler>>16&255),ao(l,c.adler>>24&255),ao(l,c.total_in&255),ao(l,c.total_in>>8&255),ao(l,c.total_in>>16&255),ao(l,c.total_in>>24&255)):(b0(l,c.adler>>>16),b0(l,c.adler&65535)),bc(c),l.wrap>0&&(l.wrap=-l.wrap),l.pending!==0?tl:nS)},FO=c=>{if(ny(c))return $h;const p=c.state.status;return c.state=null,p===ym?vm(c,uO):tl},BO=(c,p)=>{let l=p.length;if(ny(c))return $h;const E=c.state,D=E.wrap;if(D===2||D===1&&E.status!==Xg||E.lookahead)return $h;if(D===1&&(c.adler=Z0(c.adler,p,l,0)),E.wrap=0,l>=E.w_size){D===0&&($p(E.head),E.strstart=0,E.block_start=0,E.insert=0);let X=new Uint8Array(E.w_size);X.set(p.subarray(l-E.w_size,l),0),p=X,l=E.w_size}const N=c.avail_in,B=c.next_in,n=c.input;for(c.avail_in=l,c.next_in=0,c.input=p,Yg(E);E.lookahead>=Xs;){let X=E.strstart,$=E.lookahead-(Xs-1);do E.ins_h=Kp(E,E.ins_h,E.window[X+Xs-1]),E.prev[X&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=X,X++;while(--$);E.strstart=X,E.lookahead=Xs-1,Yg(E)}return E.strstart+=E.lookahead,E.block_start=E.strstart,E.insert=E.lookahead,E.lookahead=0,E.match_length=E.prev_length=Xs-1,E.match_available=0,c.next_in=B,c.input=n,c.avail_in=N,E.wrap=D,tl};var NO=zO,UO=I3,VO=L3,GO=C3,HO=OO,jO=kO,WO=FO,qO=BO,$O="pako deflate (from Nodeca project)",z0={deflateInit:NO,deflateInit2:UO,deflateReset:VO,deflateResetKeep:GO,deflateSetHeader:HO,deflate:jO,deflateEnd:WO,deflateSetDictionary:qO,deflateInfo:$O};const ZO=(c,p)=>Object.prototype.hasOwnProperty.call(c,p);var XO=function(c){const p=Array.prototype.slice.call(arguments,1);for(;p.length;){const l=p.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(const E in l)ZO(l,E)&&(c[E]=l[E])}}return c},YO=c=>{let p=0;for(let E=0,D=c.length;E<D;E++)p+=c[E].length;const l=new Uint8Array(p);for(let E=0,D=0,N=c.length;E<N;E++){let B=c[E];l.set(B,D),D+=B.length}return l},ux={assign:XO,flattenChunks:YO};let R3=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{R3=!1}const X0=new Uint8Array(256);for(let c=0;c<256;c++)X0[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;X0[254]=X0[254]=1;var KO=c=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(c);let p,l,E,D,N,B=c.length,n=0;for(D=0;D<B;D++)l=c.charCodeAt(D),(l&64512)===55296&&D+1<B&&(E=c.charCodeAt(D+1),(E&64512)===56320&&(l=65536+(l-55296<<10)+(E-56320),D++)),n+=l<128?1:l<2048?2:l<65536?3:4;for(p=new Uint8Array(n),N=0,D=0;N<n;D++)l=c.charCodeAt(D),(l&64512)===55296&&D+1<B&&(E=c.charCodeAt(D+1),(E&64512)===56320&&(l=65536+(l-55296<<10)+(E-56320),D++)),l<128?p[N++]=l:l<2048?(p[N++]=192|l>>>6,p[N++]=128|l&63):l<65536?(p[N++]=224|l>>>12,p[N++]=128|l>>>6&63,p[N++]=128|l&63):(p[N++]=240|l>>>18,p[N++]=128|l>>>12&63,p[N++]=128|l>>>6&63,p[N++]=128|l&63);return p};const JO=(c,p)=>{if(p<65534&&c.subarray&&R3)return String.fromCharCode.apply(null,c.length===p?c:c.subarray(0,p));let l="";for(let E=0;E<p;E++)l+=String.fromCharCode(c[E]);return l};var QO=(c,p)=>{const l=p||c.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(c.subarray(0,p));let E,D;const N=new Array(l*2);for(D=0,E=0;E<l;){let B=c[E++];if(B<128){N[D++]=B;continue}let n=X0[B];if(n>4){N[D++]=65533,E+=n-1;continue}for(B&=n===2?31:n===3?15:7;n>1&&E<l;)B=B<<6|c[E++]&63,n--;if(n>1){N[D++]=65533;continue}B<65536?N[D++]=B:(B-=65536,N[D++]=55296|B>>10&1023,N[D++]=56320|B&1023)}return JO(N,D)},ez=(c,p)=>{p=p||c.length,p>c.length&&(p=c.length);let l=p-1;for(;l>=0&&(c[l]&192)===128;)l--;return l<0||l===0?p:l+X0[c[l]]>p?l:p},Y0={string2buf:KO,buf2string:QO,utf8border:ez};function tz(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var P3=tz;const D3=Object.prototype.toString,{Z_NO_FLUSH:iz,Z_SYNC_FLUSH:nz,Z_FULL_FLUSH:rz,Z_FINISH:sz,Z_OK:Wv,Z_STREAM_END:oz,Z_DEFAULT_COMPRESSION:az,Z_DEFAULT_STRATEGY:lz,Z_DEFLATED:cz}=Dm;function ry(c){this.options=ux.assign({level:az,method:cz,chunkSize:16384,windowBits:15,memLevel:8,strategy:lz},c||{});let p=this.options;p.raw&&p.windowBits>0?p.windowBits=-p.windowBits:p.gzip&&p.windowBits>0&&p.windowBits<16&&(p.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new P3,this.strm.avail_out=0;let l=z0.deflateInit2(this.strm,p.level,p.method,p.windowBits,p.memLevel,p.strategy);if(l!==Wv)throw new Error(Am[l]);if(p.header&&z0.deflateSetHeader(this.strm,p.header),p.dictionary){let E;if(typeof p.dictionary=="string"?E=Y0.string2buf(p.dictionary):D3.call(p.dictionary)==="[object ArrayBuffer]"?E=new Uint8Array(p.dictionary):E=p.dictionary,l=z0.deflateSetDictionary(this.strm,E),l!==Wv)throw new Error(Am[l]);this._dict_set=!0}}ry.prototype.push=function(c,p){const l=this.strm,E=this.options.chunkSize;let D,N;if(this.ended)return!1;for(p===~~p?N=p:N=p===!0?sz:iz,typeof c=="string"?l.input=Y0.string2buf(c):D3.call(c)==="[object ArrayBuffer]"?l.input=new Uint8Array(c):l.input=c,l.next_in=0,l.avail_in=l.input.length;;){if(l.avail_out===0&&(l.output=new Uint8Array(E),l.next_out=0,l.avail_out=E),(N===nz||N===rz)&&l.avail_out<=6){this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;continue}if(D=z0.deflate(l,N),D===oz)return l.next_out>0&&this.onData(l.output.subarray(0,l.next_out)),D=z0.deflateEnd(this.strm),this.onEnd(D),this.ended=!0,D===Wv;if(l.avail_out===0){this.onData(l.output);continue}if(N>0&&l.next_out>0){this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;continue}if(l.avail_in===0)break}return!0};ry.prototype.onData=function(c){this.chunks.push(c)};ry.prototype.onEnd=function(c){c===Wv&&(this.result=ux.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg};function jw(c,p){const l=new ry(p);if(l.push(c,!0),l.err)throw l.msg||Am[l.err];return l.result}function uz(c,p){return p=p||{},p.raw=!0,jw(c,p)}function hz(c,p){return p=p||{},p.gzip=!0,jw(c,p)}var dz=ry,pz=jw,fz=uz,mz=hz,gz=Dm,_z={Deflate:dz,deflate:pz,deflateRaw:fz,gzip:mz,constants:gz};const dv=16209,yz=16191;var vz=function(p,l){let E,D,N,B,n,X,$,ne,ve,ze,ke,yt,it,xt,Ze,st,ti,mt,pt,Tt,Fe,et,Xe,qe;const gt=p.state;E=p.next_in,Xe=p.input,D=E+(p.avail_in-5),N=p.next_out,qe=p.output,B=N-(l-p.avail_out),n=N+(p.avail_out-257),X=gt.dmax,$=gt.wsize,ne=gt.whave,ve=gt.wnext,ze=gt.window,ke=gt.hold,yt=gt.bits,it=gt.lencode,xt=gt.distcode,Ze=(1<<gt.lenbits)-1,st=(1<<gt.distbits)-1;e:do{yt<15&&(ke+=Xe[E++]<<yt,yt+=8,ke+=Xe[E++]<<yt,yt+=8),ti=it[ke&Ze];t:for(;;){if(mt=ti>>>24,ke>>>=mt,yt-=mt,mt=ti>>>16&255,mt===0)qe[N++]=ti&65535;else if(mt&16){pt=ti&65535,mt&=15,mt&&(yt<mt&&(ke+=Xe[E++]<<yt,yt+=8),pt+=ke&(1<<mt)-1,ke>>>=mt,yt-=mt),yt<15&&(ke+=Xe[E++]<<yt,yt+=8,ke+=Xe[E++]<<yt,yt+=8),ti=xt[ke&st];i:for(;;){if(mt=ti>>>24,ke>>>=mt,yt-=mt,mt=ti>>>16&255,mt&16){if(Tt=ti&65535,mt&=15,yt<mt&&(ke+=Xe[E++]<<yt,yt+=8,yt<mt&&(ke+=Xe[E++]<<yt,yt+=8)),Tt+=ke&(1<<mt)-1,Tt>X){p.msg="invalid distance too far back",gt.mode=dv;break e}if(ke>>>=mt,yt-=mt,mt=N-B,Tt>mt){if(mt=Tt-mt,mt>ne&&gt.sane){p.msg="invalid distance too far back",gt.mode=dv;break e}if(Fe=0,et=ze,ve===0){if(Fe+=$-mt,mt<pt){pt-=mt;do qe[N++]=ze[Fe++];while(--mt);Fe=N-Tt,et=qe}}else if(ve<mt){if(Fe+=$+ve-mt,mt-=ve,mt<pt){pt-=mt;do qe[N++]=ze[Fe++];while(--mt);if(Fe=0,ve<pt){mt=ve,pt-=mt;do qe[N++]=ze[Fe++];while(--mt);Fe=N-Tt,et=qe}}}else if(Fe+=ve-mt,mt<pt){pt-=mt;do qe[N++]=ze[Fe++];while(--mt);Fe=N-Tt,et=qe}for(;pt>2;)qe[N++]=et[Fe++],qe[N++]=et[Fe++],qe[N++]=et[Fe++],pt-=3;pt&&(qe[N++]=et[Fe++],pt>1&&(qe[N++]=et[Fe++]))}else{Fe=N-Tt;do qe[N++]=qe[Fe++],qe[N++]=qe[Fe++],qe[N++]=qe[Fe++],pt-=3;while(pt>2);pt&&(qe[N++]=qe[Fe++],pt>1&&(qe[N++]=qe[Fe++]))}}else if(mt&64){p.msg="invalid distance code",gt.mode=dv;break e}else{ti=xt[(ti&65535)+(ke&(1<<mt)-1)];continue i}break}}else if(mt&64)if(mt&32){gt.mode=yz;break e}else{p.msg="invalid literal/length code",gt.mode=dv;break e}else{ti=it[(ti&65535)+(ke&(1<<mt)-1)];continue t}break}}while(E<D&&N<n);pt=yt>>3,E-=pt,yt-=pt<<3,ke&=(1<<yt)-1,p.next_in=E,p.next_out=N,p.avail_in=E<D?5+(D-E):5-(E-D),p.avail_out=N<n?257+(n-N):257-(N-n),gt.hold=ke,gt.bits=yt};const Lg=15,sS=852,oS=592,aS=0,B1=1,lS=2,xz=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),bz=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),wz=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Tz=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Mz=(c,p,l,E,D,N,B,n)=>{const X=n.bits;let $=0,ne=0,ve=0,ze=0,ke=0,yt=0,it=0,xt=0,Ze=0,st=0,ti,mt,pt,Tt,Fe,et=null,Xe;const qe=new Uint16Array(Lg+1),gt=new Uint16Array(Lg+1);let lt=null,vt,Jt,le;for($=0;$<=Lg;$++)qe[$]=0;for(ne=0;ne<E;ne++)qe[p[l+ne]]++;for(ke=X,ze=Lg;ze>=1&&qe[ze]===0;ze--);if(ke>ze&&(ke=ze),ze===0)return D[N++]=1<<24|64<<16|0,D[N++]=1<<24|64<<16|0,n.bits=1,0;for(ve=1;ve<ze&&qe[ve]===0;ve++);for(ke<ve&&(ke=ve),xt=1,$=1;$<=Lg;$++)if(xt<<=1,xt-=qe[$],xt<0)return-1;if(xt>0&&(c===aS||ze!==1))return-1;for(gt[1]=0,$=1;$<Lg;$++)gt[$+1]=gt[$]+qe[$];for(ne=0;ne<E;ne++)p[l+ne]!==0&&(B[gt[p[l+ne]]++]=ne);if(c===aS?(et=lt=B,Xe=20):c===B1?(et=xz,lt=bz,Xe=257):(et=wz,lt=Tz,Xe=0),st=0,ne=0,$=ve,Fe=N,yt=ke,it=0,pt=-1,Ze=1<<ke,Tt=Ze-1,c===B1&&Ze>sS||c===lS&&Ze>oS)return 1;for(;;){vt=$-it,B[ne]+1<Xe?(Jt=0,le=B[ne]):B[ne]>=Xe?(Jt=lt[B[ne]-Xe],le=et[B[ne]-Xe]):(Jt=96,le=0),ti=1<<$-it,mt=1<<yt,ve=mt;do mt-=ti,D[Fe+(st>>it)+mt]=vt<<24|Jt<<16|le|0;while(mt!==0);for(ti=1<<$-1;st&ti;)ti>>=1;if(ti!==0?(st&=ti-1,st+=ti):st=0,ne++,--qe[$]===0){if($===ze)break;$=p[l+B[ne]]}if($>ke&&(st&Tt)!==pt){for(it===0&&(it=ke),Fe+=ve,yt=$-it,xt=1<<yt;yt+it<ze&&(xt-=qe[yt+it],!(xt<=0));)yt++,xt<<=1;if(Ze+=1<<yt,c===B1&&Ze>sS||c===lS&&Ze>oS)return 1;pt=st&Tt,D[pt]=ke<<24|yt<<16|Fe-N|0}}return st!==0&&(D[Fe+st]=$-it<<24|64<<16|0),n.bits=ke,0};var k0=Mz;const Sz=0,O3=1,z3=2,{Z_FINISH:cS,Z_BLOCK:Ez,Z_TREES:pv,Z_OK:Lm,Z_STREAM_END:Az,Z_NEED_DICT:Cz,Z_STREAM_ERROR:uu,Z_DATA_ERROR:k3,Z_MEM_ERROR:F3,Z_BUF_ERROR:Lz,Z_DEFLATED:uS}=Dm,hx=16180,hS=16181,dS=16182,pS=16183,fS=16184,mS=16185,gS=16186,_S=16187,yS=16188,vS=16189,qv=16190,Dd=16191,N1=16192,xS=16193,U1=16194,bS=16195,wS=16196,TS=16197,MS=16198,fv=16199,mv=16200,SS=16201,ES=16202,AS=16203,CS=16204,LS=16205,V1=16206,IS=16207,RS=16208,Uo=16209,B3=16210,N3=16211,Iz=852,Rz=592,Pz=15,Dz=Pz,PS=c=>(c>>>24&255)+(c>>>8&65280)+((c&65280)<<8)+((c&255)<<24);function Oz(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Om=c=>{if(!c)return 1;const p=c.state;return!p||p.strm!==c||p.mode<hx||p.mode>N3?1:0},U3=c=>{if(Om(c))return uu;const p=c.state;return c.total_in=c.total_out=p.total=0,c.msg="",p.wrap&&(c.adler=p.wrap&1),p.mode=hx,p.last=0,p.havedict=0,p.flags=-1,p.dmax=32768,p.head=null,p.hold=0,p.bits=0,p.lencode=p.lendyn=new Int32Array(Iz),p.distcode=p.distdyn=new Int32Array(Rz),p.sane=1,p.back=-1,Lm},V3=c=>{if(Om(c))return uu;const p=c.state;return p.wsize=0,p.whave=0,p.wnext=0,U3(c)},G3=(c,p)=>{let l;if(Om(c))return uu;const E=c.state;return p<0?(l=0,p=-p):(l=(p>>4)+5,p<48&&(p&=15)),p&&(p<8||p>15)?uu:(E.window!==null&&E.wbits!==p&&(E.window=null),E.wrap=l,E.wbits=p,V3(c))},H3=(c,p)=>{if(!c)return uu;const l=new Oz;c.state=l,l.strm=c,l.window=null,l.mode=hx;const E=G3(c,p);return E!==Lm&&(c.state=null),E},zz=c=>H3(c,Dz);let DS=!0,G1,H1;const kz=c=>{if(DS){G1=new Int32Array(512),H1=new Int32Array(32);let p=0;for(;p<144;)c.lens[p++]=8;for(;p<256;)c.lens[p++]=9;for(;p<280;)c.lens[p++]=7;for(;p<288;)c.lens[p++]=8;for(k0(O3,c.lens,0,288,G1,0,c.work,{bits:9}),p=0;p<32;)c.lens[p++]=5;k0(z3,c.lens,0,32,H1,0,c.work,{bits:5}),DS=!1}c.lencode=G1,c.lenbits=9,c.distcode=H1,c.distbits=5},j3=(c,p,l,E)=>{let D;const N=c.state;return N.window===null&&(N.wsize=1<<N.wbits,N.wnext=0,N.whave=0,N.window=new Uint8Array(N.wsize)),E>=N.wsize?(N.window.set(p.subarray(l-N.wsize,l),0),N.wnext=0,N.whave=N.wsize):(D=N.wsize-N.wnext,D>E&&(D=E),N.window.set(p.subarray(l-E,l-E+D),N.wnext),E-=D,E?(N.window.set(p.subarray(l-E,l),0),N.wnext=E,N.whave=N.wsize):(N.wnext+=D,N.wnext===N.wsize&&(N.wnext=0),N.whave<N.wsize&&(N.whave+=D))),0},Fz=(c,p)=>{let l,E,D,N,B,n,X,$,ne,ve,ze,ke,yt,it,xt=0,Ze,st,ti,mt,pt,Tt,Fe,et;const Xe=new Uint8Array(4);let qe,gt;const lt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Om(c)||!c.output||!c.input&&c.avail_in!==0)return uu;l=c.state,l.mode===Dd&&(l.mode=N1),B=c.next_out,D=c.output,X=c.avail_out,N=c.next_in,E=c.input,n=c.avail_in,$=l.hold,ne=l.bits,ve=n,ze=X,et=Lm;e:for(;;)switch(l.mode){case hx:if(l.wrap===0){l.mode=N1;break}for(;ne<16;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(l.wrap&2&&$===35615){l.wbits===0&&(l.wbits=15),l.check=0,Xe[0]=$&255,Xe[1]=$>>>8&255,l.check=Ba(l.check,Xe,2,0),$=0,ne=0,l.mode=hS;break}if(l.head&&(l.head.done=!1),!(l.wrap&1)||((($&255)<<8)+($>>8))%31){c.msg="incorrect header check",l.mode=Uo;break}if(($&15)!==uS){c.msg="unknown compression method",l.mode=Uo;break}if($>>>=4,ne-=4,Fe=($&15)+8,l.wbits===0&&(l.wbits=Fe),Fe>15||Fe>l.wbits){c.msg="invalid window size",l.mode=Uo;break}l.dmax=1<<l.wbits,l.flags=0,c.adler=l.check=1,l.mode=$&512?vS:Dd,$=0,ne=0;break;case hS:for(;ne<16;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(l.flags=$,(l.flags&255)!==uS){c.msg="unknown compression method",l.mode=Uo;break}if(l.flags&57344){c.msg="unknown header flags set",l.mode=Uo;break}l.head&&(l.head.text=$>>8&1),l.flags&512&&l.wrap&4&&(Xe[0]=$&255,Xe[1]=$>>>8&255,l.check=Ba(l.check,Xe,2,0)),$=0,ne=0,l.mode=dS;case dS:for(;ne<32;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}l.head&&(l.head.time=$),l.flags&512&&l.wrap&4&&(Xe[0]=$&255,Xe[1]=$>>>8&255,Xe[2]=$>>>16&255,Xe[3]=$>>>24&255,l.check=Ba(l.check,Xe,4,0)),$=0,ne=0,l.mode=pS;case pS:for(;ne<16;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}l.head&&(l.head.xflags=$&255,l.head.os=$>>8),l.flags&512&&l.wrap&4&&(Xe[0]=$&255,Xe[1]=$>>>8&255,l.check=Ba(l.check,Xe,2,0)),$=0,ne=0,l.mode=fS;case fS:if(l.flags&1024){for(;ne<16;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}l.length=$,l.head&&(l.head.extra_len=$),l.flags&512&&l.wrap&4&&(Xe[0]=$&255,Xe[1]=$>>>8&255,l.check=Ba(l.check,Xe,2,0)),$=0,ne=0}else l.head&&(l.head.extra=null);l.mode=mS;case mS:if(l.flags&1024&&(ke=l.length,ke>n&&(ke=n),ke&&(l.head&&(Fe=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Uint8Array(l.head.extra_len)),l.head.extra.set(E.subarray(N,N+ke),Fe)),l.flags&512&&l.wrap&4&&(l.check=Ba(l.check,E,ke,N)),n-=ke,N+=ke,l.length-=ke),l.length))break e;l.length=0,l.mode=gS;case gS:if(l.flags&2048){if(n===0)break e;ke=0;do Fe=E[N+ke++],l.head&&Fe&&l.length<65536&&(l.head.name+=String.fromCharCode(Fe));while(Fe&&ke<n);if(l.flags&512&&l.wrap&4&&(l.check=Ba(l.check,E,ke,N)),n-=ke,N+=ke,Fe)break e}else l.head&&(l.head.name=null);l.length=0,l.mode=_S;case _S:if(l.flags&4096){if(n===0)break e;ke=0;do Fe=E[N+ke++],l.head&&Fe&&l.length<65536&&(l.head.comment+=String.fromCharCode(Fe));while(Fe&&ke<n);if(l.flags&512&&l.wrap&4&&(l.check=Ba(l.check,E,ke,N)),n-=ke,N+=ke,Fe)break e}else l.head&&(l.head.comment=null);l.mode=yS;case yS:if(l.flags&512){for(;ne<16;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(l.wrap&4&&$!==(l.check&65535)){c.msg="header crc mismatch",l.mode=Uo;break}$=0,ne=0}l.head&&(l.head.hcrc=l.flags>>9&1,l.head.done=!0),c.adler=l.check=0,l.mode=Dd;break;case vS:for(;ne<32;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}c.adler=l.check=PS($),$=0,ne=0,l.mode=qv;case qv:if(l.havedict===0)return c.next_out=B,c.avail_out=X,c.next_in=N,c.avail_in=n,l.hold=$,l.bits=ne,Cz;c.adler=l.check=1,l.mode=Dd;case Dd:if(p===Ez||p===pv)break e;case N1:if(l.last){$>>>=ne&7,ne-=ne&7,l.mode=V1;break}for(;ne<3;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}switch(l.last=$&1,$>>>=1,ne-=1,$&3){case 0:l.mode=xS;break;case 1:if(kz(l),l.mode=fv,p===pv){$>>>=2,ne-=2;break e}break;case 2:l.mode=wS;break;case 3:c.msg="invalid block type",l.mode=Uo}$>>>=2,ne-=2;break;case xS:for($>>>=ne&7,ne-=ne&7;ne<32;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(($&65535)!==($>>>16^65535)){c.msg="invalid stored block lengths",l.mode=Uo;break}if(l.length=$&65535,$=0,ne=0,l.mode=U1,p===pv)break e;case U1:l.mode=bS;case bS:if(ke=l.length,ke){if(ke>n&&(ke=n),ke>X&&(ke=X),ke===0)break e;D.set(E.subarray(N,N+ke),B),n-=ke,N+=ke,X-=ke,B+=ke,l.length-=ke;break}l.mode=Dd;break;case wS:for(;ne<14;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(l.nlen=($&31)+257,$>>>=5,ne-=5,l.ndist=($&31)+1,$>>>=5,ne-=5,l.ncode=($&15)+4,$>>>=4,ne-=4,l.nlen>286||l.ndist>30){c.msg="too many length or distance symbols",l.mode=Uo;break}l.have=0,l.mode=TS;case TS:for(;l.have<l.ncode;){for(;ne<3;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}l.lens[lt[l.have++]]=$&7,$>>>=3,ne-=3}for(;l.have<19;)l.lens[lt[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,qe={bits:l.lenbits},et=k0(Sz,l.lens,0,19,l.lencode,0,l.work,qe),l.lenbits=qe.bits,et){c.msg="invalid code lengths set",l.mode=Uo;break}l.have=0,l.mode=MS;case MS:for(;l.have<l.nlen+l.ndist;){for(;xt=l.lencode[$&(1<<l.lenbits)-1],Ze=xt>>>24,st=xt>>>16&255,ti=xt&65535,!(Ze<=ne);){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(ti<16)$>>>=Ze,ne-=Ze,l.lens[l.have++]=ti;else{if(ti===16){for(gt=Ze+2;ne<gt;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if($>>>=Ze,ne-=Ze,l.have===0){c.msg="invalid bit length repeat",l.mode=Uo;break}Fe=l.lens[l.have-1],ke=3+($&3),$>>>=2,ne-=2}else if(ti===17){for(gt=Ze+3;ne<gt;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}$>>>=Ze,ne-=Ze,Fe=0,ke=3+($&7),$>>>=3,ne-=3}else{for(gt=Ze+7;ne<gt;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}$>>>=Ze,ne-=Ze,Fe=0,ke=11+($&127),$>>>=7,ne-=7}if(l.have+ke>l.nlen+l.ndist){c.msg="invalid bit length repeat",l.mode=Uo;break}for(;ke--;)l.lens[l.have++]=Fe}}if(l.mode===Uo)break;if(l.lens[256]===0){c.msg="invalid code -- missing end-of-block",l.mode=Uo;break}if(l.lenbits=9,qe={bits:l.lenbits},et=k0(O3,l.lens,0,l.nlen,l.lencode,0,l.work,qe),l.lenbits=qe.bits,et){c.msg="invalid literal/lengths set",l.mode=Uo;break}if(l.distbits=6,l.distcode=l.distdyn,qe={bits:l.distbits},et=k0(z3,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,qe),l.distbits=qe.bits,et){c.msg="invalid distances set",l.mode=Uo;break}if(l.mode=fv,p===pv)break e;case fv:l.mode=mv;case mv:if(n>=6&&X>=258){c.next_out=B,c.avail_out=X,c.next_in=N,c.avail_in=n,l.hold=$,l.bits=ne,vz(c,ze),B=c.next_out,D=c.output,X=c.avail_out,N=c.next_in,E=c.input,n=c.avail_in,$=l.hold,ne=l.bits,l.mode===Dd&&(l.back=-1);break}for(l.back=0;xt=l.lencode[$&(1<<l.lenbits)-1],Ze=xt>>>24,st=xt>>>16&255,ti=xt&65535,!(Ze<=ne);){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(st&&!(st&240)){for(mt=Ze,pt=st,Tt=ti;xt=l.lencode[Tt+(($&(1<<mt+pt)-1)>>mt)],Ze=xt>>>24,st=xt>>>16&255,ti=xt&65535,!(mt+Ze<=ne);){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}$>>>=mt,ne-=mt,l.back+=mt}if($>>>=Ze,ne-=Ze,l.back+=Ze,l.length=ti,st===0){l.mode=LS;break}if(st&32){l.back=-1,l.mode=Dd;break}if(st&64){c.msg="invalid literal/length code",l.mode=Uo;break}l.extra=st&15,l.mode=SS;case SS:if(l.extra){for(gt=l.extra;ne<gt;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}l.length+=$&(1<<l.extra)-1,$>>>=l.extra,ne-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=ES;case ES:for(;xt=l.distcode[$&(1<<l.distbits)-1],Ze=xt>>>24,st=xt>>>16&255,ti=xt&65535,!(Ze<=ne);){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(!(st&240)){for(mt=Ze,pt=st,Tt=ti;xt=l.distcode[Tt+(($&(1<<mt+pt)-1)>>mt)],Ze=xt>>>24,st=xt>>>16&255,ti=xt&65535,!(mt+Ze<=ne);){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}$>>>=mt,ne-=mt,l.back+=mt}if($>>>=Ze,ne-=Ze,l.back+=Ze,st&64){c.msg="invalid distance code",l.mode=Uo;break}l.offset=ti,l.extra=st&15,l.mode=AS;case AS:if(l.extra){for(gt=l.extra;ne<gt;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}l.offset+=$&(1<<l.extra)-1,$>>>=l.extra,ne-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){c.msg="invalid distance too far back",l.mode=Uo;break}l.mode=CS;case CS:if(X===0)break e;if(ke=ze-X,l.offset>ke){if(ke=l.offset-ke,ke>l.whave&&l.sane){c.msg="invalid distance too far back",l.mode=Uo;break}ke>l.wnext?(ke-=l.wnext,yt=l.wsize-ke):yt=l.wnext-ke,ke>l.length&&(ke=l.length),it=l.window}else it=D,yt=B-l.offset,ke=l.length;ke>X&&(ke=X),X-=ke,l.length-=ke;do D[B++]=it[yt++];while(--ke);l.length===0&&(l.mode=mv);break;case LS:if(X===0)break e;D[B++]=l.length,X--,l.mode=mv;break;case V1:if(l.wrap){for(;ne<32;){if(n===0)break e;n--,$|=E[N++]<<ne,ne+=8}if(ze-=X,c.total_out+=ze,l.total+=ze,l.wrap&4&&ze&&(c.adler=l.check=l.flags?Ba(l.check,D,ze,B-ze):Z0(l.check,D,ze,B-ze)),ze=X,l.wrap&4&&(l.flags?$:PS($))!==l.check){c.msg="incorrect data check",l.mode=Uo;break}$=0,ne=0}l.mode=IS;case IS:if(l.wrap&&l.flags){for(;ne<32;){if(n===0)break e;n--,$+=E[N++]<<ne,ne+=8}if(l.wrap&4&&$!==(l.total&4294967295)){c.msg="incorrect length check",l.mode=Uo;break}$=0,ne=0}l.mode=RS;case RS:et=Az;break e;case Uo:et=k3;break e;case B3:return F3;case N3:default:return uu}return c.next_out=B,c.avail_out=X,c.next_in=N,c.avail_in=n,l.hold=$,l.bits=ne,(l.wsize||ze!==c.avail_out&&l.mode<Uo&&(l.mode<V1||p!==cS))&&j3(c,c.output,c.next_out,ze-c.avail_out),ve-=c.avail_in,ze-=c.avail_out,c.total_in+=ve,c.total_out+=ze,l.total+=ze,l.wrap&4&&ze&&(c.adler=l.check=l.flags?Ba(l.check,D,ze,c.next_out-ze):Z0(l.check,D,ze,c.next_out-ze)),c.data_type=l.bits+(l.last?64:0)+(l.mode===Dd?128:0)+(l.mode===fv||l.mode===U1?256:0),(ve===0&&ze===0||p===cS)&&et===Lm&&(et=Lz),et},Bz=c=>{if(Om(c))return uu;let p=c.state;return p.window&&(p.window=null),c.state=null,Lm},Nz=(c,p)=>{if(Om(c))return uu;const l=c.state;return l.wrap&2?(l.head=p,p.done=!1,Lm):uu},Uz=(c,p)=>{const l=p.length;let E,D,N;return Om(c)||(E=c.state,E.wrap!==0&&E.mode!==qv)?uu:E.mode===qv&&(D=1,D=Z0(D,p,l,0),D!==E.check)?k3:(N=j3(c,p,l,l),N?(E.mode=B3,F3):(E.havedict=1,Lm))};var Vz=V3,Gz=G3,Hz=U3,jz=zz,Wz=H3,qz=Fz,$z=Bz,Zz=Nz,Xz=Uz,Yz="pako inflate (from Nodeca project)",Fd={inflateReset:Vz,inflateReset2:Gz,inflateResetKeep:Hz,inflateInit:jz,inflateInit2:Wz,inflate:qz,inflateEnd:$z,inflateGetHeader:Zz,inflateSetDictionary:Xz,inflateInfo:Yz};function Kz(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Jz=Kz;const W3=Object.prototype.toString,{Z_NO_FLUSH:Qz,Z_FINISH:ek,Z_OK:K0,Z_STREAM_END:j1,Z_NEED_DICT:W1,Z_STREAM_ERROR:tk,Z_DATA_ERROR:OS,Z_MEM_ERROR:ik}=Dm;function sy(c){this.options=ux.assign({chunkSize:1024*64,windowBits:15,to:""},c||{});const p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),p.windowBits>=0&&p.windowBits<16&&!(c&&c.windowBits)&&(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&(p.windowBits&15||(p.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new P3,this.strm.avail_out=0;let l=Fd.inflateInit2(this.strm,p.windowBits);if(l!==K0)throw new Error(Am[l]);if(this.header=new Jz,Fd.inflateGetHeader(this.strm,this.header),p.dictionary&&(typeof p.dictionary=="string"?p.dictionary=Y0.string2buf(p.dictionary):W3.call(p.dictionary)==="[object ArrayBuffer]"&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(l=Fd.inflateSetDictionary(this.strm,p.dictionary),l!==K0)))throw new Error(Am[l])}sy.prototype.push=function(c,p){const l=this.strm,E=this.options.chunkSize,D=this.options.dictionary;let N,B,n;if(this.ended)return!1;for(p===~~p?B=p:B=p===!0?ek:Qz,W3.call(c)==="[object ArrayBuffer]"?l.input=new Uint8Array(c):l.input=c,l.next_in=0,l.avail_in=l.input.length;;){for(l.avail_out===0&&(l.output=new Uint8Array(E),l.next_out=0,l.avail_out=E),N=Fd.inflate(l,B),N===W1&&D&&(N=Fd.inflateSetDictionary(l,D),N===K0?N=Fd.inflate(l,B):N===OS&&(N=W1));l.avail_in>0&&N===j1&&l.state.wrap>0&&c[l.next_in]!==0;)Fd.inflateReset(l),N=Fd.inflate(l,B);switch(N){case tk:case OS:case W1:case ik:return this.onEnd(N),this.ended=!0,!1}if(n=l.avail_out,l.next_out&&(l.avail_out===0||N===j1))if(this.options.to==="string"){let X=Y0.utf8border(l.output,l.next_out),$=l.next_out-X,ne=Y0.buf2string(l.output,X);l.next_out=$,l.avail_out=E-$,$&&l.output.set(l.output.subarray(X,X+$),0),this.onData(ne)}else this.onData(l.output.length===l.next_out?l.output:l.output.subarray(0,l.next_out));if(!(N===K0&&n===0)){if(N===j1)return N=Fd.inflateEnd(this.strm),this.onEnd(N),this.ended=!0,!0;if(l.avail_in===0)break}}return!0};sy.prototype.onData=function(c){this.chunks.push(c)};sy.prototype.onEnd=function(c){c===K0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ux.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg};function Ww(c,p){const l=new sy(p);if(l.push(c),l.err)throw l.msg||Am[l.err];return l.result}function nk(c,p){return p=p||{},p.raw=!0,Ww(c,p)}var rk=sy,sk=Ww,ok=nk,ak=Ww,lk=Dm,ck={Inflate:rk,inflate:sk,inflateRaw:ok,ungzip:ak,constants:lk};const{Deflate:uk,deflate:hk,deflateRaw:dk,gzip:pk}=_z,{Inflate:fk,inflate:mk,inflateRaw:gk,ungzip:_k}=ck;var yk=uk,vk=hk,xk=dk,bk=pk,wk=fk,Tk=mk,Mk=gk,Sk=_k,Ek=Dm,Ak={Deflate:yk,deflate:vk,deflateRaw:xk,gzip:bk,Inflate:wk,inflate:Tk,inflateRaw:Mk,ungzip:Sk,constants:Ek},q1={exports:{}},$1={exports:{}},A0={exports:{}};/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */var Ck=A0.exports,zS;function Na(){return zS||(zS=1,function(c,p){(function(l,E){E(p)})(Ck,function(l){const E="132",Lt="300 es";class It{addEventListener(e,u){this._listeners===void 0&&(this._listeners={});const y=this._listeners;y[e]===void 0&&(y[e]=[]),y[e].indexOf(u)===-1&&y[e].push(u)}hasEventListener(e,u){if(this._listeners===void 0)return!1;const y=this._listeners;return y[e]!==void 0&&y[e].indexOf(u)!==-1}removeEventListener(e,u){if(this._listeners===void 0)return;const y=this._listeners[e];if(y!==void 0){const v=y.indexOf(u);v!==-1&&y.splice(v,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const u=this._listeners[e.type];if(u!==void 0){e.target=this;const y=u.slice(0);for(let v=0,M=y.length;v<M;v++)y[v].call(this,e);e.target=null}}}const ui=[];for(let S=0;S<256;S++)ui[S]=(S<16?"0":"")+S.toString(16);let xi=1234567;const an=Math.PI/180,cn=180/Math.PI;function _n(){const S=4294967295*Math.random()|0,e=4294967295*Math.random()|0,u=4294967295*Math.random()|0,y=4294967295*Math.random()|0;return(ui[255&S]+ui[S>>8&255]+ui[S>>16&255]+ui[S>>24&255]+"-"+ui[255&e]+ui[e>>8&255]+"-"+ui[e>>16&15|64]+ui[e>>24&255]+"-"+ui[63&u|128]+ui[u>>8&255]+"-"+ui[u>>16&255]+ui[u>>24&255]+ui[255&y]+ui[y>>8&255]+ui[y>>16&255]+ui[y>>24&255]).toUpperCase()}function Fn(S,e,u){return Math.max(e,Math.min(u,S))}function Mn(S,e){return(S%e+e)%e}function jn(S,e,u){return(1-u)*S+u*e}function Lr(S){return(S&S-1)==0&&S!==0}function Tr(S){return Math.pow(2,Math.ceil(Math.log(S)/Math.LN2))}function to(S){return Math.pow(2,Math.floor(Math.log(S)/Math.LN2))}var $r=Object.freeze({__proto__:null,DEG2RAD:an,RAD2DEG:cn,generateUUID:_n,clamp:Fn,euclideanModulo:Mn,mapLinear:function(S,e,u,y,v){return y+(S-e)*(v-y)/(u-e)},inverseLerp:function(S,e,u){return S!==e?(u-S)/(e-S):0},lerp:jn,damp:function(S,e,u,y){return jn(S,e,1-Math.exp(-u*y))},pingpong:function(S,e=1){return e-Math.abs(Mn(S,2*e)-e)},smoothstep:function(S,e,u){return S<=e?0:S>=u?1:(S=(S-e)/(u-e))*S*(3-2*S)},smootherstep:function(S,e,u){return S<=e?0:S>=u?1:(S=(S-e)/(u-e))*S*S*(S*(6*S-15)+10)},randInt:function(S,e){return S+Math.floor(Math.random()*(e-S+1))},randFloat:function(S,e){return S+Math.random()*(e-S)},randFloatSpread:function(S){return S*(.5-Math.random())},seededRandom:function(S){return S!==void 0&&(xi=S%2147483647),xi=16807*xi%2147483647,(xi-1)/2147483646},degToRad:function(S){return S*an},radToDeg:function(S){return S*cn},isPowerOfTwo:Lr,ceilPowerOfTwo:Tr,floorPowerOfTwo:to,setQuaternionFromProperEuler:function(S,e,u,y,v){const M=Math.cos,O=Math.sin,V=M(u/2),G=O(u/2),H=M((e+y)/2),Q=O((e+y)/2),ee=M((e-y)/2),se=O((e-y)/2),ae=M((y-e)/2),de=O((y-e)/2);switch(v){case"XYX":S.set(V*Q,G*ee,G*se,V*H);break;case"YZY":S.set(G*se,V*Q,G*ee,V*H);break;case"ZXZ":S.set(G*ee,G*se,V*Q,V*H);break;case"XZX":S.set(V*Q,G*de,G*ae,V*H);break;case"YXY":S.set(G*ae,V*Q,G*de,V*H);break;case"ZYZ":S.set(G*de,G*ae,V*Q,V*H);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+v)}}});class en{constructor(e=0,u=0){this.x=e,this.y=u}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,u){return this.x=e,this.y=u,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,u){switch(e){case 0:this.x=u;break;case 1:this.y=u;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,u){return u!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,u)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,u){return this.x=e.x+u.x,this.y=e.y+u.y,this}addScaledVector(e,u){return this.x+=e.x*u,this.y+=e.y*u,this}sub(e,u){return u!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,u)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,u){return this.x=e.x-u.x,this.y=e.y-u.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const u=this.x,y=this.y,v=e.elements;return this.x=v[0]*u+v[3]*y+v[6],this.y=v[1]*u+v[4]*y+v[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,u){return this.x=Math.max(e.x,Math.min(u.x,this.x)),this.y=Math.max(e.y,Math.min(u.y,this.y)),this}clampScalar(e,u){return this.x=Math.max(e,Math.min(u,this.x)),this.y=Math.max(e,Math.min(u,this.y)),this}clampLength(e,u){const y=this.length();return this.divideScalar(y||1).multiplyScalar(Math.max(e,Math.min(u,y)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const u=this.x-e.x,y=this.y-e.y;return u*u+y*y}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,u){return this.x+=(e.x-this.x)*u,this.y+=(e.y-this.y)*u,this}lerpVectors(e,u,y){return this.x=e.x+(u.x-e.x)*y,this.y=e.y+(u.y-e.y)*y,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,u=0){return this.x=e[u],this.y=e[u+1],this}toArray(e=[],u=0){return e[u]=this.x,e[u+1]=this.y,e}fromBufferAttribute(e,u,y){return y!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(u),this.y=e.getY(u),this}rotateAround(e,u){const y=Math.cos(u),v=Math.sin(u),M=this.x-e.x,O=this.y-e.y;return this.x=M*y-O*v+e.x,this.y=M*v+O*y+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}en.prototype.isVector2=!0;class Wn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,u,y,v,M,O,V,G,H){const Q=this.elements;return Q[0]=e,Q[1]=v,Q[2]=V,Q[3]=u,Q[4]=M,Q[5]=G,Q[6]=y,Q[7]=O,Q[8]=H,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const u=this.elements,y=e.elements;return u[0]=y[0],u[1]=y[1],u[2]=y[2],u[3]=y[3],u[4]=y[4],u[5]=y[5],u[6]=y[6],u[7]=y[7],u[8]=y[8],this}extractBasis(e,u,y){return e.setFromMatrix3Column(this,0),u.setFromMatrix3Column(this,1),y.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const u=e.elements;return this.set(u[0],u[4],u[8],u[1],u[5],u[9],u[2],u[6],u[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,u){const y=e.elements,v=u.elements,M=this.elements,O=y[0],V=y[3],G=y[6],H=y[1],Q=y[4],ee=y[7],se=y[2],ae=y[5],de=y[8],be=v[0],Re=v[3],Te=v[6],ct=v[1],Et=v[4],_t=v[7],jt=v[2],Xt=v[5],_i=v[8];return M[0]=O*be+V*ct+G*jt,M[3]=O*Re+V*Et+G*Xt,M[6]=O*Te+V*_t+G*_i,M[1]=H*be+Q*ct+ee*jt,M[4]=H*Re+Q*Et+ee*Xt,M[7]=H*Te+Q*_t+ee*_i,M[2]=se*be+ae*ct+de*jt,M[5]=se*Re+ae*Et+de*Xt,M[8]=se*Te+ae*_t+de*_i,this}multiplyScalar(e){const u=this.elements;return u[0]*=e,u[3]*=e,u[6]*=e,u[1]*=e,u[4]*=e,u[7]*=e,u[2]*=e,u[5]*=e,u[8]*=e,this}determinant(){const e=this.elements,u=e[0],y=e[1],v=e[2],M=e[3],O=e[4],V=e[5],G=e[6],H=e[7],Q=e[8];return u*O*Q-u*V*H-y*M*Q+y*V*G+v*M*H-v*O*G}invert(){const e=this.elements,u=e[0],y=e[1],v=e[2],M=e[3],O=e[4],V=e[5],G=e[6],H=e[7],Q=e[8],ee=Q*O-V*H,se=V*G-Q*M,ae=H*M-O*G,de=u*ee+y*se+v*ae;if(de===0)return this.set(0,0,0,0,0,0,0,0,0);const be=1/de;return e[0]=ee*be,e[1]=(v*H-Q*y)*be,e[2]=(V*y-v*O)*be,e[3]=se*be,e[4]=(Q*u-v*G)*be,e[5]=(v*M-V*u)*be,e[6]=ae*be,e[7]=(y*G-H*u)*be,e[8]=(O*u-y*M)*be,this}transpose(){let e;const u=this.elements;return e=u[1],u[1]=u[3],u[3]=e,e=u[2],u[2]=u[6],u[6]=e,e=u[5],u[5]=u[7],u[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const u=this.elements;return e[0]=u[0],e[1]=u[3],e[2]=u[6],e[3]=u[1],e[4]=u[4],e[5]=u[7],e[6]=u[2],e[7]=u[5],e[8]=u[8],this}setUvTransform(e,u,y,v,M,O,V){const G=Math.cos(M),H=Math.sin(M);return this.set(y*G,y*H,-y*(G*O+H*V)+O+e,-v*H,v*G,-v*(-H*O+G*V)+V+u,0,0,1),this}scale(e,u){const y=this.elements;return y[0]*=e,y[3]*=e,y[6]*=e,y[1]*=u,y[4]*=u,y[7]*=u,this}rotate(e){const u=Math.cos(e),y=Math.sin(e),v=this.elements,M=v[0],O=v[3],V=v[6],G=v[1],H=v[4],Q=v[7];return v[0]=u*M+y*G,v[3]=u*O+y*H,v[6]=u*V+y*Q,v[1]=-y*M+u*G,v[4]=-y*O+u*H,v[7]=-y*V+u*Q,this}translate(e,u){const y=this.elements;return y[0]+=e*y[2],y[3]+=e*y[5],y[6]+=e*y[8],y[1]+=u*y[2],y[4]+=u*y[5],y[7]+=u*y[8],this}equals(e){const u=this.elements,y=e.elements;for(let v=0;v<9;v++)if(u[v]!==y[v])return!1;return!0}fromArray(e,u=0){for(let y=0;y<9;y++)this.elements[y]=e[y+u];return this}toArray(e=[],u=0){const y=this.elements;return e[u]=y[0],e[u+1]=y[1],e[u+2]=y[2],e[u+3]=y[3],e[u+4]=y[4],e[u+5]=y[5],e[u+6]=y[6],e[u+7]=y[7],e[u+8]=y[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let Ls;Wn.prototype.isMatrix3=!0;class To{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let u;if(e instanceof HTMLCanvasElement)u=e;else{Ls===void 0&&(Ls=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ls.width=e.width,Ls.height=e.height;const y=Ls.getContext("2d");e instanceof ImageData?y.putImageData(e,0,0):y.drawImage(e,0,0,e.width,e.height),u=Ls}return u.width>2048||u.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),u.toDataURL("image/jpeg",.6)):u.toDataURL("image/png")}}let Ro=0;class _s extends It{constructor(e=_s.DEFAULT_IMAGE,u=_s.DEFAULT_MAPPING,y=1001,v=1001,M=1006,O=1008,V=1023,G=1009,H=1,Q=3e3){super(),Object.defineProperty(this,"id",{value:Ro++}),this.uuid=_n(),this.name="",this.image=e,this.mipmaps=[],this.mapping=u,this.wrapS=y,this.wrapT=v,this.magFilter=M,this.minFilter=O,this.anisotropy=H,this.format=V,this.internalFormat=null,this.type=G,this.offset=new en(0,0),this.repeat=new en(1,1),this.center=new en(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=Q,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const u=e===void 0||typeof e=="string";if(!u&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const y={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const v=this.image;if(v.uuid===void 0&&(v.uuid=_n()),!u&&e.images[v.uuid]===void 0){let M;if(Array.isArray(v)){M=[];for(let O=0,V=v.length;O<V;O++)v[O].isDataTexture?M.push(js(v[O].image)):M.push(js(v[O]))}else M=js(v);e.images[v.uuid]={uuid:v.uuid,url:M}}y.image=v.uuid}return u||(e.textures[this.uuid]=y),y}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}function js(S){return typeof HTMLImageElement<"u"&&S instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&S instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&S instanceof ImageBitmap?To.getDataURL(S):S.data?{data:Array.prototype.slice.call(S.data),width:S.width,height:S.height,type:S.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}_s.DEFAULT_IMAGE=void 0,_s.DEFAULT_MAPPING=300,_s.prototype.isTexture=!0;class Dr{constructor(e=0,u=0,y=0,v=1){this.x=e,this.y=u,this.z=y,this.w=v}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,u,y,v){return this.x=e,this.y=u,this.z=y,this.w=v,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,u){switch(e){case 0:this.x=u;break;case 1:this.y=u;break;case 2:this.z=u;break;case 3:this.w=u;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,u){return u!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,u)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,u){return this.x=e.x+u.x,this.y=e.y+u.y,this.z=e.z+u.z,this.w=e.w+u.w,this}addScaledVector(e,u){return this.x+=e.x*u,this.y+=e.y*u,this.z+=e.z*u,this.w+=e.w*u,this}sub(e,u){return u!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,u)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,u){return this.x=e.x-u.x,this.y=e.y-u.y,this.z=e.z-u.z,this.w=e.w-u.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const u=this.x,y=this.y,v=this.z,M=this.w,O=e.elements;return this.x=O[0]*u+O[4]*y+O[8]*v+O[12]*M,this.y=O[1]*u+O[5]*y+O[9]*v+O[13]*M,this.z=O[2]*u+O[6]*y+O[10]*v+O[14]*M,this.w=O[3]*u+O[7]*y+O[11]*v+O[15]*M,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const u=Math.sqrt(1-e.w*e.w);return u<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/u,this.y=e.y/u,this.z=e.z/u),this}setAxisAngleFromRotationMatrix(e){let u,y,v,M;const G=e.elements,H=G[0],Q=G[4],ee=G[8],se=G[1],ae=G[5],de=G[9],be=G[2],Re=G[6],Te=G[10];if(Math.abs(Q-se)<.01&&Math.abs(ee-be)<.01&&Math.abs(de-Re)<.01){if(Math.abs(Q+se)<.1&&Math.abs(ee+be)<.1&&Math.abs(de+Re)<.1&&Math.abs(H+ae+Te-3)<.1)return this.set(1,0,0,0),this;u=Math.PI;const Et=(H+1)/2,_t=(ae+1)/2,jt=(Te+1)/2,Xt=(Q+se)/4,_i=(ee+be)/4,vi=(de+Re)/4;return Et>_t&&Et>jt?Et<.01?(y=0,v=.707106781,M=.707106781):(y=Math.sqrt(Et),v=Xt/y,M=_i/y):_t>jt?_t<.01?(y=.707106781,v=0,M=.707106781):(v=Math.sqrt(_t),y=Xt/v,M=vi/v):jt<.01?(y=.707106781,v=.707106781,M=0):(M=Math.sqrt(jt),y=_i/M,v=vi/M),this.set(y,v,M,u),this}let ct=Math.sqrt((Re-de)*(Re-de)+(ee-be)*(ee-be)+(se-Q)*(se-Q));return Math.abs(ct)<.001&&(ct=1),this.x=(Re-de)/ct,this.y=(ee-be)/ct,this.z=(se-Q)/ct,this.w=Math.acos((H+ae+Te-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,u){return this.x=Math.max(e.x,Math.min(u.x,this.x)),this.y=Math.max(e.y,Math.min(u.y,this.y)),this.z=Math.max(e.z,Math.min(u.z,this.z)),this.w=Math.max(e.w,Math.min(u.w,this.w)),this}clampScalar(e,u){return this.x=Math.max(e,Math.min(u,this.x)),this.y=Math.max(e,Math.min(u,this.y)),this.z=Math.max(e,Math.min(u,this.z)),this.w=Math.max(e,Math.min(u,this.w)),this}clampLength(e,u){const y=this.length();return this.divideScalar(y||1).multiplyScalar(Math.max(e,Math.min(u,y)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,u){return this.x+=(e.x-this.x)*u,this.y+=(e.y-this.y)*u,this.z+=(e.z-this.z)*u,this.w+=(e.w-this.w)*u,this}lerpVectors(e,u,y){return this.x=e.x+(u.x-e.x)*y,this.y=e.y+(u.y-e.y)*y,this.z=e.z+(u.z-e.z)*y,this.w=e.w+(u.w-e.w)*y,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,u=0){return this.x=e[u],this.y=e[u+1],this.z=e[u+2],this.w=e[u+3],this}toArray(e=[],u=0){return e[u]=this.x,e[u+1]=this.y,e[u+2]=this.z,e[u+3]=this.w,e}fromBufferAttribute(e,u,y){return y!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(u),this.y=e.getY(u),this.z=e.getZ(u),this.w=e.getW(u),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Dr.prototype.isVector4=!0;class ro extends It{constructor(e,u,y={}){super(),this.width=e,this.height=u,this.depth=1,this.scissor=new Dr(0,0,e,u),this.scissorTest=!1,this.viewport=new Dr(0,0,e,u),this.texture=new _s(void 0,y.mapping,y.wrapS,y.wrapT,y.magFilter,y.minFilter,y.format,y.type,y.anisotropy,y.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:u,depth:1},this.texture.generateMipmaps=y.generateMipmaps!==void 0&&y.generateMipmaps,this.texture.internalFormat=y.internalFormat!==void 0?y.internalFormat:null,this.texture.minFilter=y.minFilter!==void 0?y.minFilter:1006,this.depthBuffer=y.depthBuffer===void 0||y.depthBuffer,this.stencilBuffer=y.stencilBuffer!==void 0&&y.stencilBuffer,this.depthTexture=y.depthTexture!==void 0?y.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,u,y=1){this.width===e&&this.height===u&&this.depth===y||(this.width=e,this.height=u,this.depth=y,this.texture.image.width=e,this.texture.image.height=u,this.texture.image.depth=y,this.dispose()),this.viewport.set(0,0,e,u),this.scissor.set(0,0,e,u)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}ro.prototype.isWebGLRenderTarget=!0;class po extends ro{constructor(e,u,y){super(e,u);const v=this.texture;this.texture=[];for(let M=0;M<y;M++)this.texture[M]=v.clone()}setSize(e,u,y=1){if(this.width!==e||this.height!==u||this.depth!==y){this.width=e,this.height=u,this.depth=y;for(let v=0,M=this.texture.length;v<M;v++)this.texture[v].image.width=e,this.texture[v].image.height=u,this.texture[v].image.depth=y;this.dispose()}return this.viewport.set(0,0,e,u),this.scissor.set(0,0,e,u),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let u=0,y=e.texture.length;u<y;u++)this.texture[u]=e.texture[u].clone();return this}}po.prototype.isWebGLMultipleRenderTargets=!0;class ai extends ro{constructor(e,u,y){super(e,u,y),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}ai.prototype.isWebGLMultisampleRenderTarget=!0;class ye{constructor(e=0,u=0,y=0,v=1){this._x=e,this._y=u,this._z=y,this._w=v}static slerp(e,u,y,v){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),y.slerpQuaternions(e,u,v)}static slerpFlat(e,u,y,v,M,O,V){let G=y[v+0],H=y[v+1],Q=y[v+2],ee=y[v+3];const se=M[O+0],ae=M[O+1],de=M[O+2],be=M[O+3];if(V===0)return e[u+0]=G,e[u+1]=H,e[u+2]=Q,void(e[u+3]=ee);if(V===1)return e[u+0]=se,e[u+1]=ae,e[u+2]=de,void(e[u+3]=be);if(ee!==be||G!==se||H!==ae||Q!==de){let Re=1-V;const Te=G*se+H*ae+Q*de+ee*be,ct=Te>=0?1:-1,Et=1-Te*Te;if(Et>Number.EPSILON){const jt=Math.sqrt(Et),Xt=Math.atan2(jt,Te*ct);Re=Math.sin(Re*Xt)/jt,V=Math.sin(V*Xt)/jt}const _t=V*ct;if(G=G*Re+se*_t,H=H*Re+ae*_t,Q=Q*Re+de*_t,ee=ee*Re+be*_t,Re===1-V){const jt=1/Math.sqrt(G*G+H*H+Q*Q+ee*ee);G*=jt,H*=jt,Q*=jt,ee*=jt}}e[u]=G,e[u+1]=H,e[u+2]=Q,e[u+3]=ee}static multiplyQuaternionsFlat(e,u,y,v,M,O){const V=y[v],G=y[v+1],H=y[v+2],Q=y[v+3],ee=M[O],se=M[O+1],ae=M[O+2],de=M[O+3];return e[u]=V*de+Q*ee+G*ae-H*se,e[u+1]=G*de+Q*se+H*ee-V*ae,e[u+2]=H*de+Q*ae+V*se-G*ee,e[u+3]=Q*de-V*ee-G*se-H*ae,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,u,y,v){return this._x=e,this._y=u,this._z=y,this._w=v,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,u){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const y=e._x,v=e._y,M=e._z,O=e._order,V=Math.cos,G=Math.sin,H=V(y/2),Q=V(v/2),ee=V(M/2),se=G(y/2),ae=G(v/2),de=G(M/2);switch(O){case"XYZ":this._x=se*Q*ee+H*ae*de,this._y=H*ae*ee-se*Q*de,this._z=H*Q*de+se*ae*ee,this._w=H*Q*ee-se*ae*de;break;case"YXZ":this._x=se*Q*ee+H*ae*de,this._y=H*ae*ee-se*Q*de,this._z=H*Q*de-se*ae*ee,this._w=H*Q*ee+se*ae*de;break;case"ZXY":this._x=se*Q*ee-H*ae*de,this._y=H*ae*ee+se*Q*de,this._z=H*Q*de+se*ae*ee,this._w=H*Q*ee-se*ae*de;break;case"ZYX":this._x=se*Q*ee-H*ae*de,this._y=H*ae*ee+se*Q*de,this._z=H*Q*de-se*ae*ee,this._w=H*Q*ee+se*ae*de;break;case"YZX":this._x=se*Q*ee+H*ae*de,this._y=H*ae*ee+se*Q*de,this._z=H*Q*de-se*ae*ee,this._w=H*Q*ee-se*ae*de;break;case"XZY":this._x=se*Q*ee-H*ae*de,this._y=H*ae*ee-se*Q*de,this._z=H*Q*de+se*ae*ee,this._w=H*Q*ee+se*ae*de;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+O)}return u!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,u){const y=u/2,v=Math.sin(y);return this._x=e.x*v,this._y=e.y*v,this._z=e.z*v,this._w=Math.cos(y),this._onChangeCallback(),this}setFromRotationMatrix(e){const u=e.elements,y=u[0],v=u[4],M=u[8],O=u[1],V=u[5],G=u[9],H=u[2],Q=u[6],ee=u[10],se=y+V+ee;if(se>0){const ae=.5/Math.sqrt(se+1);this._w=.25/ae,this._x=(Q-G)*ae,this._y=(M-H)*ae,this._z=(O-v)*ae}else if(y>V&&y>ee){const ae=2*Math.sqrt(1+y-V-ee);this._w=(Q-G)/ae,this._x=.25*ae,this._y=(v+O)/ae,this._z=(M+H)/ae}else if(V>ee){const ae=2*Math.sqrt(1+V-y-ee);this._w=(M-H)/ae,this._x=(v+O)/ae,this._y=.25*ae,this._z=(G+Q)/ae}else{const ae=2*Math.sqrt(1+ee-y-V);this._w=(O-v)/ae,this._x=(M+H)/ae,this._y=(G+Q)/ae,this._z=.25*ae}return this._onChangeCallback(),this}setFromUnitVectors(e,u){let y=e.dot(u)+1;return y<Number.EPSILON?(y=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=y):(this._x=0,this._y=-e.z,this._z=e.y,this._w=y)):(this._x=e.y*u.z-e.z*u.y,this._y=e.z*u.x-e.x*u.z,this._z=e.x*u.y-e.y*u.x,this._w=y),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Fn(this.dot(e),-1,1)))}rotateTowards(e,u){const y=this.angleTo(e);if(y===0)return this;const v=Math.min(1,u/y);return this.slerp(e,v),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,u){return u!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,u)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,u){const y=e._x,v=e._y,M=e._z,O=e._w,V=u._x,G=u._y,H=u._z,Q=u._w;return this._x=y*Q+O*V+v*H-M*G,this._y=v*Q+O*G+M*V-y*H,this._z=M*Q+O*H+y*G-v*V,this._w=O*Q-y*V-v*G-M*H,this._onChangeCallback(),this}slerp(e,u){if(u===0)return this;if(u===1)return this.copy(e);const y=this._x,v=this._y,M=this._z,O=this._w;let V=O*e._w+y*e._x+v*e._y+M*e._z;if(V<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,V=-V):this.copy(e),V>=1)return this._w=O,this._x=y,this._y=v,this._z=M,this;const G=1-V*V;if(G<=Number.EPSILON){const ae=1-u;return this._w=ae*O+u*this._w,this._x=ae*y+u*this._x,this._y=ae*v+u*this._y,this._z=ae*M+u*this._z,this.normalize(),this._onChangeCallback(),this}const H=Math.sqrt(G),Q=Math.atan2(H,V),ee=Math.sin((1-u)*Q)/H,se=Math.sin(u*Q)/H;return this._w=O*ee+this._w*se,this._x=y*ee+this._x*se,this._y=v*ee+this._y*se,this._z=M*ee+this._z*se,this._onChangeCallback(),this}slerpQuaternions(e,u,y){this.copy(e).slerp(u,y)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,u=0){return this._x=e[u],this._y=e[u+1],this._z=e[u+2],this._w=e[u+3],this._onChangeCallback(),this}toArray(e=[],u=0){return e[u]=this._x,e[u+1]=this._y,e[u+2]=this._z,e[u+3]=this._w,e}fromBufferAttribute(e,u){return this._x=e.getX(u),this._y=e.getY(u),this._z=e.getZ(u),this._w=e.getW(u),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ye.prototype.isQuaternion=!0;class re{constructor(e=0,u=0,y=0){this.x=e,this.y=u,this.z=y}set(e,u,y){return y===void 0&&(y=this.z),this.x=e,this.y=u,this.z=y,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,u){switch(e){case 0:this.x=u;break;case 1:this.y=u;break;case 2:this.z=u;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,u){return u!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,u)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,u){return this.x=e.x+u.x,this.y=e.y+u.y,this.z=e.z+u.z,this}addScaledVector(e,u){return this.x+=e.x*u,this.y+=e.y*u,this.z+=e.z*u,this}sub(e,u){return u!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,u)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,u){return this.x=e.x-u.x,this.y=e.y-u.y,this.z=e.z-u.z,this}multiply(e,u){return u!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,u)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,u){return this.x=e.x*u.x,this.y=e.y*u.y,this.z=e.z*u.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Rt.setFromEuler(e))}applyAxisAngle(e,u){return this.applyQuaternion(Rt.setFromAxisAngle(e,u))}applyMatrix3(e){const u=this.x,y=this.y,v=this.z,M=e.elements;return this.x=M[0]*u+M[3]*y+M[6]*v,this.y=M[1]*u+M[4]*y+M[7]*v,this.z=M[2]*u+M[5]*y+M[8]*v,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const u=this.x,y=this.y,v=this.z,M=e.elements,O=1/(M[3]*u+M[7]*y+M[11]*v+M[15]);return this.x=(M[0]*u+M[4]*y+M[8]*v+M[12])*O,this.y=(M[1]*u+M[5]*y+M[9]*v+M[13])*O,this.z=(M[2]*u+M[6]*y+M[10]*v+M[14])*O,this}applyQuaternion(e){const u=this.x,y=this.y,v=this.z,M=e.x,O=e.y,V=e.z,G=e.w,H=G*u+O*v-V*y,Q=G*y+V*u-M*v,ee=G*v+M*y-O*u,se=-M*u-O*y-V*v;return this.x=H*G+se*-M+Q*-V-ee*-O,this.y=Q*G+se*-O+ee*-M-H*-V,this.z=ee*G+se*-V+H*-O-Q*-M,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const u=this.x,y=this.y,v=this.z,M=e.elements;return this.x=M[0]*u+M[4]*y+M[8]*v,this.y=M[1]*u+M[5]*y+M[9]*v,this.z=M[2]*u+M[6]*y+M[10]*v,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,u){return this.x=Math.max(e.x,Math.min(u.x,this.x)),this.y=Math.max(e.y,Math.min(u.y,this.y)),this.z=Math.max(e.z,Math.min(u.z,this.z)),this}clampScalar(e,u){return this.x=Math.max(e,Math.min(u,this.x)),this.y=Math.max(e,Math.min(u,this.y)),this.z=Math.max(e,Math.min(u,this.z)),this}clampLength(e,u){const y=this.length();return this.divideScalar(y||1).multiplyScalar(Math.max(e,Math.min(u,y)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,u){return this.x+=(e.x-this.x)*u,this.y+=(e.y-this.y)*u,this.z+=(e.z-this.z)*u,this}lerpVectors(e,u,y){return this.x=e.x+(u.x-e.x)*y,this.y=e.y+(u.y-e.y)*y,this.z=e.z+(u.z-e.z)*y,this}cross(e,u){return u!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,u)):this.crossVectors(this,e)}crossVectors(e,u){const y=e.x,v=e.y,M=e.z,O=u.x,V=u.y,G=u.z;return this.x=v*G-M*V,this.y=M*O-y*G,this.z=y*V-v*O,this}projectOnVector(e){const u=e.lengthSq();if(u===0)return this.set(0,0,0);const y=e.dot(this)/u;return this.copy(e).multiplyScalar(y)}projectOnPlane(e){return Je.copy(this).projectOnVector(e),this.sub(Je)}reflect(e){return this.sub(Je.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const u=Math.sqrt(this.lengthSq()*e.lengthSq());if(u===0)return Math.PI/2;const y=this.dot(e)/u;return Math.acos(Fn(y,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const u=this.x-e.x,y=this.y-e.y,v=this.z-e.z;return u*u+y*y+v*v}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,u,y){const v=Math.sin(u)*e;return this.x=v*Math.sin(y),this.y=Math.cos(u)*e,this.z=v*Math.cos(y),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,u,y){return this.x=e*Math.sin(u),this.y=y,this.z=e*Math.cos(u),this}setFromMatrixPosition(e){const u=e.elements;return this.x=u[12],this.y=u[13],this.z=u[14],this}setFromMatrixScale(e){const u=this.setFromMatrixColumn(e,0).length(),y=this.setFromMatrixColumn(e,1).length(),v=this.setFromMatrixColumn(e,2).length();return this.x=u,this.y=y,this.z=v,this}setFromMatrixColumn(e,u){return this.fromArray(e.elements,4*u)}setFromMatrix3Column(e,u){return this.fromArray(e.elements,3*u)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,u=0){return this.x=e[u],this.y=e[u+1],this.z=e[u+2],this}toArray(e=[],u=0){return e[u]=this.x,e[u+1]=this.y,e[u+2]=this.z,e}fromBufferAttribute(e,u,y){return y!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(u),this.y=e.getY(u),this.z=e.getZ(u),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}re.prototype.isVector3=!0;const Je=new re,Rt=new ye;class dt{constructor(e=new re(1/0,1/0,1/0),u=new re(-1/0,-1/0,-1/0)){this.min=e,this.max=u}set(e,u){return this.min.copy(e),this.max.copy(u),this}setFromArray(e){let u=1/0,y=1/0,v=1/0,M=-1/0,O=-1/0,V=-1/0;for(let G=0,H=e.length;G<H;G+=3){const Q=e[G],ee=e[G+1],se=e[G+2];Q<u&&(u=Q),ee<y&&(y=ee),se<v&&(v=se),Q>M&&(M=Q),ee>O&&(O=ee),se>V&&(V=se)}return this.min.set(u,y,v),this.max.set(M,O,V),this}setFromBufferAttribute(e){let u=1/0,y=1/0,v=1/0,M=-1/0,O=-1/0,V=-1/0;for(let G=0,H=e.count;G<H;G++){const Q=e.getX(G),ee=e.getY(G),se=e.getZ(G);Q<u&&(u=Q),ee<y&&(y=ee),se<v&&(v=se),Q>M&&(M=Q),ee>O&&(O=ee),se>V&&(V=se)}return this.min.set(u,y,v),this.max.set(M,O,V),this}setFromPoints(e){this.makeEmpty();for(let u=0,y=e.length;u<y;u++)this.expandByPoint(e[u]);return this}setFromCenterAndSize(e,u){const y=oi.copy(u).multiplyScalar(.5);return this.min.copy(e).sub(y),this.max.copy(e).add(y),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const u=e.geometry;u!==void 0&&(u.boundingBox===null&&u.computeBoundingBox(),Zt.copy(u.boundingBox),Zt.applyMatrix4(e.matrixWorld),this.union(Zt));const y=e.children;for(let v=0,M=y.length;v<M;v++)this.expandByObject(y[v]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,u){return u.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,oi),oi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let u,y;return e.normal.x>0?(u=e.normal.x*this.min.x,y=e.normal.x*this.max.x):(u=e.normal.x*this.max.x,y=e.normal.x*this.min.x),e.normal.y>0?(u+=e.normal.y*this.min.y,y+=e.normal.y*this.max.y):(u+=e.normal.y*this.max.y,y+=e.normal.y*this.min.y),e.normal.z>0?(u+=e.normal.z*this.min.z,y+=e.normal.z*this.max.z):(u+=e.normal.z*this.max.z,y+=e.normal.z*this.min.z),u<=-e.constant&&y>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Jn),sr.subVectors(this.max,Jn),li.subVectors(e.a,Jn),mi.subVectors(e.b,Jn),fi.subVectors(e.c,Jn),Pi.subVectors(mi,li),tn.subVectors(fi,mi),xn.subVectors(li,fi);let u=[0,-Pi.z,Pi.y,0,-tn.z,tn.y,0,-xn.z,xn.y,Pi.z,0,-Pi.x,tn.z,0,-tn.x,xn.z,0,-xn.x,-Pi.y,Pi.x,0,-tn.y,tn.x,0,-xn.y,xn.x,0];return!!Zr(u,li,mi,fi,sr)&&(u=[1,0,0,0,1,0,0,0,1],!!Zr(u,li,mi,fi,sr)&&(ar.crossVectors(Pi,tn),u=[ar.x,ar.y,ar.z],Zr(u,li,mi,fi,sr)))}clampPoint(e,u){return u.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return oi.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(oi).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Nt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Nt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Nt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Nt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Nt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Nt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Nt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Nt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Nt)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}dt.prototype.isBox3=!0;const Nt=[new re,new re,new re,new re,new re,new re,new re,new re],oi=new re,Zt=new dt,li=new re,mi=new re,fi=new re,Pi=new re,tn=new re,xn=new re,Jn=new re,sr=new re,ar=new re,er=new re;function Zr(S,e,u,y,v){for(let M=0,O=S.length-3;M<=O;M+=3){er.fromArray(S,M);const V=v.x*Math.abs(er.x)+v.y*Math.abs(er.y)+v.z*Math.abs(er.z),G=e.dot(er),H=u.dot(er),Q=y.dot(er);if(Math.max(-Math.max(G,H,Q),Math.min(G,H,Q))>V)return!1}return!0}const Gr=new dt,yr=new re,Jr=new re,us=new re;class Ns{constructor(e=new re,u=-1){this.center=e,this.radius=u}set(e,u){return this.center.copy(e),this.radius=u,this}setFromPoints(e,u){const y=this.center;u!==void 0?y.copy(u):Gr.setFromPoints(e).getCenter(y);let v=0;for(let M=0,O=e.length;M<O;M++)v=Math.max(v,y.distanceToSquared(e[M]));return this.radius=Math.sqrt(v),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const u=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=u*u}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,u){const y=this.center.distanceToSquared(e);return u.copy(e),y>this.radius*this.radius&&(u.sub(this.center).normalize(),u.multiplyScalar(this.radius).add(this.center)),u}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){us.subVectors(e,this.center);const u=us.lengthSq();if(u>this.radius*this.radius){const y=Math.sqrt(u),v=.5*(y-this.radius);this.center.add(us.multiplyScalar(v/y)),this.radius+=v}return this}union(e){return Jr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(yr.copy(e.center).add(Jr)),this.expandByPoint(yr.copy(e.center).sub(Jr)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const es=new re,Fs=new re,Ps=new re,Mo=new re,Qo=new re,Ua=new re,ml=new re;class aa{constructor(e=new re,u=new re(0,0,-1)){this.origin=e,this.direction=u}set(e,u){return this.origin.copy(e),this.direction.copy(u),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,u){return u.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,es)),this}closestPointToPoint(e,u){u.subVectors(e,this.origin);const y=u.dot(this.direction);return y<0?u.copy(this.origin):u.copy(this.direction).multiplyScalar(y).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const u=es.subVectors(e,this.origin).dot(this.direction);return u<0?this.origin.distanceToSquared(e):(es.copy(this.direction).multiplyScalar(u).add(this.origin),es.distanceToSquared(e))}distanceSqToSegment(e,u,y,v){Fs.copy(e).add(u).multiplyScalar(.5),Ps.copy(u).sub(e).normalize(),Mo.copy(this.origin).sub(Fs);const M=.5*e.distanceTo(u),O=-this.direction.dot(Ps),V=Mo.dot(this.direction),G=-Mo.dot(Ps),H=Mo.lengthSq(),Q=Math.abs(1-O*O);let ee,se,ae,de;if(Q>0)if(ee=O*G-V,se=O*V-G,de=M*Q,ee>=0)if(se>=-de)if(se<=de){const be=1/Q;ee*=be,se*=be,ae=ee*(ee+O*se+2*V)+se*(O*ee+se+2*G)+H}else se=M,ee=Math.max(0,-(O*se+V)),ae=-ee*ee+se*(se+2*G)+H;else se=-M,ee=Math.max(0,-(O*se+V)),ae=-ee*ee+se*(se+2*G)+H;else se<=-de?(ee=Math.max(0,-(-O*M+V)),se=ee>0?-M:Math.min(Math.max(-M,-G),M),ae=-ee*ee+se*(se+2*G)+H):se<=de?(ee=0,se=Math.min(Math.max(-M,-G),M),ae=se*(se+2*G)+H):(ee=Math.max(0,-(O*M+V)),se=ee>0?M:Math.min(Math.max(-M,-G),M),ae=-ee*ee+se*(se+2*G)+H);else se=O>0?-M:M,ee=Math.max(0,-(O*se+V)),ae=-ee*ee+se*(se+2*G)+H;return y&&y.copy(this.direction).multiplyScalar(ee).add(this.origin),v&&v.copy(Ps).multiplyScalar(se).add(Fs),ae}intersectSphere(e,u){es.subVectors(e.center,this.origin);const y=es.dot(this.direction),v=es.dot(es)-y*y,M=e.radius*e.radius;if(v>M)return null;const O=Math.sqrt(M-v),V=y-O,G=y+O;return V<0&&G<0?null:V<0?this.at(G,u):this.at(V,u)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const u=e.normal.dot(this.direction);if(u===0)return e.distanceToPoint(this.origin)===0?0:null;const y=-(this.origin.dot(e.normal)+e.constant)/u;return y>=0?y:null}intersectPlane(e,u){const y=this.distanceToPlane(e);return y===null?null:this.at(y,u)}intersectsPlane(e){const u=e.distanceToPoint(this.origin);return u===0?!0:e.normal.dot(this.direction)*u<0}intersectBox(e,u){let y,v,M,O,V,G;const H=1/this.direction.x,Q=1/this.direction.y,ee=1/this.direction.z,se=this.origin;return H>=0?(y=(e.min.x-se.x)*H,v=(e.max.x-se.x)*H):(y=(e.max.x-se.x)*H,v=(e.min.x-se.x)*H),Q>=0?(M=(e.min.y-se.y)*Q,O=(e.max.y-se.y)*Q):(M=(e.max.y-se.y)*Q,O=(e.min.y-se.y)*Q),y>O||M>v?null:((M>y||y!=y)&&(y=M),(O<v||v!=v)&&(v=O),ee>=0?(V=(e.min.z-se.z)*ee,G=(e.max.z-se.z)*ee):(V=(e.max.z-se.z)*ee,G=(e.min.z-se.z)*ee),y>G||V>v?null:((V>y||y!=y)&&(y=V),(G<v||v!=v)&&(v=G),v<0?null:this.at(y>=0?y:v,u)))}intersectsBox(e){return this.intersectBox(e,es)!==null}intersectTriangle(e,u,y,v,M){Qo.subVectors(u,e),Ua.subVectors(y,e),ml.crossVectors(Qo,Ua);let O,V=this.direction.dot(ml);if(V>0){if(v)return null;O=1}else{if(!(V<0))return null;O=-1,V=-V}Mo.subVectors(this.origin,e);const G=O*this.direction.dot(Ua.crossVectors(Mo,Ua));if(G<0)return null;const H=O*this.direction.dot(Qo.cross(Mo));if(H<0||G+H>V)return null;const Q=-O*Mo.dot(ml);return Q<0?null:this.at(Q/V,M)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class nr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,u,y,v,M,O,V,G,H,Q,ee,se,ae,de,be,Re){const Te=this.elements;return Te[0]=e,Te[4]=u,Te[8]=y,Te[12]=v,Te[1]=M,Te[5]=O,Te[9]=V,Te[13]=G,Te[2]=H,Te[6]=Q,Te[10]=ee,Te[14]=se,Te[3]=ae,Te[7]=de,Te[11]=be,Te[15]=Re,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new nr().fromArray(this.elements)}copy(e){const u=this.elements,y=e.elements;return u[0]=y[0],u[1]=y[1],u[2]=y[2],u[3]=y[3],u[4]=y[4],u[5]=y[5],u[6]=y[6],u[7]=y[7],u[8]=y[8],u[9]=y[9],u[10]=y[10],u[11]=y[11],u[12]=y[12],u[13]=y[13],u[14]=y[14],u[15]=y[15],this}copyPosition(e){const u=this.elements,y=e.elements;return u[12]=y[12],u[13]=y[13],u[14]=y[14],this}setFromMatrix3(e){const u=e.elements;return this.set(u[0],u[3],u[6],0,u[1],u[4],u[7],0,u[2],u[5],u[8],0,0,0,0,1),this}extractBasis(e,u,y){return e.setFromMatrixColumn(this,0),u.setFromMatrixColumn(this,1),y.setFromMatrixColumn(this,2),this}makeBasis(e,u,y){return this.set(e.x,u.x,y.x,0,e.y,u.y,y.y,0,e.z,u.z,y.z,0,0,0,0,1),this}extractRotation(e){const u=this.elements,y=e.elements,v=1/qo.setFromMatrixColumn(e,0).length(),M=1/qo.setFromMatrixColumn(e,1).length(),O=1/qo.setFromMatrixColumn(e,2).length();return u[0]=y[0]*v,u[1]=y[1]*v,u[2]=y[2]*v,u[3]=0,u[4]=y[4]*M,u[5]=y[5]*M,u[6]=y[6]*M,u[7]=0,u[8]=y[8]*O,u[9]=y[9]*O,u[10]=y[10]*O,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const u=this.elements,y=e.x,v=e.y,M=e.z,O=Math.cos(y),V=Math.sin(y),G=Math.cos(v),H=Math.sin(v),Q=Math.cos(M),ee=Math.sin(M);if(e.order==="XYZ"){const se=O*Q,ae=O*ee,de=V*Q,be=V*ee;u[0]=G*Q,u[4]=-G*ee,u[8]=H,u[1]=ae+de*H,u[5]=se-be*H,u[9]=-V*G,u[2]=be-se*H,u[6]=de+ae*H,u[10]=O*G}else if(e.order==="YXZ"){const se=G*Q,ae=G*ee,de=H*Q,be=H*ee;u[0]=se+be*V,u[4]=de*V-ae,u[8]=O*H,u[1]=O*ee,u[5]=O*Q,u[9]=-V,u[2]=ae*V-de,u[6]=be+se*V,u[10]=O*G}else if(e.order==="ZXY"){const se=G*Q,ae=G*ee,de=H*Q,be=H*ee;u[0]=se-be*V,u[4]=-O*ee,u[8]=de+ae*V,u[1]=ae+de*V,u[5]=O*Q,u[9]=be-se*V,u[2]=-O*H,u[6]=V,u[10]=O*G}else if(e.order==="ZYX"){const se=O*Q,ae=O*ee,de=V*Q,be=V*ee;u[0]=G*Q,u[4]=de*H-ae,u[8]=se*H+be,u[1]=G*ee,u[5]=be*H+se,u[9]=ae*H-de,u[2]=-H,u[6]=V*G,u[10]=O*G}else if(e.order==="YZX"){const se=O*G,ae=O*H,de=V*G,be=V*H;u[0]=G*Q,u[4]=be-se*ee,u[8]=de*ee+ae,u[1]=ee,u[5]=O*Q,u[9]=-V*Q,u[2]=-H*Q,u[6]=ae*ee+de,u[10]=se-be*ee}else if(e.order==="XZY"){const se=O*G,ae=O*H,de=V*G,be=V*H;u[0]=G*Q,u[4]=-ee,u[8]=H*Q,u[1]=se*ee+be,u[5]=O*Q,u[9]=ae*ee-de,u[2]=de*ee-ae,u[6]=V*Q,u[10]=be*ee+se}return u[3]=0,u[7]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Vo,e,la)}lookAt(e,u,y){const v=this.elements;return Ws.subVectors(e,u),Ws.lengthSq()===0&&(Ws.z=1),Ws.normalize(),_o.crossVectors(y,Ws),_o.lengthSq()===0&&(Math.abs(y.z)===1?Ws.x+=1e-4:Ws.z+=1e-4,Ws.normalize(),_o.crossVectors(y,Ws)),_o.normalize(),$o.crossVectors(Ws,_o),v[0]=_o.x,v[4]=$o.x,v[8]=Ws.x,v[1]=_o.y,v[5]=$o.y,v[9]=Ws.y,v[2]=_o.z,v[6]=$o.z,v[10]=Ws.z,this}multiply(e,u){return u!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,u)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,u){const y=e.elements,v=u.elements,M=this.elements,O=y[0],V=y[4],G=y[8],H=y[12],Q=y[1],ee=y[5],se=y[9],ae=y[13],de=y[2],be=y[6],Re=y[10],Te=y[14],ct=y[3],Et=y[7],_t=y[11],jt=y[15],Xt=v[0],_i=v[4],vi=v[8],Bi=v[12],Li=v[1],ki=v[5],Zn=v[9],En=v[13],Ji=v[2],In=v[6],ir=v[10],rr=v[14],vr=v[3],kr=v[7],Fr=v[11],Rn=v[15];return M[0]=O*Xt+V*Li+G*Ji+H*vr,M[4]=O*_i+V*ki+G*In+H*kr,M[8]=O*vi+V*Zn+G*ir+H*Fr,M[12]=O*Bi+V*En+G*rr+H*Rn,M[1]=Q*Xt+ee*Li+se*Ji+ae*vr,M[5]=Q*_i+ee*ki+se*In+ae*kr,M[9]=Q*vi+ee*Zn+se*ir+ae*Fr,M[13]=Q*Bi+ee*En+se*rr+ae*Rn,M[2]=de*Xt+be*Li+Re*Ji+Te*vr,M[6]=de*_i+be*ki+Re*In+Te*kr,M[10]=de*vi+be*Zn+Re*ir+Te*Fr,M[14]=de*Bi+be*En+Re*rr+Te*Rn,M[3]=ct*Xt+Et*Li+_t*Ji+jt*vr,M[7]=ct*_i+Et*ki+_t*In+jt*kr,M[11]=ct*vi+Et*Zn+_t*ir+jt*Fr,M[15]=ct*Bi+Et*En+_t*rr+jt*Rn,this}multiplyScalar(e){const u=this.elements;return u[0]*=e,u[4]*=e,u[8]*=e,u[12]*=e,u[1]*=e,u[5]*=e,u[9]*=e,u[13]*=e,u[2]*=e,u[6]*=e,u[10]*=e,u[14]*=e,u[3]*=e,u[7]*=e,u[11]*=e,u[15]*=e,this}determinant(){const e=this.elements,u=e[0],y=e[4],v=e[8],M=e[12],O=e[1],V=e[5],G=e[9],H=e[13],Q=e[2],ee=e[6],se=e[10],ae=e[14];return e[3]*(+M*G*ee-v*H*ee-M*V*se+y*H*se+v*V*ae-y*G*ae)+e[7]*(+u*G*ae-u*H*se+M*O*se-v*O*ae+v*H*Q-M*G*Q)+e[11]*(+u*H*ee-u*V*ae-M*O*ee+y*O*ae+M*V*Q-y*H*Q)+e[15]*(-v*V*Q-u*G*ee+u*V*se+v*O*ee-y*O*se+y*G*Q)}transpose(){const e=this.elements;let u;return u=e[1],e[1]=e[4],e[4]=u,u=e[2],e[2]=e[8],e[8]=u,u=e[6],e[6]=e[9],e[9]=u,u=e[3],e[3]=e[12],e[12]=u,u=e[7],e[7]=e[13],e[13]=u,u=e[11],e[11]=e[14],e[14]=u,this}setPosition(e,u,y){const v=this.elements;return e.isVector3?(v[12]=e.x,v[13]=e.y,v[14]=e.z):(v[12]=e,v[13]=u,v[14]=y),this}invert(){const e=this.elements,u=e[0],y=e[1],v=e[2],M=e[3],O=e[4],V=e[5],G=e[6],H=e[7],Q=e[8],ee=e[9],se=e[10],ae=e[11],de=e[12],be=e[13],Re=e[14],Te=e[15],ct=ee*Re*H-be*se*H+be*G*ae-V*Re*ae-ee*G*Te+V*se*Te,Et=de*se*H-Q*Re*H-de*G*ae+O*Re*ae+Q*G*Te-O*se*Te,_t=Q*be*H-de*ee*H+de*V*ae-O*be*ae-Q*V*Te+O*ee*Te,jt=de*ee*G-Q*be*G-de*V*se+O*be*se+Q*V*Re-O*ee*Re,Xt=u*ct+y*Et+v*_t+M*jt;if(Xt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _i=1/Xt;return e[0]=ct*_i,e[1]=(be*se*M-ee*Re*M-be*v*ae+y*Re*ae+ee*v*Te-y*se*Te)*_i,e[2]=(V*Re*M-be*G*M+be*v*H-y*Re*H-V*v*Te+y*G*Te)*_i,e[3]=(ee*G*M-V*se*M-ee*v*H+y*se*H+V*v*ae-y*G*ae)*_i,e[4]=Et*_i,e[5]=(Q*Re*M-de*se*M+de*v*ae-u*Re*ae-Q*v*Te+u*se*Te)*_i,e[6]=(de*G*M-O*Re*M-de*v*H+u*Re*H+O*v*Te-u*G*Te)*_i,e[7]=(O*se*M-Q*G*M+Q*v*H-u*se*H-O*v*ae+u*G*ae)*_i,e[8]=_t*_i,e[9]=(de*ee*M-Q*be*M-de*y*ae+u*be*ae+Q*y*Te-u*ee*Te)*_i,e[10]=(O*be*M-de*V*M+de*y*H-u*be*H-O*y*Te+u*V*Te)*_i,e[11]=(Q*V*M-O*ee*M-Q*y*H+u*ee*H+O*y*ae-u*V*ae)*_i,e[12]=jt*_i,e[13]=(Q*be*v-de*ee*v+de*y*se-u*be*se-Q*y*Re+u*ee*Re)*_i,e[14]=(de*V*v-O*be*v-de*y*G+u*be*G+O*y*Re-u*V*Re)*_i,e[15]=(O*ee*v-Q*V*v+Q*y*G-u*ee*G-O*y*se+u*V*se)*_i,this}scale(e){const u=this.elements,y=e.x,v=e.y,M=e.z;return u[0]*=y,u[4]*=v,u[8]*=M,u[1]*=y,u[5]*=v,u[9]*=M,u[2]*=y,u[6]*=v,u[10]*=M,u[3]*=y,u[7]*=v,u[11]*=M,this}getMaxScaleOnAxis(){const e=this.elements,u=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],y=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],v=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(u,y,v))}makeTranslation(e,u,y){return this.set(1,0,0,e,0,1,0,u,0,0,1,y,0,0,0,1),this}makeRotationX(e){const u=Math.cos(e),y=Math.sin(e);return this.set(1,0,0,0,0,u,-y,0,0,y,u,0,0,0,0,1),this}makeRotationY(e){const u=Math.cos(e),y=Math.sin(e);return this.set(u,0,y,0,0,1,0,0,-y,0,u,0,0,0,0,1),this}makeRotationZ(e){const u=Math.cos(e),y=Math.sin(e);return this.set(u,-y,0,0,y,u,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,u){const y=Math.cos(u),v=Math.sin(u),M=1-y,O=e.x,V=e.y,G=e.z,H=M*O,Q=M*V;return this.set(H*O+y,H*V-v*G,H*G+v*V,0,H*V+v*G,Q*V+y,Q*G-v*O,0,H*G-v*V,Q*G+v*O,M*G*G+y,0,0,0,0,1),this}makeScale(e,u,y){return this.set(e,0,0,0,0,u,0,0,0,0,y,0,0,0,0,1),this}makeShear(e,u,y,v,M,O){return this.set(1,y,M,0,e,1,O,0,u,v,1,0,0,0,0,1),this}compose(e,u,y){const v=this.elements,M=u._x,O=u._y,V=u._z,G=u._w,H=M+M,Q=O+O,ee=V+V,se=M*H,ae=M*Q,de=M*ee,be=O*Q,Re=O*ee,Te=V*ee,ct=G*H,Et=G*Q,_t=G*ee,jt=y.x,Xt=y.y,_i=y.z;return v[0]=(1-(be+Te))*jt,v[1]=(ae+_t)*jt,v[2]=(de-Et)*jt,v[3]=0,v[4]=(ae-_t)*Xt,v[5]=(1-(se+Te))*Xt,v[6]=(Re+ct)*Xt,v[7]=0,v[8]=(de+Et)*_i,v[9]=(Re-ct)*_i,v[10]=(1-(se+be))*_i,v[11]=0,v[12]=e.x,v[13]=e.y,v[14]=e.z,v[15]=1,this}decompose(e,u,y){const v=this.elements;let M=qo.set(v[0],v[1],v[2]).length();const O=qo.set(v[4],v[5],v[6]).length(),V=qo.set(v[8],v[9],v[10]).length();this.determinant()<0&&(M=-M),e.x=v[12],e.y=v[13],e.z=v[14],go.copy(this);const G=1/M,H=1/O,Q=1/V;return go.elements[0]*=G,go.elements[1]*=G,go.elements[2]*=G,go.elements[4]*=H,go.elements[5]*=H,go.elements[6]*=H,go.elements[8]*=Q,go.elements[9]*=Q,go.elements[10]*=Q,u.setFromRotationMatrix(go),y.x=M,y.y=O,y.z=V,this}makePerspective(e,u,y,v,M,O){O===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const V=this.elements,G=2*M/(u-e),H=2*M/(y-v),Q=(u+e)/(u-e),ee=(y+v)/(y-v),se=-(O+M)/(O-M),ae=-2*O*M/(O-M);return V[0]=G,V[4]=0,V[8]=Q,V[12]=0,V[1]=0,V[5]=H,V[9]=ee,V[13]=0,V[2]=0,V[6]=0,V[10]=se,V[14]=ae,V[3]=0,V[7]=0,V[11]=-1,V[15]=0,this}makeOrthographic(e,u,y,v,M,O){const V=this.elements,G=1/(u-e),H=1/(y-v),Q=1/(O-M),ee=(u+e)*G,se=(y+v)*H,ae=(O+M)*Q;return V[0]=2*G,V[4]=0,V[8]=0,V[12]=-ee,V[1]=0,V[5]=2*H,V[9]=0,V[13]=-se,V[2]=0,V[6]=0,V[10]=-2*Q,V[14]=-ae,V[3]=0,V[7]=0,V[11]=0,V[15]=1,this}equals(e){const u=this.elements,y=e.elements;for(let v=0;v<16;v++)if(u[v]!==y[v])return!1;return!0}fromArray(e,u=0){for(let y=0;y<16;y++)this.elements[y]=e[y+u];return this}toArray(e=[],u=0){const y=this.elements;return e[u]=y[0],e[u+1]=y[1],e[u+2]=y[2],e[u+3]=y[3],e[u+4]=y[4],e[u+5]=y[5],e[u+6]=y[6],e[u+7]=y[7],e[u+8]=y[8],e[u+9]=y[9],e[u+10]=y[10],e[u+11]=y[11],e[u+12]=y[12],e[u+13]=y[13],e[u+14]=y[14],e[u+15]=y[15],e}}nr.prototype.isMatrix4=!0;const qo=new re,go=new nr,Vo=new re(0,0,0),la=new re(1,1,1),_o=new re,$o=new re,Ws=new re,_a=new nr,gl=new ye;class Va{constructor(e=0,u=0,y=0,v=Va.DefaultOrder){this._x=e,this._y=u,this._z=y,this._order=v}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,u,y,v=this._order){return this._x=e,this._y=u,this._z=y,this._order=v,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,u=this._order,y=!0){const v=e.elements,M=v[0],O=v[4],V=v[8],G=v[1],H=v[5],Q=v[9],ee=v[2],se=v[6],ae=v[10];switch(u){case"XYZ":this._y=Math.asin(Fn(V,-1,1)),Math.abs(V)<.9999999?(this._x=Math.atan2(-Q,ae),this._z=Math.atan2(-O,M)):(this._x=Math.atan2(se,H),this._z=0);break;case"YXZ":this._x=Math.asin(-Fn(Q,-1,1)),Math.abs(Q)<.9999999?(this._y=Math.atan2(V,ae),this._z=Math.atan2(G,H)):(this._y=Math.atan2(-ee,M),this._z=0);break;case"ZXY":this._x=Math.asin(Fn(se,-1,1)),Math.abs(se)<.9999999?(this._y=Math.atan2(-ee,ae),this._z=Math.atan2(-O,H)):(this._y=0,this._z=Math.atan2(G,M));break;case"ZYX":this._y=Math.asin(-Fn(ee,-1,1)),Math.abs(ee)<.9999999?(this._x=Math.atan2(se,ae),this._z=Math.atan2(G,M)):(this._x=0,this._z=Math.atan2(-O,H));break;case"YZX":this._z=Math.asin(Fn(G,-1,1)),Math.abs(G)<.9999999?(this._x=Math.atan2(-Q,H),this._y=Math.atan2(-ee,M)):(this._x=0,this._y=Math.atan2(V,ae));break;case"XZY":this._z=Math.asin(-Fn(O,-1,1)),Math.abs(O)<.9999999?(this._x=Math.atan2(se,H),this._y=Math.atan2(V,M)):(this._x=Math.atan2(-Q,ae),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+u)}return this._order=u,y===!0&&this._onChangeCallback(),this}setFromQuaternion(e,u,y){return _a.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_a,u,y)}setFromVector3(e,u=this._order){return this.set(e.x,e.y,e.z,u)}reorder(e){return gl.setFromEuler(this),this.setFromQuaternion(gl,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],u=0){return e[u]=this._x,e[u+1]=this._y,e[u+2]=this._z,e[u+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new re(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Va.prototype.isEuler=!0,Va.DefaultOrder="XYZ",Va.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Hl{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}}let Us=0;const _l=new re,yl=new ye,Ae=new nr,Me=new re,je=new re,zt=new re,Ai=new ye,Ui=new re(1,0,0),bi=new re(0,1,0),Yi=new re(0,0,1),fe={type:"added"},me={type:"removed"};class Ee extends It{constructor(){super(),Object.defineProperty(this,"id",{value:Us++}),this.uuid=_n(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ee.DefaultUp.clone();const e=new re,u=new Va,y=new ye,v=new re(1,1,1);u._onChange(function(){y.setFromEuler(u,!1)}),y._onChange(function(){u.setFromQuaternion(y,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:u},quaternion:{configurable:!0,enumerable:!0,value:y},scale:{configurable:!0,enumerable:!0,value:v},modelViewMatrix:{value:new nr},normalMatrix:{value:new Wn}}),this.matrix=new nr,this.matrixWorld=new nr,this.matrixAutoUpdate=Ee.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Hl,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,u){this.quaternion.setFromAxisAngle(e,u)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,u){return yl.setFromAxisAngle(e,u),this.quaternion.multiply(yl),this}rotateOnWorldAxis(e,u){return yl.setFromAxisAngle(e,u),this.quaternion.premultiply(yl),this}rotateX(e){return this.rotateOnAxis(Ui,e)}rotateY(e){return this.rotateOnAxis(bi,e)}rotateZ(e){return this.rotateOnAxis(Yi,e)}translateOnAxis(e,u){return _l.copy(e).applyQuaternion(this.quaternion),this.position.add(_l.multiplyScalar(u)),this}translateX(e){return this.translateOnAxis(Ui,e)}translateY(e){return this.translateOnAxis(bi,e)}translateZ(e){return this.translateOnAxis(Yi,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ae.copy(this.matrixWorld).invert())}lookAt(e,u,y){e.isVector3?Me.copy(e):Me.set(e,u,y);const v=this.parent;this.updateWorldMatrix(!0,!1),je.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ae.lookAt(je,Me,this.up):Ae.lookAt(Me,je,this.up),this.quaternion.setFromRotationMatrix(Ae),v&&(Ae.extractRotation(v.matrixWorld),yl.setFromRotationMatrix(Ae),this.quaternion.premultiply(yl.invert()))}add(e){if(arguments.length>1){for(let u=0;u<arguments.length;u++)this.add(arguments[u]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(fe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let y=0;y<arguments.length;y++)this.remove(arguments[y]);return this}const u=this.children.indexOf(e);return u!==-1&&(e.parent=null,this.children.splice(u,1),e.dispatchEvent(me)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const u=this.children[e];u.parent=null,u.dispatchEvent(me)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ae.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ae.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ae),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,u){if(this[e]===u)return this;for(let y=0,v=this.children.length;y<v;y++){const M=this.children[y].getObjectByProperty(e,u);if(M!==void 0)return M}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(je,e,zt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(je,Ai,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const u=this.matrixWorld.elements;return e.set(u[8],u[9],u[10]).normalize()}raycast(){}traverse(e){e(this);const u=this.children;for(let y=0,v=u.length;y<v;y++)u[y].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const u=this.children;for(let y=0,v=u.length;y<v;y++)u[y].traverseVisible(e)}traverseAncestors(e){const u=this.parent;u!==null&&(e(u),u.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const u=this.children;for(let y=0,v=u.length;y<v;y++)u[y].updateMatrixWorld(e)}updateWorldMatrix(e,u){const y=this.parent;if(e===!0&&y!==null&&y.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),u===!0){const v=this.children;for(let M=0,O=v.length;M<O;M++)v[M].updateWorldMatrix(!1,!0)}}toJSON(e){const u=e===void 0||typeof e=="string",y={};u&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},y.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const v={};function M(V,G){return V[G.uuid]===void 0&&(V[G.uuid]=G.toJSON(e)),G.uuid}if(v.uuid=this.uuid,v.type=this.type,this.name!==""&&(v.name=this.name),this.castShadow===!0&&(v.castShadow=!0),this.receiveShadow===!0&&(v.receiveShadow=!0),this.visible===!1&&(v.visible=!1),this.frustumCulled===!1&&(v.frustumCulled=!1),this.renderOrder!==0&&(v.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(v.userData=this.userData),v.layers=this.layers.mask,v.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(v.matrixAutoUpdate=!1),this.isInstancedMesh&&(v.type="InstancedMesh",v.count=this.count,v.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(v.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?v.background=this.background.toJSON():this.background.isTexture&&(v.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(v.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){v.geometry=M(e.geometries,this.geometry);const V=this.geometry.parameters;if(V!==void 0&&V.shapes!==void 0){const G=V.shapes;if(Array.isArray(G))for(let H=0,Q=G.length;H<Q;H++){const ee=G[H];M(e.shapes,ee)}else M(e.shapes,G)}}if(this.isSkinnedMesh&&(v.bindMode=this.bindMode,v.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(M(e.skeletons,this.skeleton),v.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const V=[];for(let G=0,H=this.material.length;G<H;G++)V.push(M(e.materials,this.material[G]));v.material=V}else v.material=M(e.materials,this.material);if(this.children.length>0){v.children=[];for(let V=0;V<this.children.length;V++)v.children.push(this.children[V].toJSON(e).object)}if(this.animations.length>0){v.animations=[];for(let V=0;V<this.animations.length;V++){const G=this.animations[V];v.animations.push(M(e.animations,G))}}if(u){const V=O(e.geometries),G=O(e.materials),H=O(e.textures),Q=O(e.images),ee=O(e.shapes),se=O(e.skeletons),ae=O(e.animations);V.length>0&&(y.geometries=V),G.length>0&&(y.materials=G),H.length>0&&(y.textures=H),Q.length>0&&(y.images=Q),ee.length>0&&(y.shapes=ee),se.length>0&&(y.skeletons=se),ae.length>0&&(y.animations=ae)}return y.object=v,y;function O(V){const G=[];for(const H in V){const Q=V[H];delete Q.metadata,G.push(Q)}return G}}clone(e){return new this.constructor().copy(this,e)}copy(e,u=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),u===!0)for(let y=0;y<e.children.length;y++){const v=e.children[y];this.add(v.clone())}return this}}Ee.DefaultUp=new re(0,1,0),Ee.DefaultMatrixAutoUpdate=!0,Ee.prototype.isObject3D=!0;const Ke=new re,Pe=new re,ci=new re,Mi=new re,Wi=new re,hn=new re,Dn=new re,Zi=new re,Kt=new re,nn=new re;class Ei{constructor(e=new re,u=new re,y=new re){this.a=e,this.b=u,this.c=y}static getNormal(e,u,y,v){v.subVectors(y,u),Ke.subVectors(e,u),v.cross(Ke);const M=v.lengthSq();return M>0?v.multiplyScalar(1/Math.sqrt(M)):v.set(0,0,0)}static getBarycoord(e,u,y,v,M){Ke.subVectors(v,u),Pe.subVectors(y,u),ci.subVectors(e,u);const O=Ke.dot(Ke),V=Ke.dot(Pe),G=Ke.dot(ci),H=Pe.dot(Pe),Q=Pe.dot(ci),ee=O*H-V*V;if(ee===0)return M.set(-2,-1,-1);const se=1/ee,ae=(H*G-V*Q)*se,de=(O*Q-V*G)*se;return M.set(1-ae-de,de,ae)}static containsPoint(e,u,y,v){return this.getBarycoord(e,u,y,v,Mi),Mi.x>=0&&Mi.y>=0&&Mi.x+Mi.y<=1}static getUV(e,u,y,v,M,O,V,G){return this.getBarycoord(e,u,y,v,Mi),G.set(0,0),G.addScaledVector(M,Mi.x),G.addScaledVector(O,Mi.y),G.addScaledVector(V,Mi.z),G}static isFrontFacing(e,u,y,v){return Ke.subVectors(y,u),Pe.subVectors(e,u),Ke.cross(Pe).dot(v)<0}set(e,u,y){return this.a.copy(e),this.b.copy(u),this.c.copy(y),this}setFromPointsAndIndices(e,u,y,v){return this.a.copy(e[u]),this.b.copy(e[y]),this.c.copy(e[v]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ke.subVectors(this.c,this.b),Pe.subVectors(this.a,this.b),.5*Ke.cross(Pe).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ei.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,u){return Ei.getBarycoord(e,this.a,this.b,this.c,u)}getUV(e,u,y,v,M){return Ei.getUV(e,this.a,this.b,this.c,u,y,v,M)}containsPoint(e){return Ei.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ei.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,u){const y=this.a,v=this.b,M=this.c;let O,V;Wi.subVectors(v,y),hn.subVectors(M,y),Zi.subVectors(e,y);const G=Wi.dot(Zi),H=hn.dot(Zi);if(G<=0&&H<=0)return u.copy(y);Kt.subVectors(e,v);const Q=Wi.dot(Kt),ee=hn.dot(Kt);if(Q>=0&&ee<=Q)return u.copy(v);const se=G*ee-Q*H;if(se<=0&&G>=0&&Q<=0)return O=G/(G-Q),u.copy(y).addScaledVector(Wi,O);nn.subVectors(e,M);const ae=Wi.dot(nn),de=hn.dot(nn);if(de>=0&&ae<=de)return u.copy(M);const be=ae*H-G*de;if(be<=0&&H>=0&&de<=0)return V=H/(H-de),u.copy(y).addScaledVector(hn,V);const Re=Q*de-ae*ee;if(Re<=0&&ee-Q>=0&&ae-de>=0)return Dn.subVectors(M,v),V=(ee-Q)/(ee-Q+(ae-de)),u.copy(v).addScaledVector(Dn,V);const Te=1/(Re+be+se);return O=be*Te,V=se*Te,u.copy(y).addScaledVector(Wi,O).addScaledVector(hn,V)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Ln=0;class Vi extends It{constructor(){super(),Object.defineProperty(this,"id",{value:Ln++}),this.uuid=_n(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=1023,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const u in e){const y=e[u];if(y===void 0){console.warn("THREE.Material: '"+u+"' parameter is undefined.");continue}if(u==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=y===1;continue}const v=this[u];v!==void 0?v&&v.isColor?v.set(y):v&&v.isVector3&&y&&y.isVector3?v.copy(y):this[u]=y:console.warn("THREE."+this.type+": '"+u+"' is not a property of this material.")}}toJSON(e){const u=e===void 0||typeof e=="string";u&&(e={textures:{},images:{}});const y={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function v(M){const O=[];for(const V in M){const G=M[V];delete G.metadata,O.push(G)}return O}if(y.uuid=this.uuid,y.type=this.type,this.name!==""&&(y.name=this.name),this.color&&this.color.isColor&&(y.color=this.color.getHex()),this.roughness!==void 0&&(y.roughness=this.roughness),this.metalness!==void 0&&(y.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(y.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(y.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(y.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(y.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(y.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(y.specularTint=this.specularTint.getHex()),this.shininess!==void 0&&(y.shininess=this.shininess),this.clearcoat!==void 0&&(y.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(y.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(y.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(y.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(y.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,y.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(y.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(y.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(y.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(y.lightMap=this.lightMap.toJSON(e).uuid,y.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(y.aoMap=this.aoMap.toJSON(e).uuid,y.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(y.bumpMap=this.bumpMap.toJSON(e).uuid,y.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(y.normalMap=this.normalMap.toJSON(e).uuid,y.normalMapType=this.normalMapType,y.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(y.displacementMap=this.displacementMap.toJSON(e).uuid,y.displacementScale=this.displacementScale,y.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(y.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(y.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(y.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(y.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(y.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(y.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(y.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(y.combine=this.combine)),this.envMapIntensity!==void 0&&(y.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(y.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(y.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(y.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(y.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(y.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(y.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(y.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(y.attenuationDistance=this.attenuationDistance),this.attenuationTint!==void 0&&(y.attenuationTint=this.attenuationTint.getHex()),this.size!==void 0&&(y.size=this.size),this.shadowSide!==null&&(y.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(y.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(y.blending=this.blending),this.side!==0&&(y.side=this.side),this.vertexColors&&(y.vertexColors=!0),this.opacity<1&&(y.opacity=this.opacity),this.format!==1023&&(y.format=this.format),this.transparent===!0&&(y.transparent=this.transparent),y.depthFunc=this.depthFunc,y.depthTest=this.depthTest,y.depthWrite=this.depthWrite,y.colorWrite=this.colorWrite,y.stencilWrite=this.stencilWrite,y.stencilWriteMask=this.stencilWriteMask,y.stencilFunc=this.stencilFunc,y.stencilRef=this.stencilRef,y.stencilFuncMask=this.stencilFuncMask,y.stencilFail=this.stencilFail,y.stencilZFail=this.stencilZFail,y.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(y.rotation=this.rotation),this.polygonOffset===!0&&(y.polygonOffset=!0),this.polygonOffsetFactor!==0&&(y.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(y.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(y.linewidth=this.linewidth),this.dashSize!==void 0&&(y.dashSize=this.dashSize),this.gapSize!==void 0&&(y.gapSize=this.gapSize),this.scale!==void 0&&(y.scale=this.scale),this.dithering===!0&&(y.dithering=!0),this.alphaTest>0&&(y.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(y.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(y.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(y.wireframe=this.wireframe),this.wireframeLinewidth>1&&(y.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(y.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(y.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(y.flatShading=this.flatShading),this.visible===!1&&(y.visible=!1),this.toneMapped===!1&&(y.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(y.userData=this.userData),u){const M=v(e.textures),O=v(e.images);M.length>0&&(y.textures=M),O.length>0&&(y.images=O)}return y}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const u=e.clippingPlanes;let y=null;if(u!==null){const v=u.length;y=new Array(v);for(let M=0;M!==v;++M)y[M]=u[M].clone()}return this.clippingPlanes=y,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}Vi.prototype.isMaterial=!0;const fn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},cr={h:0,s:0,l:0},gr={h:0,s:0,l:0};function _r(S,e,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?S+6*(e-S)*u:u<.5?e:u<2/3?S+6*(e-S)*(2/3-u):S}function Rr(S){return S<.04045?.0773993808*S:Math.pow(.9478672986*S+.0521327014,2.4)}function ur(S){return S<.0031308?12.92*S:1.055*Math.pow(S,.41666)-.055}class wn{constructor(e,u,y){return u===void 0&&y===void 0?this.set(e):this.setRGB(e,u,y)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,u,y){return this.r=e,this.g=u,this.b=y,this}setHSL(e,u,y){if(e=Mn(e,1),u=Fn(u,0,1),y=Fn(y,0,1),u===0)this.r=this.g=this.b=y;else{const v=y<=.5?y*(1+u):y+u-y*u,M=2*y-v;this.r=_r(M,v,e+1/3),this.g=_r(M,v,e),this.b=_r(M,v,e-1/3)}return this}setStyle(e){function u(v){v!==void 0&&parseFloat(v)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let y;if(y=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let v;const M=y[1],O=y[2];switch(M){case"rgb":case"rgba":if(v=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O))return this.r=Math.min(255,parseInt(v[1],10))/255,this.g=Math.min(255,parseInt(v[2],10))/255,this.b=Math.min(255,parseInt(v[3],10))/255,u(v[4]),this;if(v=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O))return this.r=Math.min(100,parseInt(v[1],10))/100,this.g=Math.min(100,parseInt(v[2],10))/100,this.b=Math.min(100,parseInt(v[3],10))/100,u(v[4]),this;break;case"hsl":case"hsla":if(v=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O)){const V=parseFloat(v[1])/360,G=parseInt(v[2],10)/100,H=parseInt(v[3],10)/100;return u(v[4]),this.setHSL(V,G,H)}}}else if(y=/^\#([A-Fa-f\d]+)$/.exec(e)){const v=y[1],M=v.length;if(M===3)return this.r=parseInt(v.charAt(0)+v.charAt(0),16)/255,this.g=parseInt(v.charAt(1)+v.charAt(1),16)/255,this.b=parseInt(v.charAt(2)+v.charAt(2),16)/255,this;if(M===6)return this.r=parseInt(v.charAt(0)+v.charAt(1),16)/255,this.g=parseInt(v.charAt(2)+v.charAt(3),16)/255,this.b=parseInt(v.charAt(4)+v.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const u=fn[e.toLowerCase()];return u!==void 0?this.setHex(u):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,u=2){return this.r=Math.pow(e.r,u),this.g=Math.pow(e.g,u),this.b=Math.pow(e.b,u),this}copyLinearToGamma(e,u=2){const y=u>0?1/u:1;return this.r=Math.pow(e.r,y),this.g=Math.pow(e.g,y),this.b=Math.pow(e.b,y),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Rr(e.r),this.g=Rr(e.g),this.b=Rr(e.b),this}copyLinearToSRGB(e){return this.r=ur(e.r),this.g=ur(e.g),this.b=ur(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const u=this.r,y=this.g,v=this.b,M=Math.max(u,y,v),O=Math.min(u,y,v);let V,G;const H=(O+M)/2;if(O===M)V=0,G=0;else{const Q=M-O;switch(G=H<=.5?Q/(M+O):Q/(2-M-O),M){case u:V=(y-v)/Q+(y<v?6:0);break;case y:V=(v-u)/Q+2;break;case v:V=(u-y)/Q+4}V/=6}return e.h=V,e.s=G,e.l=H,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,u,y){return this.getHSL(cr),cr.h+=e,cr.s+=u,cr.l+=y,this.setHSL(cr.h,cr.s,cr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,u){return this.r=e.r+u.r,this.g=e.g+u.g,this.b=e.b+u.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,u){return this.r+=(e.r-this.r)*u,this.g+=(e.g-this.g)*u,this.b+=(e.b-this.b)*u,this}lerpColors(e,u,y){return this.r=e.r+(u.r-e.r)*y,this.g=e.g+(u.g-e.g)*y,this.b=e.b+(u.b-e.b)*y,this}lerpHSL(e,u){this.getHSL(cr),e.getHSL(gr);const y=jn(cr.h,gr.h,u),v=jn(cr.s,gr.s,u),M=jn(cr.l,gr.l,u);return this.setHSL(y,v,M),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,u=0){return this.r=e[u],this.g=e[u+1],this.b=e[u+2],this}toArray(e=[],u=0){return e[u]=this.r,e[u+1]=this.g,e[u+2]=this.b,e}fromBufferAttribute(e,u){return this.r=e.getX(u),this.g=e.getY(u),this.b=e.getZ(u),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}wn.NAMES=fn,wn.prototype.isColor=!0,wn.prototype.r=1,wn.prototype.g=1,wn.prototype.b=1;class ws extends Vi{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new wn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}ws.prototype.isMeshBasicMaterial=!0;const wr=new re,Vs=new en;class Or{constructor(e,u,y){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=u,this.count=e!==void 0?e.length/u:0,this.normalized=y===!0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,u,y){e*=this.itemSize,y*=u.itemSize;for(let v=0,M=this.itemSize;v<M;v++)this.array[e+v]=u.array[y+v];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const u=this.array;let y=0;for(let v=0,M=e.length;v<M;v++){let O=e[v];O===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",v),O=new wn),u[y++]=O.r,u[y++]=O.g,u[y++]=O.b}return this}copyVector2sArray(e){const u=this.array;let y=0;for(let v=0,M=e.length;v<M;v++){let O=e[v];O===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",v),O=new en),u[y++]=O.x,u[y++]=O.y}return this}copyVector3sArray(e){const u=this.array;let y=0;for(let v=0,M=e.length;v<M;v++){let O=e[v];O===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",v),O=new re),u[y++]=O.x,u[y++]=O.y,u[y++]=O.z}return this}copyVector4sArray(e){const u=this.array;let y=0;for(let v=0,M=e.length;v<M;v++){let O=e[v];O===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",v),O=new Dr),u[y++]=O.x,u[y++]=O.y,u[y++]=O.z,u[y++]=O.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let u=0,y=this.count;u<y;u++)Vs.fromBufferAttribute(this,u),Vs.applyMatrix3(e),this.setXY(u,Vs.x,Vs.y);else if(this.itemSize===3)for(let u=0,y=this.count;u<y;u++)wr.fromBufferAttribute(this,u),wr.applyMatrix3(e),this.setXYZ(u,wr.x,wr.y,wr.z);return this}applyMatrix4(e){for(let u=0,y=this.count;u<y;u++)wr.x=this.getX(u),wr.y=this.getY(u),wr.z=this.getZ(u),wr.applyMatrix4(e),this.setXYZ(u,wr.x,wr.y,wr.z);return this}applyNormalMatrix(e){for(let u=0,y=this.count;u<y;u++)wr.x=this.getX(u),wr.y=this.getY(u),wr.z=this.getZ(u),wr.applyNormalMatrix(e),this.setXYZ(u,wr.x,wr.y,wr.z);return this}transformDirection(e){for(let u=0,y=this.count;u<y;u++)wr.x=this.getX(u),wr.y=this.getY(u),wr.z=this.getZ(u),wr.transformDirection(e),this.setXYZ(u,wr.x,wr.y,wr.z);return this}set(e,u=0){return this.array.set(e,u),this}getX(e){return this.array[e*this.itemSize]}setX(e,u){return this.array[e*this.itemSize]=u,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,u){return this.array[e*this.itemSize+1]=u,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,u){return this.array[e*this.itemSize+2]=u,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,u){return this.array[e*this.itemSize+3]=u,this}setXY(e,u,y){return e*=this.itemSize,this.array[e+0]=u,this.array[e+1]=y,this}setXYZ(e,u,y,v){return e*=this.itemSize,this.array[e+0]=u,this.array[e+1]=y,this.array[e+2]=v,this}setXYZW(e,u,y,v,M){return e*=this.itemSize,this.array[e+0]=u,this.array[e+1]=y,this.array[e+2]=v,this.array[e+3]=M,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==35044&&(e.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(e.updateRange=this.updateRange),e}}Or.prototype.isBufferAttribute=!0;class so extends Or{constructor(e,u,y){super(new Int8Array(e),u,y)}}class io extends Or{constructor(e,u,y){super(new Uint8Array(e),u,y)}}class Ys extends Or{constructor(e,u,y){super(new Uint8ClampedArray(e),u,y)}}class Ga extends Or{constructor(e,u,y){super(new Int16Array(e),u,y)}}class So extends Or{constructor(e,u,y){super(new Uint16Array(e),u,y)}}class hs extends Or{constructor(e,u,y){super(new Int32Array(e),u,y)}}class Is extends Or{constructor(e,u,y){super(new Uint32Array(e),u,y)}}class ea extends Or{constructor(e,u,y){super(new Uint16Array(e),u,y)}}ea.prototype.isFloat16BufferAttribute=!0;class Un extends Or{constructor(e,u,y){super(new Float32Array(e),u,y)}}class vl extends Or{constructor(e,u,y){super(new Float64Array(e),u,y)}}function ya(S){if(S.length===0)return-1/0;let e=S[0];for(let u=1,y=S.length;u<y;++u)S[u]>e&&(e=S[u]);return e}const nc={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function va(S,e){return new nc[S](e)}let xl=0;const xa=new nr,bl=new Ee,Qu=new re,Ca=new dt,Zo=new dt,Xo=new re;class Pr extends It{constructor(){super(),Object.defineProperty(this,"id",{value:xl++}),this.uuid=_n(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ya(e)>65535?Is:So)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,u){return this.attributes[e]=u,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,u,y=0){this.groups.push({start:e,count:u,materialIndex:y})}clearGroups(){this.groups=[]}setDrawRange(e,u){this.drawRange.start=e,this.drawRange.count=u}applyMatrix4(e){const u=this.attributes.position;u!==void 0&&(u.applyMatrix4(e),u.needsUpdate=!0);const y=this.attributes.normal;if(y!==void 0){const M=new Wn().getNormalMatrix(e);y.applyNormalMatrix(M),y.needsUpdate=!0}const v=this.attributes.tangent;return v!==void 0&&(v.transformDirection(e),v.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return xa.makeRotationFromQuaternion(e),this.applyMatrix4(xa),this}rotateX(e){return xa.makeRotationX(e),this.applyMatrix4(xa),this}rotateY(e){return xa.makeRotationY(e),this.applyMatrix4(xa),this}rotateZ(e){return xa.makeRotationZ(e),this.applyMatrix4(xa),this}translate(e,u,y){return xa.makeTranslation(e,u,y),this.applyMatrix4(xa),this}scale(e,u,y){return xa.makeScale(e,u,y),this.applyMatrix4(xa),this}lookAt(e){return bl.lookAt(e),bl.updateMatrix(),this.applyMatrix4(bl.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qu).negate(),this.translate(Qu.x,Qu.y,Qu.z),this}setFromPoints(e){const u=[];for(let y=0,v=e.length;y<v;y++){const M=e[y];u.push(M.x,M.y,M.z||0)}return this.setAttribute("position",new Un(u,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new dt);const e=this.attributes.position,u=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new re(-1/0,-1/0,-1/0),new re(1/0,1/0,1/0));if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),u)for(let y=0,v=u.length;y<v;y++){const M=u[y];Ca.setFromBufferAttribute(M),this.morphTargetsRelative?(Xo.addVectors(this.boundingBox.min,Ca.min),this.boundingBox.expandByPoint(Xo),Xo.addVectors(this.boundingBox.max,Ca.max),this.boundingBox.expandByPoint(Xo)):(this.boundingBox.expandByPoint(Ca.min),this.boundingBox.expandByPoint(Ca.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ns);const e=this.attributes.position,u=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new re,1/0);if(e){const y=this.boundingSphere.center;if(Ca.setFromBufferAttribute(e),u)for(let M=0,O=u.length;M<O;M++){const V=u[M];Zo.setFromBufferAttribute(V),this.morphTargetsRelative?(Xo.addVectors(Ca.min,Zo.min),Ca.expandByPoint(Xo),Xo.addVectors(Ca.max,Zo.max),Ca.expandByPoint(Xo)):(Ca.expandByPoint(Zo.min),Ca.expandByPoint(Zo.max))}Ca.getCenter(y);let v=0;for(let M=0,O=e.count;M<O;M++)Xo.fromBufferAttribute(e,M),v=Math.max(v,y.distanceToSquared(Xo));if(u)for(let M=0,O=u.length;M<O;M++){const V=u[M],G=this.morphTargetsRelative;for(let H=0,Q=V.count;H<Q;H++)Xo.fromBufferAttribute(V,H),G&&(Qu.fromBufferAttribute(e,H),Xo.add(Qu)),v=Math.max(v,y.distanceToSquared(Xo))}this.boundingSphere.radius=Math.sqrt(v),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,u=this.attributes;if(e===null||u.position===void 0||u.normal===void 0||u.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const y=e.array,v=u.position.array,M=u.normal.array,O=u.uv.array,V=v.length/3;u.tangent===void 0&&this.setAttribute("tangent",new Or(new Float32Array(4*V),4));const G=u.tangent.array,H=[],Q=[];for(let Li=0;Li<V;Li++)H[Li]=new re,Q[Li]=new re;const ee=new re,se=new re,ae=new re,de=new en,be=new en,Re=new en,Te=new re,ct=new re;function Et(Li,ki,Zn){ee.fromArray(v,3*Li),se.fromArray(v,3*ki),ae.fromArray(v,3*Zn),de.fromArray(O,2*Li),be.fromArray(O,2*ki),Re.fromArray(O,2*Zn),se.sub(ee),ae.sub(ee),be.sub(de),Re.sub(de);const En=1/(be.x*Re.y-Re.x*be.y);isFinite(En)&&(Te.copy(se).multiplyScalar(Re.y).addScaledVector(ae,-be.y).multiplyScalar(En),ct.copy(ae).multiplyScalar(be.x).addScaledVector(se,-Re.x).multiplyScalar(En),H[Li].add(Te),H[ki].add(Te),H[Zn].add(Te),Q[Li].add(ct),Q[ki].add(ct),Q[Zn].add(ct))}let _t=this.groups;_t.length===0&&(_t=[{start:0,count:y.length}]);for(let Li=0,ki=_t.length;Li<ki;++Li){const Zn=_t[Li],En=Zn.start;for(let Ji=En,In=En+Zn.count;Ji<In;Ji+=3)Et(y[Ji+0],y[Ji+1],y[Ji+2])}const jt=new re,Xt=new re,_i=new re,vi=new re;function Bi(Li){_i.fromArray(M,3*Li),vi.copy(_i);const ki=H[Li];jt.copy(ki),jt.sub(_i.multiplyScalar(_i.dot(ki))).normalize(),Xt.crossVectors(vi,ki);const Zn=Xt.dot(Q[Li])<0?-1:1;G[4*Li]=jt.x,G[4*Li+1]=jt.y,G[4*Li+2]=jt.z,G[4*Li+3]=Zn}for(let Li=0,ki=_t.length;Li<ki;++Li){const Zn=_t[Li],En=Zn.start;for(let Ji=En,In=En+Zn.count;Ji<In;Ji+=3)Bi(y[Ji+0]),Bi(y[Ji+1]),Bi(y[Ji+2])}}computeVertexNormals(){const e=this.index,u=this.getAttribute("position");if(u!==void 0){let y=this.getAttribute("normal");if(y===void 0)y=new Or(new Float32Array(3*u.count),3),this.setAttribute("normal",y);else for(let se=0,ae=y.count;se<ae;se++)y.setXYZ(se,0,0,0);const v=new re,M=new re,O=new re,V=new re,G=new re,H=new re,Q=new re,ee=new re;if(e)for(let se=0,ae=e.count;se<ae;se+=3){const de=e.getX(se+0),be=e.getX(se+1),Re=e.getX(se+2);v.fromBufferAttribute(u,de),M.fromBufferAttribute(u,be),O.fromBufferAttribute(u,Re),Q.subVectors(O,M),ee.subVectors(v,M),Q.cross(ee),V.fromBufferAttribute(y,de),G.fromBufferAttribute(y,be),H.fromBufferAttribute(y,Re),V.add(Q),G.add(Q),H.add(Q),y.setXYZ(de,V.x,V.y,V.z),y.setXYZ(be,G.x,G.y,G.z),y.setXYZ(Re,H.x,H.y,H.z)}else for(let se=0,ae=u.count;se<ae;se+=3)v.fromBufferAttribute(u,se+0),M.fromBufferAttribute(u,se+1),O.fromBufferAttribute(u,se+2),Q.subVectors(O,M),ee.subVectors(v,M),Q.cross(ee),y.setXYZ(se+0,Q.x,Q.y,Q.z),y.setXYZ(se+1,Q.x,Q.y,Q.z),y.setXYZ(se+2,Q.x,Q.y,Q.z);this.normalizeNormals(),y.needsUpdate=!0}}merge(e,u){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);u===void 0&&(u=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const y=this.attributes;for(const v in y){if(e.attributes[v]===void 0)continue;const M=y[v].array,O=e.attributes[v],V=O.array,G=O.itemSize*u,H=Math.min(V.length,M.length-G);for(let Q=0,ee=G;Q<H;Q++,ee++)M[ee]=V[Q]}return this}normalizeNormals(){const e=this.attributes.normal;for(let u=0,y=e.count;u<y;u++)Xo.fromBufferAttribute(e,u),Xo.normalize(),e.setXYZ(u,Xo.x,Xo.y,Xo.z)}toNonIndexed(){function e(V,G){const H=V.array,Q=V.itemSize,ee=V.normalized,se=new H.constructor(G.length*Q);let ae=0,de=0;for(let be=0,Re=G.length;be<Re;be++){ae=V.isInterleavedBufferAttribute?G[be]*V.data.stride+V.offset:G[be]*Q;for(let Te=0;Te<Q;Te++)se[de++]=H[ae++]}return new Or(se,Q,ee)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const u=new Pr,y=this.index.array,v=this.attributes;for(const V in v){const G=e(v[V],y);u.setAttribute(V,G)}const M=this.morphAttributes;for(const V in M){const G=[],H=M[V];for(let Q=0,ee=H.length;Q<ee;Q++){const se=e(H[Q],y);G.push(se)}u.morphAttributes[V]=G}u.morphTargetsRelative=this.morphTargetsRelative;const O=this.groups;for(let V=0,G=O.length;V<G;V++){const H=O[V];u.addGroup(H.start,H.count,H.materialIndex)}return u}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const G=this.parameters;for(const H in G)G[H]!==void 0&&(e[H]=G[H]);return e}e.data={attributes:{}};const u=this.index;u!==null&&(e.data.index={type:u.array.constructor.name,array:Array.prototype.slice.call(u.array)});const y=this.attributes;for(const G in y){const H=y[G];e.data.attributes[G]=H.toJSON(e.data)}const v={};let M=!1;for(const G in this.morphAttributes){const H=this.morphAttributes[G],Q=[];for(let ee=0,se=H.length;ee<se;ee++){const ae=H[ee];Q.push(ae.toJSON(e.data))}Q.length>0&&(v[G]=Q,M=!0)}M&&(e.data.morphAttributes=v,e.data.morphTargetsRelative=this.morphTargetsRelative);const O=this.groups;O.length>0&&(e.data.groups=JSON.parse(JSON.stringify(O)));const V=this.boundingSphere;return V!==null&&(e.data.boundingSphere={center:V.center.toArray(),radius:V.radius}),e}clone(){return new Pr().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const u={};this.name=e.name;const y=e.index;y!==null&&this.setIndex(y.clone(u));const v=e.attributes;for(const H in v){const Q=v[H];this.setAttribute(H,Q.clone(u))}const M=e.morphAttributes;for(const H in M){const Q=[],ee=M[H];for(let se=0,ae=ee.length;se<ae;se++)Q.push(ee[se].clone(u));this.morphAttributes[H]=Q}this.morphTargetsRelative=e.morphTargetsRelative;const O=e.groups;for(let H=0,Q=O.length;H<Q;H++){const ee=O[H];this.addGroup(ee.start,ee.count,ee.materialIndex)}const V=e.boundingBox;V!==null&&(this.boundingBox=V.clone());const G=e.boundingSphere;return G!==null&&(this.boundingSphere=G.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}Pr.prototype.isBufferGeometry=!0;const hf=new nr,wl=new aa,Ic=new Ns,Rc=new re,nl=new re,La=new re,df=new re,Pc=new re,Zd=new re,mu=new re,ca=new re,Ir=new re,Xn=new en,eh=new en,hr=new en,ed=new re,Dc=new re;class qn extends Ee{constructor(e=new Pr,u=new ws){super(),this.type="Mesh",this.geometry=e,this.material=u,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const u=e.morphAttributes,y=Object.keys(u);if(y.length>0){const v=u[y[0]];if(v!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let M=0,O=v.length;M<O;M++){const V=v[M].name||String(M);this.morphTargetInfluences.push(0),this.morphTargetDictionary[V]=M}}}}else{const u=e.morphTargets;u!==void 0&&u.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,u){const y=this.geometry,v=this.material,M=this.matrixWorld;if(v===void 0||(y.boundingSphere===null&&y.computeBoundingSphere(),Ic.copy(y.boundingSphere),Ic.applyMatrix4(M),e.ray.intersectsSphere(Ic)===!1)||(hf.copy(M).invert(),wl.copy(e.ray).applyMatrix4(hf),y.boundingBox!==null&&wl.intersectsBox(y.boundingBox)===!1))return;let O;if(y.isBufferGeometry){const V=y.index,G=y.attributes.position,H=y.morphAttributes.position,Q=y.morphTargetsRelative,ee=y.attributes.uv,se=y.attributes.uv2,ae=y.groups,de=y.drawRange;if(V!==null)if(Array.isArray(v))for(let be=0,Re=ae.length;be<Re;be++){const Te=ae[be],ct=v[Te.materialIndex];for(let Et=Math.max(Te.start,de.start),_t=Math.min(Te.start+Te.count,de.start+de.count);Et<_t;Et+=3){const jt=V.getX(Et),Xt=V.getX(Et+1),_i=V.getX(Et+2);O=th(this,ct,e,wl,G,H,Q,ee,se,jt,Xt,_i),O&&(O.faceIndex=Math.floor(Et/3),O.face.materialIndex=Te.materialIndex,u.push(O))}}else for(let be=Math.max(0,de.start),Re=Math.min(V.count,de.start+de.count);be<Re;be+=3){const Te=V.getX(be),ct=V.getX(be+1),Et=V.getX(be+2);O=th(this,v,e,wl,G,H,Q,ee,se,Te,ct,Et),O&&(O.faceIndex=Math.floor(be/3),u.push(O))}else if(G!==void 0)if(Array.isArray(v))for(let be=0,Re=ae.length;be<Re;be++){const Te=ae[be],ct=v[Te.materialIndex];for(let Et=Math.max(Te.start,de.start),_t=Math.min(Te.start+Te.count,de.start+de.count);Et<_t;Et+=3)O=th(this,ct,e,wl,G,H,Q,ee,se,Et,Et+1,Et+2),O&&(O.faceIndex=Math.floor(Et/3),O.face.materialIndex=Te.materialIndex,u.push(O))}else for(let be=Math.max(0,de.start),Re=Math.min(G.count,de.start+de.count);be<Re;be+=3)O=th(this,v,e,wl,G,H,Q,ee,se,be,be+1,be+2),O&&(O.faceIndex=Math.floor(be/3),u.push(O))}else y.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function th(S,e,u,y,v,M,O,V,G,H,Q,ee){Rc.fromBufferAttribute(v,H),nl.fromBufferAttribute(v,Q),La.fromBufferAttribute(v,ee);const se=S.morphTargetInfluences;if(M&&se){mu.set(0,0,0),ca.set(0,0,0),Ir.set(0,0,0);for(let de=0,be=M.length;de<be;de++){const Re=se[de],Te=M[de];Re!==0&&(df.fromBufferAttribute(Te,H),Pc.fromBufferAttribute(Te,Q),Zd.fromBufferAttribute(Te,ee),O?(mu.addScaledVector(df,Re),ca.addScaledVector(Pc,Re),Ir.addScaledVector(Zd,Re)):(mu.addScaledVector(df.sub(Rc),Re),ca.addScaledVector(Pc.sub(nl),Re),Ir.addScaledVector(Zd.sub(La),Re)))}Rc.add(mu),nl.add(ca),La.add(Ir)}S.isSkinnedMesh&&(S.boneTransform(H,Rc),S.boneTransform(Q,nl),S.boneTransform(ee,La));const ae=function(de,be,Re,Te,ct,Et,_t,jt){let Xt;if(Xt=be.side===1?Te.intersectTriangle(_t,Et,ct,!0,jt):Te.intersectTriangle(ct,Et,_t,be.side!==2,jt),Xt===null)return null;Dc.copy(jt),Dc.applyMatrix4(de.matrixWorld);const _i=Re.ray.origin.distanceTo(Dc);return _i<Re.near||_i>Re.far?null:{distance:_i,point:Dc.clone(),object:de}}(S,e,u,y,Rc,nl,La,ed);if(ae){V&&(Xn.fromBufferAttribute(V,H),eh.fromBufferAttribute(V,Q),hr.fromBufferAttribute(V,ee),ae.uv=Ei.getUV(ed,Rc,nl,La,Xn,eh,hr,new en)),G&&(Xn.fromBufferAttribute(G,H),eh.fromBufferAttribute(G,Q),hr.fromBufferAttribute(G,ee),ae.uv2=Ei.getUV(ed,Rc,nl,La,Xn,eh,hr,new en));const de={a:H,b:Q,c:ee,normal:new re,materialIndex:0};Ei.getNormal(Rc,nl,La,de.normal),ae.face=de}return ae}qn.prototype.isMesh=!0;class rl extends Pr{constructor(e=1,u=1,y=1,v=1,M=1,O=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:u,depth:y,widthSegments:v,heightSegments:M,depthSegments:O};const V=this;v=Math.floor(v),M=Math.floor(M),O=Math.floor(O);const G=[],H=[],Q=[],ee=[];let se=0,ae=0;function de(be,Re,Te,ct,Et,_t,jt,Xt,_i,vi,Bi){const Li=_t/_i,ki=jt/vi,Zn=_t/2,En=jt/2,Ji=Xt/2,In=_i+1,ir=vi+1;let rr=0,vr=0;const kr=new re;for(let Fr=0;Fr<ir;Fr++){const Rn=Fr*ki-En;for(let $t=0;$t<In;$t++){const ii=$t*Li-Zn;kr[be]=ii*ct,kr[Re]=Rn*Et,kr[Te]=Ji,H.push(kr.x,kr.y,kr.z),kr[be]=0,kr[Re]=0,kr[Te]=Xt>0?1:-1,Q.push(kr.x,kr.y,kr.z),ee.push($t/_i),ee.push(1-Fr/vi),rr+=1}}for(let Fr=0;Fr<vi;Fr++)for(let Rn=0;Rn<_i;Rn++){const $t=se+Rn+In*Fr,ii=se+Rn+In*(Fr+1),Qi=se+(Rn+1)+In*(Fr+1),ji=se+(Rn+1)+In*Fr;G.push($t,ii,ji),G.push(ii,Qi,ji),vr+=6}V.addGroup(ae,vr,Bi),ae+=vr,se+=rr}de("z","y","x",-1,-1,y,u,e,O,M,0),de("z","y","x",1,-1,y,u,-e,O,M,1),de("x","z","y",1,1,e,y,u,v,O,2),de("x","z","y",1,-1,e,y,-u,v,O,3),de("x","y","z",1,-1,e,u,y,v,M,4),de("x","y","z",-1,-1,e,u,-y,v,M,5),this.setIndex(G),this.setAttribute("position",new Un(H,3)),this.setAttribute("normal",new Un(Q,3)),this.setAttribute("uv",new Un(ee,2))}static fromJSON(e){return new rl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Oc(S){const e={};for(const u in S){e[u]={};for(const y in S[u]){const v=S[u][y];v&&(v.isColor||v.isMatrix3||v.isMatrix4||v.isVector2||v.isVector3||v.isVector4||v.isTexture||v.isQuaternion)?e[u][y]=v.clone():Array.isArray(v)?e[u][y]=v.slice():e[u][y]=v}}return e}function yo(S){const e={};for(let u=0;u<S.length;u++){const y=Oc(S[u]);for(const v in y)e[v]=y[v]}return e}const zc={clone:Oc,merge:yo};class co extends Vi{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Oc(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const u=super.toJSON(e);u.glslVersion=this.glslVersion,u.uniforms={};for(const v in this.uniforms){const M=this.uniforms[v].value;M&&M.isTexture?u.uniforms[v]={type:"t",value:M.toJSON(e).uuid}:M&&M.isColor?u.uniforms[v]={type:"c",value:M.getHex()}:M&&M.isVector2?u.uniforms[v]={type:"v2",value:M.toArray()}:M&&M.isVector3?u.uniforms[v]={type:"v3",value:M.toArray()}:M&&M.isVector4?u.uniforms[v]={type:"v4",value:M.toArray()}:M&&M.isMatrix3?u.uniforms[v]={type:"m3",value:M.toArray()}:M&&M.isMatrix4?u.uniforms[v]={type:"m4",value:M.toArray()}:u.uniforms[v]={value:M}}Object.keys(this.defines).length>0&&(u.defines=this.defines),u.vertexShader=this.vertexShader,u.fragmentShader=this.fragmentShader;const y={};for(const v in this.extensions)this.extensions[v]===!0&&(y[v]=!0);return Object.keys(y).length>0&&(u.extensions=y),u}}co.prototype.isShaderMaterial=!0;class kc extends Ee{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new nr,this.projectionMatrix=new nr,this.projectionMatrixInverse=new nr}copy(e,u){return super.copy(e,u),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const u=this.matrixWorld.elements;return e.set(-u[8],-u[9],-u[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,u){super.updateWorldMatrix(e,u),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}kc.prototype.isCamera=!0;class vo extends kc{constructor(e=50,u=1,y=.1,v=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=y,this.far=v,this.focus=10,this.aspect=u,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,u){return super.copy(e,u),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const u=.5*this.getFilmHeight()/e;this.fov=2*cn*Math.atan(u),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*an*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*cn*Math.atan(Math.tan(.5*an*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,u,y,v,M,O){this.aspect=e/u,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=u,this.view.offsetX=y,this.view.offsetY=v,this.view.width=M,this.view.height=O,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let u=e*Math.tan(.5*an*this.fov)/this.zoom,y=2*u,v=this.aspect*y,M=-.5*v;const O=this.view;if(this.view!==null&&this.view.enabled){const G=O.fullWidth,H=O.fullHeight;M+=O.offsetX*v/G,u-=O.offsetY*y/H,v*=O.width/G,y*=O.height/H}const V=this.filmOffset;V!==0&&(M+=e*V/this.getFilmWidth()),this.projectionMatrix.makePerspective(M,M+v,u,u-y,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const u=super.toJSON(e);return u.object.fov=this.fov,u.object.zoom=this.zoom,u.object.near=this.near,u.object.far=this.far,u.object.focus=this.focus,u.object.aspect=this.aspect,this.view!==null&&(u.object.view=Object.assign({},this.view)),u.object.filmGauge=this.filmGauge,u.object.filmOffset=this.filmOffset,u}}vo.prototype.isPerspectiveCamera=!0;const Tl=90;class gu extends Ee{constructor(e,u,y){if(super(),this.type="CubeCamera",y.isWebGLCubeRenderTarget!==!0)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=y;const v=new vo(Tl,1,e,u);v.layers=this.layers,v.up.set(0,-1,0),v.lookAt(new re(1,0,0)),this.add(v);const M=new vo(Tl,1,e,u);M.layers=this.layers,M.up.set(0,-1,0),M.lookAt(new re(-1,0,0)),this.add(M);const O=new vo(Tl,1,e,u);O.layers=this.layers,O.up.set(0,0,1),O.lookAt(new re(0,1,0)),this.add(O);const V=new vo(Tl,1,e,u);V.layers=this.layers,V.up.set(0,0,-1),V.lookAt(new re(0,-1,0)),this.add(V);const G=new vo(Tl,1,e,u);G.layers=this.layers,G.up.set(0,-1,0),G.lookAt(new re(0,0,1)),this.add(G);const H=new vo(Tl,1,e,u);H.layers=this.layers,H.up.set(0,-1,0),H.lookAt(new re(0,0,-1)),this.add(H)}update(e,u){this.parent===null&&this.updateMatrixWorld();const y=this.renderTarget,[v,M,O,V,G,H]=this.children,Q=e.xr.enabled,ee=e.getRenderTarget();e.xr.enabled=!1;const se=y.texture.generateMipmaps;y.texture.generateMipmaps=!1,e.setRenderTarget(y,0),e.render(u,v),e.setRenderTarget(y,1),e.render(u,M),e.setRenderTarget(y,2),e.render(u,O),e.setRenderTarget(y,3),e.render(u,V),e.setRenderTarget(y,4),e.render(u,G),y.texture.generateMipmaps=se,e.setRenderTarget(y,5),e.render(u,H),e.setRenderTarget(ee),e.xr.enabled=Q}}class Ia extends _s{constructor(e,u,y,v,M,O,V,G,H,Q){super(e=e!==void 0?e:[],u=u!==void 0?u:301,y,v,M,O,V=V!==void 0?V:1022,G,H,Q),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ia.prototype.isCubeTexture=!0;class Ks extends ro{constructor(e,u,y){Number.isInteger(u)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),u=y),super(e,e,u),u=u||{},this.texture=new Ia(void 0,u.mapping,u.wrapS,u.wrapT,u.magFilter,u.minFilter,u.format,u.type,u.anisotropy,u.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=u.generateMipmaps!==void 0&&u.generateMipmaps,this.texture.minFilter=u.minFilter!==void 0?u.minFilter:1006,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,u){this.texture.type=u.type,this.texture.format=1023,this.texture.encoding=u.encoding,this.texture.generateMipmaps=u.generateMipmaps,this.texture.minFilter=u.minFilter,this.texture.magFilter=u.magFilter;const y={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},v=new rl(5,5,5),M=new co({name:"CubemapFromEquirect",uniforms:Oc(y.uniforms),vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,side:1,blending:0});M.uniforms.tEquirect.value=u;const O=new qn(v,M),V=u.minFilter;return u.minFilter===1008&&(u.minFilter=1006),new gu(1,10,this).update(e,O),u.minFilter=V,O.geometry.dispose(),O.material.dispose(),this}clear(e,u,y,v){const M=e.getRenderTarget();for(let O=0;O<6;O++)e.setRenderTarget(this,O),e.clear(u,y,v);e.setRenderTarget(M)}}Ks.prototype.isWebGLCubeRenderTarget=!0;const td=new re,un=new re,Fm=new Wn;class ba{constructor(e=new re(1,0,0),u=0){this.normal=e,this.constant=u}set(e,u){return this.normal.copy(e),this.constant=u,this}setComponents(e,u,y,v){return this.normal.set(e,u,y),this.constant=v,this}setFromNormalAndCoplanarPoint(e,u){return this.normal.copy(e),this.constant=-u.dot(this.normal),this}setFromCoplanarPoints(e,u,y){const v=td.subVectors(y,u).cross(un.subVectors(e,u)).normalize();return this.setFromNormalAndCoplanarPoint(v,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,u){return u.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,u){const y=e.delta(td),v=this.normal.dot(y);if(v===0)return this.distanceToPoint(e.start)===0?u.copy(e.start):null;const M=-(e.start.dot(this.normal)+this.constant)/v;return M<0||M>1?null:u.copy(y).multiplyScalar(M).add(e.start)}intersectsLine(e){const u=this.distanceToPoint(e.start),y=this.distanceToPoint(e.end);return u<0&&y>0||y<0&&u>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,u){const y=u||Fm.getNormalMatrix(e),v=this.coplanarPoint(td).applyMatrix4(e),M=this.normal.applyMatrix3(y).normalize();return this.constant=-v.dot(M),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}ba.prototype.isPlane=!0;const rc=new Ns,_u=new re;class Fc{constructor(e=new ba,u=new ba,y=new ba,v=new ba,M=new ba,O=new ba){this.planes=[e,u,y,v,M,O]}set(e,u,y,v,M,O){const V=this.planes;return V[0].copy(e),V[1].copy(u),V[2].copy(y),V[3].copy(v),V[4].copy(M),V[5].copy(O),this}copy(e){const u=this.planes;for(let y=0;y<6;y++)u[y].copy(e.planes[y]);return this}setFromProjectionMatrix(e){const u=this.planes,y=e.elements,v=y[0],M=y[1],O=y[2],V=y[3],G=y[4],H=y[5],Q=y[6],ee=y[7],se=y[8],ae=y[9],de=y[10],be=y[11],Re=y[12],Te=y[13],ct=y[14],Et=y[15];return u[0].setComponents(V-v,ee-G,be-se,Et-Re).normalize(),u[1].setComponents(V+v,ee+G,be+se,Et+Re).normalize(),u[2].setComponents(V+M,ee+H,be+ae,Et+Te).normalize(),u[3].setComponents(V-M,ee-H,be-ae,Et-Te).normalize(),u[4].setComponents(V-O,ee-Q,be-de,Et-ct).normalize(),u[5].setComponents(V+O,ee+Q,be+de,Et+ct).normalize(),this}intersectsObject(e){const u=e.geometry;return u.boundingSphere===null&&u.computeBoundingSphere(),rc.copy(u.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(rc)}intersectsSprite(e){return rc.center.set(0,0,0),rc.radius=.7071067811865476,rc.applyMatrix4(e.matrixWorld),this.intersectsSphere(rc)}intersectsSphere(e){const u=this.planes,y=e.center,v=-e.radius;for(let M=0;M<6;M++)if(u[M].distanceToPoint(y)<v)return!1;return!0}intersectsBox(e){const u=this.planes;for(let y=0;y<6;y++){const v=u[y];if(_u.x=v.normal.x>0?e.max.x:e.min.x,_u.y=v.normal.y>0?e.max.y:e.min.y,_u.z=v.normal.z>0?e.max.z:e.min.z,v.distanceToPoint(_u)<0)return!1}return!0}containsPoint(e){const u=this.planes;for(let y=0;y<6;y++)if(u[y].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function jl(){let S=null,e=!1,u=null,y=null;function v(M,O){u(M,O),y=S.requestAnimationFrame(v)}return{start:function(){e!==!0&&u!==null&&(y=S.requestAnimationFrame(v),e=!0)},stop:function(){S.cancelAnimationFrame(y),e=!1},setAnimationLoop:function(M){u=M},setContext:function(M){S=M}}}function pf(S,e){const u=e.isWebGL2,y=new WeakMap;return{get:function(v){return v.isInterleavedBufferAttribute&&(v=v.data),y.get(v)},remove:function(v){v.isInterleavedBufferAttribute&&(v=v.data);const M=y.get(v);M&&(S.deleteBuffer(M.buffer),y.delete(v))},update:function(v,M){if(v.isGLBufferAttribute){const V=y.get(v);return void((!V||V.version<v.version)&&y.set(v,{buffer:v.buffer,type:v.type,bytesPerElement:v.elementSize,version:v.version}))}v.isInterleavedBufferAttribute&&(v=v.data);const O=y.get(v);O===void 0?y.set(v,function(V,G){const H=V.array,Q=V.usage,ee=S.createBuffer();S.bindBuffer(G,ee),S.bufferData(G,H,Q),V.onUploadCallback();let se=5126;return H instanceof Float32Array?se=5126:H instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):H instanceof Uint16Array?V.isFloat16BufferAttribute?u?se=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):se=5123:H instanceof Int16Array?se=5122:H instanceof Uint32Array?se=5125:H instanceof Int32Array?se=5124:H instanceof Int8Array?se=5120:(H instanceof Uint8Array||H instanceof Uint8ClampedArray)&&(se=5121),{buffer:ee,type:se,bytesPerElement:H.BYTES_PER_ELEMENT,version:V.version}}(v,M)):O.version<v.version&&(function(V,G,H){const Q=G.array,ee=G.updateRange;S.bindBuffer(H,V),ee.count===-1?S.bufferSubData(H,0,Q):(u?S.bufferSubData(H,ee.offset*Q.BYTES_PER_ELEMENT,Q,ee.offset,ee.count):S.bufferSubData(H,ee.offset*Q.BYTES_PER_ELEMENT,Q.subarray(ee.offset,ee.offset+ee.count)),ee.count=-1)}(O.buffer,v,M),O.version=v.version)}}}class Go extends Pr{constructor(e=1,u=1,y=1,v=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:u,widthSegments:y,heightSegments:v};const M=e/2,O=u/2,V=Math.floor(y),G=Math.floor(v),H=V+1,Q=G+1,ee=e/V,se=u/G,ae=[],de=[],be=[],Re=[];for(let Te=0;Te<Q;Te++){const ct=Te*se-O;for(let Et=0;Et<H;Et++){const _t=Et*ee-M;de.push(_t,-ct,0),be.push(0,0,1),Re.push(Et/V),Re.push(1-Te/G)}}for(let Te=0;Te<G;Te++)for(let ct=0;ct<V;ct++){const Et=ct+H*Te,_t=ct+H*(Te+1),jt=ct+1+H*(Te+1),Xt=ct+1+H*Te;ae.push(Et,_t,Xt),ae.push(_t,jt,Xt)}this.setIndex(ae),this.setAttribute("position",new Un(de,3)),this.setAttribute("normal",new Un(be,3)),this.setAttribute("uv",new Un(Re,2))}static fromJSON(e){return new Go(e.width,e.height,e.widthSegments,e.heightSegments)}}const os={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotVH = saturate( dot( geometry.viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float NoH ) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float NoV, float NoL ) {
	return saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );
}
vec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in GeometricContext geometry ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularTintFactor = specularTint;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARTINTMAP
			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularTintFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenTint = sheenTint;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenTint;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationTint, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = transmission.a;
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationTint;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularTint;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARTINTMAP
		uniform sampler2D specularTintMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenTint;
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},Qn={common:{diffuse:{value:new wn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Wn},uv2Transform:{value:new Wn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new en(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new wn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new wn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wn}},sprite:{diffuse:{value:new wn(16777215)},opacity:{value:1},center:{value:new en(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wn}}},sl={basic:{uniforms:yo([Qn.common,Qn.specularmap,Qn.envmap,Qn.aomap,Qn.lightmap,Qn.fog]),vertexShader:os.meshbasic_vert,fragmentShader:os.meshbasic_frag},lambert:{uniforms:yo([Qn.common,Qn.specularmap,Qn.envmap,Qn.aomap,Qn.lightmap,Qn.emissivemap,Qn.fog,Qn.lights,{emissive:{value:new wn(0)}}]),vertexShader:os.meshlambert_vert,fragmentShader:os.meshlambert_frag},phong:{uniforms:yo([Qn.common,Qn.specularmap,Qn.envmap,Qn.aomap,Qn.lightmap,Qn.emissivemap,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,Qn.fog,Qn.lights,{emissive:{value:new wn(0)},specular:{value:new wn(1118481)},shininess:{value:30}}]),vertexShader:os.meshphong_vert,fragmentShader:os.meshphong_frag},standard:{uniforms:yo([Qn.common,Qn.envmap,Qn.aomap,Qn.lightmap,Qn.emissivemap,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,Qn.roughnessmap,Qn.metalnessmap,Qn.fog,Qn.lights,{emissive:{value:new wn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:os.meshphysical_vert,fragmentShader:os.meshphysical_frag},toon:{uniforms:yo([Qn.common,Qn.aomap,Qn.lightmap,Qn.emissivemap,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,Qn.gradientmap,Qn.fog,Qn.lights,{emissive:{value:new wn(0)}}]),vertexShader:os.meshtoon_vert,fragmentShader:os.meshtoon_frag},matcap:{uniforms:yo([Qn.common,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,Qn.fog,{matcap:{value:null}}]),vertexShader:os.meshmatcap_vert,fragmentShader:os.meshmatcap_frag},points:{uniforms:yo([Qn.points,Qn.fog]),vertexShader:os.points_vert,fragmentShader:os.points_frag},dashed:{uniforms:yo([Qn.common,Qn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:os.linedashed_vert,fragmentShader:os.linedashed_frag},depth:{uniforms:yo([Qn.common,Qn.displacementmap]),vertexShader:os.depth_vert,fragmentShader:os.depth_frag},normal:{uniforms:yo([Qn.common,Qn.bumpmap,Qn.normalmap,Qn.displacementmap,{opacity:{value:1}}]),vertexShader:os.meshnormal_vert,fragmentShader:os.meshnormal_frag},sprite:{uniforms:yo([Qn.sprite,Qn.fog]),vertexShader:os.sprite_vert,fragmentShader:os.sprite_frag},background:{uniforms:{uvTransform:{value:new Wn},t2D:{value:null}},vertexShader:os.background_vert,fragmentShader:os.background_frag},cube:{uniforms:yo([Qn.envmap,{opacity:{value:1}}]),vertexShader:os.cube_vert,fragmentShader:os.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:os.equirect_vert,fragmentShader:os.equirect_frag},distanceRGBA:{uniforms:yo([Qn.common,Qn.displacementmap,{referencePosition:{value:new re},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:os.distanceRGBA_vert,fragmentShader:os.distanceRGBA_frag},shadow:{uniforms:yo([Qn.lights,Qn.fog,{color:{value:new wn(0)},opacity:{value:1}}]),vertexShader:os.shadow_vert,fragmentShader:os.shadow_frag}};function Bm(S,e,u,y,v){const M=new wn(0);let O,V,G=0,H=null,Q=0,ee=null;function se(ae,de){u.buffers.color.setClear(ae.r,ae.g,ae.b,de,v)}return{getClearColor:function(){return M},setClearColor:function(ae,de=1){M.set(ae),G=de,se(M,G)},getClearAlpha:function(){return G},setClearAlpha:function(ae){G=ae,se(M,G)},render:function(ae,de){let be=!1,Re=de.isScene===!0?de.background:null;Re&&Re.isTexture&&(Re=e.get(Re));const Te=S.xr,ct=Te.getSession&&Te.getSession();ct&&ct.environmentBlendMode==="additive"&&(Re=null),Re===null?se(M,G):Re&&Re.isColor&&(se(Re,1),be=!0),(S.autoClear||be)&&S.clear(S.autoClearColor,S.autoClearDepth,S.autoClearStencil),Re&&(Re.isCubeTexture||Re.mapping===306)?(V===void 0&&(V=new qn(new rl(1,1,1),new co({name:"BackgroundCubeMaterial",uniforms:Oc(sl.cube.uniforms),vertexShader:sl.cube.vertexShader,fragmentShader:sl.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),V.geometry.deleteAttribute("normal"),V.geometry.deleteAttribute("uv"),V.onBeforeRender=function(Et,_t,jt){this.matrixWorld.copyPosition(jt.matrixWorld)},Object.defineProperty(V.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),y.update(V)),V.material.uniforms.envMap.value=Re,V.material.uniforms.flipEnvMap.value=Re.isCubeTexture&&Re.isRenderTargetTexture===!1?-1:1,H===Re&&Q===Re.version&&ee===S.toneMapping||(V.material.needsUpdate=!0,H=Re,Q=Re.version,ee=S.toneMapping),ae.unshift(V,V.geometry,V.material,0,0,null)):Re&&Re.isTexture&&(O===void 0&&(O=new qn(new Go(2,2),new co({name:"BackgroundMaterial",uniforms:Oc(sl.background.uniforms),vertexShader:sl.background.vertexShader,fragmentShader:sl.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),O.geometry.deleteAttribute("normal"),Object.defineProperty(O.material,"map",{get:function(){return this.uniforms.t2D.value}}),y.update(O)),O.material.uniforms.t2D.value=Re,Re.matrixAutoUpdate===!0&&Re.updateMatrix(),O.material.uniforms.uvTransform.value.copy(Re.matrix),H===Re&&Q===Re.version&&ee===S.toneMapping||(O.material.needsUpdate=!0,H=Re,Q=Re.version,ee=S.toneMapping),ae.unshift(O,O.geometry,O.material,0,0,null))}}}function Ha(S,e,u,y){const v=S.getParameter(34921),M=y.isWebGL2?null:e.get("OES_vertex_array_object"),O=y.isWebGL2||M!==null,V={},G=se(null);let H=G;function Q(_t){return y.isWebGL2?S.bindVertexArray(_t):M.bindVertexArrayOES(_t)}function ee(_t){return y.isWebGL2?S.deleteVertexArray(_t):M.deleteVertexArrayOES(_t)}function se(_t){const jt=[],Xt=[],_i=[];for(let vi=0;vi<v;vi++)jt[vi]=0,Xt[vi]=0,_i[vi]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:jt,enabledAttributes:Xt,attributeDivisors:_i,object:_t,attributes:{},index:null}}function ae(){const _t=H.newAttributes;for(let jt=0,Xt=_t.length;jt<Xt;jt++)_t[jt]=0}function de(_t){be(_t,0)}function be(_t,jt){const Xt=H.newAttributes,_i=H.enabledAttributes,vi=H.attributeDivisors;Xt[_t]=1,_i[_t]===0&&(S.enableVertexAttribArray(_t),_i[_t]=1),vi[_t]!==jt&&((y.isWebGL2?S:e.get("ANGLE_instanced_arrays"))[y.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](_t,jt),vi[_t]=jt)}function Re(){const _t=H.newAttributes,jt=H.enabledAttributes;for(let Xt=0,_i=jt.length;Xt<_i;Xt++)jt[Xt]!==_t[Xt]&&(S.disableVertexAttribArray(Xt),jt[Xt]=0)}function Te(_t,jt,Xt,_i,vi,Bi){y.isWebGL2!==!0||Xt!==5124&&Xt!==5125?S.vertexAttribPointer(_t,jt,Xt,_i,vi,Bi):S.vertexAttribIPointer(_t,jt,Xt,vi,Bi)}function ct(){Et(),H!==G&&(H=G,Q(H.object))}function Et(){G.geometry=null,G.program=null,G.wireframe=!1}return{setup:function(_t,jt,Xt,_i,vi){let Bi=!1;if(O){const Li=function(ki,Zn,En){const Ji=En.wireframe===!0;let In=V[ki.id];In===void 0&&(In={},V[ki.id]=In);let ir=In[Zn.id];ir===void 0&&(ir={},In[Zn.id]=ir);let rr=ir[Ji];return rr===void 0&&(rr=se(y.isWebGL2?S.createVertexArray():M.createVertexArrayOES()),ir[Ji]=rr),rr}(_i,Xt,jt);H!==Li&&(H=Li,Q(H.object)),Bi=function(ki,Zn){const En=H.attributes,Ji=ki.attributes;let In=0;for(const ir in Ji){const rr=En[ir],vr=Ji[ir];if(rr===void 0||rr.attribute!==vr||rr.data!==vr.data)return!0;In++}return H.attributesNum!==In||H.index!==Zn}(_i,vi),Bi&&function(ki,Zn){const En={},Ji=ki.attributes;let In=0;for(const ir in Ji){const rr=Ji[ir],vr={};vr.attribute=rr,rr.data&&(vr.data=rr.data),En[ir]=vr,In++}H.attributes=En,H.attributesNum=In,H.index=Zn}(_i,vi)}else{const Li=jt.wireframe===!0;H.geometry===_i.id&&H.program===Xt.id&&H.wireframe===Li||(H.geometry=_i.id,H.program=Xt.id,H.wireframe=Li,Bi=!0)}_t.isInstancedMesh===!0&&(Bi=!0),vi!==null&&u.update(vi,34963),Bi&&(function(Li,ki,Zn,En){if(y.isWebGL2===!1&&(Li.isInstancedMesh||En.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;ae();const Ji=En.attributes,In=Zn.getAttributes(),ir=ki.defaultAttributeValues;for(const rr in In){const vr=In[rr];if(vr.location>=0){let kr=Ji[rr];if(kr===void 0&&(rr==="instanceMatrix"&&Li.instanceMatrix&&(kr=Li.instanceMatrix),rr==="instanceColor"&&Li.instanceColor&&(kr=Li.instanceColor)),kr!==void 0){const Fr=kr.normalized,Rn=kr.itemSize,$t=u.get(kr);if($t===void 0)continue;const ii=$t.buffer,Qi=$t.type,ji=$t.bytesPerElement;if(kr.isInterleavedBufferAttribute){const Oi=kr.data,Nn=Oi.stride,Hn=kr.offset;if(Oi&&Oi.isInstancedInterleavedBuffer){for(let Ni=0;Ni<vr.locationSize;Ni++)be(vr.location+Ni,Oi.meshPerAttribute);Li.isInstancedMesh!==!0&&En._maxInstanceCount===void 0&&(En._maxInstanceCount=Oi.meshPerAttribute*Oi.count)}else for(let Ni=0;Ni<vr.locationSize;Ni++)de(vr.location+Ni);S.bindBuffer(34962,ii);for(let Ni=0;Ni<vr.locationSize;Ni++)Te(vr.location+Ni,Rn/vr.locationSize,Qi,Fr,Nn*ji,(Hn+Rn/vr.locationSize*Ni)*ji)}else{if(kr.isInstancedBufferAttribute){for(let Oi=0;Oi<vr.locationSize;Oi++)be(vr.location+Oi,kr.meshPerAttribute);Li.isInstancedMesh!==!0&&En._maxInstanceCount===void 0&&(En._maxInstanceCount=kr.meshPerAttribute*kr.count)}else for(let Oi=0;Oi<vr.locationSize;Oi++)de(vr.location+Oi);S.bindBuffer(34962,ii);for(let Oi=0;Oi<vr.locationSize;Oi++)Te(vr.location+Oi,Rn/vr.locationSize,Qi,Fr,Rn*ji,Rn/vr.locationSize*Oi*ji)}}else if(ir!==void 0){const Fr=ir[rr];if(Fr!==void 0)switch(Fr.length){case 2:S.vertexAttrib2fv(vr.location,Fr);break;case 3:S.vertexAttrib3fv(vr.location,Fr);break;case 4:S.vertexAttrib4fv(vr.location,Fr);break;default:S.vertexAttrib1fv(vr.location,Fr)}}}}Re()}(_t,jt,Xt,_i),vi!==null&&S.bindBuffer(34963,u.get(vi).buffer))},reset:ct,resetDefaultState:Et,dispose:function(){ct();for(const _t in V){const jt=V[_t];for(const Xt in jt){const _i=jt[Xt];for(const vi in _i)ee(_i[vi].object),delete _i[vi];delete jt[Xt]}delete V[_t]}},releaseStatesOfGeometry:function(_t){if(V[_t.id]===void 0)return;const jt=V[_t.id];for(const Xt in jt){const _i=jt[Xt];for(const vi in _i)ee(_i[vi].object),delete _i[vi];delete jt[Xt]}delete V[_t.id]},releaseStatesOfProgram:function(_t){for(const jt in V){const Xt=V[jt];if(Xt[_t.id]===void 0)continue;const _i=Xt[_t.id];for(const vi in _i)ee(_i[vi].object),delete _i[vi];delete Xt[_t.id]}},initAttributes:ae,enableAttribute:de,disableUnusedAttributes:Re}}function Nm(S,e,u,y){const v=y.isWebGL2;let M;this.setMode=function(O){M=O},this.render=function(O,V){S.drawArrays(M,O,V),u.update(V,M,1)},this.renderInstances=function(O,V,G){if(G===0)return;let H,Q;if(v)H=S,Q="drawArraysInstanced";else if(H=e.get("ANGLE_instanced_arrays"),Q="drawArraysInstancedANGLE",H===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");H[Q](M,O,V,G),u.update(V,M,G)}}function ff(S,e,u){let y;function v(_t){if(_t==="highp"){if(S.getShaderPrecisionFormat(35633,36338).precision>0&&S.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";_t="mediump"}return _t==="mediump"&&S.getShaderPrecisionFormat(35633,36337).precision>0&&S.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const M=typeof WebGL2RenderingContext<"u"&&S instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&S instanceof WebGL2ComputeRenderingContext;let O=u.precision!==void 0?u.precision:"highp";const V=v(O);V!==O&&(console.warn("THREE.WebGLRenderer:",O,"not supported, using",V,"instead."),O=V);const G=M||e.has("WEBGL_draw_buffers"),H=u.logarithmicDepthBuffer===!0,Q=S.getParameter(34930),ee=S.getParameter(35660),se=S.getParameter(3379),ae=S.getParameter(34076),de=S.getParameter(34921),be=S.getParameter(36347),Re=S.getParameter(36348),Te=S.getParameter(36349),ct=ee>0,Et=M||e.has("OES_texture_float");return{isWebGL2:M,drawBuffers:G,getMaxAnisotropy:function(){if(y!==void 0)return y;if(e.has("EXT_texture_filter_anisotropic")===!0){const _t=e.get("EXT_texture_filter_anisotropic");y=S.getParameter(_t.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else y=0;return y},getMaxPrecision:v,precision:O,logarithmicDepthBuffer:H,maxTextures:Q,maxVertexTextures:ee,maxTextureSize:se,maxCubemapSize:ae,maxAttributes:de,maxVertexUniforms:be,maxVaryings:Re,maxFragmentUniforms:Te,vertexTextures:ct,floatFragmentTextures:Et,floatVertexTextures:ct&&Et,maxSamples:M?S.getParameter(36183):0}}function mf(S){const e=this;let u=null,y=0,v=!1,M=!1;const O=new ba,V=new Wn,G={value:null,needsUpdate:!1};function H(){G.value!==u&&(G.value=u,G.needsUpdate=y>0),e.numPlanes=y,e.numIntersection=0}function Q(ee,se,ae,de){const be=ee!==null?ee.length:0;let Re=null;if(be!==0){if(Re=G.value,de!==!0||Re===null){const Te=ae+4*be,ct=se.matrixWorldInverse;V.getNormalMatrix(ct),(Re===null||Re.length<Te)&&(Re=new Float32Array(Te));for(let Et=0,_t=ae;Et!==be;++Et,_t+=4)O.copy(ee[Et]).applyMatrix4(ct,V),O.normal.toArray(Re,_t),Re[_t+3]=O.constant}G.value=Re,G.needsUpdate=!0}return e.numPlanes=be,e.numIntersection=0,Re}this.uniform=G,this.numPlanes=0,this.numIntersection=0,this.init=function(ee,se,ae){const de=ee.length!==0||se||y!==0||v;return v=se,u=Q(ee,ae,0),y=ee.length,de},this.beginShadows=function(){M=!0,Q(null)},this.endShadows=function(){M=!1,H()},this.setState=function(ee,se,ae){const de=ee.clippingPlanes,be=ee.clipIntersection,Re=ee.clipShadows,Te=S.get(ee);if(!v||de===null||de.length===0||M&&!Re)M?Q(null):H();else{const ct=M?0:y,Et=4*ct;let _t=Te.clippingState||null;G.value=_t,_t=Q(de,se,Et,ae);for(let jt=0;jt!==Et;++jt)_t[jt]=u[jt];Te.clippingState=_t,this.numIntersection=be?this.numPlanes:0,this.numPlanes+=ct}}}function Xd(S){let e=new WeakMap;function u(v,M){return M===303?v.mapping=301:M===304&&(v.mapping=302),v}function y(v){const M=v.target;M.removeEventListener("dispose",y);const O=e.get(M);O!==void 0&&(e.delete(M),O.dispose())}return{get:function(v){if(v&&v.isTexture&&v.isRenderTargetTexture===!1){const M=v.mapping;if(M===303||M===304){if(e.has(v))return u(e.get(v).texture,v.mapping);{const O=v.image;if(O&&O.height>0){const V=S.getRenderTarget(),G=new Ks(O.height/2);return G.fromEquirectangularTexture(S,v),e.set(v,G),S.setRenderTarget(V),v.addEventListener("dispose",y),u(G.texture,v.mapping)}return null}}}return v},dispose:function(){e=new WeakMap}}}sl.physical={uniforms:yo([sl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new en(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new wn(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new en},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new wn(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new wn(1,1,1)},specularTintMap:{value:null}}]),vertexShader:os.meshphysical_vert,fragmentShader:os.meshphysical_frag};class ih extends kc{constructor(e=-1,u=1,y=1,v=-1,M=.1,O=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=u,this.top=y,this.bottom=v,this.near=M,this.far=O,this.updateProjectionMatrix()}copy(e,u){return super.copy(e,u),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,u,y,v,M,O){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=u,this.view.offsetX=y,this.view.offsetY=v,this.view.width=M,this.view.height=O,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),u=(this.top-this.bottom)/(2*this.zoom),y=(this.right+this.left)/2,v=(this.top+this.bottom)/2;let M=y-e,O=y+e,V=v+u,G=v-u;if(this.view!==null&&this.view.enabled){const H=(this.right-this.left)/this.view.fullWidth/this.zoom,Q=(this.top-this.bottom)/this.view.fullHeight/this.zoom;M+=H*this.view.offsetX,O=M+H*this.view.width,V-=Q*this.view.offsetY,G=V-Q*this.view.height}this.projectionMatrix.makeOrthographic(M,O,V,G,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const u=super.toJSON(e);return u.object.zoom=this.zoom,u.object.left=this.left,u.object.right=this.right,u.object.top=this.top,u.object.bottom=this.bottom,u.object.near=this.near,u.object.far=this.far,this.view!==null&&(u.object.view=Object.assign({},this.view)),u}}ih.prototype.isOrthographicCamera=!0;class yu extends co{constructor(e){super(e),this.type="RawShaderMaterial"}}yu.prototype.isRawShaderMaterial=!0;const Ml=Math.pow(2,8),gf=[.125,.215,.35,.446,.526,.582],Yd=5+gf.length,id=20,Ra={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},nh=new ih,{_lodPlanes:sc,_sizeLods:vu,_sigmas:Bc}=rd(),nd=new wn;let Wl=null;const Pa=(1+Math.sqrt(5))/2,zr=1/Pa,xu=[new re(1,1,1),new re(-1,1,1),new re(1,1,-1),new re(-1,1,-1),new re(0,Pa,zr),new re(0,Pa,-zr),new re(zr,0,Pa),new re(-zr,0,Pa),new re(Pa,zr,0),new re(-Pa,zr,0)];class rh{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(u){const y=new Float32Array(u),v=new re(0,1,0);return new yu({name:"SphericalGaussianBlur",defines:{n:u},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:y},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:v},inputEncoding:{value:Ra[3e3]},outputEncoding:{value:Ra[3e3]}},vertexShader:sd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${sh()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}(id),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,u=0,y=.1,v=100){Wl=this._renderer.getRenderTarget();const M=this._allocateTargets();return this._sceneToCubeUV(e,y,v,M),u>0&&this._blur(M,0,0,u),this._applyPMREM(M),this._cleanup(M),M}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=_f(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=Jd(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<sc.length;e++)sc[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Wl),e.scissorTest=!1,ys(e,0,0,e.width,e.height)}_fromTexture(e){Wl=this._renderer.getRenderTarget();const u=this._allocateTargets(e);return this._textureToCubeUV(e,u),this._applyPMREM(u),this._cleanup(u),u}_allocateTargets(e){const u={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:Kd(e)?e.encoding:3002,depthBuffer:!1},y=bu(u);return y.depthBuffer=!e,this._pingPongRenderTarget=bu(u),y}_compileMaterial(e){const u=new qn(sc[0],e);this._renderer.compile(u,nh)}_sceneToCubeUV(e,u,y,v){const M=new vo(90,1,u,y),O=[1,-1,1,1,1,1],V=[1,1,1,-1,-1,-1],G=this._renderer,H=G.autoClear,Q=G.outputEncoding,ee=G.toneMapping;G.getClearColor(nd),G.toneMapping=0,G.outputEncoding=3e3,G.autoClear=!1;const se=new ws({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),ae=new qn(new rl,se);let de=!1;const be=e.background;be?be.isColor&&(se.color.copy(be),e.background=null,de=!0):(se.color.copy(nd),de=!0);for(let Re=0;Re<6;Re++){const Te=Re%3;Te==0?(M.up.set(0,O[Re],0),M.lookAt(V[Re],0,0)):Te==1?(M.up.set(0,0,O[Re]),M.lookAt(0,V[Re],0)):(M.up.set(0,O[Re],0),M.lookAt(0,0,V[Re])),ys(v,Te*Ml,Re>2?Ml:0,Ml,Ml),G.setRenderTarget(v),de&&G.render(ae,M),G.render(e,M)}ae.geometry.dispose(),ae.material.dispose(),G.toneMapping=ee,G.outputEncoding=Q,G.autoClear=H,e.background=be}_textureToCubeUV(e,u){const y=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=_f()):this._equirectShader==null&&(this._equirectShader=Jd());const v=e.isCubeTexture?this._cubemapShader:this._equirectShader,M=new qn(sc[0],v),O=v.uniforms;O.envMap.value=e,e.isCubeTexture||O.texelSize.value.set(1/e.image.width,1/e.image.height),O.inputEncoding.value=Ra[e.encoding],O.outputEncoding.value=Ra[u.texture.encoding],ys(u,0,0,3*Ml,2*Ml),y.setRenderTarget(u),y.render(M,nh)}_applyPMREM(e){const u=this._renderer,y=u.autoClear;u.autoClear=!1;for(let v=1;v<Yd;v++){const M=Math.sqrt(Bc[v]*Bc[v]-Bc[v-1]*Bc[v-1]),O=xu[(v-1)%xu.length];this._blur(e,v-1,v,M,O)}u.autoClear=y}_blur(e,u,y,v,M){const O=this._pingPongRenderTarget;this._halfBlur(e,O,u,y,v,"latitudinal",M),this._halfBlur(O,e,y,y,v,"longitudinal",M)}_halfBlur(e,u,y,v,M,O,V){const G=this._renderer,H=this._blurMaterial;O!=="latitudinal"&&O!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const Q=new qn(sc[v],H),ee=H.uniforms,se=vu[y]-1,ae=isFinite(M)?Math.PI/(2*se):2*Math.PI/39,de=M/ae,be=isFinite(M)?1+Math.floor(3*de):id;be>id&&console.warn(`sigmaRadians, ${M}, is too large and will clip, as it requested ${be} samples when the maximum is set to 20`);const Re=[];let Te=0;for(let Et=0;Et<id;++Et){const _t=Et/de,jt=Math.exp(-_t*_t/2);Re.push(jt),Et==0?Te+=jt:Et<be&&(Te+=2*jt)}for(let Et=0;Et<Re.length;Et++)Re[Et]=Re[Et]/Te;ee.envMap.value=e.texture,ee.samples.value=be,ee.weights.value=Re,ee.latitudinal.value=O==="latitudinal",V&&(ee.poleAxis.value=V),ee.dTheta.value=ae,ee.mipInt.value=8-y,ee.inputEncoding.value=Ra[e.texture.encoding],ee.outputEncoding.value=Ra[e.texture.encoding];const ct=vu[v];ys(u,3*Math.max(0,Ml-2*ct),(v===0?0:2*Ml)+2*ct*(v>4?v-8+4:0),3*ct,2*ct),G.setRenderTarget(u),G.render(Q,nh)}}function Kd(S){return S!==void 0&&S.type===1009&&(S.encoding===3e3||S.encoding===3001||S.encoding===3007)}function rd(){const S=[],e=[],u=[];let y=8;for(let v=0;v<Yd;v++){const M=Math.pow(2,y);e.push(M);let O=1/M;v>4?O=gf[v-8+4-1]:v==0&&(O=0),u.push(O);const V=1/(M-1),G=-V/2,H=1+V/2,Q=[G,G,H,G,H,H,G,G,H,H,G,H],ee=6,se=6,ae=3,de=2,be=1,Re=new Float32Array(ae*se*ee),Te=new Float32Array(de*se*ee),ct=new Float32Array(be*se*ee);for(let _t=0;_t<ee;_t++){const jt=_t%3*2/3-1,Xt=_t>2?0:-1,_i=[jt,Xt,0,jt+2/3,Xt,0,jt+2/3,Xt+1,0,jt,Xt,0,jt+2/3,Xt+1,0,jt,Xt+1,0];Re.set(_i,ae*se*_t),Te.set(Q,de*se*_t);const vi=[_t,_t,_t,_t,_t,_t];ct.set(vi,be*se*_t)}const Et=new Pr;Et.setAttribute("position",new Or(Re,ae)),Et.setAttribute("uv",new Or(Te,de)),Et.setAttribute("faceIndex",new Or(ct,be)),S.push(Et),y>4&&y--}return{_lodPlanes:S,_sizeLods:e,_sigmas:u}}function bu(S){const e=new ro(3*Ml,3*Ml,S);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function ys(S,e,u,y,v){S.viewport.set(e,u,y,v),S.scissor.set(e,u,y,v)}function Jd(){const S=new en(1,1);return new yu({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:S},inputEncoding:{value:Ra[3e3]},outputEncoding:{value:Ra[3e3]}},vertexShader:sd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${sh()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function _f(){return new yu({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ra[3e3]},outputEncoding:{value:Ra[3e3]}},vertexShader:sd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${sh()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function sd(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function sh(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function od(S){let e=new WeakMap,u=null;function y(v){const M=v.target;M.removeEventListener("dispose",y);const O=e.get(M);O!==void 0&&(e.delete(M),O.dispose())}return{get:function(v){if(v&&v.isTexture&&v.isRenderTargetTexture===!1){const M=v.mapping,O=M===303||M===304,V=M===301||M===302;if(O||V){if(e.has(v))return e.get(v).texture;{const G=v.image;if(O&&G&&G.height>0||V&&G&&function(H){let Q=0;const ee=6;for(let se=0;se<ee;se++)H[se]!==void 0&&Q++;return Q===ee}(G)){const H=S.getRenderTarget();u===null&&(u=new rh(S));const Q=O?u.fromEquirectangular(v):u.fromCubemap(v);return e.set(v,Q),S.setRenderTarget(H),v.addEventListener("dispose",y),Q.texture}return null}}}return v},dispose:function(){e=new WeakMap,u!==null&&(u.dispose(),u=null)}}}function Um(S){const e={};function u(y){if(e[y]!==void 0)return e[y];let v;switch(y){case"WEBGL_depth_texture":v=S.getExtension("WEBGL_depth_texture")||S.getExtension("MOZ_WEBGL_depth_texture")||S.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":v=S.getExtension("EXT_texture_filter_anisotropic")||S.getExtension("MOZ_EXT_texture_filter_anisotropic")||S.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":v=S.getExtension("WEBGL_compressed_texture_s3tc")||S.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":v=S.getExtension("WEBGL_compressed_texture_pvrtc")||S.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:v=S.getExtension(y)}return e[y]=v,v}return{has:function(y){return u(y)!==null},init:function(y){y.isWebGL2?u("EXT_color_buffer_float"):(u("WEBGL_depth_texture"),u("OES_texture_float"),u("OES_texture_half_float"),u("OES_texture_half_float_linear"),u("OES_standard_derivatives"),u("OES_element_index_uint"),u("OES_vertex_array_object"),u("ANGLE_instanced_arrays")),u("OES_texture_float_linear"),u("EXT_color_buffer_half_float")},get:function(y){const v=u(y);return v===null&&console.warn("THREE.WebGLRenderer: "+y+" extension not supported."),v}}}function Vm(S,e,u,y){const v={},M=new WeakMap;function O(G){const H=G.target;H.index!==null&&e.remove(H.index);for(const ee in H.attributes)e.remove(H.attributes[ee]);H.removeEventListener("dispose",O),delete v[H.id];const Q=M.get(H);Q&&(e.remove(Q),M.delete(H)),y.releaseStatesOfGeometry(H),H.isInstancedBufferGeometry===!0&&delete H._maxInstanceCount,u.memory.geometries--}function V(G){const H=[],Q=G.index,ee=G.attributes.position;let se=0;if(Q!==null){const be=Q.array;se=Q.version;for(let Re=0,Te=be.length;Re<Te;Re+=3){const ct=be[Re+0],Et=be[Re+1],_t=be[Re+2];H.push(ct,Et,Et,_t,_t,ct)}}else{const be=ee.array;se=ee.version;for(let Re=0,Te=be.length/3-1;Re<Te;Re+=3){const ct=Re+0,Et=Re+1,_t=Re+2;H.push(ct,Et,Et,_t,_t,ct)}}const ae=new(ya(H)>65535?Is:So)(H,1);ae.version=se;const de=M.get(G);de&&e.remove(de),M.set(G,ae)}return{get:function(G,H){return v[H.id]===!0||(H.addEventListener("dispose",O),v[H.id]=!0,u.memory.geometries++),H},update:function(G){const H=G.attributes;for(const ee in H)e.update(H[ee],34962);const Q=G.morphAttributes;for(const ee in Q){const se=Q[ee];for(let ae=0,de=se.length;ae<de;ae++)e.update(se[ae],34962)}},getWireframeAttribute:function(G){const H=M.get(G);if(H){const Q=G.index;Q!==null&&H.version<Q.version&&V(G)}else V(G);return M.get(G)}}}function Gm(S,e,u,y){const v=y.isWebGL2;let M,O,V;this.setMode=function(G){M=G},this.setIndex=function(G){O=G.type,V=G.bytesPerElement},this.render=function(G,H){S.drawElements(M,H,O,G*V),u.update(H,M,1)},this.renderInstances=function(G,H,Q){if(Q===0)return;let ee,se;if(v)ee=S,se="drawElementsInstanced";else if(ee=e.get("ANGLE_instanced_arrays"),se="drawElementsInstancedANGLE",ee===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");ee[se](M,H,O,G*V,Q),u.update(H,M,Q)}}function oh(S){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(u,y,v){switch(e.calls++,y){case 4:e.triangles+=v*(u/3);break;case 1:e.lines+=v*(u/2);break;case 3:e.lines+=v*(u-1);break;case 2:e.lines+=v*u;break;case 0:e.points+=v*u;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",y)}}}}function Hm(S,e){return S[0]-e[0]}function __(S,e){return Math.abs(e[1])-Math.abs(S[1])}function y_(S){const e={},u=new Float32Array(8),y=[];for(let v=0;v<8;v++)y[v]=[v,0];return{update:function(v,M,O,V){const G=v.morphTargetInfluences,H=G===void 0?0:G.length;let Q=e[M.id];if(Q===void 0||Q.length!==H){Q=[];for(let be=0;be<H;be++)Q[be]=[be,0];e[M.id]=Q}for(let be=0;be<H;be++){const Re=Q[be];Re[0]=be,Re[1]=G[be]}Q.sort(__);for(let be=0;be<8;be++)be<H&&Q[be][1]?(y[be][0]=Q[be][0],y[be][1]=Q[be][1]):(y[be][0]=Number.MAX_SAFE_INTEGER,y[be][1]=0);y.sort(Hm);const ee=M.morphAttributes.position,se=M.morphAttributes.normal;let ae=0;for(let be=0;be<8;be++){const Re=y[be],Te=Re[0],ct=Re[1];Te!==Number.MAX_SAFE_INTEGER&&ct?(ee&&M.getAttribute("morphTarget"+be)!==ee[Te]&&M.setAttribute("morphTarget"+be,ee[Te]),se&&M.getAttribute("morphNormal"+be)!==se[Te]&&M.setAttribute("morphNormal"+be,se[Te]),u[be]=ct,ae+=ct):(ee&&M.hasAttribute("morphTarget"+be)===!0&&M.deleteAttribute("morphTarget"+be),se&&M.hasAttribute("morphNormal"+be)===!0&&M.deleteAttribute("morphNormal"+be),u[be]=0)}const de=M.morphTargetsRelative?1:1-ae;V.getUniforms().setValue(S,"morphTargetBaseInfluence",de),V.getUniforms().setValue(S,"morphTargetInfluences",u)}}}function v_(S,e,u,y){let v=new WeakMap;function M(O){const V=O.target;V.removeEventListener("dispose",M),u.remove(V.instanceMatrix),V.instanceColor!==null&&u.remove(V.instanceColor)}return{update:function(O){const V=y.render.frame,G=O.geometry,H=e.get(O,G);return v.get(H)!==V&&(e.update(H),v.set(H,V)),O.isInstancedMesh&&(O.hasEventListener("dispose",M)===!1&&O.addEventListener("dispose",M),u.update(O.instanceMatrix,34962),O.instanceColor!==null&&u.update(O.instanceColor,34962)),H},dispose:function(){v=new WeakMap}}}class ad extends _s{constructor(e=null,u=1,y=1,v=1){super(null),this.image={data:e,width:u,height:y,depth:v},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ad.prototype.isDataTexture2DArray=!0;class ld extends _s{constructor(e=null,u=1,y=1,v=1){super(null),this.image={data:e,width:u,height:y,depth:v},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ld.prototype.isDataTexture3D=!0;const Qd=new _s,yf=new ad,jm=new ld,vf=new Ia,Wm=[],ah=[],lh=new Float32Array(16),xf=new Float32Array(9),Da=new Float32Array(4);function Nc(S,e,u){const y=S[0];if(y<=0||y>0)return S;const v=e*u;let M=Wm[v];if(M===void 0&&(M=new Float32Array(v),Wm[v]=M),e!==0){y.toArray(M,0);for(let O=1,V=0;O!==e;++O)V+=u,S[O].toArray(M,V)}return M}function Yo(S,e){if(S.length!==e.length)return!1;for(let u=0,y=S.length;u<y;u++)if(S[u]!==e[u])return!1;return!0}function Ho(S,e){for(let u=0,y=e.length;u<y;u++)S[u]=e[u]}function ep(S,e){let u=ah[e];u===void 0&&(u=new Int32Array(e),ah[e]=u);for(let y=0;y!==e;++y)u[y]=S.allocateTextureUnit();return u}function bf(S,e){const u=this.cache;u[0]!==e&&(S.uniform1f(this.addr,e),u[0]=e)}function tp(S,e){const u=this.cache;if(e.x!==void 0)u[0]===e.x&&u[1]===e.y||(S.uniform2f(this.addr,e.x,e.y),u[0]=e.x,u[1]=e.y);else{if(Yo(u,e))return;S.uniform2fv(this.addr,e),Ho(u,e)}}function wf(S,e){const u=this.cache;if(e.x!==void 0)u[0]===e.x&&u[1]===e.y&&u[2]===e.z||(S.uniform3f(this.addr,e.x,e.y,e.z),u[0]=e.x,u[1]=e.y,u[2]=e.z);else if(e.r!==void 0)u[0]===e.r&&u[1]===e.g&&u[2]===e.b||(S.uniform3f(this.addr,e.r,e.g,e.b),u[0]=e.r,u[1]=e.g,u[2]=e.b);else{if(Yo(u,e))return;S.uniform3fv(this.addr,e),Ho(u,e)}}function cd(S,e){const u=this.cache;if(e.x!==void 0)u[0]===e.x&&u[1]===e.y&&u[2]===e.z&&u[3]===e.w||(S.uniform4f(this.addr,e.x,e.y,e.z,e.w),u[0]=e.x,u[1]=e.y,u[2]=e.z,u[3]=e.w);else{if(Yo(u,e))return;S.uniform4fv(this.addr,e),Ho(u,e)}}function ip(S,e){const u=this.cache,y=e.elements;if(y===void 0){if(Yo(u,e))return;S.uniformMatrix2fv(this.addr,!1,e),Ho(u,e)}else{if(Yo(u,y))return;Da.set(y),S.uniformMatrix2fv(this.addr,!1,Da),Ho(u,y)}}function Tf(S,e){const u=this.cache,y=e.elements;if(y===void 0){if(Yo(u,e))return;S.uniformMatrix3fv(this.addr,!1,e),Ho(u,e)}else{if(Yo(u,y))return;xf.set(y),S.uniformMatrix3fv(this.addr,!1,xf),Ho(u,y)}}function qm(S,e){const u=this.cache,y=e.elements;if(y===void 0){if(Yo(u,e))return;S.uniformMatrix4fv(this.addr,!1,e),Ho(u,e)}else{if(Yo(u,y))return;lh.set(y),S.uniformMatrix4fv(this.addr,!1,lh),Ho(u,y)}}function ch(S,e){const u=this.cache;u[0]!==e&&(S.uniform1i(this.addr,e),u[0]=e)}function x_(S,e){const u=this.cache;Yo(u,e)||(S.uniform2iv(this.addr,e),Ho(u,e))}function $m(S,e){const u=this.cache;Yo(u,e)||(S.uniform3iv(this.addr,e),Ho(u,e))}function Zm(S,e){const u=this.cache;Yo(u,e)||(S.uniform4iv(this.addr,e),Ho(u,e))}function uh(S,e){const u=this.cache;u[0]!==e&&(S.uniform1ui(this.addr,e),u[0]=e)}function Xm(S,e){const u=this.cache;Yo(u,e)||(S.uniform2uiv(this.addr,e),Ho(u,e))}function Ym(S,e){const u=this.cache;Yo(u,e)||(S.uniform3uiv(this.addr,e),Ho(u,e))}function Mf(S,e){const u=this.cache;Yo(u,e)||(S.uniform4uiv(this.addr,e),Ho(u,e))}function ud(S,e,u){const y=this.cache,v=u.allocateTextureUnit();y[0]!==v&&(S.uniform1i(this.addr,v),y[0]=v),u.safeSetTexture2D(e||Qd,v)}function np(S,e,u){const y=this.cache,v=u.allocateTextureUnit();y[0]!==v&&(S.uniform1i(this.addr,v),y[0]=v),u.setTexture3D(e||jm,v)}function hh(S,e,u){const y=this.cache,v=u.allocateTextureUnit();y[0]!==v&&(S.uniform1i(this.addr,v),y[0]=v),u.safeSetTextureCube(e||vf,v)}function Km(S,e,u){const y=this.cache,v=u.allocateTextureUnit();y[0]!==v&&(S.uniform1i(this.addr,v),y[0]=v),u.setTexture2DArray(e||yf,v)}function Sf(S,e){S.uniform1fv(this.addr,e)}function Ef(S,e){const u=Nc(e,this.size,2);S.uniform2fv(this.addr,u)}function Af(S,e){const u=Nc(e,this.size,3);S.uniform3fv(this.addr,u)}function wu(S,e){const u=Nc(e,this.size,4);S.uniform4fv(this.addr,u)}function Jm(S,e){const u=Nc(e,this.size,4);S.uniformMatrix2fv(this.addr,!1,u)}function oc(S,e){const u=Nc(e,this.size,9);S.uniformMatrix3fv(this.addr,!1,u)}function rp(S,e){const u=Nc(e,this.size,16);S.uniformMatrix4fv(this.addr,!1,u)}function Tu(S,e){S.uniform1iv(this.addr,e)}function Qm(S,e){S.uniform2iv(this.addr,e)}function Cf(S,e){S.uniform3iv(this.addr,e)}function Lf(S,e){S.uniform4iv(this.addr,e)}function If(S,e){S.uniform1uiv(this.addr,e)}function eg(S,e){S.uniform2uiv(this.addr,e)}function Rf(S,e){S.uniform3uiv(this.addr,e)}function hd(S,e){S.uniform4uiv(this.addr,e)}function b_(S,e,u){const y=e.length,v=ep(u,y);S.uniform1iv(this.addr,v);for(let M=0;M!==y;++M)u.safeSetTexture2D(e[M]||Qd,v[M])}function w_(S,e,u){const y=e.length,v=ep(u,y);S.uniform1iv(this.addr,v);for(let M=0;M!==y;++M)u.safeSetTextureCube(e[M]||vf,v[M])}function Pf(S,e,u){this.id=S,this.addr=u,this.cache=[],this.setValue=function(y){switch(y){case 5126:return bf;case 35664:return tp;case 35665:return wf;case 35666:return cd;case 35674:return ip;case 35675:return Tf;case 35676:return qm;case 5124:case 35670:return ch;case 35667:case 35671:return x_;case 35668:case 35672:return $m;case 35669:case 35673:return Zm;case 5125:return uh;case 36294:return Xm;case 36295:return Ym;case 36296:return Mf;case 35678:case 36198:case 36298:case 36306:case 35682:return ud;case 35679:case 36299:case 36307:return np;case 35680:case 36300:case 36308:case 36293:return hh;case 36289:case 36303:case 36311:case 36292:return Km}}(e.type)}function tg(S,e,u){this.id=S,this.addr=u,this.cache=[],this.size=e.size,this.setValue=function(y){switch(y){case 5126:return Sf;case 35664:return Ef;case 35665:return Af;case 35666:return wu;case 35674:return Jm;case 35675:return oc;case 35676:return rp;case 5124:case 35670:return Tu;case 35667:case 35671:return Qm;case 35668:case 35672:return Cf;case 35669:case 35673:return Lf;case 5125:return If;case 36294:return eg;case 36295:return Rf;case 36296:return hd;case 35678:case 36198:case 36298:case 36306:case 35682:return b_;case 35680:case 36300:case 36308:case 36293:return w_}}(e.type)}function sp(S){this.id=S,this.seq=[],this.map={}}tg.prototype.updateCache=function(S){const e=this.cache;S instanceof Float32Array&&e.length!==S.length&&(this.cache=new Float32Array(S.length)),Ho(e,S)},sp.prototype.setValue=function(S,e,u){const y=this.seq;for(let v=0,M=y.length;v!==M;++v){const O=y[v];O.setValue(S,e[O.id],u)}};const dh=/(\w+)(\])?(\[|\.)?/g;function Mu(S,e){S.seq.push(e),S.map[e.id]=e}function op(S,e,u){const y=S.name,v=y.length;for(dh.lastIndex=0;;){const M=dh.exec(y),O=dh.lastIndex;let V=M[1];const G=M[2]==="]",H=M[3];if(G&&(V|=0),H===void 0||H==="["&&O+2===v){Mu(u,H===void 0?new Pf(V,S,e):new tg(V,S,e));break}{let Q=u.map[V];Q===void 0&&(Q=new sp(V),Mu(u,Q)),u=Q}}}function ol(S,e){this.seq=[],this.map={};const u=S.getProgramParameter(e,35718);for(let y=0;y<u;++y){const v=S.getActiveUniform(e,y);op(v,S.getUniformLocation(e,v.name),this)}}function Uc(S,e,u){const y=S.createShader(e);return S.shaderSource(y,u),S.compileShader(y),y}ol.prototype.setValue=function(S,e,u,y){const v=this.map[e];v!==void 0&&v.setValue(S,u,y)},ol.prototype.setOptional=function(S,e,u){const y=e[u];y!==void 0&&this.setValue(S,u,y)},ol.upload=function(S,e,u,y){for(let v=0,M=e.length;v!==M;++v){const O=e[v],V=u[O.id];V.needsUpdate!==!1&&O.setValue(S,V.value,y)}},ol.seqWithValue=function(S,e){const u=[];for(let y=0,v=S.length;y!==v;++y){const M=S[y];M.id in e&&u.push(M)}return u};let ap=0;function dd(S){switch(S){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",S),["Linear","( value )"]}}function lp(S,e,u){const y=S.getShaderParameter(e,35713),v=S.getShaderInfoLog(e).trim();return y&&v===""?"":u.toUpperCase()+`

`+v+`

`+function(M){const O=M.split(`
`);for(let V=0;V<O.length;V++)O[V]=V+1+": "+O[V];return O.join(`
`)}(S.getShaderSource(e))}function Vc(S,e){const u=dd(e);return"vec4 "+S+"( vec4 value ) { return "+u[0]+"ToLinear"+u[1]+"; }"}function ig(S,e){const u=dd(e);return"vec4 "+S+"( vec4 value ) { return LinearTo"+u[0]+u[1]+"; }"}function Su(S,e){let u;switch(e){case 1:u="Linear";break;case 2:u="Reinhard";break;case 3:u="OptimizedCineon";break;case 4:u="ACESFilmic";break;case 5:u="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),u="Linear"}return"vec3 "+S+"( vec3 color ) { return "+u+"ToneMapping( color ); }"}function ac(S){return S!==""}function Sn(S,e){return S.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pd(S,e){return S.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Df=/^[ \t]*#include +<([\w\d./]+)>/gm;function lc(S){return S.replace(Df,Oa)}function Oa(S,e){const u=os[e];if(u===void 0)throw new Error("Can not resolve #include <"+e+">");return lc(u)}const Gn=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Of=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zf(S){return S.replace(Of,Eu).replace(Gn,T_)}function T_(S,e,u,y){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Eu(S,e,u,y)}function Eu(S,e,u,y){let v="";for(let M=parseInt(e);M<parseInt(u);M++)v+=y.replace(/\[\s*i\s*\]/g,"[ "+M+" ]").replace(/UNROLLED_LOOP_INDEX/g,M);return v}function cp(S){let e="precision "+S.precision+` float;
precision `+S.precision+" int;";return S.precision==="highp"?e+=`
#define HIGH_PRECISION`:S.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:S.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function fd(S,e,u,y){const v=S.getContext(),M=u.defines;let O=u.vertexShader,V=u.fragmentShader;const G=function(vi){let Bi="SHADOWMAP_TYPE_BASIC";return vi.shadowMapType===1?Bi="SHADOWMAP_TYPE_PCF":vi.shadowMapType===2?Bi="SHADOWMAP_TYPE_PCF_SOFT":vi.shadowMapType===3&&(Bi="SHADOWMAP_TYPE_VSM"),Bi}(u),H=function(vi){let Bi="ENVMAP_TYPE_CUBE";if(vi.envMap)switch(vi.envMapMode){case 301:case 302:Bi="ENVMAP_TYPE_CUBE";break;case 306:case 307:Bi="ENVMAP_TYPE_CUBE_UV"}return Bi}(u),Q=function(vi){let Bi="ENVMAP_MODE_REFLECTION";if(vi.envMap)switch(vi.envMapMode){case 302:case 307:Bi="ENVMAP_MODE_REFRACTION"}return Bi}(u),ee=function(vi){let Bi="ENVMAP_BLENDING_NONE";if(vi.envMap)switch(vi.combine){case 0:Bi="ENVMAP_BLENDING_MULTIPLY";break;case 1:Bi="ENVMAP_BLENDING_MIX";break;case 2:Bi="ENVMAP_BLENDING_ADD"}return Bi}(u),se=S.gammaFactor>0?S.gammaFactor:1,ae=u.isWebGL2?"":function(vi){return[vi.extensionDerivatives||vi.envMapCubeUV||vi.bumpMap||vi.tangentSpaceNormalMap||vi.clearcoatNormalMap||vi.flatShading||vi.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(vi.extensionFragDepth||vi.logarithmicDepthBuffer)&&vi.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",vi.extensionDrawBuffers&&vi.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(vi.extensionShaderTextureLOD||vi.envMap||vi.transmission)&&vi.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ac).join(`
`)}(u),de=function(vi){const Bi=[];for(const Li in vi){const ki=vi[Li];ki!==!1&&Bi.push("#define "+Li+" "+ki)}return Bi.join(`
`)}(M),be=v.createProgram();let Re,Te,ct=u.glslVersion?"#version "+u.glslVersion+`
`:"";u.isRawShaderMaterial?(Re=[de].filter(ac).join(`
`),Re.length>0&&(Re+=`
`),Te=[ae,de].filter(ac).join(`
`),Te.length>0&&(Te+=`
`)):(Re=[cp(u),"#define SHADER_NAME "+u.shaderName,de,u.instancing?"#define USE_INSTANCING":"",u.instancingColor?"#define USE_INSTANCING_COLOR":"",u.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+se,"#define MAX_BONES "+u.maxBones,u.useFog&&u.fog?"#define USE_FOG":"",u.useFog&&u.fogExp2?"#define FOG_EXP2":"",u.map?"#define USE_MAP":"",u.envMap?"#define USE_ENVMAP":"",u.envMap?"#define "+Q:"",u.lightMap?"#define USE_LIGHTMAP":"",u.aoMap?"#define USE_AOMAP":"",u.emissiveMap?"#define USE_EMISSIVEMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.normalMap&&u.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",u.normalMap&&u.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",u.clearcoatMap?"#define USE_CLEARCOATMAP":"",u.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",u.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",u.displacementMap&&u.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",u.specularTintMap?"#define USE_SPECULARTINTMAP":"",u.roughnessMap?"#define USE_ROUGHNESSMAP":"",u.metalnessMap?"#define USE_METALNESSMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.transmission?"#define USE_TRANSMISSION":"",u.transmissionMap?"#define USE_TRANSMISSIONMAP":"",u.thicknessMap?"#define USE_THICKNESSMAP":"",u.vertexTangents?"#define USE_TANGENT":"",u.vertexColors?"#define USE_COLOR":"",u.vertexAlphas?"#define USE_COLOR_ALPHA":"",u.vertexUvs?"#define USE_UV":"",u.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",u.flatShading?"#define FLAT_SHADED":"",u.skinning?"#define USE_SKINNING":"",u.useVertexTexture?"#define BONE_TEXTURE":"",u.morphTargets?"#define USE_MORPHTARGETS":"",u.morphNormals&&u.flatShading===!1?"#define USE_MORPHNORMALS":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+G:"",u.sizeAttenuation?"#define USE_SIZEATTENUATION":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",u.logarithmicDepthBuffer&&u.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ac).join(`
`),Te=[ae,cp(u),"#define SHADER_NAME "+u.shaderName,de,"#define GAMMA_FACTOR "+se,u.useFog&&u.fog?"#define USE_FOG":"",u.useFog&&u.fogExp2?"#define FOG_EXP2":"",u.map?"#define USE_MAP":"",u.matcap?"#define USE_MATCAP":"",u.envMap?"#define USE_ENVMAP":"",u.envMap?"#define "+H:"",u.envMap?"#define "+Q:"",u.envMap?"#define "+ee:"",u.lightMap?"#define USE_LIGHTMAP":"",u.aoMap?"#define USE_AOMAP":"",u.emissiveMap?"#define USE_EMISSIVEMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.normalMap&&u.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",u.normalMap&&u.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",u.clearcoat?"#define USE_CLEARCOAT":"",u.clearcoatMap?"#define USE_CLEARCOATMAP":"",u.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",u.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",u.specularTintMap?"#define USE_SPECULARTINTMAP":"",u.roughnessMap?"#define USE_ROUGHNESSMAP":"",u.metalnessMap?"#define USE_METALNESSMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.alphaTest?"#define USE_ALPHATEST":"",u.sheenTint?"#define USE_SHEEN":"",u.transmission?"#define USE_TRANSMISSION":"",u.transmissionMap?"#define USE_TRANSMISSIONMAP":"",u.thicknessMap?"#define USE_THICKNESSMAP":"",u.vertexTangents?"#define USE_TANGENT":"",u.vertexColors||u.instancingColor?"#define USE_COLOR":"",u.vertexAlphas?"#define USE_COLOR_ALPHA":"",u.vertexUvs?"#define USE_UV":"",u.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",u.gradientMap?"#define USE_GRADIENTMAP":"",u.flatShading?"#define FLAT_SHADED":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+G:"",u.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",u.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",u.logarithmicDepthBuffer&&u.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(u.extensionShaderTextureLOD||u.envMap)&&u.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",u.toneMapping!==0?"#define TONE_MAPPING":"",u.toneMapping!==0?os.tonemapping_pars_fragment:"",u.toneMapping!==0?Su("toneMapping",u.toneMapping):"",u.dithering?"#define DITHERING":"",u.format===1022?"#define OPAQUE":"",os.encodings_pars_fragment,u.map?Vc("mapTexelToLinear",u.mapEncoding):"",u.matcap?Vc("matcapTexelToLinear",u.matcapEncoding):"",u.envMap?Vc("envMapTexelToLinear",u.envMapEncoding):"",u.emissiveMap?Vc("emissiveMapTexelToLinear",u.emissiveMapEncoding):"",u.specularTintMap?Vc("specularTintMapTexelToLinear",u.specularTintMapEncoding):"",u.lightMap?Vc("lightMapTexelToLinear",u.lightMapEncoding):"",ig("linearToOutputTexel",u.outputEncoding),u.depthPacking?"#define DEPTH_PACKING "+u.depthPacking:"",`
`].filter(ac).join(`
`)),O=lc(O),O=Sn(O,u),O=pd(O,u),V=lc(V),V=Sn(V,u),V=pd(V,u),O=zf(O),V=zf(V),u.isWebGL2&&u.isRawShaderMaterial!==!0&&(ct=`#version 300 es
`,Re=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Re,Te=["#define varying in",u.glslVersion===Lt?"":"out highp vec4 pc_fragColor;",u.glslVersion===Lt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Te);const Et=ct+Te+V,_t=Uc(v,35633,ct+Re+O),jt=Uc(v,35632,Et);if(v.attachShader(be,_t),v.attachShader(be,jt),u.index0AttributeName!==void 0?v.bindAttribLocation(be,0,u.index0AttributeName):u.morphTargets===!0&&v.bindAttribLocation(be,0,"position"),v.linkProgram(be),S.debug.checkShaderErrors){const vi=v.getProgramInfoLog(be).trim(),Bi=v.getShaderInfoLog(_t).trim(),Li=v.getShaderInfoLog(jt).trim();let ki=!0,Zn=!0;if(v.getProgramParameter(be,35714)===!1){ki=!1;const En=lp(v,_t,"vertex"),Ji=lp(v,jt,"fragment");console.error("THREE.WebGLProgram: Shader Error "+v.getError()+" - VALIDATE_STATUS "+v.getProgramParameter(be,35715)+`

Program Info Log: `+vi+`
`+En+`
`+Ji)}else vi!==""?console.warn("THREE.WebGLProgram: Program Info Log:",vi):Bi!==""&&Li!==""||(Zn=!1);Zn&&(this.diagnostics={runnable:ki,programLog:vi,vertexShader:{log:Bi,prefix:Re},fragmentShader:{log:Li,prefix:Te}})}let Xt,_i;return v.deleteShader(_t),v.deleteShader(jt),this.getUniforms=function(){return Xt===void 0&&(Xt=new ol(v,be)),Xt},this.getAttributes=function(){return _i===void 0&&(_i=function(vi,Bi){const Li={},ki=vi.getProgramParameter(Bi,35721);for(let Zn=0;Zn<ki;Zn++){const En=vi.getActiveAttrib(Bi,Zn),Ji=En.name;let In=1;En.type===35674&&(In=2),En.type===35675&&(In=3),En.type===35676&&(In=4),Li[Ji]={type:En.type,location:vi.getAttribLocation(Bi,Ji),locationSize:In}}return Li}(v,be)),_i},this.destroy=function(){y.releaseStatesOfProgram(this),v.deleteProgram(be),this.program=void 0},this.name=u.shaderName,this.id=ap++,this.cacheKey=e,this.usedTimes=1,this.program=be,this.vertexShader=_t,this.fragmentShader=jt,this}function ng(S,e,u,y,v,M,O){const V=[],G=v.isWebGL2,H=v.logarithmicDepthBuffer,Q=v.floatVertexTextures,ee=v.maxVertexUniforms,se=v.vertexTextures;let ae=v.precision;const de={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},be=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function Re(Te){let ct;return Te&&Te.isTexture?ct=Te.encoding:Te&&Te.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),ct=Te.texture.encoding):ct=3e3,ct}return{getParameters:function(Te,ct,Et,_t,jt){const Xt=_t.fog,_i=Te.isMeshStandardMaterial?_t.environment:null,vi=(Te.isMeshStandardMaterial?u:e).get(Te.envMap||_i),Bi=de[Te.type],Li=jt.isSkinnedMesh?function(ir){const rr=ir.skeleton.bones;if(Q)return 1024;{const vr=ee,kr=Math.floor((vr-20)/4),Fr=Math.min(kr,rr.length);return Fr<rr.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+rr.length+" bones. This GPU supports "+Fr+"."),0):Fr}}(jt):0;let ki,Zn;if(Te.precision!==null&&(ae=v.getMaxPrecision(Te.precision),ae!==Te.precision&&console.warn("THREE.WebGLProgram.getParameters:",Te.precision,"not supported, using",ae,"instead.")),Bi){const ir=sl[Bi];ki=ir.vertexShader,Zn=ir.fragmentShader}else ki=Te.vertexShader,Zn=Te.fragmentShader;const En=S.getRenderTarget(),Ji=Te.alphaTest>0,In=Te.clearcoat>0;return{isWebGL2:G,shaderID:Bi,shaderName:Te.type,vertexShader:ki,fragmentShader:Zn,defines:Te.defines,isRawShaderMaterial:Te.isRawShaderMaterial===!0,glslVersion:Te.glslVersion,precision:ae,instancing:jt.isInstancedMesh===!0,instancingColor:jt.isInstancedMesh===!0&&jt.instanceColor!==null,supportsVertexTextures:se,outputEncoding:En!==null?Re(En.texture):S.outputEncoding,map:!!Te.map,mapEncoding:Re(Te.map),matcap:!!Te.matcap,matcapEncoding:Re(Te.matcap),envMap:!!vi,envMapMode:vi&&vi.mapping,envMapEncoding:Re(vi),envMapCubeUV:!!vi&&(vi.mapping===306||vi.mapping===307),lightMap:!!Te.lightMap,lightMapEncoding:Re(Te.lightMap),aoMap:!!Te.aoMap,emissiveMap:!!Te.emissiveMap,emissiveMapEncoding:Re(Te.emissiveMap),bumpMap:!!Te.bumpMap,normalMap:!!Te.normalMap,objectSpaceNormalMap:Te.normalMapType===1,tangentSpaceNormalMap:Te.normalMapType===0,clearcoat:In,clearcoatMap:In&&!!Te.clearcoatMap,clearcoatRoughnessMap:In&&!!Te.clearcoatRoughnessMap,clearcoatNormalMap:In&&!!Te.clearcoatNormalMap,displacementMap:!!Te.displacementMap,roughnessMap:!!Te.roughnessMap,metalnessMap:!!Te.metalnessMap,specularMap:!!Te.specularMap,specularIntensityMap:!!Te.specularIntensityMap,specularTintMap:!!Te.specularTintMap,specularTintMapEncoding:Re(Te.specularTintMap),alphaMap:!!Te.alphaMap,alphaTest:Ji,gradientMap:!!Te.gradientMap,sheenTint:!!Te.sheenTint&&(Te.sheenTint.r>0||Te.sheenTint.g>0||Te.sheenTint.b>0),transmission:Te.transmission>0,transmissionMap:!!Te.transmissionMap,thicknessMap:!!Te.thicknessMap,combine:Te.combine,vertexTangents:!!Te.normalMap&&!!jt.geometry&&!!jt.geometry.attributes.tangent,vertexColors:Te.vertexColors,vertexAlphas:Te.vertexColors===!0&&!!jt.geometry&&!!jt.geometry.attributes.color&&jt.geometry.attributes.color.itemSize===4,vertexUvs:!!(Te.map||Te.bumpMap||Te.normalMap||Te.specularMap||Te.alphaMap||Te.emissiveMap||Te.roughnessMap||Te.metalnessMap||Te.clearcoatMap||Te.clearcoatRoughnessMap||Te.clearcoatNormalMap||Te.displacementMap||Te.transmissionMap||Te.thicknessMap||Te.specularIntensityMap||Te.specularTintMap),uvsVertexOnly:!(Te.map||Te.bumpMap||Te.normalMap||Te.specularMap||Te.alphaMap||Te.emissiveMap||Te.roughnessMap||Te.metalnessMap||Te.clearcoatNormalMap||Te.transmission>0||Te.transmissionMap||Te.thicknessMap||Te.specularIntensityMap||Te.specularTintMap||!Te.displacementMap),fog:!!Xt,useFog:Te.fog,fogExp2:Xt&&Xt.isFogExp2,flatShading:!!Te.flatShading,sizeAttenuation:Te.sizeAttenuation,logarithmicDepthBuffer:H,skinning:jt.isSkinnedMesh===!0&&Li>0,maxBones:Li,useVertexTexture:Q,morphTargets:!!jt.geometry&&!!jt.geometry.morphAttributes.position,morphNormals:!!jt.geometry&&!!jt.geometry.morphAttributes.normal,numDirLights:ct.directional.length,numPointLights:ct.point.length,numSpotLights:ct.spot.length,numRectAreaLights:ct.rectArea.length,numHemiLights:ct.hemi.length,numDirLightShadows:ct.directionalShadowMap.length,numPointLightShadows:ct.pointShadowMap.length,numSpotLightShadows:ct.spotShadowMap.length,numClippingPlanes:O.numPlanes,numClipIntersection:O.numIntersection,format:Te.format,dithering:Te.dithering,shadowMapEnabled:S.shadowMap.enabled&&Et.length>0,shadowMapType:S.shadowMap.type,toneMapping:Te.toneMapped?S.toneMapping:0,physicallyCorrectLights:S.physicallyCorrectLights,premultipliedAlpha:Te.premultipliedAlpha,doubleSided:Te.side===2,flipSided:Te.side===1,depthPacking:Te.depthPacking!==void 0&&Te.depthPacking,index0AttributeName:Te.index0AttributeName,extensionDerivatives:Te.extensions&&Te.extensions.derivatives,extensionFragDepth:Te.extensions&&Te.extensions.fragDepth,extensionDrawBuffers:Te.extensions&&Te.extensions.drawBuffers,extensionShaderTextureLOD:Te.extensions&&Te.extensions.shaderTextureLOD,rendererExtensionFragDepth:G||y.has("EXT_frag_depth"),rendererExtensionDrawBuffers:G||y.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:G||y.has("EXT_shader_texture_lod"),customProgramCacheKey:Te.customProgramCacheKey()}},getProgramCacheKey:function(Te){const ct=[];if(Te.shaderID?ct.push(Te.shaderID):(ct.push(Te.fragmentShader),ct.push(Te.vertexShader)),Te.defines!==void 0)for(const Et in Te.defines)ct.push(Et),ct.push(Te.defines[Et]);if(Te.isRawShaderMaterial===!1){for(let Et=0;Et<be.length;Et++)ct.push(Te[be[Et]]);ct.push(S.outputEncoding),ct.push(S.gammaFactor)}return ct.push(Te.customProgramCacheKey),ct.join()},getUniforms:function(Te){const ct=de[Te.type];let Et;if(ct){const _t=sl[ct];Et=zc.clone(_t.uniforms)}else Et=Te.uniforms;return Et},acquireProgram:function(Te,ct){let Et;for(let _t=0,jt=V.length;_t<jt;_t++){const Xt=V[_t];if(Xt.cacheKey===ct){Et=Xt,++Et.usedTimes;break}}return Et===void 0&&(Et=new fd(S,ct,Te,M),V.push(Et)),Et},releaseProgram:function(Te){if(--Te.usedTimes==0){const ct=V.indexOf(Te);V[ct]=V[V.length-1],V.pop(),Te.destroy()}},programs:V}}function M_(){let S=new WeakMap;return{get:function(e){let u=S.get(e);return u===void 0&&(u={},S.set(e,u)),u},remove:function(e){S.delete(e)},update:function(e,u,y){S.get(e)[u]=y},dispose:function(){S=new WeakMap}}}function kf(S,e){return S.groupOrder!==e.groupOrder?S.groupOrder-e.groupOrder:S.renderOrder!==e.renderOrder?S.renderOrder-e.renderOrder:S.program!==e.program?S.program.id-e.program.id:S.material.id!==e.material.id?S.material.id-e.material.id:S.z!==e.z?S.z-e.z:S.id-e.id}function ph(S,e){return S.groupOrder!==e.groupOrder?S.groupOrder-e.groupOrder:S.renderOrder!==e.renderOrder?S.renderOrder-e.renderOrder:S.z!==e.z?e.z-S.z:S.id-e.id}function fh(S){const e=[];let u=0;const y=[],v=[],M=[],O={id:-1};function V(G,H,Q,ee,se,ae){let de=e[u];const be=S.get(Q);return de===void 0?(de={id:G.id,object:G,geometry:H,material:Q,program:be.program||O,groupOrder:ee,renderOrder:G.renderOrder,z:se,group:ae},e[u]=de):(de.id=G.id,de.object=G,de.geometry=H,de.material=Q,de.program=be.program||O,de.groupOrder=ee,de.renderOrder=G.renderOrder,de.z=se,de.group=ae),u++,de}return{opaque:y,transmissive:v,transparent:M,init:function(){u=0,y.length=0,v.length=0,M.length=0},push:function(G,H,Q,ee,se,ae){const de=V(G,H,Q,ee,se,ae);Q.transmission>0?v.push(de):Q.transparent===!0?M.push(de):y.push(de)},unshift:function(G,H,Q,ee,se,ae){const de=V(G,H,Q,ee,se,ae);Q.transmission>0?v.unshift(de):Q.transparent===!0?M.unshift(de):y.unshift(de)},finish:function(){for(let G=u,H=e.length;G<H;G++){const Q=e[G];if(Q.id===null)break;Q.id=null,Q.object=null,Q.geometry=null,Q.material=null,Q.program=null,Q.group=null}},sort:function(G,H){y.length>1&&y.sort(G||kf),v.length>1&&v.sort(H||ph),M.length>1&&M.sort(H||ph)}}}function up(S){let e=new WeakMap;return{get:function(u,y){let v;return e.has(u)===!1?(v=new fh(S),e.set(u,[v])):y>=e.get(u).length?(v=new fh(S),e.get(u).push(v)):v=e.get(u)[y],v},dispose:function(){e=new WeakMap}}}function ta(){const S={};return{get:function(e){if(S[e.id]!==void 0)return S[e.id];let u;switch(e.type){case"DirectionalLight":u={direction:new re,color:new wn};break;case"SpotLight":u={position:new re,direction:new re,color:new wn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":u={position:new re,color:new wn,distance:0,decay:0};break;case"HemisphereLight":u={direction:new re,skyColor:new wn,groundColor:new wn};break;case"RectAreaLight":u={color:new wn,position:new re,halfWidth:new re,halfHeight:new re}}return S[e.id]=u,u}}}let ja=0;function rg(S,e){return(e.castShadow?1:0)-(S.castShadow?1:0)}function Ff(S,e){const u=new ta,y=function(){const G={};return{get:function(H){if(G[H.id]!==void 0)return G[H.id];let Q;switch(H.type){case"DirectionalLight":case"SpotLight":Q={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new en};break;case"PointLight":Q={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new en,shadowCameraNear:1,shadowCameraFar:1e3}}return G[H.id]=Q,Q}}}(),v={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let G=0;G<9;G++)v.probe.push(new re);const M=new re,O=new nr,V=new nr;return{setup:function(G,H){let Q=0,ee=0,se=0;for(let _i=0;_i<9;_i++)v.probe[_i].set(0,0,0);let ae=0,de=0,be=0,Re=0,Te=0,ct=0,Et=0,_t=0;G.sort(rg);const jt=H!==!0?Math.PI:1;for(let _i=0,vi=G.length;_i<vi;_i++){const Bi=G[_i],Li=Bi.color,ki=Bi.intensity,Zn=Bi.distance,En=Bi.shadow&&Bi.shadow.map?Bi.shadow.map.texture:null;if(Bi.isAmbientLight)Q+=Li.r*ki*jt,ee+=Li.g*ki*jt,se+=Li.b*ki*jt;else if(Bi.isLightProbe)for(let Ji=0;Ji<9;Ji++)v.probe[Ji].addScaledVector(Bi.sh.coefficients[Ji],ki);else if(Bi.isDirectionalLight){const Ji=u.get(Bi);if(Ji.color.copy(Bi.color).multiplyScalar(Bi.intensity*jt),Bi.castShadow){const In=Bi.shadow,ir=y.get(Bi);ir.shadowBias=In.bias,ir.shadowNormalBias=In.normalBias,ir.shadowRadius=In.radius,ir.shadowMapSize=In.mapSize,v.directionalShadow[ae]=ir,v.directionalShadowMap[ae]=En,v.directionalShadowMatrix[ae]=Bi.shadow.matrix,ct++}v.directional[ae]=Ji,ae++}else if(Bi.isSpotLight){const Ji=u.get(Bi);if(Ji.position.setFromMatrixPosition(Bi.matrixWorld),Ji.color.copy(Li).multiplyScalar(ki*jt),Ji.distance=Zn,Ji.coneCos=Math.cos(Bi.angle),Ji.penumbraCos=Math.cos(Bi.angle*(1-Bi.penumbra)),Ji.decay=Bi.decay,Bi.castShadow){const In=Bi.shadow,ir=y.get(Bi);ir.shadowBias=In.bias,ir.shadowNormalBias=In.normalBias,ir.shadowRadius=In.radius,ir.shadowMapSize=In.mapSize,v.spotShadow[be]=ir,v.spotShadowMap[be]=En,v.spotShadowMatrix[be]=Bi.shadow.matrix,_t++}v.spot[be]=Ji,be++}else if(Bi.isRectAreaLight){const Ji=u.get(Bi);Ji.color.copy(Li).multiplyScalar(ki),Ji.halfWidth.set(.5*Bi.width,0,0),Ji.halfHeight.set(0,.5*Bi.height,0),v.rectArea[Re]=Ji,Re++}else if(Bi.isPointLight){const Ji=u.get(Bi);if(Ji.color.copy(Bi.color).multiplyScalar(Bi.intensity*jt),Ji.distance=Bi.distance,Ji.decay=Bi.decay,Bi.castShadow){const In=Bi.shadow,ir=y.get(Bi);ir.shadowBias=In.bias,ir.shadowNormalBias=In.normalBias,ir.shadowRadius=In.radius,ir.shadowMapSize=In.mapSize,ir.shadowCameraNear=In.camera.near,ir.shadowCameraFar=In.camera.far,v.pointShadow[de]=ir,v.pointShadowMap[de]=En,v.pointShadowMatrix[de]=Bi.shadow.matrix,Et++}v.point[de]=Ji,de++}else if(Bi.isHemisphereLight){const Ji=u.get(Bi);Ji.skyColor.copy(Bi.color).multiplyScalar(ki*jt),Ji.groundColor.copy(Bi.groundColor).multiplyScalar(ki*jt),v.hemi[Te]=Ji,Te++}}Re>0&&(e.isWebGL2||S.has("OES_texture_float_linear")===!0?(v.rectAreaLTC1=Qn.LTC_FLOAT_1,v.rectAreaLTC2=Qn.LTC_FLOAT_2):S.has("OES_texture_half_float_linear")===!0?(v.rectAreaLTC1=Qn.LTC_HALF_1,v.rectAreaLTC2=Qn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),v.ambient[0]=Q,v.ambient[1]=ee,v.ambient[2]=se;const Xt=v.hash;Xt.directionalLength===ae&&Xt.pointLength===de&&Xt.spotLength===be&&Xt.rectAreaLength===Re&&Xt.hemiLength===Te&&Xt.numDirectionalShadows===ct&&Xt.numPointShadows===Et&&Xt.numSpotShadows===_t||(v.directional.length=ae,v.spot.length=be,v.rectArea.length=Re,v.point.length=de,v.hemi.length=Te,v.directionalShadow.length=ct,v.directionalShadowMap.length=ct,v.pointShadow.length=Et,v.pointShadowMap.length=Et,v.spotShadow.length=_t,v.spotShadowMap.length=_t,v.directionalShadowMatrix.length=ct,v.pointShadowMatrix.length=Et,v.spotShadowMatrix.length=_t,Xt.directionalLength=ae,Xt.pointLength=de,Xt.spotLength=be,Xt.rectAreaLength=Re,Xt.hemiLength=Te,Xt.numDirectionalShadows=ct,Xt.numPointShadows=Et,Xt.numSpotShadows=_t,v.version=ja++)},setupView:function(G,H){let Q=0,ee=0,se=0,ae=0,de=0;const be=H.matrixWorldInverse;for(let Re=0,Te=G.length;Re<Te;Re++){const ct=G[Re];if(ct.isDirectionalLight){const Et=v.directional[Q];Et.direction.setFromMatrixPosition(ct.matrixWorld),M.setFromMatrixPosition(ct.target.matrixWorld),Et.direction.sub(M),Et.direction.transformDirection(be),Q++}else if(ct.isSpotLight){const Et=v.spot[se];Et.position.setFromMatrixPosition(ct.matrixWorld),Et.position.applyMatrix4(be),Et.direction.setFromMatrixPosition(ct.matrixWorld),M.setFromMatrixPosition(ct.target.matrixWorld),Et.direction.sub(M),Et.direction.transformDirection(be),se++}else if(ct.isRectAreaLight){const Et=v.rectArea[ae];Et.position.setFromMatrixPosition(ct.matrixWorld),Et.position.applyMatrix4(be),V.identity(),O.copy(ct.matrixWorld),O.premultiply(be),V.extractRotation(O),Et.halfWidth.set(.5*ct.width,0,0),Et.halfHeight.set(0,.5*ct.height,0),Et.halfWidth.applyMatrix4(V),Et.halfHeight.applyMatrix4(V),ae++}else if(ct.isPointLight){const Et=v.point[ee];Et.position.setFromMatrixPosition(ct.matrixWorld),Et.position.applyMatrix4(be),ee++}else if(ct.isHemisphereLight){const Et=v.hemi[de];Et.direction.setFromMatrixPosition(ct.matrixWorld),Et.direction.transformDirection(be),Et.direction.normalize(),de++}}},state:v}}function hp(S,e){const u=new Ff(S,e),y=[],v=[];return{init:function(){y.length=0,v.length=0},state:{lightsArray:y,shadowsArray:v,lights:u},setupLights:function(M){u.setup(y,M)},setupLightsView:function(M){u.setupView(y,M)},pushLight:function(M){y.push(M)},pushShadow:function(M){v.push(M)}}}function Bf(S,e){let u=new WeakMap;return{get:function(y,v=0){let M;return u.has(y)===!1?(M=new hp(S,e),u.set(y,[M])):v>=u.get(y).length?(M=new hp(S,e),u.get(y).push(M)):M=u.get(y)[v],M},dispose:function(){u=new WeakMap}}}class md extends Vi{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}md.prototype.isMeshDepthMaterial=!0;class ua extends Vi{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new re,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}ua.prototype.isMeshDistanceMaterial=!0;function eo(S,e,u){let y=new Fc;const v=new en,M=new en,O=new Dr,V=new md({depthPacking:3201}),G=new ua,H={},Q=u.maxTextureSize,ee={0:1,1:0,2:2},se=new co({uniforms:{shadow_pass:{value:null},resolution:{value:new en},radius:{value:4},samples:{value:8}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
uniform float samples;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),ae=se.clone();ae.defines.HORIZONTAL_PASS=1;const de=new Pr;de.setAttribute("position",new Or(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const be=new qn(de,se),Re=this;function Te(_t,jt){const Xt=e.update(be);se.uniforms.shadow_pass.value=_t.map.texture,se.uniforms.resolution.value=_t.mapSize,se.uniforms.radius.value=_t.radius,se.uniforms.samples.value=_t.blurSamples,S.setRenderTarget(_t.mapPass),S.clear(),S.renderBufferDirect(jt,null,Xt,se,be,null),ae.uniforms.shadow_pass.value=_t.mapPass.texture,ae.uniforms.resolution.value=_t.mapSize,ae.uniforms.radius.value=_t.radius,ae.uniforms.samples.value=_t.blurSamples,S.setRenderTarget(_t.map),S.clear(),S.renderBufferDirect(jt,null,Xt,ae,be,null)}function ct(_t,jt,Xt,_i,vi,Bi,Li){let ki=null;const Zn=_i.isPointLight===!0?_t.customDistanceMaterial:_t.customDepthMaterial;if(ki=Zn!==void 0?Zn:_i.isPointLight===!0?G:V,S.localClippingEnabled&&Xt.clipShadows===!0&&Xt.clippingPlanes.length!==0||Xt.displacementMap&&Xt.displacementScale!==0||Xt.alphaMap&&Xt.alphaTest>0){const En=ki.uuid,Ji=Xt.uuid;let In=H[En];In===void 0&&(In={},H[En]=In);let ir=In[Ji];ir===void 0&&(ir=ki.clone(),In[Ji]=ir),ki=ir}return ki.visible=Xt.visible,ki.wireframe=Xt.wireframe,ki.side=Li===3?Xt.shadowSide!==null?Xt.shadowSide:Xt.side:Xt.shadowSide!==null?Xt.shadowSide:ee[Xt.side],ki.alphaMap=Xt.alphaMap,ki.alphaTest=Xt.alphaTest,ki.clipShadows=Xt.clipShadows,ki.clippingPlanes=Xt.clippingPlanes,ki.clipIntersection=Xt.clipIntersection,ki.displacementMap=Xt.displacementMap,ki.displacementScale=Xt.displacementScale,ki.displacementBias=Xt.displacementBias,ki.wireframeLinewidth=Xt.wireframeLinewidth,ki.linewidth=Xt.linewidth,_i.isPointLight===!0&&ki.isMeshDistanceMaterial===!0&&(ki.referencePosition.setFromMatrixPosition(_i.matrixWorld),ki.nearDistance=vi,ki.farDistance=Bi),ki}function Et(_t,jt,Xt,_i,vi){if(_t.visible===!1)return;if(_t.layers.test(jt.layers)&&(_t.isMesh||_t.isLine||_t.isPoints)&&(_t.castShadow||_t.receiveShadow&&vi===3)&&(!_t.frustumCulled||y.intersectsObject(_t))){_t.modelViewMatrix.multiplyMatrices(Xt.matrixWorldInverse,_t.matrixWorld);const Li=e.update(_t),ki=_t.material;if(Array.isArray(ki)){const Zn=Li.groups;for(let En=0,Ji=Zn.length;En<Ji;En++){const In=Zn[En],ir=ki[In.materialIndex];if(ir&&ir.visible){const rr=ct(_t,0,ir,_i,Xt.near,Xt.far,vi);S.renderBufferDirect(Xt,null,Li,rr,_t,In)}}}else if(ki.visible){const Zn=ct(_t,0,ki,_i,Xt.near,Xt.far,vi);S.renderBufferDirect(Xt,null,Li,Zn,_t,null)}}const Bi=_t.children;for(let Li=0,ki=Bi.length;Li<ki;Li++)Et(Bi[Li],jt,Xt,_i,vi)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(_t,jt,Xt){if(Re.enabled===!1||Re.autoUpdate===!1&&Re.needsUpdate===!1||_t.length===0)return;const _i=S.getRenderTarget(),vi=S.getActiveCubeFace(),Bi=S.getActiveMipmapLevel(),Li=S.state;Li.setBlending(0),Li.buffers.color.setClear(1,1,1,1),Li.buffers.depth.setTest(!0),Li.setScissorTest(!1);for(let ki=0,Zn=_t.length;ki<Zn;ki++){const En=_t[ki],Ji=En.shadow;if(Ji===void 0){console.warn("THREE.WebGLShadowMap:",En,"has no shadow.");continue}if(Ji.autoUpdate===!1&&Ji.needsUpdate===!1)continue;v.copy(Ji.mapSize);const In=Ji.getFrameExtents();if(v.multiply(In),M.copy(Ji.mapSize),(v.x>Q||v.y>Q)&&(v.x>Q&&(M.x=Math.floor(Q/In.x),v.x=M.x*In.x,Ji.mapSize.x=M.x),v.y>Q&&(M.y=Math.floor(Q/In.y),v.y=M.y*In.y,Ji.mapSize.y=M.y)),Ji.map===null&&!Ji.isPointLightShadow&&this.type===3){const rr={minFilter:1006,magFilter:1006,format:1023};Ji.map=new ro(v.x,v.y,rr),Ji.map.texture.name=En.name+".shadowMap",Ji.mapPass=new ro(v.x,v.y,rr),Ji.camera.updateProjectionMatrix()}if(Ji.map===null){const rr={minFilter:1003,magFilter:1003,format:1023};Ji.map=new ro(v.x,v.y,rr),Ji.map.texture.name=En.name+".shadowMap",Ji.camera.updateProjectionMatrix()}S.setRenderTarget(Ji.map),S.clear();const ir=Ji.getViewportCount();for(let rr=0;rr<ir;rr++){const vr=Ji.getViewport(rr);O.set(M.x*vr.x,M.y*vr.y,M.x*vr.z,M.y*vr.w),Li.viewport(O),Ji.updateMatrices(En,rr),y=Ji.getFrustum(),Et(jt,Xt,Ji.camera,En,this.type)}Ji.isPointLightShadow||this.type!==3||Te(Ji,Xt),Ji.needsUpdate=!1}Re.needsUpdate=!1,S.setRenderTarget(_i,vi,Bi)}}function dp(S,e,u){const y=u.isWebGL2,v=new function(){let Bt=!1;const Ii=new Dr;let gn=null;const vn=new Dr(0,0,0,0);return{setMask:function(pn){gn===pn||Bt||(S.colorMask(pn,pn,pn,pn),gn=pn)},setLocked:function(pn){Bt=pn},setClear:function(pn,or,Ar,mr,ns){ns===!0&&(pn*=mr,or*=mr,Ar*=mr),Ii.set(pn,or,Ar,mr),vn.equals(Ii)===!1&&(S.clearColor(pn,or,Ar,mr),vn.copy(Ii))},reset:function(){Bt=!1,gn=null,vn.set(-1,0,0,0)}}},M=new function(){let Bt=!1,Ii=null,gn=null,vn=null;return{setTest:function(pn){pn?Rn(2929):$t(2929)},setMask:function(pn){Ii===pn||Bt||(S.depthMask(pn),Ii=pn)},setFunc:function(pn){if(gn!==pn){if(pn)switch(pn){case 0:S.depthFunc(512);break;case 1:S.depthFunc(519);break;case 2:S.depthFunc(513);break;case 3:S.depthFunc(515);break;case 4:S.depthFunc(514);break;case 5:S.depthFunc(518);break;case 6:S.depthFunc(516);break;case 7:S.depthFunc(517);break;default:S.depthFunc(515)}else S.depthFunc(515);gn=pn}},setLocked:function(pn){Bt=pn},setClear:function(pn){vn!==pn&&(S.clearDepth(pn),vn=pn)},reset:function(){Bt=!1,Ii=null,gn=null,vn=null}}},O=new function(){let Bt=!1,Ii=null,gn=null,vn=null,pn=null,or=null,Ar=null,mr=null,ns=null;return{setTest:function(Kr){Bt||(Kr?Rn(2960):$t(2960))},setMask:function(Kr){Ii===Kr||Bt||(S.stencilMask(Kr),Ii=Kr)},setFunc:function(Kr,sa,no){gn===Kr&&vn===sa&&pn===no||(S.stencilFunc(Kr,sa,no),gn=Kr,vn=sa,pn=no)},setOp:function(Kr,sa,no){or===Kr&&Ar===sa&&mr===no||(S.stencilOp(Kr,sa,no),or=Kr,Ar=sa,mr=no)},setLocked:function(Kr){Bt=Kr},setClear:function(Kr){ns!==Kr&&(S.clearStencil(Kr),ns=Kr)},reset:function(){Bt=!1,Ii=null,gn=null,vn=null,pn=null,or=null,Ar=null,mr=null,ns=null}}};let V={},G=null,H={},Q=null,ee=!1,se=null,ae=null,de=null,be=null,Re=null,Te=null,ct=null,Et=!1,_t=null,jt=null,Xt=null,_i=null,vi=null;const Bi=S.getParameter(35661);let Li=!1,ki=0;const Zn=S.getParameter(7938);Zn.indexOf("WebGL")!==-1?(ki=parseFloat(/^WebGL (\d)/.exec(Zn)[1]),Li=ki>=1):Zn.indexOf("OpenGL ES")!==-1&&(ki=parseFloat(/^OpenGL ES (\d)/.exec(Zn)[1]),Li=ki>=2);let En=null,Ji={};const In=S.getParameter(3088),ir=S.getParameter(2978),rr=new Dr().fromArray(In),vr=new Dr().fromArray(ir);function kr(Bt,Ii,gn){const vn=new Uint8Array(4),pn=S.createTexture();S.bindTexture(Bt,pn),S.texParameteri(Bt,10241,9728),S.texParameteri(Bt,10240,9728);for(let or=0;or<gn;or++)S.texImage2D(Ii+or,0,6408,1,1,0,6408,5121,vn);return pn}const Fr={};function Rn(Bt){V[Bt]!==!0&&(S.enable(Bt),V[Bt]=!0)}function $t(Bt){V[Bt]!==!1&&(S.disable(Bt),V[Bt]=!1)}Fr[3553]=kr(3553,3553,1),Fr[34067]=kr(34067,34069,6),v.setClear(0,0,0,1),M.setClear(1),O.setClear(0),Rn(2929),M.setFunc(3),Oi(!1),Nn(1),Rn(2884),ji(0);const ii={100:32774,101:32778,102:32779};if(y)ii[103]=32775,ii[104]=32776;else{const Bt=e.get("EXT_blend_minmax");Bt!==null&&(ii[103]=Bt.MIN_EXT,ii[104]=Bt.MAX_EXT)}const Qi={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function ji(Bt,Ii,gn,vn,pn,or,Ar,mr){if(Bt!==0){if(ee===!1&&(Rn(3042),ee=!0),Bt===5)pn=pn||Ii,or=or||gn,Ar=Ar||vn,Ii===ae&&pn===Re||(S.blendEquationSeparate(ii[Ii],ii[pn]),ae=Ii,Re=pn),gn===de&&vn===be&&or===Te&&Ar===ct||(S.blendFuncSeparate(Qi[gn],Qi[vn],Qi[or],Qi[Ar]),de=gn,be=vn,Te=or,ct=Ar),se=Bt,Et=null;else if(Bt!==se||mr!==Et){if(ae===100&&Re===100||(S.blendEquation(32774),ae=100,Re=100),mr)switch(Bt){case 1:S.blendFuncSeparate(1,771,1,771);break;case 2:S.blendFunc(1,1);break;case 3:S.blendFuncSeparate(0,0,769,771);break;case 4:S.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Bt)}else switch(Bt){case 1:S.blendFuncSeparate(770,771,1,771);break;case 2:S.blendFunc(770,1);break;case 3:S.blendFunc(0,769);break;case 4:S.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Bt)}de=null,be=null,Te=null,ct=null,se=Bt,Et=mr}}else ee===!0&&($t(3042),ee=!1)}function Oi(Bt){_t!==Bt&&(Bt?S.frontFace(2304):S.frontFace(2305),_t=Bt)}function Nn(Bt){Bt!==0?(Rn(2884),Bt!==jt&&(Bt===1?S.cullFace(1029):Bt===2?S.cullFace(1028):S.cullFace(1032))):$t(2884),jt=Bt}function Hn(Bt,Ii,gn){Bt?(Rn(32823),_i===Ii&&vi===gn||(S.polygonOffset(Ii,gn),_i=Ii,vi=gn)):$t(32823)}function Ni(Bt){Bt===void 0&&(Bt=33984+Bi-1),En!==Bt&&(S.activeTexture(Bt),En=Bt)}return{buffers:{color:v,depth:M,stencil:O},enable:Rn,disable:$t,bindFramebuffer:function(Bt,Ii){return Ii===null&&G!==null&&(Ii=G),H[Bt]!==Ii&&(S.bindFramebuffer(Bt,Ii),H[Bt]=Ii,y&&(Bt===36009&&(H[36160]=Ii),Bt===36160&&(H[36009]=Ii)),!0)},bindXRFramebuffer:function(Bt){Bt!==G&&(S.bindFramebuffer(36160,Bt),G=Bt)},useProgram:function(Bt){return Q!==Bt&&(S.useProgram(Bt),Q=Bt,!0)},setBlending:ji,setMaterial:function(Bt,Ii){Bt.side===2?$t(2884):Rn(2884);let gn=Bt.side===1;Ii&&(gn=!gn),Oi(gn),Bt.blending===1&&Bt.transparent===!1?ji(0):ji(Bt.blending,Bt.blendEquation,Bt.blendSrc,Bt.blendDst,Bt.blendEquationAlpha,Bt.blendSrcAlpha,Bt.blendDstAlpha,Bt.premultipliedAlpha),M.setFunc(Bt.depthFunc),M.setTest(Bt.depthTest),M.setMask(Bt.depthWrite),v.setMask(Bt.colorWrite);const vn=Bt.stencilWrite;O.setTest(vn),vn&&(O.setMask(Bt.stencilWriteMask),O.setFunc(Bt.stencilFunc,Bt.stencilRef,Bt.stencilFuncMask),O.setOp(Bt.stencilFail,Bt.stencilZFail,Bt.stencilZPass)),Hn(Bt.polygonOffset,Bt.polygonOffsetFactor,Bt.polygonOffsetUnits),Bt.alphaToCoverage===!0?Rn(32926):$t(32926)},setFlipSided:Oi,setCullFace:Nn,setLineWidth:function(Bt){Bt!==Xt&&(Li&&S.lineWidth(Bt),Xt=Bt)},setPolygonOffset:Hn,setScissorTest:function(Bt){Bt?Rn(3089):$t(3089)},activeTexture:Ni,bindTexture:function(Bt,Ii){En===null&&Ni();let gn=Ji[En];gn===void 0&&(gn={type:void 0,texture:void 0},Ji[En]=gn),gn.type===Bt&&gn.texture===Ii||(S.bindTexture(Bt,Ii||Fr[Bt]),gn.type=Bt,gn.texture=Ii)},unbindTexture:function(){const Bt=Ji[En];Bt!==void 0&&Bt.type!==void 0&&(S.bindTexture(Bt.type,null),Bt.type=void 0,Bt.texture=void 0)},compressedTexImage2D:function(){try{S.compressedTexImage2D.apply(S,arguments)}catch(Bt){console.error("THREE.WebGLState:",Bt)}},texImage2D:function(){try{S.texImage2D.apply(S,arguments)}catch(Bt){console.error("THREE.WebGLState:",Bt)}},texImage3D:function(){try{S.texImage3D.apply(S,arguments)}catch(Bt){console.error("THREE.WebGLState:",Bt)}},scissor:function(Bt){rr.equals(Bt)===!1&&(S.scissor(Bt.x,Bt.y,Bt.z,Bt.w),rr.copy(Bt))},viewport:function(Bt){vr.equals(Bt)===!1&&(S.viewport(Bt.x,Bt.y,Bt.z,Bt.w),vr.copy(Bt))},reset:function(){S.disable(3042),S.disable(2884),S.disable(2929),S.disable(32823),S.disable(3089),S.disable(2960),S.disable(32926),S.blendEquation(32774),S.blendFunc(1,0),S.blendFuncSeparate(1,0,1,0),S.colorMask(!0,!0,!0,!0),S.clearColor(0,0,0,0),S.depthMask(!0),S.depthFunc(513),S.clearDepth(1),S.stencilMask(4294967295),S.stencilFunc(519,0,4294967295),S.stencilOp(7680,7680,7680),S.clearStencil(0),S.cullFace(1029),S.frontFace(2305),S.polygonOffset(0,0),S.activeTexture(33984),S.bindFramebuffer(36160,null),y===!0&&(S.bindFramebuffer(36009,null),S.bindFramebuffer(36008,null)),S.useProgram(null),S.lineWidth(1),S.scissor(0,0,S.canvas.width,S.canvas.height),S.viewport(0,0,S.canvas.width,S.canvas.height),V={},En=null,Ji={},G=null,H={},Q=null,ee=!1,se=null,ae=null,de=null,be=null,Re=null,Te=null,ct=null,Et=!1,_t=null,jt=null,Xt=null,_i=null,vi=null,rr.set(0,0,S.canvas.width,S.canvas.height),vr.set(0,0,S.canvas.width,S.canvas.height),v.reset(),M.reset(),O.reset()}}}function Nf(S,e,u,y,v,M,O){const V=v.isWebGL2,G=v.maxTextures,H=v.maxCubemapSize,Q=v.maxTextureSize,ee=v.maxSamples,se=new WeakMap;let ae,de=!1;try{de=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function be($t,ii){return de?new OffscreenCanvas($t,ii):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function Re($t,ii,Qi,ji){let Oi=1;if(($t.width>ji||$t.height>ji)&&(Oi=ji/Math.max($t.width,$t.height)),Oi<1||ii===!0){if(typeof HTMLImageElement<"u"&&$t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&$t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&$t instanceof ImageBitmap){const Nn=ii?to:Math.floor,Hn=Nn(Oi*$t.width),Ni=Nn(Oi*$t.height);ae===void 0&&(ae=be(Hn,Ni));const Bt=Qi?be(Hn,Ni):ae;return Bt.width=Hn,Bt.height=Ni,Bt.getContext("2d").drawImage($t,0,0,Hn,Ni),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+$t.width+"x"+$t.height+") to ("+Hn+"x"+Ni+")."),Bt}return"data"in $t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+$t.width+"x"+$t.height+")."),$t}return $t}function Te($t){return Lr($t.width)&&Lr($t.height)}function ct($t,ii){return $t.generateMipmaps&&ii&&$t.minFilter!==1003&&$t.minFilter!==1006}function Et($t,ii,Qi,ji,Oi=1){S.generateMipmap($t),y.get(ii).__maxMipLevel=Math.log2(Math.max(Qi,ji,Oi))}function _t($t,ii,Qi){if(V===!1)return ii;if($t!==null){if(S[$t]!==void 0)return S[$t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+$t+"'")}let ji=ii;return ii===6403&&(Qi===5126&&(ji=33326),Qi===5131&&(ji=33325),Qi===5121&&(ji=33321)),ii===6407&&(Qi===5126&&(ji=34837),Qi===5131&&(ji=34843),Qi===5121&&(ji=32849)),ii===6408&&(Qi===5126&&(ji=34836),Qi===5131&&(ji=34842),Qi===5121&&(ji=32856)),ji!==33325&&ji!==33326&&ji!==34842&&ji!==34836||e.get("EXT_color_buffer_float"),ji}function jt($t){return $t===1003||$t===1004||$t===1005?9728:9729}function Xt($t){const ii=$t.target;ii.removeEventListener("dispose",Xt),function(Qi){const ji=y.get(Qi);ji.__webglInit!==void 0&&(S.deleteTexture(ji.__webglTexture),y.remove(Qi))}(ii),ii.isVideoTexture&&se.delete(ii),O.memory.textures--}function _i($t){const ii=$t.target;ii.removeEventListener("dispose",_i),function(Qi){const ji=Qi.texture,Oi=y.get(Qi),Nn=y.get(ji);if(Qi){if(Nn.__webglTexture!==void 0&&(S.deleteTexture(Nn.__webglTexture),O.memory.textures--),Qi.depthTexture&&Qi.depthTexture.dispose(),Qi.isWebGLCubeRenderTarget)for(let Hn=0;Hn<6;Hn++)S.deleteFramebuffer(Oi.__webglFramebuffer[Hn]),Oi.__webglDepthbuffer&&S.deleteRenderbuffer(Oi.__webglDepthbuffer[Hn]);else S.deleteFramebuffer(Oi.__webglFramebuffer),Oi.__webglDepthbuffer&&S.deleteRenderbuffer(Oi.__webglDepthbuffer),Oi.__webglMultisampledFramebuffer&&S.deleteFramebuffer(Oi.__webglMultisampledFramebuffer),Oi.__webglColorRenderbuffer&&S.deleteRenderbuffer(Oi.__webglColorRenderbuffer),Oi.__webglDepthRenderbuffer&&S.deleteRenderbuffer(Oi.__webglDepthRenderbuffer);if(Qi.isWebGLMultipleRenderTargets)for(let Hn=0,Ni=ji.length;Hn<Ni;Hn++){const Bt=y.get(ji[Hn]);Bt.__webglTexture&&(S.deleteTexture(Bt.__webglTexture),O.memory.textures--),y.remove(ji[Hn])}y.remove(ji),y.remove(Qi)}}(ii)}let vi=0;function Bi($t,ii){const Qi=y.get($t);if($t.isVideoTexture&&function(ji){const Oi=O.render.frame;se.get(ji)!==Oi&&(se.set(ji,Oi),ji.update())}($t),$t.version>0&&Qi.__version!==$t.version){const ji=$t.image;if(ji===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(ji.complete!==!1)return void In(Qi,$t,ii);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}u.activeTexture(33984+ii),u.bindTexture(3553,Qi.__webglTexture)}function Li($t,ii){const Qi=y.get($t);$t.version>0&&Qi.__version!==$t.version?function(ji,Oi,Nn){if(Oi.image.length!==6)return;Ji(ji,Oi),u.activeTexture(33984+Nn),u.bindTexture(34067,ji.__webglTexture),S.pixelStorei(37440,Oi.flipY),S.pixelStorei(37441,Oi.premultiplyAlpha),S.pixelStorei(3317,Oi.unpackAlignment),S.pixelStorei(37443,0);const Hn=Oi&&(Oi.isCompressedTexture||Oi.image[0].isCompressedTexture),Ni=Oi.image[0]&&Oi.image[0].isDataTexture,Bt=[];for(let mr=0;mr<6;mr++)Bt[mr]=Hn||Ni?Ni?Oi.image[mr].image:Oi.image[mr]:Re(Oi.image[mr],!1,!0,H);const Ii=Bt[0],gn=Te(Ii)||V,vn=M.convert(Oi.format),pn=M.convert(Oi.type),or=_t(Oi.internalFormat,vn,pn);let Ar;if(En(34067,Oi,gn),Hn){for(let mr=0;mr<6;mr++){Ar=Bt[mr].mipmaps;for(let ns=0;ns<Ar.length;ns++){const Kr=Ar[ns];Oi.format!==1023&&Oi.format!==1022?vn!==null?u.compressedTexImage2D(34069+mr,ns,or,Kr.width,Kr.height,0,Kr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):u.texImage2D(34069+mr,ns,or,Kr.width,Kr.height,0,vn,pn,Kr.data)}}ji.__maxMipLevel=Ar.length-1}else{Ar=Oi.mipmaps;for(let mr=0;mr<6;mr++)if(Ni){u.texImage2D(34069+mr,0,or,Bt[mr].width,Bt[mr].height,0,vn,pn,Bt[mr].data);for(let ns=0;ns<Ar.length;ns++){const Kr=Ar[ns].image[mr].image;u.texImage2D(34069+mr,ns+1,or,Kr.width,Kr.height,0,vn,pn,Kr.data)}}else{u.texImage2D(34069+mr,0,or,vn,pn,Bt[mr]);for(let ns=0;ns<Ar.length;ns++){const Kr=Ar[ns];u.texImage2D(34069+mr,ns+1,or,vn,pn,Kr.image[mr])}}ji.__maxMipLevel=Ar.length}ct(Oi,gn)&&Et(34067,Oi,Ii.width,Ii.height),ji.__version=Oi.version,Oi.onUpdate&&Oi.onUpdate(Oi)}(Qi,$t,ii):(u.activeTexture(33984+ii),u.bindTexture(34067,Qi.__webglTexture))}const ki={1e3:10497,1001:33071,1002:33648},Zn={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function En($t,ii,Qi){if(Qi?(S.texParameteri($t,10242,ki[ii.wrapS]),S.texParameteri($t,10243,ki[ii.wrapT]),$t!==32879&&$t!==35866||S.texParameteri($t,32882,ki[ii.wrapR]),S.texParameteri($t,10240,Zn[ii.magFilter]),S.texParameteri($t,10241,Zn[ii.minFilter])):(S.texParameteri($t,10242,33071),S.texParameteri($t,10243,33071),$t!==32879&&$t!==35866||S.texParameteri($t,32882,33071),ii.wrapS===1001&&ii.wrapT===1001||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),S.texParameteri($t,10240,jt(ii.magFilter)),S.texParameteri($t,10241,jt(ii.minFilter)),ii.minFilter!==1003&&ii.minFilter!==1006&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const ji=e.get("EXT_texture_filter_anisotropic");if(ii.type===1015&&e.has("OES_texture_float_linear")===!1||V===!1&&ii.type===1016&&e.has("OES_texture_half_float_linear")===!1)return;(ii.anisotropy>1||y.get(ii).__currentAnisotropy)&&(S.texParameterf($t,ji.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ii.anisotropy,v.getMaxAnisotropy())),y.get(ii).__currentAnisotropy=ii.anisotropy)}}function Ji($t,ii){$t.__webglInit===void 0&&($t.__webglInit=!0,ii.addEventListener("dispose",Xt),$t.__webglTexture=S.createTexture(),O.memory.textures++)}function In($t,ii,Qi){let ji=3553;ii.isDataTexture2DArray&&(ji=35866),ii.isDataTexture3D&&(ji=32879),Ji($t,ii),u.activeTexture(33984+Qi),u.bindTexture(ji,$t.__webglTexture),S.pixelStorei(37440,ii.flipY),S.pixelStorei(37441,ii.premultiplyAlpha),S.pixelStorei(3317,ii.unpackAlignment),S.pixelStorei(37443,0);const Oi=function(pn){return!V&&(pn.wrapS!==1001||pn.wrapT!==1001||pn.minFilter!==1003&&pn.minFilter!==1006)}(ii)&&Te(ii.image)===!1,Nn=Re(ii.image,Oi,!1,Q),Hn=Te(Nn)||V,Ni=M.convert(ii.format);let Bt,Ii=M.convert(ii.type),gn=_t(ii.internalFormat,Ni,Ii);En(ji,ii,Hn);const vn=ii.mipmaps;if(ii.isDepthTexture)gn=6402,V?gn=ii.type===1015?36012:ii.type===1014?33190:ii.type===1020?35056:33189:ii.type===1015&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ii.format===1026&&gn===6402&&ii.type!==1012&&ii.type!==1014&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ii.type=1012,Ii=M.convert(ii.type)),ii.format===1027&&gn===6402&&(gn=34041,ii.type!==1020&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ii.type=1020,Ii=M.convert(ii.type))),u.texImage2D(3553,0,gn,Nn.width,Nn.height,0,Ni,Ii,null);else if(ii.isDataTexture)if(vn.length>0&&Hn){for(let pn=0,or=vn.length;pn<or;pn++)Bt=vn[pn],u.texImage2D(3553,pn,gn,Bt.width,Bt.height,0,Ni,Ii,Bt.data);ii.generateMipmaps=!1,$t.__maxMipLevel=vn.length-1}else u.texImage2D(3553,0,gn,Nn.width,Nn.height,0,Ni,Ii,Nn.data),$t.__maxMipLevel=0;else if(ii.isCompressedTexture){for(let pn=0,or=vn.length;pn<or;pn++)Bt=vn[pn],ii.format!==1023&&ii.format!==1022?Ni!==null?u.compressedTexImage2D(3553,pn,gn,Bt.width,Bt.height,0,Bt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):u.texImage2D(3553,pn,gn,Bt.width,Bt.height,0,Ni,Ii,Bt.data);$t.__maxMipLevel=vn.length-1}else if(ii.isDataTexture2DArray)u.texImage3D(35866,0,gn,Nn.width,Nn.height,Nn.depth,0,Ni,Ii,Nn.data),$t.__maxMipLevel=0;else if(ii.isDataTexture3D)u.texImage3D(32879,0,gn,Nn.width,Nn.height,Nn.depth,0,Ni,Ii,Nn.data),$t.__maxMipLevel=0;else if(vn.length>0&&Hn){for(let pn=0,or=vn.length;pn<or;pn++)Bt=vn[pn],u.texImage2D(3553,pn,gn,Ni,Ii,Bt);ii.generateMipmaps=!1,$t.__maxMipLevel=vn.length-1}else u.texImage2D(3553,0,gn,Ni,Ii,Nn),$t.__maxMipLevel=0;ct(ii,Hn)&&Et(ji,ii,Nn.width,Nn.height),$t.__version=ii.version,ii.onUpdate&&ii.onUpdate(ii)}function ir($t,ii,Qi,ji,Oi){const Nn=M.convert(Qi.format),Hn=M.convert(Qi.type),Ni=_t(Qi.internalFormat,Nn,Hn);Oi===32879||Oi===35866?u.texImage3D(Oi,0,Ni,ii.width,ii.height,ii.depth,0,Nn,Hn,null):u.texImage2D(Oi,0,Ni,ii.width,ii.height,0,Nn,Hn,null),u.bindFramebuffer(36160,$t),S.framebufferTexture2D(36160,ji,Oi,y.get(Qi).__webglTexture,0),u.bindFramebuffer(36160,null)}function rr($t,ii,Qi){if(S.bindRenderbuffer(36161,$t),ii.depthBuffer&&!ii.stencilBuffer){let ji=33189;if(Qi){const Oi=ii.depthTexture;Oi&&Oi.isDepthTexture&&(Oi.type===1015?ji=36012:Oi.type===1014&&(ji=33190));const Nn=kr(ii);S.renderbufferStorageMultisample(36161,Nn,ji,ii.width,ii.height)}else S.renderbufferStorage(36161,ji,ii.width,ii.height);S.framebufferRenderbuffer(36160,36096,36161,$t)}else if(ii.depthBuffer&&ii.stencilBuffer){if(Qi){const ji=kr(ii);S.renderbufferStorageMultisample(36161,ji,35056,ii.width,ii.height)}else S.renderbufferStorage(36161,34041,ii.width,ii.height);S.framebufferRenderbuffer(36160,33306,36161,$t)}else{const ji=ii.isWebGLMultipleRenderTargets===!0?ii.texture[0]:ii.texture,Oi=M.convert(ji.format),Nn=M.convert(ji.type),Hn=_t(ji.internalFormat,Oi,Nn);if(Qi){const Ni=kr(ii);S.renderbufferStorageMultisample(36161,Ni,Hn,ii.width,ii.height)}else S.renderbufferStorage(36161,Hn,ii.width,ii.height)}S.bindRenderbuffer(36161,null)}function vr($t){const ii=y.get($t),Qi=$t.isWebGLCubeRenderTarget===!0;if($t.depthTexture){if(Qi)throw new Error("target.depthTexture not supported in Cube render targets");(function(ji,Oi){if(Oi&&Oi.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(u.bindFramebuffer(36160,ji),!Oi.depthTexture||!Oi.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");y.get(Oi.depthTexture).__webglTexture&&Oi.depthTexture.image.width===Oi.width&&Oi.depthTexture.image.height===Oi.height||(Oi.depthTexture.image.width=Oi.width,Oi.depthTexture.image.height=Oi.height,Oi.depthTexture.needsUpdate=!0),Bi(Oi.depthTexture,0);const Nn=y.get(Oi.depthTexture).__webglTexture;if(Oi.depthTexture.format===1026)S.framebufferTexture2D(36160,36096,3553,Nn,0);else{if(Oi.depthTexture.format!==1027)throw new Error("Unknown depthTexture format");S.framebufferTexture2D(36160,33306,3553,Nn,0)}})(ii.__webglFramebuffer,$t)}else if(Qi){ii.__webglDepthbuffer=[];for(let ji=0;ji<6;ji++)u.bindFramebuffer(36160,ii.__webglFramebuffer[ji]),ii.__webglDepthbuffer[ji]=S.createRenderbuffer(),rr(ii.__webglDepthbuffer[ji],$t,!1)}else u.bindFramebuffer(36160,ii.__webglFramebuffer),ii.__webglDepthbuffer=S.createRenderbuffer(),rr(ii.__webglDepthbuffer,$t,!1);u.bindFramebuffer(36160,null)}function kr($t){return V&&$t.isWebGLMultisampleRenderTarget?Math.min(ee,$t.samples):0}let Fr=!1,Rn=!1;this.allocateTextureUnit=function(){const $t=vi;return $t>=G&&console.warn("THREE.WebGLTextures: Trying to use "+$t+" texture units while this GPU supports only "+G),vi+=1,$t},this.resetTextureUnits=function(){vi=0},this.setTexture2D=Bi,this.setTexture2DArray=function($t,ii){const Qi=y.get($t);$t.version>0&&Qi.__version!==$t.version?In(Qi,$t,ii):(u.activeTexture(33984+ii),u.bindTexture(35866,Qi.__webglTexture))},this.setTexture3D=function($t,ii){const Qi=y.get($t);$t.version>0&&Qi.__version!==$t.version?In(Qi,$t,ii):(u.activeTexture(33984+ii),u.bindTexture(32879,Qi.__webglTexture))},this.setTextureCube=Li,this.setupRenderTarget=function($t){const ii=$t.texture,Qi=y.get($t),ji=y.get(ii);$t.addEventListener("dispose",_i),$t.isWebGLMultipleRenderTargets!==!0&&(ji.__webglTexture=S.createTexture(),ji.__version=ii.version,O.memory.textures++);const Oi=$t.isWebGLCubeRenderTarget===!0,Nn=$t.isWebGLMultipleRenderTargets===!0,Hn=$t.isWebGLMultisampleRenderTarget===!0,Ni=ii.isDataTexture3D||ii.isDataTexture2DArray,Bt=Te($t)||V;if(!V||ii.format!==1022||ii.type!==1015&&ii.type!==1016||(ii.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Oi){Qi.__webglFramebuffer=[];for(let Ii=0;Ii<6;Ii++)Qi.__webglFramebuffer[Ii]=S.createFramebuffer()}else if(Qi.__webglFramebuffer=S.createFramebuffer(),Nn)if(v.drawBuffers){const Ii=$t.texture;for(let gn=0,vn=Ii.length;gn<vn;gn++){const pn=y.get(Ii[gn]);pn.__webglTexture===void 0&&(pn.__webglTexture=S.createTexture(),O.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(Hn)if(V){Qi.__webglMultisampledFramebuffer=S.createFramebuffer(),Qi.__webglColorRenderbuffer=S.createRenderbuffer(),S.bindRenderbuffer(36161,Qi.__webglColorRenderbuffer);const Ii=M.convert(ii.format),gn=M.convert(ii.type),vn=_t(ii.internalFormat,Ii,gn),pn=kr($t);S.renderbufferStorageMultisample(36161,pn,vn,$t.width,$t.height),u.bindFramebuffer(36160,Qi.__webglMultisampledFramebuffer),S.framebufferRenderbuffer(36160,36064,36161,Qi.__webglColorRenderbuffer),S.bindRenderbuffer(36161,null),$t.depthBuffer&&(Qi.__webglDepthRenderbuffer=S.createRenderbuffer(),rr(Qi.__webglDepthRenderbuffer,$t,!0)),u.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Oi){u.bindTexture(34067,ji.__webglTexture),En(34067,ii,Bt);for(let Ii=0;Ii<6;Ii++)ir(Qi.__webglFramebuffer[Ii],$t,ii,36064,34069+Ii);ct(ii,Bt)&&Et(34067,ii,$t.width,$t.height),u.unbindTexture()}else if(Nn){const Ii=$t.texture;for(let gn=0,vn=Ii.length;gn<vn;gn++){const pn=Ii[gn],or=y.get(pn);u.bindTexture(3553,or.__webglTexture),En(3553,pn,Bt),ir(Qi.__webglFramebuffer,$t,pn,36064+gn,3553),ct(pn,Bt)&&Et(3553,pn,$t.width,$t.height)}u.unbindTexture()}else{let Ii=3553;Ni&&(V?Ii=ii.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),u.bindTexture(Ii,ji.__webglTexture),En(Ii,ii,Bt),ir(Qi.__webglFramebuffer,$t,ii,36064,Ii),ct(ii,Bt)&&Et(Ii,ii,$t.width,$t.height,$t.depth),u.unbindTexture()}$t.depthBuffer&&vr($t)},this.updateRenderTargetMipmap=function($t){const ii=Te($t)||V,Qi=$t.isWebGLMultipleRenderTargets===!0?$t.texture:[$t.texture];for(let ji=0,Oi=Qi.length;ji<Oi;ji++){const Nn=Qi[ji];if(ct(Nn,ii)){const Hn=$t.isWebGLCubeRenderTarget?34067:3553,Ni=y.get(Nn).__webglTexture;u.bindTexture(Hn,Ni),Et(Hn,Nn,$t.width,$t.height),u.unbindTexture()}}},this.updateMultisampleRenderTarget=function($t){if($t.isWebGLMultisampleRenderTarget)if(V){const ii=$t.width,Qi=$t.height;let ji=16384;$t.depthBuffer&&(ji|=256),$t.stencilBuffer&&(ji|=1024);const Oi=y.get($t);u.bindFramebuffer(36008,Oi.__webglMultisampledFramebuffer),u.bindFramebuffer(36009,Oi.__webglFramebuffer),S.blitFramebuffer(0,0,ii,Qi,0,0,ii,Qi,ji,9728),u.bindFramebuffer(36008,null),u.bindFramebuffer(36009,Oi.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function($t,ii){$t&&$t.isWebGLRenderTarget&&(Fr===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Fr=!0),$t=$t.texture),Bi($t,ii)},this.safeSetTextureCube=function($t,ii){$t&&$t.isWebGLCubeRenderTarget&&(Rn===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Rn=!0),$t=$t.texture),Li($t,ii)}}function Uf(S,e,u){const y=u.isWebGL2;return{convert:function(v){let M;if(v===1009)return 5121;if(v===1017)return 32819;if(v===1018)return 32820;if(v===1019)return 33635;if(v===1010)return 5120;if(v===1011)return 5122;if(v===1012)return 5123;if(v===1013)return 5124;if(v===1014)return 5125;if(v===1015)return 5126;if(v===1016)return y?5131:(M=e.get("OES_texture_half_float"),M!==null?M.HALF_FLOAT_OES:null);if(v===1021)return 6406;if(v===1022)return 6407;if(v===1023)return 6408;if(v===1024)return 6409;if(v===1025)return 6410;if(v===1026)return 6402;if(v===1027)return 34041;if(v===1028)return 6403;if(v===1029)return 36244;if(v===1030)return 33319;if(v===1031)return 33320;if(v===1032)return 36248;if(v===1033)return 36249;if(v===33776||v===33777||v===33778||v===33779){if(M=e.get("WEBGL_compressed_texture_s3tc"),M===null)return null;if(v===33776)return M.COMPRESSED_RGB_S3TC_DXT1_EXT;if(v===33777)return M.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(v===33778)return M.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(v===33779)return M.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(v===35840||v===35841||v===35842||v===35843){if(M=e.get("WEBGL_compressed_texture_pvrtc"),M===null)return null;if(v===35840)return M.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(v===35841)return M.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(v===35842)return M.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(v===35843)return M.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(v===36196)return M=e.get("WEBGL_compressed_texture_etc1"),M!==null?M.COMPRESSED_RGB_ETC1_WEBGL:null;if((v===37492||v===37496)&&(M=e.get("WEBGL_compressed_texture_etc"),M!==null)){if(v===37492)return M.COMPRESSED_RGB8_ETC2;if(v===37496)return M.COMPRESSED_RGBA8_ETC2_EAC}return v===37808||v===37809||v===37810||v===37811||v===37812||v===37813||v===37814||v===37815||v===37816||v===37817||v===37818||v===37819||v===37820||v===37821||v===37840||v===37841||v===37842||v===37843||v===37844||v===37845||v===37846||v===37847||v===37848||v===37849||v===37850||v===37851||v===37852||v===37853?(M=e.get("WEBGL_compressed_texture_astc"),M!==null?v:null):v===36492?(M=e.get("EXT_texture_compression_bptc"),M!==null?v:null):v===1020?y?34042:(M=e.get("WEBGL_depth_texture"),M!==null?M.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class pp extends vo{constructor(e=[]){super(),this.cameras=e}}pp.prototype.isArrayCamera=!0;class Gc extends Ee{constructor(){super(),this.type="Group"}}Gc.prototype.isGroup=!0;const S_={type:"move"};class Hc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Gc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Gc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new re,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new re),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Gc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new re,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new re),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,u,y){let v=null,M=null,O=null;const V=this._targetRay,G=this._grip,H=this._hand;if(e&&u.session.visibilityState!=="visible-blurred")if(V!==null&&(v=u.getPose(e.targetRaySpace,y),v!==null&&(V.matrix.fromArray(v.transform.matrix),V.matrix.decompose(V.position,V.rotation,V.scale),v.linearVelocity?(V.hasLinearVelocity=!0,V.linearVelocity.copy(v.linearVelocity)):V.hasLinearVelocity=!1,v.angularVelocity?(V.hasAngularVelocity=!0,V.angularVelocity.copy(v.angularVelocity)):V.hasAngularVelocity=!1,this.dispatchEvent(S_))),H&&e.hand){O=!0;for(const be of e.hand.values()){const Re=u.getJointPose(be,y);if(H.joints[be.jointName]===void 0){const ct=new Gc;ct.matrixAutoUpdate=!1,ct.visible=!1,H.joints[be.jointName]=ct,H.add(ct)}const Te=H.joints[be.jointName];Re!==null&&(Te.matrix.fromArray(Re.transform.matrix),Te.matrix.decompose(Te.position,Te.rotation,Te.scale),Te.jointRadius=Re.radius),Te.visible=Re!==null}const Q=H.joints["index-finger-tip"],ee=H.joints["thumb-tip"],se=Q.position.distanceTo(ee.position),ae=.02,de=.005;H.inputState.pinching&&se>ae+de?(H.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!H.inputState.pinching&&se<=ae-de&&(H.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else G!==null&&e.gripSpace&&(M=u.getPose(e.gripSpace,y),M!==null&&(G.matrix.fromArray(M.transform.matrix),G.matrix.decompose(G.position,G.rotation,G.scale),M.linearVelocity?(G.hasLinearVelocity=!0,G.linearVelocity.copy(M.linearVelocity)):G.hasLinearVelocity=!1,M.angularVelocity?(G.hasAngularVelocity=!0,G.angularVelocity.copy(M.angularVelocity)):G.hasAngularVelocity=!1));return V!==null&&(V.visible=v!==null),G!==null&&(G.visible=M!==null),H!==null&&(H.visible=O!==null),this}}class mh extends It{constructor(e,u){super();const y=this,v=e.state;let M=null,O=1,V=null,G="local-floor",H=null,Q=null,ee=null,se=null,ae=null,de=!1,be=null,Re=null,Te=null,ct=null,Et=null,_t=null;const jt=[],Xt=new Map,_i=new vo;_i.layers.enable(1),_i.viewport=new Dr;const vi=new vo;vi.layers.enable(2),vi.viewport=new Dr;const Bi=[_i,vi],Li=new pp;Li.layers.enable(1),Li.layers.enable(2);let ki=null,Zn=null;function En(Rn){const $t=Xt.get(Rn.inputSource);$t&&$t.dispatchEvent({type:Rn.type,data:Rn.inputSource})}function Ji(){Xt.forEach(function(Rn,$t){Rn.disconnect($t)}),Xt.clear(),ki=null,Zn=null,v.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),ee&&u.deleteFramebuffer(ee),be&&u.deleteFramebuffer(be),Re&&u.deleteRenderbuffer(Re),Te&&u.deleteRenderbuffer(Te),ee=null,be=null,Re=null,Te=null,ae=null,se=null,Q=null,M=null,Fr.stop(),y.isPresenting=!1,y.dispatchEvent({type:"sessionend"})}function In(Rn){const $t=M.inputSources;for(let ii=0;ii<jt.length;ii++)Xt.set($t[ii],jt[ii]);for(let ii=0;ii<Rn.removed.length;ii++){const Qi=Rn.removed[ii],ji=Xt.get(Qi);ji&&(ji.dispatchEvent({type:"disconnected",data:Qi}),Xt.delete(Qi))}for(let ii=0;ii<Rn.added.length;ii++){const Qi=Rn.added[ii],ji=Xt.get(Qi);ji&&ji.dispatchEvent({type:"connected",data:Qi})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Rn){let $t=jt[Rn];return $t===void 0&&($t=new Hc,jt[Rn]=$t),$t.getTargetRaySpace()},this.getControllerGrip=function(Rn){let $t=jt[Rn];return $t===void 0&&($t=new Hc,jt[Rn]=$t),$t.getGripSpace()},this.getHand=function(Rn){let $t=jt[Rn];return $t===void 0&&($t=new Hc,jt[Rn]=$t),$t.getHandSpace()},this.setFramebufferScaleFactor=function(Rn){O=Rn,y.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Rn){G=Rn,y.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return V},this.getBaseLayer=function(){return se!==null?se:ae},this.getBinding=function(){return Q},this.getFrame=function(){return ct},this.getSession=function(){return M},this.setSession=async function(Rn){if(M=Rn,M!==null){M.addEventListener("select",En),M.addEventListener("selectstart",En),M.addEventListener("selectend",En),M.addEventListener("squeeze",En),M.addEventListener("squeezestart",En),M.addEventListener("squeezeend",En),M.addEventListener("end",Ji),M.addEventListener("inputsourceschange",In);const $t=u.getContextAttributes();if($t.xrCompatible!==!0&&await u.makeXRCompatible(),M.renderState.layers===void 0){const ii={antialias:$t.antialias,alpha:$t.alpha,depth:$t.depth,stencil:$t.stencil,framebufferScaleFactor:O};ae=new XRWebGLLayer(M,u,ii),M.updateRenderState({baseLayer:ae})}else if(u instanceof WebGLRenderingContext){const ii={antialias:!0,alpha:$t.alpha,depth:$t.depth,stencil:$t.stencil,framebufferScaleFactor:O};ae=new XRWebGLLayer(M,u,ii),M.updateRenderState({layers:[ae]})}else{de=$t.antialias;let ii=null;$t.depth&&(_t=256,$t.stencil&&(_t|=1024),Et=$t.stencil?33306:36096,ii=$t.stencil?35056:33190);const Qi={colorFormat:$t.alpha?32856:32849,depthFormat:ii,scaleFactor:O};Q=new XRWebGLBinding(M,u),se=Q.createProjectionLayer(Qi),ee=u.createFramebuffer(),M.updateRenderState({layers:[se]}),de&&(be=u.createFramebuffer(),Re=u.createRenderbuffer(),u.bindRenderbuffer(36161,Re),u.renderbufferStorageMultisample(36161,4,32856,se.textureWidth,se.textureHeight),v.bindFramebuffer(36160,be),u.framebufferRenderbuffer(36160,36064,36161,Re),u.bindRenderbuffer(36161,null),ii!==null&&(Te=u.createRenderbuffer(),u.bindRenderbuffer(36161,Te),u.renderbufferStorageMultisample(36161,4,ii,se.textureWidth,se.textureHeight),u.framebufferRenderbuffer(36160,Et,36161,Te),u.bindRenderbuffer(36161,null)),v.bindFramebuffer(36160,null))}V=await M.requestReferenceSpace(G),Fr.setContext(M),Fr.start(),y.isPresenting=!0,y.dispatchEvent({type:"sessionstart"})}};const ir=new re,rr=new re;function vr(Rn,$t){$t===null?Rn.matrixWorld.copy(Rn.matrix):Rn.matrixWorld.multiplyMatrices($t.matrixWorld,Rn.matrix),Rn.matrixWorldInverse.copy(Rn.matrixWorld).invert()}this.updateCamera=function(Rn){if(M===null)return;Li.near=vi.near=_i.near=Rn.near,Li.far=vi.far=_i.far=Rn.far,ki===Li.near&&Zn===Li.far||(M.updateRenderState({depthNear:Li.near,depthFar:Li.far}),ki=Li.near,Zn=Li.far);const $t=Rn.parent,ii=Li.cameras;vr(Li,$t);for(let ji=0;ji<ii.length;ji++)vr(ii[ji],$t);Li.matrixWorld.decompose(Li.position,Li.quaternion,Li.scale),Rn.position.copy(Li.position),Rn.quaternion.copy(Li.quaternion),Rn.scale.copy(Li.scale),Rn.matrix.copy(Li.matrix),Rn.matrixWorld.copy(Li.matrixWorld);const Qi=Rn.children;for(let ji=0,Oi=Qi.length;ji<Oi;ji++)Qi[ji].updateMatrixWorld(!0);ii.length===2?function(ji,Oi,Nn){ir.setFromMatrixPosition(Oi.matrixWorld),rr.setFromMatrixPosition(Nn.matrixWorld);const Hn=ir.distanceTo(rr),Ni=Oi.projectionMatrix.elements,Bt=Nn.projectionMatrix.elements,Ii=Ni[14]/(Ni[10]-1),gn=Ni[14]/(Ni[10]+1),vn=(Ni[9]+1)/Ni[5],pn=(Ni[9]-1)/Ni[5],or=(Ni[8]-1)/Ni[0],Ar=(Bt[8]+1)/Bt[0],mr=Ii*or,ns=Ii*Ar,Kr=Hn/(-or+Ar),sa=Kr*-or;Oi.matrixWorld.decompose(ji.position,ji.quaternion,ji.scale),ji.translateX(sa),ji.translateZ(Kr),ji.matrixWorld.compose(ji.position,ji.quaternion,ji.scale),ji.matrixWorldInverse.copy(ji.matrixWorld).invert();const no=Ii+Kr,oa=gn+Kr,ul=mr-sa,Dh=ns+(Hn-sa),Cd=vn*gn/oa*no,Oh=pn*gn/oa*no;ji.projectionMatrix.makePerspective(ul,Dh,Cd,Oh,no,oa)}(Li,_i,vi):Li.projectionMatrix.copy(_i.projectionMatrix)},this.getCamera=function(){return Li},this.getFoveation=function(){return se!==null?se.fixedFoveation:ae!==null?ae.fixedFoveation:void 0},this.setFoveation=function(Rn){se!==null&&(se.fixedFoveation=Rn),ae!==null&&ae.fixedFoveation!==void 0&&(ae.fixedFoveation=Rn)};let kr=null;const Fr=new jl;Fr.setAnimationLoop(function(Rn,$t){if(H=$t.getViewerPose(V),ct=$t,H!==null){const Qi=H.views;ae!==null&&v.bindXRFramebuffer(ae.framebuffer);let ji=!1;Qi.length!==Li.cameras.length&&(Li.cameras.length=0,ji=!0);for(let Oi=0;Oi<Qi.length;Oi++){const Nn=Qi[Oi];let Hn=null;if(ae!==null)Hn=ae.getViewport(Nn);else{const Bt=Q.getViewSubImage(se,Nn);v.bindXRFramebuffer(ee),Bt.depthStencilTexture!==void 0&&u.framebufferTexture2D(36160,Et,3553,Bt.depthStencilTexture,0),u.framebufferTexture2D(36160,36064,3553,Bt.colorTexture,0),Hn=Bt.viewport}const Ni=Bi[Oi];Ni.matrix.fromArray(Nn.transform.matrix),Ni.projectionMatrix.fromArray(Nn.projectionMatrix),Ni.viewport.set(Hn.x,Hn.y,Hn.width,Hn.height),Oi===0&&Li.matrix.copy(Ni.matrix),ji===!0&&Li.cameras.push(Ni)}de&&(v.bindXRFramebuffer(be),_t!==null&&u.clear(_t))}const ii=M.inputSources;for(let Qi=0;Qi<jt.length;Qi++){const ji=jt[Qi],Oi=ii[Qi];ji.update(Oi,$t,V)}if(kr&&kr(Rn,$t),de){const Qi=se.textureWidth,ji=se.textureHeight;v.bindFramebuffer(36008,be),v.bindFramebuffer(36009,ee),u.invalidateFramebuffer(36008,[Et]),u.invalidateFramebuffer(36009,[Et]),u.blitFramebuffer(0,0,Qi,ji,0,0,Qi,ji,16384,9728),u.invalidateFramebuffer(36008,[36064]),v.bindFramebuffer(36008,null),v.bindFramebuffer(36009,null),v.bindFramebuffer(36160,be)}ct=null}),this.setAnimationLoop=function(Rn){kr=Rn},this.dispose=function(){}}}function qi(S){function e(y,v){y.opacity.value=v.opacity,v.color&&y.diffuse.value.copy(v.color),v.emissive&&y.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(y.map.value=v.map),v.alphaMap&&(y.alphaMap.value=v.alphaMap),v.specularMap&&(y.specularMap.value=v.specularMap),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);const M=S.get(v).envMap;if(M){y.envMap.value=M,y.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=v.reflectivity,y.ior.value=v.ior,y.refractionRatio.value=v.refractionRatio;const G=S.get(M).__maxMipLevel;G!==void 0&&(y.maxMipLevel.value=G)}let O,V;v.lightMap&&(y.lightMap.value=v.lightMap,y.lightMapIntensity.value=v.lightMapIntensity),v.aoMap&&(y.aoMap.value=v.aoMap,y.aoMapIntensity.value=v.aoMapIntensity),v.map?O=v.map:v.specularMap?O=v.specularMap:v.displacementMap?O=v.displacementMap:v.normalMap?O=v.normalMap:v.bumpMap?O=v.bumpMap:v.roughnessMap?O=v.roughnessMap:v.metalnessMap?O=v.metalnessMap:v.alphaMap?O=v.alphaMap:v.emissiveMap?O=v.emissiveMap:v.clearcoatMap?O=v.clearcoatMap:v.clearcoatNormalMap?O=v.clearcoatNormalMap:v.clearcoatRoughnessMap?O=v.clearcoatRoughnessMap:v.specularIntensityMap?O=v.specularIntensityMap:v.specularTintMap?O=v.specularTintMap:v.transmissionMap?O=v.transmissionMap:v.thicknessMap&&(O=v.thicknessMap),O!==void 0&&(O.isWebGLRenderTarget&&(O=O.texture),O.matrixAutoUpdate===!0&&O.updateMatrix(),y.uvTransform.value.copy(O.matrix)),v.aoMap?V=v.aoMap:v.lightMap&&(V=v.lightMap),V!==void 0&&(V.isWebGLRenderTarget&&(V=V.texture),V.matrixAutoUpdate===!0&&V.updateMatrix(),y.uv2Transform.value.copy(V.matrix))}function u(y,v){y.roughness.value=v.roughness,y.metalness.value=v.metalness,v.roughnessMap&&(y.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(y.metalnessMap.value=v.metalnessMap),v.emissiveMap&&(y.emissiveMap.value=v.emissiveMap),v.bumpMap&&(y.bumpMap.value=v.bumpMap,y.bumpScale.value=v.bumpScale,v.side===1&&(y.bumpScale.value*=-1)),v.normalMap&&(y.normalMap.value=v.normalMap,y.normalScale.value.copy(v.normalScale),v.side===1&&y.normalScale.value.negate()),v.displacementMap&&(y.displacementMap.value=v.displacementMap,y.displacementScale.value=v.displacementScale,y.displacementBias.value=v.displacementBias),S.get(v).envMap&&(y.envMapIntensity.value=v.envMapIntensity)}return{refreshFogUniforms:function(y,v){y.fogColor.value.copy(v.color),v.isFog?(y.fogNear.value=v.near,y.fogFar.value=v.far):v.isFogExp2&&(y.fogDensity.value=v.density)},refreshMaterialUniforms:function(y,v,M,O,V){v.isMeshBasicMaterial?e(y,v):v.isMeshLambertMaterial?(e(y,v),function(G,H){H.emissiveMap&&(G.emissiveMap.value=H.emissiveMap)}(y,v)):v.isMeshToonMaterial?(e(y,v),function(G,H){H.gradientMap&&(G.gradientMap.value=H.gradientMap),H.emissiveMap&&(G.emissiveMap.value=H.emissiveMap),H.bumpMap&&(G.bumpMap.value=H.bumpMap,G.bumpScale.value=H.bumpScale,H.side===1&&(G.bumpScale.value*=-1)),H.normalMap&&(G.normalMap.value=H.normalMap,G.normalScale.value.copy(H.normalScale),H.side===1&&G.normalScale.value.negate()),H.displacementMap&&(G.displacementMap.value=H.displacementMap,G.displacementScale.value=H.displacementScale,G.displacementBias.value=H.displacementBias)}(y,v)):v.isMeshPhongMaterial?(e(y,v),function(G,H){G.specular.value.copy(H.specular),G.shininess.value=Math.max(H.shininess,1e-4),H.emissiveMap&&(G.emissiveMap.value=H.emissiveMap),H.bumpMap&&(G.bumpMap.value=H.bumpMap,G.bumpScale.value=H.bumpScale,H.side===1&&(G.bumpScale.value*=-1)),H.normalMap&&(G.normalMap.value=H.normalMap,G.normalScale.value.copy(H.normalScale),H.side===1&&G.normalScale.value.negate()),H.displacementMap&&(G.displacementMap.value=H.displacementMap,G.displacementScale.value=H.displacementScale,G.displacementBias.value=H.displacementBias)}(y,v)):v.isMeshStandardMaterial?(e(y,v),v.isMeshPhysicalMaterial?function(G,H,Q){u(G,H),G.ior.value=H.ior,H.sheenTint&&G.sheenTint.value.copy(H.sheenTint),H.clearcoat>0&&(G.clearcoat.value=H.clearcoat,G.clearcoatRoughness.value=H.clearcoatRoughness,H.clearcoatMap&&(G.clearcoatMap.value=H.clearcoatMap),H.clearcoatRoughnessMap&&(G.clearcoatRoughnessMap.value=H.clearcoatRoughnessMap),H.clearcoatNormalMap&&(G.clearcoatNormalScale.value.copy(H.clearcoatNormalScale),G.clearcoatNormalMap.value=H.clearcoatNormalMap,H.side===1&&G.clearcoatNormalScale.value.negate())),H.transmission>0&&(G.transmission.value=H.transmission,G.transmissionSamplerMap.value=Q.texture,G.transmissionSamplerSize.value.set(Q.width,Q.height),H.transmissionMap&&(G.transmissionMap.value=H.transmissionMap),G.thickness.value=H.thickness,H.thicknessMap&&(G.thicknessMap.value=H.thicknessMap),G.attenuationDistance.value=H.attenuationDistance,G.attenuationTint.value.copy(H.attenuationTint)),G.specularIntensity.value=H.specularIntensity,G.specularTint.value.copy(H.specularTint),H.specularIntensityMap&&(G.specularIntensityMap.value=H.specularIntensityMap),H.specularTintMap&&(G.specularTintMap.value=H.specularTintMap)}(y,v,V):u(y,v)):v.isMeshMatcapMaterial?(e(y,v),function(G,H){H.matcap&&(G.matcap.value=H.matcap),H.bumpMap&&(G.bumpMap.value=H.bumpMap,G.bumpScale.value=H.bumpScale,H.side===1&&(G.bumpScale.value*=-1)),H.normalMap&&(G.normalMap.value=H.normalMap,G.normalScale.value.copy(H.normalScale),H.side===1&&G.normalScale.value.negate()),H.displacementMap&&(G.displacementMap.value=H.displacementMap,G.displacementScale.value=H.displacementScale,G.displacementBias.value=H.displacementBias)}(y,v)):v.isMeshDepthMaterial?(e(y,v),function(G,H){H.displacementMap&&(G.displacementMap.value=H.displacementMap,G.displacementScale.value=H.displacementScale,G.displacementBias.value=H.displacementBias)}(y,v)):v.isMeshDistanceMaterial?(e(y,v),function(G,H){H.displacementMap&&(G.displacementMap.value=H.displacementMap,G.displacementScale.value=H.displacementScale,G.displacementBias.value=H.displacementBias),G.referencePosition.value.copy(H.referencePosition),G.nearDistance.value=H.nearDistance,G.farDistance.value=H.farDistance}(y,v)):v.isMeshNormalMaterial?(e(y,v),function(G,H){H.bumpMap&&(G.bumpMap.value=H.bumpMap,G.bumpScale.value=H.bumpScale,H.side===1&&(G.bumpScale.value*=-1)),H.normalMap&&(G.normalMap.value=H.normalMap,G.normalScale.value.copy(H.normalScale),H.side===1&&G.normalScale.value.negate()),H.displacementMap&&(G.displacementMap.value=H.displacementMap,G.displacementScale.value=H.displacementScale,G.displacementBias.value=H.displacementBias)}(y,v)):v.isLineBasicMaterial?(function(G,H){G.diffuse.value.copy(H.color),G.opacity.value=H.opacity}(y,v),v.isLineDashedMaterial&&function(G,H){G.dashSize.value=H.dashSize,G.totalSize.value=H.dashSize+H.gapSize,G.scale.value=H.scale}(y,v)):v.isPointsMaterial?function(G,H,Q,ee){G.diffuse.value.copy(H.color),G.opacity.value=H.opacity,G.size.value=H.size*Q,G.scale.value=.5*ee,H.map&&(G.map.value=H.map),H.alphaMap&&(G.alphaMap.value=H.alphaMap),H.alphaTest>0&&(G.alphaTest.value=H.alphaTest);let se;H.map?se=H.map:H.alphaMap&&(se=H.alphaMap),se!==void 0&&(se.matrixAutoUpdate===!0&&se.updateMatrix(),G.uvTransform.value.copy(se.matrix))}(y,v,M,O):v.isSpriteMaterial?function(G,H){G.diffuse.value.copy(H.color),G.opacity.value=H.opacity,G.rotation.value=H.rotation,H.map&&(G.map.value=H.map),H.alphaMap&&(G.alphaMap.value=H.alphaMap),H.alphaTest>0&&(G.alphaTest.value=H.alphaTest);let Q;H.map?Q=H.map:H.alphaMap&&(Q=H.alphaMap),Q!==void 0&&(Q.matrixAutoUpdate===!0&&Q.updateMatrix(),G.uvTransform.value.copy(Q.matrix))}(y,v):v.isShadowMaterial?(y.color.value.copy(v.color),y.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}}}function yn(S={}){const e=S.canvas!==void 0?S.canvas:function(){const Wt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return Wt.style.display="block",Wt}(),u=S.context!==void 0?S.context:null,y=S.alpha!==void 0&&S.alpha,v=S.depth===void 0||S.depth,M=S.stencil===void 0||S.stencil,O=S.antialias!==void 0&&S.antialias,V=S.premultipliedAlpha===void 0||S.premultipliedAlpha,G=S.preserveDrawingBuffer!==void 0&&S.preserveDrawingBuffer,H=S.powerPreference!==void 0?S.powerPreference:"default",Q=S.failIfMajorPerformanceCaveat!==void 0&&S.failIfMajorPerformanceCaveat;let ee=null,se=null;const ae=[],de=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const be=this;let Re=!1,Te=0,ct=0,Et=null,_t=-1,jt=null;const Xt=new Dr,_i=new Dr;let vi=null,Bi=e.width,Li=e.height,ki=1,Zn=null,En=null;const Ji=new Dr(0,0,Bi,Li),In=new Dr(0,0,Bi,Li);let ir=!1;const rr=[],vr=new Fc;let kr=!1,Fr=!1,Rn=null;const $t=new nr,ii=new re,Qi={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ji(){return Et===null?ki:1}let Oi,Nn,Hn,Ni,Bt,Ii,gn,vn,pn,or,Ar,mr,ns,Kr,sa,no,oa,ul,Dh,Cd,Oh,Pl,da,Bn=u;function j_(Wt,rn){for(let Ri=0;Ri<Wt.length;Ri++){const sn=Wt[Ri],On=e.getContext(sn,rn);if(On!==null)return On}return null}try{const Wt={alpha:y,depth:v,stencil:M,antialias:O,premultipliedAlpha:V,preserveDrawingBuffer:G,powerPreference:H,failIfMajorPerformanceCaveat:Q};if(e.addEventListener("webglcontextlost",Ly,!1),e.addEventListener("webglcontextrestored",Iy,!1),Bn===null){const rn=["webgl2","webgl","experimental-webgl"];if(be.isWebGL1Renderer===!0&&rn.shift(),Bn=j_(rn,Wt),Bn===null)throw j_(rn)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Bn.getShaderPrecisionFormat===void 0&&(Bn.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Wt){throw console.error("THREE.WebGLRenderer: "+Wt.message),Wt}function Cy(){Oi=new Um(Bn),Nn=new ff(Bn,Oi,S),Oi.init(Nn),Pl=new Uf(Bn,Oi,Nn),Hn=new dp(Bn,Oi,Nn),rr[0]=1029,Ni=new oh,Bt=new M_,Ii=new Nf(Bn,Oi,Hn,Bt,Nn,Pl,Ni),gn=new Xd(be),vn=new od(be),pn=new pf(Bn,Nn),da=new Ha(Bn,Oi,pn,Nn),or=new Vm(Bn,pn,Ni,da),Ar=new v_(Bn,or,pn,Ni),Dh=new y_(Bn),no=new mf(Bt),mr=new ng(be,gn,vn,Oi,Nn,da,no),ns=new qi(Bt),Kr=new up(Bt),sa=new Bf(Oi,Nn),ul=new Bm(be,gn,Hn,Ar,V),oa=new eo(be,Ar,Nn),Cd=new Nm(Bn,Oi,Ni,Nn),Oh=new Gm(Bn,Oi,Ni,Nn),Ni.programs=mr.programs,be.capabilities=Nn,be.extensions=Oi,be.properties=Bt,be.renderLists=Kr,be.shadowMap=oa,be.state=Hn,be.info=Ni}Cy();const Dl=new mh(be,Bn);function Ly(Wt){Wt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Re=!0}function Iy(){console.log("THREE.WebGLRenderer: Context Restored."),Re=!1;const Wt=Ni.autoReset,rn=oa.enabled,Ri=oa.autoUpdate,sn=oa.needsUpdate,On=oa.type;Cy(),Ni.autoReset=Wt,oa.enabled=rn,oa.autoUpdate=Ri,oa.needsUpdate=sn,oa.type=On}function Ry(Wt){const rn=Wt.target;rn.removeEventListener("dispose",Ry),function(Ri){(function(sn){const On=Bt.get(sn).programs;On!==void 0&&On.forEach(function(qr){mr.releaseProgram(qr)})})(Ri),Bt.remove(Ri)}(rn)}this.xr=Dl,this.getContext=function(){return Bn},this.getContextAttributes=function(){return Bn.getContextAttributes()},this.forceContextLoss=function(){const Wt=Oi.get("WEBGL_lose_context");Wt&&Wt.loseContext()},this.forceContextRestore=function(){const Wt=Oi.get("WEBGL_lose_context");Wt&&Wt.restoreContext()},this.getPixelRatio=function(){return ki},this.setPixelRatio=function(Wt){Wt!==void 0&&(ki=Wt,this.setSize(Bi,Li,!1))},this.getSize=function(Wt){return Wt.set(Bi,Li)},this.setSize=function(Wt,rn,Ri){Dl.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Bi=Wt,Li=rn,e.width=Math.floor(Wt*ki),e.height=Math.floor(rn*ki),Ri!==!1&&(e.style.width=Wt+"px",e.style.height=rn+"px"),this.setViewport(0,0,Wt,rn))},this.getDrawingBufferSize=function(Wt){return Wt.set(Bi*ki,Li*ki).floor()},this.setDrawingBufferSize=function(Wt,rn,Ri){Bi=Wt,Li=rn,ki=Ri,e.width=Math.floor(Wt*Ri),e.height=Math.floor(rn*Ri),this.setViewport(0,0,Wt,rn)},this.getCurrentViewport=function(Wt){return Wt.copy(Xt)},this.getViewport=function(Wt){return Wt.copy(Ji)},this.setViewport=function(Wt,rn,Ri,sn){Wt.isVector4?Ji.set(Wt.x,Wt.y,Wt.z,Wt.w):Ji.set(Wt,rn,Ri,sn),Hn.viewport(Xt.copy(Ji).multiplyScalar(ki).floor())},this.getScissor=function(Wt){return Wt.copy(In)},this.setScissor=function(Wt,rn,Ri,sn){Wt.isVector4?In.set(Wt.x,Wt.y,Wt.z,Wt.w):In.set(Wt,rn,Ri,sn),Hn.scissor(_i.copy(In).multiplyScalar(ki).floor())},this.getScissorTest=function(){return ir},this.setScissorTest=function(Wt){Hn.setScissorTest(ir=Wt)},this.setOpaqueSort=function(Wt){Zn=Wt},this.setTransparentSort=function(Wt){En=Wt},this.getClearColor=function(Wt){return Wt.copy(ul.getClearColor())},this.setClearColor=function(){ul.setClearColor.apply(ul,arguments)},this.getClearAlpha=function(){return ul.getClearAlpha()},this.setClearAlpha=function(){ul.setClearAlpha.apply(ul,arguments)},this.clear=function(Wt,rn,Ri){let sn=0;(Wt===void 0||Wt)&&(sn|=16384),(rn===void 0||rn)&&(sn|=256),(Ri===void 0||Ri)&&(sn|=1024),Bn.clear(sn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ly,!1),e.removeEventListener("webglcontextrestored",Iy,!1),Kr.dispose(),sa.dispose(),Bt.dispose(),gn.dispose(),vn.dispose(),Ar.dispose(),da.dispose(),Dl.dispose(),Dl.removeEventListener("sessionstart",Py),Dl.removeEventListener("sessionend",q_),Rn&&(Rn.dispose(),Rn=null),Ld.stop()},this.renderBufferImmediate=function(Wt,rn){da.initAttributes();const Ri=Bt.get(Wt);Wt.hasPositions&&!Ri.position&&(Ri.position=Bn.createBuffer()),Wt.hasNormals&&!Ri.normal&&(Ri.normal=Bn.createBuffer()),Wt.hasUvs&&!Ri.uv&&(Ri.uv=Bn.createBuffer()),Wt.hasColors&&!Ri.color&&(Ri.color=Bn.createBuffer());const sn=rn.getAttributes();Wt.hasPositions&&(Bn.bindBuffer(34962,Ri.position),Bn.bufferData(34962,Wt.positionArray,35048),da.enableAttribute(sn.position.location),Bn.vertexAttribPointer(sn.position.location,3,5126,!1,0,0)),Wt.hasNormals&&(Bn.bindBuffer(34962,Ri.normal),Bn.bufferData(34962,Wt.normalArray,35048),da.enableAttribute(sn.normal.location),Bn.vertexAttribPointer(sn.normal.location,3,5126,!1,0,0)),Wt.hasUvs&&(Bn.bindBuffer(34962,Ri.uv),Bn.bufferData(34962,Wt.uvArray,35048),da.enableAttribute(sn.uv.location),Bn.vertexAttribPointer(sn.uv.location,2,5126,!1,0,0)),Wt.hasColors&&(Bn.bindBuffer(34962,Ri.color),Bn.bufferData(34962,Wt.colorArray,35048),da.enableAttribute(sn.color.location),Bn.vertexAttribPointer(sn.color.location,3,5126,!1,0,0)),da.disableUnusedAttributes(),Bn.drawArrays(4,0,Wt.count),Wt.count=0},this.renderBufferDirect=function(Wt,rn,Ri,sn,On,qr){rn===null&&(rn=Qi);const Mr=On.isMesh&&On.matrixWorld.determinant()<0,rs=X_(Wt,rn,sn,On);Hn.setMaterial(sn,Mr);let cs=Ri.index;const oo=Ri.attributes.position;if(cs===null){if(oo===void 0||oo.count===0)return}else if(cs.count===0)return;let $s,As=1;sn.wireframe===!0&&(cs=or.getWireframeAttribute(Ri),As=2),Ri.morphAttributes.position===void 0&&Ri.morphAttributes.normal===void 0||Dh.update(On,Ri,sn,rs),da.setup(On,sn,rs,Ri,cs);let ss=Cd;cs!==null&&($s=pn.get(cs),ss=Oh,ss.setIndex($s));const Id=cs!==null?cs.count:oo.count,Bo=Ri.drawRange.start*As,zh=Ri.drawRange.count*As,_c=qr!==null?qr.start*As:0,kh=qr!==null?qr.count*As:1/0,Fh=Math.max(Bo,_c),zs=Math.min(Id,Bo+zh,_c+kh)-1,Jo=Math.max(0,zs-Fh+1);if(Jo!==0){if(On.isMesh)sn.wireframe===!0?(Hn.setLineWidth(sn.wireframeLinewidth*ji()),ss.setMode(1)):ss.setMode(4);else if(On.isLine){let pa=sn.linewidth;pa===void 0&&(pa=1),Hn.setLineWidth(pa*ji()),On.isLineSegments?ss.setMode(1):On.isLineLoop?ss.setMode(2):ss.setMode(3)}else On.isPoints?ss.setMode(0):On.isSprite&&ss.setMode(4);if(On.isInstancedMesh)ss.renderInstances(Fh,Jo,On.count);else if(Ri.isInstancedBufferGeometry){const pa=Math.min(Ri.instanceCount,Ri._maxInstanceCount);ss.renderInstances(Fh,Jo,pa)}else ss.render(Fh,Jo)}},this.compile=function(Wt,rn){se=sa.get(Wt),se.init(),de.push(se),Wt.traverseVisible(function(Ri){Ri.isLight&&Ri.layers.test(rn.layers)&&(se.pushLight(Ri),Ri.castShadow&&se.pushShadow(Ri))}),se.setupLights(be.physicallyCorrectLights),Wt.traverse(function(Ri){const sn=Ri.material;if(sn)if(Array.isArray(sn))for(let On=0;On<sn.length;On++)mg(sn[On],Wt,Ri);else mg(sn,Wt,Ri)}),de.pop(),se=null};let W_=null;function Py(){Ld.stop()}function q_(){Ld.start()}const Ld=new jl;function Dy(Wt,rn,Ri,sn){if(Wt.visible===!1)return;if(Wt.layers.test(rn.layers)){if(Wt.isGroup)Ri=Wt.renderOrder;else if(Wt.isLOD)Wt.autoUpdate===!0&&Wt.update(rn);else if(Wt.isLight)se.pushLight(Wt),Wt.castShadow&&se.pushShadow(Wt);else if(Wt.isSprite){if(!Wt.frustumCulled||vr.intersectsSprite(Wt)){sn&&ii.setFromMatrixPosition(Wt.matrixWorld).applyMatrix4($t);const qr=Ar.update(Wt),Mr=Wt.material;Mr.visible&&ee.push(Wt,qr,Mr,Ri,ii.z,null)}}else if(Wt.isImmediateRenderObject)sn&&ii.setFromMatrixPosition(Wt.matrixWorld).applyMatrix4($t),ee.push(Wt,null,Wt.material,Ri,ii.z,null);else if((Wt.isMesh||Wt.isLine||Wt.isPoints)&&(Wt.isSkinnedMesh&&Wt.skeleton.frame!==Ni.render.frame&&(Wt.skeleton.update(),Wt.skeleton.frame=Ni.render.frame),!Wt.frustumCulled||vr.intersectsObject(Wt))){sn&&ii.setFromMatrixPosition(Wt.matrixWorld).applyMatrix4($t);const qr=Ar.update(Wt),Mr=Wt.material;if(Array.isArray(Mr)){const rs=qr.groups;for(let cs=0,oo=rs.length;cs<oo;cs++){const $s=rs[cs],As=Mr[$s.materialIndex];As&&As.visible&&ee.push(Wt,qr,As,Ri,ii.z,$s)}}else Mr.visible&&ee.push(Wt,qr,Mr,Ri,ii.z,null)}}const On=Wt.children;for(let qr=0,Mr=On.length;qr<Mr;qr++)Dy(On[qr],rn,Ri,sn)}function Oy(Wt,rn,Ri,sn){const On=Wt.opaque,qr=Wt.transmissive,Mr=Wt.transparent;se.setupLightsView(Ri),qr.length>0&&function(rs,cs,oo){if(Rn===null){const ss=O===!0&&Nn.isWebGL2===!0;Rn=new(ss?ai:ro)(1024,1024,{generateMipmaps:!0,type:Pl.convert(1016)!==null?1016:1009,minFilter:1008,magFilter:1003,wrapS:1001,wrapT:1001})}const $s=be.getRenderTarget();be.setRenderTarget(Rn),be.clear();const As=be.toneMapping;be.toneMapping=0,zp(rs,cs,oo),be.toneMapping=As,Ii.updateMultisampleRenderTarget(Rn),Ii.updateRenderTargetMipmap(Rn),be.setRenderTarget($s)}(On,rn,Ri),sn&&Hn.viewport(Xt.copy(sn)),On.length>0&&zp(On,rn,Ri),qr.length>0&&zp(qr,rn,Ri),Mr.length>0&&zp(Mr,rn,Ri)}function zp(Wt,rn,Ri){const sn=rn.isScene===!0?rn.overrideMaterial:null;for(let On=0,qr=Wt.length;On<qr;On++){const Mr=Wt[On],rs=Mr.object,cs=Mr.geometry,oo=sn===null?Mr.material:sn,$s=Mr.group;rs.layers.test(Ri.layers)&&$_(rs,rn,Ri,cs,oo,$s)}}function $_(Wt,rn,Ri,sn,On,qr){if(Wt.onBeforeRender(be,rn,Ri,sn,On,qr),Wt.modelViewMatrix.multiplyMatrices(Ri.matrixWorldInverse,Wt.matrixWorld),Wt.normalMatrix.getNormalMatrix(Wt.modelViewMatrix),Wt.isImmediateRenderObject){const Mr=X_(Ri,rn,On,Wt);Hn.setMaterial(On),da.reset(),function(rs,cs){rs.render(function(oo){be.renderBufferImmediate(oo,cs)})}(Wt,Mr)}else On.transparent===!0&&On.side===2?(On.side=1,On.needsUpdate=!0,be.renderBufferDirect(Ri,rn,sn,On,Wt,qr),On.side=0,On.needsUpdate=!0,be.renderBufferDirect(Ri,rn,sn,On,Wt,qr),On.side=2):be.renderBufferDirect(Ri,rn,sn,On,Wt,qr);Wt.onAfterRender(be,rn,Ri,sn,On,qr)}function mg(Wt,rn,Ri){rn.isScene!==!0&&(rn=Qi);const sn=Bt.get(Wt),On=se.state.lights,qr=se.state.shadowsArray,Mr=On.state.version,rs=mr.getParameters(Wt,On.state,qr,rn,Ri),cs=mr.getProgramCacheKey(rs);let oo=sn.programs;sn.environment=Wt.isMeshStandardMaterial?rn.environment:null,sn.fog=rn.fog,sn.envMap=(Wt.isMeshStandardMaterial?vn:gn).get(Wt.envMap||sn.environment),oo===void 0&&(Wt.addEventListener("dispose",Ry),oo=new Map,sn.programs=oo);let $s=oo.get(cs);if($s!==void 0){if(sn.currentProgram===$s&&sn.lightsStateVersion===Mr)return Z_(Wt,rs),$s}else rs.uniforms=mr.getUniforms(Wt),Wt.onBuild(rs,be),Wt.onBeforeCompile(rs,be),$s=mr.acquireProgram(rs,cs),oo.set(cs,$s),sn.uniforms=rs.uniforms;const As=sn.uniforms;(Wt.isShaderMaterial||Wt.isRawShaderMaterial)&&Wt.clipping!==!0||(As.clippingPlanes=no.uniform),Z_(Wt,rs),sn.needsLights=function(Bo){return Bo.isMeshLambertMaterial||Bo.isMeshToonMaterial||Bo.isMeshPhongMaterial||Bo.isMeshStandardMaterial||Bo.isShadowMaterial||Bo.isShaderMaterial&&Bo.lights===!0}(Wt),sn.lightsStateVersion=Mr,sn.needsLights&&(As.ambientLightColor.value=On.state.ambient,As.lightProbe.value=On.state.probe,As.directionalLights.value=On.state.directional,As.directionalLightShadows.value=On.state.directionalShadow,As.spotLights.value=On.state.spot,As.spotLightShadows.value=On.state.spotShadow,As.rectAreaLights.value=On.state.rectArea,As.ltc_1.value=On.state.rectAreaLTC1,As.ltc_2.value=On.state.rectAreaLTC2,As.pointLights.value=On.state.point,As.pointLightShadows.value=On.state.pointShadow,As.hemisphereLights.value=On.state.hemi,As.directionalShadowMap.value=On.state.directionalShadowMap,As.directionalShadowMatrix.value=On.state.directionalShadowMatrix,As.spotShadowMap.value=On.state.spotShadowMap,As.spotShadowMatrix.value=On.state.spotShadowMatrix,As.pointShadowMap.value=On.state.pointShadowMap,As.pointShadowMatrix.value=On.state.pointShadowMatrix);const ss=$s.getUniforms(),Id=ol.seqWithValue(ss.seq,As);return sn.currentProgram=$s,sn.uniformsList=Id,$s}function Z_(Wt,rn){const Ri=Bt.get(Wt);Ri.outputEncoding=rn.outputEncoding,Ri.instancing=rn.instancing,Ri.skinning=rn.skinning,Ri.morphTargets=rn.morphTargets,Ri.morphNormals=rn.morphNormals,Ri.numClippingPlanes=rn.numClippingPlanes,Ri.numIntersection=rn.numClipIntersection,Ri.vertexAlphas=rn.vertexAlphas,Ri.vertexTangents=rn.vertexTangents}function X_(Wt,rn,Ri,sn){rn.isScene!==!0&&(rn=Qi),Ii.resetTextureUnits();const On=rn.fog,qr=Ri.isMeshStandardMaterial?rn.environment:null,Mr=Et===null?be.outputEncoding:Et.texture.encoding,rs=(Ri.isMeshStandardMaterial?vn:gn).get(Ri.envMap||qr),cs=Ri.vertexColors===!0&&!!sn.geometry&&!!sn.geometry.attributes.color&&sn.geometry.attributes.color.itemSize===4,oo=!!sn.geometry&&!!sn.geometry.attributes.tangent,$s=!!sn.geometry&&!!sn.geometry.morphAttributes.position,As=!!sn.geometry&&!!sn.geometry.morphAttributes.normal,ss=Bt.get(Ri),Id=se.state.lights;if(kr===!0&&(Fr===!0||Wt!==jt)){const Fa=Wt===jt&&Ri.id===_t;no.setState(Ri,Wt,Fa)}let Bo=!1;Ri.version===ss.__version?ss.needsLights&&ss.lightsStateVersion!==Id.state.version||ss.outputEncoding!==Mr||sn.isInstancedMesh&&ss.instancing===!1?Bo=!0:sn.isInstancedMesh||ss.instancing!==!0?sn.isSkinnedMesh&&ss.skinning===!1?Bo=!0:sn.isSkinnedMesh||ss.skinning!==!0?ss.envMap!==rs||Ri.fog&&ss.fog!==On?Bo=!0:ss.numClippingPlanes===void 0||ss.numClippingPlanes===no.numPlanes&&ss.numIntersection===no.numIntersection?(ss.vertexAlphas!==cs||ss.vertexTangents!==oo||ss.morphTargets!==$s||ss.morphNormals!==As)&&(Bo=!0):Bo=!0:Bo=!0:Bo=!0:(Bo=!0,ss.__version=Ri.version);let zh=ss.currentProgram;Bo===!0&&(zh=mg(Ri,rn,sn));let _c=!1,kh=!1,Fh=!1;const zs=zh.getUniforms(),Jo=ss.uniforms;if(Hn.useProgram(zh.program)&&(_c=!0,kh=!0,Fh=!0),Ri.id!==_t&&(_t=Ri.id,kh=!0),_c||jt!==Wt){if(zs.setValue(Bn,"projectionMatrix",Wt.projectionMatrix),Nn.logarithmicDepthBuffer&&zs.setValue(Bn,"logDepthBufFC",2/(Math.log(Wt.far+1)/Math.LN2)),jt!==Wt&&(jt=Wt,kh=!0,Fh=!0),Ri.isShaderMaterial||Ri.isMeshPhongMaterial||Ri.isMeshToonMaterial||Ri.isMeshStandardMaterial||Ri.envMap){const Fa=zs.map.cameraPosition;Fa!==void 0&&Fa.setValue(Bn,ii.setFromMatrixPosition(Wt.matrixWorld))}(Ri.isMeshPhongMaterial||Ri.isMeshToonMaterial||Ri.isMeshLambertMaterial||Ri.isMeshBasicMaterial||Ri.isMeshStandardMaterial||Ri.isShaderMaterial)&&zs.setValue(Bn,"isOrthographic",Wt.isOrthographicCamera===!0),(Ri.isMeshPhongMaterial||Ri.isMeshToonMaterial||Ri.isMeshLambertMaterial||Ri.isMeshBasicMaterial||Ri.isMeshStandardMaterial||Ri.isShaderMaterial||Ri.isShadowMaterial||sn.isSkinnedMesh)&&zs.setValue(Bn,"viewMatrix",Wt.matrixWorldInverse)}if(sn.isSkinnedMesh){zs.setOptional(Bn,sn,"bindMatrix"),zs.setOptional(Bn,sn,"bindMatrixInverse");const Fa=sn.skeleton;Fa&&(Nn.floatVertexTextures?(Fa.boneTexture===null&&Fa.computeBoneTexture(),zs.setValue(Bn,"boneTexture",Fa.boneTexture,Ii),zs.setValue(Bn,"boneTextureSize",Fa.boneTextureSize)):zs.setOptional(Bn,Fa,"boneMatrices"))}var pa,hl;return(kh||ss.receiveShadow!==sn.receiveShadow)&&(ss.receiveShadow=sn.receiveShadow,zs.setValue(Bn,"receiveShadow",sn.receiveShadow)),kh&&(zs.setValue(Bn,"toneMappingExposure",be.toneMappingExposure),ss.needsLights&&(hl=Fh,(pa=Jo).ambientLightColor.needsUpdate=hl,pa.lightProbe.needsUpdate=hl,pa.directionalLights.needsUpdate=hl,pa.directionalLightShadows.needsUpdate=hl,pa.pointLights.needsUpdate=hl,pa.pointLightShadows.needsUpdate=hl,pa.spotLights.needsUpdate=hl,pa.spotLightShadows.needsUpdate=hl,pa.rectAreaLights.needsUpdate=hl,pa.hemisphereLights.needsUpdate=hl),On&&Ri.fog&&ns.refreshFogUniforms(Jo,On),ns.refreshMaterialUniforms(Jo,Ri,ki,Li,Rn),ol.upload(Bn,ss.uniformsList,Jo,Ii)),Ri.isShaderMaterial&&Ri.uniformsNeedUpdate===!0&&(ol.upload(Bn,ss.uniformsList,Jo,Ii),Ri.uniformsNeedUpdate=!1),Ri.isSpriteMaterial&&zs.setValue(Bn,"center",sn.center),zs.setValue(Bn,"modelViewMatrix",sn.modelViewMatrix),zs.setValue(Bn,"normalMatrix",sn.normalMatrix),zs.setValue(Bn,"modelMatrix",sn.matrixWorld),zh}Ld.setAnimationLoop(function(Wt){W_&&W_(Wt)}),typeof window<"u"&&Ld.setContext(window),this.setAnimationLoop=function(Wt){W_=Wt,Dl.setAnimationLoop(Wt),Wt===null?Ld.stop():Ld.start()},Dl.addEventListener("sessionstart",Py),Dl.addEventListener("sessionend",q_),this.render=function(Wt,rn){if(rn!==void 0&&rn.isCamera!==!0)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(Re===!0)return;Wt.autoUpdate===!0&&Wt.updateMatrixWorld(),rn.parent===null&&rn.updateMatrixWorld(),Dl.enabled===!0&&Dl.isPresenting===!0&&(Dl.cameraAutoUpdate===!0&&Dl.updateCamera(rn),rn=Dl.getCamera()),Wt.isScene===!0&&Wt.onBeforeRender(be,Wt,rn,Et),se=sa.get(Wt,de.length),se.init(),de.push(se),$t.multiplyMatrices(rn.projectionMatrix,rn.matrixWorldInverse),vr.setFromProjectionMatrix($t),Fr=this.localClippingEnabled,kr=no.init(this.clippingPlanes,Fr,rn),ee=Kr.get(Wt,ae.length),ee.init(),ae.push(ee),Dy(Wt,rn,0,be.sortObjects),ee.finish(),be.sortObjects===!0&&ee.sort(Zn,En),kr===!0&&no.beginShadows();const Ri=se.state.shadowsArray;if(oa.render(Ri,Wt,rn),kr===!0&&no.endShadows(),this.info.autoReset===!0&&this.info.reset(),ul.render(ee,Wt),se.setupLights(be.physicallyCorrectLights),rn.isArrayCamera){const sn=rn.cameras;for(let On=0,qr=sn.length;On<qr;On++){const Mr=sn[On];Oy(ee,Wt,Mr,Mr.viewport)}}else Oy(ee,Wt,rn);Et!==null&&(Ii.updateMultisampleRenderTarget(Et),Ii.updateRenderTargetMipmap(Et)),Wt.isScene===!0&&Wt.onAfterRender(be,Wt,rn),Hn.buffers.depth.setTest(!0),Hn.buffers.depth.setMask(!0),Hn.buffers.color.setMask(!0),Hn.setPolygonOffset(!1),da.resetDefaultState(),_t=-1,jt=null,de.pop(),se=de.length>0?de[de.length-1]:null,ae.pop(),ee=ae.length>0?ae[ae.length-1]:null},this.getActiveCubeFace=function(){return Te},this.getActiveMipmapLevel=function(){return ct},this.getRenderTarget=function(){return Et},this.setRenderTarget=function(Wt,rn=0,Ri=0){Et=Wt,Te=rn,ct=Ri,Wt&&Bt.get(Wt).__webglFramebuffer===void 0&&Ii.setupRenderTarget(Wt);let sn=null,On=!1,qr=!1;if(Wt){const Mr=Wt.texture;(Mr.isDataTexture3D||Mr.isDataTexture2DArray)&&(qr=!0);const rs=Bt.get(Wt).__webglFramebuffer;Wt.isWebGLCubeRenderTarget?(sn=rs[rn],On=!0):sn=Wt.isWebGLMultisampleRenderTarget?Bt.get(Wt).__webglMultisampledFramebuffer:rs,Xt.copy(Wt.viewport),_i.copy(Wt.scissor),vi=Wt.scissorTest}else Xt.copy(Ji).multiplyScalar(ki).floor(),_i.copy(In).multiplyScalar(ki).floor(),vi=ir;if(Hn.bindFramebuffer(36160,sn)&&Nn.drawBuffers){let Mr=!1;if(Wt)if(Wt.isWebGLMultipleRenderTargets){const rs=Wt.texture;if(rr.length!==rs.length||rr[0]!==36064){for(let cs=0,oo=rs.length;cs<oo;cs++)rr[cs]=36064+cs;rr.length=rs.length,Mr=!0}}else rr.length===1&&rr[0]===36064||(rr[0]=36064,rr.length=1,Mr=!0);else rr.length===1&&rr[0]===1029||(rr[0]=1029,rr.length=1,Mr=!0);Mr&&(Nn.isWebGL2?Bn.drawBuffers(rr):Oi.get("WEBGL_draw_buffers").drawBuffersWEBGL(rr))}if(Hn.viewport(Xt),Hn.scissor(_i),Hn.setScissorTest(vi),On){const Mr=Bt.get(Wt.texture);Bn.framebufferTexture2D(36160,36064,34069+rn,Mr.__webglTexture,Ri)}else if(qr){const Mr=Bt.get(Wt.texture),rs=rn||0;Bn.framebufferTextureLayer(36160,36064,Mr.__webglTexture,Ri||0,rs)}_t=-1},this.readRenderTargetPixels=function(Wt,rn,Ri,sn,On,qr,Mr){if(!Wt||!Wt.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let rs=Bt.get(Wt).__webglFramebuffer;if(Wt.isWebGLCubeRenderTarget&&Mr!==void 0&&(rs=rs[Mr]),rs){Hn.bindFramebuffer(36160,rs);try{const cs=Wt.texture,oo=cs.format,$s=cs.type;if(oo!==1023&&Pl.convert(oo)!==Bn.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const As=$s===1016&&(Oi.has("EXT_color_buffer_half_float")||Nn.isWebGL2&&Oi.has("EXT_color_buffer_float"));if(!($s===1009||Pl.convert($s)===Bn.getParameter(35738)||$s===1015&&(Nn.isWebGL2||Oi.has("OES_texture_float")||Oi.has("WEBGL_color_buffer_float"))||As))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Bn.checkFramebufferStatus(36160)===36053?rn>=0&&rn<=Wt.width-sn&&Ri>=0&&Ri<=Wt.height-On&&Bn.readPixels(rn,Ri,sn,On,Pl.convert(oo),Pl.convert($s),qr):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const cs=Et!==null?Bt.get(Et).__webglFramebuffer:null;Hn.bindFramebuffer(36160,cs)}}},this.copyFramebufferToTexture=function(Wt,rn,Ri=0){const sn=Math.pow(2,-Ri),On=Math.floor(rn.image.width*sn),qr=Math.floor(rn.image.height*sn);let Mr=Pl.convert(rn.format);Nn.isWebGL2&&(Mr===6407&&(Mr=32849),Mr===6408&&(Mr=32856)),Ii.setTexture2D(rn,0),Bn.copyTexImage2D(3553,Ri,Mr,Wt.x,Wt.y,On,qr,0),Hn.unbindTexture()},this.copyTextureToTexture=function(Wt,rn,Ri,sn=0){const On=rn.image.width,qr=rn.image.height,Mr=Pl.convert(Ri.format),rs=Pl.convert(Ri.type);Ii.setTexture2D(Ri,0),Bn.pixelStorei(37440,Ri.flipY),Bn.pixelStorei(37441,Ri.premultiplyAlpha),Bn.pixelStorei(3317,Ri.unpackAlignment),rn.isDataTexture?Bn.texSubImage2D(3553,sn,Wt.x,Wt.y,On,qr,Mr,rs,rn.image.data):rn.isCompressedTexture?Bn.compressedTexSubImage2D(3553,sn,Wt.x,Wt.y,rn.mipmaps[0].width,rn.mipmaps[0].height,Mr,rn.mipmaps[0].data):Bn.texSubImage2D(3553,sn,Wt.x,Wt.y,Mr,rs,rn.image),sn===0&&Ri.generateMipmaps&&Bn.generateMipmap(3553),Hn.unbindTexture()},this.copyTextureToTexture3D=function(Wt,rn,Ri,sn,On=0){if(be.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const qr=Wt.max.x-Wt.min.x+1,Mr=Wt.max.y-Wt.min.y+1,rs=Wt.max.z-Wt.min.z+1,cs=Pl.convert(sn.format),oo=Pl.convert(sn.type);let $s;if(sn.isDataTexture3D)Ii.setTexture3D(sn,0),$s=32879;else{if(!sn.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Ii.setTexture2DArray(sn,0),$s=35866}Bn.pixelStorei(37440,sn.flipY),Bn.pixelStorei(37441,sn.premultiplyAlpha),Bn.pixelStorei(3317,sn.unpackAlignment);const As=Bn.getParameter(3314),ss=Bn.getParameter(32878),Id=Bn.getParameter(3316),Bo=Bn.getParameter(3315),zh=Bn.getParameter(32877),_c=Ri.isCompressedTexture?Ri.mipmaps[0]:Ri.image;Bn.pixelStorei(3314,_c.width),Bn.pixelStorei(32878,_c.height),Bn.pixelStorei(3316,Wt.min.x),Bn.pixelStorei(3315,Wt.min.y),Bn.pixelStorei(32877,Wt.min.z),Ri.isDataTexture||Ri.isDataTexture3D?Bn.texSubImage3D($s,On,rn.x,rn.y,rn.z,qr,Mr,rs,cs,oo,_c.data):Ri.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Bn.compressedTexSubImage3D($s,On,rn.x,rn.y,rn.z,qr,Mr,rs,cs,_c.data)):Bn.texSubImage3D($s,On,rn.x,rn.y,rn.z,qr,Mr,rs,cs,oo,_c),Bn.pixelStorei(3314,As),Bn.pixelStorei(32878,ss),Bn.pixelStorei(3316,Id),Bn.pixelStorei(3315,Bo),Bn.pixelStorei(32877,zh),On===0&&sn.generateMipmaps&&Bn.generateMipmap($s),Hn.unbindTexture()},this.initTexture=function(Wt){Ii.setTexture2D(Wt,0),Hn.unbindTexture()},this.resetState=function(){Te=0,ct=0,Et=null,Hn.reset(),da.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Au extends yn{}Au.prototype.isWebGL1Renderer=!0;class Ts{constructor(e,u=25e-5){this.name="",this.color=new wn(e),this.density=u}clone(){return new Ts(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Ts.prototype.isFogExp2=!0;class Qt{constructor(e,u=1,y=1e3){this.name="",this.color=new wn(e),this.near=u,this.far=y}clone(){return new Qt(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Qt.prototype.isFog=!0;class gh extends Ee{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,u){return super.copy(e,u),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const u=super.toJSON(e);return this.fog!==null&&(u.object.fog=this.fog.toJSON()),u}}gh.prototype.isScene=!0;class Wa{constructor(e,u){this.array=e,this.stride=u,this.count=e!==void 0?e.length/u:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=_n()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,u,y){e*=this.stride,y*=u.stride;for(let v=0,M=this.stride;v<M;v++)this.array[e+v]=u.array[y+v];return this}set(e,u=0){return this.array.set(e,u),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_n()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const u=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),y=new this.constructor(u,this.stride);return y.setUsage(this.usage),y}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_n()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Wa.prototype.isInterleavedBuffer=!0;const xo=new re;class Sl{constructor(e,u,y,v=!1){this.name="",this.data=e,this.itemSize=u,this.offset=y,this.normalized=v===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let u=0,y=this.data.count;u<y;u++)xo.x=this.getX(u),xo.y=this.getY(u),xo.z=this.getZ(u),xo.applyMatrix4(e),this.setXYZ(u,xo.x,xo.y,xo.z);return this}applyNormalMatrix(e){for(let u=0,y=this.count;u<y;u++)xo.x=this.getX(u),xo.y=this.getY(u),xo.z=this.getZ(u),xo.applyNormalMatrix(e),this.setXYZ(u,xo.x,xo.y,xo.z);return this}transformDirection(e){for(let u=0,y=this.count;u<y;u++)xo.x=this.getX(u),xo.y=this.getY(u),xo.z=this.getZ(u),xo.transformDirection(e),this.setXYZ(u,xo.x,xo.y,xo.z);return this}setX(e,u){return this.data.array[e*this.data.stride+this.offset]=u,this}setY(e,u){return this.data.array[e*this.data.stride+this.offset+1]=u,this}setZ(e,u){return this.data.array[e*this.data.stride+this.offset+2]=u,this}setW(e,u){return this.data.array[e*this.data.stride+this.offset+3]=u,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,u,y){return e=e*this.data.stride+this.offset,this.data.array[e+0]=u,this.data.array[e+1]=y,this}setXYZ(e,u,y,v){return e=e*this.data.stride+this.offset,this.data.array[e+0]=u,this.data.array[e+1]=y,this.data.array[e+2]=v,this}setXYZW(e,u,y,v,M){return e=e*this.data.stride+this.offset,this.data.array[e+0]=u,this.data.array[e+1]=y,this.data.array[e+2]=v,this.data.array[e+3]=M,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const u=[];for(let y=0;y<this.count;y++){const v=y*this.data.stride+this.offset;for(let M=0;M<this.itemSize;M++)u.push(this.data.array[v+M])}return new Or(new this.array.constructor(u),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Sl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const u=[];for(let y=0;y<this.count;y++){const v=y*this.data.stride+this.offset;for(let M=0;M<this.itemSize;M++)u.push(this.data.array[v+M])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:u,normalized:this.normalized}}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Sl.prototype.isInterleavedBufferAttribute=!0;class al extends Vi{constructor(e){super(),this.type="SpriteMaterial",this.color=new wn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let jc;al.prototype.isSpriteMaterial=!0;const wa=new re,_h=new re,yh=new re,Cu=new en,Wc=new en,fp=new nr,vh=new re,qc=new re,ql=new re,xh=new en,bh=new en,Vf=new en;class qa extends Ee{constructor(e){if(super(),this.type="Sprite",jc===void 0){jc=new Pr;const u=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),y=new Wa(u,5);jc.setIndex([0,1,2,0,2,3]),jc.setAttribute("position",new Sl(y,3,0,!1)),jc.setAttribute("uv",new Sl(y,2,3,!1))}this.geometry=jc,this.material=e!==void 0?e:new al,this.center=new en(.5,.5)}raycast(e,u){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_h.setFromMatrixScale(this.matrixWorld),fp.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),yh.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_h.multiplyScalar(-yh.z);const y=this.material.rotation;let v,M;y!==0&&(M=Math.cos(y),v=Math.sin(y));const O=this.center;Ko(vh.set(-.5,-.5,0),yh,O,_h,v,M),Ko(qc.set(.5,-.5,0),yh,O,_h,v,M),Ko(ql.set(.5,.5,0),yh,O,_h,v,M),xh.set(0,0),bh.set(1,0),Vf.set(1,1);let V=e.ray.intersectTriangle(vh,qc,ql,!1,wa);if(V===null&&(Ko(qc.set(-.5,.5,0),yh,O,_h,v,M),bh.set(0,1),V=e.ray.intersectTriangle(vh,ql,qc,!1,wa),V===null))return;const G=e.ray.origin.distanceTo(wa);G<e.near||G>e.far||u.push({distance:G,point:wa.clone(),uv:Ei.getUV(wa,vh,qc,ql,xh,bh,Vf,new en),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Ko(S,e,u,y,v,M){Cu.subVectors(S,u).addScalar(.5).multiply(y),v!==void 0?(Wc.x=M*Cu.x-v*Cu.y,Wc.y=v*Cu.x+M*Cu.y):Wc.copy(Cu),S.copy(e),S.x+=Wc.x,S.y+=Wc.y,S.applyMatrix4(fp)}qa.prototype.isSprite=!0;const gd=new re,wh=new re;class Ds extends Ee{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const u=e.levels;for(let y=0,v=u.length;y<v;y++){const M=u[y];this.addLevel(M.object.clone(),M.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,u=0){u=Math.abs(u);const y=this.levels;let v;for(v=0;v<y.length&&!(u<y[v].distance);v++);return y.splice(v,0,{distance:u,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const u=this.levels;if(u.length>0){let y,v;for(y=1,v=u.length;y<v&&!(e<u[y].distance);y++);return u[y-1].object}return null}raycast(e,u){if(this.levels.length>0){gd.setFromMatrixPosition(this.matrixWorld);const y=e.ray.origin.distanceTo(gd);this.getObjectForDistance(y).raycast(e,u)}}update(e){const u=this.levels;if(u.length>1){gd.setFromMatrixPosition(e.matrixWorld),wh.setFromMatrixPosition(this.matrixWorld);const y=gd.distanceTo(wh)/e.zoom;let v,M;for(u[0].object.visible=!0,v=1,M=u.length;v<M&&y>=u[v].distance;v++)u[v-1].object.visible=!1,u[v].object.visible=!0;for(this._currentLevel=v-1;v<M;v++)u[v].object.visible=!1}}toJSON(e){const u=super.toJSON(e);this.autoUpdate===!1&&(u.object.autoUpdate=!1),u.object.levels=[];const y=this.levels;for(let v=0,M=y.length;v<M;v++){const O=y[v];u.object.levels.push({object:O.object.uuid,distance:O.distance})}return u}}const Qr=new re,Gf=new Dr,cc=new Dr,mp=new re,Lu=new nr;class Th extends qn{constructor(e,u){super(e,u),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new nr,this.bindMatrixInverse=new nr}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,u){this.skeleton=e,u===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),u=this.matrixWorld),this.bindMatrix.copy(u),this.bindMatrixInverse.copy(u).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Dr,u=this.geometry.attributes.skinWeight;for(let y=0,v=u.count;y<v;y++){e.x=u.getX(y),e.y=u.getY(y),e.z=u.getZ(y),e.w=u.getW(y);const M=1/e.manhattanLength();M!==1/0?e.multiplyScalar(M):e.set(1,0,0,0),u.setXYZW(y,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,u){const y=this.skeleton,v=this.geometry;Gf.fromBufferAttribute(v.attributes.skinIndex,e),cc.fromBufferAttribute(v.attributes.skinWeight,e),Qr.fromBufferAttribute(v.attributes.position,e).applyMatrix4(this.bindMatrix),u.set(0,0,0);for(let M=0;M<4;M++){const O=cc.getComponent(M);if(O!==0){const V=Gf.getComponent(M);Lu.multiplyMatrices(y.bones[V].matrixWorld,y.boneInverses[V]),u.addScaledVector(mp.copy(Qr).applyMatrix4(Lu),O)}}return u.applyMatrix4(this.bindMatrixInverse)}}Th.prototype.isSkinnedMesh=!0;class $c extends Ee{constructor(){super(),this.type="Bone"}}$c.prototype.isBone=!0;class Ta extends _s{constructor(e=null,u=1,y=1,v,M,O,V,G,H=1003,Q=1003,ee,se){super(null,O,V,G,H,Q,v,M,ee,se),this.image={data:e,width:u,height:y},this.magFilter=H,this.minFilter=Q,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Ta.prototype.isDataTexture=!0;const uc=new nr,hc=new nr;class Iu{constructor(e=[],u=[]){this.uuid=_n(),this.bones=e.slice(0),this.boneInverses=u,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,u=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),u.length===0)this.calculateInverses();else if(e.length!==u.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let y=0,v=this.bones.length;y<v;y++)this.boneInverses.push(new nr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,u=this.bones.length;e<u;e++){const y=new nr;this.bones[e]&&y.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(y)}}pose(){for(let e=0,u=this.bones.length;e<u;e++){const y=this.bones[e];y&&y.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,u=this.bones.length;e<u;e++){const y=this.bones[e];y&&(y.parent&&y.parent.isBone?(y.matrix.copy(y.parent.matrixWorld).invert(),y.matrix.multiply(y.matrixWorld)):y.matrix.copy(y.matrixWorld),y.matrix.decompose(y.position,y.quaternion,y.scale))}}update(){const e=this.bones,u=this.boneInverses,y=this.boneMatrices,v=this.boneTexture;for(let M=0,O=e.length;M<O;M++){const V=e[M]?e[M].matrixWorld:hc;uc.multiplyMatrices(V,u[M]),uc.toArray(y,16*M)}v!==null&&(v.needsUpdate=!0)}clone(){return new Iu(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Tr(e),e=Math.max(e,4);const u=new Float32Array(e*e*4);u.set(this.boneMatrices);const y=new Ta(u,e,e,1023,1015);return this.boneMatrices=u,this.boneTexture=y,this.boneTextureSize=e,this}getBoneByName(e){for(let u=0,y=this.bones.length;u<y;u++){const v=this.bones[u];if(v.name===e)return v}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,u){this.uuid=e.uuid;for(let y=0,v=e.bones.length;y<v;y++){const M=e.bones[y];let O=u[M];O===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",M),O=new $c),this.bones.push(O),this.boneInverses.push(new nr().fromArray(e.boneInverses[y]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const u=this.bones,y=this.boneInverses;for(let v=0,M=u.length;v<M;v++){const O=u[v];e.bones.push(O.uuid);const V=y[v];e.boneInverses.push(V.toArray())}return e}}class El extends Or{constructor(e,u,y,v=1){typeof y=="number"&&(v=y,y=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,u,y),this.meshPerAttribute=v}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}El.prototype.isInstancedBufferAttribute=!0;const Ru=new nr,gp=new nr,Mh=[],ll=new qn;class _d extends qn{constructor(e,u,y){super(e,u),this.instanceMatrix=new El(new Float32Array(16*y),16),this.instanceColor=null,this.count=y,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,u){u.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,u){u.fromArray(this.instanceMatrix.array,16*e)}raycast(e,u){const y=this.matrixWorld,v=this.count;if(ll.geometry=this.geometry,ll.material=this.material,ll.material!==void 0)for(let M=0;M<v;M++){this.getMatrixAt(M,Ru),gp.multiplyMatrices(y,Ru),ll.matrixWorld=gp,ll.raycast(e,Mh);for(let O=0,V=Mh.length;O<V;O++){const G=Mh[O];G.instanceId=M,G.object=this,u.push(G)}Mh.length=0}}setColorAt(e,u){this.instanceColor===null&&(this.instanceColor=new El(new Float32Array(3*this.instanceMatrix.count),3)),u.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,u){u.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}_d.prototype.isInstancedMesh=!0;class Po extends Vi{constructor(e){super(),this.type="LineBasicMaterial",this.color=new wn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Po.prototype.isLineBasicMaterial=!0;const Pu=new re,Du=new re,qs=new nr,Zc=new aa,Sh=new Ns;class za extends Ee{constructor(e=new Pr,u=new Po){super(),this.type="Line",this.geometry=e,this.material=u,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const u=e.attributes.position,y=[0];for(let v=1,M=u.count;v<M;v++)Pu.fromBufferAttribute(u,v-1),Du.fromBufferAttribute(u,v),y[v]=y[v-1],y[v]+=Pu.distanceTo(Du);e.setAttribute("lineDistance",new Un(y,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,u){const y=this.geometry,v=this.matrixWorld,M=e.params.Line.threshold,O=y.drawRange;if(y.boundingSphere===null&&y.computeBoundingSphere(),Sh.copy(y.boundingSphere),Sh.applyMatrix4(v),Sh.radius+=M,e.ray.intersectsSphere(Sh)===!1)return;qs.copy(v).invert(),Zc.copy(e.ray).applyMatrix4(qs);const V=M/((this.scale.x+this.scale.y+this.scale.z)/3),G=V*V,H=new re,Q=new re,ee=new re,se=new re,ae=this.isLineSegments?2:1;if(y.isBufferGeometry){const de=y.index,be=y.attributes.position;if(de!==null)for(let Re=Math.max(0,O.start),Te=Math.min(de.count,O.start+O.count)-1;Re<Te;Re+=ae){const ct=de.getX(Re),Et=de.getX(Re+1);if(H.fromBufferAttribute(be,ct),Q.fromBufferAttribute(be,Et),Zc.distanceSqToSegment(H,Q,se,ee)>G)continue;se.applyMatrix4(this.matrixWorld);const _t=e.ray.origin.distanceTo(se);_t<e.near||_t>e.far||u.push({distance:_t,point:ee.clone().applyMatrix4(this.matrixWorld),index:Re,face:null,faceIndex:null,object:this})}else for(let Re=Math.max(0,O.start),Te=Math.min(be.count,O.start+O.count)-1;Re<Te;Re+=ae){if(H.fromBufferAttribute(be,Re),Q.fromBufferAttribute(be,Re+1),Zc.distanceSqToSegment(H,Q,se,ee)>G)continue;se.applyMatrix4(this.matrixWorld);const ct=e.ray.origin.distanceTo(se);ct<e.near||ct>e.far||u.push({distance:ct,point:ee.clone().applyMatrix4(this.matrixWorld),index:Re,face:null,faceIndex:null,object:this})}}else y.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const u=e.morphAttributes,y=Object.keys(u);if(y.length>0){const v=u[y[0]];if(v!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let M=0,O=v.length;M<O;M++){const V=v[M].name||String(M);this.morphTargetInfluences.push(0),this.morphTargetDictionary[V]=M}}}}else{const u=e.morphTargets;u!==void 0&&u.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}za.prototype.isLine=!0;const Xc=new re,_p=new re;class ia extends za{constructor(e,u){super(e,u),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const u=e.attributes.position,y=[];for(let v=0,M=u.count;v<M;v+=2)Xc.fromBufferAttribute(u,v),_p.fromBufferAttribute(u,v+1),y[v]=v===0?0:y[v-1],y[v+1]=y[v]+Xc.distanceTo(_p);e.setAttribute("lineDistance",new Un(y,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ia.prototype.isLineSegments=!0;class yp extends za{constructor(e,u){super(e,u),this.type="LineLoop"}}yp.prototype.isLineLoop=!0;class Al extends Vi{constructor(e){super(),this.type="PointsMaterial",this.color=new wn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Al.prototype.isPointsMaterial=!0;const vp=new nr,Ou=new aa,Yc=new Ns,zu=new re;class Kc extends Ee{constructor(e=new Pr,u=new Al){super(),this.type="Points",this.geometry=e,this.material=u,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,u){const y=this.geometry,v=this.matrixWorld,M=e.params.Points.threshold,O=y.drawRange;if(y.boundingSphere===null&&y.computeBoundingSphere(),Yc.copy(y.boundingSphere),Yc.applyMatrix4(v),Yc.radius+=M,e.ray.intersectsSphere(Yc)===!1)return;vp.copy(v).invert(),Ou.copy(e.ray).applyMatrix4(vp);const V=M/((this.scale.x+this.scale.y+this.scale.z)/3),G=V*V;if(y.isBufferGeometry){const H=y.index,Q=y.attributes.position;if(H!==null)for(let ee=Math.max(0,O.start),se=Math.min(H.count,O.start+O.count);ee<se;ee++){const ae=H.getX(ee);zu.fromBufferAttribute(Q,ae),yd(zu,ae,G,v,e,u,this)}else for(let ee=Math.max(0,O.start),se=Math.min(Q.count,O.start+O.count);ee<se;ee++)zu.fromBufferAttribute(Q,ee),yd(zu,ee,G,v,e,u,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const u=e.morphAttributes,y=Object.keys(u);if(y.length>0){const v=u[y[0]];if(v!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let M=0,O=v.length;M<O;M++){const V=v[M].name||String(M);this.morphTargetInfluences.push(0),this.morphTargetDictionary[V]=M}}}}else{const u=e.morphTargets;u!==void 0&&u.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function yd(S,e,u,y,v,M,O){const V=Ou.distanceSqToPoint(S);if(V<u){const G=new re;Ou.closestPointToPoint(S,G),G.applyMatrix4(y);const H=v.ray.origin.distanceTo(G);if(H<v.near||H>v.far)return;M.push({distance:H,distanceToRay:Math.sqrt(V),point:G,index:e,face:null,object:O})}}Kc.prototype.isPoints=!0;class Hf extends _s{constructor(e,u,y,v,M,O,V,G,H){super(e,u,y,v,M,O,V,G,H),this.format=V!==void 0?V:1022,this.minFilter=O!==void 0?O:1006,this.magFilter=M!==void 0?M:1006,this.generateMipmaps=!1;const Q=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function ee(){Q.needsUpdate=!0,e.requestVideoFrameCallback(ee)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Hf.prototype.isVideoTexture=!0;class Eh extends _s{constructor(e,u,y,v,M,O,V,G,H,Q,ee,se){super(null,O,V,G,H,Q,v,M,ee,se),this.image={width:u,height:y},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}Eh.prototype.isCompressedTexture=!0;class Ah extends _s{constructor(e,u,y,v,M,O,V,G,H){super(e,u,y,v,M,O,V,G,H),this.needsUpdate=!0}}Ah.prototype.isCanvasTexture=!0;class xp extends _s{constructor(e,u,y,v,M,O,V,G,H,Q){if((Q=Q!==void 0?Q:1026)!==1026&&Q!==1027)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");y===void 0&&Q===1026&&(y=1012),y===void 0&&Q===1027&&(y=1020),super(null,v,M,O,V,G,Q,y,H),this.image={width:e,height:u},this.magFilter=V!==void 0?V:1003,this.minFilter=G!==void 0?G:1003,this.flipY=!1,this.generateMipmaps=!1}}xp.prototype.isDepthTexture=!0;class ku extends Pr{constructor(e=1,u=8,y=0,v=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:u,thetaStart:y,thetaLength:v},u=Math.max(3,u);const M=[],O=[],V=[],G=[],H=new re,Q=new en;O.push(0,0,0),V.push(0,0,1),G.push(.5,.5);for(let ee=0,se=3;ee<=u;ee++,se+=3){const ae=y+ee/u*v;H.x=e*Math.cos(ae),H.y=e*Math.sin(ae),O.push(H.x,H.y,H.z),V.push(0,0,1),Q.x=(O[se]/e+1)/2,Q.y=(O[se+1]/e+1)/2,G.push(Q.x,Q.y)}for(let ee=1;ee<=u;ee++)M.push(ee,ee+1,0);this.setIndex(M),this.setAttribute("position",new Un(O,3)),this.setAttribute("normal",new Un(V,3)),this.setAttribute("uv",new Un(G,2))}static fromJSON(e){return new ku(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class $l extends Pr{constructor(e=1,u=1,y=1,v=8,M=1,O=!1,V=0,G=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:u,height:y,radialSegments:v,heightSegments:M,openEnded:O,thetaStart:V,thetaLength:G};const H=this;v=Math.floor(v),M=Math.floor(M);const Q=[],ee=[],se=[],ae=[];let de=0;const be=[],Re=y/2;let Te=0;function ct(Et){const _t=de,jt=new en,Xt=new re;let _i=0;const vi=Et===!0?e:u,Bi=Et===!0?1:-1;for(let ki=1;ki<=v;ki++)ee.push(0,Re*Bi,0),se.push(0,Bi,0),ae.push(.5,.5),de++;const Li=de;for(let ki=0;ki<=v;ki++){const Zn=ki/v*G+V,En=Math.cos(Zn),Ji=Math.sin(Zn);Xt.x=vi*Ji,Xt.y=Re*Bi,Xt.z=vi*En,ee.push(Xt.x,Xt.y,Xt.z),se.push(0,Bi,0),jt.x=.5*En+.5,jt.y=.5*Ji*Bi+.5,ae.push(jt.x,jt.y),de++}for(let ki=0;ki<v;ki++){const Zn=_t+ki,En=Li+ki;Et===!0?Q.push(En,En+1,Zn):Q.push(En+1,En,Zn),_i+=3}H.addGroup(Te,_i,Et===!0?1:2),Te+=_i}(function(){const Et=new re,_t=new re;let jt=0;const Xt=(u-e)/y;for(let _i=0;_i<=M;_i++){const vi=[],Bi=_i/M,Li=Bi*(u-e)+e;for(let ki=0;ki<=v;ki++){const Zn=ki/v,En=Zn*G+V,Ji=Math.sin(En),In=Math.cos(En);_t.x=Li*Ji,_t.y=-Bi*y+Re,_t.z=Li*In,ee.push(_t.x,_t.y,_t.z),Et.set(Ji,Xt,In).normalize(),se.push(Et.x,Et.y,Et.z),ae.push(Zn,1-Bi),vi.push(de++)}be.push(vi)}for(let _i=0;_i<v;_i++)for(let vi=0;vi<M;vi++){const Bi=be[vi][_i],Li=be[vi+1][_i],ki=be[vi+1][_i+1],Zn=be[vi][_i+1];Q.push(Bi,Li,Zn),Q.push(Li,ki,Zn),jt+=6}H.addGroup(Te,jt,0),Te+=jt})(),O===!1&&(e>0&&ct(!0),u>0&&ct(!1)),this.setIndex(Q),this.setAttribute("position",new Un(ee,3)),this.setAttribute("normal",new Un(se,3)),this.setAttribute("uv",new Un(ae,2))}static fromJSON(e){return new $l(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Fu extends $l{constructor(e=1,u=1,y=8,v=1,M=!1,O=0,V=2*Math.PI){super(0,e,u,y,v,M,O,V),this.type="ConeGeometry",this.parameters={radius:e,height:u,radialSegments:y,heightSegments:v,openEnded:M,thetaStart:O,thetaLength:V}}static fromJSON(e){return new Fu(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class $a extends Pr{constructor(e,u,y=1,v=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:u,radius:y,detail:v};const M=[],O=[];function V(se,ae,de,be){const Re=be+1,Te=[];for(let ct=0;ct<=Re;ct++){Te[ct]=[];const Et=se.clone().lerp(de,ct/Re),_t=ae.clone().lerp(de,ct/Re),jt=Re-ct;for(let Xt=0;Xt<=jt;Xt++)Te[ct][Xt]=Xt===0&&ct===Re?Et:Et.clone().lerp(_t,Xt/jt)}for(let ct=0;ct<Re;ct++)for(let Et=0;Et<2*(Re-ct)-1;Et++){const _t=Math.floor(Et/2);Et%2==0?(G(Te[ct][_t+1]),G(Te[ct+1][_t]),G(Te[ct][_t])):(G(Te[ct][_t+1]),G(Te[ct+1][_t+1]),G(Te[ct+1][_t]))}}function G(se){M.push(se.x,se.y,se.z)}function H(se,ae){const de=3*se;ae.x=e[de+0],ae.y=e[de+1],ae.z=e[de+2]}function Q(se,ae,de,be){be<0&&se.x===1&&(O[ae]=se.x-1),de.x===0&&de.z===0&&(O[ae]=be/2/Math.PI+.5)}function ee(se){return Math.atan2(se.z,-se.x)}(function(se){const ae=new re,de=new re,be=new re;for(let Re=0;Re<u.length;Re+=3)H(u[Re+0],ae),H(u[Re+1],de),H(u[Re+2],be),V(ae,de,be,se)})(v),function(se){const ae=new re;for(let de=0;de<M.length;de+=3)ae.x=M[de+0],ae.y=M[de+1],ae.z=M[de+2],ae.normalize().multiplyScalar(se),M[de+0]=ae.x,M[de+1]=ae.y,M[de+2]=ae.z}(y),function(){const se=new re;for(let de=0;de<M.length;de+=3){se.x=M[de+0],se.y=M[de+1],se.z=M[de+2];const be=ee(se)/2/Math.PI+.5,Re=(ae=se,Math.atan2(-ae.y,Math.sqrt(ae.x*ae.x+ae.z*ae.z))/Math.PI+.5);O.push(be,1-Re)}var ae;(function(){const de=new re,be=new re,Re=new re,Te=new re,ct=new en,Et=new en,_t=new en;for(let jt=0,Xt=0;jt<M.length;jt+=9,Xt+=6){de.set(M[jt+0],M[jt+1],M[jt+2]),be.set(M[jt+3],M[jt+4],M[jt+5]),Re.set(M[jt+6],M[jt+7],M[jt+8]),ct.set(O[Xt+0],O[Xt+1]),Et.set(O[Xt+2],O[Xt+3]),_t.set(O[Xt+4],O[Xt+5]),Te.copy(de).add(be).add(Re).divideScalar(3);const _i=ee(Te);Q(ct,Xt+0,de,_i),Q(Et,Xt+2,be,_i),Q(_t,Xt+4,Re,_i)}})(),function(){for(let de=0;de<O.length;de+=6){const be=O[de+0],Re=O[de+2],Te=O[de+4],ct=Math.max(be,Re,Te),Et=Math.min(be,Re,Te);ct>.9&&Et<.1&&(be<.2&&(O[de+0]+=1),Re<.2&&(O[de+2]+=1),Te<.2&&(O[de+4]+=1))}}()}(),this.setAttribute("position",new Un(M,3)),this.setAttribute("normal",new Un(M.slice(),3)),this.setAttribute("uv",new Un(O,2)),v===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new $a(e.vertices,e.indices,e.radius,e.details)}}class Bu extends $a{constructor(e=1,u=0){const y=(1+Math.sqrt(5))/2,v=1/y;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-v,-y,0,-v,y,0,v,-y,0,v,y,-v,-y,0,-v,y,0,v,-y,0,v,y,0,-y,0,-v,y,0,-v,-y,0,v,y,0,v],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,u),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:u}}static fromJSON(e){return new Bu(e.radius,e.detail)}}const vd=new re,xd=new re,bp=new re,Ch=new Ei;class jf extends Pr{constructor(e,u){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:u},u=u!==void 0?u:1,e.isGeometry===!0)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const y=Math.pow(10,4),v=Math.cos(an*u),M=e.getIndex(),O=e.getAttribute("position"),V=M?M.count:O.count,G=[0,0,0],H=["a","b","c"],Q=new Array(3),ee={},se=[];for(let ae=0;ae<V;ae+=3){M?(G[0]=M.getX(ae),G[1]=M.getX(ae+1),G[2]=M.getX(ae+2)):(G[0]=ae,G[1]=ae+1,G[2]=ae+2);const{a:de,b:be,c:Re}=Ch;if(de.fromBufferAttribute(O,G[0]),be.fromBufferAttribute(O,G[1]),Re.fromBufferAttribute(O,G[2]),Ch.getNormal(bp),Q[0]=`${Math.round(de.x*y)},${Math.round(de.y*y)},${Math.round(de.z*y)}`,Q[1]=`${Math.round(be.x*y)},${Math.round(be.y*y)},${Math.round(be.z*y)}`,Q[2]=`${Math.round(Re.x*y)},${Math.round(Re.y*y)},${Math.round(Re.z*y)}`,Q[0]!==Q[1]&&Q[1]!==Q[2]&&Q[2]!==Q[0])for(let Te=0;Te<3;Te++){const ct=(Te+1)%3,Et=Q[Te],_t=Q[ct],jt=Ch[H[Te]],Xt=Ch[H[ct]],_i=`${Et}_${_t}`,vi=`${_t}_${Et}`;vi in ee&&ee[vi]?(bp.dot(ee[vi].normal)<=v&&(se.push(jt.x,jt.y,jt.z),se.push(Xt.x,Xt.y,Xt.z)),ee[vi]=null):_i in ee||(ee[_i]={index0:G[Te],index1:G[ct],normal:bp.clone()})}}for(const ae in ee)if(ee[ae]){const{index0:de,index1:be}=ee[ae];vd.fromBufferAttribute(O,de),xd.fromBufferAttribute(O,be),se.push(vd.x,vd.y,vd.z),se.push(xd.x,xd.y,xd.z)}this.setAttribute("position",new Un(se,3))}}class Za{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,u){const y=this.getUtoTmapping(e);return this.getPoint(y,u)}getPoints(e=5){const u=[];for(let y=0;y<=e;y++)u.push(this.getPoint(y/e));return u}getSpacedPoints(e=5){const u=[];for(let y=0;y<=e;y++)u.push(this.getPointAt(y/e));return u}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const u=[];let y,v=this.getPoint(0),M=0;u.push(0);for(let O=1;O<=e;O++)y=this.getPoint(O/e),M+=y.distanceTo(v),u.push(M),v=y;return this.cacheArcLengths=u,u}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,u){const y=this.getLengths();let v=0;const M=y.length;let O;O=u||e*y[M-1];let V,G=0,H=M-1;for(;G<=H;)if(v=Math.floor(G+(H-G)/2),V=y[v]-O,V<0)G=v+1;else{if(!(V>0)){H=v;break}H=v-1}if(v=H,y[v]===O)return v/(M-1);const Q=y[v];return(v+(O-Q)/(y[v+1]-Q))/(M-1)}getTangent(e,u){let v=e-1e-4,M=e+1e-4;v<0&&(v=0),M>1&&(M=1);const O=this.getPoint(v),V=this.getPoint(M),G=u||(O.isVector2?new en:new re);return G.copy(V).sub(O).normalize(),G}getTangentAt(e,u){const y=this.getUtoTmapping(e);return this.getTangent(y,u)}computeFrenetFrames(e,u){const y=new re,v=[],M=[],O=[],V=new re,G=new nr;for(let ae=0;ae<=e;ae++){const de=ae/e;v[ae]=this.getTangentAt(de,new re),v[ae].normalize()}M[0]=new re,O[0]=new re;let H=Number.MAX_VALUE;const Q=Math.abs(v[0].x),ee=Math.abs(v[0].y),se=Math.abs(v[0].z);Q<=H&&(H=Q,y.set(1,0,0)),ee<=H&&(H=ee,y.set(0,1,0)),se<=H&&y.set(0,0,1),V.crossVectors(v[0],y).normalize(),M[0].crossVectors(v[0],V),O[0].crossVectors(v[0],M[0]);for(let ae=1;ae<=e;ae++){if(M[ae]=M[ae-1].clone(),O[ae]=O[ae-1].clone(),V.crossVectors(v[ae-1],v[ae]),V.length()>Number.EPSILON){V.normalize();const de=Math.acos(Fn(v[ae-1].dot(v[ae]),-1,1));M[ae].applyMatrix4(G.makeRotationAxis(V,de))}O[ae].crossVectors(v[ae],M[ae])}if(u===!0){let ae=Math.acos(Fn(M[0].dot(M[e]),-1,1));ae/=e,v[0].dot(V.crossVectors(M[0],M[e]))>0&&(ae=-ae);for(let de=1;de<=e;de++)M[de].applyMatrix4(G.makeRotationAxis(v[de],ae*de)),O[de].crossVectors(v[de],M[de])}return{tangents:v,normals:M,binormals:O}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Js extends Za{constructor(e=0,u=0,y=1,v=1,M=0,O=2*Math.PI,V=!1,G=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=u,this.xRadius=y,this.yRadius=v,this.aStartAngle=M,this.aEndAngle=O,this.aClockwise=V,this.aRotation=G}getPoint(e,u){const y=u||new en,v=2*Math.PI;let M=this.aEndAngle-this.aStartAngle;const O=Math.abs(M)<Number.EPSILON;for(;M<0;)M+=v;for(;M>v;)M-=v;M<Number.EPSILON&&(M=O?0:v),this.aClockwise!==!0||O||(M===v?M=-v:M-=v);const V=this.aStartAngle+e*M;let G=this.aX+this.xRadius*Math.cos(V),H=this.aY+this.yRadius*Math.sin(V);if(this.aRotation!==0){const Q=Math.cos(this.aRotation),ee=Math.sin(this.aRotation),se=G-this.aX,ae=H-this.aY;G=se*Q-ae*ee+this.aX,H=se*ee+ae*Q+this.aY}return y.set(G,H)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Js.prototype.isEllipseCurve=!0;class wp extends Js{constructor(e,u,y,v,M,O){super(e,u,y,y,v,M,O),this.type="ArcCurve"}}function Wf(){let S=0,e=0,u=0,y=0;function v(M,O,V,G){S=M,e=V,u=-3*M+3*O-2*V-G,y=2*M-2*O+V+G}return{initCatmullRom:function(M,O,V,G,H){v(O,V,H*(V-M),H*(G-O))},initNonuniformCatmullRom:function(M,O,V,G,H,Q,ee){let se=(O-M)/H-(V-M)/(H+Q)+(V-O)/Q,ae=(V-O)/Q-(G-O)/(Q+ee)+(G-V)/ee;se*=Q,ae*=Q,v(O,V,se,ae)},calc:function(M){const O=M*M;return S+e*M+u*O+y*(O*M)}}}wp.prototype.isArcCurve=!0;const Tp=new re,Nu=new Wf,Mp=new Wf,Jc=new Wf;class Lh extends Za{constructor(e=[],u=!1,y="centripetal",v=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=u,this.curveType=y,this.tension=v}getPoint(e,u=new re){const y=u,v=this.points,M=v.length,O=(M-(this.closed?0:1))*e;let V,G,H=Math.floor(O),Q=O-H;this.closed?H+=H>0?0:(Math.floor(Math.abs(H)/M)+1)*M:Q===0&&H===M-1&&(H=M-2,Q=1),this.closed||H>0?V=v[(H-1)%M]:(Tp.subVectors(v[0],v[1]).add(v[0]),V=Tp);const ee=v[H%M],se=v[(H+1)%M];if(this.closed||H+2<M?G=v[(H+2)%M]:(Tp.subVectors(v[M-1],v[M-2]).add(v[M-1]),G=Tp),this.curveType==="centripetal"||this.curveType==="chordal"){const ae=this.curveType==="chordal"?.5:.25;let de=Math.pow(V.distanceToSquared(ee),ae),be=Math.pow(ee.distanceToSquared(se),ae),Re=Math.pow(se.distanceToSquared(G),ae);be<1e-4&&(be=1),de<1e-4&&(de=be),Re<1e-4&&(Re=be),Nu.initNonuniformCatmullRom(V.x,ee.x,se.x,G.x,de,be,Re),Mp.initNonuniformCatmullRom(V.y,ee.y,se.y,G.y,de,be,Re),Jc.initNonuniformCatmullRom(V.z,ee.z,se.z,G.z,de,be,Re)}else this.curveType==="catmullrom"&&(Nu.initCatmullRom(V.x,ee.x,se.x,G.x,this.tension),Mp.initCatmullRom(V.y,ee.y,se.y,G.y,this.tension),Jc.initCatmullRom(V.z,ee.z,se.z,G.z,this.tension));return y.set(Nu.calc(Q),Mp.calc(Q),Jc.calc(Q)),y}copy(e){super.copy(e),this.points=[];for(let u=0,y=e.points.length;u<y;u++){const v=e.points[u];this.points.push(v.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let u=0,y=this.points.length;u<y;u++){const v=this.points[u];e.points.push(v.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let u=0,y=e.points.length;u<y;u++){const v=e.points[u];this.points.push(new re().fromArray(v))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Zl(S,e,u,y,v){const M=.5*(y-e),O=.5*(v-u),V=S*S;return(2*u-2*y+M+O)*(S*V)+(-3*u+3*y-2*M-O)*V+M*S+u}function Cl(S,e,u,y){return function(v,M){const O=1-v;return O*O*M}(S,e)+function(v,M){return 2*(1-v)*v*M}(S,u)+function(v,M){return v*v*M}(S,y)}function uo(S,e,u,y,v){return function(M,O){const V=1-M;return V*V*V*O}(S,e)+function(M,O){const V=1-M;return 3*V*V*M*O}(S,u)+function(M,O){return 3*(1-M)*M*M*O}(S,y)+function(M,O){return M*M*M*O}(S,v)}Lh.prototype.isCatmullRomCurve3=!0;class Xa extends Za{constructor(e=new en,u=new en,y=new en,v=new en){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=u,this.v2=y,this.v3=v}getPoint(e,u=new en){const y=u,v=this.v0,M=this.v1,O=this.v2,V=this.v3;return y.set(uo(e,v.x,M.x,O.x,V.x),uo(e,v.y,M.y,O.y,V.y)),y}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Xa.prototype.isCubicBezierCurve=!0;class bd extends Za{constructor(e=new re,u=new re,y=new re,v=new re){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=u,this.v2=y,this.v3=v}getPoint(e,u=new re){const y=u,v=this.v0,M=this.v1,O=this.v2,V=this.v3;return y.set(uo(e,v.x,M.x,O.x,V.x),uo(e,v.y,M.y,O.y,V.y),uo(e,v.z,M.z,O.z,V.z)),y}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}bd.prototype.isCubicBezierCurve3=!0;class Qc extends Za{constructor(e=new en,u=new en){super(),this.type="LineCurve",this.v1=e,this.v2=u}getPoint(e,u=new en){const y=u;return e===1?y.copy(this.v2):(y.copy(this.v2).sub(this.v1),y.multiplyScalar(e).add(this.v1)),y}getPointAt(e,u){return this.getPoint(e,u)}getTangent(e,u){const y=u||new en;return y.copy(this.v2).sub(this.v1).normalize(),y}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Qc.prototype.isLineCurve=!0;class Sp extends Za{constructor(e=new re,u=new re){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=u}getPoint(e,u=new re){const y=u;return e===1?y.copy(this.v2):(y.copy(this.v2).sub(this.v1),y.multiplyScalar(e).add(this.v1)),y}getPointAt(e,u){return this.getPoint(e,u)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wd extends Za{constructor(e=new en,u=new en,y=new en){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=u,this.v2=y}getPoint(e,u=new en){const y=u,v=this.v0,M=this.v1,O=this.v2;return y.set(Cl(e,v.x,M.x,O.x),Cl(e,v.y,M.y,O.y)),y}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}wd.prototype.isQuadraticBezierCurve=!0;class Uu extends Za{constructor(e=new re,u=new re,y=new re){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=u,this.v2=y}getPoint(e,u=new re){const y=u,v=this.v0,M=this.v1,O=this.v2;return y.set(Cl(e,v.x,M.x,O.x),Cl(e,v.y,M.y,O.y),Cl(e,v.z,M.z,O.z)),y}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Uu.prototype.isQuadraticBezierCurve3=!0;class Ep extends Za{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,u=new en){const y=u,v=this.points,M=(v.length-1)*e,O=Math.floor(M),V=M-O,G=v[O===0?O:O-1],H=v[O],Q=v[O>v.length-2?v.length-1:O+1],ee=v[O>v.length-3?v.length-1:O+2];return y.set(Zl(V,G.x,H.x,Q.x,ee.x),Zl(V,G.y,H.y,Q.y,ee.y)),y}copy(e){super.copy(e),this.points=[];for(let u=0,y=e.points.length;u<y;u++){const v=e.points[u];this.points.push(v.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let u=0,y=this.points.length;u<y;u++){const v=this.points[u];e.points.push(v.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let u=0,y=e.points.length;u<y;u++){const v=e.points[u];this.points.push(new en().fromArray(v))}return this}}Ep.prototype.isSplineCurve=!0;var Ap=Object.freeze({__proto__:null,ArcCurve:wp,CatmullRomCurve3:Lh,CubicBezierCurve:Xa,CubicBezierCurve3:bd,EllipseCurve:Js,LineCurve:Qc,LineCurve3:Sp,QuadraticBezierCurve:wd,QuadraticBezierCurve3:Uu,SplineCurve:Ep});const Cp=function(S,e,u=2){const y=e&&e.length,v=y?e[0]*u:S.length;let M=Lp(S,0,v,u,!0);const O=[];if(!M||M.next===M.prev)return O;let V,G,H,Q,ee,se,ae;if(y&&(M=function(de,be,Re,Te){const ct=[];let Et,_t,jt,Xt,_i;for(Et=0,_t=be.length;Et<_t;Et++)jt=be[Et]*Te,Xt=Et<_t-1?be[Et+1]*Te:de.length,_i=Lp(de,jt,Xt,Te,!1),_i===_i.next&&(_i.steiner=!0),ct.push(C_(_i));for(ct.sort(Yl),Et=0;Et<ct.length;Et++)E_(ct[Et],Re),Re=cl(Re,Re.next);return Re}(S,e,M,u)),S.length>80*u){V=H=S[0],G=Q=S[1];for(let de=u;de<v;de+=u)ee=S[de],se=S[de+1],ee<V&&(V=ee),se<G&&(G=se),ee>H&&(H=ee),se>Q&&(Q=se);ae=Math.max(H-V,Q-G),ae=ae!==0?1/ae:0}return Xl(M,O,u,V,G,ae),O};function Lp(S,e,u,y,v){let M,O;if(v===function(V,G,H,Q){let ee=0;for(let se=G,ae=H-Q;se<H;se+=Q)ee+=(V[ae]-V[se])*(V[se+1]+V[ae+1]),ae=se;return ee}(S,e,u,y)>0)for(M=e;M<u;M+=y)O=A(M,S[M],S[M+1],O);else for(M=u-y;M>=e;M-=y)O=A(M,S[M],S[M+1],O);return O&&f(O,O.next)&&(k(O),O=O.next),O}function cl(S,e){if(!S)return S;e||(e=S);let u,y=S;do if(u=!1,y.steiner||!f(y,y.next)&&fo(y.prev,y,y.next)!==0)y=y.next;else{if(k(y),y=e=y.prev,y===y.next)break;u=!0}while(u||y!==e);return e}function Xl(S,e,u,y,v,M,O){if(!S)return;!O&&M&&function(Q,ee,se,ae){let de=Q;do de.z===null&&(de.z=qf(de.x,de.y,ee,se,ae)),de.prevZ=de.prev,de.nextZ=de.next,de=de.next;while(de!==Q);de.prevZ.nextZ=null,de.prevZ=null,function(be){let Re,Te,ct,Et,_t,jt,Xt,_i,vi=1;do{for(Te=be,be=null,_t=null,jt=0;Te;){for(jt++,ct=Te,Xt=0,Re=0;Re<vi&&(Xt++,ct=ct.nextZ,ct);Re++);for(_i=vi;Xt>0||_i>0&&ct;)Xt!==0&&(_i===0||!ct||Te.z<=ct.z)?(Et=Te,Te=Te.nextZ,Xt--):(Et=ct,ct=ct.nextZ,_i--),_t?_t.nextZ=Et:be=Et,Et.prevZ=_t,_t=Et;Te=ct}_t.nextZ=null,vi*=2}while(jt>1)}(de)}(S,y,v,M);let V,G,H=S;for(;S.prev!==S.next;)if(V=S.prev,G=S.next,M?Ll(S,y,v,M):dc(S))e.push(V.i/u),e.push(S.i/u),e.push(G.i/u),k(S),S=G.next,H=G.next;else if((S=G)===H){O?O===1?Xl(S=pc(cl(S),e,u),e,u,y,v,M,2):O===2&&fc(S,e,u,y,v,M):Xl(cl(S),e,u,y,v,M,1);break}}function dc(S){const e=S.prev,u=S,y=S.next;if(fo(e,u,y)>=0)return!1;let v=S.next.next;for(;v!==S.prev;){if(Vu(e.x,e.y,u.x,u.y,y.x,y.y,v.x,v.y)&&fo(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function Ll(S,e,u,y){const v=S.prev,M=S,O=S.next;if(fo(v,M,O)>=0)return!1;const V=v.x<M.x?v.x<O.x?v.x:O.x:M.x<O.x?M.x:O.x,G=v.y<M.y?v.y<O.y?v.y:O.y:M.y<O.y?M.y:O.y,H=v.x>M.x?v.x>O.x?v.x:O.x:M.x>O.x?M.x:O.x,Q=v.y>M.y?v.y>O.y?v.y:O.y:M.y>O.y?M.y:O.y,ee=qf(V,G,e,u,y),se=qf(H,Q,e,u,y);let ae=S.prevZ,de=S.nextZ;for(;ae&&ae.z>=ee&&de&&de.z<=se;){if(ae!==S.prev&&ae!==S.next&&Vu(v.x,v.y,M.x,M.y,O.x,O.y,ae.x,ae.y)&&fo(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,de!==S.prev&&de!==S.next&&Vu(v.x,v.y,M.x,M.y,O.x,O.y,de.x,de.y)&&fo(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ae&&ae.z>=ee;){if(ae!==S.prev&&ae!==S.next&&Vu(v.x,v.y,M.x,M.y,O.x,O.y,ae.x,ae.y)&&fo(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;de&&de.z<=se;){if(de!==S.prev&&de!==S.next&&Vu(v.x,v.y,M.x,M.y,O.x,O.y,de.x,de.y)&&fo(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function pc(S,e,u){let y=S;do{const v=y.prev,M=y.next.next;!f(v,M)&&i(v,y,y.next,M)&&x(v,M)&&x(M,v)&&(e.push(v.i/u),e.push(y.i/u),e.push(M.i/u),k(y),k(y.next),y=S=M),y=y.next}while(y!==S);return cl(y)}function fc(S,e,u,y,v,M){let O=S;do{let V=O.next.next;for(;V!==O.prev;){if(O.i!==V.i&&na(O,V)){let G=w(O,V);return O=cl(O,O.next),G=cl(G,G.next),Xl(O,e,u,y,v,M),void Xl(G,e,u,y,v,M)}V=V.next}O=O.next}while(O!==S)}function Yl(S,e){return S.x-e.x}function E_(S,e){if(e=function(u,y){let v=y;const M=u.x,O=u.y;let V,G=-1/0;do{if(O<=v.y&&O>=v.next.y&&v.next.y!==v.y){const de=v.x+(O-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(de<=M&&de>G){if(G=de,de===M){if(O===v.y)return v;if(O===v.next.y)return v.next}V=v.x<v.next.x?v:v.next}}v=v.next}while(v!==y);if(!V)return null;if(M===G)return V;const H=V,Q=V.x,ee=V.y;let se,ae=1/0;v=V;do M>=v.x&&v.x>=Q&&M!==v.x&&Vu(O<ee?M:G,O,Q,ee,O<ee?G:M,O,v.x,v.y)&&(se=Math.abs(O-v.y)/(M-v.x),x(v,u)&&(se<ae||se===ae&&(v.x>V.x||v.x===V.x&&A_(V,v)))&&(V=v,ae=se)),v=v.next;while(v!==H);return V}(S,e)){const u=w(e,S);cl(e,e.next),cl(u,u.next)}}function A_(S,e){return fo(S.prev,S,e.prev)<0&&fo(e.next,S,S.next)<0}function qf(S,e,u,y,v){return(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S=32767*(S-u)*v)|S<<8))|S<<4))|S<<2))|S<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-y)*v)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function C_(S){let e=S,u=S;do(e.x<u.x||e.x===u.x&&e.y<u.y)&&(u=e),e=e.next;while(e!==S);return u}function Vu(S,e,u,y,v,M,O,V){return(v-O)*(e-V)-(S-O)*(M-V)>=0&&(S-O)*(y-V)-(u-O)*(e-V)>=0&&(u-O)*(M-V)-(v-O)*(y-V)>=0}function na(S,e){return S.next.i!==e.i&&S.prev.i!==e.i&&!function(u,y){let v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==y.i&&v.next.i!==y.i&&i(v,v.next,u,y))return!0;v=v.next}while(v!==u);return!1}(S,e)&&(x(S,e)&&x(e,S)&&function(u,y){let v=u,M=!1;const O=(u.x+y.x)/2,V=(u.y+y.y)/2;do v.y>V!=v.next.y>V&&v.next.y!==v.y&&O<(v.next.x-v.x)*(V-v.y)/(v.next.y-v.y)+v.x&&(M=!M),v=v.next;while(v!==u);return M}(S,e)&&(fo(S.prev,S,e.prev)||fo(S,e.prev,e))||f(S,e)&&fo(S.prev,S,S.next)>0&&fo(e.prev,e,e.next)>0)}function fo(S,e,u){return(e.y-S.y)*(u.x-e.x)-(e.x-S.x)*(u.y-e.y)}function f(S,e){return S.x===e.x&&S.y===e.y}function i(S,e,u,y){const v=m(fo(S,e,u)),M=m(fo(S,e,y)),O=m(fo(u,y,S)),V=m(fo(u,y,e));return v!==M&&O!==V||!(v!==0||!s(S,u,e))||!(M!==0||!s(S,y,e))||!(O!==0||!s(u,S,y))||!(V!==0||!s(u,e,y))}function s(S,e,u){return e.x<=Math.max(S.x,u.x)&&e.x>=Math.min(S.x,u.x)&&e.y<=Math.max(S.y,u.y)&&e.y>=Math.min(S.y,u.y)}function m(S){return S>0?1:S<0?-1:0}function x(S,e){return fo(S.prev,S,S.next)<0?fo(S,e,S.next)>=0&&fo(S,S.prev,e)>=0:fo(S,e,S.prev)<0||fo(S,S.next,e)<0}function w(S,e){const u=new U(S.i,S.x,S.y),y=new U(e.i,e.x,e.y),v=S.next,M=e.prev;return S.next=e,e.prev=S,u.next=v,v.prev=u,y.next=u,u.prev=y,M.next=y,y.prev=M,y}function A(S,e,u,y){const v=new U(S,e,u);return y?(v.next=y.next,v.prev=y,y.next.prev=v,y.next=v):(v.prev=v,v.next=v),v}function k(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function U(S,e,u){this.i=S,this.x=e,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class W{static area(e){const u=e.length;let y=0;for(let v=u-1,M=0;M<u;v=M++)y+=e[v].x*e[M].y-e[M].x*e[v].y;return .5*y}static isClockWise(e){return W.area(e)<0}static triangulateShape(e,u){const y=[],v=[],M=[];j(e),Y(y,e);let O=e.length;u.forEach(j);for(let G=0;G<u.length;G++)v.push(O),O+=u[G].length,Y(y,u[G]);const V=Cp(y,v);for(let G=0;G<V.length;G+=3)M.push(V.slice(G,G+3));return M}}function j(S){const e=S.length;e>2&&S[e-1].equals(S[0])&&S.pop()}function Y(S,e){for(let u=0;u<e.length;u++)S.push(e[u].x),S.push(e[u].y)}class J extends Pr{constructor(e,u){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:u},e=Array.isArray(e)?e:[e];const y=this,v=[],M=[];for(let V=0,G=e.length;V<G;V++)O(e[V]);function O(V){const G=[],H=u.curveSegments!==void 0?u.curveSegments:12,Q=u.steps!==void 0?u.steps:1;let ee=u.depth!==void 0?u.depth:100,se=u.bevelEnabled===void 0||u.bevelEnabled,ae=u.bevelThickness!==void 0?u.bevelThickness:6,de=u.bevelSize!==void 0?u.bevelSize:ae-2,be=u.bevelOffset!==void 0?u.bevelOffset:0,Re=u.bevelSegments!==void 0?u.bevelSegments:3;const Te=u.extrudePath,ct=u.UVGenerator!==void 0?u.UVGenerator:oe;u.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),ee=u.amount);let Et,_t,jt,Xt,_i,vi=!1;Te&&(Et=Te.getSpacedPoints(Q),vi=!0,se=!1,_t=Te.computeFrenetFrames(Q,!1),jt=new re,Xt=new re,_i=new re),se||(Re=0,ae=0,de=0,be=0);const Bi=V.extractPoints(H);let Li=Bi.shape;const ki=Bi.holes;if(!W.isClockWise(Li)){Li=Li.reverse();for(let Ni=0,Bt=ki.length;Ni<Bt;Ni++){const Ii=ki[Ni];W.isClockWise(Ii)&&(ki[Ni]=Ii.reverse())}}const Zn=W.triangulateShape(Li,ki),En=Li;for(let Ni=0,Bt=ki.length;Ni<Bt;Ni++){const Ii=ki[Ni];Li=Li.concat(Ii)}function Ji(Ni,Bt,Ii){return Bt||console.error("THREE.ExtrudeGeometry: vec does not exist"),Bt.clone().multiplyScalar(Ii).add(Ni)}const In=Li.length,ir=Zn.length;function rr(Ni,Bt,Ii){let gn,vn,pn;const or=Ni.x-Bt.x,Ar=Ni.y-Bt.y,mr=Ii.x-Ni.x,ns=Ii.y-Ni.y,Kr=or*or+Ar*Ar,sa=or*ns-Ar*mr;if(Math.abs(sa)>Number.EPSILON){const no=Math.sqrt(Kr),oa=Math.sqrt(mr*mr+ns*ns),ul=Bt.x-Ar/no,Dh=Bt.y+or/no,Cd=((Ii.x-ns/oa-ul)*ns-(Ii.y+mr/oa-Dh)*mr)/(or*ns-Ar*mr);gn=ul+or*Cd-Ni.x,vn=Dh+Ar*Cd-Ni.y;const Oh=gn*gn+vn*vn;if(Oh<=2)return new en(gn,vn);pn=Math.sqrt(Oh/2)}else{let no=!1;or>Number.EPSILON?mr>Number.EPSILON&&(no=!0):or<-Number.EPSILON?mr<-Number.EPSILON&&(no=!0):Math.sign(Ar)===Math.sign(ns)&&(no=!0),no?(gn=-Ar,vn=or,pn=Math.sqrt(Kr)):(gn=or,vn=Ar,pn=Math.sqrt(Kr/2))}return new en(gn/pn,vn/pn)}const vr=[];for(let Ni=0,Bt=En.length,Ii=Bt-1,gn=Ni+1;Ni<Bt;Ni++,Ii++,gn++)Ii===Bt&&(Ii=0),gn===Bt&&(gn=0),vr[Ni]=rr(En[Ni],En[Ii],En[gn]);const kr=[];let Fr,Rn=vr.concat();for(let Ni=0,Bt=ki.length;Ni<Bt;Ni++){const Ii=ki[Ni];Fr=[];for(let gn=0,vn=Ii.length,pn=vn-1,or=gn+1;gn<vn;gn++,pn++,or++)pn===vn&&(pn=0),or===vn&&(or=0),Fr[gn]=rr(Ii[gn],Ii[pn],Ii[or]);kr.push(Fr),Rn=Rn.concat(Fr)}for(let Ni=0;Ni<Re;Ni++){const Bt=Ni/Re,Ii=ae*Math.cos(Bt*Math.PI/2),gn=de*Math.sin(Bt*Math.PI/2)+be;for(let vn=0,pn=En.length;vn<pn;vn++){const or=Ji(En[vn],vr[vn],gn);Qi(or.x,or.y,-Ii)}for(let vn=0,pn=ki.length;vn<pn;vn++){const or=ki[vn];Fr=kr[vn];for(let Ar=0,mr=or.length;Ar<mr;Ar++){const ns=Ji(or[Ar],Fr[Ar],gn);Qi(ns.x,ns.y,-Ii)}}}const $t=de+be;for(let Ni=0;Ni<In;Ni++){const Bt=se?Ji(Li[Ni],Rn[Ni],$t):Li[Ni];vi?(Xt.copy(_t.normals[0]).multiplyScalar(Bt.x),jt.copy(_t.binormals[0]).multiplyScalar(Bt.y),_i.copy(Et[0]).add(Xt).add(jt),Qi(_i.x,_i.y,_i.z)):Qi(Bt.x,Bt.y,0)}for(let Ni=1;Ni<=Q;Ni++)for(let Bt=0;Bt<In;Bt++){const Ii=se?Ji(Li[Bt],Rn[Bt],$t):Li[Bt];vi?(Xt.copy(_t.normals[Ni]).multiplyScalar(Ii.x),jt.copy(_t.binormals[Ni]).multiplyScalar(Ii.y),_i.copy(Et[Ni]).add(Xt).add(jt),Qi(_i.x,_i.y,_i.z)):Qi(Ii.x,Ii.y,ee/Q*Ni)}for(let Ni=Re-1;Ni>=0;Ni--){const Bt=Ni/Re,Ii=ae*Math.cos(Bt*Math.PI/2),gn=de*Math.sin(Bt*Math.PI/2)+be;for(let vn=0,pn=En.length;vn<pn;vn++){const or=Ji(En[vn],vr[vn],gn);Qi(or.x,or.y,ee+Ii)}for(let vn=0,pn=ki.length;vn<pn;vn++){const or=ki[vn];Fr=kr[vn];for(let Ar=0,mr=or.length;Ar<mr;Ar++){const ns=Ji(or[Ar],Fr[Ar],gn);vi?Qi(ns.x,ns.y+Et[Q-1].y,Et[Q-1].x+Ii):Qi(ns.x,ns.y,ee+Ii)}}}function ii(Ni,Bt){let Ii=Ni.length;for(;--Ii>=0;){const gn=Ii;let vn=Ii-1;vn<0&&(vn=Ni.length-1);for(let pn=0,or=Q+2*Re;pn<or;pn++){const Ar=In*pn,mr=In*(pn+1);Oi(Bt+gn+Ar,Bt+vn+Ar,Bt+vn+mr,Bt+gn+mr)}}}function Qi(Ni,Bt,Ii){G.push(Ni),G.push(Bt),G.push(Ii)}function ji(Ni,Bt,Ii){Nn(Ni),Nn(Bt),Nn(Ii);const gn=v.length/3,vn=ct.generateTopUV(y,v,gn-3,gn-2,gn-1);Hn(vn[0]),Hn(vn[1]),Hn(vn[2])}function Oi(Ni,Bt,Ii,gn){Nn(Ni),Nn(Bt),Nn(gn),Nn(Bt),Nn(Ii),Nn(gn);const vn=v.length/3,pn=ct.generateSideWallUV(y,v,vn-6,vn-3,vn-2,vn-1);Hn(pn[0]),Hn(pn[1]),Hn(pn[3]),Hn(pn[1]),Hn(pn[2]),Hn(pn[3])}function Nn(Ni){v.push(G[3*Ni+0]),v.push(G[3*Ni+1]),v.push(G[3*Ni+2])}function Hn(Ni){M.push(Ni.x),M.push(Ni.y)}(function(){const Ni=v.length/3;if(se){let Bt=0,Ii=In*Bt;for(let gn=0;gn<ir;gn++){const vn=Zn[gn];ji(vn[2]+Ii,vn[1]+Ii,vn[0]+Ii)}Bt=Q+2*Re,Ii=In*Bt;for(let gn=0;gn<ir;gn++){const vn=Zn[gn];ji(vn[0]+Ii,vn[1]+Ii,vn[2]+Ii)}}else{for(let Bt=0;Bt<ir;Bt++){const Ii=Zn[Bt];ji(Ii[2],Ii[1],Ii[0])}for(let Bt=0;Bt<ir;Bt++){const Ii=Zn[Bt];ji(Ii[0]+In*Q,Ii[1]+In*Q,Ii[2]+In*Q)}}y.addGroup(Ni,v.length/3-Ni,0)})(),function(){const Ni=v.length/3;let Bt=0;ii(En,Bt),Bt+=En.length;for(let Ii=0,gn=ki.length;Ii<gn;Ii++){const vn=ki[Ii];ii(vn,Bt),Bt+=vn.length}y.addGroup(Ni,v.length/3-Ni,1)}()}this.setAttribute("position",new Un(v,3)),this.setAttribute("uv",new Un(M,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(u,y,v){if(v.shapes=[],Array.isArray(u))for(let M=0,O=u.length;M<O;M++){const V=u[M];v.shapes.push(V.uuid)}else v.shapes.push(u.uuid);return y.extrudePath!==void 0&&(v.options.extrudePath=y.extrudePath.toJSON()),v}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,u){const y=[];for(let M=0,O=e.shapes.length;M<O;M++){const V=u[e.shapes[M]];y.push(V)}const v=e.options.extrudePath;return v!==void 0&&(e.options.extrudePath=new Ap[v.type]().fromJSON(v)),new J(y,e.options)}}const oe={generateTopUV:function(S,e,u,y,v){const M=e[3*u],O=e[3*u+1],V=e[3*y],G=e[3*y+1],H=e[3*v],Q=e[3*v+1];return[new en(M,O),new en(V,G),new en(H,Q)]},generateSideWallUV:function(S,e,u,y,v,M){const O=e[3*u],V=e[3*u+1],G=e[3*u+2],H=e[3*y],Q=e[3*y+1],ee=e[3*y+2],se=e[3*v],ae=e[3*v+1],de=e[3*v+2],be=e[3*M],Re=e[3*M+1],Te=e[3*M+2];return Math.abs(V-Q)<Math.abs(O-H)?[new en(O,1-G),new en(H,1-ee),new en(se,1-de),new en(be,1-Te)]:[new en(V,1-G),new en(Q,1-ee),new en(ae,1-de),new en(Re,1-Te)]}};class pe extends $a{constructor(e=1,u=0){const y=(1+Math.sqrt(5))/2;super([-1,y,0,1,y,0,-1,-y,0,1,-y,0,0,-1,y,0,1,y,0,-1,-y,0,1,-y,y,0,-1,y,0,1,-y,0,-1,-y,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,u),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:u}}static fromJSON(e){return new pe(e.radius,e.detail)}}class ue extends Pr{constructor(e,u=12,y=0,v=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:u,phiStart:y,phiLength:v},u=Math.floor(u),v=Fn(v,0,2*Math.PI);const M=[],O=[],V=[],G=1/u,H=new re,Q=new en;for(let ee=0;ee<=u;ee++){const se=y+ee*G*v,ae=Math.sin(se),de=Math.cos(se);for(let be=0;be<=e.length-1;be++)H.x=e[be].x*ae,H.y=e[be].y,H.z=e[be].x*de,O.push(H.x,H.y,H.z),Q.x=ee/u,Q.y=be/(e.length-1),V.push(Q.x,Q.y)}for(let ee=0;ee<u;ee++)for(let se=0;se<e.length-1;se++){const ae=se+ee*e.length,de=ae,be=ae+e.length,Re=ae+e.length+1,Te=ae+1;M.push(de,be,Te),M.push(be,Re,Te)}if(this.setIndex(M),this.setAttribute("position",new Un(O,3)),this.setAttribute("uv",new Un(V,2)),this.computeVertexNormals(),v===2*Math.PI){const ee=this.attributes.normal.array,se=new re,ae=new re,de=new re,be=u*e.length*3;for(let Re=0,Te=0;Re<e.length;Re++,Te+=3)se.x=ee[Te+0],se.y=ee[Te+1],se.z=ee[Te+2],ae.x=ee[be+Te+0],ae.y=ee[be+Te+1],ae.z=ee[be+Te+2],de.addVectors(se,ae).normalize(),ee[Te+0]=ee[be+Te+0]=de.x,ee[Te+1]=ee[be+Te+1]=de.y,ee[Te+2]=ee[be+Te+2]=de.z}}static fromJSON(e){return new ue(e.points,e.segments,e.phiStart,e.phiLength)}}class _e extends $a{constructor(e=1,u=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,u),this.type="OctahedronGeometry",this.parameters={radius:e,detail:u}}static fromJSON(e){return new _e(e.radius,e.detail)}}class ge extends Pr{constructor(e,u,y){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:u,stacks:y};const v=[],M=[],O=[],V=[],G=1e-5,H=new re,Q=new re,ee=new re,se=new re,ae=new re;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const de=u+1;for(let be=0;be<=y;be++){const Re=be/y;for(let Te=0;Te<=u;Te++){const ct=Te/u;e(ct,Re,Q),M.push(Q.x,Q.y,Q.z),ct-G>=0?(e(ct-G,Re,ee),se.subVectors(Q,ee)):(e(ct+G,Re,ee),se.subVectors(ee,Q)),Re-G>=0?(e(ct,Re-G,ee),ae.subVectors(Q,ee)):(e(ct,Re+G,ee),ae.subVectors(ee,Q)),H.crossVectors(se,ae).normalize(),O.push(H.x,H.y,H.z),V.push(ct,Re)}}for(let be=0;be<y;be++)for(let Re=0;Re<u;Re++){const Te=be*de+Re,ct=be*de+Re+1,Et=(be+1)*de+Re+1,_t=(be+1)*de+Re;v.push(Te,ct,_t),v.push(ct,Et,_t)}this.setIndex(v),this.setAttribute("position",new Un(M,3)),this.setAttribute("normal",new Un(O,3)),this.setAttribute("uv",new Un(V,2))}}class Oe extends Pr{constructor(e=.5,u=1,y=8,v=1,M=0,O=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:u,thetaSegments:y,phiSegments:v,thetaStart:M,thetaLength:O},y=Math.max(3,y);const V=[],G=[],H=[],Q=[];let ee=e;const se=(u-e)/(v=Math.max(1,v)),ae=new re,de=new en;for(let be=0;be<=v;be++){for(let Re=0;Re<=y;Re++){const Te=M+Re/y*O;ae.x=ee*Math.cos(Te),ae.y=ee*Math.sin(Te),G.push(ae.x,ae.y,ae.z),H.push(0,0,1),de.x=(ae.x/u+1)/2,de.y=(ae.y/u+1)/2,Q.push(de.x,de.y)}ee+=se}for(let be=0;be<v;be++){const Re=be*(y+1);for(let Te=0;Te<y;Te++){const ct=Te+Re,Et=ct,_t=ct+y+1,jt=ct+y+2,Xt=ct+1;V.push(Et,_t,Xt),V.push(_t,jt,Xt)}}this.setIndex(V),this.setAttribute("position",new Un(G,3)),this.setAttribute("normal",new Un(H,3)),this.setAttribute("uv",new Un(Q,2))}static fromJSON(e){return new Oe(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Ge extends Pr{constructor(e,u=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:u};const y=[],v=[],M=[],O=[];let V=0,G=0;if(Array.isArray(e)===!1)H(e);else for(let Q=0;Q<e.length;Q++)H(e[Q]),this.addGroup(V,G,Q),V+=G,G=0;function H(Q){const ee=v.length/3,se=Q.extractPoints(u);let ae=se.shape;const de=se.holes;W.isClockWise(ae)===!1&&(ae=ae.reverse());for(let Re=0,Te=de.length;Re<Te;Re++){const ct=de[Re];W.isClockWise(ct)===!0&&(de[Re]=ct.reverse())}const be=W.triangulateShape(ae,de);for(let Re=0,Te=de.length;Re<Te;Re++){const ct=de[Re];ae=ae.concat(ct)}for(let Re=0,Te=ae.length;Re<Te;Re++){const ct=ae[Re];v.push(ct.x,ct.y,0),M.push(0,0,1),O.push(ct.x,ct.y)}for(let Re=0,Te=be.length;Re<Te;Re++){const ct=be[Re],Et=ct[0]+ee,_t=ct[1]+ee,jt=ct[2]+ee;y.push(Et,_t,jt),G+=3}}this.setIndex(y),this.setAttribute("position",new Un(v,3)),this.setAttribute("normal",new Un(M,3)),this.setAttribute("uv",new Un(O,2))}toJSON(){const e=super.toJSON();return function(u,y){if(y.shapes=[],Array.isArray(u))for(let v=0,M=u.length;v<M;v++){const O=u[v];y.shapes.push(O.uuid)}else y.shapes.push(u.uuid);return y}(this.parameters.shapes,e)}static fromJSON(e,u){const y=[];for(let v=0,M=e.shapes.length;v<M;v++){const O=u[e.shapes[v]];y.push(O)}return new Ge(y,e.curveSegments)}}class He extends Pr{constructor(e=1,u=32,y=16,v=0,M=2*Math.PI,O=0,V=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:u,heightSegments:y,phiStart:v,phiLength:M,thetaStart:O,thetaLength:V},u=Math.max(3,Math.floor(u)),y=Math.max(2,Math.floor(y));const G=Math.min(O+V,Math.PI);let H=0;const Q=[],ee=new re,se=new re,ae=[],de=[],be=[],Re=[];for(let Te=0;Te<=y;Te++){const ct=[],Et=Te/y;let _t=0;Te==0&&O==0?_t=.5/u:Te==y&&G==Math.PI&&(_t=-.5/u);for(let jt=0;jt<=u;jt++){const Xt=jt/u;ee.x=-e*Math.cos(v+Xt*M)*Math.sin(O+Et*V),ee.y=e*Math.cos(O+Et*V),ee.z=e*Math.sin(v+Xt*M)*Math.sin(O+Et*V),de.push(ee.x,ee.y,ee.z),se.copy(ee).normalize(),be.push(se.x,se.y,se.z),Re.push(Xt+_t,1-Et),ct.push(H++)}Q.push(ct)}for(let Te=0;Te<y;Te++)for(let ct=0;ct<u;ct++){const Et=Q[Te][ct+1],_t=Q[Te][ct],jt=Q[Te+1][ct],Xt=Q[Te+1][ct+1];(Te!==0||O>0)&&ae.push(Et,_t,Xt),(Te!==y-1||G<Math.PI)&&ae.push(_t,jt,Xt)}this.setIndex(ae),this.setAttribute("position",new Un(de,3)),this.setAttribute("normal",new Un(be,3)),this.setAttribute("uv",new Un(Re,2))}static fromJSON(e){return new He(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Qe extends $a{constructor(e=1,u=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,u),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:u}}static fromJSON(e){return new Qe(e.radius,e.detail)}}class nt extends J{constructor(e,u={}){const y=u.font;if(!y||!y.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Pr;const v=y.generateShapes(e,u.size);u.depth=u.height!==void 0?u.height:50,u.bevelThickness===void 0&&(u.bevelThickness=10),u.bevelSize===void 0&&(u.bevelSize=8),u.bevelEnabled===void 0&&(u.bevelEnabled=!1),super(v,u),this.type="TextGeometry"}}class tt extends Pr{constructor(e=1,u=.4,y=8,v=6,M=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:u,radialSegments:y,tubularSegments:v,arc:M},y=Math.floor(y),v=Math.floor(v);const O=[],V=[],G=[],H=[],Q=new re,ee=new re,se=new re;for(let ae=0;ae<=y;ae++)for(let de=0;de<=v;de++){const be=de/v*M,Re=ae/y*Math.PI*2;ee.x=(e+u*Math.cos(Re))*Math.cos(be),ee.y=(e+u*Math.cos(Re))*Math.sin(be),ee.z=u*Math.sin(Re),V.push(ee.x,ee.y,ee.z),Q.x=e*Math.cos(be),Q.y=e*Math.sin(be),se.subVectors(ee,Q).normalize(),G.push(se.x,se.y,se.z),H.push(de/v),H.push(ae/y)}for(let ae=1;ae<=y;ae++)for(let de=1;de<=v;de++){const be=(v+1)*ae+de-1,Re=(v+1)*(ae-1)+de-1,Te=(v+1)*(ae-1)+de,ct=(v+1)*ae+de;O.push(be,Re,ct),O.push(Re,Te,ct)}this.setIndex(O),this.setAttribute("position",new Un(V,3)),this.setAttribute("normal",new Un(G,3)),this.setAttribute("uv",new Un(H,2))}static fromJSON(e){return new tt(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class at extends Pr{constructor(e=1,u=.4,y=64,v=8,M=2,O=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:u,tubularSegments:y,radialSegments:v,p:M,q:O},y=Math.floor(y),v=Math.floor(v);const V=[],G=[],H=[],Q=[],ee=new re,se=new re,ae=new re,de=new re,be=new re,Re=new re,Te=new re;for(let Et=0;Et<=y;++Et){const _t=Et/y*M*Math.PI*2;ct(_t,M,O,e,ae),ct(_t+.01,M,O,e,de),Re.subVectors(de,ae),Te.addVectors(de,ae),be.crossVectors(Re,Te),Te.crossVectors(be,Re),be.normalize(),Te.normalize();for(let jt=0;jt<=v;++jt){const Xt=jt/v*Math.PI*2,_i=-u*Math.cos(Xt),vi=u*Math.sin(Xt);ee.x=ae.x+(_i*Te.x+vi*be.x),ee.y=ae.y+(_i*Te.y+vi*be.y),ee.z=ae.z+(_i*Te.z+vi*be.z),G.push(ee.x,ee.y,ee.z),se.subVectors(ee,ae).normalize(),H.push(se.x,se.y,se.z),Q.push(Et/y),Q.push(jt/v)}}for(let Et=1;Et<=y;Et++)for(let _t=1;_t<=v;_t++){const jt=(v+1)*(Et-1)+(_t-1),Xt=(v+1)*Et+(_t-1),_i=(v+1)*Et+_t,vi=(v+1)*(Et-1)+_t;V.push(jt,Xt,vi),V.push(Xt,_i,vi)}function ct(Et,_t,jt,Xt,_i){const vi=Math.cos(Et),Bi=Math.sin(Et),Li=jt/_t*Et,ki=Math.cos(Li);_i.x=Xt*(2+ki)*.5*vi,_i.y=Xt*(2+ki)*Bi*.5,_i.z=Xt*Math.sin(Li)*.5}this.setIndex(V),this.setAttribute("position",new Un(G,3)),this.setAttribute("normal",new Un(H,3)),this.setAttribute("uv",new Un(Q,2))}static fromJSON(e){return new at(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class wt extends Pr{constructor(e,u=64,y=1,v=8,M=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:u,radius:y,radialSegments:v,closed:M};const O=e.computeFrenetFrames(u,M);this.tangents=O.tangents,this.normals=O.normals,this.binormals=O.binormals;const V=new re,G=new re,H=new en;let Q=new re;const ee=[],se=[],ae=[],de=[];function be(Re){Q=e.getPointAt(Re/u,Q);const Te=O.normals[Re],ct=O.binormals[Re];for(let Et=0;Et<=v;Et++){const _t=Et/v*Math.PI*2,jt=Math.sin(_t),Xt=-Math.cos(_t);G.x=Xt*Te.x+jt*ct.x,G.y=Xt*Te.y+jt*ct.y,G.z=Xt*Te.z+jt*ct.z,G.normalize(),se.push(G.x,G.y,G.z),V.x=Q.x+y*G.x,V.y=Q.y+y*G.y,V.z=Q.z+y*G.z,ee.push(V.x,V.y,V.z)}}(function(){for(let Re=0;Re<u;Re++)be(Re);be(M===!1?u:0),function(){for(let Re=0;Re<=u;Re++)for(let Te=0;Te<=v;Te++)H.x=Re/u,H.y=Te/v,ae.push(H.x,H.y)}(),function(){for(let Re=1;Re<=u;Re++)for(let Te=1;Te<=v;Te++){const ct=(v+1)*(Re-1)+(Te-1),Et=(v+1)*Re+(Te-1),_t=(v+1)*Re+Te,jt=(v+1)*(Re-1)+Te;de.push(ct,Et,jt),de.push(Et,_t,jt)}}()})(),this.setIndex(de),this.setAttribute("position",new Un(ee,3)),this.setAttribute("normal",new Un(se,3)),this.setAttribute("uv",new Un(ae,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new wt(new Ap[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Ot extends Pr{constructor(e){if(super(),this.type="WireframeGeometry",e.isGeometry===!0)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const u=[],y=new Set,v=new re,M=new re;if(e.index!==null){const O=e.attributes.position,V=e.index;let G=e.groups;G.length===0&&(G=[{start:0,count:V.count,materialIndex:0}]);for(let H=0,Q=G.length;H<Q;++H){const ee=G[H],se=ee.start;for(let ae=se,de=se+ee.count;ae<de;ae+=3)for(let be=0;be<3;be++){const Re=V.getX(ae+be),Te=V.getX(ae+(be+1)%3);v.fromBufferAttribute(O,Re),M.fromBufferAttribute(O,Te),Ct(v,M,y)===!0&&(u.push(v.x,v.y,v.z),u.push(M.x,M.y,M.z))}}}else{const O=e.attributes.position;for(let V=0,G=O.count/3;V<G;V++)for(let H=0;H<3;H++){const Q=3*V+H,ee=3*V+(H+1)%3;v.fromBufferAttribute(O,Q),M.fromBufferAttribute(O,ee),Ct(v,M,y)===!0&&(u.push(v.x,v.y,v.z),u.push(M.x,M.y,M.z))}}this.setAttribute("position",new Un(u,3))}}function Ct(S,e,u){const y=`${S.x},${S.y},${S.z}-${e.x},${e.y},${e.z}`,v=`${e.x},${e.y},${e.z}-${S.x},${S.y},${S.z}`;return u.has(y)!==!0&&u.has(v)!==!0&&(u.add(y,v),!0)}var St=Object.freeze({__proto__:null,BoxGeometry:rl,BoxBufferGeometry:rl,CircleGeometry:ku,CircleBufferGeometry:ku,ConeGeometry:Fu,ConeBufferGeometry:Fu,CylinderGeometry:$l,CylinderBufferGeometry:$l,DodecahedronGeometry:Bu,DodecahedronBufferGeometry:Bu,EdgesGeometry:jf,ExtrudeGeometry:J,ExtrudeBufferGeometry:J,IcosahedronGeometry:pe,IcosahedronBufferGeometry:pe,LatheGeometry:ue,LatheBufferGeometry:ue,OctahedronGeometry:_e,OctahedronBufferGeometry:_e,ParametricGeometry:ge,ParametricBufferGeometry:ge,PlaneGeometry:Go,PlaneBufferGeometry:Go,PolyhedronGeometry:$a,PolyhedronBufferGeometry:$a,RingGeometry:Oe,RingBufferGeometry:Oe,ShapeGeometry:Ge,ShapeBufferGeometry:Ge,SphereGeometry:He,SphereBufferGeometry:He,TetrahedronGeometry:Qe,TetrahedronBufferGeometry:Qe,TextGeometry:nt,TextBufferGeometry:nt,TorusGeometry:tt,TorusBufferGeometry:tt,TorusKnotGeometry:at,TorusKnotBufferGeometry:at,TubeGeometry:wt,TubeBufferGeometry:wt,WireframeGeometry:Ot});class si extends Vi{constructor(e){super(),this.type="ShadowMaterial",this.color=new wn(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}si.prototype.isShadowMaterial=!0;class di extends Vi{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new wn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}di.prototype.isMeshStandardMaterial=!0;class Si extends di{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new en(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Fn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(u){this.ior=(1+.4*u)/(1-.4*u)}}),this.sheenTint=new wn(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new wn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new wn(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheenTint.copy(e.sheenTint),this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}Si.prototype.isMeshPhysicalMaterial=!0;class Gi extends Vi{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new wn(16777215),this.specular=new wn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Gi.prototype.isMeshPhongMaterial=!0;class Ki extends Vi{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new wn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Ki.prototype.isMeshToonMaterial=!0;class qt extends Vi{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}qt.prototype.isMeshNormalMaterial=!0;class wi extends Vi{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new wn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}wi.prototype.isMeshLambertMaterial=!0;class hi extends Vi{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new wn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new en(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}hi.prototype.isMeshMatcapMaterial=!0;class Ti extends Po{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Ti.prototype.isLineDashedMaterial=!0;var Ci=Object.freeze({__proto__:null,ShadowMaterial:si,SpriteMaterial:al,RawShaderMaterial:yu,ShaderMaterial:co,PointsMaterial:Al,MeshPhysicalMaterial:Si,MeshStandardMaterial:di,MeshPhongMaterial:Gi,MeshToonMaterial:Ki,MeshNormalMaterial:qt,MeshLambertMaterial:wi,MeshDepthMaterial:md,MeshDistanceMaterial:ua,MeshBasicMaterial:ws,MeshMatcapMaterial:hi,LineDashedMaterial:Ti,LineBasicMaterial:Po,Material:Vi});const gi={arraySlice:function(S,e,u){return gi.isTypedArray(S)?new S.constructor(S.subarray(e,u!==void 0?u:S.length)):S.slice(e,u)},convertArray:function(S,e,u){return!S||!u&&S.constructor===e?S:typeof e.BYTES_PER_ELEMENT=="number"?new e(S):Array.prototype.slice.call(S)},isTypedArray:function(S){return ArrayBuffer.isView(S)&&!(S instanceof DataView)},getKeyframeOrder:function(S){const e=S.length,u=new Array(e);for(let y=0;y!==e;++y)u[y]=y;return u.sort(function(y,v){return S[y]-S[v]}),u},sortedArray:function(S,e,u){const y=S.length,v=new S.constructor(y);for(let M=0,O=0;O!==y;++M){const V=u[M]*e;for(let G=0;G!==e;++G)v[O++]=S[V+G]}return v},flattenJSON:function(S,e,u,y){let v=1,M=S[0];for(;M!==void 0&&M[y]===void 0;)M=S[v++];if(M===void 0)return;let O=M[y];if(O!==void 0)if(Array.isArray(O))do O=M[y],O!==void 0&&(e.push(M.time),u.push.apply(u,O)),M=S[v++];while(M!==void 0);else if(O.toArray!==void 0)do O=M[y],O!==void 0&&(e.push(M.time),O.toArray(u,u.length)),M=S[v++];while(M!==void 0);else do O=M[y],O!==void 0&&(e.push(M.time),u.push(O)),M=S[v++];while(M!==void 0)},subclip:function(S,e,u,y,v=30){const M=S.clone();M.name=e;const O=[];for(let G=0;G<M.tracks.length;++G){const H=M.tracks[G],Q=H.getValueSize(),ee=[],se=[];for(let ae=0;ae<H.times.length;++ae){const de=H.times[ae]*v;if(!(de<u||de>=y)){ee.push(H.times[ae]);for(let be=0;be<Q;++be)se.push(H.values[ae*Q+be])}}ee.length!==0&&(H.times=gi.convertArray(ee,H.times.constructor),H.values=gi.convertArray(se,H.values.constructor),O.push(H))}M.tracks=O;let V=1/0;for(let G=0;G<M.tracks.length;++G)V>M.tracks[G].times[0]&&(V=M.tracks[G].times[0]);for(let G=0;G<M.tracks.length;++G)M.tracks[G].shift(-1*V);return M.resetDuration(),M},makeClipAdditive:function(S,e=0,u=S,y=30){y<=0&&(y=30);const v=u.tracks.length,M=e/y;for(let O=0;O<v;++O){const V=u.tracks[O],G=V.ValueTypeName;if(G==="bool"||G==="string")continue;const H=S.tracks.find(function(Te){return Te.name===V.name&&Te.ValueTypeName===G});if(H===void 0)continue;let Q=0;const ee=V.getValueSize();V.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Q=ee/3);let se=0;const ae=H.getValueSize();H.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(se=ae/3);const de=V.times.length-1;let be;if(M<=V.times[0]){const Te=Q,ct=ee-Q;be=gi.arraySlice(V.values,Te,ct)}else if(M>=V.times[de]){const Te=de*ee+Q,ct=Te+ee-Q;be=gi.arraySlice(V.values,Te,ct)}else{const Te=V.createInterpolant(),ct=Q,Et=ee-Q;Te.evaluate(M),be=gi.arraySlice(Te.resultBuffer,ct,Et)}G==="quaternion"&&new ye().fromArray(be).normalize().conjugate().toArray(be);const Re=H.times.length;for(let Te=0;Te<Re;++Te){const ct=Te*ae+se;if(G==="quaternion")ye.multiplyQuaternionsFlat(H.values,ct,be,0,H.values,ct);else{const Et=ae-2*se;for(let _t=0;_t<Et;++_t)H.values[ct+_t]-=be[_t]}}}return S.blendMode=2501,S}};class Xi{constructor(e,u,y,v){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=v!==void 0?v:new u.constructor(y),this.sampleValues=u,this.valueSize=y,this.settings=null,this.DefaultSettings_={}}evaluate(e){const u=this.parameterPositions;let y=this._cachedIndex,v=u[y],M=u[y-1];e:{t:{let O;i:{n:if(!(e<v)){for(let V=y+2;;){if(v===void 0){if(e<M)break n;return y=u.length,this._cachedIndex=y,this.afterEnd_(y-1,e,M)}if(y===V)break;if(M=v,v=u[++y],e<v)break t}O=u.length;break i}if(e>=M)break e;{const V=u[1];e<V&&(y=2,M=V);for(let G=y-2;;){if(M===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,v);if(y===G)break;if(v=M,M=u[--y-1],e>=M)break t}O=y,y=0}}for(;y<O;){const V=y+O>>>1;e<u[V]?O=V:y=V+1}if(v=u[y],M=u[y-1],M===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,v);if(v===void 0)return y=u.length,this._cachedIndex=y,this.afterEnd_(y-1,M,e)}this._cachedIndex=y,this.intervalChanged_(y,M,v)}return this.interpolate_(y,M,e,v)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const u=this.resultBuffer,y=this.sampleValues,v=this.valueSize,M=e*v;for(let O=0;O!==v;++O)u[O]=y[M+O];return u}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Xi.prototype.beforeStart_=Xi.prototype.copySampleValue_,Xi.prototype.afterEnd_=Xi.prototype.copySampleValue_;class zn extends Xi{constructor(e,u,y,v){super(e,u,y,v),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,u,y){const v=this.parameterPositions;let M=e-2,O=e+1,V=v[M],G=v[O];if(V===void 0)switch(this.getSettings_().endingStart){case 2401:M=e,V=2*u-y;break;case 2402:M=v.length-2,V=u+v[M]-v[M+1];break;default:M=e,V=y}if(G===void 0)switch(this.getSettings_().endingEnd){case 2401:O=e,G=2*y-u;break;case 2402:O=1,G=y+v[1]-v[0];break;default:O=e-1,G=u}const H=.5*(y-u),Q=this.valueSize;this._weightPrev=H/(u-V),this._weightNext=H/(G-y),this._offsetPrev=M*Q,this._offsetNext=O*Q}interpolate_(e,u,y,v){const M=this.resultBuffer,O=this.sampleValues,V=this.valueSize,G=e*V,H=G-V,Q=this._offsetPrev,ee=this._offsetNext,se=this._weightPrev,ae=this._weightNext,de=(y-u)/(v-u),be=de*de,Re=be*de,Te=-se*Re+2*se*be-se*de,ct=(1+se)*Re+(-1.5-2*se)*be+(-.5+se)*de+1,Et=(-1-ae)*Re+(1.5+ae)*be+.5*de,_t=ae*Re-ae*be;for(let jt=0;jt!==V;++jt)M[jt]=Te*O[Q+jt]+ct*O[H+jt]+Et*O[G+jt]+_t*O[ee+jt];return M}}class $n extends Xi{constructor(e,u,y,v){super(e,u,y,v)}interpolate_(e,u,y,v){const M=this.resultBuffer,O=this.sampleValues,V=this.valueSize,G=e*V,H=G-V,Q=(y-u)/(v-u),ee=1-Q;for(let se=0;se!==V;++se)M[se]=O[H+se]*ee+O[G+se]*Q;return M}}class An extends Xi{constructor(e,u,y,v){super(e,u,y,v)}interpolate_(e){return this.copySampleValue_(e-1)}}class kn{constructor(e,u,y,v){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(u===void 0||u.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=gi.convertArray(u,this.TimeBufferType),this.values=gi.convertArray(y,this.ValueBufferType),this.setInterpolation(v||this.DefaultInterpolation)}static toJSON(e){const u=e.constructor;let y;if(u.toJSON!==this.toJSON)y=u.toJSON(e);else{y={name:e.name,times:gi.convertArray(e.times,Array),values:gi.convertArray(e.values,Array)};const v=e.getInterpolation();v!==e.DefaultInterpolation&&(y.interpolation=v)}return y.type=e.ValueTypeName,y}InterpolantFactoryMethodDiscrete(e){return new An(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new $n(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new zn(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let u;switch(e){case 2300:u=this.InterpolantFactoryMethodDiscrete;break;case 2301:u=this.InterpolantFactoryMethodLinear;break;case 2302:u=this.InterpolantFactoryMethodSmooth}if(u===void 0){const y="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(y);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",y),this}return this.createInterpolant=u,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const u=this.times;for(let y=0,v=u.length;y!==v;++y)u[y]+=e}return this}scale(e){if(e!==1){const u=this.times;for(let y=0,v=u.length;y!==v;++y)u[y]*=e}return this}trim(e,u){const y=this.times,v=y.length;let M=0,O=v-1;for(;M!==v&&y[M]<e;)++M;for(;O!==-1&&y[O]>u;)--O;if(++O,M!==0||O!==v){M>=O&&(O=Math.max(O,1),M=O-1);const V=this.getValueSize();this.times=gi.arraySlice(y,M,O),this.values=gi.arraySlice(this.values,M*V,O*V)}return this}validate(){let e=!0;const u=this.getValueSize();u-Math.floor(u)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const y=this.times,v=this.values,M=y.length;M===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let O=null;for(let V=0;V!==M;V++){const G=y[V];if(typeof G=="number"&&isNaN(G)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,V,G),e=!1;break}if(O!==null&&O>G){console.error("THREE.KeyframeTrack: Out of order keys.",this,V,G,O),e=!1;break}O=G}if(v!==void 0&&gi.isTypedArray(v))for(let V=0,G=v.length;V!==G;++V){const H=v[V];if(isNaN(H)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,V,H),e=!1;break}}return e}optimize(){const e=gi.arraySlice(this.times),u=gi.arraySlice(this.values),y=this.getValueSize(),v=this.getInterpolation()===2302,M=e.length-1;let O=1;for(let V=1;V<M;++V){let G=!1;const H=e[V];if(H!==e[V+1]&&(V!==1||H!==e[0]))if(v)G=!0;else{const Q=V*y,ee=Q-y,se=Q+y;for(let ae=0;ae!==y;++ae){const de=u[Q+ae];if(de!==u[ee+ae]||de!==u[se+ae]){G=!0;break}}}if(G){if(V!==O){e[O]=e[V];const Q=V*y,ee=O*y;for(let se=0;se!==y;++se)u[ee+se]=u[Q+se]}++O}}if(M>0){e[O]=e[M];for(let V=M*y,G=O*y,H=0;H!==y;++H)u[G+H]=u[V+H];++O}return O!==e.length?(this.times=gi.arraySlice(e,0,O),this.values=gi.arraySlice(u,0,O*y)):(this.times=e,this.values=u),this}clone(){const e=gi.arraySlice(this.times,0),u=gi.arraySlice(this.values,0),y=new this.constructor(this.name,e,u);return y.createInterpolant=this.createInterpolant,y}}kn.prototype.TimeBufferType=Float32Array,kn.prototype.ValueBufferType=Float32Array,kn.prototype.DefaultInterpolation=2301;class dn extends kn{}dn.prototype.ValueTypeName="bool",dn.prototype.ValueBufferType=Array,dn.prototype.DefaultInterpolation=2300,dn.prototype.InterpolantFactoryMethodLinear=void 0,dn.prototype.InterpolantFactoryMethodSmooth=void 0;class tr extends kn{}tr.prototype.ValueTypeName="color";class dr extends kn{}dr.prototype.ValueTypeName="number";class Nr extends Xi{constructor(e,u,y,v){super(e,u,y,v)}interpolate_(e,u,y,v){const M=this.resultBuffer,O=this.sampleValues,V=this.valueSize,G=(y-u)/(v-u);let H=e*V;for(let Q=H+V;H!==Q;H+=4)ye.slerpFlat(M,0,O,H-V,O,H,G);return M}}class as extends kn{InterpolantFactoryMethodLinear(e){return new Nr(this.times,this.values,this.getValueSize(),e)}}as.prototype.ValueTypeName="quaternion",as.prototype.DefaultInterpolation=2301,as.prototype.InterpolantFactoryMethodSmooth=void 0;class Ur extends kn{}Ur.prototype.ValueTypeName="string",Ur.prototype.ValueBufferType=Array,Ur.prototype.DefaultInterpolation=2300,Ur.prototype.InterpolantFactoryMethodLinear=void 0,Ur.prototype.InterpolantFactoryMethodSmooth=void 0;class vs extends kn{}vs.prototype.ValueTypeName="vector";class Xr{constructor(e,u=-1,y,v=2500){this.name=e,this.tracks=y,this.duration=u,this.blendMode=v,this.uuid=_n(),this.duration<0&&this.resetDuration()}static parse(e){const u=[],y=e.tracks,v=1/(e.fps||1);for(let O=0,V=y.length;O!==V;++O)u.push(Ss(y[O]).scale(v));const M=new this(e.name,e.duration,u,e.blendMode);return M.uuid=e.uuid,M}static toJSON(e){const u=[],y=e.tracks,v={name:e.name,duration:e.duration,tracks:u,uuid:e.uuid,blendMode:e.blendMode};for(let M=0,O=y.length;M!==O;++M)u.push(kn.toJSON(y[M]));return v}static CreateFromMorphTargetSequence(e,u,y,v){const M=u.length,O=[];for(let V=0;V<M;V++){let G=[],H=[];G.push((V+M-1)%M,V,(V+1)%M),H.push(0,1,0);const Q=gi.getKeyframeOrder(G);G=gi.sortedArray(G,1,Q),H=gi.sortedArray(H,1,Q),v||G[0]!==0||(G.push(M),H.push(H[0])),O.push(new dr(".morphTargetInfluences["+u[V].name+"]",G,H).scale(1/y))}return new this(e,-1,O)}static findByName(e,u){let y=e;if(!Array.isArray(e)){const v=e;y=v.geometry&&v.geometry.animations||v.animations}for(let v=0;v<y.length;v++)if(y[v].name===u)return y[v];return null}static CreateClipsFromMorphTargetSequences(e,u,y){const v={},M=/^([\w-]*?)([\d]+)$/;for(let V=0,G=e.length;V<G;V++){const H=e[V],Q=H.name.match(M);if(Q&&Q.length>1){const ee=Q[1];let se=v[ee];se||(v[ee]=se=[]),se.push(H)}}const O=[];for(const V in v)O.push(this.CreateFromMorphTargetSequence(V,v[V],u,y));return O}static parseAnimation(e,u){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const y=function(Q,ee,se,ae,de){if(se.length!==0){const be=[],Re=[];gi.flattenJSON(se,be,Re,ae),be.length!==0&&de.push(new Q(ee,be,Re))}},v=[],M=e.name||"default",O=e.fps||30,V=e.blendMode;let G=e.length||-1;const H=e.hierarchy||[];for(let Q=0;Q<H.length;Q++){const ee=H[Q].keys;if(ee&&ee.length!==0)if(ee[0].morphTargets){const se={};let ae;for(ae=0;ae<ee.length;ae++)if(ee[ae].morphTargets)for(let de=0;de<ee[ae].morphTargets.length;de++)se[ee[ae].morphTargets[de]]=-1;for(const de in se){const be=[],Re=[];for(let Te=0;Te!==ee[ae].morphTargets.length;++Te){const ct=ee[ae];be.push(ct.time),Re.push(ct.morphTarget===de?1:0)}v.push(new dr(".morphTargetInfluence["+de+"]",be,Re))}G=se.length*(O||1)}else{const se=".bones["+u[Q].name+"]";y(vs,se+".position",ee,"pos",v),y(as,se+".quaternion",ee,"rot",v),y(vs,se+".scale",ee,"scl",v)}}return v.length===0?null:new this(M,G,v,V)}resetDuration(){let e=0;for(let u=0,y=this.tracks.length;u!==y;++u){const v=this.tracks[u];e=Math.max(e,v.times[v.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let u=0;u<this.tracks.length;u++)e=e&&this.tracks[u].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let u=0;u<this.tracks.length;u++)e.push(this.tracks[u].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ss(S){if(S.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(u){switch(u.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dr;case"vector":case"vector2":case"vector3":case"vector4":return vs;case"color":return tr;case"quaternion":return as;case"bool":case"boolean":return dn;case"string":return Ur}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+u)}(S.type);if(S.times===void 0){const u=[],y=[];gi.flattenJSON(S.keys,u,y,"value"),S.times=u,S.values=y}return e.parse!==void 0?e.parse(S):new e(S.name,S.times,S.values,S.interpolation)}const br={enabled:!1,files:{},add:function(S,e){this.enabled!==!1&&(this.files[S]=e)},get:function(S){if(this.enabled!==!1)return this.files[S]},remove:function(S){delete this.files[S]},clear:function(){this.files={}}};class ds{constructor(e,u,y){const v=this;let M,O=!1,V=0,G=0;const H=[];this.onStart=void 0,this.onLoad=e,this.onProgress=u,this.onError=y,this.itemStart=function(Q){G++,O===!1&&v.onStart!==void 0&&v.onStart(Q,V,G),O=!0},this.itemEnd=function(Q){V++,v.onProgress!==void 0&&v.onProgress(Q,V,G),V===G&&(O=!1,v.onLoad!==void 0&&v.onLoad())},this.itemError=function(Q){v.onError!==void 0&&v.onError(Q)},this.resolveURL=function(Q){return M?M(Q):Q},this.setURLModifier=function(Q){return M=Q,this},this.addHandler=function(Q,ee){return H.push(Q,ee),this},this.removeHandler=function(Q){const ee=H.indexOf(Q);return ee!==-1&&H.splice(ee,2),this},this.getHandler=function(Q){for(let ee=0,se=H.length;ee<se;ee+=2){const ae=H[ee],de=H[ee+1];if(ae.global&&(ae.lastIndex=0),ae.test(Q))return de}return null}}}const ps=new ds;class Er{constructor(e){this.manager=e!==void 0?e:ps,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,u){const y=this;return new Promise(function(v,M){y.load(e,v,u,M)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const ts={};class Gs extends Er{constructor(e){super(e)}load(e,u,y,v){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const M=this,O=br.get(e);if(O!==void 0)return M.manager.itemStart(e),setTimeout(function(){u&&u(O),M.manager.itemEnd(e)},0),O;if(ts[e]!==void 0)return void ts[e].push({onLoad:u,onProgress:y,onError:v});const V=e.match(/^data:(.*?)(;base64)?,(.*)$/);let G;if(V){const H=V[1],Q=!!V[2];let ee=V[3];ee=decodeURIComponent(ee),Q&&(ee=atob(ee));try{let se;const ae=(this.responseType||"").toLowerCase();switch(ae){case"arraybuffer":case"blob":const de=new Uint8Array(ee.length);for(let Re=0;Re<ee.length;Re++)de[Re]=ee.charCodeAt(Re);se=ae==="blob"?new Blob([de.buffer],{type:H}):de.buffer;break;case"document":se=new DOMParser().parseFromString(ee,H);break;case"json":se=JSON.parse(ee);break;default:se=ee}setTimeout(function(){u&&u(se),M.manager.itemEnd(e)},0)}catch(se){setTimeout(function(){v&&v(se),M.manager.itemError(e),M.manager.itemEnd(e)},0)}}else{ts[e]=[],ts[e].push({onLoad:u,onProgress:y,onError:v}),G=new XMLHttpRequest,G.open("GET",e,!0),G.addEventListener("load",function(H){const Q=this.response,ee=ts[e];if(delete ts[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),br.add(e,Q);for(let se=0,ae=ee.length;se<ae;se++){const de=ee[se];de.onLoad&&de.onLoad(Q)}M.manager.itemEnd(e)}else{for(let se=0,ae=ee.length;se<ae;se++){const de=ee[se];de.onError&&de.onError(H)}M.manager.itemError(e),M.manager.itemEnd(e)}},!1),G.addEventListener("progress",function(H){const Q=ts[e];for(let ee=0,se=Q.length;ee<se;ee++){const ae=Q[ee];ae.onProgress&&ae.onProgress(H)}},!1),G.addEventListener("error",function(H){const Q=ts[e];delete ts[e];for(let ee=0,se=Q.length;ee<se;ee++){const ae=Q[ee];ae.onError&&ae.onError(H)}M.manager.itemError(e),M.manager.itemEnd(e)},!1),G.addEventListener("abort",function(H){const Q=ts[e];delete ts[e];for(let ee=0,se=Q.length;ee<se;ee++){const ae=Q[ee];ae.onError&&ae.onError(H)}M.manager.itemError(e),M.manager.itemEnd(e)},!1),this.responseType!==void 0&&(G.responseType=this.responseType),this.withCredentials!==void 0&&(G.withCredentials=this.withCredentials),G.overrideMimeType&&G.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const H in this.requestHeader)G.setRequestHeader(H,this.requestHeader[H]);G.send(null)}return M.manager.itemStart(e),G}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ra extends Er{constructor(e){super(e)}load(e,u,y,v){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const M=this,O=br.get(e);if(O!==void 0)return M.manager.itemStart(e),setTimeout(function(){u&&u(O),M.manager.itemEnd(e)},0),O;const V=document.createElementNS("http://www.w3.org/1999/xhtml","img");function G(){V.removeEventListener("load",G,!1),V.removeEventListener("error",H,!1),br.add(e,this),u&&u(this),M.manager.itemEnd(e)}function H(Q){V.removeEventListener("load",G,!1),V.removeEventListener("error",H,!1),v&&v(Q),M.manager.itemError(e),M.manager.itemEnd(e)}return V.addEventListener("load",G,!1),V.addEventListener("error",H,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(V.crossOrigin=this.crossOrigin),M.manager.itemStart(e),V.src=e,V}}class Ya extends Er{constructor(e){super(e)}load(e,u,y,v){const M=new Ia,O=new ra(this.manager);O.setCrossOrigin(this.crossOrigin),O.setPath(this.path);let V=0;function G(H){O.load(e[H],function(Q){M.images[H]=Q,V++,V===6&&(M.needsUpdate=!0,u&&u(M))},void 0,v)}for(let H=0;H<e.length;++H)G(H);return M}}class Eo extends Er{constructor(e){super(e)}load(e,u,y,v){const M=this,O=new Ta,V=new Gs(this.manager);return V.setResponseType("arraybuffer"),V.setRequestHeader(this.requestHeader),V.setPath(this.path),V.setWithCredentials(M.withCredentials),V.load(e,function(G){const H=M.parse(G);H&&(H.image!==void 0?O.image=H.image:H.data!==void 0&&(O.image.width=H.width,O.image.height=H.height,O.image.data=H.data),O.wrapS=H.wrapS!==void 0?H.wrapS:1001,O.wrapT=H.wrapT!==void 0?H.wrapT:1001,O.magFilter=H.magFilter!==void 0?H.magFilter:1006,O.minFilter=H.minFilter!==void 0?H.minFilter:1006,O.anisotropy=H.anisotropy!==void 0?H.anisotropy:1,H.encoding!==void 0&&(O.encoding=H.encoding),H.flipY!==void 0&&(O.flipY=H.flipY),H.format!==void 0&&(O.format=H.format),H.type!==void 0&&(O.type=H.type),H.mipmaps!==void 0&&(O.mipmaps=H.mipmaps,O.minFilter=1008),H.mipmapCount===1&&(O.minFilter=1006),H.generateMipmaps!==void 0&&(O.generateMipmaps=H.generateMipmaps),O.needsUpdate=!0,u&&u(O,H))},y,v),O}}class Wr extends Er{constructor(e){super(e)}load(e,u,y,v){const M=new _s,O=new ra(this.manager);return O.setCrossOrigin(this.crossOrigin),O.setPath(this.path),O.load(e,function(V){M.image=V;const G=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;M.format=G?1022:1023,M.needsUpdate=!0,u!==void 0&&u(M)},y,v),M}}class Hr extends Za{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),u=this.curves[this.curves.length-1].getPoint(1);e.equals(u)||this.curves.push(new Qc(u,e))}getPoint(e){const u=e*this.getLength(),y=this.getCurveLengths();let v=0;for(;v<y.length;){if(y[v]>=u){const M=y[v]-u,O=this.curves[v],V=O.getLength(),G=V===0?0:1-M/V;return O.getPointAt(G)}v++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let u=0;for(let y=0,v=this.curves.length;y<v;y++)u+=this.curves[y].getLength(),e.push(u);return this.cacheLengths=e,e}getSpacedPoints(e=40){const u=[];for(let y=0;y<=e;y++)u.push(this.getPoint(y/e));return this.autoClose&&u.push(u[0]),u}getPoints(e=12){const u=[];let y;for(let v=0,M=this.curves;v<M.length;v++){const O=M[v],V=O&&O.isEllipseCurve?2*e:O&&(O.isLineCurve||O.isLineCurve3)?1:O&&O.isSplineCurve?e*O.points.length:e,G=O.getPoints(V);for(let H=0;H<G.length;H++){const Q=G[H];y&&y.equals(Q)||(u.push(Q),y=Q)}}return this.autoClose&&u.length>1&&!u[u.length-1].equals(u[0])&&u.push(u[0]),u}copy(e){super.copy(e),this.curves=[];for(let u=0,y=e.curves.length;u<y;u++){const v=e.curves[u];this.curves.push(v.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let u=0,y=this.curves.length;u<y;u++){const v=this.curves[u];e.curves.push(v.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let u=0,y=e.curves.length;u<y;u++){const v=e.curves[u];this.curves.push(new Ap[v.type]().fromJSON(v))}return this}}class Yr extends Hr{constructor(e){super(),this.type="Path",this.currentPoint=new en,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let u=1,y=e.length;u<y;u++)this.lineTo(e[u].x,e[u].y);return this}moveTo(e,u){return this.currentPoint.set(e,u),this}lineTo(e,u){const y=new Qc(this.currentPoint.clone(),new en(e,u));return this.curves.push(y),this.currentPoint.set(e,u),this}quadraticCurveTo(e,u,y,v){const M=new wd(this.currentPoint.clone(),new en(e,u),new en(y,v));return this.curves.push(M),this.currentPoint.set(y,v),this}bezierCurveTo(e,u,y,v,M,O){const V=new Xa(this.currentPoint.clone(),new en(e,u),new en(y,v),new en(M,O));return this.curves.push(V),this.currentPoint.set(M,O),this}splineThru(e){const u=[this.currentPoint.clone()].concat(e),y=new Ep(u);return this.curves.push(y),this.currentPoint.copy(e[e.length-1]),this}arc(e,u,y,v,M,O){const V=this.currentPoint.x,G=this.currentPoint.y;return this.absarc(e+V,u+G,y,v,M,O),this}absarc(e,u,y,v,M,O){return this.absellipse(e,u,y,y,v,M,O),this}ellipse(e,u,y,v,M,O,V,G){const H=this.currentPoint.x,Q=this.currentPoint.y;return this.absellipse(e+H,u+Q,y,v,M,O,V,G),this}absellipse(e,u,y,v,M,O,V,G){const H=new Js(e,u,y,v,M,O,V,G);if(this.curves.length>0){const ee=H.getPoint(0);ee.equals(this.currentPoint)||this.lineTo(ee.x,ee.y)}this.curves.push(H);const Q=H.getPoint(1);return this.currentPoint.copy(Q),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class is extends Yr{constructor(e){super(e),this.uuid=_n(),this.type="Shape",this.holes=[]}getPointsHoles(e){const u=[];for(let y=0,v=this.holes.length;y<v;y++)u[y]=this.holes[y].getPoints(e);return u}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let u=0,y=e.holes.length;u<y;u++){const v=e.holes[u];this.holes.push(v.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let u=0,y=this.holes.length;u<y;u++){const v=this.holes[u];e.holes.push(v.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let u=0,y=e.holes.length;u<y;u++){const v=e.holes[u];this.holes.push(new Yr().fromJSON(v))}return this}}class Es extends Ee{constructor(e,u=1){super(),this.type="Light",this.color=new wn(e),this.intensity=u}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const u=super.toJSON(e);return u.object.color=this.color.getHex(),u.object.intensity=this.intensity,this.groundColor!==void 0&&(u.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(u.object.distance=this.distance),this.angle!==void 0&&(u.object.angle=this.angle),this.decay!==void 0&&(u.object.decay=this.decay),this.penumbra!==void 0&&(u.object.penumbra=this.penumbra),this.shadow!==void 0&&(u.object.shadow=this.shadow.toJSON()),u}}Es.prototype.isLight=!0;class Os extends Es{constructor(e,u,y){super(e,y),this.type="HemisphereLight",this.position.copy(Ee.DefaultUp),this.updateMatrix(),this.groundColor=new wn(u)}copy(e){return Es.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}Os.prototype.isHemisphereLight=!0;const Do=new nr,Il=new re,Ma=new re;class ha{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new en(512,512),this.map=null,this.mapPass=null,this.matrix=new nr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Fc,this._frameExtents=new en(1,1),this._viewportCount=1,this._viewports=[new Dr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const u=this.camera,y=this.matrix;Il.setFromMatrixPosition(e.matrixWorld),u.position.copy(Il),Ma.setFromMatrixPosition(e.target.matrixWorld),u.lookAt(Ma),u.updateMatrixWorld(),Do.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Do),y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(u.projectionMatrix),y.multiply(u.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Ka extends ha{constructor(){super(new vo(50,1,.5,500)),this.focus=1}updateMatrices(e){const u=this.camera,y=2*cn*e.angle*this.focus,v=this.mapSize.width/this.mapSize.height,M=e.distance||u.far;y===u.fov&&v===u.aspect&&M===u.far||(u.fov=y,u.aspect=v,u.far=M,u.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Ka.prototype.isSpotLightShadow=!0;class Ja extends Es{constructor(e,u,y=0,v=Math.PI/3,M=0,O=1){super(e,u),this.type="SpotLight",this.position.copy(Ee.DefaultUp),this.updateMatrix(),this.target=new Ee,this.distance=y,this.angle=v,this.penumbra=M,this.decay=O,this.shadow=new Ka}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Ja.prototype.isSpotLight=!0;const Sa=new nr,Qa=new re,ka=new re;class ls extends ha{constructor(){super(new vo(90,1,.5,500)),this._frameExtents=new en(4,2),this._viewportCount=6,this._viewports=[new Dr(2,1,1,1),new Dr(0,1,1,1),new Dr(3,1,1,1),new Dr(1,1,1,1),new Dr(3,0,1,1),new Dr(1,0,1,1)],this._cubeDirections=[new re(1,0,0),new re(-1,0,0),new re(0,0,1),new re(0,0,-1),new re(0,1,0),new re(0,-1,0)],this._cubeUps=[new re(0,1,0),new re(0,1,0),new re(0,1,0),new re(0,1,0),new re(0,0,1),new re(0,0,-1)]}updateMatrices(e,u=0){const y=this.camera,v=this.matrix,M=e.distance||y.far;M!==y.far&&(y.far=M,y.updateProjectionMatrix()),Qa.setFromMatrixPosition(e.matrixWorld),y.position.copy(Qa),ka.copy(y.position),ka.add(this._cubeDirections[u]),y.up.copy(this._cubeUps[u]),y.lookAt(ka),y.updateMatrixWorld(),v.makeTranslation(-Qa.x,-Qa.y,-Qa.z),Sa.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sa)}}ls.prototype.isPointLightShadow=!0;class eu extends Es{constructor(e,u,y=0,v=1){super(e,u),this.type="PointLight",this.distance=y,this.decay=v,this.shadow=new ls}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}eu.prototype.isPointLight=!0;class Ip extends ha{constructor(){super(new ih(-5,5,5,-5,.5,500))}}Ip.prototype.isDirectionalLightShadow=!0;class tu extends Es{constructor(e,u){super(e,u),this.type="DirectionalLight",this.position.copy(Ee.DefaultUp),this.updateMatrix(),this.target=new Ee,this.shadow=new Ip}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}tu.prototype.isDirectionalLight=!0;class Td extends Es{constructor(e,u){super(e,u),this.type="AmbientLight"}}Td.prototype.isAmbientLight=!0;class Gu extends Es{constructor(e,u,y=10,v=10){super(e,u),this.type="RectAreaLight",this.width=y,this.height=v}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const u=super.toJSON(e);return u.object.width=this.width,u.object.height=this.height,u}}Gu.prototype.isRectAreaLight=!0;class Kl{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new re)}set(e){for(let u=0;u<9;u++)this.coefficients[u].copy(e[u]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,u){const y=e.x,v=e.y,M=e.z,O=this.coefficients;return u.copy(O[0]).multiplyScalar(.282095),u.addScaledVector(O[1],.488603*v),u.addScaledVector(O[2],.488603*M),u.addScaledVector(O[3],.488603*y),u.addScaledVector(O[4],y*v*1.092548),u.addScaledVector(O[5],v*M*1.092548),u.addScaledVector(O[6],.315392*(3*M*M-1)),u.addScaledVector(O[7],y*M*1.092548),u.addScaledVector(O[8],.546274*(y*y-v*v)),u}getIrradianceAt(e,u){const y=e.x,v=e.y,M=e.z,O=this.coefficients;return u.copy(O[0]).multiplyScalar(.886227),u.addScaledVector(O[1],1.023328*v),u.addScaledVector(O[2],1.023328*M),u.addScaledVector(O[3],1.023328*y),u.addScaledVector(O[4],.858086*y*v),u.addScaledVector(O[5],.858086*v*M),u.addScaledVector(O[6],.743125*M*M-.247708),u.addScaledVector(O[7],.858086*y*M),u.addScaledVector(O[8],.429043*(y*y-v*v)),u}add(e){for(let u=0;u<9;u++)this.coefficients[u].add(e.coefficients[u]);return this}addScaledSH(e,u){for(let y=0;y<9;y++)this.coefficients[y].addScaledVector(e.coefficients[y],u);return this}scale(e){for(let u=0;u<9;u++)this.coefficients[u].multiplyScalar(e);return this}lerp(e,u){for(let y=0;y<9;y++)this.coefficients[y].lerp(e.coefficients[y],u);return this}equals(e){for(let u=0;u<9;u++)if(!this.coefficients[u].equals(e.coefficients[u]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,u=0){const y=this.coefficients;for(let v=0;v<9;v++)y[v].fromArray(e,u+3*v);return this}toArray(e=[],u=0){const y=this.coefficients;for(let v=0;v<9;v++)y[v].toArray(e,u+3*v);return e}static getBasisAt(e,u){const y=e.x,v=e.y,M=e.z;u[0]=.282095,u[1]=.488603*v,u[2]=.488603*M,u[3]=.488603*y,u[4]=1.092548*y*v,u[5]=1.092548*v*M,u[6]=.315392*(3*M*M-1),u[7]=1.092548*y*M,u[8]=.546274*(y*y-v*v)}}Kl.prototype.isSphericalHarmonics3=!0;class Rl extends Es{constructor(e=new Kl,u=1){super(void 0,u),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const u=super.toJSON(e);return u.object.sh=this.sh.toArray(),u}}Rl.prototype.isLightProbe=!0;class L_ extends Er{constructor(e){super(e),this.textures={}}load(e,u,y,v){const M=this,O=new Gs(M.manager);O.setPath(M.path),O.setRequestHeader(M.requestHeader),O.setWithCredentials(M.withCredentials),O.load(e,function(V){try{u(M.parse(JSON.parse(V)))}catch(G){v?v(G):console.error(G),M.manager.itemError(e)}},y,v)}parse(e){const u=this.textures;function y(M){return u[M]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",M),u[M]}const v=new Ci[e.type];if(e.uuid!==void 0&&(v.uuid=e.uuid),e.name!==void 0&&(v.name=e.name),e.color!==void 0&&v.color!==void 0&&v.color.setHex(e.color),e.roughness!==void 0&&(v.roughness=e.roughness),e.metalness!==void 0&&(v.metalness=e.metalness),e.sheenTint!==void 0&&(v.sheenTint=new wn().setHex(e.sheenTint)),e.emissive!==void 0&&v.emissive!==void 0&&v.emissive.setHex(e.emissive),e.specular!==void 0&&v.specular!==void 0&&v.specular.setHex(e.specular),e.specularIntensity!==void 0&&(v.specularIntensity=e.specularIntensity),e.specularTint!==void 0&&v.specularTint!==void 0&&v.specularTint.setHex(e.specularTint),e.shininess!==void 0&&(v.shininess=e.shininess),e.clearcoat!==void 0&&(v.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(v.clearcoatRoughness=e.clearcoatRoughness),e.transmission!==void 0&&(v.transmission=e.transmission),e.thickness!==void 0&&(v.thickness=e.thickness),e.attenuationDistance!==void 0&&(v.attenuationDistance=e.attenuationDistance),e.attenuationTint!==void 0&&v.attenuationTint!==void 0&&v.attenuationTint.setHex(e.attenuationTint),e.fog!==void 0&&(v.fog=e.fog),e.flatShading!==void 0&&(v.flatShading=e.flatShading),e.blending!==void 0&&(v.blending=e.blending),e.combine!==void 0&&(v.combine=e.combine),e.side!==void 0&&(v.side=e.side),e.shadowSide!==void 0&&(v.shadowSide=e.shadowSide),e.opacity!==void 0&&(v.opacity=e.opacity),e.format!==void 0&&(v.format=e.format),e.transparent!==void 0&&(v.transparent=e.transparent),e.alphaTest!==void 0&&(v.alphaTest=e.alphaTest),e.depthTest!==void 0&&(v.depthTest=e.depthTest),e.depthWrite!==void 0&&(v.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(v.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(v.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(v.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(v.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(v.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(v.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(v.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(v.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(v.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(v.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(v.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(v.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(v.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(v.rotation=e.rotation),e.linewidth!==1&&(v.linewidth=e.linewidth),e.dashSize!==void 0&&(v.dashSize=e.dashSize),e.gapSize!==void 0&&(v.gapSize=e.gapSize),e.scale!==void 0&&(v.scale=e.scale),e.polygonOffset!==void 0&&(v.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(v.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(v.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(v.dithering=e.dithering),e.alphaToCoverage!==void 0&&(v.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(v.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(v.visible=e.visible),e.toneMapped!==void 0&&(v.toneMapped=e.toneMapped),e.userData!==void 0&&(v.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?v.vertexColors=e.vertexColors>0:v.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const M in e.uniforms){const O=e.uniforms[M];switch(v.uniforms[M]={},O.type){case"t":v.uniforms[M].value=y(O.value);break;case"c":v.uniforms[M].value=new wn().setHex(O.value);break;case"v2":v.uniforms[M].value=new en().fromArray(O.value);break;case"v3":v.uniforms[M].value=new re().fromArray(O.value);break;case"v4":v.uniforms[M].value=new Dr().fromArray(O.value);break;case"m3":v.uniforms[M].value=new Wn().fromArray(O.value);break;case"m4":v.uniforms[M].value=new nr().fromArray(O.value);break;default:v.uniforms[M].value=O.value}}if(e.defines!==void 0&&(v.defines=e.defines),e.vertexShader!==void 0&&(v.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(v.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(const M in e.extensions)v.extensions[M]=e.extensions[M];if(e.shading!==void 0&&(v.flatShading=e.shading===1),e.size!==void 0&&(v.size=e.size),e.sizeAttenuation!==void 0&&(v.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(v.map=y(e.map)),e.matcap!==void 0&&(v.matcap=y(e.matcap)),e.alphaMap!==void 0&&(v.alphaMap=y(e.alphaMap)),e.bumpMap!==void 0&&(v.bumpMap=y(e.bumpMap)),e.bumpScale!==void 0&&(v.bumpScale=e.bumpScale),e.normalMap!==void 0&&(v.normalMap=y(e.normalMap)),e.normalMapType!==void 0&&(v.normalMapType=e.normalMapType),e.normalScale!==void 0){let M=e.normalScale;Array.isArray(M)===!1&&(M=[M,M]),v.normalScale=new en().fromArray(M)}return e.displacementMap!==void 0&&(v.displacementMap=y(e.displacementMap)),e.displacementScale!==void 0&&(v.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(v.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(v.roughnessMap=y(e.roughnessMap)),e.metalnessMap!==void 0&&(v.metalnessMap=y(e.metalnessMap)),e.emissiveMap!==void 0&&(v.emissiveMap=y(e.emissiveMap)),e.emissiveIntensity!==void 0&&(v.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(v.specularMap=y(e.specularMap)),e.specularIntensityMap!==void 0&&(v.specularIntensityMap=y(e.specularIntensityMap)),e.specularTintMap!==void 0&&(v.specularTintMap=y(e.specularTintMap)),e.envMap!==void 0&&(v.envMap=y(e.envMap)),e.envMapIntensity!==void 0&&(v.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(v.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(v.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(v.lightMap=y(e.lightMap)),e.lightMapIntensity!==void 0&&(v.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(v.aoMap=y(e.aoMap)),e.aoMapIntensity!==void 0&&(v.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(v.gradientMap=y(e.gradientMap)),e.clearcoatMap!==void 0&&(v.clearcoatMap=y(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(v.clearcoatRoughnessMap=y(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(v.clearcoatNormalMap=y(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(v.clearcoatNormalScale=new en().fromArray(e.clearcoatNormalScale)),e.transmissionMap!==void 0&&(v.transmissionMap=y(e.transmissionMap)),e.thicknessMap!==void 0&&(v.thicknessMap=y(e.thicknessMap)),v}setTextures(e){return this.textures=e,this}}class $f{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let u="";for(let y=0,v=e.length;y<v;y++)u+=String.fromCharCode(e[y]);try{return decodeURIComponent(escape(u))}catch{return u}}static extractUrlBase(e){const u=e.lastIndexOf("/");return u===-1?"./":e.substr(0,u+1)}}class Rp extends Pr{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Rp.prototype.isInstancedBufferGeometry=!0;class sg extends Er{constructor(e){super(e)}load(e,u,y,v){const M=this,O=new Gs(M.manager);O.setPath(M.path),O.setRequestHeader(M.requestHeader),O.setWithCredentials(M.withCredentials),O.load(e,function(V){try{u(M.parse(JSON.parse(V)))}catch(G){v?v(G):console.error(G),M.manager.itemError(e)}},y,v)}parse(e){const u={},y={};function v(ee,se){if(u[se]!==void 0)return u[se];const ae=ee.interleavedBuffers[se],de=function(Te,ct){if(y[ct]!==void 0)return y[ct];const Et=Te.arrayBuffers[ct],_t=new Uint32Array(Et).buffer;return y[ct]=_t,_t}(ee,ae.buffer),be=va(ae.type,de),Re=new Wa(be,ae.stride);return Re.uuid=ae.uuid,u[se]=Re,Re}const M=e.isInstancedBufferGeometry?new Rp:new Pr,O=e.data.index;if(O!==void 0){const ee=va(O.type,O.array);M.setIndex(new Or(ee,1))}const V=e.data.attributes;for(const ee in V){const se=V[ee];let ae;if(se.isInterleavedBufferAttribute){const de=v(e.data,se.data);ae=new Sl(de,se.itemSize,se.offset,se.normalized)}else{const de=va(se.type,se.array);ae=new(se.isInstancedBufferAttribute?El:Or)(de,se.itemSize,se.normalized)}se.name!==void 0&&(ae.name=se.name),se.usage!==void 0&&ae.setUsage(se.usage),se.updateRange!==void 0&&(ae.updateRange.offset=se.updateRange.offset,ae.updateRange.count=se.updateRange.count),M.setAttribute(ee,ae)}const G=e.data.morphAttributes;if(G)for(const ee in G){const se=G[ee],ae=[];for(let de=0,be=se.length;de<be;de++){const Re=se[de];let Te;if(Re.isInterleavedBufferAttribute){const ct=v(e.data,Re.data);Te=new Sl(ct,Re.itemSize,Re.offset,Re.normalized)}else{const ct=va(Re.type,Re.array);Te=new Or(ct,Re.itemSize,Re.normalized)}Re.name!==void 0&&(Te.name=Re.name),ae.push(Te)}M.morphAttributes[ee]=ae}e.data.morphTargetsRelative&&(M.morphTargetsRelative=!0);const H=e.data.groups||e.data.drawcalls||e.data.offsets;if(H!==void 0)for(let ee=0,se=H.length;ee!==se;++ee){const ae=H[ee];M.addGroup(ae.start,ae.count,ae.materialIndex)}const Q=e.data.boundingSphere;if(Q!==void 0){const ee=new re;Q.center!==void 0&&ee.fromArray(Q.center),M.boundingSphere=new Ns(ee,Q.radius)}return e.name&&(M.name=e.name),e.userData&&(M.userData=e.userData),M}}const Zf={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Xf={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},I_={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};class Yf extends Er{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,u,y,v){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const M=this,O=br.get(e);if(O!==void 0)return M.manager.itemStart(e),setTimeout(function(){u&&u(O),M.manager.itemEnd(e)},0),O;const V={};V.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",V.headers=this.requestHeader,fetch(e,V).then(function(G){return G.blob()}).then(function(G){return createImageBitmap(G,Object.assign(M.options,{colorSpaceConversion:"none"}))}).then(function(G){br.add(e,G),u&&u(G),M.manager.itemEnd(e)}).catch(function(G){v&&v(G),M.manager.itemError(e),M.manager.itemEnd(e)}),M.manager.itemStart(e)}}Yf.prototype.isImageBitmapLoader=!0;class og{constructor(){this.type="ShapePath",this.color=new wn,this.subPaths=[],this.currentPath=null}moveTo(e,u){return this.currentPath=new Yr,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,u),this}lineTo(e,u){return this.currentPath.lineTo(e,u),this}quadraticCurveTo(e,u,y,v){return this.currentPath.quadraticCurveTo(e,u,y,v),this}bezierCurveTo(e,u,y,v,M,O){return this.currentPath.bezierCurveTo(e,u,y,v,M,O),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,u){function y(ct){const Et=[];for(let _t=0,jt=ct.length;_t<jt;_t++){const Xt=ct[_t],_i=new is;_i.curves=Xt.curves,Et.push(_i)}return Et}function v(ct,Et){const _t=Et.length;let jt=!1;for(let Xt=_t-1,_i=0;_i<_t;Xt=_i++){let vi=Et[Xt],Bi=Et[_i],Li=Bi.x-vi.x,ki=Bi.y-vi.y;if(Math.abs(ki)>Number.EPSILON){if(ki<0&&(vi=Et[_i],Li=-Li,Bi=Et[Xt],ki=-ki),ct.y<vi.y||ct.y>Bi.y)continue;if(ct.y===vi.y){if(ct.x===vi.x)return!0}else{const Zn=ki*(ct.x-vi.x)-Li*(ct.y-vi.y);if(Zn===0)return!0;if(Zn<0)continue;jt=!jt}}else{if(ct.y!==vi.y)continue;if(Bi.x<=ct.x&&ct.x<=vi.x||vi.x<=ct.x&&ct.x<=Bi.x)return!0}}return jt}const M=W.isClockWise,O=this.subPaths;if(O.length===0)return[];if(u===!0)return y(O);let V,G,H;const Q=[];if(O.length===1)return G=O[0],H=new is,H.curves=G.curves,Q.push(H),Q;let ee=!M(O[0].getPoints());ee=e?!ee:ee;const se=[],ae=[];let de,be,Re=[],Te=0;ae[Te]=void 0,Re[Te]=[];for(let ct=0,Et=O.length;ct<Et;ct++)G=O[ct],de=G.getPoints(),V=M(de),V=e?!V:V,V?(!ee&&ae[Te]&&Te++,ae[Te]={s:new is,p:de},ae[Te].s.curves=G.curves,ee&&Te++,Re[Te]=[]):Re[Te].push({h:G,p:de[0]});if(!ae[0])return y(O);if(ae.length>1){let ct=!1;const Et=[];for(let _t=0,jt=ae.length;_t<jt;_t++)se[_t]=[];for(let _t=0,jt=ae.length;_t<jt;_t++){const Xt=Re[_t];for(let _i=0;_i<Xt.length;_i++){const vi=Xt[_i];let Bi=!0;for(let Li=0;Li<ae.length;Li++)v(vi.p,ae[Li].p)&&(_t!==Li&&Et.push({froms:_t,tos:Li,hole:_i}),Bi?(Bi=!1,se[Li].push(vi)):ct=!0);Bi&&se[_t].push(vi)}}Et.length>0&&(ct||(Re=se))}for(let ct=0,Et=ae.length;ct<Et;ct++){H=ae[ct].s,Q.push(H),be=Re[ct];for(let _t=0,jt=be.length;_t<jt;_t++)H.holes.push(be[_t].h)}return Q}}class Kf{constructor(e){this.type="Font",this.data=e}generateShapes(e,u=100){const y=[],v=function(M,O,V){const G=Array.from(M),H=O/V.resolution,Q=(V.boundingBox.yMax-V.boundingBox.yMin+V.underlineThickness)*H,ee=[];let se=0,ae=0;for(let de=0;de<G.length;de++){const be=G[de];if(be===`
`)se=0,ae-=Q;else{const Re=hy(be,H,se,ae,V);se+=Re.offsetX,ee.push(Re.path)}}return ee}(e,u,this.data);for(let M=0,O=v.length;M<O;M++)Array.prototype.push.apply(y,v[M].toShapes());return y}}function hy(S,e,u,y,v){const M=v.glyphs[S]||v.glyphs["?"];if(!M)return void console.error('THREE.Font: character "'+S+'" does not exists in font family '+v.familyName+".");const O=new og;let V,G,H,Q,ee,se,ae,de;if(M.o){const be=M._cachedOutline||(M._cachedOutline=M.o.split(" "));for(let Re=0,Te=be.length;Re<Te;)switch(be[Re++]){case"m":V=be[Re++]*e+u,G=be[Re++]*e+y,O.moveTo(V,G);break;case"l":V=be[Re++]*e+u,G=be[Re++]*e+y,O.lineTo(V,G);break;case"q":H=be[Re++]*e+u,Q=be[Re++]*e+y,ee=be[Re++]*e+u,se=be[Re++]*e+y,O.quadraticCurveTo(ee,se,H,Q);break;case"b":H=be[Re++]*e+u,Q=be[Re++]*e+y,ee=be[Re++]*e+u,se=be[Re++]*e+y,ae=be[Re++]*e+u,de=be[Re++]*e+y,O.bezierCurveTo(ee,se,ae,de,H,Q)}}return{offsetX:M.ha*e,path:O}}Kf.prototype.isFont=!0;let Jf;const iu={getContext:function(){return Jf===void 0&&(Jf=new(window.AudioContext||window.webkitAudioContext)),Jf},setContext:function(S){Jf=S}};class R_ extends Er{constructor(e){super(e)}load(e,u,y,v){const M=this,O=new Gs(this.manager);O.setResponseType("arraybuffer"),O.setPath(this.path),O.setRequestHeader(this.requestHeader),O.setWithCredentials(this.withCredentials),O.load(e,function(V){try{const G=V.slice(0);iu.getContext().decodeAudioData(G,function(H){u(H)})}catch(G){v?v(G):console.error(G),M.manager.itemError(e)}},y,v)}}class ag extends Rl{constructor(e,u,y=1){super(void 0,y);const v=new wn().set(e),M=new wn().set(u),O=new re(v.r,v.g,v.b),V=new re(M.r,M.g,M.b),G=Math.sqrt(Math.PI),H=G*Math.sqrt(.75);this.sh.coefficients[0].copy(O).add(V).multiplyScalar(G),this.sh.coefficients[1].copy(O).sub(V).multiplyScalar(H)}}ag.prototype.isHemisphereLightProbe=!0;class P_ extends Rl{constructor(e,u=1){super(void 0,u);const y=new wn().set(e);this.sh.coefficients[0].set(y.r,y.g,y.b).multiplyScalar(2*Math.sqrt(Math.PI))}}P_.prototype.isAmbientLightProbe=!0;const dy=new nr,py=new nr;class fy{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=D_(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const u=D_();e=(u-this.oldTime)/1e3,this.oldTime=u,this.elapsedTime+=e}return e}}function D_(){return(typeof performance>"u"?Date:performance).now()}const Ih=new re,my=new ye,gy=new re,Md=new re;class O_ extends Ee{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const u=this.context.createBufferSource();return u.buffer=this.buffer,u.loop=this.loop,u.loopStart=this.loopStart,u.loopEnd=this.loopEnd,u.onended=this.onEnded.bind(this),u.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=u,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,u=this.filters.length;e<u;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,u=this.filters.length;e<u;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Rh=new re,z_=new ye,_y=new re,Ph=new re;class k_{constructor(e,u=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=u,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const u=this.getFrequencyData();for(let y=0;y<u.length;y++)e+=u[y];return e/u.length}}class F_{constructor(e,u,y){let v,M,O;switch(this.binding=e,this.valueSize=y,u){case"quaternion":v=this._slerp,M=this._slerpAdditive,O=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*y),this._workIndex=5;break;case"string":case"bool":v=this._select,M=this._select,O=this._setAdditiveIdentityOther,this.buffer=new Array(5*y);break;default:v=this._lerp,M=this._lerpAdditive,O=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*y)}this._mixBufferRegion=v,this._mixBufferRegionAdditive=M,this._setIdentity=O,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,u){const y=this.buffer,v=this.valueSize,M=e*v+v;let O=this.cumulativeWeight;if(O===0){for(let V=0;V!==v;++V)y[M+V]=y[V];O=u}else{O+=u;const V=u/O;this._mixBufferRegion(y,M,0,V,v)}this.cumulativeWeight=O}accumulateAdditive(e){const u=this.buffer,y=this.valueSize,v=y*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(u,v,0,e,y),this.cumulativeWeightAdditive+=e}apply(e){const u=this.valueSize,y=this.buffer,v=e*u+u,M=this.cumulativeWeight,O=this.cumulativeWeightAdditive,V=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,M<1){const G=u*this._origIndex;this._mixBufferRegion(y,v,G,1-M,u)}O>0&&this._mixBufferRegionAdditive(y,v,this._addIndex*u,1,u);for(let G=u,H=u+u;G!==H;++G)if(y[G]!==y[G+u]){V.setValue(y,v);break}}saveOriginalState(){const e=this.binding,u=this.buffer,y=this.valueSize,v=y*this._origIndex;e.getValue(u,v);for(let M=y,O=v;M!==O;++M)u[M]=u[v+M%y];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,u=e+this.valueSize;for(let y=e;y<u;y++)this.buffer[y]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,u=this._addIndex*this.valueSize;for(let y=0;y<this.valueSize;y++)this.buffer[u+y]=this.buffer[e+y]}_select(e,u,y,v,M){if(v>=.5)for(let O=0;O!==M;++O)e[u+O]=e[y+O]}_slerp(e,u,y,v){ye.slerpFlat(e,u,e,u,e,y,v)}_slerpAdditive(e,u,y,v,M){const O=this._workIndex*M;ye.multiplyQuaternionsFlat(e,O,e,u,e,y),ye.slerpFlat(e,u,e,u,e,O,v)}_lerp(e,u,y,v,M){const O=1-v;for(let V=0;V!==M;++V){const G=u+V;e[G]=e[G]*O+e[y+V]*v}}_lerpAdditive(e,u,y,v,M){for(let O=0;O!==M;++O){const V=u+O;e[V]=e[V]+e[y+O]*v}}}const yy="\\[\\]\\.:\\/",B_=new RegExp("[\\[\\]\\.:\\/]","g"),nu="[^\\[\\]\\.:\\/]",Ea="[^"+yy.replace("\\.","")+"]",vy=/((?:WC+[\/:])*)/.source.replace("WC",nu),Qf=/(WCOD+)?/.source.replace("WCOD",Ea),Sx=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",nu),Ex=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",nu),em=new RegExp("^"+vy+Qf+Sx+Ex+"$"),xy=["material","materials","bones"];class Ms{constructor(e,u,y){this.path=u,this.parsedPath=y||Ms.parseTrackName(u),this.node=Ms.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,u,y){return e&&e.isAnimationObjectGroup?new Ms.Composite(e,u,y):new Ms(e,u,y)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(B_,"")}static parseTrackName(e){const u=em.exec(e);if(!u)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const y={nodeName:u[2],objectName:u[3],objectIndex:u[4],propertyName:u[5],propertyIndex:u[6]},v=y.nodeName&&y.nodeName.lastIndexOf(".");if(v!==void 0&&v!==-1){const M=y.nodeName.substring(v+1);xy.indexOf(M)!==-1&&(y.nodeName=y.nodeName.substring(0,v),y.objectName=M)}if(y.propertyName===null||y.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return y}static findNode(e,u){if(!u||u===""||u==="."||u===-1||u===e.name||u===e.uuid)return e;if(e.skeleton){const y=e.skeleton.getBoneByName(u);if(y!==void 0)return y}if(e.children){const y=function(M){for(let O=0;O<M.length;O++){const V=M[O];if(V.name===u||V.uuid===u)return V;const G=y(V.children);if(G)return G}return null},v=y(e.children);if(v)return v}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,u){e[u]=this.targetObject[this.propertyName]}_getValue_array(e,u){const y=this.resolvedProperty;for(let v=0,M=y.length;v!==M;++v)e[u++]=y[v]}_getValue_arrayElement(e,u){e[u]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,u){this.resolvedProperty.toArray(e,u)}_setValue_direct(e,u){this.targetObject[this.propertyName]=e[u]}_setValue_direct_setNeedsUpdate(e,u){this.targetObject[this.propertyName]=e[u],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,u){this.targetObject[this.propertyName]=e[u],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,u){const y=this.resolvedProperty;for(let v=0,M=y.length;v!==M;++v)y[v]=e[u++]}_setValue_array_setNeedsUpdate(e,u){const y=this.resolvedProperty;for(let v=0,M=y.length;v!==M;++v)y[v]=e[u++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,u){const y=this.resolvedProperty;for(let v=0,M=y.length;v!==M;++v)y[v]=e[u++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,u){this.resolvedProperty[this.propertyIndex]=e[u]}_setValue_arrayElement_setNeedsUpdate(e,u){this.resolvedProperty[this.propertyIndex]=e[u],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,u){this.resolvedProperty[this.propertyIndex]=e[u],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,u){this.resolvedProperty.fromArray(e,u)}_setValue_fromArray_setNeedsUpdate(e,u){this.resolvedProperty.fromArray(e,u),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,u){this.resolvedProperty.fromArray(e,u),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,u){this.bind(),this.getValue(e,u)}_setValue_unbound(e,u){this.bind(),this.setValue(e,u)}bind(){let e=this.node;const u=this.parsedPath,y=u.objectName,v=u.propertyName;let M=u.propertyIndex;if(e||(e=Ms.findNode(this.rootNode,u.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(y){let H=u.objectIndex;switch(y){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let Q=0;Q<e.length;Q++)if(e[Q].name===H){H=Q;break}break;default:if(e[y]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[y]}if(H!==void 0){if(e[H]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[H]}}const O=e[v];if(O===void 0){const H=u.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+H+"."+v+" but it wasn't found.",e)}let V=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?V=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(V=this.Versioning.MatrixWorldNeedsUpdate);let G=this.BindingType.Direct;if(M!==void 0){if(v==="morphTargetInfluences"){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);e.morphTargetDictionary[M]!==void 0&&(M=e.morphTargetDictionary[M])}G=this.BindingType.ArrayElement,this.resolvedProperty=O,this.propertyIndex=M}else O.fromArray!==void 0&&O.toArray!==void 0?(G=this.BindingType.HasFromToArray,this.resolvedProperty=O):Array.isArray(O)?(G=this.BindingType.EntireArray,this.resolvedProperty=O):this.propertyName=v;this.getValue=this.GetterByBindingType[G],this.setValue=this.SetterByBindingTypeAndVersioning[G][V]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ms.Composite=class{constructor(S,e,u){const y=u||Ms.parseTrackName(e);this._targetGroup=S,this._bindings=S.subscribe_(e,y)}getValue(S,e){this.bind();const u=this._targetGroup.nCachedObjects_,y=this._bindings[u];y!==void 0&&y.getValue(S,e)}setValue(S,e){const u=this._bindings;for(let y=this._targetGroup.nCachedObjects_,v=u.length;y!==v;++y)u[y].setValue(S,e)}bind(){const S=this._bindings;for(let e=this._targetGroup.nCachedObjects_,u=S.length;e!==u;++e)S[e].bind()}unbind(){const S=this._bindings;for(let e=this._targetGroup.nCachedObjects_,u=S.length;e!==u;++e)S[e].unbind()}},Ms.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ms.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ms.prototype.GetterByBindingType=[Ms.prototype._getValue_direct,Ms.prototype._getValue_array,Ms.prototype._getValue_arrayElement,Ms.prototype._getValue_toArray],Ms.prototype.SetterByBindingTypeAndVersioning=[[Ms.prototype._setValue_direct,Ms.prototype._setValue_direct_setNeedsUpdate,Ms.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ms.prototype._setValue_array,Ms.prototype._setValue_array_setNeedsUpdate,Ms.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ms.prototype._setValue_arrayElement,Ms.prototype._setValue_arrayElement_setNeedsUpdate,Ms.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ms.prototype._setValue_fromArray,Ms.prototype._setValue_fromArray_setNeedsUpdate,Ms.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Pp{constructor(){this.uuid=_n(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let y=0,v=arguments.length;y!==v;++y)e[arguments[y].uuid]=y;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const u=this;this.stats={objects:{get total(){return u._objects.length},get inUse(){return this.total-u.nCachedObjects_}},get bindingsPerObject(){return u._bindings.length}}}add(){const e=this._objects,u=this._indicesByUUID,y=this._paths,v=this._parsedPaths,M=this._bindings,O=M.length;let V,G=e.length,H=this.nCachedObjects_;for(let Q=0,ee=arguments.length;Q!==ee;++Q){const se=arguments[Q],ae=se.uuid;let de=u[ae];if(de===void 0){de=G++,u[ae]=de,e.push(se);for(let be=0,Re=O;be!==Re;++be)M[be].push(new Ms(se,y[be],v[be]))}else if(de<H){V=e[de];const be=--H,Re=e[be];u[Re.uuid]=de,e[de]=Re,u[ae]=be,e[be]=se;for(let Te=0,ct=O;Te!==ct;++Te){const Et=M[Te],_t=Et[be];let jt=Et[de];Et[de]=_t,jt===void 0&&(jt=new Ms(se,y[Te],v[Te])),Et[be]=jt}}else e[de]!==V&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=H}remove(){const e=this._objects,u=this._indicesByUUID,y=this._bindings,v=y.length;let M=this.nCachedObjects_;for(let O=0,V=arguments.length;O!==V;++O){const G=arguments[O],H=G.uuid,Q=u[H];if(Q!==void 0&&Q>=M){const ee=M++,se=e[ee];u[se.uuid]=Q,e[Q]=se,u[H]=ee,e[ee]=G;for(let ae=0,de=v;ae!==de;++ae){const be=y[ae],Re=be[ee],Te=be[Q];be[Q]=Re,be[ee]=Te}}}this.nCachedObjects_=M}uncache(){const e=this._objects,u=this._indicesByUUID,y=this._bindings,v=y.length;let M=this.nCachedObjects_,O=e.length;for(let V=0,G=arguments.length;V!==G;++V){const H=arguments[V].uuid,Q=u[H];if(Q!==void 0)if(delete u[H],Q<M){const ee=--M,se=e[ee],ae=--O,de=e[ae];u[se.uuid]=Q,e[Q]=se,u[de.uuid]=ee,e[ee]=de,e.pop();for(let be=0,Re=v;be!==Re;++be){const Te=y[be],ct=Te[ee],Et=Te[ae];Te[Q]=ct,Te[ee]=Et,Te.pop()}}else{const ee=--O,se=e[ee];ee>0&&(u[se.uuid]=Q),e[Q]=se,e.pop();for(let ae=0,de=v;ae!==de;++ae){const be=y[ae];be[Q]=be[ee],be.pop()}}}this.nCachedObjects_=M}subscribe_(e,u){const y=this._bindingsIndicesByPath;let v=y[e];const M=this._bindings;if(v!==void 0)return M[v];const O=this._paths,V=this._parsedPaths,G=this._objects,H=G.length,Q=this.nCachedObjects_,ee=new Array(H);v=M.length,y[e]=v,O.push(e),V.push(u),M.push(ee);for(let se=Q,ae=G.length;se!==ae;++se){const de=G[se];ee[se]=new Ms(de,e,u)}return ee}unsubscribe_(e){const u=this._bindingsIndicesByPath,y=u[e];if(y!==void 0){const v=this._paths,M=this._parsedPaths,O=this._bindings,V=O.length-1,G=O[V];u[e[V]]=y,O[y]=G,O.pop(),M[y]=M[V],M.pop(),v[y]=v[V],v.pop()}}}Pp.prototype.isAnimationObjectGroup=!0;class Ax{constructor(e,u,y=null,v=u.blendMode){this._mixer=e,this._clip=u,this._localRoot=y,this.blendMode=v;const M=u.tracks,O=M.length,V=new Array(O),G={endingStart:2400,endingEnd:2400};for(let H=0;H!==O;++H){const Q=M[H].createInterpolant(null);V[H]=Q,Q.settings=G}this._interpolantSettings=G,this._interpolants=V,this._propertyBindings=new Array(O),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,u){return this.loop=e,this.repetitions=u,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,u,y){if(e.fadeOut(u),this.fadeIn(u),y){const v=this._clip.duration,M=e._clip.duration,O=M/v,V=v/M;e.warp(1,O,u),this.warp(V,1,u)}return this}crossFadeTo(e,u,y){return e.crossFadeFrom(this,u,y)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,u,y){const v=this._mixer,M=v.time,O=this.timeScale;let V=this._timeScaleInterpolant;V===null&&(V=v._lendControlInterpolant(),this._timeScaleInterpolant=V);const G=V.parameterPositions,H=V.sampleValues;return G[0]=M,G[1]=M+y,H[0]=e/O,H[1]=u/O,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,u,y,v){if(!this.enabled)return void this._updateWeight(e);const M=this._startTime;if(M!==null){const G=(e-M)*y;if(G<0||y===0)return;this._startTime=null,u=y*G}u*=this._updateTimeScale(e);const O=this._updateTime(u),V=this._updateWeight(e);if(V>0){const G=this._interpolants,H=this._propertyBindings;switch(this.blendMode){case 2501:for(let Q=0,ee=G.length;Q!==ee;++Q)G[Q].evaluate(O),H[Q].accumulateAdditive(V);break;case 2500:default:for(let Q=0,ee=G.length;Q!==ee;++Q)G[Q].evaluate(O),H[Q].accumulate(v,V)}}}_updateWeight(e){let u=0;if(this.enabled){u=this.weight;const y=this._weightInterpolant;if(y!==null){const v=y.evaluate(e)[0];u*=v,e>y.parameterPositions[1]&&(this.stopFading(),v===0&&(this.enabled=!1))}}return this._effectiveWeight=u,u}_updateTimeScale(e){let u=0;if(!this.paused){u=this.timeScale;const y=this._timeScaleInterpolant;y!==null&&(u*=y.evaluate(e)[0],e>y.parameterPositions[1]&&(this.stopWarping(),u===0?this.paused=!0:this.timeScale=u))}return this._effectiveTimeScale=u,u}_updateTime(e){const u=this._clip.duration,y=this.loop;let v=this.time+e,M=this._loopCount;const O=y===2202;if(e===0)return M===-1?v:O&&(1&M)==1?u-v:v;if(y===2200){M===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(v>=u)v=u;else{if(!(v<0)){this.time=v;break e}v=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=v,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(M===-1&&(e>=0?(M=0,this._setEndings(!0,this.repetitions===0,O)):this._setEndings(this.repetitions===0,!0,O)),v>=u||v<0){const V=Math.floor(v/u);v-=u*V,M+=Math.abs(V);const G=this.repetitions-M;if(G<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,v=e>0?u:0,this.time=v,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(G===1){const H=e<0;this._setEndings(H,!H,O)}else this._setEndings(!1,!1,O);this._loopCount=M,this.time=v,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:V})}}else this.time=v;if(O&&(1&M)==1)return u-v}return v}_setEndings(e,u,y){const v=this._interpolantSettings;y?(v.endingStart=2401,v.endingEnd=2401):(v.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,v.endingEnd=u?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,u,y){const v=this._mixer,M=v.time;let O=this._weightInterpolant;O===null&&(O=v._lendControlInterpolant(),this._weightInterpolant=O);const V=O.parameterPositions,G=O.sampleValues;return V[0]=M,G[0]=u,V[1]=M+e,G[1]=y,this}}class by extends It{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,u){const y=e._localRoot||this._root,v=e._clip.tracks,M=v.length,O=e._propertyBindings,V=e._interpolants,G=y.uuid,H=this._bindingsByRootAndName;let Q=H[G];Q===void 0&&(Q={},H[G]=Q);for(let ee=0;ee!==M;++ee){const se=v[ee],ae=se.name;let de=Q[ae];if(de!==void 0)O[ee]=de;else{if(de=O[ee],de!==void 0){de._cacheIndex===null&&(++de.referenceCount,this._addInactiveBinding(de,G,ae));continue}const be=u&&u._propertyBindings[ee].binding.parsedPath;de=new F_(Ms.create(y,ae,be),se.ValueTypeName,se.getValueSize()),++de.referenceCount,this._addInactiveBinding(de,G,ae),O[ee]=de}V[ee].resultBuffer=de.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const y=(e._localRoot||this._root).uuid,v=e._clip.uuid,M=this._actionsByClip[v];this._bindAction(e,M&&M.knownActions[0]),this._addInactiveAction(e,v,y)}const u=e._propertyBindings;for(let y=0,v=u.length;y!==v;++y){const M=u[y];M.useCount++==0&&(this._lendBinding(M),M.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const u=e._propertyBindings;for(let y=0,v=u.length;y!==v;++y){const M=u[y];--M.useCount==0&&(M.restoreOriginalState(),this._takeBackBinding(M))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const u=e._cacheIndex;return u!==null&&u<this._nActiveActions}_addInactiveAction(e,u,y){const v=this._actions,M=this._actionsByClip;let O=M[u];if(O===void 0)O={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,M[u]=O;else{const V=O.knownActions;e._byClipCacheIndex=V.length,V.push(e)}e._cacheIndex=v.length,v.push(e),O.actionByRoot[y]=e}_removeInactiveAction(e){const u=this._actions,y=u[u.length-1],v=e._cacheIndex;y._cacheIndex=v,u[v]=y,u.pop(),e._cacheIndex=null;const M=e._clip.uuid,O=this._actionsByClip,V=O[M],G=V.knownActions,H=G[G.length-1],Q=e._byClipCacheIndex;H._byClipCacheIndex=Q,G[Q]=H,G.pop(),e._byClipCacheIndex=null,delete V.actionByRoot[(e._localRoot||this._root).uuid],G.length===0&&delete O[M],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const u=e._propertyBindings;for(let y=0,v=u.length;y!==v;++y){const M=u[y];--M.referenceCount==0&&this._removeInactiveBinding(M)}}_lendAction(e){const u=this._actions,y=e._cacheIndex,v=this._nActiveActions++,M=u[v];e._cacheIndex=v,u[v]=e,M._cacheIndex=y,u[y]=M}_takeBackAction(e){const u=this._actions,y=e._cacheIndex,v=--this._nActiveActions,M=u[v];e._cacheIndex=v,u[v]=e,M._cacheIndex=y,u[y]=M}_addInactiveBinding(e,u,y){const v=this._bindingsByRootAndName,M=this._bindings;let O=v[u];O===void 0&&(O={},v[u]=O),O[y]=e,e._cacheIndex=M.length,M.push(e)}_removeInactiveBinding(e){const u=this._bindings,y=e.binding,v=y.rootNode.uuid,M=y.path,O=this._bindingsByRootAndName,V=O[v],G=u[u.length-1],H=e._cacheIndex;G._cacheIndex=H,u[H]=G,u.pop(),delete V[M],Object.keys(V).length===0&&delete O[v]}_lendBinding(e){const u=this._bindings,y=e._cacheIndex,v=this._nActiveBindings++,M=u[v];e._cacheIndex=v,u[v]=e,M._cacheIndex=y,u[y]=M}_takeBackBinding(e){const u=this._bindings,y=e._cacheIndex,v=--this._nActiveBindings,M=u[v];e._cacheIndex=v,u[v]=e,M._cacheIndex=y,u[y]=M}_lendControlInterpolant(){const e=this._controlInterpolants,u=this._nActiveControlInterpolants++;let y=e[u];return y===void 0&&(y=new $n(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),y.__cacheIndex=u,e[u]=y),y}_takeBackControlInterpolant(e){const u=this._controlInterpolants,y=e.__cacheIndex,v=--this._nActiveControlInterpolants,M=u[v];e.__cacheIndex=v,u[v]=e,M.__cacheIndex=y,u[y]=M}clipAction(e,u,y){const v=u||this._root,M=v.uuid;let O=typeof e=="string"?Xr.findByName(v,e):e;const V=O!==null?O.uuid:e,G=this._actionsByClip[V];let H=null;if(y===void 0&&(y=O!==null?O.blendMode:2500),G!==void 0){const ee=G.actionByRoot[M];if(ee!==void 0&&ee.blendMode===y)return ee;H=G.knownActions[0],O===null&&(O=H._clip)}if(O===null)return null;const Q=new Ax(this,O,u,y);return this._bindAction(Q,H),this._addInactiveAction(Q,V,M),Q}existingAction(e,u){const y=u||this._root,v=y.uuid,M=typeof e=="string"?Xr.findByName(y,e):e,O=M?M.uuid:e,V=this._actionsByClip[O];return V!==void 0&&V.actionByRoot[v]||null}stopAllAction(){const e=this._actions;for(let u=this._nActiveActions-1;u>=0;--u)e[u].stop();return this}update(e){e*=this.timeScale;const u=this._actions,y=this._nActiveActions,v=this.time+=e,M=Math.sign(e),O=this._accuIndex^=1;for(let H=0;H!==y;++H)u[H]._update(v,e,M,O);const V=this._bindings,G=this._nActiveBindings;for(let H=0;H!==G;++H)V[H].apply(O);return this}setTime(e){this.time=0;for(let u=0;u<this._actions.length;u++)this._actions[u].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const u=this._actions,y=e.uuid,v=this._actionsByClip,M=v[y];if(M!==void 0){const O=M.knownActions;for(let V=0,G=O.length;V!==G;++V){const H=O[V];this._deactivateAction(H);const Q=H._cacheIndex,ee=u[u.length-1];H._cacheIndex=null,H._byClipCacheIndex=null,ee._cacheIndex=Q,u[Q]=ee,u.pop(),this._removeInactiveBindingsForAction(H)}delete v[y]}}uncacheRoot(e){const u=e.uuid,y=this._actionsByClip;for(const M in y){const O=y[M].actionByRoot[u];O!==void 0&&(this._deactivateAction(O),this._removeInactiveAction(O))}const v=this._bindingsByRootAndName[u];if(v!==void 0)for(const M in v){const O=v[M];O.restoreOriginalState(),this._removeInactiveBinding(O)}}uncacheAction(e,u){const y=this.existingAction(e,u);y!==null&&(this._deactivateAction(y),this._removeInactiveAction(y))}}by.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class lg{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new lg(this.value.clone===void 0?this.value:this.value.clone())}}class wy extends Wa{constructor(e,u,y=1){super(e,u),this.meshPerAttribute=y}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const u=super.clone(e);return u.meshPerAttribute=this.meshPerAttribute,u}toJSON(e){const u=super.toJSON(e);return u.isInstancedInterleavedBuffer=!0,u.meshPerAttribute=this.meshPerAttribute,u}}wy.prototype.isInstancedInterleavedBuffer=!0;class Ty{constructor(e,u,y,v,M){this.buffer=e,this.type=u,this.itemSize=y,this.elementSize=v,this.count=M,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,u){return this.type=e,this.elementSize=u,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Ty.prototype.isGLBufferAttribute=!0;function My(S,e){return S.distance-e.distance}function N_(S,e,u,y){if(S.layers.test(e.layers)&&S.raycast(e,u),y===!0){const v=S.children;for(let M=0,O=v.length;M<O;M++)N_(v[M],e,u,!0)}}const cg=new en;class Dp{constructor(e=new en(1/0,1/0),u=new en(-1/0,-1/0)){this.min=e,this.max=u}set(e,u){return this.min.copy(e),this.max.copy(u),this}setFromPoints(e){this.makeEmpty();for(let u=0,y=e.length;u<y;u++)this.expandByPoint(e[u]);return this}setFromCenterAndSize(e,u){const y=cg.copy(u).multiplyScalar(.5);return this.min.copy(e).sub(y),this.max.copy(e).add(y),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,u){return u.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,u){return u.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return cg.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Dp.prototype.isBox2=!0;const Sd=new re,ug=new re;class Ao{constructor(e=new re,u=new re){this.start=e,this.end=u}set(e,u){return this.start.copy(e),this.end.copy(u),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,u){return this.delta(u).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,u){Sd.subVectors(e,this.start),ug.subVectors(this.end,this.start);const y=ug.dot(ug);let v=ug.dot(Sd)/y;return u&&(v=Fn(v,0,1)),v}closestPointToPoint(e,u,y){const v=this.closestPointToPointParameter(e,u);return this.delta(y).multiplyScalar(v).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}class tm extends Ee{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}tm.prototype.isImmediateRenderObject=!0;const U_=new re,mc=new re,Ed=new nr,Ad=new nr;class V_ extends ia{constructor(e){const u=G_(e),y=new Pr,v=[],M=[],O=new wn(0,0,1),V=new wn(0,1,0);for(let G=0;G<u.length;G++){const H=u[G];H.parent&&H.parent.isBone&&(v.push(0,0,0),v.push(0,0,0),M.push(O.r,O.g,O.b),M.push(V.r,V.g,V.b))}y.setAttribute("position",new Un(v,3)),y.setAttribute("color",new Un(M,3)),super(y,new Po({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=u,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const u=this.bones,y=this.geometry,v=y.getAttribute("position");Ad.copy(this.root.matrixWorld).invert();for(let M=0,O=0;M<u.length;M++){const V=u[M];V.parent&&V.parent.isBone&&(Ed.multiplyMatrices(Ad,V.matrixWorld),mc.setFromMatrixPosition(Ed),v.setXYZ(O,mc.x,mc.y,mc.z),Ed.multiplyMatrices(Ad,V.parent.matrixWorld),mc.setFromMatrixPosition(Ed),v.setXYZ(O+1,mc.x,mc.y,mc.z),O+=2)}y.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function G_(S){const e=[];S&&S.isBone&&e.push(S);for(let u=0;u<S.children.length;u++)e.push.apply(e,G_(S.children[u]));return e}const im=new re,hg=new wn,nm=new wn;class Sy extends ia{constructor(e=10,u=10,y=4473924,v=8947848){y=new wn(y),v=new wn(v);const M=u/2,O=e/u,V=e/2,G=[],H=[];for(let ee=0,se=0,ae=-V;ee<=u;ee++,ae+=O){G.push(-V,0,ae,V,0,ae),G.push(ae,0,-V,ae,0,V);const de=ee===M?y:v;de.toArray(H,se),se+=3,de.toArray(H,se),se+=3,de.toArray(H,se),se+=3,de.toArray(H,se),se+=3}const Q=new Pr;Q.setAttribute("position",new Un(G,3)),Q.setAttribute("color",new Un(H,3)),super(Q,new Po({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const dg=new re,Op=new re,pg=new re,rm=new re,Oo=new kc;function Fo(S,e,u,y,v,M,O){rm.set(v,M,O).unproject(y);const V=e[S];if(V!==void 0){const G=u.getAttribute("position");for(let H=0,Q=V.length;H<Q;H++)G.setXYZ(V[H],rm.x,rm.y,rm.z)}}const sm=new dt;class fg extends ia{constructor(e,u=16776960){const y=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),v=new Float32Array(24),M=new Pr;M.setIndex(new Or(y,1)),M.setAttribute("position",new Or(v,3)),super(M,new Po({color:u,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&sm.setFromObject(this.object),sm.isEmpty())return;const u=sm.min,y=sm.max,v=this.geometry.attributes.position,M=v.array;M[0]=y.x,M[1]=y.y,M[2]=y.z,M[3]=u.x,M[4]=y.y,M[5]=y.z,M[6]=u.x,M[7]=u.y,M[8]=y.z,M[9]=y.x,M[10]=u.y,M[11]=y.z,M[12]=y.x,M[13]=y.y,M[14]=u.z,M[15]=u.x,M[16]=y.y,M[17]=u.z,M[18]=u.x,M[19]=u.y,M[20]=u.z,M[21]=y.x,M[22]=u.y,M[23]=u.z,v.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return ia.prototype.copy.call(this,e),this.object=e.object,this}}const gc=new re;let om,H_;class Ey extends ia{constructor(e=1){const u=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],y=new Pr;y.setAttribute("position",new Un(u,3)),y.setAttribute("color",new Un([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(y,new Po({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,u,y){const v=new wn,M=this.geometry.attributes.color.array;return v.set(e),v.toArray(M,0),v.toArray(M,3),v.set(u),v.toArray(M,6),v.toArray(M,9),v.set(y),v.toArray(M,12),v.toArray(M,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Ay=new Float32Array(1),Cx=new Int32Array(Ay.buffer);Za.create=function(S,e){return console.log("THREE.Curve.create() has been deprecated"),S.prototype=Object.create(Za.prototype),S.prototype.constructor=S,S.prototype.getPoint=e,S},Yr.prototype.fromPoints=function(S){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(S)},Sy.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},V_.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Er.prototype.extractUrlBase=function(S){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),$f.extractUrlBase(S)},Er.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Dp.prototype.center=function(S){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(S)},Dp.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Dp.prototype.isIntersectionBox=function(S){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(S)},Dp.prototype.size=function(S){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(S)},dt.prototype.center=function(S){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(S)},dt.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},dt.prototype.isIntersectionBox=function(S){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(S)},dt.prototype.isIntersectionSphere=function(S){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(S)},dt.prototype.size=function(S){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(S)},Ns.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Fc.prototype.setFromMatrix=function(S){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(S)},Ao.prototype.center=function(S){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(S)},Wn.prototype.flattenToArrayOffset=function(S,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(S,e)},Wn.prototype.multiplyVector3=function(S){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),S.applyMatrix3(this)},Wn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Wn.prototype.applyToBufferAttribute=function(S){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),S.applyMatrix3(this)},Wn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Wn.prototype.getInverse=function(S){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(S).invert()},nr.prototype.extractPosition=function(S){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(S)},nr.prototype.flattenToArrayOffset=function(S,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(S,e)},nr.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new re().setFromMatrixColumn(this,3)},nr.prototype.setRotationFromQuaternion=function(S){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(S)},nr.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},nr.prototype.multiplyVector3=function(S){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),S.applyMatrix4(this)},nr.prototype.multiplyVector4=function(S){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),S.applyMatrix4(this)},nr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},nr.prototype.rotateAxis=function(S){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),S.transformDirection(this)},nr.prototype.crossVector=function(S){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),S.applyMatrix4(this)},nr.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},nr.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},nr.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},nr.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},nr.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},nr.prototype.applyToBufferAttribute=function(S){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),S.applyMatrix4(this)},nr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},nr.prototype.makeFrustum=function(S,e,u,y,v,M){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(S,e,y,u,v,M)},nr.prototype.getInverse=function(S){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(S).invert()},ba.prototype.isIntersectionLine=function(S){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(S)},ye.prototype.multiplyVector3=function(S){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),S.applyQuaternion(this)},ye.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},aa.prototype.isIntersectionBox=function(S){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(S)},aa.prototype.isIntersectionPlane=function(S){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(S)},aa.prototype.isIntersectionSphere=function(S){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(S)},Ei.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ei.prototype.barycoordFromPoint=function(S,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(S,e)},Ei.prototype.midpoint=function(S){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(S)},Ei.prototypenormal=function(S){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(S)},Ei.prototype.plane=function(S){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(S)},Ei.barycoordFromPoint=function(S,e,u,y,v){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ei.getBarycoord(S,e,u,y,v)},Ei.normal=function(S,e,u,y){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ei.getNormal(S,e,u,y)},is.prototype.extractAllPoints=function(S){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(S)},is.prototype.extrude=function(S){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new J(this,S)},is.prototype.makeGeometry=function(S){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ge(this,S)},en.prototype.fromAttribute=function(S,e,u){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(S,e,u)},en.prototype.distanceToManhattan=function(S){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(S)},en.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},re.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},re.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},re.prototype.getPositionFromMatrix=function(S){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(S)},re.prototype.getScaleFromMatrix=function(S){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(S)},re.prototype.getColumnFromMatrix=function(S,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,S)},re.prototype.applyProjection=function(S){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(S)},re.prototype.fromAttribute=function(S,e,u){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(S,e,u)},re.prototype.distanceToManhattan=function(S){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(S)},re.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Dr.prototype.fromAttribute=function(S,e,u){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(S,e,u)},Dr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ee.prototype.getChildByName=function(S){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(S)},Ee.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ee.prototype.translate=function(S,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,S)},Ee.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ee.prototype.applyMatrix=function(S){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(S)},Object.defineProperties(Ee.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(S){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=S}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),qn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(qn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Th.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},vo.prototype.setLens=function(S,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(S)},Object.defineProperties(Es.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(S){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=S}},shadowCameraLeft:{set:function(S){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=S}},shadowCameraRight:{set:function(S){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=S}},shadowCameraTop:{set:function(S){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=S}},shadowCameraBottom:{set:function(S){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=S}},shadowCameraNear:{set:function(S){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=S}},shadowCameraFar:{set:function(S){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=S}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(S){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=S}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(S){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=S}},shadowMapHeight:{set:function(S){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=S}}}),Object.defineProperties(Or.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===35048},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Or.prototype.setDynamic=function(S){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(S===!0?35048:35044),this},Or.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Or.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Pr.prototype.addIndex=function(S){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(S)},Pr.prototype.addAttribute=function(S,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?S==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(S,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(S,new Or(arguments[1],arguments[2])))},Pr.prototype.addDrawCall=function(S,e,u){u!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(S,e)},Pr.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Pr.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Pr.prototype.removeAttribute=function(S){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(S)},Pr.prototype.applyMatrix=function(S){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(S)},Object.defineProperties(Pr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Wa.prototype.setDynamic=function(S){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(S===!0?35048:35044),this},Wa.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},J.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},J.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},J.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},gh.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},lg.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Vi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new wn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(S){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=S===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(S){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=S}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(co.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(S){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=S}}}),yn.prototype.clearTarget=function(S,e,u,y){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(S),this.clear(e,u,y)},yn.prototype.animate=function(S){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(S)},yn.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},yn.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},yn.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},yn.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},yn.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},yn.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},yn.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},yn.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},yn.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},yn.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},yn.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},yn.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},yn.prototype.enableScissorTest=function(S){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(S)},yn.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},yn.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},yn.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},yn.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},yn.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},yn.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},yn.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},yn.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},yn.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},yn.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(yn.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(S){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=S}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(S){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=S}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(S){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=S===!0?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(eo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ro.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(S){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=S}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(S){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=S}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(S){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=S}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(S){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=S}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(S){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=S}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(S){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=S}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(S){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=S}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(S){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=S}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(S){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=S}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(S){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=S}}}),O_.prototype.load=function(S){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new R_().load(S,function(u){e.setBuffer(u)}),this},k_.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},gu.prototype.updateCubeMap=function(S,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(S,e)},gu.prototype.clear=function(S,e,u,y){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(S,e,u,y)},To.crossOrigin=void 0,To.loadTexture=function(S,e,u,y){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const v=new Wr;v.setCrossOrigin(this.crossOrigin);const M=v.load(S,u,void 0,y);return e&&(M.mapping=e),M},To.loadTextureCube=function(S,e,u,y){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const v=new Ya;v.setCrossOrigin(this.crossOrigin);const M=v.load(S,u,void 0,y);return e&&(M.mapping=e),M},To.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},To.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Lx={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:E}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=E),l.ACESFilmicToneMapping=4,l.AddEquation=100,l.AddOperation=2,l.AdditiveAnimationBlendMode=2501,l.AdditiveBlending=2,l.AlphaFormat=1021,l.AlwaysDepth=1,l.AlwaysStencilFunc=519,l.AmbientLight=Td,l.AmbientLightProbe=P_,l.AnimationClip=Xr,l.AnimationLoader=class extends Er{constructor(S){super(S)}load(S,e,u,y){const v=this,M=new Gs(this.manager);M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(S,function(O){try{e(v.parse(JSON.parse(O)))}catch(V){y?y(V):console.error(V),v.manager.itemError(S)}},u,y)}parse(S){const e=[];for(let u=0;u<S.length;u++){const y=Xr.parse(S[u]);e.push(y)}return e}},l.AnimationMixer=by,l.AnimationObjectGroup=Pp,l.AnimationUtils=gi,l.ArcCurve=wp,l.ArrayCamera=pp,l.ArrowHelper=class extends Ee{constructor(S=new re(0,0,1),e=new re(0,0,0),u=1,y=16776960,v=.2*u,M=.2*v){super(),this.type="ArrowHelper",om===void 0&&(om=new Pr,om.setAttribute("position",new Un([0,0,0,0,1,0],3)),H_=new $l(0,.5,1,5,1),H_.translate(0,-.5,0)),this.position.copy(e),this.line=new za(om,new Po({color:y,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new qn(H_,new ws({color:y,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(S),this.setLength(u,v,M)}setDirection(S){if(S.y>.99999)this.quaternion.set(0,0,0,1);else if(S.y<-.99999)this.quaternion.set(1,0,0,0);else{gc.set(S.z,0,-S.x).normalize();const e=Math.acos(S.y);this.quaternion.setFromAxisAngle(gc,e)}}setLength(S,e=.2*S,u=.2*e){this.line.scale.set(1,Math.max(1e-4,S-e),1),this.line.updateMatrix(),this.cone.scale.set(u,e,u),this.cone.position.y=S,this.cone.updateMatrix()}setColor(S){this.line.material.color.set(S),this.cone.material.color.set(S)}copy(S){return super.copy(S,!1),this.line.copy(S.line),this.cone.copy(S.cone),this}},l.Audio=O_,l.AudioAnalyser=k_,l.AudioContext=iu,l.AudioListener=class extends Ee{constructor(){super(),this.type="AudioListener",this.context=iu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new fy}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(S){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=S,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(S){return this.gain.gain.setTargetAtTime(S,this.context.currentTime,.01),this}updateMatrixWorld(S){super.updateMatrixWorld(S);const e=this.context.listener,u=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ih,my,gy),Md.set(0,0,-1).applyQuaternion(my),e.positionX){const y=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Ih.x,y),e.positionY.linearRampToValueAtTime(Ih.y,y),e.positionZ.linearRampToValueAtTime(Ih.z,y),e.forwardX.linearRampToValueAtTime(Md.x,y),e.forwardY.linearRampToValueAtTime(Md.y,y),e.forwardZ.linearRampToValueAtTime(Md.z,y),e.upX.linearRampToValueAtTime(u.x,y),e.upY.linearRampToValueAtTime(u.y,y),e.upZ.linearRampToValueAtTime(u.z,y)}else e.setPosition(Ih.x,Ih.y,Ih.z),e.setOrientation(Md.x,Md.y,Md.z,u.x,u.y,u.z)}},l.AudioLoader=R_,l.AxesHelper=Ey,l.AxisHelper=function(S){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Ey(S)},l.BackSide=1,l.BasicDepthPacking=3200,l.BasicShadowMap=0,l.BinaryTextureLoader=function(S){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Eo(S)},l.Bone=$c,l.BooleanKeyframeTrack=dn,l.BoundingBoxHelper=function(S,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new fg(S,e)},l.Box2=Dp,l.Box3=dt,l.Box3Helper=class extends ia{constructor(S,e=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),y=new Pr;y.setIndex(new Or(u,1)),y.setAttribute("position",new Un([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(y,new Po({color:e,toneMapped:!1})),this.box=S,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(S){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(S))}},l.BoxBufferGeometry=rl,l.BoxGeometry=rl,l.BoxHelper=fg,l.BufferAttribute=Or,l.BufferGeometry=Pr,l.BufferGeometryLoader=sg,l.ByteType=1010,l.Cache=br,l.Camera=kc,l.CameraHelper=class extends ia{constructor(S){const e=new Pr,u=new Po({color:16777215,vertexColors:!0,toneMapped:!1}),y=[],v=[],M={},O=new wn(16755200),V=new wn(16711680),G=new wn(43775),H=new wn(16777215),Q=new wn(3355443);function ee(ae,de,be){se(ae,be),se(de,be)}function se(ae,de){y.push(0,0,0),v.push(de.r,de.g,de.b),M[ae]===void 0&&(M[ae]=[]),M[ae].push(y.length/3-1)}ee("n1","n2",O),ee("n2","n4",O),ee("n4","n3",O),ee("n3","n1",O),ee("f1","f2",O),ee("f2","f4",O),ee("f4","f3",O),ee("f3","f1",O),ee("n1","f1",O),ee("n2","f2",O),ee("n3","f3",O),ee("n4","f4",O),ee("p","n1",V),ee("p","n2",V),ee("p","n3",V),ee("p","n4",V),ee("u1","u2",G),ee("u2","u3",G),ee("u3","u1",G),ee("c","t",H),ee("p","c",Q),ee("cn1","cn2",Q),ee("cn3","cn4",Q),ee("cf1","cf2",Q),ee("cf3","cf4",Q),e.setAttribute("position",new Un(y,3)),e.setAttribute("color",new Un(v,3)),super(e,u),this.type="CameraHelper",this.camera=S,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=S.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=M,this.update()}update(){const S=this.geometry,e=this.pointMap;Oo.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Fo("c",e,S,Oo,0,0,-1),Fo("t",e,S,Oo,0,0,1),Fo("n1",e,S,Oo,-1,-1,-1),Fo("n2",e,S,Oo,1,-1,-1),Fo("n3",e,S,Oo,-1,1,-1),Fo("n4",e,S,Oo,1,1,-1),Fo("f1",e,S,Oo,-1,-1,1),Fo("f2",e,S,Oo,1,-1,1),Fo("f3",e,S,Oo,-1,1,1),Fo("f4",e,S,Oo,1,1,1),Fo("u1",e,S,Oo,.7,1.1,-1),Fo("u2",e,S,Oo,-.7,1.1,-1),Fo("u3",e,S,Oo,0,2,-1),Fo("cf1",e,S,Oo,-1,0,1),Fo("cf2",e,S,Oo,1,0,1),Fo("cf3",e,S,Oo,0,-1,1),Fo("cf4",e,S,Oo,0,1,1),Fo("cn1",e,S,Oo,-1,0,-1),Fo("cn2",e,S,Oo,1,0,-1),Fo("cn3",e,S,Oo,0,-1,-1),Fo("cn4",e,S,Oo,0,1,-1),S.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},l.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},l.CanvasTexture=Ah,l.CatmullRomCurve3=Lh,l.CineonToneMapping=3,l.CircleBufferGeometry=ku,l.CircleGeometry=ku,l.ClampToEdgeWrapping=1001,l.Clock=fy,l.Color=wn,l.ColorKeyframeTrack=tr,l.CompressedTexture=Eh,l.CompressedTextureLoader=class extends Er{constructor(S){super(S)}load(S,e,u,y){const v=this,M=[],O=new Eh,V=new Gs(this.manager);V.setPath(this.path),V.setResponseType("arraybuffer"),V.setRequestHeader(this.requestHeader),V.setWithCredentials(v.withCredentials);let G=0;function H(Q){V.load(S[Q],function(ee){const se=v.parse(ee,!0);M[Q]={width:se.width,height:se.height,format:se.format,mipmaps:se.mipmaps},G+=1,G===6&&(se.mipmapCount===1&&(O.minFilter=1006),O.image=M,O.format=se.format,O.needsUpdate=!0,e&&e(O))},u,y)}if(Array.isArray(S))for(let Q=0,ee=S.length;Q<ee;++Q)H(Q);else V.load(S,function(Q){const ee=v.parse(Q,!0);if(ee.isCubemap){const se=ee.mipmaps.length/ee.mipmapCount;for(let ae=0;ae<se;ae++){M[ae]={mipmaps:[]};for(let de=0;de<ee.mipmapCount;de++)M[ae].mipmaps.push(ee.mipmaps[ae*ee.mipmapCount+de]),M[ae].format=ee.format,M[ae].width=ee.width,M[ae].height=ee.height}O.image=M}else O.image.width=ee.width,O.image.height=ee.height,O.mipmaps=ee.mipmaps;ee.mipmapCount===1&&(O.minFilter=1006),O.format=ee.format,O.needsUpdate=!0,e&&e(O)},u,y);return O}},l.ConeBufferGeometry=Fu,l.ConeGeometry=Fu,l.CubeCamera=gu,l.CubeReflectionMapping=301,l.CubeRefractionMapping=302,l.CubeTexture=Ia,l.CubeTextureLoader=Ya,l.CubeUVReflectionMapping=306,l.CubeUVRefractionMapping=307,l.CubicBezierCurve=Xa,l.CubicBezierCurve3=bd,l.CubicInterpolant=zn,l.CullFaceBack=1,l.CullFaceFront=2,l.CullFaceFrontBack=3,l.CullFaceNone=0,l.Curve=Za,l.CurvePath=Hr,l.CustomBlending=5,l.CustomToneMapping=5,l.CylinderBufferGeometry=$l,l.CylinderGeometry=$l,l.Cylindrical=class{constructor(S=1,e=0,u=0){return this.radius=S,this.theta=e,this.y=u,this}set(S,e,u){return this.radius=S,this.theta=e,this.y=u,this}copy(S){return this.radius=S.radius,this.theta=S.theta,this.y=S.y,this}setFromVector3(S){return this.setFromCartesianCoords(S.x,S.y,S.z)}setFromCartesianCoords(S,e,u){return this.radius=Math.sqrt(S*S+u*u),this.theta=Math.atan2(S,u),this.y=e,this}clone(){return new this.constructor().copy(this)}},l.DataTexture=Ta,l.DataTexture2DArray=ad,l.DataTexture3D=ld,l.DataTextureLoader=Eo,l.DataUtils=class{static toHalfFloat(S){Ay[0]=S;const e=Cx[0];let u=e>>16&32768,y=e>>12&2047;const v=e>>23&255;return v<103?u:v>142?(u|=31744,u|=(v==255?0:1)&&8388607&e,u):v<113?(y|=2048,u|=(y>>114-v)+(y>>113-v&1),u):(u|=v-112<<10|y>>1,u+=1&y,u)}},l.DecrementStencilOp=7683,l.DecrementWrapStencilOp=34056,l.DefaultLoadingManager=ps,l.DepthFormat=1026,l.DepthStencilFormat=1027,l.DepthTexture=xp,l.DirectionalLight=tu,l.DirectionalLightHelper=class extends Ee{constructor(S,e,u){super(),this.light=S,this.light.updateMatrixWorld(),this.matrix=S.matrixWorld,this.matrixAutoUpdate=!1,this.color=u,e===void 0&&(e=1);let y=new Pr;y.setAttribute("position",new Un([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const v=new Po({fog:!1,toneMapped:!1});this.lightPlane=new za(y,v),this.add(this.lightPlane),y=new Pr,y.setAttribute("position",new Un([0,0,0,0,0,1],3)),this.targetLine=new za(y,v),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){dg.setFromMatrixPosition(this.light.matrixWorld),Op.setFromMatrixPosition(this.light.target.matrixWorld),pg.subVectors(Op,dg),this.lightPlane.lookAt(Op),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Op),this.targetLine.scale.z=pg.length()}},l.DiscreteInterpolant=An,l.DodecahedronBufferGeometry=Bu,l.DodecahedronGeometry=Bu,l.DoubleSide=2,l.DstAlphaFactor=206,l.DstColorFactor=208,l.DynamicBufferAttribute=function(S,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Or(S,e).setUsage(35048)},l.DynamicCopyUsage=35050,l.DynamicDrawUsage=35048,l.DynamicReadUsage=35049,l.EdgesGeometry=jf,l.EdgesHelper=function(S,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ia(new jf(S.geometry),new Po({color:e!==void 0?e:16777215}))},l.EllipseCurve=Js,l.EqualDepth=4,l.EqualStencilFunc=514,l.EquirectangularReflectionMapping=303,l.EquirectangularRefractionMapping=304,l.Euler=Va,l.EventDispatcher=It,l.ExtrudeBufferGeometry=J,l.ExtrudeGeometry=J,l.FaceColors=1,l.FileLoader=Gs,l.FlatShading=1,l.Float16BufferAttribute=ea,l.Float32Attribute=function(S,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Un(S,e)},l.Float32BufferAttribute=Un,l.Float64Attribute=function(S,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new vl(S,e)},l.Float64BufferAttribute=vl,l.FloatType=1015,l.Fog=Qt,l.FogExp2=Ts,l.Font=Kf,l.FontLoader=class extends Er{constructor(S){super(S)}load(S,e,u,y){const v=this,M=new Gs(this.manager);M.setPath(this.path),M.setRequestHeader(this.requestHeader),M.setWithCredentials(v.withCredentials),M.load(S,function(O){let V;try{V=JSON.parse(O)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),V=JSON.parse(O.substring(65,O.length-2))}const G=v.parse(V);e&&e(G)},u,y)}parse(S){return new Kf(S)}},l.FrontSide=0,l.Frustum=Fc,l.GLBufferAttribute=Ty,l.GLSL1="100",l.GLSL3=Lt,l.GammaEncoding=3007,l.GreaterDepth=6,l.GreaterEqualDepth=5,l.GreaterEqualStencilFunc=518,l.GreaterStencilFunc=516,l.GridHelper=Sy,l.Group=Gc,l.HalfFloatType=1016,l.HemisphereLight=Os,l.HemisphereLightHelper=class extends Ee{constructor(S,e,u){super(),this.light=S,this.light.updateMatrixWorld(),this.matrix=S.matrixWorld,this.matrixAutoUpdate=!1,this.color=u;const y=new _e(e);y.rotateY(.5*Math.PI),this.material=new ws({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const v=y.getAttribute("position"),M=new Float32Array(3*v.count);y.setAttribute("color",new Or(M,3)),this.add(new qn(y,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const S=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=S.geometry.getAttribute("color");hg.copy(this.light.color),nm.copy(this.light.groundColor);for(let u=0,y=e.count;u<y;u++){const v=u<y/2?hg:nm;e.setXYZ(u,v.r,v.g,v.b)}e.needsUpdate=!0}S.lookAt(im.setFromMatrixPosition(this.light.matrixWorld).negate())}},l.HemisphereLightProbe=ag,l.IcosahedronBufferGeometry=pe,l.IcosahedronGeometry=pe,l.ImageBitmapLoader=Yf,l.ImageLoader=ra,l.ImageUtils=To,l.ImmediateRenderObject=tm,l.IncrementStencilOp=7682,l.IncrementWrapStencilOp=34055,l.InstancedBufferAttribute=El,l.InstancedBufferGeometry=Rp,l.InstancedInterleavedBuffer=wy,l.InstancedMesh=_d,l.Int16Attribute=function(S,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ga(S,e)},l.Int16BufferAttribute=Ga,l.Int32Attribute=function(S,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new hs(S,e)},l.Int32BufferAttribute=hs,l.Int8Attribute=function(S,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new so(S,e)},l.Int8BufferAttribute=so,l.IntType=1013,l.InterleavedBuffer=Wa,l.InterleavedBufferAttribute=Sl,l.Interpolant=Xi,l.InterpolateDiscrete=2300,l.InterpolateLinear=2301,l.InterpolateSmooth=2302,l.InvertStencilOp=5386,l.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},l.KeepStencilOp=7680,l.KeyframeTrack=kn,l.LOD=Ds,l.LatheBufferGeometry=ue,l.LatheGeometry=ue,l.Layers=Hl,l.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},l.LessDepth=2,l.LessEqualDepth=3,l.LessEqualStencilFunc=515,l.LessStencilFunc=513,l.Light=Es,l.LightProbe=Rl,l.Line=za,l.Line3=Ao,l.LineBasicMaterial=Po,l.LineCurve=Qc,l.LineCurve3=Sp,l.LineDashedMaterial=Ti,l.LineLoop=yp,l.LinePieces=1,l.LineSegments=ia,l.LineStrip=0,l.LinearEncoding=3e3,l.LinearFilter=1006,l.LinearInterpolant=$n,l.LinearMipMapLinearFilter=1008,l.LinearMipMapNearestFilter=1007,l.LinearMipmapLinearFilter=1008,l.LinearMipmapNearestFilter=1007,l.LinearToneMapping=1,l.Loader=Er,l.LoaderUtils=$f,l.LoadingManager=ds,l.LogLuvEncoding=3003,l.LoopOnce=2200,l.LoopPingPong=2202,l.LoopRepeat=2201,l.LuminanceAlphaFormat=1025,l.LuminanceFormat=1024,l.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},l.Material=Vi,l.MaterialLoader=L_,l.Math=$r,l.MathUtils=$r,l.Matrix3=Wn,l.Matrix4=nr,l.MaxEquation=104,l.Mesh=qn,l.MeshBasicMaterial=ws,l.MeshDepthMaterial=md,l.MeshDistanceMaterial=ua,l.MeshFaceMaterial=function(S){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),S},l.MeshLambertMaterial=wi,l.MeshMatcapMaterial=hi,l.MeshNormalMaterial=qt,l.MeshPhongMaterial=Gi,l.MeshPhysicalMaterial=Si,l.MeshStandardMaterial=di,l.MeshToonMaterial=Ki,l.MinEquation=103,l.MirroredRepeatWrapping=1002,l.MixOperation=1,l.MultiMaterial=function(S=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),S.isMultiMaterial=!0,S.materials=S,S.clone=function(){return S.slice()},S},l.MultiplyBlending=4,l.MultiplyOperation=0,l.NearestFilter=1003,l.NearestMipMapLinearFilter=1005,l.NearestMipMapNearestFilter=1004,l.NearestMipmapLinearFilter=1005,l.NearestMipmapNearestFilter=1004,l.NeverDepth=0,l.NeverStencilFunc=512,l.NoBlending=0,l.NoColors=0,l.NoToneMapping=0,l.NormalAnimationBlendMode=2500,l.NormalBlending=1,l.NotEqualDepth=7,l.NotEqualStencilFunc=517,l.NumberKeyframeTrack=dr,l.Object3D=Ee,l.ObjectLoader=class extends Er{constructor(S){super(S)}load(S,e,u,y){const v=this,M=this.path===""?$f.extractUrlBase(S):this.path;this.resourcePath=this.resourcePath||M;const O=new Gs(this.manager);O.setPath(this.path),O.setRequestHeader(this.requestHeader),O.setWithCredentials(this.withCredentials),O.load(S,function(V){let G=null;try{G=JSON.parse(V)}catch(Q){return y!==void 0&&y(Q),void console.error("THREE:ObjectLoader: Can't parse "+S+".",Q.message)}const H=G.metadata;H!==void 0&&H.type!==void 0&&H.type.toLowerCase()!=="geometry"?v.parse(G,e):console.error("THREE.ObjectLoader: Can't load "+S)},u,y)}async loadAsync(S,e){const u=this.path===""?$f.extractUrlBase(S):this.path;this.resourcePath=this.resourcePath||u;const y=new Gs(this.manager);y.setPath(this.path),y.setRequestHeader(this.requestHeader),y.setWithCredentials(this.withCredentials);const v=await y.loadAsync(S,e),M=JSON.parse(v),O=M.metadata;if(O===void 0||O.type===void 0||O.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+S);return await this.parseAsync(M)}parse(S,e){const u=this.parseAnimations(S.animations),y=this.parseShapes(S.shapes),v=this.parseGeometries(S.geometries,y),M=this.parseImages(S.images,function(){e!==void 0&&e(G)}),O=this.parseTextures(S.textures,M),V=this.parseMaterials(S.materials,O),G=this.parseObject(S.object,v,V,O,u),H=this.parseSkeletons(S.skeletons,G);if(this.bindSkeletons(G,H),e!==void 0){let Q=!1;for(const ee in M)if(M[ee]instanceof HTMLImageElement){Q=!0;break}Q===!1&&e(G)}return G}async parseAsync(S){const e=this.parseAnimations(S.animations),u=this.parseShapes(S.shapes),y=this.parseGeometries(S.geometries,u),v=await this.parseImagesAsync(S.images),M=this.parseTextures(S.textures,v),O=this.parseMaterials(S.materials,M),V=this.parseObject(S.object,y,O,M,e),G=this.parseSkeletons(S.skeletons,V);return this.bindSkeletons(V,G),V}parseShapes(S){const e={};if(S!==void 0)for(let u=0,y=S.length;u<y;u++){const v=new is().fromJSON(S[u]);e[v.uuid]=v}return e}parseSkeletons(S,e){const u={},y={};if(e.traverse(function(v){v.isBone&&(y[v.uuid]=v)}),S!==void 0)for(let v=0,M=S.length;v<M;v++){const O=new Iu().fromJSON(S[v],y);u[O.uuid]=O}return u}parseGeometries(S,e){const u={};if(S!==void 0){const y=new sg;for(let v=0,M=S.length;v<M;v++){let O;const V=S[v];switch(V.type){case"BufferGeometry":case"InstancedBufferGeometry":O=y.parse(V);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:V.type in St?O=St[V.type].fromJSON(V,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${V.type}"`)}O.uuid=V.uuid,V.name!==void 0&&(O.name=V.name),O.isBufferGeometry===!0&&V.userData!==void 0&&(O.userData=V.userData),u[V.uuid]=O}}return u}parseMaterials(S,e){const u={},y={};if(S!==void 0){const v=new L_;v.setTextures(e);for(let M=0,O=S.length;M<O;M++){const V=S[M];if(V.type==="MultiMaterial"){const G=[];for(let H=0;H<V.materials.length;H++){const Q=V.materials[H];u[Q.uuid]===void 0&&(u[Q.uuid]=v.parse(Q)),G.push(u[Q.uuid])}y[V.uuid]=G}else u[V.uuid]===void 0&&(u[V.uuid]=v.parse(V)),y[V.uuid]=u[V.uuid]}}return y}parseAnimations(S){const e={};if(S!==void 0)for(let u=0;u<S.length;u++){const y=S[u],v=Xr.parse(y);e[v.uuid]=v}return e}parseImages(S,e){const u=this,y={};let v;function M(O){if(typeof O=="string"){const V=O;return function(G){return u.manager.itemStart(G),v.load(G,function(){u.manager.itemEnd(G)},void 0,function(){u.manager.itemError(G),u.manager.itemEnd(G)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(V)?V:u.resourcePath+V)}return O.data?{data:va(O.type,O.data),width:O.width,height:O.height}:null}if(S!==void 0&&S.length>0){const O=new ds(e);v=new ra(O),v.setCrossOrigin(this.crossOrigin);for(let V=0,G=S.length;V<G;V++){const H=S[V],Q=H.url;if(Array.isArray(Q)){y[H.uuid]=[];for(let ee=0,se=Q.length;ee<se;ee++){const ae=M(Q[ee]);ae!==null&&(ae instanceof HTMLImageElement?y[H.uuid].push(ae):y[H.uuid].push(new Ta(ae.data,ae.width,ae.height)))}}else{const ee=M(H.url);ee!==null&&(y[H.uuid]=ee)}}}return y}async parseImagesAsync(S){const e=this,u={};let y;async function v(M){if(typeof M=="string"){const O=M,V=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(O)?O:e.resourcePath+O;return await y.loadAsync(V)}return M.data?{data:va(M.type,M.data),width:M.width,height:M.height}:null}if(S!==void 0&&S.length>0){y=new ra(this.manager),y.setCrossOrigin(this.crossOrigin);for(let M=0,O=S.length;M<O;M++){const V=S[M],G=V.url;if(Array.isArray(G)){u[V.uuid]=[];for(let H=0,Q=G.length;H<Q;H++){const ee=G[H],se=await v(ee);se!==null&&(se instanceof HTMLImageElement?u[V.uuid].push(se):u[V.uuid].push(new Ta(se.data,se.width,se.height)))}}else{const H=await v(V.url);H!==null&&(u[V.uuid]=H)}}}return u}parseTextures(S,e){function u(v,M){return typeof v=="number"?v:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",v),M[v])}const y={};if(S!==void 0)for(let v=0,M=S.length;v<M;v++){const O=S[v];let V;O.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',O.uuid),e[O.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",O.image);const G=e[O.image];Array.isArray(G)?(V=new Ia(G),G.length===6&&(V.needsUpdate=!0)):(V=G&&G.data?new Ta(G.data,G.width,G.height):new _s(G),G&&(V.needsUpdate=!0)),V.uuid=O.uuid,O.name!==void 0&&(V.name=O.name),O.mapping!==void 0&&(V.mapping=u(O.mapping,Zf)),O.offset!==void 0&&V.offset.fromArray(O.offset),O.repeat!==void 0&&V.repeat.fromArray(O.repeat),O.center!==void 0&&V.center.fromArray(O.center),O.rotation!==void 0&&(V.rotation=O.rotation),O.wrap!==void 0&&(V.wrapS=u(O.wrap[0],Xf),V.wrapT=u(O.wrap[1],Xf)),O.format!==void 0&&(V.format=O.format),O.type!==void 0&&(V.type=O.type),O.encoding!==void 0&&(V.encoding=O.encoding),O.minFilter!==void 0&&(V.minFilter=u(O.minFilter,I_)),O.magFilter!==void 0&&(V.magFilter=u(O.magFilter,I_)),O.anisotropy!==void 0&&(V.anisotropy=O.anisotropy),O.flipY!==void 0&&(V.flipY=O.flipY),O.premultiplyAlpha!==void 0&&(V.premultiplyAlpha=O.premultiplyAlpha),O.unpackAlignment!==void 0&&(V.unpackAlignment=O.unpackAlignment),y[O.uuid]=V}return y}parseObject(S,e,u,y,v){let M,O,V;function G(ee){return e[ee]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",ee),e[ee]}function H(ee){if(ee!==void 0){if(Array.isArray(ee)){const se=[];for(let ae=0,de=ee.length;ae<de;ae++){const be=ee[ae];u[be]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",be),se.push(u[be])}return se}return u[ee]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ee),u[ee]}}function Q(ee){return y[ee]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",ee),y[ee]}switch(S.type){case"Scene":M=new gh,S.background!==void 0&&(Number.isInteger(S.background)?M.background=new wn(S.background):M.background=Q(S.background)),S.environment!==void 0&&(M.environment=Q(S.environment)),S.fog!==void 0&&(S.fog.type==="Fog"?M.fog=new Qt(S.fog.color,S.fog.near,S.fog.far):S.fog.type==="FogExp2"&&(M.fog=new Ts(S.fog.color,S.fog.density)));break;case"PerspectiveCamera":M=new vo(S.fov,S.aspect,S.near,S.far),S.focus!==void 0&&(M.focus=S.focus),S.zoom!==void 0&&(M.zoom=S.zoom),S.filmGauge!==void 0&&(M.filmGauge=S.filmGauge),S.filmOffset!==void 0&&(M.filmOffset=S.filmOffset),S.view!==void 0&&(M.view=Object.assign({},S.view));break;case"OrthographicCamera":M=new ih(S.left,S.right,S.top,S.bottom,S.near,S.far),S.zoom!==void 0&&(M.zoom=S.zoom),S.view!==void 0&&(M.view=Object.assign({},S.view));break;case"AmbientLight":M=new Td(S.color,S.intensity);break;case"DirectionalLight":M=new tu(S.color,S.intensity);break;case"PointLight":M=new eu(S.color,S.intensity,S.distance,S.decay);break;case"RectAreaLight":M=new Gu(S.color,S.intensity,S.width,S.height);break;case"SpotLight":M=new Ja(S.color,S.intensity,S.distance,S.angle,S.penumbra,S.decay);break;case"HemisphereLight":M=new Os(S.color,S.groundColor,S.intensity);break;case"LightProbe":M=new Rl().fromJSON(S);break;case"SkinnedMesh":O=G(S.geometry),V=H(S.material),M=new Th(O,V),S.bindMode!==void 0&&(M.bindMode=S.bindMode),S.bindMatrix!==void 0&&M.bindMatrix.fromArray(S.bindMatrix),S.skeleton!==void 0&&(M.skeleton=S.skeleton);break;case"Mesh":O=G(S.geometry),V=H(S.material),M=new qn(O,V);break;case"InstancedMesh":O=G(S.geometry),V=H(S.material);const ee=S.count,se=S.instanceMatrix,ae=S.instanceColor;M=new _d(O,V,ee),M.instanceMatrix=new El(new Float32Array(se.array),16),ae!==void 0&&(M.instanceColor=new El(new Float32Array(ae.array),ae.itemSize));break;case"LOD":M=new Ds;break;case"Line":M=new za(G(S.geometry),H(S.material));break;case"LineLoop":M=new yp(G(S.geometry),H(S.material));break;case"LineSegments":M=new ia(G(S.geometry),H(S.material));break;case"PointCloud":case"Points":M=new Kc(G(S.geometry),H(S.material));break;case"Sprite":M=new qa(H(S.material));break;case"Group":M=new Gc;break;case"Bone":M=new $c;break;default:M=new Ee}if(M.uuid=S.uuid,S.name!==void 0&&(M.name=S.name),S.matrix!==void 0?(M.matrix.fromArray(S.matrix),S.matrixAutoUpdate!==void 0&&(M.matrixAutoUpdate=S.matrixAutoUpdate),M.matrixAutoUpdate&&M.matrix.decompose(M.position,M.quaternion,M.scale)):(S.position!==void 0&&M.position.fromArray(S.position),S.rotation!==void 0&&M.rotation.fromArray(S.rotation),S.quaternion!==void 0&&M.quaternion.fromArray(S.quaternion),S.scale!==void 0&&M.scale.fromArray(S.scale)),S.castShadow!==void 0&&(M.castShadow=S.castShadow),S.receiveShadow!==void 0&&(M.receiveShadow=S.receiveShadow),S.shadow&&(S.shadow.bias!==void 0&&(M.shadow.bias=S.shadow.bias),S.shadow.normalBias!==void 0&&(M.shadow.normalBias=S.shadow.normalBias),S.shadow.radius!==void 0&&(M.shadow.radius=S.shadow.radius),S.shadow.mapSize!==void 0&&M.shadow.mapSize.fromArray(S.shadow.mapSize),S.shadow.camera!==void 0&&(M.shadow.camera=this.parseObject(S.shadow.camera))),S.visible!==void 0&&(M.visible=S.visible),S.frustumCulled!==void 0&&(M.frustumCulled=S.frustumCulled),S.renderOrder!==void 0&&(M.renderOrder=S.renderOrder),S.userData!==void 0&&(M.userData=S.userData),S.layers!==void 0&&(M.layers.mask=S.layers),S.children!==void 0){const ee=S.children;for(let se=0;se<ee.length;se++)M.add(this.parseObject(ee[se],e,u,y,v))}if(S.animations!==void 0){const ee=S.animations;for(let se=0;se<ee.length;se++){const ae=ee[se];M.animations.push(v[ae])}}if(S.type==="LOD"){S.autoUpdate!==void 0&&(M.autoUpdate=S.autoUpdate);const ee=S.levels;for(let se=0;se<ee.length;se++){const ae=ee[se],de=M.getObjectByProperty("uuid",ae.object);de!==void 0&&M.addLevel(de,ae.distance)}}return M}bindSkeletons(S,e){Object.keys(e).length!==0&&S.traverse(function(u){if(u.isSkinnedMesh===!0&&u.skeleton!==void 0){const y=e[u.skeleton];y===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",u.skeleton):u.bind(y,u.bindMatrix)}})}setTexturePath(S){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(S)}},l.ObjectSpaceNormalMap=1,l.OctahedronBufferGeometry=_e,l.OctahedronGeometry=_e,l.OneFactor=201,l.OneMinusDstAlphaFactor=207,l.OneMinusDstColorFactor=209,l.OneMinusSrcAlphaFactor=205,l.OneMinusSrcColorFactor=203,l.OrthographicCamera=ih,l.PCFShadowMap=1,l.PCFSoftShadowMap=2,l.PMREMGenerator=rh,l.ParametricBufferGeometry=ge,l.ParametricGeometry=ge,l.Particle=function(S){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new qa(S)},l.ParticleBasicMaterial=function(S){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Al(S)},l.ParticleSystem=function(S,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Kc(S,e)},l.ParticleSystemMaterial=function(S){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Al(S)},l.Path=Yr,l.PerspectiveCamera=vo,l.Plane=ba,l.PlaneBufferGeometry=Go,l.PlaneGeometry=Go,l.PlaneHelper=class extends za{constructor(S,e=1,u=16776960){const y=u,v=new Pr;v.setAttribute("position",new Un([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),v.computeBoundingSphere(),super(v,new Po({color:y,toneMapped:!1})),this.type="PlaneHelper",this.plane=S,this.size=e;const M=new Pr;M.setAttribute("position",new Un([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),M.computeBoundingSphere(),this.add(new qn(M,new ws({color:y,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(S){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(S)}},l.PointCloud=function(S,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Kc(S,e)},l.PointCloudMaterial=function(S){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Al(S)},l.PointLight=eu,l.PointLightHelper=class extends qn{constructor(S,e,u){super(new He(e,4,2),new ws({wireframe:!0,fog:!1,toneMapped:!1})),this.light=S,this.light.updateMatrixWorld(),this.color=u,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},l.Points=Kc,l.PointsMaterial=Al,l.PolarGridHelper=class extends ia{constructor(S=10,e=16,u=8,y=64,v=4473924,M=8947848){v=new wn(v),M=new wn(M);const O=[],V=[];for(let H=0;H<=e;H++){const Q=H/e*(2*Math.PI),ee=Math.sin(Q)*S,se=Math.cos(Q)*S;O.push(0,0,0),O.push(ee,0,se);const ae=1&H?v:M;V.push(ae.r,ae.g,ae.b),V.push(ae.r,ae.g,ae.b)}for(let H=0;H<=u;H++){const Q=1&H?v:M,ee=S-S/u*H;for(let se=0;se<y;se++){let ae=se/y*(2*Math.PI),de=Math.sin(ae)*ee,be=Math.cos(ae)*ee;O.push(de,0,be),V.push(Q.r,Q.g,Q.b),ae=(se+1)/y*(2*Math.PI),de=Math.sin(ae)*ee,be=Math.cos(ae)*ee,O.push(de,0,be),V.push(Q.r,Q.g,Q.b)}}const G=new Pr;G.setAttribute("position",new Un(O,3)),G.setAttribute("color",new Un(V,3)),super(G,new Po({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},l.PolyhedronBufferGeometry=$a,l.PolyhedronGeometry=$a,l.PositionalAudio=class extends O_{constructor(S){super(S),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(S){return this.panner.refDistance=S,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(S){return this.panner.rolloffFactor=S,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(S){return this.panner.distanceModel=S,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(S){return this.panner.maxDistance=S,this}setDirectionalCone(S,e,u){return this.panner.coneInnerAngle=S,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=u,this}updateMatrixWorld(S){if(super.updateMatrixWorld(S),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Rh,z_,_y),Ph.set(0,0,1).applyQuaternion(z_);const e=this.panner;if(e.positionX){const u=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Rh.x,u),e.positionY.linearRampToValueAtTime(Rh.y,u),e.positionZ.linearRampToValueAtTime(Rh.z,u),e.orientationX.linearRampToValueAtTime(Ph.x,u),e.orientationY.linearRampToValueAtTime(Ph.y,u),e.orientationZ.linearRampToValueAtTime(Ph.z,u)}else e.setPosition(Rh.x,Rh.y,Rh.z),e.setOrientation(Ph.x,Ph.y,Ph.z)}},l.PropertyBinding=Ms,l.PropertyMixer=F_,l.QuadraticBezierCurve=wd,l.QuadraticBezierCurve3=Uu,l.Quaternion=ye,l.QuaternionKeyframeTrack=as,l.QuaternionLinearInterpolant=Nr,l.REVISION=E,l.RGBADepthPacking=3201,l.RGBAFormat=1023,l.RGBAIntegerFormat=1033,l.RGBA_ASTC_10x10_Format=37819,l.RGBA_ASTC_10x5_Format=37816,l.RGBA_ASTC_10x6_Format=37817,l.RGBA_ASTC_10x8_Format=37818,l.RGBA_ASTC_12x10_Format=37820,l.RGBA_ASTC_12x12_Format=37821,l.RGBA_ASTC_4x4_Format=37808,l.RGBA_ASTC_5x4_Format=37809,l.RGBA_ASTC_5x5_Format=37810,l.RGBA_ASTC_6x5_Format=37811,l.RGBA_ASTC_6x6_Format=37812,l.RGBA_ASTC_8x5_Format=37813,l.RGBA_ASTC_8x6_Format=37814,l.RGBA_ASTC_8x8_Format=37815,l.RGBA_BPTC_Format=36492,l.RGBA_ETC2_EAC_Format=37496,l.RGBA_PVRTC_2BPPV1_Format=35843,l.RGBA_PVRTC_4BPPV1_Format=35842,l.RGBA_S3TC_DXT1_Format=33777,l.RGBA_S3TC_DXT3_Format=33778,l.RGBA_S3TC_DXT5_Format=33779,l.RGBDEncoding=3006,l.RGBEEncoding=3002,l.RGBEFormat=1023,l.RGBFormat=1022,l.RGBIntegerFormat=1032,l.RGBM16Encoding=3005,l.RGBM7Encoding=3004,l.RGB_ETC1_Format=36196,l.RGB_ETC2_Format=37492,l.RGB_PVRTC_2BPPV1_Format=35841,l.RGB_PVRTC_4BPPV1_Format=35840,l.RGB_S3TC_DXT1_Format=33776,l.RGFormat=1030,l.RGIntegerFormat=1031,l.RawShaderMaterial=yu,l.Ray=aa,l.Raycaster=class{constructor(S,e,u=0,y=1/0){this.ray=new aa(S,e),this.near=u,this.far=y,this.camera=null,this.layers=new Hl,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(S,e){this.ray.set(S,e)}setFromCamera(S,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(S.x,S.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(S.x,S.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(S,e=!1,u=[]){return N_(S,this,u,e),u.sort(My),u}intersectObjects(S,e=!1,u=[]){for(let y=0,v=S.length;y<v;y++)N_(S[y],this,u,e);return u.sort(My),u}},l.RectAreaLight=Gu,l.RedFormat=1028,l.RedIntegerFormat=1029,l.ReinhardToneMapping=2,l.RepeatWrapping=1e3,l.ReplaceStencilOp=7681,l.ReverseSubtractEquation=102,l.RingBufferGeometry=Oe,l.RingGeometry=Oe,l.SRGB8_ALPHA8_ASTC_10x10_Format=37851,l.SRGB8_ALPHA8_ASTC_10x5_Format=37848,l.SRGB8_ALPHA8_ASTC_10x6_Format=37849,l.SRGB8_ALPHA8_ASTC_10x8_Format=37850,l.SRGB8_ALPHA8_ASTC_12x10_Format=37852,l.SRGB8_ALPHA8_ASTC_12x12_Format=37853,l.SRGB8_ALPHA8_ASTC_4x4_Format=37840,l.SRGB8_ALPHA8_ASTC_5x4_Format=37841,l.SRGB8_ALPHA8_ASTC_5x5_Format=37842,l.SRGB8_ALPHA8_ASTC_6x5_Format=37843,l.SRGB8_ALPHA8_ASTC_6x6_Format=37844,l.SRGB8_ALPHA8_ASTC_8x5_Format=37845,l.SRGB8_ALPHA8_ASTC_8x6_Format=37846,l.SRGB8_ALPHA8_ASTC_8x8_Format=37847,l.Scene=gh,l.SceneUtils=Lx,l.ShaderChunk=os,l.ShaderLib=sl,l.ShaderMaterial=co,l.ShadowMaterial=si,l.Shape=is,l.ShapeBufferGeometry=Ge,l.ShapeGeometry=Ge,l.ShapePath=og,l.ShapeUtils=W,l.ShortType=1011,l.Skeleton=Iu,l.SkeletonHelper=V_,l.SkinnedMesh=Th,l.SmoothShading=2,l.Sphere=Ns,l.SphereBufferGeometry=He,l.SphereGeometry=He,l.Spherical=class{constructor(S=1,e=0,u=0){return this.radius=S,this.phi=e,this.theta=u,this}set(S,e,u){return this.radius=S,this.phi=e,this.theta=u,this}copy(S){return this.radius=S.radius,this.phi=S.phi,this.theta=S.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(S){return this.setFromCartesianCoords(S.x,S.y,S.z)}setFromCartesianCoords(S,e,u){return this.radius=Math.sqrt(S*S+e*e+u*u),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(S,u),this.phi=Math.acos(Fn(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},l.SphericalHarmonics3=Kl,l.SplineCurve=Ep,l.SpotLight=Ja,l.SpotLightHelper=class extends Ee{constructor(S,e){super(),this.light=S,this.light.updateMatrixWorld(),this.matrix=S.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const u=new Pr,y=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let M=0,O=1,V=32;M<V;M++,O++){const G=M/V*Math.PI*2,H=O/V*Math.PI*2;y.push(Math.cos(G),Math.sin(G),1,Math.cos(H),Math.sin(H),1)}u.setAttribute("position",new Un(y,3));const v=new Po({fog:!1,toneMapped:!1});this.cone=new ia(u,v),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const S=this.light.distance?this.light.distance:1e3,e=S*Math.tan(this.light.angle);this.cone.scale.set(e,e,S),U_.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(U_),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},l.Sprite=qa,l.SpriteMaterial=al,l.SrcAlphaFactor=204,l.SrcAlphaSaturateFactor=210,l.SrcColorFactor=202,l.StaticCopyUsage=35046,l.StaticDrawUsage=35044,l.StaticReadUsage=35045,l.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new vo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new vo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(S){const e=this._cache;if(e.focus!==S.focus||e.fov!==S.fov||e.aspect!==S.aspect*this.aspect||e.near!==S.near||e.far!==S.far||e.zoom!==S.zoom||e.eyeSep!==this.eyeSep){e.focus=S.focus,e.fov=S.fov,e.aspect=S.aspect*this.aspect,e.near=S.near,e.far=S.far,e.zoom=S.zoom,e.eyeSep=this.eyeSep;const u=S.projectionMatrix.clone(),y=e.eyeSep/2,v=y*e.near/e.focus,M=e.near*Math.tan(an*e.fov*.5)/e.zoom;let O,V;py.elements[12]=-y,dy.elements[12]=y,O=-M*e.aspect+v,V=M*e.aspect+v,u.elements[0]=2*e.near/(V-O),u.elements[8]=(V+O)/(V-O),this.cameraL.projectionMatrix.copy(u),O=-M*e.aspect-v,V=M*e.aspect-v,u.elements[0]=2*e.near/(V-O),u.elements[8]=(V+O)/(V-O),this.cameraR.projectionMatrix.copy(u)}this.cameraL.matrixWorld.copy(S.matrixWorld).multiply(py),this.cameraR.matrixWorld.copy(S.matrixWorld).multiply(dy)}},l.StreamCopyUsage=35042,l.StreamDrawUsage=35040,l.StreamReadUsage=35041,l.StringKeyframeTrack=Ur,l.SubtractEquation=101,l.SubtractiveBlending=3,l.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},l.TangentSpaceNormalMap=0,l.TetrahedronBufferGeometry=Qe,l.TetrahedronGeometry=Qe,l.TextBufferGeometry=nt,l.TextGeometry=nt,l.Texture=_s,l.TextureLoader=Wr,l.TorusBufferGeometry=tt,l.TorusGeometry=tt,l.TorusKnotBufferGeometry=at,l.TorusKnotGeometry=at,l.Triangle=Ei,l.TriangleFanDrawMode=2,l.TriangleStripDrawMode=1,l.TrianglesDrawMode=0,l.TubeBufferGeometry=wt,l.TubeGeometry=wt,l.UVMapping=300,l.Uint16Attribute=function(S,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new So(S,e)},l.Uint16BufferAttribute=So,l.Uint32Attribute=function(S,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Is(S,e)},l.Uint32BufferAttribute=Is,l.Uint8Attribute=function(S,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new io(S,e)},l.Uint8BufferAttribute=io,l.Uint8ClampedAttribute=function(S,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Ys(S,e)},l.Uint8ClampedBufferAttribute=Ys,l.Uniform=lg,l.UniformsLib=Qn,l.UniformsUtils=zc,l.UnsignedByteType=1009,l.UnsignedInt248Type=1020,l.UnsignedIntType=1014,l.UnsignedShort4444Type=1017,l.UnsignedShort5551Type=1018,l.UnsignedShort565Type=1019,l.UnsignedShortType=1012,l.VSMShadowMap=3,l.Vector2=en,l.Vector3=re,l.Vector4=Dr,l.VectorKeyframeTrack=vs,l.Vertex=function(S,e,u){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new re(S,e,u)},l.VertexColors=2,l.VideoTexture=Hf,l.WebGL1Renderer=Au,l.WebGLCubeRenderTarget=Ks,l.WebGLMultipleRenderTargets=po,l.WebGLMultisampleRenderTarget=ai,l.WebGLRenderTarget=ro,l.WebGLRenderTargetCube=function(S,e,u){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ks(S,u)},l.WebGLRenderer=yn,l.WebGLUtils=Uf,l.WireframeGeometry=Ot,l.WireframeHelper=function(S,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ia(new Ot(S.geometry),new Po({color:e!==void 0?e:16777215}))},l.WrapAroundEnding=2402,l.XHRLoader=function(S){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Gs(S)},l.ZeroCurvatureEnding=2400,l.ZeroFactor=200,l.ZeroSlopeEnding=2401,l.ZeroStencilOp=0,l.sRGBEncoding=3001,Object.defineProperty(l,"__esModule",{value:!0})})}(A0,A0.exports)),A0.exports}var Z1={exports:{}},X1={exports:{}},Y1={exports:{}},kS;function qw(){return kS||(kS=1,function(c,p){const E=.0005555555555555556*Math.PI,D=Math.atan(3/4),N=63710088e-1,B=40075017;c.exports={WORLD_SIZE:1024e3,PROJECTION_WORLD_SIZE:1024e3/(N*Math.PI*2),MERCATOR_A:N,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_RADIUS:N,EARTH_CIRCUMFERENCE:2*Math.PI*N,EARTH_CIRCUMFERENCE_EQUATOR:B,FOV_ORTHO:E,FOV:D,FOV_DEGREES:D*180/Math.PI,TILE_SIZE:512}}(Y1)),Y1.exports}var K1={exports:{}},FS;function Lk(){return FS||(FS=1,function(c,p){function l(){}l.prototype={Coords:function(E){if(E.constructor!==Array){console.error("Coords must be an array");return}if(E.length<2){console.error("Coords length must be at least 2");return}for(const D of E)if(D.constructor!==Number){console.error("Coords values must be numbers");return}if(Math.abs(E[1])>90){console.error("Latitude must be between -90 and 90");return}return E},Line:function(E){var D=this;if(E.constructor!==Array){console.error("Line must be an array");return}for(const N of E)if(!D.Coords(N)){console.error("Each coordinate in a line must be a valid Coords type");return}return E},Rotation:function(E){if(E.constructor===Number)E={z:E};else if(E.constructor===Object)for(const D of Object.keys(E)){if(!["x","y","z"].includes(D)){console.error("Rotation parameters must be x, y, or z");return}if(E[D].constructor!==Number){console.error("Individual rotation values must be numbers");return}}else{console.error("Rotation must be an object or a number");return}return E},Scale:function(E){if(E.constructor===Number)E={x:E,y:E,z:E};else if(E.constructor===Object)for(const D of Object.keys(E)){if(!["x","y","z"].includes(D)){console.error("Scale parameters must be x, y, or z");return}if(E[D].constructor!==Number){console.error("Individual scale values must be numbers");return}}else{console.error("Scale must be an object or a number");return}return E}},c.exports=l}(K1)),K1.exports}var BS;function Lc(){return BS||(BS=1,function(c,p){var l=Na(),E=qw(),D=Lk(),N={prettyPrintMatrix:function(B){for(var n=0;n<4;n++){var X=[B[n],B[n+4],B[n+8],B[n+12]];console.log(X.map(function($){return $.toFixed(4)}))}},makePerspectiveMatrix:function(B,n,X,$){var ne=new l.Matrix4,ve=1/Math.tan(B/2),ze=1/(X-$),ke=[ve/n,0,0,0,0,ve,0,0,0,0,($+X)*ze,-1,0,0,2*$*X*ze,0];return ne.elements=ke,ne},makeOrthographicMatrix:function(B,n,X,$,ne,ve){var ze=new l.Matrix4;const ke=1/(n-B),yt=1/(X-$),it=1/(ve-ne),xt=(n+B)*ke,Ze=(X+$)*yt,st=ne*it;var ti=[2*ke,0,0,0,0,2*yt,0,0,0,0,-1*it,0,-xt,-Ze,-st,1];return ze.elements=ti,ze},radify:function(B){function n(X){return X=X||0,Math.PI*2*X/360}return typeof B=="object"?B.length>0?B.map(function(X){return n(X)}):[n(B.x),n(B.y),n(B.z)]:n(B)},degreeify:function(B){function n(X){return X=X||0,X*360/(Math.PI*2)}return typeof B=="object"?[n(B.x),n(B.y),n(B.z)]:n(B)},projectToWorld:function(B){var n=[-E.MERCATOR_A*E.DEG2RAD*B[0]*E.PROJECTION_WORLD_SIZE,-E.MERCATOR_A*Math.log(Math.tan(Math.PI*.25+.5*E.DEG2RAD*B[1]))*E.PROJECTION_WORLD_SIZE];if(!B[2])n.push(0);else{var X=this.projectedUnitsPerMeter(B[1]);n.push(B[2]*X)}var $=new l.Vector3(n[0],n[1],n[2]);return $},projectedUnitsPerMeter:function(B){return Math.abs(E.WORLD_SIZE/Math.cos(E.DEG2RAD*B)/E.EARTH_CIRCUMFERENCE)},_circumferenceAtLatitude:function(B){return E.EARTH_CIRCUMFERENCE*Math.cos(B*Math.PI/180)},mercatorZfromAltitude:function(B,n){return B/this._circumferenceAtLatitude(n)},_scaleVerticesToMeters:function(B,n){var X=this.projectedUnitsPerMeter(B[1]);this.projectToWorld(B);for(var $=0;$<n.length;$++)n[$].multiplyScalar(X);return n},projectToScreen:function(B){console.log("WARNING: Projecting to screen coordinates is not yet implemented")},unprojectFromScreen:function(B){console.log("WARNING: unproject is not yet implemented")},unprojectFromWorld:function(B){var n=[-B.x/(E.MERCATOR_A*E.DEG2RAD*E.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(B.y/(E.PROJECTION_WORLD_SIZE*-E.MERCATOR_A)))-Math.PI/4)/E.DEG2RAD],X=this.projectedUnitsPerMeter(n[1]),$=B.z||0;return n.push($/X),n},toScreenPosition:function(B,n){var X=new l.Vector3,$=.5*renderer.context.canvas.width,ne=.5*renderer.context.canvas.height;return B.updateMatrixWorld(),X.setFromMatrixPosition(B.matrixWorld),X.project(n),X.x=X.x*$+$,X.y=-(X.y*ne)+ne,{x:X.x,y:X.y}},getFeatureCenter:function(n,X,$){let ne=[],ve=0,ze=0,ke=0,yt=[...n.geometry.coordinates[0]];return n.geometry.type==="Point"?ne=[...yt[0]]:(n.geometry.type==="MultiPolygon"&&(yt=yt[0]),yt.splice(-1,1),yt.forEach(function(it){ve+=it[0],ze+=it[1]}),ne=[ve/yt.length,ze/yt.length]),ke=this.getObjectHeightOnFloor(n,X,$),ne.length<3?ne.push(ke):ne[2]=ke,ne},getObjectHeightOnFloor:function(B,n,X=B.properties.level||0){let $=X*(B.properties.levelHeight||0),ne=B.properties.base_height||B.properties.min_height||0,ze=(n&&n.model?0:B.properties.height-ne)+ne;return $+ze},_flipMaterialSides:function(B){},normalizeVertices(B){let n=new l.BufferGeometry,X=[];for(var $=0;$<B.length;$++){let ze=B[$];X.push(ze.x,ze.y,ze.z),X.push(ze.x,ze.y,ze.z)}n.setAttribute("position",new l.BufferAttribute(new Float32Array(X),3)),n.computeBoundingSphere();var ne=n.boundingSphere.center,ve=B.map(function(ze){var ke=ze.sub(ne);return ke});return{vertices:ve,position:ne}},flattenVectors(B){var n=[];for(let X of B)n.push(X.x,X.y,X.z);return n},lnglatsToWorld:function(B){var n=B.map(function(X){var $=N.projectToWorld(X),ne=new l.Vector3($.x,$.y,$.z);return ne});return n},extend:function(B,n){for(let X in n)B[X]=n[X]},clone:function(B){var n={};for(let X in B)n[X]=B[X];return n},clamp:function(B,n,X){return Math.min(X,Math.max(n,B))},types:{rotation:function(B,n){B||(B=0),typeof B=="number"&&(B={z:B});var X=this.applyDefault([B.x,B.y,B.z],n),$=N.radify(X);return $},scale:function(B,n){return B||(B=1),typeof B=="number"?B=[B,B,B]:this.applyDefault([B.x,B.y,B.z],n)},applyDefault:function(B,n){var X=B.map(function($,ne){return $=$||n[ne],$});return X}},toDecimal:function(B,n){return Number(B.toFixed(n))},equal:function(B,n){const X=Object.keys(B),$=Object.keys(n);if(X.length!==$.length||X.length==0&&$.length==0&&X!==$)return!1;for(const ne of X){const ve=B[ne],ze=n[ne],ke=this.isObject(ve)&&this.isObject(ze);if(ke&&!equal(ve,ze)||!ke&&ve!==ze)return!1}return!0},isObject:function(B){return B!=null&&typeof B=="object"},curveToLine:(B,n)=>{let{width:X,color:$}=n,ne=new l.BufferGeometry().setFromPoints(B.getPoints(100)),ve=new l.LineBasicMaterial({color:$,linewidth:X});return new l.Line(ne,ve)},curvesToLines:B=>{var n=[16711680,2031360,2490623],X=B.map(($,ne)=>{let ve={width:3,color:n[ne]||"purple"};return curveToLine($,ve)});return X},_validate:function(B,n){B=B||{};var X={};N.extend(X,B);for(let $ of Object.keys(n))if(B[$]===void 0)if(n[$]===null){console.error($+" is required");return}else X[$]=n[$];else X[$]=B[$];return X},Validator:new D,exposedMethods:["projectToWorld","projectedUnitsPerMeter","extend","unprojectFromWorld"]};c.exports=N}(X1)),X1.exports}var NS;function Ik(){return NS||(NS=1,function(c,p){const l=Na(),E=Lc(),D=qw();function N(B,n,X){this.map=B,this.camera=n,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=X||new l.Group,this.world.position.x=this.world.position.y=D.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1,this.state={translateCenter:new l.Matrix4().makeTranslation(D.WORLD_SIZE/2,-D.WORLD_SIZE/2,0),worldSizeRatio:D.TILE_SIZE/D.WORLD_SIZE,worldSize:D.TILE_SIZE*this.map.transform.scale};let $=this;this.map.on("move",function(){$.updateCamera()}).on("resize",function(){$.setupCamera()}),this.setupCamera()}N.prototype={setupCamera:function(){const B=this.map.transform;this.camera.aspect=B.width/B.height,this.halfFov=B._fov/2,this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*B.height;const n=B._maxPitch*Math.PI/180;this.acuteAngle=Math.PI/2-n,this.updateCamera()},updateCamera:function(B){if(!this.camera){console.log("nocamera");return}const n=this.map.transform;this.camera.aspect=n.width/n.height;const X=n.centerOffset||new l.Vector3;let $=0,ne=0;this.halfFov=n._fov/2;const ve=Math.PI/2+n._pitch,ze=Math.cos(Math.PI/2-n._pitch);this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*n.height;let ke=1;const yt=this.worldSize();if(this.map.tb.mapboxVersion>=2){ke=this.mercatorZfromAltitude(1,n.center.lat)*yt;const qe=n._fov*(.5+n.centerOffset.y/n.height),gt=n.elevation?n.elevation.getMinElevationBelowMSL()*ke:0,lt=(n._camera.position[2]*yt-gt)/Math.cos(n._pitch),vt=Math.sin(qe)*lt/Math.sin(E.clamp(Math.PI-ve-qe,.01,Math.PI-.01));ne=ze*vt+lt;const Jt=lt*(1/n._horizonShift);$=Math.min(ne*1.01,Jt)}else{const qe=Math.sin(this.halfFov)*this.cameraToCenterDistance/Math.sin(Math.PI-ve-this.halfFov);ne=ze*qe+this.cameraToCenterDistance,$=ne*1.01}this.cameraTranslateZ=new l.Matrix4().makeTranslation(0,0,this.cameraToCenterDistance);const it=n.height/50,xt=Math.max(it*ze,it),Ze=n.height,st=n.width;this.camera instanceof l.OrthographicCamera?this.camera.projectionMatrix=E.makeOrthographicMatrix(st/-2,st/2,Ze/2,Ze/-2,xt,$):this.camera.projectionMatrix=E.makePerspectiveMatrix(n._fov,st/Ze,xt,$),this.camera.projectionMatrix.elements[8]=-X.x*2/n.width,this.camera.projectionMatrix.elements[9]=X.y*2/n.height;let ti=this.calcCameraMatrix(n._pitch,n.angle);n.elevation&&(ti.elements[14]=n._camera.position[2]*yt),this.camera.matrixWorld.copy(ti);let mt=n.scale*this.state.worldSizeRatio,pt=new l.Matrix4,Tt=new l.Matrix4,Fe=new l.Matrix4;pt.makeScale(mt,mt,mt);let et=n.x||n.point.x,Xe=n.y||n.point.y;Tt.makeTranslation(-et,Xe,0),Fe.makeRotationZ(Math.PI),this.world.matrix=new l.Matrix4().premultiply(Fe).premultiply(this.state.translateCenter).premultiply(pt).premultiply(Tt),this.map.fire("CameraSynced",{detail:{nearZ:xt,farZ:$,pitch:n._pitch,angle:n.angle,furthestDistance:ne,cameraToCenterDistance:this.cameraToCenterDistance,t:this.map.transform,tbProjMatrix:this.camera.projectionMatrix.elements,tbWorldMatrix:this.world.matrix.elements,cameraSyn:N}})},worldSize(){let B=this.map.transform;return B.tileSize*B.scale},worldSizeFromZoom(){let B=this.map.transform;return Math.pow(2,B.zoom)*B.tileSize},mercatorZfromAltitude(B,n){return B/this.circumferenceAtLatitude(n)},mercatorZfromZoom(){return this.cameraToCenterDistance/this.worldSizeFromZoom()},circumferenceAtLatitude(B){return D.EARTH_CIRCUMFERENCE*Math.cos(B*Math.PI/180)},calcCameraMatrix(B,n,X){const $=this.map.transform,ne=B===void 0?$._pitch:B,ve=n===void 0?$.angle:n,ze=X===void 0?this.cameraTranslateZ:X;return new l.Matrix4().premultiply(ze).premultiply(new l.Matrix4().makeRotationX(ne)).premultiply(new l.Matrix4().makeRotationZ(ve))},updateCameraState(){let B=this.map.transform;if(!B.height)return;const n=B._camera.forward(),X=B.cameraToCenterDistance,$=B.point;B._cameraZoom?B._cameraZoom:B._zoom;const ve=this.mercatorZfromZoom(B)-this.mercatorZfromAltitude(B._centerAltitude,B.center.lat),ze=B.cameraToCenterDistance/ve;return[$.x/this.worldSize()-n[0]*X/ze,$.y/this.worldSize()-n[1]*X/ze,this.mercatorZfromAltitude(B._centerAltitude,B._center.lat)+-n[2]*X/ze]},getWorldToCamera(B,n){let X=this.map.transform;const $=new l.Matrix4,ne=new l.Matrix4,ve=X._camera._orientation,ze=X._camera.position,ke=new l.Vector3(ze[0],ze[1],ze[2]),yt=new l.Quaternion;yt.set(ve[0],ve[1],ve[2],ve[3]);const it=yt.conjugate();return ke.multiplyScalar(-B),ne.makeTranslation(ke.x,ke.y,ke.z),$.makeRotationFromQuaternion(it).premultiply(ne),$.elements[1]*=-1,$.elements[5]*=-1,$.elements[9]*=-1,$.elements[13]*=-1,$.elements[8]*=n,$.elements[9]*=n,$.elements[10]*=n,$.elements[11]*=n,$},translate(B,n,X){let $=X[0]||X.x,ne=X[1]||X.y,ve=X[2]||X.z,ze,ke,yt,it,xt,Ze,st,ti,mt,pt,Tt,Fe;return n===B?(B[12]=n[0]*$+n[4]*ne+n[8]*ve+n[12],B[13]=n[1]*$+n[5]*ne+n[9]*ve+n[13],B[14]=n[2]*$+n[6]*ne+n[10]*ve+n[14],B[15]=n[3]*$+n[7]*ne+n[11]*ve+n[15]):(ze=n[0],ke=n[1],yt=n[2],it=n[3],xt=n[4],Ze=n[5],st=n[6],ti=n[7],mt=n[8],pt=n[9],Tt=n[10],Fe=n[11],B[0]=ze,B[1]=ke,B[2]=yt,B[3]=it,B[4]=xt,B[5]=Ze,B[6]=st,B[7]=ti,B[8]=mt,B[9]=pt,B[10]=Tt,B[11]=Fe,B[12]=ze*$+xt*ne+mt*ve+n[12],B[13]=ke*$+Ze*ne+pt*ve+n[13],B[14]=yt*$+st*ne+Tt*ve+n[14],B[15]=it*$+ti*ne+Fe*ve+n[15]),B}},c.exports=N}(Z1)),Z1.exports}var J1={exports:{}},US;function q3(){return US||(US=1,function(c,p){(function(){var l=Math.PI,E=Math.sin,D=Math.cos,N=Math.tan,B=Math.asin,n=Math.atan2,X=Math.acos,$=l/180,ne=1e3*60*60*24,ve=2440588,ze=2451545;function ke(Ft){return Ft.valueOf()/ne-.5+ve}function yt(Ft){return new Date((Ft+.5-ve)*ne)}function it(Ft){return ke(Ft)-ze}var xt=$*23.4397;function Ze(Ft,bt){return n(E(Ft)*D(xt)-N(bt)*E(xt),D(Ft))}function st(Ft,bt){return B(E(bt)*D(xt)+D(bt)*E(xt)*E(Ft))}function ti(Ft,bt,Vt){return n(E(Ft),D(Ft)*E(bt)-N(Vt)*D(bt))}function mt(Ft,bt,Vt){return B(E(bt)*E(Vt)+D(bt)*D(Vt)*D(Ft))}function pt(Ft,bt){return $*(280.16+360.9856235*Ft)-bt}function Tt(Ft){return Ft<0&&(Ft=0),2967e-7/Math.tan(Ft+.00312536/(Ft+.08901179))}function Fe(Ft){return $*(357.5291+.98560028*Ft)}function et(Ft){var bt=$*(1.9148*E(Ft)+.02*E(2*Ft)+3e-4*E(3*Ft)),Vt=$*102.9372;return Ft+bt+Vt+l}function Xe(Ft){var bt=Fe(Ft),Vt=et(bt);return{dec:st(Vt,0),ra:Ze(Vt,0)}}var qe={};qe.getPosition=function(Ft,bt,Vt){var Ht=$*-Vt,ni=$*bt,zi=it(Ft),Hi=Xe(zi),on=pt(zi,Ht)-Hi.ra;return{azimuth:ti(on,ni,Hi.dec),altitude:mt(on,ni,Hi.dec)}},qe.toJulian=function(Ft){return ke(Ft)};var gt=qe.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];qe.addTime=function(Ft,bt,Vt){gt.push([Ft,bt,Vt])};var lt=9e-4;function vt(Ft,bt){return Math.round(Ft-lt-bt/(2*l))}function Jt(Ft,bt,Vt){return lt+(Ft+bt)/(2*l)+Vt}function le(Ft,bt,Vt){return ze+Ft+.0053*E(bt)-.0069*E(2*Vt)}function we(Ft,bt,Vt){return X((E(Ft)-E(bt)*E(Vt))/(D(bt)*D(Vt)))}function xe(Ft){return-2.076*Math.sqrt(Ft)/60}function De(Ft,bt,Vt,Ht,ni,zi,Hi){var on=we(Ft,Vt,Ht),mn=Jt(on,bt,ni);return le(mn,zi,Hi)}qe.getTimes=function(Ft,bt,Vt,Ht){Ht=Ht||0;var ni=$*-Vt,zi=$*bt,Hi=xe(Ht),on=it(Ft),mn=vt(on,ni),ot=Jt(0,ni,mn),Yn=Fe(ot),pr=et(Yn),At=st(pr,0),Ye=le(ot,Yn,pr),kt,Le,Ie,Ue,We,rt,ut={solarNoon:yt(Ye),nadir:yt(Ye-.5)};for(kt=0,Le=gt.length;kt<Le;kt+=1)Ie=gt[kt],Ue=(Ie[0]+Hi)*$,We=De(Ue,ni,zi,At,mn,Yn,pr),rt=Ye-(We-Ye),ut[Ie[1]]=yt(rt),ut[Ie[2]]=yt(We);return ut};function Ce(Ft){var bt=$*(218.316+13.176396*Ft),Vt=$*(134.963+13.064993*Ft),Ht=$*(93.272+13.22935*Ft),ni=bt+$*6.289*E(Vt),zi=$*5.128*E(Ht),Hi=385001-20905*D(Vt);return{ra:Ze(ni,zi),dec:st(ni,zi),dist:Hi}}qe.getMoonPosition=function(Ft,bt,Vt){var Ht=$*-Vt,ni=$*bt,zi=it(Ft),Hi=Ce(zi),on=pt(zi,Ht)-Hi.ra,mn=mt(on,ni,Hi.dec),ot=n(E(on),N(ni)*D(Hi.dec)-E(Hi.dec)*D(on));return mn=mn+Tt(mn),{azimuth:ti(on,ni,Hi.dec),altitude:mn,distance:Hi.dist,parallacticAngle:ot}},qe.getMoonIllumination=function(Ft){var bt=it(Ft||new Date),Vt=Xe(bt),Ht=Ce(bt),ni=149598e3,zi=X(E(Vt.dec)*E(Ht.dec)+D(Vt.dec)*D(Ht.dec)*D(Vt.ra-Ht.ra)),Hi=n(ni*E(zi),Ht.dist-ni*D(zi)),on=n(D(Vt.dec)*E(Vt.ra-Ht.ra),E(Vt.dec)*D(Ht.dec)-D(Vt.dec)*E(Ht.dec)*D(Vt.ra-Ht.ra));return{fraction:(1+D(Hi))/2,phase:.5+.5*Hi*(on<0?-1:1)/Math.PI,angle:on}};function Gt(Ft,bt){return new Date(Ft.valueOf()+bt*ne/24)}qe.getMoonTimes=function(Ft,bt,Vt,Ht){var ni=new Date(Ft);Ht?ni.setUTCHours(0,0,0,0):ni.setHours(0,0,0,0);for(var zi=.133*$,Hi=qe.getMoonPosition(ni,bt,Vt).altitude-zi,on,mn,ot,Yn,pr,At,Ye,kt,Le,Ie,Ue,We,rt,ut=1;ut<=24&&(on=qe.getMoonPosition(Gt(ni,ut),bt,Vt).altitude-zi,mn=qe.getMoonPosition(Gt(ni,ut+1),bt,Vt).altitude-zi,pr=(Hi+mn)/2-on,At=(mn-Hi)/2,Ye=-At/(2*pr),kt=(pr*Ye+At)*Ye+on,Le=At*At-4*pr*on,Ie=0,Le>=0&&(rt=Math.sqrt(Le)/(Math.abs(pr)*2),Ue=Ye-rt,We=Ye+rt,Math.abs(Ue)<=1&&Ie++,Math.abs(We)<=1&&Ie++,Ue<-1&&(Ue=We)),Ie===1?Hi<0?ot=ut+Ue:Yn=ut+Ue:Ie===2&&(ot=ut+(kt<0?We:Ue),Yn=ut+(kt<0?Ue:We)),!(ot&&Yn));ut+=2)Hi=mn;var ht={};return ot&&(ht.rise=Gt(ni,ot)),Yn&&(ht.set=Gt(ni,Yn)),!ot&&!Yn&&(ht[kt>0?"alwaysUp":"alwaysDown"]=!0),ht},c.exports=qe})()}(J1)),J1.exports}var Q1={exports:{}},eb={exports:{}},VS;function dx(){return VS||(VS=1,function(c,p){var l=Lc(),E=Na(),D={material:"MeshBasicMaterial",color:"black",opacity:1};function N(B){var n;B?(B=l._validate(B,D),B.material&&B.material.isMaterial?n=B.material:B.material||B.color||B.opacity?n=new E[B.material]({color:B.color,transparent:B.opacity<1}):n=X(),n.opacity=B.opacity,B.side&&(n.side=B.side)):n=X();function X(){return new E[D.material]({color:D.color})}return n}c.exports=N}(eb)),eb.exports}var ib={exports:{}},GS;function Rk(){return GS||(GS=1,function(c,p){const l=Na(),E=Lc();function D(B){this.map=B,this.enrolledObjects=[],this.previousFrameTime}D.prototype={unenroll:function(B){this.enrolledObjects.splice(this.enrolledObjects.indexOf(B),1)},enroll:function(B){if(B.clock=new l.Clock,B.hasDefaultAnimation=!1,B.defaultAction,B.actions=[],B.mixer,B.animations&&B.animations.length>0){B.hasDefaultAnimation=!0;let $=B.userData.defaultAnimation?B.userData.defaultAnimation:0;B.mixer=new l.AnimationMixer(B),n($)}function n($){for(let ne=0;ne<B.animations.length;ne++){$>B.animations.length&&console.log("The animation index "+$+" doesn't exist for this object");let ve=B.animations[ne],ze=B.mixer.clipAction(ve);B.actions.push(ze),$===ne?(B.defaultAction=ze,ze.setEffectiveWeight(1)):ze.setEffectiveWeight(0),ze.play()}}let X=!1;Object.defineProperty(B,"isPlaying",{get(){return X},set($){X!=$&&(X=$,B.dispatchEvent({type:"IsPlayingChanged",detail:B}))}}),this.enrolledObjects.push(B),B.animationQueue=[],B.set=function($){if($.duration>0){let ne={start:Date.now(),expiration:Date.now()+$.duration,endState:{}};E.extend($,ne);let ve=$.coords,ze=$.rotation,ke=$.scale||$.scaleX||$.scaleY||$.scaleZ;if(ze){let it=B.rotation;$.startRotation=[it.x,it.y,it.z],$.endState.rotation=E.types.rotation($.rotation,$.startRotation),$.rotationPerMs=$.endState.rotation.map(function(xt,Ze){return(xt-$.startRotation[Ze])/$.duration})}if(ke){let it=B.scale;$.startScale=[it.x,it.y,it.z],$.endState.scale=E.types.scale($.scale,$.startScale),$.scalePerMs=$.endState.scale.map(function(xt,Ze){return(xt-$.startScale[Ze])/$.duration})}ve&&($.pathCurve=new l.CatmullRomCurve3(E.lnglatsToWorld([B.coordinates,$.coords])));let yt={type:"set",parameters:$};this.animationQueue.push(yt),tb.map.repaint=!0}else this.stop(),$.rotation=E.radify($.rotation),this._setObject($);return this},B.animationMethod=null,B.stop=function($){return B.mixer&&(B.isPlaying=!1,cancelAnimationFrame(B.animationMethod)),this.animationQueue=[],this},B.followPath=function($,ne){let ve={type:"followPath",parameters:E._validate($,N.followPath)};return E.extend(ve.parameters,{pathCurve:new l.CatmullRomCurve3(E.lnglatsToWorld($.path)),start:Date.now(),expiration:Date.now()+ve.parameters.duration,cb:ne}),this.animationQueue.push(ve),tb.map.repaint=!0,this},B._setObject=function($){B.setScale();let ne=$.position,ve=$.rotation,ze=$.scale,ke=$.worldCoordinates,yt=$.quaternion,it=$.translate,xt=$.worldTranslate;if(ne){this.coordinates=ne;let st=E.projectToWorld(ne);this.position.copy(st)}if(it){this.coordinates=[this.coordinates[0]+it[0],this.coordinates[1]+it[1],this.coordinates[2]+it[2]];let st=E.projectToWorld(it);this.position.copy(st),$.position=this.coordinates}if(xt){this.translateX(xt.x),this.translateY(xt.y),this.translateZ(xt.z);let st=E.unprojectFromWorld(this.position);this.coordinates=$.position=st}if(ve&&(this.rotation.set(ve[0],ve[1],ve[2]),$.rotation=new l.Vector3(ve[0],ve[1],ve[2])),ze&&(this.scale.set(ze[0],ze[1],ze[2]),$.scale=this.scale),yt&&(this.quaternion.setFromAxisAngle(yt[0],yt[1]),$.rotation=yt[0].multiplyScalar(yt[1])),ke){this.position.copy(ke);let st=E.unprojectFromWorld(ke);this.coordinates=$.position=st}this.setBoundingBoxShadowFloor(),this.setReceiveShadowFloor(),this.updateMatrixWorld(),tb.map.repaint=!0;let Ze={type:"ObjectChanged",detail:{object:this,action:{position:$.position,rotation:$.rotation,scale:$.scale}}};this.dispatchEvent(Ze)},B.playDefault=function($){if(B.mixer&&B.hasDefaultAnimation){let ne={start:Date.now(),expiration:Date.now()+$.duration,endState:{}};E.extend($,ne),B.mixer.timeScale=$.speed||1;let ve={type:"playDefault",parameters:$};return this.animationQueue.push(ve),tb.map.repaint=!0,this}},B.playAnimation=function($){B.mixer&&($.animation&&n($.animation),B.playDefault($))},B.pauseAllActions=function(){B.mixer&&B.actions.forEach(function($){$.paused=!0})},B.unPauseAllActions=function(){B.mixer&&B.actions.forEach(function($){$.paused=!1})},B.deactivateAllActions=function(){B.mixer&&B.actions.forEach(function($){$.stop()})},B.activateAllActions=function(){B.mixer&&B.actions.forEach(function($){$.play()})},B.idle=function(){return B.mixer&&B.mixer.update(.01),tb.map.repaint=!0,this}},update:function(B){if(this.previousFrameTime===void 0&&(this.previousFrameTime=B),!this.enrolledObjects)return!1;for(let n=this.enrolledObjects.length-1;n>=0;n--){let X=this.enrolledObjects[n];if(!(!X.animationQueue||X.animationQueue.length===0))for(let $=X.animationQueue.length-1;$>=0;$--){let ne=X.animationQueue[$];if(!ne)continue;let ve=ne.parameters;if(!ve.expiration){X.animationQueue.splice($,1),X.animationQueue[$]&&(X.animationQueue[$].parameters.start=B);return}if(B>=ve.expiration)ve.expiration=!1,ne.type==="playDefault"?X.stop():(ve.endState&&X._setObject(ve.endState),typeof ve.cb<"u"&&ve.cb());else{let ke=(B-ve.start)/ve.duration;if(ne.type==="set"){let yt={};ve.pathCurve&&(yt.worldCoordinates=ve.pathCurve.getPoint(ke)),ve.rotationPerMs&&(yt.rotation=ve.startRotation.map(function(it,xt){return it+ve.rotationPerMs[xt]*ke*ve.duration})),ve.scalePerMs&&(yt.scale=ve.startScale.map(function(it,xt){return it+ve.scalePerMs[xt]*ke*ve.duration})),X._setObject(yt)}if(ne.type==="followPath"){let it={worldCoordinates:ve.pathCurve.getPointAt(ke)};if(ve.trackHeading){let xt=ve.pathCurve.getTangentAt(ke).normalize(),Ze=new l.Vector3(0,0,0),st=new l.Vector3(0,1,0);Ze.crossVectors(st,xt).normalize();let ti=Math.acos(st.dot(xt));it.quaternion=[Ze,ti]}X._setObject(it)}ne.type==="playDefault"&&(X.activateAllActions(),X.isPlaying=!0,X.animationMethod=requestAnimationFrame(this.update),X.mixer.update(X.clock.getDelta()),tb.map.repaint=!0)}}}this.previousFrameTime=B}};const N={followPath:{path:null,duration:1e3,trackHeading:!0}};c.exports=D}(ib)),ib.exports}var nb={exports:{}},HS;function px(){return HS||(HS=1,function(c,p){const l=Na();(function(){class E extends l.Object3D{constructor(ve){super(),this.element=ve||document.createElement("div"),this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.alwaysVisible=!1,Object.defineProperty(this,"layer",{get(){return this.parent&&this.parent.parent?this.parent.parent.layer:null}}),this.dispose=function(){this.remove(),this.element=null},this.remove=function(){this.element instanceof Element&&this.element.parentNode!==null&&this.element.parentNode.removeChild(this.element)},this.addEventListener("removed",function(){this.remove()})}copy(ve,ze){return super.copy(ve,ze),this.element=ve.element.cloneNode(!0),this}}E.prototype.isCSS2DObject=!0;const D=new l.Vector3,N=new l.Matrix4,B=new l.Matrix4,n=new l.Vector3,X=new l.Vector3;class ${constructor(){const ve=this;let ze,ke,yt,it;const xt={objects:new WeakMap,list:new Map};this.cacheList=xt.list;const Ze=document.createElement("div");Ze.style.overflow="hidden",this.domElement=Ze,this.getSize=function(){return{width:ze,height:ke}},this.render=function(Tt,Fe){Tt.autoUpdate===!0&&Tt.updateMatrixWorld(),Fe.parent===null&&Fe.updateMatrixWorld(),N.copy(Fe.matrixWorldInverse),B.multiplyMatrices(Fe.projectionMatrix,N),st(Tt,Tt,Fe),pt(Tt)},this.setSize=function(Tt,Fe){ze=Tt,ke=Fe,yt=ze/2,it=ke/2,Ze.style.width=Tt+"px",Ze.style.height=Fe+"px"};function st(Tt,Fe,et){if(Tt.isCSS2DObject)if(!Tt.visible)xt.objects.delete({key:Tt.uuid}),xt.list.delete(Tt.uuid),Tt.remove();else{Tt.onBeforeRender(ve,Fe,et),D.setFromMatrixPosition(Tt.matrixWorld),D.applyMatrix4(B);const qe=Tt.element;var Xe;/apple/i.test(navigator.vendor)?Xe="translate(-50%,-50%) translate("+Math.round(D.x*yt+yt)+"px,"+Math.round(-D.y*it+it)+"px)":Xe="translate(-50%,-50%) translate("+(D.x*yt+yt)+"px,"+(-D.y*it+it)+"px)",qe.style.WebkitTransform=Xe,qe.style.MozTransform=Xe,qe.style.oTransform=Xe,qe.style.transform=Xe,qe.style.display=Tt.visible&&D.z>=-1&&D.z<=1?"":"none";const gt={distanceToCameraSquared:ti(et,Tt)};xt.objects.set({key:Tt.uuid},gt),xt.list.set(Tt.uuid,Tt),qe.parentNode!==Ze&&Ze.appendChild(qe),Tt.onAfterRender(ve,Fe,et)}for(let qe=0,gt=Tt.children.length;qe<gt;qe++)st(Tt.children[qe],Fe,et)}function ti(Tt,Fe){return n.setFromMatrixPosition(Tt.matrixWorld),X.setFromMatrixPosition(Fe.matrixWorld),n.distanceToSquared(X)}function mt(Tt){const Fe=[];return Tt.traverse(function(et){et.isCSS2DObject&&Fe.push(et)}),Fe}function pt(Tt){const Fe=mt(Tt).sort(function(Xe,qe){let gt=xt.objects.get({key:Xe.uuid}),lt=xt.objects.get({key:qe.uuid});if(gt&&lt){const vt=gt.distanceToCameraSquared,Jt=lt.distanceToCameraSquared;return vt-Jt}}),et=Fe.length;for(let Xe=0,qe=Fe.length;Xe<qe;Xe++)Fe[Xe].element.style.zIndex=et-Xe}}}l.CSS2DObject=E,l.CSS2DRenderer=$})(),c.exports={CSS2DRenderer:l.CSS2DRenderer,CSS2DObject:l.CSS2DObject}}(nb)),nb.exports}var jS;function qd(){return jS||(jS=1,function(c,p){const l=Lc();dx();const E=Na(),D=Rk(),N=px();function B(){}B.prototype={line:function(n){n=l._validate(n,this._defaults.line);var X=l.lnglatsToWorld(n.geometry),$=l.normalizeVertices(X),ne=l.flattenVectors($.vertices),ve=new Float32Array(ne),ze=new E.BufferGeometry;ze.setAttribute("position",new E.BufferAttribute(ve,3));var ke=new E.LineBasicMaterial({color:16711680,linewidth:21}),yt=new E.Line(ze,ke);return yt.options=options||{},yt.position.copy($.position),yt},extrusion:function(n){},unenroll:function(n,X){var $=this;X||$.animationManager.unenroll(n)},_addMethods:function(n,X){var $=this;const ne="label",ve="tooltip",ze="help",ke="shadowPlane";if(!X){let Ze=function(lt,vt,Jt,le){let we=l.radify(le);lt.position.sub(vt),lt.position.applyAxisAngle(Jt,we),lt.position.add(vt),lt.rotateOnAxis(Jt,we),tb.map.repaint=!0},gt=function(lt){return Math.pow(2,lt)};var it=Ze,xt=gt;n.coordinates||(n.coordinates=[0,0,0]),Object.defineProperty(n,"model",{get(){return n.getObjectByName("model")}}),Object.defineProperty(n,"animations",{get(){const lt=n.model;return lt?lt.animations:null}}),$.animationManager.enroll(n),n.setCoords=function(lt){return n.userData.topMargin&&n.userData.feature&&(lt[2]+=((n.userData.feature.properties.height||0)-(n.userData.feature.properties.base_height||n.userData.feature.properties.min_height||0))*(n.userData.topMargin||0)),n.coordinates=lt,n.set({position:lt}),n},n.setTranslate=function(lt){return n.set({translate:lt}),n},n.setRotation=function(lt){typeof lt=="number"&&(lt={z:lt});var vt={x:l.radify(lt.x)||n.rotation.x,y:l.radify(lt.y)||n.rotation.y,z:l.radify(lt.z)||n.rotation.z};n._setObject({rotation:[vt.x,vt.y,vt.z]})},n.calculateAdjustedPosition=function(lt,vt,Jt){let le=lt.slice(),we=l.unprojectFromWorld(n.modelSize);return Jt?(le[0]-=vt.x!=0?we[0]/vt.x:0,le[1]-=vt.y!=0?we[1]/vt.y:0,le[2]-=vt.z!=0?we[2]/vt.z:0):(le[0]+=vt.x!=0?we[0]/vt.x:0,le[1]+=vt.y!=0?we[1]/vt.y:0,le[2]+=vt.z!=0?we[2]/vt.z:0),le},n.setRotationAxis=function(lt){typeof lt=="number"&&(lt={z:lt});let vt=n.modelBox(),Jt=new E.Vector3(vt.max.x,vt.max.y,vt.min.z);lt.x!=0&&Ze(n,Jt,new E.Vector3(0,0,1),lt.x),lt.y!=0&&Ze(n,Jt,new E.Vector3(0,0,1),lt.y),lt.z!=0&&Ze(n,Jt,new E.Vector3(0,0,1),lt.z)},Object.defineProperty(n,"scaleGroup",{get(){return n.getObjectByName("scaleGroup")}}),Object.defineProperty(n,"boxGroup",{get(){return n.getObjectByName("boxGroup")}}),Object.defineProperty(n,"boundingBox",{get(){return n.getObjectByName("boxModel")}}),Object.defineProperty(n,"boundingBoxShadow",{get(){return n.getObjectByName("boxShadow")}}),n.drawBoundingBox=function(){let lt=n.box3(),vt=new E.Group;vt.name="boxGroup",vt.updateMatrixWorld(!0);let Jt=new E.Box3Helper(lt,B.prototype._defaults.colors.yellow);Jt.name="boxModel",vt.add(Jt),Jt.layers.disable(0);let le=lt.clone();le.max.z=le.min.z;let we=new E.Box3Helper(le,B.prototype._defaults.colors.black);we.name="boxShadow",vt.add(we),we.layers.disable(0),vt.visible=!1,n.scaleGroup.add(vt),n.setBoundingBoxShadowFloor()},n.setBoundingBoxShadowFloor=function(){if(n.boundingBoxShadow){let lt=-n.modelHeight,vt=n.rotation,Jt=n.boundingBoxShadow;Jt.box.max.z=Jt.box.min.z=lt,Jt.rotation.y=vt.y,Jt.rotation.x=-vt.x}},n.setAnchor=function(lt){const vt=n.box3(),Jt=vt.getCenter(new E.Vector3);switch(n.none={x:0,y:0,z:0},n.center={x:Jt.x,y:Jt.y,z:vt.min.z},n.bottom={x:Jt.x,y:vt.max.y,z:vt.min.z},n.bottomLeft={x:vt.max.x,y:vt.max.y,z:vt.min.z},n.bottomRight={x:vt.min.x,y:vt.max.y,z:vt.min.z},n.top={x:Jt.x,y:vt.min.y,z:vt.min.z},n.topLeft={x:vt.max.x,y:vt.min.y,z:vt.min.z},n.topRight={x:vt.min.x,y:vt.min.y,z:vt.min.z},n.left={x:vt.max.x,y:Jt.y,z:vt.min.z},n.right={x:vt.min.x,y:Jt.y,z:vt.min.z},lt){case"center":n.anchor=n.center;break;case"top":n.anchor=n.top;break;case"top-left":n.anchor=n.topLeft;break;case"top-right":n.anchor=n.topRight;break;case"left":n.anchor=n.left;break;case"right":n.anchor=n.right;break;case"bottom":n.anchor=n.bottom;break;case"bottom-left":default:n.anchor=n.bottomLeft;break;case"bottom-right":n.anchor=n.bottomRight;break;case"auto":case"none":n.anchor=n.none}n.model.position.set(-n.anchor.x,-n.anchor.y,-n.anchor.z)},n.setCenter=function(lt){if(lt&&(lt.x!=0||lt.y!=0||lt.z!=0)){let vt=n.getSize();n.anchor={x:n.anchor.x-vt.x*lt.x,y:n.anchor.y-vt.y*lt.y,z:n.anchor.z-vt.z*lt.z},n.model.position.set(-n.anchor.x,-n.anchor.y,-n.anchor.z)}},Object.defineProperty(n,"label",{get(){return n.getObjectByName(ne)}}),Object.defineProperty(n,"tooltip",{get(){return n.getObjectByName(ve)}}),Object.defineProperty(n,"help",{get(){return n.getObjectByName(ze)}});let st=!1;Object.defineProperty(n,"hidden",{get(){return st},set(lt){st!=lt&&(st=lt,n.visibility=!st)}}),Object.defineProperty(n,"visibility",{get(){return n.visible},set(lt){let vt=lt;if(lt=="visible"||lt==!0)vt=!0,n.label&&(n.label.visible=vt);else if(lt=="none"||lt==!1)vt=!1,n.label&&n.label.alwaysVisible&&(n.label.visible=vt),n.tooltip&&(n.tooltip.visible=vt);else return;if(n.visible!=vt){if(n.hidden&&vt)return;n.visible=vt,n.model&&n.model.traverse(function(Jt){(Jt.type=="Mesh"||Jt.type=="SkinnedMesh")&&(vt&&n.raycasted?Jt.layers.enable(0):Jt.layers.disable(0)),Jt.type=="LineSegments"&&Jt.layers.disableAll()})}}}),n.addLabel=function(lt,vt,Jt,le){lt&&n.drawLabelHTML(lt,vt,Jt,le)},n.removeLabel=function(){n.removeCSS2D(ne)},n.drawLabelHTML=function(lt,vt=!1,Jt=n.anchor,le=.5){let we=$.drawLabelHTML(lt,B.prototype._defaults.label.cssClass),xe=n.addCSS2D(we,ne,Jt,le);return xe.alwaysVisible=vt,xe.visible=vt,xe},n.addTooltip=function(lt,vt,Jt,le=!0,we=1){let xe=n.addHelp(lt,ve,vt,Jt,we);xe.visible=!1,xe.custom=le},n.removeTooltip=function(){n.removeCSS2D(ve)},n.addHelp=function(lt,vt=ze,Jt=!1,le=n.anchor,we=0){let xe=$.drawTooltip(lt,Jt),De=n.addCSS2D(xe,vt,le,we);return De.visible=!0,De},n.removeHelp=function(){n.removeCSS2D(ze)},n.addCSS2D=function(lt,vt,Jt=n.anchor,le=1){if(lt){const we=n.box3(),xe=we.getSize(new E.Vector3);let De={x:we.max.x,y:we.max.y,z:we.min.z};n.removeCSS2D(vt);let Ce=new N.CSS2DObject(lt);return Ce.name=vt,Ce.position.set(-xe.x*.5-n.model.position.x-Jt.x+De.x,-xe.y*.5-n.model.position.y-Jt.y+De.y,xe.z*le),Ce.visible=!1,n.scaleGroup.add(Ce),Ce}},n.removeCSS2D=function(lt){let vt=n.getObjectByName(lt);if(vt){vt.dispose();let Jt=n.scaleGroup.children;Jt.splice(Jt.indexOf(vt),1)}},Object.defineProperty(n,"shadowPlane",{get(){return n.getObjectByName(ke)}});let ti=!1;Object.defineProperty(n,"castShadow",{get(){return ti},set(lt){if(!(!n.model||ti===lt)){if(n.model.traverse(function(vt){vt.isMesh&&(vt.castShadow=!0)}),lt){const vt=n.modelSize,Jt=[vt.x,vt.y,vt.z,n.modelHeight],le=Math.max(...Jt)*10,we=new E.PlaneBufferGeometry(le,le),xe=new E.ShadowMaterial;xe.opacity=.5;let De=new E.Mesh(we,xe);De.name=ke,De.layers.enable(1),De.layers.disable(0),De.receiveShadow=lt,n.add(De)}else n.traverse(function(vt){vt.isMesh&&vt.material instanceof E.ShadowMaterial&&n.remove(vt)});ti=lt}}}),n.setReceiveShadowFloor=function(){if(n.castShadow){let lt=n.shadowPlane,vt=lt.position,Jt=lt.rotation;if(vt.z=-n.modelHeight,Jt.y=n.rotation.y,Jt.x=-n.rotation.x,n.userData.units==="meters"){const le=n.modelSize,we=[le.x,le.y,le.z,-vt.z],De=Math.max(...we)*10/lt.geometry.parameters.width;lt.scale.set(De,De,De)}}};let mt=!1;Object.defineProperty(n,"receiveShadow",{get(){return mt},set(lt){!n.model||mt===lt||(n.model.traverse(function(vt){vt.isMesh&&(vt.receiveShadow=!0)}),mt=lt)}});let pt=!1;Object.defineProperty(n,"wireframe",{get(){return pt},set(lt){!n.model||pt===lt||(n.model.traverse(function(vt){if(vt.type=="Mesh"||vt.type=="SkinnedMesh"){let Jt=[];Array.isArray(vt.material)?Jt=vt.material:Jt.push(vt.material);let le=Jt[0];lt?(vt.userData.materials=le,vt.material=le.clone(),vt.material.wireframe=vt.material.transparent=lt,vt.material.opacity=.3):(vt.material.dispose(),vt.material=vt.userData.materials,vt.userData.materials.dispose(),vt.userData.materials=null),lt?(vt.layers.disable(0),vt.layers.enable(1)):(vt.layers.disable(1),vt.layers.enable(0))}vt.type=="LineSegments"&&vt.layers.disableAll()}),pt=lt,n.dispatchEvent({type:"Wireframed",detail:n}))}});let Tt=null;Object.defineProperty(n,"color",{get(){return Tt},set(lt){!n.model||Tt===lt||(n.model.traverse(function(vt){if(vt.type=="Mesh"||vt.type=="SkinnedMesh"){let Jt=[];Array.isArray(vt.material)?Jt=vt.material:Jt.push(vt.material);let le=Jt[0];lt?(vt.userData.materials=le,vt.material=new E.MeshStandardMaterial,vt.material.color.setHex(lt)):(vt.material.dispose(),vt.material=vt.userData.materials,vt.userData.materials.dispose(),vt.userData.materials=null)}}),Tt=lt)}});let Fe=!1;Object.defineProperty(n,"selected",{get(){return Fe},set(lt){lt?(n.userData.bbox&&!n.boundingBox&&n.drawBoundingBox(),n.boxGroup&&(n.boundingBox.material=B.prototype._defaults.materials.boxSelectedMaterial,n.boundingBox.parent.visible=!0,n.boundingBox.layers.enable(1),n.boundingBoxShadow.layers.enable(1)),n.label&&!n.label.alwaysVisible&&(n.label.visible=!0)):(n.boxGroup&&n.remove(n.boxGroup),n.label&&!n.label.alwaysVisible&&(n.label.visible=!1),n.removeHelp()),n.tooltip&&(n.tooltip.visible=lt),Fe!=lt&&(Fe=lt,n.dispatchEvent({type:"SelectedChange",detail:n}))}});let et=!0;Object.defineProperty(n,"raycasted",{get(){return et},set(lt){!n.model||et===lt||(n.model.traverse(function(vt){(vt.type=="Mesh"||vt.type=="SkinnedMesh")&&(lt?(vt.layers.disable(1),vt.layers.enable(0)):(vt.layers.disable(0),vt.layers.enable(1)))}),et=lt)}});let Xe=!1;Object.defineProperty(n,"over",{get(){return Xe},set(lt){lt?(n.selected||(n.userData.bbox&&!n.boundingBox&&n.drawBoundingBox(),n.userData.tooltip&&!n.tooltip&&n.addTooltip(n.uuid,!0,n.anchor,!1),n.boxGroup&&(n.boundingBox.material=B.prototype._defaults.materials.boxOverMaterial,n.boundingBox.parent.visible=!0,n.boundingBox.layers.enable(1),n.boundingBoxShadow.layers.enable(1))),n.label&&!n.label.alwaysVisible&&(n.label.visible=!0),n.dispatchEvent({type:"ObjectMouseOver",detail:n})):(n.selected||(n.boxGroup&&(n.remove(n.boxGroup),n.tooltip&&!n.tooltip.custom&&n.removeTooltip()),n.label&&!n.label.alwaysVisible&&(n.label.visible=!1)),n.dispatchEvent({type:"ObjectMouseOut",detail:n})),n.tooltip&&(n.tooltip.visible=lt||n.selected),Xe=lt}}),n.box3=function(){n.updateMatrix(),n.updateMatrixWorld(!0,!0);let lt;if(n.model){let vt=n.clone(!0),Jt=n.model.clone();if(lt=new E.Box3().setFromObject(Jt),n.parent){let le=new E.Matrix4,we=new E.Matrix4;n.matrix.extractRotation(le),we.copy(le).invert(),vt.setRotationFromMatrix(we),lt=new E.Box3().setFromObject(Jt)}}return lt},n.modelBox=function(){return n.box3()},n.getSize=function(){return n.box3().getSize(new E.Vector3(0,0,0))};let qe=!1;Object.defineProperty(n,"modelSize",{get(){return qe=n.getSize(),qe},set(lt){qe!=lt&&(qe=lt)}}),Object.defineProperty(n,"modelHeight",{get(){let lt=n.coordinates[2]||0;return n.userData.units==="scene"&&(lt*=n.unitsPerMeter/n.scale.x),lt}}),Object.defineProperty(n,"unitsPerMeter",{get(){return Number(l.projectedUnitsPerMeter(n.coordinates[1]).toFixed(7))}}),Object.defineProperty(n,"fixedZoom",{get(){return n.userData.fixedZoom},set(lt){n.userData.fixedZoom!==lt&&(n.userData.fixedZoom=lt,n.userData.units=lt?"scene":"meters")}}),n.setFixedZoom=function(lt){if(n.fixedZoom!=null&&n.fixedZoom!=0){lt||(lt=n.userData.mapScale);let vt=gt(n.fixedZoom);if(vt>lt){let Jt=vt/lt;n.scale.set(Jt,Jt,Jt)}else n.scale.set(1,1,1)}},n.setScale=function(lt){if(n.userData.units!="scene"){let vt=n.unitsPerMeter;n.scale.set(vt,vt,vt)}else n.fixedZoom?(lt&&(n.userData.mapScale=lt),n.setFixedZoom(n.userData.mapScale)):n.scale.set(1,1,1)},n.setObjectScale=function(lt){n.setScale(lt),n.setBoundingBoxShadowFloor(),n.setReceiveShadowFloor()}}n.add=function(Ze){return n.scaleGroup.add(Ze),Ze.position.z=n.coordinates[2]?-n.coordinates[2]:0,Ze},n.remove=function(Ze){Ze&&(Ze.traverse(st=>{if(st.geometry&&st.geometry.dispose(),st.material)if(st.material.isMaterial)yt(st.material);else for(const ti of st.material)yt(ti);st.dispose&&st.dispose()}),n.scaleGroup.remove(Ze),tb.map.repaint=!0)},n.duplicate=function(Ze){let st=n.clone(!0);if(st.getObjectByName("model").animations=n.animations,st.userData.feature&&(Ze&&Ze.feature&&(st.userData.feature=Ze.feature),st.userData.feature.properties.uuid=st.uuid),$._addMethods(st),!Ze||l.equal(Ze.scale,n.userData.scale))return st.copyAnchor(n),st;{st.userData=Ze,st.userData.isGeoGroup=!0,st.remove(st.boxGroup);const ti=l.types.rotation(Ze.rotation,[0,0,0]),mt=l.types.scale(Ze.scale,[1,1,1]);return st.model.position.set(0,0,0),st.model.rotation.set(ti[0],ti[1],ti[2]),st.model.scale.set(mt[0],mt[1],mt[2]),st.setAnchor(Ze.anchor),st.setCenter(Ze.adjustment),st}},n.copyAnchor=function(Ze){n.anchor=Ze.anchor,n.none={x:0,y:0,z:0},n.center=Ze.center,n.bottom=Ze.bottom,n.bottomLeft=Ze.bottomLeft,n.bottomRight=Ze.bottomRight,n.top=Ze.top,n.topLeft=Ze.topLeft,n.topRight=Ze.topRight,n.left=Ze.left,n.right=Ze.right},n.dispose=function(){B.prototype.unenroll(n),n.traverse(Ze=>{if(!(Ze.parent&&Ze.parent.name=="world")&&Ze.name!=="threeboxObject"){if(Ze.geometry&&Ze.geometry.dispose(),Ze.material)if(Ze.material.isMaterial)yt(Ze.material);else for(const st of Ze.material)yt(st);Ze.dispose&&Ze.dispose()}}),n.children=[]};const yt=Ze=>{Ze.dispose();for(const mt of Object.keys(Ze)){const pt=Ze[mt];pt&&typeof pt=="object"&&"minFilter"in pt&&pt.dispose()}let st=Ze;(st.map||st.alphaMap||st.aoMap||st.bumpMap||st.displacementMap||st.emissiveMap||st.envMap||st.lightMap||st.metalnessMap||st.normalMap||st.roughnessMap)&&(st.map&&st.map.dispose(),st.alphaMap&&st.alphaMap.dispose(),st.aoMap&&st.aoMap.dispose(),st.bumpMap&&st.bumpMap.dispose(),st.displacementMap&&st.displacementMap.dispose(),st.emissiveMap&&st.emissiveMap.dispose(),st.envMap&&st.envMap.dispose(),st.lightMap&&st.lightMap.dispose(),st.metalnessMap&&st.metalnessMap.dispose(),st.normalMap&&st.normalMap.dispose(),st.roughnessMap&&st.roughnessMap.dispose())};return n},_makeGroup:function(n,X){let $=new E.Group;$.name="scaleGroup",$.add(n);var ne=new E.Group;ne.userData=X||{},ne.userData.isGeoGroup=!0,ne.userData.feature&&(ne.userData.feature.properties.uuid=ne.uuid);var ve=$.length;if(ve)for(o of $)ne.add(o);else ne.add($);return ne.name="threeboxObject",ne},animationManager:new D,drawTooltip:function(n,X=!1){if(n){let $;if(X){let ne=document.createElement("div");ne.className="mapboxgl-popup-content";let ve=document.createElement("strong");ve.innerHTML=n,ne.appendChild(ve);let ze=document.createElement("div");ze.className="mapboxgl-popup-tip";let ke=document.createElement("div");ke.className="marker mapboxgl-popup-anchor-bottom",ke.appendChild(ze),ke.appendChild(ne),$=document.createElement("div"),$.className+="label3D",$.appendChild(ke)}else $=document.createElement("span"),$.className=this._defaults.tooltip.cssClass,$.innerHTML=n;return $}},drawLabelHTML:function(n,X){let $=document.createElement("div");return $.className+=X,typeof n=="string"?$.innerHTML=n:$.innerHTML=n.outerHTML,$},_defaults:{colors:{red:new E.Color(16711680),yellow:new E.Color(16776960),green:new E.Color(65280),black:new E.Color(0)},materials:{boxNormalMaterial:new E.LineBasicMaterial({color:new E.Color(16711680)}),boxOverMaterial:new E.LineBasicMaterial({color:new E.Color(16776960)}),boxSelectedMaterial:new E.LineBasicMaterial({color:new E.Color(65280)})},line:{geometry:null,color:"black",width:1,opacity:1},label:{htmlElement:null,cssClass:" label3D",alwaysVisible:!1,topMargin:-.5},tooltip:{text:"",cssClass:"toolTip text-xs",mapboxStyle:!1,topMargin:0},sphere:{position:[0,0,0],radius:1,sides:20,units:"scene",material:"MeshBasicMaterial",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},tube:{geometry:null,radius:1,sides:6,units:"scene",material:"MeshBasicMaterial",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0},loadObj:{type:null,obj:null,units:"scene",scale:1,rotation:0,defaultAnimation:0,anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0,clone:!0},Object3D:{obj:null,units:"scene",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},extrusion:{coordinates:[[[]]],geometryOptions:{},height:100,materials:new E.MeshPhongMaterial({color:6684672,side:E.DoubleSide}),scale:1,rotation:0,units:"scene",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0}},geometries:{line:["LineString"],tube:["LineString"],sphere:["Point"]}},c.exports=B}(Q1)),Q1.exports}var rb={exports:{}},sb={exports:{}},WS;function fx(){return WS||(WS=1,function(c,p){const l=qd(),E=Lc();function D(N){N=E._validate(N,l.prototype._defaults.Object3D);let B=N.obj;const n=E.types.rotation(N.rotation,[0,0,0]),X=E.types.scale(N.scale,[1,1,1]);B.rotation.set(n[0],n[1],n[2]),B.scale.set(X[0],X[1],X[2]),B.name="model";let $=l.prototype._makeGroup(B,N);return N.obj.name="model",l.prototype._addMethods($),$.setAnchor(N.anchor),$.setCenter(N.adjustment),$.raycasted=N.raycasted,$.visibility=!0,$}c.exports=D}(sb)),sb.exports}var qS;function Pk(){return qS||(qS=1,function(c,p){const l=Lc(),E=dx(),D=Na(),N=qd(),B=fx();function n(X){X=l._validate(X,N.prototype._defaults.sphere);let $=new D.SphereBufferGeometry(X.radius,X.sides,X.sides),ne=E(X),ve=new D.Mesh($,ne);return new B({obj:ve,units:X.units,anchor:X.anchor,adjustment:X.adjustment,bbox:X.bbox,tooltip:X.tooltip,raycasted:X.raycasted})}c.exports=n}(rb)),rb.exports}var ob={exports:{}},$S;function Dk(){return $S||($S=1,function(c,p){const l=qd(),E=Lc(),D=Na(),N=fx();function B(n){n=E._validate(n,l.prototype._defaults.extrusion);let X=B.prototype.buildShape(n.coordinates),$=B.prototype.buildGeometry(X,n.geometryOptions),ne=new D.Mesh($,n.materials);return n.obj=ne,new N(n)}B.prototype={buildShape:function(n){if(n[0]instanceof(D.Vector2||D.Vector3))return new D.Shape(n);let X=new D.Shape;for(let $=0;$<n.length;$++)$===0?X=new D.Shape(this.buildPoints(n[0],n[0])):X.holes.push(new D.Path(this.buildPoints(n[$],n[0])));return X},buildPoints:function(n,X){const $=[];let ne=E.projectToWorld([X[0][0],X[0][1],0]);for(let ve=0;ve<n.length;ve++){let ze=E.projectToWorld([n[ve][0],n[ve][1],0]);$.push(new D.Vector2(E.toDecimal(ze.x-ne.x,9),E.toDecimal(ze.y-ne.y,9)))}return $},buildGeometry:function(n,X){let $=new D.ExtrudeBufferGeometry(n,X);return $.computeBoundingBox(),$}},c.exports=B}(ob)),ob.exports}var ab={exports:{}},ZS;function Ok(){return ZS||(ZS=1,function(c,p){const l=Lc(),E=qd(),D=px();function N(B){B=l._validate(B,E.prototype._defaults.label);let n=E.prototype.drawLabelHTML(B.htmlElement,B.cssClass),X=new D.CSS2DObject(n);X.name="label",X.visible=B.alwaysVisible,X.alwaysVisible=B.alwaysVisible;var $=E.prototype._makeGroup(X,B);return E.prototype._addMethods($),$.visibility=B.alwaysVisible,$}c.exports=N}(ab)),ab.exports}var lb={exports:{}},XS;function zk(){return XS||(XS=1,function(c,p){const l=Lc(),E=qd(),D=px();Na();function N(B){if(B=l._validate(B,E.prototype._defaults.tooltip),B.text){let X=E.prototype.drawTooltip(B.text,B.mapboxStyle),$=new D.CSS2DObject(X);$.visible=!1,$.name="tooltip";var n=E.prototype._makeGroup($,B);return E.prototype._addMethods(n),n}}c.exports=N}(lb)),lb.exports}var cb={exports:{}},ub={exports:{}},YS;function kk(){return YS||(YS=1,function(c,p){const l=Na();(function(){const E=/^[og]\s*(.+)?/,D=/^mtllib /,N=/^usemtl /,B=/^usemap /,n=new l.Vector3,X=new l.Vector3,$=new l.Vector3,ne=new l.Vector3,ve=new l.Vector3;function ze(){const yt={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(it,xt){if(this.object&&this.object.fromDeclaration===!1){this.object.name=it,this.object.fromDeclaration=xt!==!1;return}const Ze=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:it||"",fromDeclaration:xt!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(st,ti){const mt=this._finalize(!1);mt&&(mt.inherited||mt.groupCount<=0)&&this.materials.splice(mt.index,1);const pt={index:this.materials.length,name:st||"",mtllib:Array.isArray(ti)&&ti.length>0?ti[ti.length-1]:"",smooth:mt!==void 0?mt.smooth:this.smooth,groupStart:mt!==void 0?mt.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(Tt){const Fe={index:typeof Tt=="number"?Tt:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return Fe.clone=this.clone.bind(Fe),Fe}};return this.materials.push(pt),pt},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(st){const ti=this.currentMaterial();if(ti&&ti.groupEnd===-1&&(ti.groupEnd=this.geometry.vertices.length/3,ti.groupCount=ti.groupEnd-ti.groupStart,ti.inherited=!1),st&&this.materials.length>1)for(let mt=this.materials.length-1;mt>=0;mt--)this.materials[mt].groupCount<=0&&this.materials.splice(mt,1);return st&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),ti}},Ze&&Ze.name&&typeof Ze.clone=="function"){const st=Ze.clone(0);st.inherited=!0,this.object.materials.push(st)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(it,xt){const Ze=parseInt(it,10);return(Ze>=0?Ze-1:Ze+xt/3)*3},parseNormalIndex:function(it,xt){const Ze=parseInt(it,10);return(Ze>=0?Ze-1:Ze+xt/3)*3},parseUVIndex:function(it,xt){const Ze=parseInt(it,10);return(Ze>=0?Ze-1:Ze+xt/2)*2},addVertex:function(it,xt,Ze){const st=this.vertices,ti=this.object.geometry.vertices;ti.push(st[it+0],st[it+1],st[it+2]),ti.push(st[xt+0],st[xt+1],st[xt+2]),ti.push(st[Ze+0],st[Ze+1],st[Ze+2])},addVertexPoint:function(it){const xt=this.vertices;this.object.geometry.vertices.push(xt[it+0],xt[it+1],xt[it+2])},addVertexLine:function(it){const xt=this.vertices;this.object.geometry.vertices.push(xt[it+0],xt[it+1],xt[it+2])},addNormal:function(it,xt,Ze){const st=this.normals,ti=this.object.geometry.normals;ti.push(st[it+0],st[it+1],st[it+2]),ti.push(st[xt+0],st[xt+1],st[xt+2]),ti.push(st[Ze+0],st[Ze+1],st[Ze+2])},addFaceNormal:function(it,xt,Ze){const st=this.vertices,ti=this.object.geometry.normals;n.fromArray(st,it),X.fromArray(st,xt),$.fromArray(st,Ze),ve.subVectors($,X),ne.subVectors(n,X),ve.cross(ne),ve.normalize(),ti.push(ve.x,ve.y,ve.z),ti.push(ve.x,ve.y,ve.z),ti.push(ve.x,ve.y,ve.z)},addColor:function(it,xt,Ze){const st=this.colors,ti=this.object.geometry.colors;st[it]!==void 0&&ti.push(st[it+0],st[it+1],st[it+2]),st[xt]!==void 0&&ti.push(st[xt+0],st[xt+1],st[xt+2]),st[Ze]!==void 0&&ti.push(st[Ze+0],st[Ze+1],st[Ze+2])},addUV:function(it,xt,Ze){const st=this.uvs,ti=this.object.geometry.uvs;ti.push(st[it+0],st[it+1]),ti.push(st[xt+0],st[xt+1]),ti.push(st[Ze+0],st[Ze+1])},addDefaultUV:function(){const it=this.object.geometry.uvs;it.push(0,0),it.push(0,0),it.push(0,0)},addUVLine:function(it){const xt=this.uvs;this.object.geometry.uvs.push(xt[it+0],xt[it+1])},addFace:function(it,xt,Ze,st,ti,mt,pt,Tt,Fe){const et=this.vertices.length;let Xe=this.parseVertexIndex(it,et),qe=this.parseVertexIndex(xt,et),gt=this.parseVertexIndex(Ze,et);if(this.addVertex(Xe,qe,gt),this.addColor(Xe,qe,gt),pt!==void 0&&pt!==""){const lt=this.normals.length;Xe=this.parseNormalIndex(pt,lt),qe=this.parseNormalIndex(Tt,lt),gt=this.parseNormalIndex(Fe,lt),this.addNormal(Xe,qe,gt)}else this.addFaceNormal(Xe,qe,gt);if(st!==void 0&&st!==""){const lt=this.uvs.length;Xe=this.parseUVIndex(st,lt),qe=this.parseUVIndex(ti,lt),gt=this.parseUVIndex(mt,lt),this.addUV(Xe,qe,gt),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(it){this.object.geometry.type="Points";const xt=this.vertices.length;for(let Ze=0,st=it.length;Ze<st;Ze++){const ti=this.parseVertexIndex(it[Ze],xt);this.addVertexPoint(ti),this.addColor(ti)}},addLineGeometry:function(it,xt){this.object.geometry.type="Line";const Ze=this.vertices.length,st=this.uvs.length;for(let ti=0,mt=it.length;ti<mt;ti++)this.addVertexLine(this.parseVertexIndex(it[ti],Ze));for(let ti=0,mt=xt.length;ti<mt;ti++)this.addUVLine(this.parseUVIndex(xt[ti],st))}};return yt.startObject("",!1),yt}class ke extends l.Loader{constructor(it){super(it),this.materials=null}load(it,xt,Ze,st){const ti=this,mt=new l.FileLoader(this.manager);mt.setPath(this.path),mt.setRequestHeader(this.requestHeader),mt.setWithCredentials(this.withCredentials),mt.load(it,function(pt){try{xt(ti.parse(pt))}catch(Tt){st?st(Tt):console.error(Tt),ti.manager.itemError(it)}},Ze,st)}setMaterials(it){return this.materials=it,this}parse(it){const xt=new ze;it.indexOf(`\r
`)!==-1&&(it=it.replace(/\r\n/g,`
`)),it.indexOf(`\\
`)!==-1&&(it=it.replace(/\\\n/g,""));const Ze=it.split(`
`);let st="",ti="",mt=0,pt=[];const Tt=typeof"".trimLeft=="function";for(let Xe=0,qe=Ze.length;Xe<qe;Xe++)if(st=Ze[Xe],st=Tt?st.trimLeft():st.trim(),mt=st.length,mt!==0&&(ti=st.charAt(0),ti!=="#"))if(ti==="v"){const gt=st.split(/\s+/);switch(gt[0]){case"v":xt.vertices.push(parseFloat(gt[1]),parseFloat(gt[2]),parseFloat(gt[3])),gt.length>=7?xt.colors.push(parseFloat(gt[4]),parseFloat(gt[5]),parseFloat(gt[6])):xt.colors.push(void 0,void 0,void 0);break;case"vn":xt.normals.push(parseFloat(gt[1]),parseFloat(gt[2]),parseFloat(gt[3]));break;case"vt":xt.uvs.push(parseFloat(gt[1]),parseFloat(gt[2]));break}}else if(ti==="f"){const lt=st.substr(1).trim().split(/\s+/),vt=[];for(let le=0,we=lt.length;le<we;le++){const xe=lt[le];if(xe.length>0){const De=xe.split("/");vt.push(De)}}const Jt=vt[0];for(let le=1,we=vt.length-1;le<we;le++){const xe=vt[le],De=vt[le+1];xt.addFace(Jt[0],xe[0],De[0],Jt[1],xe[1],De[1],Jt[2],xe[2],De[2])}}else if(ti==="l"){const gt=st.substring(1).trim().split(" ");let lt=[];const vt=[];if(st.indexOf("/")===-1)lt=gt;else for(let Jt=0,le=gt.length;Jt<le;Jt++){const we=gt[Jt].split("/");we[0]!==""&&lt.push(we[0]),we[1]!==""&&vt.push(we[1])}xt.addLineGeometry(lt,vt)}else if(ti==="p"){const lt=st.substr(1).trim().split(" ");xt.addPointGeometry(lt)}else if((pt=E.exec(st))!==null){const gt=(" "+pt[0].substr(1).trim()).substr(1);xt.startObject(gt)}else if(N.test(st))xt.object.startMaterial(st.substring(7).trim(),xt.materialLibraries);else if(D.test(st))xt.materialLibraries.push(st.substring(7).trim());else if(B.test(st))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(ti==="s"){if(pt=st.split(" "),pt.length>1){const lt=pt[1].trim().toLowerCase();xt.object.smooth=lt!=="0"&&lt!=="off"}else xt.object.smooth=!0;const gt=xt.object.currentMaterial();gt&&(gt.smooth=xt.object.smooth)}else{if(st==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+st+'"')}xt.finalize();const Fe=new l.Group;if(Fe.materialLibraries=[].concat(xt.materialLibraries),!(xt.objects.length===1&&xt.objects[0].geometry.vertices.length===0)===!0)for(let Xe=0,qe=xt.objects.length;Xe<qe;Xe++){const gt=xt.objects[Xe],lt=gt.geometry,vt=gt.materials,Jt=lt.type==="Line",le=lt.type==="Points";let we=!1;if(lt.vertices.length===0)continue;const xe=new l.BufferGeometry;xe.setAttribute("position",new l.Float32BufferAttribute(lt.vertices,3)),lt.normals.length>0&&xe.setAttribute("normal",new l.Float32BufferAttribute(lt.normals,3)),lt.colors.length>0&&(we=!0,xe.setAttribute("color",new l.Float32BufferAttribute(lt.colors,3))),lt.hasUVIndices===!0&&xe.setAttribute("uv",new l.Float32BufferAttribute(lt.uvs,2));const De=[];for(let Gt=0,Ft=vt.length;Gt<Ft;Gt++){const bt=vt[Gt],Vt=bt.name+"_"+bt.smooth+"_"+we;let Ht=xt.materials[Vt];if(this.materials!==null){if(Ht=this.materials.create(bt.name),Jt&&Ht&&!(Ht instanceof l.LineBasicMaterial)){const ni=new l.LineBasicMaterial;l.Material.prototype.copy.call(ni,Ht),ni.color.copy(Ht.color),Ht=ni}else if(le&&Ht&&!(Ht instanceof l.PointsMaterial)){const ni=new l.PointsMaterial({size:10,sizeAttenuation:!1});l.Material.prototype.copy.call(ni,Ht),ni.color.copy(Ht.color),ni.map=Ht.map,Ht=ni}}Ht===void 0&&(Jt?Ht=new l.LineBasicMaterial:le?Ht=new l.PointsMaterial({size:1,sizeAttenuation:!1}):Ht=new l.MeshPhongMaterial,Ht.name=bt.name,Ht.flatShading=!bt.smooth,Ht.vertexColors=we,xt.materials[Vt]=Ht),De.push(Ht)}let Ce;if(De.length>1){for(let Gt=0,Ft=vt.length;Gt<Ft;Gt++){const bt=vt[Gt];xe.addGroup(bt.groupStart,bt.groupCount,Gt)}Jt?Ce=new l.LineSegments(xe,De):le?Ce=new l.Points(xe,De):Ce=new l.Mesh(xe,De)}else Jt?Ce=new l.LineSegments(xe,De[0]):le?Ce=new l.Points(xe,De[0]):Ce=new l.Mesh(xe,De[0]);Ce.name=gt.name,Fe.add(Ce)}else if(xt.vertices.length>0){const Xe=new l.PointsMaterial({size:1,sizeAttenuation:!1}),qe=new l.BufferGeometry;qe.setAttribute("position",new l.Float32BufferAttribute(xt.vertices,3)),xt.colors.length>0&&xt.colors[0]!==void 0&&(qe.setAttribute("color",new l.Float32BufferAttribute(xt.colors,3)),Xe.vertexColors=!0);const gt=new l.Points(qe,Xe);Fe.add(gt)}return Fe}}l.OBJLoader=ke})(),c.exports=l.OBJLoader}(ub)),ub.exports}var hb={exports:{}},KS;function Fk(){return KS||(KS=1,function(c,p){const l=Na();(function(){class E extends l.Loader{constructor(B){super(B)}load(B,n,X,$){const ne=this,ve=this.path===""?l.LoaderUtils.extractUrlBase(B||""):this.path,ze=new l.FileLoader(this.manager);ze.setPath(this.path),ze.setRequestHeader(this.requestHeader),ze.setWithCredentials(this.withCredentials),ze.load(B,function(ke){try{n(ne.parse(ke,ve))}catch(yt){$?$(yt):console.error(yt),ne.manager.itemError(B)}},X,$)}setMaterialOptions(B){return this.materialOptions=B,this}parse(B,n){const X=B.split(`
`);let $={};const ne=/\s+/,ve={};for(let ke=0;ke<X.length;ke++){let yt=X[ke];if(yt=yt.trim(),yt.length===0||yt.charAt(0)==="#")continue;const it=yt.indexOf(" ");let xt=it>=0?yt.substring(0,it):yt;xt=xt.toLowerCase();let Ze=it>=0?yt.substring(it+1):"";if(Ze=Ze.trim(),xt==="newmtl")$={name:Ze},ve[Ze]=$;else if(xt==="ka"||xt==="kd"||xt==="ks"||xt==="ke"){const st=Ze.split(ne,3);$[xt]=[parseFloat(st[0]),parseFloat(st[1]),parseFloat(st[2])]}else $[xt]=Ze}const ze=new D(this.resourcePath||n,this.materialOptions);return ze.setCrossOrigin(this.crossOrigin),ze.setManager(this.manager),ze.setMaterials(ve),ze}}class D{constructor(B="",n={}){this.baseUrl=B,this.options=n,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:l.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:l.RepeatWrapping}setCrossOrigin(B){return this.crossOrigin=B,this}setManager(B){this.manager=B}setMaterials(B){this.materialsInfo=this.convert(B),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(B){if(!this.options)return B;const n={};for(const X in B){const $=B[X],ne={};n[X]=ne;for(const ve in $){let ze=!0,ke=$[ve];const yt=ve.toLowerCase();switch(yt){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(ke=[ke[0]/255,ke[1]/255,ke[2]/255]),this.options&&this.options.ignoreZeroRGBs&&ke[0]===0&&ke[1]===0&&ke[2]===0&&(ze=!1);break}ze&&(ne[yt]=ke)}}return n}preload(){for(const B in this.materialsInfo)this.create(B)}getIndex(B){return this.nameLookup[B]}getAsArray(){let B=0;for(const n in this.materialsInfo)this.materialsArray[B]=this.create(n),this.nameLookup[n]=B,B++;return this.materialsArray}create(B){return this.materials[B]===void 0&&this.createMaterial_(B),this.materials[B]}createMaterial_(B){const n=this,X=this.materialsInfo[B],$={name:B,side:this.side};function ne(ze,ke){return typeof ke!="string"||ke===""?"":/^https?:\/\//i.test(ke)?ke:ze+ke}function ve(ze,ke){if($[ze])return;const yt=n.getTextureParams(ke,$),it=n.loadTexture(ne(n.baseUrl,yt.url));it.repeat.copy(yt.scale),it.offset.copy(yt.offset),it.wrapS=n.wrap,it.wrapT=n.wrap,$[ze]=it}for(const ze in X){const ke=X[ze];let yt;if(ke!=="")switch(ze.toLowerCase()){case"kd":$.color=new l.Color().fromArray(ke);break;case"ks":$.specular=new l.Color().fromArray(ke);break;case"ke":$.emissive=new l.Color().fromArray(ke);break;case"map_kd":ve("map",ke);break;case"map_ks":ve("specularMap",ke);break;case"map_ke":ve("emissiveMap",ke);break;case"norm":ve("normalMap",ke);break;case"map_bump":case"bump":ve("bumpMap",ke);break;case"map_d":ve("alphaMap",ke),$.transparent=!0;break;case"ns":$.shininess=parseFloat(ke);break;case"d":yt=parseFloat(ke),yt<1&&($.opacity=yt,$.transparent=!0);break;case"tr":yt=parseFloat(ke),this.options&&this.options.invertTrProperty&&(yt=1-yt),yt>0&&($.opacity=1-yt,$.transparent=!0);break}}return this.materials[B]=new l.MeshPhongMaterial($),this.materials[B]}getTextureParams(B,n){const X={scale:new l.Vector2(1,1),offset:new l.Vector2(0,0)},$=B.split(/\s+/);let ne;return ne=$.indexOf("-bm"),ne>=0&&(n.bumpScale=parseFloat($[ne+1]),$.splice(ne,2)),ne=$.indexOf("-s"),ne>=0&&(X.scale.set(parseFloat($[ne+1]),parseFloat($[ne+2])),$.splice(ne,4)),ne=$.indexOf("-o"),ne>=0&&(X.offset.set(parseFloat($[ne+1]),parseFloat($[ne+2])),$.splice(ne,4)),X.url=$.join(" ").trim(),X}loadTexture(B,n,X,$,ne){const ve=this.manager!==void 0?this.manager:l.DefaultLoadingManager;let ze=ve.getHandler(B);ze===null&&(ze=new l.TextureLoader(ve)),ze.setCrossOrigin&&ze.setCrossOrigin(this.crossOrigin);const ke=ze.load(B,X,$,ne);return n!==void 0&&(ke.mapping=n),ke}}l.MTLLoader=E})(),c.exports=l.MTLLoader}(hb)),hb.exports}var db={exports:{}},gv={exports:{}};/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
*/var JS;function Bk(){return JS||(JS=1,function(c,p){(function(l){c.exports=l()})(function(){var l={};l.__esModule=!0;var E=function(Ae){var Me;try{Me("require('worker_threads')").Worker}catch{}return p.default=function(je,zt,Ai,Ui,bi){setImmediate(function(){return bi(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var Yi=function(){};return{terminate:Yi,postMessage:Yi}},Ae}({}),D=Uint8Array,N=Uint16Array,B=Uint32Array,n=new D([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),X=new D([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$=new D([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ne=function(Ae,Me){for(var je=new N(31),zt=0;zt<31;++zt)je[zt]=Me+=1<<Ae[zt-1];var Ai=new B(je[30]);for(zt=1;zt<30;++zt)for(var Ui=je[zt];Ui<je[zt+1];++Ui)Ai[Ui]=Ui-je[zt]<<5|zt;return[je,Ai]},ve=ne(n,2),ze=ve[0],ke=ve[1];ze[28]=258,ke[258]=28;for(var yt=ne(X,0),it=yt[0],xt=yt[1],Ze=new N(32768),st=0;st<32768;++st){var ti=(43690&st)>>>1|(21845&st)<<1;Ze[st]=((65280&(ti=(61680&(ti=(52428&ti)>>>2|(13107&ti)<<2))>>>4|(3855&ti)<<4))>>>8|(255&ti)<<8)>>>1}var mt=function(Ae,Me,je){for(var zt=Ae.length,Ai=0,Ui=new N(Me);Ai<zt;++Ai)++Ui[Ae[Ai]-1];var bi,Yi=new N(Me);for(Ai=0;Ai<Me;++Ai)Yi[Ai]=Yi[Ai-1]+Ui[Ai-1]<<1;if(je){bi=new N(1<<Me);var fe=15-Me;for(Ai=0;Ai<zt;++Ai)if(Ae[Ai])for(var me=Ai<<4|Ae[Ai],Ee=Me-Ae[Ai],Ke=Yi[Ae[Ai]-1]++<<Ee,Pe=Ke|(1<<Ee)-1;Ke<=Pe;++Ke)bi[Ze[Ke]>>>fe]=me}else for(bi=new N(zt),Ai=0;Ai<zt;++Ai)Ae[Ai]&&(bi[Ai]=Ze[Yi[Ae[Ai]-1]++]>>>15-Ae[Ai]);return bi},pt=new D(288);for(st=0;st<144;++st)pt[st]=8;for(st=144;st<256;++st)pt[st]=9;for(st=256;st<280;++st)pt[st]=7;for(st=280;st<288;++st)pt[st]=8;var Tt=new D(32);for(st=0;st<32;++st)Tt[st]=5;var Fe=mt(pt,9,0),et=mt(pt,9,1),Xe=mt(Tt,5,0),qe=mt(Tt,5,1),gt=function(Ae){for(var Me=Ae[0],je=1;je<Ae.length;++je)Ae[je]>Me&&(Me=Ae[je]);return Me},lt=function(Ae,Me,je){var zt=Me/8|0;return(Ae[zt]|Ae[zt+1]<<8)>>(7&Me)&je},vt=function(Ae,Me){var je=Me/8|0;return(Ae[je]|Ae[je+1]<<8|Ae[je+2]<<16)>>(7&Me)},Jt=function(Ae){return(Ae/8|0)+(7&Ae&&1)},le=function(Ae,Me,je){(Me==null||Me<0)&&(Me=0),(je==null||je>Ae.length)&&(je=Ae.length);var zt=new(Ae instanceof N?N:Ae instanceof B?B:D)(je-Me);return zt.set(Ae.subarray(Me,je)),zt},we=function(Ae,Me,je){var zt=Ae.length;if(!zt||je&&!je.l&&zt<5)return Me||new D(0);var Ai=!Me||je,Ui=!je||je.i;je||(je={}),Me||(Me=new D(3*zt));var bi=function(ea){var Un=Me.length;if(ea>Un){var vl=new D(Math.max(2*Un,ea));vl.set(Me),Me=vl}},Yi=je.f||0,fe=je.p||0,me=je.b||0,Ee=je.l,Ke=je.d,Pe=je.m,ci=je.n,Mi=8*zt;do{if(!Ee){je.f=Yi=lt(Ae,fe,1);var Wi=lt(Ae,fe+1,3);if(fe+=3,!Wi){var hn=Ae[(_r=Jt(fe)+4)-4]|Ae[_r-3]<<8,Dn=_r+hn;if(Dn>zt){if(Ui)throw"unexpected EOF";break}Ai&&bi(me+hn),Me.set(Ae.subarray(_r,Dn),me),je.b=me+=hn,je.p=fe=8*Dn;continue}if(Wi==1)Ee=et,Ke=qe,Pe=9,ci=5;else{if(Wi!=2)throw"invalid block type";var Zi=lt(Ae,fe,31)+257,Kt=lt(Ae,fe+10,15)+4,nn=Zi+lt(Ae,fe+5,31)+1;fe+=14;for(var Ei=new D(nn),Ln=new D(19),Vi=0;Vi<Kt;++Vi)Ln[$[Vi]]=lt(Ae,fe+3*Vi,7);fe+=3*Kt;var fn=gt(Ln),cr=(1<<fn)-1;if(!Ui&&fe+nn*(fn+7)>Mi)break;var gr=mt(Ln,fn,1);for(Vi=0;Vi<nn;){var _r,Rr=gr[lt(Ae,fe,cr)];if(fe+=15&Rr,(_r=Rr>>>4)<16)Ei[Vi++]=_r;else{var ur=0,wn=0;for(_r==16?(wn=3+lt(Ae,fe,3),fe+=2,ur=Ei[Vi-1]):_r==17?(wn=3+lt(Ae,fe,7),fe+=3):_r==18&&(wn=11+lt(Ae,fe,127),fe+=7);wn--;)Ei[Vi++]=ur}}var ws=Ei.subarray(0,Zi),wr=Ei.subarray(Zi);Pe=gt(ws),ci=gt(wr),Ee=mt(ws,Pe,1),Ke=mt(wr,ci,1)}if(fe>Mi)throw"unexpected EOF"}Ai&&bi(me+131072);for(var Vs=(1<<Pe)-1,Or=(1<<ci)-1,so=Pe+ci+18;Ui||fe+so<Mi;){var io=(ur=Ee[vt(Ae,fe)&Vs])>>>4;if((fe+=15&ur)>Mi)throw"unexpected EOF";if(!ur)throw"invalid length/literal";if(io<256)Me[me++]=io;else{if(io==256){Ee=null;break}var Ys=io-254;io>264&&(Ys=lt(Ae,fe,(1<<(hs=n[Vi=io-257]))-1)+ze[Vi],fe+=hs);var Ga=Ke[vt(Ae,fe)&Or],So=Ga>>>4;if(!Ga)throw"invalid distance";if(fe+=15&Ga,wr=it[So],So>3){var hs=X[So];wr+=vt(Ae,fe)&(1<<hs)-1,fe+=hs}if(fe>Mi)throw"unexpected EOF";Ai&&bi(me+131072);for(var Is=me+Ys;me<Is;me+=4)Me[me]=Me[me-wr],Me[me+1]=Me[me+1-wr],Me[me+2]=Me[me+2-wr],Me[me+3]=Me[me+3-wr];me=Is}}je.l=Ee,je.p=fe,je.b=me,Ee&&(Yi=1,je.m=Pe,je.d=Ke,je.n=ci)}while(!Yi);return me==Me.length?Me:le(Me,0,me)},xe=function(Ae,Me,je){var zt=Me/8|0;Ae[zt]|=je<<=7&Me,Ae[zt+1]|=je>>>8},De=function(Ae,Me,je){var zt=Me/8|0;Ae[zt]|=je<<=7&Me,Ae[zt+1]|=je>>>8,Ae[zt+2]|=je>>>16},Ce=function(Ae,Me){for(var je=[],zt=0;zt<Ae.length;++zt)Ae[zt]&&je.push({s:zt,f:Ae[zt]});var Ai=je.length,Ui=je.slice();if(!Ai)return[zi,0];if(Ai==1){var bi=new D(je[0].s+1);return bi[je[0].s]=1,[bi,1]}je.sort(function(Ei,Ln){return Ei.f-Ln.f}),je.push({s:-1,f:25001});var Yi=je[0],fe=je[1],me=0,Ee=1,Ke=2;for(je[0]={s:-1,f:Yi.f+fe.f,l:Yi,r:fe};Ee!=Ai-1;)Yi=je[je[me].f<je[Ke].f?me++:Ke++],fe=je[me!=Ee&&je[me].f<je[Ke].f?me++:Ke++],je[Ee++]={s:-1,f:Yi.f+fe.f,l:Yi,r:fe};var Pe=Ui[0].s;for(zt=1;zt<Ai;++zt)Ui[zt].s>Pe&&(Pe=Ui[zt].s);var ci=new N(Pe+1),Mi=Gt(je[Ee-1],ci,0);if(Mi>Me){zt=0;var Wi=0,hn=Mi-Me,Dn=1<<hn;for(Ui.sort(function(Ei,Ln){return ci[Ln.s]-ci[Ei.s]||Ei.f-Ln.f});zt<Ai;++zt){var Zi=Ui[zt].s;if(!(ci[Zi]>Me))break;Wi+=Dn-(1<<Mi-ci[Zi]),ci[Zi]=Me}for(Wi>>>=hn;Wi>0;){var Kt=Ui[zt].s;ci[Kt]<Me?Wi-=1<<Me-ci[Kt]++-1:++zt}for(;zt>=0&&Wi;--zt){var nn=Ui[zt].s;ci[nn]==Me&&(--ci[nn],++Wi)}Mi=Me}return[new D(ci),Mi]},Gt=function(Ae,Me,je){return Ae.s==-1?Math.max(Gt(Ae.l,Me,je+1),Gt(Ae.r,Me,je+1)):Me[Ae.s]=je},Ft=function(Ae){for(var Me=Ae.length;Me&&!Ae[--Me];);for(var je=new N(++Me),zt=0,Ai=Ae[0],Ui=1,bi=function(fe){je[zt++]=fe},Yi=1;Yi<=Me;++Yi)if(Ae[Yi]==Ai&&Yi!=Me)++Ui;else{if(!Ai&&Ui>2){for(;Ui>138;Ui-=138)bi(32754);Ui>2&&(bi(Ui>10?Ui-11<<5|28690:Ui-3<<5|12305),Ui=0)}else if(Ui>3){for(bi(Ai),--Ui;Ui>6;Ui-=6)bi(8304);Ui>2&&(bi(Ui-3<<5|8208),Ui=0)}for(;Ui--;)bi(Ai);Ui=1,Ai=Ae[Yi]}return[je.subarray(0,zt),Me]},bt=function(Ae,Me){for(var je=0,zt=0;zt<Me.length;++zt)je+=Ae[zt]*Me[zt];return je},Vt=function(Ae,Me,je){var zt=je.length,Ai=Jt(Me+2);Ae[Ai]=255&zt,Ae[Ai+1]=zt>>>8,Ae[Ai+2]=255^Ae[Ai],Ae[Ai+3]=255^Ae[Ai+1];for(var Ui=0;Ui<zt;++Ui)Ae[Ai+Ui+4]=je[Ui];return 8*(Ai+4+zt)},Ht=function(Ae,Me,je,zt,Ai,Ui,bi,Yi,fe,me,Ee){xe(Me,Ee++,je),++Ai[256];for(var Ke=Ce(Ai,15),Pe=Ke[0],ci=Ke[1],Mi=Ce(Ui,15),Wi=Mi[0],hn=Mi[1],Dn=Ft(Pe),Zi=Dn[0],Kt=Dn[1],nn=Ft(Wi),Ei=nn[0],Ln=nn[1],Vi=new N(19),fn=0;fn<Zi.length;++fn)Vi[31&Zi[fn]]++;for(fn=0;fn<Ei.length;++fn)Vi[31&Ei[fn]]++;for(var cr=Ce(Vi,7),gr=cr[0],_r=cr[1],Rr=19;Rr>4&&!gr[$[Rr-1]];--Rr);var ur,wn,ws,wr,Vs=me+5<<3,Or=bt(Ai,pt)+bt(Ui,Tt)+bi,so=bt(Ai,Pe)+bt(Ui,Wi)+bi+14+3*Rr+bt(Vi,gr)+(2*Vi[16]+3*Vi[17]+7*Vi[18]);if(Vs<=Or&&Vs<=so)return Vt(Me,Ee,Ae.subarray(fe,fe+me));if(xe(Me,Ee,1+(so<Or)),Ee+=2,so<Or){ur=mt(Pe,ci,0),wn=Pe,ws=mt(Wi,hn,0),wr=Wi;var io=mt(gr,_r,0);for(xe(Me,Ee,Kt-257),xe(Me,Ee+5,Ln-1),xe(Me,Ee+10,Rr-4),Ee+=14,fn=0;fn<Rr;++fn)xe(Me,Ee+3*fn,gr[$[fn]]);Ee+=3*Rr;for(var Ys=[Zi,Ei],Ga=0;Ga<2;++Ga){var So=Ys[Ga];for(fn=0;fn<So.length;++fn)xe(Me,Ee,io[hs=31&So[fn]]),Ee+=gr[hs],hs>15&&(xe(Me,Ee,So[fn]>>>5&127),Ee+=So[fn]>>>12)}}else ur=Fe,wn=pt,ws=Xe,wr=Tt;for(fn=0;fn<Yi;++fn)if(zt[fn]>255){var hs;De(Me,Ee,ur[257+(hs=zt[fn]>>>18&31)]),Ee+=wn[hs+257],hs>7&&(xe(Me,Ee,zt[fn]>>>23&31),Ee+=n[hs]);var Is=31&zt[fn];De(Me,Ee,ws[Is]),Ee+=wr[Is],Is>3&&(De(Me,Ee,zt[fn]>>>5&8191),Ee+=X[Is])}else De(Me,Ee,ur[zt[fn]]),Ee+=wn[zt[fn]];return De(Me,Ee,ur[256]),Ee+wn[256]},ni=new B([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),zi=new D(0),Hi=function(Ae,Me,je,zt,Ai,Ui){var bi=Ae.length,Yi=new D(zt+bi+5*(1+Math.ceil(bi/7e3))+Ai),fe=Yi.subarray(zt,Yi.length-Ai),me=0;if(!Me||bi<8)for(var Ee=0;Ee<=bi;Ee+=65535){var Ke=Ee+65535;Ke<bi?me=Vt(fe,me,Ae.subarray(Ee,Ke)):(fe[Ee]=Ui,me=Vt(fe,me,Ae.subarray(Ee,bi)))}else{for(var Pe=ni[Me-1],ci=Pe>>>13,Mi=8191&Pe,Wi=(1<<je)-1,hn=new N(32768),Dn=new N(Wi+1),Zi=Math.ceil(je/3),Kt=2*Zi,nn=function(xl){return(Ae[xl]^Ae[xl+1]<<Zi^Ae[xl+2]<<Kt)&Wi},Ei=new B(25e3),Ln=new N(288),Vi=new N(32),fn=0,cr=0,gr=(Ee=0,0),_r=0,Rr=0;Ee<bi;++Ee){var ur=nn(Ee),wn=32767&Ee,ws=Dn[ur];if(hn[wn]=ws,Dn[ur]=wn,_r<=Ee){var wr=bi-Ee;if((fn>7e3||gr>24576)&&wr>423){me=Ht(Ae,fe,0,Ei,Ln,Vi,cr,gr,Rr,Ee-Rr,me),gr=fn=cr=0,Rr=Ee;for(var Vs=0;Vs<286;++Vs)Ln[Vs]=0;for(Vs=0;Vs<30;++Vs)Vi[Vs]=0}var Or=2,so=0,io=Mi,Ys=wn-ws&32767;if(wr>2&&ur==nn(Ee-Ys))for(var Ga=Math.min(ci,wr)-1,So=Math.min(32767,Ee),hs=Math.min(258,wr);Ys<=So&&--io&&wn!=ws;){if(Ae[Ee+Or]==Ae[Ee+Or-Ys]){for(var Is=0;Is<hs&&Ae[Ee+Is]==Ae[Ee+Is-Ys];++Is);if(Is>Or){if(Or=Is,so=Ys,Is>Ga)break;var ea=Math.min(Ys,Is-2),Un=0;for(Vs=0;Vs<ea;++Vs){var vl=Ee-Ys+Vs+32768&32767,ya=vl-hn[vl]+32768&32767;ya>Un&&(Un=ya,ws=vl)}}}Ys+=(wn=ws)-(ws=hn[wn])+32768&32767}if(so){Ei[gr++]=268435456|ke[Or]<<18|xt[so];var nc=31&ke[Or],va=31&xt[so];cr+=n[nc]+X[va],++Ln[257+nc],++Vi[va],_r=Ee+Or,++fn}else Ei[gr++]=Ae[Ee],++Ln[Ae[Ee]]}}me=Ht(Ae,fe,Ui,Ei,Ln,Vi,cr,gr,Rr,Ee-Rr,me),!Ui&&7&me&&(me=Vt(fe,me+1,zi))}return le(Yi,0,zt+Jt(me)+Ai)},on=function(){for(var Ae=new B(256),Me=0;Me<256;++Me){for(var je=Me,zt=9;--zt;)je=(1&je&&3988292384)^je>>>1;Ae[Me]=je}return Ae}(),mn=function(){var Ae=-1;return{p:function(Me){for(var je=Ae,zt=0;zt<Me.length;++zt)je=on[255&je^Me[zt]]^je>>>8;Ae=je},d:function(){return~Ae}}},ot=function(){var Ae=1,Me=0;return{p:function(je){for(var zt=Ae,Ai=Me,Ui=je.length,bi=0;bi!=Ui;){for(var Yi=Math.min(bi+2655,Ui);bi<Yi;++bi)Ai+=zt+=je[bi];zt=(65535&zt)+15*(zt>>16),Ai=(65535&Ai)+15*(Ai>>16)}Ae=zt,Me=Ai},d:function(){return((Ae%=65521)>>>8<<16|(255&(Me%=65521))<<8|Me>>>8)+2*((255&Ae)<<23)}}},Yn=function(Ae,Me,je,zt,Ai){return Hi(Ae,Me.level==null?6:Me.level,Me.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(Ae.length)))):12+Me.mem,je,zt,!Ai)},pr=function(Ae,Me){var je={};for(var zt in Ae)je[zt]=Ae[zt];for(var zt in Me)je[zt]=Me[zt];return je},At=function(Ae,Me,je){for(var zt=Ae(),Ai=""+Ae,Ui=Ai.slice(Ai.indexOf("[")+1,Ai.lastIndexOf("]")).replace(/ /g,"").split(","),bi=0;bi<zt.length;++bi){var Yi=zt[bi],fe=Ui[bi];if(typeof Yi=="function"){Me+=";"+fe+"=";var me=""+Yi;if(Yi.prototype)if(me.indexOf("[native code]")!=-1){var Ee=me.indexOf(" ",8)+1;Me+=me.slice(Ee,me.indexOf("(",Ee))}else for(var Ke in Me+=me,Yi.prototype)Me+=";"+fe+".prototype."+Ke+"="+Yi.prototype[Ke];else Me+=me}else je[fe]=Yi}return[Me,je]},Ye=[],kt=function(Ae){var Me=[];for(var je in Ae)(Ae[je]instanceof D||Ae[je]instanceof N||Ae[je]instanceof B)&&Me.push((Ae[je]=new Ae[je].constructor(Ae[je])).buffer);return Me},Le=function(Ae,Me,je,zt){var Ai;if(!Ye[je]){for(var Ui="",bi={},Yi=Ae.length-1,fe=0;fe<Yi;++fe)Ui=(Ai=At(Ae[fe],Ui,bi))[0],bi=Ai[1];Ye[je]=At(Ae[Yi],Ui,bi)}var me=pr({},Ye[je][1]);return E.default(Ye[je][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+Me+"}",je,me,kt(me),zt)},Ie=function(){return[D,N,B,n,X,$,ze,it,et,qe,Ze,mt,gt,lt,vt,Jt,le,we,po,Lt,It]},Ue=function(){return[D,N,B,n,X,$,ke,xt,Fe,pt,Xe,Tt,Ze,ni,zi,mt,xe,De,Ce,Gt,Ft,bt,Vt,Ht,Jt,le,Hi,Yn,_s,Lt]},We=function(){return[jn,to,Mn,mn,on]},rt=function(){return[Lr,Tr]},ut=function(){return[$r,Mn,ot]},ht=function(){return[en]},Lt=function(Ae){return postMessage(Ae,[Ae.buffer])},It=function(Ae){return Ae&&Ae.size&&new D(Ae.size)},ui=function(Ae,Me,je,zt,Ai,Ui){var bi=Le(je,zt,Ai,function(Yi,fe){bi.terminate(),Ui(Yi,fe)});return bi.postMessage([Ae,Me],Me.consume?[Ae.buffer]:[]),function(){bi.terminate()}},xi=function(Ae){return Ae.ondata=function(Me,je){return postMessage([Me,je],[Me.buffer])},function(Me){return Ae.push(Me.data[0],Me.data[1])}},an=function(Ae,Me,je,zt,Ai){var Ui,bi=Le(Ae,zt,Ai,function(Yi,fe){Yi?(bi.terminate(),Me.ondata.call(Me,Yi)):(fe[1]&&bi.terminate(),Me.ondata.call(Me,Yi,fe[0],fe[1]))});bi.postMessage(je),Me.push=function(Yi,fe){if(Ui)throw"stream finished";if(!Me.ondata)throw"no stream handler";bi.postMessage([Yi,Ui=fe],[Yi.buffer])},Me.terminate=function(){bi.terminate()}},cn=function(Ae,Me){return Ae[Me]|Ae[Me+1]<<8},_n=function(Ae,Me){return(Ae[Me]|Ae[Me+1]<<8|Ae[Me+2]<<16)+2*(Ae[Me+3]<<23)},Fn=function(Ae,Me){return _n(Ae,Me)|4294967296*_n(Ae,Me)},Mn=function(Ae,Me,je){for(;je;++Me)Ae[Me]=je,je>>>=8},jn=function(Ae,Me){var je=Me.filename;if(Ae[0]=31,Ae[1]=139,Ae[2]=8,Ae[8]=Me.level<2?4:Me.level==9?2:0,Ae[9]=3,Me.mtime!=0&&Mn(Ae,4,Math.floor(new Date(Me.mtime||Date.now())/1e3)),je){Ae[3]=8;for(var zt=0;zt<=je.length;++zt)Ae[zt+10]=je.charCodeAt(zt)}},Lr=function(Ae){if(Ae[0]!=31||Ae[1]!=139||Ae[2]!=8)throw"invalid gzip data";var Me=Ae[3],je=10;4&Me&&(je+=Ae[10]|2+(Ae[11]<<8));for(var zt=(Me>>3&1)+(Me>>4&1);zt>0;zt-=!Ae[je++]);return je+(2&Me)},Tr=function(Ae){var Me=Ae.length;return(Ae[Me-4]|Ae[Me-3]<<8|Ae[Me-2]<<16)+2*(Ae[Me-1]<<23)},to=function(Ae){return 10+(Ae.filename&&Ae.filename.length+1||0)},$r=function(Ae,Me){var je=Me.level,zt=je==0?0:je<6?1:je==9?3:2;Ae[0]=120,Ae[1]=zt<<6|(zt?32-2*zt:1)},en=function(Ae){if((15&Ae[0])!=8||Ae[0]>>>4>7||(Ae[0]<<8|Ae[1])%31)throw"invalid zlib data";if(32&Ae[1])throw"invalid zlib data: preset dictionaries not supported"};function Wn(Ae,Me){return Me||typeof Ae!="function"||(Me=Ae,Ae={}),this.ondata=Me,Ae}var Ls=function(){function Ae(Me,je){je||typeof Me!="function"||(je=Me,Me={}),this.ondata=je,this.o=Me||{}}return Ae.prototype.p=function(Me,je){this.ondata(Yn(Me,this.o,0,0,!je),je)},Ae.prototype.push=function(Me,je){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=je,this.p(Me,je||!1)},Ae}();l.Deflate=Ls;var To=function(){return function(Ae,Me){an([Ue,function(){return[xi,Ls]}],this,Wn.call(this,Ae,Me),function(je){var zt=new Ls(je.data);onmessage=xi(zt)},6)}}();function Ro(Ae,Me,je){if(je||(je=Me,Me={}),typeof je!="function")throw"no callback";return ui(Ae,Me,[Ue],function(zt){return Lt(_s(zt.data[0],zt.data[1]))},0,je)}function _s(Ae,Me){return Yn(Ae,Me||{},0,0)}l.AsyncDeflate=To,l.deflate=Ro,l.deflateSync=_s;var js=function(){function Ae(Me){this.s={},this.p=new D(0),this.ondata=Me}return Ae.prototype.e=function(Me){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var je=this.p.length,zt=new D(je+Me.length);zt.set(this.p),zt.set(Me,je),this.p=zt},Ae.prototype.c=function(Me){this.d=this.s.i=Me||!1;var je=this.s.b,zt=we(this.p,this.o,this.s);this.ondata(le(zt,je,this.s.b),this.d),this.o=le(zt,this.s.b-32768),this.s.b=this.o.length,this.p=le(this.p,this.s.p/8|0),this.s.p&=7},Ae.prototype.push=function(Me,je){this.e(Me),this.c(je)},Ae}();l.Inflate=js;var Dr=function(){return function(Ae){this.ondata=Ae,an([Ie,function(){return[xi,js]}],this,0,function(){var Me=new js;onmessage=xi(Me)},7)}}();function ro(Ae,Me,je){if(je||(je=Me,Me={}),typeof je!="function")throw"no callback";return ui(Ae,Me,[Ie],function(zt){return Lt(po(zt.data[0],It(zt.data[1])))},1,je)}function po(Ae,Me){return we(Ae,Me)}l.AsyncInflate=Dr,l.inflate=ro,l.inflateSync=po;var ai=function(){function Ae(Me,je){this.c=mn(),this.l=0,this.v=1,Ls.call(this,Me,je)}return Ae.prototype.push=function(Me,je){Ls.prototype.push.call(this,Me,je)},Ae.prototype.p=function(Me,je){this.c.p(Me),this.l+=Me.length;var zt=Yn(Me,this.o,this.v&&to(this.o),je&&8,!je);this.v&&(jn(zt,this.o),this.v=0),je&&(Mn(zt,zt.length-8,this.c.d()),Mn(zt,zt.length-4,this.l)),this.ondata(zt,je)},Ae}();l.Gzip=ai,l.Compress=ai;var ye=function(){return function(Ae,Me){an([Ue,We,function(){return[xi,Ls,ai]}],this,Wn.call(this,Ae,Me),function(je){var zt=new ai(je.data);onmessage=xi(zt)},8)}}();function re(Ae,Me,je){if(je||(je=Me,Me={}),typeof je!="function")throw"no callback";return ui(Ae,Me,[Ue,We,function(){return[Je]}],function(zt){return Lt(Je(zt.data[0],zt.data[1]))},2,je)}function Je(Ae,Me){Me||(Me={});var je=mn(),zt=Ae.length;je.p(Ae);var Ai=Yn(Ae,Me,to(Me),8),Ui=Ai.length;return jn(Ai,Me),Mn(Ai,Ui-8,je.d()),Mn(Ai,Ui-4,zt),Ai}l.AsyncGzip=ye,l.AsyncCompress=ye,l.gzip=re,l.compress=re,l.gzipSync=Je,l.compressSync=Je;var Rt=function(){function Ae(Me){this.v=1,js.call(this,Me)}return Ae.prototype.push=function(Me,je){if(js.prototype.e.call(this,Me),this.v){var zt=this.p.length>3?Lr(this.p):4;if(zt>=this.p.length&&!je)return;this.p=this.p.subarray(zt),this.v=0}if(je){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}js.prototype.c.call(this,je)},Ae}();l.Gunzip=Rt;var dt=function(){return function(Ae){this.ondata=Ae,an([Ie,rt,function(){return[xi,js,Rt]}],this,0,function(){var Me=new Rt;onmessage=xi(Me)},9)}}();function Nt(Ae,Me,je){if(je||(je=Me,Me={}),typeof je!="function")throw"no callback";return ui(Ae,Me,[Ie,rt,function(){return[oi]}],function(zt){return Lt(oi(zt.data[0]))},3,je)}function oi(Ae,Me){return we(Ae.subarray(Lr(Ae),-8),Me||new D(Tr(Ae)))}l.AsyncGunzip=dt,l.gunzip=Nt,l.gunzipSync=oi;var Zt=function(){function Ae(Me,je){this.c=ot(),this.v=1,Ls.call(this,Me,je)}return Ae.prototype.push=function(Me,je){Ls.prototype.push.call(this,Me,je)},Ae.prototype.p=function(Me,je){this.c.p(Me);var zt=Yn(Me,this.o,this.v&&2,je&&4,!je);this.v&&($r(zt,this.o),this.v=0),je&&Mn(zt,zt.length-4,this.c.d()),this.ondata(zt,je)},Ae}();l.Zlib=Zt;var li=function(){return function(Ae,Me){an([Ue,ut,function(){return[xi,Ls,Zt]}],this,Wn.call(this,Ae,Me),function(je){var zt=new Zt(je.data);onmessage=xi(zt)},10)}}();function mi(Ae,Me,je){if(je||(je=Me,Me={}),typeof je!="function")throw"no callback";return ui(Ae,Me,[Ue,ut,function(){return[fi]}],function(zt){return Lt(fi(zt.data[0],zt.data[1]))},4,je)}function fi(Ae,Me){Me||(Me={});var je=ot();je.p(Ae);var zt=Yn(Ae,Me,2,4);return $r(zt,Me),Mn(zt,zt.length-4,je.d()),zt}l.AsyncZlib=li,l.zlib=mi,l.zlibSync=fi;var Pi=function(){function Ae(Me){this.v=1,js.call(this,Me)}return Ae.prototype.push=function(Me,je){if(js.prototype.e.call(this,Me),this.v){if(this.p.length<2&&!je)return;this.p=this.p.subarray(2),this.v=0}if(je){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}js.prototype.c.call(this,je)},Ae}();l.Unzlib=Pi;var tn=function(){return function(Ae){this.ondata=Ae,an([Ie,ht,function(){return[xi,js,Pi]}],this,0,function(){var Me=new Pi;onmessage=xi(Me)},11)}}();function xn(Ae,Me,je){if(je||(je=Me,Me={}),typeof je!="function")throw"no callback";return ui(Ae,Me,[Ie,ht,function(){return[Jn]}],function(zt){return Lt(Jn(zt.data[0],It(zt.data[1])))},5,je)}function Jn(Ae,Me){return we((en(Ae),Ae.subarray(2,-4)),Me)}l.AsyncUnzlib=tn,l.unzlib=xn,l.unzlibSync=Jn;var sr=function(){function Ae(Me){this.G=Rt,this.I=js,this.Z=Pi,this.ondata=Me}return Ae.prototype.push=function(Me,je){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(Me,je);else{if(this.p&&this.p.length){var zt=new D(this.p.length+Me.length);zt.set(this.p),zt.set(Me,this.p.length)}else this.p=Me;if(this.p.length>2){var Ai=this,Ui=function(){Ai.ondata.apply(Ai,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(Ui):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(Ui):new this.Z(Ui),this.s.push(this.p,je),this.p=null}}},Ae}();l.Decompress=sr;var ar=function(){function Ae(Me){this.G=dt,this.I=Dr,this.Z=tn,this.ondata=Me}return Ae.prototype.push=function(Me,je){sr.prototype.push.call(this,Me,je)},Ae}();function er(Ae,Me,je){if(je||(je=Me,Me={}),typeof je!="function")throw"no callback";return Ae[0]==31&&Ae[1]==139&&Ae[2]==8?Nt(Ae,Me,je):(15&Ae[0])!=8||Ae[0]>>4>7||(Ae[0]<<8|Ae[1])%31?ro(Ae,Me,je):xn(Ae,Me,je)}function Zr(Ae,Me){return Ae[0]==31&&Ae[1]==139&&Ae[2]==8?oi(Ae,Me):(15&Ae[0])!=8||Ae[0]>>4>7||(Ae[0]<<8|Ae[1])%31?po(Ae,Me):Jn(Ae,Me)}l.AsyncDecompress=ar,l.decompress=er,l.decompressSync=Zr;var Gr=function(Ae,Me,je,zt){for(var Ai in Ae){var Ui=Ae[Ai],bi=Me+Ai;Ui instanceof D?je[bi]=[Ui,zt]:Array.isArray(Ui)?je[bi]=[Ui[0],pr(zt,Ui[1])]:Gr(Ui,bi+"/",je,zt)}},yr=typeof TextEncoder<"u"&&new TextEncoder,Jr=typeof TextDecoder<"u"&&new TextDecoder,us=0;try{Jr.decode(zi,{stream:!0}),us=1}catch{}var Ns=function(Ae){for(var Me="",je=0;;){var zt=Ae[je++],Ai=(zt>127)+(zt>223)+(zt>239);if(je+Ai>Ae.length)return[Me,le(Ae,je-1)];Ai?Ai==3?(zt=((15&zt)<<18|(63&Ae[je++])<<12|(63&Ae[je++])<<6|63&Ae[je++])-65536,Me+=String.fromCharCode(55296|zt>>10,56320|1023&zt)):Me+=String.fromCharCode(1&Ai?(31&zt)<<6|63&Ae[je++]:(15&zt)<<12|(63&Ae[je++])<<6|63&Ae[je++]):Me+=String.fromCharCode(zt)}},es=function(){function Ae(Me){this.ondata=Me,us?this.t=new TextDecoder:this.p=zi}return Ae.prototype.push=function(Me,je){if(!this.ondata)throw"no callback";if(je||(je=!1),this.t)return this.ondata(this.t.decode(Me,{stream:!je}),je);var zt=new D(this.p.length+Me.length);zt.set(this.p),zt.set(Me,this.p.length);var Ai=Ns(zt),Ui=Ai[0],bi=Ai[1];if(je&&bi.length)throw"invalid utf-8 data";this.p=bi,this.ondata(Ui,je)},Ae}();l.DecodeUTF8=es;var Fs=function(){function Ae(Me){this.ondata=Me}return Ae.prototype.push=function(Me,je){if(!this.ondata)throw"no callback";this.ondata(Ps(Me),je||!1)},Ae}();function Ps(Ae,Me){if(Me){for(var je=new D(Ae.length),zt=0;zt<Ae.length;++zt)je[zt]=Ae.charCodeAt(zt);return je}if(yr)return yr.encode(Ae);var Ai=Ae.length,Ui=new D(Ae.length+(Ae.length>>1)),bi=0,Yi=function(Ee){Ui[bi++]=Ee};for(zt=0;zt<Ai;++zt){if(bi+5>Ui.length){var fe=new D(bi+8+(Ai-zt<<1));fe.set(Ui),Ui=fe}var me=Ae.charCodeAt(zt);me<128||Me?Yi(me):me<2048?(Yi(192|me>>>6),Yi(128|63&me)):me>55295&&me<57344?(Yi(240|(me=65536+(1047552&me)|1023&Ae.charCodeAt(++zt))>>>18),Yi(128|me>>>12&63),Yi(128|me>>>6&63),Yi(128|63&me)):(Yi(224|me>>>12),Yi(128|me>>>6&63),Yi(128|63&me))}return le(Ui,0,bi)}function Mo(Ae,Me){if(Me){for(var je="",zt=0;zt<Ae.length;zt+=16384)je+=String.fromCharCode.apply(null,Ae.subarray(zt,zt+16384));return je}if(Jr)return Jr.decode(Ae);var Ai=Ns(Ae);if(Ai[1].length)throw"invalid utf-8 data";return Ai[0]}l.EncodeUTF8=Fs,l.strToU8=Ps,l.strFromU8=Mo;var Qo=function(Ae){return Ae==1?3:Ae<6?2:Ae==9?1:0},Ua=function(Ae,Me){return Me+30+cn(Ae,Me+26)+cn(Ae,Me+28)},ml=function(Ae,Me,je){var zt=cn(Ae,Me+28),Ai=Mo(Ae.subarray(Me+46,Me+46+zt),!(2048&cn(Ae,Me+8))),Ui=Me+46+zt,bi=_n(Ae,Me+20),Yi=je&&bi==4294967295?aa(Ae,Ui):[bi,_n(Ae,Me+24),_n(Ae,Me+42)],fe=Yi[0],me=Yi[1],Ee=Yi[2];return[cn(Ae,Me+10),fe,me,Ai,Ui+cn(Ae,Me+30)+cn(Ae,Me+32),Ee]},aa=function(Ae,Me){for(;cn(Ae,Me)!=1;Me+=4+cn(Ae,Me+2));return[Fn(Ae,Me+12),Fn(Ae,Me+4),Fn(Ae,Me+20)]},nr=function(Ae){var Me=0;if(Ae)for(var je in Ae){var zt=Ae[je].length;if(zt>65535)throw"extra field too long";Me+=zt+4}return Me},qo=function(Ae,Me,je,zt,Ai,Ui,bi,Yi){var fe=zt.length,me=je.extra,Ee=Yi&&Yi.length,Ke=nr(me);Mn(Ae,Me,bi!=null?33639248:67324752),Me+=4,bi!=null&&(Ae[Me++]=20,Ae[Me++]=je.os),Ae[Me]=20,Me+=2,Ae[Me++]=je.flag<<1|(Ui==null&&8),Ae[Me++]=Ai&&8,Ae[Me++]=255&je.compression,Ae[Me++]=je.compression>>8;var Pe=new Date(je.mtime==null?Date.now():je.mtime),ci=Pe.getFullYear()-1980;if(ci<0||ci>119)throw"date not in range 1980-2099";if(Mn(Ae,Me,2*(ci<<24)|Pe.getMonth()+1<<21|Pe.getDate()<<16|Pe.getHours()<<11|Pe.getMinutes()<<5|Pe.getSeconds()>>>1),Me+=4,Ui!=null&&(Mn(Ae,Me,je.crc),Mn(Ae,Me+4,Ui),Mn(Ae,Me+8,je.size)),Mn(Ae,Me+12,fe),Mn(Ae,Me+14,Ke),Me+=16,bi!=null&&(Mn(Ae,Me,Ee),Mn(Ae,Me+6,je.attrs),Mn(Ae,Me+10,bi),Me+=14),Ae.set(zt,Me),Me+=fe,Ke)for(var Mi in me){var Wi=me[Mi],hn=Wi.length;Mn(Ae,Me,+Mi),Mn(Ae,Me+2,hn),Ae.set(Wi,Me+4),Me+=4+hn}return Ee&&(Ae.set(Yi,Me),Me+=Ee),Me},go=function(Ae,Me,je,zt,Ai){Mn(Ae,Me,101010256),Mn(Ae,Me+8,je),Mn(Ae,Me+10,je),Mn(Ae,Me+12,zt),Mn(Ae,Me+16,Ai)},Vo=function(){function Ae(Me){this.filename=Me,this.c=mn(),this.size=0,this.compression=0}return Ae.prototype.process=function(Me,je){this.ondata(null,Me,je)},Ae.prototype.push=function(Me,je){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(Me),this.size+=Me.length,je&&(this.crc=this.c.d()),this.process(Me,je||!1)},Ae}();l.ZipPassThrough=Vo;var la=function(){function Ae(Me,je){var zt=this;je||(je={}),Vo.call(this,Me),this.d=new Ls(je,function(Ai,Ui){zt.ondata(null,Ai,Ui)}),this.compression=8,this.flag=Qo(je.level)}return Ae.prototype.process=function(Me,je){try{this.d.push(Me,je)}catch(zt){this.ondata(zt,null,je)}},Ae.prototype.push=function(Me,je){Vo.prototype.push.call(this,Me,je)},Ae}();l.ZipDeflate=la;var _o=function(){function Ae(Me,je){var zt=this;je||(je={}),Vo.call(this,Me),this.d=new To(je,function(Ai,Ui,bi){zt.ondata(Ai,Ui,bi)}),this.compression=8,this.flag=Qo(je.level),this.terminate=this.d.terminate}return Ae.prototype.process=function(Me,je){this.d.push(Me,je)},Ae.prototype.push=function(Me,je){Vo.prototype.push.call(this,Me,je)},Ae}();l.AsyncZipDeflate=_o;var $o=function(){function Ae(Me){this.ondata=Me,this.u=[],this.d=1}return Ae.prototype.add=function(Me){var je=this;if(2&this.d)throw"stream finished";var zt=Ps(Me.filename),Ai=zt.length,Ui=Me.comment,bi=Ui&&Ps(Ui),Yi=Ai!=Me.filename.length||bi&&Ui.length!=bi.length,fe=Ai+nr(Me.extra)+30;if(Ai>65535)throw"filename too long";var me=new D(fe);qo(me,0,Me,zt,Yi);var Ee=[me],Ke=function(){for(var hn=0,Dn=Ee;hn<Dn.length;hn++)je.ondata(null,Dn[hn],!1);Ee=[]},Pe=this.d;this.d=0;var ci=this.u.length,Mi=pr(Me,{f:zt,u:Yi,o:bi,t:function(){Me.terminate&&Me.terminate()},r:function(){if(Ke(),Pe){var hn=je.u[ci+1];hn?hn.r():je.d=1}Pe=1}}),Wi=0;Me.ondata=function(hn,Dn,Zi){if(hn)je.ondata(hn,Dn,Zi),je.terminate();else if(Wi+=Dn.length,Ee.push(Dn),Zi){var Kt=new D(16);Mn(Kt,0,134695760),Mn(Kt,4,Me.crc),Mn(Kt,8,Wi),Mn(Kt,12,Me.size),Ee.push(Kt),Mi.c=Wi,Mi.b=fe+Wi+16,Mi.crc=Me.crc,Mi.size=Me.size,Pe&&Mi.r(),Pe=1}else Pe&&Ke()},this.u.push(Mi)},Ae.prototype.end=function(){var Me=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&Me.d&&(Me.u.splice(-1,1),Me.e())},t:function(){}}),this.d=3},Ae.prototype.e=function(){for(var Me=0,je=0,zt=0,Ai=0,Ui=this.u;Ai<Ui.length;Ai++)zt+=46+(me=Ui[Ai]).f.length+nr(me.extra)+(me.o?me.o.length:0);for(var bi=new D(zt+22),Yi=0,fe=this.u;Yi<fe.length;Yi++){var me;qo(bi,Me,me=fe[Yi],me.f,me.u,me.c,je,me.o),Me+=46+me.f.length+nr(me.extra)+(me.o?me.o.length:0),je+=me.b}go(bi,Me,this.u.length,zt,je),this.ondata(null,bi,!0),this.d=2},Ae.prototype.terminate=function(){for(var Me=0,je=this.u;Me<je.length;Me++)je[Me].t();this.d=2},Ae}();function Ws(Ae,Me,je){if(je||(je=Me,Me={}),typeof je!="function")throw"no callback";var zt={};Gr(Ae,"",zt,Me);var Ai=Object.keys(zt),Ui=Ai.length,bi=0,Yi=0,fe=Ui,me=Array(Ui),Ee=[],Ke=function(){for(var Wi=0;Wi<Ee.length;++Wi)Ee[Wi]()},Pe=function(){var Wi=new D(Yi+22),hn=bi,Dn=Yi-bi;Yi=0;for(var Zi=0;Zi<fe;++Zi){var Kt=me[Zi];try{var nn=Kt.c.length;qo(Wi,Yi,Kt,Kt.f,Kt.u,nn);var Ei=30+Kt.f.length+nr(Kt.extra),Ln=Yi+Ei;Wi.set(Kt.c,Ln),qo(Wi,bi,Kt,Kt.f,Kt.u,nn,Yi,Kt.m),bi+=16+Ei+(Kt.m?Kt.m.length:0),Yi=Ln+nn}catch(Vi){return je(Vi,null)}}go(Wi,bi,me.length,Dn,hn),je(null,Wi)};Ui||Pe();for(var ci=function(Wi){var hn=Ai[Wi],Dn=zt[hn],Zi=Dn[0],Kt=Dn[1],nn=mn(),Ei=Zi.length;nn.p(Zi);var Ln=Ps(hn),Vi=Ln.length,fn=Kt.comment,cr=fn&&Ps(fn),gr=cr&&cr.length,_r=nr(Kt.extra),Rr=Kt.level==0?0:8,ur=function(wn,ws){if(wn)Ke(),je(wn,null);else{var wr=ws.length;me[Wi]=pr(Kt,{size:Ei,crc:nn.d(),c:ws,f:Ln,m:cr,u:Vi!=hn.length||cr&&fn.length!=gr,compression:Rr}),bi+=30+Vi+_r+wr,Yi+=76+2*(Vi+_r)+(gr||0)+wr,--Ui||Pe()}};if(Vi>65535&&ur("filename too long",null),Rr)if(Ei<16e4)try{ur(null,_s(Zi,Kt))}catch(wn){ur(wn,null)}else Ee.push(Ro(Zi,Kt,ur));else ur(null,Zi)},Mi=0;Mi<fe;++Mi)ci(Mi);return Ke}function _a(Ae,Me){Me||(Me={});var je={},zt=[];Gr(Ae,"",je,Me);var Ai=0,Ui=0;for(var bi in je){var Yi=je[bi],fe=Yi[0],me=Yi[1],Ee=me.level==0?0:8,Ke=(Vi=Ps(bi)).length,Pe=me.comment,ci=Pe&&Ps(Pe),Mi=ci&&ci.length,Wi=nr(me.extra);if(Ke>65535)throw"filename too long";var hn=Ee?_s(fe,me):fe,Dn=hn.length,Zi=mn();Zi.p(fe),zt.push(pr(me,{size:fe.length,crc:Zi.d(),c:hn,f:Vi,m:ci,u:Ke!=bi.length||ci&&Pe.length!=Mi,o:Ai,compression:Ee})),Ai+=30+Ke+Wi+Dn,Ui+=76+2*(Ke+Wi)+(Mi||0)+Dn}for(var Kt=new D(Ui+22),nn=Ai,Ei=Ui-Ai,Ln=0;Ln<zt.length;++Ln){var Vi;qo(Kt,(Vi=zt[Ln]).o,Vi,Vi.f,Vi.u,Vi.c.length);var fn=30+Vi.f.length+nr(Vi.extra);Kt.set(Vi.c,Vi.o+fn),qo(Kt,Ai,Vi,Vi.f,Vi.u,Vi.c.length,Vi.o,Vi.m),Ai+=16+fn+(Vi.m?Vi.m.length:0)}return go(Kt,Ai,zt.length,Ei,nn),Kt}l.Zip=$o,l.zip=Ws,l.zipSync=_a;var gl=function(){function Ae(){}return Ae.prototype.push=function(Me,je){this.ondata(null,Me,je)},Ae.compression=0,Ae}();l.UnzipPassThrough=gl;var Va=function(){function Ae(){var Me=this;this.i=new js(function(je,zt){Me.ondata(null,je,zt)})}return Ae.prototype.push=function(Me,je){try{this.i.push(Me,je)}catch(zt){this.ondata(zt,Me,je)}},Ae.compression=8,Ae}();l.UnzipInflate=Va;var Hl=function(){function Ae(Me,je){var zt=this;je<32e4?this.i=new js(function(Ai,Ui){zt.ondata(null,Ai,Ui)}):(this.i=new Dr(function(Ai,Ui,bi){zt.ondata(Ai,Ui,bi)}),this.terminate=this.i.terminate)}return Ae.prototype.push=function(Me,je){this.i.terminate&&(Me=le(Me,0)),this.i.push(Me,je)},Ae.compression=8,Ae}();l.AsyncUnzipInflate=Hl;var Us=function(){function Ae(Me){this.onfile=Me,this.k=[],this.o={0:gl},this.p=zi}return Ae.prototype.push=function(Me,je){var zt=this;if(!this.onfile)throw"no callback";if(this.c>0){var Ai=Math.min(this.c,Me.length),Ui=Me.subarray(0,Ai);if(this.c-=Ai,this.d?this.d.push(Ui,!this.c):this.k[0].push(Ui),(Me=Me.subarray(Ai)).length)return this.push(Me,je)}else{var bi=0,Yi=0,fe=void 0,me=void 0;this.p.length?Me.length?((me=new D(this.p.length+Me.length)).set(this.p),me.set(Me,this.p.length)):me=this.p:me=Me;for(var Ee=me.length,Ke=this.c,Pe=Ke&&this.d,ci=function(){var hn,Dn=_n(me,Yi);if(Dn==67324752){bi=1,fe=Yi,Mi.d=null,Mi.c=0;var Zi=cn(me,Yi+6),Kt=cn(me,Yi+8),nn=2048&Zi,Ei=8&Zi,Ln=cn(me,Yi+26),Vi=cn(me,Yi+28);if(Ee>Yi+30+Ln+Vi){var fn=[];Mi.k.unshift(fn),bi=2;var cr=_n(me,Yi+18),gr=_n(me,Yi+22),_r=Mo(me.subarray(Yi+30,Yi+=30+Ln),!nn);cr==4294967295?(hn=Ei?[-2]:aa(me,Yi),cr=hn[0],gr=hn[1]):Ei&&(cr=-1),Yi+=Vi,Mi.c=cr;var Rr={name:_r,compression:Kt,start:function(){if(!Rr.ondata)throw"no callback";if(cr){var ur=zt.o[Kt];if(!ur)throw"unknown compression type "+Kt;var wn=cr<0?new ur(_r):new ur(_r,cr,gr);wn.ondata=function(Vs,Or,so){Rr.ondata(Vs,Or,so)};for(var ws=0,wr=fn;ws<wr.length;ws++)wn.push(wr[ws],!1);zt.k[0]==fn?zt.d=wn:wn.push(zi,!0)}else Rr.ondata(null,zi,!0)},terminate:function(){zt.k[0]==fn&&zt.d.terminate&&zt.d.terminate()}};cr>=0&&(Rr.size=cr,Rr.originalSize=gr),Mi.onfile(Rr)}return"break"}if(Ke){if(Dn==134695760)return fe=Yi+=12+(Ke==-2&&8),bi=2,Mi.c=0,"break";if(Dn==33639248)return fe=Yi-=4,bi=2,Mi.c=0,"break"}},Mi=this;Yi<Ee-4&&ci()!=="break";++Yi);if(this.p=zi,Ke<0){var Wi=me.subarray(0,bi?fe-12-(Ke==-2&&8)-(_n(me,fe-16)==134695760&&4):Yi);Pe?Pe.push(Wi,!!bi):this.k[+(bi==2)].push(Wi)}if(2&bi)return this.push(me.subarray(Yi),je);this.p=me.subarray(Yi)}if(je&&this.c)throw"invalid zip file"},Ae.prototype.register=function(Me){this.o[Me.compression]=Me},Ae}();function _l(Ae,Me){if(typeof Me!="function")throw"no callback";for(var je=[],zt=function(){for(var Pe=0;Pe<je.length;++Pe)je[Pe]()},Ai={},Ui=Ae.length-22;_n(Ae,Ui)!=101010256;--Ui)if(!Ui||Ae.length-Ui>65558)return void Me("invalid zip file",null);var bi=cn(Ae,Ui+8);bi||Me(null,{});var Yi=bi,fe=_n(Ae,Ui+16),me=fe==4294967295;if(me){if(Ui=_n(Ae,Ui-12),_n(Ae,Ui)!=101075792)return void Me("invalid zip file",null);Yi=bi=_n(Ae,Ui+32),fe=_n(Ae,Ui+48)}for(var Ee=function(Pe){var ci=ml(Ae,fe,me),Mi=ci[0],Wi=ci[1],hn=ci[2],Dn=ci[3],Zi=ci[4],Kt=Ua(Ae,ci[5]);fe=Zi;var nn=function(Ln,Vi){Ln?(zt(),Me(Ln,null)):(Ai[Dn]=Vi,--bi||Me(null,Ai))};if(Mi)if(Mi==8){var Ei=Ae.subarray(Kt,Kt+Wi);if(Wi<32e4)try{nn(null,po(Ei,new D(hn)))}catch(Ln){nn(Ln,null)}else je.push(ro(Ei,{size:hn},nn))}else nn("unknown compression type "+Mi,null);else nn(null,le(Ae,Kt,Kt+Wi))},Ke=0;Ke<Yi;++Ke)Ee();return zt}function yl(Ae){for(var Me={},je=Ae.length-22;_n(Ae,je)!=101010256;--je)if(!je||Ae.length-je>65558)throw"invalid zip file";var zt=cn(Ae,je+8);if(!zt)return{};var Ai=_n(Ae,je+16),Ui=Ai==4294967295;if(Ui){if(je=_n(Ae,je-12),_n(Ae,je)!=101075792)throw"invalid zip file";zt=_n(Ae,je+32),Ai=_n(Ae,je+48)}for(var bi=0;bi<zt;++bi){var Yi=ml(Ae,Ai,Ui),fe=Yi[0],me=Yi[1],Ee=Yi[2],Ke=Yi[3],Pe=Yi[4],ci=Ua(Ae,Yi[5]);if(Ai=Pe,fe){if(fe!=8)throw"unknown compression type "+fe;Me[Ke]=po(Ae.subarray(ci,ci+me),new D(Ee))}else Me[Ke]=le(Ae,ci,ci+me)}return Me}return l.Unzip=Us,l.unzip=_l,l.unzipSync=yl,l})}(gv,gv.exports)),gv.exports}var QS;function Nk(){return QS||(QS=1,function(c,p){const l=Na(),E=Bk();(function(){let D,N,B;class n extends l.Loader{constructor(le){super(le)}load(le,we,xe,De){const Ce=this,Gt=Ce.path===""?l.LoaderUtils.extractUrlBase(le):Ce.path,Ft=new l.FileLoader(this.manager);Ft.setPath(Ce.path),Ft.setResponseType("arraybuffer"),Ft.setRequestHeader(Ce.requestHeader),Ft.setWithCredentials(Ce.withCredentials),Ft.load(le,function(bt){try{we(Ce.parse(bt,Gt))}catch(Vt){De?De(Vt):console.error(Vt),Ce.manager.itemError(le)}},xe,De)}parse(le,we){if(it(le))D=new ze().parse(le);else{const De=qe(le);if(!xt(De))throw new Error("THREE.FBXLoader: Unknown format.");if(Ze(De)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Ze(De));D=new ve().parse(De)}const xe=new l.TextureLoader(this.manager).setPath(this.resourcePath||we).setCrossOrigin(this.crossOrigin);return new X(xe,this.manager).parse(D)}}class X{constructor(le,we){this.textureLoader=le,this.manager=we}parse(){N=this.parseConnections();const le=this.parseImages(),we=this.parseTextures(le),xe=this.parseMaterials(we),De=this.parseDeformers(),Ce=new $().parse(De);return this.parseScene(De,Ce,xe),B}parseConnections(){const le=new Map;return"Connections"in D&&D.Connections.connections.forEach(function(xe){const De=xe[0],Ce=xe[1],Gt=xe[2];le.has(De)||le.set(De,{parents:[],children:[]});const Ft={ID:Ce,relationship:Gt};le.get(De).parents.push(Ft),le.has(Ce)||le.set(Ce,{parents:[],children:[]});const bt={ID:De,relationship:Gt};le.get(Ce).children.push(bt)}),le}parseImages(){const le={},we={};if("Video"in D.Objects){const xe=D.Objects.Video;for(const De in xe){const Ce=xe[De],Gt=parseInt(De);if(le[Gt]=Ce.RelativeFilename||Ce.Filename,"Content"in Ce){const Ft=Ce.Content instanceof ArrayBuffer&&Ce.Content.byteLength>0,bt=typeof Ce.Content=="string"&&Ce.Content!=="";if(Ft||bt){const Vt=this.parseImage(xe[De]);we[Ce.RelativeFilename||Ce.Filename]=Vt}}}}for(const xe in le){const De=le[xe];we[De]!==void 0?le[xe]=we[De]:le[xe]=le[xe].split("\\").pop()}return le}parseImage(le){const we=le.Content,xe=le.RelativeFilename||le.Filename,De=xe.slice(xe.lastIndexOf(".")+1).toLowerCase();let Ce;switch(De){case"bmp":Ce="image/bmp";break;case"jpg":case"jpeg":Ce="image/jpeg";break;case"png":Ce="image/png";break;case"tif":Ce="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",xe),Ce="image/tga";break;default:console.warn('FBXLoader: Image type "'+De+'" is not supported.');return}if(typeof we=="string")return"data:"+Ce+";base64,"+we;{const Gt=new Uint8Array(we);return window.URL.createObjectURL(new Blob([Gt],{type:Ce}))}}parseTextures(le){const we=new Map;if("Texture"in D.Objects){const xe=D.Objects.Texture;for(const De in xe){const Ce=this.parseTexture(xe[De],le);we.set(parseInt(De),Ce)}}return we}parseTexture(le,we){const xe=this.loadTexture(le,we);xe.ID=le.id,xe.name=le.attrName;const De=le.WrapModeU,Ce=le.WrapModeV,Gt=De!==void 0?De.value:0,Ft=Ce!==void 0?Ce.value:0;if(xe.wrapS=Gt===0?l.RepeatWrapping:l.ClampToEdgeWrapping,xe.wrapT=Ft===0?l.RepeatWrapping:l.ClampToEdgeWrapping,"Scaling"in le){const bt=le.Scaling.value;xe.repeat.x=bt[0],xe.repeat.y=bt[1]}return xe}loadTexture(le,we){let xe;const De=this.textureLoader.path,Ce=N.get(le.id).children;Ce!==void 0&&Ce.length>0&&we[Ce[0].ID]!==void 0&&(xe=we[Ce[0].ID],(xe.indexOf("blob:")===0||xe.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let Gt;const Ft=le.FileName.slice(-3).toLowerCase();if(Ft==="tga"){const bt=this.manager.getHandler(".tga");bt===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",le.RelativeFilename),Gt=new l.Texture):(bt.setPath(this.textureLoader.path),Gt=bt.load(xe))}else Ft==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",le.RelativeFilename),Gt=new l.Texture):Gt=this.textureLoader.load(xe);return this.textureLoader.setPath(De),Gt}parseMaterials(le){const we=new Map;if("Material"in D.Objects){const xe=D.Objects.Material;for(const De in xe){const Ce=this.parseMaterial(xe[De],le);Ce!==null&&we.set(parseInt(De),Ce)}}return we}parseMaterial(le,we){const xe=le.id,De=le.attrName;let Ce=le.ShadingModel;if(typeof Ce=="object"&&(Ce=Ce.value),!N.has(xe))return null;const Gt=this.parseParameters(le,we,xe);let Ft;switch(Ce.toLowerCase()){case"phong":Ft=new l.MeshPhongMaterial;break;case"lambert":Ft=new l.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to THREE.MeshPhongMaterial.',Ce),Ft=new l.MeshPhongMaterial;break}return Ft.setValues(Gt),Ft.name=De,Ft}parseParameters(le,we,xe){const De={};le.BumpFactor&&(De.bumpScale=le.BumpFactor.value),le.Diffuse?De.color=new l.Color().fromArray(le.Diffuse.value):le.DiffuseColor&&(le.DiffuseColor.type==="Color"||le.DiffuseColor.type==="ColorRGB")&&(De.color=new l.Color().fromArray(le.DiffuseColor.value)),le.DisplacementFactor&&(De.displacementScale=le.DisplacementFactor.value),le.Emissive?De.emissive=new l.Color().fromArray(le.Emissive.value):le.EmissiveColor&&(le.EmissiveColor.type==="Color"||le.EmissiveColor.type==="ColorRGB")&&(De.emissive=new l.Color().fromArray(le.EmissiveColor.value)),le.EmissiveFactor&&(De.emissiveIntensity=parseFloat(le.EmissiveFactor.value)),le.Opacity&&(De.opacity=parseFloat(le.Opacity.value)),De.opacity<1&&(De.transparent=!0),le.ReflectionFactor&&(De.reflectivity=le.ReflectionFactor.value),le.Shininess&&(De.shininess=le.Shininess.value),le.Specular?De.specular=new l.Color().fromArray(le.Specular.value):le.SpecularColor&&le.SpecularColor.type==="Color"&&(De.specular=new l.Color().fromArray(le.SpecularColor.value));const Ce=this;return N.get(xe).children.forEach(function(Gt){const Ft=Gt.relationship;switch(Ft){case"Bump":De.bumpMap=Ce.getTexture(we,Gt.ID);break;case"Maya|TEX_ao_map":De.aoMap=Ce.getTexture(we,Gt.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":De.map=Ce.getTexture(we,Gt.ID),De.map!==void 0&&(De.map.encoding=l.sRGBEncoding);break;case"DisplacementColor":De.displacementMap=Ce.getTexture(we,Gt.ID);break;case"EmissiveColor":De.emissiveMap=Ce.getTexture(we,Gt.ID),De.emissiveMap!==void 0&&(De.emissiveMap.encoding=l.sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":De.normalMap=Ce.getTexture(we,Gt.ID);break;case"ReflectionColor":De.envMap=Ce.getTexture(we,Gt.ID),De.envMap!==void 0&&(De.envMap.mapping=l.EquirectangularReflectionMapping,De.envMap.encoding=l.sRGBEncoding);break;case"SpecularColor":De.specularMap=Ce.getTexture(we,Gt.ID),De.specularMap!==void 0&&(De.specularMap.encoding=l.sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":De.alphaMap=Ce.getTexture(we,Gt.ID),De.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",Ft);break}}),De}getTexture(le,we){return"LayeredTexture"in D.Objects&&we in D.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),we=N.get(we).children[0].ID),le.get(we)}parseDeformers(){const le={},we={};if("Deformer"in D.Objects){const xe=D.Objects.Deformer;for(const De in xe){const Ce=xe[De],Gt=N.get(parseInt(De));if(Ce.attrType==="Skin"){const Ft=this.parseSkeleton(Gt,xe);Ft.ID=De,Gt.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),Ft.geometryID=Gt.parents[0].ID,le[De]=Ft}else if(Ce.attrType==="BlendShape"){const Ft={id:De};Ft.rawTargets=this.parseMorphTargets(Gt,xe),Ft.id=De,Gt.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),we[De]=Ft}}}return{skeletons:le,morphTargets:we}}parseSkeleton(le,we){const xe=[];return le.children.forEach(function(De){const Ce=we[De.ID];if(Ce.attrType!=="Cluster")return;const Gt={ID:De.ID,indices:[],weights:[],transformLink:new l.Matrix4().fromArray(Ce.TransformLink.a)};"Indexes"in Ce&&(Gt.indices=Ce.Indexes.a,Gt.weights=Ce.Weights.a),xe.push(Gt)}),{rawBones:xe,bones:[]}}parseMorphTargets(le,we){const xe=[];for(let De=0;De<le.children.length;De++){const Ce=le.children[De],Gt=we[Ce.ID],Ft={name:Gt.attrName,initialWeight:Gt.DeformPercent,id:Gt.id,fullWeights:Gt.FullWeights.a};if(Gt.attrType!=="BlendShapeChannel")return;Ft.geoID=N.get(parseInt(Ce.ID)).children.filter(function(bt){return bt.relationship===void 0})[0].ID,xe.push(Ft)}return xe}parseScene(le,we,xe){B=new l.Group;const De=this.parseModels(le.skeletons,we,xe),Ce=D.Objects.Model,Gt=this;De.forEach(function(bt){const Vt=Ce[bt.ID];Gt.setLookAtProperties(bt,Vt),N.get(bt.ID).parents.forEach(function(ni){const zi=De.get(ni.ID);zi!==void 0&&zi.add(bt)}),bt.parent===null&&B.add(bt)}),this.bindSkeleton(le.skeletons,we,De),this.createAmbientLight(),B.traverse(function(bt){if(bt.userData.transformData){bt.parent&&(bt.userData.transformData.parentMatrix=bt.parent.matrix,bt.userData.transformData.parentMatrixWorld=bt.parent.matrixWorld);const Vt=Fe(bt.userData.transformData);bt.applyMatrix4(Vt),bt.updateWorldMatrix()}});const Ft=new ne().parse();B.children.length===1&&B.children[0].isGroup&&(B.children[0].animations=Ft,B=B.children[0]),B.animations=Ft}parseModels(le,we,xe){const De=new Map,Ce=D.Objects.Model;for(const Gt in Ce){const Ft=parseInt(Gt),bt=Ce[Gt],Vt=N.get(Ft);let Ht=this.buildSkeleton(Vt,le,Ft,bt.attrName);if(!Ht){switch(bt.attrType){case"Camera":Ht=this.createCamera(Vt);break;case"Light":Ht=this.createLight(Vt);break;case"Mesh":Ht=this.createMesh(Vt,we,xe);break;case"NurbsCurve":Ht=this.createCurve(Vt,we);break;case"LimbNode":case"Root":Ht=new l.Bone;break;case"Null":default:Ht=new l.Group;break}Ht.name=bt.attrName?l.PropertyBinding.sanitizeNodeName(bt.attrName):"",Ht.ID=Ft}this.getTransformData(Ht,bt),De.set(Ft,Ht)}return De}buildSkeleton(le,we,xe,De){let Ce=null;return le.parents.forEach(function(Gt){for(const Ft in we){const bt=we[Ft];bt.rawBones.forEach(function(Vt,Ht){if(Vt.ID===Gt.ID){const ni=Ce;Ce=new l.Bone,Ce.matrixWorld.copy(Vt.transformLink),Ce.name=De?l.PropertyBinding.sanitizeNodeName(De):"",Ce.ID=xe,bt.bones[Ht]=Ce,ni!==null&&Ce.add(ni)}})}}),Ce}createCamera(le){let we,xe;if(le.children.forEach(function(De){const Ce=D.Objects.NodeAttribute[De.ID];Ce!==void 0&&(xe=Ce)}),xe===void 0)we=new l.Object3D;else{let De=0;xe.CameraProjectionType!==void 0&&xe.CameraProjectionType.value===1&&(De=1);let Ce=1;xe.NearPlane!==void 0&&(Ce=xe.NearPlane.value/1e3);let Gt=1e3;xe.FarPlane!==void 0&&(Gt=xe.FarPlane.value/1e3);let Ft=window.innerWidth,bt=window.innerHeight;xe.AspectWidth!==void 0&&xe.AspectHeight!==void 0&&(Ft=xe.AspectWidth.value,bt=xe.AspectHeight.value);const Vt=Ft/bt;let Ht=45;xe.FieldOfView!==void 0&&(Ht=xe.FieldOfView.value);const ni=xe.FocalLength?xe.FocalLength.value:null;switch(De){case 0:we=new l.PerspectiveCamera(Ht,Vt,Ce,Gt),ni!==null&&we.setFocalLength(ni);break;case 1:we=new l.OrthographicCamera(-Ft/2,Ft/2,bt/2,-bt/2,Ce,Gt);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+De+"."),we=new l.Object3D;break}}return we}createLight(le){let we,xe;if(le.children.forEach(function(De){const Ce=D.Objects.NodeAttribute[De.ID];Ce!==void 0&&(xe=Ce)}),xe===void 0)we=new l.Object3D;else{let De;xe.LightType===void 0?De=0:De=xe.LightType.value;let Ce=16777215;xe.Color!==void 0&&(Ce=new l.Color().fromArray(xe.Color.value));let Gt=xe.Intensity===void 0?1:xe.Intensity.value/100;xe.CastLightOnObject!==void 0&&xe.CastLightOnObject.value===0&&(Gt=0);let Ft=0;xe.FarAttenuationEnd!==void 0&&(xe.EnableFarAttenuation!==void 0&&xe.EnableFarAttenuation.value===0?Ft=0:Ft=xe.FarAttenuationEnd.value);const bt=1;switch(De){case 0:we=new l.PointLight(Ce,Gt,Ft,bt);break;case 1:we=new l.DirectionalLight(Ce,Gt);break;case 2:let Vt=Math.PI/3;xe.InnerAngle!==void 0&&(Vt=l.MathUtils.degToRad(xe.InnerAngle.value));let Ht=0;xe.OuterAngle!==void 0&&(Ht=l.MathUtils.degToRad(xe.OuterAngle.value),Ht=Math.max(Ht,1)),we=new l.SpotLight(Ce,Gt,Ft,Vt,Ht,bt);break;default:console.warn("THREE.FBXLoader: Unknown light type "+xe.LightType.value+", defaulting to a THREE.PointLight."),we=new l.PointLight(Ce,Gt);break}xe.CastShadows!==void 0&&xe.CastShadows.value===1&&(we.castShadow=!0)}return we}createMesh(le,we,xe){let De,Ce=null,Gt=null;const Ft=[];return le.children.forEach(function(bt){we.has(bt.ID)&&(Ce=we.get(bt.ID)),xe.has(bt.ID)&&Ft.push(xe.get(bt.ID))}),Ft.length>1?Gt=Ft:Ft.length>0?Gt=Ft[0]:(Gt=new l.MeshPhongMaterial({color:13421772}),Ft.push(Gt)),"color"in Ce.attributes&&Ft.forEach(function(bt){bt.vertexColors=!0}),Ce.FBX_Deformer?(De=new l.SkinnedMesh(Ce,Gt),De.normalizeSkinWeights()):De=new l.Mesh(Ce,Gt),De}createCurve(le,we){const xe=le.children.reduce(function(Ce,Gt){return we.has(Gt.ID)&&(Ce=we.get(Gt.ID)),Ce},null),De=new l.LineBasicMaterial({color:3342591,linewidth:1});return new l.Line(xe,De)}getTransformData(le,we){const xe={};"InheritType"in we&&(xe.inheritType=parseInt(we.InheritType.value)),"RotationOrder"in we?xe.eulerOrder=et(we.RotationOrder.value):xe.eulerOrder="ZYX","Lcl_Translation"in we&&(xe.translation=we.Lcl_Translation.value),"PreRotation"in we&&(xe.preRotation=we.PreRotation.value),"Lcl_Rotation"in we&&(xe.rotation=we.Lcl_Rotation.value),"PostRotation"in we&&(xe.postRotation=we.PostRotation.value),"Lcl_Scaling"in we&&(xe.scale=we.Lcl_Scaling.value),"ScalingOffset"in we&&(xe.scalingOffset=we.ScalingOffset.value),"ScalingPivot"in we&&(xe.scalingPivot=we.ScalingPivot.value),"RotationOffset"in we&&(xe.rotationOffset=we.RotationOffset.value),"RotationPivot"in we&&(xe.rotationPivot=we.RotationPivot.value),le.userData.transformData=xe}setLookAtProperties(le,we){"LookAtProperty"in we&&N.get(le.ID).children.forEach(function(De){if(De.relationship==="LookAtProperty"){const Ce=D.Objects.Model[De.ID];if("Lcl_Translation"in Ce){const Gt=Ce.Lcl_Translation.value;le.target!==void 0?(le.target.position.fromArray(Gt),B.add(le.target)):le.lookAt(new l.Vector3().fromArray(Gt))}}})}bindSkeleton(le,we,xe){const De=this.parsePoseNodes();for(const Ce in le){const Gt=le[Ce];N.get(parseInt(Gt.ID)).parents.forEach(function(bt){if(we.has(bt.ID)){const Vt=bt.ID;N.get(Vt).parents.forEach(function(ni){xe.has(ni.ID)&&xe.get(ni.ID).bind(new l.Skeleton(Gt.bones),De[ni.ID])})}})}}parsePoseNodes(){const le={};if("Pose"in D.Objects){const we=D.Objects.Pose;for(const xe in we)if(we[xe].attrType==="BindPose"){const De=we[xe].PoseNode;Array.isArray(De)?De.forEach(function(Ce){le[Ce.Node]=new l.Matrix4().fromArray(Ce.Matrix.a)}):le[De.Node]=new l.Matrix4().fromArray(De.Matrix.a)}}return le}createAmbientLight(){if("GlobalSettings"in D&&"AmbientColor"in D.GlobalSettings){const le=D.GlobalSettings.AmbientColor.value,we=le[0],xe=le[1],De=le[2];if(we!==0||xe!==0||De!==0){const Ce=new l.Color(we,xe,De);B.add(new l.AmbientLight(Ce,1))}}}}class ${parse(le){const we=new Map;if("Geometry"in D.Objects){const xe=D.Objects.Geometry;for(const De in xe){const Ce=N.get(parseInt(De)),Gt=this.parseGeometry(Ce,xe[De],le);we.set(parseInt(De),Gt)}}return we}parseGeometry(le,we,xe){switch(we.attrType){case"Mesh":return this.parseMeshGeometry(le,we,xe);case"NurbsCurve":return this.parseNurbsGeometry(we)}}parseMeshGeometry(le,we,xe){const De=xe.skeletons,Ce=[],Gt=le.parents.map(function(ni){return D.Objects.Model[ni.ID]});if(Gt.length===0)return;const Ft=le.children.reduce(function(ni,zi){return De[zi.ID]!==void 0&&(ni=De[zi.ID]),ni},null);le.children.forEach(function(ni){xe.morphTargets[ni.ID]!==void 0&&Ce.push(xe.morphTargets[ni.ID])});const bt=Gt[0],Vt={};"RotationOrder"in bt&&(Vt.eulerOrder=et(bt.RotationOrder.value)),"InheritType"in bt&&(Vt.inheritType=parseInt(bt.InheritType.value)),"GeometricTranslation"in bt&&(Vt.translation=bt.GeometricTranslation.value),"GeometricRotation"in bt&&(Vt.rotation=bt.GeometricRotation.value),"GeometricScaling"in bt&&(Vt.scale=bt.GeometricScaling.value);const Ht=Fe(Vt);return this.genGeometry(we,Ft,Ce,Ht)}genGeometry(le,we,xe,De){const Ce=new l.BufferGeometry;le.attrName&&(Ce.name=le.attrName);const Gt=this.parseGeoNode(le,we),Ft=this.genBuffers(Gt),bt=new l.Float32BufferAttribute(Ft.vertex,3);if(bt.applyMatrix4(De),Ce.setAttribute("position",bt),Ft.colors.length>0&&Ce.setAttribute("color",new l.Float32BufferAttribute(Ft.colors,3)),we&&(Ce.setAttribute("skinIndex",new l.Uint16BufferAttribute(Ft.weightsIndices,4)),Ce.setAttribute("skinWeight",new l.Float32BufferAttribute(Ft.vertexWeights,4)),Ce.FBX_Deformer=we),Ft.normal.length>0){const Vt=new l.Matrix3().getNormalMatrix(De),Ht=new l.Float32BufferAttribute(Ft.normal,3);Ht.applyNormalMatrix(Vt),Ce.setAttribute("normal",Ht)}if(Ft.uvs.forEach(function(Vt,Ht){let ni="uv"+(Ht+1).toString();Ht===0&&(ni="uv"),Ce.setAttribute(ni,new l.Float32BufferAttribute(Ft.uvs[Ht],2))}),Gt.material&&Gt.material.mappingType!=="AllSame"){let Vt=Ft.materialIndex[0],Ht=0;if(Ft.materialIndex.forEach(function(ni,zi){ni!==Vt&&(Ce.addGroup(Ht,zi-Ht,Vt),Vt=ni,Ht=zi)}),Ce.groups.length>0){const ni=Ce.groups[Ce.groups.length-1],zi=ni.start+ni.count;zi!==Ft.materialIndex.length&&Ce.addGroup(zi,Ft.materialIndex.length-zi,Vt)}Ce.groups.length===0&&Ce.addGroup(0,Ft.materialIndex.length,Ft.materialIndex[0])}return this.addMorphTargets(Ce,le,xe,De),Ce}parseGeoNode(le,we){const xe={};if(xe.vertexPositions=le.Vertices!==void 0?le.Vertices.a:[],xe.vertexIndices=le.PolygonVertexIndex!==void 0?le.PolygonVertexIndex.a:[],le.LayerElementColor&&(xe.color=this.parseVertexColors(le.LayerElementColor[0])),le.LayerElementMaterial&&(xe.material=this.parseMaterialIndices(le.LayerElementMaterial[0])),le.LayerElementNormal&&(xe.normal=this.parseNormals(le.LayerElementNormal[0])),le.LayerElementUV){xe.uv=[];let De=0;for(;le.LayerElementUV[De];)le.LayerElementUV[De].UV&&xe.uv.push(this.parseUVs(le.LayerElementUV[De])),De++}return xe.weightTable={},we!==null&&(xe.skeleton=we,we.rawBones.forEach(function(De,Ce){De.indices.forEach(function(Gt,Ft){xe.weightTable[Gt]===void 0&&(xe.weightTable[Gt]=[]),xe.weightTable[Gt].push({id:Ce,weight:De.weights[Ft]})})})),xe}genBuffers(le){const we={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let xe=0,De=0,Ce=!1,Gt=[],Ft=[],bt=[],Vt=[],Ht=[],ni=[];const zi=this;return le.vertexIndices.forEach(function(Hi,on){let mn,ot=!1;Hi<0&&(Hi=Hi^-1,ot=!0);let Yn=[],pr=[];if(Gt.push(Hi*3,Hi*3+1,Hi*3+2),le.color){const At=mt(on,xe,Hi,le.color);bt.push(At[0],At[1],At[2])}if(le.skeleton){if(le.weightTable[Hi]!==void 0&&le.weightTable[Hi].forEach(function(At){pr.push(At.weight),Yn.push(At.id)}),pr.length>4){Ce||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),Ce=!0);const At=[0,0,0,0],Ye=[0,0,0,0];pr.forEach(function(kt,Le){let Ie=kt,Ue=Yn[Le];Ye.forEach(function(We,rt,ut){if(Ie>We){ut[rt]=Ie,Ie=We;const ht=At[rt];At[rt]=Ue,Ue=ht}})}),Yn=At,pr=Ye}for(;pr.length<4;)pr.push(0),Yn.push(0);for(let At=0;At<4;++At)Ht.push(pr[At]),ni.push(Yn[At])}if(le.normal){const At=mt(on,xe,Hi,le.normal);Ft.push(At[0],At[1],At[2])}le.material&&le.material.mappingType!=="AllSame"&&(mn=mt(on,xe,Hi,le.material)[0]),le.uv&&le.uv.forEach(function(At,Ye){const kt=mt(on,xe,Hi,At);Vt[Ye]===void 0&&(Vt[Ye]=[]),Vt[Ye].push(kt[0]),Vt[Ye].push(kt[1])}),De++,ot&&(zi.genFace(we,le,Gt,mn,Ft,bt,Vt,Ht,ni,De),xe++,De=0,Gt=[],Ft=[],bt=[],Vt=[],Ht=[],ni=[])}),we}genFace(le,we,xe,De,Ce,Gt,Ft,bt,Vt,Ht){for(let ni=2;ni<Ht;ni++)le.vertex.push(we.vertexPositions[xe[0]]),le.vertex.push(we.vertexPositions[xe[1]]),le.vertex.push(we.vertexPositions[xe[2]]),le.vertex.push(we.vertexPositions[xe[(ni-1)*3]]),le.vertex.push(we.vertexPositions[xe[(ni-1)*3+1]]),le.vertex.push(we.vertexPositions[xe[(ni-1)*3+2]]),le.vertex.push(we.vertexPositions[xe[ni*3]]),le.vertex.push(we.vertexPositions[xe[ni*3+1]]),le.vertex.push(we.vertexPositions[xe[ni*3+2]]),we.skeleton&&(le.vertexWeights.push(bt[0]),le.vertexWeights.push(bt[1]),le.vertexWeights.push(bt[2]),le.vertexWeights.push(bt[3]),le.vertexWeights.push(bt[(ni-1)*4]),le.vertexWeights.push(bt[(ni-1)*4+1]),le.vertexWeights.push(bt[(ni-1)*4+2]),le.vertexWeights.push(bt[(ni-1)*4+3]),le.vertexWeights.push(bt[ni*4]),le.vertexWeights.push(bt[ni*4+1]),le.vertexWeights.push(bt[ni*4+2]),le.vertexWeights.push(bt[ni*4+3]),le.weightsIndices.push(Vt[0]),le.weightsIndices.push(Vt[1]),le.weightsIndices.push(Vt[2]),le.weightsIndices.push(Vt[3]),le.weightsIndices.push(Vt[(ni-1)*4]),le.weightsIndices.push(Vt[(ni-1)*4+1]),le.weightsIndices.push(Vt[(ni-1)*4+2]),le.weightsIndices.push(Vt[(ni-1)*4+3]),le.weightsIndices.push(Vt[ni*4]),le.weightsIndices.push(Vt[ni*4+1]),le.weightsIndices.push(Vt[ni*4+2]),le.weightsIndices.push(Vt[ni*4+3])),we.color&&(le.colors.push(Gt[0]),le.colors.push(Gt[1]),le.colors.push(Gt[2]),le.colors.push(Gt[(ni-1)*3]),le.colors.push(Gt[(ni-1)*3+1]),le.colors.push(Gt[(ni-1)*3+2]),le.colors.push(Gt[ni*3]),le.colors.push(Gt[ni*3+1]),le.colors.push(Gt[ni*3+2])),we.material&&we.material.mappingType!=="AllSame"&&(le.materialIndex.push(De),le.materialIndex.push(De),le.materialIndex.push(De)),we.normal&&(le.normal.push(Ce[0]),le.normal.push(Ce[1]),le.normal.push(Ce[2]),le.normal.push(Ce[(ni-1)*3]),le.normal.push(Ce[(ni-1)*3+1]),le.normal.push(Ce[(ni-1)*3+2]),le.normal.push(Ce[ni*3]),le.normal.push(Ce[ni*3+1]),le.normal.push(Ce[ni*3+2])),we.uv&&we.uv.forEach(function(zi,Hi){le.uvs[Hi]===void 0&&(le.uvs[Hi]=[]),le.uvs[Hi].push(Ft[Hi][0]),le.uvs[Hi].push(Ft[Hi][1]),le.uvs[Hi].push(Ft[Hi][(ni-1)*2]),le.uvs[Hi].push(Ft[Hi][(ni-1)*2+1]),le.uvs[Hi].push(Ft[Hi][ni*2]),le.uvs[Hi].push(Ft[Hi][ni*2+1])})}addMorphTargets(le,we,xe,De){if(xe.length===0)return;le.morphTargetsRelative=!0,le.morphAttributes.position=[];const Ce=this;xe.forEach(function(Gt){Gt.rawTargets.forEach(function(Ft){const bt=D.Objects.Geometry[Ft.geoID];bt!==void 0&&Ce.genMorphGeometry(le,we,bt,De,Ft.name)})})}genMorphGeometry(le,we,xe,De,Ce){const Gt=we.PolygonVertexIndex!==void 0?we.PolygonVertexIndex.a:[],Ft=xe.Vertices!==void 0?xe.Vertices.a:[],bt=xe.Indexes!==void 0?xe.Indexes.a:[],Vt=le.attributes.position.count*3,Ht=new Float32Array(Vt);for(let on=0;on<bt.length;on++){const mn=bt[on]*3;Ht[mn]=Ft[on*3],Ht[mn+1]=Ft[on*3+1],Ht[mn+2]=Ft[on*3+2]}const ni={vertexIndices:Gt,vertexPositions:Ht},zi=this.genBuffers(ni),Hi=new l.Float32BufferAttribute(zi.vertex,3);Hi.name=Ce||xe.attrName,Hi.applyMatrix4(De),le.morphAttributes.position.push(Hi)}parseNormals(le){const we=le.MappingInformationType,xe=le.ReferenceInformationType,De=le.Normals.a;let Ce=[];return xe==="IndexToDirect"&&("NormalIndex"in le?Ce=le.NormalIndex.a:"NormalsIndex"in le&&(Ce=le.NormalsIndex.a)),{dataSize:3,buffer:De,indices:Ce,mappingType:we,referenceType:xe}}parseUVs(le){const we=le.MappingInformationType,xe=le.ReferenceInformationType,De=le.UV.a;let Ce=[];return xe==="IndexToDirect"&&(Ce=le.UVIndex.a),{dataSize:2,buffer:De,indices:Ce,mappingType:we,referenceType:xe}}parseVertexColors(le){const we=le.MappingInformationType,xe=le.ReferenceInformationType,De=le.Colors.a;let Ce=[];return xe==="IndexToDirect"&&(Ce=le.ColorIndex.a),{dataSize:4,buffer:De,indices:Ce,mappingType:we,referenceType:xe}}parseMaterialIndices(le){const we=le.MappingInformationType,xe=le.ReferenceInformationType;if(we==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:xe};const De=le.Materials.a,Ce=[];for(let Gt=0;Gt<De.length;++Gt)Ce.push(Gt);return{dataSize:1,buffer:De,indices:Ce,mappingType:we,referenceType:xe}}parseNurbsGeometry(le){if(l.NURBSCurve===void 0)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new l.BufferGeometry;const we=parseInt(le.Order);if(isNaN(we))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",le.Order,le.id),new l.BufferGeometry;const xe=we-1,De=le.KnotVector.a,Ce=[],Gt=le.Points.a;for(let ni=0,zi=Gt.length;ni<zi;ni+=4)Ce.push(new l.Vector4().fromArray(Gt,ni));let Ft,bt;if(le.Form==="Closed")Ce.push(Ce[0]);else if(le.Form==="Periodic"){Ft=xe,bt=De.length-1-Ft;for(let ni=0;ni<xe;++ni)Ce.push(Ce[ni])}const Ht=new l.NURBSCurve(xe,De,Ce,Ft,bt).getPoints(Ce.length*12);return new l.BufferGeometry().setFromPoints(Ht)}}class ne{parse(){const le=[],we=this.parseClips();if(we!==void 0)for(const xe in we){const De=we[xe],Ce=this.addClip(De);le.push(Ce)}return le}parseClips(){if(D.Objects.AnimationCurve===void 0)return;const le=this.parseAnimationCurveNodes();this.parseAnimationCurves(le);const we=this.parseAnimationLayers(le);return this.parseAnimStacks(we)}parseAnimationCurveNodes(){const le=D.Objects.AnimationCurveNode,we=new Map;for(const xe in le){const De=le[xe];if(De.attrName.match(/S|R|T|DeformPercent/)!==null){const Ce={id:De.id,attr:De.attrName,curves:{}};we.set(Ce.id,Ce)}}return we}parseAnimationCurves(le){const we=D.Objects.AnimationCurve;for(const xe in we){const De={id:we[xe].id,times:we[xe].KeyTime.a.map(st),values:we[xe].KeyValueFloat.a},Ce=N.get(De.id);if(Ce!==void 0){const Gt=Ce.parents[0].ID,Ft=Ce.parents[0].relationship;Ft.match(/X/)?le.get(Gt).curves.x=De:Ft.match(/Y/)?le.get(Gt).curves.y=De:Ft.match(/Z/)?le.get(Gt).curves.z=De:Ft.match(/d|DeformPercent/)&&le.has(Gt)&&(le.get(Gt).curves.morph=De)}}}parseAnimationLayers(le){const we=D.Objects.AnimationLayer,xe=new Map;for(const De in we){const Ce=[],Gt=N.get(parseInt(De));Gt!==void 0&&(Gt.children.forEach(function(bt,Vt){if(le.has(bt.ID)){const Ht=le.get(bt.ID);if(Ht.curves.x!==void 0||Ht.curves.y!==void 0||Ht.curves.z!==void 0){if(Ce[Vt]===void 0){const ni=N.get(bt.ID).parents.filter(function(zi){return zi.relationship!==void 0})[0].ID;if(ni!==void 0){const zi=D.Objects.Model[ni.toString()];if(zi===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",bt);return}const Hi={modelName:zi.attrName?l.PropertyBinding.sanitizeNodeName(zi.attrName):"",ID:zi.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};B.traverse(function(on){on.ID===zi.id&&(Hi.transform=on.matrix,on.userData.transformData&&(Hi.eulerOrder=on.userData.transformData.eulerOrder))}),Hi.transform||(Hi.transform=new l.Matrix4),"PreRotation"in zi&&(Hi.preRotation=zi.PreRotation.value),"PostRotation"in zi&&(Hi.postRotation=zi.PostRotation.value),Ce[Vt]=Hi}}Ce[Vt]&&(Ce[Vt][Ht.attr]=Ht)}else if(Ht.curves.morph!==void 0){if(Ce[Vt]===void 0){const ni=N.get(bt.ID).parents.filter(function(Yn){return Yn.relationship!==void 0})[0].ID,zi=N.get(ni).parents[0].ID,Hi=N.get(zi).parents[0].ID,on=N.get(Hi).parents[0].ID,mn=D.Objects.Model[on],ot={modelName:mn.attrName?l.PropertyBinding.sanitizeNodeName(mn.attrName):"",morphName:D.Objects.Deformer[ni].attrName};Ce[Vt]=ot}Ce[Vt][Ht.attr]=Ht}}}),xe.set(parseInt(De),Ce))}return xe}parseAnimStacks(le){const we=D.Objects.AnimationStack,xe={};for(const De in we){const Ce=N.get(parseInt(De)).children;Ce.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const Gt=le.get(Ce[0].ID);xe[De]={name:we[De].attrName,layer:Gt}}return xe}addClip(le){let we=[];const xe=this;return le.layer.forEach(function(De){we=we.concat(xe.generateTracks(De))}),new l.AnimationClip(le.name,-1,we)}generateTracks(le){const we=[];let xe=new l.Vector3,De=new l.Quaternion,Ce=new l.Vector3;if(le.transform&&le.transform.decompose(xe,De,Ce),xe=xe.toArray(),De=new l.Euler().setFromQuaternion(De,le.eulerOrder).toArray(),Ce=Ce.toArray(),le.T!==void 0&&Object.keys(le.T.curves).length>0){const Gt=this.generateVectorTrack(le.modelName,le.T.curves,xe,"position");Gt!==void 0&&we.push(Gt)}if(le.R!==void 0&&Object.keys(le.R.curves).length>0){const Gt=this.generateRotationTrack(le.modelName,le.R.curves,De,le.preRotation,le.postRotation,le.eulerOrder);Gt!==void 0&&we.push(Gt)}if(le.S!==void 0&&Object.keys(le.S.curves).length>0){const Gt=this.generateVectorTrack(le.modelName,le.S.curves,Ce,"scale");Gt!==void 0&&we.push(Gt)}if(le.DeformPercent!==void 0){const Gt=this.generateMorphTrack(le);Gt!==void 0&&we.push(Gt)}return we}generateVectorTrack(le,we,xe,De){const Ce=this.getTimesForAllAxes(we),Gt=this.getKeyframeTrackValues(Ce,we,xe);return new l.VectorKeyframeTrack(le+"."+De,Ce,Gt)}generateRotationTrack(le,we,xe,De,Ce,Gt){we.x!==void 0&&(this.interpolateRotations(we.x),we.x.values=we.x.values.map(l.MathUtils.degToRad)),we.y!==void 0&&(this.interpolateRotations(we.y),we.y.values=we.y.values.map(l.MathUtils.degToRad)),we.z!==void 0&&(this.interpolateRotations(we.z),we.z.values=we.z.values.map(l.MathUtils.degToRad));const Ft=this.getTimesForAllAxes(we),bt=this.getKeyframeTrackValues(Ft,we,xe);De!==void 0&&(De=De.map(l.MathUtils.degToRad),De.push(Gt),De=new l.Euler().fromArray(De),De=new l.Quaternion().setFromEuler(De)),Ce!==void 0&&(Ce=Ce.map(l.MathUtils.degToRad),Ce.push(Gt),Ce=new l.Euler().fromArray(Ce),Ce=new l.Quaternion().setFromEuler(Ce).invert());const Vt=new l.Quaternion,Ht=new l.Euler,ni=[];for(let zi=0;zi<bt.length;zi+=3)Ht.set(bt[zi],bt[zi+1],bt[zi+2],Gt),Vt.setFromEuler(Ht),De!==void 0&&Vt.premultiply(De),Ce!==void 0&&Vt.multiply(Ce),Vt.toArray(ni,zi/3*4);return new l.QuaternionKeyframeTrack(le+".quaternion",Ft,ni)}generateMorphTrack(le){const we=le.DeformPercent.curves.morph,xe=we.values.map(function(Ce){return Ce/100}),De=B.getObjectByName(le.modelName).morphTargetDictionary[le.morphName];return new l.NumberKeyframeTrack(le.modelName+".morphTargetInfluences["+De+"]",we.times,xe)}getTimesForAllAxes(le){let we=[];if(le.x!==void 0&&(we=we.concat(le.x.times)),le.y!==void 0&&(we=we.concat(le.y.times)),le.z!==void 0&&(we=we.concat(le.z.times)),we=we.sort(function(xe,De){return xe-De}),we.length>1){let xe=1,De=we[0];for(let Ce=1;Ce<we.length;Ce++){const Gt=we[Ce];Gt!==De&&(we[xe]=Gt,De=Gt,xe++)}we=we.slice(0,xe)}return we}getKeyframeTrackValues(le,we,xe){const De=xe,Ce=[];let Gt=-1,Ft=-1,bt=-1;return le.forEach(function(Vt){if(we.x&&(Gt=we.x.times.indexOf(Vt)),we.y&&(Ft=we.y.times.indexOf(Vt)),we.z&&(bt=we.z.times.indexOf(Vt)),Gt!==-1){const Ht=we.x.values[Gt];Ce.push(Ht),De[0]=Ht}else Ce.push(De[0]);if(Ft!==-1){const Ht=we.y.values[Ft];Ce.push(Ht),De[1]=Ht}else Ce.push(De[1]);if(bt!==-1){const Ht=we.z.values[bt];Ce.push(Ht),De[2]=Ht}else Ce.push(De[2])}),Ce}interpolateRotations(le){for(let we=1;we<le.values.length;we++){const xe=le.values[we-1],De=le.values[we]-xe,Ce=Math.abs(De);if(Ce>=180){const Gt=Ce/180,Ft=De/Gt;let bt=xe+Ft;const Vt=le.times[we-1],ni=(le.times[we]-Vt)/Gt;let zi=Vt+ni;const Hi=[],on=[];for(;zi<le.times[we];)Hi.push(zi),zi+=ni,on.push(bt),bt+=Ft;le.times=vt(le.times,we,Hi),le.values=vt(le.values,we,on)}}}}class ve{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(le){this.nodeStack.push(le),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(le,we){this.currentProp=le,this.currentPropName=we}parse(le){this.currentIndent=0,this.allNodes=new yt,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const we=this,xe=le.split(/[\r\n]+/);return xe.forEach(function(De,Ce){const Gt=De.match(/^[\s\t]*;/),Ft=De.match(/^[\s\t]*$/);if(Gt||Ft)return;const bt=De.match("^\\t{"+we.currentIndent+"}(\\w+):(.*){",""),Vt=De.match("^\\t{"+we.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),Ht=De.match("^\\t{"+(we.currentIndent-1)+"}}");bt?we.parseNodeBegin(De,bt):Vt?we.parseNodeProperty(De,Vt,xe[++Ce]):Ht?we.popStack():De.match(/^[^\s\t}]/)&&we.parseNodePropertyContinued(De)}),this.allNodes}parseNodeBegin(le,we){const xe=we[1].trim().replace(/^"/,"").replace(/"$/,""),De=we[2].split(",").map(function(bt){return bt.trim().replace(/^"/,"").replace(/"$/,"")}),Ce={name:xe},Gt=this.parseNodeAttr(De),Ft=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(xe,Ce):xe in Ft?(xe==="PoseNode"?Ft.PoseNode.push(Ce):Ft[xe].id!==void 0&&(Ft[xe]={},Ft[xe][Ft[xe].id]=Ft[xe]),Gt.id!==""&&(Ft[xe][Gt.id]=Ce)):typeof Gt.id=="number"?(Ft[xe]={},Ft[xe][Gt.id]=Ce):xe!=="Properties70"&&(xe==="PoseNode"?Ft[xe]=[Ce]:Ft[xe]=Ce),typeof Gt.id=="number"&&(Ce.id=Gt.id),Gt.name!==""&&(Ce.attrName=Gt.name),Gt.type!==""&&(Ce.attrType=Gt.type),this.pushStack(Ce)}parseNodeAttr(le){let we=le[0];le[0]!==""&&(we=parseInt(le[0]),isNaN(we)&&(we=le[0]));let xe="",De="";return le.length>1&&(xe=le[1].replace(/^(\w+)::/,""),De=le[2]),{id:we,name:xe,type:De}}parseNodeProperty(le,we,xe){let De=we[1].replace(/^"/,"").replace(/"$/,"").trim(),Ce=we[2].replace(/^"/,"").replace(/"$/,"").trim();De==="Content"&&Ce===","&&(Ce=xe.replace(/"/g,"").replace(/,$/,"").trim());const Gt=this.getCurrentNode();if(Gt.name==="Properties70"){this.parseNodeSpecialProperty(le,De,Ce);return}if(De==="C"){const bt=Ce.split(",").slice(1),Vt=parseInt(bt[0]),Ht=parseInt(bt[1]);let ni=Ce.split(",").slice(3);ni=ni.map(function(zi){return zi.trim().replace(/^"/,"")}),De="connections",Ce=[Vt,Ht],gt(Ce,ni),Gt[De]===void 0&&(Gt[De]=[])}De==="Node"&&(Gt.id=Ce),De in Gt&&Array.isArray(Gt[De])?Gt[De].push(Ce):De!=="a"?Gt[De]=Ce:Gt.a=Ce,this.setCurrentProp(Gt,De),De==="a"&&Ce.slice(-1)!==","&&(Gt.a=Xe(Ce))}parseNodePropertyContinued(le){const we=this.getCurrentNode();we.a+=le,le.slice(-1)!==","&&(we.a=Xe(we.a))}parseNodeSpecialProperty(le,we,xe){const De=xe.split('",').map(function(Ht){return Ht.trim().replace(/^\"/,"").replace(/\s/,"_")}),Ce=De[0],Gt=De[1],Ft=De[2],bt=De[3];let Vt=De[4];switch(Gt){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":Vt=parseFloat(Vt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":Vt=Xe(Vt);break}this.getPrevNode()[Ce]={type:Gt,type2:Ft,flag:bt,value:Vt},this.setCurrentProp(this.getPrevNode(),Ce)}}class ze{parse(le){const we=new ke(le);we.skip(23);const xe=we.getUint32();if(xe<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+xe);const De=new yt;for(;!this.endOfContent(we);){const Ce=this.parseNode(we,xe);Ce!==null&&De.add(Ce.name,Ce)}return De}endOfContent(le){return le.size()%16===0?(le.getOffset()+160+16&-16)>=le.size():le.getOffset()+160+16>=le.size()}parseNode(le,we){const xe={},De=we>=7500?le.getUint64():le.getUint32(),Ce=we>=7500?le.getUint64():le.getUint32();we>=7500?le.getUint64():le.getUint32();const Gt=le.getUint8(),Ft=le.getString(Gt);if(De===0)return null;const bt=[];for(let zi=0;zi<Ce;zi++)bt.push(this.parseProperty(le));const Vt=bt.length>0?bt[0]:"",Ht=bt.length>1?bt[1]:"",ni=bt.length>2?bt[2]:"";for(xe.singleProperty=Ce===1&&le.getOffset()===De;De>le.getOffset();){const zi=this.parseNode(le,we);zi!==null&&this.parseSubNode(Ft,xe,zi)}return xe.propertyList=bt,typeof Vt=="number"&&(xe.id=Vt),Ht!==""&&(xe.attrName=Ht),ni!==""&&(xe.attrType=ni),Ft!==""&&(xe.name=Ft),xe}parseSubNode(le,we,xe){if(xe.singleProperty===!0){const De=xe.propertyList[0];Array.isArray(De)?(we[xe.name]=xe,xe.a=De):we[xe.name]=De}else if(le==="Connections"&&xe.name==="C"){const De=[];xe.propertyList.forEach(function(Ce,Gt){Gt!==0&&De.push(Ce)}),we.connections===void 0&&(we.connections=[]),we.connections.push(De)}else if(xe.name==="Properties70")Object.keys(xe).forEach(function(Ce){we[Ce]=xe[Ce]});else if(le==="Properties70"&&xe.name==="P"){let De=xe.propertyList[0],Ce=xe.propertyList[1];const Gt=xe.propertyList[2],Ft=xe.propertyList[3];let bt;De.indexOf("Lcl ")===0&&(De=De.replace("Lcl ","Lcl_")),Ce.indexOf("Lcl ")===0&&(Ce=Ce.replace("Lcl ","Lcl_")),Ce==="Color"||Ce==="ColorRGB"||Ce==="Vector"||Ce==="Vector3D"||Ce.indexOf("Lcl_")===0?bt=[xe.propertyList[4],xe.propertyList[5],xe.propertyList[6]]:bt=xe.propertyList[4],we[De]={type:Ce,type2:Gt,flag:Ft,value:bt}}else we[xe.name]===void 0?typeof xe.id=="number"?(we[xe.name]={},we[xe.name][xe.id]=xe):we[xe.name]=xe:xe.name==="PoseNode"?(Array.isArray(we[xe.name])||(we[xe.name]=[we[xe.name]]),we[xe.name].push(xe)):we[xe.name][xe.id]===void 0&&(we[xe.name][xe.id]=xe)}parseProperty(le){const we=le.getString(1);let xe;switch(we){case"C":return le.getBoolean();case"D":return le.getFloat64();case"F":return le.getFloat32();case"I":return le.getInt32();case"L":return le.getInt64();case"R":return xe=le.getUint32(),le.getArrayBuffer(xe);case"S":return xe=le.getUint32(),le.getString(xe);case"Y":return le.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const De=le.getUint32(),Ce=le.getUint32(),Gt=le.getUint32();if(Ce===0)switch(we){case"b":case"c":return le.getBooleanArray(De);case"d":return le.getFloat64Array(De);case"f":return le.getFloat32Array(De);case"i":return le.getInt32Array(De);case"l":return le.getInt64Array(De)}typeof E>"u"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const Ft=E.unzlibSync(new Uint8Array(le.getArrayBuffer(Gt))),bt=new ke(Ft.buffer);switch(we){case"b":case"c":return bt.getBooleanArray(De);case"d":return bt.getFloat64Array(De);case"f":return bt.getFloat32Array(De);case"i":return bt.getInt32Array(De);case"l":return bt.getInt64Array(De)}default:throw new Error("THREE.FBXLoader: Unknown property type "+we)}}}class ke{constructor(le,we){this.dv=new DataView(le),this.offset=0,this.littleEndian=we!==void 0?we:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(le){this.offset+=le}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(le){const we=[];for(let xe=0;xe<le;xe++)we.push(this.getBoolean());return we}getUint8(){const le=this.dv.getUint8(this.offset);return this.offset+=1,le}getInt16(){const le=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,le}getInt32(){const le=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,le}getInt32Array(le){const we=[];for(let xe=0;xe<le;xe++)we.push(this.getInt32());return we}getUint32(){const le=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,le}getInt64(){let le,we;return this.littleEndian?(le=this.getUint32(),we=this.getUint32()):(we=this.getUint32(),le=this.getUint32()),we&2147483648?(we=~we&4294967295,le=~le&4294967295,le===4294967295&&(we=we+1&4294967295),le=le+1&4294967295,-(we*4294967296+le)):we*4294967296+le}getInt64Array(le){const we=[];for(let xe=0;xe<le;xe++)we.push(this.getInt64());return we}getUint64(){let le,we;return this.littleEndian?(le=this.getUint32(),we=this.getUint32()):(we=this.getUint32(),le=this.getUint32()),we*4294967296+le}getFloat32(){const le=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,le}getFloat32Array(le){const we=[];for(let xe=0;xe<le;xe++)we.push(this.getFloat32());return we}getFloat64(){const le=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,le}getFloat64Array(le){const we=[];for(let xe=0;xe<le;xe++)we.push(this.getFloat64());return we}getArrayBuffer(le){const we=this.dv.buffer.slice(this.offset,this.offset+le);return this.offset+=le,we}getString(le){let we=[];for(let De=0;De<le;De++)we[De]=this.getUint8();const xe=we.indexOf(0);return xe>=0&&(we=we.slice(0,xe)),l.LoaderUtils.decodeText(new Uint8Array(we))}}class yt{add(le,we){this[le]=we}}function it(Jt){const le="Kaydara FBX Binary  \0";return Jt.byteLength>=le.length&&le===qe(Jt,0,le.length)}function xt(Jt){const le=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let we=0;function xe(De){const Ce=Jt[De-1];return Jt=Jt.slice(we+De),we++,Ce}for(let De=0;De<le.length;++De)if(xe(1)===le[De])return!1;return!0}function Ze(Jt){const le=/FBXVersion: (\d+)/,we=Jt.match(le);if(we)return parseInt(we[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function st(Jt){return Jt/46186158e3}const ti=[];function mt(Jt,le,we,xe){let De;switch(xe.mappingType){case"ByPolygonVertex":De=Jt;break;case"ByPolygon":De=le;break;case"ByVertice":De=we;break;case"AllSame":De=xe.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+xe.mappingType)}xe.referenceType==="IndexToDirect"&&(De=xe.indices[De]);const Ce=De*xe.dataSize,Gt=Ce+xe.dataSize;return lt(ti,xe.buffer,Ce,Gt)}const pt=new l.Euler,Tt=new l.Vector3;function Fe(Jt){const le=new l.Matrix4,we=new l.Matrix4,xe=new l.Matrix4,De=new l.Matrix4,Ce=new l.Matrix4,Gt=new l.Matrix4,Ft=new l.Matrix4,bt=new l.Matrix4,Vt=new l.Matrix4,Ht=new l.Matrix4,ni=new l.Matrix4,zi=new l.Matrix4,Hi=Jt.inheritType?Jt.inheritType:0;if(Jt.translation&&le.setPosition(Tt.fromArray(Jt.translation)),Jt.preRotation){const rt=Jt.preRotation.map(l.MathUtils.degToRad);rt.push(Jt.eulerOrder),we.makeRotationFromEuler(pt.fromArray(rt))}if(Jt.rotation){const rt=Jt.rotation.map(l.MathUtils.degToRad);rt.push(Jt.eulerOrder),xe.makeRotationFromEuler(pt.fromArray(rt))}if(Jt.postRotation){const rt=Jt.postRotation.map(l.MathUtils.degToRad);rt.push(Jt.eulerOrder),De.makeRotationFromEuler(pt.fromArray(rt)),De.invert()}Jt.scale&&Ce.scale(Tt.fromArray(Jt.scale)),Jt.scalingOffset&&Ft.setPosition(Tt.fromArray(Jt.scalingOffset)),Jt.scalingPivot&&Gt.setPosition(Tt.fromArray(Jt.scalingPivot)),Jt.rotationOffset&&bt.setPosition(Tt.fromArray(Jt.rotationOffset)),Jt.rotationPivot&&Vt.setPosition(Tt.fromArray(Jt.rotationPivot)),Jt.parentMatrixWorld&&(ni.copy(Jt.parentMatrix),Ht.copy(Jt.parentMatrixWorld));const on=we.clone().multiply(xe).multiply(De),mn=new l.Matrix4;mn.extractRotation(Ht);const ot=new l.Matrix4;ot.copyPosition(Ht);const Yn=ot.clone().invert().multiply(Ht),pr=mn.clone().invert().multiply(Yn),At=Ce,Ye=new l.Matrix4;if(Hi===0)Ye.copy(mn).multiply(on).multiply(pr).multiply(At);else if(Hi===1)Ye.copy(mn).multiply(pr).multiply(on).multiply(At);else{const ut=new l.Matrix4().scale(new l.Vector3().setFromMatrixScale(ni)).clone().invert(),ht=pr.clone().multiply(ut);Ye.copy(mn).multiply(on).multiply(ht).multiply(At)}const kt=Vt.clone().invert(),Le=Gt.clone().invert();let Ie=le.clone().multiply(bt).multiply(Vt).multiply(we).multiply(xe).multiply(De).multiply(kt).multiply(Ft).multiply(Gt).multiply(Ce).multiply(Le);const Ue=new l.Matrix4().copyPosition(Ie),We=Ht.clone().multiply(Ue);return zi.copyPosition(We),Ie=zi.clone().multiply(Ye),Ie.premultiply(Ht.invert()),Ie}function et(Jt){Jt=Jt||0;const le=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return Jt===6?(console.warn("THREE.FBXLoader: unsupported THREE.Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),le[0]):le[Jt]}function Xe(Jt){return Jt.split(",").map(function(we){return parseFloat(we)})}function qe(Jt,le,we){return le===void 0&&(le=0),we===void 0&&(we=Jt.byteLength),l.LoaderUtils.decodeText(new Uint8Array(Jt,le,we))}function gt(Jt,le){for(let we=0,xe=Jt.length,De=le.length;we<De;we++,xe++)Jt[xe]=le[we]}function lt(Jt,le,we,xe){for(let De=we,Ce=0;De<xe;De++,Ce++)Jt[Ce]=le[De];return Jt}function vt(Jt,le,we){return Jt.slice(0,le).concat(we).concat(Jt.slice(le))}l.FBXLoader=n})(),c.exports=l.FBXLoader}(db)),db.exports}var pb={exports:{}},eE;function Uk(){return eE||(eE=1,function(c,p){const l=Na();(function(){class E extends l.Loader{constructor(Le){super(Le),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(Ie){return new X(Ie)}),this.register(function(Ie){return new ke(Ie)}),this.register(function(Ie){return new yt(Ie)}),this.register(function(Ie){return new $(Ie)}),this.register(function(Ie){return new ne(Ie)}),this.register(function(Ie){return new ve(Ie)}),this.register(function(Ie){return new ze(Ie)}),this.register(function(Ie){return new B(Ie)}),this.register(function(Ie){return new it(Ie)})}load(Le,Ie,Ue,We){const rt=this;let ut;this.resourcePath!==""?ut=this.resourcePath:this.path!==""?ut=this.path:ut=l.LoaderUtils.extractUrlBase(Le),this.manager.itemStart(Le);const ht=function(It){We?We(It):console.error(It),rt.manager.itemError(Le),rt.manager.itemEnd(Le)},Lt=new l.FileLoader(this.manager);Lt.setPath(this.path),Lt.setResponseType("arraybuffer"),Lt.setRequestHeader(this.requestHeader),Lt.setWithCredentials(this.withCredentials),Lt.load(Le,function(It){try{rt.parse(It,ut,function(ui){Ie(ui),rt.manager.itemEnd(Le)},ht)}catch(ui){ht(ui)}},Ue,ht)}setDRACOLoader(Le){return this.dracoLoader=Le,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(Le){return this.ktx2Loader=Le,this}setMeshoptDecoder(Le){return this.meshoptDecoder=Le,this}register(Le){return this.pluginCallbacks.indexOf(Le)===-1&&this.pluginCallbacks.push(Le),this}unregister(Le){return this.pluginCallbacks.indexOf(Le)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(Le),1),this}parse(Le,Ie,Ue,We){let rt;const ut={},ht={};if(typeof Le=="string")rt=Le;else if(l.LoaderUtils.decodeText(new Uint8Array(Le,0,4))===xt){try{ut[N.KHR_BINARY_GLTF]=new ti(Le)}catch(xi){We&&We(xi);return}rt=ut[N.KHR_BINARY_GLTF].content}else rt=l.LoaderUtils.decodeText(new Uint8Array(Le));const Lt=JSON.parse(rt);if(Lt.asset===void 0||Lt.asset.version[0]<2){We&&We(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const It=new ot(Lt,{path:Ie||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});It.fileLoader.setRequestHeader(this.requestHeader);for(let ui=0;ui<this.pluginCallbacks.length;ui++){const xi=this.pluginCallbacks[ui](It);ht[xi.name]=xi,ut[xi.name]=!0}if(Lt.extensionsUsed)for(let ui=0;ui<Lt.extensionsUsed.length;++ui){const xi=Lt.extensionsUsed[ui],an=Lt.extensionsRequired||[];switch(xi){case N.KHR_MATERIALS_UNLIT:ut[xi]=new n;break;case N.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:ut[xi]=new Fe;break;case N.KHR_DRACO_MESH_COMPRESSION:ut[xi]=new mt(Lt,this.dracoLoader);break;case N.KHR_TEXTURE_TRANSFORM:ut[xi]=new pt;break;case N.KHR_MESH_QUANTIZATION:ut[xi]=new et;break;default:an.indexOf(xi)>=0&&ht[xi]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+xi+'".')}}It.setExtensions(ut),It.setPlugins(ht),It.parse(Ue,We)}}function D(){let kt={};return{get:function(Le){return kt[Le]},add:function(Le,Ie){kt[Le]=Ie},remove:function(Le){delete kt[Le]},removeAll:function(){kt={}}}}const N={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class B{constructor(Le){this.parser=Le,this.name=N.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const Le=this.parser,Ie=this.parser.json.nodes||[];for(let Ue=0,We=Ie.length;Ue<We;Ue++){const rt=Ie[Ue];rt.extensions&&rt.extensions[this.name]&&rt.extensions[this.name].light!==void 0&&Le._addNodeRef(this.cache,rt.extensions[this.name].light)}}_loadLight(Le){const Ie=this.parser,Ue="light:"+Le;let We=Ie.cache.get(Ue);if(We)return We;const rt=Ie.json,Lt=((rt.extensions&&rt.extensions[this.name]||{}).lights||[])[Le];let It;const ui=new l.Color(16777215);Lt.color!==void 0&&ui.fromArray(Lt.color);const xi=Lt.range!==void 0?Lt.range:0;switch(Lt.type){case"directional":It=new l.DirectionalLight(ui),It.target.position.set(0,0,-1),It.add(It.target);break;case"point":It=new l.PointLight(ui),It.distance=xi;break;case"spot":It=new l.SpotLight(ui),It.distance=xi,Lt.spot=Lt.spot||{},Lt.spot.innerConeAngle=Lt.spot.innerConeAngle!==void 0?Lt.spot.innerConeAngle:0,Lt.spot.outerConeAngle=Lt.spot.outerConeAngle!==void 0?Lt.spot.outerConeAngle:Math.PI/4,It.angle=Lt.spot.outerConeAngle,It.penumbra=1-Lt.spot.innerConeAngle/Lt.spot.outerConeAngle,It.target.position.set(0,0,-1),It.add(It.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+Lt.type)}return It.position.set(0,0,0),It.decay=2,Lt.intensity!==void 0&&(It.intensity=Lt.intensity),It.name=Ie.createUniqueName(Lt.name||"light_"+Le),We=Promise.resolve(It),Ie.cache.add(Ue,We),We}createNodeAttachment(Le){const Ie=this,Ue=this.parser,rt=Ue.json.nodes[Le],ht=(rt.extensions&&rt.extensions[this.name]||{}).light;return ht===void 0?null:this._loadLight(ht).then(function(Lt){return Ue._getNodeRef(Ie.cache,ht,Lt)})}}class n{constructor(){this.name=N.KHR_MATERIALS_UNLIT}getMaterialType(){return l.MeshBasicMaterial}extendParams(Le,Ie,Ue){const We=[];Le.color=new l.Color(1,1,1),Le.opacity=1;const rt=Ie.pbrMetallicRoughness;if(rt){if(Array.isArray(rt.baseColorFactor)){const ut=rt.baseColorFactor;Le.color.fromArray(ut),Le.opacity=ut[3]}rt.baseColorTexture!==void 0&&We.push(Ue.assignTexture(Le,"map",rt.baseColorTexture))}return Promise.all(We)}}class X{constructor(Le){this.parser=Le,this.name=N.KHR_MATERIALS_CLEARCOAT}getMaterialType(Le){const Ue=this.parser.json.materials[Le];return!Ue.extensions||!Ue.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Ue=this.parser,We=Ue.json.materials[Le];if(!We.extensions||!We.extensions[this.name])return Promise.resolve();const rt=[],ut=We.extensions[this.name];if(ut.clearcoatFactor!==void 0&&(Ie.clearcoat=ut.clearcoatFactor),ut.clearcoatTexture!==void 0&&rt.push(Ue.assignTexture(Ie,"clearcoatMap",ut.clearcoatTexture)),ut.clearcoatRoughnessFactor!==void 0&&(Ie.clearcoatRoughness=ut.clearcoatRoughnessFactor),ut.clearcoatRoughnessTexture!==void 0&&rt.push(Ue.assignTexture(Ie,"clearcoatRoughnessMap",ut.clearcoatRoughnessTexture)),ut.clearcoatNormalTexture!==void 0&&(rt.push(Ue.assignTexture(Ie,"clearcoatNormalMap",ut.clearcoatNormalTexture)),ut.clearcoatNormalTexture.scale!==void 0)){const ht=ut.clearcoatNormalTexture.scale;Ie.clearcoatNormalScale=new l.Vector2(ht,-ht)}return Promise.all(rt)}}class ${constructor(Le){this.parser=Le,this.name=N.KHR_MATERIALS_TRANSMISSION}getMaterialType(Le){const Ue=this.parser.json.materials[Le];return!Ue.extensions||!Ue.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Ue=this.parser,We=Ue.json.materials[Le];if(!We.extensions||!We.extensions[this.name])return Promise.resolve();const rt=[],ut=We.extensions[this.name];return ut.transmissionFactor!==void 0&&(Ie.transmission=ut.transmissionFactor),ut.transmissionTexture!==void 0&&rt.push(Ue.assignTexture(Ie,"transmissionMap",ut.transmissionTexture)),Promise.all(rt)}}class ne{constructor(Le){this.parser=Le,this.name=N.KHR_MATERIALS_VOLUME}getMaterialType(Le){const Ue=this.parser.json.materials[Le];return!Ue.extensions||!Ue.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Ue=this.parser,We=Ue.json.materials[Le];if(!We.extensions||!We.extensions[this.name])return Promise.resolve();const rt=[],ut=We.extensions[this.name];Ie.thickness=ut.thicknessFactor!==void 0?ut.thicknessFactor:0,ut.thicknessTexture!==void 0&&rt.push(Ue.assignTexture(Ie,"thicknessMap",ut.thicknessTexture)),Ie.attenuationDistance=ut.attenuationDistance||0;const ht=ut.attenuationColor||[1,1,1];return Ie.attenuationTint=new l.Color(ht[0],ht[1],ht[2]),Promise.all(rt)}}class ve{constructor(Le){this.parser=Le,this.name=N.KHR_MATERIALS_IOR}getMaterialType(Le){const Ue=this.parser.json.materials[Le];return!Ue.extensions||!Ue.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const We=this.parser.json.materials[Le];if(!We.extensions||!We.extensions[this.name])return Promise.resolve();const rt=We.extensions[this.name];return Ie.ior=rt.ior!==void 0?rt.ior:1.5,Promise.resolve()}}class ze{constructor(Le){this.parser=Le,this.name=N.KHR_MATERIALS_SPECULAR}getMaterialType(Le){const Ue=this.parser.json.materials[Le];return!Ue.extensions||!Ue.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(Le,Ie){const Ue=this.parser,We=Ue.json.materials[Le];if(!We.extensions||!We.extensions[this.name])return Promise.resolve();const rt=[],ut=We.extensions[this.name];Ie.specularIntensity=ut.specularFactor!==void 0?ut.specularFactor:1,ut.specularTexture!==void 0&&rt.push(Ue.assignTexture(Ie,"specularIntensityMap",ut.specularTexture));const ht=ut.specularColorFactor||[1,1,1];return Ie.specularTint=new l.Color(ht[0],ht[1],ht[2]),ut.specularColorTexture!==void 0&&rt.push(Ue.assignTexture(Ie,"specularTintMap",ut.specularColorTexture).then(function(Lt){Lt.encoding=l.sRGBEncoding})),Promise.all(rt)}}class ke{constructor(Le){this.parser=Le,this.name=N.KHR_TEXTURE_BASISU}loadTexture(Le){const Ie=this.parser,Ue=Ie.json,We=Ue.textures[Le];if(!We.extensions||!We.extensions[this.name])return null;const rt=We.extensions[this.name],ut=Ue.images[rt.source],ht=Ie.options.ktx2Loader;if(!ht){if(Ue.extensionsRequired&&Ue.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return Ie.loadTextureImage(Le,ut,ht)}}class yt{constructor(Le){this.parser=Le,this.name=N.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(Le){const Ie=this.name,Ue=this.parser,We=Ue.json,rt=We.textures[Le];if(!rt.extensions||!rt.extensions[Ie])return null;const ut=rt.extensions[Ie],ht=We.images[ut.source];let Lt=Ue.textureLoader;if(ht.uri){const It=Ue.options.manager.getHandler(ht.uri);It!==null&&(Lt=It)}return this.detectSupport().then(function(It){if(It)return Ue.loadTextureImage(Le,ht,Lt);if(We.extensionsRequired&&We.extensionsRequired.indexOf(Ie)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return Ue.loadTexture(Le)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(Le){const Ie=new Image;Ie.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",Ie.onload=Ie.onerror=function(){Le(Ie.height===1)}})),this.isSupported}}class it{constructor(Le){this.name=N.EXT_MESHOPT_COMPRESSION,this.parser=Le}loadBufferView(Le){const Ie=this.parser.json,Ue=Ie.bufferViews[Le];if(Ue.extensions&&Ue.extensions[this.name]){const We=Ue.extensions[this.name],rt=this.parser.getDependency("buffer",We.buffer),ut=this.parser.options.meshoptDecoder;if(!ut||!ut.supported){if(Ie.extensionsRequired&&Ie.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([rt,ut.ready]).then(function(ht){const Lt=We.byteOffset||0,It=We.byteLength||0,ui=We.count,xi=We.byteStride,an=new ArrayBuffer(ui*xi),cn=new Uint8Array(ht[0],Lt,It);return ut.decodeGltfBuffer(new Uint8Array(an),ui,xi,cn,We.mode,We.filter),an})}else return null}}const xt="glTF",Ze=12,st={JSON:1313821514,BIN:5130562};class ti{constructor(Le){this.name=N.KHR_BINARY_GLTF,this.content=null,this.body=null;const Ie=new DataView(Le,0,Ze);if(this.header={magic:l.LoaderUtils.decodeText(new Uint8Array(Le.slice(0,4))),version:Ie.getUint32(4,!0),length:Ie.getUint32(8,!0)},this.header.magic!==xt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const Ue=this.header.length-Ze,We=new DataView(Le,Ze);let rt=0;for(;rt<Ue;){const ut=We.getUint32(rt,!0);rt+=4;const ht=We.getUint32(rt,!0);if(rt+=4,ht===st.JSON){const Lt=new Uint8Array(Le,Ze+rt,ut);this.content=l.LoaderUtils.decodeText(Lt)}else if(ht===st.BIN){const Lt=Ze+rt;this.body=Le.slice(Lt,Lt+ut)}rt+=ut}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class mt{constructor(Le,Ie){if(!Ie)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=N.KHR_DRACO_MESH_COMPRESSION,this.json=Le,this.dracoLoader=Ie,this.dracoLoader.preload()}decodePrimitive(Le,Ie){const Ue=this.json,We=this.dracoLoader,rt=Le.extensions[this.name].bufferView,ut=Le.extensions[this.name].attributes,ht={},Lt={},It={};for(const ui in ut){const xi=xe[ui]||ui.toLowerCase();ht[xi]=ut[ui]}for(const ui in Le.attributes){const xi=xe[ui]||ui.toLowerCase();if(ut[ui]!==void 0){const an=Ue.accessors[Le.attributes[ui]],cn=vt[an.componentType];It[xi]=cn,Lt[xi]=an.normalized===!0}}return Ie.getDependency("bufferView",rt).then(function(ui){return new Promise(function(xi){We.decodeDracoFile(ui,function(an){for(const cn in an.attributes){const _n=an.attributes[cn],Fn=Lt[cn];Fn!==void 0&&(_n.normalized=Fn)}xi(an)},ht,It)})})}}class pt{constructor(){this.name=N.KHR_TEXTURE_TRANSFORM}extendTexture(Le,Ie){return Ie.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),Ie.offset===void 0&&Ie.rotation===void 0&&Ie.scale===void 0||(Le=Le.clone(),Ie.offset!==void 0&&Le.offset.fromArray(Ie.offset),Ie.rotation!==void 0&&(Le.rotation=Ie.rotation),Ie.scale!==void 0&&Le.repeat.fromArray(Ie.scale),Le.needsUpdate=!0),Le}}class Tt extends l.MeshStandardMaterial{constructor(Le){super(),this.isGLTFSpecularGlossinessMaterial=!0;const Ie=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),Ue=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),We=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),rt=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),ut=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),ht={specular:{value:new l.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=ht,this.onBeforeCompile=function(Lt){for(const It in ht)Lt.uniforms[It]=ht[It];Lt.fragmentShader=Lt.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",Ie).replace("#include <metalnessmap_pars_fragment>",Ue).replace("#include <roughnessmap_fragment>",We).replace("#include <metalnessmap_fragment>",rt).replace("#include <lights_physical_fragment>",ut)},Object.defineProperties(this,{specular:{get:function(){return ht.specular.value},set:function(Lt){ht.specular.value=Lt}},specularMap:{get:function(){return ht.specularMap.value},set:function(Lt){ht.specularMap.value=Lt,Lt?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return ht.glossiness.value},set:function(Lt){ht.glossiness.value=Lt}},glossinessMap:{get:function(){return ht.glossinessMap.value},set:function(Lt){ht.glossinessMap.value=Lt,Lt?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(Le)}copy(Le){return super.copy(Le),this.specularMap=Le.specularMap,this.specular.copy(Le.specular),this.glossinessMap=Le.glossinessMap,this.glossiness=Le.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Fe{constructor(){this.name=N.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Tt}extendParams(Le,Ie,Ue){const We=Ie.extensions[this.name];Le.color=new l.Color(1,1,1),Le.opacity=1;const rt=[];if(Array.isArray(We.diffuseFactor)){const ut=We.diffuseFactor;Le.color.fromArray(ut),Le.opacity=ut[3]}if(We.diffuseTexture!==void 0&&rt.push(Ue.assignTexture(Le,"map",We.diffuseTexture)),Le.emissive=new l.Color(0,0,0),Le.glossiness=We.glossinessFactor!==void 0?We.glossinessFactor:1,Le.specular=new l.Color(1,1,1),Array.isArray(We.specularFactor)&&Le.specular.fromArray(We.specularFactor),We.specularGlossinessTexture!==void 0){const ut=We.specularGlossinessTexture;rt.push(Ue.assignTexture(Le,"glossinessMap",ut)),rt.push(Ue.assignTexture(Le,"specularMap",ut))}return Promise.all(rt)}createMaterial(Le){const Ie=new Tt(Le);return Ie.fog=!0,Ie.color=Le.color,Ie.map=Le.map===void 0?null:Le.map,Ie.lightMap=null,Ie.lightMapIntensity=1,Ie.aoMap=Le.aoMap===void 0?null:Le.aoMap,Ie.aoMapIntensity=1,Ie.emissive=Le.emissive,Ie.emissiveIntensity=1,Ie.emissiveMap=Le.emissiveMap===void 0?null:Le.emissiveMap,Ie.bumpMap=Le.bumpMap===void 0?null:Le.bumpMap,Ie.bumpScale=1,Ie.normalMap=Le.normalMap===void 0?null:Le.normalMap,Ie.normalMapType=l.TangentSpaceNormalMap,Le.normalScale&&(Ie.normalScale=Le.normalScale),Ie.displacementMap=null,Ie.displacementScale=1,Ie.displacementBias=0,Ie.specularMap=Le.specularMap===void 0?null:Le.specularMap,Ie.specular=Le.specular,Ie.glossinessMap=Le.glossinessMap===void 0?null:Le.glossinessMap,Ie.glossiness=Le.glossiness,Ie.alphaMap=null,Ie.envMap=Le.envMap===void 0?null:Le.envMap,Ie.envMapIntensity=1,Ie.refractionRatio=.98,Ie}}class et{constructor(){this.name=N.KHR_MESH_QUANTIZATION}}class Xe extends l.Interpolant{constructor(Le,Ie,Ue,We){super(Le,Ie,Ue,We)}copySampleValue_(Le){const Ie=this.resultBuffer,Ue=this.sampleValues,We=this.valueSize,rt=Le*We*3+We;for(let ut=0;ut!==We;ut++)Ie[ut]=Ue[rt+ut];return Ie}}Xe.prototype.beforeStart_=Xe.prototype.copySampleValue_,Xe.prototype.afterEnd_=Xe.prototype.copySampleValue_,Xe.prototype.interpolate_=function(kt,Le,Ie,Ue){const We=this.resultBuffer,rt=this.sampleValues,ut=this.valueSize,ht=ut*2,Lt=ut*3,It=Ue-Le,ui=(Ie-Le)/It,xi=ui*ui,an=xi*ui,cn=kt*Lt,_n=cn-Lt,Fn=-2*an+3*xi,Mn=an-xi,jn=1-Fn,Lr=Mn-xi+ui;for(let Tr=0;Tr!==ut;Tr++){const to=rt[_n+Tr+ut],$r=rt[_n+Tr+ht]*It,en=rt[cn+Tr+ut],Wn=rt[cn+Tr]*It;We[Tr]=jn*to+Lr*$r+Fn*en+Mn*Wn}return We};const qe=new l.Quaternion;class gt extends Xe{interpolate_(Le,Ie,Ue,We){const rt=super.interpolate_(Le,Ie,Ue,We);return qe.fromArray(rt).normalize().toArray(rt),rt}}const lt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},vt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jt={9728:l.NearestFilter,9729:l.LinearFilter,9984:l.NearestMipmapNearestFilter,9985:l.LinearMipmapNearestFilter,9986:l.NearestMipmapLinearFilter,9987:l.LinearMipmapLinearFilter},le={33071:l.ClampToEdgeWrapping,33648:l.MirroredRepeatWrapping,10497:l.RepeatWrapping},we={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},De={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ce={CUBICSPLINE:void 0,LINEAR:l.InterpolateLinear,STEP:l.InterpolateDiscrete},Gt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ft(kt,Le){return typeof kt!="string"||kt===""?"":(/^https?:\/\//i.test(Le)&&/^\//.test(kt)&&(Le=Le.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(kt)||/^data:.*,.*$/i.test(kt)||/^blob:.*$/i.test(kt)?kt:Le+kt)}function bt(kt){return kt.DefaultMaterial===void 0&&(kt.DefaultMaterial=new l.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l.FrontSide})),kt.DefaultMaterial}function Vt(kt,Le,Ie){for(const Ue in Ie.extensions)kt[Ue]===void 0&&(Le.userData.gltfExtensions=Le.userData.gltfExtensions||{},Le.userData.gltfExtensions[Ue]=Ie.extensions[Ue])}function Ht(kt,Le){Le.extras!==void 0&&(typeof Le.extras=="object"?Object.assign(kt.userData,Le.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+Le.extras))}function ni(kt,Le,Ie){let Ue=!1,We=!1;for(let ht=0,Lt=Le.length;ht<Lt;ht++){const It=Le[ht];if(It.POSITION!==void 0&&(Ue=!0),It.NORMAL!==void 0&&(We=!0),Ue&&We)break}if(!Ue&&!We)return Promise.resolve(kt);const rt=[],ut=[];for(let ht=0,Lt=Le.length;ht<Lt;ht++){const It=Le[ht];if(Ue){const ui=It.POSITION!==void 0?Ie.getDependency("accessor",It.POSITION):kt.attributes.position;rt.push(ui)}if(We){const ui=It.NORMAL!==void 0?Ie.getDependency("accessor",It.NORMAL):kt.attributes.normal;ut.push(ui)}}return Promise.all([Promise.all(rt),Promise.all(ut)]).then(function(ht){const Lt=ht[0],It=ht[1];return Ue&&(kt.morphAttributes.position=Lt),We&&(kt.morphAttributes.normal=It),kt.morphTargetsRelative=!0,kt})}function zi(kt,Le){if(kt.updateMorphTargets(),Le.weights!==void 0)for(let Ie=0,Ue=Le.weights.length;Ie<Ue;Ie++)kt.morphTargetInfluences[Ie]=Le.weights[Ie];if(Le.extras&&Array.isArray(Le.extras.targetNames)){const Ie=Le.extras.targetNames;if(kt.morphTargetInfluences.length===Ie.length){kt.morphTargetDictionary={};for(let Ue=0,We=Ie.length;Ue<We;Ue++)kt.morphTargetDictionary[Ie[Ue]]=Ue}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Hi(kt){const Le=kt.extensions&&kt.extensions[N.KHR_DRACO_MESH_COMPRESSION];let Ie;return Le?Ie="draco:"+Le.bufferView+":"+Le.indices+":"+on(Le.attributes):Ie=kt.indices+":"+on(kt.attributes)+":"+kt.mode,Ie}function on(kt){let Le="";const Ie=Object.keys(kt).sort();for(let Ue=0,We=Ie.length;Ue<We;Ue++)Le+=Ie[Ue]+":"+kt[Ie[Ue]]+";";return Le}function mn(kt){switch(kt){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ot{constructor(Le={},Ie={}){this.json=Le,this.extensions={},this.plugins={},this.options=Ie,this.cache=new D,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new l.ImageBitmapLoader(this.options.manager):this.textureLoader=new l.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(Le){this.extensions=Le}setPlugins(Le){this.plugins=Le}parse(Le,Ie){const Ue=this,We=this.json,rt=this.extensions;this.cache.removeAll(),this._invokeAll(function(ut){return ut._markDefs&&ut._markDefs()}),Promise.all(this._invokeAll(function(ut){return ut.beforeRoot&&ut.beforeRoot()})).then(function(){return Promise.all([Ue.getDependencies("scene"),Ue.getDependencies("animation"),Ue.getDependencies("camera")])}).then(function(ut){const ht={scene:ut[0][We.scene||0],scenes:ut[0],animations:ut[1],cameras:ut[2],asset:We.asset,parser:Ue,userData:{}};Vt(rt,ht,We),Ht(ht,We),Promise.all(Ue._invokeAll(function(Lt){return Lt.afterRoot&&Lt.afterRoot(ht)})).then(function(){Le(ht)})}).catch(Ie)}_markDefs(){const Le=this.json.nodes||[],Ie=this.json.skins||[],Ue=this.json.meshes||[];for(let We=0,rt=Ie.length;We<rt;We++){const ut=Ie[We].joints;for(let ht=0,Lt=ut.length;ht<Lt;ht++)Le[ut[ht]].isBone=!0}for(let We=0,rt=Le.length;We<rt;We++){const ut=Le[We];ut.mesh!==void 0&&(this._addNodeRef(this.meshCache,ut.mesh),ut.skin!==void 0&&(Ue[ut.mesh].isSkinnedMesh=!0)),ut.camera!==void 0&&this._addNodeRef(this.cameraCache,ut.camera)}}_addNodeRef(Le,Ie){Ie!==void 0&&(Le.refs[Ie]===void 0&&(Le.refs[Ie]=Le.uses[Ie]=0),Le.refs[Ie]++)}_getNodeRef(Le,Ie,Ue){if(Le.refs[Ie]<=1)return Ue;const We=Ue.clone();return We.name+="_instance_"+Le.uses[Ie]++,We}_invokeOne(Le){const Ie=Object.values(this.plugins);Ie.push(this);for(let Ue=0;Ue<Ie.length;Ue++){const We=Le(Ie[Ue]);if(We)return We}return null}_invokeAll(Le){const Ie=Object.values(this.plugins);Ie.unshift(this);const Ue=[];for(let We=0;We<Ie.length;We++){const rt=Le(Ie[We]);rt&&Ue.push(rt)}return Ue}getDependency(Le,Ie){const Ue=Le+":"+Ie;let We=this.cache.get(Ue);if(!We){switch(Le){case"scene":We=this.loadScene(Ie);break;case"node":We=this.loadNode(Ie);break;case"mesh":We=this._invokeOne(function(rt){return rt.loadMesh&&rt.loadMesh(Ie)});break;case"accessor":We=this.loadAccessor(Ie);break;case"bufferView":We=this._invokeOne(function(rt){return rt.loadBufferView&&rt.loadBufferView(Ie)});break;case"buffer":We=this.loadBuffer(Ie);break;case"material":We=this._invokeOne(function(rt){return rt.loadMaterial&&rt.loadMaterial(Ie)});break;case"texture":We=this._invokeOne(function(rt){return rt.loadTexture&&rt.loadTexture(Ie)});break;case"skin":We=this.loadSkin(Ie);break;case"animation":We=this.loadAnimation(Ie);break;case"camera":We=this.loadCamera(Ie);break;default:throw new Error("Unknown type: "+Le)}this.cache.add(Ue,We)}return We}getDependencies(Le){let Ie=this.cache.get(Le);if(!Ie){const Ue=this,We=this.json[Le+(Le==="mesh"?"es":"s")]||[];Ie=Promise.all(We.map(function(rt,ut){return Ue.getDependency(Le,ut)})),this.cache.add(Le,Ie)}return Ie}loadBuffer(Le){const Ie=this.json.buffers[Le],Ue=this.fileLoader;if(Ie.type&&Ie.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+Ie.type+" buffer type is not supported.");if(Ie.uri===void 0&&Le===0)return Promise.resolve(this.extensions[N.KHR_BINARY_GLTF].body);const We=this.options;return new Promise(function(rt,ut){Ue.load(Ft(Ie.uri,We.path),rt,void 0,function(){ut(new Error('THREE.GLTFLoader: Failed to load buffer "'+Ie.uri+'".'))})})}loadBufferView(Le){const Ie=this.json.bufferViews[Le];return this.getDependency("buffer",Ie.buffer).then(function(Ue){const We=Ie.byteLength||0,rt=Ie.byteOffset||0;return Ue.slice(rt,rt+We)})}loadAccessor(Le){const Ie=this,Ue=this.json,We=this.json.accessors[Le];if(We.bufferView===void 0&&We.sparse===void 0)return Promise.resolve(null);const rt=[];return We.bufferView!==void 0?rt.push(this.getDependency("bufferView",We.bufferView)):rt.push(null),We.sparse!==void 0&&(rt.push(this.getDependency("bufferView",We.sparse.indices.bufferView)),rt.push(this.getDependency("bufferView",We.sparse.values.bufferView))),Promise.all(rt).then(function(ut){const ht=ut[0],Lt=we[We.type],It=vt[We.componentType],ui=It.BYTES_PER_ELEMENT,xi=ui*Lt,an=We.byteOffset||0,cn=We.bufferView!==void 0?Ue.bufferViews[We.bufferView].byteStride:void 0,_n=We.normalized===!0;let Fn,Mn;if(cn&&cn!==xi){const jn=Math.floor(an/cn),Lr="InterleavedBuffer:"+We.bufferView+":"+We.componentType+":"+jn+":"+We.count;let Tr=Ie.cache.get(Lr);Tr||(Fn=new It(ht,jn*cn,We.count*cn/ui),Tr=new l.InterleavedBuffer(Fn,cn/ui),Ie.cache.add(Lr,Tr)),Mn=new l.InterleavedBufferAttribute(Tr,Lt,an%cn/ui,_n)}else ht===null?Fn=new It(We.count*Lt):Fn=new It(ht,an,We.count*Lt),Mn=new l.BufferAttribute(Fn,Lt,_n);if(We.sparse!==void 0){const jn=we.SCALAR,Lr=vt[We.sparse.indices.componentType],Tr=We.sparse.indices.byteOffset||0,to=We.sparse.values.byteOffset||0,$r=new Lr(ut[1],Tr,We.sparse.count*jn),en=new It(ut[2],to,We.sparse.count*Lt);ht!==null&&(Mn=new l.BufferAttribute(Mn.array.slice(),Mn.itemSize,Mn.normalized));for(let Wn=0,Ls=$r.length;Wn<Ls;Wn++){const To=$r[Wn];if(Mn.setX(To,en[Wn*Lt]),Lt>=2&&Mn.setY(To,en[Wn*Lt+1]),Lt>=3&&Mn.setZ(To,en[Wn*Lt+2]),Lt>=4&&Mn.setW(To,en[Wn*Lt+3]),Lt>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return Mn})}loadTexture(Le){const Ie=this.json,Ue=this.options,We=Ie.textures[Le],rt=Ie.images[We.source];let ut=this.textureLoader;if(rt.uri){const ht=Ue.manager.getHandler(rt.uri);ht!==null&&(ut=ht)}return this.loadTextureImage(Le,rt,ut)}loadTextureImage(Le,Ie,Ue){const We=this,rt=this.json,ut=this.options,ht=rt.textures[Le],Lt=(Ie.uri||Ie.bufferView)+":"+ht.sampler;if(this.textureCache[Lt])return this.textureCache[Lt];const It=self.URL||self.webkitURL;let ui=Ie.uri||"",xi=!1,an=!0;const cn=ui.search(/\.jpe?g($|\?)/i)>0||ui.search(/^data\:image\/jpeg/)===0;if((Ie.mimeType==="image/jpeg"||cn)&&(an=!1),Ie.bufferView!==void 0)ui=We.getDependency("bufferView",Ie.bufferView).then(function(Fn){if(Ie.mimeType==="image/png"){const jn=new DataView(Fn,25,1).getUint8(0,!1);an=jn===6||jn===4||jn===3}xi=!0;const Mn=new Blob([Fn],{type:Ie.mimeType});return ui=It.createObjectURL(Mn),ui});else if(Ie.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+Le+" is missing URI and bufferView");const _n=Promise.resolve(ui).then(function(Fn){return new Promise(function(Mn,jn){let Lr=Mn;Ue.isImageBitmapLoader===!0&&(Lr=function(Tr){const to=new l.Texture(Tr);to.needsUpdate=!0,Mn(to)}),Ue.load(Ft(Fn,ut.path),Lr,void 0,jn)})}).then(function(Fn){xi===!0&&It.revokeObjectURL(ui),Fn.flipY=!1,ht.name&&(Fn.name=ht.name),an||(Fn.format=l.RGBFormat);const jn=(rt.samplers||{})[ht.sampler]||{};return Fn.magFilter=Jt[jn.magFilter]||l.LinearFilter,Fn.minFilter=Jt[jn.minFilter]||l.LinearMipmapLinearFilter,Fn.wrapS=le[jn.wrapS]||l.RepeatWrapping,Fn.wrapT=le[jn.wrapT]||l.RepeatWrapping,We.associations.set(Fn,{type:"textures",index:Le}),Fn}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",ui),null});return this.textureCache[Lt]=_n,_n}assignTexture(Le,Ie,Ue){const We=this;return this.getDependency("texture",Ue.index).then(function(rt){if(Ue.texCoord!==void 0&&Ue.texCoord!=0&&!(Ie==="aoMap"&&Ue.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+Ue.texCoord+" for texture "+Ie+" not yet supported."),We.extensions[N.KHR_TEXTURE_TRANSFORM]){const ut=Ue.extensions!==void 0?Ue.extensions[N.KHR_TEXTURE_TRANSFORM]:void 0;if(ut){const ht=We.associations.get(rt);rt=We.extensions[N.KHR_TEXTURE_TRANSFORM].extendTexture(rt,ut),We.associations.set(rt,ht)}}return Le[Ie]=rt,rt})}assignFinalMaterial(Le){const Ie=Le.geometry;let Ue=Le.material;const We=Ie.attributes.tangent!==void 0,rt=Ie.attributes.color!==void 0,ut=Ie.attributes.normal===void 0;if(Le.isPoints){const ht="PointsMaterial:"+Ue.uuid;let Lt=this.cache.get(ht);Lt||(Lt=new l.PointsMaterial,l.Material.prototype.copy.call(Lt,Ue),Lt.color.copy(Ue.color),Lt.map=Ue.map,Lt.sizeAttenuation=!1,this.cache.add(ht,Lt)),Ue=Lt}else if(Le.isLine){const ht="LineBasicMaterial:"+Ue.uuid;let Lt=this.cache.get(ht);Lt||(Lt=new l.LineBasicMaterial,l.Material.prototype.copy.call(Lt,Ue),Lt.color.copy(Ue.color),this.cache.add(ht,Lt)),Ue=Lt}if(We||rt||ut){let ht="ClonedMaterial:"+Ue.uuid+":";Ue.isGLTFSpecularGlossinessMaterial&&(ht+="specular-glossiness:"),We&&(ht+="vertex-tangents:"),rt&&(ht+="vertex-colors:"),ut&&(ht+="flat-shading:");let Lt=this.cache.get(ht);Lt||(Lt=Ue.clone(),rt&&(Lt.vertexColors=!0),ut&&(Lt.flatShading=!0),We&&(Lt.normalScale&&(Lt.normalScale.y*=-1),Lt.clearcoatNormalScale&&(Lt.clearcoatNormalScale.y*=-1)),this.cache.add(ht,Lt),this.associations.set(Lt,this.associations.get(Ue))),Ue=Lt}Ue.aoMap&&Ie.attributes.uv2===void 0&&Ie.attributes.uv!==void 0&&Ie.setAttribute("uv2",Ie.attributes.uv),Le.material=Ue}getMaterialType(){return l.MeshStandardMaterial}loadMaterial(Le){const Ie=this,Ue=this.json,We=this.extensions,rt=Ue.materials[Le];let ut;const ht={},Lt=rt.extensions||{},It=[];if(Lt[N.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const xi=We[N.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];ut=xi.getMaterialType(),It.push(xi.extendParams(ht,rt,Ie))}else if(Lt[N.KHR_MATERIALS_UNLIT]){const xi=We[N.KHR_MATERIALS_UNLIT];ut=xi.getMaterialType(),It.push(xi.extendParams(ht,rt,Ie))}else{const xi=rt.pbrMetallicRoughness||{};if(ht.color=new l.Color(1,1,1),ht.opacity=1,Array.isArray(xi.baseColorFactor)){const an=xi.baseColorFactor;ht.color.fromArray(an),ht.opacity=an[3]}xi.baseColorTexture!==void 0&&It.push(Ie.assignTexture(ht,"map",xi.baseColorTexture)),ht.metalness=xi.metallicFactor!==void 0?xi.metallicFactor:1,ht.roughness=xi.roughnessFactor!==void 0?xi.roughnessFactor:1,xi.metallicRoughnessTexture!==void 0&&(It.push(Ie.assignTexture(ht,"metalnessMap",xi.metallicRoughnessTexture)),It.push(Ie.assignTexture(ht,"roughnessMap",xi.metallicRoughnessTexture))),ut=this._invokeOne(function(an){return an.getMaterialType&&an.getMaterialType(Le)}),It.push(Promise.all(this._invokeAll(function(an){return an.extendMaterialParams&&an.extendMaterialParams(Le,ht)})))}rt.doubleSided===!0&&(ht.side=l.DoubleSide);const ui=rt.alphaMode||Gt.OPAQUE;return ui===Gt.BLEND?(ht.transparent=!0,ht.depthWrite=!1):(ht.format=l.RGBFormat,ht.transparent=!1,ui===Gt.MASK&&(ht.alphaTest=rt.alphaCutoff!==void 0?rt.alphaCutoff:.5)),rt.normalTexture!==void 0&&ut!==l.MeshBasicMaterial&&(It.push(Ie.assignTexture(ht,"normalMap",rt.normalTexture)),ht.normalScale=new l.Vector2(1,-1),rt.normalTexture.scale!==void 0&&ht.normalScale.set(rt.normalTexture.scale,-rt.normalTexture.scale)),rt.occlusionTexture!==void 0&&ut!==l.MeshBasicMaterial&&(It.push(Ie.assignTexture(ht,"aoMap",rt.occlusionTexture)),rt.occlusionTexture.strength!==void 0&&(ht.aoMapIntensity=rt.occlusionTexture.strength)),rt.emissiveFactor!==void 0&&ut!==l.MeshBasicMaterial&&(ht.emissive=new l.Color().fromArray(rt.emissiveFactor)),rt.emissiveTexture!==void 0&&ut!==l.MeshBasicMaterial&&It.push(Ie.assignTexture(ht,"emissiveMap",rt.emissiveTexture)),Promise.all(It).then(function(){let xi;return ut===Tt?xi=We[N.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(ht):xi=new ut(ht),rt.name&&(xi.name=rt.name),xi.map&&(xi.map.encoding=l.sRGBEncoding),xi.emissiveMap&&(xi.emissiveMap.encoding=l.sRGBEncoding),Ht(xi,rt),Ie.associations.set(xi,{type:"materials",index:Le}),rt.extensions&&Vt(We,xi,rt),xi})}createUniqueName(Le){const Ie=l.PropertyBinding.sanitizeNodeName(Le||"");let Ue=Ie;for(let We=1;this.nodeNamesUsed[Ue];++We)Ue=Ie+"_"+We;return this.nodeNamesUsed[Ue]=!0,Ue}loadGeometries(Le){const Ie=this,Ue=this.extensions,We=this.primitiveCache;function rt(ht){return Ue[N.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(ht,Ie).then(function(Lt){return At(Lt,ht,Ie)})}const ut=[];for(let ht=0,Lt=Le.length;ht<Lt;ht++){const It=Le[ht],ui=Hi(It),xi=We[ui];if(xi)ut.push(xi.promise);else{let an;It.extensions&&It.extensions[N.KHR_DRACO_MESH_COMPRESSION]?an=rt(It):an=At(new l.BufferGeometry,It,Ie),We[ui]={primitive:It,promise:an},ut.push(an)}}return Promise.all(ut)}loadMesh(Le){const Ie=this,Ue=this.json,We=this.extensions,rt=Ue.meshes[Le],ut=rt.primitives,ht=[];for(let Lt=0,It=ut.length;Lt<It;Lt++){const ui=ut[Lt].material===void 0?bt(this.cache):this.getDependency("material",ut[Lt].material);ht.push(ui)}return ht.push(Ie.loadGeometries(ut)),Promise.all(ht).then(function(Lt){const It=Lt.slice(0,Lt.length-1),ui=Lt[Lt.length-1],xi=[];for(let cn=0,_n=ui.length;cn<_n;cn++){const Fn=ui[cn],Mn=ut[cn];let jn;const Lr=It[cn];if(Mn.mode===lt.TRIANGLES||Mn.mode===lt.TRIANGLE_STRIP||Mn.mode===lt.TRIANGLE_FAN||Mn.mode===void 0)jn=rt.isSkinnedMesh===!0?new l.SkinnedMesh(Fn,Lr):new l.Mesh(Fn,Lr),jn.isSkinnedMesh===!0&&!jn.geometry.attributes.skinWeight.normalized&&jn.normalizeSkinWeights(),Mn.mode===lt.TRIANGLE_STRIP?jn.geometry=Ye(jn.geometry,l.TriangleStripDrawMode):Mn.mode===lt.TRIANGLE_FAN&&(jn.geometry=Ye(jn.geometry,l.TriangleFanDrawMode));else if(Mn.mode===lt.LINES)jn=new l.LineSegments(Fn,Lr);else if(Mn.mode===lt.LINE_STRIP)jn=new l.Line(Fn,Lr);else if(Mn.mode===lt.LINE_LOOP)jn=new l.LineLoop(Fn,Lr);else if(Mn.mode===lt.POINTS)jn=new l.Points(Fn,Lr);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+Mn.mode);Object.keys(jn.geometry.morphAttributes).length>0&&zi(jn,rt),jn.name=Ie.createUniqueName(rt.name||"mesh_"+Le),Ht(jn,rt),Mn.extensions&&Vt(We,jn,Mn),Ie.assignFinalMaterial(jn),xi.push(jn)}if(xi.length===1)return xi[0];const an=new l.Group;for(let cn=0,_n=xi.length;cn<_n;cn++)an.add(xi[cn]);return an})}loadCamera(Le){let Ie;const Ue=this.json.cameras[Le],We=Ue[Ue.type];if(!We){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return Ue.type==="perspective"?Ie=new l.PerspectiveCamera(l.MathUtils.radToDeg(We.yfov),We.aspectRatio||1,We.znear||1,We.zfar||2e6):Ue.type==="orthographic"&&(Ie=new l.OrthographicCamera(-We.xmag,We.xmag,We.ymag,-We.ymag,We.znear,We.zfar)),Ue.name&&(Ie.name=this.createUniqueName(Ue.name)),Ht(Ie,Ue),Promise.resolve(Ie)}loadSkin(Le){const Ie=this.json.skins[Le],Ue={joints:Ie.joints};return Ie.inverseBindMatrices===void 0?Promise.resolve(Ue):this.getDependency("accessor",Ie.inverseBindMatrices).then(function(We){return Ue.inverseBindMatrices=We,Ue})}loadAnimation(Le){const Ue=this.json.animations[Le],We=[],rt=[],ut=[],ht=[],Lt=[];for(let It=0,ui=Ue.channels.length;It<ui;It++){const xi=Ue.channels[It],an=Ue.samplers[xi.sampler],cn=xi.target,_n=cn.node!==void 0?cn.node:cn.id,Fn=Ue.parameters!==void 0?Ue.parameters[an.input]:an.input,Mn=Ue.parameters!==void 0?Ue.parameters[an.output]:an.output;We.push(this.getDependency("node",_n)),rt.push(this.getDependency("accessor",Fn)),ut.push(this.getDependency("accessor",Mn)),ht.push(an),Lt.push(cn)}return Promise.all([Promise.all(We),Promise.all(rt),Promise.all(ut),Promise.all(ht),Promise.all(Lt)]).then(function(It){const ui=It[0],xi=It[1],an=It[2],cn=It[3],_n=It[4],Fn=[];for(let jn=0,Lr=ui.length;jn<Lr;jn++){const Tr=ui[jn],to=xi[jn],$r=an[jn],en=cn[jn],Wn=_n[jn];if(Tr===void 0)continue;Tr.updateMatrix(),Tr.matrixAutoUpdate=!0;let Ls;switch(De[Wn.path]){case De.weights:Ls=l.NumberKeyframeTrack;break;case De.rotation:Ls=l.QuaternionKeyframeTrack;break;case De.position:case De.scale:default:Ls=l.VectorKeyframeTrack;break}const To=Tr.name?Tr.name:Tr.uuid,Ro=en.interpolation!==void 0?Ce[en.interpolation]:l.InterpolateLinear,_s=[];De[Wn.path]===De.weights?Tr.traverse(function(Dr){Dr.isMesh===!0&&Dr.morphTargetInfluences&&_s.push(Dr.name?Dr.name:Dr.uuid)}):_s.push(To);let js=$r.array;if($r.normalized){const Dr=mn(js.constructor),ro=new Float32Array(js.length);for(let po=0,ai=js.length;po<ai;po++)ro[po]=js[po]*Dr;js=ro}for(let Dr=0,ro=_s.length;Dr<ro;Dr++){const po=new Ls(_s[Dr]+"."+De[Wn.path],to.array,js,Ro);en.interpolation==="CUBICSPLINE"&&(po.createInterpolant=function(ye){const re=this instanceof l.QuaternionKeyframeTrack?gt:Xe;return new re(this.times,this.values,this.getValueSize()/3,ye)},po.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),Fn.push(po)}}const Mn=Ue.name?Ue.name:"animation_"+Le;return new l.AnimationClip(Mn,void 0,Fn)})}createNodeMesh(Le){const Ie=this.json,Ue=this,We=Ie.nodes[Le];return We.mesh===void 0?null:Ue.getDependency("mesh",We.mesh).then(function(rt){const ut=Ue._getNodeRef(Ue.meshCache,We.mesh,rt);return We.weights!==void 0&&ut.traverse(function(ht){if(ht.isMesh)for(let Lt=0,It=We.weights.length;Lt<It;Lt++)ht.morphTargetInfluences[Lt]=We.weights[Lt]}),ut})}loadNode(Le){const Ie=this.json,Ue=this.extensions,We=this,rt=Ie.nodes[Le],ut=rt.name?We.createUniqueName(rt.name):"";return function(){const ht=[],Lt=We._invokeOne(function(It){return It.createNodeMesh&&It.createNodeMesh(Le)});return Lt&&ht.push(Lt),rt.camera!==void 0&&ht.push(We.getDependency("camera",rt.camera).then(function(It){return We._getNodeRef(We.cameraCache,rt.camera,It)})),We._invokeAll(function(It){return It.createNodeAttachment&&It.createNodeAttachment(Le)}).forEach(function(It){ht.push(It)}),Promise.all(ht)}().then(function(ht){let Lt;if(rt.isBone===!0?Lt=new l.Bone:ht.length>1?Lt=new l.Group:ht.length===1?Lt=ht[0]:Lt=new l.Object3D,Lt!==ht[0])for(let It=0,ui=ht.length;It<ui;It++)Lt.add(ht[It]);if(rt.name&&(Lt.userData.name=rt.name,Lt.name=ut),Ht(Lt,rt),rt.extensions&&Vt(Ue,Lt,rt),rt.matrix!==void 0){const It=new l.Matrix4;It.fromArray(rt.matrix),Lt.applyMatrix4(It)}else rt.translation!==void 0&&Lt.position.fromArray(rt.translation),rt.rotation!==void 0&&Lt.quaternion.fromArray(rt.rotation),rt.scale!==void 0&&Lt.scale.fromArray(rt.scale);return We.associations.set(Lt,{type:"nodes",index:Le}),Lt})}loadScene(Le){const Ie=this.json,Ue=this.extensions,We=this.json.scenes[Le],rt=this,ut=new l.Group;We.name&&(ut.name=rt.createUniqueName(We.name)),Ht(ut,We),We.extensions&&Vt(Ue,ut,We);const ht=We.nodes||[],Lt=[];for(let It=0,ui=ht.length;It<ui;It++)Lt.push(Yn(ht[It],ut,Ie,rt));return Promise.all(Lt).then(function(){return ut})}}function Yn(kt,Le,Ie,Ue){const We=Ie.nodes[kt];return Ue.getDependency("node",kt).then(function(rt){if(We.skin===void 0)return rt;let ut;return Ue.getDependency("skin",We.skin).then(function(ht){ut=ht;const Lt=[];for(let It=0,ui=ut.joints.length;It<ui;It++)Lt.push(Ue.getDependency("node",ut.joints[It]));return Promise.all(Lt)}).then(function(ht){return rt.traverse(function(Lt){if(!Lt.isMesh)return;const It=[],ui=[];for(let xi=0,an=ht.length;xi<an;xi++){const cn=ht[xi];if(cn){It.push(cn);const _n=new l.Matrix4;ut.inverseBindMatrices!==void 0&&_n.fromArray(ut.inverseBindMatrices.array,xi*16),ui.push(_n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',ut.joints[xi])}Lt.bind(new l.Skeleton(It,ui),Lt.matrixWorld)}),rt})}).then(function(rt){Le.add(rt);const ut=[];if(We.children){const ht=We.children;for(let Lt=0,It=ht.length;Lt<It;Lt++){const ui=ht[Lt];ut.push(Yn(ui,rt,Ie,Ue))}}return Promise.all(ut)})}function pr(kt,Le,Ie){const Ue=Le.attributes,We=new l.Box3;if(Ue.POSITION!==void 0){const ht=Ie.json.accessors[Ue.POSITION],Lt=ht.min,It=ht.max;if(Lt!==void 0&&It!==void 0){if(We.set(new l.Vector3(Lt[0],Lt[1],Lt[2]),new l.Vector3(It[0],It[1],It[2])),ht.normalized){const ui=mn(vt[ht.componentType]);We.min.multiplyScalar(ui),We.max.multiplyScalar(ui)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const rt=Le.targets;if(rt!==void 0){const ht=new l.Vector3,Lt=new l.Vector3;for(let It=0,ui=rt.length;It<ui;It++){const xi=rt[It];if(xi.POSITION!==void 0){const an=Ie.json.accessors[xi.POSITION],cn=an.min,_n=an.max;if(cn!==void 0&&_n!==void 0){if(Lt.setX(Math.max(Math.abs(cn[0]),Math.abs(_n[0]))),Lt.setY(Math.max(Math.abs(cn[1]),Math.abs(_n[1]))),Lt.setZ(Math.max(Math.abs(cn[2]),Math.abs(_n[2]))),an.normalized){const Fn=mn(vt[an.componentType]);Lt.multiplyScalar(Fn)}ht.max(Lt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}We.expandByVector(ht)}kt.boundingBox=We;const ut=new l.Sphere;We.getCenter(ut.center),ut.radius=We.min.distanceTo(We.max)/2,kt.boundingSphere=ut}function At(kt,Le,Ie){const Ue=Le.attributes,We=[];function rt(ut,ht){return Ie.getDependency("accessor",ut).then(function(Lt){kt.setAttribute(ht,Lt)})}for(const ut in Ue){const ht=xe[ut]||ut.toLowerCase();ht in kt.attributes||We.push(rt(Ue[ut],ht))}if(Le.indices!==void 0&&!kt.index){const ut=Ie.getDependency("accessor",Le.indices).then(function(ht){kt.setIndex(ht)});We.push(ut)}return Ht(kt,Le),pr(kt,Le,Ie),Promise.all(We).then(function(){return Le.targets!==void 0?ni(kt,Le.targets,Ie):kt})}function Ye(kt,Le){let Ie=kt.getIndex();if(Ie===null){const ut=[],ht=kt.getAttribute("position");if(ht!==void 0){for(let Lt=0;Lt<ht.count;Lt++)ut.push(Lt);kt.setIndex(ut),Ie=kt.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),kt}const Ue=Ie.count-2,We=[];if(Le===l.TriangleFanDrawMode)for(let ut=1;ut<=Ue;ut++)We.push(Ie.getX(0)),We.push(Ie.getX(ut)),We.push(Ie.getX(ut+1));else for(let ut=0;ut<Ue;ut++)ut%2===0?(We.push(Ie.getX(ut)),We.push(Ie.getX(ut+1)),We.push(Ie.getX(ut+2))):(We.push(Ie.getX(ut+2)),We.push(Ie.getX(ut+1)),We.push(Ie.getX(ut)));We.length/3!==Ue&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const rt=kt.clone();return rt.setIndex(We),rt}l.GLTFLoader=E})(),c.exports=l.GLTFLoader}(pb)),pb.exports}var fb={exports:{}},tE;function Vk(){return tE||(tE=1,function(c,p){const l=Na();(function(){class E extends l.Loader{constructor(N){super(N)}load(N,B,n,X){const $=this,ne=$.path===""?l.LoaderUtils.extractUrlBase(N):$.path,ve=new l.FileLoader($.manager);ve.setPath($.path),ve.setRequestHeader($.requestHeader),ve.setWithCredentials($.withCredentials),ve.load(N,function(ze){try{B($.parse(ze,ne))}catch(ke){X?X(ke):console.error(ke),$.manager.itemError(N)}},n,X)}parse(N,B){function n(fe,me){const Ee=[],Ke=fe.childNodes;for(let Pe=0,ci=Ke.length;Pe<ci;Pe++){const Mi=Ke[Pe];Mi.nodeName===me&&Ee.push(Mi)}return Ee}function X(fe){if(fe.length===0)return[];const me=fe.trim().split(/\s+/),Ee=new Array(me.length);for(let Ke=0,Pe=me.length;Ke<Pe;Ke++)Ee[Ke]=me[Ke];return Ee}function $(fe){if(fe.length===0)return[];const me=fe.trim().split(/\s+/),Ee=new Array(me.length);for(let Ke=0,Pe=me.length;Ke<Pe;Ke++)Ee[Ke]=parseFloat(me[Ke]);return Ee}function ne(fe){if(fe.length===0)return[];const me=fe.trim().split(/\s+/),Ee=new Array(me.length);for(let Ke=0,Pe=me.length;Ke<Pe;Ke++)Ee[Ke]=parseInt(me[Ke]);return Ee}function ve(fe){return fe.substring(1)}function ze(){return"three_default_"+Ui++}function ke(fe){return Object.keys(fe).length===0}function yt(fe){return{unit:it(n(fe,"unit")[0]),upAxis:xt(n(fe,"up_axis")[0])}}function it(fe){return fe!==void 0&&fe.hasAttribute("meter")===!0?parseFloat(fe.getAttribute("meter")):1}function xt(fe){return fe!==void 0?fe.textContent:"Y_UP"}function Ze(fe,me,Ee,Ke){const Pe=n(fe,me)[0];if(Pe!==void 0){const ci=n(Pe,Ee);for(let Mi=0;Mi<ci.length;Mi++)Ke(ci[Mi])}}function st(fe,me){for(const Ee in fe){const Ke=fe[Ee];Ke.build=me(fe[Ee])}}function ti(fe,me){return fe.build!==void 0||(fe.build=me(fe)),fe.build}function mt(fe){const me={sources:{},samplers:{},channels:{}};let Ee=!1;for(let Ke=0,Pe=fe.childNodes.length;Ke<Pe;Ke++){const ci=fe.childNodes[Ke];if(ci.nodeType!==1)continue;let Mi;switch(ci.nodeName){case"source":Mi=ci.getAttribute("id"),me.sources[Mi]=Dr(ci);break;case"sampler":Mi=ci.getAttribute("id"),me.samplers[Mi]=pt(ci);break;case"channel":Mi=ci.getAttribute("target"),me.channels[Mi]=Tt(ci);break;case"animation":mt(ci),Ee=!0;break;default:console.log(ci)}}Ee===!1&&(bi.animations[fe.getAttribute("id")||l.MathUtils.generateUUID()]=me)}function pt(fe){const me={inputs:{}};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"input":const ci=ve(Pe.getAttribute("source")),Mi=Pe.getAttribute("semantic");me.inputs[Mi]=ci;break}}return me}function Tt(fe){const me={};let Ke=fe.getAttribute("target").split("/");const Pe=Ke.shift();let ci=Ke.shift();const Mi=ci.indexOf("(")!==-1,Wi=ci.indexOf(".")!==-1;if(Wi)Ke=ci.split("."),ci=Ke.shift(),me.member=Ke.shift();else if(Mi){const hn=ci.split("(");ci=hn.shift();for(let Dn=0;Dn<hn.length;Dn++)hn[Dn]=parseInt(hn[Dn].replace(/\)/,""));me.indices=hn}return me.id=Pe,me.sid=ci,me.arraySyntax=Mi,me.memberSyntax=Wi,me.sampler=ve(fe.getAttribute("source")),me}function Fe(fe){const me=[],Ee=fe.channels,Ke=fe.samplers,Pe=fe.sources;for(const ci in Ee)if(Ee.hasOwnProperty(ci)){const Mi=Ee[ci],Wi=Ke[Mi.sampler],hn=Wi.inputs.INPUT,Dn=Wi.inputs.OUTPUT,Zi=Pe[hn],Kt=Pe[Dn],nn=Xe(Mi,Zi,Kt);Jt(nn,me)}return me}function et(fe){return ti(bi.animations[fe],Fe)}function Xe(fe,me,Ee){const Ke=bi.nodes[fe.id],Pe=Vo(Ke.id),ci=Ke.transforms[fe.sid],Mi=Ke.matrix.clone().transpose();let Wi,hn,Dn,Zi,Kt,nn;const Ei={};switch(ci){case"matrix":for(Dn=0,Zi=me.array.length;Dn<Zi;Dn++)if(Wi=me.array[Dn],hn=Dn*Ee.stride,Ei[Wi]===void 0&&(Ei[Wi]={}),fe.arraySyntax===!0){const fn=Ee.array[hn],cr=fe.indices[0]+4*fe.indices[1];Ei[Wi][cr]=fn}else for(Kt=0,nn=Ee.stride;Kt<nn;Kt++)Ei[Wi][Kt]=Ee.array[hn+Kt];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ci);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ci);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ci);break}const Ln=qe(Ei,Mi);return{name:Pe.uuid,keyframes:Ln}}function qe(fe,me){const Ee=[];for(const Pe in fe)Ee.push({time:parseFloat(Pe),value:fe[Pe]});Ee.sort(Ke);for(let Pe=0;Pe<16;Pe++)le(Ee,Pe,me.elements[Pe]);return Ee;function Ke(Pe,ci){return Pe.time-ci.time}}const gt=new l.Vector3,lt=new l.Vector3,vt=new l.Quaternion;function Jt(fe,me){const Ee=fe.keyframes,Ke=fe.name,Pe=[],ci=[],Mi=[],Wi=[];for(let hn=0,Dn=Ee.length;hn<Dn;hn++){const Zi=Ee[hn],Kt=Zi.time,nn=Zi.value;es.fromArray(nn).transpose(),es.decompose(gt,vt,lt),Pe.push(Kt),ci.push(gt.x,gt.y,gt.z),Mi.push(vt.x,vt.y,vt.z,vt.w),Wi.push(lt.x,lt.y,lt.z)}return ci.length>0&&me.push(new l.VectorKeyframeTrack(Ke+".position",Pe,ci)),Mi.length>0&&me.push(new l.QuaternionKeyframeTrack(Ke+".quaternion",Pe,Mi)),Wi.length>0&&me.push(new l.VectorKeyframeTrack(Ke+".scale",Pe,Wi)),me}function le(fe,me,Ee){let Ke,Pe=!0,ci,Mi;for(ci=0,Mi=fe.length;ci<Mi;ci++)Ke=fe[ci],Ke.value[me]===void 0?Ke.value[me]=null:Pe=!1;if(Pe===!0)for(ci=0,Mi=fe.length;ci<Mi;ci++)Ke=fe[ci],Ke.value[me]=Ee;else we(fe,me)}function we(fe,me){let Ee,Ke;for(let Pe=0,ci=fe.length;Pe<ci;Pe++){const Mi=fe[Pe];if(Mi.value[me]===null){if(Ee=xe(fe,Pe,me),Ke=De(fe,Pe,me),Ee===null){Mi.value[me]=Ke.value[me];continue}if(Ke===null){Mi.value[me]=Ee.value[me];continue}Ce(Mi,Ee,Ke,me)}}}function xe(fe,me,Ee){for(;me>=0;){const Ke=fe[me];if(Ke.value[Ee]!==null)return Ke;me--}return null}function De(fe,me,Ee){for(;me<fe.length;){const Ke=fe[me];if(Ke.value[Ee]!==null)return Ke;me++}return null}function Ce(fe,me,Ee,Ke){if(Ee.time-me.time===0){fe.value[Ke]=me.value[Ke];return}fe.value[Ke]=(fe.time-me.time)*(Ee.value[Ke]-me.value[Ke])/(Ee.time-me.time)+me.value[Ke]}function Gt(fe){const me={name:fe.getAttribute("id")||"default",start:parseFloat(fe.getAttribute("start")||0),end:parseFloat(fe.getAttribute("end")||0),animations:[]};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"instance_animation":me.animations.push(ve(Pe.getAttribute("url")));break}}bi.clips[fe.getAttribute("id")]=me}function Ft(fe){const me=[],Ee=fe.name,Ke=fe.end-fe.start||-1,Pe=fe.animations;for(let ci=0,Mi=Pe.length;ci<Mi;ci++){const Wi=et(Pe[ci]);for(let hn=0,Dn=Wi.length;hn<Dn;hn++)me.push(Wi[hn])}return new l.AnimationClip(Ee,Ke,me)}function bt(fe){return ti(bi.clips[fe],Ft)}function Vt(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"skin":me.id=ve(Pe.getAttribute("source")),me.skin=Ht(Pe);break;case"morph":me.id=ve(Pe.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}bi.controllers[fe.getAttribute("id")]=me}function Ht(fe){const me={sources:{}};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"bind_shape_matrix":me.bindShapeMatrix=$(Pe.textContent);break;case"source":const ci=Pe.getAttribute("id");me.sources[ci]=Dr(Pe);break;case"joints":me.joints=ni(Pe);break;case"vertex_weights":me.vertexWeights=zi(Pe);break}}return me}function ni(fe){const me={inputs:{}};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"input":const ci=Pe.getAttribute("semantic"),Mi=ve(Pe.getAttribute("source"));me.inputs[ci]=Mi;break}}return me}function zi(fe){const me={inputs:{}};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"input":const ci=Pe.getAttribute("semantic"),Mi=ve(Pe.getAttribute("source")),Wi=parseInt(Pe.getAttribute("offset"));me.inputs[ci]={id:Mi,offset:Wi};break;case"vcount":me.vcount=ne(Pe.textContent);break;case"v":me.v=ne(Pe.textContent);break}}return me}function Hi(fe){const me={id:fe.id},Ee=bi.geometries[me.id];return fe.skin!==void 0&&(me.skin=on(fe.skin),Ee.sources.skinIndices=me.skin.indices,Ee.sources.skinWeights=me.skin.weights),me}function on(fe){const Ee={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},Ke=fe.sources,Pe=fe.vertexWeights,ci=Pe.vcount,Mi=Pe.v,Wi=Pe.inputs.JOINT.offset,hn=Pe.inputs.WEIGHT.offset,Dn=fe.sources[fe.joints.inputs.JOINT],Zi=fe.sources[fe.joints.inputs.INV_BIND_MATRIX],Kt=Ke[Pe.inputs.WEIGHT.id].array;let nn=0,Ei,Ln,Vi;for(Ei=0,Vi=ci.length;Ei<Vi;Ei++){const cr=ci[Ei],gr=[];for(Ln=0;Ln<cr;Ln++){const _r=Mi[nn+Wi],Rr=Mi[nn+hn],ur=Kt[Rr];gr.push({index:_r,weight:ur}),nn+=2}for(gr.sort(fn),Ln=0;Ln<4;Ln++){const _r=gr[Ln];_r!==void 0?(Ee.indices.array.push(_r.index),Ee.weights.array.push(_r.weight)):(Ee.indices.array.push(0),Ee.weights.array.push(0))}}for(fe.bindShapeMatrix?Ee.bindMatrix=new l.Matrix4().fromArray(fe.bindShapeMatrix).transpose():Ee.bindMatrix=new l.Matrix4().identity(),Ei=0,Vi=Dn.array.length;Ei<Vi;Ei++){const cr=Dn.array[Ei],gr=new l.Matrix4().fromArray(Zi.array,Ei*Zi.stride).transpose();Ee.joints.push({name:cr,boneInverse:gr})}return Ee;function fn(cr,gr){return gr.weight-cr.weight}}function mn(fe){return ti(bi.controllers[fe],Hi)}function ot(fe){const me={init_from:n(fe,"init_from")[0].textContent};bi.images[fe.getAttribute("id")]=me}function Yn(fe){return fe.build!==void 0?fe.build:fe.init_from}function pr(fe){const me=bi.images[fe];return me!==void 0?ti(me,Yn):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",fe),null)}function At(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"profile_COMMON":me.profile=Ye(Pe);break}}bi.effects[fe.getAttribute("id")]=me}function Ye(fe){const me={surfaces:{},samplers:{}};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"newparam":kt(Pe,me);break;case"technique":me.technique=Ue(Pe);break;case"extra":me.extra=It(Pe);break}}return me}function kt(fe,me){const Ee=fe.getAttribute("sid");for(let Ke=0,Pe=fe.childNodes.length;Ke<Pe;Ke++){const ci=fe.childNodes[Ke];if(ci.nodeType===1)switch(ci.nodeName){case"surface":me.surfaces[Ee]=Le(ci);break;case"sampler2D":me.samplers[Ee]=Ie(ci);break}}}function Le(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"init_from":me.init_from=Pe.textContent;break}}return me}function Ie(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"source":me.source=Pe.textContent;break}}return me}function Ue(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"constant":case"lambert":case"blinn":case"phong":me.type=Pe.nodeName,me.parameters=We(Pe);break}}return me}function We(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":me[Pe.nodeName]=rt(Pe);break;case"transparent":me[Pe.nodeName]={opaque:Pe.getAttribute("opaque"),data:rt(Pe)};break}}return me}function rt(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"color":me[Pe.nodeName]=$(Pe.textContent);break;case"float":me[Pe.nodeName]=parseFloat(Pe.textContent);break;case"texture":me[Pe.nodeName]={id:Pe.getAttribute("texture"),extra:ut(Pe)};break}}return me}function ut(fe){const me={technique:{}};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"extra":ht(Pe,me);break}}return me}function ht(fe,me){for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"technique":Lt(Pe,me);break}}}function Lt(fe,me){for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":me.technique[Pe.nodeName]=parseFloat(Pe.textContent);break;case"wrapU":case"wrapV":Pe.textContent.toUpperCase()==="TRUE"?me.technique[Pe.nodeName]=1:Pe.textContent.toUpperCase()==="FALSE"?me.technique[Pe.nodeName]=0:me.technique[Pe.nodeName]=parseInt(Pe.textContent);break}}}function It(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"technique":me.technique=ui(Pe);break}}return me}function ui(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"double_sided":me[Pe.nodeName]=parseInt(Pe.textContent);break}}return me}function xi(fe){return fe}function an(fe){return ti(bi.effects[fe],xi)}function cn(fe){const me={name:fe.getAttribute("name")};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"instance_effect":me.url=ve(Pe.getAttribute("url"));break}}bi.materials[fe.getAttribute("id")]=me}function _n(fe){let me,Ee=fe.slice((fe.lastIndexOf(".")-1>>>0)+2);switch(Ee=Ee.toLowerCase(),Ee){case"tga":me=je;break;default:me=Me}return me}function Fn(fe){const me=an(fe.url),Ee=me.profile.technique,Ke=me.profile.extra;let Pe;switch(Ee.type){case"phong":case"blinn":Pe=new l.MeshPhongMaterial;break;case"lambert":Pe=new l.MeshLambertMaterial;break;default:Pe=new l.MeshBasicMaterial;break}Pe.name=fe.name||"";function ci(Dn){const Zi=me.profile.samplers[Dn.id];let Kt=null;if(Zi!==void 0){const nn=me.profile.surfaces[Zi.source];Kt=pr(nn.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),Kt=pr(Dn.id);if(Kt!==null){const nn=_n(Kt);if(nn!==void 0){const Ei=nn.load(Kt),Ln=Dn.extra;if(Ln!==void 0&&Ln.technique!==void 0&&ke(Ln.technique)===!1){const Vi=Ln.technique;Ei.wrapS=Vi.wrapU?l.RepeatWrapping:l.ClampToEdgeWrapping,Ei.wrapT=Vi.wrapV?l.RepeatWrapping:l.ClampToEdgeWrapping,Ei.offset.set(Vi.offsetU||0,Vi.offsetV||0),Ei.repeat.set(Vi.repeatU||1,Vi.repeatV||1)}else Ei.wrapS=l.RepeatWrapping,Ei.wrapT=l.RepeatWrapping;return Ei}else return console.warn("THREE.ColladaLoader: THREE.Loader for texture %s not found.",Kt),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",Dn.id),null}const Mi=Ee.parameters;for(const Dn in Mi){const Zi=Mi[Dn];switch(Dn){case"diffuse":Zi.color&&Pe.color.fromArray(Zi.color),Zi.texture&&(Pe.map=ci(Zi.texture));break;case"specular":Zi.color&&Pe.specular&&Pe.specular.fromArray(Zi.color),Zi.texture&&(Pe.specularMap=ci(Zi.texture));break;case"bump":Zi.texture&&(Pe.normalMap=ci(Zi.texture));break;case"ambient":Zi.texture&&(Pe.lightMap=ci(Zi.texture));break;case"shininess":Zi.float&&Pe.shininess&&(Pe.shininess=Zi.float);break;case"emission":Zi.color&&Pe.emissive&&Pe.emissive.fromArray(Zi.color),Zi.texture&&(Pe.emissiveMap=ci(Zi.texture));break}}let Wi=Mi.transparent,hn=Mi.transparency;if(hn===void 0&&Wi&&(hn={float:1}),Wi===void 0&&hn&&(Wi={opaque:"A_ONE",data:{color:[1,1,1,1]}}),Wi&&hn)if(Wi.data.texture)Pe.transparent=!0;else{const Dn=Wi.data.color;switch(Wi.opaque){case"A_ONE":Pe.opacity=Dn[3]*hn.float;break;case"RGB_ZERO":Pe.opacity=1-Dn[0]*hn.float;break;case"A_ZERO":Pe.opacity=1-Dn[3]*hn.float;break;case"RGB_ONE":Pe.opacity=Dn[0]*hn.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',Wi.opaque)}Pe.opacity<1&&(Pe.transparent=!0)}return Ke!==void 0&&Ke.technique!==void 0&&Ke.technique.double_sided===1&&(Pe.side=l.DoubleSide),Pe}function Mn(fe){return ti(bi.materials[fe],Fn)}function jn(fe){const me={name:fe.getAttribute("name")};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"optics":me.optics=Lr(Pe);break}}bi.cameras[fe.getAttribute("id")]=me}function Lr(fe){for(let me=0;me<fe.childNodes.length;me++){const Ee=fe.childNodes[me];switch(Ee.nodeName){case"technique_common":return Tr(Ee)}}return{}}function Tr(fe){const me={};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];switch(Ke.nodeName){case"perspective":case"orthographic":me.technique=Ke.nodeName,me.parameters=to(Ke);break}}return me}function to(fe){const me={};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];switch(Ke.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":me[Ke.nodeName]=parseFloat(Ke.textContent);break}}return me}function $r(fe){let me;switch(fe.optics.technique){case"perspective":me=new l.PerspectiveCamera(fe.optics.parameters.yfov,fe.optics.parameters.aspect_ratio,fe.optics.parameters.znear,fe.optics.parameters.zfar);break;case"orthographic":let Ee=fe.optics.parameters.ymag,Ke=fe.optics.parameters.xmag;const Pe=fe.optics.parameters.aspect_ratio;Ke=Ke===void 0?Ee*Pe:Ke,Ee=Ee===void 0?Ke/Pe:Ee,Ke*=.5,Ee*=.5,me=new l.OrthographicCamera(-Ke,Ke,Ee,-Ee,fe.optics.parameters.znear,fe.optics.parameters.zfar);break;default:me=new l.PerspectiveCamera;break}return me.name=fe.name||"",me}function en(fe){const me=bi.cameras[fe];return me!==void 0?ti(me,$r):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",fe),null)}function Wn(fe){let me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"technique_common":me=Ls(Pe);break}}bi.lights[fe.getAttribute("id")]=me}function Ls(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"directional":case"point":case"spot":case"ambient":me.technique=Pe.nodeName,me.parameters=To(Pe)}}return me}function To(fe){const me={};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"color":const ci=$(Pe.textContent);me.color=new l.Color().fromArray(ci);break;case"falloff_angle":me.falloffAngle=parseFloat(Pe.textContent);break;case"quadratic_attenuation":const Mi=parseFloat(Pe.textContent);me.distance=Mi?Math.sqrt(1/Mi):0;break}}return me}function Ro(fe){let me;switch(fe.technique){case"directional":me=new l.DirectionalLight;break;case"point":me=new l.PointLight;break;case"spot":me=new l.SpotLight;break;case"ambient":me=new l.AmbientLight;break}return fe.parameters.color&&me.color.copy(fe.parameters.color),fe.parameters.distance&&(me.distance=fe.parameters.distance),me}function _s(fe){const me=bi.lights[fe];return me!==void 0?ti(me,Ro):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",fe),null)}function js(fe){const me={name:fe.getAttribute("name"),sources:{},vertices:{},primitives:[]},Ee=n(fe,"mesh")[0];if(Ee!==void 0){for(let Ke=0;Ke<Ee.childNodes.length;Ke++){const Pe=Ee.childNodes[Ke];if(Pe.nodeType!==1)continue;const ci=Pe.getAttribute("id");switch(Pe.nodeName){case"source":me.sources[ci]=Dr(Pe);break;case"vertices":me.vertices=ro(Pe);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",Pe.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":me.primitives.push(po(Pe));break;default:console.log(Pe)}}bi.geometries[fe.getAttribute("id")]=me}}function Dr(fe){const me={array:[],stride:3};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"float_array":me.array=$(Ke.textContent);break;case"Name_array":me.array=X(Ke.textContent);break;case"technique_common":const Pe=n(Ke,"accessor")[0];Pe!==void 0&&(me.stride=parseInt(Pe.getAttribute("stride")));break}}return me}function ro(fe){const me={};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];Ke.nodeType===1&&(me[Ke.getAttribute("semantic")]=ve(Ke.getAttribute("source")))}return me}function po(fe){const me={type:fe.nodeName,material:fe.getAttribute("material"),count:parseInt(fe.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let Ee=0,Ke=fe.childNodes.length;Ee<Ke;Ee++){const Pe=fe.childNodes[Ee];if(Pe.nodeType===1)switch(Pe.nodeName){case"input":const ci=ve(Pe.getAttribute("source")),Mi=Pe.getAttribute("semantic"),Wi=parseInt(Pe.getAttribute("offset")),hn=parseInt(Pe.getAttribute("set")),Dn=hn>0?Mi+hn:Mi;me.inputs[Dn]={id:ci,offset:Wi},me.stride=Math.max(me.stride,Wi+1),Mi==="TEXCOORD"&&(me.hasUV=!0);break;case"vcount":me.vcount=ne(Pe.textContent);break;case"p":me.p=ne(Pe.textContent);break}}return me}function ai(fe){const me={};for(let Ee=0;Ee<fe.length;Ee++){const Ke=fe[Ee];me[Ke.type]===void 0&&(me[Ke.type]=[]),me[Ke.type].push(Ke)}return me}function ye(fe){let me=0;for(let Ee=0,Ke=fe.length;Ee<Ke;Ee++)fe[Ee].hasUV===!0&&me++;me>0&&me<fe.length&&(fe.uvsNeedsFix=!0)}function re(fe){const me={},Ee=fe.sources,Ke=fe.vertices,Pe=fe.primitives;if(Pe.length===0)return{};const ci=ai(Pe);for(const Mi in ci){const Wi=ci[Mi];ye(Wi),me[Mi]=Je(Wi,Ee,Ke)}return me}function Je(fe,me,Ee){const Ke={},Pe={array:[],stride:0},ci={array:[],stride:0},Mi={array:[],stride:0},Wi={array:[],stride:0},hn={array:[],stride:0},Dn={array:[],stride:4},Zi={array:[],stride:4},Kt=new l.BufferGeometry,nn=[];let Ei=0;for(let Ln=0;Ln<fe.length;Ln++){const Vi=fe[Ln],fn=Vi.inputs;let cr=0;switch(Vi.type){case"lines":case"linestrips":cr=Vi.count*2;break;case"triangles":cr=Vi.count*3;break;case"polylist":for(let gr=0;gr<Vi.count;gr++){const _r=Vi.vcount[gr];switch(_r){case 3:cr+=3;break;case 4:cr+=6;break;default:cr+=(_r-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",Vi.type)}Kt.addGroup(Ei,cr,Ln),Ei+=cr,Vi.material&&nn.push(Vi.material);for(const gr in fn){const _r=fn[gr];switch(gr){case"VERTEX":for(const Rr in Ee){const ur=Ee[Rr];switch(Rr){case"POSITION":const wn=Pe.array.length;if(Rt(Vi,me[ur],_r.offset,Pe.array),Pe.stride=me[ur].stride,me.skinWeights&&me.skinIndices&&(Rt(Vi,me.skinIndices,_r.offset,Dn.array),Rt(Vi,me.skinWeights,_r.offset,Zi.array)),Vi.hasUV===!1&&fe.uvsNeedsFix===!0){const ws=(Pe.array.length-wn)/Pe.stride;for(let wr=0;wr<ws;wr++)Mi.array.push(0,0)}break;case"NORMAL":Rt(Vi,me[ur],_r.offset,ci.array),ci.stride=me[ur].stride;break;case"COLOR":Rt(Vi,me[ur],_r.offset,hn.array),hn.stride=me[ur].stride;break;case"TEXCOORD":Rt(Vi,me[ur],_r.offset,Mi.array),Mi.stride=me[ur].stride;break;case"TEXCOORD1":Rt(Vi,me[ur],_r.offset,Wi.array),Mi.stride=me[ur].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',Rr)}}break;case"NORMAL":Rt(Vi,me[_r.id],_r.offset,ci.array),ci.stride=me[_r.id].stride;break;case"COLOR":Rt(Vi,me[_r.id],_r.offset,hn.array),hn.stride=me[_r.id].stride;break;case"TEXCOORD":Rt(Vi,me[_r.id],_r.offset,Mi.array),Mi.stride=me[_r.id].stride;break;case"TEXCOORD1":Rt(Vi,me[_r.id],_r.offset,Wi.array),Wi.stride=me[_r.id].stride;break}}}return Pe.array.length>0&&Kt.setAttribute("position",new l.Float32BufferAttribute(Pe.array,Pe.stride)),ci.array.length>0&&Kt.setAttribute("normal",new l.Float32BufferAttribute(ci.array,ci.stride)),hn.array.length>0&&Kt.setAttribute("color",new l.Float32BufferAttribute(hn.array,hn.stride)),Mi.array.length>0&&Kt.setAttribute("uv",new l.Float32BufferAttribute(Mi.array,Mi.stride)),Wi.array.length>0&&Kt.setAttribute("uv2",new l.Float32BufferAttribute(Wi.array,Wi.stride)),Dn.array.length>0&&Kt.setAttribute("skinIndex",new l.Float32BufferAttribute(Dn.array,Dn.stride)),Zi.array.length>0&&Kt.setAttribute("skinWeight",new l.Float32BufferAttribute(Zi.array,Zi.stride)),Ke.data=Kt,Ke.type=fe[0].type,Ke.materialKeys=nn,Ke}function Rt(fe,me,Ee,Ke){const Pe=fe.p,ci=fe.stride,Mi=fe.vcount;function Wi(Zi){let Kt=Pe[Zi+Ee]*Dn;const nn=Kt+Dn;for(;Kt<nn;Kt++)Ke.push(hn[Kt])}const hn=me.array,Dn=me.stride;if(fe.vcount!==void 0){let Zi=0;for(let Kt=0,nn=Mi.length;Kt<nn;Kt++){const Ei=Mi[Kt];if(Ei===4){const Ln=Zi+ci*0,Vi=Zi+ci*1,fn=Zi+ci*2,cr=Zi+ci*3;Wi(Ln),Wi(Vi),Wi(cr),Wi(Vi),Wi(fn),Wi(cr)}else if(Ei===3){const Ln=Zi+ci*0,Vi=Zi+ci*1,fn=Zi+ci*2;Wi(Ln),Wi(Vi),Wi(fn)}else if(Ei>4)for(let Ln=1,Vi=Ei-2;Ln<=Vi;Ln++){const fn=Zi+ci*0,cr=Zi+ci*Ln,gr=Zi+ci*(Ln+1);Wi(fn),Wi(cr),Wi(gr)}Zi+=ci*Ei}}else for(let Zi=0,Kt=Pe.length;Zi<Kt;Zi+=ci)Wi(Zi)}function dt(fe){return ti(bi.geometries[fe],re)}function Nt(fe){const me={name:fe.getAttribute("name")||"",joints:{},links:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"technique_common":li(Ke,me);break}}bi.kinematicsModels[fe.getAttribute("id")]=me}function oi(fe){return fe.build!==void 0?fe.build:fe}function Zt(fe){return ti(bi.kinematicsModels[fe],oi)}function li(fe,me){for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"joint":me.joints[Ke.getAttribute("sid")]=mi(Ke);break;case"link":me.links.push(Pi(Ke));break}}}function mi(fe){let me;for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"prismatic":case"revolute":me=fi(Ke);break}}return me}function fi(fe){const me={sid:fe.getAttribute("sid"),name:fe.getAttribute("name")||"",axis:new l.Vector3,limits:{min:0,max:0},type:fe.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"axis":const Pe=$(Ke.textContent);me.axis.fromArray(Pe);break;case"limits":const ci=Ke.getElementsByTagName("max")[0],Mi=Ke.getElementsByTagName("min")[0];me.limits.max=parseFloat(ci.textContent),me.limits.min=parseFloat(Mi.textContent);break}}return me.limits.min>=me.limits.max&&(me.static=!0),me.middlePosition=(me.limits.min+me.limits.max)/2,me}function Pi(fe){const me={sid:fe.getAttribute("sid"),name:fe.getAttribute("name")||"",attachments:[],transforms:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"attachment_full":me.attachments.push(tn(Ke));break;case"matrix":case"translate":case"rotate":me.transforms.push(xn(Ke));break}}return me}function tn(fe){const me={joint:fe.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"link":me.links.push(Pi(Ke));break;case"matrix":case"translate":case"rotate":me.transforms.push(xn(Ke));break}}return me}function xn(fe){const me={type:fe.nodeName},Ee=$(fe.textContent);switch(me.type){case"matrix":me.obj=new l.Matrix4,me.obj.fromArray(Ee).transpose();break;case"translate":me.obj=new l.Vector3,me.obj.fromArray(Ee);break;case"rotate":me.obj=new l.Vector3,me.obj.fromArray(Ee),me.angle=l.MathUtils.degToRad(Ee[3]);break}return me}function Jn(fe){const me={name:fe.getAttribute("name")||"",rigidBodies:{}};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"rigid_body":me.rigidBodies[Ke.getAttribute("name")]={},sr(Ke,me.rigidBodies[Ke.getAttribute("name")]);break}}bi.physicsModels[fe.getAttribute("id")]=me}function sr(fe,me){for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"technique_common":ar(Ke,me);break}}}function ar(fe,me){for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"inertia":me.inertia=$(Ke.textContent);break;case"mass":me.mass=$(Ke.textContent)[0];break}}}function er(fe){const me={bindJointAxis:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"bind_joint_axis":me.bindJointAxis.push(Zr(Ke));break}}bi.kinematicsScenes[ve(fe.getAttribute("url"))]=me}function Zr(fe){const me={target:fe.getAttribute("target").split("/").pop()};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType===1)switch(Ke.nodeName){case"axis":const Pe=Ke.getElementsByTagName("param")[0];me.axis=Pe.textContent;const ci=me.axis.split("inst_").pop().split("axis")[0];me.jointIndex=ci.substr(0,ci.length-1);break}}return me}function Gr(fe){return fe.build!==void 0?fe.build:fe}function yr(fe){return ti(bi.kinematicsScenes[fe],Gr)}function Jr(){const fe=Object.keys(bi.kinematicsModels)[0],me=Object.keys(bi.kinematicsScenes)[0],Ee=Object.keys(bi.visualScenes)[0];if(fe===void 0||me===void 0)return;const Ke=Zt(fe),Pe=yr(me),ci=Ws(Ee),Mi=Pe.bindJointAxis,Wi={};for(let Zi=0,Kt=Mi.length;Zi<Kt;Zi++){const nn=Mi[Zi],Ei=Us.querySelector('[sid="'+nn.target+'"]');if(Ei){const Ln=Ei.parentElement;hn(nn.jointIndex,Ln)}}function hn(Zi,Kt){const nn=Kt.getAttribute("name"),Ei=Ke.joints[Zi];ci.traverse(function(Ln){Ln.name===nn&&(Wi[Zi]={object:Ln,transforms:us(Kt),joint:Ei,position:Ei.zeroPosition})})}const Dn=new l.Matrix4;Ai={joints:Ke&&Ke.joints,getJointValue:function(Zi){const Kt=Wi[Zi];if(Kt)return Kt.position;console.warn("THREE.ColladaLoader: Joint "+Zi+" doesn't exist.")},setJointValue:function(Zi,Kt){const nn=Wi[Zi];if(nn){const Ei=nn.joint;if(Kt>Ei.limits.max||Kt<Ei.limits.min)console.warn("THREE.ColladaLoader: Joint "+Zi+" value "+Kt+" outside of limits (min: "+Ei.limits.min+", max: "+Ei.limits.max+").");else if(Ei.static)console.warn("THREE.ColladaLoader: Joint "+Zi+" is static.");else{const Ln=nn.object,Vi=Ei.axis,fn=nn.transforms;es.identity();for(let cr=0;cr<fn.length;cr++){const gr=fn[cr];if(gr.sid&&gr.sid.indexOf(Zi)!==-1)switch(Ei.type){case"revolute":es.multiply(Dn.makeRotationAxis(Vi,l.MathUtils.degToRad(Kt)));break;case"prismatic":es.multiply(Dn.makeTranslation(Vi.x*Kt,Vi.y*Kt,Vi.z*Kt));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+Ei.type);break}else switch(gr.type){case"matrix":es.multiply(gr.obj);break;case"translate":es.multiply(Dn.makeTranslation(gr.obj.x,gr.obj.y,gr.obj.z));break;case"scale":es.scale(gr.obj);break;case"rotate":es.multiply(Dn.makeRotationAxis(gr.obj,gr.angle));break}}Ln.matrix.copy(es),Ln.matrix.decompose(Ln.position,Ln.quaternion,Ln.scale),Wi[Zi].position=Kt}}else console.log("THREE.ColladaLoader: "+Zi+" does not exist.")}}}function us(fe){const me=[],Ee=Us.querySelector('[id="'+fe.id+'"]');for(let Ke=0;Ke<Ee.childNodes.length;Ke++){const Pe=Ee.childNodes[Ke];if(Pe.nodeType!==1)continue;let ci,Mi;switch(Pe.nodeName){case"matrix":ci=$(Pe.textContent);const Wi=new l.Matrix4().fromArray(ci).transpose();me.push({sid:Pe.getAttribute("sid"),type:Pe.nodeName,obj:Wi});break;case"translate":case"scale":ci=$(Pe.textContent),Mi=new l.Vector3().fromArray(ci),me.push({sid:Pe.getAttribute("sid"),type:Pe.nodeName,obj:Mi});break;case"rotate":ci=$(Pe.textContent),Mi=new l.Vector3().fromArray(ci);const hn=l.MathUtils.degToRad(ci[3]);me.push({sid:Pe.getAttribute("sid"),type:Pe.nodeName,obj:Mi,angle:hn});break}}return me}function Ns(fe){const me=fe.getElementsByTagName("node");for(let Ee=0;Ee<me.length;Ee++){const Ke=me[Ee];Ke.hasAttribute("id")===!1&&Ke.setAttribute("id",ze())}}const es=new l.Matrix4,Fs=new l.Vector3;function Ps(fe){const me={name:fe.getAttribute("name")||"",type:fe.getAttribute("type"),id:fe.getAttribute("id"),sid:fe.getAttribute("sid"),matrix:new l.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];if(Ke.nodeType!==1)continue;let Pe;switch(Ke.nodeName){case"node":me.nodes.push(Ke.getAttribute("id")),Ps(Ke);break;case"instance_camera":me.instanceCameras.push(ve(Ke.getAttribute("url")));break;case"instance_controller":me.instanceControllers.push(Mo(Ke));break;case"instance_light":me.instanceLights.push(ve(Ke.getAttribute("url")));break;case"instance_geometry":me.instanceGeometries.push(Mo(Ke));break;case"instance_node":me.instanceNodes.push(ve(Ke.getAttribute("url")));break;case"matrix":Pe=$(Ke.textContent),me.matrix.multiply(es.fromArray(Pe).transpose()),me.transforms[Ke.getAttribute("sid")]=Ke.nodeName;break;case"translate":Pe=$(Ke.textContent),Fs.fromArray(Pe),me.matrix.multiply(es.makeTranslation(Fs.x,Fs.y,Fs.z)),me.transforms[Ke.getAttribute("sid")]=Ke.nodeName;break;case"rotate":Pe=$(Ke.textContent);const ci=l.MathUtils.degToRad(Pe[3]);me.matrix.multiply(es.makeRotationAxis(Fs.fromArray(Pe),ci)),me.transforms[Ke.getAttribute("sid")]=Ke.nodeName;break;case"scale":Pe=$(Ke.textContent),me.matrix.scale(Fs.fromArray(Pe)),me.transforms[Ke.getAttribute("sid")]=Ke.nodeName;break;case"extra":break;default:console.log(Ke)}}return go(me.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",me.id):bi.nodes[me.id]=me,me}function Mo(fe){const me={id:ve(fe.getAttribute("url")),materials:{},skeletons:[]};for(let Ee=0;Ee<fe.childNodes.length;Ee++){const Ke=fe.childNodes[Ee];switch(Ke.nodeName){case"bind_material":const Pe=Ke.getElementsByTagName("instance_material");for(let ci=0;ci<Pe.length;ci++){const Mi=Pe[ci],Wi=Mi.getAttribute("symbol"),hn=Mi.getAttribute("target");me.materials[Wi]=ve(hn)}break;case"skeleton":me.skeletons.push(ve(Ke.textContent));break}}return me}function Qo(fe,me){const Ee=[],Ke=[];let Pe,ci,Mi;for(Pe=0;Pe<fe.length;Pe++){const Dn=fe[Pe];let Zi;if(go(Dn))Zi=Vo(Dn),Ua(Zi,me,Ee);else if($o(Dn)){const nn=bi.visualScenes[Dn].children;for(let Ei=0;Ei<nn.length;Ei++){const Ln=nn[Ei];if(Ln.type==="JOINT"){const Vi=Vo(Ln.id);Ua(Vi,me,Ee)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",Dn)}for(Pe=0;Pe<me.length;Pe++)for(ci=0;ci<Ee.length;ci++)if(Mi=Ee[ci],Mi.bone.name===me[Pe].name){Ke[Pe]=Mi,Mi.processed=!0;break}for(Pe=0;Pe<Ee.length;Pe++)Mi=Ee[Pe],Mi.processed===!1&&(Ke.push(Mi),Mi.processed=!0);const Wi=[],hn=[];for(Pe=0;Pe<Ke.length;Pe++)Mi=Ke[Pe],Wi.push(Mi.bone),hn.push(Mi.boneInverse);return new l.Skeleton(Wi,hn)}function Ua(fe,me,Ee){fe.traverse(function(Ke){if(Ke.isBone===!0){let Pe;for(let ci=0;ci<me.length;ci++){const Mi=me[ci];if(Mi.name===Ke.name){Pe=Mi.boneInverse;break}}Pe===void 0&&(Pe=new l.Matrix4),Ee.push({bone:Ke,boneInverse:Pe,processed:!1})}})}function ml(fe){const me=[],Ee=fe.matrix,Ke=fe.nodes,Pe=fe.type,ci=fe.instanceCameras,Mi=fe.instanceControllers,Wi=fe.instanceLights,hn=fe.instanceGeometries,Dn=fe.instanceNodes;for(let Kt=0,nn=Ke.length;Kt<nn;Kt++)me.push(Vo(Ke[Kt]));for(let Kt=0,nn=ci.length;Kt<nn;Kt++){const Ei=en(ci[Kt]);Ei!==null&&me.push(Ei.clone())}for(let Kt=0,nn=Mi.length;Kt<nn;Kt++){const Ei=Mi[Kt],Ln=mn(Ei.id),Vi=dt(Ln.id),fn=qo(Vi,Ei.materials),cr=Ei.skeletons,gr=Ln.skin.joints,_r=Qo(cr,gr);for(let Rr=0,ur=fn.length;Rr<ur;Rr++){const wn=fn[Rr];wn.isSkinnedMesh&&(wn.bind(_r,Ln.skin.bindMatrix),wn.normalizeSkinWeights()),me.push(wn)}}for(let Kt=0,nn=Wi.length;Kt<nn;Kt++){const Ei=_s(Wi[Kt]);Ei!==null&&me.push(Ei.clone())}for(let Kt=0,nn=hn.length;Kt<nn;Kt++){const Ei=hn[Kt],Ln=dt(Ei.id),Vi=qo(Ln,Ei.materials);for(let fn=0,cr=Vi.length;fn<cr;fn++)me.push(Vi[fn])}for(let Kt=0,nn=Dn.length;Kt<nn;Kt++)me.push(Vo(Dn[Kt]).clone());let Zi;if(Ke.length===0&&me.length===1)Zi=me[0];else{Zi=Pe==="JOINT"?new l.Bone:new l.Group;for(let Kt=0;Kt<me.length;Kt++)Zi.add(me[Kt])}return Zi.name=Pe==="JOINT"?fe.sid:fe.name,Zi.matrix.copy(Ee),Zi.matrix.decompose(Zi.position,Zi.quaternion,Zi.scale),Zi}const aa=new l.MeshBasicMaterial({color:16711935});function nr(fe,me){const Ee=[];for(let Ke=0,Pe=fe.length;Ke<Pe;Ke++){const ci=me[fe[Ke]];ci===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",fe[Ke]),Ee.push(aa)):Ee.push(Mn(ci))}return Ee}function qo(fe,me){const Ee=[];for(const Ke in fe){const Pe=fe[Ke],ci=nr(Pe.materialKeys,me);ci.length===0&&(Ke==="lines"||Ke==="linestrips"?ci.push(new l.LineBasicMaterial):ci.push(new l.MeshPhongMaterial));const Mi=Pe.data.attributes.skinIndex!==void 0,Wi=ci.length===1?ci[0]:ci;let hn;switch(Ke){case"lines":hn=new l.LineSegments(Pe.data,Wi);break;case"linestrips":hn=new l.Line(Pe.data,Wi);break;case"triangles":case"polylist":Mi?hn=new l.SkinnedMesh(Pe.data,Wi):hn=new l.Mesh(Pe.data,Wi);break}Ee.push(hn)}return Ee}function go(fe){return bi.nodes[fe]!==void 0}function Vo(fe){return ti(bi.nodes[fe],ml)}function la(fe){const me={name:fe.getAttribute("name"),children:[]};Ns(fe);const Ee=n(fe,"node");for(let Ke=0;Ke<Ee.length;Ke++)me.children.push(Ps(Ee[Ke]));bi.visualScenes[fe.getAttribute("id")]=me}function _o(fe){const me=new l.Group;me.name=fe.name;const Ee=fe.children;for(let Ke=0;Ke<Ee.length;Ke++){const Pe=Ee[Ke];me.add(Vo(Pe.id))}return me}function $o(fe){return bi.visualScenes[fe]!==void 0}function Ws(fe){return ti(bi.visualScenes[fe],_o)}function _a(fe){const me=n(fe,"instance_visual_scene")[0];return Ws(ve(me.getAttribute("url")))}function gl(){const fe=bi.clips;if(ke(fe)===!0){if(ke(bi.animations)===!1){const me=[];for(const Ee in bi.animations){const Ke=et(Ee);for(let Pe=0,ci=Ke.length;Pe<ci;Pe++)me.push(Ke[Pe])}zt.push(new l.AnimationClip("default",-1,me))}}else for(const me in fe)zt.push(bt(me))}function Va(fe){let me="";const Ee=[fe];for(;Ee.length;){const Ke=Ee.shift();Ke.nodeType===Node.TEXT_NODE?me+=Ke.textContent:(me+=`
`,Ee.push.apply(Ee,Ke.childNodes))}return me.trim()}if(N.length===0)return{scene:new l.Scene};const Hl=new DOMParser().parseFromString(N,"application/xml"),Us=n(Hl,"COLLADA")[0],_l=Hl.getElementsByTagName("parsererror")[0];if(_l!==void 0){const fe=n(_l,"div")[0];let me;return fe?me=fe.textContent:me=Va(_l),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,me),null}const yl=Us.getAttribute("version");console.log("THREE.ColladaLoader: File version",yl);const Ae=yt(n(Us,"asset")[0]),Me=new l.TextureLoader(this.manager);Me.setPath(this.resourcePath||B).setCrossOrigin(this.crossOrigin);let je;l.TGALoader&&(je=new l.TGALoader(this.manager),je.setPath(this.resourcePath||B));const zt=[];let Ai={},Ui=0;const bi={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};Ze(Us,"library_animations","animation",mt),Ze(Us,"library_animation_clips","animation_clip",Gt),Ze(Us,"library_controllers","controller",Vt),Ze(Us,"library_images","image",ot),Ze(Us,"library_effects","effect",At),Ze(Us,"library_materials","material",cn),Ze(Us,"library_cameras","camera",jn),Ze(Us,"library_lights","light",Wn),Ze(Us,"library_geometries","geometry",js),Ze(Us,"library_nodes","node",Ps),Ze(Us,"library_visual_scenes","visual_scene",la),Ze(Us,"library_kinematics_models","kinematics_model",Nt),Ze(Us,"library_physics_models","physics_model",Jn),Ze(Us,"scene","instance_kinematics_scene",er),st(bi.animations,Fe),st(bi.clips,Ft),st(bi.controllers,Hi),st(bi.images,Yn),st(bi.effects,xi),st(bi.materials,Fn),st(bi.cameras,$r),st(bi.lights,Ro),st(bi.geometries,re),st(bi.visualScenes,_o),gl(),Jr();const Yi=_a(n(Us,"scene")[0]);return Yi.animations=zt,Ae.upAxis==="Z_UP"&&Yi.quaternion.setFromEuler(new l.Euler(-Math.PI/2,0,0)),Yi.scale.multiplyScalar(Ae.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),zt},kinematics:Ai,library:bi,scene:Yi}}}l.ColladaLoader=E})(),c.exports=l.ColladaLoader}(fb)),fb.exports}var iE;function Gk(){return iE||(iE=1,function(c,p){const l=Lc(),E=qd(),D=kk(),N=Fk(),B=Nk(),n=Uk(),X=Vk(),$=new D,ne=new N,ve=new n,ze=new B,ke=new X;function yt(it,xt,Ze){if(it===void 0)return console.error("Invalid options provided to loadObj()");it=l._validate(it,E.prototype._defaults.loadObj);let st;switch(it.type||(it.type="mtl"),it.type){case"mtl":st=$;break;case"gltf":case"glb":st=ve;break;case"fbx":st=ze;break;case"dae":st=ke;break}ne.load(it.mtl,ti,()=>null,pt=>{console.warn("No material file found "+pt.stack)});function ti(pt){pt&&it.type=="mtl"&&(pt.preload(),st.setMaterials(pt)),st.load(it.obj,Tt=>{let Fe=[];switch(it.type){case"mtl":Tt=Tt.children[0];break;case"gltf":case"glb":case"dae":Fe=Tt.animations,Tt=Tt.scene;break;case"fbx":Fe=Tt.animations;break}Tt.animations=Fe;const et=l.types.rotation(it.rotation,[0,0,0]),Xe=l.types.scale(it.scale,[1,1,1]);Tt.rotation.set(et[0],et[1],et[2]),Tt.scale.set(Xe[0],Xe[1],Xe[2]),it.normalize&&mt(Tt),Tt.name="model";let qe=E.prototype._makeGroup(Tt,it);E.prototype._addMethods(qe),qe.setAnchor(it.anchor),qe.setCenter(it.adjustment),qe.raycasted=it.raycasted,Ze(qe),xt(qe),qe.setFixedZoom(it.mapScale),qe.idle()},()=>null,Tt=>{console.error("Could not load model file: "+it.obj+` 
 `+Tt.stack),Ze("Error loading the model")})}function mt(pt){pt.traverse(function(Tt){if(Tt.isMesh){let Fe;Tt.material.type=="MeshStandardMaterial"?(Tt.material.metalness&&(Tt.material.metalness*=.1),Tt.material.glossiness&&(Tt.material.glossiness*=.25),Fe=new THREE.Color(12,12,12)):Tt.material.type=="MeshPhongMaterial"&&(Tt.material.shininess=.1,Fe=new THREE.Color(20,20,20)),Tt.material.specular&&Tt.material.specular.isColor&&(Tt.material.specular=Fe)}})}}c.exports=yt}(cb)),cb.exports}var mb={exports:{}},nE;function Hk(){return nE||(nE=1,function(c,p){const l=Na(),E=Lc(),D=qd();function N(B){B=E._validate(B,D.prototype._defaults.line);var n=E.lnglatsToWorld(B.geometry),X=E.normalizeVertices(n),$=E.flattenVectors(X.vertices),ne=new l.LineGeometry;ne.setPositions($);let ve=new l.LineMaterial({color:B.color,linewidth:B.width,dashed:!1,opacity:B.opacity});return ve.resolution.set(window.innerWidth,window.innerHeight),ve.isMaterial=!0,ve.transparent=!0,ve.depthWrite=!1,N=new l.Line2(ne,ve),N.position.copy(X.position),N.computeLineDistances(),N}c.exports=N,function(){const B=new l.Box3,n=new l.Vector3;class X extends l.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";const ne=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],ve=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],ze=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(ze),this.setAttribute("position",new l.Float32BufferAttribute(ne,3)),this.setAttribute("uv",new l.Float32BufferAttribute(ve,2))}applyMatrix4(ne){const ve=this.attributes.instanceStart,ze=this.attributes.instanceEnd;return ve!==void 0&&(ve.applyMatrix4(ne),ze.applyMatrix4(ne),ve.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(ne){let ve;ne instanceof Float32Array?ve=ne:Array.isArray(ne)&&(ve=new Float32Array(ne));const ze=new l.InstancedInterleavedBuffer(ve,6,1);return this.setAttribute("instanceStart",new l.InterleavedBufferAttribute(ze,3,0)),this.setAttribute("instanceEnd",new l.InterleavedBufferAttribute(ze,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(ne){let ve;ne instanceof Float32Array?ve=ne:Array.isArray(ne)&&(ve=new Float32Array(ne));const ze=new l.InstancedInterleavedBuffer(ve,6,1);return this.setAttribute("instanceColorStart",new l.InterleavedBufferAttribute(ze,3,0)),this.setAttribute("instanceColorEnd",new l.InterleavedBufferAttribute(ze,3,3)),this}fromWireframeGeometry(ne){return this.setPositions(ne.attributes.position.array),this}fromEdgesGeometry(ne){return this.setPositions(ne.attributes.position.array),this}fromMesh(ne){return this.fromWireframeGeometry(new l.WireframeGeometry(ne.geometry)),this}fromLineSegments(ne){const ve=ne.geometry;if(ve.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else ve.isBufferGeometry&&this.setPositions(ve.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new l.Box3);const ne=this.attributes.instanceStart,ve=this.attributes.instanceEnd;ne!==void 0&&ve!==void 0&&(this.boundingBox.setFromBufferAttribute(ne),B.setFromBufferAttribute(ve),this.boundingBox.union(B))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new l.Sphere),this.boundingBox===null&&this.computeBoundingBox();const ne=this.attributes.instanceStart,ve=this.attributes.instanceEnd;if(ne!==void 0&&ve!==void 0){const ze=this.boundingSphere.center;this.boundingBox.getCenter(ze);let ke=0;for(let yt=0,it=ne.count;yt<it;yt++)n.fromBufferAttribute(ne,yt),ke=Math.max(ke,ze.distanceToSquared(n)),n.fromBufferAttribute(ve,yt),ke=Math.max(ke,ze.distanceToSquared(n));this.boundingSphere.radius=Math.sqrt(ke),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(ne){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(ne)}}X.prototype.isLineSegmentsGeometry=!0,l.LineSegmentsGeometry=X}(),function(){class B extends l.LineSegmentsGeometry{constructor(){super(),this.type="LineGeometry"}setPositions(X){for(var $=X.length-3,ne=new Float32Array(2*$),ve=0;ve<$;ve+=3)ne[2*ve]=X[ve],ne[2*ve+1]=X[ve+1],ne[2*ve+2]=X[ve+2],ne[2*ve+3]=X[ve+3],ne[2*ve+4]=X[ve+4],ne[2*ve+5]=X[ve+5];return super.setPositions(ne),this}setColors(X){for(var $=X.length-3,ne=new Float32Array(2*$),ve=0;ve<$;ve+=3)ne[2*ve]=X[ve],ne[2*ve+1]=X[ve+1],ne[2*ve+2]=X[ve+2],ne[2*ve+3]=X[ve+3],ne[2*ve+4]=X[ve+4],ne[2*ve+5]=X[ve+5];return super.setColors(ne),this}fromLine(X){var $=X.geometry;if($.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else $.isBufferGeometry&&this.setPositions($.attributes.position.array);return this}}B.prototype.isLineGeometry=!0,l.LineGeometry=B}(),function(){class B extends l.LineSegmentsGeometry{constructor(X){super(),this.type="WireframeGeometry2",this.fromWireframeGeometry(new l.WireframeGeometry(X))}}B.prototype.isWireframeGeometry2=!0,l.WireframeGeometry2=B}(),function(){l.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new l.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},l.ShaderLib.line={uniforms:l.UniformsUtils.merge([l.UniformsLib.common,l.UniformsLib.fog,l.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		varying vec2 vUv;
		varying vec4 worldPos;
		varying vec3 worldStart;
		varying vec3 worldEnd;

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;

			#endif

			float aspect = resolution.x / resolution.y;

			vUv = uv;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			worldStart = start.xyz;
			worldEnd = end.xyz;

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;
		varying vec4 worldPos;
		varying vec3 worldStart;
		varying vec3 worldEnd;

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		varying vec2 vUv;

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class B extends l.ShaderMaterial{constructor(X){super({type:"LineMaterial",uniforms:l.UniformsUtils.clone(l.ShaderLib.line.uniforms),vertexShader:l.ShaderLib.line.vertexShader,fragmentShader:l.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function($){this.uniforms.diffuse.value=$}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function($){$===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function($){this.uniforms.linewidth.value=$}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set($){!!$!="USE_DASH"in this.defines&&(this.needsUpdate=!0),$===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function($){this.uniforms.dashScale.value=$}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function($){this.uniforms.dashSize.value=$}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function($){this.uniforms.dashOffset.value=$}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function($){this.uniforms.gapSize.value=$}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function($){this.uniforms.opacity.value=$}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function($){this.uniforms.resolution.value.copy($)}},alphaToCoverage:{enumerable:!0,get:function(){return"ALPHA_TO_COVERAGE"in this.defines},set:function($){!!$!="ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),$===!0?(this.defines.ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(X)}}B.prototype.isLineMaterial=!0,l.LineMaterial=B}(),function(){const B=new l.Vector3,n=new l.Vector3,X=new l.Vector4,$=new l.Vector4,ne=new l.Vector4,ve=new l.Vector3,ze=new l.Matrix4,ke=new l.Line3,yt=new l.Vector3,it=new l.Box3,xt=new l.Sphere,Ze=new l.Vector4;class st extends l.Mesh{constructor(mt=new l.LineSegmentsGeometry,pt=new l.LineMaterial({color:Math.random()*16777215})){super(mt,pt),this.type="LineSegments2"}computeLineDistances(){const mt=this.geometry,pt=mt.attributes.instanceStart,Tt=mt.attributes.instanceEnd,Fe=new Float32Array(2*pt.count);for(let Xe=0,qe=0,gt=pt.count;Xe<gt;Xe++,qe+=2)B.fromBufferAttribute(pt,Xe),n.fromBufferAttribute(Tt,Xe),Fe[qe]=qe===0?0:Fe[qe-1],Fe[qe+1]=Fe[qe]+B.distanceTo(n);const et=new l.InstancedInterleavedBuffer(Fe,2,1);return mt.setAttribute("instanceDistanceStart",new l.InterleavedBufferAttribute(et,1,0)),mt.setAttribute("instanceDistanceEnd",new l.InterleavedBufferAttribute(et,1,1)),this}raycast(mt,pt){mt.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');const Tt=mt.params.Line2!==void 0&&mt.params.Line2.threshold||0,Fe=mt.ray,et=mt.camera,Xe=et.projectionMatrix,qe=this.matrixWorld,gt=this.geometry,lt=this.material,vt=lt.resolution,Jt=lt.linewidth+Tt,le=gt.attributes.instanceStart,we=gt.attributes.instanceEnd,xe=-et.near,De=2*Math.max(Jt/vt.width,Jt/vt.height);gt.boundingSphere===null&&gt.computeBoundingSphere(),xt.copy(gt.boundingSphere).applyMatrix4(qe);const Ce=Math.max(et.near,xt.distanceToPoint(Fe.origin));Ze.set(0,0,-Ce,1).applyMatrix4(et.projectionMatrix),Ze.multiplyScalar(1/Ze.w),Ze.applyMatrix4(et.projectionMatrixInverse);const Gt=Math.abs(De/Ze.w)*.5;if(xt.radius+=Gt,mt.ray.intersectsSphere(xt)===!1)return;gt.boundingBox===null&&gt.computeBoundingBox(),it.copy(gt.boundingBox).applyMatrix4(qe);const Ft=Math.max(et.near,it.distanceToPoint(Fe.origin));Ze.set(0,0,-Ft,1).applyMatrix4(et.projectionMatrix),Ze.multiplyScalar(1/Ze.w),Ze.applyMatrix4(et.projectionMatrixInverse);const bt=Math.abs(De/Ze.w)*.5;if(it.max.x+=bt,it.max.y+=bt,it.max.z+=bt,it.min.x-=bt,it.min.y-=bt,it.min.z-=bt,mt.ray.intersectsBox(it)!==!1){Fe.at(1,ne),ne.w=1,ne.applyMatrix4(et.matrixWorldInverse),ne.applyMatrix4(Xe),ne.multiplyScalar(1/ne.w),ne.x*=vt.x/2,ne.y*=vt.y/2,ne.z=0,ve.copy(ne),ze.multiplyMatrices(et.matrixWorldInverse,qe);for(let Ht=0,ni=le.count;Ht<ni;Ht++){X.fromBufferAttribute(le,Ht),$.fromBufferAttribute(we,Ht),X.w=1,$.w=1,X.applyMatrix4(ze),$.applyMatrix4(ze);var Vt=X.z>xe&&$.z>xe;if(Vt)continue;if(X.z>xe){const ot=X.z-$.z,Yn=(X.z-xe)/ot;X.lerp($,Yn)}else if($.z>xe){const ot=$.z-X.z,Yn=($.z-xe)/ot;$.lerp(X,Yn)}X.applyMatrix4(Xe),$.applyMatrix4(Xe),X.multiplyScalar(1/X.w),$.multiplyScalar(1/$.w),X.x*=vt.x/2,X.y*=vt.y/2,$.x*=vt.x/2,$.y*=vt.y/2,ke.start.copy(X),ke.start.z=0,ke.end.copy($),ke.end.z=0;const zi=ke.closestPointToPointParameter(ve,!0);ke.at(zi,yt);const Hi=l.MathUtils.lerp(X.z,$.z,zi),on=Hi>=-1&&Hi<=1,mn=ve.distanceTo(yt)<Jt*.5;if(on&&mn){ke.start.fromBufferAttribute(le,Ht),ke.end.fromBufferAttribute(we,Ht),ke.start.applyMatrix4(qe),ke.end.applyMatrix4(qe);const ot=new l.Vector3,Yn=new l.Vector3;Fe.distanceSqToSegment(ke.start,ke.end,Yn,ot),pt.push({point:Yn,pointOnLine:ot,distance:Fe.origin.distanceTo(Yn),object:this,face:null,faceIndex:Ht,uv:null,uv2:null})}}}}}st.prototype.LineSegments2=!0,l.LineSegments2=st}(),function(){class B extends l.LineSegments2{constructor(X=new l.LineGeometry,$=new l.LineMaterial({color:Math.random()*16777215})){super(X,$),this.type="Line2"}}B.prototype.isLine2=!0,l.Line2=B}(),function(){const B=new l.Vector3,n=new l.Vector3;class X extends l.Mesh{constructor(ne=new l.LineSegmentsGeometry,ve=new l.LineMaterial({color:Math.random()*16777215})){super(ne,ve),this.type="Wireframe"}computeLineDistances(){const ne=this.geometry,ve=ne.attributes.instanceStart,ze=ne.attributes.instanceEnd,ke=new Float32Array(2*ve.count);for(let it=0,xt=0,Ze=ve.count;it<Ze;it++,xt+=2)B.fromBufferAttribute(ve,it),n.fromBufferAttribute(ze,it),ke[xt]=xt===0?0:ke[xt-1],ke[xt+1]=ke[xt]+B.distanceTo(n);const yt=new l.InstancedInterleavedBuffer(ke,2,1);return ne.setAttribute("instanceDistanceStart",new l.InterleavedBufferAttribute(yt,1,0)),ne.setAttribute("instanceDistanceEnd",new l.InterleavedBufferAttribute(yt,1,1)),this}}X.prototype.isWireframe=!0,l.Wireframe=X}()}(mb)),mb.exports}var gb={exports:{}},rE;function jk(){return rE||(rE=1,function(c,p){const l=Lc(),E=dx(),D=qd(),N=Na(),B=fx();function n(X,$){X=l._validate(X,D.prototype._defaults.tube);let ne=[];X.geometry.forEach(it=>{ne.push(new N.Vector3(it[0],it[1],it[2]))});const ve=new N.CatmullRomCurve3(ne);let ze=new N.TubeGeometry(ve,ne.length,X.radius,X.sides,!1),ke=E(X),yt=new N.Mesh(ze,ke);return new B({obj:yt,units:X.units,anchor:X.anchor,adjustment:X.adjustment,bbox:X.bbox,tooltip:X.tooltip,raycasted:X.raycasted})}c.exports=n}(gb)),gb.exports}var _b={exports:{}},sE;function Wk(){return sE||(sE=1,function(c,p){const l=px();function E(D){this.map=D,this.renderer=new l.CSS2DRenderer,this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.id="labelCanvas",this.renderer.domElement.style.top=0,this.renderer.domElement.style.zIndex="0",this.map.getCanvasContainer().appendChild(this.renderer.domElement),this.scene,this.camera,this.dispose=function(){this.map.getCanvasContainer().removeChild(this.renderer.domElement),this.renderer.domElement.remove(),this.renderer={}},this.setSize=function(N,B){this.renderer.setSize(N,B)},this.map.on("resize",(function(){this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight)}).bind(this)),this.state={reset:function(){}},this.render=async function(N,B){return this.scene=N,this.camera=B,new Promise(n=>{n(this.renderer.render(N,B))})},this.toggleLabels=async function(N,B){return new Promise(n=>{n(this.setVisibility(N,B,this.scene,this.camera,this.renderer))})},this.setVisibility=function(N,B,n,X,$){var ne=this.renderer.cacheList;ne.forEach(function(ve){ve.visible!=B&&ve.layer===N&&(B&&ve.alwaysVisible||!B)&&(ve.visible=B,$.renderObject(ve,n,X))})}}c.exports=E}(_b)),_b.exports}var yb={exports:{}},oE;function qk(){return oE||(oE=1,function(c,p){q3();class l{constructor(D,N){this.id=D.layerId,this.type="custom",this.renderingMode="3d",this.opacity=.5,this.buildingsLayerId=D.buildingsLayerId,this.minAltitude=D.minAltitude||.1,this.tb=N}onAdd(D,N){this.map=D;const B=`
			uniform mat4 u_matrix;
			uniform float u_height_factor;
			uniform float u_altitude;
			uniform float u_azimuth;
			attribute vec2 a_pos;
			attribute vec4 a_normal_ed;
			attribute lowp vec2 a_base;
			attribute lowp vec2 a_height;
			void main() {
				float base = max(0.0, a_base.x);
				float height = max(0.0, a_height.x);
				float t = mod(a_normal_ed.x, 2.0);
				vec4 pos = vec4(a_pos, t > 0.0 ? height : base, 1);
				float len = pos.z * u_height_factor / tan(u_altitude);
				pos.x += cos(u_azimuth) * len;
				pos.y += sin(u_azimuth) * len;
				pos.z = 0.0;
				gl_Position = u_matrix * pos;
			}
			`,n=`
			void main() {
				gl_FragColor = vec4(0.0, 0.0, 0.0, 0.7);
			}
			`,X=N.createShader(N.VERTEX_SHADER);N.shaderSource(X,B),N.compileShader(X);const $=N.createShader(N.FRAGMENT_SHADER);N.shaderSource($,n),N.compileShader($),this.program=N.createProgram(),N.attachShader(this.program,X),N.attachShader(this.program,$),N.linkProgram(this.program),N.validateProgram(this.program),this.uMatrix=N.getUniformLocation(this.program,"u_matrix"),this.uHeightFactor=N.getUniformLocation(this.program,"u_height_factor"),this.uAltitude=N.getUniformLocation(this.program,"u_altitude"),this.uAzimuth=N.getUniformLocation(this.program,"u_azimuth"),this.aPos=N.getAttribLocation(this.program,"a_pos"),this.aNormal=N.getAttribLocation(this.program,"a_normal_ed"),this.aBase=N.getAttribLocation(this.program,"a_base"),this.aHeight=N.getAttribLocation(this.program,"a_height")}render(D,N){D.useProgram(this.program);const B=this.map.style.sourceCaches.composite,n=B.getVisibleCoordinates().reverse(),X=this.map.getLayer(this.buildingsLayerId),$=this.map.painter.context,{lng:ne,lat:ve}=this.map.getCenter(),ze=this.tb.getSunPosition(this.tb.lightDateTime,[ne,ve]);D.uniform1f(this.uAltitude,ze.altitude>this.minAltitude?ze.altitude:0),D.uniform1f(this.uAzimuth,ze.azimuth+3*Math.PI/2),D.enable(D.BLEND),D.blendFunc(D.SRC_ALPHA,D.ONE_MINUS_SRC_ALPHA),D.getExtension("EXT_blend_minmax"),D.disable(D.DEPTH_TEST);for(const ke of n){const yt=B.getTile(ke),it=yt.getBucket(X);if(!it)continue;const[xt,Ze]=it.programConfigurations.programConfigurations[this.buildingsLayerId]._buffers;D.uniformMatrix4fv(this.uMatrix,!1,ke.posMatrix),D.uniform1f(this.uHeightFactor,Math.pow(2,ke.overscaledZ)/yt.tileSize/8);for(const st of it.segments.get()){const ti=$.currentNumAttributes||0,mt=2;for(let Tt=mt;Tt<ti;Tt++)D.disableVertexAttribArray(Tt);const pt=st.vertexOffset||0;D.enableVertexAttribArray(this.aPos),D.enableVertexAttribArray(this.aNormal),D.enableVertexAttribArray(this.aHeight),D.enableVertexAttribArray(this.aBase),it.layoutVertexBuffer.bind(),D.vertexAttribPointer(this.aPos,2,D.SHORT,!1,12,12*pt),D.vertexAttribPointer(this.aNormal,4,D.SHORT,!1,12,4+12*pt),xt.bind(),D.vertexAttribPointer(this.aHeight,1,D.FLOAT,!1,4,4*pt),Ze.bind(),D.vertexAttribPointer(this.aBase,1,D.FLOAT,!1,4,4*pt),it.indexBuffer.bind(),$.currentNumAttributes=mt,D.drawElements(D.TRIANGLES,st.primitiveLength*3,D.UNSIGNED_SHORT,st.primitiveOffset*3*2)}}}}c.exports=l}(yb)),yb.exports}var aE;function $k(){return aE||(aE=1,function(c,p){const l=Na(),E=Ik(),D=Lc(),N=q3(),B=qw(),n=qd(),X=dx(),$=Pk(),ne=Dk(),ve=Ok(),ze=zk(),ke=Gk(),yt=fx(),it=Hk(),xt=jk(),Ze=Wk(),st=qk();function ti(pt,Tt,Fe){this.init(pt,Tt,Fe)}ti.prototype={repaint:function(){this.map.repaint=!0},init:function(pt,Tt,Fe){this.options=D._validate(Fe||{},mt),this.map=pt,this.map.tb=this,this.objects=new n,this.mapboxVersion=parseFloat(this.map.version),this.renderer=new l.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:Fe.preserveDrawingBuffer,canvas:pt.getCanvas(),context:Tt}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.outputEncoding=l.sRGBEncoding,this.renderer.autoClear=!1,this.labelRenderer=new Ze(this.map),this.scene=new l.Scene,this.world=new l.Group,this.world.name="world",this.scene.add(this.world),this.objectsCache=new Map,this.zoomLayers=[],this.fov=this.options.fov,this.orthographic=this.options.orthographic||!1,this.raycaster=new l.Raycaster,this.raycaster.layers.set(0),this.mapCenter=this.map.getCenter(),this.mapCenterUnits=D.projectToWorld([this.mapCenter.lng,this.mapCenter.lat]),this.lightDateTime=new Date,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition,this.rotationStep=5,this.gridStep=6,this.altitudeStep=.1,this.defaultCursor="default",this.lights=this.initLights,this.options.defaultLights&&this.defaultLights(),this.options.realSunlight&&this.realSunlight(this.options.realSunlightHelper),this.skyLayerName="sky-layer",this.terrainSourceName="mapbox-dem",this.terrainExaggeration=1,this.terrainLayerName="",this.enableSelectingFeatures=this.options.enableSelectingFeatures||!1,this.enableSelectingObjects=this.options.enableSelectingObjects||!1,this.enableDraggingObjects=this.options.enableDraggingObjects||!1,this.enableRotatingObjects=this.options.enableRotatingObjects||!1,this.enableTooltips=this.options.enableTooltips||!1,this.multiLayer=this.options.multiLayer||!1,this.enableHelpTooltips=this.options.enableHelpTooltips||!1,this.map.on("style.load",function(){this.tb.zoomLayers=[],this.tb.options.multiLayer&&this.addLayer({id:"threebox_layer",type:"custom",renderingMode:"3d",map:this,onAdd:function(Xe,qe){},render:function(Xe,qe){this.map.tb.update()}}),this.once("idle",()=>{this.tb.setObjectsScale()}),this.tb.options.sky&&(this.tb.sky=!0),this.tb.options.terrain&&(this.tb.terrain=!0),["satellite","mapbox-mapbox-satellite","satelliteLayer"].forEach(Xe=>{this.getLayer(Xe)&&(this.tb.terrainLayerName=Xe)})}),this.map.on("load",function(){this.selectedObject,this.selectedFeature,this.draggedObject;let et;this.overedObject,this.overedFeature;let Xe=this.getCanvasContainer();this.getCanvasContainer().style.cursor=this.tb.defaultCursor;let qe,gt=[],lt,vt,Jt,le;function we(Ht){var ni=Xe.getBoundingClientRect();return{x:Ht.originalEvent.clientX-ni.left-Xe.clientLeft,y:Ht.originalEvent.clientY-ni.top-Xe.clientTop}}this.unselectObject=function(){this.selectedObject.selected=!1,this.selectedObject=null},this.outObject=function(){this.overedObject.over=!1,this.overedObject=null},this.unselectFeature=function(Ht){typeof Ht.id>"u"||(this.setFeatureState({source:Ht.source,sourceLayer:Ht.sourceLayer,id:Ht.id},{select:!1}),this.removeTooltip(Ht),Ht=this.queryRenderedFeatures({layers:[Ht.layer.id],filter:["==",["id"],Ht.id]})[0],Ht&&this.fire("SelectedFeatureChange",{detail:Ht}),this.selectedFeature=null)},this.selectFeature=function(Ht){this.selectedFeature=Ht,this.setFeatureState({source:this.selectedFeature.source,sourceLayer:this.selectedFeature.sourceLayer,id:this.selectedFeature.id},{select:!0}),this.selectedFeature=this.queryRenderedFeatures({layers:[this.selectedFeature.layer.id],filter:["==",["id"],this.selectedFeature.id]})[0],this.addTooltip(this.selectedFeature),this.fire("SelectedFeatureChange",{detail:this.selectedFeature})},this.outFeature=function(Ht){this.overedFeature&&typeof this.overedFeature<"u"&&this.overedFeature.id!=Ht&&(pt.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!1}),this.removeTooltip(this.overedFeature),this.overedFeature=null)},this.addTooltip=function(Ht){if(!this.tb.enableTooltips)return;let ni=this.tb.getFeatureCenter(Ht),zi=this.tb.tooltip({text:Ht.properties.name||Ht.id||Ht.type,mapboxStyle:!0,feature:Ht});zi.setCoords(ni),this.tb.add(zi,Ht.layer.id),Ht.tooltip=zi,Ht.tooltip.tooltip.visible=!0},this.removeTooltip=function(Ht){Ht.tooltip&&(Ht.tooltip.visibility=!1,this.tb.remove(Ht.tooltip),Ht.tooltip=null)},pt.onContextMenu=function(Ht){alert("contextMenu")},this.onClick=function(Ht){let ni,zi=[];if(pt.tb.enableSelectingObjects&&(zi=this.tb.queryRenderedFeatures(Ht.point)),ni=typeof zi[0]=="object",ni){let Hi=ti.prototype.findParent3DObject(zi[0]);if(Hi){if(this.selectedFeature&&this.unselectFeature(this.selectedFeature),!this.selectedObject)this.selectedObject=Hi,this.selectedObject.selected=!0;else if(this.selectedObject.uuid!=Hi.uuid)this.selectedObject.selected=!1,Hi.selected=!0,this.selectedObject=Hi;else if(this.selectedObject.uuid==Hi.uuid){this.unselectObject();return}this.selectedObject.dispatchEvent({type:"Wireframed",detail:this.selectedObject}),this.selectedObject.dispatchEvent({type:"IsPlayingChanged",detail:this.selectedObject}),this.repaint=!0,Ht.preventDefault()}}else{let Hi=[];if(pt.tb.enableSelectingFeatures&&(Hi=this.queryRenderedFeatures(Ht.point)),Hi.length>0&&Hi[0].layer.type=="fill-extrusion"&&typeof Hi[0].id<"u"){if(this.selectedObject&&this.unselectObject(),!this.selectedFeature)this.selectFeature(Hi[0]);else if(this.selectedFeature.id!=Hi[0].id)this.unselectFeature(this.selectedFeature),this.selectFeature(Hi[0]);else if(this.selectedFeature.id==Hi[0].id){this.unselectFeature(this.selectedFeature);return}}}},this.onMouseMove=function(Ht){let ni=we(Ht);if(this.getCanvasContainer().style.cursor=this.tb.defaultCursor,Ht.originalEvent.altKey&&this.draggedObject){if(!pt.tb.enableRotatingObjects)return;et="rotate",this.getCanvasContainer().style.cursor="move",Math.min(qe.x,ni.x),Math.max(qe.x,ni.x),Math.min(qe.y,ni.y),Math.max(qe.y,ni.y);let on={x:0,y:0,z:Math.round(le[2]+~~((ni.x-qe.x)/this.tb.rotationStep)%360*this.tb.rotationStep%360)};this.draggedObject.setRotation(on),pt.tb.enableHelpTooltips&&this.draggedObject.addHelp("rot: "+on.z+"&#176;");return}if(Ht.originalEvent.shiftKey&&this.draggedObject){if(!pt.tb.enableDraggingObjects)return;et="translate",this.getCanvasContainer().style.cursor="move";let on=Ht.lngLat,mn=[Number((on.lng+lt).toFixed(this.tb.gridStep)),Number((on.lat+vt).toFixed(this.tb.gridStep)),this.draggedObject.modelHeight];this.draggedObject.setCoords(mn),pt.tb.enableHelpTooltips&&this.draggedObject.addHelp("lng: "+mn[0]+"&#176;, lat: "+mn[1]+"&#176;");return}if(Ht.originalEvent.ctrlKey&&this.draggedObject){if(!pt.tb.enableDraggingObjects)return;et="altitude",this.getCanvasContainer().style.cursor="move";let on=Ht.point.y*this.tb.altitudeStep,mn=[this.draggedObject.coordinates[0],this.draggedObject.coordinates[1],Number((-on-Jt).toFixed(this.tb.gridStep))];this.draggedObject.setCoords(mn),pt.tb.enableHelpTooltips&&this.draggedObject.addHelp("alt: "+mn[2]+"m");return}let zi,Hi=[];if(pt.tb.enableSelectingObjects&&(Hi=this.tb.queryRenderedFeatures(Ht.point)),zi=typeof Hi[0]=="object",zi){let on=ti.prototype.findParent3DObject(Hi[0]);on&&(this.outFeature(this.overedFeature),this.getCanvasContainer().style.cursor="pointer",!this.selectedObject||on.uuid!=this.selectedObject.uuid?(this.overedObject&&this.overedObject.uuid!=on.uuid&&this.outObject(),on.over=!0,this.overedObject=on):this.selectedObject&&on.uuid==this.selectedObject.uuid&&(on.over=!0,this.overedObject=on),this.repaint=!0,Ht.preventDefault())}else{this.overedObject&&this.outObject();let on=[];pt.tb.enableSelectingFeatures&&(on=this.queryRenderedFeatures(Ht.point)),on.length>0&&(this.outFeature(on[0]),on[0].layer.type=="fill-extrusion"&&typeof on[0].id<"u"&&(!this.selectedFeature||this.selectedFeature.id!=on[0].id)&&(this.getCanvasContainer().style.cursor="pointer",this.overedFeature=on[0],this.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!0}),this.overedFeature=pt.queryRenderedFeatures({layers:[this.overedFeature.layer.id],filter:["==",["id"],this.overedFeature.id]})[0],this.addTooltip(this.overedFeature)))}},this.onMouseDown=function(Ht){(Ht.originalEvent.shiftKey||Ht.originalEvent.altKey||Ht.originalEvent.ctrlKey)&&Ht.originalEvent.button===0&&this.selectedObject&&(!pt.tb.enableDraggingObjects&&!pt.tb.enableRotatingObjects||(Ht.preventDefault(),pt.getCanvasContainer().style.cursor="move",pt.once("mouseup",this.onMouseUp),this.draggedObject=this.selectedObject,qe=we(Ht),gt=this.draggedObject.coordinates,le=D.degreeify(this.draggedObject.rotation),lt=gt[0]-Ht.lngLat.lng,vt=gt[1]-Ht.lngLat.lat,Jt=-this.draggedObject.modelHeight-Ht.point.y*this.tb.altitudeStep))},this.onMouseUp=function(Ht){this.getCanvasContainer().style.cursor=this.tb.defaultCursor,this.off("mouseup",this.onMouseUp),this.off("mouseout",this.onMouseUp),this.dragPan.enable(),this.draggedObject&&(this.draggedObject.dispatchEvent({type:"ObjectDragged",detail:{draggedObject:this.draggedObject,draggedAction:et}}),this.draggedObject.removeHelp(),this.draggedObject=null,et=null)},this.onMouseOut=function(Ht){if(this.overedFeature){let ni=this.queryRenderedFeatures(Ht.point);ni.length>0&&this.overedFeature.id!=ni[0].id&&(this.getCanvasContainer().style.cursor=this.tb.defaultCursor,this.outFeature(ni[0]))}},this.onZoom=function(Ht){this.tb.zoomLayers.forEach(ni=>{this.tb.toggleLayer(ni)}),this.tb.setObjectsScale()};let xe=!1,De=17,Ce=91,Gt=16,Ft=83;function bt(Ht){Ht.which===De||Ht.which,Ht.which===Gt&&(xe=!0);let ni=this.selectedObject;if(xe&&Ht.which===Ft&&ni){let zi=D.toDecimal;if(ni.help)ni.removeHelp();else{let Hi=ni.modelSize,on=1;ni.userData.units!=="meters"&&(on=D.projectedUnitsPerMeter(ni.coordinates[1]),on||(on=1),on=zi(on,7)),pt.tb.enableHelpTooltips&&ni.addHelp("size(m): "+zi(Hi.x/on,3)+" W, "+zi(Hi.y/on,3)+" L, "+zi(Hi.z/on,3)+" H"),this.repaint=!0}return!1}}function Vt(Ht){Ht.which==De||Ht.which==Ce,Ht.which===Gt&&(xe=!1)}this.on("click",this.onClick),this.on("mousemove",this.onMouseMove),this.on("mouseout",this.onMouseOut),this.on("mousedown",this.onMouseDown),this.on("zoom",this.onZoom),this.on("zoomend",this.onZoom),document.addEventListener("keydown",bt.bind(this),!0),document.addEventListener("keyup",Vt.bind(this))})},get sky(){return this.options.sky},set sky(pt){pt?this.createSkyLayer():this.removeLayer(this.skyLayerName),this.options.sky=pt},get terrain(){return this.options.terrain},set terrain(pt){if(this.terrainLayerName="",pt)this.createTerrainLayer();else{if(this.mapboxVersion<2){console.warn("Terrain layer are only supported by Mapbox-gl-js > v2.0");return}this.map.getTerrain()&&(this.map.setTerrain(null),this.map.removeSource(this.terrainSourceName))}this.options.terrain=pt},get fov(){return this.options.fov},set fov(pt){this.camera instanceof l.PerspectiveCamera&&this.options.fov!==pt&&(this.map.transform.fov=pt,this.camera.fov=this.map.transform.fov,this.cameraSync.setupCamera(),this.map.repaint=!0,this.options.fov=pt)},get orthographic(){return this.options.orthographic},set orthographic(pt){const Tt=this.map.getCanvas().clientHeight,Fe=this.map.getCanvas().clientWidth;pt?(this.map.transform.fov=0,this.camera=new l.OrthographicCamera(Fe/-2,Fe/2,Tt/2,Tt/-2,.1,1e21)):(this.map.transform.fov=this.fov,this.camera=new l.PerspectiveCamera(this.map.transform.fov,Fe/Tt,.1,1e21)),this.camera.layers.enable(0),this.camera.layers.enable(1),this.cameraSync=new E(this.map,this.camera,this.world),this.map.repaint=!0,this.options.orthographic=pt},createSkyLayer:function(){if(this.mapboxVersion<2){console.warn("Sky layer are only supported by Mapbox-gl-js > v2.0"),this.options.sky=!1;return}this.map.getLayer(this.skyLayerName)||(this.map.addLayer({id:this.skyLayerName,type:"sky",paint:{"sky-opacity":["interpolate",["linear"],["zoom"],0,0,5,.3,8,1],"sky-type":"atmosphere","sky-atmosphere-sun":this.getSunSky(this.lightDateTime),"sky-atmosphere-sun-intensity":10}}),this.map.once("idle",()=>{this.setSunlight(),this.repaint()}))},createTerrainLayer:function(){if(this.mapboxVersion<2){console.warn("Terrain layer are only supported by Mapbox-gl-js > v2.0"),this.options.terrain=!1;return}this.map.getTerrain()||(this.map.addSource(this.terrainSourceName,{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),this.map.setTerrain({source:this.terrainSourceName,exaggeration:this.terrainExaggeration}),this.map.once("idle",()=>{this.cameraSync.updateCamera(),this.repaint()}))},sphere:function(pt){return this.setDefaultView(pt,this.options),$(pt,this.world)},line:it,label:ve,tooltip:ze,tube:function(pt){return this.setDefaultView(pt,this.options),xt(pt,this.world)},extrusion:function(pt){return this.setDefaultView(pt,this.options),ne(pt)},Object3D:function(pt){return this.setDefaultView(pt,this.options),yt(pt)},loadObj:async function(Tt,Fe){if(this.setDefaultView(Tt,this.options),Tt.clone===!1)return new Promise(async et=>{ke(Tt,Fe,async Xe=>{et(Xe)})});{let et=this.objectsCache.get(Tt.obj);et?et.promise.then(Xe=>{Fe(Xe.duplicate(Tt))}).catch(Xe=>{this.objectsCache.delete(Tt.obj),console.error("Could not load model file: "+Tt.obj)}):this.objectsCache.set(Tt.obj,{promise:new Promise(async(Xe,qe)=>{ke(Tt,Fe,async gt=>{gt.duplicate?Xe(gt.duplicate()):qe(gt)})})})}},material:function(pt){return X(pt)},initLights:{ambientLight:null,dirLight:null,dirLightBack:null,dirLightHelper:null,hemiLight:null,pointLight:null},utils:D,SunCalc:N,Constants:B,projectToWorld:function(pt){return this.utils.projectToWorld(pt)},unprojectFromWorld:function(pt){return this.utils.unprojectFromWorld(pt)},projectedUnitsPerMeter:function(pt){return this.utils.projectedUnitsPerMeter(pt)},getFeatureCenter:function(Tt,Fe,et){return D.getFeatureCenter(Tt,Fe,et)},getObjectHeightOnFloor:function(pt,Tt,Fe){return D.getObjectHeightOnFloor(pt,Tt,Fe)},queryRenderedFeatures:function(pt){let Tt=new l.Vector2;return Tt.x=pt.x/this.map.transform.width*2-1,Tt.y=1-pt.y/this.map.transform.height*2,this.raycaster.setFromCamera(Tt,this.camera),this.raycaster.intersectObjects(this.world.children,!0)},findParent3DObject:function(pt){var Tt;return pt.object.traverseAncestors(function(Fe){Fe.parent&&Fe.parent.type=="Group"&&Fe.userData.obj&&(Tt=Fe)}),Tt},setLayoutProperty:function(pt,Tt,Fe){this.map.setLayoutProperty(pt,Tt,Fe),Fe!=null&&Tt==="visibility"&&this.world.children.filter(et=>et.layer===pt).forEach(et=>{et.visibility=Fe})},setLayerZoomRange:function(pt,Tt,Fe){this.map.getLayer(pt)&&(this.map.setLayerZoomRange(pt,Tt,Fe),this.zoomLayers.includes(pt)||this.zoomLayers.push(pt),this.toggleLayer(pt))},setLayerHeigthProperty:function(pt,Tt){let Fe=this.map.getLayer(pt);if(Fe)if(Fe.type=="fill-extrusion"){let et=this.map.getStyle().sources[Fe.source].data;et.features.forEach(function(qe){qe.properties.level=Tt}),this.map.getSource(Fe.source).setData(et)}else Fe.type=="custom"&&this.world.children.forEach(function(et){let Xe=et.userData.feature;if(Xe&&Xe.layer===pt){let qe=this.tb.getFeatureCenter(Xe,et,Tt);et.setCoords(qe)}})},setObjectsScale:function(){this.world.children.filter(pt=>pt.fixedZoom!=null).forEach(pt=>{pt.setObjectScale(this.map.transform.scale)})},setStyle:function(pt,Tt){this.clear().then(()=>{this.map.setStyle(pt,Tt)})},toggleLayer:function(pt,Tt=!0){let Fe=this.map.getLayer(pt);if(Fe){if(!Tt){this.toggle(Fe.id,!1);return}let et=this.map.getZoom();if(Fe.minzoom&&et<Fe.minzoom){this.toggle(Fe.id,!1);return}if(Fe.maxzoom&&et>=Fe.maxzoom){this.toggle(Fe.id,!1);return}this.toggle(Fe.id,!0)}},toggle:function(pt,Tt){this.setLayoutProperty(pt,"visibility",Tt?"visible":"none"),this.labelRenderer.toggleLabels(pt,Tt)},update:function(){this.map.repaint&&(this.map.repaint=!1);var pt=Date.now();this.objects.animationManager.update(pt),this.updateLightHelper(),this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.labelRenderer.render(this.scene,this.camera),this.options.passiveRendering===!1&&this.map.triggerRepaint()},add:function(pt,Tt,Fe){if(!this.enableTooltips&&pt.tooltip&&(pt.tooltip.visibility=!1),this.world.add(pt),Tt){pt.layer=Tt,pt.source=Fe;let et=this.map.getLayer(Tt);if(et){let Xe=et.visibility,qe=typeof Xe>"u";pt.visibility=!!(qe||Xe==="visible")}}},removeByName:function(pt){let Tt=this.world.getObjectByName(pt);Tt&&this.remove(Tt)},remove:function(pt){this.map.selectedObject&&pt.uuid==this.map.selectedObject.uuid&&this.map.unselectObject(),this.map.draggedObject&&pt.uuid==this.map.draggedObject.uuid&&(this.map.draggedObject=null),pt.dispose&&pt.dispose(),this.world.remove(pt),pt=null},clear:async function(pt=null,Tt=!1){return new Promise((Fe,et)=>{let Xe=[];this.world.children.forEach(function(qe){Xe.push(qe)});for(let qe=0;qe<Xe.length;qe++){let gt=Xe[qe];(gt.layer===pt||!pt)&&this.remove(gt)}Tt&&this.objectsCache.forEach(qe=>{qe.promise.then(gt=>{gt.dispose(),gt=null})}),Fe("clear")})},removeLayer:function(pt){this.clear(pt,!0).then(()=>{this.map.removeLayer(pt)})},getSunPosition:function(pt,Tt){return N.getPosition(pt||Date.now(),Tt[1],Tt[0])},getSunTimes:function(pt,Tt){return N.getTimes(pt,Tt[1],Tt[0],Tt[2]?Tt[2]:0)},setBuildingShadows:function(pt){if(this.map.getLayer(pt.buildingsLayerId)){let Tt=new st(pt,this);this.map.addLayer(Tt,pt.buildingsLayerId)}else console.warn("The layer '"+pt.buildingsLayerId+"' does not exist in the map.")},setSunlight:function(pt=new Date,Tt){if(!this.lights.dirLight||!this.options.realSunlight){console.warn("To use setSunlight it's required to set realSunlight : true in Threebox initial options.");return}var Fe=new Date(pt.getTime());if(Tt?Tt.lng&&Tt.lat?this.mapCenter=Tt:this.mapCenter={lng:Tt[0],lat:Tt[1]}:this.mapCenter=this.map.getCenter(),this.lightDateTime&&this.lightDateTime.getTime()===Fe.getTime()&&this.lightLng===this.mapCenter.lng&&this.lightLat===this.mapCenter.lat)return;this.lightDateTime=Fe,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition=this.getSunPosition(Fe,[this.mapCenter.lng,this.mapCenter.lat]);let et=this.sunPosition.altitude,Xe=Math.PI+this.sunPosition.azimuth,qe=B.WORLD_SIZE/2,gt=Math.sin(et),lt=Math.cos(et),vt=Math.cos(Xe)*lt,Jt=Math.sin(Xe)*lt;this.lights.dirLight.position.set(Jt,vt,gt),this.lights.dirLight.position.multiplyScalar(qe),this.lights.dirLight.intensity=Math.max(gt,0),this.lights.hemiLight.intensity=Math.max(gt*1,.1),this.lights.dirLight.updateMatrixWorld(),this.updateLightHelper(),this.map.loaded()&&(this.updateSunGround(this.sunPosition),this.map.setLight({anchor:"map",position:[3,180+this.sunPosition.azimuth*180/Math.PI,90-this.sunPosition.altitude*180/Math.PI],intensity:Math.cos(this.sunPosition.altitude),color:`hsl(40, ${50*Math.cos(this.sunPosition.altitude)}%, ${Math.max(20,20+96*Math.sin(this.sunPosition.altitude))}%)`},{duration:0}),this.sky&&this.updateSunSky(this.getSunSky(Fe,this.sunPosition)))},getSunSky:function(pt,Tt){if(!Tt){var Fe=this.map.getCenter();Tt=this.getSunPosition(pt||Date.now(),[Fe.lng,Fe.lat])}var et=180+Tt.azimuth*180/Math.PI,Xe=90-Tt.altitude*180/Math.PI;return[et,Xe]},updateSunSky:function(pt){this.sky&&this.map.setPaintProperty(this.skyLayerName,"sky-atmosphere-sun",pt)},updateSunGround:function(pt){this.terrainLayerName!=""&&this.map.setPaintProperty(this.terrainLayerName,"raster-opacity",Math.max(Math.min(1,pt.altitude*4),.25))},updateLightHelper:function(){this.lights.dirLightHelper&&(this.lights.dirLightHelper.position.setFromMatrixPosition(this.lights.dirLight.matrixWorld),this.lights.dirLightHelper.updateMatrix(),this.lights.dirLightHelper.update())},dispose:async function(){return console.log(this.memory()),new Promise(pt=>{pt(this.clear(null,!0).then(Tt=>(this.map.remove(),this.map={},this.scene.remove(this.world),this.world.children=[],this.world=null,this.objectsCache.clear(),this.labelRenderer.dispose(),console.log(this.memory()),this.renderer.dispose(),Tt)))})},defaultLights:function(){this.lights.ambientLight=new l.AmbientLight(new l.Color("hsl(0, 0%, 100%)"),.75),this.scene.add(this.lights.ambientLight),this.lights.dirLightBack=new l.DirectionalLight(new l.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLightBack.position.set(30,100,100),this.scene.add(this.lights.dirLightBack),this.lights.dirLight=new l.DirectionalLight(new l.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLight.position.set(-30,100,-100),this.scene.add(this.lights.dirLight)},realSunlight:function(pt=!1){this.renderer.shadowMap.enabled=!0,this.lights.dirLight=new l.DirectionalLight(16777215,1),this.scene.add(this.lights.dirLight),pt&&(this.lights.dirLightHelper=new l.DirectionalLightHelper(this.lights.dirLight,5),this.scene.add(this.lights.dirLightHelper));let Tt=1e3,Fe=2,et=8192;this.lights.dirLight.castShadow=!0,this.lights.dirLight.shadow.radius=Fe,this.lights.dirLight.shadow.mapSize.width=et,this.lights.dirLight.shadow.mapSize.height=et,this.lights.dirLight.shadow.camera.top=this.lights.dirLight.shadow.camera.right=Tt,this.lights.dirLight.shadow.camera.bottom=this.lights.dirLight.shadow.camera.left=-Tt,this.lights.dirLight.shadow.camera.near=1,this.lights.dirLight.shadow.camera.visible=!0,this.lights.dirLight.shadow.camera.far=4e8,this.lights.hemiLight=new l.HemisphereLight(new l.Color(16777215),new l.Color(16777215),.6),this.lights.hemiLight.color.setHSL(.661,.96,.12),this.lights.hemiLight.groundColor.setHSL(.11,.96,.14),this.lights.hemiLight.position.set(0,0,50),this.scene.add(this.lights.hemiLight),this.setSunlight(),this.map.once("idle",()=>{this.setSunlight(),this.repaint()})},setDefaultView:function(pt,Tt){pt.bbox=(pt.bbox||pt.bbox==null)&&Tt.enableSelectingObjects,pt.tooltip=(pt.tooltip||pt.tooltip==null)&&Tt.enableTooltips,pt.mapScale=this.map.transform.scale},memory:function(){return this.renderer.info.memory},programs:function(){return this.renderer.info.programs.length},version:"2.2.7"};var mt={defaultLights:!1,realSunlight:!1,realSunlightHelper:!1,passiveRendering:!0,preserveDrawingBuffer:!1,enableSelectingFeatures:!1,enableSelectingObjects:!1,enableDraggingObjects:!1,enableRotatingObjects:!1,enableTooltips:!1,enableHelpTooltips:!1,multiLayer:!1,orthographic:!1,fov:B.FOV_DEGREES,sky:!1,terrain:!1};c.exports=ti}($1)),$1.exports}var lE;function Zk(){return lE||(lE=1,function(c,p){c.exports={Threebox:$k(),THREE:Na()}}(q1)),q1.exports}var Xk=Zk();const{min:Yk,max:Kk}=Math,Mm=(c,p=0,l=1)=>Yk(Kk(p,c),l),$w=c=>{c._clipped=!1,c._unclipped=c.slice(0);for(let p=0;p<=3;p++)p<3?((c[p]<0||c[p]>255)&&(c._clipped=!0),c[p]=Mm(c[p],0,255)):p===3&&(c[p]=Mm(c[p],0,1));return c},$3={};for(let c of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])$3[`[object ${c}]`]=c.toLowerCase();function ks(c){return $3[Object.prototype.toString.call(c)]||"object"}const bs=(c,p=null)=>c.length>=3?Array.prototype.slice.call(c):ks(c[0])=="object"&&p?p.split("").filter(l=>c[0][l]!==void 0).map(l=>c[0][l]):c[0].slice(0),c_=c=>{if(c.length<2)return null;const p=c.length-1;return ks(c[p])=="string"?c[p].toLowerCase():null},{PI:mx,min:Z3,max:X3}=Math,lu=c=>Math.round(c*100)/100,uw=c=>Math.round(c*100)/100,Bd=mx*2,vb=mx/3,Jk=mx/180,Qk=180/mx;function Y3(c){return[...c.slice(0,3).reverse(),...c.slice(3)]}const ms={format:{},autodetect:[]};class Vn{constructor(...p){const l=this;if(ks(p[0])==="object"&&p[0].constructor&&p[0].constructor===this.constructor)return p[0];let E=c_(p),D=!1;if(!E){D=!0,ms.sorted||(ms.autodetect=ms.autodetect.sort((N,B)=>B.p-N.p),ms.sorted=!0);for(let N of ms.autodetect)if(E=N.test(...p),E)break}if(ms.format[E]){const N=ms.format[E].apply(null,D?p:p.slice(0,-1));l._rgb=$w(N)}else throw new Error("unknown format: "+p);l._rgb.length===3&&l._rgb.push(1)}toString(){return ks(this.hex)=="function"?this.hex():`[${this._rgb.join(",")}]`}}const e4="3.1.2",Hs=(...c)=>new Vn(...c);Hs.version=e4;const Kg={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},t4=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,i4=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,K3=c=>{if(c.match(t4)){(c.length===4||c.length===7)&&(c=c.substr(1)),c.length===3&&(c=c.split(""),c=c[0]+c[0]+c[1]+c[1]+c[2]+c[2]);const p=parseInt(c,16),l=p>>16,E=p>>8&255,D=p&255;return[l,E,D,1]}if(c.match(i4)){(c.length===5||c.length===9)&&(c=c.substr(1)),c.length===4&&(c=c.split(""),c=c[0]+c[0]+c[1]+c[1]+c[2]+c[2]+c[3]+c[3]);const p=parseInt(c,16),l=p>>24&255,E=p>>16&255,D=p>>8&255,N=Math.round((p&255)/255*100)/100;return[l,E,D,N]}throw new Error(`unknown hex color: ${c}`)},{round:_v}=Math,J3=(...c)=>{let[p,l,E,D]=bs(c,"rgba"),N=c_(c)||"auto";D===void 0&&(D=1),N==="auto"&&(N=D<1?"rgba":"rgb"),p=_v(p),l=_v(l),E=_v(E);let n="000000"+(p<<16|l<<8|E).toString(16);n=n.substr(n.length-6);let X="0"+_v(D*255).toString(16);switch(X=X.substr(X.length-2),N.toLowerCase()){case"rgba":return`#${n}${X}`;case"argb":return`#${X}${n}`;default:return`#${n}`}};Vn.prototype.name=function(){const c=J3(this._rgb,"rgb");for(let p of Object.keys(Kg))if(Kg[p]===c)return p.toLowerCase();return c};ms.format.named=c=>{if(c=c.toLowerCase(),Kg[c])return K3(Kg[c]);throw new Error("unknown color name: "+c)};ms.autodetect.push({p:5,test:(c,...p)=>{if(!p.length&&ks(c)==="string"&&Kg[c.toLowerCase()])return"named"}});Vn.prototype.alpha=function(c,p=!1){return c!==void 0&&ks(c)==="number"?p?(this._rgb[3]=c,this):new Vn([this._rgb[0],this._rgb[1],this._rgb[2],c],"rgb"):this._rgb[3]};Vn.prototype.clipped=function(){return this._rgb._clipped||!1};const Xh={Kn:18,labWhitePoint:"d65",Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452,kE:216/24389,kKE:8,kK:24389/27,RefWhiteRGB:{X:.95047,Y:1,Z:1.08883},MtxRGB2XYZ:{m00:.4124564390896922,m01:.21267285140562253,m02:.0193338955823293,m10:.357576077643909,m11:.715152155287818,m12:.11919202588130297,m20:.18043748326639894,m21:.07217499330655958,m22:.9503040785363679},MtxXYZ2RGB:{m00:3.2404541621141045,m01:-.9692660305051868,m02:.055643430959114726,m10:-1.5371385127977166,m11:1.8760108454466942,m12:-.2040259135167538,m20:-.498531409556016,m21:.041556017530349834,m22:1.0572251882231791},As:.9414285350000001,Bs:1.040417467,Cs:1.089532651,MtxAdaptMa:{m00:.8951,m01:-.7502,m02:.0389,m10:.2664,m11:1.7135,m12:-.0685,m20:-.1614,m21:.0367,m22:1.0296},MtxAdaptMaI:{m00:.9869929054667123,m01:.43230526972339456,m02:-.008528664575177328,m10:-.14705425642099013,m11:.5183602715367776,m12:.04004282165408487,m20:.15996265166373125,m21:.0492912282128556,m22:.9684866957875502}},n4=new Map([["a",[1.0985,.35585]],["b",[1.0985,.35585]],["c",[.98074,1.18232]],["d50",[.96422,.82521]],["d55",[.95682,.92149]],["d65",[.95047,1.08883]],["e",[1,1,1]],["f2",[.99186,.67393]],["f7",[.95041,1.08747]],["f11",[1.00962,.6435]],["icc",[.96422,.82521]]]);function Ud(c){const p=n4.get(String(c).toLowerCase());if(!p)throw new Error("unknown Lab illuminant "+c);Xh.labWhitePoint=c,Xh.Xn=p[0],Xh.Zn=p[1]}function J0(){return Xh.labWhitePoint}const Zw=(...c)=>{c=bs(c,"lab");const[p,l,E]=c,[D,N,B]=r4(p,l,E),[n,X,$]=Q3(D,N,B);return[n,X,$,c.length>3?c[3]:1]},r4=(c,p,l)=>{const{kE:E,kK:D,kKE:N,Xn:B,Yn:n,Zn:X}=Xh,$=(c+16)/116,ne=.002*p+$,ve=$-.005*l,ze=ne*ne*ne,ke=ve*ve*ve,yt=ze>E?ze:(116*ne-16)/D,it=c>N?Math.pow((c+16)/116,3):c/D,xt=ke>E?ke:(116*ve-16)/D,Ze=yt*B,st=it*n,ti=xt*X;return[Ze,st,ti]},xb=c=>{const p=Math.sign(c);return c=Math.abs(c),(c<=.0031308?c*12.92:1.055*Math.pow(c,1/2.4)-.055)*p},Q3=(c,p,l)=>{const{MtxAdaptMa:E,MtxAdaptMaI:D,MtxXYZ2RGB:N,RefWhiteRGB:B,Xn:n,Yn:X,Zn:$}=Xh,ne=n*E.m00+X*E.m10+$*E.m20,ve=n*E.m01+X*E.m11+$*E.m21,ze=n*E.m02+X*E.m12+$*E.m22,ke=B.X*E.m00+B.Y*E.m10+B.Z*E.m20,yt=B.X*E.m01+B.Y*E.m11+B.Z*E.m21,it=B.X*E.m02+B.Y*E.m12+B.Z*E.m22,xt=(c*E.m00+p*E.m10+l*E.m20)*(ke/ne),Ze=(c*E.m01+p*E.m11+l*E.m21)*(yt/ve),st=(c*E.m02+p*E.m12+l*E.m22)*(it/ze),ti=xt*D.m00+Ze*D.m10+st*D.m20,mt=xt*D.m01+Ze*D.m11+st*D.m21,pt=xt*D.m02+Ze*D.m12+st*D.m22,Tt=xb(ti*N.m00+mt*N.m10+pt*N.m20),Fe=xb(ti*N.m01+mt*N.m11+pt*N.m21),et=xb(ti*N.m02+mt*N.m12+pt*N.m22);return[Tt*255,Fe*255,et*255]},Xw=(...c)=>{const[p,l,E,...D]=bs(c,"rgb"),[N,B,n]=eC(p,l,E),[X,$,ne]=s4(N,B,n);return[X,$,ne,...D.length>0&&D[0]<1?[D[0]]:[]]};function s4(c,p,l){const{Xn:E,Yn:D,Zn:N,kE:B,kK:n}=Xh,X=c/E,$=p/D,ne=l/N,ve=X>B?Math.pow(X,1/3):(n*X+16)/116,ze=$>B?Math.pow($,1/3):(n*$+16)/116,ke=ne>B?Math.pow(ne,1/3):(n*ne+16)/116;return[116*ze-16,500*(ve-ze),200*(ze-ke)]}function bb(c){const p=Math.sign(c);return c=Math.abs(c),(c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4))*p}const eC=(c,p,l)=>{c=bb(c/255),p=bb(p/255),l=bb(l/255);const{MtxRGB2XYZ:E,MtxAdaptMa:D,MtxAdaptMaI:N,Xn:B,Yn:n,Zn:X,As:$,Bs:ne,Cs:ve}=Xh;let ze=c*E.m00+p*E.m10+l*E.m20,ke=c*E.m01+p*E.m11+l*E.m21,yt=c*E.m02+p*E.m12+l*E.m22;const it=B*D.m00+n*D.m10+X*D.m20,xt=B*D.m01+n*D.m11+X*D.m21,Ze=B*D.m02+n*D.m12+X*D.m22;let st=ze*D.m00+ke*D.m10+yt*D.m20,ti=ze*D.m01+ke*D.m11+yt*D.m21,mt=ze*D.m02+ke*D.m12+yt*D.m22;return st*=it/$,ti*=xt/ne,mt*=Ze/ve,ze=st*N.m00+ti*N.m10+mt*N.m20,ke=st*N.m01+ti*N.m11+mt*N.m21,yt=st*N.m02+ti*N.m12+mt*N.m22,[ze,ke,yt]};Vn.prototype.lab=function(){return Xw(this._rgb)};const o4=(...c)=>new Vn(...c,"lab");Object.assign(Hs,{lab:o4,getLabWhitePoint:J0,setLabWhitePoint:Ud});ms.format.lab=Zw;ms.autodetect.push({p:2,test:(...c)=>{if(c=bs(c,"lab"),ks(c)==="array"&&c.length===3)return"lab"}});Vn.prototype.darken=function(c=1){const p=this,l=p.lab();return l[0]-=Xh.Kn*c,new Vn(l,"lab").alpha(p.alpha(),!0)};Vn.prototype.brighten=function(c=1){return this.darken(-c)};Vn.prototype.darker=Vn.prototype.darken;Vn.prototype.brighter=Vn.prototype.brighten;Vn.prototype.get=function(c){const[p,l]=c.split("."),E=this[p]();if(l){const D=p.indexOf(l)-(p.substr(0,2)==="ok"?2:0);if(D>-1)return E[D];throw new Error(`unknown channel ${l} in mode ${p}`)}else return E};const{pow:a4}=Math,l4=1e-7,c4=20;Vn.prototype.luminance=function(c,p="rgb"){if(c!==void 0&&ks(c)==="number"){if(c===0)return new Vn([0,0,0,this._rgb[3]],"rgb");if(c===1)return new Vn([255,255,255,this._rgb[3]],"rgb");let l=this.luminance(),E=c4;const D=(B,n)=>{const X=B.interpolate(n,.5,p),$=X.luminance();return Math.abs(c-$)<l4||!E--?X:$>c?D(B,X):D(X,n)},N=(l>c?D(new Vn([0,0,0]),this):D(this,new Vn([255,255,255]))).rgb();return new Vn([...N,this._rgb[3]])}return u4(...this._rgb.slice(0,3))};const u4=(c,p,l)=>(c=wb(c),p=wb(p),l=wb(l),.2126*c+.7152*p+.0722*l),wb=c=>(c/=255,c<=.03928?c/12.92:a4((c+.055)/1.055,2.4)),fl={},Jg=(c,p,l=.5,...E)=>{let D=E[0]||"lrgb";if(!fl[D]&&!E.length&&(D=Object.keys(fl)[0]),!fl[D])throw new Error(`interpolation mode ${D} is not defined`);return ks(c)!=="object"&&(c=new Vn(c)),ks(p)!=="object"&&(p=new Vn(p)),fl[D](c,p,l).alpha(c.alpha()+l*(p.alpha()-c.alpha()))};Vn.prototype.mix=Vn.prototype.interpolate=function(c,p=.5,...l){return Jg(this,c,p,...l)};Vn.prototype.premultiply=function(c=!1){const p=this._rgb,l=p[3];return c?(this._rgb=[p[0]*l,p[1]*l,p[2]*l,l],this):new Vn([p[0]*l,p[1]*l,p[2]*l,l],"rgb")};const{sin:h4,cos:d4}=Math,tC=(...c)=>{let[p,l,E]=bs(c,"lch");return isNaN(E)&&(E=0),E=E*Jk,[p,d4(E)*l,h4(E)*l]},Yw=(...c)=>{c=bs(c,"lch");const[p,l,E]=c,[D,N,B]=tC(p,l,E),[n,X,$]=Zw(D,N,B);return[n,X,$,c.length>3?c[3]:1]},p4=(...c)=>{const p=Y3(bs(c,"hcl"));return Yw(...p)},{sqrt:f4,atan2:m4,round:g4}=Math,iC=(...c)=>{const[p,l,E]=bs(c,"lab"),D=f4(l*l+E*E);let N=(m4(E,l)*Qk+360)%360;return g4(D*1e4)===0&&(N=Number.NaN),[p,D,N]},Kw=(...c)=>{const[p,l,E,...D]=bs(c,"rgb"),[N,B,n]=Xw(p,l,E),[X,$,ne]=iC(N,B,n);return[X,$,ne,...D.length>0&&D[0]<1?[D[0]]:[]]};Vn.prototype.lch=function(){return Kw(this._rgb)};Vn.prototype.hcl=function(){return Y3(Kw(this._rgb))};const _4=(...c)=>new Vn(...c,"lch"),y4=(...c)=>new Vn(...c,"hcl");Object.assign(Hs,{lch:_4,hcl:y4});ms.format.lch=Yw;ms.format.hcl=p4;["lch","hcl"].forEach(c=>ms.autodetect.push({p:2,test:(...p)=>{if(p=bs(p,c),ks(p)==="array"&&p.length===3)return c}}));Vn.prototype.saturate=function(c=1){const p=this,l=p.lch();return l[1]+=Xh.Kn*c,l[1]<0&&(l[1]=0),new Vn(l,"lch").alpha(p.alpha(),!0)};Vn.prototype.desaturate=function(c=1){return this.saturate(-c)};Vn.prototype.set=function(c,p,l=!1){const[E,D]=c.split("."),N=this[E]();if(D){const B=E.indexOf(D)-(E.substr(0,2)==="ok"?2:0);if(B>-1){if(ks(p)=="string")switch(p.charAt(0)){case"+":N[B]+=+p;break;case"-":N[B]+=+p;break;case"*":N[B]*=+p.substr(1);break;case"/":N[B]/=+p.substr(1);break;default:N[B]=+p}else if(ks(p)==="number")N[B]=p;else throw new Error("unsupported value for Color.set");const n=new Vn(N,E);return l?(this._rgb=n._rgb,this):n}throw new Error(`unknown channel ${D} in mode ${E}`)}else return N};Vn.prototype.tint=function(c=.5,...p){return Jg(this,"white",c,...p)};Vn.prototype.shade=function(c=.5,...p){return Jg(this,"black",c,...p)};const v4=(c,p,l)=>{const E=c._rgb,D=p._rgb;return new Vn(E[0]+l*(D[0]-E[0]),E[1]+l*(D[1]-E[1]),E[2]+l*(D[2]-E[2]),"rgb")};fl.rgb=v4;const{sqrt:Tb,pow:Ig}=Math,x4=(c,p,l)=>{const[E,D,N]=c._rgb,[B,n,X]=p._rgb;return new Vn(Tb(Ig(E,2)*(1-l)+Ig(B,2)*l),Tb(Ig(D,2)*(1-l)+Ig(n,2)*l),Tb(Ig(N,2)*(1-l)+Ig(X,2)*l),"rgb")};fl.lrgb=x4;const b4=(c,p,l)=>{const E=c.lab(),D=p.lab();return new Vn(E[0]+l*(D[0]-E[0]),E[1]+l*(D[1]-E[1]),E[2]+l*(D[2]-E[2]),"lab")};fl.lab=b4;const u_=(c,p,l,E)=>{let D,N;E==="hsl"?(D=c.hsl(),N=p.hsl()):E==="hsv"?(D=c.hsv(),N=p.hsv()):E==="hcg"?(D=c.hcg(),N=p.hcg()):E==="hsi"?(D=c.hsi(),N=p.hsi()):E==="lch"||E==="hcl"?(E="hcl",D=c.hcl(),N=p.hcl()):E==="oklch"&&(D=c.oklch().reverse(),N=p.oklch().reverse());let B,n,X,$,ne,ve;(E.substr(0,1)==="h"||E==="oklch")&&([B,X,ne]=D,[n,$,ve]=N);let ze,ke,yt,it;return!isNaN(B)&&!isNaN(n)?(n>B&&n-B>180?it=n-(B+360):n<B&&B-n>180?it=n+360-B:it=n-B,ke=B+l*it):isNaN(B)?isNaN(n)?ke=Number.NaN:(ke=n,(ne==1||ne==0)&&E!="hsv"&&(ze=$)):(ke=B,(ve==1||ve==0)&&E!="hsv"&&(ze=X)),ze===void 0&&(ze=X+l*($-X)),yt=ne+l*(ve-ne),E==="oklch"?new Vn([yt,ze,ke],E):new Vn([ke,ze,yt],E)},nC=(c,p,l)=>u_(c,p,l,"lch");fl.lch=nC;fl.hcl=nC;const w4=c=>{if(ks(c)=="number"&&c>=0&&c<=16777215){const p=c>>16,l=c>>8&255,E=c&255;return[p,l,E,1]}throw new Error("unknown num color: "+c)},T4=(...c)=>{const[p,l,E]=bs(c,"rgb");return(p<<16)+(l<<8)+E};Vn.prototype.num=function(){return T4(this._rgb)};const M4=(...c)=>new Vn(...c,"num");Object.assign(Hs,{num:M4});ms.format.num=w4;ms.autodetect.push({p:5,test:(...c)=>{if(c.length===1&&ks(c[0])==="number"&&c[0]>=0&&c[0]<=16777215)return"num"}});const S4=(c,p,l)=>{const E=c.num(),D=p.num();return new Vn(E+l*(D-E),"num")};fl.num=S4;const{floor:E4}=Math,A4=(...c)=>{c=bs(c,"hcg");let[p,l,E]=c,D,N,B;E=E*255;const n=l*255;if(l===0)D=N=B=E;else{p===360&&(p=0),p>360&&(p-=360),p<0&&(p+=360),p/=60;const X=E4(p),$=p-X,ne=E*(1-l),ve=ne+n*(1-$),ze=ne+n*$,ke=ne+n;switch(X){case 0:[D,N,B]=[ke,ze,ne];break;case 1:[D,N,B]=[ve,ke,ne];break;case 2:[D,N,B]=[ne,ke,ze];break;case 3:[D,N,B]=[ne,ve,ke];break;case 4:[D,N,B]=[ze,ne,ke];break;case 5:[D,N,B]=[ke,ne,ve];break}}return[D,N,B,c.length>3?c[3]:1]},C4=(...c)=>{const[p,l,E]=bs(c,"rgb"),D=Z3(p,l,E),N=X3(p,l,E),B=N-D,n=B*100/255,X=D/(255-B)*100;let $;return B===0?$=Number.NaN:(p===N&&($=(l-E)/B),l===N&&($=2+(E-p)/B),E===N&&($=4+(p-l)/B),$*=60,$<0&&($+=360)),[$,n,X]};Vn.prototype.hcg=function(){return C4(this._rgb)};const L4=(...c)=>new Vn(...c,"hcg");Hs.hcg=L4;ms.format.hcg=A4;ms.autodetect.push({p:1,test:(...c)=>{if(c=bs(c,"hcg"),ks(c)==="array"&&c.length===3)return"hcg"}});const I4=(c,p,l)=>u_(c,p,l,"hcg");fl.hcg=I4;const{cos:Rg}=Math,R4=(...c)=>{c=bs(c,"hsi");let[p,l,E]=c,D,N,B;return isNaN(p)&&(p=0),isNaN(l)&&(l=0),p>360&&(p-=360),p<0&&(p+=360),p/=360,p<1/3?(B=(1-l)/3,D=(1+l*Rg(Bd*p)/Rg(vb-Bd*p))/3,N=1-(B+D)):p<2/3?(p-=1/3,D=(1-l)/3,N=(1+l*Rg(Bd*p)/Rg(vb-Bd*p))/3,B=1-(D+N)):(p-=2/3,N=(1-l)/3,B=(1+l*Rg(Bd*p)/Rg(vb-Bd*p))/3,D=1-(N+B)),D=Mm(E*D*3),N=Mm(E*N*3),B=Mm(E*B*3),[D*255,N*255,B*255,c.length>3?c[3]:1]},{min:P4,sqrt:D4,acos:O4}=Math,z4=(...c)=>{let[p,l,E]=bs(c,"rgb");p/=255,l/=255,E/=255;let D;const N=P4(p,l,E),B=(p+l+E)/3,n=B>0?1-N/B:0;return n===0?D=NaN:(D=(p-l+(p-E))/2,D/=D4((p-l)*(p-l)+(p-E)*(l-E)),D=O4(D),E>l&&(D=Bd-D),D/=Bd),[D*360,n,B]};Vn.prototype.hsi=function(){return z4(this._rgb)};const k4=(...c)=>new Vn(...c,"hsi");Hs.hsi=k4;ms.format.hsi=R4;ms.autodetect.push({p:2,test:(...c)=>{if(c=bs(c,"hsi"),ks(c)==="array"&&c.length===3)return"hsi"}});const F4=(c,p,l)=>u_(c,p,l,"hsi");fl.hsi=F4;const hw=(...c)=>{c=bs(c,"hsl");const[p,l,E]=c;let D,N,B;if(l===0)D=N=B=E*255;else{const n=[0,0,0],X=[0,0,0],$=E<.5?E*(1+l):E+l-E*l,ne=2*E-$,ve=p/360;n[0]=ve+1/3,n[1]=ve,n[2]=ve-1/3;for(let ze=0;ze<3;ze++)n[ze]<0&&(n[ze]+=1),n[ze]>1&&(n[ze]-=1),6*n[ze]<1?X[ze]=ne+($-ne)*6*n[ze]:2*n[ze]<1?X[ze]=$:3*n[ze]<2?X[ze]=ne+($-ne)*(2/3-n[ze])*6:X[ze]=ne;[D,N,B]=[X[0]*255,X[1]*255,X[2]*255]}return c.length>3?[D,N,B,c[3]]:[D,N,B,1]},rC=(...c)=>{c=bs(c,"rgba");let[p,l,E]=c;p/=255,l/=255,E/=255;const D=Z3(p,l,E),N=X3(p,l,E),B=(N+D)/2;let n,X;return N===D?(n=0,X=Number.NaN):n=B<.5?(N-D)/(N+D):(N-D)/(2-N-D),p==N?X=(l-E)/(N-D):l==N?X=2+(E-p)/(N-D):E==N&&(X=4+(p-l)/(N-D)),X*=60,X<0&&(X+=360),c.length>3&&c[3]!==void 0?[X,n,B,c[3]]:[X,n,B]};Vn.prototype.hsl=function(){return rC(this._rgb)};const B4=(...c)=>new Vn(...c,"hsl");Hs.hsl=B4;ms.format.hsl=hw;ms.autodetect.push({p:2,test:(...c)=>{if(c=bs(c,"hsl"),ks(c)==="array"&&c.length===3)return"hsl"}});const N4=(c,p,l)=>u_(c,p,l,"hsl");fl.hsl=N4;const{floor:U4}=Math,V4=(...c)=>{c=bs(c,"hsv");let[p,l,E]=c,D,N,B;if(E*=255,l===0)D=N=B=E;else{p===360&&(p=0),p>360&&(p-=360),p<0&&(p+=360),p/=60;const n=U4(p),X=p-n,$=E*(1-l),ne=E*(1-l*X),ve=E*(1-l*(1-X));switch(n){case 0:[D,N,B]=[E,ve,$];break;case 1:[D,N,B]=[ne,E,$];break;case 2:[D,N,B]=[$,E,ve];break;case 3:[D,N,B]=[$,ne,E];break;case 4:[D,N,B]=[ve,$,E];break;case 5:[D,N,B]=[E,$,ne];break}}return[D,N,B,c.length>3?c[3]:1]},{min:G4,max:H4}=Math,j4=(...c)=>{c=bs(c,"rgb");let[p,l,E]=c;const D=G4(p,l,E),N=H4(p,l,E),B=N-D;let n,X,$;return $=N/255,N===0?(n=Number.NaN,X=0):(X=B/N,p===N&&(n=(l-E)/B),l===N&&(n=2+(E-p)/B),E===N&&(n=4+(p-l)/B),n*=60,n<0&&(n+=360)),[n,X,$]};Vn.prototype.hsv=function(){return j4(this._rgb)};const W4=(...c)=>new Vn(...c,"hsv");Hs.hsv=W4;ms.format.hsv=V4;ms.autodetect.push({p:2,test:(...c)=>{if(c=bs(c,"hsv"),ks(c)==="array"&&c.length===3)return"hsv"}});const q4=(c,p,l)=>u_(c,p,l,"hsv");fl.hsv=q4;function $v(c,p){let l=c.length;Array.isArray(c[0])||(c=[c]),Array.isArray(p[0])||(p=p.map(B=>[B]));let E=p[0].length,D=p[0].map((B,n)=>p.map(X=>X[n])),N=c.map(B=>D.map(n=>Array.isArray(B)?B.reduce((X,$,ne)=>X+$*(n[ne]||0),0):n.reduce((X,$)=>X+$*B,0)));return l===1&&(N=N[0]),E===1?N.map(B=>B[0]):N}const Jw=(...c)=>{c=bs(c,"lab");const[p,l,E,...D]=c,[N,B,n]=$4([p,l,E]),[X,$,ne]=Q3(N,B,n);return[X,$,ne,...D.length>0&&D[0]<1?[D[0]]:[]]};function $4(c){var p=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],l=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],E=$v(l,c);return $v(p,E.map(D=>D**3))}const Qw=(...c)=>{const[p,l,E,...D]=bs(c,"rgb"),N=eC(p,l,E);return[...Z4(N),...D.length>0&&D[0]<1?[D[0]]:[]]};function Z4(c){const p=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],l=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],E=$v(p,c);return $v(l,E.map(D=>Math.cbrt(D)))}Vn.prototype.oklab=function(){return Qw(this._rgb)};const X4=(...c)=>new Vn(...c,"oklab");Object.assign(Hs,{oklab:X4});ms.format.oklab=Jw;ms.autodetect.push({p:2,test:(...c)=>{if(c=bs(c,"oklab"),ks(c)==="array"&&c.length===3)return"oklab"}});const Y4=(c,p,l)=>{const E=c.oklab(),D=p.oklab();return new Vn(E[0]+l*(D[0]-E[0]),E[1]+l*(D[1]-E[1]),E[2]+l*(D[2]-E[2]),"oklab")};fl.oklab=Y4;const K4=(c,p,l)=>u_(c,p,l,"oklch");fl.oklch=K4;const{pow:Mb,sqrt:Sb,PI:Eb,cos:cE,sin:uE,atan2:J4}=Math,Q4=(c,p="lrgb",l=null)=>{const E=c.length;l||(l=Array.from(new Array(E)).map(()=>1));const D=E/l.reduce(function(ve,ze){return ve+ze});if(l.forEach((ve,ze)=>{l[ze]*=D}),c=c.map(ve=>new Vn(ve)),p==="lrgb")return eF(c,l);const N=c.shift(),B=N.get(p),n=[];let X=0,$=0;for(let ve=0;ve<B.length;ve++)if(B[ve]=(B[ve]||0)*l[0],n.push(isNaN(B[ve])?0:l[0]),p.charAt(ve)==="h"&&!isNaN(B[ve])){const ze=B[ve]/180*Eb;X+=cE(ze)*l[0],$+=uE(ze)*l[0]}let ne=N.alpha()*l[0];c.forEach((ve,ze)=>{const ke=ve.get(p);ne+=ve.alpha()*l[ze+1];for(let yt=0;yt<B.length;yt++)if(!isNaN(ke[yt]))if(n[yt]+=l[ze+1],p.charAt(yt)==="h"){const it=ke[yt]/180*Eb;X+=cE(it)*l[ze+1],$+=uE(it)*l[ze+1]}else B[yt]+=ke[yt]*l[ze+1]});for(let ve=0;ve<B.length;ve++)if(p.charAt(ve)==="h"){let ze=J4($/n[ve],X/n[ve])/Eb*180;for(;ze<0;)ze+=360;for(;ze>=360;)ze-=360;B[ve]=ze}else B[ve]=B[ve]/n[ve];return ne/=E,new Vn(B,p).alpha(ne>.99999?1:ne,!0)},eF=(c,p)=>{const l=c.length,E=[0,0,0,0];for(let D=0;D<c.length;D++){const N=c[D],B=p[D]/l,n=N._rgb;E[0]+=Mb(n[0],2)*B,E[1]+=Mb(n[1],2)*B,E[2]+=Mb(n[2],2)*B,E[3]+=n[3]*B}return E[0]=Sb(E[0]),E[1]=Sb(E[1]),E[2]=Sb(E[2]),E[3]>.9999999&&(E[3]=1),new Vn($w(E))},{pow:tF}=Math;function Zv(c){let p="rgb",l=Hs("#ccc"),E=0,D=[0,1],N=[],B=[0,0],n=!1,X=[],$=!1,ne=0,ve=1,ze=!1,ke={},yt=!0,it=1;const xt=function(Fe){if(Fe=Fe||["#fff","#000"],Fe&&ks(Fe)==="string"&&Hs.brewer&&Hs.brewer[Fe.toLowerCase()]&&(Fe=Hs.brewer[Fe.toLowerCase()]),ks(Fe)==="array"){Fe.length===1&&(Fe=[Fe[0],Fe[0]]),Fe=Fe.slice(0);for(let et=0;et<Fe.length;et++)Fe[et]=Hs(Fe[et]);N.length=0;for(let et=0;et<Fe.length;et++)N.push(et/(Fe.length-1))}return pt(),X=Fe},Ze=function(Fe){if(n!=null){const et=n.length-1;let Xe=0;for(;Xe<et&&Fe>=n[Xe];)Xe++;return Xe-1}return 0};let st=Fe=>Fe,ti=Fe=>Fe;const mt=function(Fe,et){let Xe,qe;if(et==null&&(et=!1),isNaN(Fe)||Fe===null)return l;et?qe=Fe:n&&n.length>2?qe=Ze(Fe)/(n.length-2):ve!==ne?qe=(Fe-ne)/(ve-ne):qe=1,qe=ti(qe),et||(qe=st(qe)),it!==1&&(qe=tF(qe,it)),qe=B[0]+qe*(1-B[0]-B[1]),qe=Mm(qe,0,1);const gt=Math.floor(qe*1e4);if(yt&&ke[gt])Xe=ke[gt];else{if(ks(X)==="array")for(let lt=0;lt<N.length;lt++){const vt=N[lt];if(qe<=vt){Xe=X[lt];break}if(qe>=vt&&lt===N.length-1){Xe=X[lt];break}if(qe>vt&&qe<N[lt+1]){qe=(qe-vt)/(N[lt+1]-vt),Xe=Hs.interpolate(X[lt],X[lt+1],qe,p);break}}else ks(X)==="function"&&(Xe=X(qe));yt&&(ke[gt]=Xe)}return Xe};var pt=()=>ke={};xt(c);const Tt=function(Fe){const et=Hs(mt(Fe));return $&&et[$]?et[$]():et};return Tt.classes=function(Fe){if(Fe!=null){if(ks(Fe)==="array")n=Fe,D=[Fe[0],Fe[Fe.length-1]];else{const et=Hs.analyze(D);Fe===0?n=[et.min,et.max]:n=Hs.limits(et,"e",Fe)}return Tt}return n},Tt.domain=function(Fe){if(!arguments.length)return D;ne=Fe[0],ve=Fe[Fe.length-1],N=[];const et=X.length;if(Fe.length===et&&ne!==ve)for(let Xe of Array.from(Fe))N.push((Xe-ne)/(ve-ne));else{for(let Xe=0;Xe<et;Xe++)N.push(Xe/(et-1));if(Fe.length>2){const Xe=Fe.map((gt,lt)=>lt/(Fe.length-1)),qe=Fe.map(gt=>(gt-ne)/(ve-ne));qe.every((gt,lt)=>Xe[lt]===gt)||(ti=gt=>{if(gt<=0||gt>=1)return gt;let lt=0;for(;gt>=qe[lt+1];)lt++;const vt=(gt-qe[lt])/(qe[lt+1]-qe[lt]);return Xe[lt]+vt*(Xe[lt+1]-Xe[lt])})}}return D=[ne,ve],Tt},Tt.mode=function(Fe){return arguments.length?(p=Fe,pt(),Tt):p},Tt.range=function(Fe,et){return xt(Fe),Tt},Tt.out=function(Fe){return $=Fe,Tt},Tt.spread=function(Fe){return arguments.length?(E=Fe,Tt):E},Tt.correctLightness=function(Fe){return Fe==null&&(Fe=!0),ze=Fe,pt(),ze?st=function(et){const Xe=mt(0,!0).lab()[0],qe=mt(1,!0).lab()[0],gt=Xe>qe;let lt=mt(et,!0).lab()[0];const vt=Xe+(qe-Xe)*et;let Jt=lt-vt,le=0,we=1,xe=20;for(;Math.abs(Jt)>.01&&xe-- >0;)(function(){return gt&&(Jt*=-1),Jt<0?(le=et,et+=(we-et)*.5):(we=et,et+=(le-et)*.5),lt=mt(et,!0).lab()[0],Jt=lt-vt})();return et}:st=et=>et,Tt},Tt.padding=function(Fe){return Fe!=null?(ks(Fe)==="number"&&(Fe=[Fe,Fe]),B=Fe,Tt):B},Tt.colors=function(Fe,et){arguments.length<2&&(et="hex");let Xe=[];if(arguments.length===0)Xe=X.slice(0);else if(Fe===1)Xe=[Tt(.5)];else if(Fe>1){const qe=D[0],gt=D[1]-qe;Xe=iF(0,Fe).map(lt=>Tt(qe+lt/(Fe-1)*gt))}else{c=[];let qe=[];if(n&&n.length>2)for(let gt=1,lt=n.length,vt=1<=lt;vt?gt<lt:gt>lt;vt?gt++:gt--)qe.push((n[gt-1]+n[gt])*.5);else qe=D;Xe=qe.map(gt=>Tt(gt))}return Hs[et]&&(Xe=Xe.map(qe=>qe[et]())),Xe},Tt.cache=function(Fe){return Fe!=null?(yt=Fe,Tt):yt},Tt.gamma=function(Fe){return Fe!=null?(it=Fe,Tt):it},Tt.nodata=function(Fe){return Fe!=null?(l=Hs(Fe),Tt):l},Tt}function iF(c,p,l){let E=[],D=c<p,N=p;for(let B=c;D?B<N:B>N;D?B++:B--)E.push(B);return E}const nF=function(c){let p=[1,1];for(let l=1;l<c;l++){let E=[1];for(let D=1;D<=p.length;D++)E[D]=(p[D]||0)+p[D-1];p=E}return p},rF=function(c){let p,l,E,D;if(c=c.map(N=>new Vn(N)),c.length===2)[l,E]=c.map(N=>N.lab()),p=function(N){const B=[0,1,2].map(n=>l[n]+N*(E[n]-l[n]));return new Vn(B,"lab")};else if(c.length===3)[l,E,D]=c.map(N=>N.lab()),p=function(N){const B=[0,1,2].map(n=>(1-N)*(1-N)*l[n]+2*(1-N)*N*E[n]+N*N*D[n]);return new Vn(B,"lab")};else if(c.length===4){let N;[l,E,D,N]=c.map(B=>B.lab()),p=function(B){const n=[0,1,2].map(X=>(1-B)*(1-B)*(1-B)*l[X]+3*(1-B)*(1-B)*B*E[X]+3*(1-B)*B*B*D[X]+B*B*B*N[X]);return new Vn(n,"lab")}}else if(c.length>=5){let N,B,n;N=c.map(X=>X.lab()),n=c.length-1,B=nF(n),p=function(X){const $=1-X,ne=[0,1,2].map(ve=>N.reduce((ze,ke,yt)=>ze+B[yt]*$**(n-yt)*X**yt*ke[ve],0));return new Vn(ne,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return p},sF=c=>{const p=rF(c);return p.scale=()=>Zv(p),p},{round:sC}=Math;Vn.prototype.rgb=function(c=!0){return c===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(sC)};Vn.prototype.rgba=function(c=!0){return this._rgb.slice(0,4).map((p,l)=>l<3?c===!1?p:sC(p):p)};const oF=(...c)=>new Vn(...c,"rgb");Object.assign(Hs,{rgb:oF});ms.format.rgb=(...c)=>{const p=bs(c,"rgba");return p[3]===void 0&&(p[3]=1),p};ms.autodetect.push({p:3,test:(...c)=>{if(c=bs(c,"rgba"),ks(c)==="array"&&(c.length===3||c.length===4&&ks(c[3])=="number"&&c[3]>=0&&c[3]<=1))return"rgb"}});const Ku=(c,p,l)=>{if(!Ku[l])throw new Error("unknown blend mode "+l);return Ku[l](c,p)},of=c=>(p,l)=>{const E=Hs(l).rgb(),D=Hs(p).rgb();return Hs.rgb(c(E,D))},af=c=>(p,l)=>{const E=[];return E[0]=c(p[0],l[0]),E[1]=c(p[1],l[1]),E[2]=c(p[2],l[2]),E},aF=c=>c,lF=(c,p)=>c*p/255,cF=(c,p)=>c>p?p:c,uF=(c,p)=>c>p?c:p,hF=(c,p)=>255*(1-(1-c/255)*(1-p/255)),dF=(c,p)=>p<128?2*c*p/255:255*(1-2*(1-c/255)*(1-p/255)),pF=(c,p)=>255*(1-(1-p/255)/(c/255)),fF=(c,p)=>c===255?255:(c=255*(p/255)/(1-c/255),c>255?255:c);Ku.normal=of(af(aF));Ku.multiply=of(af(lF));Ku.screen=of(af(hF));Ku.overlay=of(af(dF));Ku.darken=of(af(cF));Ku.lighten=of(af(uF));Ku.dodge=of(af(fF));Ku.burn=of(af(pF));const{pow:mF,sin:gF,cos:_F}=Math;function yF(c=300,p=-1.5,l=1,E=1,D=[0,1]){let N=0,B;ks(D)==="array"?B=D[1]-D[0]:(B=0,D=[D,D]);const n=function(X){const $=Bd*((c+120)/360+p*X),ne=mF(D[0]+B*X,E),ze=(N!==0?l[0]+X*N:l)*ne*(1-ne)/2,ke=_F($),yt=gF($),it=ne+ze*(-.14861*ke+1.78277*yt),xt=ne+ze*(-.29227*ke-.90649*yt),Ze=ne+ze*(1.97294*ke);return Hs($w([it*255,xt*255,Ze*255,1]))};return n.start=function(X){return X==null?c:(c=X,n)},n.rotations=function(X){return X==null?p:(p=X,n)},n.gamma=function(X){return X==null?E:(E=X,n)},n.hue=function(X){return X==null?l:(l=X,ks(l)==="array"?(N=l[1]-l[0],N===0&&(l=l[1])):N=0,n)},n.lightness=function(X){return X==null?D:(ks(X)==="array"?(D=X,B=X[1]-X[0]):(D=[X,X],B=0),n)},n.scale=()=>Hs.scale(n),n.hue(l),n}const vF="0123456789abcdef",{floor:xF,random:bF}=Math,wF=()=>{let c="#";for(let p=0;p<6;p++)c+=vF.charAt(xF(bF()*16));return new Vn(c,"hex")},{log:hE,pow:TF,floor:MF,abs:SF}=Math;function oC(c,p=null){const l={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return ks(c)==="object"&&(c=Object.values(c)),c.forEach(E=>{p&&ks(E)==="object"&&(E=E[p]),E!=null&&!isNaN(E)&&(l.values.push(E),l.sum+=E,E<l.min&&(l.min=E),E>l.max&&(l.max=E),l.count+=1)}),l.domain=[l.min,l.max],l.limits=(E,D)=>aC(l,E,D),l}function aC(c,p="equal",l=7){ks(c)=="array"&&(c=oC(c));const{min:E,max:D}=c,N=c.values.sort((n,X)=>n-X);if(l===1)return[E,D];const B=[];if(p.substr(0,1)==="c"&&(B.push(E),B.push(D)),p.substr(0,1)==="e"){B.push(E);for(let n=1;n<l;n++)B.push(E+n/l*(D-E));B.push(D)}else if(p.substr(0,1)==="l"){if(E<=0)throw new Error("Logarithmic scales are only possible for values > 0");const n=Math.LOG10E*hE(E),X=Math.LOG10E*hE(D);B.push(E);for(let $=1;$<l;$++)B.push(TF(10,n+$/l*(X-n)));B.push(D)}else if(p.substr(0,1)==="q"){B.push(E);for(let n=1;n<l;n++){const X=(N.length-1)*n/l,$=MF(X);if($===X)B.push(N[$]);else{const ne=X-$;B.push(N[$]*(1-ne)+N[$+1]*ne)}}B.push(D)}else if(p.substr(0,1)==="k"){let n;const X=N.length,$=new Array(X),ne=new Array(l);let ve=!0,ze=0,ke=null;ke=[],ke.push(E);for(let xt=1;xt<l;xt++)ke.push(E+xt/l*(D-E));for(ke.push(D);ve;){for(let Ze=0;Ze<l;Ze++)ne[Ze]=0;for(let Ze=0;Ze<X;Ze++){const st=N[Ze];let ti=Number.MAX_VALUE,mt;for(let pt=0;pt<l;pt++){const Tt=SF(ke[pt]-st);Tt<ti&&(ti=Tt,mt=pt),ne[mt]++,$[Ze]=mt}}const xt=new Array(l);for(let Ze=0;Ze<l;Ze++)xt[Ze]=null;for(let Ze=0;Ze<X;Ze++)n=$[Ze],xt[n]===null?xt[n]=N[Ze]:xt[n]+=N[Ze];for(let Ze=0;Ze<l;Ze++)xt[Ze]*=1/ne[Ze];ve=!1;for(let Ze=0;Ze<l;Ze++)if(xt[Ze]!==ke[Ze]){ve=!0;break}ke=xt,ze++,ze>200&&(ve=!1)}const yt={};for(let xt=0;xt<l;xt++)yt[xt]=[];for(let xt=0;xt<X;xt++)n=$[xt],yt[n].push(N[xt]);let it=[];for(let xt=0;xt<l;xt++)it.push(yt[xt][0]),it.push(yt[xt][yt[xt].length-1]);it=it.sort((xt,Ze)=>xt-Ze),B.push(it[0]);for(let xt=1;xt<it.length;xt+=2){const Ze=it[xt];!isNaN(Ze)&&B.indexOf(Ze)===-1&&B.push(Ze)}}return B}const EF=(c,p)=>{c=new Vn(c),p=new Vn(p);const l=c.luminance(),E=p.luminance();return l>E?(l+.05)/(E+.05):(E+.05)/(l+.05)};/**
 * @license
 *
 * The APCA contrast prediction algorithm is based of the formulas published
 * in the APCA-1.0.98G specification by Myndex. The specification is available at:
 * https://raw.githubusercontent.com/Myndex/apca-w3/master/images/APCAw3_0.1.17_APCA0.0.98G.svg
 *
 * Note that the APCA implementation is still beta, so please update to
 * future versions of chroma.js when they become available.
 *
 * You can read more about the APCA Readability Criterion at
 * https://readtech.org/ARC/
 */const dE=.027,AF=5e-4,CF=.1,pE=1.14,yv=.022,fE=1.414,LF=(c,p)=>{c=new Vn(c),p=new Vn(p),c.alpha()<1&&(c=Jg(p,c,c.alpha(),"rgb"));const l=mE(...c.rgb()),E=mE(...p.rgb()),D=l>=yv?l:l+Math.pow(yv-l,fE),N=E>=yv?E:E+Math.pow(yv-E,fE),B=Math.pow(N,.56)-Math.pow(D,.57),n=Math.pow(N,.65)-Math.pow(D,.62),X=Math.abs(N-D)<AF?0:D<N?B*pE:n*pE;return(Math.abs(X)<CF?0:X>0?X-dE:X+dE)*100};function mE(c,p,l){return .2126729*Math.pow(c/255,2.4)+.7151522*Math.pow(p/255,2.4)+.072175*Math.pow(l/255,2.4)}const{sqrt:Od,pow:fa,min:IF,max:RF,atan2:gE,abs:_E,cos:vv,sin:yE,exp:PF,PI:vE}=Math;function DF(c,p,l=1,E=1,D=1){var N=function(Vt){return 360*Vt/(2*vE)},B=function(Vt){return 2*vE*Vt/360};c=new Vn(c),p=new Vn(p);const[n,X,$]=Array.from(c.lab()),[ne,ve,ze]=Array.from(p.lab()),ke=(n+ne)/2,yt=Od(fa(X,2)+fa($,2)),it=Od(fa(ve,2)+fa(ze,2)),xt=(yt+it)/2,Ze=.5*(1-Od(fa(xt,7)/(fa(xt,7)+fa(25,7)))),st=X*(1+Ze),ti=ve*(1+Ze),mt=Od(fa(st,2)+fa($,2)),pt=Od(fa(ti,2)+fa(ze,2)),Tt=(mt+pt)/2,Fe=N(gE($,st)),et=N(gE(ze,ti)),Xe=Fe>=0?Fe:Fe+360,qe=et>=0?et:et+360,gt=_E(Xe-qe)>180?(Xe+qe+360)/2:(Xe+qe)/2,lt=1-.17*vv(B(gt-30))+.24*vv(B(2*gt))+.32*vv(B(3*gt+6))-.2*vv(B(4*gt-63));let vt=qe-Xe;vt=_E(vt)<=180?vt:qe<=Xe?vt+360:vt-360,vt=2*Od(mt*pt)*yE(B(vt)/2);const Jt=ne-n,le=pt-mt,we=1+.015*fa(ke-50,2)/Od(20+fa(ke-50,2)),xe=1+.045*Tt,De=1+.015*Tt*lt,Ce=30*PF(-fa((gt-275)/25,2)),Ft=-(2*Od(fa(Tt,7)/(fa(Tt,7)+fa(25,7))))*yE(2*B(Ce)),bt=Od(fa(Jt/(l*we),2)+fa(le/(E*xe),2)+fa(vt/(D*De),2)+Ft*(le/(E*xe))*(vt/(D*De)));return RF(0,IF(100,bt))}function OF(c,p,l="lab"){c=new Vn(c),p=new Vn(p);const E=c.get(l),D=p.get(l);let N=0;for(let B in E){const n=(E[B]||0)-(D[B]||0);N+=n*n}return Math.sqrt(N)}const zF=(...c)=>{try{return new Vn(...c),!0}catch{return!1}},kF={cool(){return Zv([Hs.hsl(180,1,.9),Hs.hsl(250,.7,.4)])},hot(){return Zv(["#000","#f00","#ff0","#fff"]).mode("rgb")}},dw={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},lC=Object.keys(dw),xE=new Map(lC.map(c=>[c.toLowerCase(),c])),FF=typeof Proxy=="function"?new Proxy(dw,{get(c,p){const l=p.toLowerCase();if(xE.has(l))return c[xE.get(l)]},getOwnPropertyNames(){return Object.getOwnPropertyNames(lC)}}):dw,BF=(...c)=>{c=bs(c,"cmyk");const[p,l,E,D]=c,N=c.length>4?c[4]:1;return D===1?[0,0,0,N]:[p>=1?0:255*(1-p)*(1-D),l>=1?0:255*(1-l)*(1-D),E>=1?0:255*(1-E)*(1-D),N]},{max:bE}=Math,NF=(...c)=>{let[p,l,E]=bs(c,"rgb");p=p/255,l=l/255,E=E/255;const D=1-bE(p,bE(l,E)),N=D<1?1/(1-D):0,B=(1-p-D)*N,n=(1-l-D)*N,X=(1-E-D)*N;return[B,n,X,D]};Vn.prototype.cmyk=function(){return NF(this._rgb)};const UF=(...c)=>new Vn(...c,"cmyk");Object.assign(Hs,{cmyk:UF});ms.format.cmyk=BF;ms.autodetect.push({p:2,test:(...c)=>{if(c=bs(c,"cmyk"),ks(c)==="array"&&c.length===4)return"cmyk"}});const VF=(...c)=>{const p=bs(c,"hsla");let l=c_(c)||"lsa";return p[0]=lu(p[0]||0)+"deg",p[1]=lu(p[1]*100)+"%",p[2]=lu(p[2]*100)+"%",l==="hsla"||p.length>3&&p[3]<1?(p[3]="/ "+(p.length>3?p[3]:1),l="hsla"):p.length=3,`${l.substr(0,3)}(${p.join(" ")})`},GF=(...c)=>{const p=bs(c,"lab");let l=c_(c)||"lab";return p[0]=lu(p[0])+"%",p[1]=lu(p[1]),p[2]=lu(p[2]),l==="laba"||p.length>3&&p[3]<1?p[3]="/ "+(p.length>3?p[3]:1):p.length=3,`lab(${p.join(" ")})`},HF=(...c)=>{const p=bs(c,"lch");let l=c_(c)||"lab";return p[0]=lu(p[0])+"%",p[1]=lu(p[1]),p[2]=isNaN(p[2])?"none":lu(p[2])+"deg",l==="lcha"||p.length>3&&p[3]<1?p[3]="/ "+(p.length>3?p[3]:1):p.length=3,`lch(${p.join(" ")})`},jF=(...c)=>{const p=bs(c,"lab");return p[0]=lu(p[0]*100)+"%",p[1]=uw(p[1]),p[2]=uw(p[2]),p.length>3&&p[3]<1?p[3]="/ "+(p.length>3?p[3]:1):p.length=3,`oklab(${p.join(" ")})`},cC=(...c)=>{const[p,l,E,...D]=bs(c,"rgb"),[N,B,n]=Qw(p,l,E),[X,$,ne]=iC(N,B,n);return[X,$,ne,...D.length>0&&D[0]<1?[D[0]]:[]]},WF=(...c)=>{const p=bs(c,"lch");return p[0]=lu(p[0]*100)+"%",p[1]=uw(p[1]),p[2]=isNaN(p[2])?"none":lu(p[2])+"deg",p.length>3&&p[3]<1?p[3]="/ "+(p.length>3?p[3]:1):p.length=3,`oklch(${p.join(" ")})`},{round:Ab}=Math,qF=(...c)=>{const p=bs(c,"rgba");let l=c_(c)||"rgb";if(l.substr(0,3)==="hsl")return VF(rC(p),l);if(l.substr(0,3)==="lab"){const E=J0();Ud("d50");const D=GF(Xw(p),l);return Ud(E),D}if(l.substr(0,3)==="lch"){const E=J0();Ud("d50");const D=HF(Kw(p),l);return Ud(E),D}return l.substr(0,5)==="oklab"?jF(Qw(p)):l.substr(0,5)==="oklch"?WF(cC(p)):(p[0]=Ab(p[0]),p[1]=Ab(p[1]),p[2]=Ab(p[2]),(l==="rgba"||p.length>3&&p[3]<1)&&(p[3]="/ "+(p.length>3?p[3]:1),l="rgba"),`${l.substr(0,3)}(${p.slice(0,l==="rgb"?3:4).join(" ")})`)},uC=(...c)=>{c=bs(c,"lch");const[p,l,E,...D]=c,[N,B,n]=tC(p,l,E),[X,$,ne]=Jw(N,B,n);return[X,$,ne,...D.length>0&&D[0]<1?[D[0]]:[]]},Vd=/((?:-?\d+)|(?:-?\d+(?:\.\d+)?)%|none)/.source,Yu=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%?)|none)/.source,Xv=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%)|none)/.source,hu=/\s*/.source,h_=/\s+/.source,eT=/\s*,\s*/.source,gx=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)(?:deg)?)|none)/.source,d_=/\s*(?:\/\s*((?:[01]|[01]?\.\d+)|\d+(?:\.\d+)?%))?/.source,hC=new RegExp("^rgba?\\("+hu+[Vd,Vd,Vd].join(h_)+d_+"\\)$"),dC=new RegExp("^rgb\\("+hu+[Vd,Vd,Vd].join(eT)+hu+"\\)$"),pC=new RegExp("^rgba\\("+hu+[Vd,Vd,Vd,Yu].join(eT)+hu+"\\)$"),fC=new RegExp("^hsla?\\("+hu+[gx,Xv,Xv].join(h_)+d_+"\\)$"),mC=new RegExp("^hsl?\\("+hu+[gx,Xv,Xv].join(eT)+hu+"\\)$"),gC=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,_C=new RegExp("^lab\\("+hu+[Yu,Yu,Yu].join(h_)+d_+"\\)$"),yC=new RegExp("^lch\\("+hu+[Yu,Yu,gx].join(h_)+d_+"\\)$"),vC=new RegExp("^oklab\\("+hu+[Yu,Yu,Yu].join(h_)+d_+"\\)$"),xC=new RegExp("^oklch\\("+hu+[Yu,Yu,gx].join(h_)+d_+"\\)$"),{round:bC}=Math,Pg=c=>c.map((p,l)=>l<=2?Mm(bC(p),0,255):p),ma=(c,p=0,l=100,E=!1)=>(typeof c=="string"&&c.endsWith("%")&&(c=parseFloat(c.substring(0,c.length-1))/100,E?c=p+(c+1)*.5*(l-p):c=p+c*(l-p)),+c),zl=(c,p)=>c==="none"?p:c,tT=c=>{if(c=c.toLowerCase().trim(),c==="transparent")return[0,0,0,0];let p;if(ms.format.named)try{return ms.format.named(c)}catch{}if((p=c.match(hC))||(p=c.match(dC))){let l=p.slice(1,4);for(let D=0;D<3;D++)l[D]=+ma(zl(l[D],0),0,255);l=Pg(l);const E=p[4]!==void 0?+ma(p[4],0,1):1;return l[3]=E,l}if(p=c.match(pC)){const l=p.slice(1,5);for(let E=0;E<4;E++)l[E]=+ma(l[E],0,255);return l}if((p=c.match(fC))||(p=c.match(mC))){const l=p.slice(1,4);l[0]=+zl(l[0].replace("deg",""),0),l[1]=+ma(zl(l[1],0),0,100)*.01,l[2]=+ma(zl(l[2],0),0,100)*.01;const E=Pg(hw(l)),D=p[4]!==void 0?+ma(p[4],0,1):1;return E[3]=D,E}if(p=c.match(gC)){const l=p.slice(1,4);l[1]*=.01,l[2]*=.01;const E=hw(l);for(let D=0;D<3;D++)E[D]=bC(E[D]);return E[3]=+p[4],E}if(p=c.match(_C)){const l=p.slice(1,4);l[0]=ma(zl(l[0],0),0,100),l[1]=ma(zl(l[1],0),-125,125,!0),l[2]=ma(zl(l[2],0),-125,125,!0);const E=J0();Ud("d50");const D=Pg(Zw(l));Ud(E);const N=p[4]!==void 0?+ma(p[4],0,1):1;return D[3]=N,D}if(p=c.match(yC)){const l=p.slice(1,4);l[0]=ma(l[0],0,100),l[1]=ma(zl(l[1],0),0,150,!1),l[2]=+zl(l[2].replace("deg",""),0);const E=J0();Ud("d50");const D=Pg(Yw(l));Ud(E);const N=p[4]!==void 0?+ma(p[4],0,1):1;return D[3]=N,D}if(p=c.match(vC)){const l=p.slice(1,4);l[0]=ma(zl(l[0],0),0,1),l[1]=ma(zl(l[1],0),-.4,.4,!0),l[2]=ma(zl(l[2],0),-.4,.4,!0);const E=Pg(Jw(l)),D=p[4]!==void 0?+ma(p[4],0,1):1;return E[3]=D,E}if(p=c.match(xC)){const l=p.slice(1,4);l[0]=ma(zl(l[0],0),0,1),l[1]=ma(zl(l[1],0),0,.4,!1),l[2]=+zl(l[2].replace("deg",""),0);const E=Pg(uC(l)),D=p[4]!==void 0?+ma(p[4],0,1):1;return E[3]=D,E}};tT.test=c=>hC.test(c)||fC.test(c)||_C.test(c)||yC.test(c)||vC.test(c)||xC.test(c)||dC.test(c)||pC.test(c)||mC.test(c)||gC.test(c)||c==="transparent";Vn.prototype.css=function(c){return qF(this._rgb,c)};const $F=(...c)=>new Vn(...c,"css");Hs.css=$F;ms.format.css=tT;ms.autodetect.push({p:5,test:(c,...p)=>{if(!p.length&&ks(c)==="string"&&tT.test(c))return"css"}});ms.format.gl=(...c)=>{const p=bs(c,"rgba");return p[0]*=255,p[1]*=255,p[2]*=255,p};const ZF=(...c)=>new Vn(...c,"gl");Hs.gl=ZF;Vn.prototype.gl=function(){const c=this._rgb;return[c[0]/255,c[1]/255,c[2]/255,c[3]]};Vn.prototype.hex=function(c){return J3(this._rgb,c)};const XF=(...c)=>new Vn(...c,"hex");Hs.hex=XF;ms.format.hex=K3;ms.autodetect.push({p:4,test:(c,...p)=>{if(!p.length&&ks(c)==="string"&&[3,4,5,6,7,8,9].indexOf(c.length)>=0)return"hex"}});const{log:xv}=Math,wC=c=>{const p=c/100;let l,E,D;return p<66?(l=255,E=p<6?0:-155.25485562709179-.44596950469579133*(E=p-2)+104.49216199393888*xv(E),D=p<20?0:-254.76935184120902+.8274096064007395*(D=p-10)+115.67994401066147*xv(D)):(l=351.97690566805693+.114206453784165*(l=p-55)-40.25366309332127*xv(l),E=325.4494125711974+.07943456536662342*(E=p-50)-28.0852963507957*xv(E),D=255),[l,E,D,1]},{round:YF}=Math,KF=(...c)=>{const p=bs(c,"rgb"),l=p[0],E=p[2];let D=1e3,N=4e4;const B=.4;let n;for(;N-D>B;){n=(N+D)*.5;const X=wC(n);X[2]/X[0]>=E/l?N=n:D=n}return YF(n)};Vn.prototype.temp=Vn.prototype.kelvin=Vn.prototype.temperature=function(){return KF(this._rgb)};const Cb=(...c)=>new Vn(...c,"temp");Object.assign(Hs,{temp:Cb,kelvin:Cb,temperature:Cb});ms.format.temp=ms.format.kelvin=ms.format.temperature=wC;Vn.prototype.oklch=function(){return cC(this._rgb)};const JF=(...c)=>new Vn(...c,"oklch");Object.assign(Hs,{oklch:JF});ms.format.oklch=uC;ms.autodetect.push({p:2,test:(...c)=>{if(c=bs(c,"oklch"),ks(c)==="array"&&c.length===3)return"oklch"}});Object.assign(Hs,{analyze:oC,average:Q4,bezier:sF,blend:Ku,brewer:FF,Color:Vn,colors:Kg,contrast:EF,contrastAPCA:LF,cubehelix:yF,deltaE:DF,distance:OF,input:ms,interpolate:Jg,limits:aC,mix:Jg,random:wF,scale:Zv,scales:kF,valid:zF});const QF="/GeoLocatorExplorer/logo.svg",eB="/GeoLocatorExplorer/ORCID_iD.svg",tB=(c,p)=>{const l=c.__vccOpts||c;for(const[E,D]of p)l[E]=D;return l},iB={data(){return{records:[],map:null,exaggeration:12,loading_records:!0}},mounted(){this.fetchRecords(),qM.accessToken="pk.eyJ1IjoicmFmbnVzcyIsImEiOiIzMVE1dnc0In0.3FNMKIlQ_afYktqki-6m0g",this.map=new qM.Map({container:"map",style:"mapbox://styles/mapbox/satellite-v9",center:[0,0],zoom:1,pitch:0,bearing:0}),this.map.on("load",()=>{this.map.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.terrain-rgb",tileSize:512,maxzoom:14}),this.map.setTerrain({source:"mapbox-dem",exaggeration:this.exaggeration})})},methods:{async loadCsvData(){try{const p=await(await fetch(this.csvUrl)).text();return new Promise((l,E)=>{ZM.parse(p,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:D=>{const B=D.data.reduce((n,X)=>{const{lon:$,lat:ne,altitude:ve,tag_id:ze}=X;if(!isNaN($)&&!isNaN(ne)&&!isNaN(ve)&&ze){const ke=[$,ne,ve*this.exaggeration];n[ze]||(n[ze]=[]),n[ze].push(ke)}return n},{});l(B)},error:D=>{console.error("Error parsing CSV:",D),E([])}})})}catch(c){return console.error("Error loading CSV data:",c),[]}},async fetchRecords(){const c="https://zenodo.org/api/records?communities=geolocator-dp";try{const p=await fetch(c);if(!p.ok)throw new Error(`Error fetching records: ${p.statusText}`);const l=await p.json();this.records=await Promise.all(l.hits.hits.map(async E=>{let D=E.files.reduce((N,B)=>{const{key:n,links:{self:X}}=B;return N[n]=X,N},{});if(!D["datapackage.json"])return console.warn("No datapackage.json found for record:",E.metadata.title),null;try{const B=await(await fetch(D["datapackage.json"])).json();E={...E,...B};let n="";E.metadata.description&&(n=E.metadata.description);const X=150;return n.length>X&&(n=n.substring(0,X).trim()+"..."),E.creators=E.metadata.creators,E.description=n,E.taxonomic=Array.isArray(E.taxonomic)?E.taxonomic:[E.taxonomic],E.doi=E.doi,E.tags=null,E.staps=null,E.paths=null,E.pressurepaths=null,E.loading=0,E.files=D,console.log(E.taxonomic),E}catch(N){return console.error("Error loading datapackage.json:",N),null}}))}catch(p){console.log(p)}finally{this.loading_records=!1,this.plotSpatial()}},loadDataRecord(c){this.records[c].loading=1;const p=["pressurepaths"],l=(D,N)=>new Promise((B,n)=>{const X=D.includes(".csv.gz");fetch(D).then($=>{if(!$.ok)throw new Error(`Network response was not ok for ${D}`);return X?$.arrayBuffer():$.text()}).then($=>{let ne;X?ne=Ak.ungzip(new Uint8Array($),{to:"string"}):ne=$,ZM.parse(ne,{complete:ve=>{this.records[c][N]=ve.data,B()},header:!0})}).catch($=>{console.error(`Error fetching or parsing ${N} CSV:`,$),n($)})}),E=p.map(D=>{const N=Object.keys(this.records[c].files).find(n=>n.includes(D)),B=this.records[c].files[N];return this.records[c].loading==2?(console.error(`Record ${D} already loaded.`),Promise.resolve()):B?l(B,D):(console.error(`File ${D} not found in the record.`),Promise.reject(new Error(`File ${D} not found in the record.`)))});Promise.all(E).then(()=>{this.records[c].loading=2,this.plotPathsOnMap()}).catch(D=>{console.error("Error loading CSV files:",D),this.records[c].loading=3})},plotPathsOnMap(){const p=this.records.map(N=>N.pressurepaths).flat().reduce((N,B)=>{if(B){const{lon:n,lat:X,altitude:$,tag_id:ne}=B;if(!isNaN(n)&&!isNaN(X)&&!isNaN($)&&ne){const ve=[Number(n),Number(X),Math.round(Number($)*this.exaggeration)];N[ne]||(N[ne]=[]),N[ne].push(ve)}}return N},{});console.log(p);const l=new Xk.Threebox(this.map,this.map.getCanvas().getContext("webgl"),{defaultLights:!0}),E=Object.keys(p),D=Hs.scale("spectral").domain([0,E.length-1]);E.forEach((N,B)=>{const n=p[N],X=D(B).hex();l.add(l.line({geometry:n,color:X,width:6,opacity:1}))}),this.map.getLayer("pressurepaths")&&this.map.removeLayer("pressurepaths"),this.map.addLayer({id:"pressurepaths",type:"custom",renderingMode:"3d",render:(N,B)=>{l.update()}})},plotSpatial(){this.records.forEach(c=>{if(c.spatial){const p="polygon-"+c.id,l="polygon-outline-"+c.id;this.map.addSource(p,{type:"geojson",data:c.spatial}),this.map.addLayer({id:l,type:"line",source:p,paint:{"line-color":"#FFF","line-width":2}})}})}}},nB={class:"d-flex vh-100"},rB={class:"bg-dark text-white p-4 overflow-auto",style:{width:"32rem"}},sB={key:0},oB={key:1},aB={class:"list-group"},lB={class:"d-flex w-100 justify-content-between"},cB={class:"mb-1"},uB=["onClick"],hB={key:1,class:"d-flex align-items-center",role:"status","aria-live":"polite"},dB={key:2,class:"d-flex align-items-center"},pB={class:"mb-1"},fB=["title"],mB=["href"],gB={key:1},_B={class:"text-muted"},yB={class:"d-flex flex-wrap gap-2 align-items-center mb-1"},vB={class:"badge bg-secondary rounded-pill"},xB=["href"],bB=["src"];function wB(c,p,l,E,D,N){return el(),dl("div",nB,[jo("div",rB,[p[6]||(p[6]=VP('<div class="d-flex align-items-center mb-2"><img src="'+QF+'" alt="GeoLocator Logo" style="max-width:40px;" class="bg-white rounded-circle p-1 me-2"><h2 class="h4 fw-bold mb-0">GeoLocatorExplorer</h2></div><p style="color:#f8f9fa;"> Visualize the pressurepath (3D trajectory on an hourly basis) constructed from pressure sensor for all datapackage. Simply click on <i class="bi bi-cloud-download"></i>, and navigate the map in 3D. </p>',2)),D.loading_records?(el(),dl("div",sB,"Loading datapackages...")):(el(),dl("div",oB,[jo("div",aB,[(el(!0),dl(Tc,null,uv(D.records,(B,n)=>(el(),dl("div",{key:B.id,class:"list-group-item list-group-item-action rounded mb-2 hover"},[jo("div",lB,[jo("h5",cB,zg(B.title),1),B.loading===0?(el(),dl("button",{key:0,class:"btn btn-link p-0",onClick:X=>N.loadDataRecord(n),"aria-label":"Load data"},p[0]||(p[0]=[jo("i",{class:"bi bi-cloud-download"},null,-1)]),8,uB)):B.loading===1?(el(),dl("div",hB,p[1]||(p[1]=[jo("div",{class:"spinner-border text-primary",style:{width:"1.5rem",height:"1.5rem"},"aria-hidden":"true"},null,-1),jo("span",{class:"visually-hidden"},"Loading...",-1)]))):B.loading===2?(el(),dl("div",dB,p[2]||(p[2]=[jo("i",{class:"bi bi-check-circle text-success"},null,-1)]))):L1("",!0)]),jo("p",pB,[(el(!0),dl(Tc,null,uv(B.creators,(X,$)=>(el(),dl("span",{key:X.orcid||$},[jo("span",{title:X.affiliation||""},zg(X.name),9,fB),X.orcid?(el(),dl("a",{key:0,href:"https://orcid.org/"+X.orcid,target:"_blank",title:"View ORCID"},p[3]||(p[3]=[jo("img",{src:eB,alt:"ORCID",class:"orcid-logo"},null,-1)]),8,mB)):L1("",!0),$<B.creators.length-1?(el(),dl("span",gB,", ")):L1("",!0)]))),128))]),jo("small",_B,[p[4]||(p[4]=jo("i",{class:"bi bi-calendar-range"},null,-1)),s3(" "+zg(B.temporal.start)+"  "+zg(B.temporal.end),1)]),(el(!0),dl(Tc,null,uv(B.taxonomic,X=>(el(),dl("span",{key:X}))),128)),jo("div",yB,[p[5]||(p[5]=jo("i",{class:"bi bi-feather"},null,-1)),(el(!0),dl(Tc,null,uv(B.taxonomic,X=>(el(),dl("span",{key:X},[jo("span",vB,zg(X),1)]))),128))]),jo("p",null,[jo("a",{href:"https://doi.org/"+B.doi,target:"_blank"},[jo("img",{src:"https://zenodo.org/badge/DOI/"+B.doi+".svg",alt:"DOI"},null,8,bB)],8,xB)])]))),128))])]))]),p[7]||(p[7]=jo("div",{class:"flex-grow-1 bg-light"},[jo("div",{id:"map",class:"h-100 w-100"})],-1))])}const TB=tB(iB,[["render",wB]]);var Vl="top",Ec="bottom",Ac="right",Gl="left",_x="auto",p_=[Vl,Ec,Ac,Gl],Im="start",Qg="end",TC="clippingParents",iT="viewport",Fg="popper",MC="reference",pw=p_.reduce(function(c,p){return c.concat([p+"-"+Im,p+"-"+Qg])},[]),nT=[].concat(p_,[_x]).reduce(function(c,p){return c.concat([p,p+"-"+Im,p+"-"+Qg])},[]),SC="beforeRead",EC="read",AC="afterRead",CC="beforeMain",LC="main",IC="afterMain",RC="beforeWrite",PC="write",DC="afterWrite",OC=[SC,EC,AC,CC,LC,IC,RC,PC,DC];function Qh(c){return c?(c.nodeName||"").toLowerCase():null}function Cc(c){if(c==null)return window;if(c.toString()!=="[object Window]"){var p=c.ownerDocument;return p&&p.defaultView||window}return c}function Rm(c){var p=Cc(c).Element;return c instanceof p||c instanceof Element}function cu(c){var p=Cc(c).HTMLElement;return c instanceof p||c instanceof HTMLElement}function rT(c){if(typeof ShadowRoot>"u")return!1;var p=Cc(c).ShadowRoot;return c instanceof p||c instanceof ShadowRoot}function MB(c){var p=c.state;Object.keys(p.elements).forEach(function(l){var E=p.styles[l]||{},D=p.attributes[l]||{},N=p.elements[l];!cu(N)||!Qh(N)||(Object.assign(N.style,E),Object.keys(D).forEach(function(B){var n=D[B];n===!1?N.removeAttribute(B):N.setAttribute(B,n===!0?"":n)}))})}function SB(c){var p=c.state,l={popper:{position:p.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(p.elements.popper.style,l.popper),p.styles=l,p.elements.arrow&&Object.assign(p.elements.arrow.style,l.arrow),function(){Object.keys(p.elements).forEach(function(E){var D=p.elements[E],N=p.attributes[E]||{},B=Object.keys(p.styles.hasOwnProperty(E)?p.styles[E]:l[E]),n=B.reduce(function(X,$){return X[$]="",X},{});!cu(D)||!Qh(D)||(Object.assign(D.style,n),Object.keys(N).forEach(function(X){D.removeAttribute(X)}))})}}const sT={name:"applyStyles",enabled:!0,phase:"write",fn:MB,effect:SB,requires:["computeStyles"]};function Yh(c){return c.split("-")[0]}var Sm=Math.max,Yv=Math.min,e_=Math.round;function fw(){var c=navigator.userAgentData;return c!=null&&c.brands&&Array.isArray(c.brands)?c.brands.map(function(p){return p.brand+"/"+p.version}).join(" "):navigator.userAgent}function zC(){return!/^((?!chrome|android).)*safari/i.test(fw())}function t_(c,p,l){p===void 0&&(p=!1),l===void 0&&(l=!1);var E=c.getBoundingClientRect(),D=1,N=1;p&&cu(c)&&(D=c.offsetWidth>0&&e_(E.width)/c.offsetWidth||1,N=c.offsetHeight>0&&e_(E.height)/c.offsetHeight||1);var B=Rm(c)?Cc(c):window,n=B.visualViewport,X=!zC()&&l,$=(E.left+(X&&n?n.offsetLeft:0))/D,ne=(E.top+(X&&n?n.offsetTop:0))/N,ve=E.width/D,ze=E.height/N;return{width:ve,height:ze,top:ne,right:$+ve,bottom:ne+ze,left:$,x:$,y:ne}}function oT(c){var p=t_(c),l=c.offsetWidth,E=c.offsetHeight;return Math.abs(p.width-l)<=1&&(l=p.width),Math.abs(p.height-E)<=1&&(E=p.height),{x:c.offsetLeft,y:c.offsetTop,width:l,height:E}}function kC(c,p){var l=p.getRootNode&&p.getRootNode();if(c.contains(p))return!0;if(l&&rT(l)){var E=p;do{if(E&&c.isSameNode(E))return!0;E=E.parentNode||E.host}while(E)}return!1}function jd(c){return Cc(c).getComputedStyle(c)}function EB(c){return["table","td","th"].indexOf(Qh(c))>=0}function lf(c){return((Rm(c)?c.ownerDocument:c.document)||window.document).documentElement}function yx(c){return Qh(c)==="html"?c:c.assignedSlot||c.parentNode||(rT(c)?c.host:null)||lf(c)}function wE(c){return!cu(c)||jd(c).position==="fixed"?null:c.offsetParent}function AB(c){var p=/firefox/i.test(fw()),l=/Trident/i.test(fw());if(l&&cu(c)){var E=jd(c);if(E.position==="fixed")return null}var D=yx(c);for(rT(D)&&(D=D.host);cu(D)&&["html","body"].indexOf(Qh(D))<0;){var N=jd(D);if(N.transform!=="none"||N.perspective!=="none"||N.contain==="paint"||["transform","perspective"].indexOf(N.willChange)!==-1||p&&N.willChange==="filter"||p&&N.filter&&N.filter!=="none")return D;D=D.parentNode}return null}function oy(c){for(var p=Cc(c),l=wE(c);l&&EB(l)&&jd(l).position==="static";)l=wE(l);return l&&(Qh(l)==="html"||Qh(l)==="body"&&jd(l).position==="static")?p:l||AB(c)||p}function aT(c){return["top","bottom"].indexOf(c)>=0?"x":"y"}function F0(c,p,l){return Sm(c,Yv(p,l))}function CB(c,p,l){var E=F0(c,p,l);return E>l?l:E}function FC(){return{top:0,right:0,bottom:0,left:0}}function BC(c){return Object.assign({},FC(),c)}function NC(c,p){return p.reduce(function(l,E){return l[E]=c,l},{})}var LB=function(p,l){return p=typeof p=="function"?p(Object.assign({},l.rects,{placement:l.placement})):p,BC(typeof p!="number"?p:NC(p,p_))};function IB(c){var p,l=c.state,E=c.name,D=c.options,N=l.elements.arrow,B=l.modifiersData.popperOffsets,n=Yh(l.placement),X=aT(n),$=[Gl,Ac].indexOf(n)>=0,ne=$?"height":"width";if(!(!N||!B)){var ve=LB(D.padding,l),ze=oT(N),ke=X==="y"?Vl:Gl,yt=X==="y"?Ec:Ac,it=l.rects.reference[ne]+l.rects.reference[X]-B[X]-l.rects.popper[ne],xt=B[X]-l.rects.reference[X],Ze=oy(N),st=Ze?X==="y"?Ze.clientHeight||0:Ze.clientWidth||0:0,ti=it/2-xt/2,mt=ve[ke],pt=st-ze[ne]-ve[yt],Tt=st/2-ze[ne]/2+ti,Fe=F0(mt,Tt,pt),et=X;l.modifiersData[E]=(p={},p[et]=Fe,p.centerOffset=Fe-Tt,p)}}function RB(c){var p=c.state,l=c.options,E=l.element,D=E===void 0?"[data-popper-arrow]":E;D!=null&&(typeof D=="string"&&(D=p.elements.popper.querySelector(D),!D)||kC(p.elements.popper,D)&&(p.elements.arrow=D))}const UC={name:"arrow",enabled:!0,phase:"main",fn:IB,effect:RB,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function i_(c){return c.split("-")[1]}var PB={top:"auto",right:"auto",bottom:"auto",left:"auto"};function DB(c,p){var l=c.x,E=c.y,D=p.devicePixelRatio||1;return{x:e_(l*D)/D||0,y:e_(E*D)/D||0}}function TE(c){var p,l=c.popper,E=c.popperRect,D=c.placement,N=c.variation,B=c.offsets,n=c.position,X=c.gpuAcceleration,$=c.adaptive,ne=c.roundOffsets,ve=c.isFixed,ze=B.x,ke=ze===void 0?0:ze,yt=B.y,it=yt===void 0?0:yt,xt=typeof ne=="function"?ne({x:ke,y:it}):{x:ke,y:it};ke=xt.x,it=xt.y;var Ze=B.hasOwnProperty("x"),st=B.hasOwnProperty("y"),ti=Gl,mt=Vl,pt=window;if($){var Tt=oy(l),Fe="clientHeight",et="clientWidth";if(Tt===Cc(l)&&(Tt=lf(l),jd(Tt).position!=="static"&&n==="absolute"&&(Fe="scrollHeight",et="scrollWidth")),Tt=Tt,D===Vl||(D===Gl||D===Ac)&&N===Qg){mt=Ec;var Xe=ve&&Tt===pt&&pt.visualViewport?pt.visualViewport.height:Tt[Fe];it-=Xe-E.height,it*=X?1:-1}if(D===Gl||(D===Vl||D===Ec)&&N===Qg){ti=Ac;var qe=ve&&Tt===pt&&pt.visualViewport?pt.visualViewport.width:Tt[et];ke-=qe-E.width,ke*=X?1:-1}}var gt=Object.assign({position:n},$&&PB),lt=ne===!0?DB({x:ke,y:it},Cc(l)):{x:ke,y:it};if(ke=lt.x,it=lt.y,X){var vt;return Object.assign({},gt,(vt={},vt[mt]=st?"0":"",vt[ti]=Ze?"0":"",vt.transform=(pt.devicePixelRatio||1)<=1?"translate("+ke+"px, "+it+"px)":"translate3d("+ke+"px, "+it+"px, 0)",vt))}return Object.assign({},gt,(p={},p[mt]=st?it+"px":"",p[ti]=Ze?ke+"px":"",p.transform="",p))}function OB(c){var p=c.state,l=c.options,E=l.gpuAcceleration,D=E===void 0?!0:E,N=l.adaptive,B=N===void 0?!0:N,n=l.roundOffsets,X=n===void 0?!0:n,$={placement:Yh(p.placement),variation:i_(p.placement),popper:p.elements.popper,popperRect:p.rects.popper,gpuAcceleration:D,isFixed:p.options.strategy==="fixed"};p.modifiersData.popperOffsets!=null&&(p.styles.popper=Object.assign({},p.styles.popper,TE(Object.assign({},$,{offsets:p.modifiersData.popperOffsets,position:p.options.strategy,adaptive:B,roundOffsets:X})))),p.modifiersData.arrow!=null&&(p.styles.arrow=Object.assign({},p.styles.arrow,TE(Object.assign({},$,{offsets:p.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:X})))),p.attributes.popper=Object.assign({},p.attributes.popper,{"data-popper-placement":p.placement})}const lT={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:OB,data:{}};var bv={passive:!0};function zB(c){var p=c.state,l=c.instance,E=c.options,D=E.scroll,N=D===void 0?!0:D,B=E.resize,n=B===void 0?!0:B,X=Cc(p.elements.popper),$=[].concat(p.scrollParents.reference,p.scrollParents.popper);return N&&$.forEach(function(ne){ne.addEventListener("scroll",l.update,bv)}),n&&X.addEventListener("resize",l.update,bv),function(){N&&$.forEach(function(ne){ne.removeEventListener("scroll",l.update,bv)}),n&&X.removeEventListener("resize",l.update,bv)}}const cT={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:zB,data:{}};var kB={left:"right",right:"left",bottom:"top",top:"bottom"};function zv(c){return c.replace(/left|right|bottom|top/g,function(p){return kB[p]})}var FB={start:"end",end:"start"};function ME(c){return c.replace(/start|end/g,function(p){return FB[p]})}function uT(c){var p=Cc(c),l=p.pageXOffset,E=p.pageYOffset;return{scrollLeft:l,scrollTop:E}}function hT(c){return t_(lf(c)).left+uT(c).scrollLeft}function BB(c,p){var l=Cc(c),E=lf(c),D=l.visualViewport,N=E.clientWidth,B=E.clientHeight,n=0,X=0;if(D){N=D.width,B=D.height;var $=zC();($||!$&&p==="fixed")&&(n=D.offsetLeft,X=D.offsetTop)}return{width:N,height:B,x:n+hT(c),y:X}}function NB(c){var p,l=lf(c),E=uT(c),D=(p=c.ownerDocument)==null?void 0:p.body,N=Sm(l.scrollWidth,l.clientWidth,D?D.scrollWidth:0,D?D.clientWidth:0),B=Sm(l.scrollHeight,l.clientHeight,D?D.scrollHeight:0,D?D.clientHeight:0),n=-E.scrollLeft+hT(c),X=-E.scrollTop;return jd(D||l).direction==="rtl"&&(n+=Sm(l.clientWidth,D?D.clientWidth:0)-N),{width:N,height:B,x:n,y:X}}function dT(c){var p=jd(c),l=p.overflow,E=p.overflowX,D=p.overflowY;return/auto|scroll|overlay|hidden/.test(l+D+E)}function VC(c){return["html","body","#document"].indexOf(Qh(c))>=0?c.ownerDocument.body:cu(c)&&dT(c)?c:VC(yx(c))}function B0(c,p){var l;p===void 0&&(p=[]);var E=VC(c),D=E===((l=c.ownerDocument)==null?void 0:l.body),N=Cc(E),B=D?[N].concat(N.visualViewport||[],dT(E)?E:[]):E,n=p.concat(B);return D?n:n.concat(B0(yx(B)))}function mw(c){return Object.assign({},c,{left:c.x,top:c.y,right:c.x+c.width,bottom:c.y+c.height})}function UB(c,p){var l=t_(c,!1,p==="fixed");return l.top=l.top+c.clientTop,l.left=l.left+c.clientLeft,l.bottom=l.top+c.clientHeight,l.right=l.left+c.clientWidth,l.width=c.clientWidth,l.height=c.clientHeight,l.x=l.left,l.y=l.top,l}function SE(c,p,l){return p===iT?mw(BB(c,l)):Rm(p)?UB(p,l):mw(NB(lf(c)))}function VB(c){var p=B0(yx(c)),l=["absolute","fixed"].indexOf(jd(c).position)>=0,E=l&&cu(c)?oy(c):c;return Rm(E)?p.filter(function(D){return Rm(D)&&kC(D,E)&&Qh(D)!=="body"}):[]}function GB(c,p,l,E){var D=p==="clippingParents"?VB(c):[].concat(p),N=[].concat(D,[l]),B=N[0],n=N.reduce(function(X,$){var ne=SE(c,$,E);return X.top=Sm(ne.top,X.top),X.right=Yv(ne.right,X.right),X.bottom=Yv(ne.bottom,X.bottom),X.left=Sm(ne.left,X.left),X},SE(c,B,E));return n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}function GC(c){var p=c.reference,l=c.element,E=c.placement,D=E?Yh(E):null,N=E?i_(E):null,B=p.x+p.width/2-l.width/2,n=p.y+p.height/2-l.height/2,X;switch(D){case Vl:X={x:B,y:p.y-l.height};break;case Ec:X={x:B,y:p.y+p.height};break;case Ac:X={x:p.x+p.width,y:n};break;case Gl:X={x:p.x-l.width,y:n};break;default:X={x:p.x,y:p.y}}var $=D?aT(D):null;if($!=null){var ne=$==="y"?"height":"width";switch(N){case Im:X[$]=X[$]-(p[ne]/2-l[ne]/2);break;case Qg:X[$]=X[$]+(p[ne]/2-l[ne]/2);break}}return X}function n_(c,p){p===void 0&&(p={});var l=p,E=l.placement,D=E===void 0?c.placement:E,N=l.strategy,B=N===void 0?c.strategy:N,n=l.boundary,X=n===void 0?TC:n,$=l.rootBoundary,ne=$===void 0?iT:$,ve=l.elementContext,ze=ve===void 0?Fg:ve,ke=l.altBoundary,yt=ke===void 0?!1:ke,it=l.padding,xt=it===void 0?0:it,Ze=BC(typeof xt!="number"?xt:NC(xt,p_)),st=ze===Fg?MC:Fg,ti=c.rects.popper,mt=c.elements[yt?st:ze],pt=GB(Rm(mt)?mt:mt.contextElement||lf(c.elements.popper),X,ne,B),Tt=t_(c.elements.reference),Fe=GC({reference:Tt,element:ti,strategy:"absolute",placement:D}),et=mw(Object.assign({},ti,Fe)),Xe=ze===Fg?et:Tt,qe={top:pt.top-Xe.top+Ze.top,bottom:Xe.bottom-pt.bottom+Ze.bottom,left:pt.left-Xe.left+Ze.left,right:Xe.right-pt.right+Ze.right},gt=c.modifiersData.offset;if(ze===Fg&&gt){var lt=gt[D];Object.keys(qe).forEach(function(vt){var Jt=[Ac,Ec].indexOf(vt)>=0?1:-1,le=[Vl,Ec].indexOf(vt)>=0?"y":"x";qe[vt]+=lt[le]*Jt})}return qe}function HB(c,p){p===void 0&&(p={});var l=p,E=l.placement,D=l.boundary,N=l.rootBoundary,B=l.padding,n=l.flipVariations,X=l.allowedAutoPlacements,$=X===void 0?nT:X,ne=i_(E),ve=ne?n?pw:pw.filter(function(yt){return i_(yt)===ne}):p_,ze=ve.filter(function(yt){return $.indexOf(yt)>=0});ze.length===0&&(ze=ve);var ke=ze.reduce(function(yt,it){return yt[it]=n_(c,{placement:it,boundary:D,rootBoundary:N,padding:B})[Yh(it)],yt},{});return Object.keys(ke).sort(function(yt,it){return ke[yt]-ke[it]})}function jB(c){if(Yh(c)===_x)return[];var p=zv(c);return[ME(c),p,ME(p)]}function WB(c){var p=c.state,l=c.options,E=c.name;if(!p.modifiersData[E]._skip){for(var D=l.mainAxis,N=D===void 0?!0:D,B=l.altAxis,n=B===void 0?!0:B,X=l.fallbackPlacements,$=l.padding,ne=l.boundary,ve=l.rootBoundary,ze=l.altBoundary,ke=l.flipVariations,yt=ke===void 0?!0:ke,it=l.allowedAutoPlacements,xt=p.options.placement,Ze=Yh(xt),st=Ze===xt,ti=X||(st||!yt?[zv(xt)]:jB(xt)),mt=[xt].concat(ti).reduce(function(Ht,ni){return Ht.concat(Yh(ni)===_x?HB(p,{placement:ni,boundary:ne,rootBoundary:ve,padding:$,flipVariations:yt,allowedAutoPlacements:it}):ni)},[]),pt=p.rects.reference,Tt=p.rects.popper,Fe=new Map,et=!0,Xe=mt[0],qe=0;qe<mt.length;qe++){var gt=mt[qe],lt=Yh(gt),vt=i_(gt)===Im,Jt=[Vl,Ec].indexOf(lt)>=0,le=Jt?"width":"height",we=n_(p,{placement:gt,boundary:ne,rootBoundary:ve,altBoundary:ze,padding:$}),xe=Jt?vt?Ac:Gl:vt?Ec:Vl;pt[le]>Tt[le]&&(xe=zv(xe));var De=zv(xe),Ce=[];if(N&&Ce.push(we[lt]<=0),n&&Ce.push(we[xe]<=0,we[De]<=0),Ce.every(function(Ht){return Ht})){Xe=gt,et=!1;break}Fe.set(gt,Ce)}if(et)for(var Gt=yt?3:1,Ft=function(ni){var zi=mt.find(function(Hi){var on=Fe.get(Hi);if(on)return on.slice(0,ni).every(function(mn){return mn})});if(zi)return Xe=zi,"break"},bt=Gt;bt>0;bt--){var Vt=Ft(bt);if(Vt==="break")break}p.placement!==Xe&&(p.modifiersData[E]._skip=!0,p.placement=Xe,p.reset=!0)}}const HC={name:"flip",enabled:!0,phase:"main",fn:WB,requiresIfExists:["offset"],data:{_skip:!1}};function EE(c,p,l){return l===void 0&&(l={x:0,y:0}),{top:c.top-p.height-l.y,right:c.right-p.width+l.x,bottom:c.bottom-p.height+l.y,left:c.left-p.width-l.x}}function AE(c){return[Vl,Ac,Ec,Gl].some(function(p){return c[p]>=0})}function qB(c){var p=c.state,l=c.name,E=p.rects.reference,D=p.rects.popper,N=p.modifiersData.preventOverflow,B=n_(p,{elementContext:"reference"}),n=n_(p,{altBoundary:!0}),X=EE(B,E),$=EE(n,D,N),ne=AE(X),ve=AE($);p.modifiersData[l]={referenceClippingOffsets:X,popperEscapeOffsets:$,isReferenceHidden:ne,hasPopperEscaped:ve},p.attributes.popper=Object.assign({},p.attributes.popper,{"data-popper-reference-hidden":ne,"data-popper-escaped":ve})}const jC={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:qB};function $B(c,p,l){var E=Yh(c),D=[Gl,Vl].indexOf(E)>=0?-1:1,N=typeof l=="function"?l(Object.assign({},p,{placement:c})):l,B=N[0],n=N[1];return B=B||0,n=(n||0)*D,[Gl,Ac].indexOf(E)>=0?{x:n,y:B}:{x:B,y:n}}function ZB(c){var p=c.state,l=c.options,E=c.name,D=l.offset,N=D===void 0?[0,0]:D,B=nT.reduce(function(ne,ve){return ne[ve]=$B(ve,p.rects,N),ne},{}),n=B[p.placement],X=n.x,$=n.y;p.modifiersData.popperOffsets!=null&&(p.modifiersData.popperOffsets.x+=X,p.modifiersData.popperOffsets.y+=$),p.modifiersData[E]=B}const WC={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:ZB};function XB(c){var p=c.state,l=c.name;p.modifiersData[l]=GC({reference:p.rects.reference,element:p.rects.popper,strategy:"absolute",placement:p.placement})}const pT={name:"popperOffsets",enabled:!0,phase:"read",fn:XB,data:{}};function YB(c){return c==="x"?"y":"x"}function KB(c){var p=c.state,l=c.options,E=c.name,D=l.mainAxis,N=D===void 0?!0:D,B=l.altAxis,n=B===void 0?!1:B,X=l.boundary,$=l.rootBoundary,ne=l.altBoundary,ve=l.padding,ze=l.tether,ke=ze===void 0?!0:ze,yt=l.tetherOffset,it=yt===void 0?0:yt,xt=n_(p,{boundary:X,rootBoundary:$,padding:ve,altBoundary:ne}),Ze=Yh(p.placement),st=i_(p.placement),ti=!st,mt=aT(Ze),pt=YB(mt),Tt=p.modifiersData.popperOffsets,Fe=p.rects.reference,et=p.rects.popper,Xe=typeof it=="function"?it(Object.assign({},p.rects,{placement:p.placement})):it,qe=typeof Xe=="number"?{mainAxis:Xe,altAxis:Xe}:Object.assign({mainAxis:0,altAxis:0},Xe),gt=p.modifiersData.offset?p.modifiersData.offset[p.placement]:null,lt={x:0,y:0};if(Tt){if(N){var vt,Jt=mt==="y"?Vl:Gl,le=mt==="y"?Ec:Ac,we=mt==="y"?"height":"width",xe=Tt[mt],De=xe+xt[Jt],Ce=xe-xt[le],Gt=ke?-et[we]/2:0,Ft=st===Im?Fe[we]:et[we],bt=st===Im?-et[we]:-Fe[we],Vt=p.elements.arrow,Ht=ke&&Vt?oT(Vt):{width:0,height:0},ni=p.modifiersData["arrow#persistent"]?p.modifiersData["arrow#persistent"].padding:FC(),zi=ni[Jt],Hi=ni[le],on=F0(0,Fe[we],Ht[we]),mn=ti?Fe[we]/2-Gt-on-zi-qe.mainAxis:Ft-on-zi-qe.mainAxis,ot=ti?-Fe[we]/2+Gt+on+Hi+qe.mainAxis:bt+on+Hi+qe.mainAxis,Yn=p.elements.arrow&&oy(p.elements.arrow),pr=Yn?mt==="y"?Yn.clientTop||0:Yn.clientLeft||0:0,At=(vt=gt==null?void 0:gt[mt])!=null?vt:0,Ye=xe+mn-At-pr,kt=xe+ot-At,Le=F0(ke?Yv(De,Ye):De,xe,ke?Sm(Ce,kt):Ce);Tt[mt]=Le,lt[mt]=Le-xe}if(n){var Ie,Ue=mt==="x"?Vl:Gl,We=mt==="x"?Ec:Ac,rt=Tt[pt],ut=pt==="y"?"height":"width",ht=rt+xt[Ue],Lt=rt-xt[We],It=[Vl,Gl].indexOf(Ze)!==-1,ui=(Ie=gt==null?void 0:gt[pt])!=null?Ie:0,xi=It?ht:rt-Fe[ut]-et[ut]-ui+qe.altAxis,an=It?rt+Fe[ut]+et[ut]-ui-qe.altAxis:Lt,cn=ke&&It?CB(xi,rt,an):F0(ke?xi:ht,rt,ke?an:Lt);Tt[pt]=cn,lt[pt]=cn-rt}p.modifiersData[E]=lt}}const qC={name:"preventOverflow",enabled:!0,phase:"main",fn:KB,requiresIfExists:["offset"]};function JB(c){return{scrollLeft:c.scrollLeft,scrollTop:c.scrollTop}}function QB(c){return c===Cc(c)||!cu(c)?uT(c):JB(c)}function e5(c){var p=c.getBoundingClientRect(),l=e_(p.width)/c.offsetWidth||1,E=e_(p.height)/c.offsetHeight||1;return l!==1||E!==1}function t5(c,p,l){l===void 0&&(l=!1);var E=cu(p),D=cu(p)&&e5(p),N=lf(p),B=t_(c,D,l),n={scrollLeft:0,scrollTop:0},X={x:0,y:0};return(E||!E&&!l)&&((Qh(p)!=="body"||dT(N))&&(n=QB(p)),cu(p)?(X=t_(p,!0),X.x+=p.clientLeft,X.y+=p.clientTop):N&&(X.x=hT(N))),{x:B.left+n.scrollLeft-X.x,y:B.top+n.scrollTop-X.y,width:B.width,height:B.height}}function i5(c){var p=new Map,l=new Set,E=[];c.forEach(function(N){p.set(N.name,N)});function D(N){l.add(N.name);var B=[].concat(N.requires||[],N.requiresIfExists||[]);B.forEach(function(n){if(!l.has(n)){var X=p.get(n);X&&D(X)}}),E.push(N)}return c.forEach(function(N){l.has(N.name)||D(N)}),E}function n5(c){var p=i5(c);return OC.reduce(function(l,E){return l.concat(p.filter(function(D){return D.phase===E}))},[])}function r5(c){var p;return function(){return p||(p=new Promise(function(l){Promise.resolve().then(function(){p=void 0,l(c())})})),p}}function s5(c){var p=c.reduce(function(l,E){var D=l[E.name];return l[E.name]=D?Object.assign({},D,E,{options:Object.assign({},D.options,E.options),data:Object.assign({},D.data,E.data)}):E,l},{});return Object.keys(p).map(function(l){return p[l]})}var CE={placement:"bottom",modifiers:[],strategy:"absolute"};function LE(){for(var c=arguments.length,p=new Array(c),l=0;l<c;l++)p[l]=arguments[l];return!p.some(function(E){return!(E&&typeof E.getBoundingClientRect=="function")})}function vx(c){c===void 0&&(c={});var p=c,l=p.defaultModifiers,E=l===void 0?[]:l,D=p.defaultOptions,N=D===void 0?CE:D;return function(n,X,$){$===void 0&&($=N);var ne={placement:"bottom",orderedModifiers:[],options:Object.assign({},CE,N),modifiersData:{},elements:{reference:n,popper:X},attributes:{},styles:{}},ve=[],ze=!1,ke={state:ne,setOptions:function(Ze){var st=typeof Ze=="function"?Ze(ne.options):Ze;it(),ne.options=Object.assign({},N,ne.options,st),ne.scrollParents={reference:Rm(n)?B0(n):n.contextElement?B0(n.contextElement):[],popper:B0(X)};var ti=n5(s5([].concat(E,ne.options.modifiers)));return ne.orderedModifiers=ti.filter(function(mt){return mt.enabled}),yt(),ke.update()},forceUpdate:function(){if(!ze){var Ze=ne.elements,st=Ze.reference,ti=Ze.popper;if(LE(st,ti)){ne.rects={reference:t5(st,oy(ti),ne.options.strategy==="fixed"),popper:oT(ti)},ne.reset=!1,ne.placement=ne.options.placement,ne.orderedModifiers.forEach(function(qe){return ne.modifiersData[qe.name]=Object.assign({},qe.data)});for(var mt=0;mt<ne.orderedModifiers.length;mt++){if(ne.reset===!0){ne.reset=!1,mt=-1;continue}var pt=ne.orderedModifiers[mt],Tt=pt.fn,Fe=pt.options,et=Fe===void 0?{}:Fe,Xe=pt.name;typeof Tt=="function"&&(ne=Tt({state:ne,options:et,name:Xe,instance:ke})||ne)}}}},update:r5(function(){return new Promise(function(xt){ke.forceUpdate(),xt(ne)})}),destroy:function(){it(),ze=!0}};if(!LE(n,X))return ke;ke.setOptions($).then(function(xt){!ze&&$.onFirstUpdate&&$.onFirstUpdate(xt)});function yt(){ne.orderedModifiers.forEach(function(xt){var Ze=xt.name,st=xt.options,ti=st===void 0?{}:st,mt=xt.effect;if(typeof mt=="function"){var pt=mt({state:ne,name:Ze,instance:ke,options:ti}),Tt=function(){};ve.push(pt||Tt)}})}function it(){ve.forEach(function(xt){return xt()}),ve=[]}return ke}}var o5=vx(),a5=[cT,pT,lT,sT],l5=vx({defaultModifiers:a5}),c5=[cT,pT,lT,sT,WC,HC,qC,UC,jC],fT=vx({defaultModifiers:c5});const $C=Object.freeze(Object.defineProperty({__proto__:null,afterMain:IC,afterRead:AC,afterWrite:DC,applyStyles:sT,arrow:UC,auto:_x,basePlacements:p_,beforeMain:CC,beforeRead:SC,beforeWrite:RC,bottom:Ec,clippingParents:TC,computeStyles:lT,createPopper:fT,createPopperBase:o5,createPopperLite:l5,detectOverflow:n_,end:Qg,eventListeners:cT,flip:HC,hide:jC,left:Gl,main:LC,modifierPhases:OC,offset:WC,placements:nT,popper:Fg,popperGenerator:vx,popperOffsets:pT,preventOverflow:qC,read:EC,reference:MC,right:Ac,start:Im,top:Vl,variationPlacements:pw,viewport:iT,write:PC},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const Hp=new Map,Lb={set(c,p,l){Hp.has(c)||Hp.set(c,new Map);const E=Hp.get(c);if(!E.has(p)&&E.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(E.keys())[0]}.`);return}E.set(p,l)},get(c,p){return Hp.has(c)&&Hp.get(c).get(p)||null},remove(c,p){if(!Hp.has(c))return;const l=Hp.get(c);l.delete(p),l.size===0&&Hp.delete(c)}},u5=1e6,h5=1e3,gw="transitionend",ZC=c=>(c&&window.CSS&&window.CSS.escape&&(c=c.replace(/#([^\s"#']+)/g,(p,l)=>`#${CSS.escape(l)}`)),c),d5=c=>c==null?`${c}`:Object.prototype.toString.call(c).match(/\s([a-z]+)/i)[1].toLowerCase(),p5=c=>{do c+=Math.floor(Math.random()*u5);while(document.getElementById(c));return c},f5=c=>{if(!c)return 0;let{transitionDuration:p,transitionDelay:l}=window.getComputedStyle(c);const E=Number.parseFloat(p),D=Number.parseFloat(l);return!E&&!D?0:(p=p.split(",")[0],l=l.split(",")[0],(Number.parseFloat(p)+Number.parseFloat(l))*h5)},XC=c=>{c.dispatchEvent(new Event(gw))},Gd=c=>!c||typeof c!="object"?!1:(typeof c.jquery<"u"&&(c=c[0]),typeof c.nodeType<"u"),Qp=c=>Gd(c)?c.jquery?c[0]:c:typeof c=="string"&&c.length>0?document.querySelector(ZC(c)):null,f_=c=>{if(!Gd(c)||c.getClientRects().length===0)return!1;const p=getComputedStyle(c).getPropertyValue("visibility")==="visible",l=c.closest("details:not([open])");if(!l)return p;if(l!==c){const E=c.closest("summary");if(E&&E.parentNode!==l||E===null)return!1}return p},ef=c=>!c||c.nodeType!==Node.ELEMENT_NODE||c.classList.contains("disabled")?!0:typeof c.disabled<"u"?c.disabled:c.hasAttribute("disabled")&&c.getAttribute("disabled")!=="false",YC=c=>{if(!document.documentElement.attachShadow)return null;if(typeof c.getRootNode=="function"){const p=c.getRootNode();return p instanceof ShadowRoot?p:null}return c instanceof ShadowRoot?c:c.parentNode?YC(c.parentNode):null},Kv=()=>{},ay=c=>{c.offsetHeight},KC=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Ib=[],m5=c=>{document.readyState==="loading"?(Ib.length||document.addEventListener("DOMContentLoaded",()=>{for(const p of Ib)p()}),Ib.push(c)):c()},du=()=>document.documentElement.dir==="rtl",fu=c=>{m5(()=>{const p=KC();if(p){const l=c.NAME,E=p.fn[l];p.fn[l]=c.jQueryInterface,p.fn[l].Constructor=c,p.fn[l].noConflict=()=>(p.fn[l]=E,c.jQueryInterface)}})},tc=(c,p=[],l=c)=>typeof c=="function"?c(...p):l,JC=(c,p,l=!0)=>{if(!l){tc(c);return}const D=f5(p)+5;let N=!1;const B=({target:n})=>{n===p&&(N=!0,p.removeEventListener(gw,B),tc(c))};p.addEventListener(gw,B),setTimeout(()=>{N||XC(p)},D)},mT=(c,p,l,E)=>{const D=c.length;let N=c.indexOf(p);return N===-1?!l&&E?c[D-1]:c[0]:(N+=l?1:-1,E&&(N=(N+D)%D),c[Math.max(0,Math.min(N,D-1))])},g5=/[^.]*(?=\..*)\.|.*/,_5=/\..*/,y5=/::\d+$/,Rb={};let IE=1;const QC={mouseenter:"mouseover",mouseleave:"mouseout"},v5=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function eL(c,p){return p&&`${p}::${IE++}`||c.uidEvent||IE++}function tL(c){const p=eL(c);return c.uidEvent=p,Rb[p]=Rb[p]||{},Rb[p]}function x5(c,p){return function l(E){return gT(E,{delegateTarget:c}),l.oneOff&&Pn.off(c,E.type,p),p.apply(c,[E])}}function b5(c,p,l){return function E(D){const N=c.querySelectorAll(p);for(let{target:B}=D;B&&B!==this;B=B.parentNode)for(const n of N)if(n===B)return gT(D,{delegateTarget:B}),E.oneOff&&Pn.off(c,D.type,p,l),l.apply(B,[D])}}function iL(c,p,l=null){return Object.values(c).find(E=>E.callable===p&&E.delegationSelector===l)}function nL(c,p,l){const E=typeof p=="string",D=E?l:p||l;let N=rL(c);return v5.has(N)||(N=c),[E,D,N]}function RE(c,p,l,E,D){if(typeof p!="string"||!c)return;let[N,B,n]=nL(p,l,E);p in QC&&(B=(yt=>function(it){if(!it.relatedTarget||it.relatedTarget!==it.delegateTarget&&!it.delegateTarget.contains(it.relatedTarget))return yt.call(this,it)})(B));const X=tL(c),$=X[n]||(X[n]={}),ne=iL($,B,N?l:null);if(ne){ne.oneOff=ne.oneOff&&D;return}const ve=eL(B,p.replace(g5,"")),ze=N?b5(c,l,B):x5(c,B);ze.delegationSelector=N?l:null,ze.callable=B,ze.oneOff=D,ze.uidEvent=ve,$[ve]=ze,c.addEventListener(n,ze,N)}function _w(c,p,l,E,D){const N=iL(p[l],E,D);N&&(c.removeEventListener(l,N,!!D),delete p[l][N.uidEvent])}function w5(c,p,l,E){const D=p[l]||{};for(const[N,B]of Object.entries(D))N.includes(E)&&_w(c,p,l,B.callable,B.delegationSelector)}function rL(c){return c=c.replace(_5,""),QC[c]||c}const Pn={on(c,p,l,E){RE(c,p,l,E,!1)},one(c,p,l,E){RE(c,p,l,E,!0)},off(c,p,l,E){if(typeof p!="string"||!c)return;const[D,N,B]=nL(p,l,E),n=B!==p,X=tL(c),$=X[B]||{},ne=p.startsWith(".");if(typeof N<"u"){if(!Object.keys($).length)return;_w(c,X,B,N,D?l:null);return}if(ne)for(const ve of Object.keys(X))w5(c,X,ve,p.slice(1));for(const[ve,ze]of Object.entries($)){const ke=ve.replace(y5,"");(!n||p.includes(ke))&&_w(c,X,B,ze.callable,ze.delegationSelector)}},trigger(c,p,l){if(typeof p!="string"||!c)return null;const E=KC(),D=rL(p),N=p!==D;let B=null,n=!0,X=!0,$=!1;N&&E&&(B=E.Event(p,l),E(c).trigger(B),n=!B.isPropagationStopped(),X=!B.isImmediatePropagationStopped(),$=B.isDefaultPrevented());const ne=gT(new Event(p,{bubbles:n,cancelable:!0}),l);return $&&ne.preventDefault(),X&&c.dispatchEvent(ne),ne.defaultPrevented&&B&&B.preventDefault(),ne}};function gT(c,p={}){for(const[l,E]of Object.entries(p))try{c[l]=E}catch{Object.defineProperty(c,l,{configurable:!0,get(){return E}})}return c}function PE(c){if(c==="true")return!0;if(c==="false")return!1;if(c===Number(c).toString())return Number(c);if(c===""||c==="null")return null;if(typeof c!="string")return c;try{return JSON.parse(decodeURIComponent(c))}catch{return c}}function Pb(c){return c.replace(/[A-Z]/g,p=>`-${p.toLowerCase()}`)}const Hd={setDataAttribute(c,p,l){c.setAttribute(`data-bs-${Pb(p)}`,l)},removeDataAttribute(c,p){c.removeAttribute(`data-bs-${Pb(p)}`)},getDataAttributes(c){if(!c)return{};const p={},l=Object.keys(c.dataset).filter(E=>E.startsWith("bs")&&!E.startsWith("bsConfig"));for(const E of l){let D=E.replace(/^bs/,"");D=D.charAt(0).toLowerCase()+D.slice(1,D.length),p[D]=PE(c.dataset[E])}return p},getDataAttribute(c,p){return PE(c.getAttribute(`data-bs-${Pb(p)}`))}};class ly{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(p){return p=this._mergeConfigObj(p),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p}_mergeConfigObj(p,l){const E=Gd(l)?Hd.getDataAttribute(l,"config"):{};return{...this.constructor.Default,...typeof E=="object"?E:{},...Gd(l)?Hd.getDataAttributes(l):{},...typeof p=="object"?p:{}}}_typeCheckConfig(p,l=this.constructor.DefaultType){for(const[E,D]of Object.entries(l)){const N=p[E],B=Gd(N)?"element":d5(N);if(!new RegExp(D).test(B))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${E}" provided type "${B}" but expected type "${D}".`)}}}const T5="5.3.3";class Ju extends ly{constructor(p,l){super(),p=Qp(p),p&&(this._element=p,this._config=this._getConfig(l),Lb.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Lb.remove(this._element,this.constructor.DATA_KEY),Pn.off(this._element,this.constructor.EVENT_KEY);for(const p of Object.getOwnPropertyNames(this))this[p]=null}_queueCallback(p,l,E=!0){JC(p,l,E)}_getConfig(p){return p=this._mergeConfigObj(p,this._element),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}static getInstance(p){return Lb.get(Qp(p),this.DATA_KEY)}static getOrCreateInstance(p,l={}){return this.getInstance(p)||new this(p,typeof l=="object"?l:null)}static get VERSION(){return T5}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(p){return`${p}${this.EVENT_KEY}`}}const Db=c=>{let p=c.getAttribute("data-bs-target");if(!p||p==="#"){let l=c.getAttribute("href");if(!l||!l.includes("#")&&!l.startsWith("."))return null;l.includes("#")&&!l.startsWith("#")&&(l=`#${l.split("#")[1]}`),p=l&&l!=="#"?l.trim():null}return p?p.split(",").map(l=>ZC(l)).join(","):null},jr={find(c,p=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(p,c))},findOne(c,p=document.documentElement){return Element.prototype.querySelector.call(p,c)},children(c,p){return[].concat(...c.children).filter(l=>l.matches(p))},parents(c,p){const l=[];let E=c.parentNode.closest(p);for(;E;)l.push(E),E=E.parentNode.closest(p);return l},prev(c,p){let l=c.previousElementSibling;for(;l;){if(l.matches(p))return[l];l=l.previousElementSibling}return[]},next(c,p){let l=c.nextElementSibling;for(;l;){if(l.matches(p))return[l];l=l.nextElementSibling}return[]},focusableChildren(c){const p=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(l=>`${l}:not([tabindex^="-"])`).join(",");return this.find(p,c).filter(l=>!ef(l)&&f_(l))},getSelectorFromElement(c){const p=Db(c);return p&&jr.findOne(p)?p:null},getElementFromSelector(c){const p=Db(c);return p?jr.findOne(p):null},getMultipleElementsFromSelector(c){const p=Db(c);return p?jr.find(p):[]}},xx=(c,p="hide")=>{const l=`click.dismiss${c.EVENT_KEY}`,E=c.NAME;Pn.on(document,l,`[data-bs-dismiss="${E}"]`,function(D){if(["A","AREA"].includes(this.tagName)&&D.preventDefault(),ef(this))return;const N=jr.getElementFromSelector(this)||this.closest(`.${E}`);c.getOrCreateInstance(N)[p]()})},M5="alert",S5="bs.alert",sL=`.${S5}`,E5=`close${sL}`,A5=`closed${sL}`,C5="fade",L5="show";class bx extends Ju{static get NAME(){return M5}close(){if(Pn.trigger(this._element,E5).defaultPrevented)return;this._element.classList.remove(L5);const l=this._element.classList.contains(C5);this._queueCallback(()=>this._destroyElement(),this._element,l)}_destroyElement(){this._element.remove(),Pn.trigger(this._element,A5),this.dispose()}static jQueryInterface(p){return this.each(function(){const l=bx.getOrCreateInstance(this);if(typeof p=="string"){if(l[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);l[p](this)}})}}xx(bx,"close");fu(bx);const I5="button",R5="bs.button",P5=`.${R5}`,D5=".data-api",O5="active",DE='[data-bs-toggle="button"]',z5=`click${P5}${D5}`;class wx extends Ju{static get NAME(){return I5}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(O5))}static jQueryInterface(p){return this.each(function(){const l=wx.getOrCreateInstance(this);p==="toggle"&&l[p]()})}}Pn.on(document,z5,DE,c=>{c.preventDefault();const p=c.target.closest(DE);wx.getOrCreateInstance(p).toggle()});fu(wx);const k5="swipe",m_=".bs.swipe",F5=`touchstart${m_}`,B5=`touchmove${m_}`,N5=`touchend${m_}`,U5=`pointerdown${m_}`,V5=`pointerup${m_}`,G5="touch",H5="pen",j5="pointer-event",W5=40,q5={endCallback:null,leftCallback:null,rightCallback:null},$5={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Jv extends ly{constructor(p,l){super(),this._element=p,!(!p||!Jv.isSupported())&&(this._config=this._getConfig(l),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return q5}static get DefaultType(){return $5}static get NAME(){return k5}dispose(){Pn.off(this._element,m_)}_start(p){if(!this._supportPointerEvents){this._deltaX=p.touches[0].clientX;return}this._eventIsPointerPenTouch(p)&&(this._deltaX=p.clientX)}_end(p){this._eventIsPointerPenTouch(p)&&(this._deltaX=p.clientX-this._deltaX),this._handleSwipe(),tc(this._config.endCallback)}_move(p){this._deltaX=p.touches&&p.touches.length>1?0:p.touches[0].clientX-this._deltaX}_handleSwipe(){const p=Math.abs(this._deltaX);if(p<=W5)return;const l=p/this._deltaX;this._deltaX=0,l&&tc(l>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Pn.on(this._element,U5,p=>this._start(p)),Pn.on(this._element,V5,p=>this._end(p)),this._element.classList.add(j5)):(Pn.on(this._element,F5,p=>this._start(p)),Pn.on(this._element,B5,p=>this._move(p)),Pn.on(this._element,N5,p=>this._end(p)))}_eventIsPointerPenTouch(p){return this._supportPointerEvents&&(p.pointerType===H5||p.pointerType===G5)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Z5="carousel",X5="bs.carousel",cf=`.${X5}`,oL=".data-api",Y5="ArrowLeft",K5="ArrowRight",J5=500,w0="next",Dg="prev",Bg="left",kv="right",Q5=`slide${cf}`,Ob=`slid${cf}`,eN=`keydown${cf}`,tN=`mouseenter${cf}`,iN=`mouseleave${cf}`,nN=`dragstart${cf}`,rN=`load${cf}${oL}`,sN=`click${cf}${oL}`,aL="carousel",wv="active",oN="slide",aN="carousel-item-end",lN="carousel-item-start",cN="carousel-item-next",uN="carousel-item-prev",lL=".active",cL=".carousel-item",hN=lL+cL,dN=".carousel-item img",pN=".carousel-indicators",fN="[data-bs-slide], [data-bs-slide-to]",mN='[data-bs-ride="carousel"]',gN={[Y5]:kv,[K5]:Bg},_N={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},yN={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class cy extends Ju{constructor(p,l){super(p,l),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=jr.findOne(pN,this._element),this._addEventListeners(),this._config.ride===aL&&this.cycle()}static get Default(){return _N}static get DefaultType(){return yN}static get NAME(){return Z5}next(){this._slide(w0)}nextWhenVisible(){!document.hidden&&f_(this._element)&&this.next()}prev(){this._slide(Dg)}pause(){this._isSliding&&XC(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){Pn.one(this._element,Ob,()=>this.cycle());return}this.cycle()}}to(p){const l=this._getItems();if(p>l.length-1||p<0)return;if(this._isSliding){Pn.one(this._element,Ob,()=>this.to(p));return}const E=this._getItemIndex(this._getActive());if(E===p)return;const D=p>E?w0:Dg;this._slide(D,l[p])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(p){return p.defaultInterval=p.interval,p}_addEventListeners(){this._config.keyboard&&Pn.on(this._element,eN,p=>this._keydown(p)),this._config.pause==="hover"&&(Pn.on(this._element,tN,()=>this.pause()),Pn.on(this._element,iN,()=>this._maybeEnableCycle())),this._config.touch&&Jv.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const E of jr.find(dN,this._element))Pn.on(E,nN,D=>D.preventDefault());const l={leftCallback:()=>this._slide(this._directionToOrder(Bg)),rightCallback:()=>this._slide(this._directionToOrder(kv)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),J5+this._config.interval))}};this._swipeHelper=new Jv(this._element,l)}_keydown(p){if(/input|textarea/i.test(p.target.tagName))return;const l=gN[p.key];l&&(p.preventDefault(),this._slide(this._directionToOrder(l)))}_getItemIndex(p){return this._getItems().indexOf(p)}_setActiveIndicatorElement(p){if(!this._indicatorsElement)return;const l=jr.findOne(lL,this._indicatorsElement);l.classList.remove(wv),l.removeAttribute("aria-current");const E=jr.findOne(`[data-bs-slide-to="${p}"]`,this._indicatorsElement);E&&(E.classList.add(wv),E.setAttribute("aria-current","true"))}_updateInterval(){const p=this._activeElement||this._getActive();if(!p)return;const l=Number.parseInt(p.getAttribute("data-bs-interval"),10);this._config.interval=l||this._config.defaultInterval}_slide(p,l=null){if(this._isSliding)return;const E=this._getActive(),D=p===w0,N=l||mT(this._getItems(),E,D,this._config.wrap);if(N===E)return;const B=this._getItemIndex(N),n=ke=>Pn.trigger(this._element,ke,{relatedTarget:N,direction:this._orderToDirection(p),from:this._getItemIndex(E),to:B});if(n(Q5).defaultPrevented||!E||!N)return;const $=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(B),this._activeElement=N;const ne=D?lN:aN,ve=D?cN:uN;N.classList.add(ve),ay(N),E.classList.add(ne),N.classList.add(ne);const ze=()=>{N.classList.remove(ne,ve),N.classList.add(wv),E.classList.remove(wv,ve,ne),this._isSliding=!1,n(Ob)};this._queueCallback(ze,E,this._isAnimated()),$&&this.cycle()}_isAnimated(){return this._element.classList.contains(oN)}_getActive(){return jr.findOne(hN,this._element)}_getItems(){return jr.find(cL,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(p){return du()?p===Bg?Dg:w0:p===Bg?w0:Dg}_orderToDirection(p){return du()?p===Dg?Bg:kv:p===Dg?kv:Bg}static jQueryInterface(p){return this.each(function(){const l=cy.getOrCreateInstance(this,p);if(typeof p=="number"){l.to(p);return}if(typeof p=="string"){if(l[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);l[p]()}})}}Pn.on(document,sN,fN,function(c){const p=jr.getElementFromSelector(this);if(!p||!p.classList.contains(aL))return;c.preventDefault();const l=cy.getOrCreateInstance(p),E=this.getAttribute("data-bs-slide-to");if(E){l.to(E),l._maybeEnableCycle();return}if(Hd.getDataAttribute(this,"slide")==="next"){l.next(),l._maybeEnableCycle();return}l.prev(),l._maybeEnableCycle()});Pn.on(window,rN,()=>{const c=jr.find(mN);for(const p of c)cy.getOrCreateInstance(p)});fu(cy);const vN="collapse",xN="bs.collapse",uy=`.${xN}`,bN=".data-api",wN=`show${uy}`,TN=`shown${uy}`,MN=`hide${uy}`,SN=`hidden${uy}`,EN=`click${uy}${bN}`,zb="show",Ug="collapse",Tv="collapsing",AN="collapsed",CN=`:scope .${Ug} .${Ug}`,LN="collapse-horizontal",IN="width",RN="height",PN=".collapse.show, .collapse.collapsing",yw='[data-bs-toggle="collapse"]',DN={parent:null,toggle:!0},ON={parent:"(null|element)",toggle:"boolean"};class Q0 extends Ju{constructor(p,l){super(p,l),this._isTransitioning=!1,this._triggerArray=[];const E=jr.find(yw);for(const D of E){const N=jr.getSelectorFromElement(D),B=jr.find(N).filter(n=>n===this._element);N!==null&&B.length&&this._triggerArray.push(D)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return DN}static get DefaultType(){return ON}static get NAME(){return vN}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let p=[];if(this._config.parent&&(p=this._getFirstLevelChildren(PN).filter(n=>n!==this._element).map(n=>Q0.getOrCreateInstance(n,{toggle:!1}))),p.length&&p[0]._isTransitioning||Pn.trigger(this._element,wN).defaultPrevented)return;for(const n of p)n.hide();const E=this._getDimension();this._element.classList.remove(Ug),this._element.classList.add(Tv),this._element.style[E]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const D=()=>{this._isTransitioning=!1,this._element.classList.remove(Tv),this._element.classList.add(Ug,zb),this._element.style[E]="",Pn.trigger(this._element,TN)},B=`scroll${E[0].toUpperCase()+E.slice(1)}`;this._queueCallback(D,this._element,!0),this._element.style[E]=`${this._element[B]}px`}hide(){if(this._isTransitioning||!this._isShown()||Pn.trigger(this._element,MN).defaultPrevented)return;const l=this._getDimension();this._element.style[l]=`${this._element.getBoundingClientRect()[l]}px`,ay(this._element),this._element.classList.add(Tv),this._element.classList.remove(Ug,zb);for(const D of this._triggerArray){const N=jr.getElementFromSelector(D);N&&!this._isShown(N)&&this._addAriaAndCollapsedClass([D],!1)}this._isTransitioning=!0;const E=()=>{this._isTransitioning=!1,this._element.classList.remove(Tv),this._element.classList.add(Ug),Pn.trigger(this._element,SN)};this._element.style[l]="",this._queueCallback(E,this._element,!0)}_isShown(p=this._element){return p.classList.contains(zb)}_configAfterMerge(p){return p.toggle=!!p.toggle,p.parent=Qp(p.parent),p}_getDimension(){return this._element.classList.contains(LN)?IN:RN}_initializeChildren(){if(!this._config.parent)return;const p=this._getFirstLevelChildren(yw);for(const l of p){const E=jr.getElementFromSelector(l);E&&this._addAriaAndCollapsedClass([l],this._isShown(E))}}_getFirstLevelChildren(p){const l=jr.find(CN,this._config.parent);return jr.find(p,this._config.parent).filter(E=>!l.includes(E))}_addAriaAndCollapsedClass(p,l){if(p.length)for(const E of p)E.classList.toggle(AN,!l),E.setAttribute("aria-expanded",l)}static jQueryInterface(p){const l={};return typeof p=="string"&&/show|hide/.test(p)&&(l.toggle=!1),this.each(function(){const E=Q0.getOrCreateInstance(this,l);if(typeof p=="string"){if(typeof E[p]>"u")throw new TypeError(`No method named "${p}"`);E[p]()}})}}Pn.on(document,EN,yw,function(c){(c.target.tagName==="A"||c.delegateTarget&&c.delegateTarget.tagName==="A")&&c.preventDefault();for(const p of jr.getMultipleElementsFromSelector(this))Q0.getOrCreateInstance(p,{toggle:!1}).toggle()});fu(Q0);const OE="dropdown",zN="bs.dropdown",zm=`.${zN}`,_T=".data-api",kN="Escape",zE="Tab",FN="ArrowUp",kE="ArrowDown",BN=2,NN=`hide${zm}`,UN=`hidden${zm}`,VN=`show${zm}`,GN=`shown${zm}`,uL=`click${zm}${_T}`,hL=`keydown${zm}${_T}`,HN=`keyup${zm}${_T}`,Ng="show",jN="dropup",WN="dropend",qN="dropstart",$N="dropup-center",ZN="dropdown-center",xm='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',XN=`${xm}.${Ng}`,Fv=".dropdown-menu",YN=".navbar",KN=".navbar-nav",JN=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",QN=du()?"top-end":"top-start",e6=du()?"top-start":"top-end",t6=du()?"bottom-end":"bottom-start",i6=du()?"bottom-start":"bottom-end",n6=du()?"left-start":"right-start",r6=du()?"right-start":"left-start",s6="top",o6="bottom",a6={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},l6={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Kh extends Ju{constructor(p,l){super(p,l),this._popper=null,this._parent=this._element.parentNode,this._menu=jr.next(this._element,Fv)[0]||jr.prev(this._element,Fv)[0]||jr.findOne(Fv,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return a6}static get DefaultType(){return l6}static get NAME(){return OE}toggle(){return this._isShown()?this.hide():this.show()}show(){if(ef(this._element)||this._isShown())return;const p={relatedTarget:this._element};if(!Pn.trigger(this._element,VN,p).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(KN))for(const E of[].concat(...document.body.children))Pn.on(E,"mouseover",Kv);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Ng),this._element.classList.add(Ng),Pn.trigger(this._element,GN,p)}}hide(){if(ef(this._element)||!this._isShown())return;const p={relatedTarget:this._element};this._completeHide(p)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(p){if(!Pn.trigger(this._element,NN,p).defaultPrevented){if("ontouchstart"in document.documentElement)for(const E of[].concat(...document.body.children))Pn.off(E,"mouseover",Kv);this._popper&&this._popper.destroy(),this._menu.classList.remove(Ng),this._element.classList.remove(Ng),this._element.setAttribute("aria-expanded","false"),Hd.removeDataAttribute(this._menu,"popper"),Pn.trigger(this._element,UN,p)}}_getConfig(p){if(p=super._getConfig(p),typeof p.reference=="object"&&!Gd(p.reference)&&typeof p.reference.getBoundingClientRect!="function")throw new TypeError(`${OE.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return p}_createPopper(){if(typeof $C>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let p=this._element;this._config.reference==="parent"?p=this._parent:Gd(this._config.reference)?p=Qp(this._config.reference):typeof this._config.reference=="object"&&(p=this._config.reference);const l=this._getPopperConfig();this._popper=fT(p,this._menu,l)}_isShown(){return this._menu.classList.contains(Ng)}_getPlacement(){const p=this._parent;if(p.classList.contains(WN))return n6;if(p.classList.contains(qN))return r6;if(p.classList.contains($N))return s6;if(p.classList.contains(ZN))return o6;const l=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return p.classList.contains(jN)?l?e6:QN:l?i6:t6}_detectNavbar(){return this._element.closest(YN)!==null}_getOffset(){const{offset:p}=this._config;return typeof p=="string"?p.split(",").map(l=>Number.parseInt(l,10)):typeof p=="function"?l=>p(l,this._element):p}_getPopperConfig(){const p={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Hd.setDataAttribute(this._menu,"popper","static"),p.modifiers=[{name:"applyStyles",enabled:!1}]),{...p,...tc(this._config.popperConfig,[p])}}_selectMenuItem({key:p,target:l}){const E=jr.find(JN,this._menu).filter(D=>f_(D));E.length&&mT(E,l,p===kE,!E.includes(l)).focus()}static jQueryInterface(p){return this.each(function(){const l=Kh.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof l[p]>"u")throw new TypeError(`No method named "${p}"`);l[p]()}})}static clearMenus(p){if(p.button===BN||p.type==="keyup"&&p.key!==zE)return;const l=jr.find(XN);for(const E of l){const D=Kh.getInstance(E);if(!D||D._config.autoClose===!1)continue;const N=p.composedPath(),B=N.includes(D._menu);if(N.includes(D._element)||D._config.autoClose==="inside"&&!B||D._config.autoClose==="outside"&&B||D._menu.contains(p.target)&&(p.type==="keyup"&&p.key===zE||/input|select|option|textarea|form/i.test(p.target.tagName)))continue;const n={relatedTarget:D._element};p.type==="click"&&(n.clickEvent=p),D._completeHide(n)}}static dataApiKeydownHandler(p){const l=/input|textarea/i.test(p.target.tagName),E=p.key===kN,D=[FN,kE].includes(p.key);if(!D&&!E||l&&!E)return;p.preventDefault();const N=this.matches(xm)?this:jr.prev(this,xm)[0]||jr.next(this,xm)[0]||jr.findOne(xm,p.delegateTarget.parentNode),B=Kh.getOrCreateInstance(N);if(D){p.stopPropagation(),B.show(),B._selectMenuItem(p);return}B._isShown()&&(p.stopPropagation(),B.hide(),N.focus())}}Pn.on(document,hL,xm,Kh.dataApiKeydownHandler);Pn.on(document,hL,Fv,Kh.dataApiKeydownHandler);Pn.on(document,uL,Kh.clearMenus);Pn.on(document,HN,Kh.clearMenus);Pn.on(document,uL,xm,function(c){c.preventDefault(),Kh.getOrCreateInstance(this).toggle()});fu(Kh);const dL="backdrop",c6="fade",FE="show",BE=`mousedown.bs.${dL}`,u6={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},h6={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class pL extends ly{constructor(p){super(),this._config=this._getConfig(p),this._isAppended=!1,this._element=null}static get Default(){return u6}static get DefaultType(){return h6}static get NAME(){return dL}show(p){if(!this._config.isVisible){tc(p);return}this._append();const l=this._getElement();this._config.isAnimated&&ay(l),l.classList.add(FE),this._emulateAnimation(()=>{tc(p)})}hide(p){if(!this._config.isVisible){tc(p);return}this._getElement().classList.remove(FE),this._emulateAnimation(()=>{this.dispose(),tc(p)})}dispose(){this._isAppended&&(Pn.off(this._element,BE),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const p=document.createElement("div");p.className=this._config.className,this._config.isAnimated&&p.classList.add(c6),this._element=p}return this._element}_configAfterMerge(p){return p.rootElement=Qp(p.rootElement),p}_append(){if(this._isAppended)return;const p=this._getElement();this._config.rootElement.append(p),Pn.on(p,BE,()=>{tc(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(p){JC(p,this._getElement(),this._config.isAnimated)}}const d6="focustrap",p6="bs.focustrap",Qv=`.${p6}`,f6=`focusin${Qv}`,m6=`keydown.tab${Qv}`,g6="Tab",_6="forward",NE="backward",y6={autofocus:!0,trapElement:null},v6={autofocus:"boolean",trapElement:"element"};class fL extends ly{constructor(p){super(),this._config=this._getConfig(p),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return y6}static get DefaultType(){return v6}static get NAME(){return d6}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Pn.off(document,Qv),Pn.on(document,f6,p=>this._handleFocusin(p)),Pn.on(document,m6,p=>this._handleKeydown(p)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Pn.off(document,Qv))}_handleFocusin(p){const{trapElement:l}=this._config;if(p.target===document||p.target===l||l.contains(p.target))return;const E=jr.focusableChildren(l);E.length===0?l.focus():this._lastTabNavDirection===NE?E[E.length-1].focus():E[0].focus()}_handleKeydown(p){p.key===g6&&(this._lastTabNavDirection=p.shiftKey?NE:_6)}}const UE=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",VE=".sticky-top",Mv="padding-right",GE="margin-right";class vw{constructor(){this._element=document.body}getWidth(){const p=document.documentElement.clientWidth;return Math.abs(window.innerWidth-p)}hide(){const p=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Mv,l=>l+p),this._setElementAttributes(UE,Mv,l=>l+p),this._setElementAttributes(VE,GE,l=>l-p)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Mv),this._resetElementAttributes(UE,Mv),this._resetElementAttributes(VE,GE)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(p,l,E){const D=this.getWidth(),N=B=>{if(B!==this._element&&window.innerWidth>B.clientWidth+D)return;this._saveInitialAttribute(B,l);const n=window.getComputedStyle(B).getPropertyValue(l);B.style.setProperty(l,`${E(Number.parseFloat(n))}px`)};this._applyManipulationCallback(p,N)}_saveInitialAttribute(p,l){const E=p.style.getPropertyValue(l);E&&Hd.setDataAttribute(p,l,E)}_resetElementAttributes(p,l){const E=D=>{const N=Hd.getDataAttribute(D,l);if(N===null){D.style.removeProperty(l);return}Hd.removeDataAttribute(D,l),D.style.setProperty(l,N)};this._applyManipulationCallback(p,E)}_applyManipulationCallback(p,l){if(Gd(p)){l(p);return}for(const E of jr.find(p,this._element))l(E)}}const x6="modal",b6="bs.modal",pu=`.${b6}`,w6=".data-api",T6="Escape",M6=`hide${pu}`,S6=`hidePrevented${pu}`,mL=`hidden${pu}`,gL=`show${pu}`,E6=`shown${pu}`,A6=`resize${pu}`,C6=`click.dismiss${pu}`,L6=`mousedown.dismiss${pu}`,I6=`keydown.dismiss${pu}`,R6=`click${pu}${w6}`,HE="modal-open",P6="fade",jE="show",kb="modal-static",D6=".modal.show",O6=".modal-dialog",z6=".modal-body",k6='[data-bs-toggle="modal"]',F6={backdrop:!0,focus:!0,keyboard:!0},B6={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class r_ extends Ju{constructor(p,l){super(p,l),this._dialog=jr.findOne(O6,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new vw,this._addEventListeners()}static get Default(){return F6}static get DefaultType(){return B6}static get NAME(){return x6}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){this._isShown||this._isTransitioning||Pn.trigger(this._element,gL,{relatedTarget:p}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(HE),this._adjustDialog(),this._backdrop.show(()=>this._showElement(p)))}hide(){!this._isShown||this._isTransitioning||Pn.trigger(this._element,M6).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(jE),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){Pn.off(window,pu),Pn.off(this._dialog,pu),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new pL({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new fL({trapElement:this._element})}_showElement(p){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const l=jr.findOne(z6,this._dialog);l&&(l.scrollTop=0),ay(this._element),this._element.classList.add(jE);const E=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Pn.trigger(this._element,E6,{relatedTarget:p})};this._queueCallback(E,this._dialog,this._isAnimated())}_addEventListeners(){Pn.on(this._element,I6,p=>{if(p.key===T6){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),Pn.on(window,A6,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Pn.on(this._element,L6,p=>{Pn.one(this._element,C6,l=>{if(!(this._element!==p.target||this._element!==l.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(HE),this._resetAdjustments(),this._scrollBar.reset(),Pn.trigger(this._element,mL)})}_isAnimated(){return this._element.classList.contains(P6)}_triggerBackdropTransition(){if(Pn.trigger(this._element,S6).defaultPrevented)return;const l=this._element.scrollHeight>document.documentElement.clientHeight,E=this._element.style.overflowY;E==="hidden"||this._element.classList.contains(kb)||(l||(this._element.style.overflowY="hidden"),this._element.classList.add(kb),this._queueCallback(()=>{this._element.classList.remove(kb),this._queueCallback(()=>{this._element.style.overflowY=E},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const p=this._element.scrollHeight>document.documentElement.clientHeight,l=this._scrollBar.getWidth(),E=l>0;if(E&&!p){const D=du()?"paddingLeft":"paddingRight";this._element.style[D]=`${l}px`}if(!E&&p){const D=du()?"paddingRight":"paddingLeft";this._element.style[D]=`${l}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(p,l){return this.each(function(){const E=r_.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof E[p]>"u")throw new TypeError(`No method named "${p}"`);E[p](l)}})}}Pn.on(document,R6,k6,function(c){const p=jr.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&c.preventDefault(),Pn.one(p,gL,D=>{D.defaultPrevented||Pn.one(p,mL,()=>{f_(this)&&this.focus()})});const l=jr.findOne(D6);l&&r_.getInstance(l).hide(),r_.getOrCreateInstance(p).toggle(this)});xx(r_);fu(r_);const N6="offcanvas",U6="bs.offcanvas",$d=`.${U6}`,_L=".data-api",V6=`load${$d}${_L}`,G6="Escape",WE="show",qE="showing",$E="hiding",H6="offcanvas-backdrop",yL=".offcanvas.show",j6=`show${$d}`,W6=`shown${$d}`,q6=`hide${$d}`,ZE=`hidePrevented${$d}`,vL=`hidden${$d}`,$6=`resize${$d}`,Z6=`click${$d}${_L}`,X6=`keydown.dismiss${$d}`,Y6='[data-bs-toggle="offcanvas"]',K6={backdrop:!0,keyboard:!0,scroll:!1},J6={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class tf extends Ju{constructor(p,l){super(p,l),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return K6}static get DefaultType(){return J6}static get NAME(){return N6}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){if(this._isShown||Pn.trigger(this._element,j6,{relatedTarget:p}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new vw().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(qE);const E=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(WE),this._element.classList.remove(qE),Pn.trigger(this._element,W6,{relatedTarget:p})};this._queueCallback(E,this._element,!0)}hide(){if(!this._isShown||Pn.trigger(this._element,q6).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add($E),this._backdrop.hide();const l=()=>{this._element.classList.remove(WE,$E),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new vw().reset(),Pn.trigger(this._element,vL)};this._queueCallback(l,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const p=()=>{if(this._config.backdrop==="static"){Pn.trigger(this._element,ZE);return}this.hide()},l=!!this._config.backdrop;return new pL({className:H6,isVisible:l,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:l?p:null})}_initializeFocusTrap(){return new fL({trapElement:this._element})}_addEventListeners(){Pn.on(this._element,X6,p=>{if(p.key===G6){if(this._config.keyboard){this.hide();return}Pn.trigger(this._element,ZE)}})}static jQueryInterface(p){return this.each(function(){const l=tf.getOrCreateInstance(this,p);if(typeof p=="string"){if(l[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);l[p](this)}})}}Pn.on(document,Z6,Y6,function(c){const p=jr.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&c.preventDefault(),ef(this))return;Pn.one(p,vL,()=>{f_(this)&&this.focus()});const l=jr.findOne(yL);l&&l!==p&&tf.getInstance(l).hide(),tf.getOrCreateInstance(p).toggle(this)});Pn.on(window,V6,()=>{for(const c of jr.find(yL))tf.getOrCreateInstance(c).show()});Pn.on(window,$6,()=>{for(const c of jr.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(c).position!=="fixed"&&tf.getOrCreateInstance(c).hide()});xx(tf);fu(tf);const Q6=/^aria-[\w-]*$/i,xL={"*":["class","dir","id","lang","role",Q6],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},eU=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),tU=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,iU=(c,p)=>{const l=c.nodeName.toLowerCase();return p.includes(l)?eU.has(l)?!!tU.test(c.nodeValue):!0:p.filter(E=>E instanceof RegExp).some(E=>E.test(l))};function nU(c,p,l){if(!c.length)return c;if(l&&typeof l=="function")return l(c);const D=new window.DOMParser().parseFromString(c,"text/html"),N=[].concat(...D.body.querySelectorAll("*"));for(const B of N){const n=B.nodeName.toLowerCase();if(!Object.keys(p).includes(n)){B.remove();continue}const X=[].concat(...B.attributes),$=[].concat(p["*"]||[],p[n]||[]);for(const ne of X)iU(ne,$)||B.removeAttribute(ne.nodeName)}return D.body.innerHTML}const rU="TemplateFactory",sU={allowList:xL,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},oU={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},aU={entry:"(string|element|function|null)",selector:"(string|element)"};class lU extends ly{constructor(p){super(),this._config=this._getConfig(p)}static get Default(){return sU}static get DefaultType(){return oU}static get NAME(){return rU}getContent(){return Object.values(this._config.content).map(p=>this._resolvePossibleFunction(p)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(p){return this._checkContent(p),this._config.content={...this._config.content,...p},this}toHtml(){const p=document.createElement("div");p.innerHTML=this._maybeSanitize(this._config.template);for(const[D,N]of Object.entries(this._config.content))this._setContent(p,N,D);const l=p.children[0],E=this._resolvePossibleFunction(this._config.extraClass);return E&&l.classList.add(...E.split(" ")),l}_typeCheckConfig(p){super._typeCheckConfig(p),this._checkContent(p.content)}_checkContent(p){for(const[l,E]of Object.entries(p))super._typeCheckConfig({selector:l,entry:E},aU)}_setContent(p,l,E){const D=jr.findOne(E,p);if(D){if(l=this._resolvePossibleFunction(l),!l){D.remove();return}if(Gd(l)){this._putElementInTemplate(Qp(l),D);return}if(this._config.html){D.innerHTML=this._maybeSanitize(l);return}D.textContent=l}}_maybeSanitize(p){return this._config.sanitize?nU(p,this._config.allowList,this._config.sanitizeFn):p}_resolvePossibleFunction(p){return tc(p,[this])}_putElementInTemplate(p,l){if(this._config.html){l.innerHTML="",l.append(p);return}l.textContent=p.textContent}}const cU="tooltip",uU=new Set(["sanitize","allowList","sanitizeFn"]),Fb="fade",hU="modal",Sv="show",dU=".tooltip-inner",XE=`.${hU}`,YE="hide.bs.modal",T0="hover",Bb="focus",pU="click",fU="manual",mU="hide",gU="hidden",_U="show",yU="shown",vU="inserted",xU="click",bU="focusin",wU="focusout",TU="mouseenter",MU="mouseleave",SU={AUTO:"auto",TOP:"top",RIGHT:du()?"left":"right",BOTTOM:"bottom",LEFT:du()?"right":"left"},EU={allowList:xL,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},AU={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class g_ extends Ju{constructor(p,l){if(typeof $C>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(p,l),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return EU}static get DefaultType(){return AU}static get NAME(){return cU}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),Pn.off(this._element.closest(XE),YE,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const p=Pn.trigger(this._element,this.constructor.eventName(_U)),E=(YC(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(p.defaultPrevented||!E)return;this._disposePopper();const D=this._getTipElement();this._element.setAttribute("aria-describedby",D.getAttribute("id"));const{container:N}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(N.append(D),Pn.trigger(this._element,this.constructor.eventName(vU))),this._popper=this._createPopper(D),D.classList.add(Sv),"ontouchstart"in document.documentElement)for(const n of[].concat(...document.body.children))Pn.on(n,"mouseover",Kv);const B=()=>{Pn.trigger(this._element,this.constructor.eventName(yU)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(B,this.tip,this._isAnimated())}hide(){if(!this._isShown()||Pn.trigger(this._element,this.constructor.eventName(mU)).defaultPrevented)return;if(this._getTipElement().classList.remove(Sv),"ontouchstart"in document.documentElement)for(const D of[].concat(...document.body.children))Pn.off(D,"mouseover",Kv);this._activeTrigger[pU]=!1,this._activeTrigger[Bb]=!1,this._activeTrigger[T0]=!1,this._isHovered=null;const E=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Pn.trigger(this._element,this.constructor.eventName(gU)))};this._queueCallback(E,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(p){const l=this._getTemplateFactory(p).toHtml();if(!l)return null;l.classList.remove(Fb,Sv),l.classList.add(`bs-${this.constructor.NAME}-auto`);const E=p5(this.constructor.NAME).toString();return l.setAttribute("id",E),this._isAnimated()&&l.classList.add(Fb),l}setContent(p){this._newContent=p,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(p){return this._templateFactory?this._templateFactory.changeContent(p):this._templateFactory=new lU({...this._config,content:p,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[dU]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(p){return this.constructor.getOrCreateInstance(p.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Fb)}_isShown(){return this.tip&&this.tip.classList.contains(Sv)}_createPopper(p){const l=tc(this._config.placement,[this,p,this._element]),E=SU[l.toUpperCase()];return fT(this._element,p,this._getPopperConfig(E))}_getOffset(){const{offset:p}=this._config;return typeof p=="string"?p.split(",").map(l=>Number.parseInt(l,10)):typeof p=="function"?l=>p(l,this._element):p}_resolvePossibleFunction(p){return tc(p,[this._element])}_getPopperConfig(p){const l={placement:p,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:E=>{this._getTipElement().setAttribute("data-popper-placement",E.state.placement)}}]};return{...l,...tc(this._config.popperConfig,[l])}}_setListeners(){const p=this._config.trigger.split(" ");for(const l of p)if(l==="click")Pn.on(this._element,this.constructor.eventName(xU),this._config.selector,E=>{this._initializeOnDelegatedTarget(E).toggle()});else if(l!==fU){const E=l===T0?this.constructor.eventName(TU):this.constructor.eventName(bU),D=l===T0?this.constructor.eventName(MU):this.constructor.eventName(wU);Pn.on(this._element,E,this._config.selector,N=>{const B=this._initializeOnDelegatedTarget(N);B._activeTrigger[N.type==="focusin"?Bb:T0]=!0,B._enter()}),Pn.on(this._element,D,this._config.selector,N=>{const B=this._initializeOnDelegatedTarget(N);B._activeTrigger[N.type==="focusout"?Bb:T0]=B._element.contains(N.relatedTarget),B._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Pn.on(this._element.closest(XE),YE,this._hideModalHandler)}_fixTitle(){const p=this._element.getAttribute("title");p&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",p),this._element.setAttribute("data-bs-original-title",p),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(p,l){clearTimeout(this._timeout),this._timeout=setTimeout(p,l)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(p){const l=Hd.getDataAttributes(this._element);for(const E of Object.keys(l))uU.has(E)&&delete l[E];return p={...l,...typeof p=="object"&&p?p:{}},p=this._mergeConfigObj(p),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p.container=p.container===!1?document.body:Qp(p.container),typeof p.delay=="number"&&(p.delay={show:p.delay,hide:p.delay}),typeof p.title=="number"&&(p.title=p.title.toString()),typeof p.content=="number"&&(p.content=p.content.toString()),p}_getDelegateConfig(){const p={};for(const[l,E]of Object.entries(this._config))this.constructor.Default[l]!==E&&(p[l]=E);return p.selector=!1,p.trigger="manual",p}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(p){return this.each(function(){const l=g_.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof l[p]>"u")throw new TypeError(`No method named "${p}"`);l[p]()}})}}fu(g_);const CU="popover",LU=".popover-header",IU=".popover-body",RU={...g_.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},PU={...g_.DefaultType,content:"(null|string|element|function)"};class yT extends g_{static get Default(){return RU}static get DefaultType(){return PU}static get NAME(){return CU}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[LU]:this._getTitle(),[IU]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(p){return this.each(function(){const l=yT.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof l[p]>"u")throw new TypeError(`No method named "${p}"`);l[p]()}})}}fu(yT);const DU="scrollspy",OU="bs.scrollspy",vT=`.${OU}`,zU=".data-api",kU=`activate${vT}`,KE=`click${vT}`,FU=`load${vT}${zU}`,BU="dropdown-item",Og="active",NU='[data-bs-spy="scroll"]',Nb="[href]",UU=".nav, .list-group",JE=".nav-link",VU=".nav-item",GU=".list-group-item",HU=`${JE}, ${VU} > ${JE}, ${GU}`,jU=".dropdown",WU=".dropdown-toggle",qU={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},$U={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Tx extends Ju{constructor(p,l){super(p,l),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return qU}static get DefaultType(){return $U}static get NAME(){return DU}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const p of this._observableSections.values())this._observer.observe(p)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(p){return p.target=Qp(p.target)||document.body,p.rootMargin=p.offset?`${p.offset}px 0px -30%`:p.rootMargin,typeof p.threshold=="string"&&(p.threshold=p.threshold.split(",").map(l=>Number.parseFloat(l))),p}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Pn.off(this._config.target,KE),Pn.on(this._config.target,KE,Nb,p=>{const l=this._observableSections.get(p.target.hash);if(l){p.preventDefault();const E=this._rootElement||window,D=l.offsetTop-this._element.offsetTop;if(E.scrollTo){E.scrollTo({top:D,behavior:"smooth"});return}E.scrollTop=D}}))}_getNewObserver(){const p={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(l=>this._observerCallback(l),p)}_observerCallback(p){const l=B=>this._targetLinks.get(`#${B.target.id}`),E=B=>{this._previousScrollData.visibleEntryTop=B.target.offsetTop,this._process(l(B))},D=(this._rootElement||document.documentElement).scrollTop,N=D>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=D;for(const B of p){if(!B.isIntersecting){this._activeTarget=null,this._clearActiveClass(l(B));continue}const n=B.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(N&&n){if(E(B),!D)return;continue}!N&&!n&&E(B)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const p=jr.find(Nb,this._config.target);for(const l of p){if(!l.hash||ef(l))continue;const E=jr.findOne(decodeURI(l.hash),this._element);f_(E)&&(this._targetLinks.set(decodeURI(l.hash),l),this._observableSections.set(l.hash,E))}}_process(p){this._activeTarget!==p&&(this._clearActiveClass(this._config.target),this._activeTarget=p,p.classList.add(Og),this._activateParents(p),Pn.trigger(this._element,kU,{relatedTarget:p}))}_activateParents(p){if(p.classList.contains(BU)){jr.findOne(WU,p.closest(jU)).classList.add(Og);return}for(const l of jr.parents(p,UU))for(const E of jr.prev(l,HU))E.classList.add(Og)}_clearActiveClass(p){p.classList.remove(Og);const l=jr.find(`${Nb}.${Og}`,p);for(const E of l)E.classList.remove(Og)}static jQueryInterface(p){return this.each(function(){const l=Tx.getOrCreateInstance(this,p);if(typeof p=="string"){if(l[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);l[p]()}})}}Pn.on(window,FU,()=>{for(const c of jr.find(NU))Tx.getOrCreateInstance(c)});fu(Tx);const ZU="tab",XU="bs.tab",km=`.${XU}`,YU=`hide${km}`,KU=`hidden${km}`,JU=`show${km}`,QU=`shown${km}`,eV=`click${km}`,tV=`keydown${km}`,iV=`load${km}`,nV="ArrowLeft",QE="ArrowRight",rV="ArrowUp",eA="ArrowDown",Ub="Home",tA="End",bm="active",iA="fade",Vb="show",sV="dropdown",bL=".dropdown-toggle",oV=".dropdown-menu",Gb=`:not(${bL})`,aV='.list-group, .nav, [role="tablist"]',lV=".nav-item, .list-group-item",cV=`.nav-link${Gb}, .list-group-item${Gb}, [role="tab"]${Gb}`,wL='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Hb=`${cV}, ${wL}`,uV=`.${bm}[data-bs-toggle="tab"], .${bm}[data-bs-toggle="pill"], .${bm}[data-bs-toggle="list"]`;class s_ extends Ju{constructor(p){super(p),this._parent=this._element.closest(aV),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Pn.on(this._element,tV,l=>this._keydown(l)))}static get NAME(){return ZU}show(){const p=this._element;if(this._elemIsActive(p))return;const l=this._getActiveElem(),E=l?Pn.trigger(l,YU,{relatedTarget:p}):null;Pn.trigger(p,JU,{relatedTarget:l}).defaultPrevented||E&&E.defaultPrevented||(this._deactivate(l,p),this._activate(p,l))}_activate(p,l){if(!p)return;p.classList.add(bm),this._activate(jr.getElementFromSelector(p));const E=()=>{if(p.getAttribute("role")!=="tab"){p.classList.add(Vb);return}p.removeAttribute("tabindex"),p.setAttribute("aria-selected",!0),this._toggleDropDown(p,!0),Pn.trigger(p,QU,{relatedTarget:l})};this._queueCallback(E,p,p.classList.contains(iA))}_deactivate(p,l){if(!p)return;p.classList.remove(bm),p.blur(),this._deactivate(jr.getElementFromSelector(p));const E=()=>{if(p.getAttribute("role")!=="tab"){p.classList.remove(Vb);return}p.setAttribute("aria-selected",!1),p.setAttribute("tabindex","-1"),this._toggleDropDown(p,!1),Pn.trigger(p,KU,{relatedTarget:l})};this._queueCallback(E,p,p.classList.contains(iA))}_keydown(p){if(![nV,QE,rV,eA,Ub,tA].includes(p.key))return;p.stopPropagation(),p.preventDefault();const l=this._getChildren().filter(D=>!ef(D));let E;if([Ub,tA].includes(p.key))E=l[p.key===Ub?0:l.length-1];else{const D=[QE,eA].includes(p.key);E=mT(l,p.target,D,!0)}E&&(E.focus({preventScroll:!0}),s_.getOrCreateInstance(E).show())}_getChildren(){return jr.find(Hb,this._parent)}_getActiveElem(){return this._getChildren().find(p=>this._elemIsActive(p))||null}_setInitialAttributes(p,l){this._setAttributeIfNotExists(p,"role","tablist");for(const E of l)this._setInitialAttributesOnChild(E)}_setInitialAttributesOnChild(p){p=this._getInnerElement(p);const l=this._elemIsActive(p),E=this._getOuterElement(p);p.setAttribute("aria-selected",l),E!==p&&this._setAttributeIfNotExists(E,"role","presentation"),l||p.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(p,"role","tab"),this._setInitialAttributesOnTargetPanel(p)}_setInitialAttributesOnTargetPanel(p){const l=jr.getElementFromSelector(p);l&&(this._setAttributeIfNotExists(l,"role","tabpanel"),p.id&&this._setAttributeIfNotExists(l,"aria-labelledby",`${p.id}`))}_toggleDropDown(p,l){const E=this._getOuterElement(p);if(!E.classList.contains(sV))return;const D=(N,B)=>{const n=jr.findOne(N,E);n&&n.classList.toggle(B,l)};D(bL,bm),D(oV,Vb),E.setAttribute("aria-expanded",l)}_setAttributeIfNotExists(p,l,E){p.hasAttribute(l)||p.setAttribute(l,E)}_elemIsActive(p){return p.classList.contains(bm)}_getInnerElement(p){return p.matches(Hb)?p:jr.findOne(Hb,p)}_getOuterElement(p){return p.closest(lV)||p}static jQueryInterface(p){return this.each(function(){const l=s_.getOrCreateInstance(this);if(typeof p=="string"){if(l[p]===void 0||p.startsWith("_")||p==="constructor")throw new TypeError(`No method named "${p}"`);l[p]()}})}}Pn.on(document,eV,wL,function(c){["A","AREA"].includes(this.tagName)&&c.preventDefault(),!ef(this)&&s_.getOrCreateInstance(this).show()});Pn.on(window,iV,()=>{for(const c of jr.find(uV))s_.getOrCreateInstance(c)});fu(s_);const hV="toast",dV="bs.toast",uf=`.${dV}`,pV=`mouseover${uf}`,fV=`mouseout${uf}`,mV=`focusin${uf}`,gV=`focusout${uf}`,_V=`hide${uf}`,yV=`hidden${uf}`,vV=`show${uf}`,xV=`shown${uf}`,bV="fade",nA="hide",Ev="show",Av="showing",wV={animation:"boolean",autohide:"boolean",delay:"number"},TV={animation:!0,autohide:!0,delay:5e3};class Mx extends Ju{constructor(p,l){super(p,l),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return TV}static get DefaultType(){return wV}static get NAME(){return hV}show(){if(Pn.trigger(this._element,vV).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(bV);const l=()=>{this._element.classList.remove(Av),Pn.trigger(this._element,xV),this._maybeScheduleHide()};this._element.classList.remove(nA),ay(this._element),this._element.classList.add(Ev,Av),this._queueCallback(l,this._element,this._config.animation)}hide(){if(!this.isShown()||Pn.trigger(this._element,_V).defaultPrevented)return;const l=()=>{this._element.classList.add(nA),this._element.classList.remove(Av,Ev),Pn.trigger(this._element,yV)};this._element.classList.add(Av),this._queueCallback(l,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Ev),super.dispose()}isShown(){return this._element.classList.contains(Ev)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(p,l){switch(p.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=l;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=l;break}}if(l){this._clearTimeout();return}const E=p.relatedTarget;this._element===E||this._element.contains(E)||this._maybeScheduleHide()}_setListeners(){Pn.on(this._element,pV,p=>this._onInteraction(p,!0)),Pn.on(this._element,fV,p=>this._onInteraction(p,!1)),Pn.on(this._element,mV,p=>this._onInteraction(p,!0)),Pn.on(this._element,gV,p=>this._onInteraction(p,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(p){return this.each(function(){const l=Mx.getOrCreateInstance(this,p);if(typeof p=="string"){if(typeof l[p]>"u")throw new TypeError(`No method named "${p}"`);l[p](this)}})}}xx(Mx);fu(Mx);bD(TB).mount("#app");
